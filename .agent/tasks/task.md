# Tasks

- [x] Fix `downloadSharedProject` ReferenceError in `app-session.js` <!-- id: 0 -->
- [x] Investigate and fix infinite recursion in `updateCalculations` <!-- id: 1 -->
    - [x] Check definition of `updateCalculations` in `app-core-new-2.js` <!-- id: 2 -->
    - [x] Ensure `app-session.js` wrapper doesn't call itself <!-- id: 3 -->
- [x] Migrate `app-session.js` specific logic to ESM modules <!-- id: 4 -->
    - [x] Extract `notifications.js` and add unit tests <!-- id: 5 -->
    - [x] Extract `session-runtime.js` and add unit tests <!-- id: 6 -->
    - [x] Migrate `web-lock-manager` to `ProjectLockService` with legacy adapter <!-- id: 7 -->
- [x] Migrate Settings & Appearance Logic <!-- id: 8 -->
    - [x] Refactor `settings-and-appearance.js` to ESM <!-- id: 9 -->
    - [x] Update `app-session.js` to import settings module directly <!-- id: 10 -->
    - [x] Remove dynamic appearance binding from `app-session.js` <!-- id: 11 -->
- [x] Session Migration - Phase 3 (URL Handling) <!-- id: 12 -->
    - [x] Create `src/scripts/modules/core/url-handler.js` <!-- id: 13 -->
    - [x] Extract `applySharedSetupFromUrl` and URL cleanup logic <!-- id: 14 -->
    - [x] Refactor `app-session.js` to use `UrlHandler` <!-- id: 15 -->
    - [x] Verify Shared Setup URL loading <!-- id: 16 -->
- [x] Session Migration - Phase 4 (Event Binding) <!-- id: 17 -->
    - [x] Analyze event listener dependencies <!-- id: 18 -->
    - [x] Create `src/scripts/modules/core/event-binder.js` <!-- id: 19 -->
    - [x] Extract event setup logic <!-- id: 20 -->
    - [x] Refactor `app-session.js` to use `EventBinder` <!-- id: 21 -->
- [x] Session Migration - Phase 5 (Project Storage) <!-- id: 22 -->
    - [x] Create `src/scripts/modules/core/project-storage-manager.js` <!-- id: 23 -->
    - [x] Extract `resolveActiveProjectStorageKey` and revision logic <!-- id: 24 -->
    - [x] Extract `scheduleProjectStorageSync` <!-- id: 25 -->
    - [x] Refactor `app-session.js` to use `ProjectStorageManager` <!-- id: 26 -->
- [x] Session Migration - Phase 6 (Backup & Export) <!-- id: 27 -->
    - [x] Create `start_server` workflow <!-- id: 28 -->
    - [x] Create `src/scripts/modules/core/project-transfer-manager.js` <!-- id: 29 -->
    - [x] Extract `downloadSharedProject` logic (New module created, app-session refactored) <!-- id: 30 -->
    - [x] Refactor `app-session.js` to use `ProjectTransferManager` <!-- id: 31 -->
    - [x] Verify Backup & Export functionality (Code reviewed and linted) <!-- id: 32 -->
- [x] Session Migration - Phase 7 (Logging Module) <!-- id: 33 -->
    - [x] Create `src/scripts/modules/core/logging-manager.js` <!-- id: 34 -->
    - [x] Extract logging logic from `app-session.js` <!-- id: 35 -->
    - [x] Refactor `app-session.js` to use `LoggingManager` <!-- id: 36 -->
- [x] Session Migration - Phase 8 (Restore Compatibility) <!-- id: 38 -->
    - [x] Create `src/scripts/modules/core/restore-compatibility-manager.js` <!-- id: 39 -->
    - [x] Extract `verifyRestoredBackupIntegrity` and helper logic <!-- id: 40 -->
    - [x] Refactor `app-session.js` to use `RestoreCompatibilityManager` <!-- id: 41 -->
    - [x] Verify functionality <!-- id: 42 -->
- [x] Session Migration - Phase 9 (Feature Search Extraction) <!-- id: 43 -->
    - [x] Create `src/scripts/modules/features/feature-search.js` <!-- id: 44 -->
    - [x] Extract `featureSearchEntries`, `runFeatureSearch`, and UI logic (lines ~16000-16700) <!-- id: 45 -->
    - [x] Refactor `app-session.js` to use `FeatureSearch` module <!-- id: 46 -->
    - [x] Verify functionality <!-- id: 47 -->
- [x] Session Migration - Phase 10 (Project Import Logic) <!-- id: 50 -->
    - [x] Create `src/scripts/modules/core/project-import-manager.js` <!-- id: 51 -->
    - [x] Extract `ensureImportedProjectBaseNameSession`, `resolveProjectNameCollisionForImport` logic <!-- id: 52 -->
    - [x] Extract `applySharedSetup` logic (partially or fully) <!-- id: 53 -->
    - [x] Refactor `app-session.js` to use `ProjectImportManager` <!-- id: 54 -->
    - [x] Verify functionality <!-- id: 55 -->
- [x] Session Migration - Phase 11 (Device Capability Extraction) <!-- id: 56 -->
    - [x] Create `src/scripts/modules/core/device-capability-manager.js` <!-- id: 57 -->
    - [x] Extract Lens Focus Scale logic (lines ~17000-17206) <!-- id: 58 -->
    - [x] Extract Frame Rate/Resolution logic (lines ~17241-17800) <!-- id: 59 -->
    - [x] Refactor `app-session.js` to use `DeviceCapabilityManager` <!-- id: 60 -->
    - [x] Verify functionality <!-- id: 61 -->
- [x] Session Migration - Phase 12 (Contact Manager) <!-- id: 62 -->
    - [x] Create `src/scripts/modules/features/contact-manager.js` <!-- id: 63 -->
    - [x] Extract `mergeSharedContactsIntoCache` and related logic <!-- id: 64 -->
    - [x] Refactor `app-session.js` to use `ContactManager` <!-- id: 65 -->
    - [x] Verify functionality <!-- id: 66 -->
- [x] Session Migration - Phase 13 (AutoGear Manager) <!-- id: 67 -->
    - [x] Create `src/scripts/modules/features/auto-gear-manager.js` <!-- id: 68 -->
    - [x] Extract AutoGear state and logic <!-- id: 69 -->
    - [x] Refactor `app-session.js` to use `AutoGearManager` <!-- id: 70 -->
    - [x] Verify functionality <!-- id: 71 -->
- [x] Session Migration - Phase 14 (Initialization Manager) <!-- id: 72 -->
    - [x] Create `src/scripts/modules/core/initialization-manager.js` <!-- id: 73 -->
    - [x] Extract `initApp` logic <!-- id: 74 -->
    - [x] Refactor `app-session.js` to use `InitializationManager` <!-- id: 75 -->
    - [x] Verify functionality <!-- id: 76 -->
- [x] Session Migration - Phase 15 (UI Population Manager) <!-- id: 77 -->
    - [x] Create `src/scripts/modules/ui/ui-population-manager.js` <!-- id: 78 -->
    - [x] Extract population logic <!-- id: 79 -->
    - [x] Refactor `app-session.js` to use `UiPopulationManager` <!-- id: 80 -->
    - [x] Verify functionality <!-- id: 81 -->
- [x] Session Migration - Phase 16 (Runtime Resolution & UI Preferences) <!-- id: 82 -->
    - [x] Update `src/scripts/modules/core/session-runtime.js` with resolution logic <!-- id: 83 -->
    - [x] Create `src/scripts/modules/ui/ui-preferences.js` <!-- id: 84 -->
    - [x] Extract runtime resolution and UI preference logic from `app-session.js` <!-- id: 85 -->
    - [x] Refactor `app-session.js` to use `SessionRuntime` and `UiPreferences` <!-- id: 86 -->
    - [x] Verify functionality <!-- id: 87 -->
- [ ] Session Migration - Phase 17 (Restore Rehearsal Extraction) <!-- id: 88 -->
    - [ ] Create `src/scripts/modules/features/restore-rehearsal-manager.js` <!-- id: 89 -->
    - [ ] Extract `Restore Rehearsal` constants, state, and logic <!-- id: 90 -->
    - [ ] Extract `Backup Diff` logic and UI rendering <!-- id: 91 -->
    - [ ] Refactor `app-session.js` to use `RestoreRehearsalManager` <!-- id: 92 -->
    - [ ] Verify functionality <!-- id: 93 -->

