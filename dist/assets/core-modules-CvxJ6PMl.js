import{g as Kf,L as Na,s as $f,d as Vf,c as Wf,k as qf}from"./vendor-Dzz8Pluk.js";function zc(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Gc(e){return!!e&&(typeof e=="object"||typeof e=="function")}function bi(e){if(typeof Object.freeze=="function")try{return Object.freeze(e)}catch{}return e}function Io(e){if(!e)return[];try{return Array.prototype.slice.call(e)}catch{}const t=[];for(let r=0;r<e.length;r+=1)t[r]=e[r];return t}function za(){return{objects:typeof WeakMap=="function"?new WeakMap:null,primitives:Object.create(null),empty:null}}function Hf(e,t){if(!e)return null;if(Gc(t)){if(!e.objects)return null;let o=e.objects.get(t);return o||(o={cached:!1,value:null},e.objects.set(t,o)),o}const r=typeof t+":"+String(t);let n=e.primitives[r];return n||(n={cached:!1,value:null},e.primitives[r]=n),n}function Rt(e,t){Gc(t)&&e.indexOf(t)===-1&&e.push(t)}const Xi=(function(){const t=[];return Rt(t,typeof globalThis<"u"?globalThis:null),Rt(t,typeof window<"u"?window:null),Rt(t,typeof self<"u"?self:null),Rt(t,typeof global<"u"?global:null),bi(t)})(),Zi=bi([]),Bc=typeof WeakMap=="function",zi=Bc?new WeakMap:null;function Yf(e){if(!Array.isArray(e)||e.length===0)return Zi;const t=[];for(let r=0;r<e.length;r+=1)Rt(t,e[r]);return t.length===0?Zi:bi(t)}function Ga(e,t,r){const n=[];Rt(n,e);let o=null;if(typeof t=="function")try{o=t()}catch{o=null}Rt(n,o);for(let i=0;i<Xi.length;i+=1)Rt(n,Xi[i]);if(Array.isArray(r))for(let i=0;i<r.length;i+=1)Rt(n,r[i]);return bi(n)}function Jf(e,t){if(!e)return null;if(t===Zi)return e.empty||(e.empty=za()),e.empty;if(!e.extras){if(!Bc)return null;e.extras=new WeakMap}let r=e.extras.get(t);return r||(r=za(),e.extras.set(t,r)),r}function Qf(e){if(!zi)return null;let t=zi.get(e);return t||(t={empty:null,extras:null},zi.set(e,t)),t}function Xf(e,t,r,n){if(n){const i=Hf(n,e);if(i){if(i.cached)return Io(i.value);const s=Ga(e,t,r);return i.value=s,i.cached=!0,Io(s)}}const o=Ga(e,t,r);return Io(o)}function Ts(e){const t=e&&typeof e.detectGlobalScope=="function"?e.detectGlobalScope:zc,r=Yf(e&&e.additionalScopes),n=Qf(t),o=Jf(n,r);return function(s){return Xf(s,t,r,o)}}function Zf(e,t){return Ts(t||{})(e)}function ep(){return Io(Xi)}const Gi=zc();Gi&&!Gi.__cineScopeCollector&&(Gi.__cineScopeCollector={collectCandidateScopes:Zf,createCollector:Ts,getBaseScopes:ep});const Si="__cinePendingModuleRegistrations__";function Ut(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function tp(e){const t=e||Ut();if(!t||typeof t!="object"&&typeof t!="function")return;let r=null;try{r=t.console||null}catch{r=null}if(!r||typeof r!="object"&&typeof r!="function")return;const n=["log","warn","error","info","debug"];let o=null;try{o=r.__cineSafeConsoleOriginals||null}catch{o=null}if(!o||typeof o!="object"){o={};try{Object.defineProperty(r,"__cineSafeConsoleOriginals",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{try{r.__cineSafeConsoleOriginals=o}catch{}}}for(let i=0;i<n.length;i+=1){const s=n[i];let a=null;try{a=r[s]}catch{a=null}if(typeof a!="function"||a&&a.__cineSafeConsoleGuard)continue;Object.prototype.hasOwnProperty.call(o,s)||(o[s]=a);const c=function(){try{return a.apply(r,arguments)}catch{}};try{Object.defineProperty(c,"__cineSafeConsoleGuard",{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{c.__cineSafeConsoleGuard=!0}try{r[s]=c}catch{}}}const Ba=Ts,rp={key:"defaultExtras"},Bi=[],Pr=typeof WeakMap=="function"?new WeakMap:[];function np(e){if(!e||typeof e!="object"&&typeof e!="function")return;if(Pr&&typeof Pr.get=="function"){let r=Pr.get(e);return r||(r=[e],Pr.set(e,r)),r}for(let r=0;r<Pr.length;r+=1){const n=Pr[r];if(n.scope===e)return n.extras}const t=[e];return Pr.push({scope:e,extras:t}),t}function op(e,t){if(!Ba)return null;const r=Array.isArray(t)?t:rp;for(let o=0;o<Bi.length;o+=1){const i=Bi[o];if(i.detect===e&&i.extras===r)return i.collector}const n=Ba({detectGlobalScope:e,additionalScopes:Array.isArray(t)?t:void 0});return n?(Bi.push({detect:e,extras:r,collector:n}),n):null}function Ei(e,t){const r=t||Ut(),n=np(r),o=op(Ut,n);if(o)return o(e||r);const i=[];function s(a){!a||typeof a!="object"&&typeof a!="function"||i.indexOf(a)===-1&&i.push(a)}return s(e||r),typeof globalThis<"u"&&s(globalThis),typeof window<"u"&&s(window),typeof self<"u"&&s(self),typeof global<"u"&&s(global),i}function xc(e){return null}function Fc(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Ls(e,t,r){const n=e||r,o=typeof t=="string"&&t?t:Si;if(!n||typeof n!="object")return null;let i=n[o];return Array.isArray(i)?i:!Fc(n,o,[])||(i=n[o],!Array.isArray(i))?null:i}const xi=(function(){const t="__cineBuiltinImmutabilityGuards__",r=Ei(null,Ut());for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function es(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(ve&&typeof ve=="object")try{if(e===ve.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(t){if(t&&typeof t.message=="string"&&/metamask/i.test(t.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function ip(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function ts(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(ip(e)||typeof e=="object"&&e&&typeof e.id=="string"&&typeof e.filename=="string"&&(typeof e.loaded=="boolean"||Array.isArray(e.children))||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(xi&&typeof xi.isImmutableBuiltin=="function"&&xi.isImmutableBuiltin(e)||typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function sp(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function Ms(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||ts(e)||es(e))return e;if(typeof e=="function")try{return Object.freeze(e)}catch{return e}const r=sp(t);if(r.has(e))return e;r.add(e);let n;try{n=Object.getOwnPropertyNames(e)}catch{return e}for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=Object.getOwnPropertyDescriptor(e,i)}catch{s=null}if(s&&(typeof s.get=="function"||typeof s.set=="function"))continue;let a;try{a=e[i]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||ts(a)||es(a)||Ms(a,r)}try{return Object.freeze(e)}catch{return e}}function Uc(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function ap(e,t){const n=Ei(e||t,t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}function cp(e,t,r,n,o){const s=Ls(e||o,Si,o);if(!s)return!1;const a=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{return s.push(a),!0}catch{}try{return s[s.length]=a,!0}catch{}return!1}function lp(e){const t=e||Ut();return{detectGlobalScope:Ut,getGlobalScope(){return t},collectCandidateScopes(r){return Ei(r||t,t)},tryRequire:xc,defineHiddenProperty:Fc,ensureQueue(r,n){return Ls(r||t,n,t)},freezeDeep:Ms,safeWarn:Uc,resolveModuleRegistry(r){return ap(r||t,t)},queueModuleRegistration(r,n,o,i){return cp(r||t,n,o,i,t)},getPendingQueueKey(){return Si}}}function up(e){const t=e||Ut();return t&&typeof t.cineModuleArchitectureKernel=="object"?t.cineModuleArchitectureKernel:null}const Ns=Ut();tp(Ns);const fp=up(Ns),Q=fp||lp(Ns);function xa(){if(Q&&typeof Q.detectGlobalScope=="function")try{const e=Q.detectGlobalScope();if(e)return e}catch{}return Ut()}const ve=Q&&typeof Q.getGlobalScope=="function"?(function(){try{const t=Q.getGlobalScope();if(t)return t}catch{}return xa()})():xa(),rs=Q&&typeof Q.getPendingQueueKey=="function"?Q.getPendingQueueKey():Si;function Dc(e){if(Q&&typeof Q.collectCandidateScopes=="function")try{const t=Q.collectCandidateScopes(e||ve);if(Array.isArray(t)&&t.length>0)return t}catch{}return Ei(e||ve,ve)}function Kc(e){if(Q&&typeof Q.tryRequire=="function")try{const t=Q.tryRequire(e);if(typeof t<"u")return t}catch{}return xc()}function $c(e){const t=e||ve;if(Q&&typeof Q.resolveModuleRegistry=="function")try{const o=Q.resolveModuleRegistry(t);if(o&&typeof o=="object")return o}catch{}const r=Kc("./registry.js");if(r&&typeof r=="object")return r;const n=Dc(t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}let Fa=null,Ua=!1;function ns(e){if(!Ua||e&&e!==ve){const t=$c(e);if(e&&e!==ve)return t;Fa=t,Ua=!0}return Fa}function pp(e){const t=e||ve;if(Q&&typeof Q.ensureQueue=="function")try{const r=Q.ensureQueue(t,rs);if(Array.isArray(r))return r}catch{}return Ls(t,rs,ve)}function Vc(e,t,r,n){const o=e||ve;if(Q&&typeof Q.queueModuleRegistration=="function")try{if(Q.queueModuleRegistration(o,t,r,n))return!0}catch{}const i=pp(o);if(!i)return!1;const s=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{i.push(s)}catch{i[i.length]=s}return!0}function Wc(e,t,r,n,o,i){if(t&&typeof t.register=="function")try{return t.register(r,n,o),!0}catch(s){typeof i=="function"&&i(s)}return Vc(e,r,n,o),!1}function Da(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||ts(e)||es(e))return e;if(Q&&typeof Q.freezeDeep=="function")try{return Q.freezeDeep(e)}catch{}return Ms(e)}function qc(e,t){if(Q&&typeof Q.safeWarn=="function")try{Q.safeWarn(e,t);return}catch{}Uc(e,t)}function Hc(e,t,r,n={}){const o=r||ve;if(!o||typeof o!="object")return!1;const i={configurable:n.configurable!==!1,enumerable:!!n.enumerable,value:t,writable:n.writable===!0};try{return Object.defineProperty(o,e,i),!0}catch{try{return o[e]=t,!0}catch{return!1}}}const Yc=Da({getGlobalScope(){return ve},collectCandidateScopes:Dc,tryRequire:Kc,resolveModuleRegistry:$c,getModuleRegistry:ns,queueModuleRegistration(e,t,r,n){return Vc(n||ve,e,t,r)},registerOrQueueModule(e,t,r,n,o,i){const s=o||ve,a=i||ns(s);return Wc(s,a,e,t,r,n)},freezeDeep:Da,safeWarn:qc,exposeGlobal:Hc,PENDING_QUEUE_KEY:rs}),dp=ns();Wc(ve,dp,"cineModuleBase",Yc,{category:"infrastructure",description:"Shared helpers for module registration, freezing and safe global exposure.",replace:!0,connections:["cineModuleArchitectureKernel","cineModuleArchitectureHelpers"]},e=>{qc("Unable to register cineModuleBase.",e)});Hc("cineModuleBase",Yc,ve,{configurable:!0,enumerable:!1,writable:!1});var yp={};const Oe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};let qo=null;!qo&&Oe&&typeof Oe.__cineEnsureConsoleMethodsWritable=="function"&&(qo=Oe.__cineEnsureConsoleMethodsWritable);typeof qo=="function"&&qo(["warn","info"]);const Zn="__cinePendingModuleRegistrations__",zs="__cinePendingModuleRegistrationsTimer__";let Tr=Object.create(null),Ho=Object.create(null),Ro=null;function Jc(e){const r=[e||Oe];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModuleImmutability=="object")return o.cineModuleImmutability}return null}const Fi=(function(){const t="__cineBuiltinImmutabilityGuards__",r=[Oe];typeof globalThis<"u"&&globalThis!==Oe&&r.push(globalThis),typeof window<"u"&&r.push(window),typeof self<"u"&&r.push(self),typeof global<"u"&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function gp(){function e(r){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function")return!1;try{if(Fi&&typeof Fi.isImmutableBuiltin=="function"&&Fi.isImmutableBuiltin(r)||typeof r.pipe=="function"&&typeof r.unpipe=="function")return!0;if(typeof r.on=="function"&&typeof r.emit=="function"){if(typeof r.write=="function"||typeof r.read=="function")return!0;const n=r.constructor&&r.constructor.name;if(n&&/Stream|Emitter|Port/i.test(n))return!0}if(typeof Symbol<"u"&&r[Symbol.toStringTag]){const n=r[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port/i.test(n))return!0}}catch{}return!1}function t(r,n=new WeakSet){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function"||e(r)||n.has(r))return r;n.add(r);const o=Object.getOwnPropertyNames(r);for(let i=0;i<o.length;i+=1){const s=o[i];let a;try{a=r[s]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||t(a,n)}try{return Object.freeze(r)}catch{return r}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const Gs=gp();let vn=Jc(Oe)||Gs;function mp(){if(vn!==Gs)return vn;const e=Jc(Oe);return e&&e!==vn&&(vn=e),vn}function bt(e,t){const r=mp();try{return r.freezeDeep(e,t)}catch{}return Gs.freezeDeep(e,t)}function Or(e){if(typeof e=="string"){const t=e.trim();if(t)return t}throw new TypeError("cineModules.register expected a non-empty string name.")}function To(e){if(e==null)return[];const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=new Set,n=[];for(let o=0;o<t.length;o+=1){const i=t[o];let s=null;if(typeof i=="string"?s=i:i&&typeof i.name=="string"&&(s=i.name),!s)continue;const a=s.trim();!a||r.has(a)||(r.add(a),n.push(a))}return n}function hp(e,t,r={}){const n=Or(e);if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError(`cineModules.register("${n}") expected an object or function.`);const o=r.freeze!==!1,i=o&&!Object.isFrozen(t)?bt(t):t;if(Object.prototype.hasOwnProperty.call(Tr,n)){const s=Tr[n];if(s===i)return s;if(!r.replace)throw new Error(`cineModules: Module "${n}" is already registered. Use { replace: true } to overwrite.`)}return Tr[n]=i,Ho[n]={description:typeof r.description=="string"?r.description.trim():"",category:typeof r.category=="string"?r.category.trim():"",registeredAt:Date.now(),frozen:o,connections:bt(To(r.connections||r.links||r.dependencies||null))},i}function bp(e){const t=Or(e);return Object.prototype.hasOwnProperty.call(Tr,t)?Tr[t]:null}function Qc(e){const t=Or(e);return Object.prototype.hasOwnProperty.call(Tr,t)}function Sp(){return Object.freeze(Object.keys(Tr).sort())}function Ep(e){const t=Or(e),r=Ho[t];return r?Object.freeze({name:t,description:r.description,category:r.category,registeredAt:r.registeredAt,frozen:r.frozen,connections:r.connections||bt([])}):null}function wp(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];try{const s=Or(i);n.has(s)||(n.add(s),r.push(s))}catch{}}return r.length>0?r:null}function Ap(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i!="string")continue;const s=i.trim();!s||n.has(s)||(n.add(s),r.push(s))}return r.length>0?r:null}function Op(e={}){const t=wp(e&&e.names),r=Ap(e&&(e.categories||e.category||null)),n=t?new Set(t):null,o=r?new Set(r):null,i=[],s=n?t:Object.keys(Ho);for(let a=0;a<s.length;a+=1){const c=s[a],u=Ho[c];u&&(o&&!o.has(u.category)||i.push({name:c,description:u.description,category:u.category,registeredAt:u.registeredAt,frozen:u.frozen,connections:u.connections||bt([])}))}return n||(!e||e.sort!==!1)&&i.sort((c,u)=>c.name.localeCompare(u.name)),bt(i)}function Cp(e){const t=Array.isArray(e)?e.slice():[e],r={},n=[];for(let o=0;o<t.length;o+=1){const i=Or(t[o]),s=Qc(i);r[i]=s,s||n.push(i)}return Object.freeze({ok:n.length===0,missing:Object.freeze(n),detail:Object.freeze(r)})}function _p(e={}){throw typeof process<"u"&&process,new Error("cineModules.__internalResetForTests() is restricted to test environments.")}function Xc(e){if(!e||typeof e!="object")return null;const t=e[zs];return t&&typeof t=="object"?t:null}function Bs(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Yo(e){const t=Xc(e);if(!t)return;const r=t&&typeof t.clear=="function"?t.clear:null;if(r&&Object.prototype.hasOwnProperty.call(t,"id"))try{r(t.id)}catch{}Bs(e,zs,null)}function Zc(e){if(!e||typeof e!="object")return;const t=e[Zn];if(!Array.isArray(t)||t.length===0){Yo(e);return}if(Xc(e))return;const r=typeof e.setTimeout=="function"&&e.setTimeout.bind(e)||typeof Oe.setTimeout=="function"&&Oe.setTimeout.bind(Oe)||(typeof setTimeout=="function"?setTimeout:null);if(typeof r!="function")return;const n=typeof e.clearTimeout=="function"&&e.clearTimeout.bind(e)||typeof Oe.clearTimeout=="function"&&Oe.clearTimeout.bind(Oe)||(typeof clearTimeout=="function"?clearTimeout:null),o=r(function(){Yo(e),el(e)},0);Bs(e,zs,{id:o,clear:typeof n=="function"?n:null})}function el(e){if(!e||typeof e!="object")return;const t=e[Zn];if(!Array.isArray(t)||t.length===0){Yo(e);return}const r=t.slice();t.length=0;for(let n=0;n<r.length;n+=1){const o=r[n];if(!o||typeof o!="object")continue;const i=o.name,s=o.api,a=o.options||{};try{we.register(i,s,a)}catch(c){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`cineModules: discard pending registration for "${i}" due to error:`,c);continue}}t.length>0?Zc(e):Yo(e)}function kp(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),r(Oe),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function Ui(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e[Zn];return Array.isArray(t)?t:null}catch{return null}}function Pp(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=Ui(e);if(t||Bs(e,Zn,[])&&(t=Ui(e),t))return t;try{if(e[Zn]=[],t=Ui(e),t)return t}catch{}return null}function jp(e){const t=kp(e);for(let r=0;r<t.length;r+=1){const n=t[r],o=Pp(n);if(o)return{queue:o,scope:n}}return null}function vp(e,t){const r=jp(e||Oe);if(!r||!r.queue)return!1;const n=bt({name:t&&t.name?Or(t.name):null,api:t?t.api:null,options:Object.freeze({...t&&t.options?t.options:{}})}),{queue:o,scope:i}=r;try{o.push(n)}catch{o[o.length]=n}try{Zc(i)}catch{}return!0}function Ip(e={}){const t=Or(e.name),r=typeof e.category=="string"?e.category.trim():"";if(!r)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty category string.`);const n=typeof e.description=="string"?e.description.trim():"";if(!n)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty description.`);const o=e.freeze!==!1,i=bt(To(e.connections)),s=typeof e.factory=="function"?e.factory:null,a=s?null:e.api;if(!s&&(!a||typeof a!="object"&&typeof a!="function"))throw new TypeError(`cineModules.createBlueprint("${t}") expected an object API or factory function.`);const c=Object.freeze({name:t,category:r,description:n,connections:i,freeze:o});let u=null,f=!1,l=null;function y(m){const b={category:c.category,description:c.description,connections:c.connections,freeze:c.freeze};if(!m||typeof m!="object")return Object.freeze({...b});const O={...b};if(Object.prototype.hasOwnProperty.call(m,"category")){const A=typeof m.category=="string"?m.category.trim():"";A&&(O.category=A)}if(Object.prototype.hasOwnProperty.call(m,"description")){const A=typeof m.description=="string"?m.description.trim():"";A&&(O.description=A)}return Object.prototype.hasOwnProperty.call(m,"connections")&&(O.connections=bt(To(m.connections))),Object.prototype.hasOwnProperty.call(m,"freeze")&&(O.freeze=m.freeze!==!1),Object.freeze(O)}function p(m){if(f){if(l)throw l;return u}f=!0;let b=a;if(s){const O=m&&typeof m=="object"?{...m}:{},A=Object.freeze({registry:Ro||null,metadata:c,context:O,freezeDeep:bt,normalizeConnections:To});try{b=s(A)}catch(C){throw l=C instanceof Error?C:new Error(String(C)),l}}if(!b||typeof b!="object"&&typeof b!="function"){const O=new TypeError(`cineModules.createBlueprint("${t}") factory expected an object or function return value.`);throw l=O,O}return u=o&&!Object.isFrozen(b)?bt(b):b,u}function d(m={}){const b=m&&typeof m.registry=="object"&&m.registry?m.registry:Ro,O=y(m&&m.options),A=m&&m.scope?m.scope:Oe,C=m&&Object.prototype.hasOwnProperty.call(m,"defer")?m.defer!==!1:!0,_=m&&typeof m.onError=="function"?m.onError:null,k=p(m&&m.context),j=b&&typeof b.register=="function"?b:Ro;if(!j||typeof j.register!="function")throw new TypeError("cineModules.createBlueprint register() requires a registry with a register() function.");try{return j.register(c.name,k,O)}catch(S){if(C&&vp(A,{name:c.name,api:k,options:O}),_)try{_(S)}catch{}throw S}}const g={name:c.name,category:c.category,description:c.description,connections:c.connections,freeze:c.freeze,instantiate:p,register:d,getMetadata(){return c},createRegistrationOptions:y,toJSON(){return c}};return Object.freeze(g)}const we={};we.register=hp;we.get=bp;we.has=Qc;we.list=Sp;we.describe=Ep;we.describeAll=Op;we.assertRegistered=Cp;we.createBlueprint=Ip;we.__internalResetForTests=_p;Ro=we;const Dt=[Oe];typeof globalThis<"u"&&globalThis!==Oe&&Dt.push(globalThis);typeof window<"u"&&Dt.indexOf(window)===-1&&Dt.push(window);typeof self<"u"&&Dt.indexOf(self)===-1&&Dt.push(self);typeof global<"u"&&Dt.indexOf(global)===-1&&Dt.push(global);for(let e=0;e<Dt.length;e+=1){const t=Dt[e];if(!t||typeof t!="object")continue;if(t.cineModules!==we)try{Object.defineProperty(t,"cineModules",{configurable:!1,enumerable:!1,value:we,writable:!1})}catch{try{t.cineModules=we}catch{}}el(t)}function xs(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const tl=xs(),In={value:null,time:0};function Fs(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function fo(){if(In.value&&typeof In.value=="object")return In.value;try{const e=xs();if(e&&(typeof e=="object"||typeof e=="function"))return In.value=e,In.time=Date.now(),e}catch{}return tl}function rl(e,t,r){const n=[],o=s=>{!s||typeof s!="object"&&typeof s!="function"||n.indexOf(s)===-1&&n.push(s)};o(e);const i=typeof r=="function"?r:fo;try{o(i())}catch{}if(Array.isArray(t))for(let s=0;s<t.length;s+=1)o(t[s]);return typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),o(tl),n.slice()}function Rp(e){if(typeof require!="function")return null;try{return require(e)}catch{return null}}function Tp(e,t){const r=t||{},n=typeof r.predicate=="function"?r.predicate:null,o=Array.isArray(r.scopes)?r.scopes.slice():[],i=rl(r.primaryScope,r.additionalScopes,r.detect);for(let s=0;s<i.length;s+=1)o.indexOf(i[s])===-1&&o.push(i[s]);for(let s=0;s<o.length;s+=1){const a=o[s];if(!(!a||typeof a!="object"&&typeof a!="function")){if(n)try{if(n(a,e))return a}catch{}try{if(e in a)return a}catch{}}}return null}function Lp(e,t){if(!e)return typeof t=="function"?t():t;const r=fo();if(r&&typeof r=="object"){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];const n=typeof t=="function"?t():t;if(Fs(r,e,n))try{return r[e]}catch{}return n}return typeof t=="function"?t():t}const Mp={baseDetectGlobalScope:xs,detectGlobalScope:fo,collectCandidateScopes:rl,tryRequire:Rp,defineHiddenProperty:Fs,resolveFromScopes:Tp,getCachedGlobalValue:Lp},Di=fo();Di&&!Di.cineScopeUtils&&Fs(Di,"cineScopeUtils",Mp);const Ke=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},Us=(function(){const t=Ke.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:null);if(typeof t!="object"||!t)return new Set;const r=Object.values(t).filter(n=>typeof n=="string"&&n);return new Set(r)})();function Bn(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return"";if(typeof String.fromCodePoint=="function")try{return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):""}function Jo(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=Bn(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=Bn(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=Bn(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=Bn(i[1],10);if(s)return s}return t}function B(e,t){const n=(Ke.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons",o=t||n,i=Us.has(o)?o:n,a={char:Jo(e),font:i};return typeof Object.freeze=="function"?Object.freeze(a):a}function wi(e){const r=(Ke.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons";if(!e)return{char:"",font:r,className:"",size:void 0};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:Jo(e),font:r,className:"",size:void 0};if(typeof e=="object"){const n=typeof e.char=="string"?Jo(e.char):"",o=e.font&&Us.has(e.font)?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:"",size:void 0}}function nl(e){return typeof e!="string"?"":e.indexOf('aria-hidden="true"')!==-1?e:e.replace("<svg",'<svg aria-hidden="true"')}function ol(e,t){if(!e)return;const r=wi(t);if(r.markup){e.innerHTML=nl(r.markup),e.setAttribute("aria-hidden","true"),r.className&&r.className.split(/\s+/).filter(Boolean).forEach(o=>e.classList.add(o)),e.removeAttribute("data-icon-font");return}const n=r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font):e.removeAttribute("data-icon-font")}function il(e,t){const r=wi(e),n=[];r.className&&n.push(r.className),t&&n.push(t);const o=n.join(" ");if(r.markup){let s=nl(r.markup);return o&&(s.indexOf('class="')!==-1?s=s.replace('class="',`class="${o} `):s=s.replace("<svg",`<svg class="${o}"`)),s}const i=r.char?`data-icon-font="${r.font}"`:"";return`<span class="icon-glyph ${o}" aria-hidden="true" ${i}>${r.char}</span>`}function er(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function sl(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=er(t),a=er(r),c=er(n),u=er(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(l,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[];return/(?:^|\s)width\s*=/i.test(p)||d.push(`width="${c}"`),/(?:^|\s)height\s*=/i.test(p)||d.push(`height="${u}"`),d.push(`x="-${er(i)}"`),d.push(`y="-${er(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}const Ds=`
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M12 17.25 6.545 20.2 7.9 13.975 3 9.45l6.272-.7L12 3l2.728 5.75L21 9.45l-4.9 4.525 1.355 6.225Z"
    fill="currentColor"
    stroke="currentColor"
    stroke-width="0"
  />
</svg>
`.trim(),G=Ke.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons",ESSENTIAL:"essential",GADGET:"gadget",FILM:"film",TEXT:"text"}),al=Object.freeze({batteryBolt:B("",G.UICONS),batteryFull:B("",G.UICONS),bolt:B("",G.ESSENTIAL),plug:B("",G.UICONS),sliders:B("",G.ESSENTIAL),screen:B("",G.GADGET),brightness:B("",G.UICONS),wifi:B("",G.UICONS),gears:B("",G.UICONS),controller:B("",G.GADGET),distance:B("",G.UICONS),sensor:B("",G.UICONS),viewfinder:B("",G.FILM),camera:B("",G.UICONS),trash:B("",G.ESSENTIAL),reload:B("",G.ESSENTIAL),load:B("",G.UICONS),installApp:B("",G.UICONS),add:Object.freeze({char:"+",font:G.TEXT,className:"icon-text"}),minus:Object.freeze({char:"−",font:G.TEXT,className:"icon-text"}),arrowLeft:Object.freeze({char:"←",font:G.TEXT,className:"icon-text"}),check:B("",G.UICONS),fileExport:B("",G.UICONS),fileImport:B("",G.UICONS),save:B("",G.ESSENTIAL),share:B("",G.ESSENTIAL),paperPlane:B("",G.UICONS),magnet:B("",G.ESSENTIAL),codec:B("",G.UICONS),timecode:B("",G.FILM),audioIn:B("",G.ESSENTIAL),audioOut:B("",G.ESSENTIAL),note:B("",G.ESSENTIAL),overview:B("",G.UICONS),gearList:B("",G.UICONS),contacts:B("",G.UICONS),feedback:B("",G.UICONS),resetView:B("",G.UICONS),pin:B("",G.ESSENTIAL),sun:B("",G.UICONS),moon:B("",G.UICONS),circleX:B("",G.ESSENTIAL),settingsGeneral:B("",G.UICONS),settingsAutoGear:B("",G.UICONS),settingsAccessibility:B("",G.UICONS),settingsBackup:B("",G.UICONS),settingsData:B("",G.UICONS),settingsAbout:B("",G.UICONS),star:Object.freeze({markup:Ds,className:"icon-svg favorite-star-icon"}),warning:B("",G.ESSENTIAL)});Ke.cineIcons={VALID_ICON_FONTS:Us,toCodePointChar:Bn,normalizeGlyphChar:Jo,iconGlyph:B,resolveIconGlyph:wi,applyIconGlyph:ol,iconMarkup:il,formatSvgCoordinate:er,positionSvgMarkup:sl,STAR_ICON_SVG:Ds,ICON_GLYPHS:al};Ke.iconGlyph=B;Ke.resolveIconGlyph=wi;Ke.applyIconGlyph=ol;Ke.iconMarkup=il;Ke.formatSvgCoordinate=er;Ke.positionSvgMarkup=sl;Ke.STAR_ICON_SVG=Ds;Ke.ICON_GLYPHS=al;Ke.cineIcons;const po=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},Np=new Set(["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI","DisplayPort"]),Qo="__normalized";function cl(e){const t=new Map;return r=>{if(!r)return"";const n=String(r).replace(/[™®]/g,"").trim(),o=n.toLowerCase();return t.has(o)||t.set(o,e(n,o)),t.get(o)}}const zp=[{needles:["12g"],value:"12G-SDI"},{needles:["6g"],value:"6G-SDI"},{needles:["3g"],value:"3G-SDI"},{needles:["hd","sdi"],value:"3G-SDI"},{needles:["mini","bnc"],value:"Mini BNC"},{needles:["micro","hdmi"],value:"Micro HDMI"},{needles:["mini","hdmi"],value:"Mini HDMI"},{needles:["hdmi"],value:"HDMI"},{needles:["displayport"],value:"DisplayPort"},{needles:["display","port"],value:"DisplayPort"},{needles:["dp"],value:"DisplayPort"}],ll=cl((e,t)=>{const r=zp.find(({needles:n})=>n.every(o=>t.includes(o)));return r?r.value:""}),Gp={"lemo 4-pin (lbus)":"LBUS (LEMO 4-pin)","lbus (lemo 4-pin)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo for motors)":"LBUS (LEMO 4-pin)","4-pin lemo (lbus)":"LBUS (LEMO 4-pin)","lemo 4-pin":"LEMO 4-pin","4-pin lemo":"LEMO 4-pin","lemo 7-pin":"LEMO 7-pin","lemo 7-pin 1b":"LEMO 7-pin","7-pin lemo":"LEMO 7-pin","7-pin lemo (lcs)":"LEMO 7-pin (LCS)","7-pin lemo (cam)":"LEMO 7-pin (CAM)","ext (lemo 7-pin)":"EXT LEMO 7-pin","hirose 12pin":"Hirose 12-pin","12-pin hirose":"Hirose 12-pin","12pin broadcast connector":"Hirose 12-pin","lens 12 pin":"Hirose 12-pin","lens terminal 12-pin":"Hirose 12-pin","lens terminal 12-pin jack":"Hirose 12-pin","lens terminal":"Hirose 12-pin","usb type-c":"USB-C","usb-c":"USB-C","usb-c (usb 3.2 / 3.1 gen 1)":"USB-C","usb-c / gigabit ethernet (via adapter)":"USB-C","active ef mount":"Active EF mount","lanc (2.5mm stereo mini jack)":"LANC","2.5 mm sub-mini (lanc)":"LANC","remote a (2.5mm)":"REMOTE A connector","remote control terminal":"REMOTE A connector","remote 8 pin":"REMOTE B connector"};function Ks(e){return cl((t,r)=>e[r]||t)}const xn=Ks(Gp),Bp={'dsmc3 red touch 7" lcd (optional)':'RED Touch 7" LCD (Optional)','red touch 7.0" lcd (optional)':'RED Touch 7" LCD (Optional)',"lcd touch panel":"LCD touchscreen","lcd touchscreen":"LCD touchscreen","native lcd capacitive touchscreen":"LCD touchscreen","integrated touchscreen lcd":"LCD touchscreen","free-angle lcd":"Vari-angle LCD","lcd monitor (native)":"Integrated LCD monitor","native lcd viewfinder":"Integrated LCD monitor","lcd monitor lm-v2 (supplied)":"LCD Monitor LM-V2","integrated main monitor":"Integrated LCD monitor","optional evf-v70 viewfinder":"EVF-V70 (Optional)","optional evf-v50":"EVF-V50 (Optional)","optional oled viewfinder":"OLED EVF (Optional)","blackmagic pocket cinema camera pro evf (optional)":"Blackmagic Pro EVF (Optional)","external backlit lcd status display":"LCD status display","built-in fold-out lcd":"Fold-out LCD","oled lvf (live view finder)":"OLED EVF","lcd capacitive touchscreen":"LCD touchscreen","lemo 26 pin":"LEMO 26-pin port"},ul=Ks(Bp),xp={"lemo 8-pin (dc in / bat)":"Bat LEMO 8-pin","lemo 8-pin (bat)":"Bat LEMO 8-pin","bat (lemo 8-pin)":"Bat LEMO 8-pin","lemo 8-pin":"Bat LEMO 8-pin","2-pin dc-input":"2-pin DC-IN","dc-":"DC IN",dc:"DC IN","2-pin xlr":"XLR 2-pin","2-pin locking connector":"LEMO 2-pin","2-pin locking connector / 2-pin lemo":"LEMO 2-pin","4-pin xlr / dc in 12v":"XLR 4-pin","4-pin xlr / v-lock":"XLR 4-pin","xlr 4-pin jack":"XLR 4-pin","xlr 4-pin (main input)":"XLR 4-pin","xlr-type 4 pin (male) / square-shaped 5 pin connector (battery)":"XLR 4-pin / Square 5-pin","12-pin molex connector (at battery plate rear) / 4-pin xlr (external power)":"Molex 12-pin / XLR 4-pin","battery slot":"Battery Slot","usb-c":"USB-C","usb type-c":"USB-C","usb-c pd":"USB-C PD","usb-c (power delivery)":"USB-C PD","usb-c pd,dc coupler":"USB-C PD / DC Coupler","dc coupler":"DC Coupler","dc coupler (dr-e6c)":"DC Coupler","dc input":"DC IN","dc barrel":"DC Barrel","dc (barrel)":"DC Barrel","locking dc barrel":"DC Barrel","dc 24v terminal":"DC Barrel","weipu sf610/s2 (12vdc) input":"Weipu SF610/S2","6-pin 1b dc-in / tb50 battery mount":"6-pin 1B DC-IN","6-pin 1b dc-,tb50":"6-pin 1B DC-IN"},Ka=Ks(xp);function Lo(e){if(!e)return[];const t=r=>{const n=Ka(r);return n?n.split(/[/,]/).map(o=>Ka(o.trim())).map(o=>o&&o.trim()||"").filter(Boolean):[]};return Array.isArray(e)?e.flatMap(t):t(e)}function jr(e,t){return Array.isArray(e)?e.map(r=>typeof r=="string"?{...t,type:r}:{...t,...r||{}}):[]}function $s(e){if(!e)return;e.powerInput&&!e.power?.input&&(e.power={...e.power||{},input:{type:Lo(e.powerInput)}},delete e.powerInput);const t=e.power?.input;if(!t)return;const r=n=>{if(typeof n=="string")return{type:Lo(n)};if(n){const{portType:o,type:i,...s}=n,a=!i&&o?o:i;return{...s,type:a?Lo(a):[]}}return{type:[]}};e.power.input=Array.isArray(t)?t.map(r):r(t)}function $a(e){!e||typeof e!="object"||Object.values(e).forEach($s)}function fl(e){return!!(e&&Object.prototype.hasOwnProperty.call(e,Qo)&&e[Qo])}function Vs(e){if(!e||typeof e!="object")return e;try{Object.defineProperty(e,Qo,{configurable:!0,enumerable:!1,value:!0,writable:!0})}catch{e[Qo]=!0}return e}function Ws(e,t){if(!e||typeof e!="object"||!!!(t&&t.force)&&fl(e))return e;Object.values(e.cameras||{}).forEach(o=>{o.power?.input&&o.power.input.powerDrawWatts!==void 0&&delete o.power.input.powerDrawWatts,$s(o),Array.isArray(o.power?.batteryPlateSupport)&&(o.power.batteryPlateSupport=o.power.batteryPlateSupport.map(i=>{if(typeof i=="string"){const s=i.match(/([^()]+)(?:\(([^)]+)\))?(?:\s*-\s*(.*))?/),a=s?s[1].trim():i;let c=s&&s[2]?s[2].trim().toLowerCase():"";c?/via adapter/i.test(c)&&(c="adapted"):c=/adapted|via adapter/i.test(i)?"adapted":"native";const u=s&&s[3]?s[3].trim():/via adapter/i.test(i)?"via adapter":"";return{type:a,mount:c,notes:u}}return{type:i.type||"",mount:(i.mount?i.mount:i.native?"native":i.adapted?"adapted":"native").toLowerCase(),notes:i.notes||""}})),o.power&&(o.power.powerDistributionOutputs=jr(o.power.powerDistributionOutputs,{type:"",voltage:"",current:"",wattage:null,notes:""})),o.videoOutputs=jr(o.videoOutputs,{type:"",notes:""}).flatMap(i=>{const{count:s,...a}=i||{},c=ll(a.type);if(!Np.has(c))return[];const u=parseInt(s,10),f=Number.isFinite(u)&&u>0?u:1,l={...a,type:c,notes:a.notes||""};return Array.from({length:f},()=>({...l}))}),o.fizConnectors=jr(o.fizConnectors,{type:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:xn(s)}}),o.viewfinder=jr(o.viewfinder,{type:"",resolution:"",connector:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:ul(s)}}),o.recordingMedia=jr(o.recordingMedia,{type:"",notes:""}).map(i=>{let{type:s="",notes:a=""}=i||{};const c=s.match(/^(.*?)(?:\((.*)\))?$/);return c&&(s=c[1].trim(),a=a||(c[2]?c[2].trim():"")),/^SD UHS-II$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II`:"UHS-II"):/^SD \(UHS-II\/UHS-I\)$/i.test(s)?(s="SD Card",a="UHS-II/UHS-I"):s==="CFast 2.0 card slots"?(s="CFast 2.0",a=a||"Dual Slots"):s==="CFexpress Type B (Dual Slots)"?(s="CFexpress Type B",a=a||"Dual Slots"):s==="CFexpress Type B (via adapter)"?(s="CFexpress Type B",a=a||"via adapter"):/^SD UHS-II \(Dual Slots\)$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II (Dual Slots)`:"UHS-II (Dual Slots)"):s==="SD Card (Dual Slots)"?(s="SD Card",a=a||"Dual Slots"):s==="SD card slot (for proxy/backup)"&&(s="SD Card",a=a||"for proxy/backup"),{type:s,notes:a}}),o.timecode=jr(o.timecode,{type:"",notes:""}),o.lensMount=jr(o.lensMount,{type:"",mount:"native",notes:""}).map(i=>({type:i.type,mount:i.mount?i.mount.toLowerCase():"native",notes:i.notes||""})).filter((i,s,a)=>s===a.findIndex(c=>c.type===i.type&&c.mount===i.mount&&c.notes===i.notes))}),Object.values(e.lenses||{}).forEach(o=>{if(!o||typeof o!="object")return;const i=y=>{if(!y)return null;if(typeof y=="string"){const g=y.trim();return g?{type:g,mount:"native"}:null}const p=typeof y.type=="string"?y.type.trim():"";if(!p)return null;const d=typeof y.mount=="string"?y.mount.trim().toLowerCase():"";return{type:p,mount:d==="adapted"?"adapted":"native"}},s=o.mountOptions,a=[],c=y=>{const p=i(y);p&&a.push(p)};if(Array.isArray(s)?s.forEach(c):s&&typeof s=="object"&&c(s),!a.length&&Array.isArray(o.lensMount)&&(o.lensMount.forEach(c),delete o.lensMount),!a.length){const y=typeof o.mount=="string"?o.mount.trim():"";y&&c({type:y,mount:"native"})}const u=[];a.forEach(y=>{if(!y||!y.type)return;const p=y.mount==="adapted"?"adapted":"native";u.some(g=>g.type===y.type&&g.mount===p)||u.push({type:y.type,mount:p})});const f=Array.isArray(u)?u:[];o.mountOptions=f;const l=Array.isArray(o.mountOptions)?o.mountOptions:[];if(l.length){const y=l.find(d=>d&&d.mount==="native"&&d.type)||l[0],p=y&&y.type?y.type:"";p?o.mount=p:typeof o.mount=="string"&&(o.mount=o.mount.trim())}else typeof o.mount=="string"&&(o.mount=o.mount.trim(),o.mount||delete o.mount)}),["monitors","video","viewfinders"].forEach(o=>{$a(e[o])});const n=e.fiz||{};return["motors","controllers","distance"].forEach(o=>{$a(n[o])}),Object.values(e.fiz?.motors||{}).forEach(o=>{o&&(o.connector&&!o.fizConnector&&(o.fizConnector=o.connector,delete o.connector),o.fizConnector&&(o.fizConnector=xn(o.fizConnector)))}),Object.values(e.fiz?.controllers||{}).forEach(o=>{if(o)if(o.FIZ_connector&&!o.fizConnector&&!o.fizConnectors&&(o.fizConnector=o.FIZ_connector,delete o.FIZ_connector),Array.isArray(o.fizConnectors))o.fizConnectors=o.fizConnectors.map(i=>{if(!i)return{type:""};const s=xn(i.type||i),a=i.notes||void 0;return a?{type:s,notes:a}:{type:s}});else if(o.fizConnector){const i=String(o.fizConnector).split(",").map(s=>s.trim()).filter(Boolean);o.fizConnectors=i.map(s=>({type:xn(s)})),delete o.fizConnector}else o.fizConnectors=[]}),Vs(e),e}function pl(e){return Ws(e,{force:!0})}po.cineDeviceNormalization={unifyDevices:Ws,normalizeDevicesForPersistence:pl,markDevicesNormalized:Vs,hasNormalizedDevicesMarker:fl,fixPowerInput:$s,normalizeVideoType:ll,normalizeFizConnectorType:xn,normalizeViewfinderType:ul,normalizePowerPortType:Lo};po.unifyDevices=Ws;po.normalizeDevicesForPersistence=pl;po.markDevicesNormalized=Vs;po.cineDeviceNormalization;var Va={};function dl(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Cr(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function Fp(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function Wa(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}const yl=(function(){const t=dl();if(t&&typeof t.__cineDeepClone=="function")return t.__cineDeepClone;const r=Fp(t);return r?function(o){if(o===null||typeof o!="object")return o;try{return r(o)}catch{}return Wa(o)}:Wa})();function Up(e){const t=Cr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function Dp(e){const t=Cr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}function Kp(e){const t=Cr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleGlobals=="object")return n.cineModuleGlobals}return null}function qa(e){return null}const Ai=dl(),Y=Up(Ai),J=Dp(Ai),q=Kp(Ai),H=(J&&typeof J.getGlobalScope=="function"?J.getGlobalScope():null)||(Y&&typeof Y.getGlobalScope=="function"?Y.getGlobalScope():null)||Ai;(function(){return q&&typeof q.tryRequire=="function"?q.tryRequire:J&&typeof J.tryRequire=="function"?function(r){const n=J.tryRequire(r);return typeof n>"u"?qa():n}:Y&&typeof Y.tryRequire=="function"?Y.tryRequire:qa})();const Ha=(function(){const t=[];function r(o,i){if(typeof o!="function")return;t.some(a=>a&&a.fn===o)||t.push({fn:o,scope:i||null})}if(q&&(typeof q.structuredClone=="function"&&r(q.structuredClone,q),typeof q.getStructuredClone=="function"))try{const o=q.getStructuredClone();r(o,q)}catch{}if(J&&(typeof J.structuredClone=="function"&&r(J.structuredClone,J),typeof J.getStructuredClone=="function"))try{const o=J.getStructuredClone();r(o,J)}catch{}if(Y&&(typeof Y.structuredClone=="function"&&r(Y.structuredClone,Y),typeof Y.getStructuredClone=="function"))try{const o=Y.getStructuredClone();r(o,Y)}catch{}const n=Cr(H);for(let o=0;o<n.length;o+=1){const i=n[o];if(!i||typeof i!="object"&&typeof i!="function")continue;const s=i.structuredClone;typeof s=="function"&&r(s,i)}return t})();let Eo=null;function $p(e){if(Eo)try{const t=Eo;return{success:!0,value:t.scope?t.fn.call(t.scope,e):t.fn(e)}}catch{Eo=null}for(let t=0;t<Ha.length;t+=1){const r=Ha[t];if(!(!r||typeof r.fn!="function"))try{const n=r.scope?r.fn.call(r.scope,e):r.fn(e);return Eo=r,{success:!0,value:n}}catch{}}return{success:!1,value:null}}function Vp(e){if(q&&typeof q.resolveModuleRegistry=="function")try{const r=q.resolveModuleRegistry(e||H);if(r)return r}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const r=J.getModuleRegistry(e||H);if(r)return r}catch{}if(Y&&typeof Y.resolveModuleRegistry=="function")try{return Y.resolveModuleRegistry(e||H)}catch{}if(we&&typeof we=="object")return we;const t=Cr(H);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModules=="object")return n.cineModules}return null}const Mo=(function(){if(q&&typeof q.getModuleRegistry=="function")try{const t=q.getModuleRegistry(H);if(t)return t}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const t=J.getModuleRegistry(H);if(t)return t}catch{}if(Y&&typeof Y.getModuleRegistry=="function")try{const t=Y.getModuleRegistry(H);if(t)return t}catch{}return Vp()})(),Wp=(function(){return q&&typeof q.queueModuleRegistration=="function"?function(r,n,o,i){try{return q.queueModuleRegistration(r,n,o,i||H)}catch{return!1}}:J&&typeof J.queueModuleRegistration=="function"?function(r,n,o){try{const i=J.queueModuleRegistration(r,n,o);return typeof i>"u"?!1:i}catch{return!1}}:Y&&typeof Y.queueModuleRegistration=="function"?function(r,n,o,i){try{return Y.queueModuleRegistration(r,n,o,i||H)}catch{return!1}}:function(){return!1}})(),qp=(function(){return q&&typeof q.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=q.registerOrQueueModule(r,n,o,i,s||H,a||Mo);return typeof c>"u"?!1:c}catch{return!1}}:J&&typeof J.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=J.registerOrQueueModule(r,n,o,i,s||H,a||Mo);return typeof c>"u"?!1:c}catch{return!1}}:Y&&typeof Y.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{return Y.registerOrQueueModule(r,n,o,i,s||H,a||Mo)}catch{return!1}}:function(r,n,o,i){if(typeof i=="function")try{if(typeof window<"u"&&window.cineModuleRegistry&&typeof window.cineModuleRegistry.register=="function")return window.cineModuleRegistry.register(r,n,o),!0;console.warn("Logging module registration deferred - queue unavailable.")}catch{}return!1}})();function Hp(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Yp(e){if(!e||typeof e!="object"||Hp(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;const t=e.constructor;if(!t)return!1;if(t===Number||t===String||t===Boolean||t===Date||t===RegExp||t===Promise||t===WeakMap||t===WeakSet||t===Map||t===Set)return!0;const r=typeof t.name=="string"?t.name:"";if(r&&/Error|Event|Response|Request|Headers|Node|Element|Window|Document/.test(r))return!0;try{if(typeof e.then=="function"||typeof e.catch=="function"||typeof e.pipe=="function"||typeof e.on=="function"||typeof e.write=="function"||typeof e.read=="function"||typeof e.getReader=="function"||typeof e.getWriter=="function"||typeof e[Symbol.iterator]=="function"&&!Array.isArray(e))return!0;if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const n=e[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port|Process/.test(n))return!0}}catch{}return!1}function os(e,t){const r=t||(typeof WeakSet=="function"?new WeakSet:{add(){},has(){return!1}});if(!e||typeof e!="object"||Yp(e))return e;if(typeof process<"u"&&process&&Va&&Va.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(typeof r.has=="function"&&r.has(e))return e;typeof r.add=="function"&&r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||os(s,r)}try{try{return Object.freeze(e)}catch(o){return e}}catch{return e}}const Ie=(function(){return q&&typeof q.freezeDeep=="function"?q.freezeDeep:J&&typeof J.freezeDeep=="function"?function(r,n){try{return J.freezeDeep(r,n)}catch{return os(r,n)}}:Y&&typeof Y.freezeDeep=="function"?Y.freezeDeep:os})();function Ya(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const He=(function(){return q&&typeof q.safeWarn=="function"?q.safeWarn:J&&typeof J.safeWarn=="function"?function(r,n){try{J.safeWarn(r,n)}catch{Ya(r,n)}}:Y&&typeof Y.safeWarn=="function"?Y.safeWarn:Ya})(),fn=["debug","info","warn","error","log"],mt=typeof Symbol=="function"?Symbol.for("cineLoggingConsoleProxyInstalled"):"__cineLoggingConsoleProxyInstalled__",ge=(function(){const t=Object.create(null);if(typeof console>"u"||!console)return t;for(let r=0;r<fn.length;r+=1){const n=fn[r];try{const o=console[n];t[n]=typeof o=="function"?o:null}catch{t[n]=null}}return t})();let ct=!1,qs=!1,Ir=!1,Rn=null,wo=!1,Tn=0;const Jp=(function(){return q&&typeof q.exposeGlobal=="function"?function(r,n,o){try{return q.exposeGlobal(r,n,o)}catch{return!1}}:function(r,n){if(!H||typeof H!="object"&&typeof H!="function")return!1;try{return H[r]=n,!0}catch{return!1}}})();function Qp(e,t){if(!(!q||typeof q.recordModule!="function"))try{q.recordModule(e,t)}catch{}}const Ot={debug:{priority:10,consoleMethod:"debug"},info:{priority:20,consoleMethod:"info"},warn:{priority:30,consoleMethod:"warn"},error:{priority:40,consoleMethod:"error"}},Xp=Ie(Ot),pn=Object.freeze(Object.keys(Ot).concat(["other"]));function Cn(){const e=Object.create(null);for(let t=0;t<pn.length;t+=1){const r=pn[t];e[r]=0}return e}function Zp(e){if(!(!e||typeof e!="object"))for(let t=0;t<pn.length;t+=1){const r=pn[t];e[r]=0}}function ed(e){if(typeof e=="string"&&e){if(Object.prototype.hasOwnProperty.call(Ot,e))return e;const t=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(Ot,t))return t}return"other"}function is(e,t){if(!e||typeof e!="object")return 0;const r=e[t];return typeof r=="number"&&Number.isFinite(r)&&r>0?r:0}function Hs(e,t,r){if(!e||typeof e!="object"||typeof r!="number"||!Number.isFinite(r)||r===0)return;const n=ed(t),i=is(e,n)+r;e[n]=i>0?i:0}function gl(e,t,r){if(!(!Array.isArray(t)||!t.length)&&!(typeof r!="number"||!Number.isFinite(r)||r===0))for(let n=0;n<t.length;n+=1){const o=t[n],i=o&&o.level;Hs(e,i,r)}}function td(e){const t=Cn();return gl(t,e,1),t}function ml(e,t){if(!(!e||typeof e!="object"||!t||typeof t!="object"))for(let r=0;r<pn.length;r+=1){const n=pn[r],o=is(t,n);if(o){const i=is(e,n);e[n]=i+o}}}function hl(e){const t=Cn();return ml(t,e),t}function en(e){return Ie(hl(e))}const Xo=50,bl=1,Sl=5e3,Zo="__cineLoggingHistory",ss="__cineLoggingConfig",rd=typeof Symbol=="function"?Symbol.for("cineLoggingHandled"):"__cineLoggingHandled__",ot={level:"warn",historyLevel:"info",historyLimit:1200,consoleOutput:!0,persistSession:!0,captureGlobalErrors:!0,captureConsole:!1,stackTraces:!0},nd=Ie(ot),od="cine-sw-logs",id="cine-sw:log-entry",sd="cine-sw:log-state-request",ad="cine-sw:log-state",Ja=5e3,cd=60*1e3,ld=200;function El(){return{level:ot.level,historyLevel:ot.historyLevel,historyLimit:ot.historyLimit,consoleOutput:ot.consoleOutput,persistSession:ot.persistSession,captureGlobalErrors:ot.captureGlobalErrors,captureConsole:ot.captureConsole,stackTraces:ot.stackTraces}}let v=El();const Et=[],ei=new Set,ti=new Set,Ao=typeof WeakSet=="function"?new WeakSet:[];let wl=0;const Al=Cn(),Oi=Cn(),Ol=Cn();let Cl=0,ae=null;const U={initialised:!1,supported:!1,requestInFlight:!1,lastRequestId:null,pollTimer:null,requestTimer:null,broadcastChannel:null,broadcastFailed:!1,seenIds:typeof Set=="function"?new Set:null,fallbackSeenIds:typeof Set!="function"?[]:null,lastSnapshotMeta:null};function fr(e,t){const r=typeof t=="string"?t:v.level;if(typeof e=="string"){const n=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(Ot,n))return n;if(n==="log"||n==="information")return"info";if(n==="warning")return"warn";if(n==="trace"||n==="verbose")return"debug";if(n==="fatal"||n==="critical")return"error"}return Object.prototype.hasOwnProperty.call(Ot,r)?r:"info"}function dn(e){const t=fr(e,"info"),r=Ot[t];return r?r.priority:Ot.info.priority}function Ln(e,t){if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:e>0:!!t;if(typeof e=="string"){const r=e.trim().toLowerCase();if(r==="true"||r==="1"||r==="yes"||r==="on")return!0;if(r==="false"||r==="0"||r==="no"||r==="off")return!1}return typeof t=="boolean"?t:!1}function _l(e,t){const n=!!(t&&t.allowReducedMin===!0)?bl:Xo;if(typeof e=="number"&&Number.isFinite(e)){const o=Math.abs(Math.floor(e));return o?Math.max(n,Math.min(Sl,o)):v.historyLimit}if(typeof e=="string"&&e){const o=Number(e);if(Number.isFinite(o))return _l(o,t)}return v.historyLimit}function eo(e){if(typeof e=="string")return e;if(e instanceof Error)return e.message||e.name||"Error";if(e&&typeof e=="object"){if(typeof e.message=="string")return e.message;const t=e.constructor&&e.constructor.name;if(t)return t}if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e>"u"||e===null)return"";try{return String(e)}catch{}return Object.prototype.toString.call(e)}function ue(e,t,r){const n=typeof t=="number"?t:0,o=r||(typeof WeakSet=="function"?new WeakSet:null);if(e===null||typeof e>"u")return null;const i=typeof e;if(i==="string"||i==="number"||i==="boolean")return e;if(i==="bigint")try{return e.toString()}catch{return"BigInt"}if(i==="symbol")try{return e.toString()}catch{return"Symbol"}if(i==="function")return`[Function${e.name?` ${e.name}`:""}]`;if(e instanceof Date)try{return e.toISOString()}catch{return e.toString()}if(typeof RegExp<"u"&&e instanceof RegExp){try{return e.toString()}catch{}return"[RegExp]"}if(e instanceof Error){const a={name:e.name,message:e.message};if(e.stack&&(a.stack=String(e.stack)),typeof e.code<"u"&&(a.code=e.code),typeof e.status<"u"&&(a.status=e.status),typeof e.cause<"u"&&e.cause!==null&&(a.cause=ue(e.cause,n+1,o)),typeof e.details<"u"&&(a.details=ue(e.details,n+1,o)),typeof e.errors<"u"&&e.errors!==null){const c=[];let f=0;const l=function(d){if(c.length>=10){f+=1;return}try{c.push(ue(d,n+1,o))}catch(g){c.push(g&&g.message?`[Unserializable error: ${g.message}]`:"[Unserializable error]")}},y=e.errors;if(Array.isArray(y)){for(let p=0;p<y.length;p+=1)l(y[p]);y.length>c.length&&(f+=y.length-c.length)}else if(y&&typeof y=="object"){let p=null;try{const d=typeof Symbol=="function"?Symbol.iterator:null;d&&typeof y[d]=="function"&&(p=y[d].call(y))}catch{p=null}if(p&&typeof p.next=="function"){let d=p.next(),g=0;for(;!d.done;){g<10?l(d.value):f+=1,g+=1;try{d=p.next()}catch{f+=1;break}}}else l(y)}else l(y);c.length&&(a.errors=c,f>0&&(a.errorsTruncated=f))}return a}if(i==="object"){if(o)try{if(o.has(e))return"[Circular]";o.add(e)}catch{}if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return{__type:"ArrayBuffer",byteLength:e.byteLength};if(typeof DataView<"u"&&e instanceof DataView)return{__type:"DataView",byteOffset:e.byteOffset,byteLength:e.byteLength};if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(e)){const d=e.constructor&&e.constructor.name,g=32,m=typeof e.length=="number"?e.length:0,b=[],O=Math.min(m,g);for(let C=0;C<O;C+=1)b.push(e[C]);const A={__type:d||"TypedArray",length:m,byteOffset:typeof e.byteOffset=="number"?e.byteOffset:0,byteLength:typeof e.byteLength=="number"?e.byteLength:0};return b.length&&(A.preview=b),m>g&&(A.__truncatedItems=m-g),A}const a=typeof Map=="function"?Map:null;if(a&&e instanceof a){const d=[];let m=0;e.forEach((O,A)=>{m<30&&d.push({key:ue(A,n+1,o),value:ue(O,n+1,o)}),m+=1});const b={__type:"Map",size:typeof e.size=="number"?e.size:m,entries:d};return m>30&&(b.__truncatedEntries=m-30),b}const c=typeof Set=="function"?Set:null;if(c&&e instanceof c){const d=[];let m=0;e.forEach(O=>{m<30&&d.push(ue(O,n+1,o)),m+=1});const b={__type:"Set",size:typeof e.size=="number"?e.size:m,values:d};return m>30&&(b.__truncatedValues=m-30),b}const u=typeof URLSearchParams=="function"?URLSearchParams:null;if(u&&e instanceof u){const d=[],g=typeof e.entries=="function"?e.entries():null;let m=0;if(g&&typeof g.next=="function"){let A=0,C=g.next();for(;!C.done;){if(A<40){const _=C.value||[];d.push({key:ue(_[0],n+1,o),value:ue(_[1],n+1,o)})}A+=1,C=g.next()}A>d.length&&(m=A-d.length)}const b={__type:"URLSearchParams",entries:d};return m>0&&(b.__truncatedEntries=m),b}if(typeof URL=="function"&&e instanceof URL)try{return e.toString()}catch{}if(n>=4){const d=e.constructor&&e.constructor.name;return d?`[${d}]`:Object.prototype.toString.call(e)}if(Array.isArray(e)){const g=[],m=Math.min(e.length,20);for(let b=0;b<m;b+=1)g.push(ue(e[b],n+1,o));return e.length>20&&g.push(`… (${e.length-20} more)`),g}const f={},l=Object.keys(e),y=30,p=Math.min(l.length,y);for(let d=0;d<p;d+=1){const g=l[d];try{f[g]=ue(e[g],n+1,o)}catch(m){f[g]=`[Threw: ${m&&m.message?m.message:"error"}]`}}if(l.length>y&&(f.__truncatedKeys=l.length-y),typeof Object.getOwnPropertySymbols=="function"){const d=Object.getOwnPropertySymbols(e),g=Math.min(d.length,5);for(let m=0;m<g;m+=1){const b=d[m],O=typeof b=="symbol"?b.toString():String(b);try{f[O]=ue(e[b],n+1,o)}catch(A){f[O]=`[Threw: ${A&&A.message?A.message:"error"}]`}}}if(!l.length){const d=e.constructor&&e.constructor.name;d&&(f.__className=d)}return f}const s=$p(e);if(s.success)return s.value;try{return yl(e)}catch{}try{return String(e)}catch{}return null}function ri(e){if(typeof e!="string")return null;const t=e.replace(/\r\n?/g,`
`).trim();if(!t)return null;const r=5e3,n=t.length>r,o=n?t.slice(0,r):t,i=t.split(`
`),s=40,a=[];let c=!1;for(let u=0;u<i.length;u+=1){const f=i[u].trim();if(f)if(a.length<s)a.push(f.length>500?`${f.slice(0,500)}…`:f);else{c=!0;break}}return{stack:o,frames:a,truncated:n||c}}function ud(e){if(!e||typeof e!="object")return null;const t=typeof e.source=="string"&&e.source?e.source:"unknown";let r=null;typeof e.stack=="string"&&e.stack&&(r=ri(e.stack));const n=[];if(Array.isArray(e.frames))for(let s=0;s<e.frames.length&&n.length<40;s+=1){const a=e.frames[s];typeof a=="string"&&a?n.push(a):a!==null&&typeof a<"u"&&n.push(eo(a))}else if(r&&Array.isArray(r.frames))for(let s=0;s<r.frames.length;s+=1)n.push(r.frames[s]);const o=e.truncated===!0||(r?r.truncated===!0:!1)||n.length>0&&n.length>=40,i={source:t,truncated:o};return r&&r.stack?i.stack=r.stack:typeof e.stack=="string"&&e.stack?i.stack=e.stack:i.stack=null,n.length&&(i.frames=n),!i.stack&&(!i.frames||!i.frames.length)?null:Ie(i)}function yo(){const e=Cr(H);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{const n=r.sessionStorage;if(n&&typeof n.getItem=="function"&&typeof n.setItem=="function")return n}catch{}}return null}function kl(){const e=yo();if(e)try{e.removeItem(Zo)}catch{}}function fd(){const e=yo();if(e){if(!v.persistSession){try{e.removeItem(ss)}catch{}return}try{e.setItem(ss,JSON.stringify({level:v.level,historyLevel:v.historyLevel,historyLimit:v.historyLimit,consoleOutput:v.consoleOutput,persistSession:v.persistSession,captureGlobalErrors:v.captureGlobalErrors,captureConsole:v.captureConsole,stackTraces:v.stackTraces}))}catch(t){console.warn("cineLogging: Unable to persist logging config",t)}}}function Ys(){if(!v.persistSession){kl();return}const e=yo();if(e)try{e.setItem(Zo,JSON.stringify(Et))}catch(t){if(t&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")){v.persistSession=!1;try{e.removeItem(Zo)}catch{}return}console.warn("cineLogging: Unable to persist log history",t)}}function Js(){const e=v.persistSession===!1?bl:Xo;return Math.max(e,Math.min(Sl,Math.floor(v.historyLimit)))}function pd(e,t,r){if(!Array.isArray(e)||e.length===0)return null;Cl+=e.length;const n=td(e),o=r&&typeof r.source=="string"&&r.source.trim()?r.source.trim():"enforce",i=e[0]||null,s=e[e.length-1]||null,a=Date.now();let c="";try{c=new Date(a).toISOString()}catch{c=String(a)}if(ae=Ie({count:e.length,limit:t,source:o,timestamp:a,isoTimestamp:c,oldestEntryId:i&&typeof i.id=="string"?i.id:null,oldestEntryTimestamp:i&&typeof i.timestamp=="number"?i.timestamp:null,oldestEntryIsoTimestamp:i&&typeof i.isoTimestamp=="string"?i.isoTimestamp:null,newestEntryId:s&&typeof s.id=="string"?s.id:null,newestEntryTimestamp:s&&typeof s.timestamp=="number"?s.timestamp:null,newestEntryIsoTimestamp:s&&typeof s.isoTimestamp=="string"?s.isoTimestamp:null,levels:en(n)}),ge&&typeof ge.warn=="function")try{ge.warn("cineLogging: history trimmed to enforce retention limit",{limit:t,removed:e.length,source:o,levels:hl(n)})}catch{}return n}function Qs(e){const t=Js();if(Et.length<=t)return 0;const r=Et.length-t,n=Et.splice(0,r);gl(Oi,n,-1);const o=pd(n,t,e);return o&&ml(Ol,o),r}function Pl(e){return dn(e)>=dn(v.historyLevel)}function jl(e){return v.consoleOutput?dn(e)>=dn(v.level):!1}function Xs(e){const t=fr(e,"info"),r=jl(t),n=Pl(t);return Ie({level:t,enabled:r||n,console:r,history:n,thresholds:Ie({console:fr(v.level,ot.level),history:fr(v.historyLevel,ot.historyLevel)})})}function vl(e,t){const r=Xs(e);if(!t||typeof t!="object")return r.enabled;const n=t.console!==!1,o=t.history!==!1;return!n&&!o?!1:t.requireAll===!0?!(n&&!r.console||o&&!r.history):!!(n&&r.console||o&&r.history)}function Il(e){return`log-${e}-${Math.random().toString(36).slice(2,10)}`}function Rl(e){if(e){try{Et.push(e)}catch{return}Hs(Oi,e.level,1)}}function Tl(e){Rl(e),wl+=1,Qs({source:"append"}),Ys(),dd(e)}function dd(e){if(!ei.size)return;const t=Array.from(ei);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){He("cineLogging listener execution failed",o)}}}function yd(e){const t=typeof e=="number"&&Number.isFinite(e)?Math.max(0,Math.floor(e)):Et.length;if(!t)return Object.freeze([]);const r=Math.max(0,Et.length-t),n=Et.slice(r);return Object.freeze(n.slice())}function gd(e){if(!ti.size)return;const t=Array.from(ti);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){He("cineLogging config listener failed",o)}}}function Zs(e){if(!e||typeof e.length!="number")return[];const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}function cr(e,t){if(!Array.isArray(e))return!1;try{return typeof Object.isExtensible=="function"&&!Object.isExtensible(e)?!1:(e.push(t),!0)}catch{}return!1}function md(e){return e==="error"?"error":e==="warn"?"warn":e==="info"?"info":"debug"}function Ll(e){if(typeof e!="string"||!e)return null;if(Object.prototype.hasOwnProperty.call(ge,e)){const t=ge[e];if(typeof t=="function")return t}if(typeof console<"u"&&console){let t=null;try{t=console[e]}catch{t=null}if(typeof t=="function"&&(!t||!t[mt]))return t}if((e==="debug"||e==="log")&&typeof ge.log=="function")return ge.log;if(e==="info"){if(typeof ge.info=="function")return ge.info;if(typeof ge.log=="function")return ge.log}if(e==="warn"){if(typeof ge.warn=="function")return ge.warn;if(typeof ge.error=="function")return ge.error}return e==="error"&&typeof ge.error=="function"?ge.error:null}function Ml(e,t){const r=Ll(e);if(typeof r!="function")return;const n=typeof console<"u"&&console?console:H&&H.console?H.console:null,o=Array.isArray(t)?t:Zs(t);try{return r.apply(n,o)}catch{try{return Function.prototype.apply.call(r,n,o)}catch{}}}function hd(e,t,r){const n=md(e),o=Array.isArray(t)?t:Zs(t),i=[];for(let d=0;d<o.length;d+=1){const g=o[d],m=typeof g;if(m==="string")cr(i,g);else if(m==="number"||m==="boolean")cr(i,String(g));else if(m==="symbol")try{cr(i,g.toString())}catch{}}let s=i.join(" ").trim();s||(s=`[console.${e||n}]`);let a=null,c=null;if(o.length)try{a=ue(o),c={arguments:a}}catch{c={arguments:o.slice()}}const u=[],f=Array.isArray(a)?a:null;for(let d=0;d<o.length;d+=1){const g=o[d],m=f?f[d]:null,b=g instanceof Error,O=m&&typeof m=="object"&&m!==null?typeof m.stack=="string"||typeof m.message=="string"||typeof m.name=="string":!1;if(!b&&!O)continue;let A=O?m:null;if(!A)try{A=ue(g)}catch{A=null}!A&&b&&(A={name:g.name||null,message:g.message||eo(g)||null},typeof g.code<"u"&&(A.code=g.code),typeof g.status<"u"&&(A.status=g.status),typeof g.stack=="string"&&g.stack&&(A.stack=g.stack));let C=A;if(C&&typeof C=="object")try{C=yl(C)}catch{try{C=Object.assign({},C)}catch{C=A}}const _={index:d};if(C&&typeof C=="object")_.value=C,typeof C.name=="string"&&C.name&&(_.name=C.name),typeof C.message=="string"&&C.message&&(_.message=C.message),typeof C.code<"u"&&(_.code=C.code),typeof C.status<"u"&&(_.status=C.status);else if(typeof C<"u"){_.value=C;const S=eo(C);S&&(_.message=S)}else _.value=null;const k=g===null?"null":typeof g;if(k==="object"||k==="function"){const S=g&&g.constructor&&g.constructor.name;_.argumentType=typeof S=="string"&&S?S:k}else _.argumentType=k;const j=b&&typeof g.stack=="string"&&g.stack?ri(g.stack):C&&typeof C=="object"&&typeof C.stack=="string"?ri(C.stack):null;j&&(typeof j.stack=="string"&&(_.stack=j.stack),Array.isArray(j.frames)&&j.frames.length&&(_.frames=j.frames),j.truncated&&(_.stackTruncated=!0)),cr(u,_)}const l={channel:"console",method:e||"log"};if(r&&typeof r=="object"){const d=Object.keys(r);for(let g=0;g<d.length;g+=1){const m=d[g];try{l[m]=ue(r[m])}catch{l[m]=r[m]}}}if(u.length){c=c||{};const d=[];for(let m=0;m<u.length;m+=1){const b=u[m];d.push(b.index)}c.errors=u,c.errorCount=u.length,c.errorIndices=d,c.primaryError=u[0],l.errorCount=u.length,l.errorIndices=d;const g=u[0];g&&(typeof g.name=="string"&&g.name&&(l.primaryErrorName=g.name),typeof g.message=="string"&&g.message&&(l.primaryErrorMessage=g.message),typeof g.code<"u"&&(l.primaryErrorCode=g.code),typeof g.status<"u"&&(l.primaryErrorStatus=g.status),g.stack&&(l.primaryErrorHasStack=!0))}const y=e==="error"||u.length>0,p={namespace:"console",meta:l};return y&&(p.captureStack=!0),tt(n,s,c,p,{silentConsole:!0})}function bd(){if(ct)return!0;if(qs=!0,typeof console>"u"||!console)return Ir=!0,!1;try{if(console[mt])return ct=!0,Ir=!1,!0}catch{}let e=!1;for(let t=0;t<fn.length;t+=1){const r=fn[t];let n=Ll(r);if(typeof n!="function")try{const i=console[r];typeof i=="function"&&(!i||!i[mt])&&(n=i)}catch{n=null}if((!Object.prototype.hasOwnProperty.call(ge,r)||ge[r]===null)&&(ge[r]=typeof n=="function"?n:ge[r]),typeof n!="function")continue;const o=function(){const s=Zs(arguments);Tn+=1;try{if(Tn===1){const a=s.length?s[0]:null;if(!(typeof a=="string"&&a.indexOf("cineLogging:")===0))try{hd(r,s,{captured:!0})}catch(u){}}return Ml(r,s)}finally{Tn-=1,Tn<0&&(Tn=0)}};try{Object.defineProperty(o,mt,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{o[mt]=!0}try{console[r]=o,e=!0}catch{}}if(e){ct=!0,Ir=!1;try{Object.defineProperty(console,mt,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{try{console[mt]=!0}catch{}}}else Ir=!0;return ct}function Sd(){if(!ct)return!1;if(typeof console>"u"||!console)return ct=!1,!1;let e=!1;for(let t=0;t<fn.length;t+=1){const r=fn[t],n=ge[r];try{typeof n=="function"?(console[r]=n,e=!0):r!=="log"&&r!=="info"&&delete console[r]}catch{}}try{console&&console[mt]&&(typeof Object.defineProperty=="function"?Object.defineProperty(console,mt,{configurable:!0,enumerable:!1,writable:!0,value:!1}):console[mt]=!1)}catch{}return ct=!1,e}function ea(){return v.captureConsole?bd()?(wo=!1,Rn!=="enabled"&&(tt("info","Console output capture enabled",Ki({status:"enabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Rn="enabled"),!0):(wo||(tt("warn","Console output capture failed",Ki({status:"failed",reason:typeof console>"u"||!console?"console-unavailable":"installation-failed"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),He("cineLogging: Unable to capture console output for diagnostics."),wo=!0),Rn="failed",!1):(ct&&Sd(),Rn!=="disabled"&&(tt("info","Console output capture disabled",Ki({status:"disabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Rn="disabled"),wo=!1,Ir=!1,!0)}function ta(){return!!v.captureConsole&&ct===!0}function Ki(e){const t={configured:v.captureConsole===!0,installed:ct===!0,attempted:qs===!0,failed:Ir===!0};if((typeof console>"u"||!console)&&(t.consoleAvailable=!1),e&&typeof e=="object"){const r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}}return t}function Ed(e){return ra({captureConsole:!0},(e&&typeof e=="object"?e:null)||void 0),ta()}function wd(e){return ra({captureConsole:!1},(e&&typeof e=="object"?e:null)||void 0),ta()}function Ad(e,t,r){const n=r&&Object.prototype.hasOwnProperty.call(r,"captureStack")?r.captureStack:null;return n===!0?!0:n===!1||v.stackTraces!==!0?!1:t instanceof Error?!0:dn(e)>=dn("warn")}function Nl(e,t,r,n){if(!Ad(e,r,n))return null;let o="generated",i="";if(r instanceof Error){const c=r.stack;typeof c=="string"&&c&&(o="detail",i=c)}if(!i)try{const c=typeof t=="string"&&t?t:`Log ${e}`,u=new Error(c);typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(u,Nl),typeof u.stack=="string"&&u.stack&&(i=u.stack)}catch{}const s=ri(i);if(!s)return null;const a={source:o,stack:s.stack,truncated:s.truncated};return Array.isArray(s.frames)&&s.frames.length&&(a.frames=s.frames),Ie(a)}function tt(e,t,r,n,o){const i=fr(e,"info"),s=Date.now();let a="";try{a=new Date(s).toISOString()}catch{a=String(s)}const c=n&&typeof n=="object"?n:null,u=Nl(i,t,r,c),f=c&&typeof c.namespace=="string"&&c.namespace?n.namespace:null,l=c&&typeof c.meta<"u"?ue(c.meta):null,y=typeof r>"u"?null:ue(r),p=Ie({id:Il(s),level:i,message:eo(t),namespace:f,detail:y,meta:l,timestamp:s,isoTimestamp:a,origin:u});Hs(Al,i,1),Pl(i)&&Tl(p);const d=o&&typeof o=="object"?o:null;if(jl(i)&&(!d||d.silentConsole!==!0)){const m=(Ot[i]||Ot.info).consoleMethod,b=["[cine]"];f&&b.push(`[${f}]`),b.push(p.isoTimestamp);const A=[`${b.join(" ")} ${p.message}`];r!==void 0?cr(A,r):p.detail!==null&&cr(A,p.detail),p.meta!==null&&cr(A,{meta:p.meta}),u&&cr(A,{origin:u}),Ml(m,A)}return p}function zl(e,t,r){return tt("debug",e,t,r)}function Od(e,t,r){return tt("info",e,t,r)}function Cd(e,t,r){return tt("warn",e,t,r)}function _d(e,t,r){return tt("error",e,t,r)}function to(){return Ie({level:v.level,historyLevel:v.historyLevel,historyLimit:v.historyLimit,consoleOutput:v.consoleOutput,persistSession:v.persistSession,captureGlobalErrors:v.captureGlobalErrors,captureConsole:v.captureConsole,stackTraces:v.stackTraces})}function kd(e){const t=e&&typeof e.limit<"u"?e.limit:void 0;return yd(t)}function Pd(){return ae?Ie({count:typeof ae.count=="number"?ae.count:0,limit:typeof ae.limit=="number"?ae.limit:Js(),source:typeof ae.source=="string"?ae.source:"enforce",timestamp:typeof ae.timestamp=="number"?ae.timestamp:null,isoTimestamp:typeof ae.isoTimestamp=="string"?ae.isoTimestamp:null,oldestEntryId:typeof ae.oldestEntryId=="string"?ae.oldestEntryId:null,oldestEntryTimestamp:typeof ae.oldestEntryTimestamp=="number"?ae.oldestEntryTimestamp:null,oldestEntryIsoTimestamp:typeof ae.oldestEntryIsoTimestamp=="string"?ae.oldestEntryIsoTimestamp:null,newestEntryId:typeof ae.newestEntryId=="string"?ae.newestEntryId:null,newestEntryTimestamp:typeof ae.newestEntryTimestamp=="number"?ae.newestEntryTimestamp:null,newestEntryIsoTimestamp:typeof ae.newestEntryIsoTimestamp=="string"?ae.newestEntryIsoTimestamp:null,levels:ae.levels?en(ae.levels):en(Cn())}):null}function Gl(){return Ie({runtimeEntries:wl,retainedEntries:Et.length,droppedEntries:Cl,historyLimit:Js(),lastDrop:Pd(),levels:Ie({emitted:en(Al),retained:en(Oi),dropped:en(Ol)}),consoleCapture:Ie({configured:v.captureConsole===!0,installed:ct,attempted:qs,failed:Ir})})}function jd(e){return Et.length=0,Zp(Oi),(!e||e.persist!==!1)&&Ys(),!0}function vd(e){return typeof e!="function"?function(){return!1}:(ei.add(e),function(){return ei.delete(e),!0})}function Id(e){return typeof e!="function"?function(){return!1}:(ti.add(e),function(){return ti.delete(e),!0})}function Rd(e,t){if(!e&&!t)return null;if(!e)return ue(t);if(!t)return e;if(typeof e!="object"||typeof t!="object")return ue(t);const r={},n=Object.keys(e);for(let i=0;i<n.length;i+=1){const s=n[i];r[s]=e[s]}const o=Object.keys(t);for(let i=0;i<o.length;i+=1){const s=o[i];r[s]=ue(t[s])}return r}function Td(e,t){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?ue(t.meta):null;function o(i,s,a,c){const u=Rd(n,c);return tt(i,s,a,{namespace:r,meta:u})}return Ie({namespace:r,log(i,s,a,c){return o(i,s,a,c)},debug(i,s,a){return o("debug",i,s,a)},info(i,s,a){return o("info",i,s,a)},warn(i,s,a){return o("warn",i,s,a)},error(i,s,a){return o("error",i,s,a)},getConfig:to,isLevelEnabled(i,s){return vl(i,s)},getLevelState(i){return Xs(i)}})}function Bl(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;const t=rd;try{return typeof t=="symbol"?e[t]?!0:(e[t]=!0,!1):Object.prototype.hasOwnProperty.call(e,t)&&e[t]?!0:(Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:!0}),!1)}catch{}return!1}function Ld(e){if(!v.captureGlobalErrors||Bl(e))return;const t={message:e&&typeof e.message=="string"?e.message:"",filename:e&&(e.filename||e.fileName)||null,lineno:e&&(e.lineno||e.lineNumber)||null,colno:e&&(e.colno||e.columnNumber)||null,error:e&&e.error?ue(e.error):null};e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),tt("error","Global error captured",t,{namespace:"global"})}function Md(e){if(!v.captureGlobalErrors||Bl(e))return;const t={reason:e?ue(e.reason):null};e&&e.promise&&(t.promiseState="[Promise]"),e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),tt("error","Unhandled promise rejection captured",t,{namespace:"global"})}function Nd(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;if(Ao instanceof WeakSet)return Ao.has(e)?!0:(Ao.add(e),!1);const t=Ao;return t.indexOf(e)!==-1?!0:(t.push(e),!1)}function xl(){if(!v.captureGlobalErrors)return;const e=Cr(H);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r.addEventListener!="function")&&!Nd(r)){try{r.addEventListener("error",Ld,!0)}catch{}try{r.addEventListener("unhandledrejection",Md,!0)}catch{}}}}function Ci(e){if(!e||typeof e!="object")return{changed:!1,captureChanged:!1,limitChanged:!1};let t=!1,r=!1,n=!1,o=!1;const i=Object.prototype.hasOwnProperty.call(e,"persistSession")?Ln(e.persistSession,v.persistSession):v.persistSession;if(Object.prototype.hasOwnProperty.call(e,"level")){const s=fr(e.level,v.level);s!==v.level&&(v.level=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLevel")){const s=fr(e.historyLevel,v.historyLevel);s!==v.historyLevel&&(v.historyLevel=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLimit")){const s=_l(e.historyLimit,{allowReducedMin:i===!1});s!==v.historyLimit&&(v.historyLimit=s,t=!0,n=!0)}if(Object.prototype.hasOwnProperty.call(e,"consoleOutput")){const s=Ln(e.consoleOutput,v.consoleOutput);s!==v.consoleOutput&&(v.consoleOutput=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"persistSession")&&i!==v.persistSession&&(v.persistSession=i,t=!0),v.persistSession&&v.historyLimit<Xo&&(v.historyLimit=Xo,t=!0,n=!0),Object.prototype.hasOwnProperty.call(e,"captureGlobalErrors")){const s=Ln(e.captureGlobalErrors,v.captureGlobalErrors);s!==v.captureGlobalErrors&&(v.captureGlobalErrors=s,t=!0,r=!0)}if(Object.prototype.hasOwnProperty.call(e,"captureConsole")){const s=Ln(e.captureConsole,v.captureConsole);s!==v.captureConsole&&(v.captureConsole=s,t=!0,o=!0)}if(Object.prototype.hasOwnProperty.call(e,"stackTraces")){const s=Ln(e.stackTraces,v.stackTraces);s!==v.stackTraces&&(v.stackTraces=s,t=!0)}return{changed:t,captureChanged:r,limitChanged:n,consoleCaptureChanged:o}}function ra(e,t){const r=v.captureGlobalErrors,n=v.captureConsole,o=Ci(e);return o.limitChanged&&Qs({source:"config"}),o.changed&&(!t||t.persist!==!1)&&(fd(),Ys()),v.persistSession||kl(),!r&&v.captureGlobalErrors&&xl(),(o.consoleCaptureChanged||n!==v.captureConsole)&&ea(),o.changed&&gd(to()),to()}function zd(){const e=Cr(H),t=["__cineLoggingConfig","__CINE_LOGGING_CONFIG","cineLoggingConfig"];for(let r=0;r<e.length;r+=1){const n=e[r];if(!(!n||typeof n!="object"&&typeof n!="function"))for(let o=0;o<t.length;o+=1){const i=t[o];let s;try{s=n[i]}catch{s=null}if(s&&typeof s=="object")return s}}return null}function Gd(){const e=yo();if(!e)return;let t="";try{t=e.getItem(ss)||""}catch{return}if(t)try{const r=JSON.parse(t);Ci(r)}catch(r){He("cineLogging: Unable to restore logging config from storage",r)}}function Bd(){if(!H||!H.location)return;let e="";try{e=H.location.search||""}catch{return}if(typeof e!="string"||!e)return;let t=null;if(typeof URLSearchParams=="function")try{t=new URLSearchParams(e)}catch{}const r={};let n=!1;function o(i,s){r[i]=s,n=!0}if(t)t.has("cineLogLevel")&&o("level",t.get("cineLogLevel")),t.has("cineLogHistoryLevel")&&o("historyLevel",t.get("cineLogHistoryLevel")),t.has("cineLogLimit")&&o("historyLimit",t.get("cineLogLimit")),t.has("cineLogConsole")&&o("consoleOutput",t.get("cineLogConsole")),t.has("cineLogPersist")&&o("persistSession",t.get("cineLogPersist")),t.has("cineLogCapture")&&o("captureGlobalErrors",t.get("cineLogCapture")),t.has("cineLogConsoleCapture")&&o("captureConsole",t.get("cineLogConsoleCapture")),t.has("cineLogStackTraces")&&o("stackTraces",t.get("cineLogStackTraces"));else{const s=(e.charAt(0)==="?"?e.slice(1):e).split("&");for(let a=0;a<s.length;a+=1){const c=s[a];if(!c)continue;const u=c.indexOf("="),f=decodeURIComponent(u===-1?c:c.slice(0,u)),l=u===-1?"":decodeURIComponent(c.slice(u+1));f==="cineLogLevel"?o("level",l):f==="cineLogHistoryLevel"?o("historyLevel",l):f==="cineLogLimit"?o("historyLimit",l):f==="cineLogConsole"?o("consoleOutput",l):f==="cineLogPersist"?o("persistSession",l):f==="cineLogCapture"?o("captureGlobalErrors",l):f==="cineLogConsoleCapture"?o("captureConsole",l):f==="cineLogStackTraces"&&o("stackTraces",l)}}n&&Ci(r)}function Fl(e){if(!e||typeof e!="object")return null;const t=fr(e.level,"info"),r=typeof e.timestamp=="number"&&Number.isFinite(e.timestamp)?e.timestamp:Date.now();let n="";if(typeof e.isoTimestamp=="string"&&e.isoTimestamp)n=e.isoTimestamp;else try{n=new Date(r).toISOString()}catch{n=String(r)}const o=typeof e.message=="string"?e.message:eo(e.message),i=typeof e.namespace=="string"&&e.namespace?e.namespace:null,s=typeof e.id=="string"&&e.id?e.id:Il(r);return Ie({id:s,level:t,message:o,namespace:i,detail:typeof e.detail>"u"?null:ue(e.detail),meta:typeof e.meta>"u"?null:ue(e.meta),timestamp:r,isoTimestamp:n,origin:typeof e.origin>"u"?null:ud(e.origin)})}function xd(){return H&&typeof H.navigator=="object"&&H.navigator?H.navigator:typeof navigator<"u"&&navigator?navigator:typeof globalThis<"u"&&globalThis&&typeof globalThis.navigator=="object"?globalThis.navigator:null}function Ul(){const e=xd();return!e||typeof e!="object"||!e.serviceWorker?null:e.serviceWorker}function Fd(e){return e?U.seenIds?U.seenIds.has(e)?!1:(U.seenIds.add(e),!0):Array.isArray(U.fallbackSeenIds)?U.fallbackSeenIds.indexOf(e)!==-1?!1:(U.fallbackSeenIds.push(e),!0):!0:!0}function Ud(e,t){const r={};if(e&&typeof e.meta<"u")if(e.meta&&typeof e.meta=="object")for(const o in e.meta)Object.prototype.hasOwnProperty.call(e.meta,o)&&(r[o]=e.meta[o]);else r.value=e.meta;const n=e&&typeof e.channel=="string"&&e.channel?e.channel:r.channel;return n?r.channel=n:r.channel="service-worker",t&&typeof t=="object"&&(t.cacheName&&!r.cacheName&&(r.cacheName=t.cacheName),t.cacheVersion&&!r.cacheVersion&&(r.cacheVersion=t.cacheVersion),typeof t.generatedAt=="number"&&Number.isFinite(t.generatedAt)&&(r.snapshotTimestamp||(r.snapshotTimestamp=t.generatedAt)),typeof t.historyLength=="number"&&Number.isFinite(t.historyLength)&&(r.snapshotSize||(r.snapshotSize=t.historyLength))),r}function Qa(e,t){if(!(!Array.isArray(e)||!e.length))for(let r=0;r<e.length;r+=1){const n=e[r];if(!n||typeof n!="object")continue;const o=typeof n.id=="string"&&n.id?n.id:null;if(!Fd(o))continue;const i=n.origin&&typeof n.origin=="object"?n.origin:{runtime:"service-worker"},s=Fl({id:o||void 0,level:n.level,message:n.message,namespace:typeof n.namespace=="string"&&n.namespace?n.namespace:"service-worker",detail:typeof n.detail>"u"?null:n.detail,meta:Ud(n,t),timestamp:n.timestamp,isoTimestamp:n.isoTimestamp,origin:i});s&&Tl(s)}}function No(e){if(U.requestInFlight&&!(e&&U.lastRequestId&&e!==U.lastRequestId)){if(U.requestInFlight=!1,U.lastRequestId=null,U.requestTimer&&typeof clearTimeout=="function")try{clearTimeout(U.requestTimer)}catch{}U.requestTimer=null}}function Lr(){if(!(U.broadcastChannel||U.broadcastFailed)&&!(U.pollTimer||typeof setTimeout!="function"))try{U.pollTimer=setTimeout(()=>{U.pollTimer=null,Dl("poll")},cd)}catch{}}function Dd(){if(U.broadcastFailed)return null;if(U.broadcastChannel)return U.broadcastChannel;if(typeof BroadcastChannel!="function")return U.broadcastFailed=!0,null;try{const e=new BroadcastChannel(od);if(e.addEventListener("message",ni),U.broadcastChannel=e,U.pollTimer&&typeof clearTimeout=="function"){try{clearTimeout(U.pollTimer)}catch(t){}U.pollTimer=null}return e}catch(e){return U.broadcastFailed=!0,He("cineLogging: Unable to open service worker diagnostics channel",e),null}}function ni(e){if(!e)return;let t=null;try{t=e.data||null}catch{t=null}if(!(!t||typeof t!="object")){if(t.type===id){Qa([t.entry],U.lastSnapshotMeta),Lr();return}if(t.type===ad){No(t.requestId||null);const r=t.state&&typeof t.state=="object"?t.state:null;if(!r){Lr();return}U.lastSnapshotMeta={cacheName:typeof r.cacheName=="string"&&r.cacheName?r.cacheName:null,cacheVersion:r.cacheVersion||null,generatedAt:typeof r.generatedAt=="number"&&Number.isFinite(r.generatedAt)?r.generatedAt:Date.now(),historyLength:typeof r.historyLength=="number"&&Number.isFinite(r.historyLength)?r.historyLength:null},Qa(r.history,U.lastSnapshotMeta),Lr()}}}function Dl(e){if(U.requestInFlight)return;const t=Ul();if(!t)return;U.supported=!0;const r=`sw-log-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;U.requestInFlight=!0,U.lastRequestId=r;const n={type:sd,limit:ld,reason:typeof e=="string"&&e?e:"sync",requestId:r},o=s=>{if(s){try{s.port1.onmessage=null}catch{}if(typeof s.port1.onmessageerror<"u")try{s.port1.onmessageerror=null}catch{}try{s.port1.close()}catch{}try{s.port2.close()}catch{}}},i=t.ready&&typeof t.ready.then=="function"?t.ready.then(s=>s&&s.active||t.controller||null):Promise.resolve(t.controller||null);Promise.resolve(i).then(s=>{const a=t.controller||null,c=s||a;if(!c||typeof c.postMessage!="function"){No(r),Lr();return}let u=!1,f=null;const l=()=>{u||(u=!0,o(f),No(r))},y=()=>{l(),Lr()},p=b=>{l(),ni(b)},d=()=>{He("cineLogging: Service worker diagnostics channel closed before a response was received",{requestId:r}),y()},g=()=>{try{c.postMessage(n)}catch(b){He("cineLogging: Unable to post service worker diagnostics request",b),y();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{u||y()},Ja)}catch{}};if(!(typeof MessageChannel!="function"||!a?!1:c===a)){g();return}if(f=new MessageChannel,f.port1.onmessage=p,typeof f.port1.onmessageerror<"u"&&(f.port1.onmessageerror=d),typeof f.port1.start=="function")try{f.port1.start()}catch{}try{c.postMessage(n,[f.port2])}catch(b){o(f),f=null,He("cineLogging: Unable to request service worker diagnostics",b),g();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{u||d()},Ja)}catch{}}).catch(s=>{No(r),He("cineLogging: Unable to await service worker for diagnostics",s),Lr()})}function Kd(){if(U.initialised)return;U.initialised=!0;const e=Ul();if(e){if(U.supported=!0,Dd(),typeof e.addEventListener=="function")try{e.addEventListener("message",ni)}catch(t){He("cineLogging: Unable to attach service worker diagnostics listener",t)}else if(typeof e.onmessage>"u")try{e.onmessage=ni}catch{}Dl("initial-sync"),U.broadcastChannel||Lr()}}function $d(){if(!v.persistSession)return;const e=yo();if(!e)return;let t="";try{t=e.getItem(Zo)||""}catch{return}if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;for(let n=0;n<r.length;n+=1){const o=Fl(r[n]);o&&Rl(o)}Qs({source:"restore"})}catch(r){He("cineLogging: Unable to restore log history from storage",r)}}function Vd(){v=El();const e=zd();e&&Ci(e),Gd(),Bd()}Vd();$d();Kd();ea();v.captureGlobalErrors&&xl();zl("cineLogging initialized",{config:to(),stats:Gl()},{namespace:"logging",meta:{lifecycle:"init"}});const _i=Ie({log:tt,debug:zl,info:Od,warn:Cd,error:_d,createLogger:Td,getHistory:kd,getStats:Gl,clearHistory:jd,getConfig:to,setConfig:ra,getLevelState:Xs,isLevelEnabled:vl,subscribe:vd,subscribeConfig:Id,enableConsoleCapture:Ed,disableConsoleCapture:wd,syncConsoleCapture:ea,isConsoleCaptureActive:ta,constants:Ie({LOG_LEVELS:Xp,DEFAULT_CONFIG:nd})});Qp("cineLogging",_i);const Kl={category:"diagnostics",description:"Structured logging utilities for debugging and diagnostics.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},Wd=qp("cineLogging",_i,Kl,function(e){He("Unable to register cineLogging module.",e)},H,Mo);Wd||Wp("cineLogging",_i,Kl,H);Jp("cineLogging",_i,{configurable:!0,enumerable:!1,writable:!1})||He("Unable to expose cineLogging globally.");const Rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;function oi(e){const t=(Rr&&typeof Rr=="object"?Rr:null)||(typeof globalThis<"u"?globalThis:null);if(!t)return null;let r,n=null;try{r=t.console,n=Object.getOwnPropertyDescriptor(t,"console")}catch{r=typeof console<"u"?console:null}if(!r||typeof r!="object")return null;let o=[];Array.isArray(e)?o=e:typeof e=="string"&&e?o=[e]:o=["warn","info"];const i=Object.create(null);for(let u=0;u<o.length;u+=1){const f=o[u];typeof f=="string"&&f&&(i[f]=!0)}const s=Object.keys(i);if(!s.length)return r;const a=Object.create(null);for(let u=0;u<s.length;u+=1){const f=s[u];let l=r[f];try{const y=Object.getOwnPropertyDescriptor(r,f);y&&Object.prototype.hasOwnProperty.call(y,"value")&&(l=y.value)}catch{}if(typeof l=="function")try{a[f]=l.bind(r)}catch{a[f]=l}else a[f]=l}const c=new Proxy(r,{get(u,f,l){return Object.prototype.hasOwnProperty.call(a,f)?a[f]:Reflect.get(u,f,l)},set(u,f,l,y){if(Object.prototype.hasOwnProperty.call(a,f))return a[f]=l,!0;try{return Reflect.set(u,f,l,y),!0}catch{}return!1},defineProperty(u,f,l){return Object.prototype.hasOwnProperty.call(a,f)?(l&&Object.prototype.hasOwnProperty.call(l,"value")&&(a[f]=l.value),!0):Reflect.defineProperty(u,f,l)},getOwnPropertyDescriptor(u,f){return Object.prototype.hasOwnProperty.call(a,f)?{configurable:!0,enumerable:!0,writable:!0,value:a[f]}:Reflect.getOwnPropertyDescriptor(u,f)},ownKeys(u){const f=Reflect.ownKeys(u);for(let l=0;l<s.length;l+=1)f.indexOf(s[l])===-1&&f.push(s[l]);return f}});try{Object.defineProperty(t,"console",{configurable:!0,enumerable:n?n.enumerable!==!1:!0,writable:!0,value:c})}catch{t.console=c}return c}if(Rr&&typeof Rr=="object")try{typeof Rr.__cineEnsureConsoleMethodsWritable!="function"&&(Rr.__cineEnsureConsoleMethodsWritable=oi)}catch{}const qd=Object.freeze(Object.defineProperty({__proto__:null,ensureConsoleMethodsWritable:oi},Symbol.toStringTag,{value:"Module"}));function Hd(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Kt=Hd();function Yd(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const Se=Yd(Kt),Jd=Se&&typeof Se.freezeDeep=="function"?Se.freezeDeep:function(t){return t},$l=e=>{try{return Jd(e)}catch{return e}};function Xa(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return e&&r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}const Qd=Se&&typeof Se.collectCandidateScopes=="function"?function(t){try{const r=Se.collectCandidateScopes(t,Kt);if(Array.isArray(r)&&r.length)return r}catch{}return Xa(t||Kt)}:Xa;function Xd(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const as=Se&&typeof Se.safeWarn=="function"?Se.safeWarn:Xd;function Zd(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=null;try{t=e.cineLogging||null}catch{t=null}return t&&typeof t=="object"?t:null}function Vl(e={}){const t=e.baseScope||Kt;e.allowRequire;const r=Qd(t);for(let n=0;n<r.length;n+=1){const o=Zd(r[n]);if(o)return o}return null}function nr(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const o=[];t.set(e,o);for(let i=0;i<e.length;i+=1)o[i]=nr(e[i],t);return o}const r={};t.set(e,r);const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=nr(e[i],t)}return r}function ey(e,t){if(!e&&!t)return null;if(!e)return nr(t);if(!t)return nr(e);if(typeof e!="object"||typeof t!="object")return nr(t);const r=nr(e),n=Object.keys(t);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=nr(t[i])}return r}function ty(e){if(typeof console>"u"||!console)return null;const t=typeof e=="string"?e.toLowerCase():"";return t==="error"&&typeof console.error=="function"?console.error.bind(console):t==="warn"&&typeof console.warn=="function"?console.warn.bind(console):t==="info"&&typeof console.info=="function"?console.info.bind(console):t==="debug"&&typeof console.debug=="function"?console.debug.bind(console):typeof console.log=="function"?console.log.bind(console):null}let Za=!1;function Wl(e,t={}){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?nr(t.meta):null;function o(s,a,c,u){const f=ty(s);if(!f)return null;const l=["[cine-fallback]"];r&&l.push(`[${r}]`);const y=new Date;try{l.push(y.toISOString())}catch{l.push(String(y.getTime()))}const g=[`${l.join(" ")} ${typeof a=="string"&&a?a:"Log entry"}`];typeof c<"u"&&g.push(c);const m=ey(n,u);m&&g.push({meta:m,source:"console-fallback"});try{f(...g)}catch{}if(!Za&&typeof console<"u"&&typeof console.warn=="function"){Za=!0;try{console.warn("[cine-fallback] Structured logging unavailable, using console logger.")}catch{}}return null}return $l({namespace:r,log(s,a,c,u){return o(s,a,c,u)},debug(s,a,c){return o("debug",s,a,c)},info(s,a,c){return o("info",s,a,c)},warn(s,a,c){return o("warn",s,a,c)},error(s,a,c){return o("error",s,a,c)},getConfig(){return null},isLevelEnabled(){return!0},getLevelState(s){return{level:typeof s=="string"&&s?s:"all",enabled:!0,source:"console-fallback"}},__cineLoggingFallback:!0})}function ry(e,t={}){const r=Vl(t),n=t&&typeof t.meta<"u"?t.meta:void 0;if(r&&typeof r.createLogger=="function")try{const o=r.createLogger(e,typeof n<"u"?{meta:n}:void 0);if(o)return o}catch(o){as("cineLoggingResolver: createLogger failed, falling back to console.",o)}return t.allowConsoleFallback===!1?null:Wl(e,{meta:n})}const Mr=$l({resolveLogging:Vl,resolveLogger:ry,createConsoleFallbackLogger:Wl}),ny=Se&&typeof Se.resolveModuleRegistry=="function"?Se.resolveModuleRegistry(Kt):null;if(Se&&typeof Se.registerOrQueueModule=="function"&&!Se.registerOrQueueModule("cineLoggingResolver",Mr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0,connections:["cineLogging","cineModuleBase","cineEnvironmentBridge"]},t=>{as("Unable to register cineLoggingResolver module.",t)},Kt,ny)&&typeof Se.queueModuleRegistration=="function")try{Se.queueModuleRegistration("cineLoggingResolver",Mr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0},Kt)}catch(t){as("Unable to queue cineLoggingResolver registration.",t)}if(Se&&typeof Se.exposeGlobal=="function")Se.exposeGlobal("cineLoggingResolver",Mr,Kt,{configurable:!0,enumerable:!1,writable:!1});else try{Kt.cineLoggingResolver=Mr}catch{}function oy(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const pr=oy(),at=typeof cineModuleBase=="object"&&cineModuleBase||(pr&&typeof pr.cineModuleBase=="object"?pr.cineModuleBase:null),gr=at&&typeof at.safeWarn=="function"?at.safeWarn:function(t,r){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof r>"u"?console.warn(t):console.warn(t,r)}catch{}},na="cameraPowerPlanner_contacts";function ql(e){const t=e||pr;try{if(t&&typeof t.localStorage<"u")return t.localStorage}catch(r){gr("cine.features.contacts could not access localStorage.",r)}return null}function Hl(){return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function vt(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return vt(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Yl(e){if(!e||typeof e!="object")return null;const t=vt(e.id)||Hl(),r=vt(e.name),n=vt(e.role),o=vt(e.phone),i=vt(e.email),s=vt(e.website||e.url),a=vt(e.notes||e.note||e.text),c=typeof e.avatar=="string"&&e.avatar.startsWith("data:")?e.avatar:"",u=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),f=Number.isFinite(e.updatedAt)?e.updatedAt:u,l={id:t,name:r,role:n,phone:o,email:i,website:s,notes:a,createdAt:u,updatedAt:f};return c&&(l.avatar=c),l}function Jl(e){return(Array.isArray(e)?e.filter(Boolean):[]).map(Yl).filter(Boolean).sort((t,r)=>{const n=(t&&t.name?t.name:"").toLowerCase(),o=(r&&r.name?r.name:"").toLowerCase();if(n&&o&&n!==o)try{return n.localeCompare(o)}catch(i){gr("cine.features.contacts could not sort contacts by locale.",i)}return n&&!o?-1:!n&&o?1:(t&&t.createdAt?t.createdAt:0)-(r&&r.createdAt?r.createdAt:0)})}function iy(e={}){const t=ql(e.scope);if(!t||typeof t.getItem!="function")return[];const r=typeof e.storageKey=="string"&&e.storageKey?e.storageKey:na;try{const n=t.getItem(r);if(!n)return[];const o=JSON.parse(n);return Array.isArray(o)?Jl(o):[]}catch(n){return gr("cine.features.contacts could not load contacts from storage.",n),[]}}function sy(e,t={}){const r=ql(t.scope);if(!r||typeof r.setItem!="function")return!1;const n=typeof t.storageKey=="string"&&t.storageKey?t.storageKey:na;try{return r.setItem(n,JSON.stringify(Array.isArray(e)?e:[])),!0}catch(o){return gr("cine.features.contacts could not save contacts to storage.",o),!1}}const yn=Object.freeze({CONTACTS_STORAGE_KEY:na,generateContactId:Hl,sanitizeContactValue:vt,normalizeContactEntry:Yl,sortContacts:Jl,loadStoredContacts:iy,saveContactsToStorage:sy});if(at&&typeof at.registerOrQueueModule=="function")try{at.registerOrQueueModule("cine.features.contacts",yn,{category:"features",description:"Shared helpers for contacts management.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cinePersistence"]},e=>gr("Unable to register cine.features.contacts module.",e),pr,at.getModuleRegistry&&at.getModuleRegistry(pr))}catch(e){gr("cine.features.contacts registration failed.",e)}let Ql=!1;if(at&&typeof at.exposeGlobal=="function")try{at.exposeGlobal("cineFeaturesContacts",yn,pr,{configurable:!0,enumerable:!1,writable:!1}),Ql=!0}catch(e){gr("cine.features.contacts could not expose global api.",e)}if(!Ql)try{pr.cineFeaturesContacts=yn}catch(e){gr("cine.features.contacts could not assign global api.",e)}const Ch=Object.freeze(Object.defineProperty({__proto__:null,default:yn},Symbol.toStringTag,{value:"Module"})),ay="modulepreload",cy=function(e){return"/"+e},ec={},Xl=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");o=c(r.map(u=>{if(u=cy(u),u in ec)return;ec[u]=!0;const f=u.endsWith(".css"),l=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":ay,f||(y.as="script"),y.crossOrigin="",y.href=u,a&&y.setAttribute("nonce",a),document.head.appendChild(y),f)return new Promise((p,d)=>{y.addEventListener("load",p),y.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};class Zl{async init(){throw new Error('Method "init()" must be implemented.')}async getItem(t){throw new Error('Method "getItem()" must be implemented.')}async setItem(t,r){throw new Error('Method "setItem()" must be implemented.')}async removeItem(t){throw new Error('Method "removeItem()" must be implemented.')}async clear(){throw new Error('Method "clear()" must be implemented.')}async getKeys(){throw new Error('Method "getKeys()" must be implemented.')}}class eu extends Zl{constructor(){super(),this.storage=window.localStorage}async init(){if(!this.storage)throw new Error("LocalStorage is not supported in this environment.");return Promise.resolve()}async getItem(t){try{const r=this.storage.getItem(t);if(r===null)return null;try{return JSON.parse(r)}catch{return r}}catch(r){return console.warn(`[LocalStorageAdapter] Failed to get item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r);this.storage.setItem(t,n)}catch(n){throw console.error(`[LocalStorageAdapter] Failed to save item: ${t}`,n),n}}async removeItem(t){try{this.storage.removeItem(t)}catch(r){console.warn(`[LocalStorageAdapter] Failed to remove item: ${t}`,r)}}async clear(){try{this.storage.clear()}catch(t){console.warn("[LocalStorageAdapter] Failed to clear storage",t)}}async getKeys(){return Object.keys(this.storage)}}class tu{constructor(){this.userId=null,this.storageKey="cine_user_uuid"}init(){if(this.userId)return this.userId;let t=localStorage.getItem(this.storageKey);return t?console.log("[UserContext] Loaded User UUID:",t):(typeof crypto<"u"&&crypto.randomUUID?t=crypto.randomUUID():t="user_"+Math.random().toString(36).substring(2,15),localStorage.setItem(this.storageKey,t),console.log("[UserContext] Generated new User UUID:",t)),this.userId=t,t}getUserId(){return this.userId?this.userId:this.init()}getScopedKey(t){return`user_${this.getUserId()}_${t}`}reset(){localStorage.removeItem(this.storageKey),this.userId=null}}const or=new tu,ly=Object.freeze(Object.defineProperty({__proto__:null,UserContext:tu,userContext:or},Symbol.toStringTag,{value:"Module"}));class uy{constructor(){this.driver=new eu,this.initialized=!1}async init(){this.initialized||(await this.driver.init(),console.log("[StorageRepository] Initialized with default driver:",this.driver.constructor.name),this.initialized=!0)}async switchDriver(t){console.log("[StorageRepository] Switching driver to:",t.constructor.name),await t.init(),this.driver=t}async getItem(t){this.initialized||await this.init();const r=or.getScopedKey(t);return this.driver.getItem(r)}async setItem(t,r){this.initialized||await this.init();const n=or.getScopedKey(t);return this.driver.setItem(n,r)}async removeItem(t){this.initialized||await this.init();const r=or.getScopedKey(t);return this.driver.removeItem(r)}async clear(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${or.getUserId()}_`,n=t.filter(o=>o.startsWith(r)).map(o=>this.driver.removeItem(o));await Promise.all(n)}async loadProject(t){return this.getItem(t)}async getKeys(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${or.getUserId()}_`;return t.filter(n=>n.startsWith(r)).map(n=>n.slice(r.length))}async saveProject(t,r){return Xl(async()=>{const{dataVault:n}=await Promise.resolve().then(()=>dy);return{dataVault:n}},void 0).then(({dataVault:n})=>{n&&n.saveSnapshot(t,r).catch(o=>console.warn("Auto-backup failed",o))}),this.setItem(t,r)}}const K=new uy;class cs extends Zl{constructor(){super(),this.name="IndexedDBAdapter"}async init(){try{if(typeof indexedDB>"u")throw new Error("IndexedDB is not supported in this environment.");return Promise.resolve()}catch(t){throw console.warn("IndexedDB initialization failed:",t),t}}async getItem(t){try{const r=await Kf(t);if(!r)return null;let n=Na.decompressFromUTF16(r);const o=n!==null?n:r;try{return JSON.parse(o)}catch{return o}}catch(r){return console.warn(`[IndexedDBAdapter] Failed to get/decompress item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r),o=Na.compressToUTF16(n);await $f(t,o)}catch(n){throw console.error(`[IndexedDBAdapter] Failed to compress/save item: ${t}`,n),n}}async removeItem(t){return Vf(t)}async clear(){return Wf()}async getKeys(){return qf()}}const Oo="cine_storage_migrated_v2";class fy{constructor(){this.localStorage=new eu,this.indexedDB=new cs}async runMigrationIfNeeded(){try{if(await this.localStorage.init(),await this.indexedDB.init(),await this.localStorage.getItem(Oo)==="true")return console.log("[MigrationService] Storage already migrated to IndexedDB."),!1;console.log("[MigrationService] Starting storage migration...");const r=await this.localStorage.getKeys();if(r.length===0)return console.log("[MigrationService] No local storage data found. safe to skip."),await this.markAsMigrated(),!1;const n=r.filter(i=>i!==Oo&&i!=="cine_user_uuid"),{userContext:o}=await Xl(async()=>{const{userContext:i}=await Promise.resolve().then(()=>ly);return{userContext:i}},void 0);o.init();for(const i of n)try{const s=await this.localStorage.getItem(i);if(s!==null){const a=o.getScopedKey(i);await this.indexedDB.setItem(a,s),console.log(`[MigrationService] Migrated key: ${i} -> ${a}`)}}catch(s){console.error(`[MigrationService] Failed to migrate key: ${i}`,s)}return await this.markAsMigrated(),console.log("[MigrationService] Migration complete. IndexedDB is now the primary storage."),!0}catch(t){return console.error("[MigrationService] Critical migration failure:",t),!1}}async markAsMigrated(){await this.localStorage.setItem(Oo,"true"),await this.indexedDB.setItem(Oo,"true")}}const $r=new fy,tc="cameraPowerPlanner_ownGear";class py{constructor(){this.memoryCache=null}async getOwnGear(){if(this.memoryCache)return this.memoryCache;try{const t=await K.getItem(tc);if(!t)return[];Array.isArray(t)?this.memoryCache=t:t.items&&Array.isArray(t.items)?this.memoryCache=t.items:this.memoryCache=[]}catch(t){console.warn("[GearRepository] Failed to load own gear:",t),this.memoryCache=[]}return this.memoryCache}async saveOwnGear(t){if(!Array.isArray(t)){console.error("[GearRepository] saveOwnGear expects an array");return}this.memoryCache=t,await K.setItem(tc,t)}async addOwnGearItem(t){const r=await this.getOwnGear();r.push(t),await this.saveOwnGear(r)}getLibrary(){return typeof deviceLibrary<"u"?deviceLibrary:window.deviceLibrary?window.deviceLibrary:{}}async searchGear(t){if(!t)return[];const r=t.toLowerCase();return(await this.getOwnGear()).filter(i=>i.name&&i.name.toLowerCase().includes(r)||i.brand&&i.brand.toLowerCase().includes(r))}}const ru=new py;class nu{constructor(){this.root=null,this.initialized=!1}async init(){if(!this.initialized)try{if(!navigator.storage||!navigator.storage.getDirectory){console.warn("[DataVault] OPFS is not supported in this browser.");return}this.root=await navigator.storage.getDirectory(),this.initialized=!0}catch(t){console.error("[DataVault] Failed to initialize OPFS:",t)}}async saveSnapshot(t,r){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const n=t.replace(/[^a-z0-9_\-\.\s]/gi,"_"),i=await(await this.root.getFileHandle(n+".json",{create:!0})).createWritable();return await i.write(JSON.stringify(r)),await i.close(),console.log(`[DataVault] Saved snapshot: ${t}`),!0}catch(n){throw console.error(`[DataVault] Failed to save snapshot ${t}:`,n),n}}async listSnapshots(){if(this.initialized||await this.init(),!this.root)return[];const t=[];try{for await(const[r,n]of this.root.entries())n.kind==="file"&&r.endsWith(".json")&&t.push(r)}catch(r){console.error("[DataVault] Failed to list snapshots:",r)}return t.sort().reverse()}async restoreSnapshot(t){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const o=await(await(await this.root.getFileHandle(t)).getFile()).text();return JSON.parse(o)}catch(r){throw console.error(`[DataVault] Failed to restore snapshot ${t}:`,r),r}}async deleteSnapshot(t){if(this.initialized||await this.init(),!!this.root)try{await this.root.removeEntry(t),console.log(`[DataVault] Deleted snapshot: ${t}`)}catch(r){console.warn(`[DataVault] Failed to delete snapshot ${t}:`,r)}}async clear(){if(this.initialized||await this.init(),!!this.root)try{const t=await this.listSnapshots();for(const r of t)await this.root.removeEntry(r);console.log("[DataVault] All data wiped.")}catch(t){console.error("[DataVault] Failed to wipe vault:",t)}}}const ls=new nu,dy=Object.freeze(Object.defineProperty({__proto__:null,DataVault:nu,dataVault:ls},Symbol.toStringTag,{value:"Module"}));var $n={};console.log("DEBUG: storage.js execution started");let Mt={},gn=!1;async function rc(){if(!gn){console.log("[storage.js] Hydrating project cache from storage...");try{const e=await K.getKeys(),t="cameraPowerPlanner_project";let r=!1;const n=[];for(const i of e)if(!(i.startsWith("cine_")||i.startsWith("user_"))){if(i===ii){K.getItem(i).then(s=>{s&&(di=s)});continue}i===t?r=!0:n.push(i)}if(r)try{const i=await K.getItem(t);i&&typeof i=="object"&&Object.assign(Mt,i)}catch(i){console.warn("[hydrate] Failed to load monolith",i)}const o=n.map(async i=>{try{const s=await K.getItem(i);s&&(Mt[i]=s)}catch(s){console.warn("[hydrate] Failed to load shard",i,s)}});await Promise.all(o),gn=!0,console.log("[storage.js] Project cache hydrated. Keys:",Object.keys(Mt).length)}catch(e){console.warn("Cache hydration failed",e)}}}const h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:null,yy=typeof process<"u"&&process&&$n&&($n.JEST_WORKER_ID||$n.CINE_FORCE_STORAGE_REINIT),Ue="cine_factory_reset_lock";if(h&&h.__cineStorageInitialized)if(yy){try{delete h.__cineStorageInitialized}catch{h.__cineStorageInitialized=!1}try{delete h.__cineStorageApi}catch{h.__cineStorageApi=null}try{delete h.__cineMonolithicProjectCleanupDone}catch{h.__cineMonolithicProjectCleanupDone=!1}}else typeof module<"u"&&module.exports&&h.__cineStorageApi&&typeof h.__cineStorageApi=="object"&&(module.exports=h.__cineStorageApi);const gy="cine-power-planner-lifecycle";let je=null;const my=typeof process<"u"&&process&&$n&&$n.JEST_WORKER_ID;if(typeof BroadcastChannel<"u"&&!my)try{je=new BroadcastChannel(gy),je&&(je.onmessage=e=>{if(e&&e.data==="factory-reset"){if(h){h.__cameraPowerPlannerFactoryResetting=!0;try{typeof sessionStorage<"u"&&sessionStorage.setItem(Ue,"true"),typeof localStorage<"u"&&localStorage.setItem(Ue,"true")}catch(t){}if(typeof sessionStorage<"u"&&typeof sessionStorage.clear=="function")try{const t=sessionStorage.getItem(Ue);sessionStorage.clear(),t&&sessionStorage.setItem(Ue,t)}catch(t){}typeof h.location<"u"&&typeof h.location.reload=="function"&&h.location.reload()}}else e.data==="project-shards-changed"&&$t()})}catch{}if(h)try{const e=[typeof window<"u"?window:null,typeof sessionStorage<"u"?sessionStorage:null,typeof localStorage<"u"?localStorage:null];let t=!1;e.forEach(r=>{if(r&&typeof r.getItem=="function")try{r.getItem(Ue)&&(t=!0)}catch(n){}}),t&&(h.__cineJustFactoryReset=!0),e.forEach(r=>{if(r&&typeof r.removeItem=="function")try{r.removeItem(Ue)}catch(n){}}),Object.defineProperty(h,"__cineStorageInitialized",{configurable:!0,writable:!0,value:!0}),(async()=>{try{$r&&typeof $r.runMigrationIfNeeded=="function"?await $r.runMigrationIfNeeded()&&(console.log("[storage.js] Migration successful. Switching to IndexedDB."),K.switchDriver(new cs),rc()):$r&&typeof $r.init=="function"&&await $r.init()&&(K.switchDriver(new cs),rc())}catch(r){console.warn("[storage.js] Migration service failed:",r)}})()}catch{h.__cineStorageInitialized=!0}function hy(){if(je){try{je.close()}catch{}je=null}}typeof module<"u"&&module.exports&&(module.exports.closeStorageLifecycle=hy);function us(e,t){if(e===null||typeof e!="object")return e;let r=t;if(r||(r=typeof WeakMap=="function"?new WeakMap:[]),typeof r.has=="function"&&typeof r.get=="function"){if(r.has(e))return r.get(e)}else if(Array.isArray(r))for(let i=0;i<r.length;i+=1){const s=r[i];if(s&&s[0]===e)return s[1]}if(Object.prototype.toString.call(e)==="[object Date]"){let i;try{const s=typeof e.getTime=="function"?e.getTime():e.valueOf();i=new Date(s)}catch{i=new Date(e)}return typeof r.set=="function"?r.set(e,i):Array.isArray(r)&&r.push([e,i]),i}const o=Array.isArray(e)?[]:{};if(typeof r.set=="function"?r.set(e,o):Array.isArray(r)&&r.push([e,o]),Array.isArray(e))for(let i=0;i<e.length;i+=1)o[i]=us(e[i],r);else{const i=Object.keys(e);for(let s=0;s<i.length;s+=1){const a=i[s];o[a]=us(e[a],r)}}return o}function mr(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return us(e,null)}function by(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function Sy(e){const t=by(e);return t?function(n){if(n===null||typeof n!="object")return n;try{return t(n)}catch{}return mr(n)}:mr}const Jt=h&&typeof h.__cineDeepClone=="function"?h.__cineDeepClone:Sy(h),tn=typeof WeakSet=="function"?new WeakSet:null;function Nr(e){if(!(!tn||typeof tn.add!="function"||!e))try{tn.add(e)}catch{}}function oa(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.sessionStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}(function(){const t=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=oa(t[r]);n&&Nr(n)}if(typeof sessionStorage<"u")try{Nr(sessionStorage)}catch{}})();function Ey(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.localStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}function ou(){const e=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof globalThis<"u"?globalThis:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=[],r=typeof WeakSet=="function"?new WeakSet:null;for(let n=0;n<e.length;n+=1){const o=Ey(e[n]);if(o){if(r)try{if(r.has(o))continue;r.add(o)}catch{}else if(t.indexOf(o)!==-1)continue;t.push(o)}}return t}if(h&&typeof h.__cineDeepClone!="function")try{h.__cineDeepClone=Jt}catch{}function iu(){const e=r=>{if(!r||typeof r!="object"&&typeof r!="function")return!1;try{return r.__cameraPowerPlannerFactoryResetting===!0}catch{return!1}};if(e(h))return!0;const t=[typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&n!==h&&e(n))return!0}try{if(typeof sessionStorage<"u"&&sessionStorage.getItem(Ue)||typeof localStorage<"u"&&localStorage.getItem(Ue))return!0}catch{}return!1}var De="cameraPowerPlanner_devices",Co=null,Ye="cameraPowerPlanner_setups",lt="cameraPowerPlanner_session",Nt="cameraPowerPlanner_feedback",pe="cameraPowerPlanner_project",ki="cameraPowerPlanner_project_rev",zt="cameraPowerPlanner_favorites",Gt="cameraPowerPlanner_contacts",_n="cameraPowerPlanner_ownGear",lr="cameraPowerPlanner_userProfile",Tt="cameraPowerPlanner_documentationTracker",ft="cameraPowerPlanner_schemaCache",ia="cinePowerPlanner_schemaCache",zo="cameraPowerPlanner_customFonts",Go="cameraPowerPlanner_mountVoltages",mn="cameraPowerPlanner_cameraColors",qe="cineRentalPrintSections",ii="cameraPowerPlanner_projectIndex",Vn=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.mountVoltageKey"):null,Ze=null,ir=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.storageCache"):"__cineStorageStateCache",wt="cameraPowerPlanner_prj_",Jr=typeof WeakMap=="function"&&typeof Map=="function"?new WeakMap:null,gt=null,nc=!1,zr=typeof Map=="function"?new Map:null,Mn=[],wy=6,su=typeof Object.freeze=="function"?Object.freeze({__cineCompressionMiss:!0}):{__cineCompressionMiss:!0},oc=lu(8),ic=lu(6),ut=typeof Map=="function"?new Map:null,sr=[],Ay=16;function si(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.slice();for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n],i=e[o];t[o]=Array.isArray(i)?i.slice():i}return t}function au(e){if(!ut||typeof e!="string"||!e)return null;var t;try{t=ut.get(e)}catch{t=null}return!t||!t.payload?null:{payload:si(t.payload),compression:t.compression?si(t.compression):null}}function Bo(e,t,r){if(!(!ut||typeof e!="string"||!e||!Sn(t))){var n={payload:si(t),compression:r?si(r):null};try{ut.set(e,n)}catch{return}var o=sr.indexOf(e);for(o!==-1&&sr.splice(o,1),sr.push(e);sr.length>Ay;){var i=sr.shift();if(!(!i||i===e))try{ut.delete(i)}catch{}}}}function Oy(){if(ut&&typeof ut.clear=="function")try{ut.clear()}catch{}sr.length=0}var fs=Number.POSITIVE_INFINITY,ps=8,cu=60*1e3,Fn={entries:Object.create(null),totalWarnings:0,suppressionNoticeShown:!1},st=null,Xt=null,Vr=null,sc=!1;qd&&typeof oi=="function"&&(st=oi);var Bt="",At=!1;!st&&h&&typeof h.__cineEnsureConsoleMethodsWritable=="function"&&(st=h.__cineEnsureConsoleMethodsWritable);typeof st=="function"&&st(["warn","info"]);function Cy(){var e=[],t=function(n){!n||typeof n!="object"&&typeof n!="function"||e.indexOf(n)===-1&&e.push(n)};return t(h),t(typeof globalThis<"u"?globalThis:null),t(typeof window<"u"?window:null),t(typeof self<"u"?self:null),t(typeof global<"u"?global:null),e}function _y(){if(Xt)return Xt;if(Mr&&typeof Mr.resolveLogger=="function")return Xt=Mr,Xt;for(var e=Cy(),t=0;t<e.length;t+=1){var r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{var n=r.cineLoggingResolver;if(n&&typeof n.resolveLogger=="function")return Xt=n,Xt}catch{}}return Xt=null,Xt}function ky(){if(Vr||sc)return Vr;sc=!0;var e=_y();if(e&&typeof e.resolveLogger=="function")try{var t=e.resolveLogger("storage",{meta:{source:"storage-module"}});if(t)return Vr=t,Vr}catch{}return Vr=null,Vr}function Hr(e){if(!e)return null;if(typeof e=="string")return{message:e};var t={};if(typeof e.name=="string"&&e.name&&(t.name=e.name),typeof e.message=="string"&&e.message&&(t.message=e.message),typeof e.stack=="string"&&e.stack&&(t.stack=e.stack),!Object.keys(t).length)try{t.message=String(e)}catch{return null}return t}function tr(e){if(e&&typeof F<"u"&&F&&F.storage===e)return F&&typeof F.type=="string"?F.type:"unknown";if(e&&h){try{if(h.localStorage&&e===h.localStorage)return"local"}catch{}try{if(h.sessionStorage&&e===h.sessionStorage)return"session"}catch{}}return typeof F<"u"&&F&&typeof F.type=="string"?F.type:"unknown"}function rr(e,t,r,n,o){var i=typeof e=="string"&&e?e.toLowerCase():"info",s=typeof t=="string"&&t?t:"Storage event",a=ky(),c=!1,u={module:"storage"};if(n&&typeof n=="object"){u={module:"storage"};for(var f=Object.keys(n),l=0;l<f.length;l+=1){var y=f[l];u[y]=n[y]}}if(a){if(typeof a[i]=="function")try{a[i](s,r,u),c=!0}catch{c=!1}else if(typeof a.log=="function")try{a.log(i,s,r,u),c=!0}catch{c=!1}}if(typeof o=="function"){try{o()}catch{}return c}if(typeof console>"u"||!console)return c;var p=null;if(i==="error"&&typeof console.error=="function"?p=console.error:i==="warn"&&typeof console.warn=="function"?p=console.warn:i==="info"&&typeof console.info=="function"?p=console.info:i==="debug"&&typeof console.debug=="function"?p=console.debug:typeof console.log=="function"&&(p=console.log),typeof p=="function")try{p.call(console,s,r||null)}catch{}return c}function Py(){if(typeof Date>"u")return null;if(typeof Date.now=="function")return Date.now();try{return new Date().getTime()}catch{}return null}function Pi(e,t,r,n,o){var i=typeof e=="string"&&e?e:"generic",s=null;if(typeof t=="string"&&t)s=t;else if(t!=null)try{s=String(t)}catch{s=null}var a={event:"compression-savings",kind:i,key:s,storageType:tr()};typeof n=="number"&&Number.isFinite(n)&&(a.savings=n),typeof o=="number"&&Number.isFinite(o)&&(a.percent=o);var c=function(){if(!(typeof console>"u")){var f=Fn,l=f.entries[i],y=Py();if(l||(l={kind:i,occurrences:0,totalSavings:0,lastPercent:null,lastKey:null,uniqueKeys:Object.create(null),uniqueKeyCount:0,firstLoggedAt:y,lastLoggedAt:y,lastSummaryAt:null,suppressedTotal:0,suppressedSinceSummary:0},f.entries[i]=l),l.occurrences+=1,l.lastLoggedAt=y,s&&(l.lastKey=s,l.uniqueKeys[s]||(l.uniqueKeys[s]=!0,l.uniqueKeyCount+=1)),typeof n=="number"&&Number.isFinite(n)&&(l.totalSavings+=n),typeof o=="number"&&Number.isFinite(o)&&(l.lastPercent=o),f.totalWarnings<fs){typeof st=="function"&&st("warn"),typeof console.warn=="function"&&r&&console.warn(r),f.totalWarnings+=1;return}l.suppressedTotal+=1,l.suppressedSinceSummary+=1,!f.suppressionNoticeShown&&typeof console.info=="function"&&(typeof st=="function"&&st("info"),console.info("Additional storage compression warnings are being batched to keep diagnostics readable.",{limit:fs,batchSize:ps}),f.suppressionNoticeShown=!0);var p=!1;l.lastSummaryAt?(l.suppressedSinceSummary>=ps||y!==null&&l.lastSummaryAt!==null&&l.suppressedSinceSummary>0&&y-l.lastSummaryAt>=cu)&&(p=!0):p=!0,p&&typeof console.info=="function"&&(typeof st=="function"&&st("info"),console.info("Suppressed repeated storage compression warnings.",{kind:l.kind,mostRecentKey:l.lastKey,suppressedSinceSummary:l.suppressedSinceSummary,suppressedTotal:l.suppressedTotal,totalOccurrences:l.occurrences,totalSavings:l.totalSavings,lastPercent:l.lastPercent,uniqueKeys:l.uniqueKeyCount}),l.lastSummaryAt=y,l.suppressedSinceSummary=0)}};rr("info",r,a,{event:"compression-savings",kind:i},c)}function jy(){for(var e={},t=Object.keys(Fn.entries),r=0;r<t.length;r+=1){var n=t[r],o=Fn.entries[n];o&&(e[n]={kind:o.kind,occurrences:o.occurrences,totalSavings:o.totalSavings,lastPercent:o.lastPercent,lastKey:o.lastKey,uniqueKeyCount:o.uniqueKeyCount,firstLoggedAt:o.firstLoggedAt,lastLoggedAt:o.lastLoggedAt,lastSummaryAt:o.lastSummaryAt,suppressedTotal:o.suppressedTotal})}return{limit:fs,batchSize:ps,summaryWindowMs:cu,totalWarnings:Fn.totalWarnings,suppressionNoticeShown:Fn.suppressionNoticeShown,entries:e}}function vy(e){if(!Array.isArray(e)||!e.length)return null;for(var t=[],r=0;r<e.length;r+=1){var n=e[r]||{},o=typeof n.variant=="string"?n.variant:"",i=typeof n.compress=="string"?n.compress:"",s=typeof n.decompress=="string"?n.decompress:"";t.push(o+":"+i+":"+s)}return t.join("|")}function Iy(e,t){if(!zr||!e)return null;var r;try{r=zr.get(e)}catch{r=null}return!r||r.lz!==t?null:!Array.isArray(r.strategies)||!r.strategies.length?Array.isArray(r.strategies)?[]:null:r.strategies.slice()}function Ry(e){if(!(!zr||!e)){var t=Mn.indexOf(e);for(t!==-1&&Mn.splice(t,1),Mn.push(e);Mn.length>wy;){var r=Mn.shift();if(typeof zr.delete=="function")try{zr.delete(r)}catch{}}}}function Ty(e,t,r){if(!(!zr||!e)){var n={lz:t,strategies:Array.isArray(r)?r.slice():[]};try{zr.set(e,n),Ry(e)}catch{}}}function Ly(){if(typeof JSON>"u"||!JSON||typeof JSON.stringify!="function")return 0;try{var e={[_t]:!0,version:ai,algorithm:io,namespace:Fr,data:"",originalLength:0,compressedPayloadLength:0,compressionVariant:""},t=JSON.stringify(e);if(typeof t!="string"||!t)return 0;var r=JSON.stringify("").length;return r>0?t.length-r*2-String(0).length*2:0}catch{}return 0}function lu(e){if(typeof Map!="function")return null;var t=Number(e);return t>0?{map:new Map,keys:[],limit:Math.floor(t)}:null}function uu(e){if(!e||typeof e!="object")return null;for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1)t[r[n]]=e[r[n]];return t}function fu(e,t){if(!(!e||!Array.isArray(e.keys))){var r=e.keys.indexOf(t);r!==-1&&e.keys.splice(r,1),e.keys.push(t)}}function pu(e,t){if(!e||!e.map||typeof e.map.get!="function")return{hit:!1};if(typeof t!="string"||!t)return{hit:!1};var r;try{r=e.map.get(t)}catch{return{hit:!1}}if(r===void 0)return{hit:!1};if(fu(e,t),r===su)return{hit:!0,candidate:null};var n=uu(r);return n?{hit:!0,candidate:n}:{hit:!0,candidate:null}}function du(e,t,r){if(!(!e||!e.map||typeof e.map.set!="function")&&!(typeof t!="string"||!t)&&!(!e.limit||e.limit<=0)){var n=r&&typeof r=="object"?uu(r):su;try{e.map.set(t,n)}catch{return}for(fu(e,t);e.keys.length>e.limit;){var o=e.keys.shift();if(!(typeof o!="string"||o===t))try{e.map.delete(o)}catch{}}}}function sa(e,t){if(!e||typeof e!="object"&&typeof e!="function")return null;let r=null;if(ir)try{r=e[ir]}catch{r=null}if(!r&&Jr)try{r=Jr.get(e)||null}catch{r=null}if(r||!t)return r||null;const n=new Map;let o=!1;if(ir)try{Object.defineProperty(e,ir,{configurable:!0,writable:!0,value:n}),o=!0}catch{try{e[ir]=n,o=!0}catch{o=!1}}if(!o&&Jr)try{Jr.set(e,n),o=!0}catch{o=!1}return o?n:null}function My(e,t){const r=sa(e,!1);return!r||typeof t!="string"||!t?null:r.get(t)||null}function Lt(e,t){const r=sa(e,!1);if(!(!r||typeof t!="string"||!t)&&(typeof r.delete=="function"&&r.delete(t),r.size===0)){if(ir)try{e&&(typeof e=="object"||typeof e=="function")&&Object.prototype.hasOwnProperty.call(e,ir)&&delete e[ir]}catch{}if(Jr)try{Jr.delete(e)}catch{}}}function yu(e){if(e===null||typeof e!="object")return e;try{return Jt(e)}catch{}return e}function $i(e){if(!e)return;const{value:t}=e;return t===null||typeof t!="object"?t:yu(t)}function hn(e,t){const r=new Map;if(!e||typeof e.forEach!="function")return r;const{freezeArray:n=!1}=t||{};return e.forEach((o,i)=>{if(Array.isArray(o)){const s=o.slice();if(n)try{Object.freeze(s)}catch{}r.set(i,s)}else r.set(i,o)}),r}function gu(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:hn(e.raw),normalized:hn(e.normalized)}}function Ny(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:hn(e.raw),normalized:hn(e.normalized,{freezeArray:!0})}}function zy(e){if(!w(e))return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n],i=e[o];if(i&&typeof i=="object")try{Object.freeze(i)}catch{}t[o]=i}try{Object.freeze(t)}catch{}return t}function ac(e){if(!e||typeof e!="object"){Ze=null;return}Ze={projects:zy(e.projects),changed:!!e.changed,originalValue:e.originalValue,lookup:Ny(e.lookup),rawValue:e.rawValue===void 0?void 0:e.rawValue}}function Gy(e){if(!Ze)return null;const t=T();let r=null;if(t&&typeof t.getItem=="function")try{r=t.getItem(pe)}catch{r=null}if(Ze.rawValue!==void 0&&Ze.rawValue!==r)return Ze=null,null;const{forMutation:n=!1}=e||{};return{projects:n?Jt(Ze.projects):Ze.projects,changed:Ze.changed,originalValue:Ze.originalValue,lookup:gu(Ze.lookup)}}function $t(){Ze=null}function By(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}return null}function xy(){return ki}function mu(e){const t=e||T();if(!t||typeof t.getItem!="function")return null;const r=Le(t,ki,"Error reading project storage revision from localStorage:",null,{validate:n=>n===null||typeof n=="number"||typeof n=="string"});return By(r)}function aa(e){const t=e||T();if(!t||typeof t.setItem!="function")return null;const r=mu(t),n=Number.isFinite(r)?r+1:1;return ke(t,ki,n,"Error saving project storage revision to localStorage:",{disableCompression:!0,enableCompressionSweep:!1}),n}function xe(e,t,r,n,o){if(typeof t!="string"||!t||!e||typeof e!="object"&&typeof e!="function")return;const i=sa(e,!0);if(!i)return;const s=yu(o),c={raw:typeof r=="string"&&r?r:null,normalizedRaw:typeof n=="string"&&n?n:typeof r=="string"&&r?r:null,value:s};i.set(t,c)}function Fy(e,t,r,n){const o=My(e,t);if(!o)return{hit:!1};if(typeof n=="string"&&n&&o.raw&&o.raw===n)return{hit:!0,value:$i(o)};if(typeof r=="string"&&r){if(o.normalizedRaw&&o.normalizedRaw===r)return{hit:!0,value:$i(o)};if(o.raw&&o.raw===r)return{hit:!0,value:$i(o)}}return{hit:!1}}function Uy(e,t){if(!e||typeof e!="object")return"";var r;try{r=Object.getOwnPropertyDescriptor(e,t)}catch{r=null}if(r&&Object.prototype.hasOwnProperty.call(r,"value")&&typeof r.value=="string"&&r.value)return r.value;var n;try{n=e[t]}catch{n=""}if(typeof n=="string"&&n)return n;if(Vn)try{const o=e[Vn];if(typeof o=="string"&&o)return o}catch{}return""}function hu(e,t,r){if(!e||typeof e!="object")return"";if(Vn)try{e[Vn]=r;const i=e[Vn];if(typeof i=="string"&&i)return i}catch{}var n;try{n=Object.getOwnPropertyDescriptor(e,t)}catch{n=null}if(n&&Object.prototype.hasOwnProperty.call(n,"value")&&typeof n.value=="string"&&n.value)return n.value;if(n&&n.configurable===!1&&n.writable===!1)return"";var o="";try{e[t]=r,o=e[t]}catch{o=""}return typeof o=="string"&&o?o:(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose mount voltage storage key globally. Using fallback only."),"")}function bu(){if(!h||typeof h!="object")return Go;var e=Uy(h,"MOUNT_VOLTAGE_STORAGE_KEY");if(e)return e;var t=hu(h,"MOUNT_VOLTAGE_STORAGE_KEY",Go);return t||Go}var xo=bu();function Su(){const e=bu();if(e&&e!==xo&&(xo=e,h&&hu(h,"MOUNT_VOLTAGE_STORAGE_KEY",e),typeof ht<"u"&&ht&&typeof ht.add=="function")){ht.add(e);const t=dt(e);for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&ht.add(n)}}return xo}function go(){return Su()}function Eu(){const e=Su();return e?`${e}__backup`:`${Go}__backup`}function wu(){if(!h)return zo;const e=typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:typeof h.CUSTOM_FONT_STORAGE_KEY=="string"?h.CUSTOM_FONT_STORAGE_KEY:zo;let t=e;return e==="cinePowerPlanner_customFonts"&&(t=zo),h.CUSTOM_FONT_STORAGE_KEY!==t&&(h.CUSTOM_FONT_STORAGE_KEY=t),h.CUSTOM_FONT_STORAGE_KEY_NAME!==t&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=t),t}function hr(){return h&&typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:wu()}wu();var Vt="customLogo",cc="cameraPowerPlanner_temperatureUnit",lc="cameraPowerPlanner_focusScale";function Dy(){if(!h)return cc;const e=typeof h.TEMPERATURE_UNIT_STORAGE_KEY=="string"?h.TEMPERATURE_UNIT_STORAGE_KEY:cc;if(h.TEMPERATURE_UNIT_STORAGE_KEY!==e)try{h.TEMPERATURE_UNIT_STORAGE_KEY=e}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign temperature unit storage key globally.",t);try{Object.defineProperty(h,"TEMPERATURE_UNIT_STORAGE_KEY",{configurable:!0,writable:!0,value:e})}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose temperature unit storage key globally.",r)}}return e}var bn=Dy(),ro=(function(){if(!h)return lc;const t=typeof h.FOCUS_SCALE_STORAGE_KEY=="string"?h.FOCUS_SCALE_STORAGE_KEY:lc;if(h.FOCUS_SCALE_STORAGE_KEY!==t)try{h.FOCUS_SCALE_STORAGE_KEY=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign focus scale storage key globally.",r)}if(h.FOCUS_SCALE_STORAGE_KEY_NAME!==t)try{h.FOCUS_SCALE_STORAGE_KEY_NAME=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose focus scale storage key globally.",r)}return t})(),br="cameraPowerPlanner_autoGearRules",Ur="cameraPowerPlanner_autoGearSeeded",Wt="cameraPowerPlanner_autoGearBackups",qt="cameraPowerPlanner_autoGearPresets",Sr="cameraPowerPlanner_autoGearMonitorDefaults",Er="cameraPowerPlanner_autoGearActivePreset",xt="cameraPowerPlanner_autoGearAutoPreset",Dr="cameraPowerPlanner_autoGearShowBackups",wr="cameraPowerPlanner_autoGearBackupRetention",ur="cameraPowerPlanner_fullBackups",Be="auto-backup-",pt="auto-backup-before-delete-",Gr="__cineAutoBackupRenamed",no="__cineAutoBackupMetadata",rn="__cineAutoBackupSnapshot",Br=1,ca="__cineAutoBackupCompressedPayload",Au="__cineCircular__",dr=new Map,Vi=typeof Set=="function"?new Set:null,Ky=2048;function Ct(e){return typeof e=="string"&&(e.startsWith(Be)||e.startsWith(pt))}if(h&&typeof h=="object")try{Object.prototype.hasOwnProperty.call(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG")||Object.defineProperty(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG",{configurable:!0,writable:!1,value:Gr})}catch{try{h.__CINE_AUTO_BACKUP_RENAMED_FLAG=Gr}catch{}}var Qr=240,uc=20,Ou=36,et=1,$y=120;function Vy(){if(!(!h||typeof h!="object")){if(typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=Ou}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention default globally.",e)}if(typeof h.AUTO_GEAR_BACKUP_RETENTION_MIN!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_MIN=et}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention minimum globally.",e)}}}Vy();function Wy(e){return!e||typeof e!="object"?null:{version:Number.isFinite(e.version)?e.version:Br,snapshotType:e.snapshotType==="delta"?"delta":"full",base:typeof e.base=="string"?e.base:null,sequence:Number.isFinite(e.sequence)?e.sequence:e.snapshotType==="delta"?1:0,createdAt:typeof e.createdAt=="string"?e.createdAt:null,changedKeys:Array.isArray(e.changedKeys)?e.changedKeys.slice():[],removedKeys:Array.isArray(e.removedKeys)?e.removedKeys.slice():[],payloadSignature:typeof e.payloadSignature=="string"?e.payloadSignature:null,payloadCompression:w(e.payloadCompression)?{...e.payloadCompression}:null,compressedPayload:w(e.compressedPayload)?he(e.compressedPayload,{stripMetadata:!0}):e.compressedPayload&&typeof e.compressedPayload=="string"?e.compressedPayload:null}}function Wn(e,t){if(!e||typeof e!="object")return;const r=Wy(t);try{Object.defineProperty(e,no,{configurable:!0,enumerable:!1,writable:!0,value:r})}catch{try{e[no]=r}catch{}}}function oo(e){if(!e||typeof e!="object")return null;const t=e[no];return!t||typeof t!="object"?null:t}function qy(e,t){if(!t||typeof t!="object")return;const r=oo(e);r&&Wn(t,r)}function he(e,t,r){const n=t||{},o=r||(typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),i=(s,a)=>{if(!o||!o.stack)return a();if(o.stack.has(s)){if(!o.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function")try{console.warn("Detected circular reference while cloning automatic backup data. Using a placeholder to keep serialization stable.")}catch{}return o&&(o.reportedCycle=!0),Au}o.stack.add(s);try{return a()}finally{o.stack.delete(s)}};return e===null||typeof e!="object"?e:e instanceof Date?new Date(e.getTime()):Array.isArray(e)?i(e,()=>e.map(s=>he(s,n,o))):i(e,()=>{const s={};if(Object.keys(e).forEach(a=>{n.stripMetadata&&a===no||(s[a]=he(e[a],n,o))}),!n.stripMetadata){const a=oo(e);a&&Wn(s,a)}return s})}function ds(e,t){const n=he(e,t,typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),o=fe(n);return o!==n?o:n}function Sn(e){return!w(e)||e[ca]!==!0?!1:typeof e.data=="string"&&e.data}function Wi(e,t,r){if(!e||typeof e!="object")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:null};const n=r||{};if(n.disableCompression)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:typeof n.payloadSignature=="string"?n.payloadSignature:null};const o=n.reportCompression!==!1;let i=null;try{i=typeof n.payloadSignature=="string"?n.payloadSignature:Ce(e)}catch(y){i=null,console.warn("Unable to compute stable signature for automatic backup payload before compression",y)}const s=typeof n.existingPayloadSignature=="string"?n.existingPayloadSignature:null;if(s&&i&&s===i&&Sn(n.existingCompressedPayload)){const y=he(n.existingCompressedPayload,{stripMetadata:!0}),p=w(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null;return!n.disableCompression&&typeof i=="string"&&i&&Bo(i,y,p),{payload:y,compression:p,compressed:!0,reused:!0,payloadSignature:i}}if(!n.disableCompression&&typeof i=="string"&&i){const y=au(i);if(y&&y.payload)return{payload:y.payload,compression:y.compression,compressed:!0,reused:!0,payloadSignature:i}}let a;try{a=JSON.stringify(e)}catch(y){return console.warn("Unable to serialize auto backup payload before compression",y),{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i}}if(typeof a!="string"||a.length<Ky)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};if(!n.disableCompression&&Sn(n.existingCompressedPayload)){const y=mo(n.existingCompressedPayload.data);if(y.success&&typeof y.value=="string"&&y.value===a){const p=he(n.existingCompressedPayload,{stripMetadata:!0}),d=w(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null,g=typeof i=="string"&&i?i:typeof s=="string"&&s?s:null;return g&&Bo(g,p,d),{payload:p,compression:d,compressed:!0,reused:!0,payloadSignature:g}}}const c=En(a);if(!c||typeof c.serialized!="string")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};const u=c.originalLength-c.wrappedLength,f={[ca]:!0,data:c.serialized,originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},l=typeof c.originalLength=="number"&&Number.isFinite(c.originalLength)&&typeof c.wrappedLength=="number"&&Number.isFinite(c.wrappedLength)?{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null}:null;if(!n.disableCompression&&typeof i=="string"&&i&&Bo(i,f,l),o&&typeof console<"u"&&typeof console.warn=="function"&&u>0){const y=typeof t=="string"&&t?`"${t}"`:"an automatic backup",p=c.originalLength>0?Math.round(u/c.originalLength*100):0,d=`Stored compressed payload for ${y} snapshot to reduce storage usage by ${u} characters (${p}%).`;Pi("auto-backup",t||y,d,u,p)}return{payload:f,compression:{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},compressed:!0,reused:!1,payloadSignature:i}}function ys(e,t){if(!e||typeof e!="object")return{payload:e,compressed:!1};const r=e.payload;if(!Sn(r))return{payload:r,compressed:!1};const n=mo(r.data);if(!n.success||typeof n.value!="string"){const o=n&&n.error?n.error:null;throw console.warn("Unable to decompress automatic backup payload.",t,o),new Error("Failed to decompress automatic backup payload")}try{return{payload:JSON.parse(n.value),compressed:!0}}catch(o){throw console.warn("Unable to parse decompressed automatic backup payload.",t,o),o}}function qn(e,t){const r=da(e);if(r&&Number.isFinite(r.timestamp)&&r.timestamp>0)try{return new Date(r.timestamp).toISOString()}catch{}const n=t instanceof Date?t:new Date;try{return n.toISOString()}catch{return new Date().toISOString()}}function Hy(e,t,r){if(!w(e)||!r||r.snapshotType!=="delta")return{cycle:!1,path:[]};const n=new Set,o=[],i=Math.max(10,Object.keys(e).length+5);let s=0,a=t,c=r;for(;c&&c.snapshotType==="delta";){if(s>i)return{cycle:!0,path:o};const u=typeof c.base=="string"?c.base:null;if(!u)return{cycle:!1,path:o};if(!Ct(u))return{cycle:!1,path:o};if(n.has(u))return o.push(u),{cycle:!0,path:o};n.add(a),o.push(a);const f=Object.prototype.hasOwnProperty.call(e,u)?e[u]:null;if(!w(f))return{cycle:!1,path:o};if(a=u,c=oo(f),!c)return{cycle:!1,path:o};s+=1}return{cycle:!1,path:o}}function Yy(e,t,r){if(!e||typeof e!="object")return;e.snapshotType="full",e.base=null,e.sequence=0,e.removedKeys=[];const n=w(r)?Object.keys(r):[];e.changedKeys=n.slice(),(typeof e.createdAt!="string"||!e.createdAt)&&(e.createdAt=qn(t))}function Cu(e,t){if(!w(e))return e;const r={},n=new Map,o=t||{},i=typeof o.isAutoBackupKey=="function"?o.isAutoBackupKey:Ct,s=typeof o.filter=="function"?o.filter:null,a=s?u=>{let f=!1;try{f=s(u)}catch{f=!1}return f}:()=>!0,c=(u,f)=>{if(n.has(u))return n.get(u);const l=e[u],y=Ii(l,u),p=y.restored?y.value:l;if(!w(p)){const m=he(p);return n.set(u,m),m}const d=p[rn];if(d&&typeof d=="object"){if(f.has(u)){console.warn("Detected cyclic auto-backup reference while expanding snapshot",u);let E={},R=[],x=null;try{const N=ys(d,u);if(N&&w(N.payload)){E=he(N.payload),R=Object.keys(N.payload);try{x=Ce(N.payload)}catch(M){x=null,console.warn("Unable to compute stable signature for automatic backup payload after detecting a cycle",M)}}}catch(N){console.warn("Failed to restore automatic backup payload after detecting a cyclic reference",u,N)}const L={version:Number.isFinite(d.version)?d.version:Br,snapshotType:"full",base:null,sequence:Number.isFinite(d.sequence)?d.sequence:0,createdAt:typeof d.createdAt=="string"?d.createdAt:qn(u),changedKeys:R.slice(),removedKeys:[],payloadSignature:x};return Sn(d.payload)?(L.compressedPayload=he(d.payload,{stripMetadata:!0}),L.payloadCompression=w(d.payloadCompression)?{...d.payloadCompression}:null):(L.compressedPayload=null,L.payloadCompression=null),Wn(E,L),n.set(u,E),E}f.add(u);const m=d.snapshotType==="delta"?"delta":"full",b=m==="delta"&&typeof d.base=="string"?d.base:null,O=b?he(c(b,f)):{};let A;try{A=ys(d,u)}catch(E){throw console.warn("Failed to restore automatic backup payload while expanding snapshot",u,E),E}const C=w(A.payload)?A.payload:{},_=Array.isArray(d.changedKeys)&&d.changedKeys.length?d.changedKeys:Object.keys(C),k=Array.isArray(d.removedKeys)?d.removedKeys:[],j=he(O);_.forEach(E=>{Object.prototype.hasOwnProperty.call(C,E)&&j&&(j[E]=he(C[E]))}),k.forEach(E=>{Object.prototype.hasOwnProperty.call(j,E)&&delete j[E]});const S={version:Number.isFinite(d.version)?d.version:Br,snapshotType:m,base:m==="delta"?b:null,sequence:Number.isFinite(d.sequence)?d.sequence:m==="delta"?1:0,createdAt:typeof d.createdAt=="string"?d.createdAt:qn(u),changedKeys:_.slice(),removedKeys:k.slice()};try{S.payloadSignature=Ce(C)}catch(E){S.payloadSignature=null,console.warn("Unable to compute stable signature for automatic backup payload during expansion",E)}return Sn(d.payload)?(S.compressedPayload=he(d.payload,{stripMetadata:!0}),S.payloadCompression=w(d.payloadCompression)?{...d.payloadCompression}:null):(S.compressedPayload=null,S.payloadCompression=null),Wn(j,S),n.set(u,j),f.delete(u),j}const g=he(p);if(i(u)){const m={version:Br,snapshotType:"full",base:null,sequence:0,createdAt:qn(u),changedKeys:Object.keys(g),removedKeys:[]};Wn(g,m)}return n.set(u,g),g};return Object.keys(e).forEach(u=>{if(a(u)){if(!i(u)){const f=e[u];r[u]=w(f)?he(f):f;return}r[u]=c(u,new Set)}}),r}function Jy(e,t){const r={},n=[],o=[],i=w(t)?Object.keys(t):[],s=w(e)?Object.keys(e):[];return new Set([...i,...s]).forEach(c=>{if(c===no)return;const u=Object.prototype.hasOwnProperty.call(e||{},c),f=Object.prototype.hasOwnProperty.call(t||{},c);if(!u&&f){o.push(c);return}if(!u)return;const l=e?e[c]:void 0,y=f?t[c]:void 0,p=Ce(l),d=Ce(y);p!==d&&(n.push(c),r[c]=he(l,{stripMetadata:!0}))}),{payload:r,changedKeys:n,removedKeys:o}}function _u(e,t){if(!w(e))return e;const r=t||{},n=typeof r.isAutoBackupKey=="function"?r.isAutoBackupKey:Ct,o={},i=Object.keys(e),s=(()=>{const a=new Map;i.forEach(u=>{if(!n(u))return;const f=e[u],l=oo(f);let y=Number.NEGATIVE_INFINITY;if(l&&typeof l.createdAt=="string"){const g=Date.parse(l.createdAt);Number.isNaN(g)||(y=g)}if(!Number.isFinite(y)){const g=da(u);g&&Number.isFinite(g.timestamp)&&(y=g.timestamp)}const p=u.startsWith(pt)?pt:Be,d=a.get(p);(!d||y>d.timestamp||y===d.timestamp&&u.localeCompare(d.name)>0)&&a.set(p,{name:u,timestamp:y})});const c=new Set;return a.forEach(({name:u})=>{typeof u=="string"&&u&&c.add(u)}),c})();return i.forEach(a=>{const c=e[a],u=ds(c,{stripMetadata:!0});if(!n(a)||!w(u)){o[a]=u;return}const f=s.has(a),l=oo(c);l&&l.snapshotType==="delta"&&Hy(e,a,l).cycle&&(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Detected cyclic automatic backup chain during serialization. Promoting to full snapshot.",a),Yy(l,a,u));const y=l&&typeof l.createdAt=="string"?l.createdAt:qn(a);if(!l||l.snapshotType!=="delta"){o[a]={};const C={version:Br,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(u||{}),removedKeys:[]};let _;try{_=Ce(u)}catch(j){_=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",j)}const k=Wi(u,a,{disableCompression:f,payloadSignature:_,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(C.payload=k.payload,k.compression&&(C.payloadCompression=k.compression),l){const j=typeof k.payloadSignature=="string"?k.payloadSignature:_;l.payloadSignature=j||null,k.compressed?(l.compressedPayload=he(k.payload,{stripMetadata:!0}),l.payloadCompression=k.compression?{...k.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][rn]=C;return}const p=typeof l.base=="string"?l.base:null,d=p&&Object.prototype.hasOwnProperty.call(e,p)?e[p]:null;if(!d||!w(d)){o[a]={};const C={version:Br,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(u||{}),removedKeys:[]};let _;try{_=Ce(u)}catch(j){_=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",j)}const k=Wi(u,a,{disableCompression:f,payloadSignature:_,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(C.payload=k.payload,k.compression&&(C.payloadCompression=k.compression),l){const j=typeof k.payloadSignature=="string"?k.payloadSignature:_;l.payloadSignature=j||null,k.compressed?(l.compressedPayload=he(k.payload,{stripMetadata:!0}),l.payloadCompression=k.compression?{...k.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][rn]=C;return}const g=ds(d,{stripMetadata:!0}),m=Jy(u,g);o[a]={};const b={version:Number.isFinite(l.version)?l.version:Br,snapshotType:"delta",base:p,sequence:Number.isFinite(l.sequence)?l.sequence:1,createdAt:y,changedKeys:m.changedKeys,removedKeys:m.removedKeys};let O;try{O=Ce(m.payload)}catch(C){O=null,console.warn("Unable to compute stable signature for automatic backup delta payload before serialization",C)}const A=Wi(m.payload,a,{disableCompression:f,payloadSignature:O,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(b.payload=A.payload,A.compression&&(b.payloadCompression=A.compression),l){const C=typeof A.payloadSignature=="string"?A.payloadSignature:O;l.payloadSignature=C||null,A.compressed?(l.compressedPayload=he(A.payload,{stripMetadata:!0}),l.payloadCompression=A.compression?{...A.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][rn]=b}),o}function dt(e){if(typeof e!="string"||!e)return[e];const t=new Set([e]);return e.startsWith("cameraPowerPlanner_")?t.add(`cinePowerPlanner_${e.slice(19)}`):e.startsWith("cinePowerPlanner_")&&t.add(`cameraPowerPlanner_${e.slice(17)}`),Array.from(t)}var nn=new Set(dt(Ye));function Qy(){return(!Co||typeof Co.has!="function")&&(Co=new Set(dt(De))),Co}function ku(e){if(typeof e!="string"||!e)return!1;const t=Qy();return t&&typeof t.has=="function"?t.has(e):e===De}function Xy(e){return!(typeof e!="string"||!e||!nn||typeof nn.has!="function"||!nn.has(e)||At)}function Zy(e,t){if(!e||typeof e.getItem!="function"||!nn||typeof nn.forEach!="function")return;const r=new Set,n=t&&typeof t.has=="function"?t:null;nn.forEach(o=>{if(!(typeof o!="string"||!o||r.has(o))&&(r.add(o),!(n&&n.has(o))))try{e.getItem(o)}catch{}})}var de="__backup",eg=3,tg=100,_r="__legacyMigrationBackup",ht=new Set([hr(),Vt,ft,Gt,_n,Tt,xo,ro,qe]);Array.from(ht).forEach(e=>{dt(e).forEach(t=>{typeof t=="string"&&t&&ht.add(t)})});var fc=[()=>({key:De}),()=>({key:Ye}),()=>({key:lt}),()=>({key:Nt}),()=>({key:pe,valueProvider:()=>{if(typeof yt=="function")try{const{projects:e}=yt({forMutation:!1});if(e&&typeof e=="object")return JSON.stringify(e)}catch(e){typeof console<"u"&&console.warn&&console.warn("Failed to reconstruct monolithic project backup",e)}return null}}),()=>({key:zt}),()=>({key:Gt}),()=>({key:_n}),()=>({key:Tt}),()=>({key:ft}),()=>({key:br}),()=>({key:Ur}),()=>({key:Wt}),()=>({key:qt}),()=>({key:Er}),()=>({key:xt}),()=>({key:Dr}),()=>({key:wr}),()=>({key:Sr}),()=>({key:ur}),()=>({key:Vt}),()=>({key:hr()}),()=>({key:"darkMode"}),()=>({key:"pinkMode"}),()=>({key:"highContrast"}),()=>({key:"reduceMotion"}),()=>({key:"relaxedSpacing"}),()=>({key:"showAutoBackups"}),()=>({key:"accentColor"}),()=>({key:"fontSize"}),()=>({key:"fontFamily"}),()=>({key:"language"}),()=>({key:"iosPwaHelpShown"}),()=>({key:qe}),()=>({key:bn}),()=>({key:go(),backupKey:Eu()})];function rg(e,t={}){if(!e||typeof e!="object")return null;const{key:r,backupKey:n,storage:o=null}=e;if(typeof r!="string"||!r)return null;const i=typeof n=="string"&&n?n:`${r}${de}`;return{key:r,backupKey:i,storage:o,label:typeof t.label=="string"?t.label:r,valueProvider:typeof e.valueProvider=="function"?e.valueProvider:null}}function ng(e={}){const t=[],r=new Set,n=i=>{if(!i)return;const s=dt(i.key),a=`${i.key}${de}`;for(let c=0;c<s.length;c+=1){const u=s[c];if(typeof u!="string"||!u)continue;let f=i.backupKey;u!==i.key&&i.backupKey===a&&(f=`${u}${de}`);const l=u===i.key?i:{...i,key:u,backupKey:f},y=l.storage||null,p=`${l.key}__${y?String(y):"default"}`;r.has(p)||(r.add(p),t.push(l))}};for(let i=0;i<fc.length;i+=1){const s=fc[i];if(typeof s!="function")continue;let a;try{a=s(e)}catch(u){var o={event:"critical-storage",action:"collect-keys",reason:"provider-error",storageType:tr(e&&e.storage?e.storage:null),error:Hr(u)};rr("warn","Critical storage key provider failed",o,{event:"critical-storage",stage:"gather"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage key provider failed",u)});continue}const c=rg(a,e);c&&n(c)}return t}let Pu=null;function og(e){if(Pu=e,!(!h||typeof h!="object"))try{h.__cineCriticalStorageGuard=e}catch{try{Object.defineProperty(h,"__cineCriticalStorageGuard",{configurable:!0,writable:!0,value:e})}catch{}}}function ig(e={}){let t=e&&e.storage?e.storage:null;if(!t)try{t=T()}catch(f){var r={event:"critical-storage",action:"resolve-storage",reason:"resolve-failed",storageType:tr(e&&e.storage?e.storage:null),error:Hr(f)};rr("warn","Unable to resolve safe storage while ensuring backups",r,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve safe storage while ensuring backups",f)}),t=null}const n={ensured:[],skipped:[],errors:[],timestamp:new Date().toISOString(),storageType:F&&F.type?F.type:"unknown"},o=ng(e),i=t&&typeof t.getItem=="function"?t:null;for(let f=0;f<o.length;f+=1){const l=o[f],y=l.storage&&typeof l.storage.getItem=="function"?l.storage:i;if(!y||typeof y.getItem!="function"||typeof y.setItem!="function"){n.skipped.push({key:l.key,reason:"unavailable-storage"});continue}let p;try{l.valueProvider?p=l.valueProvider():p=y.getItem(l.key)}catch(k){n.errors.push({key:l.key,reason:"read-failed",error:k});var s={event:"critical-storage",action:"inspect-primary",key:l.key,storageType:tr(y),reason:"read-failed",error:Hr(k)};rr("warn","Critical storage guard could not inspect "+l.key,s,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not inspect "+l.key,k)});continue}if(p==null){n.skipped.push({key:l.key,reason:"missing"});continue}let d;try{d=y.getItem(l.backupKey)}catch(k){n.errors.push({key:l.key,reason:"backup-read-failed",error:k});var a={event:"critical-storage",action:"inspect-backup",key:l.key,backupKey:l.backupKey,storageType:tr(y),reason:"backup-read-failed",error:Hr(k)};rr("warn","Critical storage guard could not read backup for "+l.key,a,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not read backup for "+l.key,k)});continue}if(typeof d=="string"){n.skipped.push({key:l.key,reason:"exists"});continue}const g=typeof p=="string"?p:p==null?"":String(p),m=k=>{try{return y.setItem(l.backupKey,k),{success:!0,error:null}}catch(j){return{success:!1,error:j}}},b=(k,j="backup-write-failed")=>{n.errors.push({key:l.key,reason:j,error:k});var S={event:"critical-storage",action:"mirror-backup",key:l.key,backupKey:l.backupKey,storageType:tr(y),reason:j,error:Hr(k)};C&&(S.compressed=!0),rr("error","Critical storage guard could not mirror "+l.key,S,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.error=="function"&&console.error("Critical storage guard could not mirror "+l.key,k)})},O=typeof g=="string"&&g&&!g.includes(`"${_t}":true`)&&!ku(l.key);let A=g,C=null,_=m(A);if(!_.success&&_.error){if(!St(_.error)){b(_.error);continue}if(O){const k=En(g);k&&typeof k.serialized=="string"&&k.serialized&&(A=k.serialized,C=k,_=m(A))}if(!_.success&&_.error&&St(_.error)){const k=new Set;typeof l.backupKey=="string"&&l.backupKey&&k.add(l.backupKey);const j=Xy(l.key);!j&&typeof l.key=="string"&&l.key&&k.add(l.key),!j&&!At&&Zy(y,k);const S=Lu(y,{skipKeys:Array.from(k)});S&&S.success&&(_=m(A))}if(!_.success){b(_.error,St(_.error)?"backup-quota-exceeded":"backup-write-failed"),St(_.error)&&le("critical-backup-quota");continue}}if(n.ensured.push({key:l.key,backupKey:l.backupKey,compressed:!!C}),C&&typeof C.originalLength=="number"&&typeof C.wrappedLength=="number"){const k=C.originalLength-C.wrappedLength,j=C.originalLength>0?Math.round(k/C.originalLength*100):0,S=`Stored compressed critical backup for ${l.key}, reducing storage usage by ${k} characters (${j}%).`;Pi("critical-backup",l.key,S,k,j)}}if(og(n),n.ensured.length){var c={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||tr(),count:n.ensured.length,timestamp:n.timestamp,entries:n.ensured.map(function(l){return{key:l.key,backupKey:l.backupKey,compressed:!!l.compressed}})};rr("info","Critical storage guard mirrored backup copies",c,{event:"critical-storage",stage:"ensure"},function(){if(typeof console<"u"&&typeof console.info=="function"){const l=n.ensured.map(y=>({key:y.key,backupKey:y.backupKey}));console.info("Critical storage guard mirrored backup copies",{count:n.ensured.length,entries:l})}})}if(n.errors.length){var u={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||tr(),count:n.errors.length,timestamp:n.timestamp,reason:"errors-detected",entries:n.errors.map(function(l){return{key:l&&l.key,reason:l&&l.reason,error:Hr(l&&l.error)}})};rr("warn","Critical storage guard encountered issues",u,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard encountered issues",n.errors)})}return n}function sg(){return Pu}var ag=10,ju="lz-string",vu="json-string",ji=[{variant:"utf16",compress:"compressToUTF16",decompress:"decompressFromUTF16"},{variant:"uri-component",compress:"compressToEncodedURIComponent",decompress:"decompressFromEncodedURIComponent"},{variant:"base64",compress:"compressToBase64",decompress:"decompressFromBase64"}],_t="__cineStorageCompressed",ai=1,io="lz-string",pc="lz-string-utf16",Iu=ji,Fr="camera-power-planner:storage-compression",cg=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(io):'"'.concat(String(io),'"'),lg=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(Fr):'"'.concat(String(Fr),'"'),dc=Ly(),Wr=typeof WeakSet=="function"?new WeakSet:null,ug=40,fg=128,yr="__cineRawGetItem",pg=1024,dg=256,yg=.08;function vi(e){if(!Array.isArray(e)||!e.length)return[];var t=typeof LZString=="object"&&LZString?LZString:null;if(!t)return[];var r=vy(e),n=Iy(r,t);if(n!=null)return n;for(var o=[],i=0;i<e.length;i+=1){var s=e[i];if(s){var a=typeof t[s.compress]=="function"?t[s.compress]:null,c=typeof t[s.decompress]=="function"?t[s.decompress]:null,u=null,f=0;if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{u=JSON.stringify(String(s.variant||"")),typeof u=="string"&&u?f=u.length:(u=null,f=0)}catch{u=null,f=0}a&&c&&o.push({variant:s.variant,compress:a,decompress:c,variantLiteral:f>0?u:null,variantLiteralLength:f})}}var l=o.length?o.slice():[];return r&&Ty(r,t,l),l}function Ru(e,t,r,n){if(typeof e!="string"||!e)return{success:!1};var o=vi(t);if(!o.length)return{success:!1};var i=[];if(r){for(var s=null,a=0;a<o.length;a+=1)if(o[a].variant===r){s=o[a];break}s?i.push(s):typeof console<"u"&&typeof console.warn=="function"&&console.warn("Compression variant ".concat(r," is unavailable while reading ").concat(n||"compressed payload","."))}for(var c=0;c<o.length;c+=1)(!r||o[c].variant!==r)&&i.push(o[c]);for(var u=null,f=0;f<i.length;f+=1){var l=i[f];try{var y=l.decompress(e);if(typeof y=="string"&&y)return{success:!0,value:y,variant:l.variant}}catch(p){u=p,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decompress ".concat(n||"compressed payload"," with ").concat(l.variant," variant"),p)}}return{success:!1,error:u}}function la(){return vi(ji).length>0}function gg(e,t){if(typeof e!="string"||!e||!la())return null;var r=pu(ic,e);if(r.hit)return r.candidate;var n=null,o=vi(ji);if(!o.length)return null;for(var i=0;i<o.length;i+=1){var s=o[i],a=null;try{a=s.compress(e)}catch(f){console.warn("Unable to compress migration backup payload with ".concat(s.variant," variant"),f);continue}if(!(typeof a!="string"||!a||a.length>=e.length)){var c={createdAt:t,compression:ju,compressionVariant:s.variant,encoding:vu,data:a,originalSize:e.length,compressedSize:a.length},u;try{u=JSON.stringify(c)}catch(f){console.warn("Unable to serialize compressed migration backup payload",f);continue}typeof u!="string"||!u||u.length>=e.length||(!n||u.length<n.serializedLength)&&(n={serialized:u,serializedLength:u.length,originalSize:e.length,compressedSize:a.length,variant:s.variant})}}return du(ic,e,n),n}function mg(e){if(typeof e!="string"||!e)return{createdAt:0,size:typeof e=="string"?e.length:0};const t={createdAt:0,size:e.length};try{const r=JSON.parse(e);if(r&&typeof r=="object"){let n=null;if(typeof r.createdAt=="string"?n=r.createdAt.trim():typeof r.createdAt=="number"&&Number.isFinite(r.createdAt)&&(t.createdAt=r.createdAt),n){const o=Date.parse(n);Number.isNaN(o)||(t.createdAt=o)}else for(let o=0;o<ci.length;o+=1){const i=ci[o];if(typeof r[i]=="string"){const s=r[i].trim();if(s){const a=Date.parse(s);if(!Number.isNaN(a)){t.createdAt=a;break}}}else if(typeof r[i]=="number"&&Number.isFinite(r[i])){t.createdAt=r[i];break}}}}catch{}return t}function Tu(){return la()}function En(e){if(typeof e!="string"||!e||!Tu())return null;var t=pu(oc,e);if(t.hit)return t.candidate;var r=vi(Iu);if(!r.length)return null;for(var n=typeof dc=="number"?dc:0,o=null,i=null,s=null,a=null,c=String(e.length).length,u=0;u<r.length;u+=1){var f=r[u],l=null;try{l=f.compress(e)}catch(_){console.warn("Unable to compress storage payload with ".concat(f.variant," variant"),_);continue}if(!(typeof l!="string"||!l)){var y;try{y=JSON.stringify(l)}catch(_){console.warn("Unable to serialize compressed storage payload candidate",_);continue}if(!(typeof y!="string"||!y)){var p=typeof f.variantLiteral=="string"&&f.variantLiteral?f.variantLiteral:null,d=typeof f.variantLiteralLength=="number"&&f.variantLiteralLength>0?f.variantLiteralLength:0;if(!p&&typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{p=JSON.stringify(String(f.variant||"")),d=typeof p=="string"&&p?p.length:0}catch{p=null,d=0}var g=null,m=Number.POSITIVE_INFINITY;if(n>0&&d>0){var b=String(l.length).length;m=n+y.length+c+b+d}else{var O={[_t]:!0,version:ai,algorithm:io,namespace:Fr,data:l,originalLength:e.length,compressedPayloadLength:l.length,compressionVariant:f.variant};try{g=JSON.stringify(O)}catch(_){console.warn("Unable to serialize compressed storage payload wrapper",_);continue}if(typeof g!="string"||!g)continue;m=g.length}m<e.length&&(!o||m<o.wrappedLength)&&(o={originalLength:e.length,wrappedLength:m,compressedPayloadLength:l.length,compressionVariant:f.variant},i=g,s=y,a=p)}}}if(o&&(!i||typeof i!="string"))if(typeof s!="string"||!s)o=null;else{var A;if(typeof a=="string"&&a)A=a;else if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{A=JSON.stringify(String(o.compressionVariant||""))}catch{A=null}if(typeof A!="string"||!A)o=null;else{var C='{"'.concat(_t,'":true,"version":').concat(String(ai),',"algorithm":').concat(cg,',"namespace":').concat(lg,',"data":').concat(s,',"originalLength":').concat(String(o.originalLength),',"compressedPayloadLength":').concat(String(o.compressedPayloadLength),',"compressionVariant":').concat(A,"}");i=C}}return o&&i&&typeof i=="string"&&i.length<o.originalLength?(o.serialized=i,o.wrappedLength=i.length):o=null,du(oc,e,o),o}function mo(e){if(typeof e!="string")return{success:!1};if(!e||e.charCodeAt(0)!==123)return{success:!1};if(!e.includes(`"${_t}":true`)||!e.includes(`"namespace":"${Fr}`))return{success:!1};let t;try{t=JSON.parse(e)}catch(o){return{success:!1,error:o}}if(!t||t[_t]!==!0)return{success:!1};if(t.namespace!==Fr)return{success:!1};if(t.version!==ai)return console.warn("Unsupported storage compression version",t.version),{success:!1};if(t.algorithm!==io&&t.algorithm!==pc)return console.warn("Unsupported storage compression algorithm",t.algorithm),{success:!1};if(typeof t.data!="string"||!t.data)return{success:!1};if(!Tu())return console.warn("Compressed storage payload detected but compression library is unavailable."),{success:!1};var r=null;typeof t.compressionVariant=="string"&&t.compressionVariant?r=t.compressionVariant:t.algorithm===pc&&(r="utf16");var n=Ru(t.data,Iu,r,"storage payload");return n.success?(!t.compressionVariant&&n.variant&&(t.compressionVariant=n.variant),{success:!0,value:n.value,metadata:t}):{success:!1,error:n.error}}function Ii(e,t){if(typeof e=="string"){const r=mo(e);if(!r.success||typeof r.value!="string")return{restored:!1,value:e};try{return{restored:!0,value:JSON.parse(r.value)}}catch(n){return console.warn("Unable to parse decompressed project entry payload",t||"project entry",n),{restored:!1,value:e}}}if(w(e)&&e[_t]===!0){let r;try{r=JSON.stringify(e)}catch(n){return console.warn("Unable to reserialize compressed project entry wrapper before restoration",t||"project entry",n),{restored:!1,value:e}}if(typeof r=="string"&&r)return Ii(r,t)}return{restored:!1,value:e}}function Ri(e,t){if(typeof e!="string")return;const r=typeof t=="number"&&Number.isFinite(t)?t:Date.now(),n=Ge(e);if(n){dr.set(n,r),n!==e&&dr.set(e,r);return}dr.set(e,r)}function hg(e,t){if(!e||typeof e!="object")return;const r=Date.now();Object.keys(e).forEach(n=>{typeof n!="string"||!n||Ct(n)||Ri(n,r)})}function gs(e){if(typeof e!="string")return;const t=Ge(e);dr.delete(e),t&&t!==e&&dr.delete(t)}function bg(e){if(typeof e!="string")return"";const t=Ge(e);return typeof t=="string"&&t?t:""}function Sg(e){if(!Vi||typeof Vi.has!="function")return!1;const t=bg(e);if(!t)return!1;try{return Vi.has(t)}catch{}return!1}function Eg(e,t){const r=Ii(e,t);return r.restored?r.value:e}function wg(e){return w(e)&&Object.keys(e).forEach(t=>{e[t]=Eg(e[t],t)}),e}function Ag(e){if(!e||typeof e.add!="function")return;const t=[pe,`${pe}${de}`,Ye,`${Ye}${de}`];for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&e.add(n)}}function Og(e){if(!e||typeof e.add!="function")return;const t=[Gt,_n,lr,De];for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n!="string"||!n)continue;const o=dt(n);for(let i=0;i<o.length;i+=1){const s=o[i];typeof s!="string"||!s||(e.add(s),e.add(`${s}${de}`))}}}function Kr(e,t){if(typeof e!="string")return e;const r=mo(e);return r.success?r.value:e}function Lu(e,t){if(!e||typeof e.length!="number"||typeof e.key!="function")return{success:!1,compressed:0,freed:0};if(Du(e))return{success:!1,compressed:0,freed:0};const{skipKeys:r=[],limit:n=ug,minSavings:o=fg}=t||{},i=new Set;if(At&&Bt&&i.add(Bt),At&&Ag(i),Og(i),Array.isArray(r))for(let y=0;y<r.length;y+=1){const p=r[y];typeof p=="string"&&p&&i.add(p)}const s=typeof o=="number"&&o>0?o:0,a=e.length,c=[];for(let y=0;y<a;y+=1){let p;try{p=e.key(y)}catch{p=null}if(typeof p!="string"||!p||i.has(p))continue;let d;try{d=e.getItem(p)}catch{continue}if(typeof d!="string"||!d||d.includes(`"${_t}":true`))continue;const g=En(d);if(!g||typeof g.serialized!="string"||!g.serialized)continue;const m=typeof g.originalLength=="number"&&typeof g.wrappedLength=="number"?g.originalLength-g.wrappedLength:0;m<s||c.push({key:p,serialized:g.serialized,savings:m>0?m:0,originalLength:typeof g.originalLength=="number"?g.originalLength:0})}if(!c.length)return{success:!1,compressed:0,freed:0};c.sort((y,p)=>p.savings!==y.savings?p.savings-y.savings:p.originalLength-y.originalLength);const u=typeof n=="number"&&n>0?Math.min(n,c.length):c.length;let f=0,l=0;for(let y=0;y<c.length&&f<u;y+=1){const p=c[y];if(!(!p||typeof p.serialized!="string"||!p.serialized))try{e.setItem(p.key,p.serialized),f+=1,l+=p.savings}catch{}}return f===0?{success:!1,compressed:0,freed:0}:(typeof console<"u"&&typeof console.warn=="function"&&(l>0?console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery, freeing approximately ${l} characters.`):console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery.`)),{success:!0,compressed:f,freed:l})}function Ar(e){return e==null?e:Kr(e)}function yc(e){if(!e||typeof e.getItem!="function"||Wr&&typeof Wr.has=="function"&&Wr.has(e))return;const t=e.getItem,r=typeof t=="function"?function(i){return t.call(this,i)}:null,n=function(i){const s=r?r.call(this,i):void 0;return Kr(s)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(o){const i=o&&typeof o.message=="string"&&o.message.includes("Cannot redefine property");i||console.warn("Unable to redefine storage.getItem descriptor for compression support",o);try{e.getItem=n}catch(s){const a=s&&typeof s.message=="string"&&s.message.includes("Cannot assign to read only property");return a||console.warn("Unable to patch storage instance getItem for compression support",s),void 0}}if(r)try{Object.defineProperty(e,yr,{configurable:!0,writable:!0,value:r})}catch{try{e[yr]=r}catch{}}if(Wr&&typeof Wr.add=="function")try{Wr.add(e)}catch{}}function Cg(){if(typeof Storage>"u"){const i=[];h&&typeof h=="object"&&(h.localStorage&&i.push(h.localStorage),h.sessionStorage&&i.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&i.push(global.localStorage),global.sessionStorage&&i.push(global.sessionStorage)),i.forEach(yc);return}const e=Storage.prototype;if(!e||typeof e.getItem!="function"||e.__cineStorageCompressionPatched)return;const t=e.getItem,r=function(s){return t.call(this,s)},n=function(s){const a=r.call(this,s);return Kr(a)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(i){console.warn("Unable to patch Storage.getItem for compression support",i);return}try{Object.defineProperty(e,yr,{configurable:!0,writable:!1,value:r})}catch{try{e[yr]=r}catch{}}try{Object.defineProperty(e,"__cineStorageCompressionPatched",{configurable:!0,writable:!1,value:!0})}catch{e.__cineStorageCompressionPatched=!0}const o=[];h&&typeof h=="object"&&(h.localStorage&&o.push(h.localStorage),h.sessionStorage&&o.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&o.push(global.localStorage),global.sessionStorage&&o.push(global.sessionStorage)),o.forEach(yc)}function ua(e){if(!e||typeof e!="object")return null;const t=e[yr];if(typeof t=="function")return t;const r=Object.getPrototypeOf(e);return r&&typeof r[yr]=="function"?r[yr]:null}function Un(e,t,r){if(!e||typeof t!="string"||!t)return null;const n=typeof r=="function"?r:ua(e);if(typeof n!="function")return null;try{return n.call(e,t)}catch{return null}}function _g(e,t){if(!e)return[];let r;try{r=fa(e,{suppressAlerts:!0})}catch(n){return console.warn("Unable to inspect storage while preparing migration backup cleanup",n),[]}return!r||typeof r!="object"?[]:Object.keys(r).filter(n=>!(typeof n!="string"||!n||!n.endsWith(_r)||t&&n===t)).map(n=>{const o=r[n],i=typeof o=="string"?o:o==null?"":String(o),s=mg(i);return{key:n,createdAt:s.createdAt,size:s.size}}).sort((n,o)=>n.createdAt&&o.createdAt&&n.createdAt!==o.createdAt?n.createdAt-o.createdAt:n.createdAt&&!o.createdAt?-1:!n.createdAt&&o.createdAt?1:n.size!==o.size?o.size-n.size:n.key.localeCompare(o.key))}function Mu(e,t){const r=_g(e,t);if(!r.length)return[];const n=[],o=r[0];try{e.removeItem(o.key),n.push(o.key)}catch(i){console.warn(`Unable to remove migration backup ${o.key} during cleanup`,i)}return n}function gc(e,t,r,n){if(!e||typeof e.setItem!="function")return{success:!1,error:null};const o=[];let i=null;if(typeof n!="function")return{success:!1,error:null};const s=()=>{const a=n();return a&&typeof a=="object"&&"error"in a&&a.error&&(i=a.error),a&&a.success?{success:!0,quota:!1}:a&&a.quota?{success:!1,quota:!0,error:a.error||null}:{success:!1,quota:!1,error:a&&a.error?a.error:null}};if(typeof Ht=="function"){let a=!1;try{Ht(),a=!0}catch(c){console.warn("Unable to clear cached UI storage entries before creating migration backup",c)}if(a){const c=s();if(c.success)return console.warn(`Cleared cached planner data to free storage before creating migration backup for ${t}.`),{success:!0,error:null};if(!c.quota)return{success:!1,error:c.error}}}for(let a=0;a<ag;a+=1){const c=Mu(e,r);if(!c.length)break;o.push(...c);const u=s();if(u.success)return console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} to free up storage before creating migration backup for ${t}.`,o),{success:!0,error:null};if(!u.quota)return{success:!1,error:u.error}}return o.length>0&&console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} while attempting to create migration backup for ${t}, but storage quota is still exceeded.`,o),{success:!1,error:i}}function $e(e,t){if(!e||typeof e.getItem!="function"||!t)return null;let r=null;try{r=e.getItem(t)}catch(i){return console.warn(`Unable to inspect existing value for ${t} before creating migration backup`,i),null}if(r==null)return null;let n=r,o=r;if(typeof r=="string"&&r)if(o=Kr(r),typeof o=="string"&&o)try{n=JSON.parse(o)}catch{}else n=o;return n&&typeof n=="object"&&(Array.isArray(n)&&n.length===0||!Array.isArray(n)&&Object.keys(n).length===0)||rt(e,t,n),n}var mc=["payload","value","content","entries","snapshot","state","record"],ci=["iso","timestamp","time"];function _o(e){try{return JSON.stringify(e)}catch(t){return console.warn("Unable to serialize normalized migration backup payload",t),null}}function hc(e,t){const r=typeof t=="string"&&t?t:null;if(typeof e=="string"){const o=e.trim();if(!o)return{value:r||new Date().toISOString(),changed:!0};const i=Number(o);if(!Number.isNaN(i)&&Number.isFinite(i)&&String(i)===o)try{return{value:new Date(i).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}const s=Date.parse(o);if(!Number.isNaN(s))try{const a=new Date(s).toISOString();return{value:a,changed:a!==o}}catch{return{value:r||new Date().toISOString(),changed:!0}}return{value:o,changed:o!==e}}if(typeof e=="number"&&Number.isFinite(e))try{return{value:new Date(e).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}if(e instanceof Date){const o=e.getTime();if(Number.isFinite(o))try{return{value:e.toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}}return r?{value:r,changed:!0}:{value:new Date().toISOString(),changed:!0}}function kg(e,t){if(typeof e!="string"||!e)return null;const r=typeof t=="string"&&t?t:new Date().toISOString();let n;try{n=JSON.parse(e)}catch{return _o({createdAt:r,data:e})}if(!n||typeof n!="object")return _o({createdAt:r,data:n===void 0?e:n});if(Array.isArray(n)){let f=!1;const l=n.map(y=>{if(!y||typeof y!="object")return f=!0,{createdAt:r,data:y};const p=Object.prototype.hasOwnProperty.call(y,"data"),d=y.createdAt,{value:g,changed:m}=hc(d,r);return p?m||d!==g?(f=!0,{...y,createdAt:g}):y:(f=!0,{createdAt:g,data:y})});return f?_o(l):null}let o,i=!1;if(Object.prototype.hasOwnProperty.call(n,"data"))o={...n};else{let f=null;for(let l=0;l<mc.length;l+=1){const y=mc[l];if(Object.prototype.hasOwnProperty.call(n,y)){f=y;break}}f?(o={...n},o.data=n[f],delete o[f],i=!0):(o={data:n},i=!0)}let s=o.createdAt,a="createdAt";if(s===void 0)for(let f=0;f<ci.length;f+=1){const l=ci[f];if(Object.prototype.hasOwnProperty.call(n,l)){s=n[l],a=l;break}}const{value:c,changed:u}=hc(s,r);return o.createdAt=c,a!=="createdAt"&&a&&Object.prototype.hasOwnProperty.call(o,a)&&(delete o[a],i=!0),u&&(i=!0),i?_o(o):null}function Pg(e,t,r,n){const o=kg(r,n);if(o===null)return!0;if(typeof o!="string"||!o)return!1;if(o===r)return!0;try{return e.setItem(t,o),!0}catch(i){return console.warn(`Unable to normalize legacy migration backup for ${t}`,i),!1}}function rt(e,t,r){if(!e||typeof e.setItem!="function"||r==null)return;const n=`${t}${_r}`;let o=!1;if(typeof e.getItem=="function")try{const d=e.getItem(n);if(d!=null){o=!0;const g=new Date().toISOString();Pg(e,n,d,g)}}catch(d){console.warn(`Unable to inspect migration backup for ${t}`,d)}if(o)try{const d=e.getItem(n),g=Ar(d);let m=null;try{m=JSON.parse(g)}catch(k){m=g}let b=Array.isArray(m)?m:[m];const O={createdAt:new Date().toISOString(),data:r};b.push(O);const A=5;b.length>A&&(b=b.slice(b.length-A));const C=k=>{try{return e.setItem(n,JSON.stringify(k)),{success:!0}}catch(j){return{success:!1,quota:St(j),error:j}}};let _=C(b);for(;!_.success&&_.quota&&b.length>1;)b.shift(),console.warn(`Pruning oldest migration backup for ${t} due to quota limit.`),_=C(b);if(_.success)return;if(!_.success&&_.quota){const k=gc(e,t,n,()=>C(b));if(k&&k.success)return}console.warn("Unable to append to migration backup",_.error);return}catch(d){console.warn("Unable to append to migration backup",d);return}let i;const s=new Date().toISOString();try{i=JSON.stringify({createdAt:s,data:r})}catch(d){console.warn(`Unable to serialize migration backup for ${t}`,d);return}const a=(d,g={})=>{const{logCompression:m=!1,info:b=null}=g||{};try{if(e.setItem(n,d.serialized),m&&b&&!a.compressionLogged){a.compressionLogged=!0;const O=typeof b.serializedLength=="number"?b.serializedLength:b.compressedSize,A=b.originalSize-O,C=A>0?A:0,_=b.originalSize>0?Math.round(C/b.originalSize*100):0,k=`Stored compressed migration backup for ${t} to reduce storage usage by ${C} characters (${_}%) using ${b.variant||"unknown"} variant.`;Pi("migration-backup",t,k,C,_)}return{success:!0,quota:!1}}catch(O){return{success:!1,quota:St(O),error:O}}};a.compressionLogged=a.compressionLogged||!1;const c={serialized:i},u=a(c);if(u.success)return;const f=d=>{console.warn(`Unable to create migration backup for ${t}`,d)};if(!u.quota){f(u.error);return}const y=!ku(t)?gg(i,s):null,p=(d,g,m)=>{const b=gc(e,t,n,()=>a(d,g));if(b&&b.success)return!0;const O=b&&b.error?b.error:m;return f(O),le("migration-backup-quota"),!1};if(y){const d=a(y,{logCompression:!0,info:y});if(d.success)return;if(!d.quota){f(d.error);return}return p(y,{logCompression:!0,info:y},d.error),void 0}p(c,{},u.error)}var bc=[De,Ye,lt,Nt,pe,zt,ft,br,Ur,Wt,qt,Er,xt,Dr,Sr,wr,ur],Sc=[Vt,hr(),"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",mn,bn],on="__cameraPowerPlannerStorageAlertShown",Fo="__cameraPowerPlannerSessionFallbackAlertShown",Uo=!1;h&&(typeof h[on]=="boolean"?Uo=h[on]:h[on]=!1);var ms=!1;h&&(typeof h[Fo]=="boolean"?ms=h[Fo]:h[Fo]=!1);var jg=["cameras","monitors","video","viewfinders","directorMonitors","iosVideo","videoAssist","media","lenses","batteries","batteryHotswaps","wirelessReceivers"],vg=["motors","handUnits","controllers","distance"],Ig=["chargers","cages","powerPlates","cameraSupport","matteboxes","filters","rigging","batteries","cables","videoAssist","media","cardReaders","tripodHeads","tripods","sliders","cameraStabiliser","grip","carts"],Rg=()=>typeof navigator<"u"&&navigator&&typeof navigator.storage=="object"?navigator.storage:null,hs="__storage_test__",Tg=new Set(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"]),Lg=new Set([22,1014]),Mg=new Set([22,1014]);function St(e){return!e||typeof e!="object"?!1:!!(typeof e.code=="number"&&Lg.has(e.code)||typeof e.number=="number"&&Mg.has(e.number)||typeof e.name=="string"&&Tg.has(e.name))}function Ng(e){if(!e)return!1;try{if(typeof e.length=="number"&&e.length>0)return!0}catch(t){console.warn("Unable to read storage length after quota error",t)}if(typeof e.getItem=="function")try{for(let t=0;t<bc.length;t+=1){const r=bc[t],n=dt(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;const s=`${i}${de}`;if(e.getItem(s)!==null)return!0}}for(let t=0;t<Sc.length;t+=1){const r=Sc[t],n=dt(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;if(ht.has(i)){const s=`${i}${de}`;if(e.getItem(s)!==null)return!0}}}}catch(t){console.warn("Unable to inspect known storage keys after quota error",t)}if(typeof e.key=="function")try{const t=typeof e.length=="number"?e.length:0;for(let r=0;r<t;r+=1){const n=e.key(r);if(typeof n=="string"&&n)return!0}}catch(t){console.warn("Unable to iterate storage keys after quota error",t)}return!1}function li(e){if(!e)return null;try{e.setItem(hs,"1")}catch(t){if(St(t)&&Ng(e))return console.warn("localStorage quota exceeded. Existing planner data will remain available but new saves may fail.",t),e;throw t}try{e.removeItem(hs)}catch(t){console.warn("Unable to clean up storage test key",t)}return e}function Nu(){let e={};return{get length(){return Object.keys(e).length},key(t){const r=Object.keys(e);return t>=0&&t<r.length?r[t]:null},getItem(t){return Object.prototype.hasOwnProperty.call(e,t)?Kr(e[t]):null},setItem(t,r){e[t]=String(r)},removeItem(t){delete e[t]},clear(){e={}},keys(){return Object.keys(e)}}}function zu(){const e=ou();for(let t=0;t<e.length;t+=1){const r=e[t];if(r)try{const n=li(r);if(n)return ar=null,{storage:n,type:"local"}}catch(n){console.warn("localStorage is unavailable:",n),ar=r}}if(typeof window<"u")try{if("sessionStorage"in window){const t=li(window.sessionStorage);if(t)return Nr(t),console.warn("Falling back to sessionStorage; data persists for this tab only."),Uu(),{storage:t,type:"session"}}}catch(t){console.warn("sessionStorage fallback is unavailable:",t)}return le(),{storage:Nu(),type:"memory"}}var ar=null,F=zu();function zg(e,t){const r=[],n=[];return!e||!t||typeof t.setItem!="function"?{migratedKeys:r,failedKeys:n}:(Object.keys(e).forEach(o=>{const i=e[o];if(i==null)return;let s=null,a=!1;try{s=t.getItem(o),a=!0}catch(c){console.warn("Unable to inspect localStorage during upgrade",o,c)}if(a&&s!==null&&s!==void 0&&s!==i&&rt(t,o,s),a&&s===i){r.push(o);return}try{t.setItem(o,i),r.push(o)}catch(c){console.warn("Unable to migrate storage key during upgrade",o,c),n.push(o)}}),{migratedKeys:r,failedKeys:n})}function Gg(e,t,r){if(!e||!t||typeof t.removeItem!="function")return;(Array.isArray(r)&&r.length>0?r:Object.keys(e)).forEach(o=>{try{t.removeItem(o)}catch(i){console.warn("Unable to remove migrated storage key from fallback",o,i)}})}function Bg(e,t){!e||typeof e.removeItem!="function"||!Array.isArray(t)||t.forEach(r=>{try{e.removeItem(r)}catch(n){console.warn("Unable to roll back migrated storage key after upgrade failure",r,n)}})}function fa(e,t={}){const r=Object.create(null);if(!e)return r;const{suppressAlerts:n=!1}=t||{},o=i=>{if(typeof i!="string"||!i)return;let s;try{typeof e.getItem=="function"?s=e.getItem(i):Object.prototype.hasOwnProperty.call(e,i)&&(s=e[i])}catch(a){console.warn("Unable to read storage key during snapshot",i,a),n||le("migration-read");return}s!=null&&(r[i]=String(s))};if(typeof e.key=="function"&&typeof e.length=="number"){for(let i=0;i<e.length;i+=1)o(e.key(i));return r}if(typeof e.keys=="function"){try{const i=e.keys();Array.isArray(i)&&i.forEach(o)}catch(i){console.warn("Unable to enumerate storage keys during snapshot",i),n||le("migration-read")}return r}if(typeof e.forEach=="function"){try{e.forEach((i,s)=>{typeof s=="string"&&i!=null&&(r[s]=String(i))})}catch(i){console.warn("Unable to iterate storage entries during snapshot",i),n||le("migration-read")}return r}return Object.keys(e).forEach(o),r}function Gu(){if(!(!h||typeof h!="object"))try{Object.defineProperty(h,"SAFE_LOCAL_STORAGE",{configurable:!0,get:T});return}catch{try{h.SAFE_LOCAL_STORAGE=T();return}catch(t){console.warn("Unable to refresh SAFE_LOCAL_STORAGE global reference",t)}}}function Ee(e,t,r){if(!F||F.type==="memory")return;const n=F.storage;if(!n||r&&r!==n)return;let o=Object.create(null);try{o=fa(n,{suppressAlerts:!0})}catch(c){console.warn("Unable to capture storage snapshot during downgrade",c)}let i=null,s="memory";if(F.type!=="session"){const c=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let u=0;u<c.length;u+=1){const f=oa(c[u]);if(!(!f||f===n||r&&f===r))try{const l=li(f);if(l){i=l,s="session",Nr(l);break}}catch(l){console.warn("Unable to activate sessionStorage fallback during downgrade",l)}}}i||(i=Nu()),Object.keys(o).forEach(c=>{const u=o[c];if(u!=null)try{typeof i.setItem=="function"?i.setItem(c,u):i[c]=u}catch(f){console.warn(`Unable to copy storage entry to ${s==="session"?"sessionStorage":"memory"} during downgrade`,c,f)}}),F={storage:i,type:s},ar=null;const a=s==="session"?"sessionStorage":"in-memory fallback";console.warn(e?`Downgraded planner storage to ${a} after ${e} errors.`:`Downgraded planner storage to ${a} after storage errors.`,t),s==="session"&&Uu(),Gu()}function xg(){if(!F||F.type==="local")return F.storage;const e=ou(),t=F.storage;let r=null,n=null;for(let a=0;a<e.length;a+=1){const c=e[a];if(!c||c===t||c===ar)continue;let u;try{u=li(c)}catch(f){console.warn("localStorage upgrade verification failed",f),ar=c;continue}if(!u||u===t){u||(ar=c);continue}r=c,n=u;break}if(!n)return t;const o=fa(t),{migratedKeys:i,failedKeys:s}=zg(o,n);return s.length>0?(Bg(n,i),console.warn("Aborting localStorage upgrade because some entries could not be migrated. Continuing to use fallback storage.",s),le("migration-write"),ar=r||n,t):(Gg(o,t,i),F={storage:n,type:"local"},ar=null,n)}function T(){return K&&K.driver&&K.driver.storage?K.driver.storage:((!F||!F.storage)&&(F=zu(),typeof console<"u"&&console.log&&console.log("DEBUG: storage initialized with type:",F.type)),F.type!=="local"&&xg(),F.storage)}Gu();Cg();var Nn=null;function Bu(){const e=Rg();if(!(e&&typeof e.persist=="function"))return Promise.resolve({supported:!1,granted:!1,alreadyGranted:!1});if(Nn)return Nn;const n=(async()=>{let o=!1;const i=typeof e.persisted=="function";if(i)try{o=await e.persisted()}catch(s){console.warn("Unable to determine persistent storage state",s)}if(o)return{supported:!0,granted:!0,alreadyGranted:!0};try{const s=await e.persist();if(!s&&i)try{if(await e.persisted())return{supported:!0,granted:!0,alreadyGranted:!0}}catch(a){console.warn("Unable to verify persistent storage after request",a)}return{supported:!0,granted:s,alreadyGranted:!1}}catch(s){return console.warn("Persistent storage request failed",s),{supported:!0,granted:!1,alreadyGranted:!1,error:s}}})().then(o=>((!o||o.granted!==!0)&&(Nn=null),o),o=>{throw Nn=null,o});return Nn=n,n}typeof window<"u"&&typeof navigator<"u"&&Bu();function w(e){if(e===null||typeof e!="object")return!1;let t;try{t=Object.getPrototypeOf(e)}catch{return!1}if(t===null||t===Object.prototype)return!0;if(Object.getPrototypeOf(t)===null&&typeof t.constructor=="function"){const n=t.constructor.name;return n==="Object"||n===""}return!1}function re(e){if(!e||typeof e!="object")return!1;if(Object.prototype.toString.call(e)==="[object Map]")return!0;if(typeof Map<"u")try{if(e instanceof Map)return!0}catch{}return typeof e.size=="number"&&typeof e.entries=="function"&&typeof e.forEach=="function"&&typeof e.get=="function"&&typeof e.set=="function"}function xu(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(typeof e=="symbol")return e.description||e.toString();if(e&&typeof e=="object")try{const t=JSON.stringify(e);if(t&&t!=="{}")return t}catch{}try{return String(e)}catch{}return null}function ne(e){if(!re(e))return null;const t=Object.create(null),r=(o,i)=>{const s=xu(o);s!=null&&(Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i))};let n=!1;if(typeof e.entries=="function")try{const o=e.entries();if(o&&typeof o.next=="function"){for(let i=o.next();!i.done;i=o.next()){const s=i&&i.value;Array.isArray(s)&&s.length>=2&&r(s[0],s[1])}n=!0}}catch(o){console.warn("Unable to iterate map-like value entries",o)}if(!n&&typeof e.forEach=="function")try{e.forEach((o,i)=>{r(i,o)}),n=!0}catch(o){console.warn("Unable to iterate map-like value via forEach",o)}return!Object.keys(t).length&&!n?null:t}var so=/^long[\s_-]?gop$/i;function Ec(e){if(typeof e!="string")return null;var t=e.trim();if(!t)return null;var r=t.toLowerCase();return r==="utf16"||r==="utf-16"?"utf16":r==="uri-component"||r==="uri_component"||r==="encoded-uri-component"||r==="uri"?"uri-component":r==="base64"?"base64":so.test(r)?"utf16":null}function wc(e){if(typeof e!="string")return e;const t=e.trim();return so.test(t)?"long-gop":e}function Fg(e){return typeof e!="string"?e:so.test(e)?"long-gop":e}function fe(e,t){if(e===null||typeof e!="object")return wc(e);const r=t||new WeakSet;if(r.has(e))return e;if(r.add(e),Array.isArray(e)){let n=!1;const o=e.map(i=>{const s=fe(i,r);return s!==i&&(n=!0),s});return n?o:e}if(w(e)){let n=!1;const o={};return Object.keys(e).forEach(i=>{const s=Fg(i),a=e[i],c=fe(a,r);(s!==i||c!==a)&&(n=!0),o[s]=c}),n?o:e}return wc(e)}function pa(e){if(!Array.isArray(e))return{normalized:Array.isArray(e)?e:[],changed:!1};let t=!1;return{normalized:e.map(n=>{if(n==null)return n;const o=fe(n);return o!==n&&(t=!0),o}),changed:t}}function da(e){if(typeof e!="string")return{timestamp:Number.NEGATIVE_INFINITY,label:""};const t=(r,n={})=>{const i=e.slice(r.length).split("-");if(i.length<5)return null;const[s,a,c,u,f]=i,l=Number.parseInt(s,10),y=Number.parseInt(a,10)-1,p=Number.parseInt(c,10),d=Number.parseInt(u,10),g=Number.parseInt(f,10);if([l,y,p,d,g].some(k=>Number.isNaN(k)))return null;let m=!1,b=0,O=5;if(i.length>O){const k=i[O];if(/^\d{1,2}$/u.test(k))m=!0,b=Number.parseInt(k,10),O+=1;else if(n.requireSeconds)return null}else if(n.requireSeconds)return null;const A=i.slice(O).join("-").trim(),_=new Date(l,y,p,d,g,m?b:0,0).getTime();return Number.isNaN(_)?null:{timestamp:_,label:A}};if(e.startsWith(Be)){const r=t(Be);return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}if(e.startsWith(pt)){const r=t(pt,{requireSeconds:!1});return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}return{timestamp:Number.NEGATIVE_INFINITY,label:""}}function ui(e,t){return!w(e)||typeof t!="string"?[]:Object.keys(e).filter(r=>typeof r=="string"&&r.startsWith(t)).map(r=>{const{timestamp:n,label:o}=da(r);return{key:r,timestamp:n,label:o}}).sort((r,n)=>r.timestamp!==n.timestamp?r.timestamp-n.timestamp:r.key.localeCompare(n.key))}function Ug(e){if(!(!e||typeof e!="object")){try{e[Gr]=!0}catch{try{Object.defineProperty(e,Gr,{configurable:!0,enumerable:!0,writable:!0,value:!0})}catch{}}if(w(e.projectInfo))try{e.projectInfo[Gr]=!0}catch{}}}function Dg(e){return!e||typeof e!="object"?!1:!!(e[Gr]===!0||w(e.projectInfo)&&e.projectInfo[Gr]===!0)}function ya(e,t){return!w(e)||typeof t!="string"?!1:Dg(e[t])}function Fu(e){if(!e||typeof e!="object")return"";if(typeof e.label=="string"){const t=e.label.trim();if(t)return t}if(typeof e.key=="string"&&e.key.trim()){const t=e.key.trim();return t.startsWith(Be)||t.startsWith(pt)?"__auto-backup:unlabeled__":t}return"__auto-backup:unlabeled__"}function Kg(e,t){if(!w(e)||!t||typeof t.key!="string")return"undefined";const r=Object.prototype.hasOwnProperty.call(e,t.key)?e[t.key]:void 0;try{let n=r;if(w(r)&&r[rn]){const i=he(r,{stripMetadata:!0}),s=i[rn];if(s&&typeof s=="object")try{const a=ys(s,t.key);s.payload=a.payload,Object.prototype.hasOwnProperty.call(s,"payloadCompression")&&delete s.payloadCompression}catch(a){console.warn("Failed to expand automatic backup payload for signature comparison",t.key,a)}n=i}const o=ds(n,{stripMetadata:!0});return Ce(o)}catch(n){return console.warn("Failed to create stable signature for automatic backup entry",n),"undefined"}}function Ce(e,t){const r=t||(typeof WeakSet=="function"?{seen:new WeakSet,reportedCycle:!1}:null),n=r&&r.seen?r.seen:null,o=(i,s)=>{if(!n)return s();if(n.has(i))return!r.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Detected circular reference while computing automatic backup signature. Using a placeholder token to keep backups stable."),r.reportedCycle=!0,Au;n.add(i);try{return s()}finally{n.delete(i)}};if(e===null)return"null";if(e===void 0)return"undefined";if(Array.isArray(e))return o(e,()=>{let i="[";for(let s=0;s<e.length;s+=1)s>0&&(i+=","),i+=Ce(e[s],r);return i+="]",i});if(e instanceof Date)return o(e,()=>{const i=e.getTime();return Number.isNaN(i)?"date:invalid":`date:${i}`});if(w(e))return o(e,()=>{const i=Object.keys(e).sort();let s="{";for(let a=0;a<i.length;a+=1){const c=i[a];a>0&&(s+=","),s+=`${JSON.stringify(c)}:${Ce(e[c],r)}`}return s+="}",s});if(e&&typeof e=="object")return o(e,()=>`${typeof e}:${String(e)}`);if(typeof e=="number")return Number.isNaN(e)?"number:NaN":Number.isFinite(e)?`number:${e}`:e>0?"number:Infinity":"number:-Infinity";if(typeof e=="bigint")return`bigint:${e.toString()}`;if(typeof e=="boolean")return e?"boolean:true":"boolean:false";if(typeof e=="string"){const i=mo(e);if(i.success&&typeof i.value=="string")try{const s=JSON.parse(i.value);return Ce(s,r)}catch(s){console.warn("Unable to decode compressed string while computing stable value signature",s)}return`string:${e}`}return typeof e=="symbol"?`symbol:${String(e)}`:typeof e=="function"?`function:${e.name||"anonymous"}`:`${typeof e}:${String(e)}`}function bs(e,t){if(!w(e)||!Array.isArray(t)||t.length<2)return null;const r=new Map;for(let n=t.length-1;n>=0;n-=1){const o=t[n];if(!o||typeof o.key!="string"||ya(e,o.key))continue;const i=Fu(o);let s=r.get(i);s||(s=new Map,r.set(i,s));const a=Object.prototype.hasOwnProperty.call(e,o.key)?e[o.key]:void 0,c=Ce(a),u=s.get(c);if(u&&typeof u.key=="string")return delete e[o.key],t.splice(n,1),typeof console<"u"&&typeof console.info=="function"&&console.info("Removed duplicate automatic backup while preserving newer copy.",{removedKey:o.key,preservedKey:u.key,label:i}),o.key;s.set(c,{key:o.key,signature:c})}return null}function Ac(e,t){const r=[];for(;;){const n=bs(e,t);if(!n)break;r.push(n)}return r}function Oc(e,t,r,n){if(!w(e)||!Array.isArray(t)||t.length<=r)return;const o=new Map;for(let s=0;s<t.length;s+=1){const a=t[s];if(!a||typeof a.key!="string")continue;const c=Fu(a),u=Kg(e,a),f=`${c}__${u}`,l=o.get(f);l?l.push(s):o.set(f,[s])}const i=Array.from(o.values()).filter(s=>Array.isArray(s)&&s.length>1).flatMap(s=>s.slice(0,-1)).sort((s,a)=>s-a);if(!i.length){t.length>r&&console.warn("Skipped trimming automatic backups because all remaining versions are unique.",{limit:r,total:t.length});return}for(let s=i.length-1;s>=0&&t.length>r;s-=1){const a=i[s],c=t[a];!c||typeof c.key!="string"||ya(e,c.key)||(delete e[c.key],t.splice(a,1),n.push(c.key))}t.length>r&&console.warn("Unable to trim automatic backups down to the configured limit without losing unique data.",{limit:r,remaining:t.length})}function ga(e){if(!w(e))return[];const t=[],r=ui(e,Be);t.push(...Ac(e,r)),r.length>Qr&&Oc(e,r,Qr,t);const n=ui(e,pt);return t.push(...Ac(e,n)),n.length>uc&&Oc(e,n,uc,t),t.length>0&&console.warn(`Removed ${t.length} older automatic backup${t.length>1?"s":""} to stay within storage limits.`,t),t}function Ss(e,t={}){if(!w(e))return null;const{force:r=!1}=t,n=(f,{respectRename:l=!0}={})=>{if(!Array.isArray(f)||f.length===0)return null;for(let y=0;y<f.length;y+=1){const p=f[y];if(!p||typeof p.key!="string")continue;const d=Object.prototype.hasOwnProperty.call(e,p.key),g=d?e[p.key]:void 0;if(!d||g===void 0||g===null||typeof g!="object")return delete e[p.key],p.key;if(!(l&&ya(e,p.key)))return delete e[p.key],p.key}return null},o=ui(e,Be),i=bs(e,o);if(i)return i;const s=ui(e,pt),a=bs(e,s);if(a)return a;const c=n(s,{respectRename:!1});if(c)return c;s.length>0&&console.warn("Unable to free space by removing pre-deletion backups because all copies appear to be protected.");const u=n(o,{respectRename:!r});return u||(o.length>0&&console.warn("Unable to free space by removing automatic backups because the remaining copies were renamed or protected."),null)}function $g(e){if(!e||typeof e!="object")return"";if(typeof e.note=="string"){const t=e.note.trim();if(t)return t}if(typeof e.createdAt=="string"){const t=e.createdAt.trim();if(t)return t}return typeof e.id=="string"?e.id:""}function Es(e){if(!Array.isArray(e)||e.length===0)return null;const t=r=>{const[n]=e.splice(r,1);return{removed:n,label:$g(n)}};for(let r=e.length-1;r>=0;r-=1){const n=e[r];if(!n||typeof n!="object"||!Array.isArray(n.rules))return t(r)}return t(e.length-1)}function Vg(e){if(!e||typeof e.getItem!="function"||typeof e.removeItem!="function")return!1;const t=`${Wt}${_r}`,r=[];try{const n=e.getItem(t);n!=null&&(e.removeItem(t),r.push(t))}catch(n){console.warn("Unable to inspect automatic gear backup migration snapshot while recovering storage quota.",n)}try{const n=Mu(e,t);Array.isArray(n)&&n.length>0&&r.push(...n)}catch(n){console.warn("Unable to prune migration backups while recovering storage for automatic gear backups.",n)}return r.length>0?(console.warn(`Removed ${r.length} migration backup${r.length>1?"s":""} while freeing storage for automatic gear backups.`,r),!0):!1}function ws(){if(typeof Ht!="function")return!1;try{return Ht(),console.warn("Cleared cached planner data to free up storage space before saving automatic gear backups."),!0}catch(e){console.warn("Unable to clear cached planner data while recovering storage for automatic gear backups.",e)}return!1}function Wg(e){return e?!(e==="migration-read"&&typeof F<"u"&&F&&F.type&&F.type!=="memory"):!0}function le(e){if(!Wg(e)||(h&&typeof h[on]=="boolean"&&(Uo=h[on]),Uo)||(Uo=!0,h&&(h[on]=!0),typeof window>"u"||typeof window.alert!="function"))return;let t="Storage error: Unable to access local data. Changes may not be saved.";try{if(typeof texts<"u"){const r=typeof currentLang<"u"&&texts[currentLang]?currentLang:"en";t=texts[r]?.alertStorageError||t}}catch{}window.alert(t)}function Uu(){if(ms||(ms=!0,h&&(h[Fo]=!0),typeof window>"u"||typeof window.alert!="function"))return;let e="Warning: Local storage is unavailable. Data will only persist for this browser tab.";try{if(typeof texts<"u"){const t=typeof currentLang<"u"&&texts[currentLang]?currentLang:"en";e=texts[t]?.alertSessionFallback||e}}catch{}window.alert(e)}function wn(e){if(typeof window>"u")return null;try{return window[e]}catch(t){return console.warn(`Unable to access ${e} during legacy migration`,t),null}}function ao(e){if(!Array.isArray(e)||e.length===0)return[];const t=[],r=new Set;for(let n=0;n<e.length;n+=1){const o=e[n];!o||typeof o.getItem!="function"||r.has(o)||(r.add(o),t.push(o))}return t}function qg(e,t,r,n,o={}){if(!e||typeof e.getItem!="function")return!1;const{keepLegacy:i=!1}=o;let s;try{s=e.getItem(r)}catch(c){return console.warn(`Unable to read legacy storage key ${r}`,c),le("migration-read"),!1}if(s==null)return!1;const a=t&&typeof t.setItem=="function"?t:e;try{const c=a.getItem(n);if(c!=null){if(!i&&(e!==a||r!==n))try{e.removeItem(r)}catch(u){console.warn(`Unable to remove legacy storage key ${r}`,u)}return!1}}catch(c){console.warn(`Unable to inspect destination storage for ${n}`,c)}try{a.setItem(n,s)}catch(c){return console.warn(`Unable to migrate legacy storage key ${r}`,c),!1}if(!i)try{e.removeItem(r)}catch(c){console.warn(`Unable to remove legacy storage key ${r} after migration`,c)}return!0}function ko(e,t,r,n,o){let i=!1;for(let s=0;s<e.length;s+=1)qg(e[s],t,r,n,o)&&(i=!0);return i}function Hg(){const e=T(),t=ao([wn("localStorage"),e]),r=ao([wn("sessionStorage"),typeof sessionStorage<"u"?sessionStorage:null]),n="cinePowerPlanner_";[{legacy:`${n}devices`,modern:De},{legacy:`${n}setups`,modern:Ye},{legacy:`${n}session`,modern:lt,includeSession:!0},{legacy:`${n}feedback`,modern:Nt},{legacy:`${n}project`,modern:pe},{legacy:`${n}projects`,modern:pe},{legacy:`${n}favorites`,modern:zt},{legacy:`${n}ownGear`,modern:_n},{legacy:`${n}schemaCache`,modern:ft},{legacy:`${n}autoGearRules`,modern:br},{legacy:`${n}autoGearBackups`,modern:Wt},{legacy:`${n}autoGearSeeded`,modern:Ur},{legacy:`${n}autoGearPresets`,modern:qt},{legacy:`${n}autoGearActivePreset`,modern:Er},{legacy:`${n}autoGearAutoPreset`,modern:xt},{legacy:`${n}autoGearShowBackups`,modern:Dr},{legacy:`${n}autoGearBackupRetention`,modern:wr},{legacy:`${n}autoGearMonitorDefaults`,modern:Sr},{legacy:`${n}customFonts`,modern:zo,updateFontKey:!0}].forEach(({legacy:i,modern:s,includeSession:a=!1,updateFontKey:c=!1})=>{const u=ko(t,e,i,s);ko(t,e,`${i}${de}`,`${s}${de}`),a&&(ko(r,null,i,s),ko(r,null,`${i}${de}`,`${s}${de}`)),c&&u&&h&&(h.CUSTOM_FONT_STORAGE_KEY===i&&(h.CUSTOM_FONT_STORAGE_KEY=s),h.CUSTOM_FONT_STORAGE_KEY_NAME===i&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=s))})}function _e(){Hg()}function Du(e){if(!e||typeof e.getItem!="function")return!1;if(tn&&typeof tn.has=="function"&&tn.has(e))return!0;if(F&&F.type==="session"&&F.storage===e||typeof SAFE_LOCAL_STORAGE<"u"&&SAFE_LOCAL_STORAGE&&F&&F.type==="session"&&SAFE_LOCAL_STORAGE===e)return Nr(e),!0;const t=[h,h&&h.__cineGlobal?h.__cineGlobal:null,h&&h.window?h.window:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=oa(t[r]);if(n&&n===e)return Nr(n),!0}return!1}function Le(e,t,r,n=null,o={}){if(!e)return n;const{disableBackup:i=!1,backupKey:s,validate:a,restoreIfMissing:c=!1,alertOnFailure:u=null,migrationBackupKey:f}=o||{},l=typeof s=="string"&&s?s:`${t}${de}`,y=!i&&l&&l!==t,p=iu()||h&&h.__cineJustFactoryReset,d=y&&!p,g=!p,m=(()=>{const L=new Set,N=[],M=$=>{typeof $!="string"||!$||L.has($)||(L.add($),N.push($))};typeof f=="string"&&f&&M(f);const z=dt(t);for(let $=0;$<z.length;$+=1)M(`${z[$]}${_r}`);return N})(),b=ua(e);let O=typeof b=="function"?Un(e,t,b):void 0,A=!1;const C=(L,N)=>{if(L==null)return{ok:!1,reason:"missing"};const M=typeof L=="string"?Kr(L):L;if(typeof L=="string"&&L&&M===L&&L.includes(`"${_t}":true`)&&L.includes(`"namespace":"${Fr}`))return console.warn(`${r} Compressed value could not be decoded${N?` (${N})`:""}.`),A=!0,{ok:!1,reason:"compressed"};try{const z=JSON.parse(M);return typeof a=="function"&&!a(z)?(console.warn(`${r} Invalid data${N?` (${N})`:""}.`),A=!0,{ok:!1,reason:"invalid"}):{ok:!0,value:z,raw:L,normalizedRaw:M}}catch(z){return console.error(`${r}${N?` (${N})`:""}`,z),A=!0,{ok:!1,reason:"error"}}};let _=null;try{_=e.getItem(t)}catch(L){console.error(`${r} (read)`,L),Ee("read access",L,e),A=!0}typeof O>"u"&&typeof b=="function"&&(O=Un(e,t,b)),_==null&&O==null&&Lt(e,t);const k=Fy(e,t,_,O);if(k.hit)return k.value;const j=C(_,"");if(j.ok){const L=typeof j.normalizedRaw=="string"&&j.normalizedRaw?j.normalizedRaw:typeof j.raw=="string"&&j.raw?j.raw:null,N=typeof O=="string"&&O?O:typeof j.raw=="string"&&j.raw?j.raw:null;return xe(e,t,N,L,j.value),j.value}const S=!j.ok&&j.reason==="missing",E=()=>{if(!m.length)return{success:!1,shouldAlert:!1};for(let L=0;L<m.length;L+=1){const N=m[L];let M=null,z;try{M=e.getItem(N)}catch(I){return console.error(`${r} (migration backup read)`,I),Ee("read access",I,e),{success:!1,shouldAlert:!0}}if(typeof b=="function"&&(z=Un(e,N,b)),M==null&&z==null){Lt(e,N);continue}const $=M??z,Je=ln({key:N,value:$,type:"migration-backup"});if(typeof Je>"u")continue;let me=Je;if(typeof me=="string"){const I=me.trim();if(I)try{me=JSON.parse(I)}catch{}else me=""}if(typeof a=="function"&&!a(me)){console.warn(`Ignored migration backup for ${t} because it failed validation.`);continue}xe(e,N,typeof z=="string"&&z?z:typeof $=="string"&&$?$:null,typeof $=="string"&&$?$:typeof z=="string"&&z?z:null,me);let Qe=null;try{Qe=JSON.stringify(me)}catch(I){console.warn(`Unable to serialize recovered migration backup for ${t}`,I),Qe=null}let kr=null,Xe=!1;if(Qe!==null){let I=Qe;const D=typeof Qe=="string"?En(Qe):null;D&&typeof D.serialized=="string"&&(I=D.serialized);try{e.setItem(t,I),kr=I}catch(V){console.warn(`Unable to restore primary copy for ${t} from migration backup`,V),Ee("write access",V,e),Xe=!0}}else Xe=!0;kr!==null?xe(e,t,kr,Qe,me):Qe!==null?xe(e,t,Qe,Qe,me):xe(e,t,null,null,me),console.warn(kr!==null?`Recovered ${t} from migration backup copy.`:`Recovered ${t} from migration backup copy but could not rewrite the primary entry.`);try{e.removeItem(N),Lt(e,N)}catch(I){console.warn(`Unable to remove migration backup ${N} after recovery`,I)}return{success:!0,value:me,shouldAlert:Xe}}return{success:!1,shouldAlert:!1}},R=d&&(A||c||S);if(R){let L=null;try{L=e.getItem(l)}catch(z){console.error(`${r} (backup read)`,z),Ee("read access",z,e),A=!0}const N=typeof b=="function"?Un(e,l,b):void 0,M=C(L,"backup");if(M.ok&&((A||S)&&console.warn(`Recovered ${t} from backup copy.`),M.raw!==null&&M.raw!==void 0)){let z=null;try{if(typeof M.raw=="string"){const Je=typeof M.normalizedRaw=="string"&&M.normalizedRaw?M.normalizedRaw:M.raw,me=En(Je);me&&typeof me.serialized=="string"?(e.setItem(t,me.serialized),z=me.serialized):Je!==M.raw?(e.setItem(t,Je),z=Je):(e.setItem(t,M.raw),z=M.raw)}else e.setItem(t,M.raw),z=typeof M.raw=="string"?M.raw:null}catch(Je){console.warn(`Unable to restore primary copy for ${t} from backup`,Je),z=null}const $=typeof M.normalizedRaw=="string"&&M.normalizedRaw?M.normalizedRaw:typeof M.raw=="string"&&M.raw?M.raw:null,kt=typeof N=="string"&&N?N:typeof M.raw=="string"&&M.raw?M.raw:null;return xe(e,l,kt,$,M.value),typeof z=="string"&&z&&xe(e,t,z,$,M.value),M.value}}const x=g&&m.length>0&&(S||c||A);if(x){const L=E();if(L.success){if(L.shouldAlert&&(A=!0),m.length){const N=m[0].key;try{e.removeItem(N),e[yr]&&e.removeItem&&e.removeItem(N)}catch(M){console.warn("Post-migration cleanup error:",M)}}return L.value}L.shouldAlert&&(A=!0)}return A&&le(u),Lt(e,t),S&&!R&&!x&&console.debug(`[Storage] Returning default for ${t} (No primary, no backups found)`),n}function ke(e,t,r,n,o={}){if(!e){console.warn("DEBUG: saveJSONToStorage NO STORAGE");return}if(iu()){console.warn("DEBUG: saveJSONToStorage RESET ACTIVE");return}const{disableBackup:i=!1,backupKey:s,onQuotaExceeded:a,enableCompressionSweep:c=!0,disableCompression:u=!1,forceCompressionOnQuota:f=!1}=o||{},l=typeof s=="string"&&s?s:`${t}${de}`,y=!i&&l&&l!==t,p=Du(e),d=p||!!u,g=p?!1:f===!0,m=ua(e),b=I=>Un(e,I,m);let O,A=!1,C,_=!1,k=!1,j=!1;const S=()=>{O=void 0,A=!1,C=void 0,_=!1,k=!1,j=!1},E=()=>{if(A)return O;A=!0;try{O=JSON.stringify(r)}catch(I){O=null,console.error(n,I),le()}return O},R=()=>{if(C!==void 0)return C&&typeof C.serialized=="string"?C.serialized:null;const I=E();if(typeof I!="string"||!I)return C=null,null;const D=En(I);return!D||typeof D.serialized!="string"?(C=null,null):(C=D,D.serialized)},x=()=>{if(_){const D=R();if(typeof D=="string")return D;_=!1}const I=E();return typeof I=="string"?I:null},L=({force:I=!1}={})=>{const D=I&&g;if(d&&!D)return k=!0,!1;if(_||k&&!D)return!1;k=!0;const V=E();if(typeof V!="string"||!V)return!1;const Pe=R();return typeof Pe!="string"||!Pe||Pe.length>=V.length?!1:(_=!0,!0)},N=()=>{if(!_||!C||j)return;const{originalLength:I,wrappedLength:D}=C;if(typeof I=="number"&&typeof D=="number"&&D<I){const V=I-D,Pe=I>0?Math.round(V/I*100):0,te=`Stored compressed value for ${t} to reduce storage usage by ${V} characters (${Pe}%).`;Pi("storage-value",t,te,V,Pe)}j=!0},M=()=>{if(d){k=!0;return}if(_||k)return;const I=E();if(typeof I!="string"||!I||I.length<pg)return;const D=R();if(typeof D!="string"||!D)return;const V=I.length-D.length;if(V<dg||(I.length>0?V/I.length:0)<yg)return;const te=b(t);typeof te=="string"&&te===D||(_=!0,k=!0)};let z,$=!1,kt=!1,Je=0,me=!1,Mi=!1;M();const kn=()=>(Je+=1,Je>tg?(me=!0,console.warn(`Exceeded maximum storage recovery attempts while saving ${t}.`),!1):!0),Qe=(I,D)=>{if(!I||typeof I.length!="number"||typeof I.key!="function")return{success:!1,freed:0};const{skipKeys:V=[]}=D||{},Pe=new Set(V);At&&Bt&&Pe.add(Bt);const te=[],Me=I.length;for(let Ne=0;Ne<Me;Ne+=1){let se;try{se=I.key(Ne)}catch{continue}if(!(!se||Pe.has(se))){if(se.endsWith("__legacyMigrationBackup")){te.push({key:se,priority:1,size:0});continue}if(se.endsWith("__backup")){te.push({key:se,priority:2,size:0});continue}if(se===ft||se===ia){te.push({key:se,priority:3,size:0});continue}if(se.startsWith(wt)&&se.includes("auto-backup-")){te.push({key:se,priority:4,size:0});continue}}}if(!te.length)return{success:!1,freed:0};te.sort((Ne,se)=>Ne.priority-se.priority);let ze=0,Pt=0;for(let Ne=0;Ne<te.length;Ne+=1){const se=te[Ne];try{const jt=I.getItem(se.key),Pn=jt?jt.length:0;if(I.removeItem(se.key),Lt(I,se.key),ze+=Pn,Pt+=1,console.warn(`[Storage Cleanup] Removed ${se.key} to free ${Pn} chars.`),ze>5e5)break}catch(jt){console.warn(`[Storage Cleanup] Failed to remove ${se.key}`,jt)}}return{success:Pt>0,freed:ze}},kr=(I,D={})=>{if(!St(I))return!1;if(typeof a=="function")try{if(a(I,{storage:e,key:t,value:r,...D})===!0)return!0}catch(te){const Me=D&&D.isBackup?" (backup)":"";console.error(`Error while handling quota exceed for ${t}${Me}`,te)}if(!Mi&&c!==!1){Mi=!0;const te=[t];y&&typeof l=="string"&&l&&l!==t&&te.push(l),D&&typeof D.backupKey=="string"&&D.backupKey&&te.push(D.backupKey);const Me=Lu(e,{skipKeys:te});if(Me&&Me.success)return!0}const V=[t];y&&typeof l=="string"&&l&&V.push(l);const Pe=Qe(e,{skipKeys:V});return!!(Pe&&Pe.success)};let Xe=0;for(;Xe<eg;){Xe+=1;const I=x();if(typeof I!="string")return;const D=E(),V=typeof D=="string"&&D?D:null;let Pe=!1,te,Me=!1,ze=null,Pt=null,Ne=null;if(typeof e.getItem=="function")try{const oe=e.getItem(t);if(oe===I)Pe=!0,Pt=I;else if(_){const Re=b(t);typeof Re=="string"&&(Pt=Re,Re===I&&(Pe=!0))}else typeof oe=="string"&&(Pt=oe)}catch(oe){console.warn(`Unable to inspect existing value for ${t}`,oe)}if(y&&typeof e.getItem=="function")try{te=e.getItem(l),Me=typeof te=="string",Me&&_?(ze=b(l),typeof ze=="string"&&(Ne=ze)):Me&&(Ne=te)}catch(oe){console.warn(`Unable to inspect existing backup for ${t}`,oe)}!$&&Me&&typeof te=="string"&&(z=te,$=!0);const se=(()=>{if(!y)return[];const oe=[];if(_){const Re=E();typeof Re=="string"&&Re&&oe.push({serialized:Re,compressed:!1}),typeof I=="string"&&I&&(!oe.length||oe[oe.length-1].serialized!==I)&&oe.push({serialized:I,compressed:!0})}else typeof I=="string"&&I&&oe.push({serialized:I,compressed:!1});return oe})(),jt=se.length?se[0]:null,Pn=Me&&jt&&typeof jt.serialized=="string"&&(te===jt.serialized||typeof ze=="string"&&ze===jt.serialized);if(Pe&&(!y||Pn)){if(V&&(xe(e,t,_&&typeof Pt=="string"&&Pt?Pt:I,V,r),y&&Me)){const Re=_&&typeof ze=="string"&&ze?ze:Ne;typeof Re=="string"&&Re&&xe(e,l,Re,V,r)}return}if(!Pe)try{e.setItem(t,I),N(),V&&xe(e,t,I,V,r)}catch(oe){if(kr(oe)){if(S(),!kn())break;Xe>0&&(Xe-=1);continue}if(!me&&L({force:g})){if(!kn())break;Xe>0&&(Xe-=1);continue}console.error(n,oe),Ee("write access",oe,e),le();return}if(!y)return;if(Pn){if(V&&Me){const oe=_&&typeof ze=="string"&&ze?ze:Ne;typeof oe=="string"&&oe&&xe(e,l,oe,V,r)}return}const La=(()=>{const oe=se.length?se:[{serialized:I,compressed:_}];let Re=null,Ni=!1,So=null;const Ma=Qt=>{try{return e.setItem(l,Qt.serialized),Qt.compressed&&N(),kt=!1,!0}catch(nt){return Re=nt,!1}};for(let Qt=0;Qt<oe.length;Qt+=1){const nt=oe[Qt];if(So=nt,Ma(nt)){if(V){const jn=nt.compressed&&V?V:nt.serialized;xe(e,l,nt.serialized,jn,r)}return"success"}if(!St(Re))break;if(!Ni&&Me)try{if(e.removeItem(l),Lt(e,l),Ni=!0,kt=!0,Me=!1,Ma(nt)){if(V){const jn=nt.compressed&&V?V:nt.serialized;xe(e,l,nt.serialized,jn,r)}return"success"}}catch(jn){console.warn(`Unable to remove previous backup for ${t}`,jn)}}if(St(Re)&&(kr(Re,{serialized:So&&typeof So.serialized=="string"?So.serialized:I,backupKey:l,isBackup:!0})||!me&&L({force:g})))return S(),kn()?"retry":"failure";if(Ni&&typeof te=="string")try{e.setItem(l,te),V&&xe(e,l,te,V,r),kt=!1}catch(Qt){console.warn(`Unable to restore previous backup for ${t}`,Qt)}return console.warn(`Unable to update backup copy for ${t}`,Re),le(),"failure"})();if(La==="success")return;if(La==="retry"){Xe>0&&(Xe-=1);continue}if(me)break;return}if($&&kt&&typeof z=="string")try{e.setItem(l,z),Lt(e,l)}catch(I){console.warn(`Unable to restore preserved backup for ${t}`,I)}console.error(n,new Error("Unable to save value after multiple attempts.")),le()}function ce(e,t,r,n={}){if(!e)return;const{disableBackup:o=!1,backupKey:i,disableMigrationCleanup:s=!1}=n||{},a=typeof i=="string"&&i?i:`${t}${de}`,c=!o&&a&&a!==t;Lt(e,t),c&&Lt(e,a),t===pe&&$t();try{e.removeItem(t)}catch(u){console.error(r,u),Ee("deletion",u,e),le()}if(c)try{e.removeItem(a)}catch(u){console.error(`${r} (backup)`,u),Ee("deletion",u,e),le()}if(!s){const u=`${t}${_r}`;try{e.removeItem(u)}catch(f){console.warn(`Unable to remove migration backup for ${t}`,f)}}}var Yg=[ft,ia],Po=new Set;function Jg(){const e=[],t=new Set,r=i=>{!i||typeof i.getItem!="function"||e.push(i)},n=(i,s,a)=>{if(!i||typeof i!="object"&&typeof i!="function")return null;try{return i[s]}catch(c){return a&&!Po.has(a)&&(Po.add(a),console.warn(`Unable to access ${a} while clearing UI caches`,c)),null}},o=(i,s)=>{if(!i||t.has(i))return;t.add(i),r(n(i,"SAFE_LOCAL_STORAGE",`${s}.SAFE_LOCAL_STORAGE`)),r(n(i,"localStorage",`${s}.localStorage`)),r(n(i,"sessionStorage",`${s}.sessionStorage`));const a=n(i,"__cineGlobal",`${s}.__cineGlobal`);a&&a!==i&&o(a,`${s}.__cineGlobal`)};o(typeof globalThis<"u"?globalThis:null,"globalThis"),o(typeof window<"u"?window:null,"window"),o(typeof self<"u"?self:null,"self"),o(typeof global<"u"?global:null,"global"),typeof __cineGlobal<"u"&&o(__cineGlobal,"__cineGlobal"),F&&F.storage&&r(F.storage),typeof SAFE_LOCAL_STORAGE<"u"&&SAFE_LOCAL_STORAGE&&r(SAFE_LOCAL_STORAGE);try{r(T())}catch(i){Po.has("getSafeLocalStorage")||(Po.add("getSafeLocalStorage"),console.warn("Unable to access safe local storage while clearing UI caches",i))}return r(wn("localStorage")),r(wn("sessionStorage")),typeof localStorage<"u"&&r(localStorage),typeof sessionStorage<"u"&&r(sessionStorage),ao(e)}function Ht(){const e=Jg();e.length&&Yg.forEach(t=>{typeof t!="string"||!t||e.forEach(r=>{ce(r,t,`Failed to clear UI cache entry ${t}`)})})}function Ku(e,t,r){if(!e)return!1;try{return e.getItem(t)==="1"}catch(n){return console.error(r,n),Ee("read access",n,e),le(),!1}}function $u(e,t,r,n){if(e)try{r?e.setItem(t,"1"):e.removeItem(t)}catch(o){console.error(n,o),Ee("write access",o,e),le()}}function Qg(e,t,r,n,o,i,s,a){const c=Le(e,r,n,null,a);if(c!==null)return c;if(!t)return null;const u={...a||{},alertOnFailure:"migration-read"},f=Le(t,r,o,null,u);return f!==null?(ke(e,r,f,i),ce(t,r,s),f):null}function ma(e,t,r){const n=e.trim();let o=n,i=2;const s=r||new Set([...t].map(c=>c.trim().toLowerCase()));let a=n.toLowerCase();for(;s.has(a);)o=`${n} (${i++})`,a=o.toLowerCase();return t.add(o),s.add(a),o}function Xg(e){const t=typeof e=="string"?e.trim():"";if(!t)return"Project-imported";const r=t.match(/^(.*?)-imported(?:-(\d+))?$/i);if(r){const n=typeof r[1]=="string"?r[1].trim():"";return n?`${n}-imported`:"Project-imported"}return t.toLowerCase().endsWith("-imported")?t:`${t}-imported`}function Zg(e){const t=typeof e=="string"?e.trim():"",r=Xg(e);if(!t)return{base:r,initialCandidate:r,suffixStart:2};const n=t.match(/^(.*?)-imported(?:-(\d+))?$/i),o=n&&n[2]?Number(n[2]):NaN,i=Number.isFinite(o)?o+1:2;return n?{base:r,initialCandidate:t,suffixStart:i}:{base:r,initialCandidate:r,suffixStart:2}}function em(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=Zg(e);let i=typeof o.initialCandidate=="string"?o.initialCandidate.trim():"";i||(i=o.base||"Project-imported");let s=i.trim().toLowerCase(),a=o.suffixStart;for(;s&&n.has(s);)i=`${o.base||"Project-imported"}-${a++}`,s=i.trim().toLowerCase();return t.add(i),s&&n.add(s),i}function tm(e){const t=typeof e=="string"?e.trim():"";return t?t.toLowerCase().endsWith("-updated")?t:`${t}-updated`:"Project-updated"}function zn(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=tm(e);let i=o,s=2,a=i.trim().toLowerCase();for(;a&&n.has(a);)i=`${o}-${s++}`,a=i.trim().toLowerCase();return i}function rm(e){if(e==null)return[];if(typeof e=="string"){const t=e.trim();return t?[t]:[]}return Array.isArray(e)?e.filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):w(e)?Object.values(e).filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):[]}function nm(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}function As(e){if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(!n||typeof n!="object")return;const o=Number(n.x),i=Number(n.y);!Number.isFinite(o)||!Number.isFinite(i)||(t[r]={x:o,y:i})}),t}function om(e,t){const r=Object.keys(e||{}),n=Object.keys(t||{});if(r.length!==n.length)return!1;for(let o=0;o<r.length;o+=1){const i=r[o];if(!Object.prototype.hasOwnProperty.call(t||{},i))return!1;const s=e[i],a=t[i];if(!s||typeof s!="object"||!a||typeof a!="object"||Number(s.x)!==a.x||Number(s.y)!==a.y)return!1}return!0}function im(e){if(!w(e))return{state:null,changed:!1};const t={...e};let r=!1;const n=s=>{if(!Object.prototype.hasOwnProperty.call(t,s))return;const a=t[s];if(typeof a=="string"){const c=a.trim();c!==a&&(t[s]=c,r=!0);return}if(a==null){t[s]="",r=!0;return}if(typeof a=="number"||typeof a=="boolean"){t[s]=String(a),r=!0;return}t[s]="",r=!0};["setupName","setupSelect","camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap","sliderBowl","easyrig"].forEach(n);const o=(s,a=[])=>{const c=[],u=[s,...a];let f=!1;u.forEach(g=>{if(Object.prototype.hasOwnProperty.call(t,g)){const m=rm(t[g]);g!==s&&(f=!0),m.length&&c.push(...m)}}),u.slice(1).forEach(g=>{Object.prototype.hasOwnProperty.call(t,g)&&(delete t[g],r=!0)});const l=[],y=new Set;c.forEach(g=>{y.has(g)||(y.add(g),l.push(g))});const p=Object.prototype.hasOwnProperty.call(t,s),d=p&&Array.isArray(t[s])?t[s].filter(g=>typeof g=="string").map(g=>g.trim()).filter(g=>g):[];!p&&!f&&l.length===0&&d.length===0||nm(d,l)||(t[s]=l,r=!0)};if(o("motors",["motor","motorSelect"]),o("controllers",["controller","controllerSelect"]),Object.prototype.hasOwnProperty.call(t,"projectInfo")&&!w(t.projectInfo)&&(t.projectInfo=null,r=!0),Object.prototype.hasOwnProperty.call(t,"autoGearHighlight")){const s=t.autoGearHighlight,a=s===!0||s==="true"||s===1||s==="1";(s!==a||typeof s!="boolean")&&(t.autoGearHighlight=a,r=!0)}if(Object.prototype.hasOwnProperty.call(t,"diagramPositions")){const s=As(t.diagramPositions);Object.keys(s).length===0?(delete t.diagramPositions,r=!0):om(t.diagramPositions,s)||(t.diagramPositions=s,r=!0)}const i=fe(t);return i!==t?{state:i,changed:!0}:{state:t,changed:r}}function Vu(){_e();const e=T(),t=Qg(e,typeof sessionStorage<"u"?sessionStorage:null,lt,"Error loading session state from localStorage:","Error loading session state from sessionStorage:","Error saving session state to localStorage:","Error deleting session state from sessionStorage:",{validate:o=>o===null||w(o)});if(t===null)return null;const{state:r,changed:n}=im(t);return r?(n&&(rt(e,lt,t),ha(r)),r):null}function ha(e,t={}){const r=T();if(e==null){ce(r,lt,"Error deleting session state from localStorage:");return}if(!w(e)){console.warn("Ignoring invalid session state payload. Expected a plain object.");return}$e(r,lt);const n=fe(e),o=w(t)?t:{},i=o.disableCompression!==!1,s={...o,disableCompression:i,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{if(typeof Es=="function"){const a=Pa();if(Es(a))return console.warn("Removed oldest automatic gear backup to free up space for session state."),!0}return typeof ws=="function"&&ws()?(console.warn("Cleared cached planner data to free up space for session state."),!0):!1}};ke(r,lt,n,"Error saving session state to localStorage:",s)}function Wu(e){if(!w(e))return{data:null,changed:!1};const t={...e};let r=!1;const n=(o,i)=>(w(o[i])||(o[i]={},r=!0),o[i]);return jg.forEach(o=>{n(t,o)}),w(t.fiz)||(t.fiz={},r=!0),vg.forEach(o=>{n(t.fiz,o)}),w(t.accessories)||(t.accessories={},r=!0),Ig.forEach(o=>{n(t.accessories,o)}),Array.isArray(t.filterOptions)||(t.filterOptions=Array.isArray(e.filterOptions)?e.filterOptions.slice():[],r=!0),{data:t,changed:r}}function qu(){_e();const e=T(),t=Le(e,De,"Error loading device data from localStorage:",null,{validate:o=>o===null||w(o)}),{data:r,changed:n}=Wu(t);return r?(n&&(rt(e,De,t),ke(e,De,r,"Error updating device data in localStorage during normalization:",{disableCompression:!0,forceCompressionOnQuota:!1})),r):null}function Hu(e){const t=T();if(e==null){ce(t,De,"Error deleting device data from localStorage:");return}if(!w(e)){console.warn("Ignoring invalid device data payload. Expected a plain object.");return}const{data:r}=Wu(e),n=r||e;$e(t,De),ke(t,De,n,"Error saving device data to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Yu(e){if(!e)return{data:{},changed:!1};if(Array.isArray(e)){const n={},o=new Set,i=new Set;for(let s=0;s<e.length;s+=1){const a=e[s];if(!w(a))continue;const c=a.name||a.setupName||`Setup ${s+1}`,u=ma(c,o,i);n[u]=a}return{data:n,changed:!0}}if(!w(e))return{data:{},changed:!0};const t={};let r=!1;return Object.keys(e).forEach(n=>{const o=e[n];if(w(o)){const i=fe(o);i!==o&&(r=!0),t[n]=i}else r=!0}),r?{data:t,changed:!0}:{data:e,changed:!1}}function ho(){_e();const e=T(),t=Le(e,Ye,"Error loading setups from localStorage:",null,{validate:o=>o===null||Array.isArray(o)||w(o)}),{data:r,changed:n}=Yu(t);n&&(rt(e,Ye,t),ke(e,Ye,r,"Error updating setups in localStorage during normalization:"));try{return Cu(r,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Be)})}catch(o){return console.warn("Failed to expand automatic backup entries while loading setups",o),he(r)}}function ba(e){const{data:t}=Yu(e);ga(t);const r=_u(t,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Be)});wg(r);const n=T();$e(n,Ye),ke(n,Ye,r,"Error saving setups to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{const o=Ss(r);return o?(console.warn(`Removed automatic backup "${o}" to free up storage space before saving setups.`),!0):!1}})}function Sa(e){const t=ho(),{result:r,changed:n=!0}=e(t)||{};return n&&ba(t),r}function sm(e,t){Sa(r=>(r[e]=t,{changed:!0}))}function am(e){return ho()[e]}function cm(e){Sa(t=>Object.prototype.hasOwnProperty.call(t,e)?(delete t[e],{changed:!0}):{changed:!1})}function lm(e,t){return Sa(r=>{if(!Object.prototype.hasOwnProperty.call(r,e))return{result:null,changed:!1};const n=t.trim();if(!n)return{result:e,changed:!1};if(e.trim().toLowerCase()===n.toLowerCase())return{result:e,changed:!1};const o=new Set(Object.keys(r));o.delete(e);const i=ma(n,o),s=r[e];r[i]=s,delete r[e];const a=typeof e=="string"&&e.startsWith(Be),c=typeof i=="string"&&i.startsWith(Be);return a&&c&&Ug(s),{result:i,changed:!0}})}var um=new Set(["prepDays","shootingDays","returnDays","crew","productionCompany","productionCompanyAddress"]),Ju={productionCompany:["Production Company","Produktionsfirma","Société de production","Productora","Casa di produzione"],productionCompanyAddress:["Production Company Address","Adresse der Produktionsfirma","Adresse de la société de production","Dirección de la productora","Indirizzo della casa di produzione"],productionCompanyStreet:["Street address","Straße und Hausnummer","Adresse","Dirección","Indirizzo"],productionCompanyStreet2:["Address line 2","Adresszusatz","Complément d'adresse","Línea 2 de dirección","Seconda linea indirizzo"],productionCompanyCity:["City","Stadt","Ville","Ciudad","Città"],productionCompanyRegion:["State / Province / Region","Bundesland / Region","État / Région / Département","Estado / Provincia / Región","Regione / Provincia / Stato"],productionCompanyPostalCode:["Postal code","Postleitzahl","Code postal","Código postal","CAP"],productionCompanyCountry:["Country","Land","Pays","País","Paese"],rentalHouse:["Rental","Kameraverleih","Loueur","Noleggio","Verleih","Location","Rental House"],crew:["Crew","Team","Équipe","Equipo","Troupe"],prepDays:["Prep Days","Prep-Tage","Jours de préparation","Días de preparación","Giorni di preparazione"],shootingDays:["Shooting Days","Drehtage","Jours de tournage","Días de rodaje","Giorni di riprese"],returnDays:["Return Days","Rückgabetage","Jours de restitution","Días de devolución","Giorni di restituzione"],deliveryResolution:["Delivery Resolution","Auslieferungsauflösung","Résolution de livraison","Resolución de entrega","Risoluzione di consegna"],recordingResolution:["Recording Resolution","Aufnahmeauflösung","Résolution d’enregistrement","Resolución de grabación","Risoluzione di registrazione"],slowMotionRecordingResolution:["Slow Motion Recording Resolution","Zeitlupen-Aufnahmeauflösung","Résolution d’enregistrement au ralenti","Resolución de grabación en cámara lenta","Risoluzione di registrazione slow motion"],aspectRatio:["Aspect Ratio","Seitenverhältnis","Format d’image","Relación de aspecto","Formato"],codec:["Codec","Codec","Codec","Códec","Codec"],baseFrameRate:["Base Frame Rate","Basis-Framerate","Cadence de base","Velocidad base","Frame rate base"],slowMotionBaseFrameRate:["Slow Motion Base Frame Rate","Zeitlupen-Basis-Framerate","Cadence de base au ralenti","Velocidad base en cámara lenta","Frame rate base slow motion"],recordingFrameRate:["Recording Frame Rate","Aufnahmebildrate","Cadence d’enregistrement","Velocidad de grabación","Frame rate di registrazione"],slowMotionRecordingFrameRate:["Slow Motion Recording Frame Rate","Zeitlupen-Aufnahmebildrate","Cadence d’enregistrement au ralenti","Velocidad de grabación en cámara lenta","Frame rate di registrazione slow motion"],sensorMode:["Sensor Mode","Sensormodus","Mode capteur","Modo de sensor","Modalità sensore"],slowMotionSensorMode:["Slow Motion Sensor Mode","Zeitlupen-Sensormodus","Mode capteur au ralenti","Modo de sensor en cámara lenta","Modalità sensore slow motion"],slowMotionAspectRatio:["Slow Motion Aspect Ratio","Zeitlupen-Seitenverhältnis","Format d’image au ralenti","Relación de aspecto en cámara lenta","Formato slow motion"],lenses:["Lenses","Objektive","Optiques","Ópticas","Obiettivi"],requiredScenarios:["Required Scenarios","Anforderungen","Scénarios requis","Escenarios requeridos","Scenari richiesti"],cameraHandle:["Camera Handle","Kamera-Handgriff","Poignée caméra","Empuñadura de cámara","Maniglia camera"],viewfinderExtension:["Viewfinder Extension","Sucher-Verlängerung","Extension viseur","Extensión de visor","Prolunga mirino"],viewfinderEyeLeatherColor:["Viewfinder Eye Leather Color","Sucher-Augenmuschel-Farbe","Couleur de l’œil du viseur","Color del ocular del visor","Colore gomma mirino"],mattebox:["Mattebox","Matte-Box","Matte box","Matte box","Matte box"],gimbal:["Gimbal","Gimbal-Stabilisator","Stabilisateur gimbal","Estabilizador gimbal","Stabilizzatore gimbal"],videoDistribution:["Video Distribution","Videoverteilung","Distribution vidéo","Distribución de vídeo","Distribuzione video"],monitoringSupport:["Monitoring support","Monitoring-Support","Support de monitoring","Soporte de monitorización","Supporto monitoraggio"],monitoringConfiguration:["Monitoring configuration","Monitoring-Konfiguration","Configuration de monitoring","Configuración de monitorización","Configurazione monitoraggio"],focusMonitor:["Focus Monitor","Fokusmonitor","Moniteur focus","Monitor de foco","Monitor fuoco"],monitorUserButtons:["Onboard Monitor User Buttons","Onboard-Monitor-Buttons","Boutons personnalisés du moniteur","Botones de usuario del monitor integrado","Tasti monitor onboard"],cameraUserButtons:["Camera User Buttons","Kamera-Buttons","Boutons personnalisés caméra","Botones de usuario de la cámara","Tasti camera"],viewfinderUserButtons:["Viewfinder User Buttons","Sucher-Buttons","Boutons personnalisés viseur","Botones de usuario del visor","Tasti mirino"],tripodHeadBrand:["Tripod Head Brand","Kopfmarke","Marque de la tête","Marca de la cabeza","Marca della testa"],tripodBowl:["Tripod Bowl","Schalentyp","Type de bol","Tipo de bowl","Tipo di bowl"],tripodTypes:["Tripod Types","Stativtypen","Types de trépied","Tipos de trípode","Tipi di treppiede"],tripodSpreader:["Tripod Spreader","Spreizer-Option","Type de spreader","Tipo de esparcidor","Tipo di spreader"],sliderBowl:["Slider Bowl","Slider-Schale","Slider bowl","Bowl del slider","Slider bowl"],easyrig:["Further Stabilisation","Weitere Stabilisierung","Stabilisation complémentaire","Estabilización adicional","Stabilizzazione aggiuntiva"]},Os=["productionCompanyAddress","productionCompanyStreet","productionCompanyStreet2","productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"];function Qu(e){return typeof e!="string"?"":e.trim().replace(/[:：]\s*$/,"").trim()}function fm(e){var t={},r=typeof texts<"u"?texts:null,n=r&&r.en&&r.en.projectFields||{},o=["productionCompany"].concat(Os);return o.forEach(function(i){var s=new Set,a=function(u){if(typeof u=="string"){var f=Qu(u);f&&s.add(f)}};e&&e[i]&&a(e[i]),n&&n[i]&&a(n[i]);var c=Ju[i];Array.isArray(c)&&c.forEach(a),t[i]=s}),t}function pm(e,t,r){if(typeof e!="string")return null;var n=e.replace(/\r\n?/g,`
`).split(`
`).map(function(m){return m.trim()}).filter(function(m){return m});if(!n.length)return null;var o=fm(t),i={},s=n[0];s&&(i.productionCompany=s);var a=Array.isArray(r?.lines)?r.lines:null;if(a&&a.length){var c={};if(a.forEach(function(m){if(!(!m||typeof m.text!="string")){var b=m.text.trim();if(b){var O=m.fields;typeof O=="string"&&(O=O.split(/\s+/)),!(!Array.isArray(O)||!O.length)&&O.map(function(A){return typeof A=="string"?A.trim():""}).filter(function(A){return A&&Os.includes(A)}).forEach(function(A){c[A]||(c[A]=[]),c[A].push(b)})}}}),Object.keys(c).length){if(c.productionCompanyAddress&&c.productionCompanyAddress.length&&(i.productionCompanyAddress=c.productionCompanyAddress.join(`
`)),c.productionCompanyStreet&&c.productionCompanyStreet.length){var u=c.productionCompanyStreet;if(i.productionCompanyStreet=u[0],u.length>1){var f=u.slice(1).join(`
`);f&&(i.productionCompanyStreet2=f)}}if(c.productionCompanyStreet2&&c.productionCompanyStreet2.length){var l=c.productionCompanyStreet2.join(`
`);l&&(i.productionCompanyStreet2=i.productionCompanyStreet2?i.productionCompanyStreet2+`
`+l:l)}var y=function(m){if(!(!c[m]||!c[m].length)){var b=c[m].join(" ");b&&(i[m]=b)}};return["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"].forEach(y),i}}var p={},d=null;if(n.slice(1).forEach(function(m){var b=Qu(m),O=null;if(Os.forEach(function(A){O||!o[A]||o[A].has(b)&&(O=A)}),O){d=O,p[d]||(p[d]=[]);return}if(!d){i.productionCompany?i.productionCompany+=`
`+m:i.productionCompany=m;return}p[d]||(p[d]=[]),p[d].push(m)}),p.productionCompanyAddress&&p.productionCompanyAddress.length&&(i.productionCompanyAddress=p.productionCompanyAddress.join(`
`)),p.productionCompanyStreet&&p.productionCompanyStreet.length){var g=p.productionCompanyStreet;i.productionCompanyStreet=g[0],g.length>1&&(i.productionCompanyStreet2=g.slice(1).join(`
`))}return p.productionCompanyCity&&p.productionCompanyCity.length&&(i.productionCompanyCity=p.productionCompanyCity.join(" ")),p.productionCompanyRegion&&p.productionCompanyRegion.length&&(i.productionCompanyRegion=p.productionCompanyRegion.join(" ")),p.productionCompanyPostalCode&&p.productionCompanyPostalCode.length&&(i.productionCompanyPostalCode=p.productionCompanyPostalCode.join(" ")),p.productionCompanyCountry&&p.productionCompanyCountry.length&&(i.productionCompanyCountry=p.productionCompanyCountry.join(" ")),i}var dm=(()=>{const e=new Map,t=r=>typeof r!="string"?"":r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return Object.entries(Ju).forEach(([r,n])=>{n.forEach(o=>{const i=t(o);i&&!e.has(i)&&e.set(i,r)})}),e})(),ym={amp:"&",lt:"<",gt:">",quot:'"',apos:"'",nbsp:" "};function Hn(e){return typeof e!="string"||!e?"":e.replace(/&(#x?[0-9a-fA-F]+|[a-zA-Z]+);/g,(t,r)=>{if(!r)return t;if(r[0]==="#"){const o=r[1]==="x"||r[1]==="X"?parseInt(r.slice(2),16):parseInt(r.slice(1),10);return Number.isFinite(o)?String.fromCodePoint(o):t}const n=ym[r.toLowerCase()];return n!==void 0?n:t})}function Yn(e){if(typeof e!="string")return"";let t;do t=e,e=e.replace(/<[^>]*>/g,"");while(e!==t);return e}function gm(e,t){if(typeof e!="string")return"";const r=e.replace(/<\s*br\s*\/?\s*>/gi,`
`).replace(/<\/(p|div|li|ul|ol)>/gi,`
`).replace(/<li[^>]*>/gi,""),o=Hn(Yn(r)).replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(i=>i.replace(/\s+/g," ").trim()).filter(i=>i);return o.length?t&&um.has(t)?o.join(`
`):o.join(", "):""}function mm(e){if(typeof e!="string")return null;const t=/<span([^>]*)>([\s\S]*?)<\/span>/gi,r=[];let n;for(;n=t.exec(e);){const o=n[1]||"";if(!/class=["'][^"']*req-sub-line[^"']*["']/i.test(o))continue;const i=n[2]||"",s=Hn(Yn(i)).replace(/\s+/g," ").trim();if(!s)continue;const a=o.match(/data-fields=["']([^"']+)["']/i),c=a?null:o.match(/data-field=["']([^"']+)["']/i),u=a?a[1]:c?c[1]:"",f=typeof u=="string"?u.split(/\s+/).map(l=>l.trim()).filter(l=>l):[];r.push({text:s,fields:f})}return r.length?{lines:r}:null}function hm(e){if(typeof e!="string")return"";const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return t&&dm.get(t)||""}function Cc(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const r={},n=t.match(/<div[^>]*class=["'][^"']*requirements-grid[^"']*["'][^>]*>/i),o=n?n.index:-1;if(o===-1){const p=t.match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(p){const g=Hn(Yn(p[1])).replace(/[“”"']/g,"").trim();g&&(r.projectName=g)}return Object.keys(r).length?r:null}const i=t.slice(o),a=t.slice(0,o).match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(a){const d=Hn(Yn(a[1])).replace(/[“”"']/g,"").trim();d&&!/gear list/i.test(d)&&(r.projectName=d)}const c=/<div[^>]*class=["'][^"']*requirement-box[^"']*["'][^>]*>[\s\S]*?<\/div>/gi;let u;const f=typeof texts<"u"?texts:null,l=typeof currentLang=="string"&&f&&f[currentLang]?currentLang:"en",y=f&&f[l]&&f[l].projectFields?f[l].projectFields:f&&f.en&&f.en.projectFields?f.en.projectFields:{};for(;u=c.exec(i);){const p=u[0],d=p.match(/data-field=["']([^"']+)["']/i),g=p.match(/<span[^>]*class=["'][^"']*req-label[^"']*["'][^>]*>([\s\S]*?)<\/span>/i),m=p.match(/<span[^>]*class=["'][^"']*req-value[^"']*["'][^>]*>([\s\S]*)<\/span\s*>/i),b=d?d[1].trim():"",O=g?Hn(Yn(g[1])):"",A=b||hm(O);if(!A)continue;const C=m?m[1]:"",_=gm(C,A);if(!_)continue;let k=_,j=null;if(A==="productionCompany"){j=mm(C);const S=pm(_,y,j);S&&typeof S=="object"&&(S.productionCompany&&(k=S.productionCompany),Object.entries(S).forEach(([E,R])=>{E!=="productionCompany"&&(Object.prototype.hasOwnProperty.call(r,E)||(r[E]=R))}))}Object.prototype.hasOwnProperty.call(r,A)||(r[A]=k)}return Object.keys(r).length?r:null}function An(e){if(Array.isArray(e))return e.map(t=>An(t));if(w(e)){const t={};return Object.entries(e).forEach(([r,n])=>{t[r]=An(n)}),t}return e}function jo(e){if(!w(e))return null;try{return Jt(e)}catch(t){console.warn("Unable to serialize project info during normalization",t);try{return An(e)}catch(r){return console.warn("Unable to deep clone project info during normalization",r),{...e}}}}function bm(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(r=>{if(!w(r)){const l=Ea(r);l!=null&&t.push(l);return}const n={},o=typeof r.name=="string"?r.name.trim():"";o&&(n.name=o);const i=typeof r.phone=="string"?r.phone.trim():"";i&&(n.phone=i);const s=typeof r.email=="string"?r.email.trim():"";s&&(n.email=s);const c=typeof r.website=="string"?r.website.trim():typeof r.url=="string"?r.url.trim():"";c&&(n.website=c);const u=typeof r.text=="string"?r.text.trim():"";u&&(n.text=u);const f=typeof r.role=="string"?r.role.trim():"";f&&(n.role=f),Object.keys(n).length&&t.push(n)}),t}function Ea(e){if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t||null}if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="boolean")return e?!0:null;if(Array.isArray(e)){const t=e.map(r=>Ea(r)).filter(r=>r!=null&&!(typeof r=="string"&&!r));return t.length?t:null}return w(e)?Xu(e):null}function Xu(e){if(!w(e))return null;const t={},r=[],n=new Set,o=a=>{if(typeof a!="string")return;const c=a.trim();!c||n.has(c)||(n.add(c),r.push(c))},i=(a,c={})=>{if(a==null)return;if(c.fromSelections){(Array.isArray(a)?a:[a]).forEach(l=>{if(re(l)){const p=ne(l);if(p){i(p,{fromSelections:!0});return}}if(w(l)){const p=wa(l);if(p.length){p.forEach(d=>{d&&typeof d.name=="string"&&o(d.name)});return}}const y=Te(l);y&&o(y)});return}const u=We(a);u.length&&u.forEach(f=>{o(f)})};if(i(e.lenses),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&i(e.lensSelections,{fromSelections:!0}),Object.entries(e).forEach(([a,c])=>{if(c==null)return;if(a==="people"){const f=bm(c);f.length&&(t.people=f);return}if(a==="lenses"){const{names:f}=tf(c);t.lenses=f.slice();return}if(a==="lensSelections"){const f=Cs(c,r);f.selections&&f.selections.length&&(t.lensSelections=f.selections);return}const u=Ea(c);u!=null&&(t[a]=u)}),!Object.prototype.hasOwnProperty.call(t,"lenses")&&r.length&&(t.lenses=r.slice()),!Object.prototype.hasOwnProperty.call(t,"lensSelections")&&r.length){const a=Cs([],r);a.selections&&a.selections.length&&(t.lensSelections=a.selections)}return Object.keys(t).length?fe(t):null}function Sm(e){if(!Array.isArray(e)||!e.length)return null;try{return Jt(e)}catch(t){console.warn("Unable to serialize automatic gear rules during normalization",t);try{return An(e)}catch(r){return console.warn("Unable to deep clone automatic gear rules during normalization",r),e.slice()}}}function Em(e){if(!w(e)||!Object.keys(e).length)return{};try{return Jt(e)}catch(t){console.warn("Unable to serialize diagram positions during normalization",t);try{return An(e)}catch(r){return console.warn("Unable to deep clone diagram positions during normalization",r),{...e}}}}var Do="4x5.65";function it(e){if(e==null)return[];if(Array.isArray(e)){const r=[];return e.forEach(n=>{if(n==null)return;if(Array.isArray(n)){r.push(...it(n));return}if(re(n)){const i=ne(n);if(i){r.push(...it(i));return}}if(typeof n=="object"){r.push(...it(Object.values(n)));return}const o=String(n).trim();o&&r.push(o)}),r}if(re(e)){const r=ne(e);if(r)return it(r)}if(typeof e=="object")return Object.prototype.hasOwnProperty.call(e,"values")?it(e.values):Object.prototype.hasOwnProperty.call(e,"selected")?it(e.selected):it(Object.values(e));if(typeof e=="string"){const r=e.trim();if(!r||r==="!")return[];const n=Ae(r);return n.success?it(n.parsed):r.split(/[|,]/).map(o=>o.trim()).filter(o=>o)}const t=String(e).trim();return t?[t]:[]}function sn(e,t=""){if(e==null)return null;if(typeof e=="string"){const r=e.trim();if(!r)return null;const n=Ae(r);if(n.success)return sn(n.parsed,t);const o=r.split(":"),i=o.shift(),s=i?i.trim():"";if(!s)return null;const a=o.shift(),c=a&&a.trim()?a.trim():Do;if(!o.length)return{type:s,size:c,values:[],hasExplicitValues:!1};const u=o.join(":");if(u==="!")return{type:s,size:c,values:[],hasExplicitValues:!0};const f=it(u);return{type:s,size:c,values:f,hasExplicitValues:!0}}if(Array.isArray(e)){if(!e.length)return null;if(e.length===1)return sn(e[0],t);const[r,n,o]=e;let i=typeof r=="string"?r.trim():"";if(!i&&typeof t=="string"&&(i=t.trim()),!i)return null;const s=typeof n=="string"&&n.trim()?n.trim():Do,a=e.length>2,c=a?it(o):[];return{type:i,size:s,values:c,hasExplicitValues:a}}if(re(e)){const r=ne(e);if(r)return sn(r,t)}if(typeof e=="object"){let r="";const n=["type","filter","name","label"];for(let u=0;u<n.length;u+=1){const f=n[u];if(typeof e[f]=="string"){const l=e[f].trim();if(l){r=l;break}}}if(!r&&typeof t=="string"&&t.trim()&&(r=t.trim()),!r)return null;const o=["size","filterSize","format","dimension","dimensions","diameter"];let i="";for(let u=0;u<o.length;u+=1){const f=o[u];if(typeof e[f]=="string"){const l=e[f].trim();if(l){i=l;break}}}i||(i=Do);const s=["values","value","strengths","strength","options","selected","selections","choices"];let a=!1,c=[];for(let u=0;u<s.length;u+=1){const f=s[u];if(Object.prototype.hasOwnProperty.call(e,f)){a=!0,c=it(e[f]);break}}return{type:r,size:i,values:c,hasExplicitValues:a}}return null}function qi(e){if(!e||!e.type)return null;const t=e.type,r=e.size&&e.size.trim()?e.size.trim():Do;let n=`${t}:${r}`;const o=Array.isArray(e.values)?Array.from(new Set(e.values.map(i=>typeof i=="string"?i.trim():String(i??"").trim()).filter(i=>i))):[];return(e.hasExplicitValues||o.length)&&(n+=o.length?`:${o.join("|")}`:":!"),n}function fi(e){if(e===void 0)return null;if(e===null)return"";if(typeof e=="string"){const t=e.trim();if(!t)return"";const r=Ae(t);return r.success?fi(r.parsed):t}if(Array.isArray(e)){const t=e.map(r=>sn(r)).filter(Boolean);return t.length?t.map(r=>qi(r)).filter(Boolean).join(","):""}if(re(e)){const t=ne(e);if(t)return fi(t)}if(typeof e=="object"){const t=sn(e);if(t)return qi(t)||"";const r=[];return Object.entries(e).forEach(([n,o])=>{const i=sn(o,n);i&&r.push(i)}),r.length?r.map(n=>qi(n)).filter(Boolean).join(","):""}return String(e).trim()}function Hi(e){if(!w(e))return;const t=fi(e.filter);if(t!==null)t?e.filter=t:delete e.filter;else{const r=fi(e.filters);r!==null&&(r?e.filter=r:delete e.filter)}Object.prototype.hasOwnProperty.call(e,"filters")&&delete e.filters}function Gn(e){if(!w(e))return null;const t=n=>{if(Array.isArray(n))return n.map(i=>t(i)).filter(i=>i!==void 0);if(w(n)){const o={};return Object.entries(n).forEach(([i,s])=>{if(typeof i!="string"||!i)return;const a=t(s);a!==void 0&&(o[i]=a)}),o}if(n==null)return"";if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean")return String(n);try{return String(n)}catch{}return""},r={};return Object.entries(e).forEach(([n,o])=>{if(typeof n!="string"||!n)return;const i=t(o);i!==void 0&&(r[n]=i)}),Object.keys(r).length?r:null}function Dn(e){if(e==null)return null;const t=o=>typeof o=="string"?o.trim():o==null?"":typeof o=="number"||typeof o=="boolean"?String(o):"";if(!w(e))return null;const r={batteryPlate:t(e.batteryPlate),battery:t(e.battery),batteryHotswap:t(e.batteryHotswap)};return Object.keys(r).some(o=>r[o])?r:null}function wm(e){const t=Dn(e);return t?{batteryPlate:t.batteryPlate,battery:t.battery,batteryHotswap:t.batteryHotswap}:null}const Am=new Set(["name","lensname","label","title","text","lens","mount","mountlabel","mountname","mounts","note","notes","names","values","selection","legacyvalue","lensselections","selections","entries","items","options","meta","metadata","count","version","length","size","updated","created","createdat","timestamp","id","uuid","key","value"]);function Zu(e){if(typeof e!="string")return!1;const t=e.trim();if(!t||/^[0-9]+$/u.test(t))return!1;const r=t.toLowerCase();return!(r.startsWith("__proto__")||r==="prototype"||r==="constructor"||Am.has(r))}function ef(e){if(!w(e))return[];const t=Object.keys(e),r=[];return t.forEach(n=>{if(!Zu(n))return;const o=n.trim();o&&r.push(o)}),r}function Te(e){if(e==null)return"";if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return(typeof e=="string"?e:String(e)).trim();if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Te(e[t]);if(r)return r}return""}if(re(e)){const t=ne(e);if(t)return Te(t)}if(w(e)){const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i=="string"){const s=i.trim();if(s)return s}}const r=ef(e);if(r.length)return r[0];if(Array.isArray(e.names)&&e.names.length){const o=Te(e.names[0]);if(o)return o}if(Array.isArray(e.values)&&e.values.length){const o=Te(e.values[0]);if(o)return o}const n=Object.values(e);for(let o=0;o<n.length;o+=1){const i=Te(n[o]);if(i)return i}}return""}function We(e){if(e==null)return[];if(Array.isArray(e)){const t=[];return e.forEach(r=>{if(r==null)return;if(typeof r=="string"){const o=Ae(r);if(o.success){t.push(...We(o.parsed));return}const i=r.trim();i&&t.push(i);return}if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint"){t.push(String(r));return}const n=Te(r);if(n){t.push(n);return}if(Array.isArray(r)){t.push(...We(r));return}if(re(r)){const o=ne(r);o&&t.push(...We(o));return}w(r)&&t.push(...We(Object.values(r)))}),t}if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return[String(e)];if(typeof e=="string"){const t=Ae(e);return t.success?We(t.parsed):e.split(/[\n,;]/u).map(r=>r.trim()).filter(r=>r)}if(re(e)){const t=ne(e);if(t)return We(t)}if(w(e)){const t=ef(e);if(t.length)return t;const r=Te(e);if(r)return[r];const n=[];return Array.isArray(e.names)&&n.push(...We(e.names)),Array.isArray(e.values)&&n.push(...We(e.values)),n.length||n.push(...We(Object.values(e))),n}return[]}function tf(e){const t=We(e),r=Array.isArray(e)&&e.length===t.length&&e.every((n,o)=>typeof n=="string"&&n.trim()===t[o]);return{names:t,changed:!r}}function Ko(e){if(e==null)return{selection:null,changed:!1};if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"){const t=Te(e);return t?{selection:{name:t,mount:""},changed:!0}:{selection:null,changed:!0}}if(re(e)){const t=ne(e);if(t)return Ko(t)}if(Array.isArray(e)){if(!e.length)return{selection:null,changed:!0};const t=Te(e[0]);if(!t)return{selection:null,changed:!0};const r=e.length>1?e[1]:"",n=typeof r=="string"?r.trim():"",o={name:t};return o.mount=n||"",{selection:o,changed:!0}}if(w(e)){const t={...e};let r=!1;const n=Te(e);if(!n)return{selection:null,changed:!0};t.name!==n&&(t.name=n,r=!0),Object.prototype.hasOwnProperty.call(t,"name")||(t.name=n,r=!0);const o=[];if(typeof e.mount=="string"&&o.push(e.mount),typeof e.mountLabel=="string"&&o.push(e.mountLabel),typeof e.mountName=="string"&&o.push(e.mountName),Array.isArray(e.mounts))for(let s=0;s<e.mounts.length;s+=1){const a=e.mounts[s];if(typeof a=="string"&&a.trim()){o.push(a);break}}let i="";for(let s=0;s<o.length;s+=1){const a=o[s];if(typeof a=="string"){const c=a.trim();if(c){i=c;break}}}if(typeof t.mount=="string"){const s=t.mount.trim();s!==t.mount&&(t.mount=s,r=!0),!i&&s&&(i=s)}return i||(i=""),t.mount!==i&&(t.mount=i,r=!0),Object.prototype.hasOwnProperty.call(t,"mount")||(t.mount=i,r=!0),{selection:t,changed:r}}return{selection:null,changed:!0}}function wa(e){if(!w(e))return[];const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let n=0;n<t.length;n+=1){const o=t[n];if(typeof o=="string"&&o.trim())return[]}const r=[];return Object.entries(e).forEach(([n,o])=>{if(!Zu(n))return;const i=n.trim();if(!i)return;let s=o;if(re(s)){const u=ne(s);u&&(s=u)}if(w(s)){const u={...s};u.name=i;let f="";const l=["mount","mountLabel","mountName"];for(let y=0;y<l.length;y+=1){const p=l[y];if(typeof u[p]!="string")continue;const d=u[p].trim();if(d&&d.toLowerCase()!==i.toLowerCase()){f=d;break}}if(!f&&Array.isArray(u.mounts)){const y=Te(u.mounts);y&&y.toLowerCase()!==i.toLowerCase()&&(f=y)}u.mount=typeof f=="string"?f:"",r.push(u);return}if(Array.isArray(s)){const u=Te(s),f=u&&u.toLowerCase()!==i.toLowerCase()?u:"";r.push({name:i,mount:f});return}if(typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"){const u=Te(s),f=u&&u.toLowerCase()!==i.toLowerCase()?u:"";r.push({name:i,mount:f});return}if(s==null){r.push({name:i,mount:""});return}const a=Te(s),c=a&&a.toLowerCase()!==i.toLowerCase()?a:"";r.push({name:i,mount:c})}),r}function Cs(e,t=[]){const r=Array.isArray(e)?e:[e],n=[],o=new Set;let i=!1;const s=(c,u)=>{if(!c||typeof c!="object"){u&&(i=!0);return}const f={...c},y=(typeof f.name=="string"?f.name:"").trim();if(!y){u&&(i=!0);return}f.name!==y&&(f.name=y,u=!0);const d=(typeof f.mount=="string"?f.mount:"").trim();if(f.mount!==d&&(f.mount=d,u=!0),Object.prototype.hasOwnProperty.call(f,"mount")||(f.mount=d,u=!0),Object.prototype.hasOwnProperty.call(f,"mountState")){const m=(typeof f.mountState=="string"?f.mountState:"").trim();f.mountState!==m&&(f.mountState=m,u=!0),m||(delete f.mountState,u=!0)}u&&(i=!0),n.push(f),o.add(y)},a=c=>{if(c==null)return;if(typeof c=="string"){const f=Ae(c);if(f.success){a(f.parsed),i=!0;return}const l=We(c);l.length?l.forEach(y=>{s({name:y,mount:""},!0)}):i=!0;return}if(typeof c=="number"||typeof c=="boolean"||typeof c=="bigint"){s({name:String(c),mount:""},!0);return}if(Array.isArray(c)){if(c.length&&c.length<=2&&(typeof c[0]=="string"||typeof c[0]=="number"||typeof c[0]=="boolean"||typeof c[0]=="bigint")){const{selection:f,changed:l}=Ko(c);if(f){s(f,l);return}}c.forEach(f=>{const{selection:l,changed:y}=Ko(f);l?s(l,y):y&&(i=!0)});return}if(re(c)){const f=ne(c);f&&(a(f),i=!0);return}if(w(c)){const f=wa(c);if(f.length){f.forEach(d=>{s(d,!0)});return}const{selection:l,changed:y}=Ko(c);if(l){s(l,y);return}const p=Object.values(c);p.length&&(a(p),i=!0);return}const u=Te(c);u?s({name:u,mount:""},!0):i=!0};for(let c=0;c<r.length;c+=1)a(r[c]);return Array.isArray(t)&&t.forEach(c=>{if(typeof c!="string")return;const u=c.trim();!u||o.has(u)||(n.push({name:u,mount:""}),o.add(u),i=!0)}),n.length?{selections:n,changed:i}:{selections:null,changed:i}}function Fe(e){const t=Ii(e);if(t.restored)return Fe(t.value);if(typeof e=="string"){const r=Ae(e);if(r.success){const n=Fe(r.parsed);if(n)return n}return Fe({gearList:e,projectInfo:null})}if(re(e)){const r=ne(e);return r?Fe(r):null}if(w(e)){if(Object.prototype.hasOwnProperty.call(e,"gearList")||Object.prototype.hasOwnProperty.call(e,"projectInfo")){const r=re(e.project)?ne(e.project):e.project;let n=e.projectInfo;re(n)&&(n=ne(n));let o=w(n)?n:null;if(!o&&typeof n=="string"){const S=Ae(n);S.success&&w(S.parsed)&&(o=S.parsed)}if(!o&&w(r)){let S=r.projectInfo;if(re(S)&&(S=ne(S)),w(S))o=S;else if(typeof S=="string"){const E=Ae(S);E.success&&w(E.parsed)&&(o=E.parsed)}}let i=null;const s=S=>{if(i&&i.length||S==null)return;let E=S;if(re(E)){const R=ne(E);R&&(E=Object.values(R).filter(x=>x!=null))}if(Array.isArray(E)&&E.length){i=E;return}if(w(E)){const R=Object.values(E).filter(x=>x!=null);if(R.length){i=R;return}}if(typeof E=="string"){const R=Ae(E);R.success&&Array.isArray(R.parsed)&&R.parsed.length&&(i=R.parsed)}};s(e.autoGearRules),!i&&w(r)&&s(r.autoGearRules);let a=re(e.gearList)?ne(e.gearList):e.gearList;if((a==null||typeof a=="string"&&!a)&&w(r)&&Object.prototype.hasOwnProperty.call(r,"gearList")&&(a=r.gearList),re(a)){const S=ne(a);S&&(a=S)}let c=typeof a=="string"||a&&typeof a=="object"?a:"",u=null;const f=re(e.gearSelectors)?ne(e.gearSelectors):e.gearSelectors;if(w(f))u=Gn(f);else if(typeof f=="string"){const S=Ae(f);S.success&&w(S.parsed)&&(u=Gn(S.parsed))}const l=re(e.powerSelection)?ne(e.powerSelection):e.powerSelection;let y=Dn(l);if(!y&&w(l)&&(y=Dn(l)),typeof c=="string"){const S=Ae(c);if(S.success){const E=Fe(S.parsed);E?(c=E.gearList,!o&&E.projectInfo&&(o=E.projectInfo),(!i||!i.length)&&Array.isArray(E.autoGearRules)&&E.autoGearRules.length&&(i=E.autoGearRules),!u&&w(E.gearSelectors)&&(u=Gn(E.gearSelectors)),!y&&w(E.powerSelection)&&(y=Dn(E.powerSelection))):(typeof S.parsed=="string"||w(S.parsed)&&Object.values(S.parsed).every(R=>typeof R=="string"))&&(c=S.parsed)}}c&&typeof c=="object"&&!w(c)&&(c=""),o&&Hi(o),o&&(o=Xu(o)||null),o&&Hi(o);const p={gearList:Array.isArray(c)||w(c)?An(c):c,projectInfo:o?jo(o):null},d=re(e.diagramPositions)?ne(e.diagramPositions):e.diagramPositions;let g=As(d);if(Object.keys(g).length===0&&w(r)){const S=re(r.diagramPositions)?ne(r.diagramPositions):r.diagramPositions;g=As(S)}Object.keys(g).length&&(p.diagramPositions=Em(g));const m=[];if(typeof e.projectHtml=="string"&&m.push(e.projectHtml),typeof e.gearHtml=="string"&&m.push(e.gearHtml),w(r)&&(typeof r.projectHtml=="string"&&m.push(r.projectHtml),typeof r.gearHtml=="string"&&m.push(r.gearHtml)),w(a)&&typeof a.gearHtml=="string"&&m.push(a.gearHtml),w(c)?(typeof c.projectHtml=="string"&&m.push(c.projectHtml),typeof c.gearHtml=="string"&&m.push(c.gearHtml)):typeof c=="string"&&m.push(c),!u&&w(r)){const S=re(r.gearSelectors)?ne(r.gearSelectors):r.gearSelectors;w(S)&&(u=Gn(S))}if(!u&&w(c)&&w(c.gearSelectors)&&(u=Gn(c.gearSelectors)),!y&&w(r)){const S=re(r.powerSelection)?ne(r.powerSelection):r.powerSelection;w(S)&&(y=Dn(S))}if(o){if(m.length)for(let S=0;S<m.length;S+=1){const E=Cc(m[S]);if(E){const R=jo(E)||{},x=jo(o)||{};p.projectInfo={...R,...x};break}}}else for(let S=0;S<m.length;S+=1){const E=Cc(m[S]);if(E){p.projectInfo=jo(E);break}}const b=[],O=new Set,A=S=>{if(typeof S!="string")return;const E=S.trim();!E||O.has(E)||(O.add(E),b.push(E))},C=(S,E={})=>{if(S==null)return;if(E.fromSelections){(Array.isArray(S)?S:[S]).forEach(L=>{if(re(L)){const M=ne(L);if(M){C(M,{fromSelections:!0});return}}if(w(L)){const M=wa(L);if(M.length){M.forEach(z=>{z&&typeof z.name=="string"&&A(z.name)});return}}const N=Te(L);N&&A(N)});return}const R=We(S);R.length&&R.forEach(x=>{A(x)})};if(p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lenses")){const{names:S}=tf(p.projectInfo.lenses);p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=S.slice(),C(S)}C(e.lenses),w(r)&&C(r.lenses),C(a&&a.lenses),w(c)&&C(c.lenses),(!p.projectInfo||!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&b.length&&(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=b.slice());const _=[];p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&(C(p.projectInfo.lensSelections,{fromSelections:!0}),_.push(p.projectInfo.lensSelections)),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&(C(e.lensSelections,{fromSelections:!0}),_.push(e.lensSelections)),w(r)&&Object.prototype.hasOwnProperty.call(r,"lensSelections")&&(C(r.lensSelections,{fromSelections:!0}),_.push(r.lensSelections)),w(a)&&Object.prototype.hasOwnProperty.call(a,"lensSelections")&&(C(a.lensSelections,{fromSelections:!0}),_.push(a.lensSelections)),w(c)&&Object.prototype.hasOwnProperty.call(c,"lensSelections")&&(C(c.lensSelections,{fromSelections:!0}),_.push(c.lensSelections));const k=Cs(_,b);k&&k.selections&&k.selections.length?(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lensSelections=k.selections,(!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&(p.projectInfo.lenses=k.selections.map(S=>typeof S.name=="string"?S.name:"").filter(S=>S))):k&&k.changed&&p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&delete p.projectInfo.lensSelections;const j=typeof e.gearListAndProjectRequirementsGenerated=="boolean"?e.gearListAndProjectRequirementsGenerated:m.some(S=>typeof S=="string"&&S.trim());if(p.gearListAndProjectRequirementsGenerated=j,i&&i.length&&(p.autoGearRules=Sm(i)),u&&Object.keys(u).length&&(p.gearSelectors=u),y&&(p.powerSelection=wm(y)),qy(e,p),p.projectInfo&&Hi(p.projectInfo),p.projectInfo){const S=fe(p.projectInfo);S!==p.projectInfo&&(p.projectInfo=S)}if(p.autoGearRules){const S=fe(p.autoGearRules);S!==p.autoGearRules&&(p.autoGearRules=S)}if(p.gearSelectors){const S=fe(p.gearSelectors);S!==p.gearSelectors&&(p.gearSelectors=S)}if(p.diagramPositions){const S=fe(p.diagramPositions);S!==p.diagramPositions&&(p.diagramPositions=S)}if(p.powerSelection){const S=fe(p.powerSelection);S!==p.powerSelection&&(p.powerSelection=S)}return p}if(Object.prototype.hasOwnProperty.call(e,"projectHtml")||Object.prototype.hasOwnProperty.call(e,"gearHtml"))return{gearList:{projectHtml:e.projectHtml||"",gearHtml:e.gearHtml||""},projectInfo:null};if(w(e.project)){const r=Fe(e.project);if(r)return r}else if(typeof e.project=="string"){const r=Ae(e.project);if(r.success){const n=Fe(r.parsed);if(n)return n}}}return null}var Om=new Set(["gearList","projectInfo","projectHtml","gearHtml","autoGearRules","powerSelection","gearListAndProjectRequirementsGenerated"]),Cm=new Set(["gearList","projectInfo","autoGearRules","diagramPositions","gearSelectors","powerSelection","gearListAndProjectRequirementsGenerated"]);function pi(e){if(!w(e)||!Object.keys(e).every(o=>Cm.has(o)))return!1;const{gearList:r,projectInfo:n}=e;if(typeof r!="string"&&!(w(r)&&Object.keys(r).every(o=>typeof r[o]=="string"))||n!==null&&!w(n)||Object.prototype.hasOwnProperty.call(e,"autoGearRules")&&(!Array.isArray(e.autoGearRules)||!e.autoGearRules.length)||Object.prototype.hasOwnProperty.call(e,"diagramPositions")&&!w(e.diagramPositions)||Object.prototype.hasOwnProperty.call(e,"gearSelectors")&&!w(e.gearSelectors))return!1;if(Object.prototype.hasOwnProperty.call(e,"powerSelection")){const o=e.powerSelection;if(!w(o))return!1}return!(Object.prototype.hasOwnProperty.call(e,"gearListAndProjectRequirementsGenerated")&&typeof e.gearListAndProjectRequirementsGenerated!="boolean")}function Ge(e){return typeof e!="string"?"":e.trim()}function _m(e){if(e==null)return Bt="",At=!1,"";const t=Ge(e);return Sg(t)?(Bt="",At=!1,t):(Bt=t,At=!0,t)}function km(e){return!At||e!==void 0&&Ge(e)!==Bt?!1:(Bt="",At=!1,!0)}function xr(e,t,r,n={}){if(!e||typeof e!="object")return null;const o=typeof r=="string"?r:"";if(Object.prototype.hasOwnProperty.call(e,o))return o;const i=Ge(o);if(i&&i!==o&&Object.prototype.hasOwnProperty.call(e,i))return i;if(!t||typeof t!="object")return null;const{raw:s,normalized:a}=t;if(s&&typeof s.get=="function"&&s.has(o)){const c=s.get(o);if(Object.prototype.hasOwnProperty.call(e,c))return c}if(a&&typeof a.get=="function"&&a.has(i)){const c=a.get(i);if(Array.isArray(c)){if(n&&n.preferExact&&o){const f=c.find(l=>l===o&&Object.prototype.hasOwnProperty.call(e,l));if(f)return f}const u=c.find(f=>Object.prototype.hasOwnProperty.call(e,f));if(u)return u}else if(typeof c=="string"&&Object.prototype.hasOwnProperty.call(e,c))return c}return null}function yt(e={}){const{forceRefresh:t=!1,forMutation:r=!1,skipMigrations:n=!1,skipAutoBackupExpansion:o=!1}=e||{};if(n||_e(),gn)return{projects:{...Mt},changed:!1,originalValue:{...Mt},lookup:{raw:new Map,normalized:new Map}};const i=T();let s=null;if(i&&typeof i.getItem=="function")try{s=i.getItem(pe)}catch{s=null}const a=Le(i,pe,"Error loading project from localStorage:",null,{validate:E=>E===null||typeof E=="string"||Array.isArray(E)||w(E)}),c=a;let u=null;if(w(a)?u={...a}:u={},i&&typeof i.length=="number"){const E=i.length;for(let R=0;R<E;R++){const x=i.key(R);if(!x||!x.startsWith(wt))continue;const L=x.substring(wt.length);if(L!=null)try{const N=i.getItem(x),M=JSON.parse(Ar(N));u===null&&(u={}),u[L]=M}catch{}}}let f=a;(u!==null&&Object.keys(u).length>0||w(a))&&(f=u);const l={isAutoBackupKey:Ct};o&&(l.filter=E=>!Ct(E));const y=Cu(f,l),p={};let d=!1;const g=new Set,m=new Set,b=E=>{if(typeof E!="string")return;g.add(E);const R=E.trim();R&&m.add(R.toLowerCase())},O=new Map,A=new Map,C=(E,R)=>{if(typeof E!="string")return;const x=typeof R=="string"?R:E;O.set(E,x);const L=Ge(E);A.has(L)||A.set(L,[]),A.get(L).push(x)},_=()=>({raw:hn(O),normalized:hn(A)}),k=()=>{const E={projects:p,changed:d,originalValue:c,lookup:_(),rawValue:s};return d?(ac(null),r?{projects:Jt(E.projects),changed:E.changed,originalValue:E.originalValue,lookup:gu(E.lookup)}:E):t?E:(ac(E),Gy({forMutation:r})||E)};if(y==null)return k();if(typeof y=="string"){const E=Fe(y);if(E){const R=E&&E.projectInfo&&typeof E.projectInfo.projectName=="string"?E.projectInfo.projectName:"",x=zn(R,g,m);p[x]=E,C("",x),b(x)}return d=!0,k()}if(Array.isArray(y)){const E=g,R=m;return y.forEach((x,L)=>{const N=Fe(x);if(!N){d=!0;return}const z=(w(x)&&typeof x.name=="string"?x.name.trim():`Project ${L+1}`)||`Project ${L+1}`,$=zn(z,E,R);p[$]=N,C(z,$),b($)}),d=!0,k()}if(!w(y))return d=!0,k();const j=Object.keys(y);if(j.length>0&&j.every(E=>Om.has(E))){const E=Fe(y);if(E){const R=zn("",g,m);p[R]=E,C("",R),b(R)}return d=!0,k()}return j.forEach(E=>{if(pi(y[E])){const R=typeof E=="string"?E.trim():"";R&&m.add(R.toLowerCase())}}),j.forEach(E=>{const R=Fe(y[E]);if(R){const x=y[E],N=!pi(x);let M=!1;if(!N)try{const $=Ce(R),kt=Ce(x);$!==kt&&(M=!0)}catch($){M=!0,console.warn("Unable to compare stored project entry during legacy long-GOP normalization check",$)}let z=E;if(N){const $=R&&R.projectInfo&&typeof R.projectInfo.projectName=="string"&&R.projectInfo.projectName?R.projectInfo.projectName:E;z=zn($,g,m),d=!0}z!==E&&Object.prototype.hasOwnProperty.call(p,z)&&(z=zn(z,g,m)),p[z]=R,C(E,z),b(z),!N&&M&&(d=!0)}else d=!0}),k()}function rf(e,t){if(!e||typeof e.length!="number"||!w(t))return;const r=new Set(Object.keys(t).map(o=>Ge(o))),n=[];for(let o=0;o<e.length;o+=1){const i=e.key(o);if(i&&i.startsWith(wt)){const s=i.substring(wt.length);r.has(s)||n.push(i)}}n.forEach(o=>ce(e,o,"Pruning orphan project shard:"))}function nf(e){if(!e||h&&h.__cineMonolithicProjectCleanupDone)return;const t=e.getItem(pe);if(!t){h&&(h.__cineMonolithicProjectCleanupDone=!0);return}try{const r=JSON.parse(Ar(t));r&&rt(e,pe,r)}catch{}ce(e,pe,"Error clearing project monolithic storage after sharding:",{disableBackup:!1,disableMigrationCleanup:!0}),h&&(h.__cineMonolithicProjectCleanupDone=!0)}function of(e,t,r={}){if(e==null||t===void 0||t===null)return!1;const n=T();if(!n)return!1;const{skipCompression:o=!1}=r||{},i=wt+Ge(e),s={};s[e]=t;const c=_u(s,{isAutoBackupKey:Ct})[e];return ke(n,i,c,`Error saving project shard "${e}":`,{disableCompression:o,forceCompressionOnQuota:!0,disableBackup:!0,onQuotaExceeded:()=>{const{projects:f}=yt({forMutation:!1,skipMigrations:!0});let l=Ss(f);if(l||(l=Ss(f,{force:!0})),l){const y=wt+Ge(l);return ce(n,y,`Pruning shard "${l}" to recover space:`),!0}return!1}})==="success"}function Aa(e,t={}){const{skipCompression:r=!1}=t||{},n=T();if(!(!e||typeof e!="object")){ga(e),rf(n,e),Object.keys(e).forEach(o=>{of(o,e[o],{skipCompression:r})}),nf(n),aa(n);try{sf(e,n)}catch(o){console.warn("Failed to update project index",o)}if($t(),je)try{je.postMessage("project-shards-changed")}catch{}}}let di=null;function Pm(){if(di)return di;const e=T(),t=K&&K.driver&&K.driver.constructor&&K.driver.constructor.name==="IndexedDBAdapter";if(!e||typeof e.getItem!="function"||t)return null;try{const r=e.getItem(ii);if(!r)return null;const n=JSON.parse(r);if(n&&typeof n=="object")return n}catch(r){console.warn("Failed to read project index",r)}return null}function sf(e,t){if(!e||typeof e!="object")return;const r={};Object.keys(e).forEach(o=>{if(Ct(o))return;const i=e[o];i&&(r[o]={color:i.color,icon:i.icon,lastModified:i.lastModified,prepDays:i.prepDays,shootingDays:i.shootingDays,returnDays:i.returnDays,archived:i.archived,status:i.status})}),di=r;const n=K&&K.driver&&K.driver.constructor&&K.driver.constructor.name==="IndexedDBAdapter";if(K&&K.setItem(ii,r).catch(o=>console.warn("Failed to persist index to repo",o)),!n&&t&&typeof t.setItem=="function")try{t.setItem(ii,JSON.stringify(r))}catch(o){console.warn("Failed to write project index",o)}}function af(e){const t=e!==void 0&&!(typeof e=="string"&&Ct(e));let{projects:r,changed:n,originalValue:o,lookup:i}=yt({skipAutoBackupExpansion:t}),s=null;if(e!==void 0&&(s=xr(r,i,e,{preferExact:!0}),s!=null&&Ri(s)),n){const a=T();a&&rt(a,pe,o);const c=Jt(r);Aa(c),r=c}if(e===void 0)return hg(r),r;if(s!=null&&Object.prototype.hasOwnProperty.call(r,s)){const a=r[s];if(a&&(!a.gearList||a.gearList==="")){const u=ho()[s];u&&u.gearList&&(a.gearList=u.gearList)}return a}return null}function jm(){const e=Pm();if(e)return e;const t=yt({forMutation:!1,skipAutoBackupExpansion:!0}),r={};if(t&&t.projects){const n=Object.keys(t.projects);for(let i=0;i<n.length;i++){const s=n[i];if(Ct(s))continue;const a=t.projects[s];a&&(r[s]={color:a.color,icon:a.icon,lastModified:a.lastModified,prepDays:a.prepDays,shootingDays:a.shootingDays,returnDays:a.returnDays,archived:a.archived,status:a.status})}const o=T();if(o)try{sf(t.projects,o)}catch{}}return r}function cf(e){if(typeof e!="string")return"";const t=e.replace(/\s+/g," ").trim();return t?t.length<=120?t:t.slice(0,120):""}function lf(e){const t=r=>String(r).padStart(2,"0");return[e.getFullYear(),t(e.getMonth()+1),t(e.getDate()),t(e.getHours()),t(e.getMinutes()),t(e.getSeconds())].join("-")}function vm(e,t){const n=lf(new Date),o=cf(e),i=o?`${pt}${n}-${o}`:`${pt}${n}`,s=new Set(Object.keys(t));if(!s.has(i))return{name:i};let a=2,c=`${i}-${a}`;for(;s.has(c);)a+=1,c=`${i}-${a}`;return{name:c}}function uf(e){if(e!==void 0){if(e===null||typeof e!="object")return e;try{const t=Jt(e),r=fe(t);return r!==t?r:t}catch(t){console.warn("Unable to deep clone project for backup",t);const r={...e},n=fe(r);return n!==r?n:r}}}function ff(e,t){if(!e||!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(typeof t=="string"&&t.startsWith(Be))return{status:"skipped"};const r=e[t];if(r===void 0)return{status:"missing"};const{name:n}=vm(t,e);if(!n)return{status:"failed"};const o=uf(r);return o===void 0?(typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipping deletion backup for project "${t}" because no stored data was available during backup creation.`),{status:"missing"}):(e[n]=o,{status:"created",backupName:n})}function Im(e){const{projects:t,changed:r,originalValue:n,lookup:o}=yt({forMutation:!0});if(!t||typeof t!="object")return{status:"invalid"};const i=xr(t,o,e,{preferExact:!0}),s=Ge(e),a=i??s;if(!Object.prototype.hasOwnProperty.call(t,a))return{status:"missing"};const c=ff(t,a);if(c.status!=="created")return c;if(r){const u=T();u&&rt(u,pe,n)}return Ri(c.backupName),Aa(t),c}function Rm(e,t){const r=lf(new Date),n=cf(e),o=n?`${Be}${r}-${n}`:`${Be}${r}`,i=new Set(Object.keys(t));if(!i.has(o))return{name:o};let s=2,a=`${o}-${s}`;for(;i.has(a);)s+=1,a=`${o}-${s}`;return{name:a}}function Tm(e,t){if(!w(e)||typeof t!="string")return{status:"invalid"};if(!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(t.startsWith(Be)||t.startsWith(pt))return{status:"skipped"};const r=uf(e[t]);if(r===void 0)return{status:"failed"};const{name:n}=Rm(t,e);return n?(e[n]=r,{status:"created",backupName:n}):{status:"failed"}}function Oa(e,t,r={}){if(!w(t))return;const n=Fe(t);if(!n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped saving project "${e||""}" because the payload could not be normalised.`);return}const o=!!(r&&r.skipOverwriteBackup),i=!!(r&&r.skipCompression),s=typeof e=="string"?e:"",a=Ge(s),c=yt({forMutation:!0}),u=w(c.projects)?c.projects:{};if(c.changed){const E=T();E&&rt(E,pe,c.originalValue)}const f=xr(u,c.lookup,s,{preferExact:!0}),l=f!=null&&Object.prototype.hasOwnProperty.call(u,f)?u[f]:null,y=l?Ce(l):null,p=yt({forMutation:!0}),d=w(p.projects)?p.projects:{};if(p.changed){const E=T();E&&rt(E,pe,p.originalValue)}const g=xr(d,p.lookup,s,{preferExact:!0});let m=g,b=null;a&&a!==g&&!Object.prototype.hasOwnProperty.call(d,a)&&(m=a,b=g),m==null&&(m=a),!m&&m!==""&&(m="");const O=b??m,A=O!=null&&Object.prototype.hasOwnProperty.call(d,O),C=A?d[O]:null;if(A&&!o){const E=Ce(C),R=Ce(n);E!==R&&Tm(d,O).status==="failed"&&console.warn(`Automatic backup before overwriting project "${O}" failed. Proceeding with save.`)}if(b!=null&&b!==m){let E=!!y;Object.prototype.hasOwnProperty.call(d,b)&&y?Ce(d[b])!==y&&(E=!1):E=!1,E?(delete d[b],gs(b)):typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped removing "${b}" while saving "${m}" because the original entry changed in another tab.`)}const _=r&&r.renamedFrom;if(_&&_!==m){const E=xr(d,p.lookup,_,{preferExact:!0});E&&Object.prototype.hasOwnProperty.call(d,E)&&(delete d[E],gs(E))}const k=m||"";d[k]=n,Ri(k),ga(d),K&&K.saveProject(k,n).catch(E=>console.warn("[saveProject] Repo write failed",E)),gn&&(Mt[k]=n);const j=K&&K.driver&&K.driver.constructor&&K.driver.constructor.name==="IndexedDBAdapter";let S=!0;if(j||(S=of(k,n,{skipCompression:i})),S){const E=T();if(rf(E,d),nf(E),$t(),je)try{je.postMessage("project-shards-changed")}catch{}aa(E)}else Aa(d,{skipCompression:i})}function pf(e){if(e===void 0){const l=[T()];typeof localStorage<"u"&&l.indexOf(localStorage)===-1&&l.push(localStorage),l.forEach(p=>{if(p&&typeof p.removeItem=="function")try{p.removeItem(pe);const d=typeof de=="string"?de:"__backup";p.removeItem(`${pe}${d}`),p.removeItem("cameraPowerPlanner_project__backup")}catch(d){console.warn("[FactoryReset] Failed to force delete project keys",d)}if(ce(p,pe,"Error deleting project from storage:"),p&&typeof p.length=="number"){const d=[];for(let g=0;g<p.length;g++){const m=p.key(g);m&&m.startsWith(wt)&&d.push(m)}d.forEach(g=>ce(p,g,"Error deleting project shard from storage:"))}});try{K&&K.clear().catch(p=>console.warn("[FactoryReset] Failed to clear StorageRepository",p)),ls&&ls.clear().catch(p=>console.warn("[FactoryReset] Failed to clear DataVault",p)),or&&or.reset()}catch(p){console.warn("[FactoryReset] Error clearing modern storage",p)}if(typeof Ht=="function")try{Ht()}catch(p){console.warn("Failed to clear UI cache during project deletion",p)}if($t(),je)try{je.postMessage("project-shards-changed")}catch{}dr&&typeof dr.clear=="function"&&dr.clear();const y=T();y&&aa(y);return}const{projects:t,changed:r,originalValue:n,lookup:o}=yt({forMutation:!0});if(r){const l=T();l&&rt(l,pe,n)}const i=xr(t,o,e,{preferExact:!0}),s=i??Ge(e);if(!Object.prototype.hasOwnProperty.call(t,s)){const l=wt+Ge(e),y=T();y&&ce(y,l,"Error deleting orphan project shard:");return}if(ff(t,s).status==="failed"){console.warn(`Automatic backup before deleting project "${s}" failed. Deletion aborted.`),le();return}const c=wt+Ge(s),u=T(),f=K&&K.driver&&K.driver.constructor&&K.driver.constructor.name==="IndexedDBAdapter";if(u&&!f&&ce(u,c,"Error deleting project shard:"),gn&&delete Mt[s],K.removeItem(s).catch(l=>console.warn("Failed to delete from repo",l)),delete t[s],gs(s),$t(),je)try{je.postMessage("project-shards-changed")}catch{}}function Lm(e,t){if(!e||!t)return null;const{projects:r}=yt({forMutation:!0}),n=xr(r,null,e,{preferExact:!0});if(!n||!r[n])return null;const o=t.trim();if(!o||o===n)return n;const i=r[n];if(i.name=o,gn?(delete Mt[n],Mt[o]=i):(delete r[n],r[o]=i),K.removeItem(n).catch(s=>console.warn("Failed to delete old project key",s)),Oa(o,i),$t(),je)try{je.postMessage("project-shards-changed")}catch{}return o}function _c(){const{projects:e,changed:t,originalValue:r}=yt({forMutation:!0});if(t){const s=T();s&&rt(s,pe,r)}const n=new Set(Object.keys(e)),o=new Set([...n].map(s=>s.trim().toLowerCase())),i="Imported project";return(s,a,c=i)=>{const u=Fe(a);if(!u)return;!(a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"gearListAndProjectRequirementsGenerated")&&typeof a.gearListAndProjectRequirementsGenerated=="boolean")&&typeof u.gearListAndProjectRequirementsGenerated!="boolean"&&(u.gearListAndProjectRequirementsGenerated=!1);const l=[];if(typeof s=="string"&&l.push(s.trim()),w(a)){typeof a.name=="string"&&l.push(a.name.trim());const m=a.projectInfo;w(m)&&typeof m.projectName=="string"&&l.push(m.projectName.trim())}const y=typeof c=="string"&&c.trim()?c.trim():i,p=l.length>0?l[0]:y,d=typeof p=="string"?p.trim().toLowerCase():"",g=o.has(d)?em(p,n,o):ma(p,n,o);Oa(g,u,{skipCompression:!1})}}function Ae(e){if(typeof e!="string")return{success:!1,parsed:null};const t=e.trim();if(!t)return{success:!1,parsed:null};const r=t[0],n=t[t.length-1];let o=null;if(r==="{"?o="}":r==="["?o="]":r==='"'&&(o='"'),!o||n!==o)return{success:!1,parsed:null};try{return{success:!0,parsed:JSON.parse(t)}}catch{return{success:!1,parsed:null}}}function Jn(e,t,r="Imported project"){if(typeof e=="string"){const n=Ae(e);return n.success?Jn(n.parsed,t,r):(t()(r,e,r),!0)}if(re(e)){const n=ne(e);return n?Jn(Object.entries(n),t,r):!1}if(Array.isArray(e)){const n=e.map(s=>s==null?null:Array.isArray(s)&&s.length>=2?{name:s[0],project:s[1]}:w(s)&&typeof s.name=="string"?{name:s.name,project:s}:{name:"",project:s}).filter(Boolean);if(!n.length)return!0;const o=t();let i=0;return n.forEach(({name:s,project:a})=>{if(a==null)return;i+=1;let c="";typeof s=="string"?c=s:typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"?c=String(s):typeof s=="symbol"&&(c=s.description||s.toString()),o(c,a,`${r} ${i}`)}),!0}if(w(e)){const n=t();return Object.entries(e).forEach(([o,i])=>{const s=typeof o=="string"?o:xu(o);n(typeof s=="string"&&s?s:r,i,r)}),!0}return!1}function Mm(e){if(!e||typeof e!="object")return[];const t=[],r=i=>{i!=null&&t.push(i)};["projectData","projectCollection","projectEntries","legacyProjects","legacyProjectData"].forEach(i=>{Object.prototype.hasOwnProperty.call(e,i)&&r(e[i])}),w(e.data)&&(Object.prototype.hasOwnProperty.call(e.data,"project")&&r(e.data.project),Object.prototype.hasOwnProperty.call(e.data,"projects")&&r(e.data.projects));const o=e.plannerData;return Array.isArray(o)&&o.forEach(i=>{if(Array.isArray(i)&&i.length>=2){const c=i[0];typeof c=="string"&&c.toLowerCase().includes("project")&&r(i[1]);return}if(!i||typeof i!="object")return;const s=typeof i.key=="string"?i.key:typeof i.name=="string"?i.name:typeof i.id=="string"?i.id:typeof i.section=="string"?i.section:null;if(!s||!s.toLowerCase().includes("project"))return;const a=Object.prototype.hasOwnProperty.call(i,"value")?i.value:Object.prototype.hasOwnProperty.call(i,"data")?i.data:Object.prototype.hasOwnProperty.call(i,"project")?i.project:Object.prototype.hasOwnProperty.call(i,"projects")?i.projects:null;a!=null&&r(a)}),t}function df(){_e();const e=T(),t=Le(e,zt,"Error loading favorites from localStorage:",{},{validate:r=>r===null||w(r)});return w(t)?t:{}}function yf(e){const t=T();if(e==null){ce(t,zt,"Error deleting favorites from localStorage:");return}if(!w(e)){console.warn("Ignoring invalid favorites payload. Expected a plain object.");return}$e(t,zt),ke(t,zt,e,"Error saving favorites to localStorage:")}function Nm(){if(gt||(nc||(nc=!0,yn&&(gt=yn)),gt))return gt;const e=h&&typeof h=="object"?h:null;if(e&&e.cineFeaturesContacts&&typeof e.cineFeaturesContacts=="object")return gt=e.cineFeaturesContacts,gt;const t=e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null;if(t&&typeof t.resolveModule=="function")try{const r=t.resolveModule("cine.features.contacts",e);if(r&&typeof r=="object")return gt=r,gt}catch{}return gt}function gf(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return gf(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function zm(e){if(e&&typeof e.generateContactId=="function")try{const t=e.generateContactId();if(typeof t=="string"&&t)return t}catch{}return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function Gm(e,t){if(!e||typeof e!="object")return null;const r=gf,n=r(e.id)||zm(t),o=r(e.name),i=r(e.role),s=r(e.phone),a=r(e.email),c=r(e.website||e.url),u=r(e.notes||e.note||e.text),f=typeof e.avatar=="string"?e.avatar.trim():"",l=f&&f.startsWith("data:")?f:"",y=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),p=Number.isFinite(e.updatedAt)?e.updatedAt:y,d={id:n,name:o,role:i,phone:s,email:a,website:c,notes:u,createdAt:y,updatedAt:p};return l&&(d.avatar=l),d}function Bm(e){if(!Array.isArray(e))return[];const t=e.filter(r=>r&&typeof r=="object").map(r=>({...r}));return t.sort((r,n)=>{const o=(r&&r.name?r.name:"").toLowerCase(),i=(n&&n.name?n.name:"").toLowerCase();if(o&&i&&o!==i)try{return o.localeCompare(i)}catch{}if(o&&!i)return-1;if(!o&&i)return 1;const s=r&&typeof r.createdAt=="number"?r.createdAt:0,a=n&&typeof n.createdAt=="number"?n.createdAt:0;return s-a}),t}function Ca(e){if(!Array.isArray(e))return[];const t=Nm();if(t&&typeof t.sortContacts=="function")try{const o=t.sortContacts(e);if(Array.isArray(o))return o.filter(i=>i&&typeof i=="object")}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contacts via module.",o)}const r=t&&typeof t.normalizeContactEntry=="function"?t.normalizeContactEntry:null,n=[];for(let o=0;o<e.length;o+=1){const i=e[o];if(!i)continue;let s=null;if(r)try{s=r(i)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contact entry via module.",a),s=null}s||(s=Gm(i,t)),s&&typeof s=="object"&&n.push(s)}return Bm(n)}function mf(){_e();const e=T(),t=Le(e,Gt,"Error loading contacts from localStorage:",[],{validate:r=>r===null||Array.isArray(r)});return Array.isArray(t)?Ca(t):[]}function _s(e){const t=T();if(e==null){ce(t,Gt,"Error deleting contacts from localStorage:");return}if(!Array.isArray(e)){console.warn("Ignoring invalid contacts payload. Expected an array.");return}const r=Ca(e);$e(t,Gt),ke(t,Gt,r,"Error saving contacts to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function hf(){return ru.getOwnGear()}function bf(e){return ru.saveOwnGear(e)}function Yr(e){if(typeof e=="string")return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="bigint")return e.toString();if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return Yr(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function _a(e){if(!e||typeof e!="object")return null;const t=Yr(e.name),r=Yr(e.role),n=Yr(e.avatar),o=n&&n.toLowerCase().startsWith("data:")?n:"",i=Yr(e.phone),s=Yr(e.email);return!t&&!r&&!o&&!i&&!s?{name:"",role:"",avatar:"",phone:"",email:""}:{name:t,role:r,avatar:o,phone:i,email:s}}function Sf(){_e();const e=T(),t=Le(e,lr,"Error loading user profile from localStorage:",null,{validate:r=>r===null||w(r)});return w(t)?_a(t)||{name:"",role:"",avatar:"",phone:"",email:""}:{name:"",role:"",avatar:"",phone:"",email:""}}function $o(e){const t=T();if(e==null){ce(t,lr,"Error deleting user profile from localStorage:");return}const r=_a(e)||{name:"",role:"",avatar:"",phone:"",email:""};if(!r.name&&!r.role&&!r.avatar&&!r.phone&&!r.email){ce(t,lr,"Error deleting user profile from localStorage:");return}$e(t,lr),ke(t,lr,r,"Error saving user profile to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,enableCompressionSweep:!1})}function Ef(){_e();const e=T(),t=Le(e,Nt,"Error loading feedback from localStorage:",null,{validate:r=>r===null||w(r)});return w(t)?t:{}}function wf(e){const t=T();if(e==null){ce(t,Nt,"Error deleting feedback from localStorage:");return}if(!w(e)){console.warn("Ignoring invalid feedback payload. Expected a plain object.");return}$e(t,Nt),ke(t,Nt,e,"Error saving feedback to localStorage:")}function an(e){if(!e)return null;if(typeof e=="string"){const t=e.trim();return t?{createdAt:t}:null}if(typeof e=="object"){const t=typeof e.createdAt=="string"&&e.createdAt.trim()?e.createdAt.trim():typeof e.iso=="string"&&e.iso.trim()?e.iso.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?e.timestamp.trim():null;if(!t)return null;const r={createdAt:t};return typeof e.fileName=="string"&&e.fileName.trim()?r.fileName=e.fileName.trim():typeof e.name=="string"&&e.name.trim()&&(r.fileName=e.name.trim()),r}return null}function co(){_e();const e=T(),t=Le(e,ur,"Error loading full backup history from localStorage:",[],{validate:r=>r===null||Array.isArray(r)});return Array.isArray(t)?t.map(an).filter(Boolean):[]}function yi(e){const t=T();if(e==null){ce(t,ur,"Error deleting full backup history from localStorage:");return}if(!Array.isArray(e)){console.warn("Ignoring invalid full backup history payload. Expected an array.");return}const r=e.map(an).filter(Boolean);if(!r.length){e.length===0?ce(t,ur,"Error deleting full backup history from localStorage:"):console.warn("Ignoring full backup history update because no valid entries were provided.");return}$e(t,ur),ke(t,ur,r,"Error saving full backup history to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}var Af=e=>{const t=an(e);if(!t)return co();const r=co();r.push(t);const n=r.slice(-200);return yi(n),n};function It(e,t,r=0){if(e==null)return[];if(r>50)return[];if(Array.isArray(e)){const o=[],i=e.length,s=t||new WeakSet;if(s.has(e))return[];s.add(e);for(let a=0;a<i;a+=1){const c=e[a];if(!(typeof c=="object"&&c!==null&&s.has(c)))if(Array.isArray(c)){const u=It(c,s,r+1);if(u&&u.length)for(let f=0;f<u.length;f+=1)o.push(u[f])}else{const u=an(c);u&&o.push(u)}}return o}const n=t||new WeakSet;if(typeof e=="object"&&e!==null){if(n.has(e))return[];n.add(e)}if(re(e)){const o=ne(e);return o?It(Object.values(o),n,r+1):[]}if(typeof e=="string"){const o=Ae(e);if(o.success)return It(o.parsed,n,r+1);const i=an(e);return i?[i]:[]}if(Array.isArray(e))return[];if(w(e)){if(Array.isArray(e.history))return It(e.history,n,r+1);if(Array.isArray(e.entries))return It(e.entries,n,r+1);if(Array.isArray(e.list))return It(e.list,n,r+1);const o=an(e);if(o)return[o];const i=Object.values(e);if(i.length)return It(i,n,r+1)}return[]}var gi=1;function xm(){var e=0;if(typeof Date<"u"&&Date&&typeof Date.now=="function")e=Date.now();else try{e=new Date().getTime()}catch{e=Math.floor(Math.random()*1e9)}var t=0;try{t=Math.floor(Math.random()*1e6)}catch{t=e%1e6}return"doc-tracker-"+e.toString(36)+"-"+t.toString(36)}function kc(e){var t=!1,r=null;if(e&&typeof e=="object"){typeof e.completed=="boolean"?t=e.completed:typeof e.checked=="boolean"?t=e.checked:typeof e.value=="boolean"?t=e.value:e.done===!0&&(t=!0);var n=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?n=e.updatedAt.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?n=e.timestamp.trim():typeof e.completedAt=="string"&&e.completedAt.trim()&&(n=e.completedAt.trim()),n&&(r=n)}else if(typeof e=="boolean")t=e;else if(typeof e=="string"){var o=e.trim().toLowerCase();(o==="true"||o==="1"||o==="yes"||o==="done")&&(t=!0)}return{completed:t===!0,updatedAt:typeof r=="string"?r:null}}function Fm(e){var t={};if(Array.isArray(e)){for(var r=0;r<e.length;r+=1){var n=e[r];if(n!=null){if(typeof n=="string"&&n.trim()){t[n.trim()]={completed:!0,updatedAt:null};continue}if(typeof n=="object"){var o=null;if(typeof n.id=="string"&&n.id.trim()?o=n.id.trim():typeof n.key=="string"&&n.key.trim()?o=n.key.trim():typeof n.name=="string"&&n.name.trim()&&(o=n.name.trim()),!o)continue;t[o]=kc(n)}}}return t}if(e&&(typeof e=="object"||typeof e=="function"))for(var i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(a!=null){var c=typeof a=="string"?a:String(a);if(c){var u=c.trim();u&&(t[u]=kc(e[a]))}}}return t}function Um(e){var t={};if(e&&(typeof e=="object"||typeof e=="function"))for(var r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n];o&&(t[o]=Fm(e[o]))}return t.locales||(t.locales={}),t.helpTopics||(t.helpTopics={}),t.printGuides||(t.printGuides={}),t}function Pc(e){if(!e||typeof e!="object"&&typeof e!="function")return null;var t=null;typeof e.id=="string"&&e.id.trim()&&(t=e.id.trim()),!t&&typeof e.key=="string"&&e.key.trim()&&(t=e.key.trim()),t||(t=xm());var r="";typeof e.name=="string"?r=e.name.trim():typeof e.title=="string"&&(r=e.title.trim());var n="";typeof e.targetDate=="string"&&e.targetDate.trim()?n=e.targetDate.trim():typeof e.releaseDate=="string"&&e.releaseDate.trim()&&(n=e.releaseDate.trim());var o="";if(typeof e.createdAt=="string"&&e.createdAt.trim()?o=e.createdAt.trim():typeof e.generatedAt=="string"&&e.generatedAt.trim()&&(o=e.generatedAt.trim()),!o)try{o=new Date().toISOString()}catch{o=""}var i=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?i=e.updatedAt.trim():typeof e.modifiedAt=="string"&&e.modifiedAt.trim()?i=e.modifiedAt.trim():typeof e.lastUpdated=="string"&&e.lastUpdated.trim()?i=e.lastUpdated.trim():typeof e.timestamp=="string"&&e.timestamp.trim()&&(i=e.timestamp.trim()),i||(i=o||null);var s="";typeof e.notes=="string"?s=e.notes.trim():typeof e.summary=="string"&&(s=e.summary.trim()),s&&s.length>8e3&&(s=s.slice(0,8e3));var a=!1;if(typeof e.archived=="boolean")a=e.archived;else if(typeof e.status=="string"){var c=e.status.trim().toLowerCase();(c==="archived"||c==="closed"||c==="complete")&&(a=!0)}var u=Um(e.statuses);return{id:t,name:r,targetDate:n,createdAt:typeof o=="string"?o:"",updatedAt:typeof i=="string"?i:null,statuses:u,notes:s,archived:a===!0}}function Qn(e){var t={version:gi,releases:[]};if(e==null)return t;var r=e;if(Array.isArray(r))return t.releases=r.map(Pc).filter(Boolean),t;if(typeof r!="object"&&typeof r!="function")return t;typeof r.version=="number"&&Number.isFinite(r.version)&&(t.version=r.version);var n=null;if(Array.isArray(r.releases)?n=r.releases:Array.isArray(r.entries)?n=r.entries:Array.isArray(r.logs)&&(n=r.logs),!n&&r&&typeof r=="object"){var o=Object.values(r);o.length&&o.every(function(i){return i&&typeof i=="object"&&!Array.isArray(i)})&&(n=o)}return!n||!Array.isArray(n)?t.releases=[]:t.releases=n.map(Pc).filter(Boolean),t}function Of(){_e();const e=T(),t=Le(e,Tt,"Error loading documentation tracker from localStorage:",null,{validate:n=>n===null||w(n)||Array.isArray(n)});if(!t)return{version:gi,releases:[]};const r=Qn(t);return!r||!Array.isArray(r.releases)?{version:gi,releases:[]}:r}function Vo(e){const t=T();if(e==null){ce(t,Tt,"Error deleting documentation tracker from localStorage:");return}const r=Qn(e);if(!r.releases.length){ce(t,Tt,"Error deleting documentation tracker from localStorage:");return}$e(t,Tt),ke(t,Tt,{version:gi,releases:r.releases},"Error saving documentation tracker to localStorage:",{disableCompression:!0})}function Cf(){_e();const e=T(),t=Le(e,br,"Error loading automatic gear rules from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?fe(r):[];if(n!==r&&ka(n,{skipNormalization:!0}),Array.isArray(n)){let o=!1;const i=n.map(s=>s&&typeof s=="object"&&typeof s.enabled>"u"?(o=!0,{...s,enabled:!0}):s);return o?i:n}return[]}function ka(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],i=n?o:Array.isArray(o)?fe(o):[],s=T();return $e(s,br),ke(s,br,i,"Error saving automatic gear rules to localStorage:",{disableCompression:!0}),i}function Pa(){_e();const e=T(),t=Le(e,Wt,"Error loading automatic gear rule backups from localStorage:",[],{validate:i=>i===null||Array.isArray(i)}),r=Array.isArray(t)?t:[],{normalized:n,changed:o}=pa(r);return o&&ja(n,{skipNormalization:!0}),n}function ja(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],{normalized:i}=n?{normalized:o}:pa(o),s=T();$e(s,Wt);let a=!1,c=!1;return ke(s,Wt,i,"Error saving automatic gear rule backups to localStorage:",{onQuotaExceeded:(u,f={})=>{const l=Es(i);if(l){const p=l.label;return console.warn(p?`Removed automatic gear backup "${p}" to free up storage space before saving gear backups.`:"Removed oldest automatic gear backup entry to free up storage space before saving gear backups."),!0}const y=f&&f.storage?f.storage:s;return!!(!a&&(a=!0,Vg(y))||!c&&(c=!0,ws()))}}),i}function _f(){_e();const e=T();return Ku(e,Ur,"Error loading automatic gear seed flag from localStorage:")}function ks(e){const t=T();$u(t,Ur,!!e,"Error saving automatic gear seed flag to localStorage:")}function kf(){_e();const e=T(),t=Le(e,qt,"Error loading automatic gear presets from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?fe(r):[];return n!==r&&Ti(n,{skipNormalization:!0}),Array.isArray(n)?n:[]}function Dm(){const e=new Set,t=r=>{if(typeof r=="string"){const n=r.trim();n&&e.add(n)}};if(typeof mi=="function")try{t(mi())}catch(r){console.warn("Unable to read automatic gear active preset id while evaluating compression policy.",r)}if(typeof hi=="function")try{t(hi())}catch(r){console.warn("Unable to read automatic gear auto preset id while evaluating compression policy.",r)}return e}function Ti(e,t={}){const r=t||{},{skipNormalization:n=!1,disableCompression:o}=r,i=Array.isArray(e)?e.slice():[],s=n?i:Array.isArray(i)?fe(i):[],a=T();$e(a,qt);let c=typeof o=="boolean"?o:!1;if(o===void 0){const u=Dm();u.size>0&&(c=s.some(f=>f&&typeof f=="object"&&typeof f.id=="string"&&u.has(f.id)))}return ke(a,qt,s,"Error saving automatic gear presets to localStorage:",c?{disableCompression:!0}:void 0),s}function Pf(){_e();const e=T(),t=Le(e,Sr,"Error loading automatic gear monitor defaults from localStorage:",{},{validate:o=>o===null||typeof o=="object"}),r=t&&typeof t=="object"?t:{},n=w(r)?fe(r):{};return n!==r&&va(n,{skipNormalization:!0}),n&&typeof n=="object"?n:{}}function va(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=e&&typeof e=="object"?{...e}:{},i=n?o:w(o)?fe(o):{},s=T();return $e(s,Sr),ke(s,Sr,i,"Error saving automatic gear monitor defaults to localStorage:"),i}function jc(e,t){if(!e)return;const r=t||T();if(!r)return;let n;try{n=r.getItem(qt)}catch(a){console.error("Error loading automatic gear presets while removing autosaved preset from localStorage:",a),Ee("read access",a,r),le();return}if(n===null||typeof n>"u")return;let o,i=n;typeof n=="string"&&n&&(i=Kr(n));try{o=JSON.parse(i)}catch(a){console.error("Error parsing automatic gear presets while removing autosaved preset from localStorage:",a);return}if(!Array.isArray(o))return;const s=o.filter(a=>!a||typeof a!="object"?!0:a.id!==e);s.length!==o.length&&Ti(s,{skipNormalization:!0})}function mi(){_e();const e=T();if(!e)return"";try{const t=e.getItem(Er);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear active preset from localStorage:",t),Ee("read access",t,e),le(),""}}function jf(e){const t=T();if(t)try{e?t.setItem(Er,e):t.removeItem(Er)}catch(r){console.error("Error saving automatic gear active preset to localStorage:",r),Ee("write access",r,t),le()}}function hi(){_e();const e=T();if(!e)return"";try{const t=e.getItem(xt);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear auto preset from localStorage:",t),Ee("read access",t,e),le(),""}}function vf(e){const t=T();if(!t)return;let r="";try{const n=t.getItem(xt);typeof n=="string"&&n&&(r=n)}catch(n){console.error("Error inspecting automatic gear auto preset in localStorage:",n),Ee("read access",n,t)}try{e?(t.setItem(xt,e),r&&r!==e&&jc(r,t)):(t.removeItem(xt),r&&jc(r,t))}catch(n){console.error("Error saving automatic gear auto preset to localStorage:",n),Ee("write access",n,t),le()}}function If(){_e();const e=T();return Ku(e,Dr,"Error loading automatic gear backup visibility from localStorage:")}function Ps(e){const t=T();$u(t,Dr,!!e,"Error saving automatic gear backup visibility to localStorage:")}function Rf(){const t=Number($y);if(!Number.isFinite(t))return Qr;const r=Math.round(t);return Number.isFinite(r)?r<et?et:r>Qr?Qr:r:Qr}function Xr(e){const t=Number(e);if(!Number.isFinite(t))return lo();const r=Math.round(t);if(!Number.isFinite(r))return lo();if(r<et)return et;const n=Rf();return r>n?n:r}function lo(){const e=Rf();if(h&&typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=="number"){const r=h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT;if(Number.isFinite(r)&&r>=et){const n=Math.round(r);return Number.isFinite(n)?n<et?et:n>e?e:n:e}}const t=Math.round(Ou);return Number.isFinite(t)?t>e?e:t<et?et:t:et}function Xn(e,t=lo()){if(e==null)return t;if(typeof e=="number")return Xr(e);if(typeof e=="string"){const r=e.trim();if(!r)return t;const n=Number(r);if(Number.isFinite(n))return Xr(n);const o=Ae(r);return o&&o.success?Xn(o.parsed,t):t}if(Array.isArray(e)){for(let r=0;r<e.length;r+=1){const n=Xn(e[r],null);if(typeof n=="number"&&Number.isFinite(n))return Xr(n)}return t}if(w(e)){const r=["value","retention","limit","count"];for(let n=0;n<r.length;n+=1){const o=r[n];if(!Object.prototype.hasOwnProperty.call(e,o))continue;const i=Xn(e[o],null);if(typeof i=="number"&&Number.isFinite(i))return Xr(i)}return t}return t}function Tf(){_e();const e=T(),t=Le(e,wr,"Error loading automatic gear backup retention from localStorage:",lo(),{validate:r=>r===null||typeof r=="number"||typeof r=="string"||Array.isArray(r)||w(r)});return Xn(t)}function Lf(e){if(e==null||typeof e=="function"||typeof e=="object"&&!Array.isArray(e)&&!w(e))return;const t=T(),r=Xn(e);$e(t,wr),ke(t,wr,r,"Error saving automatic gear backup retention to localStorage:")}async function Km(){try{typeof globalThis<"u"&&(globalThis.__cameraPowerPlannerFactoryResetting=!0),typeof global<"u"&&(global.__cameraPowerPlannerFactoryResetting=!0),typeof window<"u"&&(window.__cameraPowerPlannerFactoryResetting=!0),h&&(h.__cameraPowerPlannerFactoryResetting=!0,h.__cineMonolithicProjectCleanupDone=!1),typeof sessionStorage<"u"&&sessionStorage.setItem(Ue,"true"),typeof localStorage<"u"&&localStorage.setItem(Ue,"true")}catch{}if(je)try{je.postMessage("factory-reset")}catch{}const e="Error clearing storage:";try{pf()}catch(l){console.warn("Unable to clear stored projects during factory reset",l)}$t(),ut&&typeof ut.clear=="function"&&ut.clear(),Array.isArray(sr)&&(sr.length=0);try{let l=null;if(h&&typeof h.clearBackupVault=="function"?l=h.clearBackupVault:typeof clearBackupVault<"u"&&typeof clearBackupVault=="function"?l=clearBackupVault:h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup.clearBackupVault=="function"&&(l=h.cineFeatureBackup.clearBackupVault),l&&await l(),typeof indexedDB<"u"){const y=["cinePowerPlannerBackupVault","cinePowerPlanner","cameraPowerPlanner"];if(typeof indexedDB.databases=="function")try{(await indexedDB.databases()).forEach(d=>{d.name&&!y.includes(d.name)&&y.push(d.name)})}catch(p){console.warn("Failed to list IndexedDB databases during factory reset",p)}await Promise.all(y.map(p=>new Promise(d=>{try{const g=indexedDB.deleteDatabase(p);g.addEventListener("success",()=>d()),g.addEventListener("error",()=>{console.warn(`Failed to delete IndexedDB database "${p}" during factory reset`,g.error),d()}),g.addEventListener("blocked",()=>{console.warn(`Deletion of IndexedDB database "${p}" blocked during factory reset`),d()})}catch(g){console.warn(`Error initiating deletion of IndexedDB database "${p}"`,g),d()}})))}}catch(l){console.warn("Failed to clear backup vault during factory reset",l)}const t=T(),r=(l,y)=>{if(l){if(typeof l.clear=="function")try{l.clear()}catch(p){console.warn(`Failed to clear ${y} using clear(), falling back to manual removal.`,p)}try{const p=[];try{const d=l.length;for(let g=0;g<d;g++){const m=l.key(g);m&&p.push(m)}}catch(d){console.warn(`Failed to iterate ${y} by index`,d)}try{const d=Object.keys(l);Array.isArray(d)&&d.forEach(g=>{g&&!p.includes(g)&&p.push(g)})}catch(d){}p.forEach(d=>{if(d!==Ue)try{l.removeItem(d)}catch(g){console.warn(`Failed to remove key ${d} from ${y}`,g)}})}catch(p){console.warn(`Failed to iterate ${y} for strict cleanup`,p)}}};r(t,"safeLocalStorage"),typeof localStorage<"u"&&localStorage!==t&&r(localStorage,"localStorage"),typeof sessionStorage<"u"&&r(sessionStorage,"sessionStorage");const n=["settingsActiveTab",typeof h<"u"&&h&&typeof h.INSTALL_BANNER_DISMISSED_KEY=="string"?h.INSTALL_BANNER_DISMISSED_KEY:"cine_install_banner_dismissed"],o=(l,y)=>{if(!l||typeof l.length!="number"||typeof l.key!="function")return;const p=[],d=l.length;for(let g=0;g<d;g++){const m=l.key(g);m&&(m.startsWith("cameraPowerPlanner_")||m.startsWith("cine_")||m.startsWith("cinePowerPlanner_")||m.startsWith("cinePowerPlanner")||m.startsWith("cineRental")||m.startsWith("__cine")||m.startsWith("cine_")||n.includes(m))&&m!==Ue&&p.push(m)}p.forEach(g=>{try{l.removeItem(g)}catch(m){console.warn(`Failed to remove key ${g} from ${y}`,m)}})};if(o(t,"safeLocalStorage"),typeof localStorage<"u"&&localStorage!==t&&o(localStorage,"localStorage"),typeof sessionStorage<"u"&&o(sessionStorage,"sessionStorage"),typeof Ht=="function")try{Ht()}catch{}if(["cineBackupVaultFallbackRecords",De,Ye,Nt,pe,ki,"cameraPowerPlanner_projects","cameraPowerPlanner_project_shards",zt,Gt,br,Wt,Ur,qt,Er,xt,Dr,wr,Sr,hr(),Vt,ft,ia,_n,lr,Tt,ur,_t,hs,lt,"cameraPowerPlanner_lastProject","cameraPowerPlanner_onboardingComplete","cameraPowerPlanner_tourShown","cameraPowerPlanner_v1_migration","cameraPowerPlanner_v2_migration","cameraPowerPlanner_sharded","cameraPowerPlanner_forceLegacyBundle","cameraPowerPlanner_forceLegacyBundleRetry",typeof h<"u"&&h.TEMPERATURE_UNIT_STORAGE_KEY,typeof h<"u"&&h.FOCUS_SCALE_STORAGE_KEY,typeof h<"u"&&h.INSTALL_BANNER_DISMISSED_KEY,"cine_install_banner_dismissed","cameraPowerPlanner_project__backup","cameraPowerPlanner_project__legacyMigrationBackup","cameraPowerPlanner_setups__backup","cameraPowerPlanner_setups__legacyMigrationBackup"].forEach(l=>{l&&(ce(t,l,e),typeof t.removeItem=="function"&&(t.removeItem(`${l}${de}`),t.removeItem(`${l}${_r}`)))}),typeof sessionStorage<"u"){ce(sessionStorage,lt,e),ce(sessionStorage,"__cineLoggingHistory",e),ce(sessionStorage,"__cineLoggingConfig",e);try{const l=sessionStorage.getItem(Ue);sessionStorage.clear(),l&&sessionStorage.setItem(Ue,l)}catch{}}if(typeof caches<"u"&&typeof caches.keys=="function")try{const l=await caches.keys();await Promise.all(l.map(function(y){return caches.delete(y)})),typeof console<"u"&&typeof console.log=="function"&&console.log("Storage reset: Service Worker caches cleared.")}catch(l){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Storage reset: Failed to clear Service Worker caches.",l)}["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",mn,qe].forEach(l=>{ce(t,l,e,{disableBackup:!0}),typeof t.removeItem=="function"&&t.removeItem(`${l}${de}`)});const a=["cameraPowerPlanner_onboardingTutorial","cinePowerPlanner_onboardingTutorial","cameraPowerPlanner_onboardingComplete","cameraPowerPlanner_tourShown"],c=l=>{if(l)for(let y=0;y<a.length;y+=1){const p=a[y];ce(l,p,e),typeof l.removeItem=="function"&&l.removeItem(`${p}${de}`)}},u=ao([t,typeof SAFE_LOCAL_STORAGE<"u"?SAFE_LOCAL_STORAGE:null,wn("localStorage"),typeof localStorage<"u"?localStorage:null]);for(let l=0;l<u.length;l+=1)c(u[l]);const f=ao([typeof sessionStorage<"u"?sessionStorage:null,wn("sessionStorage")]);for(let l=0;l<f.length;l+=1)c(f[l]);try{const l=h&&h.cineLogging?h.cineLogging:null;l&&typeof l.clearHistory=="function"&&l.clearHistory({persist:!1})}catch(l){console.warn("Unable to clear logging history during factory reset",l)}try{h&&typeof h.name=="string"&&(h.name=""),typeof window<"u"&&typeof window.name=="string"&&(window.name="")}catch(l){console.warn("Unable to reset window.name during factory reset",l)}try{if(typeof navigator<"u"&&navigator.serviceWorker){const l=await navigator.serviceWorker.getRegistrations();for(const y of l)await y.unregister()}}catch(l){console.warn("Failed to unregister service workers",l)}typeof console<"u"&&typeof console.log=="function"&&console.log("Factory reset cleanup complete. Waiting for reload.")}function be(e){const t=T();if(!t||typeof t.getItem!="function")return null;const r=dt(e);for(let n=0;n<r.length;n+=1){const o=r[n];try{const i=t.getItem(o);if(i==null){if(ht.has(o))try{const s=t.getItem(`${o}${de}`);if(s!=null){const a=Ar(s);return typeof a=="string"?a:String(s)}}catch(s){console.warn("Unable to read backup key for export",o,s),Ee("read access",s,t)}}else{const s=Ar(i);return typeof s=="string"?s:String(i)}}catch(i){console.warn("Unable to read storage key for backup",o,i),Ee("read access",i,t)}}return null}function vr(e){if(e==null)return null;if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isNaN(e)?null:e!==0;const t=String(e).trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}function Ia(e){if(e==null)return null;let t=null,r=e;if(typeof e=="string"){const c=e.trim();if(!c)return null;t=c;try{r=JSON.parse(c)}catch{return{normalized:null,serialized:t}}}if(!r||typeof r!="object")return t?{normalized:null,serialized:t}:null;const n=typeof r.sections=="object"&&r.sections!==null,o=n?r.sections:r,i={};if(o&&typeof o=="object"){const c=Object.keys(o);for(let u=0;u<c.length;u+=1){const f=c[u],l=o[f];typeof l=="boolean"&&(i[f]=l)}}let s=null;if(typeof r.layout=="string"){const c=r.layout.trim();c&&(s=c)}s||(s=n?"standard":"rental");const a={sections:i,layout:s};if(n){const c=Object.keys(r);for(let u=0;u<c.length;u+=1){const f=c[u];f==="sections"||f==="layout"||(a[f]=mr(r[f]))}}return{normalized:a,serialized:t}}function $m(){const e={},t=vr(be("darkMode"));t!==null&&(e.darkMode=t);const r=vr(be("pinkMode"));r!==null&&(e.pinkMode=r);const n=vr(be("highContrast"));n!==null&&(e.highContrast=n);const o=vr(be("reduceMotion"));o!==null&&(e.reduceMotion=o);const i=vr(be("relaxedSpacing"));i!==null&&(e.relaxedSpacing=i);const s=vr(be("showAutoBackups"));s!==null&&(e.showAutoBackups=s);const a=be("accentColor");a&&(e.accentColor=a);const c=be("fontSize");c&&(e.fontSize=c);const u=be("fontFamily");u&&(e.fontFamily=u);const f=be("language");f&&(e.language=f);const l=go(),y=be(l);if(y)try{e.mountVoltages=JSON.parse(y)}catch(O){console.warn("Failed to parse stored mount voltages for backup",O),e.mountVoltages=y}const p=vr(be("iosPwaHelpShown"));p!==null&&(e.iosPwaHelpShown=p);const d=be(bn);d&&(e.temperatureUnit=d);const g=be(ro);g&&(e.focusScale=g);const m=be(mn);if(m){let O=null;if(typeof m=="string"){const A=m.trim();if(A)try{O=JSON.parse(A)}catch(C){console.warn("Failed to parse stored camera color preferences for backup",C),O=null}}O&&typeof O=="object"?e.cameraColors=mr(O):typeof m=="string"&&m.trim()&&(e.cameraColors=m)}const b=be(qe);if(b!=null){const O=Ia(b);O&&(O.normalized?e[qe]=mr(O.normalized):O.serialized&&(e[qe]=O.serialized))}return e}function Mf(e){return Array.isArray(e)?e.map(t=>({id:t&&typeof t.id=="string"?t.id:null,name:t&&typeof t.name=="string"?t.name:"",data:t&&typeof t.data=="string"?t.data:""})).filter(t=>t.id&&t.name&&t.data):[]}function Vm(){const e=be(hr());if(!e)return[];try{const t=JSON.parse(e);return Mf(t)}catch(t){return console.warn("Failed to parse stored custom fonts for backup",t),[]}}let Kn=[];function Wm(e){if(!e||typeof e!="object")return null;const t={};return typeof e.source=="string"&&e.source&&(t.source=e.source),typeof e.reason=="string"&&e.reason&&(t.reason=e.reason),typeof e.permissionState=="string"&&e.permissionState&&(t.permissionState=e.permissionState),Object.keys(t).length?t:null}function Nf(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"";if(!t)return null;const r=typeof e.fileName=="string"&&e.fileName?e.fileName:"cine-power-planner-backup.json",n=typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)?e.createdAtMs:null,o=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:n!==null?new Date(n).toISOString():null;let i=n;if(i===null&&o){const a=Date.parse(o);Number.isFinite(a)&&(i=a)}i===null&&(i=Date.now());const s=Wm(e.metadata);return{id:t,fileName:r,payload:e.payload,createdAt:o||new Date(i).toISOString(),createdAtMs:i,metadata:s||{}}}function uo(e){if(!e)return[];let t=e;if(typeof e=="string"){const o=Ae(e);o&&o.success&&(t=o.parsed)}const r=Array.isArray(t)?t:[],n=[];return r.forEach(o=>{const i=Nf(o);i&&n.push(i)}),n}function vc(e){if(!e)return 0;let t=0;return e.payload!==null&&e.payload!==void 0&&(t+=3),typeof e.fileName=="string"&&e.fileName&&(t+=1),typeof e.createdAt=="string"&&e.createdAt&&(t+=1),typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)&&(t+=1),e.metadata&&typeof e.metadata=="object"&&(t+=1),t}function zf(e,t){const r=new Map,n=o=>{Array.isArray(o)&&o.forEach(i=>{const s=Nf(i);if(!s)return;const a=r.get(s.id);(!a||vc(s)>=vc(a))&&r.set(s.id,s)})};return n(e),n(t),Array.from(r.values())}function Gf(){const e=be("cineBackupVaultFallbackRecords");return uo(e)}function Bf(){return h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup=="object"?h.cineFeatureBackup:h&&typeof h.getQueuedBackupPayloads=="function"?h:null}function xf(){const e=Bf();if(!e)return;const t=typeof e.listBackupVaultRecords=="function"?e.listBackupVaultRecords:typeof e.getQueuedBackupPayloads=="function"?e.getQueuedBackupPayloads:null;if(!t)return;let r=null;try{r=t()}catch(n){console.warn("Unable to load backup vault records for export",n);return}if(Array.isArray(r)){Kn=uo(r);return}return r&&typeof r.then=="function"?r.then(n=>(Kn=uo(n),Kn)).catch(n=>(console.warn("Unable to load backup vault records for export",n),[])):Promise.resolve(Kn)}async function qm(){return await xf()}function Hm(){xf();const e={devices:qu(),setups:ho(),session:Vu(),feedback:Ef(),project:af(),favorites:df(),contacts:mf(),ownGear:hf(),userProfile:null,autoGearRules:Cf(),autoGearBackups:Pa(),autoGearSeeded:_f(),autoGearPresets:kf(),autoGearMonitorDefaults:Pf(),autoGearActivePresetId:mi(),autoGearAutoPresetId:hi(),autoGearShowBackups:If(),autoGearBackupRetention:Tf(),fullBackupHistory:co()},t=Of();t&&Array.isArray(t.releases)&&t.releases.length&&(e.documentationTracker=t);const r=$m();Object.keys(r).length&&(e.preferences=r);const n=Sf();n&&typeof n=="object"&&(typeof n.name=="string"&&n.name||typeof n.role=="string"&&n.role||typeof n.avatar=="string"&&n.avatar||typeof n.phone=="string"&&n.phone||typeof n.email=="string"&&n.email)?e.userProfile=n:delete e.userProfile;const o=be(Vt);o&&(e.customLogo=o);const i=Vm();i.length&&(e.customFonts=i);const s=be(ft);s!=null&&(e.schemaCache=s);const a=Gf(),c=zf(Kn,a);return c.length&&(e.backupVaultRecords=c.map(u=>mr(u))),e}function ye(e,t){const r=T();if(!r)return;const n=ht.has(e),o=`${e}${de}`;try{if(t==null){if(r.removeItem(e),n)try{r.removeItem(o)}catch(i){console.warn("Unable to remove backup key during import",o,i),Ee("deletion",i,r)}}else{const i=String(t);if(r.setItem(e,i),n)try{r.setItem(o,i)}catch(s){console.warn("Unable to update backup key during import",o,s),Ee("write access",s,r),le()}}}catch(i){console.warn("Unable to persist storage key during import",e,i),Ee("write access",i,r),n&&le()}}function cn(e){if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}if(typeof e=="number")return Number.isNaN(e)?null:e!==0;if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=cn(e[t]);if(r!==null)return r}return null}if(w(e)){if(Object.prototype.hasOwnProperty.call(e,"value"))return cn(e.value);if(Object.prototype.hasOwnProperty.call(e,"enabled"))return cn(e.enabled)}return null}function Ft(e,t=[],r=null){if(re(e)){const n=ne(e);return n?Ft(n,t,r):[]}if(Array.isArray(e))return r?e.filter(n=>r(n)):e.filter(n=>n!=null);if(typeof e=="string"){const n=Ae(e);return n.success?Ft(n.parsed,t,r):[]}if(w(e)){for(let o=0;o<t.length;o+=1){const i=t[o];if(!Object.prototype.hasOwnProperty.call(e,i))continue;const s=Ft(e[i],t,r);if(s.length)return s}const n=Object.values(e);if(n.length)return r?n.filter(o=>r(o)):n.filter(o=>o!=null)}return[]}function Ym(e){const t=Ft(e,["contacts","entries","items","list","values","data"],r=>r&&typeof r=="object");return Array.isArray(t)?Ca(t):[]}function Jm(e){const t=Ft(e,["rules","items","entries","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?fe(t):[]}function Qm(e){const t=Ft(e,["backups","entries","items","list","values","data"],n=>n!==null&&typeof n=="object");if(!Array.isArray(t))return[];const{normalized:r}=pa(t);return r}function Wo(e){if(e==null)return null;if(typeof e=="number")return Xr(e);if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return Xr(r);const n=Ae(t);return n&&n.success?Wo(n.parsed):null}if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Wo(e[t]);if(typeof r=="number")return r}return null}if(w(e)){const t=["value","retention","limit","count"];for(let r=0;r<t.length;r+=1){const n=t[r];if(!Object.prototype.hasOwnProperty.call(e,n))continue;const o=Wo(e[n]);if(typeof o=="number")return o}return null}return typeof e=="boolean"&&e?et:null}function Xm(e){const t=Ft(e,["presets","entries","items","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?fe(t):[]}function Zm(e){if(!e||typeof e!="object")return{};const t={};Object.entries(e).forEach(([n,o])=>{if(typeof o!="string")return;const i=o.trim();i&&(t[n]=i)});const r=fe(t);return w(r)?r:t}function js(e){if(typeof e=="string")return e;if(typeof e=="number")return Number.isNaN(e)?"":String(e);if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=js(e[t]);if(r)return r}return""}if(w(e)){if(typeof e.id=="string"&&e.id)return e.id;if(typeof e.value=="string")return e.value;if(Object.prototype.hasOwnProperty.call(e,"name"))return js(e.name)}return""}function Ic(e){const t=Ft(e,["backupVaultRecords","backupVault","vault","records","entries","items","list","values","data"],r=>r&&typeof r=="object");return uo(t)}function Rc(e){const t=uo(e);if(!t.length)return;const r=Gf(),n=zf(r,t);try{ye("cineBackupVaultFallbackRecords",JSON.stringify(n))}catch(a){console.warn("Unable to persist imported backup vault fallback records",a)}const o=Bf();if(!o||typeof o.queueBackupPayloadForVault!="function")return;const i=a=>{o.queueBackupPayloadForVault(a.fileName,a.payload,{id:a.id,createdAt:a.createdAt,createdAtMs:a.createdAtMs,source:a.metadata&&a.metadata.source?a.metadata.source:void 0,reason:a.metadata&&a.metadata.reason?a.metadata.reason:void 0,permissionState:a.metadata&&a.metadata.permissionState?a.metadata.permissionState:void 0})},s=typeof o.listBackupVaultRecords=="function"?o.listBackupVaultRecords:typeof o.getQueuedBackupPayloads=="function"?o.getQueuedBackupPayloads:null;if(!s){t.forEach(i);return}try{const a=s();if(Array.isArray(a)){const c=new Set(a.map(u=>u&&u.id?u.id:null));t.forEach(u=>{c.has(u.id)||i(u)});return}if(a&&typeof a.then=="function"){a.then(c=>{const u=new Set(Array.isArray(c)?c.map(f=>f&&f.id?f.id:null):[]);t.forEach(f=>{u.has(f.id)||i(f)})}).catch(c=>{console.warn("Unable to inspect backup vault before import",c),t.forEach(i)});return}t.forEach(i)}catch(a){console.warn("Unable to import backup vault records via backup module",a),t.forEach(i)}}function eh(e){return dt(e)}function Ve(e,t){if(!w(e))return null;const r=eh(t);for(let n=0;n<r.length;n+=1){const o=r[n];if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"primary"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${de}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"backup"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${_r}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"migration-backup"}}return null}function ln(e){if(!e)return;let t=e.value;if(e.type==="migration-backup")try{const r=typeof t=="string"?JSON.parse(t):t;if(r&&typeof r=="object"){const n=typeof r.compression=="string"?r.compression.trim():"",o=typeof r.encoding=="string"?r.encoding.trim():"",i=n===ju&&o===vu,s=so.test(n)||so.test(o);if((i||s)&&typeof r.data=="string")if(la()){let a=typeof r.compressionVariant=="string"&&r.compressionVariant?r.compressionVariant:null;a||(s?a=Ec(o)||Ec(n)||"utf16":a="utf16");const c=Ru(r.data,ji,a,"migration backup entry");if(c.success&&typeof c.value=="string")try{const u=JSON.parse(c.value);u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"data")?t=u.data:t=null}catch(u){console.warn("Unable to parse migration backup entry during import",e.key,u),t=null}else console.warn("Unable to decompress migration backup entry during import",e&&e.key,c.error),t=null}else console.warn("Compression support is unavailable while reading migration backup entry",e&&e.key),t=null;else Object.prototype.hasOwnProperty.call(r,"data")?t=r.data:t=null}else t=null}catch(r){console.warn("Unable to parse migration backup entry during import",e.key,r),t=null}return t}function vo(e){const t=ln(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=Ar(t);if(r===null)return null;if(r===void 0)return;if(typeof r!="string")return r;const n=r.trim();if(!n)return"";try{return JSON.parse(n)}catch{return r}}return t}}function Zt(e){const t=ln(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=Ar(t);if(r===null)return null;if(r===void 0)return;if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return String(r);if(Array.isArray(r)||r&&typeof r=="object")try{return JSON.stringify(r)}catch(n){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,n),null}return null}if(typeof t=="number"||typeof t=="boolean")return String(t);if(Array.isArray(t)||t&&typeof t=="object")try{return JSON.stringify(t)}catch(r){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,r),null}return null}}function th(e){if(!w(e)||["devices","setups","session","feedback","favorites","contacts","preferences","project","projects","autoGearRules","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","autoGearSeeded","autoGearActivePresetId","autoGearAutoPresetId","autoGearBackupRetention","autoGearShowBackups","fullBackupHistory","fullBackups","backupVaultRecords"].some(S=>Object.prototype.hasOwnProperty.call(e,S)))return null;const n={};let o=!1,i=!1;const s=["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",mn,qe],a=go(),c=new Set([Vt,...s,a].filter(S=>typeof S=="string"&&S)),u=new Set(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"]),f=S=>{if(!S||typeof S.key!="string")return;if(S.key.startsWith("cameraPowerPlanner_")||S.key.startsWith("cinePowerPlanner_")||S.key.endsWith(de)||S.key.endsWith(_r)){i=!0;return}const E=S.key.replace(/(?:__backup|__legacyMigrationBackup)$/u,"");c.has(E)&&(i=!0)},l=(S,E)=>{const R=Ve(e,S);if(!R)return;f(R);const x=vo(R);x!==void 0&&(n[E]=x,o=!0)};l(De,"devices"),l(Ye,"setups"),l(lt,"session"),l(Nt,"feedback"),l(pe,"project"),l(zt,"favorites"),l(Gt,"contacts"),l(_n,"ownGear"),l(lr,"userProfile"),l(Tt,"documentationTracker"),l(br,"autoGearRules"),l(Wt,"autoGearBackups"),l(qt,"autoGearPresets"),l(Sr,"autoGearMonitorDefaults"),l(wr,"autoGearBackupRetention");const y=Ve(e,ft);if(y){f(y);const S=Zt(y);S!==void 0&&(n.schemaCache=S,o=!0)}const p=Ve(e,hr());if(p){f(p);const S=vo(p);S!==void 0&&(n.customFonts=S,o=!0)}const d=Ve(e,Vt);if(d){f(d);const S=Zt(d);S!==void 0&&(n.customLogo=S,o=!0)}const g=Ve(e,Ur);g&&(f(g),n.autoGearSeeded=ln(g),o=!0);const m=Ve(e,Er);m&&(f(m),n.autoGearActivePresetId=Zt(m),o=!0);const b=Ve(e,xt);b&&(f(b),n.autoGearAutoPresetId=Zt(b),o=!0);const O=Ve(e,Dr);O&&(f(O),n.autoGearShowBackups=ln(O),o=!0);const A={};s.forEach(S=>{const E=Ve(e,S);if(!E)return;if(f(E),S===qe){const L=Zt(E);if(L!==void 0){const N=Ia(L);if(N){if(N.normalized){A[S]=mr(N.normalized),o=!0;return}if(N.serialized){A[S]=N.serialized,o=!0;return}}}return}const R=ln(E);if(u.has(S)){const L=cn(R);if(L!==null){A[S]=L,o=!0;return}}const x=Zt(E);x!==void 0&&(A[S]=x,o=!0)});const C=Ve(e,bn);if(C){f(C);const S=Zt(C);if(typeof S=="string"){const E=S.trim();E&&(A.temperatureUnit=E,o=!0)}}const _=Ve(e,ro);if(_){f(_);const S=Zt(_);if(typeof S=="string"){const E=S.trim();E&&(A.focusScale=E,o=!0)}}const k=Ve(e,mn);if(k){f(k);const S=vo(k);S!==void 0&&(A.cameraColors=S,o=!0)}const j=Ve(e,a);if(j){f(j);const S=vo(j);S!==void 0&&(A.mountVoltages=S,o=!0)}return Object.keys(A).length>0&&(n.preferences=A),!o||!i?null:n}function Ff(e,t={}){if(Array.isArray(e)){Jn(e,()=>_c());return}if(!w(e))return;const{skipSnapshotConversion:r=!1}=t||{};if(!r){const l=th(e);if(l){Ff(l,{skipSnapshotConversion:!0});return}}const n=l=>Object.prototype.hasOwnProperty.call(e,l),o=go(),i=mn;if(n("devices")&&Hu(e.devices),n("setups")&&ba(e.setups),n("session")&&ha(e.session,{disableCompression:!0}),n("feedback")&&wf(e.feedback),n("favorites")&&yf(e.favorites),n("contacts"))if(e.contacts===null)_s(null);else{const l=Ym(e.contacts);_s(l)}if(n("ownGear")){const l=Ft(e.ownGear,["items","entries","list","values","data"],y=>y&&typeof y=="object");bf(l)}if(n("userProfile")){if(e.userProfile===null)$o(null);else if(w(e.userProfile)){const l=_a(e.userProfile);$o(l||null)}}if(w(e.preferences)){const l=e.preferences;if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"].forEach(d=>{Object.prototype.hasOwnProperty.call(l,d)&&typeof l[d]=="boolean"&&ye(d,l[d])}),["accentColor","fontSize","fontFamily","language"].forEach(d=>{if(Object.prototype.hasOwnProperty.call(l,d)){const g=l[d];typeof g=="string"&&g&&ye(d,g)}}),Object.prototype.hasOwnProperty.call(l,"temperatureUnit")){const d=l.temperatureUnit;if(typeof d=="string"){const g=d.trim();g&&ye(bn,g)}else d===null&&ye(bn,null)}if(Object.prototype.hasOwnProperty.call(l,"focusScale")){const d=l.focusScale;if(typeof d=="string"){const g=d.trim();if(g&&(ye(ro,g),typeof applyFocusScalePreference=="function"))try{applyFocusScalePreference(g,{persist:!1,forceUpdate:!0})}catch(m){console.warn("Unable to apply imported focus scale preference",m)}}else d===null&&ye(ro,null)}if(Object.prototype.hasOwnProperty.call(l,qe)){const d=l[qe];if(d===null)ye(qe,null);else{const g=Ia(d);if(g){if(g.normalized){const m=mr(g.normalized);let b=null;try{b=JSON.stringify(m)}catch(O){console.warn("Unable to serialize imported print preferences",O),b=null}if(b!==null)try{ye(qe,b)}catch(O){console.warn("Unable to persist imported print preferences",O)}if(typeof savePrintPreferences=="function")try{savePrintPreferences(m)}catch(O){console.warn("Unable to apply imported print preferences",O)}}else if(g.serialized)try{ye(qe,g.serialized)}catch(m){console.warn("Unable to store imported print preferences string value",m)}}}}if(Object.prototype.hasOwnProperty.call(l,"mountVoltages")){const d=l.mountVoltages;if(d&&typeof d=="object"){try{ye(o,JSON.stringify(d))}catch(g){console.warn("Unable to store imported mount voltages",g)}typeof applyMountVoltagePreferences=="function"&&applyMountVoltagePreferences(d,{persist:!1,triggerUpdate:!0})}else if(typeof d=="string"){if(ye(o,d),typeof parseStoredMountVoltages=="function")try{const g=parseStoredMountVoltages(d);g&&typeof applyMountVoltagePreferences=="function"&&applyMountVoltagePreferences(g,{persist:!1,triggerUpdate:!0})}catch(g){console.warn("Unable to parse imported mount voltages",g)}}else d===null&&(ye(o,null),typeof resetMountVoltagePreferences=="function"&&resetMountVoltagePreferences({persist:!1,triggerUpdate:!0}))}if(Object.prototype.hasOwnProperty.call(l,"cameraColors")){const d=l.cameraColors,g=m=>{if(!m||typeof m!="object")return!1;let b=!1;if(typeof window<"u"&&window&&typeof window.setCameraLetterColors=="function")try{window.setCameraLetterColors(m),b=!0}catch(A){console.warn("Unable to apply imported camera color preferences",A),b=!1}let O=null;try{O=JSON.stringify(m)}catch(A){console.warn("Unable to serialize imported camera color preferences",A),O=null}if(O)try{ye(i,O)}catch(A){console.warn("Unable to persist imported camera color preferences",A)}return b};if(d&&typeof d=="object")g(d);else if(typeof d=="string"){const m=d.trim();if(m){let b=null;try{b=JSON.parse(m)}catch(O){console.warn("Unable to parse imported camera color palette",O),b=null}if(b&&typeof b=="object")g(b);else try{ye(i,m)}catch(O){console.warn("Unable to store raw imported camera color palette",O)}}}else d===null&&ye(i,null)}}if(Object.prototype.hasOwnProperty.call(e,"customLogo")){const l=e.customLogo;typeof l=="string"&&l?ye(Vt,l):ye(Vt,null)}if(Object.prototype.hasOwnProperty.call(e,"customFonts")){const l=Mf(e.customFonts);if(l.length)try{ye(hr(),JSON.stringify(l))}catch(y){console.warn("Unable to store imported custom fonts",y)}else ye(hr(),null)}if(Object.prototype.hasOwnProperty.call(e,"schemaCache")){const l=e.schemaCache;if(typeof l=="string"||l===null)ye(ft,l);else if(l&&typeof l=="object")try{ye(ft,JSON.stringify(l))}catch(y){console.warn("Unable to store imported schema cache",y)}}if(Object.prototype.hasOwnProperty.call(e,"documentationTracker")){const l=Qn(e.documentationTracker);Vo(l)}else if(Object.prototype.hasOwnProperty.call(e,"documentationLogs")){const l=Qn({releases:e.documentationLogs});Vo(l)}else if(Object.prototype.hasOwnProperty.call(e,"documentationUpdateLog")){const l=Qn(e.documentationUpdateLog);Vo(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearRules")){const l=Jm(e.autoGearRules);ka(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackups")){const l=Qm(e.autoGearBackups);ja(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearSeeded")){const l=cn(e.autoGearSeeded);ks(l===null?!1:l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearPresets")){const l=Xm(e.autoGearPresets);Ti(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearMonitorDefaults")){const l=Zm(e.autoGearMonitorDefaults);va(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearActivePresetId")){const l=js(e.autoGearActivePresetId);jf(typeof l=="string"?l:"")}if(Object.prototype.hasOwnProperty.call(e,"autoGearAutoPresetId")&&vf(typeof e.autoGearAutoPresetId=="string"?e.autoGearAutoPresetId:""),Object.prototype.hasOwnProperty.call(e,"autoGearShowBackups")){const l=cn(e.autoGearShowBackups);Ps(l===null?!1:l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackupRetention")){const l=Wo(e.autoGearBackupRetention);typeof l=="number"&&Number.isFinite(l)&&Lf(l)}if(Object.prototype.hasOwnProperty.call(e,"fullBackupHistory")){const l=It(e.fullBackupHistory);yi(l)}else if(Object.prototype.hasOwnProperty.call(e,"fullBackups")){const l=It(e.fullBackups);yi(l)}if(Object.prototype.hasOwnProperty.call(e,"backupVaultRecords")){const l=Ic(e.backupVaultRecords);Rc(l)}else if(Object.prototype.hasOwnProperty.call(e,"backupVault")){const l=Ic(e.backupVault);Rc(l)}let s=null;const a=()=>(s||(s=_c()),s);let c=!1;const u=()=>{const l=a();return(y,p,d)=>{c=!0,l(y,p,d)}},f=(l,y)=>{const d=Jn(l,()=>u(),y);return d&&(c=!0),d};e.project&&f(e.project,""),e.projects?f(e.projects):!e.project&&typeof e.gearList=="string"&&(u()("",{gearList:e.gearList}),c=!0),c||Mm(e).forEach((y,p)=>{if(y&&typeof y=="object"&&!Array.isArray(y)){const g=pi(y)?y:Fe(y);if(g&&pi(g)){u()("",g,`Imported project ${p+1}`),c=!0;return}}Jn(y,()=>u(),`Imported project ${p+1}`)&&(c=!0)})}var Yt={getSafeLocalStorage:T,loadDeviceData:qu,saveDeviceData:Hu,loadSetups:ho,saveSetups:ba,saveSetup:sm,loadSetup:am,deleteSetup:cm,renameSetup:lm,getMountVoltageStorageKeyName:go,getMountVoltageStorageBackupKeyName:Eu,getProjectStorageRevisionKeyName:xy,loadProjectStorageRevision:mu,loadProject:af,loadProjectMetadata:jm,saveProject:Oa,deleteProject:pf,renameProject:Lm,createProjectDeletionBackup:Im,loadSessionState:Vu,saveSessionState:ha,loadFavorites:df,saveFavorites:yf,loadContacts:mf,saveContacts:_s,loadOwnGear:hf,saveOwnGear:bf,loadUserProfile:Sf,saveUserProfile:$o,loadDocumentationTracker:Of,saveDocumentationTracker:Vo,loadAutoGearBackups:Pa,saveAutoGearBackups:ja,loadFeedback:Ef,saveFeedback:wf,clearAllData:Km,exportAllData:Hm,prepareBackupForExport:qm,importAllData:Ff,loadAutoGearRules:Cf,saveAutoGearRules:ka,loadAutoGearSeedFlag:_f,saveAutoGearSeedFlag:ks,loadAutoGearPresets:kf,saveAutoGearPresets:Ti,loadAutoGearMonitorDefaults:Pf,saveAutoGearMonitorDefaults:va,loadAutoGearActivePresetId:mi,saveAutoGearActivePresetId:jf,loadAutoGearAutoPresetId:hi,saveAutoGearAutoPresetId:vf,loadAutoGearBackupVisibility:If,saveAutoGearBackupVisibility:Ps,loadAutoGearBackupRetention:Tf,saveAutoGearBackupRetention:Lf,getAutoGearBackupRetentionDefault:lo,loadFullBackupHistory:co,saveFullBackupHistory:yi,recordFullBackupHistoryEntry:Af,requestPersistentStorage:Bu,clearUiCacheStorageEntries:Ht,ensureCriticalStorageBackups:ig,getLastCriticalStorageGuardResult:sg,decodeStoredValue:Ar,getCompressionLogSnapshot:jy,setActiveProjectCompressionHold:_m,clearActiveProjectCompressionHold:km,invalidateProjectReadCache:$t,storageRepo:K},Tc={flag:ca,read:au,write:Bo,clear:Oy};try{Object.defineProperty(Yt,"__testAutoBackupCompressionCache",{configurable:!1,enumerable:!1,writable:!1,value:Tc})}catch{Yt.__testAutoBackupCompressionCache=Tc}typeof module<"u"&&module.exports&&(module.exports=Yt);console.log("DEBUG: storage.js: starting global export loop");if(h&&typeof h=="object"){Object.keys(Yt).forEach(e=>{const t=Yt[e];if(typeof t=="function"&&typeof h[e]!="function")try{h[e]=t}catch{try{Object.defineProperty(h,e,{configurable:!0,writable:!0,value:t})}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Unable to expose storage helper ${e} globally.`,n)}}});try{typeof h.recordFullBackupHistoryEntry!="function"&&(h.recordFullBackupHistoryEntry=Af),typeof h.loadFullBackupHistory!="function"&&(h.loadFullBackupHistory=co)}catch{}}if(h)try{Object.defineProperty(h,"__cineStorageApi",{configurable:!0,writable:!0,value:Yt})}catch{h.__cineStorageApi=Yt}console.log("DEBUG: storage.js execution finished");const rh=Yt,Yi=Object.freeze(Object.defineProperty({__proto__:null,cineStorage:rh,default:Yt},Symbol.toStringTag,{value:"Module"}));var Lc={};const Li=fo();function nh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const o=n&&n.cineModuleLinker;if(o&&typeof o=="object")return o}catch{}}return null}function oh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function ih(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}const ie=nh(Li),X=ie&&typeof ie.getModuleEnvironment=="function"?ie.getModuleEnvironment():oh(Li),Z=ie&&typeof ie.getEnvironmentBridge=="function"?ie.getEnvironmentBridge():ih(Li),W=(ie&&typeof ie.getGlobalScope=="function"?ie.getGlobalScope():null)||(Z&&typeof Z.getGlobalScope=="function"?Z.getGlobalScope():null)||(X&&typeof X.getGlobalScope=="function"?X.getGlobalScope():null)||Li;function sh(){const e=[W];typeof globalThis<"u"&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&e.indexOf(global)===-1&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&typeof r.cineModuleGlobals=="object")return r.cineModuleGlobals}return null}const ee=(ie&&typeof ie.getModuleGlobals=="function"?ie.getModuleGlobals():null)||sh();function ah(e,t){if(ie&&typeof ie.recordModule=="function"&&ie.recordModule(e,t),!(!ee||typeof ee.recordModule!="function"))try{ee.recordModule(e,t)}catch{}}function Mc(e){return null}(function(){return ie&&typeof ie.tryRequire=="function"?ie.tryRequire:ee&&typeof ee.tryRequire=="function"?ee.tryRequire:Z&&typeof Z.tryRequire=="function"?function(r){const n=Z.tryRequire(r);return typeof n>"u"?Mc():n}:X&&typeof X.tryRequire=="function"?X.tryRequire:Mc})();function ch(e){const t=e||W;if(ie&&typeof ie.getModuleRegistry=="function"){const n=ie.getModuleRegistry(t);if(n)return n}if(ee&&typeof ee.resolveModuleRegistry=="function")try{const n=ee.resolveModuleRegistry(t);if(n)return n}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const n=Z.getModuleRegistry(t);if(n)return n}catch{}if(X&&typeof X.resolveModuleRegistry=="function")try{const n=X.resolveModuleRegistry(t);if(n)return n}catch{}if(we&&typeof we=="object")return we;const r=[t];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModules=="object")return o.cineModules}return null}const un=(function(){if(ie&&typeof ie.getModuleRegistry=="function"){const e=ie.getModuleRegistry(W);if(e)return e}if(ee&&typeof ee.getModuleRegistry=="function")try{const e=ee.getModuleRegistry(W);if(e)return e}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const e=Z.getModuleRegistry(W);if(e)return e}catch{}if(X&&typeof X.getModuleRegistry=="function")try{const e=X.getModuleRegistry(W);if(e)return e}catch{}return ch(W)})(),qr=(function(){if(ie&&typeof ie.getPendingQueueKey=="function"){const t=ie.getPendingQueueKey();if(typeof t=="string"&&t)return t}if(ee&&typeof ee.getPendingQueueKey=="function")try{const t=ee.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}if(Z&&typeof Z.getPendingQueueKey=="function")try{const t=Z.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return X&&typeof X.PENDING_QUEUE_KEY=="string"?X.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function lh(e){if(!e||typeof e!="object")return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}return t}function uh(e,t,r){if(ee&&typeof ee.queueModuleRegistration=="function")try{if(ee.queueModuleRegistration(e,t,r,W))return!0}catch{}if(Z&&typeof Z.queueModuleRegistration=="function")try{if(Z.queueModuleRegistration(e,t,r))return!0}catch{}if(X&&typeof X.queueModuleRegistration=="function")return X.queueModuleRegistration(e,t,r,W);if(!W||typeof W!="object")return!1;const n=Object.freeze({name:e,api:t,options:Object.freeze(lh(r))});let o=W[qr];if(!Array.isArray(o))try{Object.defineProperty(W,qr,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=W[qr]}catch{try{Array.isArray(W[qr])||(W[qr]=[]),o=W[qr]}catch{return!1}}try{o.push(n)}catch{o[o.length]=n}return!0}function Ji(e,t,r,n){if(un&&typeof un.register=="function")try{return un.register(e,t,r),!0}catch(o){if(typeof n=="function")try{n(o)}catch{}}return uh(e,t,r),!1}const fh=(function(){return ee&&typeof ee.registerOrQueueModule=="function"?function(r,n,o,i){try{if(ee.registerOrQueueModule(r,n,o,i,W,un))return!0}catch{}return Ji(r,n,o,i)}:Z&&typeof Z.registerOrQueueModule=="function"?function(r,n,o,i){try{if(Z.registerOrQueueModule(r,n,o,i,W,un))return!0}catch{}return Ji(r,n,o,i)}:X&&typeof X.registerOrQueueModule=="function"?function(r,n,o,i){return X.registerOrQueueModule(r,n,o,i,W,un)}:Ji})();function ph(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function dh(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(ph(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function yh(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function vs(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||dh(e))return e;if(typeof process<"u"&&process&&Lc&&Lc.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const r=yh(t);if(r.has(e))return e;r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||vs(s,r)}try{return Object.freeze(e)}catch{return e}}const Ra=(function(){return ee&&typeof ee.freezeDeep=="function"?ee.freezeDeep:Z&&typeof Z.freezeDeep=="function"?function(r,n){try{return Z.freezeDeep(r,n)}catch{return vs(r,n)}}:X&&typeof X.freezeDeep=="function"?X.freezeDeep:vs})();function Nc(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const gh=(function(){return ee&&typeof ee.safeWarn=="function"?ee.safeWarn:Z&&typeof Z.safeWarn=="function"?function(r,n){try{Z.safeWarn(r,n)}catch{Nc(r,n)}}:X&&typeof X.safeWarn=="function"?X.safeWarn:Nc})();function Qi(e,t){if(!W||typeof W!="object")return!1;try{return Object.defineProperty(W,e,{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{try{return W[e]=t,!0}catch{return!1}}}const mh=(function(){return ee&&typeof ee.exposeGlobal=="function"?function(r,n,o){try{return ee.exposeGlobal(r,n,o)}catch{return Qi(r,n)}}:Z&&typeof Z.exposeGlobal=="function"?function(r,n,o){try{return Z.exposeGlobal(r,n,o)}catch{return Qi(r,n)}}:X&&typeof X.exposeGlobal=="function"?function(r,n,o){return X.exposeGlobal(r,n,W,o)}:Qi})(),Is=[];function bo(e,t){!e||typeof e!="object"||Is.push({ref:e,name:t||null})}bo(W,"global");Yi&&typeof Yi=="object"&&bo(Yi,"storage");W.cineAppSession&&bo(W.cineAppSession,"session");W.cineAppSetups&&bo(W.cineAppSetups,"setups");const Rs=Object.create(null),Zr=[];function hh(e){if(!e)return null;if(e.name)return e.name;const t=e.ref;return!t||typeof t!="object"?null:t===W?"global":typeof t.constructor=="function"&&t.constructor.name?t.constructor.name:null}function Uf(e,t){const r=String(e);let n=Rs[r];return n?t&&n.implementationName!==t&&(n.implementationName=t):(n={name:r,implementationName:t||r,available:!1,providerIndex:-1,providerName:null,lastChecked:null,implementation:null},Rs[r]=n,Zr.push(r)),n}function Ta(e,t={}){const r=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,n=Uf(e),o=n.implementationName||String(e);if(!r&&n.implementation&&typeof n.implementation=="function")return n;let i=null;for(let s=0;s<Is.length;s+=1){const a=Is[s],c=a&&a.ref;if(!c||typeof c!="object")continue;const u=c[o];if(typeof u=="function"){i={implementation:u,providerIndex:s,providerName:hh(a)};break}}return n.available=!!i,n.providerIndex=i?i.providerIndex:-1,n.providerName=i?i.providerName:null,n.lastChecked=Date.now(),n.implementation=i?i.implementation:null,n}function bh(e){const t=Ta(e,{refresh:!0});if(!t||typeof t.implementation!="function"){const r=new Error(`cinePersistence could not resolve function "${e}".`);throw r.code="CINE_PERSISTENCE_BINDING_MISSING",r.binding=e,r.detail={name:e,available:t?t.available:!1,providerName:t?t.providerName:null},r}return t.implementation}function Df(e){return e?Object.freeze({name:e.name,available:!!e.available,providerIndex:typeof e.providerIndex=="number"?e.providerIndex:-1,providerName:e.providerName||null,lastChecked:e.lastChecked||null,implementation:e.implementationName||e.name}):null}function P(e,t){const r=t||e;return Uf(r,e),function(){return bh(r).apply(this,arguments)}}function Sh(e,t={}){const r=String(e),n=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,o=Ta(r,{refresh:n});return Df(o)}function Eh(e={}){if(e&&Object.prototype.hasOwnProperty.call(e,"refresh")?e.refresh:!0)for(let n=0;n<Zr.length;n+=1)Ta(Zr[n],{refresh:!0});const r={};for(let n=0;n<Zr.length;n+=1){const o=Zr[n];r[o]=Df(Rs[o])}return Ra(r)}function wh(){return Zr.slice()}const On={bindings:{saveSession:P("saveCurrentSession","saveSession"),autoSaveSetup:P("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:P("saveCurrentGearList","saveGearList"),restoreSessionState:P("restoreSessionState"),collectFullBackupData:P("collectFullBackupData"),createSettingsBackup:P("createSettingsBackup"),captureStorageSnapshot:P("captureStorageSnapshot"),sanitizeBackupPayload:P("sanitizeBackupPayload"),autoBackup:P("autoBackup"),formatFullBackupFilename:P("formatFullBackupFilename"),downloadPayload:P("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:P("recordFullBackupHistoryEntry"),encodeSharedSetup:P("encodeSharedSetup"),decodeSharedSetup:P("decodeSharedSetup"),applySharedSetup:P("applySharedSetup"),applySharedSetupFromUrl:P("applySharedSetupFromUrl"),downloadProject:P("downloadSharedProject","downloadProject"),saveProject:P("saveProject"),proceed:P("handleRestoreRehearsalProceed","proceed"),abort:P("handleRestoreRehearsalAbort","abort")},storage:{loadDeviceData:P("loadDeviceData"),saveDeviceData:P("saveDeviceData"),loadSetups:P("loadSetups"),saveSetups:P("saveSetups"),saveSetup:P("saveSetup"),loadSetup:P("loadSetup"),deleteSetup:P("deleteSetup"),renameSetup:P("renameSetup"),loadSessionState:P("loadSessionState"),saveSessionState:P("saveSessionState"),loadFeedback:P("loadFeedback"),saveFeedback:P("saveFeedback"),saveProject:P("saveProject"),loadProject:P("loadProject"),deleteProject:P("deleteProject"),loadFavorites:P("loadFavorites"),saveFavorites:P("saveFavorites"),exportAllData:P("exportAllData"),importAllData:P("importAllData"),clearAllData:P("clearAllData"),loadAutoGearRules:P("loadAutoGearRules"),saveAutoGearRules:P("saveAutoGearRules"),loadAutoGearBackups:P("loadAutoGearBackups"),saveAutoGearBackups:P("saveAutoGearBackups"),loadAutoGearSeedFlag:P("loadAutoGearSeedFlag"),saveAutoGearSeedFlag:P("saveAutoGearSeedFlag"),loadAutoGearBackupRetention:P("loadAutoGearBackupRetention"),saveAutoGearBackupRetention:P("saveAutoGearBackupRetention"),getAutoGearBackupRetentionDefault:P("getAutoGearBackupRetentionDefault"),loadAutoGearPresets:P("loadAutoGearPresets"),saveAutoGearPresets:P("saveAutoGearPresets"),loadAutoGearActivePresetId:P("loadAutoGearActivePresetId"),saveAutoGearActivePresetId:P("saveAutoGearActivePresetId"),loadAutoGearAutoPresetId:P("loadAutoGearAutoPresetId"),saveAutoGearAutoPresetId:P("saveAutoGearAutoPresetId"),loadAutoGearMonitorDefaults:P("loadAutoGearMonitorDefaults"),saveAutoGearMonitorDefaults:P("saveAutoGearMonitorDefaults"),loadAutoGearBackupVisibility:P("loadAutoGearBackupVisibility"),saveAutoGearBackupVisibility:P("saveAutoGearBackupVisibility"),loadFullBackupHistory:P("loadFullBackupHistory"),saveFullBackupHistory:P("saveFullBackupHistory"),recordFullBackupHistoryEntry:P("recordFullBackupHistoryEntry"),requestPersistentStorage:P("requestPersistentStorage"),clearUiCacheStorageEntries:P("clearUiCacheStorageEntries"),ensureCriticalStorageBackups:P("ensureCriticalStorageBackups"),getLastCriticalStorageGuardResult:P("getLastCriticalStorageGuardResult"),saveSession:P("saveCurrentSession","saveSession"),autoSaveSetup:P("autoSaveCurrentSetup","autoSaveSetup"),proceed:P("handleRestoreRehearsalProceed","proceed"),abort:P("handleRestoreRehearsalAbort","abort")},autosave:{saveSession:P("saveCurrentSession","saveSession"),autoSaveSetup:P("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:P("saveCurrentGearList","saveGearList"),restoreSessionState:P("restoreSessionState")},backups:{collectFullBackupData:P("collectFullBackupData"),createSettingsBackup:P("createSettingsBackup"),captureStorageSnapshot:P("captureStorageSnapshot"),sanitizeBackupPayload:P("sanitizeBackupPayload"),autoBackup:P("autoBackup"),formatFullBackupFilename:P("formatFullBackupFilename"),downloadPayload:P("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:P("recordFullBackupHistoryEntry")},restore:{proceed:P("handleRestoreRehearsalProceed","proceed"),abort:P("handleRestoreRehearsalAbort","abort")},share:{downloadProject:P("downloadSharedProject","downloadProject"),encodeSharedSetup:P("encodeSharedSetup"),decodeSharedSetup:P("decodeSharedSetup"),applySharedSetup:P("applySharedSetup"),applySharedSetupFromUrl:P("applySharedSetupFromUrl")},__internal:Ra({listBindings:wh,inspectBinding(e,t){return Sh(e,t)||null},inspectAllBindings:Eh})};Ra(On);bo(On.bindings,"bindings");ah("cinePersistence",On);fh("cinePersistence",On,{category:"persistence",description:"Data integrity facade for storage, autosave, backups, restore, and share flows.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},e=>{gh("Unable to register cinePersistence module.",e)});if(W&&typeof W=="object"){let e=null;try{e=W.cinePersistence||null}catch{e=null}e!==On&&!mh("cinePersistence",On,{configurable:!0,enumerable:!1,writable:!1})&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose cinePersistence globally.")}export{Xl as _,fo as a,Yc as b,Mp as c,ls as d,Ts as e,rh as f,Mr as g,Ch as h,we as r,K as s};
//# sourceMappingURL=core-modules-CvxJ6PMl.js.map
