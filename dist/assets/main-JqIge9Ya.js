import{i as iconGlyph$1,I as ICON_GLYPHS$1,a as iconMarkup$2,_ as __vitePreload,b as detectGlobalScope$l,c as baseApi,r as registry$2,e as api$1,f as createCollector,g as resolverApi,h as cineStorage,n as normalizePowerPortType$1,j as normalizeViewfinderType$2,k as normalizeFizConnectorType$2,l as normalizeVideoType$2,m as ensureList$2,o as fixPowerInput$2}from"./core-modules-Be_U3JJE.js";import{V as V2Bootstrap}from"./v2-ui-czcGWvey.js";import{r as rentalHouses,d as devices$2,c as cineDevices}from"./data-So-wGb1N.js";import{a as storage,t as translations$2}from"./vendor-DzOFLsIx.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();const index$1=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),createInlineRuntimeToolFallbacks=(function(){function t(l){return l&&(typeof l=="object"||typeof l=="function")?l:typeof CORE_PART1_RUNTIME_SCOPE<"u"&&CORE_PART1_RUNTIME_SCOPE&&typeof CORE_PART1_RUNTIME_SCOPE=="object"?CORE_PART1_RUNTIME_SCOPE:typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:typeof window<"u"&&window&&typeof window=="object"?window:typeof self<"u"&&self&&typeof self=="object"?self:typeof global<"u"&&global&&typeof global=="object"?global:null}function o(l,u,d){const m=typeof u=="function"?u:function(){return u},y=t(d);if(!y||typeof l!="string"||!l)try{return m()}catch{return}try{if(typeof y[l]<"u")return y[l]}catch{}const h=m();try{return y[l]=h,y[l]}catch{}try{return Object.defineProperty(y,l,{configurable:!0,writable:!0,value:h}),y[l]}catch{}return h}function r(l){if(l===null||typeof l!="object")return l;try{return JSON.parse(JSON.stringify(l))}catch{}return l}function n(l){if(typeof structuredClone=="function")return structuredClone;const u=t(l);if(u&&typeof u.structuredClone=="function")try{return u.structuredClone.bind(u)}catch{}return null}function a(l){const u=n(l);return u?function(m){if(m===null||typeof m!="object")return m;try{return u(m)}catch{}return r(m)}:r}function s(l){const u=t(l);if(u&&typeof u.__cineDeepClone=="function")return u.__cineDeepClone;const d=a(u);if(u&&typeof u=="object"){try{Object.defineProperty(u,"__cineDeepClone",{configurable:!0,writable:!0,value:d})}catch{}try{typeof u.__cineDeepClone!="function"&&(u.__cineDeepClone=d)}catch{}}return d}return function(u){const d=t(u);return{getCoreGlobalObject(){return t(d)},ensureCoreGlobalValue(m,y){return o(m,y,d)},jsonDeepClone:r,resolveStructuredClone(m){return n(m||d)},createResilientDeepClone(m){return a(m||d)},ensureDeepClone(m){return s(m||d)}}}})(),_CORE_PART1_RUNTIME_SCOPE=(()=>{try{if(typeof CORE_PART1_RUNTIME_SCOPE<"u"&&CORE_PART1_RUNTIME_SCOPE)return CORE_PART1_RUNTIME_SCOPE}catch{}return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null})();let CORE_RUNTIME_TOOL_FALLBACKS=typeof CORE_RUNTIME_TOOL_FALLBACK_FACTORY=="function"?CORE_RUNTIME_TOOL_FALLBACK_FACTORY(_CORE_PART1_RUNTIME_SCOPE):null;(!CORE_RUNTIME_TOOL_FALLBACKS||typeof CORE_RUNTIME_TOOL_FALLBACKS!="object")&&(CORE_RUNTIME_TOOL_FALLBACKS=createInlineRuntimeToolFallbacks(_CORE_PART1_RUNTIME_SCOPE));function fallbackGetCoreGlobalObject(){if(CORE_RUNTIME_TOOL_FALLBACKS&&typeof CORE_RUNTIME_TOOL_FALLBACKS.getCoreGlobalObject=="function")try{const e=CORE_RUNTIME_TOOL_FALLBACKS.getCoreGlobalObject();if(e)return e}catch{}return typeof CORE_PART1_RUNTIME_SCOPE<"u"&&CORE_PART1_RUNTIME_SCOPE&&typeof CORE_PART1_RUNTIME_SCOPE=="object"?CORE_PART1_RUNTIME_SCOPE:typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:typeof window<"u"&&window&&typeof window=="object"?window:typeof self<"u"&&self&&typeof self=="object"?self:typeof global<"u"&&global&&typeof global=="object"?global:null}function fallbackEnsureCoreGlobalValue(e,t){if(CORE_RUNTIME_TOOL_FALLBACKS&&typeof CORE_RUNTIME_TOOL_FALLBACKS.ensureCoreGlobalValue=="function")try{return CORE_RUNTIME_TOOL_FALLBACKS.ensureCoreGlobalValue(e,t)}catch{}const o=typeof t=="function"?t:function(){return t};if(typeof e!="string"||!e)try{return o()}catch{return}const r=fallbackGetCoreGlobalObject();if(!r||typeof r!="object")return o();let n;try{n=r[e]}catch{n=void 0}if(typeof n<"u")return n;const a=o();try{return r[e]=a,r[e]}catch{}try{return Object.defineProperty(r,e,{configurable:!0,writable:!0,value:a}),r[e]}catch{}return a}function fallbackJsonDeepClone(e){if(CORE_RUNTIME_TOOL_FALLBACKS&&typeof CORE_RUNTIME_TOOL_FALLBACKS.jsonDeepClone=="function")try{return CORE_RUNTIME_TOOL_FALLBACKS.jsonDeepClone(e)}catch{}if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}function fallbackCreateResilientDeepClone(e){if(CORE_RUNTIME_TOOL_FALLBACKS&&typeof CORE_RUNTIME_TOOL_FALLBACKS.createResilientDeepClone=="function")try{return CORE_RUNTIME_TOOL_FALLBACKS.createResilientDeepClone(e)}catch{}return function(o){return fallbackJsonDeepClone(o)}}function fallbackEnsureDeepClone(e){if(CORE_RUNTIME_TOOL_FALLBACKS&&typeof CORE_RUNTIME_TOOL_FALLBACKS.ensureDeepClone=="function")try{return CORE_RUNTIME_TOOL_FALLBACKS.ensureDeepClone(e)}catch{}const t=e||fallbackGetCoreGlobalObject(),o=fallbackCreateResilientDeepClone(t);if(t&&typeof t=="object")try{Object.defineProperty(t,"__cineDeepClone",{configurable:!0,writable:!0,value:o})}catch{try{t.__cineDeepClone=o}catch{}}return o}var CORE_GLOBAL_SCOPE$4=fallbackGetCoreGlobalObject();const CORE_RUNTIME_TOOLS_REFERENCE=(function(){var t=[];typeof globalThis<"u"&&t.push(globalThis),typeof window<"u"&&t.push(window),typeof self<"u"&&t.push(self),typeof global<"u"&&t.push(global);for(var o=0;o<t.length;o+=1){var r=t[o];if(!(!r||typeof r!="object"))try{if(r.CORE_RUNTIME_TOOLS)return r.CORE_RUNTIME_TOOLS}catch{}}return null})(),getCoreGlobalObject$1=CORE_RUNTIME_TOOLS_REFERENCE&&typeof CORE_RUNTIME_TOOLS_REFERENCE.detectScope=="function"?function(){try{return CORE_RUNTIME_TOOLS_REFERENCE.detectScope(CORE_GLOBAL_SCOPE$4)}catch{}return fallbackGetCoreGlobalObject()}:fallbackGetCoreGlobalObject,ensureCoreGlobalValue=CORE_RUNTIME_TOOLS_REFERENCE&&typeof CORE_RUNTIME_TOOLS_REFERENCE.ensureGlobalValue=="function"?function(t,o){return CORE_RUNTIME_TOOLS_REFERENCE.ensureGlobalValue(t,o,CORE_GLOBAL_SCOPE$4)}:fallbackEnsureCoreGlobalValue,coreJsonDeepClone=CORE_RUNTIME_TOOLS_REFERENCE&&typeof CORE_RUNTIME_TOOLS_REFERENCE.jsonDeepClone=="function"?function(t){try{return CORE_RUNTIME_TOOLS_REFERENCE.jsonDeepClone(t)}catch{}return fallbackJsonDeepClone(t)}:fallbackJsonDeepClone,coreCreateResilientDeepClone=CORE_RUNTIME_TOOLS_REFERENCE&&typeof CORE_RUNTIME_TOOLS_REFERENCE.createResilientDeepClone=="function"?function(t){try{return CORE_RUNTIME_TOOLS_REFERENCE.createResilientDeepClone(t||CORE_GLOBAL_SCOPE$4)}catch{}return fallbackCreateResilientDeepClone(t||CORE_GLOBAL_SCOPE$4)}:fallbackCreateResilientDeepClone,CORE_DEEP_CLONE=CORE_RUNTIME_TOOLS_REFERENCE&&typeof CORE_RUNTIME_TOOLS_REFERENCE.ensureDeepClone=="function"?CORE_RUNTIME_TOOLS_REFERENCE.ensureDeepClone(CORE_GLOBAL_SCOPE$4):fallbackEnsureDeepClone(CORE_GLOBAL_SCOPE$4);if(CORE_GLOBAL_SCOPE$4&&typeof CORE_GLOBAL_SCOPE$4.__cineDeepClone!="function")try{CORE_GLOBAL_SCOPE$4.__cineDeepClone=CORE_DEEP_CLONE}catch{}(function(){const t={};function o(n,a){try{Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get(){return a}})}catch{t[n]=a}}o("createInlineRuntimeToolFallbacks",createInlineRuntimeToolFallbacks),o("CORE_RUNTIME_TOOL_FALLBACKS",CORE_RUNTIME_TOOL_FALLBACKS),o("fallbackGetCoreGlobalObject",fallbackGetCoreGlobalObject),o("fallbackEnsureCoreGlobalValue",fallbackEnsureCoreGlobalValue),o("fallbackJsonDeepClone",fallbackJsonDeepClone),o("fallbackCreateResilientDeepClone",fallbackCreateResilientDeepClone),o("fallbackEnsureDeepClone",fallbackEnsureDeepClone),o("CORE_GLOBAL_SCOPE",CORE_GLOBAL_SCOPE$4),o("getCoreGlobalObject",getCoreGlobalObject$1),o("ensureCoreGlobalValue",ensureCoreGlobalValue),o("coreJsonDeepClone",coreJsonDeepClone),o("coreCreateResilientDeepClone",coreCreateResilientDeepClone),o("CORE_DEEP_CLONE",CORE_DEEP_CLONE);const r=[];try{CORE_GLOBAL_SCOPE$4&&typeof CORE_GLOBAL_SCOPE$4=="object"&&r.push(CORE_GLOBAL_SCOPE$4)}catch{}typeof globalThis<"u"&&globalThis&&r.push(globalThis),typeof window<"u"&&window&&r.push(window),typeof self<"u"&&self&&r.push(self),typeof global<"u"&&global&&r.push(global);for(let n=0;n<r.length;n+=1){const a=r[n];if(!(!a||typeof a!="object"&&typeof a!="function"))try{a.cineCoreRuntimeGlobalTools||(a.cineCoreRuntimeGlobalTools=t),a.ensureCoreGlobalValue||(a.ensureCoreGlobalValue=t.ensureCoreGlobalValue),a.getCoreGlobalObject||(a.getCoreGlobalObject=t.getCoreGlobalObject),a.CORE_DEEP_CLONE||(a.CORE_DEEP_CLONE=t.CORE_DEEP_CLONE)}catch{}}return t})();typeof window<"u"&&(console.log("[Vite Global Patches] Applying global shims..."),window.getCoreGlobalObject=getCoreGlobalObject$1,window.CORE_GLOBAL_SCOPE=window,window.iconGlyph=iconGlyph$1,window.ICON_GLYPHS=ICON_GLYPHS$1,window.iconMarkup=iconMarkup$2,typeof window.CORE_RUNTIME_CANDIDATE_SCOPES>"u"&&(window.CORE_RUNTIME_CANDIDATE_SCOPES=null),typeof window.CORE_RUNTIME_STATE_SUPPORT>"u"&&(window.CORE_RUNTIME_STATE_SUPPORT=null),console.log("[Vite Global Patches] Shims applied."));(function(){console.log("[ForcePopulate] Script loaded");function e(){if(!window.devices||!window.populateSelect)return console.log("[ForcePopulate] Waiting for dependencies..."),!1;console.log("[ForcePopulate] Dependencies ready. Populating...");const t=window.devices,o=window.populateSelect,r=(a,s)=>{const l=document.getElementById(a);if(l&&l.options.length<=1)try{o(l,s),console.log(`[ForcePopulate] Populated ${a} with ${Object.keys(s).length} items`)}catch(u){console.error(`[ForcePopulate] Failed to populate ${a}`,u)}};if(t.cameras&&r("cameraSelect",t.cameras),t.monitors&&r("monitorSelect",t.monitors),t.video&&r("videoSelect",t.video),t.batteries&&r("batterySelect",t.batteries),t.batteryHotswaps&&r("batteryHotswapSelect",t.batteryHotswaps),t.fiz&&["motor1Select","motor2Select","motor3Select","motor4Select","controller1Select","controller2Select","controller3Select","controller4Select"].forEach(a=>{r(a,t.fiz)}),typeof window.processCoreBootQueue=="function")console.log("[ForcePopulate] Triggering boot queue processing..."),window.processCoreBootQueue();else if(window.CORE_BOOT_QUEUE&&window.CORE_BOOT_QUEUE.length>0){console.warn("[ForcePopulate] processCoreBootQueue not found, manually draining queue...");const a=window.CORE_BOOT_QUEUE;a.splice(0,a.length).forEach(l=>{try{l()}catch{}})}console.log("[ForcePopulate] Dismissing loading overlay...");const n=document.getElementById("cineGlobalLoadingIndicator");n&&(n.style.display="none",n.setAttribute("aria-hidden","true")),console.log("[ForcePopulate] Initializing V2 Bootstrap...");try{V2Bootstrap&&typeof V2Bootstrap.init=="function"&&V2Bootstrap.init()}catch(a){console.error("[ForcePopulate] V2 Bootstrap init failed",a)}try{window.dispatchEvent(new CustomEvent("cine-loader-complete"))}catch(a){console.error(a)}return document.body.classList.add("app-ready"),!0}if(!e()){const t=setInterval(()=>{e()&&clearInterval(t)},100)}})();const data={texts:{appTitle:"Cine Power Planner",tagline:"Plan your film rig and calculate power consumption & battery life.",printPreview:{title:"Print & Export",closeLabel:"Close Preview",layoutModeTitle:"Layout Mode",layoutRentalLabel:"Rental Friendly",layoutRentalDescription:"Optimizes layout for rental by grouping items by category.",sectionsTitle:"Sections",sectionProject:"Production Requirements",sectionDevices:"Camera Package Devices",sectionDiagram:"Power Diagram",sectionGearList:"Kit List",sectionBattery:"Battery Comparison",exportPdfButton:"Export PDF",printButton:"Print",generatedTitle:"Overview",generatedProjectNameLabel:"Project Name:",generatedProductionLabel:"Production:",generatedDateLabel:"Date:",generatedNoProjectRequirements:"No production requirements data.",generatedDeviceSelectionTitle:"Camera Package Devices",generatedNoDevicesSelected:"No devices selected.",generatedPowerDiagramTitle:"Power Diagram",generatedPowerSummaryTitle:"Power Summary",generatedGearListTitle:"Kit List",generatedTotalLoad:"Total Load",generatedPeak:"Peak:",generatedEstRuntime:"Est. Runtime",generatedWith:"w/",generatedDailyNeeds:"Daily Needs",generatedBatts:"Batts",generatedFor12hDay:"for 12h day"},skipToContent:"Skip to content",offlineIndicator:"Offline",offlineIndicatorHelp:"Appears when the planner is offline or the service worker reports degraded connectivity. All projects, backups and device data stay stored on this device so you can keep working. Force reload and other network actions stay disabled until connectivity recovers.",offlineIndicatorDegraded:"Connectivity degraded — working from cached copy.",offlineIndicatorDegradedHelp:"The service worker served cached content after a failed probe. Continue working from the offline copy and retry once the banner clears.",offlineIndicatorReasonCacheFallback:"Service worker served the cached bundle after a network error.",offlineIndicatorReasonGetFailed:"Network request for the reload check failed.",offlineIndicatorReasonTimeout:"Connectivity probe timed out before the server responded.",offlineIndicatorReasonUnreachable:"The probe could not reach the server.",offlineIndicatorReasonReloadBlocked:"Reload is paused until a healthy connection is confirmed.",offlineIndicatorReasonUnknown:"Connectivity degraded. Keep working offline until the banner clears.",globalLoadingIndicator:"Loading data…",globalLoadingIndicatorPreparing:"Preparing planner…",globalLoadingIndicatorModules:"Loading planner interface…",globalLoadingIndicatorData:"Loading planner data…",globalLoadingIndicatorAlmostReady:"Almost ready…",installBannerText:"Install Cine Power Planner on your device for quick access.",installBannerDismiss:"Dismiss",installHelpTitleIos:"Install Cine Power Planner on iOS",installHelpTitleAndroid:"Install Cine Power Planner on Android",installHelpIntroIos:"Add the planner to your Home Screen to use it like an app.",installHelpIntroAndroid:"Add the planner to your Home Screen to use it like an app.",installHelpStepsIos:["Open Cine Power Planner in Safari.","Tap the Share button.","Choose Add to Home Screen and confirm."],installHelpStepsAndroid:["Open Cine Power Planner in Chrome.","Tap the browser menu (⋮).","Choose Add to Home Screen and confirm."],installHelpNoteIos:"Once installed, launch Cine Power Planner from your Home Screen.",installHelpNoteAndroid:"Android keeps using the same storage for the browser and the installed app, so your projects stay available.",installHelpMigrationTitle:"Move your existing data into the app",installHelpClose:"Close",iosPwaHelpTitle:"Keep your data when installing on iOS",iosPwaHelpIntro:"Safari keeps the browser tab and the installed app separate. To move your Cine Power Planner data into the app:",iosPwaHelpStep1:"Open Cine Power Planner in Safari where your projects are still visible.",iosPwaHelpStep2:"Go to Settings → Backup & Restore → Backup to download a copy of your data.",iosPwaHelpStep3:"Open Cine Power Planner from your home screen.",iosPwaHelpStep4:"Go to Settings → Backup & Restore → Restore and pick the backup file.",iosPwaHelpNote:"After restoring once, all changes stay inside the installed app. Keep the backup if you plan to reinstall or switch devices.",iosPwaHelpClose:"Got it",impressum:"Imprint",privacy:"Privacy Policy",setupManageHeading:"Project Overview",deviceSelectionHeading:"Camera Package",overviewDeviceSelectionHeading:"Camera Package Devices",resultsHeading:"Power Summary",deviceManagerHeading:"Device Library",batteryComparisonHeading:"Battery Comparison",batteryComparisonDescription:"Review every compatible battery to see runtime estimates for your current setup.",batteryComparisonDescriptionHelp:"This table lists every compatible battery and updates as you change your setup. Hover any heading to learn what the numbers represent.",batteryComparisonTableHelp:"Rows show compatible batteries. Runtime includes current draw calculations, and the colored bar compares runtime length at a glance.",setupDiagramHeading:"Power Diagram",diagramPdfNote:"The Power Diagram is not included in the PDF export. Open the print view to review the layout.",projectRequirementsNav:"Production Requirements",projectRequirementsNavHelp:"Jump to the Production Requirements output once generated.",gearListNav:"Kit List",gearListNavHelp:"View the generated kit list with all items and categories.",ownGearNav:"Own Gear",ownGearNavHelp:"Track personal gear you already have on hand and reuse it across projects.",overviewExportTitleSuffix:"Kit List and Production Requirements",openSettingsNav:"Settings",openSettingsNavHelp:"Open Settings to adjust language, themes, accessibility options and backups.",openHelpNav:"Help Center",openHelpNavHelp:"Open the in-app help guide with tutorials, troubleshooting tips and shortcuts.",setupManageHeadingHelp:"Manage saved projects: save, load, or clear configurations.",deviceSelectionHeadingHelp:"Choose cameras, monitors, and accessories for your camera package.",resultsHeadingHelp:"See power consumption, estimated runtime, and battery counts.",resultsPlainSummaryTitle:"Quick summary",resultsPlainSummaryHelp:"Explains the power summary in plain language so you can confirm runtime and battery needs without reading every table.",resultsPlainSummaryPrompt:"Add devices and choose a battery to see a plain-language summary of runtime and consumption.",resultsPlainSummaryNeedBattery:"Choose a battery to see how long the rig will run and how many packs to pack.",resultsPlainSummaryRuntime:"With {batteryName}, expect about {hours} hours of runtime. Pack {batteryCount} batteries for a 10-hour day. Your rig currently draws {totalPower} W.",resultsPlainSummaryUnlimited:"With {batteryName}, your rig draws {totalPower} W, so runtime stays unlimited. Keep a charged pack connected before recording.",resultsPlainSummaryNote:"Pins and D-Tap status updates as you add gear.",resultsPlainSummaryPinsZero:"Pins: no 12V draw yet.",resultsPlainSummaryPinsOk:"Pins: {current}A within the {max}A limit.",resultsPlainSummaryPinsNear:"Pins: {current}A is close to the {max}A limit.",resultsPlainSummaryPinsExceeded:"Pins: {current}A exceeds the {max}A limit.",resultsPlainSummaryPinsUnknown:"Pins: draw is {current}A but no limit is documented.",resultsPlainSummaryDtapZero:"D-Tap: idle.",resultsPlainSummaryDtapOk:"D-Tap: {current}A within the {max}A rating.",resultsPlainSummaryDtapNear:"D-Tap: {current}A is close to the {max}A rating.",resultsPlainSummaryDtapExceeded:"D-Tap: {current}A exceeds the {max}A rating.",resultsPlainSummaryDtapUnavailable:"D-Tap: auxiliary port disabled for this battery selection.",resultsPlainSummaryDtapUnavailableBMount:"D-Tap: B-Mount cameras disable the aux port.",resultsPlainSummaryDtapUnknown:"D-Tap: rating missing, treat {current}A with caution.",resultsPlainSummaryUnnamedBattery:"your selected battery",deviceManagerHeadingHelp:"Add, edit or remove entries from the device database, including categories, subcategories and attributes.",batteryComparisonHeadingHelp:"Compare runtimes for all compatible batteries.",batteryTableBatteryHelp:"Battery name and mount that can power your current build.",batteryTableRuntimeHelp:"Estimated runtime in hours plus which outputs supply enough current.",batteryTableGraphLabel:"Runtime comparison bar",batteryTableGraphHelp:"Bar length compares runtime across batteries. Green covers pins and D-Tap, orange means only main pins, and blue marks infinite runtime estimates.",setupDiagramHeadingHelp:"View the Power Diagram showing how power, video, and control connect across the rig.",setupDiagramPlaceholder:"Select devices to visualize the project.",diagramLegendPower:"Power",diagramLegendVideo:"Video",diagramLegendFIZ:"FIZ",downloadDiagramBtn:"Download Power Diagram",gridSnapToggle:"Snap to Grid",existingDevicesHeading:"Existing Devices",deviceLibrarySearchLabel:"Search entire library",deviceLibrarySearchPlaceholder:"Search all device categories…",deviceLibrarySearchHelp:"Filter across every category at once. Press Enter to jump to the closest match.",deviceLibrarySearchStatusDefault:"Showing all {total} devices.",deviceLibrarySearchResultOne:"Showing {visible} of {total} devices.",deviceLibrarySearchResultOther:"Showing {visible} of {total} devices.",deviceLibrarySearchNoResults:"No devices match “{query}”.",darkModeLabel:"Toggle dark mode",existingDevicesSubtitle:"Browse and manage devices in your library",existingDevicesTitle:"Existing Devices",addDeviceSubtitle:"Create a custom device entry for your database",addNewDeviceTitle:"Add New Device",tabBrowseLibrary:"Browse Library",tabAddDevice:"Add Device",deviceLibrarySubtitle:"Add, edit, and manage devices in your local database",deviceLibraryTitle:"Device Library",v2ui:{revision:"REV.02"},pinkModeLabel:"Toggle pink mode",menuToggleLabel:"Menu",menuToggleHelp:"Open the sidebar to jump between planner sections or reveal controls on smaller screens. Click again to close it.",sideMenuTitle:"Planner sections",sideMenuTitleHelp:"Swipe up to explore planner sections and mobile controls. Your project keeps saving automatically while you browse.",sideMenuClose:"Close navigation",sideMenuCloseHelp:"Close the navigation drawer and return to the planner. Your data stays saved and ready to restore if needed.",sideMenuHelp:"Sidebar navigation listing planner sections. Select a section to scroll there and the menu closes automatically.",contacts:{heading:"Contacts",description:"Save crew members once, keep them stored offline and reuse them for every project.",addContactButton:"Add contact",importButton:"Import vCard",importHint:"Import .vcf files to add contacts instantly. Existing details are preserved automatically.",emptyState:"No contacts saved yet. Add your crew to reuse them later.",close:"Close",selectLabel:"Saved contacts",selectPlaceholder:"Select contact",saveContact:"Save to contacts",openManager:"Open contacts",linkedBadge:"Linked to contact",linkedProfileBadge:"Linked to user profile",contactMissingDetails:"Enter a name, email, phone number or website before saving this contact.",websiteLabel:"Website",websitePlaceholder:"https://example.com",avatarOptionsTitle:"Photo options",avatarOptionsDescription:"Preview this photo, choose how to update it, or click outside the window to save and close.",avatarOptionsClose:"Close",avatarDelete:"Delete photo",avatarEditAction:"Edit framing",avatarChange:"Change photo",avatarCleared:"Profile photo removed.",avatarTooLarge:"Choose an image under 300 KB.",avatarReadError:"Could not read the selected image.",avatarUpdated:"Profile photo updated.",avatarEditInstructions:"Drag the photo to adjust the framing.",avatarEditZoomLabel:"Zoom",avatarEditCancel:"Cancel",avatarEditApply:"Apply framing",avatarMissingImage:"Add a photo before editing.",avatarEditUnavailable:"Photo editor unavailable.",avatarEditFailed:"Could not update the photo framing.",userProfileHeading:"Your profile",userProfileDescription:"Add your name, role, phone and email so your gear shows as “User”.",userProfileNameLabel:"Display name",userProfileNamePlaceholder:"Your name",userProfileRoleLabel:"Role or title",userProfileRolePlaceholder:"Select role",userProfilePhoneLabel:"Phone number",userProfilePhonePlaceholder:"Your phone number",userProfileEmailLabel:"Email address",userProfileEmailPlaceholder:"name@example.com",userProfileHint:"Used to show your first name and last initial for the “User” option in the provided by dropdown. Phone and email appear on exports and backups so crews can reach you offline.",userProfileAvatarButton:"Change photo",userProfileAvatarRemove:"Remove photo",userProfileSaved:"Profile saved.",contactDetached:"Crew row disconnected from saved contact.",contactApplied:"Crew row updated from contact.",contactDeleted:"Contact removed. Project rows keep their details.",contactSaved:"Contact saved for future projects.",contactUpdated:"Contact updated.",contactDraftCreated:"New contact ready. Fill in the details.",contactFallbackName:"Crew contact",useInProject:"Add to project crew",contactAddedToProject:"Contact added to the current project.",deleteContact:"Delete contact",deleteConfirm:"Remove this contact? Project rows will keep their details.",importSummary:"{added} added, {updated} updated.",importNone:"No new contacts found in the file.",importError:"Could not import the selected file.",rolePlaceholder:"Select role"},featureSearchPlaceholder:"Search features, devices, actions, or help...",featureSearchLabel:"Search features, devices, actions, and help",featureSearchHelp:`Type to jump to features, devices, quick actions like Save or Backup, or help topics. Suggestions prioritize direct feature and device matches before help topics so navigation lands on controls first. Each entry shows whether it opens a Feature, Action, Device or Help topic so you know what happens before pressing Enter. Exact matches and items you've used recently jump to the top automatically, so your go-to controls stay first. Every suggestion also includes a short description so you can confirm what it will do at a glance. Search also reads the same tooltip and help text shown around controls, so words like "JSON" or "autosave" still land on the right button even if the label differs. Small typos are forgiven too, so "bakcup" still finds Backup or Save. Connector and media abbreviations like "USB-C", "Micro-HDMI", "SDXC", "CFexpress", "V-Mount" or "D-Tap" automatically match their full names, so type whichever version you remember. Exposure and color vocabulary is linked the same way—ISO, EI, ASA, exposure index, ND or neutral density, and WB, white balance or color temperature terms all resolve together so any phrasing points to the right controls. Press Enter to navigate, / or Ctrl+K (Cmd+K on Mac) to focus the search from anywhere, use Escape or × to clear the query, and notice how clearing the field floats your most recently used matches to the top for faster repeats. Prefix your query with "feature", "action", "device" or "help" (or your localized equivalents) (for example, "help: battery") to filter suggestions to that type. Start with "recent" or "history" (or your localized equivalents) (for example, "recent iso") to search only items you've used lately before scanning the full catalog. Wrap any phrase in double quotes to force an exact match, so typing "battery health" with quotes jumps ahead of broader matches. Common filler words are ignored automatically, so conversational questions like "how do I back up" still surface the important keywords.`,featureSearchFilterAliases:{feature:["feature","features","setting","settings"],action:["action","actions","command","commands"],device:["device","devices","gear","equipment"],help:["help","doc","docs","guide","guides","support"],recent:["recent","recents","recently","history","histories","frequent","frequently"]},featureSearchStopWords:["how","do","does","did","done","doing","can","cant","cannot","should","could","would","please","need","needs","needing","want","wants","wanting","i","im","ive","ill","id","we","were","weve","well","you","youre","youve","youll","they","theyre","theyve","them","us","me","my","mine","our","ours","your","yours","their","theirs","the","and","for","with","about","what","where","when","why","which","who","whom","whose","this","that","these","those","also","still","really","very","just","maybe","perhaps","again"],featureSearchClear:"Clear search",featureSearchClearHelp:"Clear the search box and show all results again. Press Escape to clear quickly.",featureSearchTypeFeature:"Feature",featureSearchTypeAction:"Action",featureSearchTypeDevice:"Device",featureSearchTypeHelp:"Help topic",darkModeHelp:"Switch between light and dark themes for comfortable viewing. Press D to toggle. The preference is saved.",pinkModeHelp:"Add a playful pink accent theme. The unicorn icon cycles every 30 seconds with a gentle pop animation while pink mode is on, and the setting works with light or dark mode and is remembered for next time.",settingsButton:"Settings",settingsButtonHelp:"Open Settings to personalize language, colors, fonts, accessibility options and backups.",settingsHeading:"Settings",settingsHeadingHelp:"Adjust language, themes, typography, accessibility preferences and backups in one place.",settingsSectionsLabel:"Settings sections",settingsTabGeneral:"General",settingsTabGeneralHelp:"Adjust language, theme, typography and branding preferences.",generalSectionLanguageHeading:"Language & units",generalSectionAppearanceHeading:"Appearance",generalSectionCameraColorsHeading:"Camera designations",generalSectionTypographyHeading:"Typography",generalSectionBrandingHeading:"Branding",documentationTrackerHeading:"Documentation update tracker",documentationTrackerDescription:"Use this log to mark translation, help and print guide refreshes before distributing offline bundles.",documentationTrackerAddRelease:"New release log",documentationTrackerEmpty:"No releases tracked yet. Add the upcoming release to start logging updates.",documentationTrackerSummaryIntro:"Create release log entries to track translations, help topics, READMEs and print guides until every item is verified.",documentationTrackerLocalesHeading:"Localized README coverage",documentationTrackerLocaleEnglish:"English README",documentationTrackerLocaleGerman:"German README",documentationTrackerLocaleSpanish:"Spanish README",documentationTrackerLocaleFrench:"French README",documentationTrackerLocaleItalian:"Italian README",documentationTrackerHelpHeading:"Help center topics",helpTopics:{projectManagement:{title:"Project Management",content:"Name projects and press **Save** to capture snapshots in Saved Projects. Saving won’t overwrite other projects until you confirm the name. Autosave and auto-backups protect drafts, and Delete removes entries only after a safety snapshot is created."},saveShareBackup:{title:"Save, Share & Backup",content:"Use **Export Project** to download a JSON bundle (optionally include automatic gear rules and owned-gear markers). Use **Share Project** to create a share bundle for offline import; recipients open it with **Import Project** and nothing overwrites their current setup until they confirm Save. Use **Backup & Restore** for full-app backups, restore rehearsals, version comparisons, and the local backup vault when automatic downloads are blocked."},deviceConfiguration:{title:"Camera Package",content:"Build your camera package by selecting devices. Start with a **Camera**, then add **Monitors**, **Wireless Transmitters**, and **FIZ** systems. Use the Device Library to import or export custom gear so offline edits stay with your projects."},powerCalculation:{title:"Power Calculation",content:"The **Power Summary** shows the total power consumption of your rig and estimated runtime based on the selected battery and mount voltages. Watch for **Pin** and **D-Tap** warnings, and use the quick summary to explain results offline."},connectionDiagram:{title:"Power Diagram",content:"The **Power Diagram** shows how power, video, and control gear connect. Drag to arrange nodes, zoom and pan to inspect details, and download SVG or JPG snapshots for sharing."},gearList:{title:"Kit List",content:"Generate a detailed **Kit List** from camera package devices and production requirements. Edit quantities, providers, temporary extras and owned-gear badges, then print or export it for rental or crew."},contacts:{title:"Contacts",content:"Save crew members in **Contacts** or import vCards. Entries reuse across projects and flow into providers, backups and exports."},ownGear:{title:"Own Gear",content:"Track your personal inventory in **Own Gear**. Mark items you own so kit list rows can be flagged and exported with those annotations."},settings:{title:"Settings",content:"Customize the planner in **Settings**. Adjust **Language**, themes, typography, branding and **Backup & Restore** safeguards, plus automatic gear rules and documentation tracking."},offlineUse:{title:"Offline Use",content:"Cine Power Planner works fully **Offline** with locally stored icons, fonts and help content. Verify the offline indicator. Export at least one project and create a full backup before disconnecting. Run a restore rehearsal (or at minimum confirm the latest autosave timestamp in Settings → Data & Storage)."},troubleshooting:{title:"Troubleshooting",content:`If things aren't working as expected:

- **Force reload**: Open the toolbar help/status menu and choose **Force reload** to refresh the app without touching your data.
- **Export + Backup**: Before clearing browser cache or site data, **Export Project** and run **Backup & Restore** to capture your project and a full local backup.
- **Browser cache/site data**: Only if issues persist, clear your browser cache or site data. **Warning:** clearing site data can delete locally stored projects.`},shortcuts:{title:"Keyboard Shortcuts",content:`Navigate faster with these keys:

- **?**, **H**, **F1**: Open Help
- **/**: Focus Search
- **Esc**: Close dialogs or menus
- **D**: Toggle Dark Mode`},pinkMode:{title:"Pink Mode",content:"Activate **Pink Mode** in Settings or the top bar to add playful accents and animated icons. The unicorn icon cycles every 30 seconds, and floating stickers drift across the screen. Click any floating sticker **3 times** to trigger a celebratory rain effect."}},documentationTrackerHelpStart:"Start Here & navigation",documentationTrackerHelpSave:"Saving, sharing & exports",documentationTrackerHelpBackup:"Backup & restore drills",documentationTrackerHelpOwnGear:"Own gear & imports",documentationTrackerHelpOffline:"Offline readiness & service worker",documentationTrackerHelpPinkMode:"Pink mode & animations",documentationTrackerPrintHeading:"Printable guides",documentationTrackerPrintChecklist:"Documentation update checklist",documentationTrackerPrintMaintenance:"Documentation maintenance guide",documentationTrackerPrintSaveShare:"Save, share, import, backup & restore reference",documentationTrackerPrintOffline:"Offline readiness drill",documentationTrackerReleaseNameLabel:"Release name",documentationTrackerReleaseDateLabel:"Target release date",documentationTrackerNotesLabel:"Verification notes",documentationTrackerNotesPlaceholder:"Record what changed, who reviewed it and where the artifacts were stored.",documentationTrackerMarkAllComplete:"Mark all complete",documentationTrackerArchiveRelease:"Archive release",documentationTrackerRestoreRelease:"Reopen release",documentationTrackerArchivedBadge:"Archived",documentationTrackerArchiveConfirm:'Archive "{name}"? Completed checkmarks stay logged for audits.',documentationTrackerSummaryPending:'{remaining} of {total} documentation tasks remain for "{name}".',documentationTrackerSummaryComplete:'All {total} documentation tasks for "{name}" are complete.',documentationTrackerFallbackReleaseName:"Documentation release",documentationTrackerProgress:"{completed}/{total} complete",documentationTrackerSectionProgress:"{completed}/{total}",documentationTrackerUpdatedAt:"Updated {time}",documentationTrackerTargetSummary:"Target {date}",documentationTrackerDefaultReleaseName:"Release {date}",settingsTabBackup:"Backup & Restore",settingsTabData:"Data & Storage",settingsTabAbout:"About & Support",generalSectionInterfaceHeading:"Interface & Accessibility",generalSectionInterfaceHelp:"Manage font sizes, high contrast mode and animation preferences.",settingsBackupAutomatedHeading:"Automated Backups",settingsBackupManualHeading:"Manual Actions",settingsBackupDangerHeading:"Danger Zone",settingsDataStorageStatusHeading:"Storage Status",settingsDataPersistenceHeading:"Persistence & Backup",settingsDataLoggingHeading:"Logging",settingsAboutHeading:"About & Support",rulesViewTitle:"Auto Gear Rules",rulesViewSubtitle:"Manage automatic gear additions based on your equipment selection.",buttonAddRule:"Add Rule",rulesEmptyTitle:"No rules defined",rulesEmptyText:"Create your first rule to automate your gear list.",ruleBadgeAlways:"Always",ruleTagConditions:"Conditions",ruleTagItemsAdded:"Items Added",confirmDeleteRule:"Are you sure you want to delete this rule?",modalTitleCreateRule:"Create Rule",modalTitleEditRule:"Edit Rule",tabGeneral:"General",tabContext:"Context",tabCamera:"Camera",tabMonitoring:"Monitoring",tabSupport:"Support",tabCrew:"Crew",tabActions:"Actions",labelRuleName:"Rule Name",labelRuleEnabled:"Rule Enabled",labelRuleAlways:"Always Apply",helpRuleAlways:"Overrides all other conditions.",placeholderRuleName:"e.g. Add Batteries for Monitor",sectionScenarios:"Scenarios",sectionCameraModels:"Camera Models",sectionMatteboxes:"Matteboxes",sectionViewfinders:"Viewfinders / Top Handles (Extensions)",sectionMonitors:"Monitors",sectionWireless:"Wireless",sectionTripodHeads:"Tripod Heads",sectionBowlSize:"Bowl Size",sectionLegTypes:"Leg Types",sectionSpreaders:"Spreaders",sectionCrewPresent:"Crew Present",sectionCrewAbsent:"Crew Absent",sectionItemsToAdd:"Items to Add",sectionItemsToRemove:"Items to Remove",buttonAddItem:"+ Add Item",labelItemName:"Item Name",placeholderItemSearch:"Search...",labelCategory:"Category",labelQty:"Qty",buttonAdd:"Add",textNoOptions:"No options available.",textNoItems:"No items defined.",buttonSaveRule:"Save Rule",buttonCancel:"Cancel",buttonEdit:"Edit",buttonDelete:"Delete",alertEnterRuleName:"Please enter a rule name.",contactsViewTitle:"Contacts",contactsViewSubtitle:"Manage your crew and vendor contacts.",buttonAddContact:"Add Contact",buttonAddFirstContact:"+ Add First Contact",contactsEmptyTitle:"No contacts found",contactsEmptyText:"Add people and companies to your contact list to quickly assign them to projects.",linkWebsite:"Website",contactUnnamed:"Unnamed Contact",contactNoRole:"No Role",modalTitleDeleteContact:"Delete Contact",confirmDeleteContact:"Are you sure you want to delete this contact? This action cannot be undone.",buttonDeleteRed:"Delete",modalTitleNewContact:"New Contact",modalTitleEditContact:"Edit Contact",buttonUploadPhoto:"Upload Photo",buttonRemovePhoto:"Remove",labelName:"Name",labelRole:"Role",labelPhone:"Phone",labelEmail:"Email",labelWebsite:"Website / Link",labelNotes:"Notes",placeholderFullName:"Full Name",placeholderRole:"e.g. 1st AC",placeholderPhone:"+1 234 567 890",placeholderEmail:"email@example.com",placeholderWebsite:"https://...",placeholderNotes:"Additional details...",buttonSaveContact:"Save Contact",alertEnterName:"Please enter a name.",ownGearViewTitle:"Owned Gear",ownGearViewSubtitle:"Manage your personal equipment inventory.",buttonAddGearItem:"Add Item",buttonAddFirstGearItem:"+ Add First Item",ownGearEmptyTitle:"No gear found",ownGearEmptyText:"Add items to your personal inventory to quickly add them to projects.",labelQtyPrefix:"Qty: ",labelSourcePrefix:"Source: ",confirmDeleteGearItem:"Are you sure you want to delete this item?",modalTitleNewGearItem:"New Gear Item",modalTitleEditGearItem:"Edit Gear Item",placeholderGearName:"e.g. Arri Alexa Mini",placeholderGearQty:"1",placeholderGearNotes:"Condition, serial number, etc...",buttonSaveGearItem:"Save Item",alertInvalidItemData:"Invalid item data.",alertSaveItemFailed:"Failed to save item.",labelQuantity:"Quantity",buttonDownloadBackup:"Download Backup",buttonDownloadFullBackup:"Download Full Backup",buttonRestore:"Restore",buttonRestoreRehearsal:"Restore Rehearsal",buttonFactoryReset:"Factory Reset",buttonCompareVersions:"Compare Versions",buttonReset:"Reset",buttonUploadSvg:"Upload SVG",buttonClose:"Close",buttonExportLog:"Export Log",buttonChooseFile:"Choose File",buttonSupport:"Support",buttonReportBug:"Report Bug",buttonSuggestFeature:"Suggest Feature",buttonRequestPersistence:"Request Persistent Storage",labelBackupRetention:"Backup Retention (copies per project)",labelBaselineVersion:"Baseline Version",labelComparisonVersion:"Comparison Version",labelIncidentNotes:"Incident Notes",labelSelectFile:"Select File",labelNoFileSelected:"No file selected",labelLatestProjectSave:"Latest Project Save",labelLatestAutoBackup:"Latest Auto Backup",labelLatestFullBackup:"Latest Full Backup",tableHeaderData:"Data",tableHeaderDifference:"Difference",labelLogLevel:"Log Level",labelHistoryLimit:"History Limit",labelNamespaceFilter:"Namespace Filter",placeholderIncidentNotes:"Context for this comparison...",checkboxAutoBackupList:"Show auto-backups in project list",checkboxHighContrast:"High Contrast Elements",checkboxReduceMotion:"Reduce Motion",checkboxRelaxedSpacing:"Relaxed Spacing",checkboxMirrorConsole:"Mirror to Console",checkboxCaptureConsole:"Capture Console Output",checkboxCaptureGlobalErrors:"Capture Global Errors",checkboxPersistSession:"Persist Session Between Reloads",brandingNoLogo:"No custom logo set",documentationTrackerEmptyShort:"No releases tracked.",settingsFactoryResetHelp:"Reset the application to its initial state. All data will be deleted.",backupDiffModalTitle:"Version Comparison",backupDiffModalSubtitle:"Pick two manual saves or automatic backups to inspect changes.",backupDiffEmptyState:"Select versions to see differences.",rehearsalModalSubtitle:"Load a backup into a disposable workspace to verify it before running a full restore.",rehearsalModalSourceLabel:"Choose a rehearsal source",rehearsalModalSourceBackup:"Full app backup (.json)",rehearsalModalSourceProject:"Project bundle (.json)",textManageLocalData:"Manage your local data.",textRequestPersistence:"Request persistent storage verification to prevent browser eviction.",statusCheckingPersistence:"Checking storage protection...",textNoLogEntries:"No log entries.",optionLogLevelAll:"All levels",optionLogLevelInfo:"Info and above",optionLogLevelWarn:"Warnings and errors",optionLogLevelError:"Errors only",appCreator:"Created by Luca Zanner",languageSetting:"Language",settingsLanguageHelp:"Choose the interface language. Changes apply immediately and are remembered for next time.",darkModeSetting:"Dark mode",settingsDarkModeHelp:"Switch between light and dark themes from any control. The onboarding selector, top-bar toggle and Settings checkbox stay synchronized instantly.",pinkModeSetting:"Pink mode",settingsPinkModeHelp:"Enable the playful pink accent theme from Settings.",accentColorSetting:"Accent color",accentColorHelp:"Pick the accent color used for buttons, highlights and diagrams. The choice is saved with your settings.",cameraColorSettingDescription:"Assign a highlight color to each camera letter so linked gear stays coordinated across your lists.",cameraColorInputHelp:"Choose the highlight color for camera %s.",cameraColorALabel:"Camera A color",cameraColorBLabel:"Camera B color",cameraColorCLabel:"Camera C color",cameraColorDLabel:"Camera D color",cameraColorELabel:"Camera E color",accentColorReset:"Reset to default",accentColorResetHelp:"Revert the accent color to the original theme color while keeping other preferences intact.",temperatureUnitSetting:"Temperature unit",temperatureUnitSettingHelp:"Choose whether temperatures are shown in Celsius or Fahrenheit throughout the app.",focusScaleSetting:"Focus scale",focusScaleSettingHelp:"Choose the measurement markings displayed for focus scales in lens notes and overviews.",focusScaleMetric:"Metric",focusScaleImperial:"Imperial",mountVoltageSettingsHeading:"Battery mount voltages",mountVoltageSettingsHelp:"Adjust the voltages used for current draw calculations across B-Mount, V-Mount and Gold Mount setups.",mountVoltageDescription:"Set the default high and low voltages for each battery mount so the planner matches your hardware.",mountVoltageReset:"Restore defaults",mountVoltageResetHelp:"Reset all mount voltages to their factory defaults.",mountVoltageHighLabel:"High-voltage output",mountVoltageLowLabel:"Low-voltage output",mountVoltageHighHelp:"Used to calculate total current at the battery's main output such as the high-voltage pins.",mountVoltageLowHelp:"Used to calculate total current at auxiliary outputs such as D-Tap ports or B-Mount low-voltage pins.",mountVoltageNote:"These voltages update the totals in the power summary, runtime estimates and pin warnings.",mountVoltageCardLabelV:"V-Mount",mountVoltageCardLabelGold:"Gold Mount",mountVoltageCardLabelB:"B-Mount",totalCurrentHighLabelTemplate:"Total Current (at {voltage}V):",totalCurrentLowLabelTemplate:"Total Current (at {voltage}V):",totalCurrentHighHelpTemplate:"Current draw at the battery's main output ({voltage}V).",totalCurrentLowHelpTemplate:"Current draw at auxiliary outputs ({voltage}V).",temperatureUnitCelsius:"Celsius (°C)",temperatureUnitFahrenheit:"Fahrenheit (°F)",temperatureUnitSymbolCelsius:"°C",temperatureUnitSymbolFahrenheit:"°F",fontSizeSetting:"Font size",fontSizeSettingHelp:"Set the base interface font size to improve readability or fit more information on screen.",fontFamilySetting:"Font",fontFamilySettingHelp:"Select the typeface used throughout the planner. Added local fonts appear in this menu.",bundledFontsGroup:"Bundled fonts",localFontsGroup:"Local fonts",localFontsButton:"Add local font…",localFontsButtonHelp:"Allow the planner to use installable fonts from this device when your browser supports it.",localFontsUnsupported:"Local fonts aren't supported in this browser.",localFontsFileFallback:"Your browser can't list installed fonts automatically. Upload font files instead.",localFontsAdded:"Added: %s",localFontsAlreadyAdded:"Already added: %s",localFontsNoFonts:"No fonts were selected.",localFontsError:"Could not access local fonts.",localFontsPermissionNeeded:"Access to installed fonts was denied. Upload font files instead.",localFontsUnsupportedFiles:"Some files weren't recognized as fonts: %s.",localFontsSaveError:"Font added for this session but couldn't be saved for offline use.",logoSetting:"Logo (SVG)",logoSettingHelp:"Upload an SVG logo to brand printable overviews and include it in backups.",logoFormatError:"Unsupported logo format. Please choose an SVG file.",autoGearHeading:"Automatic Gear Rules",autoGearHeadingHelp:"Adjust which Production Requirements scenarios automatically add or remove kit items.",autoGearDescription:"Create scenario-based rules that tweak the generated kit list. Rules apply after the default planner suggestions.",autoGearPresetDescription:"Save and reuse complete sets of automatic gear rules.",autoGearPresetLabel:"Preset",autoGearPresetPlaceholder:"Custom rules",autoGearAutoPresetLabel:"Autosaved rules",autoGearSavePresetButton:"Save preset",autoGearDeletePresetButton:"Delete preset",autoGearPresetNamePrompt:"Name this preset",autoGearPresetNameRequired:"Enter a preset name to continue.",autoGearPresetOverwriteConfirm:"Replace the existing preset “%s”?",autoGearPresetApplyConfirm:"Replace your automatic gear rules with the preset “%s”?",autoGearPresetSaved:"Automatic gear preset saved.",autoGearPresetDeleted:"Automatic gear preset deleted.",autoGearPresetApplied:"Preset applied.",autoGearPresetExportSuccess:"Automatic gear presets downloaded.",autoGearPresetExportError:"Automatic gear preset export failed.",autoGearAddRule:"Add rule",autoGearNoRules:"No custom rules yet.",autoGearNoMatches:"No rules match your filters.",autoGearNoFocusMatches:"No rules match the selected dashboard filter.",autoGearSummaryHeading:"Rule coverage overview",autoGearSummaryDescription:"Review automatic gear rules for duplicate triggers, conflicts, stacked scenarios and uncovered coverage.",autoGearSummaryEmpty:"Add a rule to unlock coverage insights.",autoGearSummaryTotalLabel:"Rules tracked",autoGearSummaryTotalDescription:"Rules currently saved in this setup.",autoGearSummaryCoverageLabel:"Scenario coverage",autoGearSummaryCoverageDescription:"{covered} of {total} scenarios covered",autoGearSummaryCoverageEmpty:"Add scenarios to measure coverage.",autoGearSummaryNetLabel:"Net change",autoGearSummaryNetDescription:"Adds {adds} · Removes {removes}",autoGearSummaryDuplicatesLabel:"Duplicated triggers",autoGearSummaryDuplicatesSome:"{rules} across {groups} groups",autoGearSummaryDuplicatesNone:"No duplicate triggers.",autoGearSummaryConflictsLabel:"Potential conflicts",autoGearSummaryConflictsSome:"{rules} affected across {items} items",autoGearSummaryConflictsNone:"No conflicting adds/removes.",autoGearSummaryOverlapsLabel:"Stacked scenarios",autoGearSummaryOverlapsSome:"{count} scenarios touched by multiple rules",autoGearSummaryOverlapsNone:"No scenarios currently stack multiple rules.",autoGearSummaryUncoveredLabel:"Uncovered scenarios",autoGearSummaryUncoveredSome:"Review {count} scenario gaps",autoGearSummaryUncoveredNone:"All required scenarios covered.",autoGearSummaryDetailsIntro:"Focus cards to inspect coverage percentages, stacked scenarios, duplicates and conflicts before exporting or printing.",autoGearSummaryDetailsDuplicatesHeading:"Duplicated triggers",autoGearSummaryDuplicateGroupTitle:"Matching triggers",autoGearSummaryDetailsConflictsHeading:"Potential conflicts",autoGearSummaryConflictAddsLabel:"Adds",autoGearSummaryConflictRemovesLabel:"Removes",autoGearSummaryDetailsOverlapsHeading:"Scenarios with stacked rules",autoGearSummaryDetailsOverlapsNone:"No scenarios currently stack multiple rules.",autoGearSummaryDetailsUncoveredHeading:"Uncovered scenarios",autoGearSummaryResetFocus:"Clear dashboard filter",autoGearSummaryDetailsFocusEmpty:"No coverage details match the current focus.",autoGearSummaryJumpToRule:"Jump to rule",autoGearSummarySetScenarioFilter:"Filter to scenario {scenario}",autoGearSummaryRuleReference:"Rule {position}: {label}",autoGearSummaryRuleReferenceUntitled:"Rule {position}",autoGearSummaryFilteredDescription:"Showing {visible} of {total} rules after filters.",autoGearSearchLabel:"Search rules",autoGearSearchHelp:"Filter automatic gear rules by name, scenario or items. Results update instantly as you type.",autoGearSearchPlaceholder:"Search by name, scenario or item",autoGearFilterScenarioLabel:"Filter by scenario",autoGearFilterScenarioHelp:"Show only rules that require a specific scenario.",autoGearFilterScenarioAny:"All scenarios",autoGearFilterClear:"Clear filters",autoGearRuleNameLabel:"Rule name",autoGearRuleNameHelp:"Optional label displayed in the rules list.",autoGearConditionSelectLabel:"Add a condition",autoGearConditionSelectHelp:"Reveal the selectors you want to use as rule conditions.",autoGearAddCondition:"Add condition",autoGearConditionPlaceholder:"Choose a condition",autoGearConditionAddShortcut:"Add another condition",autoGearConditionRemove:"Remove this condition",autoGearConditionLogicLabel:"Match behavior",autoGearConditionLogicHelp:"Choose how the selected values interact before the rule activates.",autoGearConditionLogicAll:"Require every selected value",autoGearConditionLogicAny:"Match any selected value",autoGearConditionLogicOr:"Start a new OR group (matches any selected value)",autoGearConditionLogicNone:"Require none of the selected values",autoGearConditionLogicMultiplier:"Multiply by matched values",autoGearConditionRepeatHint:"Condition already added. Existing inputs for {condition} are highlighted so you can add more selections.",autoGearAlwaysLabel:"Always include",autoGearAlwaysHelp:"Apply this rule to every kit list.",autoGearAlwaysMeta:"Always active",autoGearScenariosLabel:"Required scenarios",autoGearScenariosHelp:"Pick every scenario that must be selected for this rule to apply. Hold Ctrl (Cmd on Mac) to choose multiple.",autoGearScenarioPlaceholder:"Select scenarios",autoGearScenarioModeLabel:"Scenario matching",autoGearScenarioModeHelp:"Choose how the selected scenarios interact before the rule activates.",autoGearScenarioModeAll:"Require every selected scenario",autoGearScenarioModeAny:"Match any selected scenario",autoGearScenarioModeMultiplier:"Multiply when combined",autoGearScenarioBaseLabel:"Base scenario",autoGearScenarioBaseHelp:"Items always add when this scenario is active.",autoGearScenarioBasePlaceholder:"Select a base scenario",autoGearScenarioFactorLabel:"Multiplier factor",autoGearScenarioFactorHelp:"Scale item quantities when every additional scenario is active.",autoGearShootingDaysLabel:"Shooting days condition",autoGearShootingDaysHelp:"Activate this rule when the shooting schedule meets your chosen minimum or maximum, or repeat the gear for each block of days.",autoGearShootingDaysModeMinimum:"Minimum",autoGearShootingDaysModeMaximum:"Maximum",autoGearShootingDaysModeEvery:"Every",autoGearShootingDaysValueLabel:"Shooting days value",autoGearMatteboxLabel:"Mattebox options",autoGearMatteboxHelp:"Apply this rule when these mattebox choices are selected. Clamp-on rules automatically add the matching backing sizes for the selected lens fronts.",autoGearMatteboxPlaceholder:"Select mattebox options",autoGearCameraHandleLabel:"Camera handles",autoGearCameraHandleHelp:"Apply this rule when these camera handle options are selected.",autoGearCameraHandlePlaceholder:"Select camera handles",autoGearViewfinderExtensionLabel:"Viewfinder extension",autoGearViewfinderExtensionHelp:"Apply this rule when these viewfinder extension choices are selected.",autoGearViewfinderExtensionPlaceholder:"Select viewfinder extension options",autoGearDeliveryResolutionLabel:"Delivery resolution",autoGearDeliveryResolutionHelp:"Apply this rule when these delivery resolutions are selected.",autoGearDeliveryResolutionPlaceholder:"Select delivery resolutions",autoGearVideoDistributionLabel:"Video distribution",autoGearVideoDistributionHelp:"Apply this rule when these video distribution preferences are selected.",autoGearVideoDistributionPlaceholder:"Select video distribution options",autoGearTripodHeadBrandLabel:"Tripod head brand",autoGearTripodHeadBrandHelp:"Apply this rule when the tripod head preferences include these brands.",autoGearTripodHeadBrandPlaceholder:"Select tripod head brands",autoGearTripodBowlLabel:"Tripod bowl size",autoGearTripodBowlHelp:"Apply this rule when the tripod head preferences include these bowl sizes.",autoGearTripodBowlPlaceholder:"Select tripod bowl sizes",autoGearTripodTypesLabel:"Tripod types",autoGearTripodTypesHelp:"Apply this rule when the tripod preferences include these tripod types.",autoGearTripodTypesPlaceholder:"Select tripod types",autoGearTripodSpreaderLabel:"Tripod spreader",autoGearTripodSpreaderHelp:"Apply this rule when the tripod preferences include these spreader options.",autoGearTripodSpreaderPlaceholder:"Select tripod spreaders",autoGearVideoDistributionNone:"No video distribution selected",autoGearCameraLabel:"Camera selection",autoGearCameraHelp:"Apply this rule when these camera bodies are selected.",autoGearCameraWeightLabel:"Camera weight",autoGearCameraWeightHelp:"Compare the selected camera's weight to the threshold before triggering this rule.",autoGearCameraWeightOperatorLabel:"Weight comparison",autoGearCameraWeightOperatorGreater:"Heavier than",autoGearCameraWeightOperatorLess:"Lighter than",autoGearCameraWeightOperatorEqual:"Exactly",autoGearCameraWeightValueLabel:"Weight threshold (grams)",autoGearCameraWeightValueRequired:"Enter a camera weight threshold before saving.",autoGearMonitorLabel:"Onboard monitors",autoGearMonitorDefaultsHeading:"Monitor defaults",autoGearMonitorDefaultsDescription:"Choose which monitors should be preselected for new kit lists.",autoGearDefaultFocusMonitorLabel:"Focus monitor",autoGearDefaultHandheldMonitorLabel:'7" handheld monitor',autoGearDefaultComboMonitorLabel:'Combo monitor 15-21"',autoGearDefaultDirectorMonitorLabel:'Director monitor 15-21"',autoGearMonitorDefaultPlaceholder:"Use recommended automatically",autoGearMonitorHelp:"Apply this rule when these onboard monitors are selected.",autoGearCrewPresentLabel:"Crew present",autoGearCrewPresentHelp:"Apply this rule when these crew roles are listed on the project.",autoGearCrewAbsentLabel:"Crew absent",autoGearCrewAbsentHelp:"Apply this rule when these crew roles are not listed on the project.",autoGearWirelessLabel:"Wireless transmitters",autoGearWirelessHelp:"Apply this rule when these wireless transmitters are selected.",autoGearMotorsLabel:"FIZ motors",autoGearMotorsAny:"Any motor selected",autoGearMotorsHelp:"Apply this rule when these FIZ motors are selected.",autoGearControllersLabel:"FIZ controllers",autoGearControllersHelp:"Apply this rule when these FIZ controllers are selected.",autoGearDistanceLabel:"FIZ distance devices",autoGearDistanceHelp:"Apply this rule when these distance devices are selected.",autoGearRuleConditionRequired:"Select at least one scenario, camera, monitor, wireless transmitter, motor, controller, distance device, mattebox option, camera handle, viewfinder extension or video distribution before saving.",autoGearAddItemsHeading:"Add these items",autoGearOwnGearLabel:"Own gear item",autoGearOwnGearHelp:"Select an item you own to link this rule to your inventory.",autoGearConditionOwnGearLabel:"Own gear",autoGearConditionOwnGearHelp:"Apply this rule when these items are saved in your own gear list.",autoGearOwnGearMissing:"Removed own gear",autoGearOwnGearPlaceholder:"Manual entry",autoGearOwnGearBadge:"Own gear",autoGearAddItemLabel:"Item",autoGearAddCategoryLabel:"Category",autoGearAddQuantityLabel:"Qty",autoGearAddItemButton:"Add item",autoGearUpdateItemButton:"Save item",autoGearAddMultipleHint:"Separate multiple items with semicolons.",autoGearRemoveItemsHeading:"Remove these items",autoGearRemoveItemLabel:"Item",autoGearRemoveCategoryLabel:"Category",autoGearRemoveQuantityLabel:"Qty",autoGearRemoveItemButton:"Add removal",autoGearRemoveMultipleHint:"Separate multiple items with semicolons.",autoGearSaveRule:"Save rule",autoGearRuleSaved:"Automatic gear rule saved.",autoGearCancelEdit:"Cancel",autoGearResetFactoryButton:"Reset to factory additions",autoGearResetFactoryHelp:"Restore the automatic gear rules generated from the planner's default scenarios. Your current presets download before anything changes.",autoGearResetFactoryConfirm:"Replace your automatic gear rules with the default additions?",autoGearResetFactoryDone:"Automatic gear rules restored to factory additions.",autoGearResetFactoryEmpty:"Factory additions unavailable. Automatic gear rules cleared.",autoGearResetFactoryError:"Reset failed. Please try again.",autoGearResetFactoryExportFailed:"Automatic gear preset export failed. Reset cancelled.",autoGearExportButton:"Export rules",autoGearExportHelp:"Download your automatic gear rules as a JSON file.",autoGearExportSuccess:"Automatic gear rules downloaded.",autoGearExportError:"Automatic gear rules export failed.",autoGearImportButton:"Import rules",autoGearImportHelp:"Replace your automatic gear rules with a file you previously exported.",autoGearImportConfirm:"Replace your automatic gear rules with the imported file?",autoGearImportSuccess:"Automatic gear rules imported.",autoGearImportError:"Import failed. Please choose a valid automatic gear rules file.",autoGearImportSchemaError:"Import failed. The file does not match the automatic gear rules export format.",autoGearImportMetadataLabelType:"type marker",autoGearImportMetadataLabelVersion:"version",autoGearImportMetadataLabelTimestamp:"marca temporale",autoGearImportMissingMetadataWarning:"Imported rules are missing required metadata: {fields}. Confirm the file comes from a trusted export before saving.",autoGearImportInvalidMetadataWarning:"Imported rules include invalid metadata: {fields}. Confirm the file comes from a trusted export before saving.",autoGearImportNewerVersionWarning:"Imported rules were created with version {importVersion}, which is newer than this build ({appVersion}). Double-check compatibility before relying on them.",autoGearImportOlderVersionWarning:"Imported rules were created with version {importVersion}, which is older than this build ({appVersion}). Review them to confirm they still match your workflow.",autoGearImportInvalidVersionWarning:'Imported rules report version "{value}", which is not a valid semantic version string.',autoGearImportInvalidTimestampWarning:'The import timestamp "{value}" could not be verified. Confirm the file has not been modified.',autoGearBackupsHeading:"Automatic backups",autoGearBackupsDescription:"Backups save your rules every 10 minutes when changes occur and keep up to 50 tracked changes between full snapshots. Restore a snapshot if something goes wrong.",autoGearShowBackupsLabel:"Show automatic backups",autoGearShowBackupsHelp:"Reveal the snapshots captured in the background.",autoGearBackupsHidden:"Automatic backups stay hidden until you turn them on.",autoGearBackupSelectLabel:"Choose a backup",autoGearBackupSelectPlaceholder:"Select a backup to restore",autoGearBackupEmpty:"No automatic backups yet.",autoGearBackupRestore:"Restore",autoGearBackupRestoreConfirm:"Replace your automatic gear rules with this backup?",autoGearBackupRestoreSuccess:"Automatic gear backup restored.",autoGearBackupRestoreError:"Automatic gear backup restore failed.",autoGearBackupSaved:"Automatic gear backup saved.",autoGearBackupFailed:"Automatic gear backup failed.",autoGearBackupRetentionLabel:"Automatic backup retention",autoGearBackupRetentionHelp:"Choose how many automatic gear backups stay on this device.",autoGearBackupRetentionSummary:"Keeping the latest {limit}. Currently {stored} stored.",autoGearBackupRetentionWarning:"Lowering to {limit} will remove {trimmed}. A safety snapshot will be saved first.",autoGearBackupRetentionConfirm:"Save a safety snapshot and trim older backups now?",autoGearBackupRetentionSafetyNote:"Retention lowered to {limit}.",autoGearBackupRetentionSafetyNoteTrimmed:"Retention lowered to {limit}. Removed {trimmed} in this change.",autoGearBackupRetentionSafetySaved:"Safety snapshot captured before trimming backups.",autoGearBackupRetentionSafetyFailed:"Safety snapshot failed. Retention was not changed.",autoGearBackupRetentionUpdated:"Retention updated to {limit}. Removed {trimmed}.",autoGearBackupRetentionUpdatedNoTrim:"Retention updated to {limit}. No backups were removed.",autoGearBackupRetentionExpanded:"Retention updated to {limit}.",autoGearBackupRetentionUpdateFailed:"Could not apply the new retention limit. Try again.",autoGearRulesCountOne:"%s rule",autoGearRulesCountOther:"%s rules",autoGearRuleToggleEnable:"Enable rule",autoGearRuleToggleDisable:"Disable rule",autoGearRuleEnabledLabel:"Enabled",autoGearRuleDisabledLabel:"Disabled",autoGearSummaryAllDisabled:"All automatic gear rules are disabled.",autoGearSummaryDisabledSuffix:"{count} disabled rules are ignored in coverage.",autoGearSummaryDisabledNote:"Disabled rules are visible below but ignored until re-enabled.",autoGearBackupClearsRules:"Clears all rules",autoGearBackupMeta:"%s · %s",autoGearAddsCountOne:"%s addition",autoGearAddsCountOther:"%s additions",autoGearAddsListLabel:"Adds",autoGearItemSummaryWithCategory:"%s × %s (%s)",autoGearItemSummary:"%s × %s",autoGearRemovalsCountOne:"%s removal",autoGearRemovalsCountOther:"%s removals",autoGearDuplicateRule:"Duplicate",autoGearDuplicateSuffix:"Copy",autoGearDeleteRule:"Delete",autoGearDeleteConfirm:"Delete this rule?",autoGearItemNameRequired:"Enter an item name first.",autoGearEditSingleItemWarning:"Edit one item at a time.",autoGearRuleScenarioRequired:"Select a scenario before saving.",autoGearRuleNeedsItems:"Add at least one item to add or remove before saving.",autoGearListRemove:"Remove",autoGearListEdit:"Edit",autoGearEmptyList:"No items yet.",autoGearDraftImpactHeading:"Draft impact preview",autoGearDraftImpactDescription:"Simulated totals showing how this draft would change shared gear outputs.",autoGearDraftImpactEmpty:"No changes detected yet. Add or adjust items to preview the impact.",autoGearDraftImpactUnavailable:"Preview becomes available after this rule includes at least one item.",autoGearDraftImpactTotals:"Current total: %s → After save: %s",autoGearDraftImpactChange:"Change: %s",autoGearDraftImpactStackedOne:"Stacked across %s rule.",autoGearDraftImpactStackedOther:"Stacked across %s rules.",autoGearDraftImpactConflictOne:"Removals also active in %s rule.",autoGearDraftImpactConflictOther:"Removals also active in %s rules.",autoGearDraftWarningHeading:"Warnings",autoGearDraftWarningCritical:"%s would drop out of the kit list.",autoGearDraftWarningConflict:"%s has conflicting add and remove instructions.",autoGearDraftWarningRedundant:"%s is added by multiple rules without increasing totals.",autoGearDraftWarningConfirm:"Save anyway? Review the impact warnings below before confirming.",autoGearCustomCategory:"Custom Additions",autoGearAddScreenSizeLabel:"Screen size",autoGearAddSelectorTypeLabel:"Selector",autoGearAddSelectorDefaultLabel:"Default item",autoGearAddSelectorIncludeLabel:"Include selector",autoGearAddNotesLabel:"Notes",autoGearRemoveScreenSizeLabel:"Screen size",autoGearRemoveSelectorTypeLabel:"Selector",autoGearRemoveSelectorDefaultLabel:"Default item",autoGearRemoveSelectorIncludeLabel:"Include selector",autoGearRemoveNotesLabel:"Notes",autoGearSelectorDefaultPlaceholder:"Choose a default device",autoGearSelectorNoneOption:"No selector",autoGearSelectorMonitorOption:"Monitor selector",autoGearSelectorDirectorOption:"Director monitor selector",autoGearSelectorTripodHeadOption:"Tripod head selector",autoGearSelectorTripodBowlOption:"Tripod bowl selector",autoGearSelectorTripodTypesOption:"Tripod type selector",autoGearSelectorTripodSpreaderOption:"Tripod spreader selector",autoGearSelectorFizHandUnitOption:"FIZ hand unit selector",autoGearSelectorScrollHint:"Scroll to see more devices.",autoGearSelectorSummaryWithDefault:"%s selector (default: %s)",autoGearSelectorSummary:"%s selector",autoGearSelectorSummaryNoSelector:"%s default: %s",autoGearRuleTooltipNamed:"Added by automatic gear rule “%s”.",autoGearRuleTooltipUnnamed:"Added by an automatic gear rule.",autoGearRuleBadgeNamed:"Rule: %s",autoGearRuleBadgeUnnamed:"Automatic rule",accessibilityHeading:"Accessibility",accessibilityHeadingHelp:"Adjust contrast and other options that improve legibility.",highContrastSetting:"High contrast",highContrastSettingHelp:"Increase contrast for text and outlines to boost readability in any theme.",reduceMotionSetting:"Reduce motion",reduceMotionSettingHelp:"Limit color and interface animations so transitions feel steady for motion-sensitive users.",relaxedSpacingSetting:"Relaxed spacing",relaxedSpacingSettingHelp:"Increase line spacing and control padding to make text easier to scan and tap.",backupHeading:"Backup & Restore",backupHeadingHelp:"Manage full backups of settings, saved projects, custom devices, queued vault entries, and runtime feedback.",projectBackupsHeading:"Project Backups",projectBackupsDescription:"Manage automatic snapshots and compare saved versions before restoring changes.",showAutoBackupsSetting:"Show auto backups in project list",showAutoBackupsHelp:"Temporarily list automatic backup snapshots in Saved Projects so you can restore them manually.",versionCompareButton:"Compare versions",versionCompareButtonHelp:"Review differences between saves, add notes, and export a comparison log.",versionCompareHeading:"Version comparison",versionCompareIntro:"Pick two manual saves or automatic backups to inspect changes before archiving a log.",versionComparePrimaryLabel:"Baseline version",versionCompareSecondaryLabel:"Comparison version",versionCompareSelectPlaceholder:"Select a version",versionCompareEmpty:"Save a project or wait for auto-backups to start comparing versions.",versionCompareNoSelection:"Choose two versions to generate a diff.",versionCompareSameSelection:"Select two different versions to compare.",versionCompareDifferencesCountOne:"%s difference noted.",versionCompareDifferencesCountOther:"%s differences noted.",versionCompareIdentical:"Versions match—no changes detected.",versionCompareManualLabel:"Manual save",versionCompareAutoLabel:"Auto backup",versionCompareAutoDeleteLabel:"Auto backup before delete",versionCompareNotesLabel:"Incident notes",versionCompareNotesPlaceholder:"Record context, on-set observations, or required follow-up.",versionCompareExport:"Export log",versionCompareExportHelp:"Download a JSON copy of this comparison and your notes.",versionCompareClose:"Close",versionCompareExportSuccess:"Comparison log exported.",versionCompareExportFailure:"Comparison export failed.",versionCompareMissingSelection:"Select two versions before exporting a log.",versionCompareChangeAdded:"Added",versionCompareChangeRemoved:"Removed",versionCompareChangeUpdated:"Updated",versionCompareMissingValue:"Not present",versionCompareRootPath:"Entire setup",versionCompareListItemLabel:"Item %s",versionCompareSummaryAdded:"Added: %s",versionCompareSummaryRemoved:"Removed: %s",versionCompareSummaryChanged:"Updated: %s",backupSettings:"Backup",backupSettingsHelp:"Download a full JSON backup containing every project, device edit, preference, auto-gear rule, queued backup vault entry, and runtime log stored on this device. Keep multiple copies in your offline archive.",restoreSettings:"Restore",restoreSettingsHelp:"Restore a full JSON backup. The planner captures a fresh safety copy first, then replaces stored preferences and session data with the selected file so you can roll back immediately if anything looks wrong.",restoreRehearsalButton:"Restore rehearsal",restoreRehearsalButtonHelp:"Test a backup or project bundle in a disposable sandbox before you restore your live data.",restoreRehearsalHeading:"Restore rehearsal",restoreRehearsalIntro:"Load a backup or project bundle into a disposable workspace. We compare key counts with your live profile and clear the sandbox automatically.",restoreRehearsalModeLabel:"Choose a rehearsal source",restoreRehearsalModeBackup:"Full app backup (.json)",restoreRehearsalModeProject:"Project bundle (.json)",restoreRehearsalFileLabel:"Select file",restoreRehearsalFileButton:"Choose file",restoreRehearsalNoFile:"No file selected yet.",restoreRehearsalReady:"Sandbox ready. Pick a JSON file to inspect.",restoreRehearsalProcessing:"Loading file in an isolated sandbox…",restoreRehearsalMatch:"All counts match. The sandbox was cleared automatically.",restoreRehearsalMismatch:"Differences detected: %s. The sandbox was cleared automatically.",restoreRehearsalError:"Restore rehearsal failed. Check the file and try again.",restoreRehearsalBackupMismatch:"File doesn't look like a full app backup. Double-check the source and try again.",restoreRehearsalProjectMismatch:"File doesn't look like a project bundle. Double-check the source and try again.",restoreRehearsalRuleHeading:"Automatic gear rule changes",restoreRehearsalRuleIntro:"Compare every automatic gear rule before loading the sandbox. Live rules stay untouched.",restoreRehearsalRuleEmpty:"No automatic gear rule differences found.",restoreRehearsalRuleAddsLabel:"Automatic additions",restoreRehearsalRuleRemovesLabel:"Automatic removals",restoreRehearsalRuleScenariosLabel:"Scenario scope",restoreRehearsalRuleNone:"None",restoreRehearsalRuleLogicLabel:"Scenario logic",restoreRehearsalRuleBaseLabel:"Base scenario",restoreRehearsalRuleMultiplierLabel:"Multiplier",restoreRehearsalRuleRequiredLabel:"Required scenarios",restoreRehearsalRuleAlwaysLabel:"Always active",restoreRehearsalRuleFallback:"Automatic rule change",restoreRehearsalProceed:"Resume restore rehearsal",restoreRehearsalProceedHelp:"Stage the sandbox snapshot to continue the rehearsal.",restoreRehearsalProceedMessage:"Sandbox snapshot staged. Live data remains untouched until you perform a full restore.",restoreRehearsalAbort:"Abort rehearsal",restoreRehearsalAbortHelp:"Discard the sandbox snapshot and keep live data unchanged.",restoreRehearsalAbortMessage:"Rehearsal sandbox cleared. Live data remains untouched.",restoreRehearsalTableCaption:"Backup rehearsal comparison",restoreRehearsalMetricColumn:"Data type",restoreRehearsalLiveColumn:"Live profile",restoreRehearsalSandboxColumn:"Sandbox import",restoreRehearsalDifferenceColumn:"Difference",restoreRehearsalClose:"Close rehearsal",restoreRehearsalMetricProjects:"Projects",restoreRehearsalMetricProjectDetails:"Project details",restoreRehearsalMetricCrew:"Crew entries",restoreRehearsalMetricSchedule:"Schedule entries",restoreRehearsalMetricRules:"Automatic gear rules",restoreRehearsalMetricFavorites:"Favorites",restoreRehearsalMetricDeviceLibrary:"Device library entries",restoreRehearsalMetricSession:"Stored session snapshot",restoreRehearsalMetricFeedback:"Feedback drafts",restoreRehearsalMetricAutoPresets:"Automatic gear presets",restoreRehearsalMetricAutoBackups:"Automatic gear backups",restoreRehearsalMetricBackupHistory:"Backup history entries",restoreRehearsalMetricCustomFonts:"Custom fonts",restoreRehearsalMetricCustomLogo:"Custom logo saved",restoreRehearsalMetricPreferences:"Stored preferences",restoreRehearsalMetricSchemaCache:"Device schema cache",restoreRehearsalMatchLabel:"Match",restoreRehearsalDifferenceListJoin:", ",restoreRehearsalIncreaseLabel:"Sandbox includes %d more %s.",restoreRehearsalDecreaseLabel:"Sandbox includes %d fewer %s.",factoryResetButton:"Factory reset",factoryResetButtonHelp:"Create a backup and wipe all planner data after confirmation.",confirmFactoryReset:"Create a backup and wipe all planner data?",confirmFactoryResetAgain:"Last warning: all projects, devices, settings and feedback will be deleted. Continue?",factoryResetBackupFailed:"Backup failed. Data was not deleted.",factoryResetAwaitDownload:"Allow downloads to save your backup. The factory reset will continue after you accept the download.",factoryResetDownloadBlocked:"The backup download was blocked. Data was not deleted.",factoryResetSuccess:"Backup downloaded. All planner data cleared. Reloading…",factoryResetError:"Factory reset failed. Please try again.",preDeleteBackupSuccess:"Automatic safety copy stored before deletion. Find the matching auto-backup entry under Saved Projects and rename it if you plan to keep it permanently.",preDeleteBackupFailed:"Automatic backup failed. The action was cancelled.",restoreBackupFailed:"Backup failed. Restore cancelled.",restoreBackupQueuedConfirm:"The safety backup is waiting in the local vault. Continue with the restore now?",manualDownloadFallback:"The download didn't start automatically. A new tab opened with the file contents so you can copy or save them manually.",manualDownloadCopyHint:"Select all the text below and copy it to keep the file safe.",dataHeading:"Data & Storage",dataHeadingHelp:"Review what the planner stores locally and how much space backups take.",storageSummaryIntro:"Everything below stays in this browser unless you export or clear it.",storageSummaryFootnote:"Backups download human-readable JSON with each entry—Quick safeguards keep fresh copies one click away.",storageSummaryEmpty:"No planner data is currently stored.",storagePersistenceHeading:"Storage reliability",storagePersistenceHeadingHelp:"Ask the browser to keep Cine Power Planner's data safe from automatic cleanups.",storagePersistenceIntro:"Request persistent storage so the browser keeps planner data even when space runs low.",storagePersistenceRequest:"Protect storage on this device",storagePersistenceRequestHelp:"Tell the browser to mark Cine Power Planner's data as persistent.",storagePersistenceStatusIdle:"Request persistent storage to reduce the risk of automatic cleanup.",storagePersistenceStatusChecking:"Checking storage protection…",storagePersistenceStatusRequesting:"Requesting persistent storage from the browser…",storagePersistenceStatusGranted:"Persistent storage granted. Planner data is protected from automatic cleanup.",storagePersistenceStatusDenied:"The browser could not grant persistent storage. Keep exporting backups regularly.",storagePersistenceStatusSafariIncompatible:"Safari currently blocks persistent storage requests. Treat this as a browser limitation.",storagePersistenceStatusError:"Persistent storage request failed. Try again after freeing space or review browser settings.",storagePersistenceStatusUnsupported:"This browser cannot grant persistent storage automatically. Continue keeping external backups.",storagePersistenceUsage:"Approximate usage: {used} of {quota}.",storagePersistenceUsageUnknown:"Approximate usage: {used}.",storageActionsHeading:"Quick safeguards",storageActionsHeadingHelp:"Download full backups or jump straight to restore tools from here.",storageActionsIntro:"Capture a fresh full backup or open restore utilities without leaving this tab.",storageBackupNow:"Download full backup",storageBackupNowHelp:"Exports the entire planner snapshot, including projects, auto backups and preferences.",storageOpenBackupTab:"Open Backup & Restore",storageOpenBackupTabHelp:"Switch to the Backup & Restore tab for rehearsal, restore and factory reset tools.",storageStatusHeading:"Latest activity",storageStatusHeadingHelp:"Review the most recent saves and backups at a glance.",storageStatusLastProjectLabel:"Latest project save",storageStatusLastAutoBackupLabel:"Latest auto backup",autoBackupInProgressNotice:"Auto backup running. Performance may pause briefly.",storageStatusLastFullBackupLabel:"Latest full app backup",loggingSectionHelp:"Review runtime diagnostics without leaving Settings. Service worker entries stream in automatically so offline cache and activation events stay visible.",loggingHeading:"Diagnostics log",loggingHeadingHelp:"Review runtime diagnostics without leaving Settings.",loggingIntro:"The log updates live while Settings stay open. Console capture runs by default so transcripts stay local; adjust the toggles below if you need to change diagnostics behavior. Nothing leaves this device.",loggingLevelFilterLabel:"Show entries from",loggingLevelFilterHelp:"Choose the minimum level to display.",loggingLevelFilterAll:"All levels",loggingLevelFilterInfo:"Info and above",loggingLevelFilterWarn:"Warnings and errors",loggingLevelFilterError:"Errors only",loggingNamespaceFilterLabel:"Namespace filter",loggingNamespaceFilterPlaceholder:"Filter namespaces (for example, backup)",loggingNamespaceFilterHelp:"Type a namespace such as “backup”, “autosave” or “logging”.",loggingHistoryLimitLabel:"History size",loggingHistoryLimitHelp:"Maximum entries stored on this device.",loggingHistoryLimitStatus:"Storing up to {count} entries locally.",loggingHistoryLimitAria:"Set how many log entries stay available offline",loggingConsoleOutputLabel:"Mirror to console",loggingConsoleOutputHelp:"Keep the browser console in sync with these entries.",loggingCaptureConsoleLabel:"Capture console output",loggingCaptureConsoleHelp:"Record console messages for diagnostics. Leave this enabled unless you need to reduce logging overhead.",loggingCaptureErrorsLabel:"Capture global errors",loggingCaptureErrorsHelp:"Record uncaught errors and unhandled promise rejections.",loggingPersistSessionLabel:"Keep log between reloads",loggingPersistSessionHelp:"Store entries in session storage so diagnostics survive refreshes.",loggingExportButton:"Export log",loggingExportHelp:"Download the full diagnostics log as a JSON file.",loggingExportSuccess:"Diagnostics log exported.",loggingExportError:"Log export failed. Try again after reloading Settings.",loggingExportUnavailable:"Logging unavailable. Try again after reloading Settings.",loggingStatusIdle:"Live log ready.",loggingStatusUpdating:"Updating log…",loggingStatusExporting:"Preparing log export…",loggingStatusExported:"Diagnostics log ready for download.",loggingStatusExportFailed:"Log export failed.",loggingStorageEstimateUpdated:"Storage estimate refreshed.",loggingStorageQuotaOnly:"Available storage: {quota}.",loggingStatusError:"Logging unavailable. Diagnostics remain in the browser console.",loggingEmptyState:"No log entries captured yet.",loggingEmptyFiltered:"No log entries match the current filters.",loggingUnavailable:"Logging module unavailable. Console output continues as a fallback.",loggingLevelDebug:"Debug",loggingLevelInfo:"Info",loggingLevelWarn:"Warning",loggingLevelError:"Error",loggingEntryTimestampLabel:"Time",loggingEntryNamespaceLabel:"Namespace",loggingEntryMetaLabel:"Meta",loggingEntryDetailLabel:"Details",loggingTimestampCombined:"{local} ({iso})",storageStatusNever:"Not captured yet.",storageStatusStoredWithoutTimestamp:"Stored (timestamp not recorded).",storageStatusTimestamp:"Captured {relative} ({absolute}).",storageStatusTimestampAbsolute:"Captured {absolute}.",storageStatusWithName:"{name} — {time}",storageStatusReminderUpToDate:"Backups look fresh. Keep autosave running and capture a full backup after major changes.",storageStatusReminderSaveProject:"Save a named project so your latest work stays protected offline.",storageStatusReminderRefreshProject:"Save your project again soon (last save {time}).",storageStatusReminderAutoBackupFirst:"Keep Cine Power Planner open until it captures an automatic backup.",storageStatusReminderAutoBackup:"Let an automatic backup run again soon (last snapshot {time}).",storageStatusReminderFullBackupFirst:"Download a full backup to archive every dataset before going offline.",storageStatusReminderFullBackup:"Download another full backup when possible (last archive {time}).",storageStatusReminderConnectivity:"Connectivity degraded — {reason} Keep working from the offline copy and avoid clearing caches until the banner clears.",storageKeyProjects:"Saved projects",storageKeyProjectsDesc:"Configurations saved from Manage Project.",storageProjectsCountOne:"%s project",storageProjectsCountOther:"%s projects",storageKeyAutoBackups:"Auto backups",storageKeyAutoBackupsDesc:"Timestamped safety copies saved every 10 minutes or after 50 tracked changes. Switching projects, importing, exporting or preparing to reload triggers an immediate snapshot even if that cadence hasn't elapsed.",storageAutoBackupsCountOne:"%s auto backup",storageAutoBackupsCountOther:"%s auto backups",storageKeyGearLists:"Kit list snapshots",storageKeyGearListsDesc:"Printable overviews and production requirements.",storageGearListsCountOne:"%s entry",storageGearListsCountOther:"%s entries",storageKeyDevices:"Custom or modified devices",storageKeyDevicesDesc:"Differences from the built-in device library.",storageDevicesCountOne:"%s device",storageDevicesCountOther:"%s devices",storageDeviceCategories:"Affected categories: %s",storageKeyFavorites:"Pinned favorites",storageKeyFavoritesDesc:"Dropdown entries marked with a star.",storageFavoritesCountOne:"%s favorite",storageFavoritesCountOther:"%s favorites",storageKeyFeedback:"Runtime feedback",storageKeyFeedbackDesc:"User-submitted runtime reports.",storageFeedbackCountOne:"%s entry",storageFeedbackCountOther:"%s entries",storageKeySession:"Unsaved session",storageKeySessionDesc:"Restores the working project after a reload.",storageKeyFullBackups:"Full app backups",storageKeyFullBackupsDesc:"Downloads created from Backup & Restore or hourly safety copies, including queued vault entries.",storageFullBackupsCountOne:"%s backup",storageFullBackupsCountOther:"%s backups",queuedBackupDownloadDeferred:"Automatic downloads were blocked. We saved {fileName} in the local vault so the next tap can export it safely.",queuedBackupVaultEmpty:"No queued backups are waiting in the local vault.",queuedBackupVaultTitle:"Local backup vault",queuedBackupVaultIntro:"Automatic downloads were blocked. Review the backups below and download them manually while you have the browser ready offline.",queuedBackupVaultPopupBlocked:"Enable pop-ups to review queued backups stored in the local vault.",queuedBackupBannerMessageOne:"1 backup saved in the local vault.",queuedBackupBannerMessageOther:"{count} backups saved in the local vault.",queuedBackupBannerGesture:"Interact with the planner to export them safely.",queuedBackupBannerAction:"Open local backup vault",queuedBackupFallbackHint:"Emergency fallback storage active. Export queued backups immediately.",storageSessionStored:"Stored",storageSessionNotStored:"Not stored",storageKeyTotalSize:"Approximate backup size",storageKeyTotalSizeDesc:"Based on the current backup export.",storageKeyIntegrityGuard:"Backup guardian",storageKeyIntegrityGuardDesc:"Mirrors every critical storage key into a backup slot before any edits.",storageIntegrityGuardStatus:"Active",storageIntegrityGuardStatusCreated:"Mirrored {count} key(s) this session",storageIntegrityGuardStatusIssue:"{count} issue(s) — check console",storageIntegrityGuardStatusMissing:"Waiting for first save",storageTotalSizeValue:"~%s KB",aboutHeading:"About & Support",aboutHeadingHelp:"Review version details and reach support resources.",versionLabel:"Version",supportLink:"Support",supportLinkHelp:"Open the GitHub repository in a new tab.",reportBugLink:"Report a bug",reportBugLinkHelp:"Open the GitHub issues tracker to report a bug.",suggestFeatureLink:"Suggest a feature",suggestFeatureLinkHelp:"Open the GitHub issues tracker to share feature ideas.",restoreSuccess:"Settings restored. Reload to apply all changes.",restoreVerificationMatch:"Restore verification passed. Live data matches the backup snapshot.",restoreVerificationMismatch:"Restore verification found differences. Review the counts before continuing:",restoreVerificationDifference:"{label}: backup {expected}, live {actual}",restoreVerificationFailed:"Restore verification could not confirm the imported data. Review the backup manually.",restoreVerificationUnknownMetric:"Metric",restoreFailed:"Restore failed. Check the backup file and try again.",restoreVersionWarning:"Backup created with a different version. Some features might not transfer.",restoreVersionSummaryTitle:"Older backup detected",restoreVersionSummaryHeading:"This backup was created with {oldVersion} and you are running {newVersion}.",restoreVersionCoreMissing:"Not included in this backup:",restoreVersionStorageMissing:"Stored preferences not included:",restoreVersionOptionalMissing:"Optional items you may need to recreate:",restoreVersionNoIssues:"All modern data sections were found in this backup.",restoreVersionTip:"We saved a safety backup of your current data before importing.",restoreVersionFooter:"You can continue and manually recreate the missing items afterward.",restoreVersionUnknownVersion:"unknown version",restoreVersionBackupLabel:"Safety backup saved before restore: {fileName}",restoreSectionDevices:"Device library",restoreSectionSetups:"Saved setups",restoreSectionProjects:"Projects",restoreSectionFavorites:"Favorites",restoreSectionAutoGearRules:"Automatic gear rules",restoreSectionAutoGearPresets:"Automatic gear presets",restoreSectionAutoGearBackups:"Automatic gear backups",restoreSectionAutoGearActivePreset:"Selected automatic gear preset",restoreSectionAutoGearAutoPreset:"Automatic assignment preset",restoreSectionAutoGearVisibility:"Automatic backup visibility",restoreSectionAutoGearBackupRetention:"Automatic backup retention",restoreSectionAutoGearSeeded:"Automatic gear onboarding status",restoreSectionAutoGearMonitorDefaults:"Monitor defaults",restoreSectionSession:"Current planner session",restoreSectionFeedback:"Feedback drafts",restoreSectionPreferences:"App preferences",restoreSectionCustomLogo:"Custom logo",restoreSectionCustomFonts:"Custom fonts",restoreSectionSchemaCache:"Device schema cache",restoreSectionFullBackupHistory:"Backup history",restoreSectionStoredSettings:"Stored settings snapshot",restoreSectionStoredSession:"Stored session snapshot",saveSettings:"Save",saveSettingsHelp:"Apply personalization changes and close Settings.",cancelSettings:"Cancel",cancelSettingsHelp:"Close Settings without saving; previous colors and logo are restored.",reloadAppLabel:"Force reload",reloadAppHelp:"Clear cached files, unregister outdated service workers and reload without removing saved data. The app now verifies connectivity before cleanup, broadcasts fallback status to the offline banner, and preloads the fresh bundle so the new version appears faster.",reloadAppOfflineNotice:"Offline or degraded — force reload pings the server first, so reconnect and try again.",favoriteToggleLabel:"Toggle favorite",favoriteToggleHelp:"Mark the current selection as a favorite to pin it to the top of the list.",savedSetupsLabel:"Saved Projects:",newSetupOption:"-- New Project --",setupNameLabel:"Project Name:",generatedOnLabel:"Generated on",deleteSetupBtn:"Delete",saveSetupBtn:"Save",updateSetupBtn:"Update",clearFilter:"Clear filter",shareSetupBtn:"Export Project",shareSetupPrompt:"Project file ready to export. Crew contacts are included.",shareLinkCopied:"Project file downloaded.",shareExportFailed:"Project export failed.",shareLinkTooLong:"Project data is too large to export.",shareFilenamePrompt:"Enter a name for the exported project file (default: {defaultName}).",shareFilenameInvalid:"Please enter a valid file name to continue.",shareIncludeAutoGearConfirm:"Include automatic gear rules in the exported file? Select OK to include them or Cancel to skip.",shareIncludeAutoGearLabel:"Include automatic gear rules",shareIncludeAutoGearHelp:"Add your automatic gear rules to the exported project file.",shareIncludeOwnedGearLabel:"Mark owned gear in export",shareIncludeOwnedGearHelp:"Add ownership badges for gear you marked as yours when exporting.",shareDialogTitle:"Export Project",shareFilenameLabel:"Export file name",shareDialogConfirm:"Download",shareDialogCancel:"Cancel",sharedLinkLabel:"Project file",loadSharedLinkBtn:"Import Project",invalidSharedLink:"Invalid project file.",sharedImportAutoGearLabel:"Automatic gear rules",sharedImportAutoGearNone:"Do not import automatic gear rules",sharedImportAutoGearNoneHelp:"Load the project without applying the shared automatic rules.",sharedImportAutoGearProject:"Use shared rules for this project only",sharedImportAutoGearProjectHelp:"Save the shared automatic gear rules as a preset, apply it here, and restore your previous preset for other projects.",sharedImportAutoGearGlobal:"Use shared rules for all projects",sharedImportAutoGearGlobalHelp:"Save the shared automatic gear rules as a preset, activate it, and keep it selected for every project.",sharedImportAutoGearPresetName:"Shared rules – %s",sharedImportAutoGearPresetFallback:"Shared automatic gear rules",sharedImportDialogTitle:"Automatic gear rules",sharedImportDialogMessage:"Choose how to apply the shared automatic gear rules from this project.",sharedImportMetadataTimestamp:"Exported {timestamp}",sharedImportMetadataVersion:"Planner version {version}",sharedImportMetadataVersionMismatch:"Planner version {importVersion} (current build {appVersion})",sharedImportMetadataIncludesAutoGear:"Includes automatic gear rules",sharedImportMetadataIncludesOwnedGear:"Marks owned gear items",sharedImportMetadataUnavailable:"Export details unavailable.",sharedImportDialogConfirm:"Apply",sharedImportDialogCancel:"Cancel",cameraLabel:"Camera:",monitorLabel:"Monitor:",videoLabel:"Wireless Transmitter:",cageLabel:"Camera Cage:",distanceLabel:"Distance Sensor:",batteryLabel:"Battery:",batteryBMountLabel:"B-Mount Battery:",batteryPlateLabel:"Battery Plate:",batteryHotswapLabel:"Battery Hotswap:",lensesLabel:"Lenses:",fizLegend:"FIZ (Follow Focus) Systems",fizMotorsLabel:"FIZ Motors:",fizControllersLabel:"FIZ Controllers:",fizLegendHelp:"Add motors, controllers or distance units for focus/iris/zoom control.",fizMotorsHelp:"Select focus, iris or zoom motors.",fizControllersHelp:"Choose hand units or controllers for your FIZ system.",breakdownListHelp:"Power consumption per device category.",totalPowerLabel:"Total Consumption:",totalPowerHelp:"Combined power draw of all selected devices.",availablePowerLabel:"Available Power:",totalCurrent144Label:"Total Current (at 14.4V):",totalCurrent144Help:"Current draw at the battery's high-voltage output (e.g., 14.4V pins).",totalCurrent12Label:"Total Current (at 12V):",totalCurrent12Help:"Current draw from a 12V output such as D-Tap.",totalCurrent336Label:"Total Current (at 33.6V):",totalCurrent336Help:"Current draw at the battery's high-voltage output (e.g., 33.6V pins).",totalCurrent216Label:"Total Current (at 21.6V):",totalCurrent216Help:"Current draw from a 21.6V output such as B-Mount low-voltage.",batteryLifeLabel:"Runtime (estimated):",batteryLifeHelp:"Estimated runtime based on total draw and chosen battery capacity.",batteryCountLabel:"Batteries for 10h shoot:",batteryCountHelp:"Batteries needed for a 10-hour shoot.",runtimeFeedbackBtn:"Submit User Runtime Feedback",selectedGearHeading:"Selected Gear",recommendationsHeading:"Recommended Accessories",recommendationsHeadingHelp:"Accessories suggested based on selected devices.",weightingHeading:"Runtime Weighting Breakdown",pinWarningHelp:"Alerts if current exceeds what the battery pins can supply.",dtapWarningHelp:"Alerts if current exceeds what the D-Tap port can supply.",hotswapWarningHelp:"Alerts if the selected hotswap restricts available current.",methodPinsOnly:"pins only!",methodPinsAndDTap:"both pins and D-Tap",methodInfinite:"infinite",pinOk:"Battery pins can supply up to {max}A – current draw is within limits.",dtapOk:"D-Tap can supply up to {max}A – current draw is within limits.",warnPinExceededLevel:"warning",warnPinNearLevel:"note",warnDTapExceededLevel:"warning",warnDTapNearLevel:"note",warnPinExceeded:"WARNING: current draw ({current}A at ~12V) exceeds the battery's main output rating ({max}A)!",warnPinNear:"Note: current draw is close to the main output limit ({current}A of {max}A).",warnDTapExceeded:"WARNING: current draw ({current}A) exceeds the battery's D-Tap output ({max}A)!",warnDTapNear:"Note: current draw uses over 80% of the D-Tap capacity ({current}A of {max}A).",warnHotswapLower:"WARNING: hotswap current limit ({max}A) is lower than battery ({batt}A).",powerWarningTitle:"Battery cannot power this load",powerWarningLimitsHeading:"Output limits",powerWarningMessage:"“{battery}” must deliver {current}A, which exceeds every available output.",powerWarningPinsDetail:"Pins limit: {max}A",powerWarningPinsUnavailable:"Pins limit unavailable.",powerWarningDtapDetail:"D-Tap limit: {max}A",powerWarningDtapUnavailable:"No D-Tap output is available.",powerWarningDtapBlocked:"D-Tap cannot be used with the current configuration.",powerWarningAdvice:"Choose another battery, reduce the draw, or adjust your power distribution.",powerWarningClose:"Understood",incompatibleFIZWarning:"WARNING: incompatible FIZ brands selected.",missingFIZControllerWarning:"ERROR: FIZ motors require a controller with LBUS/CAM connection.",arriUMC4Warning:"WARNING: UMC-4 only works with LCS (LEMO 7-pin) to LBUS cable with LBUS devices.",arriRIA1Warning:"WARNING: RIA-1 or cforce RF controllers are not compatible with CLM-3/4/5.",arriCLMNoUMC4Warning:"WARNING: No FIZ controller present. Select a UMC-4 for a complete project. CLM-3/4/5 are not compatible with RIA-1, cforce RF or Master Grips.",distanceControllerWarning:"WARNING: Distance units require UMC-4, RIA-1 or cforce RF.",masterGripWirelessWarning:"WARNING: Master Grip has no wireless capability. Use RIA-1, UMC-4 or cforce RF for wireless control.",amiraCforceRemoteWarning:"ERROR: AMIRA with cforce Mini/Plus requires RIA-1, cforce RF, or UMC-4 for remote focus. Master Grips only allow local operator focus.",category_cameras:"Cameras",category_lenses:"Lenses",category_viewfinders:"Viewfinders",category_monitors:"Monitors",category_video:"Wireless Transmitter",category_wirelessReceivers:"Wireless Receiver",category_cages:"Cages",category_fiz_motors:"FIZ Motors",category_fiz_controllers:"FIZ Controllers",category_fiz_distance:"FIZ Distance",category_batteries:"Batteries",category_batteryHotswaps:"Battery Hotswap",category_accessory_batteries:"Accessory Batteries",category_cables:"Cables",category_camera_support:"Camera Support",category_chargers:"Chargers",category_cardReaders:"Card Reader",lensSpecBrandLabel:"Brand",lensSpecTypeLabel:"Lens Type",lensSpecMountLabel:"Mount",lensSpecFrontDiameterLabel:"Front Diameter",lensSpecTStopLabel:"T-stop",lensSpecImageCircleLabel:"Image Circle",lensSpecLengthLabel:"Length",lensSpecMinFocusLabel:"Minimum Focus",lensSpecWeightLabel:"Weight",lensSpecRodStandardLabel:"Rod Standard",lensSpecRodLengthLabel:"Rod Length",lensSpecClampOnLabel:"Clamp-on",lensSpecSupportLabel:"Lens Support",lensSpecCategoryGeneralLabel:"General",lensSpecCategoryOpticsLabel:"Optics",lensSpecCategoryPhysicalLabel:"Physical",lensSpecCategorySupportLabel:"Support",lensSpecCategoryNotesLabel:"Notes",lensSpecNotesLabel:"Notes",lensSpecFocusScaleLabel:"Focus Scale",lensSpecYes:"Yes",lensSpecNo:"No",lensSpecSupportRequired:"Required",lensSpecSupportNotRequired:"Not required",lensSpecUnknownValue:"Unknown",addDeviceHeading:"Add New Device",categoryLabel:"Category:",subcategoryLabel:"Subcategory:",deviceNameLabel:"Name:",consumptionLabel:"Consumption (W):",capacityLabel:"Capacity (Wh):",pinLabel:"Max Pin A:",dtapLabel:"Max D-Tap A:",cameraWattLabel:"Power Draw (W):",cameraVoltageLabel:"Voltage Range:",cameraPortTypeLabel:"Port Type:",cameraPlatesLabel:"Battery Plates:",cameraMediaLabel:"Recording Media:",cameraLensMountLabel:"Lens Mount:",lensDeviceMountHeading:"Lens Mount Options",lensDeviceMountLabel:"Mount options:",lensDeviceMountHelp:'Add every mount this lens supports. Choose "native" when no adapter is required.',lensFocusScaleLabel:"Focus scale unit:",lensFocusScaleHelp:"Choose the measurement markings shown for this lens. Leave the global default to follow project settings.",lensFocusScaleDefault:"Use global focus scale",powerInputsHeading:"Power Inputs",powerDistributionHeading:"Power Distribution",videoOutputsHeading:"Video Outputs",fizConnectorHeading:"FIZ Connector",mediaHeading:"Media",viewfinderHeading:"Viewfinder",lensMountHeading:"Lens Mount",timecodeHeading:"Timecode",powerDistributionLabel:"Outputs:",videoOutputsLabel:"Outputs:",fizConnectorLabel:"Connectors:",viewfinderLabel:"Viewfinders:",timecodeLabel:"Timecode:",monitorScreenSizeLabel:"Screen Size (in):",monitorBrightnessLabel:"Brightness (nits):",monitorWattLabel:"Power Draw (W):",monitorVoltageLabel:"Voltage Range:",monitorPortTypeLabel:"Port Type:",monitorVideoInputsHeading:"Video Inputs",monitorVideoInputsLabel:"Inputs:",monitorVideoOutputsHeading:"Video Outputs",monitorVideoOutputsLabel:"Outputs:",monitorWirelessTxLabel:"Wireless TX:",monitorLatencyLabel:"Latency:",monitorLatencyHelp:"Latency is saved even if Wireless TX is off. Clear this field to remove the stored value.",monitorAudioOutputLabel:"Audio Output:",viewfinderDetailsHeading:"Viewfinder Details",viewfinderScreenSizeLabel:"Screen Size (in):",viewfinderBrightnessLabel:"Brightness (nits):",viewfinderPowerHeading:"Power Input",viewfinderWattLabel:"Power Draw (W):",viewfinderVoltageLabel:"Voltage Range:",viewfinderPortTypeLabel:"Port Type:",viewfinderVideoInputsHeading:"Video Inputs",viewfinderVideoInputsLabel:"Inputs:",viewfinderVideoOutputsHeading:"Video Outputs",viewfinderVideoOutputsLabel:"Outputs:",viewfinderWirelessTxLabel:"Wireless TX:",viewfinderLatencyLabel:"Latency:",viewfinderLatencyHelp:"Latency is saved even if Wireless TX is off. Clear this field to remove the stored value.",videoPowerInputsHeading:"Power Inputs",videoVideoInputsHeading:"Video Inputs",videoVideoInputsLabel:"Inputs:",videoVideoOutputsHeading:"Video Outputs",videoVideoOutputsLabel:"Outputs:",videoPowerInputLabel:"Connectors:",videoPowerInputHelp:"Add every supported power connector, including battery plates. Use notes for mount adapters or other details.",videoPowerTypeLabel:"Connector",videoPowerVoltageLabel:"Voltage range",videoPowerNotesLabel:"Notes",videoPowerVoltagePlaceholder:"Voltage range (e.g. 6-28V)",videoPowerNotesPlaceholder:"Notes (mount, adapter, etc.)",videoFrequencyLabel:"Frequency:",videoLatencyLabel:"Latency:",motorConnectorLabel:"Connector:",motorInternalLabel:"Internal Controller:",motorTorqueLabel:"Torque (Nm):",motorGearLabel:"Gear Types:",controllerConnectorLabel:"Connector:",controllerPowerLabel:"Power Source:",controllerBatteryLabel:"Battery Type:",controllerConnectivityLabel:"Connectivity:",distanceConnectionLabel:"Connection:",distanceMethodLabel:"Method:",distanceRangeLabel:"Range:",distanceAccuracyLabel:"Accuracy:",distanceOutputLabel:"Display:",notesLabel:"Notes:",monitorDetailsHeading:"Monitor Details",monitorPowerHeading:"Power Input",addDeviceBtn:"Add",addDeviceBtnHelp:"Add the new device to the database.",updateDeviceBtn:"Update",updateDeviceBtnHelp:"Save changes to the current device.",editBtn:"Edit",editBtnHelp:"Modify this device's details.",deleteDeviceBtn:"Delete",deleteDeviceBtnHelp:"Remove this device from the database.",cancelEditBtn:"Cancel",cancelEditBtnHelp:"Cancel editing and clear the form.",exportDataBtn:"Export Database",exportDataBtnHelp:"Download the current device database as a JSON file.",importDataBtn:"Import Database",importDataBtnHelp:"Load a device database from a JSON file.",alertImportSuccess:"Database imported successfully! {num_devices} devices loaded.",alertImportError:"Failed to import database. Invalid file or data format.",confirmExportAndRevert:"Are you sure you want to export the current database AND then revert to the default database? This will overwrite your current saved data with the original defaults.",alertExportAndRevertSuccess:"Database exported and reverted to defaults successfully.",alertStorageError:"Storage error: Unable to access local data. Changes may not be saved.",alertSessionFallback:"Warning: Local storage is unavailable. Data will only persist for this browser tab.",placeholder_deviceName:"Device name",placeholder_watt:"e.g. 12.5",placeholder_capacity:"e.g. 98",placeholder_pin:"e.g. 10",placeholder_dtap:"e.g. 5",placeholder_voltage:"11V-34V DC",placeholder_port:"Bat LEMO 8-pin",placeholder_plates:'[{"type":"V-Mount","mount":"native"}]',placeholder_media:'[{"type":"CFast 2.0"}]',placeholder_lensmount:"ARRI PL",placeholder_powerdist:"[{}]",placeholder_videooutputs:"[{}]",placeholder_fizconnector:"[{}]",placeholder_timecode:"[{}]",placeholder_filter:"Filter {item}...",toggleDeviceManager:"Edit Device Data…",hideDeviceManager:"Hide Device Data",showDetails:"Show Details",hideDetails:"Hide Details",batteryTableLabel:"Battery",batteryLifeHeading:"Runtime comparison",runtimeLabel:"Estimated Runtime (h)",batteryLifeUnit:"hrs",runtimeAverageNote:"Note: runtime estimate uses a weighted average of user-submitted runtimes adjusted for resolution, codec, frame rate, brightness and temperature.",runtimeUserCountNote:"Based on {count} user reports for this project.",temperatureNoteHeading:"Temperature impact on runtime:",temperatureNoteHelp:"Shows how different temperatures affect battery runtime.",temperatureLabel:"Temperature",batteryCountTempLabel:"Batteries needed",noBatterySupports:"No battery can supply this load.",alertSetupName:"Please enter a name for the project.",alertSetupNeedsDevice:"You can save a project even if no devices are selected yet.",alertSetupSaved:'Project "{name}" saved in this browser. It stays available after closing or reopening tabs unless you clear the browser cache.',alertSetupSavedNoDevices:`Project "{name}" saved in this browser with no devices yet. Add gear and requirements whenever you're ready—we'll keep everything protected.`,alertSetupRenameSaveFailed:"We couldn’t finish saving the renamed project. Your original project is still available—please try saving again to keep everything in sync.",alertNoSetupSelected:"Please select a saved project to delete.",alertSetupDeleted:'Project "{name}" deleted.',confirmDeleteSetup:'Really delete project "{name}"?',confirmDeleteSetupAgain:"This will permanently delete the project. Are you sure?",confirmDeleteDevice:'Really delete device "{name}"?',alertDeviceExists:"A device with this name already exists in this category.",alertDeviceAdded:'Device "{name}" added to category "{category}".',alertDeviceUpdated:'Device "{name}" updated in category "{category}".',alertDeviceFields:"Please provide valid values for capacity, Pin A and D-Tap A.",alertDeviceWatt:"Please enter a valid watt value.",alertDeviceName:"Device name cannot be empty.",alertInvalidCameraJSON:"Invalid JSON for camera details",generateOverviewBtn:"Generate Overview",generateGearListBtn:"Generate Kit List and Production Requirements",addExtraGearBtn:"Add temporary extra gear",editProjectBtn:"Edit Project requirements",projectForm:{heading:"Production Requirements",projectName:"Project Name:",productionCompany:"Production Company:",productionCompanyAddress:"Production Company Address (optional):",productionCompanyStreet:"Street address",productionCompanyStreetPlaceholder:"123 Production Way",productionCompanyStreet2:"Address line 2 (optional)",productionCompanyStreet2Placeholder:"Suite, building, etc.",productionCompanyCity:"City",productionCompanyCityPlaceholder:"Los Angeles",productionCompanyRegion:"State / Province / Region",productionCompanyRegionPlaceholder:"California",productionCompanyPostalCode:"Postal code",productionCompanyPostalCodePlaceholder:"90001",productionCompanyCountry:"Country",productionCompanyCountryPlaceholder:"United States",rentalHouse:"Rental:",crewHeading:"Crew",prepLabel:"Prep Days:",shootLabel:"Shooting Days:",returnLabel:"Return Day(s):",deliveryResolution:"Delivery Resolution:",recordingResolution:"Recording Resolution:",sensorMode:"Sensor Mode:",aspectRatio:"Aspect Ratio:",codec:"Codec:",baseFrameRate:"Base Frame Rate:",recordingFrameRate:"Recording Frame Rate:",recordingFrameRateRangeHint:"Enter a recording frame rate from 1 to {max} fps.",recordingFrameRateDefaultHint:"Enter the recording frame rate in frames per second.",slowMotionHeading:"Slow Motion Frame Rate",slowMotionRecordingResolution:"Slow Motion Recording Resolution:",slowMotionSensorMode:"Slow Motion Sensor Mode:",slowMotionAspectRatio:"Slow Motion Aspect Ratio:",slowMotionBaseFrameRate:"Slow Motion Base Frame Rate:",slowMotionRecordingFrameRate:"Slow Motion Recording Frame Rate:",slowMotionRecordingFrameRateRangeHint:"Enter a slow motion recording frame rate from 1 to {max} fps.",slowMotionRecordingFrameRateDefaultHint:"Enter the slow motion recording frame rate in frames per second.",lensesHeading:"Lenses",lensManufacturerStep:"Step 1: Select manufacturer",lensManufacturerPlaceholder:"Choose a manufacturer",lensSeriesStep:"Step 2: Select series",lensSeriesPlaceholder:"Choose a series",lensSeriesEmpty:"No series available for this manufacturer.",lensesLabel:"Step 3: Choose lenses",lensOptionsEmpty:"No lenses available for this series.",lensSelectionsLabel:"Selected lenses",lensSelectionsHint:"Selections update as you add or remove lenses.",lensRemoveLabel:"Remove {lens}",lensMountLabel:"Mount",riggingHeading:"Rigging & Mounting",requiredScenarios:"Shooting Scenarios & Environments",cameraHandle:"Camera Handle:",viewfinderExtension:"Viewfinder Extension:",viewfinderExtensionNone:"No",viewfinderExtensionYes:"Yes",matteboxFilterHeading:"Mattebox and Filter",mattebox:"Mattebox:",filter:"Filter:",storageHeading:"Storage & Media",storageNeedsLabel:"Recording media needs:",storageQuantityLabel:"Quantity",storageTypeLabel:"Media type:",storageVariantLabel:"Brand & capacity:",storageNotesLabel:"Notes:",storageTypePlaceholder:"Select media type",storageVariantPlaceholder:"Select brand & size",storageNotesPlaceholder:"Add notes (brand, capacity, recorder...)",storageDuplicateEntry:"Duplicate media row",storageSummaryFallback:"Media",monitoringHeading:"Monitoring",monitoringConfiguration:"Camera Monitoring Configuration:",viewfinderSettings:"Viewfinder Settings:",frameGuides:"Frameguides:",aspectMaskOpacity:"Aspect Mask Opacity:",videoDistribution:"Video distribution:",monitorUserButtons:"Onboard Monitor User Buttons:",cameraUserButtons:"Camera User Buttons:",viewfinderUserButtons:"Viewfinder User Buttons:",userButtonFunctions:{user1:"User 1",user2:"User 2",user3:"User 3",user4:"User 4",toggleLut:"Toggle LUT",falseColor:"False Color",peaking:"Peaking",anamorphicDesqueeze:"Anamorphic Desqueeze",surroundView:"Surround View",oneToOneZoom:"1:1 Zoom",waveform:"Waveform",histogram:"Histogram",vectorscope:"Vectorscope",zebra:"Zebra",playback:"Playback",record:"Record",zoom:"Zoom",frameLines:"Frame Lines",frameGrab:"Frame Grab",wb:"WB",iso:"ISO",nd:"ND",fps:"FPS",shutter:"Shutter"},tripodPreferencesHeading:"Tripod Preferences",tripodHeadBrand:"Head Brand:",tripodBowl:"Bowl type:",tripodTypes:"Tripod types:",tripodSpreader:"Spreader Preference:",cancel:"Cancel",addEntry:"Add",removeEntry:"Remove",submit:"OK",crewNamePlaceholder:"Name",crewPhonePlaceholder:"Phone",crewEmailPlaceholder:"Email",crewWebsitePlaceholder:"Website",crewRoleLabel:"Crew role",crewNameLabel:"Crew member name",crewPhoneLabel:"Crew member phone",crewEmailLabel:"Crew member email",crewWebsiteLabel:"Crew member website"},projectFields:{productionCompany:"Production Company",productionCompanyAddress:"Production Company Address",productionCompanyStreet:"Street address",productionCompanyStreetPlaceholder:"123 Production Way",productionCompanyStreet2:"Address line 2 (optional)",productionCompanyStreet2Placeholder:"Suite, building, etc.",productionCompanyCity:"City",productionCompanyCityPlaceholder:"Los Angeles",productionCompanyRegion:"State / Province / Region",productionCompanyRegionPlaceholder:"California",productionCompanyPostalCode:"Postal code",productionCompanyPostalCodePlaceholder:"90001",productionCompanyCountry:"Country",productionCompanyCountryPlaceholder:"United States",rentalHouse:"Rental",rentalHouseContact:"Rental contact",rentalHouseAddress:"Rental address",crew:"Crew",prepDays:"Prep Days",shootingDays:"Shooting Days",returnDays:"Return Days",deliveryResolution:"Delivery Resolution",recordingResolution:"Recording Resolution",aspectRatio:"Aspect Ratio",codec:"Codec",baseFrameRate:"Base Frame Rate",recordingFrameRate:"Recording Frame Rate",slowMotionRecordingResolution:"Slow Motion Recording Resolution",slowMotionSensorMode:"Slow Motion Sensor Mode",slowMotionAspectRatio:"Slow Motion Aspect Ratio",slowMotionBaseFrameRate:"Slow Motion Base Frame Rate",slowMotionRecordingFrameRate:"Slow Motion Recording Frame Rate",sensorMode:"Sensor Mode",lenses:"Lenses",requiredScenarios:"Required Scenarios",cameraHandle:"Camera Handle",viewfinderExtension:"Viewfinder Extension",viewfinderEyeLeatherColor:"Viewfinder Eye Leather Color",mattebox:"Mattebox",gimbal:"Gimbal",videoDistribution:"Video Distribution",monitoringSupport:"Monitoring support",monitoringConfiguration:"Monitoring configuration",focusMonitor:"Focus Monitor",monitorUserButtons:"Onboard Monitor User Buttons",cameraUserButtons:"Camera User Buttons",viewfinderUserButtons:"Viewfinder User Buttons",tripodHeadBrand:"Tripod Head Brand",tripodBowl:"Tripod Bowl",tripodTypes:"Tripod Types",tripodSpreader:"Tripod Spreader",sliderBowl:"Slider Bowl",easyrig:"Further Stabilisation",storageRequirements:"Storage & Media"},crewRoles:{Producer:"Producer","Production Manager":"Production Manager",Director:"Director","Assistant Director":"1st AD","Production Assistant":"Production Assistant",DoP:"DoP","Camera Operator":"Camera Operator","B-Camera Operator":"B-Camera Operator","Steadicam Operator":"Steadicam Operator","Drone Operator":"Drone Operator","1st AC":"1st AC","2nd AC":"2nd AC",DIT:"DIT","Video Operator":"Video Operator","Key Gaffer":"Gaffer",Gaffer:"Electric","Best Boy Electric":"Best Boy Electric",Electrician:"Electrician","Rigging Gaffer":"Rigging Gaffer","Key Grip":"Key Grip","Best Boy Grip":"Best Boy Grip",Grip:"Grip","Dolly Grip":"Dolly Grip","Rigging Grip":"Rigging Grip"},scenarios:{Indoor:"Indoor",Outdoor:"Outdoor",Studio:"Studio",Tripod:"Tripod",Handheld:"Handheld",Easyrig:"Easyrig","Cine Saddle":"Cine Saddle",Steadybag:"Steadybag",Dolly:"Dolly",Slider:"Slider",Steadicam:"Steadicam",Gimbal:"Gimbal",Trinity:"Trinity",Rollcage:"Rollcage","Car Mount":"Car Mount",Jib:"Jib","Undersling mode":"Undersling Mode",Crane:"Crane","Remote Head":"Remote Head","Extreme cold (snow)":"Extreme Cold (Snow)","Extreme rain":"Extreme Rain","Extreme heat":"Extreme Heat","Rain Machine":"Rain Machine","Slow Motion":"Slow Motion","Battery Belt":"Battery Belt"},gearListNoteLabel:"Note:",gearListAutosaveNote:"Autosaved after each rig tweak so the offline gear manifest mirrors your latest camera build.",gearListAddCustomItem:"Add custom item",gearListAddCustomItemToCategory:"Add custom item to {category}",gearListRemoveCustomItem:"Remove",gearListRemoveCustomItemFromCategory:"Remove custom item from {category}",gearListCustomItemQuantityLabel:"Quantity",gearListCustomItemQuantityAria:"Quantity for custom item in {category}",gearListCustomItemNameLabel:"Item name",gearListCustomItemNameAria:"Item name for custom item in {category}",gearListCustomItemNamePlaceholder:"Custom item",gearListCustomItemPreviewFallback:"Custom item",gearListCartSelectorLabel:"Camera cart",gearListCartConfigurationLabel:"Cart configuration",gearListCartAccessoriesLabel:"Cart accessories",gearListExcludeRentalToggle:"Exclude for rental",gearListIncludeRentalToggle:"Include for rental",gearListRentalNote:"Rental handles this item",gearListEditProviderLabel:"Provided by",gearListEditProviderHelp:"Select who provides this item. Rental stays the default unless the item is in your own gear list.",gearListProviderRental:"Rental",gearListProviderUser:"User",gearListProviderCrewHeading:"Crew",gearListProviderUnknown:"Custom provider",gearListEditOwnedLabel:"Owned",gearListEditOwnedHelp:"Add or remove this line from your Own Gear list to keep your inventory in sync.",gearListOwnedExportLabel:"Owned by %s",gearListEditCameraLinkLabel:"Camera link",gearListEditCameraAssignmentLabel:"Camera designation",gearListEditCameraAssignmentHelp:"Pick the letter for this camera body. Linked accessories will share its color.",gearListEditCameraLinkHelp:"Highlight items that should follow a specific camera letter so crews know which kit moves together.",gearListEditCameraLinkNoneOption:"No camera link",gearListEditCameraLinkCameraOption:"Camera %s — %s",gearListEditCameraLinkUnavailableOption:"Camera %s (unassigned)",gearListEditCameraLinkDefaultLabel:"Camera %s",gearListCameraLinkBadgeLabel:"Linked to camera",gearListEditDialogTitle:"Edit gear item",gearListEditQuantityLabel:"Quantity",gearListEditNameLabel:"Item name",gearListEditAttributesLabel:"Attributes",gearListEditNoteLabel:"Note",gearListEditExtraLabel:"Temporary extra gear",gearListEditExtraHelp:"Flag this item as a short-term addition. Set the period so everyone schedules it correctly.",gearListEditExtraStartLabel:"Needed from",gearListEditExtraEndLabel:"Needed until",gearListEditExtraPeriodHelp:"Leave the dates blank when the schedule is still tentative.",gearListExtraCategoryLabel:"Temporary Extras",gearListExtraIndicatorRange:"Temporary extra: %s – %s",gearListExtraIndicatorOpen:"Temporary extra from %s",gearListExtraIndicatorEnd:"Temporary extra until %s",gearListExtraIndicatorNoPeriod:"Temporary extra",gearListEditRentalLabel:"Exclude from rental",gearListEditSave:"Save",gearListEditCancel:"Cancel",gearListEditButton:"Edit gear item",gearListEditCustomItem:"Edit custom item",gearListEditReset:"Reset name",gearListEditDeviceHeading:"Device attributes",gearListEditDeviceEdit:"Edit device attributes",gearListEditDeviceEmpty:"No device attributes recorded yet. Update the device to add details.",gearListEditDeviceCategory:"Device library: %s",gearListLensCoverageWarning:"This lens may not cover the full sensor of this camera!",autoGearHighlightToggle:"Highlight automatic gear",autoGearHighlightToggleHelp:"Toggle a temporary color overlay for gear added by automatic rules. Useful while debugging gear rule behavior.",autoGearHighlightToggleStateOn:"On",autoGearHighlightToggleStateOff:"Off",deleteGearListBtn:"Delete Kit List",deleteGearListBtnHelp:"Remove the saved kit list from this project and hide the table.",confirmDeleteGearList:"Delete kit list?",confirmDeleteGearListAgain:"This will permanently delete the kit list. Are you sure?",ownGearDialogTitle:"Own gear",ownGearDialogDescription:"Capture the equipment you personally own so you can plan around what's already in your kit.",ownGearAddHeading:"Add gear",ownGearAddHelp:"Start typing to search our catalog for suggestions or describe custom items you own. Entries save immediately.",ownGearNameLabel:"Item",ownGearNamePlaceholder:"Lens, monitor, adapter…",ownGearNameHelp:"Required. Use the exact model name so suggestions and exports stay clear.",ownGearQuantityLabel:"Quantity",ownGearQuantityPlaceholder:"1",ownGearQuantityHelp:"Enter how many of this item you own. Leave blank when it varies.",ownGearNotesLabel:"Notes",ownGearNotesPlaceholder:"Condition, accessories, case number…",ownGearNotesHelp:"Optional notes about accessories, serial numbers or case locations.",ownGearSaveButton:"Save item",ownGearUpdateButton:"Update item",ownGearResetButton:"Reset form",ownGearCloseButton:"Close",ownGearListHeading:"Your gear",ownGearListEmpty:"No gear saved yet. Add the equipment you own to reuse it across projects.",ownGearListSummaryOne:"%s item tracked",ownGearListSummaryOther:"%s items tracked",ownGearEditButton:"Edit",ownGearEditButtonAria:"Edit “%s”",ownGearDeleteButton:"Remove",ownGearDeleteButtonAria:"Remove “%s” from your own gear list",ownGearDeleteConfirm:"Remove “%s” from your own gear list? This only removes it from your inventory.",ownGearQuantityInvalid:"Enter a non-negative quantity or leave the field blank.",ownGearNameRequired:"Enter the item name to save it.",alertSelectSetupForOverview:"Please select a saved project to generate an overview.",overviewTitle:"Project Overview",backToAppBtn:"Back to App",printBtn:"Print",exportPdfBtn:"Export PDF / Print",exportRentalPdfBtn:"Export PDF for Rental",rentalPrintDialogTitle:"Export PDF / Print",rentalPrintDialogDescription:"Choose what to include before exporting or printing.",rentalPrintDialogSectionsLabel:"Sections to include",rentalPrintDialogConfirm:"Export PDF",rentalPrintDialogCancel:"Cancel",rentalPrintDialogSelectAll:"Select all",printOptionsLayoutLabel:"Layout",printOptionsLayoutStandard:"Standard layout",printOptionsLayoutRental:"Rental-friendly layout",rentalPrintSectionProject:"Production Requirements",rentalPrintSectionDevices:"Camera Package Devices",rentalPrintSectionPower:"Power Summary",rentalPrintSectionDiagram:"Power Diagram",rentalPrintSectionGearList:"Kit List",rentalPrintSectionBattery:"Battery Comparison",pdfWarningsHeading:"Warnings",exportAndRevertBtn:"Export and revert to default database",exportAndRevertBtnHelp:"Export your database and restore default entries.",helpButtonLabel:"Help",helpButtonTitle:"Help (press ?, H, F1 or Ctrl+/)",helpButtonHelp:"Open the help dialog for step-by-step guidance. Keyboard shortcuts: F1, Ctrl + /, Cmd + /, ? or H.",helpButtonShortcuts:"F1; Ctrl + /; Cmd + /; ?; H",helpButtonAriaShortcuts:"F1 Control+Slash Meta+Slash Shift+Slash KeyH",helpClose:"Close (Esc)",helpCloseHelp:"Close the help dialog and return to the planner (press Esc).",helpTitle:"How to use",helpSearchPlaceholder:"Search help topics...",helpSearchLabel:"Search help topics",helpResultsSummaryAll:"All %s help topics are shown.",helpResultsSummaryFiltered:"Showing %1$s of %2$s help topics for “%3$s”.",helpResultsAssist:"Tip: Press Tab to move into the quick links, or press Enter to open the top visible topic.",helpNoResults:"No help topics match your search. Try shorter keywords, synonyms, or clear the field to browse everything.",helpNoResultsSuggestionsHeading:"Need a different result?",helpNoResultsSuggestionsIntro:"Try these steps to get back on track while keeping your data safe and confirming offline safeguards:",helpNoResultsSuggestionClear:"Use %s to browse every article again.",helpNoResultsSuggestionSynonyms:"Search for equipment nicknames, battery part numbers, or shorter keywords.",helpNoResultsSuggestionQuickStart:"Jump to the %s for a guided refresher on saving, sharing, and backups.",helpNoResultsSuggestionBackup:"Open %1$s, start a %2$s to confirm your offline exports, and review Settings → Data & Storage for the latest autosave timestamp before you continue.",helpOnboardingTutorialCopy:"to follow every workflow with offline progress tracking—including the Power Summary checkpoint and the offline safety net drill—before configuring your first project. Use the step navigator and progress meter to review completed sections offline.",onboardingTour:{startLabel:"Start guided tutorial",restartLabel:"Replay guided tutorial",resumeLabel:"Resume guided tutorial",skipLabel:"Skip tutorial",backLabel:"Back",nextLabel:"Next",introStartLabel:"Start onboarding tour",doneLabel:"Finish tutorial",stepIndicator:"Step {current} of {total}",completionIndicator:"First project secured offline",prefaceIndicator:"Welcome",stepListAriaLabel:"Tutorial steps",stepStatusCurrent:"Current step",stepStatusComplete:"Completed",stepStatusUpcoming:"Up next",resumeHint:"Picking up right where you paused. Use the step navigator to revisit earlier workflows without clearing offline progress.",resumeHintDetailed:"Resuming at step {current} of {total}. {completed} steps are already complete and locked into your offline saves.",userProfileInteractionIntro:"Enter your crew details once. Each update syncs to Contacts instantly, stays cached offline and flows into exports so crews always know who owns the setup.",userProfileInteractionSkipHint:"Press Next when you are ready—Contacts in the sidebar always shows these saved details without resetting tutorial progress.",userProfileAvatarAction:"Add profile photo",userProfileAvatarEditAction:"Edit photo",projectRequirementsMiniIntro:"Fill these proxy fields while the Production Requirements dialog stays open.",projectRequirementsMiniOfflineHint:"Every edit saves offline instantly—use Back/Next here without risking data loss.",unitsPreferencesLanguageLabel:"Language",unitsPreferencesThemeLabel:"Theme",unitsPreferencesThemeLight:"Light",unitsPreferencesThemeDark:"Dark",unitsPreferencesPinkLabel:"Pink mode accents",unitsPreferencesPinkOff:"Disabled",unitsPreferencesPinkOn:"Enabled",unitsPreferencesUnitsLabel:"Temperature units",unitsPreferencesPersistenceHint:"Request persistent storage so the browser keeps planner data even when space runs low.",unitsPreferencesPersistenceAction:"Protect storage on this device",progressMeterLabel:"Tutorial progress",progressValueLabel:"Completed {completed} of {total} steps",resumeLabelWithProgress:"Resume guided tutorial ({completed}/{total} complete)",helpStatusNotStarted:"Guided tutorial progress saves offline as you advance. Up next: {next}.",helpStatusInProgress:"Offline progress saved: {completed} steps completed out of {total}. Next workflow: {next}.",helpStatusResume:"Paused on {current}. {completed} of {total} steps already secured offline.",helpStatusSkipped:"Tutorial skipped. Restart whenever you're ready—saved progress stays available offline.",helpStatusCompleted:"Tutorial completed. Replay any step anytime for a refresher.",helpStatusLastCompleted:"Last completed: {step} ({timeAgo}).",helpStatusLastUpdated:"Last update: {timeAgo}.",helpStatusTimeJustNow:"just now",helpStatusTimeMinute:"1 minute ago",helpStatusTimeMinutes:"{count} minutes ago",helpStatusTimeHour:"1 hour ago",helpStatusTimeHours:"{count} hours ago",helpStatusTimeDay:"1 day ago",helpStatusTimeDays:"{count} days ago",skipConfirmationTitle:"Skip the guided tutorial?",skipConfirmationBody:"You can reopen the tutorial from Help or use the step navigator to replay any section later.",skipConfirmationAccept:"Skip tutorial",skipConfirmationCancel:"Continue tutorial",steps:{intro:{hero:{heading:"Welcome to Cine Power Planner!",subheading:"Safeguard every camera setup with power checks, AutoGear kits, and rental-ready handoffs—kept fully offline.",summary:"Plan safe camera setups, verify power limits, auto-build kit lists from production requirements, and export rental-ready PDFs—every save stays local before call time.",badgeIcon:"",badgeLabel:"Crew-first · Offline forever",badgeDescription:"No servers, no accounts, no subscriptions. Every save, autosave, backup, restore, share, and import lives on this device.",highlights:[{icon:"",title:"Lock in power, safety, and backups",body:"Model draw, runtime, changeovers, and redundant pack coverage so battery safety margins are confirmed before rolling."},{icon:"",title:"AutoGear builds reusable kits",body:"Generate full kit lists from shooting scenarios with AutoGear rules, adjust those rules for the day, and reuse the presets."},{icon:"",title:"Project requirements ready to hand off",body:"Track requirements, crew coverage, and rental notes, then export PDF packets the crew, rental, and production rely on."},{icon:"",title:"Offline-first, subscription-free PWA",body:"Run the planner entirely offline, install it as a mobile PWA, and keep workflows available without subscriptions or servers."},{icon:"",title:"Data is sacred",body:"Autosave, backup/restore, share, and import safeguards protect every project snapshot. Restore rehearsals prove nothing is lost."}],languageLabel:"Language",languageHint:"Choose the interface language so this tour, the help center, and exports translate instantly across offline saves.",offlineSummary:"Cine Power Planner is built for field reliability: offline by default, installable on mobile, and always storing redundant saves locally so crews retain control of their data."}},userProfile:{title:"Complete your crew profile",body:"Set your display name, role, phone, email and photo. Each update syncs to Contacts immediately, stays in offline saves and appears on exports."},unitsPreferences:{title:"Tune theme and units",body:"Open Settings → General to choose the theme, optional pink highlights, focus scale and temperature units. Request persistent storage so the browser keeps preferences and safeguards saves during cleanups."},nameProject:{title:"Name your first project",body:"Give the project a descriptive name to anchor autosave, history, exports and backups. Every workflow references it so your offline library stays organized and easy to restore."},saveProject:{title:"Capture an immediate save",body:"Select Save (or press Ctrl+S/⌘S/Enter) to capture a complete offline snapshot—devices, power math, requirements, notes and diagnostics. The next workflow unlocks once the save finishes."},addCamera:{title:"Select the primary camera",body:"Choose the camera body you are planning. Offline search works inside the menu. That selection unlocks matching accessories, power draws and diagrams."},addMonitoring:{title:"Add monitors, wireless video and FIZ",body:"Pick onboard monitors, wireless transmitters and FIZ motors or controllers. Each selection feeds runtime math, diagrams and automatic gear rules so the generated kit reflects the full build."},selectBattery:{title:"Choose batteries",body:"Select the battery system that powers the rig. Runtime projections update immediately and the selection is stored with your offline project snapshots and backups."},resultsTotalDraw:{title:"Power Summary: Total draw",body:"Start your Power Summary review by confirming the Total Draw card and peak load so the demand math stays accurate before moving on to deeper checks."},resultsBatteryPacks:{title:"Power Summary: Battery runtimes",body:"Review each battery pack's projected runtime, all framed around a worst-case draw so most kits run longer—helping you know how many packs to bring, feel confident the rig won't demand constant swaps, and automatically pair the right batteries with each camera."},resultsChangeover:{title:"Power Summary: Changeovers",body:"Use the changeover card to review the category-by-category draw chart, see exactly which devices contribute the most load, and confirm every swap sequence keeps enough headroom. The breakdown ties each accessory to its watt draw so the next charged pack is staged for the hungriest circuit and the saved snapshot captures the latest handoff plan."},resultsWarnings:{title:"Power Summary: Warnings and backups",body:"Check the connector warning boxes: green shows the pin or D-Tap battery feed is safe, yellow means the feed is near its limit, and red means the rig is pulling more than that line can supply. Change out batteries and devices to get both boxes to appear green again. Rest assured the warnings keep you from pushing higher loads than a battery can safely handle."},batteryComparison:{title:"Battery Comparison",body:"Battery Comparison evaluates alternate packs side by side so you can lock in the safest runtime margin. The table shows which batteries can power the rig—green pins and D-Tap feeds are safe, orange pins-only outputs cover the rig without D-Tap support—and how long each pack runs."},runtimeFeedback:{title:"Submit runtime feedback",body:"Use the runtime feedback button to log real-world results. Entries sync with the current project, strengthen future estimates and remain available offline for audits."},connectionDiagram:{title:"Inspect the power diagram",body:"The interactive Power Diagram shows how power, video and control gear connect. Drag nodes to plan rig layout, double-click devices to open hover details, then save so the arrangement and annotations persist across exports and restores."},connectionDiagramDetails:{title:"Open device hover details",body:"Double-click any device node in the diagram to reveal its hover detail popup. Review draw notes, connector callouts and saved annotations, then close it to keep arranging the layout before saving."},editDeviceDataAdd:{title:"Add a device to the library",body:"Open Device Library, choose the correct category, enter the draw and connector details, then press Add. This stores the gear in the offline catalog so autosave, backups and shares all capture the new entry."},editDeviceDataReview:{title:"Review the device details",body:"Locate the device you just saved under Existing Devices and expand its details panel. Confirm the draw, outputs and compatibility information look right before relying on the data for runtime math or exports."},editDeviceDataEdit:{title:"Update and resave the device",body:"Use the Edit button on that entry, adjust specs or notes, and save again. This verifies the autosave timeline, backups and exports are refreshed with the latest numbers without risking any user data."},ownGearAccess:{title:"Open the Own Gear dialog",body:"Press the Own Gear button in the sidebar to launch your inventory dialog, then review the summary banner and your own gear list so you know where saved items, edit buttons and counts live. Finish by exploring the Add gear form—item search, quantity, notes, plus the Save and Reset controls—so you can add equipment instantly once the tour ends."},ownGearAddDevice:{title:"Add your first owned device",body:"Enter the item name, optional quantity and notes, then save. Owned gear is stored offline, included in backups and marked inside exports so teams instantly see what is available without duplicating requests."},projectRequirementsBrief:{title:"Capture the project brief",body:"Open the Production Requirements dialog from Generate Kit List and Production Requirements, then document production company, address, rental preferences, deliverables and schedule notes. These entries auto-fill rental-ready PDFs, stay cached offline and prepare the next sections."},projectRequirementsCrew:{title:"Map crew coverage and contacts",body:"Populate Crew, Prep, Shooting and Return rows with names, roles and coverage notes. Link saved Contacts, add emergency details and duplicate rows when multiple days share assignments so exports show who is on set and when."},projectRequirementsLogistics:{title:"Log lenses, rigging and monitoring plans",body:"Work through camera specs, the lens workflow, rigging scenarios, storage/media counts, matte box preferences and monitoring layouts. These entries feed automatic gear rules and storage math so the generated checklist reflects the full shoot plan."},generateGearAndRequirements:{title:"Save and rebuild the outputs",body:"Press OK inside the Production Requirements dialog to store every entry, regenerate the requirements summary and rebuild the categorized kit list. The planner snapshots the result with the active project so exports, backups and shares stay current."},autoGearRulesAccess:{title:"Open Automatic Gear Rules",body:"Go to Settings → Automatic Gear Rules to review automation controls. Opening the tab shows the presets, stock rules (including smart tripod logic that references your head/legs preference) and safety backups stored with your offline saves."},autoGearRulesEdit:{title:"Edit stock automatic gear rules",body:"Use the rules list to inspect factory additions. Select a stock rule to open it in the editor, adjust items or conditions, then save so the updated automation stays cached with backups and share bundles."},autoGearRulesCreate:{title:"Add a new automatic gear rule",body:"Press Add rule to create a custom automation. Name it, add conditions and required gear, then save. The planner runs new rules offline each time you regenerate the kit and includes them in exports, shares and backups."},projectRequirements:{title:"Refine production requirements boxes",body:"Review the regenerated Production Requirements summary beside the kit list. Confirm the brief, crew coverage and logistics boxes mirror the data you just saved, then rerun exports or backups so downstream teams get the updated context with every share."},gearList:{title:"Audit the generated kit list",body:"Check the categorized kit list for duplicates, counts and auto-added accessories. Edits save instantly, are included in share bundles and appear in printouts and PDFs."},exportImport:{title:"Export and import projects",body:"Use Export Project to download a JSON safety copy and Import Project to rehearse restores. Store exports on redundant media so no workstation loses data if a browser profile resets. Always keep the original export untouched so you can re-import even if a working copy gets edited."},overviewAndPrint:{title:"Generate overview, PDF and printouts",body:"Generate the project overview to access PDF, print and share-ready summaries. The dialog uses saved data only, so you can print or export even while fully offline."},help:{title:"Open the Help center",body:"The Help dialog includes searchable documentation, translation notes and onboarding references. Keep it pinned while working—articles stay cached offline and update when new features arrive."},settingsGeneral:{title:"Revisit Settings → General",body:"Adjust language, typography, theme, pink mode, focus scale and other presentation options anytime. Preferences save locally, sync across projects and are bundled with backups."},settingsData:{title:"Monitor Data & Storage",body:"Use the Data & Storage tab to request persistent storage, watch save timestamps and launch quick safeguards. These controls verify that every project snapshot remains available offline."},settingsBackup:{title:"Maintain Backup & Restore",body:"The Backup & Restore tab manages full-app exports, restore rehearsals and diagnostics. Run backups before major changes, archive the files on external media and verify restores regularly."},completion:{title:"Tutorial complete",body:"You now know every safeguard. Keep saving often, export redundant backups and revisit any step from Help whenever you want a refresher. Cine Power Planner will keep protecting your data offline."}}},helpQuickStartChecklistTitle:"Quick start checklist",helpDataSafetyTitle:"Protect your work",helpRestoreDrillTitle:"Restore rehearsal drill",helpDataAuditTitle:"Monthly data health check",helpDataAuditStep1:"Open %1$s, switch to %2$s, then use %3$s under %4$s to capture a fresh full-app snapshot before auditing downloads.",helpDataAuditStep2:"Export each active project with %1$s, confirm each download opens without errors, and store the files in two separate locations.",helpDataAuditStep3:"While offline, reload using %1$s and confirm the %2$s stays visible while projects and help articles load from local storage. Test %3$s with one of the new exports to ensure share bundles restore without reconnecting.",helpDataAuditStep4:"Run %1$s with your latest backup, verify every project, device, and rule, then record the runtime guard output from %2$s in your verification log before closing the rehearsal without publishing changes.",helpDataAuditNote:"Log the results, capture a screenshot of Settings → Data & Storage with the latest autosave timestamp, and archive the console guard output with your backup rotation checklist so you always know which copies were verified offline.",helpRestoreDrillNote:"Log filenames, timestamps and verification results in your backup rotation checklist so every rehearsal documents a restorable copy.",helpSearchClear:"Clear search",helpSearchHelp:"Type keywords or alternate spellings to instantly filter help topics. Quick links update as you type and highlight the matching article when you press Enter. Press '/' or Ctrl+F (Cmd+F on Mac) to focus the search box when the help dialog is open (instead of the browser find), then press Tab to step through filtered quick links without leaving your project.",helpSearchClearHelp:"Clear the search box and show all help topics again.",helpQuickLinksHeading:"Jump to a topic",helpQuickLinksAriaLabel:"Help topics quick navigation",helpQuickLinksHelp:"Jump directly to any section of the help dialog. Buttons only show topics that match the current search.",helpQuickLinkButtonHelp:"Scroll to the “%s” section in the help dialog.",hoverHelpButtonLabel:"Hover for help",hoverHelpButtonHelp:"Activate hover help so moving the cursor over buttons, fields, dropdowns or headers reveals brief explanations. You can open Settings while hover help is active to explore preferences without leaving this mode. Hovered controls are outlined and the tooltip shows their title alongside any available details. Longer descriptions are automatically broken into readable steps or bullet lists when available. Keyboard shortcuts are displayed whenever they exist so you can learn faster ways to use each control. When a control doesn't have custom guidance, the planner fills in contextual descriptions automatically so every interface element explains itself.",hoverHelpExitHint:"Press Esc or click anywhere to exit hover help.",hoverHelpShortcutsHeading:"Shortcuts",hoverHelpFallbackGeneric:"Interactive control.",hoverHelpFallbackButton:"Button. Activate to perform this action.",hoverHelpFallbackToggleButton:"Toggle button. Activate to switch between on and off states.",hoverHelpFallbackMenuButton:"Menu button. Opens a menu with related options.",hoverHelpFallbackLink:"Link. Opens the referenced section without leaving the app.",hoverHelpFallbackSelect:"Dropdown list. Open to choose one of the available options.",hoverHelpFallbackTextInput:"Text field. Type to enter information and press Enter to confirm when needed.",hoverHelpFallbackNumberInput:"Number field. Type a value or use arrow keys to adjust the number.",hoverHelpFallbackTextarea:"Multiline text field. Type paragraphs or paste notes.",hoverHelpFallbackCheckbox:"Checkbox. Select to enable, deselect to disable.",hoverHelpFallbackRadio:"Radio option. Select exactly one choice from this group.",hoverHelpFallbackSwitch:"Switch control. Toggle between on and off.",hoverHelpFallbackSlider:"Slider. Drag or use arrow keys to set the value.",hoverHelpFallbackFileInput:"File picker. Browse your device for files to add.",hoverHelpFallbackColorInput:"Color picker. Choose a color value.",hoverHelpFallbackDetails:"Expandable details section. Activate to show or hide the extra content.",hoverHelpFallbackDialog:"Dialog. Remains on top until you close it. Complete or cancel before returning to the main planner.",hoverHelpFallbackTablist:"Tab list. Use arrow keys to move between tabs.",hoverHelpFallbackTab:"Tab. Activate to display its panel of settings.",hoverHelpFallbackMenu:"Menu. Use arrow keys to move through options and Enter to select.",hoverHelpFallbackProgress:"Progress indicator showing current completion.",hoverHelpFallbackStatus:"Status message that updates automatically.",hoverHelpFallbackAlert:"Important alert that may require your attention.",setupSelectHelp:"Pick a previously saved configuration or select '-- New Project --' to start from scratch.",setupNameHelp:"Enter a descriptive name for the current project so you can recognize it later.",deleteSetupHelp:"Remove the highlighted saved project permanently from your browser.",saveSetupHelp:"Capture a full snapshot of the current project—devices, requirements, notes, runtime logs and diagram layout—and store it in your local library. The autosave status dot beside Project Name pulses while the write finishes, and the background auto-backup queue schedules the matching timestamped snapshot right after the save so redundancy stays current. Press Enter or Ctrl+S (⌘S on Mac) for the same result; the Save button stays disabled until you enter a project name. Saving never overwrites other projects until you confirm the name, so your prior data remains protected.",generateOverviewHelp:"Rebuilds the print-ready summary for the selected saved project and opens the overview dialog so you can review power and connection details before printing when ready. Lens selections render with brand, mount, diameter, focus, weight, rod support and notes so exports cover spec-sensitive checkouts.",generateGearListHelp:"Build a categorized kit list that combines selected gear with production requirements. The list refreshes on every change, merges duplicate items with counts and auto-adds required cables, rigging, lens supports, matte box parts, battery counts with hotswap hardware, default monitors for each role and scenario-specific accessories. Entries are sorted alphabetically and include hover descriptions.",shareSetupHelp:"Download a JSON safety bundle of the current project—covering custom gear, favorites, runtime feedback and devices—ready to archive or share offline. Store the file with your redundant crew backups before closing the planner so every workstation can restore it without network access. The export leaves your current project unchanged, so nothing is lost while you create the share bundle.",applySharedLinkHelp:"Load the configuration from a JSON backup exported via Save & Share or Backup & Restore. Review the preview diff before applying—nothing overwrites your current project until you confirm Save, and the planner schedules a fresh auto-backup beforehand so you can roll back instantly. Unnamed imports are saved automatically under an “-imported” title so the data lands even when the bundle omitted a project name. The imported project remains local and offline-ready immediately after you save.",sharedLinkHelp:"Choose a project JSON exported from Save & Share or Backup & Restore. Keep the original file in your backups after import—the planner only reads a copy and logs the attempt in diagnostics for your records so you can audit every restore.",cameraSelectHelp:"Choose the camera body that anchors your rig.",monitorSelectHelp:"Choose an on-board or wireless monitor to include.",videoSelectHelp:"Choose a transmitter/receiver pair or other wireless video link.",cageSelectHelp:"Choose a camera cage for mounting accessories.",distanceSelectHelp:"Choose an optional distance or range-finder sensor.",batterySelectHelp:"Choose the battery model that will power the entire rig.",batteryPlateSelectHelp:"Choose the battery plate or adapter that connects the battery to the camera.",batteryHotswapSelectHelp:"Select the hot-swap buffer that keeps power during battery changes.",runtimeFeedbackBtnHelp:"Open a form where you can submit real-world runtime data for this configuration.",zoomOutHelp:"Zoom out of the project diagram to view more of the layout.",zoomInHelp:"Zoom in on the project diagram for a closer look at connections.",downloadDiagramHelp:"Download the Power Diagram as an SVG or JPG image.",gridSnapToggleHelp:"Turn grid snapping on or off to help align items in the diagram.",resetViewBtn:"Reset View",resetViewHelp:"Reset zoom and pan to their defaults.",toggleDeviceManagerHelp:"Open the editor where you can add, modify, export or import device data.",hideDeviceManagerHelp:"Close the device database editor and return to normal mode.",zoomInLabel:"Zoom in",zoomOutLabel:"Zoom out",diagramHoverNotice:"Double click for details",diagramDetailBackLabel:"Back",diagramDetailDefaultHeading:"Diagram details",diagramMoveHint:"Drag nodes to rearrange; drag empty space to pan.",v2:{dashboard:{header:{title:"Projects"},actions:{newProject:"New Project",importProject:"Import Project"},projects:"Projects",newProject:"New Project",projectLocked:"The project '{projectName}' is already open in another tab.",emptyState:{title:"No Projects Yet",subtitle:"Create your first power plan to get started.",help:"Need help getting started?",archiveTitle:"No Archived Projects",archiveSubtitle:"Projects you archive will appear here."},search:{noResults:{title:"No Results",subtitle:'No projects match "{query}"'}},projectTile:{prep:"Prep:",shoot:"Shoot:",return:"Return:",openProject:"Open Project",renameAndEdit:"Rename & Edit",moreOptions:"More options",actionsFor:"Actions for {project}"},contextMenu:{open:"Open Project",rename:"Rename & Edit",duplicate:"Duplicate",archive:"Archive",unarchive:"Restore",delete:"Delete",print:"Print",pdf:"Export PDF"},status:{draft:"Draft",planning:"Planning",waitingForApproval:"Waiting for Approval",approved:"Approved",shooting:"Shooting",completed:"Completed",archived:"Archived"}},sidebar:{nav:{allProjects:"All Projects",activeProjects:"Active Projects",archive:"Archive",autoBackups:"Auto Backups",deviceLibrary:"Device Library",contacts:"Contacts",autoGearRules:"Auto Gear Rules",ownedGear:"Owned Gear",createProject:"Create New Project",projectsSection:"Projects",toolsSection:"Tools",supportSection:"Support",help:"Help",settings:"Settings"},search:{placeholder:"Search features, devices, actions...",label:"Search features, devices, actions, and help"}},detail:{backButton:"Back to Projects",header:{export:"Export Project",print:"Print / Export PDF",generateReqs:"Reqs & Gear",generateOverview:"Generate Overview",save:"Save"},tabs:{cameraPackage:"Camera Package",powerSummary:"Power Summary",requirements:"Requirements",gearList:"Gear List"},actions:{projectRequirements:"Project Requirements",generateRequirements:"Generate Requirements",generateRequirementsHelp:'Click "Generate Requirements" to create your production report.',gearList:"Gear List",generateGearList:"Generate Gear List",generateGearListHelp:'Click "Generate Gear List" to create your equipment list.'},diagram:{zoomIn:"Zoom In",zoomOut:"Zoom Out",resetView:"Reset View",download:"Download Diagram"}}}},categoryNames:{cameras:"Camera",viewfinders:"Viewfinder",monitors:"Monitor",video:"Wireless Transmitter","fiz.motors":"FIZ Motor","fiz.controllers":"FIZ Controller","fiz.distance":"FIZ Distance",batteries:"Battery",batteryHotswaps:"Battery Hotswap",wirelessReceivers:"Wireless Receiver","accessories.batteries":"Accessory Battery","accessories.cables":"Cable","accessories.cages":"Camera Cage","accessories.cameraSupport":"Camera Support","accessories.chargers":"Charger",cages:"Camera Cage",chargers:"Charger",directorMonitors:"Director Monitor",iosVideo:"iOS Video",videoAssist:"Video Assist",media:"Recording Media","accessories.cardReaders":"Card Reader",cardReaders:"Card Reader",lenses:"Lens",filterOptions:"Filter Option",other:"Other"},gearItems:{"Tennis ball":"Tennis ball","Clapper Stick":"Clapper Stick"}},DEFAULT_LANGUAGE$2="en",LOCALE_IMPORTS={de:()=>__vitePreload(()=>import("./de-C03m4Y6h.js"),[]),es:()=>__vitePreload(()=>import("./es-BFl1f0yX.js"),[]),fr:()=>__vitePreload(()=>import("./fr-gLkNwM_L.js"),[]),it:()=>__vitePreload(()=>import("./it-CnY_oOy7.js"),[])},loadedLocales=new Set(["en"]),scope$4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{};scope$4.texts=scope$4.texts||{};scope$4.categoryNames=scope$4.categoryNames||{};scope$4.gearItems=scope$4.gearItems||{};function cloneTranslationValue(e){if(Array.isArray(e))return e.map(t=>cloneTranslationValue(t));if(e&&typeof e=="object"){const t={};return Object.keys(e).forEach(o=>{t[o]=cloneTranslationValue(e[o])}),t}return e}function freezeTranslationTree(e,t=new WeakMap){if(!e||typeof e!="object"||t.has(e))return e;t.set(e,!0),Array.isArray(e)?e.forEach(o=>freezeTranslationTree(o,t)):Object.values(e).forEach(o=>freezeTranslationTree(o,t));try{Object.isFrozen(e)||Object.freeze(e)}catch{}return e}function alignTranslationValue(e,t){const o=Array.isArray(e)?"array":e===null?"null":typeof e,r=Array.isArray(t)?"array":t===null?"null":typeof t;if(o==="array"){if(r!=="array")return cloneTranslationValue(e);const n=e.length,a=new Array(n);for(let s=0;s<n;s++){const l=e[s],u=s<t.length?t[s]:void 0;a[s]=alignTranslationValue(l,u)}return a}if(o==="object"){if(r!=="object")return cloneTranslationValue(e);const n=t&&typeof t=="object"?t:{};return Object.keys(e||{}).forEach(s=>{const l=e[s],u=Object.prototype.hasOwnProperty.call(n,s)?n[s]:void 0;n[s]=alignTranslationValue(l,u)}),Object.keys(n).forEach(s=>{Object.prototype.hasOwnProperty.call(e,s)||delete n[s]}),n}return r===o&&typeof t<"u"?t:cloneTranslationValue(e)}function alignDataset(e,t){const o={};return Object.keys(e||{}).forEach(n=>{const a=e[n],s=t&&Object.prototype.hasOwnProperty.call(t,n)?t[n]:void 0;o[n]=alignTranslationValue(a,s)}),o}function registerLocaleData(e,t){if(!e||!t)return;const o=t.texts||{},r=t.categoryNames||{},n=t.gearItems||{};let a=scope$4.texts[DEFAULT_LANGUAGE$2]?{texts:scope$4.texts[DEFAULT_LANGUAGE$2],categoryNames:scope$4.categoryNames[DEFAULT_LANGUAGE$2],gearItems:scope$4.gearItems[DEFAULT_LANGUAGE$2]}:null;e===DEFAULT_LANGUAGE$2&&(freezeTranslationTree(o),freezeTranslationTree(r),freezeTranslationTree(n),a={texts:o,categoryNames:r,gearItems:n});const s=a||{texts:{},categoryNames:{},gearItems:{}},l=e===DEFAULT_LANGUAGE$2?s.texts:alignDataset(s.texts,o),u=e===DEFAULT_LANGUAGE$2?s.categoryNames:alignDataset(s.categoryNames,r),d=e===DEFAULT_LANGUAGE$2?s.gearItems:alignDataset(s.gearItems,n);scope$4.texts[e]=l,scope$4.categoryNames[e]=u,scope$4.gearItems[e]=d}function resolveLocaleKey(e){if(typeof e!="string")return DEFAULT_LANGUAGE$2;const t=e.trim();if(!t)return DEFAULT_LANGUAGE$2;const o=t.toLowerCase();if(LOCALE_IMPORTS[o])return o;const r=o.split("-")[0];return LOCALE_IMPORTS[r]?r:DEFAULT_LANGUAGE$2}async function loadLanguage(e){if(loadedLocales.has(e))return;const t=resolveLocaleKey(e);if(!(t===DEFAULT_LANGUAGE$2&&loadedLocales.has(DEFAULT_LANGUAGE$2))&&LOCALE_IMPORTS[t])try{const o=await LOCALE_IMPORTS[t]();registerLocaleData(t,o.data),loadedLocales.add(t),loadedLocales.add(e)}catch(o){console.error(`Failed to load locale: ${t}`,o)}}registerLocaleData(DEFAULT_LANGUAGE$2,data);loadedLocales.add(DEFAULT_LANGUAGE$2);scope$4.__cineTranslationsLoader__={loadLanguage};const translations$1={loadLanguage},cineTranslations=Object.freeze(Object.defineProperty({__proto__:null,default:translations$1,loadLanguage},Symbol.toStringTag,{value:"Module"})),CORE_GLOBAL_SCOPE$3=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{};function resolveRuntimeModuleLoader$2(){return typeof cineCoreRuntimeModuleLoader<"u"&&cineCoreRuntimeModuleLoader&&typeof cineCoreRuntimeModuleLoader=="object"?cineCoreRuntimeModuleLoader:typeof globalThis<"u"&&globalThis&&typeof globalThis.cineCoreRuntimeModuleLoader=="object"?globalThis.cineCoreRuntimeModuleLoader:typeof window<"u"&&window&&typeof window.cineCoreRuntimeModuleLoader=="object"?window.cineCoreRuntimeModuleLoader:typeof self<"u"&&self&&typeof self.cineCoreRuntimeModuleLoader=="object"?self.cineCoreRuntimeModuleLoader:typeof global<"u"&&global&&typeof global.cineCoreRuntimeModuleLoader=="object"?global.cineCoreRuntimeModuleLoader:null}function requireCoreRuntimeModule$2(e,t){const o=resolveRuntimeModuleLoader$2();if(o&&typeof o.resolveCoreRuntimeModule=="function")try{return o.resolveCoreRuntimeModule(e,t)}catch{}return null}const CORE_RUNTIME_SCOPE_TOOLS=(function(){const t="cineCoreRuntimeScopeTools";function o(a){if(!a||typeof a!="object"&&typeof a!="function")return null;try{const s=a[t];return s&&typeof s=="object"?s:null}catch{}return null}const r=[(function(){try{return typeof CORE_GLOBAL_SCOPE$3=="object"&&CORE_GLOBAL_SCOPE$3?CORE_GLOBAL_SCOPE$3:null}catch{}return null})(),typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let a=0;a<r.length;a+=1){const s=o(r[a]);if(s)return s}const n=requireCoreRuntimeModule$2("modules/core/runtime-scope-tools.js");if(n&&typeof n=="object")return n;for(let a=0;a<r.length;a+=1){const s=o(r[a]);if(s)return s}return null})();function inlineResolvePrimaryScopeCandidate(){try{if(typeof CORE_GLOBAL_SCOPE$3=="object"&&CORE_GLOBAL_SCOPE$3)return CORE_GLOBAL_SCOPE$3}catch{}try{if(typeof globalThis<"u"&&globalThis&&typeof globalThis.CORE_GLOBAL_SCOPE=="object"&&globalThis.CORE_GLOBAL_SCOPE)return globalThis.CORE_GLOBAL_SCOPE}catch{}return null}var CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2=CORE_RUNTIME_SCOPE_TOOLS&&typeof CORE_RUNTIME_SCOPE_TOOLS.getPrimaryScopeCandidate=="function"?CORE_RUNTIME_SCOPE_TOOLS.getPrimaryScopeCandidate():inlineResolvePrimaryScopeCandidate(),collectRuntimeScopeCandidates$1=CORE_RUNTIME_SCOPE_TOOLS&&typeof CORE_RUNTIME_SCOPE_TOOLS.getScopeCandidates=="function"?function(t=[]){return CORE_RUNTIME_SCOPE_TOOLS.getScopeCandidates({primaryCandidate:CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2,extraCandidates:t})}:function(t=[]){const o=[CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2,inlineResolvePrimaryScopeCandidate(),typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null],r=Array.isArray(t)?t:[t];for(let a=0;a<r.length;a+=1)o.push(r[a]);const n=[];for(let a=0;a<o.length;a+=1){const s=o[a];if(!s||typeof s!="object"&&typeof s!="function")continue;let l=!1;for(let u=0;u<n.length;u+=1)if(n[u]===s){l=!0;break}l||n.push(s)}return n};typeof window<"u"&&(window.collectRuntimeScopeCandidates=collectRuntimeScopeCandidates$1,window.CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE=CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2);function resolveCoreDeviceSchemaNamespace(){if(typeof collectRuntimeScopeCandidates$1!="function")return null;const e=collectRuntimeScopeCandidates$1();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function")){try{if(o.CORE_DEVICE_SCHEMA&&typeof o.CORE_DEVICE_SCHEMA=="object")return o.CORE_DEVICE_SCHEMA}catch{}try{if(o.cineCoreDeviceSchema&&typeof o.cineCoreDeviceSchema=="object")return o.cineCoreDeviceSchema}catch{}}}return null}resolveCoreDeviceSchemaNamespace();function resolveRuntimeModuleLoader$1(){function e(o){if(!o||typeof o!="object"&&typeof o!="function")return null;try{const r=o.cineCoreRuntimeModuleLoader;return r&&typeof r=="object"?r:null}catch{}return null}if(typeof cineCoreRuntimeModuleLoader<"u"&&cineCoreRuntimeModuleLoader&&typeof cineCoreRuntimeModuleLoader=="object")return cineCoreRuntimeModuleLoader;if(typeof collectRuntimeScopeCandidates$1!="function")return null;const t=collectRuntimeScopeCandidates$1();for(let o=0;o<t.length;o+=1){const r=e(t[o]);if(r)return r}for(let o=0;o<t.length;o+=1){const r=e(t[o]);if(r)return r}return null}function requireCoreRuntimeModule$1(e,t){const o=resolveRuntimeModuleLoader$1();if(o&&typeof o.resolveCoreRuntimeModule=="function")try{const r=o.resolveCoreRuntimeModule(e,t);return r}catch{}return null}const CORE_RUNTIME_SUPPORT_BOOTSTRAP=(function(){const t="cineCoreRuntimeSupportBootstrap";function o(n){if(!n||typeof n!="object"&&typeof n!="function")return null;try{const a=n[t];return a&&typeof a=="object"?a:null}catch{}return null}if(typeof collectRuntimeScopeCandidates$1!="function")return[];const r=collectRuntimeScopeCandidates$1();for(let n=0;n<r.length;n+=1){const a=o(r[n]);if(a)return a}for(let n=0;n<r.length;n+=1){const a=o(r[n]);if(a)return a}return null})(),CORE_RUNTIME_SUPPORT_RESOLUTION=(function(){const t="cineCoreRuntimeSupportResolution";function o(n){if(!n||typeof n!="object"&&typeof n!="function")return null;try{const a=n[t];return a&&typeof a=="object"?a:null}catch{}return null}const r=typeof collectRuntimeScopeCandidates$1=="function"?collectRuntimeScopeCandidates$1():[];for(let n=0;n<r.length;n+=1){const a=o(r[n]);if(a)return a}for(let n=0;n<r.length;n+=1){const a=o(r[n]);if(a)return a}return null})(),CORE_TEXT_ENTRY_TOOLS=(function(){const t="cineCoreTextEntries";if(typeof cineCoreTextEntries<"u"&&cineCoreTextEntries&&typeof cineCoreTextEntries=="object")return cineCoreTextEntries;const o=typeof collectRuntimeScopeCandidates$1=="function"?collectRuntimeScopeCandidates$1():[];for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function"))try{const a=n[t];if(a&&typeof a=="object")return a}catch{}}return null})(),CORE_TEXT_ENTRY_SEPARATOR=CORE_TEXT_ENTRY_TOOLS&&typeof CORE_TEXT_ENTRY_TOOLS.TEXT_ENTRY_SEPARATOR=="string"&&CORE_TEXT_ENTRY_TOOLS.TEXT_ENTRY_SEPARATOR?CORE_TEXT_ENTRY_TOOLS.TEXT_ENTRY_SEPARATOR:`
`;function inlineNormaliseTextEntryValue(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"){try{return String(e)}catch{}return""}if(Array.isArray(e)){const t=[];for(let o=0;o<e.length;o+=1){const r=inlineNormaliseTextEntryValue(e[o]);r&&t.push(r)}return t.join(CORE_TEXT_ENTRY_SEPARATOR)}if(e&&typeof e=="object"){if(typeof e.text=="string")return e.text;if(Array.isArray(e.text))return inlineNormaliseTextEntryValue(e.text);if(typeof e.label=="string")return e.label;try{const t=String(e);if(t&&t!=="[object Object]")return t}catch{}}return""}function inlineResolveTextEntry(e,t,o,r=""){const n=typeof r=="string"?r:"",a=[];e&&(typeof e=="object"||typeof e=="function")&&a.push(e),t&&t!==e&&(typeof t=="object"||typeof t=="function")&&a.push(t);for(let s=0;s<a.length;s+=1){const l=a[s];let u;try{u=l[o]}catch{u=void 0}if(typeof u>"u"||u===null)continue;const d=inlineNormaliseTextEntryValue(u);if(typeof d=="string")return d}return n}CORE_TEXT_ENTRY_TOOLS&&CORE_TEXT_ENTRY_TOOLS.normaliseTextEntryValue;const resolveTextEntryRuntime=CORE_TEXT_ENTRY_TOOLS&&typeof CORE_TEXT_ENTRY_TOOLS.resolveTextEntry=="function"?function(t,o,r,n=""){return CORE_TEXT_ENTRY_TOOLS.resolveTextEntry(t,o,r,n,CORE_TEXT_ENTRY_SEPARATOR)}:inlineResolveTextEntry,resolveTextEntryInternal$1=(function(t){const o=[CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2,typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function"))try{if(typeof n.resolveTextEntry=="function")return n.resolveTextEntry}catch{}}try{if(typeof resolveTextEntry=="function")return resolveTextEntry}catch{}for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function"))try{if(n.resolveTextEntry=t,typeof n.resolveTextEntry=="function")return n.resolveTextEntry}catch{}}return t})(resolveTextEntryRuntime);(function(t){if(typeof t=="function"){if(typeof globalThis<"u"&&typeof globalThis.resolveTextEntryInternal!="function")try{globalThis.resolveTextEntryInternal=t}catch{}if(typeof window<"u"&&typeof window.resolveTextEntryInternal!="function")try{window.resolveTextEntryInternal=t}catch{}}})(resolveTextEntryInternal$1);const CORE_TEMPERATURE_STORAGE_KEY_FALLBACK="cameraPowerPlanner_temperatureUnit";function resolvePreferredTemperatureStorageKey(){const e=typeof collectRuntimeScopeCandidates$1=="function"?collectRuntimeScopeCandidates$1():[];for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function")){if(typeof o.TEMPERATURE_STORAGE_KEY=="string"&&o.TEMPERATURE_STORAGE_KEY)return o.TEMPERATURE_STORAGE_KEY;if(typeof o.TEMPERATURE_UNIT_STORAGE_KEY=="string"&&o.TEMPERATURE_UNIT_STORAGE_KEY)return o.TEMPERATURE_UNIT_STORAGE_KEY;if(o.CORE_SHARED&&typeof o.CORE_SHARED=="object"&&typeof o.CORE_SHARED.TEMPERATURE_STORAGE_KEY=="string"&&o.CORE_SHARED.TEMPERATURE_STORAGE_KEY)return o.CORE_SHARED.TEMPERATURE_STORAGE_KEY;if(o.__cineStorageApi&&typeof o.__cineStorageApi=="object"){const r=o.__cineStorageApi;if(typeof r.TEMPERATURE_STORAGE_KEY=="string"&&r.TEMPERATURE_STORAGE_KEY)return r.TEMPERATURE_STORAGE_KEY;if(typeof r.getTemperaturePreferenceStorageKey=="function")try{const n=r.getTemperaturePreferenceStorageKey();if(typeof n=="string"&&n)return n}catch{}}if(typeof o.resolveTemperatureStorageKey=="function")try{const r=o.resolveTemperatureStorageKey();if(typeof r=="string"&&r)return r}catch{}}}return CORE_TEMPERATURE_STORAGE_KEY_FALLBACK}const PREEXISTING_TEMPERATURE_STORAGE_KEY=typeof TEMPERATURE_STORAGE_KEY=="string"&&TEMPERATURE_STORAGE_KEY?TEMPERATURE_STORAGE_KEY:null,CORE_TEMPERATURE_STORAGE_KEY$1=PREEXISTING_TEMPERATURE_STORAGE_KEY||resolvePreferredTemperatureStorageKey();(function(t){const o=[CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null];for(let n=0;n<o.length;n+=1){const a=o[n];if(!(!a||typeof a!="object"&&typeof a!="function")&&!(typeof a.TEMPERATURE_STORAGE_KEY=="string"&&a.TEMPERATURE_STORAGE_KEY))try{a.TEMPERATURE_STORAGE_KEY=t}catch{}}const r=o.map(n=>{if(!n||typeof n!="object"&&typeof n!="function")return null;try{return n.CORE_SHARED&&typeof n.CORE_SHARED=="object"?n.CORE_SHARED:null}catch{}return null}).filter(n=>n);for(let n=0;n<r.length;n+=1){const a=r[n];if(!(!a||typeof a!="object")&&!(typeof a.TEMPERATURE_STORAGE_KEY=="string"&&a.TEMPERATURE_STORAGE_KEY))try{a.TEMPERATURE_STORAGE_KEY=t}catch{}}})(CORE_TEMPERATURE_STORAGE_KEY$1);(function(){const t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(!t.enqueueCoreBootTask&&typeof enqueueCoreBootTask=="function"&&(t.enqueueCoreBootTask=enqueueCoreBootTask),!t.setGridSnapState&&typeof setGridSnapState=="function"&&(t.setGridSnapState=setGridSnapState),!t.getGridSnapState&&typeof getGridSnapState=="function"&&(t.getGridSnapState=getGridSnapState))})();const CORE_RUNTIME_SUPPORT_DEFAULTS_NAMESPACE=(function(){const t="cineCoreRuntimeSupportDefaults";function o(n){if(!n||typeof n!="object"&&typeof n!="function")return null;try{const a=n[t];return a&&typeof a=="object"?a:null}catch{}return null}const r=typeof collectRuntimeScopeCandidates$1=="function"?collectRuntimeScopeCandidates$1():[];for(let n=0;n<r.length;n+=1){const a=o(r[n]);if(a)return a}for(let n=0;n<r.length;n+=1){const a=o(r[n]);if(a)return a}return null})();function createInlineRuntimeSupportDefaults(){function e(o){if(o&&(typeof o=="object"||typeof o=="function"))return o;const r=typeof collectRuntimeScopeCandidates$1=="function"?collectRuntimeScopeCandidates$1():[];for(let n=0;n<r.length;n+=1){const a=r[n];if(a&&(typeof a=="object"||typeof a=="function"))return a}return null}function t(o,r,n){if(typeof o!="string"||!o)return null;const a=e(n);if(a&&a[o]&&typeof a[o]=="object")return a[o];if(typeof require=="function"&&typeof r=="string"&&r)try{const s=require(r);if(s&&typeof s=="object")return s}catch{}return null}return{fallbackDetectRuntimeScope:e,fallbackResolveCoreSupportModule:t,readRuntimeSupportResolver:function(){return Object.freeze({detectRuntimeScope:e,resolveCoreSupportModule:t})}}}const CORE_RUNTIME_SUPPORT_RESOLUTION_DEFAULTS=CORE_RUNTIME_SUPPORT_DEFAULTS_NAMESPACE&&typeof CORE_RUNTIME_SUPPORT_DEFAULTS_NAMESPACE.fallbackDetectRuntimeScope=="function"&&typeof CORE_RUNTIME_SUPPORT_DEFAULTS_NAMESPACE.fallbackResolveCoreSupportModule=="function"&&typeof CORE_RUNTIME_SUPPORT_DEFAULTS_NAMESPACE.readRuntimeSupportResolver=="function"?CORE_RUNTIME_SUPPORT_DEFAULTS_NAMESPACE:createInlineRuntimeSupportDefaults(),CORE_RUNTIME_SUPPORT_RESOLUTION_TOOLS=(function(){if(CORE_RUNTIME_SUPPORT_RESOLUTION&&typeof CORE_RUNTIME_SUPPORT_RESOLUTION.readRuntimeSupportResolver=="function")try{return CORE_RUNTIME_SUPPORT_RESOLUTION.readRuntimeSupportResolver(CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2)}catch{}try{return CORE_RUNTIME_SUPPORT_RESOLUTION_DEFAULTS.readRuntimeSupportResolver(CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2)}catch{}return null})(),CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS=CORE_RUNTIME_SUPPORT_BOOTSTRAP&&typeof CORE_RUNTIME_SUPPORT_BOOTSTRAP.resolveBootstrap=="function"?CORE_RUNTIME_SUPPORT_BOOTSTRAP.resolveBootstrap(CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2):null,CORE_RUNTIME_SUPPORT_FALLBACK_TOOLS=!CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&CORE_RUNTIME_SUPPORT_BOOTSTRAP&&typeof CORE_RUNTIME_SUPPORT_BOOTSTRAP.readRuntimeSupportTools=="function"?CORE_RUNTIME_SUPPORT_BOOTSTRAP.readRuntimeSupportTools(CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2):null,fallbackDetectRuntimeScope=CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.fallbackDetectRuntimeScope=="function"&&CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.fallbackDetectRuntimeScope||CORE_RUNTIME_SUPPORT_FALLBACK_TOOLS&&typeof CORE_RUNTIME_SUPPORT_FALLBACK_TOOLS.fallbackDetectRuntimeScope=="function"&&CORE_RUNTIME_SUPPORT_FALLBACK_TOOLS.fallbackDetectRuntimeScope||CORE_RUNTIME_SUPPORT_RESOLUTION_TOOLS&&typeof CORE_RUNTIME_SUPPORT_RESOLUTION_TOOLS.detectRuntimeScope=="function"&&CORE_RUNTIME_SUPPORT_RESOLUTION_TOOLS.detectRuntimeScope||CORE_RUNTIME_SUPPORT_RESOLUTION_DEFAULTS.fallbackDetectRuntimeScope,detectRuntimeScope=CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.detectRuntimeScope=="function"&&CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.detectRuntimeScope||fallbackDetectRuntimeScope,fallbackResolveCoreSupportModule=CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.fallbackResolveCoreSupportModule=="function"&&CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.fallbackResolveCoreSupportModule||CORE_RUNTIME_SUPPORT_FALLBACK_TOOLS&&typeof CORE_RUNTIME_SUPPORT_FALLBACK_TOOLS.fallbackResolveCoreSupportModule=="function"&&CORE_RUNTIME_SUPPORT_FALLBACK_TOOLS.fallbackResolveCoreSupportModule||CORE_RUNTIME_SUPPORT_RESOLUTION_TOOLS&&typeof CORE_RUNTIME_SUPPORT_RESOLUTION_TOOLS.resolveCoreSupportModule=="function"&&CORE_RUNTIME_SUPPORT_RESOLUTION_TOOLS.resolveCoreSupportModule||CORE_RUNTIME_SUPPORT_RESOLUTION_DEFAULTS.fallbackResolveCoreSupportModule;var CORE_PART1_RUNTIME_SCOPE$2=CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.runtimeScope?CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.runtimeScope:detectRuntimeScope(CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$2);const resolveCoreSupportModule$1=CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule=="function"?function(t,o){return CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule(t,o,CORE_PART1_RUNTIME_SCOPE$2)}:function(t,o){return fallbackResolveCoreSupportModule(t,o,CORE_PART1_RUNTIME_SCOPE$2)};(function(){const t="cineCoreRuntimeSupportExports";function o(s){if(!s||typeof s!="object"&&typeof s!="function")return null;try{const l=s[t];return l&&typeof l=="object"?l:null}catch{}return null}const r=typeof collectRuntimeScopeCandidates$1=="function"?collectRuntimeScopeCandidates$1([typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null]):[typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null];let n=null;for(let s=0;s<r.length;s+=1){const l=o(r[s]);if(l){n=l;break}}if(!n||typeof n!="object")n={};else{const s=typeof Object.isExtensible=="function"?Object.isExtensible(n):!0,l=typeof Object.isSealed=="function"&&Object.isSealed(n);(!s||l)&&(n=Object.assign({},n))}function a(s,l,u){if(!(!s||typeof s!="object")){try{if(s[l]=u,s[l]===u)return}catch{}try{Object.defineProperty(s,l,{configurable:!0,writable:!0,value:u})}catch{}}}a(n,"resolveRuntimeModuleLoader",resolveRuntimeModuleLoader$1),a(n,"requireCoreRuntimeModule",requireCoreRuntimeModule$1);for(let s=0;s<r.length;s+=1){const l=r[s];if(!(!l||typeof l!="object"&&typeof l!="function"))try{l[t]=n}catch{}}if(typeof module=="object"&&module&&typeof module.exports=="object")try{module.exports=n}catch{}return n})();const PINK_MODE_SUPPORT_LOADER_TOOLS=resolveCoreSupportModule$1("cineCoreAppPinkModeSupportLoader","./modules/app-core/pink-mode.js"),PINK_MODE_SUPPORT_API_TOOLS=resolveCoreSupportModule$1("cineCoreAppPinkModeSupportApi","./modules/app-core/pink-mode.js"),PINK_MODE_SUPPORT_RESOLVER_TOOLS=resolveCoreSupportModule$1("cineCoreAppPinkModeSupportResolver","./modules/app-core/pink-mode.js"),PINK_MODE_SUPPORT_API$1=(function(){const t=typeof require=="function"?require:null;function o(){if(PINK_MODE_SUPPORT_RESOLVER_TOOLS&&typeof PINK_MODE_SUPPORT_RESOLVER_TOOLS.createPinkModeSupportLastResortApi=="function")try{const _=PINK_MODE_SUPPORT_RESOLVER_TOOLS.createPinkModeSupportLastResortApi();if(_&&typeof _=="object")return _}catch{}if(typeof t=="function")try{const _=t("./modules/app-core/pink-mode.js");if(_&&typeof _.createPinkModeSupportLastResortApi=="function"){const G=_.createPinkModeSupportLastResortApi();if(G&&typeof G=="object")return G}}catch{}const s='<svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="m1 40c0-8 3-17 3-17a4.84 4.84 0 0 0-1.829-3.064 1 1 0 0 1 .45-1.716 19.438 19.438 0 0 1 4.379-.22c.579-2.317-1.19-3.963-2.782-4.938a1 1 0 0 1 .393-1.85 14.128 14.128 0 0 1 6.389.788c0-.958-1.147-2.145-2.342-3.122a1 1 0 0 1 .708-1.773 40.655 40.655 0 0 1 6.634.895 3.723 3.723 0 0 0-1.049-2.264 1 1 0 0 1 .823-1.652c6.151.378 9.226 1.916 9.226 1.916l10-1s8.472-2.311 15.954.5a1 1 0 0 1-.084 1.9c-1.455.394-2.87 1.143-2.87 2.6 0 0 4.426.738 5.675 4.114a1 1 0 0 1-1.228 1.317c-1.64-.48-4.273-.88-6.447.569Z" fill="#805333" /><path d="m30.18 42.82c1.073 2.7 2.6 9.993 3.357 13.8a2 2 0 0 1-1.964 2.38h-28.573a2 2 0 0 1-2-2v-18c0-2.55 10.03-22.11 23.99-23.87Z" fill="#a56a43" /><path d="m55.67 48.46-6.34 2.97a6 6 0 0 1-7.98-2.88l-.25-.54-.76-1.6a4.956 4.956 0 0 0-4.68-2.87c-.22.01-.44.02-.66.02a16.019 16.019 0 0 1-8.28-29.66c-1.81-2.97-3.45-8.03 2.03-12.49a2.1 2.1 0 0 1 2.5 0c4.23 3.45 4.21 7.25 3.16 10.17a16 16 0 0 1 15.91 11.36l5.31 11.31 2.92 6.22a6.008 6.008 0 0 1-2.88 7.99Z" fill="#cb8252" /><circle cx="42" cy="26" r="3" fill="#2c2f38" /><circle cx="54" cy="43" r="1" fill="#805333" /><path d="m58.55 40.47-2.92-6.22-14.53 13.76.25.54a6 6 0 0 0 7.98 2.88l6.34-2.97a6.008 6.008 0 0 0 2.88-7.99Zm-4.55 3.53a1 1 0 1 1 1-1 1 1 0 0 1-1 1Z" fill="#cf976a" /><circle cx="41" cy="25" r="1.25" fill="#ecf0f1" /></svg>',u=s.replace("</svg>",'<path d="M44 19 L56 5 L49 22 Z" fill="#ffd700" />'+"</svg>"),d=u.replace(/#805333/g,"#d63384").replace(/#a56a43/g,"#e83e8c").replace(/#cb8252/g,"#fd7e14").replace(/#cf976a/g,"#ffc0cb"),m=u.replace(/#805333/g,"#6f42c1").replace(/#a56a43/g,"#d63384").replace(/#cb8252/g,"#e83e8c").replace(/#cf976a/g,"#e0cffc"),y=u.replace(/#805333/g,"#0dcaf0").replace(/#a56a43/g,"#6f42c1").replace(/#cb8252/g,"#d63384").replace(/#cf976a/g,"#9ec5fe"),h=[{className:"icon-svg pink-mode-icon",markup:d,lottiePath:"src/animations/unicorn.json"},{className:"icon-svg pink-mode-icon",markup:m,lottiePath:"src/animations/horn.json"},{className:"icon-svg pink-mode-icon",markup:y,lottiePath:"src/animations/rainbow.json"}],b=Object.freeze({off:Object.freeze({className:"icon-svg pink-mode-icon",markup:s}),onSequence:Object.freeze(h)});function v(_){if(typeof Promise<"u"&&typeof Promise.resolve=="function")return Promise.resolve(_);const G={then(O){if(typeof O=="function")try{return v(O(_))}catch{}return G},catch(){return G}};return G}function C(){}function A(_){return _}const w=Object.freeze({pinkModeIcons:b,ensureSvgHasAriaHidden:A,setPinkModeIconSequence:C,loadPinkModeIconsFromFiles(){return v(b)},ensurePinkModeLottieRuntime(){const _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:global;return _&&_.lottie?v(_.lottie):_&&_.bodymovin?v(_.bodymovin):typeof document>"u"?v(null):document.querySelector('script[data-loader="pink-mode-lottie"]')?new Promise(G=>{const O=document.querySelector('script[data-loader="pink-mode-lottie"]');O.dataset.loaded==="true"?G(_.lottie):O.addEventListener("load",()=>G(_.lottie),{once:!0})}):new Promise(G=>{const O=document.createElement("script");O.src="src/vendor/lottie.min.js",O.async=!0,O.setAttribute("data-loader","pink-mode-lottie"),O.onload=()=>{O.dataset.loaded="true",G(_.lottie)},O.onerror=()=>{G(null)},document.head.appendChild(O)})},resolvePinkModeLottieRuntime(){const _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:global,G=_&&(_.lottie||_.bodymovin)||null;return v(G)},startPinkModeAnimatedIcons:C,stopPinkModeAnimatedIcons:C,triggerPinkModeIconRain:C,getPinkModeIconRotationTimer:C,setPinkModeIconRotationTimer:C,getPinkModeIconIndex:C,setPinkModeIconIndex:C,PINK_MODE_ICON_INTERVAL_MS:1500,PINK_MODE_ICON_ANIMATION_CLASS:"pink-mode-icon-animation",PINK_MODE_ICON_ANIMATION_RESET_DELAY:400,PINK_MODE_ICON_FALLBACK_MARKUP:s}),R=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global;if(R&&typeof R=="object")try{R.cineCorePinkModeSupport||(R.cineCorePinkModeSupport=w),R.pinkModeIcons||(R.pinkModeIcons=w.pinkModeIcons),R.startPinkModeAnimatedIcons||(R.startPinkModeAnimatedIcons=w.startPinkModeAnimatedIcons)}catch{}return w}const r={loaderTools:PINK_MODE_SUPPORT_LOADER_TOOLS,apiTools:PINK_MODE_SUPPORT_API_TOOLS,resolveCoreSupportModule:resolveCoreSupportModule$1,requireFn:t,runtimeScope:typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,coreGlobalScope:typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,fallbackScopes:[typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null],loaderPath:"./modules/app-core/pink-mode.js",apiRequirePath:"./modules/app-core/pink-mode.js",lastResortFactory:o};function n(s){if(!s||typeof s!="object")return null;const l=typeof s.resolvePinkModeSupportApi=="function"?s.resolvePinkModeSupportApi:null;if(!l)return null;try{const u=l(r);return u&&typeof u=="object"?u:null}catch{}return null}let a=n(PINK_MODE_SUPPORT_RESOLVER_TOOLS);if(!a&&typeof t=="function")try{const s=t("./modules/app-core/pink-mode.js");a=n(s)}catch{}if(!a){const s=[typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let l=0;l<s.length;l+=1){const u=s[l];if(!(!u||typeof u!="object")){try{const d=u.cineCoreAppPinkModeSupportResolver;a=n(d)}catch{}if(a)break}}}return(!a||typeof a!="object")&&(a=o()),a})();typeof module<"u"&&module.exports&&(module.exports={PINK_MODE_SUPPORT_API:PINK_MODE_SUPPORT_API$1});typeof globalThis<"u"?globalThis.PINK_MODE_SUPPORT_API=PINK_MODE_SUPPORT_API$1:typeof window<"u"?window.PINK_MODE_SUPPORT_API=PINK_MODE_SUPPORT_API$1:typeof self<"u"?self.PINK_MODE_SUPPORT_API=PINK_MODE_SUPPORT_API$1:typeof global<"u"&&(global.PINK_MODE_SUPPORT_API=PINK_MODE_SUPPORT_API$1);var AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS$1={focus:"autoGearDefaultFocusMonitorLabel",handheld7:"autoGearDefaultHandheldMonitorLabel",combo15:"autoGearDefaultComboMonitorLabel",director15:"autoGearDefaultDirectorMonitorLabel"};function resolveAutoGearConditionKeys(){if(typeof AUTO_GEAR_CONDITION_KEYS<"u"&&Array.isArray(AUTO_GEAR_CONDITION_KEYS))return AUTO_GEAR_CONDITION_KEYS;var e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,t=e&&typeof e.AUTO_GEAR_UI_HELPERS=="object"&&e.AUTO_GEAR_UI_HELPERS?e.AUTO_GEAR_UI_HELPERS:null;if(t){if(Array.isArray(t.AUTO_GEAR_CONDITION_KEYS))return t.AUTO_GEAR_CONDITION_KEYS;if(t.autoGearConditionSelects&&typeof t.autoGearConditionSelects=="object")return Object.keys(t.autoGearConditionSelects)}return[]}var createDeferredAutoGearRefresher$1=function(e){return function(t){return callCoreFunctionIfAvailable(e,[t],{defer:!0})}};function focusAutoGearConditionPicker$1(){if(autoGearConditionSelect)try{autoGearConditionSelect.focus({preventScroll:!0})}catch{autoGearConditionSelect.focus()}}function configureAutoGearConditionButtons$1(){var e,t,o,r,n=((e=texts[currentLang])===null||e===void 0?void 0:e.autoGearConditionAddShortcut)||((t=texts.en)===null||t===void 0?void 0:t.autoGearConditionAddShortcut)||"Add another condition",a=((o=texts[currentLang])===null||o===void 0?void 0:o.autoGearConditionRemove)||((r=texts.en)===null||r===void 0?void 0:r.autoGearConditionRemove)||"Remove this condition",s=resolveAutoGearConditionKeys();s.length&&s.forEach(function(l){var u=getAutoGearConditionConfig(l);u&&(u.addShortcut&&(setButtonLabelWithIconBinding(u.addShortcut,"",ICON_GLYPHS.add),u.addShortcut.setAttribute("aria-label",n),u.addShortcut.setAttribute("title",n),u.addShortcut.setAttribute("data-help",n)),u.removeButton&&(setButtonLabelWithIconBinding(u.removeButton,"",ICON_GLYPHS.minus),u.removeButton.setAttribute("aria-label",a),u.removeButton.setAttribute("title",a),u.removeButton.setAttribute("data-help",a)))})}var AUTO_GEAR_UI_EXPORTS_BRIDGE={createDeferredAutoGearRefresher:createDeferredAutoGearRefresher$1,focusAutoGearConditionPicker:focusAutoGearConditionPicker$1,configureAutoGearConditionButtons:configureAutoGearConditionButtons$1,AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS:AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS$1};typeof module<"u"&&module.exports&&(module.exports=AUTO_GEAR_UI_EXPORTS_BRIDGE);if(typeof globalThis<"u"){var target$4=typeof globalThis.AUTO_GEAR_UI_HELPERS=="object"&&globalThis.AUTO_GEAR_UI_HELPERS?globalThis.AUTO_GEAR_UI_HELPERS:globalThis.AUTO_GEAR_UI_HELPERS={};Object.assign(target$4,AUTO_GEAR_UI_EXPORTS_BRIDGE),globalThis.AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS=AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS$1}var AUTO_GEAR_NORMALIZER_SCOPE=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},stableStringify$2=(function(){for(var e=[AUTO_GEAR_NORMALIZER_SCOPE,AUTO_GEAR_NORMALIZER_SCOPE&&AUTO_GEAR_NORMALIZER_SCOPE.global,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=0;t<e.length;t+=1){var o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function")){if(typeof o.stableStringify=="function")return o.stableStringify;if(o.cineCoreShared&&typeof o.cineCoreShared.stableStringify=="function")return o.cineCoreShared.stableStringify}}for(var r=function(n){if(n===null)return"null";if(n===void 0)return"undefined";if(Array.isArray(n)){for(var a="[",s=0;s<n.length;s+=1)s>0&&(a+=","),a+=r(n[s]);return a+="]",a}if(typeof n=="object"){for(var l=Object.keys(n).sort(),a="{",u=0;u<l.length;u+=1){var d=l[u];u>0&&(a+=","),a+="".concat(JSON.stringify(d),":").concat(r(n[d]))}return a+="}",a}return JSON.stringify(n)},t=0;t<e.length;t+=1){var o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function")&&typeof o.stableStringify!="function")try{o.stableStringify=r}catch{try{Object.defineProperty(o,"stableStringify",{configurable:!0,enumerable:!1,writable:!0,value:r})}catch{}}}return r})();function resolveAutoGearDefaultLanguageSource(){for(var e=[AUTO_GEAR_NORMALIZER_SCOPE,AUTO_GEAR_NORMALIZER_SCOPE&&AUTO_GEAR_NORMALIZER_SCOPE.global,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=0;t<e.length;t+=1){var o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function")){if(typeof o.DEFAULT_LANGUAGE_SAFE=="string"&&o.DEFAULT_LANGUAGE_SAFE)return o.DEFAULT_LANGUAGE_SAFE;if(typeof o.CPP_DEFAULT_LANGUAGE_SAFE=="string"&&o.CPP_DEFAULT_LANGUAGE_SAFE)return o.CPP_DEFAULT_LANGUAGE_SAFE;if(o.cineCoreShared&&typeof o.cineCoreShared.DEFAULT_LANGUAGE_SAFE=="string"&&o.cineCoreShared.DEFAULT_LANGUAGE_SAFE)return o.cineCoreShared.DEFAULT_LANGUAGE_SAFE}}return null}function getAutoGearFallbackLanguage(){var e=resolveAutoGearDefaultLanguageSource();return e||(typeof navigator<"u"&&typeof navigator.language=="string"&&navigator.language?navigator.language.slice(0,2).toLowerCase():"en")}function assignAutoGearLanguageFallback(e,t){if(!(!e||typeof e!="object"&&typeof e!="function")){var o=function(r){if(typeof e[r]!="string"||!e[r])try{e[r]=t}catch{try{Object.defineProperty(e,r,{configurable:!0,enumerable:!1,writable:!0,value:t})}catch{}}};o("DEFAULT_LANGUAGE_SAFE"),o("CPP_DEFAULT_LANGUAGE_SAFE")}}function ensureAutoGearDefaultLanguageGlobals(){var e=getAutoGearFallbackLanguage(),t=[AUTO_GEAR_NORMALIZER_SCOPE,AUTO_GEAR_NORMALIZER_SCOPE&&AUTO_GEAR_NORMALIZER_SCOPE.global,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];t.forEach(function(o){!o||typeof o!="object"&&typeof o!="function"||(assignAutoGearLanguageFallback(o,e),o.cineCoreShared&&typeof o.cineCoreShared=="object"&&assignAutoGearLanguageFallback(o.cineCoreShared,e))})}ensureAutoGearDefaultLanguageGlobals();function getAutoGearFallbackTexts(){var e=getAutoGearFallbackLanguage();try{var t=getLanguageTexts(e);if(t&&typeof t=="object")return t}catch{}return{}}var AUTO_GEAR_DEFAULT_SELECTOR_TYPES=Object.freeze(["none","monitor","directorMonitor","tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader","fizHandUnit"]);function ensureAutoGearSelectorTypeGlobals(e){var t=e&&e.AUTO_GEAR_SELECTOR_TYPE_MAP&&typeof e.AUTO_GEAR_SELECTOR_TYPE_MAP=="object"?e.AUTO_GEAR_SELECTOR_TYPE_MAP:null,o=t&&Object.keys(t).length?t:AUTO_GEAR_DEFAULT_SELECTOR_TYPES.reduce(function(a,s){return a[s.toLowerCase()]=s,a},Object.create(null)),r=e&&e.AUTO_GEAR_SELECTOR_TYPE_SET instanceof Set?e.AUTO_GEAR_SELECTOR_TYPE_SET:null,n=r&&r.size?r:new Set(Object.keys(o));return e&&typeof e=="object"&&(e.AUTO_GEAR_SELECTOR_TYPE_MAP||(e.AUTO_GEAR_SELECTOR_TYPE_MAP=o),e.AUTO_GEAR_SELECTOR_TYPE_SET||(e.AUTO_GEAR_SELECTOR_TYPE_SET=n)),{map:o,set:n}}var AUTO_GEAR_SELECTOR_TYPE_GLOBALS=ensureAutoGearSelectorTypeGlobals(AUTO_GEAR_NORMALIZER_SCOPE),AUTO_GEAR_SELECTOR_TYPE_MAP_FALLBACK=AUTO_GEAR_SELECTOR_TYPE_GLOBALS.map,AUTO_GEAR_SELECTOR_TYPE_SET_FALLBACK=AUTO_GEAR_SELECTOR_TYPE_GLOBALS.set;function generateAutoGearId$1(e){var t=e||"rule";return typeof crypto<"u"&&crypto.randomUUID?"".concat(t,"-").concat(crypto.randomUUID()):"".concat(t,"-").concat(Math.random().toString(36).slice(2),"-").concat(Date.now())}function normalizeAutoGearQuantity$1(e){var t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:1}function parseAutoGearDraftNames(e){if(typeof e!="string")return[];var t=e.trim();if(!t)return[];var o=/[;\n\r]/.test(t),r=o?t.split(/[;\n\r]+/):[t];return r.map(function(n){var a=n.trim();if(!a)return null;var s=a.match(/^([+-])\s*(.+)$/),l=s?s[1]==="-"?"remove":"add":null,u=s?s[2].trim():a;if(!u)return null;var d=u.match(/^(\d+)\s*[x×]\s*(.+)$/i);if(d){var m=d[2].trim();return m?{name:m,quantity:normalizeAutoGearQuantity$1(d[1]),listType:l}:null}return{name:u,listType:l}}).filter(Boolean)}function normalizeAutoGearText$1(e,t){var o=t===void 0?{}:t,r=o.collapseWhitespace,n=r===void 0?!0:r;if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e!="string")return"";var a=e.trim();return n?a.replace(/\s+/g," "):a}function normalizeAutoGearSelectorType$1(e){var t=typeof e=="string"?e.trim().toLowerCase():"";if(!t)return"none";var o=typeof AUTO_GEAR_SELECTOR_TYPE_SET<"u"&&AUTO_GEAR_SELECTOR_TYPE_SET||AUTO_GEAR_SELECTOR_TYPE_SET_FALLBACK,r=typeof AUTO_GEAR_SELECTOR_TYPE_MAP<"u"&&AUTO_GEAR_SELECTOR_TYPE_MAP||AUTO_GEAR_SELECTOR_TYPE_MAP_FALLBACK;return!o||!o.has(t)?"none":r&&r[t]||"none"}function normalizeAutoGearSelectorDefault$1(e,t,o){var r=normalizeAutoGearText$1(t);if(!r)return"";var n=getAutoGearSelectorOptions$1(e,o?{selectorContext:o}:null);if(!n.length)return r;var a=n.find(function(s){return s.toLowerCase()===r.toLowerCase()});return a||r}var AUTO_GEAR_MONITOR_DEFAULT_TYPES$2={focus:"monitor",handheld7:"monitor",combo15:"directorMonitor",director15:"directorMonitor"};function normalizeAutoGearMonitorDefaults$2(e){var t={focus:"",handheld7:"",combo15:"",director15:""};return!e||typeof e!="object"||Object.keys(AUTO_GEAR_MONITOR_DEFAULT_TYPES$2).forEach(function(o){var r=AUTO_GEAR_MONITOR_DEFAULT_TYPES$2[o],n=normalizeAutoGearSelectorDefault$1(r,e[o]);t[o]=n}),t}function resolveDevicesSnapshot(){if(DEVICE_GLOBAL_SCOPE&&DEVICE_GLOBAL_SCOPE.devices&&typeof DEVICE_GLOBAL_SCOPE.devices=="object")return DEVICE_GLOBAL_SCOPE.devices;try{return typeof devices<"u"&&devices&&typeof devices=="object"?devices:null}catch(e){if(e&&typeof e=="object"&&e.name==="ReferenceError")return null;throw e}}function updateGlobalDevicesReference$1(e){var t=e&&typeof e=="object"?e:{},o=new Set,r=[],n=function(m){!m||typeof m!="object"&&typeof m!="function"||o.has(m)||(o.add(m),r.push(m))};try{typeof DEVICE_GLOBAL_SCOPE<"u"&&n(DEVICE_GLOBAL_SCOPE)}catch{}n(typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null),n(typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null),n(typeof CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE<"u"?CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE:null),n(typeof globalThis<"u"?globalThis:null),n(typeof window<"u"?window:null),n(typeof self<"u"?self:null),n(typeof global<"u"?global:null);for(var a=0;a<r.length;a+=1){var s=r[a];if(s){try{s.devices=t}catch{try{Object.defineProperty(s,"devices",{configurable:!0,writable:!0,value:t})}catch{}}try{var l=s.CORE_SHARED||s.cineCoreShared;if(l&&typeof l=="object"&&(l.devices=t,typeof l.updateDevices=="function"))try{l.updateDevices(t)}catch(m){}}catch{}s&&s.global&&s.global!==s&&n(s.global);var u=s.__cineRuntimeState;if(u&&typeof u=="object")try{u.devices=t}catch{}}}var d=resolveAutoGearCoreShared();if(d&&typeof d=="object")try{d.devices=t,typeof d.updateDevices=="function"&&d.updateDevices(t)}catch{}if(typeof module<"u"&&module&&typeof module.exports=="object"&&module.exports)try{module.exports.devices=t}catch{}return t}function resolveAutoGearCoreShared(){for(var e=[AUTO_GEAR_NORMALIZER_SCOPE,AUTO_GEAR_NORMALIZER_SCOPE&&AUTO_GEAR_NORMALIZER_SCOPE.global,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=0;t<e.length;t+=1){var o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function")){if(o.CORE_SHARED&&typeof o.CORE_SHARED=="object")return o.CORE_SHARED;if(o.cineCoreShared&&typeof o.cineCoreShared=="object")return o.cineCoreShared}}return null}function resolveTripodPreferenceSelect(e){if(typeof document>"u")return null;var t=AUTO_GEAR_TRIPOD_FIELD_IDS[e];return t?document.getElementById(t):null}function collectTripodPreferenceOptions$1(e){if(!AUTO_GEAR_TRIPOD_SELECTOR_TYPES.has(e))return[];var t=resolveTripodPreferenceSelect(e);if(!t||!t.options)return[];var o=Array.from(t.options),r=new Set,n=[];return o.forEach(function(a){if(a){var s=typeof a.value=="string"?a.value.trim():"",l=typeof a.textContent=="string"?a.textContent.trim():"",u=s||l;if(u){var d=u.toLowerCase();r.has(d)||(r.add(d),n.push({value:u,label:l||u}))}}}),n}function getAutoGearSelectorOptions$1(e,t){var o=normalizeAutoGearSelectorType$1(e),r=resolveDevicesSnapshot();if(!r||typeof r!="object")return[];if(o==="monitor"){var n=r&&r.monitors?r.monitors:null;return!n||typeof n!="object"?[]:Object.keys(n).filter(function(b){return b&&b!=="None"}).sort(localeSort)}if(o==="directorMonitor"){var a=r&&r.directorMonitors?r.directorMonitors:null;return!a||typeof a!="object"?[]:Object.keys(a).filter(function(b){return b&&b!=="None"}).sort(localeSort)}if(o==="fizHandUnit"){var s=typeof AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS=="object"?AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS:typeof globalThis<"u"&&typeof globalThis.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS=="object"?globalThis.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS:Object.create(null),l=typeof AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP=="object"?AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP:typeof globalThis<"u"&&typeof globalThis.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP=="object"?globalThis.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP:Object.create(null),u="";if(t&&typeof t=="object"){var d=t.selectorContext||t.context;typeof d=="string"&&(u=d.trim())}else typeof t=="string"&&(u=t.trim());var m=null;if(u&&(m=s[u]||null,!m)){var y=normalizeAutoGearTriggerValue$2(u);y&&(s[y]?m=s[y]:l[y]&&s[l[y]]&&(m=s[l[y]]))}if(m&&Array.isArray(m.options))return m.options.slice();var h=[];return Object.values(s).forEach(function(b){!b||!Array.isArray(b.options)||b.options.forEach(function(v){!v||h.includes(v)||h.push(v)})}),h}return AUTO_GEAR_TRIPOD_SELECTOR_TYPES.has(o)?collectTripodPreferenceOptions$1(o).map(function(b){return b.value}):[]}function getAutoGearSelectorLabel$1(e){var t=normalizeAutoGearSelectorType$1(e),o=getLanguageTexts(currentLang),r=getAutoGearFallbackTexts();return t==="monitor"?o.autoGearSelectorMonitorOption||r.autoGearSelectorMonitorOption||"Monitor selector":t==="directorMonitor"?o.autoGearSelectorDirectorOption||r.autoGearSelectorDirectorOption||"Director monitor selector":t==="tripodHeadBrand"?o.autoGearSelectorTripodHeadOption||r.autoGearSelectorTripodHeadOption||"Tripod head selector":t==="tripodBowl"?o.autoGearSelectorTripodBowlOption||r.autoGearSelectorTripodBowlOption||"Tripod bowl selector":t==="tripodTypes"?o.autoGearSelectorTripodTypesOption||r.autoGearSelectorTripodTypesOption||"Tripod type selector":t==="tripodSpreader"?o.autoGearSelectorTripodSpreaderOption||r.autoGearSelectorTripodSpreaderOption||"Tripod spreader selector":t==="fizHandUnit"?o.autoGearSelectorFizHandUnitOption||r.autoGearSelectorFizHandUnitOption||"FIZ hand unit selector":o.autoGearSelectorNoneOption||r.autoGearSelectorNoneOption||"No selector"}function getAutoGearSelectorScrollHint(){var e=getLanguageTexts(currentLang),t=getAutoGearFallbackTexts();return e.autoGearSelectorScrollHint||t.autoGearSelectorScrollHint||"Scroll to see more devices."}function getAutoGearSelectorDefaultPlaceholder(){var e=getLanguageTexts(currentLang),t=getAutoGearFallbackTexts();return e.autoGearSelectorDefaultPlaceholder||t.autoGearSelectorDefaultPlaceholder||"Choose a default device"}function getAutoGearMonitorDefaultPlaceholder$1(){var e=getLanguageTexts(currentLang),t=getAutoGearFallbackTexts();return e.autoGearMonitorDefaultPlaceholder||t.autoGearMonitorDefaultPlaceholder||"Use recommended automatically"}function formatAutoGearSelectorValue$1(e,t){var o=typeof t=="string"?t.trim():"";if(!o)return"";var r=normalizeAutoGearSelectorType$1(e);if(AUTO_GEAR_TRIPOD_SELECTOR_TYPES.has(r)){var n=collectTripodPreferenceOptions$1(r),a=n.find(function(s){return s.value.toLowerCase()===o.toLowerCase()});if(a&&a.label)return a.label}return typeof addArriKNumber=="function"&&(r==="monitor"||r==="directorMonitor"||r==="fizHandUnit")?addArriKNumber(o):o}function populateAutoGearCategorySelect$1(e,t){var o,r;if(e){var n=typeof t=="string"?t:"",a=typeof currentLang=="string"?currentLang:"en";e.innerHTML="",GEAR_LIST_CATEGORIES.forEach(function(l){var u=document.createElement("option");u.value=l,u.textContent=l,n===l&&(u.selected=!0),e.appendChild(u)});var s=document.createElement("option");s.value=AUTO_GEAR_CUSTOM_CATEGORY,s.textContent=((o=texts==null?void 0:texts[a])===null||o===void 0?void 0:o.autoGearCustomCategory)||((r=texts==null?void 0:texts.en)===null||r===void 0?void 0:r.autoGearCustomCategory)||"Custom Additions",(!n||n===AUTO_GEAR_CUSTOM_CATEGORY)&&(s.selected=!0),e.appendChild(s)}}function formatAutoGearOwnGearLabel$1(e){if(!e||typeof e.name!="string")return"";var t=typeof e?.quantity=="number"?String(e.quantity):e?.quantity,o=formatOwnGearQuantityText(t);return o?"".concat(e.name," (").concat(o,")"):e.name}function refreshAutoGearOwnGearConditionOptions$1(e){if(autoGearOwnGearSelect){var t=Array.isArray(e)?e.filter(function(l){return typeof l=="string"}).map(function(l){return l.trim()}).filter(Boolean):collectAutoGearSelectedValues(e,"ownGear");autoGearOwnGearSelect.innerHTML="",autoGearOwnGearSelect.multiple=!0;var o=getAutoGearOwnGearItems(),r=new Set,n=function(l,u,d){if(d===void 0&&(d={}),typeof l=="string"){var m=l.trim();if(!(!m||r.has(m))){var y=document.createElement("option");y.value=m,y.textContent=u||m,d.dataset&&y.dataset&&Object.entries(d.dataset).forEach(function(h){var b=h[0],v=h[1];v!=null&&(y.dataset[b]=v)}),d.fallback&&(y.dataset.autoGearFallback="true"),t.includes(m)&&(y.selected=!0),autoGearOwnGearSelect.appendChild(y),r.add(m)}}};o.forEach(function(l){if(!(!l||typeof l.id!="string")){var u=l.id.trim();if(u){var d={};typeof l.name=="string"&&l.name&&(d.name=l.name);var m=formatOwnGearQuantityText(l.quantity);m&&(d.quantity=m),typeof l.notes=="string"&&l.notes&&(d.notes=l.notes),n(u,formatAutoGearOwnGearLabel$1(l)||l.name||u,{dataset:d})}}}),t.forEach(function(l){if(!(!l||r.has(l))){var u=typeof findAutoGearOwnGearById=="function"?findAutoGearOwnGearById(l):null,d=u?.name||l;n(l,d,{fallback:!0})}});var a=Array.from(autoGearOwnGearSelect.options||[]).filter(function(l){return!l.disabled});autoGearOwnGearSelect.size=computeAutoGearMultiSelectSize(a.length,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS});var s=a.some(function(l){return l.dataset.autoGearFallback!=="true"});autoGearOwnGearSelect.disabled=!s&&t.length===0}}function updateAutoGearOwnGearOptions$1(){var e=[autoGearAddOwnGearSelect,autoGearRemoveOwnGearSelect].filter(Boolean);if(e.length){var t=getAutoGearOwnGearItems();e.forEach(function(o){var r,n;if(o){var a=o.value||"",s=o.getAttribute("data-placeholder")||((r=texts[currentLang])===null||r===void 0?void 0:r.autoGearOwnGearPlaceholder)||((n=texts.en)===null||n===void 0?void 0:n.autoGearOwnGearPlaceholder)||"Manual entry";o.innerHTML="";var l=document.createElement("option");l.value="",l.textContent=s,o.appendChild(l),t.forEach(function(u){if(!(!u||typeof u.id!="string"||!u.id||typeof u.name!="string")){var d=document.createElement("option");d.value=u.id,d.textContent=formatAutoGearOwnGearLabel$1(u)||u.name,d.dataset.name=u.name,u.notes&&(d.dataset.notes=u.notes),u.source&&(d.dataset.source=u.source);var m=formatOwnGearQuantityText(u.quantity);m&&(d.dataset.quantity=m),u.id===a&&(d.selected=!0),o.appendChild(d)}}),a&&o.value!==a&&(o.querySelector('option[value="'.concat(a,'"]'))?o.value=a:o.value=""),o.disabled=t.length===0}}),refreshAutoGearOwnGearConditionOptions$1(Array.isArray(autoGearEditorDraft==null?void 0:autoGearEditorDraft.ownGear)?autoGearEditorDraft.ownGear:void 0)}}function isAutoGearMonitoringCategory(e){return typeof e!="string"?!1:e.trim().toLowerCase()==="monitoring"}function isMonitoringCategorySelected(e){var t;if(!e)return!1;var o=typeof e.value=="string"?e.value:"";if(isAutoGearMonitoringCategory(o))return!0;var r=((t=e.options)===null||t===void 0?void 0:t[e.selectedIndex])||null;if(!r)return!1;var n=typeof r.value=="string"?r.value:"";if(isAutoGearMonitoringCategory(n))return!0;var a=typeof r.textContent=="string"?r.textContent:"";return isAutoGearMonitoringCategory(a)}function matchesTripodCategory(e){var t=typeof e=="string"?e.trim().toLowerCase():"";return t?t==="camera support"||t==="grip"?!0:t.includes("tripod"):!1}function isTripodCategorySelected(e){var t;if(!e)return!1;var o=typeof e.value=="string"?e.value:"";if(matchesTripodCategory(o))return!0;var r=((t=e.options)===null||t===void 0?void 0:t[e.selectedIndex])||null;if(!r)return!1;if(matchesTripodCategory(r.value))return!0;var n=typeof r.textContent=="string"?r.textContent:"";return matchesTripodCategory(n)}function setAutoGearFieldVisibility(e,t){if(e)if(t)if(e.hidden=!1,e.removeAttribute("hidden"),e.removeAttribute("aria-hidden"),Object.prototype.hasOwnProperty.call(e.dataset,"autoGearHiddenDisplay")){var o=e.dataset.autoGearHiddenDisplay;o?e.style.display=o:e.style.removeProperty("display"),delete e.dataset.autoGearHiddenDisplay}else e.style.display==="none"&&e.style.removeProperty("display");else e.hidden=!0,e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),Object.prototype.hasOwnProperty.call(e.dataset,"autoGearHiddenDisplay")||(e.dataset.autoGearHiddenDisplay=e.style.display||""),e.style.display="none"}function updateAutoGearMonitorFieldGroup(e){if(!(!e||!e.select)){var t=e.select,o=e.screenSizeField,r=e.screenSizeInput,n=e.selectorTypeField,a=e.selectorTypeSelect,s=e.selectorDefaultField,l=e.selectorDefaultInput,u=isMonitoringCategorySelected(t),d=isTripodCategorySelected(t),m=u,y=u||d;setAutoGearFieldVisibility(o,m),setAutoGearFieldVisibility(n,y),setAutoGearFieldVisibility(s,y),!m&&r&&(r.value=""),y||(a&&(a.value="none"),l&&(l.value="",Object.prototype.hasOwnProperty.call(l.dataset||{},"autoGearPreferredDefault")&&delete l.dataset.autoGearPreferredDefault))}}function extractAutoGearContextNotes(e){var t=[];if(!e||typeof e!="string")return{baseName:"",contexts:t};for(var o=e.trim(),r=/^(.*\([^()]*\)) \(([^()]+)\)$/,n=o.match(r);n;){var a=n[2].trim();if(/handheld\b/i.test(a)||/15-21"?$/.test(a))t.unshift(a),o=n[1].trim();else break;n=o.match(r)}return{baseName:o,contexts:t}}function normalizeAutoGearItem$2(e){if(!e||typeof e!="object")return null;var t=normalizeAutoGearText$1(e.name),o=typeof e.ownGearId=="string"?e.ownGearId.trim():"",r=normalizeAutoGearText$1(e.ownGearLabel),n=normalizeAutoGearText$1(e.ownGearName),a=null;o&&(a=findAutoGearOwnGearById(o)||null);var s=a?.name||n||t;if(!s)return null;var l=extractAutoGearContextNotes(t||s),u=l.baseName,d=l.contexts,m=u||s,y=Array.isArray(e.contextNotes)?e.contextNotes.filter(function(V){return typeof V=="string"&&V.trim()}):[];y.forEach(function(V){var M=V.trim();M&&(d.includes(M)||d.push(M))});var h=normalizeAutoGearText$1(e.category),b=normalizeAutoGearQuantity$1(e.quantity),v=typeof e.id=="string"&&e.id?e.id:generateAutoGearId$1("item"),C=normalizeAutoGearText$1(e.screenSize),A=normalizeAutoGearSelectorType$1(e.selectorType),w=typeof e.selectorContext=="string"?e.selectorContext.trim():"",R=normalizeAutoGearSelectorDefault$1(A,e.selectorDefault,w),_=!!e.selectorEnabled;A==="none"?_=!1:isAutoGearMonitoringCategory(h)&&(_=!0);var G=normalizeAutoGearText$1(e.notes),O="",B="";if(a){if(O=a.id,B=a.name||"",m=a.name||m,!G&&typeof a.notes=="string"){var $=normalizeAutoGearText$1(a.notes);$&&(G=$)}}else o&&(O=o,B=r||n||m);return{id:v,name:m,category:h,quantity:b,screenSize:C,selectorType:A,selectorDefault:R,selectorEnabled:_,selectorContext:w,notes:G,contextNotes:d,ownGearId:O,ownGearLabel:B}}function normalizeAutoGearTriggerList(e){return Array.isArray(e)?Array.from(new Set(e.map(function(t){return typeof t=="string"?t.trim():""}).filter(Boolean))):[]}var AUTO_GEAR_SCENARIO_LOGIC_VALUES=new Set(["all","any","multiplier"]);function normalizeAutoGearScenarioLogic$2(e){if(typeof e!="string")return"all";var t=e.trim().toLowerCase();return t?t==="or"?"any":t==="and"?"all":t==="any"?"any":t==="multiplier"||t==="multiply"||t==="multiplied"?"multiplier":AUTO_GEAR_SCENARIO_LOGIC_VALUES.has(t)?t:"all":"all"}var AUTO_GEAR_CONDITION_LOGIC_VALUES=new Set(["all","any","or","none","multiplier"]),AUTO_GEAR_CONDITION_LOGIC_FIELDS$1={mattebox:"matteboxLogic",cameraHandle:"cameraHandleLogic",viewfinderExtension:"viewfinderExtensionLogic",deliveryResolution:"deliveryResolutionLogic",videoDistribution:"videoDistributionLogic",camera:"cameraLogic",ownGear:"ownGearLogic",monitor:"monitorLogic",tripodHeadBrand:"tripodHeadBrandLogic",tripodBowl:"tripodBowlLogic",tripodTypes:"tripodTypesLogic",tripodSpreader:"tripodSpreaderLogic",crewPresent:"crewPresentLogic",crewAbsent:"crewAbsentLogic",wireless:"wirelessLogic",motors:"motorsLogic",controllers:"controllersLogic",distance:"distanceLogic"};function normalizeAutoGearConditionLogic$2(e){if(typeof e!="string")return"all";var t=e.trim().toLowerCase();return t?t==="or"?"or":t==="and"?"all":t==="any"?"any":t==="none"||t==="no"||t==="exclude"||t==="absent"?"none":t==="multiplier"||t==="multiply"||t==="multiplied"?"multiplier":AUTO_GEAR_CONDITION_LOGIC_VALUES.has(t)?t:(typeof console<"u"&&typeof console.warn=="function"&&console.warn('Unknown auto gear condition logic joiner. Falling back to "all".',e),"all"):"all"}function readAutoGearConditionLogic(e,t){if(!e||typeof e!="object")return"all";var o=AUTO_GEAR_CONDITION_LOGIC_FIELDS$1[t],r;if(o&&Object.prototype.hasOwnProperty.call(e,o)&&(r=e[o]),r==null){var n="".concat(t,"Mode");Object.prototype.hasOwnProperty.call(e,n)&&(r=e[n])}return r==null&&e.conditionLogic&&typeof e.conditionLogic=="object"&&(r=e.conditionLogic[t]),normalizeAutoGearConditionLogic$2(r)}function normalizeAutoGearScenarioMultiplier$2(e){var t=parseInt(e,10);return Number.isFinite(t)&&t>1?t:1}function normalizeAutoGearScenarioPrimary$2(e){return typeof e=="string"?e.trim():""}function normalizeVideoDistributionTriggerList(e){if(!Array.isArray(e))return[];var t=normalizeAutoGearTriggerList(e),o=new Set,r=[];return t.forEach(function(n){var a=n.toLowerCase(),s=a==="__none__"||a==="none"?"__none__":n;!s||o.has(s)||(o.add(s),r.push(s))}),r}function normalizeAutoGearTriggerValue$2(e){return typeof e=="string"?e.trim().toLowerCase():""}function autoGearRuleMatteboxKey$1(e){if(!e||typeof e!="object")return"";var t=Array.isArray(e.mattebox)?e.mattebox:[];return t.length?t.map(normalizeAutoGearTriggerValue$2).filter(Boolean).sort(function(o,r){return o.localeCompare(r)}).join("|"):""}var AUTO_GEAR_SHOOTING_DAY_MODES$1=new Set(["minimum","maximum","every"]);function normalizeAutoGearShootingDayMode$1(e){if(typeof e!="string")return"minimum";var t=e.trim().toLowerCase();return t?AUTO_GEAR_SHOOTING_DAY_MODES$1.has(t)?t:t==="min"||t==="at least"?"minimum":t==="max"||t==="at most"?"maximum":t==="each"||t==="every"?"every":"minimum":"minimum"}function normalizeAutoGearShootingDayValue(e){if(typeof e=="number"&&Number.isFinite(e)){var t=Math.round(e);return t>0?t:null}if(typeof e=="string"){var o=e.trim();if(!o)return null;var r=Number.parseInt(o,10);return Number.isFinite(r)&&r>0?r:null}return null}function normalizeAutoGearShootingDaysList(e){if(!Array.isArray(e))return[];var t=new Set;return e.forEach(function(o){var r=normalizeAutoGearShootingDayValue(o);Number.isFinite(r)&&r>0&&t.add(r)}),Array.from(t).sort(function(o,r){return o-r})}function normalizeAutoGearShootingDaysCondition$2(e){var t,o,r,n,a,s,l,u,d;if(!e)return null;if(Array.isArray(e)){var m=normalizeAutoGearShootingDaysList(e);if(!m.length)return null;var y=m[m.length-1];return Number.isFinite(y)&&y>0?{mode:"minimum",value:y}:null}if(typeof e=="object"){var h=(n=(r=(o=(t=e.mode)!==null&&t!==void 0?t:e.type)!==null&&o!==void 0?o:e.comparison)!==null&&r!==void 0?r:e.condition)!==null&&n!==void 0?n:e.kind,b=normalizeAutoGearShootingDayMode$1(h),v=(d=(u=(l=(s=(a=e.value)!==null&&a!==void 0?a:e.count)!==null&&s!==void 0?s:e.days)!==null&&l!==void 0?l:e.minimum)!==null&&u!==void 0?u:e.maximum)!==null&&d!==void 0?d:e.frequency,C=normalizeAutoGearShootingDayValue(v);return Number.isFinite(C)&&C>0?{mode:b,value:C}:null}var A=normalizeAutoGearShootingDayValue(e);return Number.isFinite(A)&&A>0?{mode:"minimum",value:A}:null}function normalizeAutoGearRule$2(e){if(!e||typeof e!="object")return null;var t=typeof e.id=="string"&&e.id?e.id:generateAutoGearId$1("rule"),o=typeof e.label=="string"?e.label.trim():"",r=!0;if(typeof e.enabled=="string"){var n=e.enabled.trim().toLowerCase();(n==="false"||n==="0")&&(r=!1)}else e.enabled===!1&&(r=!1);var a=!1;if(Array.isArray(e.always))a=e.always.some(function(Ve){if(typeof Ve=="string"){var je=Ve.trim().toLowerCase();return!(!je||je==="false"||je==="0")}return!!Ve});else if(typeof e.always=="string"){var s=e.always.trim().toLowerCase();a=s==="true"||s&&s!=="false"&&s!=="0"}else a=!!e.always;var l=normalizeAutoGearTriggerList(e.scenarios),u=normalizeAutoGearScenarioLogic$2(e.scenarioLogic),d=1,m="";if(u==="multiplier"){d=normalizeAutoGearScenarioMultiplier$2(e.scenarioMultiplier);var y=normalizeAutoGearScenarioPrimary$2(e.scenarioPrimary),h=normalizeAutoGearTriggerValue$2(y);if(h){var b=l.find(function(Ve){return normalizeAutoGearTriggerValue$2(Ve)===h});b?m=b:y&&(m=y,l.push(y))}!m&&l.length&&(m=l[0])}if(l=l.sort(function(Ve,je){return Ve.localeCompare(je)}),u==="multiplier"&&m){var v=normalizeAutoGearTriggerValue$2(m),C=l.some(function(Ve){return normalizeAutoGearTriggerValue$2(Ve)===v});C||(l.push(m),l.sort(function(Ve,je){return Ve.localeCompare(je)}))}var A=normalizeAutoGearTriggerList(e.mattebox).sort(function(Ve,je){return Ve.localeCompare(je)}),w=normalizeAutoGearTriggerList(e.cameraHandle).sort(function(Ve,je){return Ve.localeCompare(je)}),R=normalizeAutoGearTriggerList(e.viewfinderExtension).sort(function(Ve,je){return Ve.localeCompare(je)}),_=normalizeAutoGearTriggerList(e.deliveryResolution).sort(function(Ve,je){return Ve.localeCompare(je)}),G=normalizeVideoDistributionTriggerList(e.videoDistribution).sort(function(Ve,je){return Ve.localeCompare(je)}),O=normalizeAutoGearTriggerList(e.camera).sort(function(Ve,je){return Ve.localeCompare(je)}),B=normalizeAutoGearTriggerList(e.ownGear).sort(function(Ve,je){return Ve.localeCompare(je)}),$=normalizeAutoGearCameraWeightCondition(e.cameraWeight),V=normalizeAutoGearTriggerList(e.monitor).sort(function(Ve,je){return Ve.localeCompare(je)}),M=normalizeAutoGearTriggerList(e.tripodHeadBrand).sort(function(Ve,je){return Ve.localeCompare(je)}),F=normalizeAutoGearTriggerList(e.tripodBowl).sort(function(Ve,je){return Ve.localeCompare(je)}),z=normalizeAutoGearTriggerList(e.tripodTypes).sort(function(Ve,je){return Ve.localeCompare(je)}),x=normalizeAutoGearTriggerList(e.tripodSpreader).sort(function(Ve,je){return Ve.localeCompare(je)}),H=normalizeAutoGearTriggerList(e.crewPresent).sort(function(Ve,je){return Ve.localeCompare(je)}),W=normalizeAutoGearTriggerList(e.crewAbsent).sort(function(Ve,je){return Ve.localeCompare(je)}),U=normalizeAutoGearTriggerList(e.wireless).sort(function(Ve,je){return Ve.localeCompare(je)}),j=normalizeAutoGearTriggerList(e.motors).sort(function(Ve,je){return Ve.localeCompare(je)}),Y=normalizeAutoGearTriggerList(e.controllers).sort(function(Ve,je){return Ve.localeCompare(je)}),le=normalizeAutoGearTriggerList(e.distance).sort(function(Ve,je){return Ve.localeCompare(je)}),be=normalizeAutoGearShootingDaysCondition$2(e.shootingDays),re=readAutoGearConditionLogic(e,"mattebox"),de=readAutoGearConditionLogic(e,"cameraHandle"),ne=readAutoGearConditionLogic(e,"viewfinderExtension"),Ce=readAutoGearConditionLogic(e,"deliveryResolution"),Ee=readAutoGearConditionLogic(e,"videoDistribution"),Pe=readAutoGearConditionLogic(e,"camera"),et=readAutoGearConditionLogic(e,"ownGear"),Je=readAutoGearConditionLogic(e,"monitor"),it=readAutoGearConditionLogic(e,"tripodHeadBrand"),rt=readAutoGearConditionLogic(e,"tripodBowl"),Pt=readAutoGearConditionLogic(e,"tripodTypes"),vt=readAutoGearConditionLogic(e,"tripodSpreader"),bo=readAutoGearConditionLogic(e,"crewPresent"),Et=readAutoGearConditionLogic(e,"crewAbsent"),Ut=readAutoGearConditionLogic(e,"wireless"),ge=readAutoGearConditionLogic(e,"motors"),ue=readAutoGearConditionLogic(e,"controllers"),We=readAutoGearConditionLogic(e,"distance"),Me={};if(u&&u!=="all"&&(Me.scenarios=u),re&&re!=="all"&&(Me.mattebox=re),de&&de!=="all"&&(Me.cameraHandle=de),ne&&ne!=="all"&&(Me.viewfinderExtension=ne),Ce&&Ce!=="all"&&(Me.deliveryResolution=Ce),Ee&&Ee!=="all"&&(Me.videoDistribution=Ee),Pe&&Pe!=="all"&&(Me.camera=Pe),et&&et!=="all"&&(Me.ownGear=et),Je&&Je!=="all"&&(Me.monitor=Je),it&&it!=="all"&&(Me.tripodHeadBrand=it),rt&&rt!=="all"&&(Me.tripodBowl=rt),Pt&&Pt!=="all"&&(Me.tripodTypes=Pt),vt&&vt!=="all"&&(Me.tripodSpreader=vt),bo&&bo!=="all"&&(Me.crewPresent=bo),Et&&Et!=="all"&&(Me.crewAbsent=Et),Ut&&Ut!=="all"&&(Me.wireless=Ut),ge&&ge!=="all"&&(Me.motors=ge),ue&&ue!=="all"&&(Me.controllers=ue),We&&We!=="all"&&(Me.distance=We),!a&&!l.length&&!be&&!A.length&&!w.length&&!R.length&&!_.length&&!G.length&&!O.length&&!B.length&&!$&&!V.length&&!M.length&&!F.length&&!z.length&&!x.length&&!H.length&&!W.length&&!U.length&&!j.length&&!Y.length&&!le.length)return null;var Te=Array.isArray(e.add)?e.add.map(normalizeAutoGearItem$2).filter(Boolean):[],Be=Array.isArray(e.remove)?e.remove.map(normalizeAutoGearItem$2).filter(Boolean):[];return!Te.length&&!Be.length?null:{id:t,label:o,always:a,scenarioLogic:u,scenarioPrimary:m,scenarioMultiplier:d,scenarios:l,mattebox:A,cameraHandle:w,viewfinderExtension:R,deliveryResolution:_,videoDistribution:G,camera:O,ownGear:B,cameraWeight:$,monitor:V,tripodHeadBrand:M,tripodBowl:F,tripodTypes:z,tripodSpreader:x,crewPresent:H,crewAbsent:W,wireless:U,motors:j,controllers:Y,distance:le,shootingDays:be,matteboxLogic:re,cameraHandleLogic:de,viewfinderExtensionLogic:ne,deliveryResolutionLogic:Ce,videoDistributionLogic:Ee,cameraLogic:Pe,ownGearLogic:et,monitorLogic:Je,tripodHeadBrandLogic:it,tripodBowlLogic:rt,tripodTypesLogic:Pt,tripodSpreaderLogic:vt,crewPresentLogic:bo,crewAbsentLogic:Et,wirelessLogic:Ut,motorsLogic:ge,controllersLogic:ue,distanceLogic:We,conditionLogic:Me,add:Te,remove:Be,enabled:r}}function autoGearItemSnapshot$1(e){var t=normalizeAutoGearItem$2(e);if(!t)return{name:"",category:"",quantity:0,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:"",ownGearId:"",ownGearLabel:""};var o=t.name,r=t.category,n=t.quantity,a=t.screenSize,s=t.selectorType,l=t.selectorDefault,u=t.selectorEnabled,d=t.notes,m=t.ownGearId,y=t.ownGearLabel;return{name:o,category:r,quantity:normalizeAutoGearQuantity$1(n),screenSize:a,selectorType:s,selectorDefault:l,selectorEnabled:u,notes:d,ownGearId:m,ownGearLabel:y}}function autoGearItemSortKey(e){var t=autoGearItemSnapshot$1(e),o=t.name||"",r=t.category||"",n=normalizeAutoGearQuantity$1(t.quantity),a=t.screenSize||"",s=t.selectorType||"none",l=t.selectorDefault||"",u=t.selectorEnabled?"1":"0",d=t.notes||"",m=t.ownGearId||"",y=t.ownGearLabel||"";return"".concat(o,"|").concat(r,"|").concat(n,"|").concat(a,"|").concat(s,"|").concat(u,"|").concat(l,"|").concat(d,"|").concat(m,"|").concat(y)}function snapshotAutoGearRuleForFingerprint(e){var t=normalizeAutoGearRule$2(e);if(!t)return null;var o=function(r){return r.map(autoGearItemSnapshot$1).sort(function(n,a){return autoGearItemSortKey(n).localeCompare(autoGearItemSortKey(a))})};return{label:t.label||"",always:t.always?1:0,scenarios:t.scenarios.slice().sort(function(r,n){return r.localeCompare(n)}),mattebox:t.mattebox.slice().sort(function(r,n){return r.localeCompare(n)}),cameraHandle:t.cameraHandle.slice().sort(function(r,n){return r.localeCompare(n)}),viewfinderExtension:t.viewfinderExtension.slice().sort(function(r,n){return r.localeCompare(n)}),deliveryResolution:t.deliveryResolution.slice().sort(function(r,n){return r.localeCompare(n)}),videoDistribution:t.videoDistribution.slice().sort(function(r,n){return r.localeCompare(n)}),camera:t.camera.slice().sort(function(r,n){return r.localeCompare(n)}),cameraWeight:t.cameraWeight?{operator:t.cameraWeight.operator,value:t.cameraWeight.value}:null,monitor:t.monitor.slice().sort(function(r,n){return r.localeCompare(n)}),tripodHeadBrand:t.tripodHeadBrand.slice().sort(function(r,n){return r.localeCompare(n)}),tripodBowl:t.tripodBowl.slice().sort(function(r,n){return r.localeCompare(n)}),tripodTypes:t.tripodTypes.slice().sort(function(r,n){return r.localeCompare(n)}),tripodSpreader:t.tripodSpreader.slice().sort(function(r,n){return r.localeCompare(n)}),crewPresent:t.crewPresent.slice().sort(function(r,n){return r.localeCompare(n)}),crewAbsent:t.crewAbsent.slice().sort(function(r,n){return r.localeCompare(n)}),wireless:t.wireless.slice().sort(function(r,n){return r.localeCompare(n)}),motors:t.motors.slice().sort(function(r,n){return r.localeCompare(n)}),controllers:t.controllers.slice().sort(function(r,n){return r.localeCompare(n)}),distance:t.distance.slice().sort(function(r,n){return r.localeCompare(n)}),shootingDays:normalizeAutoGearShootingDaysCondition$2(t.shootingDays),matteboxLogic:normalizeAutoGearConditionLogic$2(t.matteboxLogic),cameraHandleLogic:normalizeAutoGearConditionLogic$2(t.cameraHandleLogic),viewfinderExtensionLogic:normalizeAutoGearConditionLogic$2(t.viewfinderExtensionLogic),deliveryResolutionLogic:normalizeAutoGearConditionLogic$2(t.deliveryResolutionLogic),videoDistributionLogic:normalizeAutoGearConditionLogic$2(t.videoDistributionLogic),cameraLogic:normalizeAutoGearConditionLogic$2(t.cameraLogic),monitorLogic:normalizeAutoGearConditionLogic$2(t.monitorLogic),tripodHeadBrandLogic:normalizeAutoGearConditionLogic$2(t.tripodHeadBrandLogic),tripodBowlLogic:normalizeAutoGearConditionLogic$2(t.tripodBowlLogic),tripodTypesLogic:normalizeAutoGearConditionLogic$2(t.tripodTypesLogic),tripodSpreaderLogic:normalizeAutoGearConditionLogic$2(t.tripodSpreaderLogic),crewPresentLogic:normalizeAutoGearConditionLogic$2(t.crewPresentLogic),crewAbsentLogic:normalizeAutoGearConditionLogic$2(t.crewAbsentLogic),wirelessLogic:normalizeAutoGearConditionLogic$2(t.wirelessLogic),motorsLogic:normalizeAutoGearConditionLogic$2(t.motorsLogic),controllersLogic:normalizeAutoGearConditionLogic$2(t.controllersLogic),distanceLogic:normalizeAutoGearConditionLogic$2(t.distanceLogic),conditionLogic:t.conditionLogic?Object.keys(t.conditionLogic).reduce(function(r,n){return r[n]=normalizeAutoGearConditionLogic$2(t.conditionLogic[n]),r},{}):{},add:o(t.add),remove:o(t.remove),enabled:t.enabled?1:0}}function autoGearRuleSortKey(e){var t=e&&e.always?"1":"0",o=Array.isArray(e.scenarios)?e.scenarios.join("|"):"",r=Array.isArray(e.mattebox)?e.mattebox.join("|"):"",n=Array.isArray(e.cameraHandle)?e.cameraHandle.join("|"):"",a=Array.isArray(e.viewfinderExtension)?e.viewfinderExtension.join("|"):"",s=Array.isArray(e.deliveryResolution)?e.deliveryResolution.join("|"):"",l=Array.isArray(e.videoDistribution)?e.videoDistribution.join("|"):"",u=Array.isArray(e.camera)?e.camera.join("|"):"",d=normalizeAutoGearCameraWeightCondition(e?.cameraWeight),m=d?"".concat(d.operator,":").concat(d.value):"",y=Array.isArray(e.monitor)?e.monitor.join("|"):"",h=Array.isArray(e.tripodHeadBrand)?e.tripodHeadBrand.join("|"):"",b=Array.isArray(e.tripodBowl)?e.tripodBowl.join("|"):"",v=Array.isArray(e.tripodTypes)?e.tripodTypes.join("|"):"",C=Array.isArray(e.tripodSpreader)?e.tripodSpreader.join("|"):"",A=Array.isArray(e.crewPresent)?e.crewPresent.join("|"):"",w=Array.isArray(e.crewAbsent)?e.crewAbsent.join("|"):"",R=Array.isArray(e.wireless)?e.wireless.join("|"):"",_=Array.isArray(e.motors)?e.motors.join("|"):"",G=Array.isArray(e.controllers)?e.controllers.join("|"):"",O=Array.isArray(e.distance)?e.distance.join("|"):"",B=normalizeAutoGearShootingDaysCondition$2(e?.shootingDays),$=B?"".concat(B.mode,":").concat(B.value):"",V=normalizeAutoGearConditionLogic$2(e?.matteboxLogic),M=normalizeAutoGearConditionLogic$2(e?.cameraHandleLogic),F=normalizeAutoGearConditionLogic$2(e?.viewfinderExtensionLogic),z=normalizeAutoGearConditionLogic$2(e?.deliveryResolutionLogic),x=normalizeAutoGearConditionLogic$2(e?.videoDistributionLogic),H=normalizeAutoGearConditionLogic$2(e?.cameraLogic),W=normalizeAutoGearConditionLogic$2(e?.monitorLogic),U=normalizeAutoGearConditionLogic$2(e?.tripodHeadBrandLogic),j=normalizeAutoGearConditionLogic$2(e?.tripodBowlLogic),Y=normalizeAutoGearConditionLogic$2(e?.tripodTypesLogic),le=normalizeAutoGearConditionLogic$2(e?.tripodSpreaderLogic),be=normalizeAutoGearConditionLogic$2(e?.crewPresentLogic),re=normalizeAutoGearConditionLogic$2(e?.crewAbsentLogic),de=normalizeAutoGearConditionLogic$2(e?.wirelessLogic),ne=normalizeAutoGearConditionLogic$2(e?.motorsLogic),Ce=normalizeAutoGearConditionLogic$2(e?.controllersLogic),Ee=normalizeAutoGearConditionLogic$2(e?.distanceLogic),Pe=Array.isArray(e.add)?e.add.map(autoGearItemSortKey).join("|"):"",et=Array.isArray(e.remove)?e.remove.map(autoGearItemSortKey).join("|"):"";return"".concat(t,"|").concat(o,"|").concat(r,"|").concat(n,"|").concat(a,"|").concat(s,"|").concat(l,"|").concat(u,"|").concat(m,"|").concat(y,"|").concat(h,"|").concat(b,"|").concat(v,"|").concat(C,"|").concat(A,"|").concat(w,"|").concat(R,"|").concat(_,"|").concat(G,"|").concat(O,"|").concat($,"|").concat(V,"|").concat(M,"|").concat(F,"|").concat(z,"|").concat(x,"|").concat(H,"|").concat(W,"|").concat(U,"|").concat(j,"|").concat(Y,"|").concat(le,"|").concat(be,"|").concat(re,"|").concat(de,"|").concat(ne,"|").concat(Ce,"|").concat(Ee,"|").concat(e.label||"","|").concat(Pe,"|").concat(et)}function createAutoGearRulesFingerprint$1(e){var t=(Array.isArray(e)?e:[]).map(snapshotAutoGearRuleForFingerprint).filter(Boolean).sort(function(o,r){return autoGearRuleSortKey(o).localeCompare(autoGearRuleSortKey(r))});return stableStringify$2(t)}function normalizeAutoGearPreset$2(e){if(!e||typeof e!="object")return null;var t=typeof e.label=="string"?e.label.trim():"";if(!t)return null;var o=Array.isArray(e.rules)?e.rules:[],r=o.map(normalizeAutoGearRule$2).filter(Boolean),n=typeof e.id=="string"&&e.id?e.id:generateAutoGearId$1("preset"),a=createAutoGearRulesFingerprint$1(r);return{id:n,label:t,rules:r,fingerprint:a}}function normalizeAutoGearBackupEntry$1(e){if(!e||typeof e!="object")return null;var t=typeof e.createdAt=="string"?e.createdAt:null,o=t?Date.parse(t):NaN;if(!Number.isFinite(o))return null;var r=new Date(o).toISOString(),n=Array.isArray(e.rules)?e.rules:[],a=n.map(normalizeAutoGearRule$2).filter(Boolean),s=n.length===0?[]:a,l=typeof e.id=="string"&&e.id?e.id:generateAutoGearId$1("backup"),u=normalizeAutoGearMonitorDefaults$2(e.monitorDefaults),d=typeof e.note=="string"?e.note:"";return{id:l,createdAt:r,rules:s,monitorDefaults:u,note:d}}var AUTO_GEAR_NORMALIZER_EXPORTS={generateAutoGearId:generateAutoGearId$1,normalizeAutoGearQuantity:normalizeAutoGearQuantity$1,parseAutoGearDraftNames,normalizeAutoGearText:normalizeAutoGearText$1,normalizeAutoGearSelectorType:normalizeAutoGearSelectorType$1,normalizeAutoGearSelectorDefault:normalizeAutoGearSelectorDefault$1,resolveDevicesSnapshot,updateGlobalDevicesReference:updateGlobalDevicesReference$1,resolveTripodPreferenceSelect,collectTripodPreferenceOptions:collectTripodPreferenceOptions$1,getAutoGearSelectorOptions:getAutoGearSelectorOptions$1,getAutoGearSelectorLabel:getAutoGearSelectorLabel$1,getAutoGearSelectorScrollHint,getAutoGearSelectorDefaultPlaceholder,getAutoGearMonitorDefaultPlaceholder:getAutoGearMonitorDefaultPlaceholder$1,formatAutoGearSelectorValue:formatAutoGearSelectorValue$1,populateAutoGearCategorySelect:populateAutoGearCategorySelect$1,formatAutoGearOwnGearLabel:formatAutoGearOwnGearLabel$1,refreshAutoGearOwnGearConditionOptions:refreshAutoGearOwnGearConditionOptions$1,updateAutoGearOwnGearOptions:updateAutoGearOwnGearOptions$1,isAutoGearMonitoringCategory,isMonitoringCategorySelected,matchesTripodCategory,isTripodCategorySelected,setAutoGearFieldVisibility,updateAutoGearMonitorFieldGroup,extractAutoGearContextNotes,normalizeAutoGearItem:normalizeAutoGearItem$2,normalizeAutoGearTriggerList,normalizeAutoGearScenarioLogic:normalizeAutoGearScenarioLogic$2,normalizeAutoGearConditionLogic:normalizeAutoGearConditionLogic$2,readAutoGearConditionLogic,normalizeAutoGearScenarioMultiplier:normalizeAutoGearScenarioMultiplier$2,normalizeAutoGearScenarioPrimary:normalizeAutoGearScenarioPrimary$2,normalizeVideoDistributionTriggerList,normalizeAutoGearTriggerValue:normalizeAutoGearTriggerValue$2,normalizeAutoGearShootingDayMode:normalizeAutoGearShootingDayMode$1,normalizeAutoGearShootingDayValue,normalizeAutoGearShootingDaysList,normalizeAutoGearShootingDaysCondition:normalizeAutoGearShootingDaysCondition$2,normalizeAutoGearRule:normalizeAutoGearRule$2,autoGearItemSnapshot:autoGearItemSnapshot$1,autoGearItemSortKey,autoGearRuleMatteboxKey:autoGearRuleMatteboxKey$1,snapshotAutoGearRuleForFingerprint,autoGearRuleSortKey,createAutoGearRulesFingerprint:createAutoGearRulesFingerprint$1,normalizeAutoGearPreset:normalizeAutoGearPreset$2,normalizeAutoGearBackupEntry:normalizeAutoGearBackupEntry$1,normalizeAutoGearMonitorDefaults:normalizeAutoGearMonitorDefaults$2,AUTO_GEAR_MONITOR_DEFAULT_TYPES:AUTO_GEAR_MONITOR_DEFAULT_TYPES$2};typeof module<"u"&&module.exports&&(module.exports=AUTO_GEAR_NORMALIZER_EXPORTS);if(typeof globalThis<"u"){var target$3=typeof globalThis.AUTO_GEAR_NORMALIZER_EXPORTS=="object"&&globalThis.AUTO_GEAR_NORMALIZER_EXPORTS?globalThis.AUTO_GEAR_NORMALIZER_EXPORTS:globalThis.AUTO_GEAR_NORMALIZER_EXPORTS={};Object.assign(target$3,AUTO_GEAR_NORMALIZER_EXPORTS),Object.assign(globalThis,AUTO_GEAR_NORMALIZER_EXPORTS),globalThis.AUTO_GEAR_MONITOR_DEFAULT_TYPES=AUTO_GEAR_MONITOR_DEFAULT_TYPES$2,globalThis.normalizeAutoGearMonitorDefaults=normalizeAutoGearMonitorDefaults$2}const autoGearNormalizers=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var AUTO_GEAR_BACKUP_RETENTION_FALLBACK_KEY="cameraPowerPlanner_autoGearBackupRetention",AUTO_GEAR_BACKUP_RETENTION_FALLBACK_DEFAULT=36,AUTO_GEAR_BACKUP_RETENTION_FALLBACK_MIN=1,AUTO_GEAR_BACKUP_RETENTION_FALLBACK_MAX=120,AUTO_GEAR_BACKUP_GLOBAL_SCOPE=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;function readScopedNumericAutoGearValue(e){if(!AUTO_GEAR_BACKUP_GLOBAL_SCOPE)return null;var t=AUTO_GEAR_BACKUP_GLOBAL_SCOPE[e];return typeof t=="number"&&Number.isFinite(t)?t:null}function normalizeRetentionCandidate(e,t,o){if(typeof e!="number"||!Number.isFinite(e))return null;var r=Math.round(e);return Number.isFinite(r)?r<t?t:r>o?o:r:null}function resolveAutoGearBackupRetentionMinValue(){var e=readScopedNumericAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_MIN_VALUE");if(e!==null)return Math.max(AUTO_GEAR_BACKUP_RETENTION_FALLBACK_MIN,Math.round(e));var t=readScopedNumericAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_MIN");return t!==null?Math.max(AUTO_GEAR_BACKUP_RETENTION_FALLBACK_MIN,Math.round(t)):AUTO_GEAR_BACKUP_RETENTION_FALLBACK_MIN}function resolveAutoGearBackupRetentionMaxValue(){var e=readScopedNumericAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_MAX");return e!==null?Math.max(resolveAutoGearBackupRetentionMinValue(),Math.round(e)):Math.max(resolveAutoGearBackupRetentionMinValue(),AUTO_GEAR_BACKUP_RETENTION_FALLBACK_MAX)}function resolveAutoGearBackupRetentionDefaultValue(){for(var e=resolveAutoGearBackupRetentionMinValue(),t=resolveAutoGearBackupRetentionMaxValue(),o=[readScopedNumericAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_DEFAULT"),readScopedNumericAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_DEFAULT_VALUE"),AUTO_GEAR_BACKUP_RETENTION_FALLBACK_DEFAULT],r=0;r<o.length;r+=1){var n=o[r],a=normalizeRetentionCandidate(n,e,t);if(typeof a=="number")return a}return e}function resolveAutoGearBackupRetentionKey(){if(AUTO_GEAR_BACKUP_GLOBAL_SCOPE&&typeof AUTO_GEAR_BACKUP_GLOBAL_SCOPE.AUTO_GEAR_BACKUP_RETENTION_KEY=="string"){var e=AUTO_GEAR_BACKUP_GLOBAL_SCOPE.AUTO_GEAR_BACKUP_RETENTION_KEY.trim();if(e)return e}return AUTO_GEAR_BACKUP_RETENTION_FALLBACK_KEY}function readAutoGearBackupsFromStorage$1(e){e===void 0&&(e=resolveAutoGearBackupRetentionDefaultValue());var t=[];if(typeof loadAutoGearBackups=="function")try{t=loadAutoGearBackups()}catch(n){console.warn("Failed to load automatic gear backups",n),t=[]}else if(typeof localStorage<"u")try{var o=localStorage.getItem(AUTO_GEAR_BACKUPS_KEY);t=o?JSON.parse(o):[]}catch(n){console.warn("Failed to read automatic gear backups from storage",n),t=[]}if(!Array.isArray(t))return[];var r=clampAutoGearBackupRetentionLimit$1(e);return t.map(normalizeAutoGearBackupEntry).filter(Boolean).sort(function(n,a){return n.createdAt===a.createdAt?0:n.createdAt>a.createdAt?-1:1}).slice(0,r)}function sortAutoGearPresets$1(e){return e.sort(function(t,o){return t.label.localeCompare(o.label,void 0,{sensitivity:"base",numeric:!0})})}function readAutoGearPresetsFromStorage$1(){var e=[];if(typeof loadAutoGearPresets=="function")try{e=loadAutoGearPresets()}catch(o){console.warn("Failed to load automatic gear presets",o),e=[]}else if(typeof localStorage<"u")try{var t=localStorage.getItem(AUTO_GEAR_PRESETS_KEY);e=t?JSON.parse(t):[]}catch(o){console.warn("Failed to read automatic gear presets from storage",o),e=[]}return Array.isArray(e)?sortAutoGearPresets$1(e.map(normalizeAutoGearPreset).filter(Boolean)):[]}function persistAutoGearPresets$1(e){var t=Array.isArray(e)?e.map(function(o){return{id:o.id,label:o.label,rules:Array.isArray(o.rules)?o.rules:[]}}):[];if(typeof saveAutoGearPresets=="function")try{saveAutoGearPresets(t);return}catch(o){console.warn("Failed to save automatic gear presets",o)}if(!(typeof localStorage>"u"))try{localStorage.setItem(AUTO_GEAR_PRESETS_KEY,JSON.stringify(t))}catch(o){console.warn("Failed to persist automatic gear presets",o)}}function readAutoGearMonitorDefaultsFromStorage$1(){var e={};if(typeof loadAutoGearMonitorDefaults=="function")try{e=loadAutoGearMonitorDefaults()}catch(o){console.warn("Failed to load automatic gear monitor defaults",o),e={}}else if(typeof localStorage<"u")try{var t=localStorage.getItem(AUTO_GEAR_MONITOR_DEFAULTS_KEY);e=t?JSON.parse(t):{}}catch(o){console.warn("Failed to read automatic gear monitor defaults from storage",o),e={}}return normalizeAutoGearMonitorDefaults(e)}function persistAutoGearMonitorDefaults$1(e){var t=normalizeAutoGearMonitorDefaults(e);if(typeof saveAutoGearMonitorDefaults=="function")try{return saveAutoGearMonitorDefaults(t),t}catch(o){console.warn("Failed to save automatic gear monitor defaults",o)}if(typeof localStorage>"u")return t;try{localStorage.setItem(AUTO_GEAR_MONITOR_DEFAULTS_KEY,JSON.stringify(t))}catch(o){console.warn("Failed to persist automatic gear monitor defaults",o)}return t}function readActiveAutoGearPresetIdFromStorage$1(){if(typeof loadAutoGearActivePresetId=="function")try{var e=loadAutoGearActivePresetId();return typeof e=="string"?e:""}catch(o){return console.warn("Failed to load automatic gear active preset id",o),""}if(typeof localStorage>"u")return"";try{var t=localStorage.getItem(AUTO_GEAR_ACTIVE_PRESET_KEY);return typeof t=="string"?t:""}catch(o){return console.warn("Failed to read automatic gear active preset id from storage",o),""}}function persistActiveAutoGearPresetId$1(e){if(typeof saveAutoGearActivePresetId=="function")try{saveAutoGearActivePresetId(typeof e=="string"?e:"");return}catch(t){console.warn("Failed to save automatic gear active preset id",t)}if(!(typeof localStorage>"u"))try{e?localStorage.setItem(AUTO_GEAR_ACTIVE_PRESET_KEY,e):localStorage.removeItem(AUTO_GEAR_ACTIVE_PRESET_KEY)}catch(t){console.warn("Failed to persist automatic gear active preset id",t)}}function readAutoGearAutoPresetIdFromStorage$1(){if(typeof loadAutoGearAutoPresetId=="function")try{var e=loadAutoGearAutoPresetId();return typeof e=="string"?e:""}catch(o){return console.warn("Failed to load automatic gear auto preset id",o),""}if(typeof localStorage>"u")return"";try{var t=localStorage.getItem(AUTO_GEAR_AUTO_PRESET_KEY);return typeof t=="string"?t:""}catch(o){return console.warn("Failed to read automatic gear auto preset id from storage",o),""}}function persistAutoGearAutoPresetId$1(e){if(typeof saveAutoGearAutoPresetId=="function")try{saveAutoGearAutoPresetId(typeof e=="string"?e:"");return}catch(t){console.warn("Failed to save automatic gear auto preset id",t)}if(!(typeof localStorage>"u"))try{e?localStorage.setItem(AUTO_GEAR_AUTO_PRESET_KEY,e):localStorage.removeItem(AUTO_GEAR_AUTO_PRESET_KEY)}catch(t){console.warn("Failed to persist automatic gear auto preset id",t)}}function readAutoGearBackupVisibilityFromStorage$1(){if(typeof loadAutoGearBackupVisibility=="function")try{return!!loadAutoGearBackupVisibility()}catch(e){return console.warn("Failed to load automatic gear backup visibility",e),!1}if(typeof localStorage>"u")return!1;try{return localStorage.getItem(AUTO_GEAR_BACKUP_VISIBILITY_KEY)==="1"}catch(e){return console.warn("Failed to read automatic gear backup visibility from storage",e),!1}}function persistAutoGearBackupVisibility$1(e){var t=!!e;if(typeof saveAutoGearBackupVisibility=="function")try{saveAutoGearBackupVisibility(t);return}catch(o){console.warn("Failed to save automatic gear backup visibility",o)}if(!(typeof localStorage>"u"))try{t?localStorage.setItem(AUTO_GEAR_BACKUP_VISIBILITY_KEY,"1"):localStorage.removeItem(AUTO_GEAR_BACKUP_VISIBILITY_KEY)}catch(o){console.warn("Failed to persist automatic gear backup visibility",o)}}function clampAutoGearBackupRetentionLimit$1(e){var t=Number(e);if(!Number.isFinite(t))return resolveAutoGearBackupRetentionDefaultValue();var o=Math.round(t);if(!Number.isFinite(o))return resolveAutoGearBackupRetentionDefaultValue();var r=resolveAutoGearBackupRetentionMinValue(),n=resolveAutoGearBackupRetentionMaxValue();return o<r?r:o>n?n:o}function readAutoGearBackupRetentionFromStorage$1(){if(typeof loadAutoGearBackupRetention=="function")try{return clampAutoGearBackupRetentionLimit$1(loadAutoGearBackupRetention())}catch(r){console.warn("Failed to load automatic gear backup retention",r)}if(typeof localStorage>"u")return resolveAutoGearBackupRetentionDefaultValue();try{var e=localStorage.getItem(resolveAutoGearBackupRetentionKey());if(e==null)return resolveAutoGearBackupRetentionDefaultValue();try{var t=JSON.parse(e);return clampAutoGearBackupRetentionLimit$1(t)}catch(r){var o=Number(e);if(Number.isFinite(o))return clampAutoGearBackupRetentionLimit$1(o);throw r}}catch(r){return console.warn("Failed to read automatic gear backup retention from storage",r),resolveAutoGearBackupRetentionDefaultValue()}}function persistAutoGearBackupRetention$1(e){var t=clampAutoGearBackupRetentionLimit$1(e);if(typeof saveAutoGearBackupRetention=="function")try{return saveAutoGearBackupRetention(t),!0}catch(o){console.warn("Failed to save automatic gear backup retention",o)}if(typeof localStorage>"u")return!1;try{return localStorage.setItem(resolveAutoGearBackupRetentionKey(),JSON.stringify(t)),!0}catch(o){return console.warn("Failed to persist automatic gear backup retention",o),!1}}function persistAutoGearBackups$1(e){var t=Array.isArray(e)?e.map(function(r){return{id:r.id,createdAt:r.createdAt,rules:Array.isArray(r.rules)?r.rules:[],monitorDefaults:normalizeAutoGearMonitorDefaults(r.monitorDefaults),note:typeof r.note=="string"?r.note:void 0}}):[];if(typeof saveAutoGearBackups=="function"){var o=saveAutoGearBackups(t);return Array.isArray(o)?o:t}if(typeof localStorage>"u")throw new Error("Storage unavailable");return localStorage.setItem(AUTO_GEAR_BACKUPS_KEY,JSON.stringify(t)),t}function assignAutoGearGlobalValue(e,t){var o=[];typeof globalThis<"u"&&o.push(globalThis),typeof window<"u"&&o.push(window),typeof self<"u"&&o.push(self),typeof global<"u"&&o.push(global);for(var r=0;r<o.length;r+=1){var n=o[r];if(n&&Object.prototype.hasOwnProperty.call(n,e))return n[e]=t,!0}return!1}function enforceAutoGearBackupRetentionLimit(e){var t=clampAutoGearBackupRetentionLimit$1(e),o=autoGearBackupRetention;if(t===o)return callCoreFunctionIfAvailable("renderAutoGearBackupRetentionControls",[],{defer:!0}),{success:!0,trimmed:[],previousLimit:o};var r=autoGearBackups.slice(),n=[],a=persistAutoGearBackupRetention$1(t);if(!a)return autoGearBackupRetentionInput&&(autoGearBackupRetentionInput.value=String(autoGearBackupRetention)),callCoreFunctionIfAvailable("renderAutoGearBackupRetentionControls",[],{defer:!0}),{success:!1,error:new Error("retention-persist-failed"),previousLimit:o};if(assignAutoGearGlobalValue("autoGearBackupRetention",t),autoGearBackups.length>t){var s=autoGearBackups.slice(0,t);n.push.apply(n,autoGearBackups.slice(t));try{var l=persistAutoGearBackups$1(s)||[],u=Array.isArray(l)?l:[];u.length<s.length&&n.push.apply(n,s.slice(u.length)),assignAutoGearGlobalValue("autoGearBackups",u)}catch(d){console.warn("Failed to trim automatic gear backups to retention limit",d),assignAutoGearGlobalValue("autoGearBackupRetention",o),persistAutoGearBackupRetention$1(o);try{persistAutoGearBackups$1(r)}catch(m){console.warn("Failed to restore automatic gear backups after trim error",m)}return assignAutoGearGlobalValue("autoGearBackups",readAutoGearBackupsFromStorage$1(o)),callCoreFunctionIfAvailable("renderAutoGearBackupControls",[],{defer:!0}),callCoreFunctionIfAvailable("renderAutoGearBackupRetentionControls",[],{defer:!0}),{success:!1,error:d,previousLimit:o}}}return callCoreFunctionIfAvailable("renderAutoGearBackupControls",[],{defer:!0}),callCoreFunctionIfAvailable("renderAutoGearBackupRetentionControls",[],{defer:!0}),{success:!0,trimmed:n,previousLimit:o}}function readAutoGearRulesFromStorage$1(){var e=[];if(typeof loadAutoGearRules<"u"&&typeof loadAutoGearRules=="function")try{e=loadAutoGearRules()}catch(o){console.warn("Failed to load automatic gear rules",o),e=[]}else if(typeof localStorage<"u")try{var t=localStorage.getItem(AUTO_GEAR_RULES_KEY);e=t?JSON.parse(t):[]}catch(o){console.warn("Failed to load automatic gear rules",o),e=[]}return Array.isArray(e)?e.map(normalizeAutoGearRule).filter(Boolean):[]}var AUTO_GEAR_STORAGE_EXPORTS={readAutoGearBackupsFromStorage:readAutoGearBackupsFromStorage$1,readAutoGearPresetsFromStorage:readAutoGearPresetsFromStorage$1,persistAutoGearPresets:persistAutoGearPresets$1,normalizeAutoGearMonitorDefaults,readAutoGearMonitorDefaultsFromStorage:readAutoGearMonitorDefaultsFromStorage$1,persistAutoGearMonitorDefaults:persistAutoGearMonitorDefaults$1,readActiveAutoGearPresetIdFromStorage:readActiveAutoGearPresetIdFromStorage$1,persistActiveAutoGearPresetId:persistActiveAutoGearPresetId$1,readAutoGearAutoPresetIdFromStorage:readAutoGearAutoPresetIdFromStorage$1,persistAutoGearAutoPresetId:persistAutoGearAutoPresetId$1,readAutoGearBackupVisibilityFromStorage:readAutoGearBackupVisibilityFromStorage$1,persistAutoGearBackupVisibility:persistAutoGearBackupVisibility$1,clampAutoGearBackupRetentionLimit:clampAutoGearBackupRetentionLimit$1,readAutoGearBackupRetentionFromStorage:readAutoGearBackupRetentionFromStorage$1,persistAutoGearBackupRetention:persistAutoGearBackupRetention$1,persistAutoGearBackups:persistAutoGearBackups$1,enforceAutoGearBackupRetentionLimit,readAutoGearRulesFromStorage:readAutoGearRulesFromStorage$1};typeof module<"u"&&module.exports&&(module.exports=AUTO_GEAR_STORAGE_EXPORTS);if(typeof globalThis<"u"){var target$2=typeof globalThis.AUTO_GEAR_STORAGE_EXPORTS=="object"&&globalThis.AUTO_GEAR_STORAGE_EXPORTS?globalThis.AUTO_GEAR_STORAGE_EXPORTS:globalThis.AUTO_GEAR_STORAGE_EXPORTS={};Object.assign(target$2,AUTO_GEAR_STORAGE_EXPORTS)}(function(){for(var e=[typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=function(u,d,m){if(!(!u||typeof u!="object"&&typeof u!="function")&&typeof u[d]!="function")try{u[d]=m}catch{try{Object.defineProperty(u,d,{configurable:!0,enumerable:!1,writable:!0,value:m})}catch{}}},o=Object.keys(AUTO_GEAR_STORAGE_EXPORTS),r=0;r<e.length;r+=1){var n=e[r];if(n)for(var a=0;a<o.length;a+=1){var s=o[a],l=AUTO_GEAR_STORAGE_EXPORTS[s];typeof l=="function"&&t(n,s,l)}}})();const autoGearStorage=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function isObject$1(e){return!!e&&(typeof e=="object"||typeof e=="function")}function ensureRequireFn(e){return typeof e=="function"?e:typeof require=="function"?require:null}function ensureArray(e){return Array.isArray(e)?e.slice():[]}function registerScope$1(e,t){!t||!isObject$1(t)||Array.isArray(e)&&e.indexOf(t)===-1&&e.push(t)}function attemptFactory(e,t){if(typeof e!="function")return null;try{const o=e(t);return o&&typeof o=="object"?o:null}catch{}return null}function normalizeBootstrapInvocationOptions(e,t){const o=arguments.length>1,r=o?e:null,n=o?t:e,a={};if(r&&isObject$1(r)&&!Array.isArray(r)){const l=Object.keys(r);for(let u=0;u<l.length;u+=1){const d=l[u];a[d]=r[d]}}a.resolveCoreSupportModule=typeof a.resolveCoreSupportModule=="function"?a.resolveCoreSupportModule:null,a.requireFn=ensureRequireFn(a.requireFn),a.runtimeScope=a.runtimeScope&&isObject$1(a.runtimeScope)?a.runtimeScope:null,a.coreGlobalScope=a.coreGlobalScope&&isObject$1(a.coreGlobalScope)?a.coreGlobalScope:null,a.fallbackScopes=ensureArray(a.fallbackScopes);function s(l){if(!l)return;if(Array.isArray(l)){a.fallbackScopes=l.slice();return}if(!isObject$1(l))return;Array.isArray(l.fallbackScopes)?a.fallbackScopes=l.fallbackScopes.slice():l.fallbackScopes&&(a.fallbackScopes=[l.fallbackScopes]),l.runtimeScope&&isObject$1(l.runtimeScope)&&(a.runtimeScope=l.runtimeScope),l.coreGlobalScope&&isObject$1(l.coreGlobalScope)&&(a.coreGlobalScope=l.coreGlobalScope),typeof l.requireFn=="function"?a.requireFn=l.requireFn:Object.prototype.hasOwnProperty.call(l,"requireFn")&&(a.requireFn=ensureRequireFn(l.requireFn)),typeof l.resolveCoreSupportModule=="function"?a.resolveCoreSupportModule=l.resolveCoreSupportModule:Object.prototype.hasOwnProperty.call(l,"resolveCoreSupportModule")&&(a.resolveCoreSupportModule=null);const u=Object.keys(l);for(let d=0;d<u.length;d+=1){const m=u[d];m==="fallbackScopes"||m==="runtimeScope"||m==="coreGlobalScope"||m==="requireFn"||m==="resolveCoreSupportModule"||(a[m]=l[m])}}return s(n),a.requireFn=ensureRequireFn(a.requireFn),a.fallbackScopes=ensureArray(a.fallbackScopes),a}function collectBootstrapFallbackScopes(e){const t=normalizeBootstrapInvocationOptions(e),o=t.runtimeScope,r=t.coreGlobalScope,n=ensureArray(t.fallbackScopes),a=t.bootstrapEnvironmentTools||t.bootstrapEnvironment||getBootstrapEnvironmentTools(t),s=t.bootstrapResultsTools||getBootstrapResultsTools(t);if(s&&typeof s.collectBootstrapFallbackScopes=="function"){const l=a&&typeof a.collectFallbackScopes=="function"?function(d){try{const m=a.collectFallbackScopes({fallbackScopes:Array.isArray(d)?d:ensureArray(d),runtimeScope:o,coreGlobalScope:r});if(Array.isArray(m))return m}catch{}if(Array.isArray(d))try{const m=a.collectFallbackScopes(d);if(Array.isArray(m))return m}catch{}return null}:null;try{const u=s.collectBootstrapFallbackScopes({fallbackScopes:n,runtimeScope:o,coreGlobalScope:r,collectFallbackScopes:l});if(Array.isArray(u))return u}catch{}}if(a&&typeof a.collectFallbackScopes=="function"){try{const l=a.collectFallbackScopes({fallbackScopes:n,runtimeScope:o,coreGlobalScope:r});if(Array.isArray(l))return l}catch{}if(Array.isArray(n))try{const l=a.collectFallbackScopes(n);if(Array.isArray(l))return l}catch{}}return appendFallbackScopes(n,o,r)}function getBootstrapEnvironmentTools(e){return e&&isObject$1(e.bootstrapEnvironmentTools)?e.bootstrapEnvironmentTools:e&&isObject$1(e.bootstrapEnvironment)?e.bootstrapEnvironment:resolveBootstrapEnvironmentTools(e)}function getBootstrapResultsTools(e){return e&&isObject$1(e.bootstrapResultsTools)?e.bootstrapResultsTools:e&&isObject$1(e.resultsTools)?e.resultsTools:resolveBootstrapResultsTools(e)}function getBootstrapFallbackTools(e){return e&&isObject$1(e.bootstrapFallbackTools)?e.bootstrapFallbackTools:e&&isObject$1(e.fallbackTools)?e.fallbackTools:resolveBootstrapFallbackTools(e)}function getBootstrapResolverTools(e){return e&&isObject$1(e.bootstrapResolverTools)&&hasBootstrapResolverCapabilities(e.bootstrapResolverTools)?e.bootstrapResolverTools:resolveBootstrapResolverTools(e)}function appendFallbackScopes(e,t,o){if(!Array.isArray(e))return[];const r=e.slice();t&&isObject$1(t)&&r.indexOf(t)===-1&&r.push(t),o&&isObject$1(o)&&r.indexOf(o)===-1&&r.push(o);const n=[typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let a=0;a<n.length;a+=1){const s=n[a];!s||!isObject$1(s)||r.indexOf(s)===-1&&r.push(s)}return r}function resolveNamespace(e,t,o){const r=o&&isObject$1(o.directNamespace)?o.directNamespace:null;if(r)return r;const n=o&&typeof o.resolveCoreSupportModule=="function"?o.resolveCoreSupportModule:null;if(n)try{const l=n(e,t);if(l&&isObject$1(l))return l}catch{}const a=ensureRequireFn(o&&o.requireFn);if(typeof a=="function"&&t)try{const l=a(t);if(l&&isObject$1(l))return l}catch{}const s=collectBootstrapFallbackScopes(o);for(let l=0;l<s.length;l+=1){const u=s[l];if(!(!u||!isObject$1(u)))try{const d=u[e];if(d&&isObject$1(d))return d}catch{}}return null}function resolveBootstrapTools(e){return resolveNamespace("cineCoreAppCoreBootstrap","./modules/app-core/bootstrap.js",e)}function resolveBootstrapFallbackTools(e){return resolveNamespace("cineCoreAppCoreBootstrapFallbacks","./modules/app-core/bootstrap.js",e)}function cloneResolverOptions(e,t){const o=e&&typeof e=="object"&&!Array.isArray(e)?Object.assign({},e):{};return!o.directNamespace&&t&&isObject$1(t)&&(o.directNamespace=t),o}function resolveBootstrapEnvironmentTools(e){const t=cloneResolverOptions(e,e&&isObject$1(e.directBootstrapEnvironmentNamespace)?e.directBootstrapEnvironmentNamespace:null);return resolveNamespace("cineCoreAppCoreBootstrapEnvironment","./modules/app-core/bootstrap.js",t)}function resolveBootstrapResultsTools(e){const t=cloneResolverOptions(e,e&&isObject$1(e.directBootstrapResultsNamespace)?e.directBootstrapResultsNamespace:null);return resolveNamespace("cineCoreAppCoreBootstrapResults","./modules/app-core/bootstrap.js",t)}function collectEnvironmentFallbackScopes(e){const t=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,o=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null;return appendFallbackScopes(ensureArray(e&&e.fallbackScopes),t,o)}function hasBootstrapResolverCapabilities(e){return!!e&&typeof e=="object"&&typeof e.resolveBootstrapTools=="function"&&typeof e.resolveBootstrapFallbackTools=="function"&&typeof e.createInlineLocalizationFallback=="function"&&typeof e.createInlineRuntimeSharedFallback=="function"}function resolveBootstrapResolverTools(e){const t=e&&isObject$1(e.directResolverNamespace)?e.directResolverNamespace:null;if(hasBootstrapResolverCapabilities(t))return t;const o={resolveCoreSupportModule:e&&typeof e.resolveCoreSupportModule=="function"?e.resolveCoreSupportModule:null,requireFn:ensureRequireFn(e&&e.requireFn),runtimeScope:e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,coreGlobalScope:e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,fallbackScopes:ensureArray(e&&e.fallbackScopes)},r=resolveNamespace("cineCoreAppCoreBootstrapResolver","./modules/app-core/bootstrap.js",Object.assign({},o,{directNamespace:t}));if(hasBootstrapResolverCapabilities(r))return r;if(r&&isObject$1(r.cineCoreAppCoreBootstrapResolver)&&hasBootstrapResolverCapabilities(r.cineCoreAppCoreBootstrapResolver))return r.cineCoreAppCoreBootstrapResolver;if(r&&isObject$1(r.cineCoreAppCoreBootstrap)&&hasBootstrapResolverCapabilities(r.cineCoreAppCoreBootstrap))return r.cineCoreAppCoreBootstrap;const n=collectBootstrapFallbackScopes(o);for(let a=0;a<n.length;a+=1){const s=n[a];if(!(!s||!isObject$1(s)))try{const l=s.cineCoreAppCoreBootstrapResolver;if(hasBootstrapResolverCapabilities(l))return l;const u=s.cineCoreAppCoreBootstrap;if(hasBootstrapResolverCapabilities(u))return u}catch{}}return null}function resolveBootstrapToolsWithResolver(e){const t=e&&isObject$1(e.bootstrapResolverTools)?e.bootstrapResolverTools:null;if(t&&typeof t.resolveBootstrapTools=="function")try{const s=t.resolveBootstrapTools(e);if(s&&isObject$1(s))return s}catch{}const o=e&&isObject$1(e.directBootstrapNamespace)?e.directBootstrapNamespace:null;if(o&&isObject$1(o))return o;const r=e&&typeof e.resolveCoreSupportModule=="function"?e.resolveCoreSupportModule:null;if(r)try{const s=r("cineCoreAppCoreBootstrap","./modules/app-core/bootstrap.js");if(s&&isObject$1(s))return s}catch{}const n=ensureRequireFn(e&&e.requireFn);if(typeof n=="function")try{const s=n("./modules/app-core/bootstrap.js");if(s&&isObject$1(s))return s}catch{}const a=collectEnvironmentFallbackScopes(e);for(let s=0;s<a.length;s+=1){const l=a[s];if(!(!l||!isObject$1(l)))try{const u=l.cineCoreAppCoreBootstrap;if(u&&isObject$1(u))return u}catch{}}return null}function resolveBootstrapFallbackToolsWithResolver(e){const t=e&&isObject$1(e.bootstrapResolverTools)?e.bootstrapResolverTools:null;if(t&&typeof t.resolveBootstrapFallbackTools=="function")try{const s=t.resolveBootstrapFallbackTools(e);if(s&&isObject$1(s))return s}catch{}const o=e&&isObject$1(e.directBootstrapFallbackNamespace)?e.directBootstrapFallbackNamespace:null;if(o&&isObject$1(o))return o;const r=e&&typeof e.resolveCoreSupportModule=="function"?e.resolveCoreSupportModule:null;if(r)try{const s=r("cineCoreAppCoreBootstrapFallbacks","./modules/app-core/bootstrap.js");if(s&&isObject$1(s))return s}catch{}const n=ensureRequireFn(e&&e.requireFn);if(typeof n=="function")try{const s=n("./modules/app-core/bootstrap.js");if(s&&isObject$1(s.cineCoreAppCoreBootstrapFallbacks))return s.cineCoreAppCoreBootstrapFallbacks;if(s&&isObject$1(s))return s}catch{}const a=collectEnvironmentFallbackScopes(e);for(let s=0;s<a.length;s+=1){const l=a[s];if(!(!l||!isObject$1(l)))try{const u=l.cineCoreAppCoreBootstrapFallbacks;if(u&&isObject$1(u))return u}catch{}}return null}function createInlineLocalizationFallbackWithResolver(e){const t=e&&isObject$1(e.bootstrapResolverTools)?e.bootstrapResolverTools:null;if(t&&typeof t.createInlineLocalizationFallback=="function")try{const r=t.createInlineLocalizationFallback(e);if(r&&isObject$1(r))return r}catch{}const o=e&&isObject$1(e.fallbackTools)?e.fallbackTools:null;if(o&&typeof o.createLocalizationBootstrapFallback=="function")try{const r=o.createLocalizationBootstrapFallback(e);if(r&&isObject$1(r))return r}catch{}return createLocalizationBootstrapFallback()}function createInlineRuntimeSharedFallbackWithResolver(e){const t=e&&isObject$1(e.bootstrapResolverTools)?e.bootstrapResolverTools:null;if(t&&typeof t.createInlineRuntimeSharedFallback=="function")try{const s=t.createInlineRuntimeSharedFallback(e);if(s&&isObject$1(s))return s}catch{}const o=e&&isObject$1(e.fallbackTools)?e.fallbackTools:null;if(o&&typeof o.createRuntimeSharedBootstrapFallback=="function")try{const s=o.createRuntimeSharedBootstrapFallback(e);if(s&&isObject$1(s))return s}catch{}const r=collectEnvironmentFallbackScopes(e);function n(){for(let s=0;s<r.length;s+=1){const l=r[s];if(!(!l||!isObject$1(l)))try{const u=l.cineCoreRuntimeShared;if(u&&isObject$1(u))return u}catch{}}return null}let a=e&&isObject$1(e.currentRuntimeShared)?e.currentRuntimeShared:null;if(a||(a=n()),!a||typeof a!="object")try{a=Object.create(null)}catch{a={}}return{runtimeSharedNamespace:null,runtimeSharedResolver:null,existingRuntimeShared:a,runtimeShared:a,fallbackResolveRuntimeSharedFromGlobal:n}}function createBootstrapEnvironment(e){const t=ensureRequireFn(e&&e.requireFn),o=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,r=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,n=collectEnvironmentFallbackScopes({runtimeScope:o,coreGlobalScope:r,fallbackScopes:e&&e.fallbackScopes}),a=resolveBootstrapResolverTools({directResolverNamespace:e&&e.directResolverNamespace,resolveCoreSupportModule:e&&e.resolveCoreSupportModule,requireFn:t,runtimeScope:o,coreGlobalScope:r,fallbackScopes:n}),s=resolveBootstrapToolsWithResolver({directBootstrapNamespace:e&&e.directBootstrapNamespace,bootstrapResolverTools:a,resolveCoreSupportModule:e&&e.resolveCoreSupportModule,requireFn:t,runtimeScope:o,coreGlobalScope:r,fallbackScopes:n}),l=resolveBootstrapFallbackToolsWithResolver({directBootstrapFallbackNamespace:e&&e.directBootstrapFallbackNamespace,bootstrapResolverTools:a,resolveCoreSupportModule:e&&e.resolveCoreSupportModule,requireFn:t,runtimeScope:o,coreGlobalScope:r,fallbackScopes:n});function u(){return createInlineLocalizationFallbackWithResolver({bootstrapResolverTools:a,fallbackTools:l,resolveCoreSupportModule:e&&e.resolveCoreSupportModule,requireFn:t,runtimeScope:o,coreGlobalScope:r,fallbackScopes:n})}function d(y){const h=y&&y.fallbackScopes?y.fallbackScopes:n;return createInlineRuntimeSharedFallbackWithResolver({bootstrapResolverTools:a,fallbackTools:l,resolveCoreSupportModule:e&&e.resolveCoreSupportModule,requireFn:t,runtimeScope:o,coreGlobalScope:r,fallbackScopes:h,currentRuntimeShared:y&&isObject$1(y.currentRuntimeShared)?y.currentRuntimeShared:null})}function m(y){return collectEnvironmentFallbackScopes({runtimeScope:o,coreGlobalScope:r,fallbackScopes:y})}return{fallbackScopes:n,bootstrapResolverTools:a,bootstrapTools:s,bootstrapFallbackTools:l,createInlineLocalizationFallback:u,createInlineRuntimeSharedFallback:d,collectFallbackScopes:m}}function collectResultsFallbackScopes(e){const t=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,o=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,r=e?e.fallbackScopes:null;if(e&&typeof e.collectFallbackScopes=="function")try{const a=e.collectFallbackScopes(r);if(Array.isArray(a)){const s=ensureArray(a);return registerScope$1(s,t),registerScope$1(s,o),registerScope$1(s,typeof globalThis<"u"?globalThis:null),registerScope$1(s,typeof window<"u"?window:null),registerScope$1(s,typeof self<"u"?self:null),registerScope$1(s,typeof global<"u"?global:null),s}}catch{}const n=ensureArray(r);return registerScope$1(n,t),registerScope$1(n,o),registerScope$1(n,typeof globalThis<"u"?globalThis:null),registerScope$1(n,typeof window<"u"?window:null),registerScope$1(n,typeof self<"u"?self:null),registerScope$1(n,typeof global<"u"?global:null),n}function createLocalizationFallbackSkeleton(){return{localizationSupport:null,localizationRuntimeEnvironment:null,localizationBridge:null,localizationFallbacks:null,inlineLocalizationFallbacks:null,localizationFallbackSupport:null,createBasicLocalizationFallbackResolvers(){return null},localizationFallbackRegistry:{createFallbackResolvers(){return null}},localizationFallbackResolvers:null,localizationFallbackNamespace:null,fallbackResolveLocaleModule(){return null},createLocaleFallbacks(){return null}}}function createRuntimeSharedFallbackSkeleton(e){const t=collectResultsFallbackScopes(e||null),o=e&&isObject$1(e.currentRuntimeShared)?e.currentRuntimeShared:null;function r(){for(let a=0;a<t.length;a+=1){const s=t[a];if(isObject$1(s))try{const l=s.cineCoreRuntimeShared;if(l&&typeof l=="object")return l}catch{}}return null}let n=o;if((!n||typeof n!="object")&&(n=r()),!n||typeof n!="object")try{n=Object.create(null)}catch{n={}}return{runtimeSharedNamespace:null,runtimeSharedResolver:null,existingRuntimeShared:n,runtimeShared:n,fallbackResolveRuntimeSharedFromGlobal:r}}function resolveLocalizationBootstrapResult(e){const t=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,o=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,r=collectResultsFallbackScopes({runtimeScope:t,coreGlobalScope:o,fallbackScopes:e&&e.fallbackScopes,collectFallbackScopes:e&&e.collectFallbackScopes}),n=ensureRequireFn(e&&e.requireFn),a=e&&typeof e.resolveCoreSupportModule=="function"?e.resolveCoreSupportModule:null,s={localizationSupportTools:e&&isObject$1(e.localizationSupportTools)?e.localizationSupportTools:null,localizationBootstrapTools:e&&isObject$1(e.localizationBootstrapTools)?e.localizationBootstrapTools:null,localizationRuntimeTools:e&&isObject$1(e.localizationRuntimeTools)?e.localizationRuntimeTools:null,resolveCoreSupportModule:a,requireFn:n,runtimeScope:t,coreGlobalScope:o,fallbackScopes:r,currentLocalization:e&&isObject$1(e.currentLocalization)?e.currentLocalization:null},l=e&&isObject$1(e.bootstrapTools)?e.bootstrapTools:null;let u=attemptFactory(l&&l.createLocalizationBootstrapResult,s);if(u||(u=attemptFactory(l&&l.createLocalizationBootstrapFallback,s)),!u){const d=e&&typeof e.createInlineLocalizationFallback=="function"?e.createInlineLocalizationFallback:null;u=attemptFactory(d,{fallbackTools:e&&isObject$1(e.bootstrapFallbackTools)?e.bootstrapFallbackTools:null,resolveCoreSupportModule:a,requireFn:n,runtimeScope:t,coreGlobalScope:o,fallbackScopes:r,localizationFallbackOptions:e&&e.localizationFallbackOptions?e.localizationFallbackOptions:null})}return u||(u=createLocalizationFallbackSkeleton()),u}function resolveRuntimeSharedBootstrapResult(e){const t=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,o=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,r=collectResultsFallbackScopes({runtimeScope:t,coreGlobalScope:o,fallbackScopes:e&&e.fallbackScopes,collectFallbackScopes:e&&e.collectFallbackScopes}),n=ensureRequireFn(e&&e.requireFn),a=e&&typeof e.resolveCoreSupportModule=="function"?e.resolveCoreSupportModule:null,s={runtimeSharedBootstrapResolverTools:e&&isObject$1(e.runtimeSharedBootstrapResolverTools)?e.runtimeSharedBootstrapResolverTools:null,runtimeSharedBootstrapTools:e&&isObject$1(e.runtimeSharedBootstrapTools)?e.runtimeSharedBootstrapTools:null,runtimeSharedNamespaceTools:e&&isObject$1(e.runtimeSharedNamespaceTools)?e.runtimeSharedNamespaceTools:null,runtimeSharedBootstrapInlineTools:e&&isObject$1(e.runtimeSharedBootstrapInlineTools)?e.runtimeSharedBootstrapInlineTools:null,runtimeSharedBootstrapResultTools:e&&isObject$1(e.runtimeSharedBootstrapResultTools)?e.runtimeSharedBootstrapResultTools:null,runtimeSharedBootstrapLoaderTools:e&&isObject$1(e.runtimeSharedBootstrapLoaderTools)?e.runtimeSharedBootstrapLoaderTools:null,runtimeSharedBootstrapManagerTools:e&&isObject$1(e.runtimeSharedBootstrapManagerTools)?e.runtimeSharedBootstrapManagerTools:null,resolveCoreSupportModule:a,requireFn:n,runtimeScope:t,coreGlobalScope:o,currentRuntimeShared:e&&isObject$1(e.currentRuntimeShared)?e.currentRuntimeShared:null,fallbackScopes:r,runtimeSharedBootstrapInlineRequirePath:e&&e.runtimeSharedBootstrapInlineRequirePath?e.runtimeSharedBootstrapInlineRequirePath:null,runtimeSharedBootstrapResultRequirePath:e&&e.runtimeSharedBootstrapResultRequirePath?e.runtimeSharedBootstrapResultRequirePath:null},l=e&&isObject$1(e.bootstrapTools)?e.bootstrapTools:null;let u=attemptFactory(l&&l.createRuntimeSharedBootstrapResult,s);if(u||(u=attemptFactory(l&&l.createRuntimeSharedBootstrapFallback,s)),!u){const d=e&&typeof e.createInlineRuntimeSharedFallback=="function"?e.createInlineRuntimeSharedFallback:null;u=attemptFactory(d,{fallbackTools:e&&isObject$1(e.bootstrapFallbackTools)?e.bootstrapFallbackTools:null,resolveCoreSupportModule:a,requireFn:n,runtimeScope:t,coreGlobalScope:o,fallbackScopes:r,currentRuntimeShared:e&&isObject$1(e.currentRuntimeShared)?e.currentRuntimeShared:null})}return u||(u=createRuntimeSharedFallbackSkeleton({runtimeScope:t,coreGlobalScope:o,fallbackScopes:r,currentRuntimeShared:e&&isObject$1(e.currentRuntimeShared)?e.currentRuntimeShared:null})),u}function createLocalizationBootstrapFallback(){return{localizationSupport:null,localizationRuntimeEnvironment:null,localizationBridge:null,localizationFallbacks:null,inlineLocalizationFallbacks:null,localizationFallbackSupport:null,createBasicLocalizationFallbackResolvers(){return null},localizationFallbackRegistry:{createFallbackResolvers(){return null}},localizationFallbackResolvers:null,localizationFallbackNamespace:null,fallbackResolveLocaleModule(){return null},createLocaleFallbacks(){return null}}}function createLocalizationBootstrapResult(e){const t=e&&isObject$1(e.localizationSupportTools)?e.localizationSupportTools:null,o=e&&isObject$1(e.localizationBootstrapTools)?e.localizationBootstrapTools:null,r=e&&isObject$1(e.localizationRuntimeTools)?e.localizationRuntimeTools:null,n=e&&typeof e.resolveCoreSupportModule=="function"?e.resolveCoreSupportModule:null,a=ensureRequireFn(e&&e.requireFn),s=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,l=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,u=appendFallbackScopes(ensureArray(e&&e.fallbackScopes),s,l),d={localizationSupportTools:t,resolveCoreSupportModule:n,requireFn:a,runtimeScope:s,coreGlobalScope:l,fallbackScopes:u};let m=attemptFactory(o&&o.createLocalizationBootstrapResult,d);return m||(m=attemptFactory(r&&r.resolveRuntimeLocalization,{currentLocalization:e&&e.currentLocalization,resolveCoreSupportModule:n,requireFn:a,runtimeScope:s,coreGlobalScope:l,fallbackScopes:u})),m||(m=attemptFactory(r&&r.createFallbackLocalizationRuntimeSetup,{currentLocalization:e&&e.currentLocalization,resolveCoreSupportModule:n,requireFn:a,runtimeScope:s,coreGlobalScope:l,fallbackScopes:u})),m||(m=createLocalizationBootstrapFallback()),m}function createInlineLocalizationFallback(e){const t=normalizeBootstrapInvocationOptions(e),o=t.runtimeScope,r=t.coreGlobalScope,n=t.requireFn,a=t.bootstrapEnvironmentTools||t.bootstrapEnvironment||getBootstrapEnvironmentTools(t),s=t.bootstrapResultsTools||getBootstrapResultsTools(t),l=t.localizationFallbackOptions||null,u=normalizeBootstrapInvocationOptions(t,{bootstrapEnvironmentTools:a,bootstrapEnvironment:a,bootstrapResultsTools:s,fallbackScopes:t.fallbackScopes}),d=collectBootstrapFallbackScopes(u);u.fallbackScopes=d;const m=t.bootstrapResolverTools||getBootstrapResolverTools(u),y=t.bootstrapFallbackTools||t.fallbackTools||getBootstrapFallbackTools(u),h=t.bootstrapSuite&&isObject$1(t.bootstrapSuite)?t.bootstrapSuite:null;if(m&&typeof m.createInlineLocalizationFallback=="function")try{const b=m.createInlineLocalizationFallback({fallbackTools:y,resolveCoreSupportModule:t.resolveCoreSupportModule,requireFn:n,runtimeScope:o,coreGlobalScope:r,fallbackScopes:d,localizationFallbackOptions:l});if(b&&isObject$1(b))return b}catch{}if(h&&typeof h.createLocalizationBootstrapFallback=="function")try{const b=h.createLocalizationBootstrapFallback({fallbackScopes:d,runtimeScope:o,coreGlobalScope:r,localizationFallbackOptions:l});if(b&&isObject$1(b))return b}catch{}if(y&&typeof y.createLocalizationBootstrapFallback=="function")try{const b=y.createLocalizationBootstrapFallback({resolveCoreSupportModule:t.resolveCoreSupportModule,requireFn:n,runtimeScope:o,coreGlobalScope:r,fallbackScopes:d,localizationFallbackOptions:l});if(b&&isObject$1(b))return b}catch{}if(s&&typeof s.createLocalizationFallbackSkeleton=="function")try{const b=s.createLocalizationFallbackSkeleton();if(b&&isObject$1(b))return b}catch{}return createLocalizationBootstrapFallback()}function createRuntimeSharedBootstrapFallback(e){const t=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,o=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,r=appendFallbackScopes(ensureArray(e&&e.fallbackScopes),t,o),n=e&&isObject$1(e.currentRuntimeShared)?e.currentRuntimeShared:null;function a(){for(let l=0;l<r.length;l+=1){const u=r[l];if(!(!u||!isObject$1(u)))try{const d=u.cineCoreRuntimeShared;if(d&&typeof d=="object")return d}catch{}}return null}let s=n;if((!s||typeof s!="object")&&(s=a()),!s||typeof s!="object")try{s=Object.create(null)}catch{s={}}return{runtimeSharedNamespace:null,runtimeSharedResolver:null,existingRuntimeShared:s,runtimeShared:s,fallbackResolveRuntimeSharedFromGlobal:a}}function createInlineRuntimeSharedFallback$1(e){const t=normalizeBootstrapInvocationOptions(e),o=t.runtimeScope,r=t.coreGlobalScope,n=t.requireFn,a=t.bootstrapEnvironmentTools||t.bootstrapEnvironment||getBootstrapEnvironmentTools(t),s=t.bootstrapResultsTools||getBootstrapResultsTools(t),l=t.currentRuntimeShared&&isObject$1(t.currentRuntimeShared)?t.currentRuntimeShared:null,u=normalizeBootstrapInvocationOptions(t,{bootstrapEnvironmentTools:a,bootstrapEnvironment:a,bootstrapResultsTools:s,fallbackScopes:t.fallbackScopes,currentRuntimeShared:l}),d=collectBootstrapFallbackScopes(u);u.fallbackScopes=d,u.currentRuntimeShared=l;const m=t.bootstrapResolverTools||getBootstrapResolverTools(u),y=t.bootstrapFallbackTools||t.fallbackTools||getBootstrapFallbackTools(u),h=t.bootstrapSuite&&isObject$1(t.bootstrapSuite)?t.bootstrapSuite:null;if(m&&typeof m.createInlineRuntimeSharedFallback=="function")try{const b=m.createInlineRuntimeSharedFallback({fallbackTools:y,resolveCoreSupportModule:t.resolveCoreSupportModule,requireFn:n,runtimeScope:o,coreGlobalScope:r,fallbackScopes:d,currentRuntimeShared:l});if(b&&isObject$1(b))return b}catch{}if(h&&typeof h.createRuntimeSharedBootstrapFallback=="function")try{const b=h.createRuntimeSharedBootstrapFallback({fallbackScopes:d,runtimeScope:o,coreGlobalScope:r,currentRuntimeShared:l});if(b&&isObject$1(b))return b}catch{}if(y&&typeof y.createRuntimeSharedBootstrapFallback=="function")try{const b=y.createRuntimeSharedBootstrapFallback({resolveCoreSupportModule:t.resolveCoreSupportModule,requireFn:n,runtimeScope:o,coreGlobalScope:r,fallbackScopes:d,currentRuntimeShared:l});if(b&&isObject$1(b))return b}catch{}if(s&&typeof s.createRuntimeSharedFallbackSkeleton=="function")try{const b=s.createRuntimeSharedFallbackSkeleton({runtimeScope:o,coreGlobalScope:r,fallbackScopes:d,currentRuntimeShared:l});if(b&&isObject$1(b))return b}catch{}return createRuntimeSharedFallbackSkeleton({runtimeScope:o,coreGlobalScope:r,fallbackScopes:d,currentRuntimeShared:l})}function createRuntimeSharedBootstrapResult(e){const t=e&&isObject$1(e.runtimeSharedBootstrapResolverTools)?e.runtimeSharedBootstrapResolverTools:null,o=e&&isObject$1(e.runtimeSharedBootstrapTools)?e.runtimeSharedBootstrapTools:null,r=e&&isObject$1(e.runtimeSharedNamespaceTools)?e.runtimeSharedNamespaceTools:null,n=e&&isObject$1(e.runtimeSharedBootstrapInlineTools)?e.runtimeSharedBootstrapInlineTools:null,a=e&&isObject$1(e.runtimeSharedBootstrapResultTools)?e.runtimeSharedBootstrapResultTools:null,s=e&&isObject$1(e.runtimeSharedBootstrapLoaderTools)?e.runtimeSharedBootstrapLoaderTools:null,l=e&&isObject$1(e.runtimeSharedBootstrapManagerTools)?e.runtimeSharedBootstrapManagerTools:null,u=e&&typeof e.resolveCoreSupportModule=="function"?e.resolveCoreSupportModule:null,d=ensureRequireFn(e&&e.requireFn),m=e&&isObject$1(e.runtimeScope)?e.runtimeScope:null,y=e&&isObject$1(e.coreGlobalScope)?e.coreGlobalScope:null,h=appendFallbackScopes(ensureArray(e&&e.fallbackScopes),m,y),b=e&&isObject$1(e.currentRuntimeShared)?e.currentRuntimeShared:null,v={runtimeSharedBootstrapTools:o,runtimeSharedNamespaceTools:r,runtimeSharedBootstrapInlineTools:n,runtimeSharedBootstrapResultTools:a,runtimeSharedBootstrapLoaderTools:s,runtimeSharedBootstrapManagerTools:l,resolveCoreSupportModule:u,requireFn:d,runtimeScope:m,coreGlobalScope:y,currentRuntimeShared:b,fallbackScopes:h};let C=attemptFactory(t&&t.createRuntimeSharedBootstrapResult,v);return C||(C=attemptFactory(s&&s.resolveRuntimeSharedBootstrapResult,{bootstrapOptions:v,runtimeSharedBootstrapInlineTools:n,resultTools:a,requireFn:d,inlineRequirePath:e&&e.runtimeSharedBootstrapInlineRequirePath,resultModulePath:e&&e.runtimeSharedBootstrapResultRequirePath})),C||(C=attemptFactory(a&&a.createRuntimeSharedBootstrapResult,{bootstrapOptions:{runtimeSharedBootstrapTools:o,runtimeSharedNamespaceTools:r,resolveCoreSupportModule:u,requireFn:d,runtimeScope:m,coreGlobalScope:y,currentRuntimeShared:b,fallbackScopes:h},runtimeSharedBootstrapInlineTools:n,requireFn:d,inlineRequirePath:e&&e.runtimeSharedBootstrapInlineRequirePath})),!C&&a&&(C=attemptFactory(a.createRuntimeSharedBootstrapInlineFallback,{runtimeScope:m,coreGlobalScope:y,fallbackScopes:h,currentRuntimeShared:b})),C||(C=createRuntimeSharedBootstrapFallback({runtimeScope:m,coreGlobalScope:y,fallbackScopes:h,currentRuntimeShared:b})),C}function createBootstrapSuite(e){const t=normalizeBootstrapInvocationOptions(e),o=t.requireFn,r=resolveBootstrapTools(cloneResolverOptions(t,t.directBootstrapNamespace||null))||null,n=resolveBootstrapFallbackTools(cloneResolverOptions(t,t.directBootstrapFallbackNamespace||null))||null,a=resolveBootstrapEnvironmentTools(cloneResolverOptions(t,t.directBootstrapEnvironmentNamespace||null))||null,s=resolveBootstrapResultsTools(cloneResolverOptions(t,t.directBootstrapResultsNamespace||null))||null;function l(w){const R={resolveCoreSupportModule:t&&typeof t.resolveCoreSupportModule=="function"?t.resolveCoreSupportModule:null,requireFn:o,runtimeScope:t&&isObject$1(t.runtimeScope)?t.runtimeScope:null,coreGlobalScope:t&&isObject$1(t.coreGlobalScope)?t.coreGlobalScope:null},_=[];if(Array.isArray(t.fallbackScopes))for(let G=0;G<t.fallbackScopes.length;G+=1)_.push(t.fallbackScopes[G]);if(w&&typeof w=="object"){const G=Object.keys(w);for(let O=0;O<G.length;O+=1){const B=G[O];if(B==="fallbackScopes"){const $=w[B];if(Array.isArray($))for(let V=0;V<$.length;V+=1)_.push($[V]);else $&&isObject$1($)&&_.push($);continue}R[B]=w[B]}}return R.fallbackScopes=_,normalizeBootstrapInvocationOptions(R)}function u(w){const R=l(w),_=ensureArray(R.fallbackScopes),G=R.runtimeScope,O=R.coreGlobalScope;if(s&&typeof s.collectBootstrapFallbackScopes=="function"){const B=a&&typeof a.collectFallbackScopes=="function"?function(V){return a.collectFallbackScopes({fallbackScopes:Array.isArray(V)?V:ensureArray(V),runtimeScope:G,coreGlobalScope:O})}:null;try{const $=s.collectBootstrapFallbackScopes({fallbackScopes:_,runtimeScope:G,coreGlobalScope:O,collectFallbackScopes:B});if(Array.isArray($))return $}catch{}}return collectBootstrapFallbackScopes({runtimeScope:G,coreGlobalScope:O,fallbackScopes:_})}function d(w){if(a&&typeof a.createBootstrapEnvironment=="function"){const R=l(w);!R.directResolverNamespace&&t.directResolverNamespace&&(R.directResolverNamespace=t.directResolverNamespace),!R.directBootstrapNamespace&&r&&(R.directBootstrapNamespace=r),!R.directBootstrapFallbackNamespace&&n&&(R.directBootstrapFallbackNamespace=n);try{return a.createBootstrapEnvironment(R)}catch{}}return null}function m(w){const R=l(w);if(R.fallbackScopes=u(w),!R.bootstrapTools&&r&&(R.bootstrapTools=r),!R.bootstrapFallbackTools&&n&&(R.bootstrapFallbackTools=n),R.createInlineLocalizationFallback||(R.createInlineLocalizationFallback=(a&&typeof a.createInlineLocalizationFallback=="function"?a.createInlineLocalizationFallback:null)||(r&&typeof r.createInlineLocalizationFallback=="function"?r.createInlineLocalizationFallback:createInlineLocalizationFallback)),s&&typeof s.resolveLocalizationBootstrapResult=="function")try{const _=s.resolveLocalizationBootstrapResult(R);if(_&&isObject$1(_))return _}catch{}return createLocalizationBootstrapResult(R)}function y(w){const R=l(w);if(R.fallbackScopes=u(w),!R.fallbackTools&&n&&(R.fallbackTools=n),s&&typeof s.createLocalizationFallbackSkeleton=="function")try{const _=s.createLocalizationFallbackSkeleton(R);if(_&&isObject$1(_))return _}catch{}if(n&&typeof n.createLocalizationBootstrapFallback=="function")try{const _=n.createLocalizationBootstrapFallback(R.localizationFallbackOptions||null);if(_&&isObject$1(_))return _}catch{}return createLocalizationBootstrapFallback()}function h(w){const R=l(w);if(R.fallbackScopes=u(w),!R.bootstrapTools&&r&&(R.bootstrapTools=r),!R.bootstrapFallbackTools&&n&&(R.bootstrapFallbackTools=n),R.createInlineRuntimeSharedFallback||(R.createInlineRuntimeSharedFallback=(a&&typeof a.createInlineRuntimeSharedFallback=="function"?a.createInlineRuntimeSharedFallback:null)||(r&&typeof r.createInlineRuntimeSharedFallback=="function"?r.createInlineRuntimeSharedFallback:createInlineRuntimeSharedFallback$1)),s&&typeof s.resolveRuntimeSharedBootstrapResult=="function")try{const _=s.resolveRuntimeSharedBootstrapResult(R);if(_&&isObject$1(_))return _}catch{}return createRuntimeSharedBootstrapResult(R)}function b(w){const R=l(w);if(R.fallbackScopes=u(w),s&&typeof s.createRuntimeSharedFallbackSkeleton=="function")try{const _=s.createRuntimeSharedFallbackSkeleton(R);if(_&&isObject$1(_))return _}catch{}if(n&&typeof n.createRuntimeSharedBootstrapFallback=="function")try{const _=n.createRuntimeSharedBootstrapFallback(R);if(_&&isObject$1(_))return _}catch{}return createRuntimeSharedBootstrapFallback(R)}function v(w){const R=l(w);return R.fallbackScopes=u(w),!R.fallbackTools&&n&&(R.fallbackTools=n),createInlineLocalizationFallback(R)}function C(w){const R=l(w);return R.fallbackScopes=u(w),!R.fallbackTools&&n&&(R.fallbackTools=n),createInlineRuntimeSharedFallback$1(R)}const A={bootstrapTools:r,bootstrapFallbackTools:n,bootstrapEnvironmentTools:a,bootstrapResultsTools:s,collectBootstrapFallbackScopes:u,createBootstrapEnvironment:d,createLocalizationBootstrapResult:m,createLocalizationBootstrapFallback:y,createRuntimeSharedBootstrapResult:h,createRuntimeSharedBootstrapFallback:b,createInlineLocalizationFallback:v,createInlineRuntimeSharedFallback:C,resolveBootstrapTools,resolveBootstrapFallbackTools,resolveBootstrapEnvironmentTools,resolveBootstrapResultsTools};try{A.bootstrapEnvironment=d(t.bootstrapEnvironmentOptions||null)}catch{A.bootstrapEnvironment=null}return A}const cineCoreAppCoreBootstrap={createLocalizationBootstrapResult,createLocalizationBootstrapFallback,createRuntimeSharedBootstrapResult,createRuntimeSharedBootstrapFallback,normalizeBootstrapInvocationOptions,collectBootstrapFallbackScopes,resolveBootstrapTools,resolveBootstrapFallbackTools,resolveBootstrapEnvironmentTools,resolveBootstrapResultsTools,createInlineLocalizationFallback,createInlineRuntimeSharedFallback:createInlineRuntimeSharedFallback$1,createBootstrapSuite,resolveBootstrapResolverTools,createBootstrapEnvironment},namespace$5=cineCoreAppCoreBootstrap,globalScope$8=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},cineCoreAppCoreBootstrapFallbacks={createLocalizationBootstrapFallback,createRuntimeSharedBootstrapFallback},fallbackNamespace=cineCoreAppCoreBootstrapFallbacks,cineCoreAppCoreBootstrapEnvironment={createBootstrapEnvironment,resolveBootstrapResolverTools,resolveBootstrapTools:resolveBootstrapToolsWithResolver,resolveBootstrapFallbackTools:resolveBootstrapFallbackToolsWithResolver,createInlineLocalizationFallback:createInlineLocalizationFallbackWithResolver,createInlineRuntimeSharedFallback:createInlineRuntimeSharedFallbackWithResolver,collectFallbackScopes:collectEnvironmentFallbackScopes,normalizeBootstrapInvocationOptions},environmentNamespace=cineCoreAppCoreBootstrapEnvironment,cineCoreAppCoreBootstrapResults={resolveLocalizationBootstrapResult,resolveRuntimeSharedBootstrapResult,collectBootstrapFallbackScopes(e){return collectResultsFallbackScopes(e||null)},createLocalizationFallbackSkeleton,createRuntimeSharedFallbackSkeleton},resultsNamespace=cineCoreAppCoreBootstrapResults,namespaceName="cineCoreAppCoreBootstrap",existing$4=isObject$1(globalScope$8)&&isObject$1(globalScope$8[namespaceName])?globalScope$8[namespaceName]:{};Object.assign(existing$4,namespace$5);const fallbackNamespaceName="cineCoreAppCoreBootstrapFallbacks",existingFallbacks=isObject$1(globalScope$8)&&isObject$1(globalScope$8[fallbackNamespaceName])?globalScope$8[fallbackNamespaceName]:{};Object.assign(existingFallbacks,fallbackNamespace);const environmentNamespaceName="cineCoreAppCoreBootstrapEnvironment",existingEnvironment=isObject$1(globalScope$8)&&isObject$1(globalScope$8[environmentNamespaceName])?globalScope$8[environmentNamespaceName]:{};Object.assign(existingEnvironment,environmentNamespace);const resultsNamespaceName="cineCoreAppCoreBootstrapResults",existingResults=isObject$1(globalScope$8)&&isObject$1(globalScope$8[resultsNamespaceName])?globalScope$8[resultsNamespaceName]:{};Object.assign(existingResults,resultsNamespace);const cineCoreAppCoreBootstrapResolver={resolveBootstrapTools,resolveBootstrapFallbackTools,resolveBootstrapEnvironmentTools,resolveBootstrapResultsTools,resolveBootstrapResolverTools,createInlineLocalizationFallback,createInlineRuntimeSharedFallback:createInlineRuntimeSharedFallback$1,createBootstrapSuite,normalizeBootstrapInvocationOptions,collectBootstrapFallbackScopes},resolverNamespace=cineCoreAppCoreBootstrapResolver,resolverNamespaceName="cineCoreAppCoreBootstrapResolver",existingResolver=isObject$1(globalScope$8)&&isObject$1(globalScope$8[resolverNamespaceName])?globalScope$8[resolverNamespaceName]:existing$4;Object.assign(existingResolver,resolverNamespace);isObject$1(existing$4)&&(existing$4.fallbacks=isObject$1(existing$4.fallbacks)?Object.assign(existing$4.fallbacks,fallbackNamespace):existingFallbacks,existing$4.environment=isObject$1(existing$4.environment)?Object.assign(existing$4.environment,environmentNamespace):existingEnvironment,existing$4.results=isObject$1(existing$4.results)?Object.assign(existing$4.results,resultsNamespace):existingResults,existing$4.resolver=isObject$1(existing$4.resolver)?Object.assign(existing$4.resolver,resolverNamespace):existingResolver);if(isObject$1(globalScope$8)){try{globalScope$8[namespaceName]=existing$4}catch{}try{globalScope$8[resolverNamespaceName]=existingResolver}catch{}try{globalScope$8[fallbackNamespaceName]=existingFallbacks}catch{}try{globalScope$8[environmentNamespaceName]=existingEnvironment}catch{}try{globalScope$8[resultsNamespaceName]=existingResults}catch{}}const _globalScope$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};_globalScope$1.cineCoreAppLocalizationSupport=_globalScope$1.cineCoreAppLocalizationSupport||{};_globalScope$1.cineCoreAppLocalizationBootstrap=_globalScope$1.cineCoreAppLocalizationBootstrap||{};_globalScope$1.cineCoreAppRuntimeLocalization=_globalScope$1.cineCoreAppRuntimeLocalization||{};_globalScope$1.cineCoreAppLocalizationAccessors=_globalScope$1.cineCoreAppLocalizationAccessors||{};const cineCoreAppLocalizationSupport=_globalScope$1.cineCoreAppLocalizationSupport,cineCoreAppLocalizationBootstrap=_globalScope$1.cineCoreAppLocalizationBootstrap,cineCoreAppRuntimeLocalization=_globalScope$1.cineCoreAppRuntimeLocalization;(function(){function e(m){return!!m&&(typeof m=="object"||typeof m=="function")}function t(m){return e(m)?m:typeof globalThis<"u"&&e(globalThis)?globalThis:typeof window<"u"&&e(window)?window:typeof self<"u"&&e(self)?self:typeof global<"u"&&e(global)?global:null}function o(m){return typeof m=="function"?m:typeof require=="function"?require:null}function r(m,y,h){if(typeof m=="function")return m;const b=t(h);if(e(b)&&typeof b.resolveCoreSupportModule=="function")try{return b.resolveCoreSupportModule.bind(b)}catch{}if(e(b)&&b.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof b.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule=="function")try{return b.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule.bind(b.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS)}catch{}return typeof y=="function"?function(C,A){if(typeof C!="string"||!C||typeof A!="string"||!A)return null;try{const w=y(A);return e(w)?w:null}catch{}return null}:function(){return null}}function n(m,y){return e(m)?m:t(y)}function a(m){const y=o(m&&m.requireFn),h=n(m&&m.runtimeScope),b=n(m&&m.coreGlobalScope,h),v=r(m&&m.resolveCoreSupportModule,y,h||b),C=v("cineCoreLocalizationRuntimeEnvironment","../core/localization-runtime-environment.js"),A=C&&typeof C.createLocalizationRuntimeEnvironment=="function"?C.createLocalizationRuntimeEnvironment({resolveCoreSupportModule:v,requireFn:y,runtimeScope:h,coreGlobalScope:b}):null,w=A&&e(A.coreLocalizationBridge)?A.coreLocalizationBridge:null,R=A&&e(A.coreLocalizationFallbacks)?A.coreLocalizationFallbacks:null,_=A&&e(A.coreInlineLocalizationFallbacks)?A.coreInlineLocalizationFallbacks:null,G=A&&typeof A.localizationFallbackSupport<"u"?A.localizationFallbackSupport:null,O=A&&typeof A.createBasicLocalizationFallbackResolvers=="function"?A.createBasicLocalizationFallbackResolvers:function(){return null},B=A&&e(A.localizationFallbackRegistry)?A.localizationFallbackRegistry:{createFallbackResolvers(z){return O(z)}},$=A&&e(A.localizationFallbackResolvers)?A.localizationFallbackResolvers:B&&typeof B.createFallbackResolvers=="function"?B.createFallbackResolvers({directNamespace:R,inlineNamespace:_}):O({directNamespace:R,inlineNamespace:_}),V=A&&typeof A.localizationFallbackNamespace<"u"?A.localizationFallbackNamespace:null,M=A&&typeof A.fallbackResolveLocaleModule=="function"?A.fallbackResolveLocaleModule:function(){return null},F=A&&typeof A.createLocaleFallbacks=="function"?A.createLocaleFallbacks:function(){return null};return{localizationRuntimeEnvironment:A,localizationBridge:w,localizationFallbacks:R,inlineLocalizationFallbacks:_,localizationFallbackSupport:G,createBasicLocalizationFallbackResolvers:O,localizationFallbackRegistry:B,localizationFallbackResolvers:$,localizationFallbackNamespace:V,fallbackResolveLocaleModule:M,createLocaleFallbacks:F}}const s={createAppLocalizationSupport:a},l=t(),u="cineCoreAppLocalizationSupport",d=e(l)&&e(l[u])?l[u]:{};for(const m of Object.keys(s))d[m]=s[m];if(e(l))try{l[u]=d}catch{}typeof module=="object"&&module&&module.exports&&(module.exports=d)})();(function(){function e(C){return!!C&&(typeof C=="object"||typeof C=="function")}function t(C){return e(C)?C:typeof globalThis<"u"&&e(globalThis)?globalThis:typeof window<"u"&&e(window)?window:typeof self<"u"&&e(self)?self:typeof global<"u"&&e(global)?global:null}function o(C){return typeof C=="function"?C:typeof require=="function"?require:null}function r(C,A){return e(C)?C:t(A)}function n(C,A,w){if(typeof C=="function")return C;const R=r(w);if(R&&typeof R.resolveCoreSupportModule=="function")try{return R.resolveCoreSupportModule.bind(R)}catch{}if(R&&R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule=="function")try{return R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule.bind(R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS)}catch{}return typeof A=="function"?function(G,O){if(typeof G!="string"||!G||typeof O!="string"||!O)return null;try{const B=A(O);return e(B)?B:null}catch{}return null}:function(){return null}}function a(C,A){e(A)&&C.indexOf(A)===-1&&C.push(A)}function s(C,A,w){const R=Array.isArray(C)?C.slice():[];return a(R,A),a(R,w),a(R,typeof globalThis<"u"?globalThis:null),a(R,typeof window<"u"?window:null),a(R,typeof self<"u"?self:null),a(R,typeof global<"u"?global:null),R}function l(C){if(C&&e(C.localizationSupportTools))return C.localizationSupportTools;const A=C&&typeof C.resolveCoreSupportModule=="function"?C.resolveCoreSupportModule:null;if(A)try{const _=A("cineCoreAppLocalizationSupport","./modules/app-core/localization-fixed.js");if(e(_))return _}catch{}const w=o(C&&C.requireFn);if(typeof w=="function")try{const _=w("./modules/app-core/localization-fixed.js");if(e(_))return _}catch{}const R=s(C&&C.fallbackScopes,C&&C.runtimeScope,C&&C.coreGlobalScope);for(let _=0;_<R.length;_+=1){const G=R[_];try{const O=G&&G.cineCoreAppLocalizationSupport;if(e(O))return O}catch{}}return null}function u(C){const A=l(C);if(A&&typeof A.createAppLocalizationSupport=="function")try{return A.createAppLocalizationSupport({resolveCoreSupportModule:C&&C.resolveCoreSupportModule,requireFn:C&&C.requireFn,runtimeScope:C&&C.runtimeScope,coreGlobalScope:C&&C.coreGlobalScope})}catch{}return null}function d(C){const A=o(C&&C.requireFn),w=r(C&&C.runtimeScope),R=r(C&&C.coreGlobalScope,w),_=n(C&&C.resolveCoreSupportModule,A,w||R),G=s(C&&C.fallbackScopes,w,R),O=u({localizationSupportTools:C&&C.localizationSupportTools,resolveCoreSupportModule:_,requireFn:A,runtimeScope:w,coreGlobalScope:R,fallbackScopes:G}),B=O&&O.localizationRuntimeEnvironment?O.localizationRuntimeEnvironment:null,$=O&&O.localizationBridge?O.localizationBridge:null,V=O&&O.localizationFallbacks?O.localizationFallbacks:null,M=O&&O.inlineLocalizationFallbacks?O.inlineLocalizationFallbacks:null,F=O&&typeof O.localizationFallbackSupport<"u"?O.localizationFallbackSupport:null,z=O&&typeof O.createBasicLocalizationFallbackResolvers=="function"?O.createBasicLocalizationFallbackResolvers:function(){return null},x=O&&O.localizationFallbackRegistry?O.localizationFallbackRegistry:{createFallbackResolvers(Y){return z(Y)}},H=O&&O.localizationFallbackResolvers?O.localizationFallbackResolvers:x&&typeof x.createFallbackResolvers=="function"?x.createFallbackResolvers({directNamespace:V,inlineNamespace:M}):z({directNamespace:V,inlineNamespace:M}),W=O&&typeof O.localizationFallbackNamespace<"u"?O.localizationFallbackNamespace:null,U=O&&typeof O.fallbackResolveLocaleModule=="function"?O.fallbackResolveLocaleModule:function(){return null},j=O&&typeof O.createLocaleFallbacks=="function"?O.createLocaleFallbacks:function(){return null};return{localizationSupport:O,localizationRuntimeEnvironment:B,localizationBridge:$,localizationFallbacks:V,inlineLocalizationFallbacks:M,localizationFallbackSupport:F,createBasicLocalizationFallbackResolvers:z,localizationFallbackRegistry:x,localizationFallbackResolvers:H,localizationFallbackNamespace:W,fallbackResolveLocaleModule:U,createLocaleFallbacks:j}}function m(C){const A=C&&e(C.localizationBootstrapResult)?C.localizationBootstrapResult:null,w=A&&e(A.localizationSupport)?A.localizationSupport:null,R=A&&e(A.localizationRuntimeEnvironment)?A.localizationRuntimeEnvironment:null,_=A&&e(A.localizationBridge)?A.localizationBridge:null,G=A&&e(A.localizationFallbacks)?A.localizationFallbacks:null,O=A&&e(A.inlineLocalizationFallbacks)?A.inlineLocalizationFallbacks:null,B=A&&typeof A.localizationFallbackSupport<"u"?A.localizationFallbackSupport:null,$=A&&typeof A.createBasicLocalizationFallbackResolvers=="function"?A.createBasicLocalizationFallbackResolvers:function(){return null},V=A&&e(A.localizationFallbackRegistry)?A.localizationFallbackRegistry:{createFallbackResolvers(H){return $(H)}},M=A&&e(A.localizationFallbackResolvers)?A.localizationFallbackResolvers:V&&typeof V.createFallbackResolvers=="function"?V.createFallbackResolvers({directNamespace:G,inlineNamespace:O}):$({directNamespace:G,inlineNamespace:O}),F=A&&typeof A.localizationFallbackNamespace<"u"?A.localizationFallbackNamespace:null,z=A&&typeof A.fallbackResolveLocaleModule=="function"?A.fallbackResolveLocaleModule:function(){return null},x=A&&typeof A.createLocaleFallbacks=="function"?A.createLocaleFallbacks:function(){return null};return{localizationBootstrapResult:A,localizationSupport:w,localizationRuntimeEnvironment:R,localizationBridge:_,localizationFallbacks:G,inlineLocalizationFallbacks:O,localizationFallbackSupport:B,createBasicLocalizationFallbackResolvers:$,localizationFallbackRegistry:V,localizationFallbackResolvers:M,localizationFallbackNamespace:F,fallbackResolveLocaleModule:z,createLocaleFallbacks:x}}const y={createLocalizationBootstrapResult:d,createLocalizationBootstrapWiring:m},h=t(),b="cineCoreAppLocalizationBootstrap",v=e(h)&&e(h[b])?h[b]:{};if(Object.assign(v,y),e(h))try{h[b]=v}catch{}typeof module=="object"&&module&&module.exports&&(module.exports=v)})();(function(){function e(C){return!!C&&(typeof C=="object"||typeof C=="function")}function t(C){return typeof C=="function"?C:typeof require=="function"?require:null}function o(C,A,w){const R=[],_=typeof Set=="function"?new Set:null;function G(O){if(e(O)){if(_){if(_.has(O))return;_.add(O),R.push(O);return}R.indexOf(O)===-1&&R.push(O)}}if(G(C),G(A),Array.isArray(w))for(let O=0;O<w.length;O+=1)G(w[O]);return G(typeof globalThis<"u"?globalThis:null),G(typeof window<"u"?window:null),G(typeof self<"u"?self:null),G(typeof global<"u"?global:null),R}function r(C){const A=typeof C=="string"&&C?C:"en";return function(R){if(!R)return A;try{return String(R).trim().toLowerCase()||A}catch{}return A}}function n(C,A){const w=Array.isArray(C)&&C.length?C:["ar","fa","he","ur"];return function(_){const O=A(_).split("-")[0];return w.indexOf(O)!==-1}}function a(C,A){return function(R){if(typeof document<"u"&&document&&document.documentElement)try{const _=document.documentElement.getAttribute("dir");if(_)return _}catch{}return A(R)?"rtl":"ltr"}}function s(C,A,w){if(C){if(A)try{C.lang=A}catch{}if(w)try{C.dir=w}catch{}}}function l(C,A,w){return function(){for(let _=0;_<C.length;_+=1){const G=C[_];if(!e(G))continue;const O=G.texts;if(e(O))return O}if(typeof A=="function")try{const _=A(w);if(e(_)&&e(_.texts))return _.texts}catch{}return{}}}function u(C,A){const w=typeof A=="string"&&A?A:"en";return function(_){const G=C();let O=null;if(typeof _=="string"&&_)try{O=String(_).trim().toLowerCase()}catch{O=null}let B=O&&Object.prototype.hasOwnProperty.call(G,O)?O:"";if(!B&&O){const M=O.split("-")[0];M&&Object.prototype.hasOwnProperty.call(G,M)&&(B=M)}B||(B=w);const $=G&&B&&e(G[B])?G[B]:null;if($)return $;if(B!==w){const M=G&&e(G[w])?G[w]:null;if(M)return M}if(G&&e(G.en))return G.en;const V=G?Object.keys(G):[];if(V.length){const M=V[0],F=G[M];if(e(F))return F}return{}}}function d(C,A){return function(R){if(C&&typeof C.ensureGlobalGetLanguageTextsAvailability=="function")try{C.ensureGlobalGetLanguageTextsAvailability();return}catch{}const _=typeof R=="function"?R:function(){return{}};for(let G=0;G<A.length;G+=1){const O=A[G];if(e(O)&&typeof O.getLanguageTexts!="function")try{O.getLanguageTexts=_}catch{}}}}function m(C){const A=e(C&&C.coreLocalizationRuntime)?C.coreLocalizationRuntime:null,w=e(C&&C.coreLocalizationBridge)?C.coreLocalizationBridge:null,R=C&&C.corePartRuntimeScope,_=C&&C.coreGlobalScope,G=C&&C.additionalLocalizationScopes,O=C&&typeof C.fallbackResolveLocaleModule=="function"?C.fallbackResolveLocaleModule:null,B=t(C&&C.requireFn),$=C&&typeof C.translationsRequirePath=="string"&&C.translationsRequirePath?C.translationsRequirePath:"./translations.js",V=o(R,_,G),M=A&&A.localeModule||(O?O(R):null),F=A&&A.defaultLanguage||(M&&typeof M.DEFAULT_LANGUAGE=="string"?M.DEFAULT_LANGUAGE:"en"),z=A&&A.rtlLanguageCodes||(M&&Array.isArray(M.RTL_LANGUAGE_CODES)&&M.RTL_LANGUAGE_CODES.length>0?M.RTL_LANGUAGE_CODES:["ar","fa","he","ur"]),x=r(F),H=A&&typeof A.normalizeLanguageCode=="function"?function(Ee){try{return A.normalizeLanguageCode(Ee)}catch{}return x(Ee)}:w&&typeof w.normalizeLanguageCode=="function"?function(Ee){try{return w.normalizeLanguageCode(Ee,R)}catch{}return x(Ee)}:x,W=n(z,H),U=A&&typeof A.isRtlLanguage=="function"?function(Ee){try{return A.isRtlLanguage(Ee)}catch{}return W(Ee)}:w&&typeof w.isRtlLanguage=="function"?function(Ee){try{return w.isRtlLanguage(Ee,R)}catch{}return W(Ee)}:W,j=a(H,U),Y=A&&typeof A.resolveDocumentDirection=="function"?function(Ee){try{return A.resolveDocumentDirection(Ee)}catch{}return j(Ee)}:w&&typeof w.resolveDocumentDirection=="function"?function(Ee){try{return w.resolveDocumentDirection(Ee,R)}catch{}return j(Ee)}:j,le=A&&typeof A.applyLocaleMetadata=="function"?function(Ee,Pe,et){try{return A.applyLocaleMetadata(Ee,Pe,et)}catch{}return s(Ee,Pe,et)}:w&&typeof w.applyLocaleMetadata=="function"?function(Ee,Pe,et){try{return w.applyLocaleMetadata(Ee,Pe,et,R)}catch{}return s(Ee,Pe,et)}:s,be=l(V,B,$),re=u(be,F),de=A&&typeof A.getLanguageTexts=="function"?function(Ee){try{return A.getLanguageTexts(Ee)}catch{}return re(Ee)}:re,ne=d(A,V);return{localeModule:e(M)?M:null,defaultLanguage:typeof F=="string"&&F?F:"en",rtlLanguageCodes:Array.isArray(z)&&z.length?z:["ar","fa","he","ur"],normalizeLanguageCode:H,isRtlLanguage:U,resolveDocumentDirection:Y,applyLocaleMetadata:le,getLanguageTexts:de,ensureGlobalGetLanguageTextsAvailability:ne,fallbackResolveTranslationDataset:be}}const y={createLocalizationAccessors:m},h=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,b="cineCoreAppLocalizationAccessors",v=e(h)&&e(h[b])?h[b]:{};if(Object.assign(v,y),e(h))try{h[b]=v}catch{}typeof module=="object"&&module&&module.exports&&(module.exports=v)})();(function(){function e(v){return!!v&&(typeof v=="object"||typeof v=="function")}function t(v){return e(v)?v:typeof globalThis<"u"&&e(globalThis)?globalThis:typeof window<"u"&&e(window)?window:typeof self<"u"&&e(self)?self:typeof global<"u"&&e(global)?global:null}function o(v,C){return e(v)?v:t(C)}function r(v){return typeof v=="function"?v:typeof require=="function"?require:null}function n(v,C,A){if(typeof v=="function")return v;const w=t(A);if(w&&typeof w.resolveCoreSupportModule=="function")try{return w.resolveCoreSupportModule.bind(w)}catch{}if(w&&w.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof w.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule=="function")try{return w.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule.bind(w.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS)}catch{}return typeof C=="function"?function(_,G){if(typeof _!="string"||!_||typeof G!="string"||!G)return null;try{const O=C(G);return e(O)?O:null}catch{}return null}:function(){return null}}function a(v,C){const A=[];e(v)&&A.indexOf(v)===-1&&A.push(v),e(C)&&A.indexOf(C)===-1&&A.push(C);const w=[typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let R=0;R<w.length;R+=1){const _=w[R];e(_)&&A.indexOf(_)===-1&&A.push(_)}return A}function s(v){const C=v&&v.resolveCoreSupportModule,A=v&&v.requireFn,w=v&&v.runtimeScope,R=v&&v.coreGlobalScope;let _=null;if(typeof C=="function")try{_=C("cineCoreAppLocalizationSupport","../app-core/localization-fixed.js")}catch{_=null}if(!e(_)&&typeof A=="function")try{const O=A("../app-core/localization-fixed.js");e(O)&&(_=O)}catch{}if(e(_))return _;const G=a(w,R);for(let O=0;O<G.length;O+=1){const B=G[O];try{const $=B&&B.cineCoreAppLocalizationSupport;if(e($))return $}catch{}}return null}function l(){function v(){return null}const C={createFallbackResolvers(R){return v()}};function A(){return null}function w(){return null}return{localizationRuntimeEnvironment:null,localizationBridge:null,localizationFallbacks:null,inlineLocalizationFallbacks:null,localizationFallbackSupport:null,createBasicLocalizationFallbackResolvers:v,localizationFallbackRegistry:C,localizationFallbackResolvers:null,localizationFallbackNamespace:null,fallbackResolveLocaleModule:A,createLocaleFallbacks:w}}function u(v,C){if(e(v)&&typeof v.createAppLocalizationSupport=="function")try{return v.createAppLocalizationSupport(C)}catch{}return null}function d(v){const C=r(v&&v.requireFn),A=o(v&&v.runtimeScope),w=o(v&&v.coreGlobalScope,A),R=n(v&&v.resolveCoreSupportModule,C,A||w),_=s({resolveCoreSupportModule:R,requireFn:C,runtimeScope:A,coreGlobalScope:w}),G=u(_,{resolveCoreSupportModule:R,requireFn:C,runtimeScope:A,coreGlobalScope:w});return e(G)?G:l()}const m={createLocalizationRuntimeBridge:d},y="cineCoreAppLocalizationRuntimeBridge",h=t(),b=e(h)&&e(h[y])?h[y]:{};for(const v of Object.keys(m))b[v]=m[v];if(e(h))try{h[y]=b}catch{}typeof module=="object"&&module&&module.exports&&(module.exports=b)})();(function(){function e(C){return!!C&&(typeof C=="object"||typeof C=="function")}function t(C){return e(C)?C:typeof globalThis<"u"&&e(globalThis)?globalThis:typeof window<"u"&&e(window)?window:typeof self<"u"&&e(self)?self:typeof global<"u"&&e(global)?global:null}function o(C,A){return e(C)?C:t(A)}function r(C){return typeof C=="function"?C:typeof require=="function"?require:null}function n(C,A,w){if(typeof C=="function")return C;const R=t(w);if(R&&typeof R.resolveCoreSupportModule=="function")try{return R.resolveCoreSupportModule.bind(R)}catch{}if(R&&R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule=="function")try{return R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule.bind(R.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS)}catch{}return typeof A=="function"?function(G,O){if(typeof G!="string"||!G||typeof O!="string"||!O)return null;try{const B=A(O);return e(B)?B:null}catch{}return null}:function(){return null}}function a(C,A){const w=[];e(C)&&w.indexOf(C)===-1&&w.push(C),e(A)&&w.indexOf(A)===-1&&w.push(A);const R=[typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let _=0;_<R.length;_+=1){const G=R[_];e(G)&&w.indexOf(G)===-1&&w.push(G)}return w}function s(C){const A=C&&C.resolveCoreSupportModule,w=C&&C.requireFn,R=C&&C.runtimeScope,_=C&&C.coreGlobalScope;let G=null;if(typeof A=="function")try{G=A("cineCoreAppLocalizationRuntimeBridge","./modules/app-core/localization-fixed.js")}catch{G=null}if(!e(G)&&typeof w=="function")try{const B=w("./modules/app-core/localization-fixed.js");e(B)&&(G=B)}catch{}if(e(G))return G;const O=a(R,_);for(let B=0;B<O.length;B+=1){const $=O[B];try{const V=$&&$.cineCoreAppLocalizationRuntimeBridge;if(e(V))return V}catch{}}return null}function l(){function C(){return null}const A={createFallbackResolvers(_){return C()}};function w(){return null}function R(){return null}return{localizationRuntimeEnvironment:null,localizationBridge:null,localizationFallbacks:null,inlineLocalizationFallbacks:null,localizationFallbackSupport:null,createBasicLocalizationFallbackResolvers:C,localizationFallbackRegistry:A,localizationFallbackResolvers:null,localizationFallbackNamespace:null,fallbackResolveLocaleModule:w,createLocaleFallbacks:R}}function u(C){const A=C&&C.requireFn,w=C&&C.runtimeScope,R=C&&C.coreGlobalScope,_=s(C);if(e(_)&&typeof _.createLocalizationRuntimeBridge=="function")return _.createLocalizationRuntimeBridge;if(typeof A=="function")try{const O=A("./modules/app-core/localization-fixed.js");if(e(O)&&typeof O.createLocalizationRuntimeBridge=="function")return O.createLocalizationRuntimeBridge}catch{}const G=a(w,R);for(let O=0;O<G.length;O+=1){const B=G[O];try{const $=B&&B.cineCoreAppLocalizationRuntimeBridge;if(e($)&&typeof $.createLocalizationRuntimeBridge=="function")return $.createLocalizationRuntimeBridge}catch{}}return function(){return l()}}function d(C){const A=e(C)?C:l(),w=e(A.localizationRuntimeEnvironment)?A.localizationRuntimeEnvironment:null,R=e(A.localizationBridge)?A.localizationBridge:null,_=e(A.localizationFallbacks)?A.localizationFallbacks:null,G=e(A.inlineLocalizationFallbacks)?A.inlineLocalizationFallbacks:null,O=typeof A.localizationFallbackSupport<"u"?A.localizationFallbackSupport:null,B=typeof A.createBasicLocalizationFallbackResolvers=="function"?A.createBasicLocalizationFallbackResolvers:function(){return null},$=e(A.localizationFallbackRegistry)?A.localizationFallbackRegistry:{createFallbackResolvers(x){return B(x)}},V=typeof A.fallbackResolveLocaleModule=="function"?A.fallbackResolveLocaleModule:function(){return null},M=typeof A.createLocaleFallbacks=="function"?A.createLocaleFallbacks:function(){return null},F=typeof A.localizationFallbackNamespace<"u"?A.localizationFallbackNamespace:null,z=A.localizationFallbackResolvers?A.localizationFallbackResolvers:$&&typeof $.createFallbackResolvers=="function"?$.createFallbackResolvers({directNamespace:_,inlineNamespace:G}):B({directNamespace:_,inlineNamespace:G});return{localizationRuntimeEnvironment:w,localizationBridge:R,localizationFallbacks:_,inlineLocalizationFallbacks:G,localizationFallbackSupport:O,createBasicLocalizationFallbackResolvers:B,localizationFallbackRegistry:$,localizationFallbackResolvers:z,localizationFallbackNamespace:F,fallbackResolveLocaleModule:V,createLocaleFallbacks:M}}function m(C){const A=r(C&&C.requireFn),w=o(C&&C.runtimeScope),R=o(C&&C.coreGlobalScope,w),_=n(C&&C.resolveCoreSupportModule,A,w||R),O=u({resolveCoreSupportModule:_,requireFn:A,runtimeScope:w,coreGlobalScope:R})({resolveCoreSupportModule:_,requireFn:A,runtimeScope:w,coreGlobalScope:R});return d(O)}const y={createLocalizationRuntimeSetup:m},h="cineCoreAppLocalizationRuntimeSetup",b=t(),v=e(b)&&e(b[h])?b[h]:{};for(const C of Object.keys(y))v[C]=y[C];if(e(b))try{b[h]=v}catch{}typeof module=="object"&&module&&module.exports&&(module.exports=v)})();(function(){function e(A){return!!A&&(typeof A=="object"||typeof A=="function")}function t(A){return e(A)?A:typeof globalThis<"u"&&e(globalThis)?globalThis:typeof window<"u"&&e(window)?window:typeof self<"u"&&e(self)?self:typeof global<"u"&&e(global)?global:null}function o(A,w){return e(A)?A:t(w)}function r(A){return typeof A=="function"?A:typeof require=="function"?require:null}function n(A,w,R){if(typeof A=="function")return A;const _=o(R);if(_&&typeof _.resolveCoreSupportModule=="function")try{return _.resolveCoreSupportModule.bind(_)}catch{}if(_&&_.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof _.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule=="function")try{return _.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule.bind(_.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS)}catch{}return typeof w=="function"?function(O,B){if(typeof O!="string"||!O||typeof B!="string"||!B)return null;try{const $=w(B);return e($)?$:null}catch{}return null}:null}function a(A,w){e(w)&&A.indexOf(w)===-1&&A.push(w)}function s(A,w){const R=[];return a(R,A),a(R,w),a(R,typeof globalThis<"u"?globalThis:null),a(R,typeof window<"u"?window:null),a(R,typeof self<"u"?self:null),a(R,typeof global<"u"?global:null),R}function l(){return{localizationRuntimeEnvironment:null,localizationBridge:null,localizationFallbacks:null,inlineLocalizationFallbacks:null,localizationFallbackSupport:null,createBasicLocalizationFallbackResolvers(){return null},localizationFallbackRegistry:{createFallbackResolvers(){return null}},localizationFallbackResolvers:null,localizationFallbackNamespace:null,fallbackResolveLocaleModule(){return null},createLocaleFallbacks(){return null}}}function u(A){let w=!1,R=null;return function(){if(w||(w=!0,typeof A!="function"))return R;try{const G=A("./modules/app-core/localization-fixed.js");e(G)&&(R=G)}catch{}return R}}function d(A,w,R){let _=null;if(typeof A=="function")try{_=A("cineCoreAppRuntimeLocalization","./modules/app-core/localization-fixed.js")}catch{_=null}if(e(_)||(_=R()),e(_))return _;for(let G=0;G<w.length;G+=1){const O=w[G];try{const B=O&&O.cineCoreAppRuntimeLocalization;if(e(B))return B}catch{}}return null}function m(A,w,R,_){if(e(w)&&typeof w[A]=="function")return w[A];const G=_();if(e(G)&&typeof G[A]=="function")return G[A];for(let O=0;O<R.length;O+=1){const B=R[O];try{const $=B&&B.cineCoreAppRuntimeLocalization;if(e($)&&typeof $[A]=="function")return $[A]}catch{}}return null}function y(A){const w=r(A&&A.requireFn),R=o(A&&A.runtimeScope),_=o(A&&A.coreGlobalScope,R),G=n(A&&A.resolveCoreSupportModule,w,R||_),O=s(R,_),B=u(w),$=d(G,O,B),V=m("resolveRuntimeLocalization",$,O,B),M=m("createFallbackLocalizationRuntimeSetup",$,O,B)||l;return(typeof V=="function"?V({resolveCoreSupportModule:G,requireFn:w,runtimeScope:R,coreGlobalScope:_}):null)||(typeof M=="function"?M():l())||l()}const h={resolveLocalizationRuntimeSetup:y,createInlineFallbackLocalizationRuntimeSetup:l},b=t(),v="cineCoreAppRuntimeLocalizationResolver",C=e(b)&&e(b[v])?b[v]:{};if(Object.assign(C,h),e(b))try{b[v]=C}catch{}typeof module=="object"&&module&&module.exports&&(module.exports=C)})();(function(){function e(A){return!!A&&(typeof A=="object"||typeof A=="function")}function t(A){return e(A)?A:typeof globalThis<"u"&&e(globalThis)?globalThis:typeof window<"u"&&e(window)?window:typeof self<"u"&&e(self)?self:typeof global<"u"&&e(global)?global:null}function o(A,w){return e(A)?A:t(w)}function r(A){return typeof A=="function"?A:typeof require=="function"?require:null}function n(A,w,R){if(typeof A=="function")return A;const _=t(R);if(_&&typeof _.resolveCoreSupportModule=="function")try{return _.resolveCoreSupportModule.bind(_)}catch{}if(_&&_.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS&&typeof _.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule=="function")try{return _.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS.resolveCoreSupportModule.bind(_.CORE_RUNTIME_SUPPORT_BOOTSTRAP_TOOLS)}catch{}return typeof w=="function"?function(O,B){if(typeof O!="string"||!O||typeof B!="string"||!B)return null;try{const $=w(B);return e($)?$:null}catch{}return null}:function(){return null}}function a(A,w){e(w)&&A.indexOf(w)===-1&&A.push(w)}function s(A,w){const R=[];return a(R,A),a(R,w),a(R,typeof globalThis<"u"?globalThis:null),a(R,typeof window<"u"?window:null),a(R,typeof self<"u"?self:null),a(R,typeof global<"u"?global:null),R}function l(){return{localizationRuntimeEnvironment:null,localizationBridge:null,localizationFallbacks:null,inlineLocalizationFallbacks:null,localizationFallbackSupport:null,createBasicLocalizationFallbackResolvers(){return null},localizationFallbackRegistry:{createFallbackResolvers(){return null}},localizationFallbackResolvers:null,localizationFallbackNamespace:null,fallbackResolveLocaleModule(){return null},createLocaleFallbacks(){return null}}}function u(A){const w=A&&A.resolveCoreSupportModule,R=A&&A.requireFn,_=A&&A.runtimeScope,G=A&&A.coreGlobalScope;let O=null;if(typeof w=="function")try{O=w("cineCoreAppLocalizationRuntimeSetup","./modules/app-core/localization-fixed.js")}catch{O=null}if(!e(O)&&typeof R=="function")try{const B=R("./modules/app-core/localization-fixed.js");e(B)&&(O=B)}catch{}if(!e(O)){const B=s(_,G);for(let $=0;$<B.length;$+=1){const V=B[$];if(e(V))try{const M=V.cineCoreAppLocalizationRuntimeSetup;if(e(M)){O=M;break}}catch{}}}return e(O)&&typeof O.createLocalizationRuntimeSetup=="function"?O.createLocalizationRuntimeSetup:null}function d(A,w){return typeof A=="function"?A:w}function m(A){const w=l(),R=e(A)?A:{},_=e(R.localizationRuntimeEnvironment)?R.localizationRuntimeEnvironment:w.localizationRuntimeEnvironment,G=e(R.localizationBridge)?R.localizationBridge:w.localizationBridge,O=e(R.localizationFallbacks)?R.localizationFallbacks:w.localizationFallbacks,B=e(R.inlineLocalizationFallbacks)?R.inlineLocalizationFallbacks:w.inlineLocalizationFallbacks,$=Object.prototype.hasOwnProperty.call(R,"localizationFallbackSupport")?R.localizationFallbackSupport:w.localizationFallbackSupport,V=d(R.createBasicLocalizationFallbackResolvers,w.createBasicLocalizationFallbackResolvers),M=e(R.localizationFallbackRegistry)?R.localizationFallbackRegistry:{createFallbackResolvers(W){return V(W)}};let F=R.localizationFallbackResolvers;if(!F&&M){const W=d(M.createFallbackResolvers,null);if(W)try{F=W({directNamespace:O,inlineNamespace:B})}catch{F=null}}if(!F&&typeof V=="function")try{F=V({directNamespace:O,inlineNamespace:B})}catch{F=null}F||(F=w.localizationFallbackResolvers);const z=Object.prototype.hasOwnProperty.call(R,"localizationFallbackNamespace")?R.localizationFallbackNamespace:w.localizationFallbackNamespace,x=d(R.fallbackResolveLocaleModule,w.fallbackResolveLocaleModule),H=d(R.createLocaleFallbacks,w.createLocaleFallbacks);return{localizationRuntimeEnvironment:_,localizationBridge:G,localizationFallbacks:O,inlineLocalizationFallbacks:B,localizationFallbackSupport:$,createBasicLocalizationFallbackResolvers:V,localizationFallbackRegistry:M,localizationFallbackResolvers:F,localizationFallbackNamespace:z,fallbackResolveLocaleModule:x,createLocaleFallbacks:H}}function y(A){const w=A&&A.currentLocalization;if(e(w))return m(w);const R=r(A&&A.requireFn),_=o(A&&A.runtimeScope),G=o(A&&A.coreGlobalScope,_),O=n(A&&A.resolveCoreSupportModule,R,_||G),B=u({resolveCoreSupportModule:O,requireFn:R,runtimeScope:_,coreGlobalScope:G});if(typeof B=="function")try{const $=B({resolveCoreSupportModule:O,requireFn:R,runtimeScope:_,coreGlobalScope:G});return m($)}catch{}return l()}const h={resolveRuntimeLocalization:y,createFallbackLocalizationRuntimeSetup:l},b="cineCoreAppRuntimeLocalization",v=t(),C=e(v)&&e(v[b])?v[b]:{};for(const A of Object.keys(h))C[A]=h[A];if(e(v))try{v[b]=C}catch{}typeof module=="object"&&module&&module.exports&&(module.exports=C)})();const APP_CORE_BOOTSTRAP_TOOLS=cineCoreAppCoreBootstrap,APP_CORE_LOCALIZATION_RUNTIME_TOOLS=cineCoreAppRuntimeLocalization,APP_CORE_LOCALIZATION_SUPPORT_TOOLS=cineCoreAppLocalizationSupport,APP_CORE_LOCALIZATION_BOOTSTRAP_TOOLS=cineCoreAppLocalizationBootstrap,APP_CORE_BOOTSTRAP_RESOLVER_DIRECT=cineCoreAppCoreBootstrapResolver,APP_CORE_BOOTSTRAP_FALLBACK_DIRECT=cineCoreAppCoreBootstrapFallbacks,APP_CORE_BOOTSTRAP_ENVIRONMENT_TOOLS_DIRECT=cineCoreAppCoreBootstrapEnvironment,APP_CORE_BOOTSTRAP_RESULTS_TOOLS_DIRECT=cineCoreAppCoreBootstrapResults;function getDefaultRuntimeScope$1(){return typeof CORE_PART1_RUNTIME_SCOPE<"u"&&CORE_PART1_RUNTIME_SCOPE?CORE_PART1_RUNTIME_SCOPE:null}function getDefaultCoreGlobalScope$1(){return typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null}const APP_CORE_BOOTSTRAP_SUITE=APP_CORE_BOOTSTRAP_TOOLS&&typeof APP_CORE_BOOTSTRAP_TOOLS.createBootstrapSuite=="function"?APP_CORE_BOOTSTRAP_TOOLS.createBootstrapSuite({directResolverNamespace:APP_CORE_BOOTSTRAP_RESOLVER_DIRECT,directBootstrapNamespace:APP_CORE_BOOTSTRAP_TOOLS,directBootstrapFallbackNamespace:APP_CORE_BOOTSTRAP_FALLBACK_DIRECT,directBootstrapEnvironmentNamespace:APP_CORE_BOOTSTRAP_ENVIRONMENT_TOOLS_DIRECT,directBootstrapResultsNamespace:APP_CORE_BOOTSTRAP_RESULTS_TOOLS_DIRECT,resolveCoreSupportModule:resolveCoreSupportModule$1,requireFn:typeof require=="function"?require:null,runtimeScope:getDefaultRuntimeScope$1(),coreGlobalScope:getDefaultCoreGlobalScope$1()}):null;APP_CORE_BOOTSTRAP_SUITE&&APP_CORE_BOOTSTRAP_SUITE.bootstrapEnvironmentTools;const APP_CORE_BOOTSTRAP_RESULTS_TOOLS=APP_CORE_BOOTSTRAP_SUITE&&APP_CORE_BOOTSTRAP_SUITE.bootstrapResultsTools||APP_CORE_BOOTSTRAP_RESULTS_TOOLS_DIRECT||null,APP_CORE_BOOTSTRAP_ENVIRONMENT=APP_CORE_BOOTSTRAP_SUITE&&APP_CORE_BOOTSTRAP_SUITE.bootstrapEnvironment||null;APP_CORE_BOOTSTRAP_SUITE&&APP_CORE_BOOTSTRAP_SUITE.bootstrapEnvironment&&APP_CORE_BOOTSTRAP_SUITE.bootstrapEnvironment.bootstrapResolverTools||APP_CORE_BOOTSTRAP_ENVIRONMENT&&APP_CORE_BOOTSTRAP_ENVIRONMENT.bootstrapResolverTools;const APP_CORE_BOOTSTRAP_FALLBACK_TOOLS=APP_CORE_BOOTSTRAP_SUITE&&APP_CORE_BOOTSTRAP_SUITE.bootstrapFallbackTools||APP_CORE_BOOTSTRAP_ENVIRONMENT&&APP_CORE_BOOTSTRAP_ENVIRONMENT.bootstrapFallbackTools||APP_CORE_BOOTSTRAP_FALLBACK_DIRECT||null,localizationBootstrapResult=(function(){if(APP_CORE_BOOTSTRAP_SUITE&&typeof APP_CORE_BOOTSTRAP_SUITE.createLocalizationBootstrapResult=="function"){const t={bootstrapTools:APP_CORE_BOOTSTRAP_TOOLS,bootstrapFallbackTools:APP_CORE_BOOTSTRAP_FALLBACK_TOOLS,localizationSupportTools:APP_CORE_LOCALIZATION_SUPPORT_TOOLS,localizationBootstrapTools:APP_CORE_LOCALIZATION_BOOTSTRAP_TOOLS,localizationRuntimeTools:APP_CORE_LOCALIZATION_RUNTIME_TOOLS,resolveCoreSupportModule:resolveCoreSupportModule$1,requireFn:typeof require=="function"?require:null,runtimeScope:getDefaultRuntimeScope$1(),coreGlobalScope:getDefaultCoreGlobalScope$1(),fallbackScopes:[]};return APP_CORE_BOOTSTRAP_SUITE.createLocalizationBootstrapResult(t)}return null})(),localizationBootstrapWiring$1=APP_CORE_LOCALIZATION_BOOTSTRAP_TOOLS&&typeof APP_CORE_LOCALIZATION_BOOTSTRAP_TOOLS.createLocalizationBootstrapWiring=="function"&&APP_CORE_LOCALIZATION_BOOTSTRAP_TOOLS.createLocalizationBootstrapWiring({localizationBootstrapResult})||null;typeof globalThis<"u"?globalThis.localizationBootstrapWiring=localizationBootstrapWiring$1:typeof window<"u"?window.localizationBootstrapWiring=localizationBootstrapWiring$1:typeof self<"u"?self.localizationBootstrapWiring=localizationBootstrapWiring$1:typeof global<"u"&&(global.localizationBootstrapWiring=localizationBootstrapWiring$1);const GLOBAL_SCOPE$g=detectGlobalScope$l(),MODULE_BASE$a=baseApi,moduleRegistry$7=typeof MODULE_BASE$a.getModuleRegistry=="function"?MODULE_BASE$a.getModuleRegistry(GLOBAL_SCOPE$g):null,freezeDeep$b=typeof MODULE_BASE$a.freezeDeep=="function"?function(t){try{return MODULE_BASE$a.freezeDeep(t)}catch{}return t}:function(t){return t},exposeGlobal$c=typeof MODULE_BASE$a.exposeGlobal=="function"?function(t,o,r){return MODULE_BASE$a.exposeGlobal(t,o,GLOBAL_SCOPE$g,r||{})}:function(t,o){try{return GLOBAL_SCOPE$g[t]=o,!0}catch{}return!1},registerOrQueueModule$a=typeof MODULE_BASE$a.registerOrQueueModule=="function"?function(t,o,r,n){return MODULE_BASE$a.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$g,moduleRegistry$7)}:function(){return!1},safeWarn$e=typeof MODULE_BASE$a.safeWarn=="function"?function(t,o){try{MODULE_BASE$a.safeWarn(t,o)}catch{}}:function(t,o){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof o>"u"?console.warn(t):console.warn(t,o)}catch{}},DEFAULT_LANGUAGE$1="en",RTL_LANGUAGE_CODES=["ar","fa","he","ur"];function normalizeLanguageCode(e){if(!e)return DEFAULT_LANGUAGE$1;try{return String(e).trim().toLowerCase()}catch{}return DEFAULT_LANGUAGE$1}function isRtlLanguage(e){const o=normalizeLanguageCode(e).split("-")[0];return RTL_LANGUAGE_CODES.indexOf(o)!==-1}function resolveDocumentDirection(e,t){const o=t||(typeof document<"u"?document:null);if(o&&o.documentElement)try{const r=o.documentElement.getAttribute("dir");if(r==="rtl"||r==="ltr")return r}catch{}return isRtlLanguage(e)?"rtl":"ltr"}function applyLocaleMetadata(e,t,o){if(e){if(t)try{e.lang=t}catch{}if(o)try{e.dir=o}catch{}}}const localeAPI={DEFAULT_LANGUAGE:DEFAULT_LANGUAGE$1,RTL_LANGUAGE_CODES:freezeDeep$b([].concat(RTL_LANGUAGE_CODES)),normalizeLanguageCode,isRtlLanguage,resolveDocumentDirection,applyLocaleMetadata};freezeDeep$b(localeAPI);registerOrQueueModule$a("cineLocale",localeAPI,{category:"localisation",description:"Language helpers shared between the runtime core and UI modules.",replace:!0},function(e){safeWarn$e("Unable to register cineLocale module.",e)});exposeGlobal$c("cineLocale",localeAPI,{configurable:!0,enumerable:!1,writable:!1});function fallbackDetectPrimaryScope(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const LOCAL_SCOPE$5=fallbackDetectPrimaryScope();function resolveArchitecture$1(e){const t=e||LOCAL_SCOPE$5;return t&&typeof t.cineModuleArchitecture=="object"?t.cineModuleArchitecture:null}const ARCHITECTURE$2=resolveArchitecture$1(LOCAL_SCOPE$5),detectPrimaryScope=ARCHITECTURE$2&&typeof ARCHITECTURE$2.detectGlobalScope=="function"?ARCHITECTURE$2.detectGlobalScope:fallbackDetectPrimaryScope,PRIMARY_SCOPE$6=detectPrimaryScope();function fallbackCollectCandidateScopes$5(e){const t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}return o(e),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),t}const collectCandidateScopes$8=ARCHITECTURE$2&&typeof ARCHITECTURE$2.collectCandidateScopes=="function"?function(e){return ARCHITECTURE$2.collectCandidateScopes(e||PRIMARY_SCOPE$6)}:function(e){return fallbackCollectCandidateScopes$5(e||PRIMARY_SCOPE$6)},tryRequire$6=ARCHITECTURE$2&&typeof ARCHITECTURE$2.tryRequire=="function"?ARCHITECTURE$2.tryRequire:function(e){return null};let resolvedModuleBase,hasResolvedModuleBase$1=!1;function resolveModuleBase$a(){if(baseApi&&typeof baseApi=="object")return baseApi;const e=collectCandidateScopes$8(PRIMARY_SCOPE$6);if(ARCHITECTURE$2&&typeof ARCHITECTURE$2.resolveFromScopes=="function"){const t=ARCHITECTURE$2.resolveFromScopes("cineModuleBase",{scopes:e});if(t&&typeof t=="object")return t}for(let t=0;t<e.length;t+=1){const o=e[t];if(o&&typeof o.cineModuleBase=="object")return o.cineModuleBase}return null}function getModuleBase$1(){return hasResolvedModuleBase$1||(resolvedModuleBase=resolveModuleBase$a(),hasResolvedModuleBase$1=!0),resolvedModuleBase}let resolvedGlobalScope,hasResolvedGlobalScope=!1;function getGlobalScope$5(){if(!hasResolvedGlobalScope){const e=getModuleBase$1();if(e&&typeof e.getGlobalScope=="function")try{resolvedGlobalScope=e.getGlobalScope()||PRIMARY_SCOPE$6}catch{resolvedGlobalScope=PRIMARY_SCOPE$6}else resolvedGlobalScope=PRIMARY_SCOPE$6;hasResolvedGlobalScope=!0}return resolvedGlobalScope}function getCandidateScopes(e){const t=getModuleBase$1();if(t&&typeof t.collectCandidateScopes=="function")try{const o=t.collectCandidateScopes(e||getGlobalScope$5());if(Array.isArray(o))return o}catch{}return collectCandidateScopes$8(e||getGlobalScope$5())}function getTryRequire(){const e=getModuleBase$1();return e&&typeof e.tryRequire=="function"?e.tryRequire:tryRequire$6}function resolveModuleRegistry$5(e){const t=getModuleBase$1(),o=e||getGlobalScope$5();if(t&&typeof t.resolveModuleRegistry=="function")try{return t.resolveModuleRegistry(o)}catch{}if(registry$2&&typeof registry$2=="object")return registry$2;const r=getCandidateScopes(o);if(ARCHITECTURE$2&&typeof ARCHITECTURE$2.resolveFromScopes=="function"){const n=ARCHITECTURE$2.resolveFromScopes("cineModules",{scopes:r});if(n&&typeof n=="object")return n}for(let n=0;n<r.length;n+=1){const a=r[n];if(a&&typeof a.cineModules=="object")return a.cineModules}return null}let resolvedRegistry,hasResolvedRegistry=!1;function getModuleRegistry$3(e){return e&&e!==getGlobalScope$5()?resolveModuleRegistry$5(e):(hasResolvedRegistry||(resolvedRegistry=resolveModuleRegistry$5(getGlobalScope$5()),hasResolvedRegistry=!0),resolvedRegistry)}function getPendingQueueKey$1(){const e=getModuleBase$1();return e&&typeof e.PENDING_QUEUE_KEY=="string"?e.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"}function ensureQueue$4(e){if(!e||typeof e!="object")return null;const t=getPendingQueueKey$1();let o=e[t];if(Array.isArray(o))return o;try{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=e[t]}catch{try{Array.isArray(e[t])||(e[t]=[]),o=e[t]}catch{return null}}return o}function queueModuleRegistrationForScope(e,t,o,r){const n=getModuleBase$1(),a=e||getGlobalScope$5();if(n&&typeof n.queueModuleRegistration=="function")try{return n.queueModuleRegistration(t,o,r,a)}catch{}const s=ensureQueue$4(a);if(!s)return!1;const l=Object.freeze({name:t,api:o,options:Object.freeze({...r||{}})});try{s.push(l)}catch{s[s.length]=l}return!0}function registerOrQueueForScope(e,t,o,r,n,a){const s=getModuleBase$1(),l=e||getGlobalScope$5(),u=t||getModuleRegistry$3(l);if(s&&typeof s.registerOrQueueModule=="function")try{return s.registerOrQueueModule(o,r,n,a,l,u)}catch{}if(u&&typeof u.register=="function")try{return u.register(o,r,n),!0}catch(d){typeof a=="function"&&a(d)}return queueModuleRegistrationForScope(l,o,r,n),!1}function isConsoleCandidate(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(isNodeProcessReference$4(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{let t=null;try{typeof console<"u"&&console&&(t=console)}catch(o){}if(t){if(e===t)return!0;try{if(e.__cameraPowerPlannerOriginal&&e.__cameraPowerPlannerOriginal===t)return!0}catch(o){}}try{if(typeof e.log=="function"&&typeof e.warn=="function"&&typeof e.error=="function"){const o=e.constructor&&e.constructor.name;if(o&&/Console/i.test(o))return!0;if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const r=e[Symbol.toStringTag];if(typeof r=="string"&&/Console/i.test(r))return!0}}}catch(o){}}catch{return!1}return!1}function isNodeModuleCandidate(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;try{if(typeof e.require=="function"&&typeof e.loaded=="boolean"&&((Array.isArray?Array.isArray(e.children):Object.prototype.toString.call(e.children)==="[object Array]")||typeof e.paths<"u"))return!0}catch{}return!1}function isEthereumProviderCandidate$1(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(PRIMARY_SCOPE$6&&typeof PRIMARY_SCOPE$6=="object")try{if(e===PRIMARY_SCOPE$6.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(t){if(t&&typeof t.message=="string"&&/metamask/i.test(t.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function isNodeProcessReference$4(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const o=Function.prototype.toString.call(e);if(o&&o.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function shouldBypassDeepFreeze$4(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function fallbackResolveSeenTracker$3(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(o){return e.indexOf(o)!==-1},add(o){e.indexOf(o)===-1&&e.push(o)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(o){return t.indexOf(o)!==-1},add(o){t.indexOf(o)===-1&&t.push(o)}}}function fallbackFreezeDeep$5(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||shouldBypassDeepFreeze$4(e)||isEthereumProviderCandidate$1(e)||isConsoleCandidate(e)||isNodeModuleCandidate(e))return e;const o=fallbackResolveSeenTracker$3(t);if(o.has(e))return e;o.add(e);const r=Object.getOwnPropertyNames(e);for(let n=0;n<r.length;n+=1){const a=r[n];let s;try{s=Object.getOwnPropertyDescriptor(e,a)}catch{s=null}if(s&&(typeof s.get=="function"||typeof s.set=="function"))continue;let l;try{l=e[a]}catch{l=void 0}!l||typeof l=="function"||typeof l!="object"&&typeof l!="function"||shouldBypassDeepFreeze$4(l)||isEthereumProviderCandidate$1(l)||isConsoleCandidate(l)||isNodeModuleCandidate(l)||fallbackFreezeDeep$5(l,o)}try{return Object.freeze(e)}catch{return e}}function freezeDeep$a(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||shouldBypassDeepFreeze$4(e)||isEthereumProviderCandidate$1(e)||isConsoleCandidate(e)||isNodeModuleCandidate(e))return e;const o=getModuleBase$1();return(o&&typeof o.freezeDeep=="function"?o.freezeDeep:fallbackFreezeDeep$5)(e,t)}function fallbackSafeWarn$7(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function safeWarn$d(e,t){const o=getModuleBase$1();(o&&typeof o.safeWarn=="function"?o.safeWarn:fallbackSafeWarn$7)(e,t)}function fallbackExposeGlobal$4(e,t,o,r={}){if(!o||typeof o!="object")return!1;const n={configurable:r.configurable!==!1,enumerable:!!r.enumerable,value:t,writable:r.writable===!0};try{return Object.defineProperty(o,e,n),!0}catch{try{return o[e]=t,!0}catch{return!1}}}function exposeGlobal$b(e,t,o,r){const n=o||getGlobalScope$5(),a=getModuleBase$1();return a&&typeof a.exposeGlobal=="function"?a.exposeGlobal(e,t,n,r):fallbackExposeGlobal$4(e,t,n,r)}function createScopedEnvironment(e={}){const t=e&&typeof e.scope=="object"?e.scope:getGlobalScope$5(),o=e&&e.registry?e.registry:getModuleRegistry$3(t),r={tryRequire(n){return getTryRequire()(n)},queueModuleRegistration(n,a,s){return queueModuleRegistrationForScope(t,n,a,s)},registerOrQueueModule(n,a,s,l){return registerOrQueueForScope(t,o,n,a,s,l)},freezeDeep:freezeDeep$a,safeWarn:safeWarn$d,exposeGlobal(n,a,s){return exposeGlobal$b(n,a,t,s)},collectCandidateScopes(){return Object.freeze(getCandidateScopes(t).slice())},PENDING_QUEUE_KEY:getPendingQueueKey$1()};return Object.defineProperties(r,{scope:{configurable:!1,enumerable:!0,get(){return t}},registry:{configurable:!1,enumerable:!0,get(){return o}}}),freezeDeep$a(r)}const moduleEnvironment=freezeDeep$a({getModuleBase:getModuleBase$1,getGlobalScope:getGlobalScope$5,getModuleRegistry:getModuleRegistry$3,resolveModuleRegistry:resolveModuleRegistry$5,collectCandidateScopes:getCandidateScopes,tryRequire(e){return getTryRequire()(e)},queueModuleRegistration(e,t,o,r){return queueModuleRegistrationForScope(r||getGlobalScope$5(),e,t,o)},registerOrQueueModule(e,t,o,r,n,a){return registerOrQueueForScope(n||getGlobalScope$5(),a,e,t,o,r)},freezeDeep:freezeDeep$a,safeWarn:safeWarn$d,exposeGlobal(e,t,o,r){return exposeGlobal$b(e,t,o||getGlobalScope$5(),r)},PENDING_QUEUE_KEY:getPendingQueueKey$1(),createScopedEnvironment});registerOrQueueForScope(getGlobalScope$5(),getModuleRegistry$3(),"cineModuleEnvironment",moduleEnvironment,{category:"infrastructure",description:"Shared environment bootstrap that harmonizes module communication across bundles.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cineEnvironmentBridge"]},e=>{safeWarn$d("Unable to register cineModuleEnvironment.",e)});exposeGlobal$b("cineModuleEnvironment",moduleEnvironment,getGlobalScope$5(),{configurable:!0,enumerable:!1,writable:!1});const cineModuleEnvironment=moduleEnvironment;var define_process_env_default$5={};function detectGlobalScope$k(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}var PRIMARY_SCOPE$5=detectGlobalScope$k();function collectCandidateScopes$7(e){var t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}return o(e),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),t}function tryRequireLocal$1(e){return null}function locateModuleEnvironment(e){if(cineModuleEnvironment&&typeof cineModuleEnvironment=="object")return cineModuleEnvironment;for(var t=collectCandidateScopes$7(e||PRIMARY_SCOPE$5),o=0;o<t.length;o+=1){var r=t[o];if(r&&typeof r.cineModuleEnvironment=="object")return r.cineModuleEnvironment}return null}function isNodeProcessReference$3(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const o=Function.prototype.toString.call(e);if(o&&o.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function shouldBypassDeepFreeze$3(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(isNodeProcessReference$3(e)||isEthereumProviderCandidate(e))return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;var t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){var o=e[Symbol.toStringTag];if(typeof o=="string"&&/Stream|Port/i.test(o))return!0}}catch{}return!1}function isEthereumProviderCandidate(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(PRIMARY_SCOPE$5&&typeof PRIMARY_SCOPE$5=="object")try{if(e===PRIMARY_SCOPE$5.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(o){if(o&&typeof o.message=="string"&&/metamask/i.test(o.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;var t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function fallbackFreezeDeep$4(e,t){var o=t;if(!o)if(typeof WeakSet=="function")o=new WeakSet;else{var r=[];o={add:function(a){r.push(a)},has:function(a){return r.indexOf(a)!==-1}}}if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||shouldBypassDeepFreeze$3(e))return e;if(typeof process<"u"&&process&&define_process_env_default$5&&define_process_env_default$5.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(isEthereumProviderCandidate(e)||typeof o.has=="function"&&o.has(e))return e;typeof o.add=="function"&&o.add(e);try{Object.freeze(e)}catch{}return e}function fallbackSafeWarn$6(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function fallbackExposeGlobal$3(e,t,o,r){if(!o||typeof o!="object")return!1;var n={configurable:!r||r.configurable!==!1,enumerable:!!(r&&r.enumerable),value:t,writable:!!(r&&r.writable===!0)};try{return Object.defineProperty(o,e,n),!0}catch{try{return o[e]=t,!0}catch{return!1}}}function ensureQueue$3(e,t){if(!e||typeof e!="object")return null;var o=null;try{o=e[t]}catch{o=null}if(Array.isArray(o))return o;try{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=e[t]}catch{try{Array.isArray(e[t])||(e[t]=[]),o=e[t]}catch{return null}}return o}function shallowCopyOptions$1(e){if(!e||typeof e!="object")return{};var t={},o=[];try{o=Object.keys(e)}catch{o=[]}for(var r=0;r<o.length;r+=1){var n=o[r];try{t[n]=e[n]}catch{}}return t}function createFallbackEnvironment(e){var t=e||PRIMARY_SCOPE$5,o="__cinePendingModuleRegistrations__",r=null,n=!1;function a(m){if(registry$2&&typeof registry$2=="object")return registry$2;for(var y=collectCandidateScopes$7(m),h=0;h<y.length;h+=1){var b=y[h];if(b&&typeof b.cineModules=="object")return b.cineModules}return null}function s(){return n||(r=a(t),n=!0),r}function l(m,y,h){var b=ensureQueue$3(t,o);if(!b)return!1;var v=Object.freeze(shallowCopyOptions$1(h)),C=Object.freeze({name:m,api:y,options:v});try{b.push(C)}catch{b[b.length]=C}return!0}function u(m,y,h,b){var v=s();if(v&&typeof v.register=="function")try{return v.register(m,y,h||{}),!0}catch(C){if(typeof b=="function")try{b(C)}catch{}}return l(m,y,h)}function d(){var m=collectCandidateScopes$7(t);return m.slice()}return{scope:t,registry:s(),tryRequire:function(y){return tryRequireLocal$1()},queueModuleRegistration:function(y,h,b){return l(y,h,b)},registerOrQueueModule:function(y,h,b,v){return u(y,h,b,v)},freezeDeep:function(y,h){return fallbackFreezeDeep$4(y,h)},safeWarn:function(y,h){fallbackSafeWarn$6(y,h)},exposeGlobal:function(y,h,b){return fallbackExposeGlobal$3(y,h,t,b||{})},collectCandidateScopes:function(){return Object.freeze(d())},PENDING_QUEUE_KEY:o}}function buildDescriptor(e){var t=e||PRIMARY_SCOPE$5,o=locateModuleEnvironment(t);if(o&&typeof o.createScopedEnvironment=="function")try{var r=o.createScopedEnvironment({scope:t});if(r&&typeof r=="object")return{scope:r.scope||t,moduleEnv:o,environment:r}}catch{}var n=createFallbackEnvironment(t);return{scope:n.scope||t,moduleEnv:o||null,environment:n}}var cachedDescriptor=null;function ensureDescriptor(){return cachedDescriptor||(cachedDescriptor=buildDescriptor(PRIMARY_SCOPE$5)),cachedDescriptor}function refreshDescriptor(e){var t=e&&e.scope?e.scope:PRIMARY_SCOPE$5;return cachedDescriptor=buildDescriptor(t),cachedDescriptor}function safeInvoke(e,t){try{return e()}catch{return t}}function getGlobalScope$4(){return ensureDescriptor().scope}function getEnvironment(){return ensureDescriptor().environment}function getModuleEnvironment(){return ensureDescriptor().moduleEnv}function getModuleRegistry$2(e){if(e&&e!==getGlobalScope$4()){var t=getModuleEnvironment();if(t&&typeof t.getModuleRegistry=="function")return safeInvoke(function(){return t.getModuleRegistry(e)},null);var o=buildDescriptor(e);return o.environment&&o.environment.registry?o.environment.registry:null}var r=ensureDescriptor();if(r.environment&&r.environment.registry)return r.environment.registry;var n=r.moduleEnv;return n&&typeof n.getModuleRegistry=="function"?safeInvoke(function(){return n.getModuleRegistry(r.scope)},null):null}function tryRequire$5(e){var t=getEnvironment();if(t&&typeof t.tryRequire=="function"){var o=safeInvoke(function(){return t.tryRequire(e)},void 0);if(typeof o<"u")return o}var r=getModuleEnvironment();if(r&&typeof r.tryRequire=="function"){var n=safeInvoke(function(){return r.tryRequire(e)},void 0);if(typeof n<"u")return n}return tryRequireLocal$1()}function queueModuleRegistration$5(e,t,o){var r=getEnvironment();if(r&&typeof r.queueModuleRegistration=="function")return safeInvoke(function(){return r.queueModuleRegistration(e,t,o)},!1);var n=createFallbackEnvironment(getGlobalScope$4());return n.queueModuleRegistration(e,t,o)}function registerOrQueueModule$9(e,t,o,r,n){var a=getEnvironment();if(a&&typeof a.registerOrQueueModule=="function")return safeInvoke(function(){return a.registerOrQueueModule(e,t,o,r)},!1);var s=n||getGlobalScope$4(),l=createFallbackEnvironment(s);return l.registerOrQueueModule(e,t,o,r)}function freezeDeep$9(e,t){return fallbackFreezeDeep$4(e,t)}function safeWarn$c(e,t){var o=getEnvironment();if(o&&typeof o.safeWarn=="function"){safeInvoke(function(){o.safeWarn(e,t)},void 0);return}fallbackSafeWarn$6(e,t)}function exposeGlobal$a(e,t,o,r){var n=getEnvironment();return n&&typeof n.exposeGlobal=="function"?safeInvoke(function(){return n.exposeGlobal(e,t,r)},!1):fallbackExposeGlobal$3(e,t,o||getGlobalScope$4(),r||{})}function collectCandidateScopesFor(e){var t=getEnvironment();if(t&&typeof t.collectCandidateScopes=="function"){var o=safeInvoke(function(){return t.collectCandidateScopes(e)},[]);if(Array.isArray(o))return o.slice()}return collectCandidateScopes$7(e||getGlobalScope$4())}function getPendingQueueKey(){var e=getEnvironment();if(e&&typeof e.PENDING_QUEUE_KEY=="string")return e.PENDING_QUEUE_KEY;var t=getModuleEnvironment();return t&&typeof t.PENDING_QUEUE_KEY=="string"?t.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"}var bridge$1=Object.freeze({getGlobalScope:getGlobalScope$4,getEnvironment,getModuleEnvironment,getModuleRegistry:getModuleRegistry$2,tryRequire:tryRequire$5,queueModuleRegistration:queueModuleRegistration$5,registerOrQueueModule:registerOrQueueModule$9,freezeDeep:freezeDeep$9,safeWarn:safeWarn$c,exposeGlobal:function(t,o,r){return exposeGlobal$a(t,o,getGlobalScope$4(),r||{})},exposeGlobalScoped:function(t,o,r,n){return exposeGlobal$a(t,o,r||getGlobalScope$4(),n||{})},collectCandidateScopes:function(t){return Object.freeze(collectCandidateScopesFor(t))},getPendingQueueKey,refresh:function(t){return Object.freeze(refreshDescriptor(t||{}))}}),globalScope$7=getGlobalScope$4();if(globalScope$7&&typeof globalScope$7=="object")try{Object.defineProperty(globalScope$7,"cineEnvironmentBridge",{configurable:!0,enumerable:!1,writable:!1,value:bridge$1})}catch{try{globalScope$7.cineEnvironmentBridge=bridge$1}catch{}}var registry$1=getModuleRegistry$2();if(registry$1&&typeof registry$1.register=="function")try{registry$1.register("cineEnvironmentBridge",bridge$1,{category:"infrastructure",description:"Provides consistent global environment access between Cine modules.",replace:!0,connections:["cineModuleEnvironment","cineModuleGlobals"]})}catch(e){safeWarn$c("Unable to register cineEnvironmentBridge.",e)}else queueModuleRegistration$5("cineEnvironmentBridge",bridge$1,{category:"infrastructure",description:"Provides consistent global environment access between Cine modules.",replace:!0,connections:["cineModuleEnvironment","cineModuleGlobals"]});const cineEnvironmentBridge=bridge$1;var define_process_env_default$4={};(function(){function e(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const t=e(),o="__cineReloadProbe__",r="x-cine-connectivity-probe",n="x-cine-connectivity-probe-result",a="network",s="fallback",l="cine-sw-logs",u="cine-sw:connectivity-status";function d(I){if(typeof require=="function")try{return require("./helpers/module-linker.js")}catch{}const N=[I];typeof globalThis<"u"&&N.indexOf(globalThis)===-1&&N.push(globalThis),typeof window<"u"&&N.indexOf(window)===-1&&N.push(window),typeof self<"u"&&N.indexOf(self)===-1&&N.push(self),typeof global<"u"&&N.indexOf(global)===-1&&N.push(global);for(let K=0;K<N.length;K+=1){const oe=N[K];try{const ce=oe&&oe.cineModuleLinker;if(ce&&typeof ce=="object")return ce}catch{}}return null}function m(I){if(typeof require=="function")try{return require("./environment.js")}catch{}const N=[I];typeof globalThis<"u"&&N.indexOf(globalThis)===-1&&N.push(globalThis),typeof window<"u"&&N.indexOf(window)===-1&&N.push(window),typeof self<"u"&&N.indexOf(self)===-1&&N.push(self),typeof global<"u"&&N.indexOf(global)===-1&&N.push(global);for(let K=0;K<N.length;K+=1){const oe=N[K];if(oe&&typeof oe.cineModuleEnvironment=="object")return oe.cineModuleEnvironment}return null}function y(I){if(typeof require=="function")try{return require("./environment-bridge.js")}catch{}const N=[I];typeof globalThis<"u"&&N.indexOf(globalThis)===-1&&N.push(globalThis),typeof window<"u"&&N.indexOf(window)===-1&&N.push(window),typeof self<"u"&&N.indexOf(self)===-1&&N.push(self),typeof global<"u"&&N.indexOf(global)===-1&&N.push(global);for(let K=0;K<N.length;K+=1){const oe=N[K];if(oe&&typeof oe.cineEnvironmentBridge=="object")return oe.cineEnvironmentBridge}return null}const h=d(t),b=h&&typeof h.getModuleEnvironment=="function"?h.getModuleEnvironment():m(t),v=h&&typeof h.getEnvironmentBridge=="function"?h.getEnvironmentBridge():y(t),C=(h&&typeof h.getGlobalScope=="function"?h.getGlobalScope():null)||(v&&typeof v.getGlobalScope=="function"?v.getGlobalScope():null)||(b&&typeof b.getGlobalScope=="function"?b.getGlobalScope():null)||t;function A(){if(typeof require=="function")try{const N=require("./globals.js");if(N&&typeof N=="object")return N}catch{}const I=[C];typeof globalThis<"u"&&I.indexOf(globalThis)===-1&&I.push(globalThis),typeof window<"u"&&I.indexOf(window)===-1&&I.push(window),typeof self<"u"&&I.indexOf(self)===-1&&I.push(self),typeof global<"u"&&I.indexOf(global)===-1&&I.push(global);for(let N=0;N<I.length;N+=1){const K=I[N];if(K&&typeof K.cineModuleGlobals=="object")return K.cineModuleGlobals}return null}const w=(h&&typeof h.getModuleGlobals=="function"?h.getModuleGlobals():null)||A();let R=null,_=!1,G=null;const O=new Set;function B(I){if(!I)return null;if(typeof I=="string")return I;if(typeof I=="number")return Number.isFinite(I)?I:null;if(typeof I=="boolean")return I;if(typeof I=="object"){const N={},K=typeof I.name=="string"&&I.name?I.name:null,oe=typeof I.message=="string"&&I.message?I.message:null,ce=typeof I.code=="string"&&I.code?I.code:null;if(K&&(N.name=K),oe&&(N.message=oe),ce&&(N.code=ce),typeof I.status=="number"&&Number.isFinite(I.status)&&(N.status=I.status),typeof I.type=="string"&&I.type&&(N.type=I.type),Object.keys(N).length===0){try{const me=String(I);if(me&&me!=="[object Object]")return me}catch{}return null}return N}try{return String(I)}catch{return null}}function $(I){if(!I)return null;if(typeof I!="object")return B(I);const N={};if(typeof I.status=="number"&&Number.isFinite(I.status)&&(N.status=I.status),typeof I.statusText=="string"&&I.statusText&&(N.statusText=I.statusText),typeof I.probeResult=="string"&&I.probeResult&&(N.probeResult=I.probeResult),typeof I.reason=="string"&&I.reason&&(N.reason=I.reason),typeof I.stage=="string"&&I.stage&&(N.stage=I.stage),typeof I.source=="string"&&I.source&&(N.source=I.source),typeof I.message=="string"&&I.message&&(N.message=I.message),typeof I.code=="string"&&I.code&&(N.code=I.code),I.head&&typeof I.head=="object"){const K=$(I.head);K&&(N.head=K)}if(I.error){const K=B(I.error);K&&(N.error=K)}if(I.detail&&typeof I.detail=="object"&&I.detail!==I){const K=$(I.detail);K&&(N.detail=K)}return Object.keys(N).length?N:null}function V(){if(_)return null;if(R)return R;if(typeof BroadcastChannel!="function")return _=!0,null;try{return R=new BroadcastChannel(l),R}catch(I){return _=!0,ue("cineOffline: Unable to open connectivity broadcast channel",I),null}}function M(I){if(!(!C||typeof C!="object"))try{C.cineConnectivityStatus=I}catch{}}function F(I){O.forEach(N=>{try{N(I)}catch(K){ue("cineOffline: connectivity listener failed",K)}})}function z(I){const N=V();if(N)try{N.postMessage({type:u,state:I})}catch(K){ue("cineOffline: Unable to broadcast connectivity state",K);try{N.close()}catch{}R=null,_=!0}}function x(I){try{return bo(I)}catch(N){return ue("cineOffline: Unable to freeze connectivity state",N),I}}function H(I){const N=G&&typeof G=="object"?G:{status:"unknown",detail:null,source:"cineOffline"},K={status:typeof I.status=="string"&&I.status?I.status:N.status||"unknown",reason:typeof I.reason=="string"&&I.reason?I.reason:null,detail:typeof I.detail>"u"?N.detail:$(I.detail),timestamp:typeof I.timestamp=="number"&&Number.isFinite(I.timestamp)?I.timestamp:Date.now(),source:typeof I.source=="string"&&I.source?I.source:N.source||"cineOffline"};return x(K)}function W(I){if(typeof document>"u"||!document)return;const N=document.getElementById("offlineIndicator");N&&(I.status==="offline"?typeof N.removeAttribute=="function"&&N.removeAttribute("hidden"):typeof N.setAttribute=="function"&&N.setAttribute("hidden",""))}function U(I){if(!I||typeof I!="object")return G;const N=H(I);return G&&G.status===N.status&&G.reason===N.reason&&G.detail===N.detail&&G.source===N.source?(G=N,M(N),W(N),G):(G=N,M(N),W(N),F(N),z(N),G)}function j(I,N){if(h&&typeof h.recordModule=="function"&&h.recordModule(I,N),!(!w||typeof w.recordModule!="function"))try{w.recordModule(I,N)}catch{}}function Y(I){if(typeof require!="function")return null;try{return require(I)}catch{return null}}const le=(function(){return h&&typeof h.tryRequire=="function"?h.tryRequire:w&&typeof w.tryRequire=="function"?w.tryRequire:v&&typeof v.tryRequire=="function"?function(K){const oe=v.tryRequire(K);return typeof oe>"u"?Y(K):oe}:b&&typeof b.tryRequire=="function"?b.tryRequire:Y})();function be(I){const N=I||C;if(h&&typeof h.getModuleRegistry=="function"){const ce=h.getModuleRegistry(N);if(ce)return ce}if(w&&typeof w.resolveModuleRegistry=="function")try{const ce=w.resolveModuleRegistry(N);if(ce)return ce}catch{}if(v&&typeof v.getModuleRegistry=="function")try{const ce=v.getModuleRegistry(N);if(ce)return ce}catch{}if(b&&typeof b.resolveModuleRegistry=="function")try{const ce=b.resolveModuleRegistry(N);if(ce)return ce}catch{}const K=le("./registry.js");if(K&&typeof K=="object")return K;const oe=[N];typeof globalThis<"u"&&oe.indexOf(globalThis)===-1&&oe.push(globalThis),typeof window<"u"&&oe.indexOf(window)===-1&&oe.push(window),typeof self<"u"&&oe.indexOf(self)===-1&&oe.push(self),typeof global<"u"&&oe.indexOf(global)===-1&&oe.push(global);for(let ce=0;ce<oe.length;ce+=1){const me=oe[ce];if(me&&typeof me.cineModules=="object")return me.cineModules}return null}const re=(function(){if(h&&typeof h.getModuleRegistry=="function"){const I=h.getModuleRegistry(C);if(I)return I}if(w&&typeof w.getModuleRegistry=="function")try{const I=w.getModuleRegistry(C);if(I)return I}catch{}if(v&&typeof v.getModuleRegistry=="function")try{const I=v.getModuleRegistry(C);if(I)return I}catch{}if(b&&typeof b.getModuleRegistry=="function")try{const I=b.getModuleRegistry(C);if(I)return I}catch{}return be(C)})(),de=(function(){if(w&&typeof w.getPendingQueueKey=="function")try{const N=w.getPendingQueueKey();if(typeof N=="string"&&N)return N}catch{}if(v&&typeof v.getPendingQueueKey=="function")try{const N=v.getPendingQueueKey();if(typeof N=="string"&&N)return N}catch{}return b&&typeof b.PENDING_QUEUE_KEY=="string"?b.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function ne(I){if(!I||typeof I!="object")return{};const N={},K=Object.keys(I);for(let oe=0;oe<K.length;oe+=1){const ce=K[oe];N[ce]=I[ce]}return N}function Ce(I,N,K){if(!C||typeof C!="object")return!1;const oe=Object.freeze({name:I,api:N,options:Object.freeze(ne(K))});let ce=C[de];if(!Array.isArray(ce))try{Object.defineProperty(C,de,{configurable:!0,enumerable:!1,writable:!0,value:[]}),ce=C[de]}catch{try{Array.isArray(C[de])||(C[de]=[]),ce=C[de]}catch{return!1}}try{ce.push(oe)}catch{ce[ce.length]=oe}return!0}function Ee(I,N,K){if(w&&typeof w.queueModuleRegistration=="function")try{if(w.queueModuleRegistration(I,N,K,C))return!0}catch{}if(v&&typeof v.queueModuleRegistration=="function")try{if(v.queueModuleRegistration(I,N,K))return!0}catch{}return b&&typeof b.queueModuleRegistration=="function"?b.queueModuleRegistration(I,N,K,C):Ce(I,N,K)}function Pe(I,N,K,oe){if(re&&typeof re.register=="function")try{return re.register(I,N,K),!0}catch(ce){if(typeof oe=="function")try{oe(ce)}catch{}}return Ee(I,N,K),!1}const et=(function(){return w&&typeof w.registerOrQueueModule=="function"?function(K,oe,ce,me){try{if(w.registerOrQueueModule(K,oe,ce,me,C,re))return!0}catch{}return Pe(K,oe,ce,me)}:v&&typeof v.registerOrQueueModule=="function"?function(K,oe,ce,me){try{if(v.registerOrQueueModule(K,oe,ce,me,C,re))return!0}catch{}return Pe(K,oe,ce,me)}:b&&typeof b.registerOrQueueModule=="function"?function(K,oe,ce,me){return b.registerOrQueueModule(K,oe,ce,me,C,re)}:Pe})();function Je(I){if(!I||typeof process>"u"||!process)return!1;if(I===process)return!0;if(typeof I=="object"){try{if(I.constructor&&I.constructor.name==="process")return!0}catch{}if(typeof I.pid=="number"&&typeof I.nextTick=="function"&&typeof I.emit=="function"&&typeof I.binding=="function")return!0}if(typeof I=="function"){if(I===process.binding||I===process._linkedBinding||I===process.dlopen)return!0;try{const N=I.name||"";if(N&&(N==="binding"||N==="dlopen")){const K=Function.prototype.toString.call(I);if(K&&K.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function it(I){if(!I||typeof I=="function"||typeof I!="object"&&typeof I!="function")return!1;if(Je(I)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof I.pipe=="function"&&typeof I.unpipe=="function")return!0;if(typeof I.on=="function"&&typeof I.emit=="function"){if(typeof I.write=="function"||typeof I.read=="function")return!0;const N=I.constructor&&I.constructor.name;if(N&&/Stream|Emitter|Port/i.test(N))return!0}if(typeof Symbol<"u"&&I[Symbol.toStringTag]){const N=I[Symbol.toStringTag];if(typeof N=="string"&&/Stream|Port/i.test(N))return!0}}catch{}return!1}function rt(I){if(I&&typeof I.has=="function"&&typeof I.add=="function")return I;if(Array.isArray(I))return{has(K){return I.indexOf(K)!==-1},add(K){I.indexOf(K)===-1&&I.push(K)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const N=[];return{has(K){return N.indexOf(K)!==-1},add(K){N.indexOf(K)===-1&&N.push(K)}}}function Pt(I,N){if(!I||typeof I!="object"||it(I))return I;if(typeof process<"u"&&process&&define_process_env_default$4&&define_process_env_default$4.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(I)}catch{}return I}const K=rt(N);if(K.has(I))return I;K.add(I);const oe=Object.getOwnPropertyNames(I);for(let ce=0;ce<oe.length;ce+=1){const me=oe[ce];let De;try{De=I[me]}catch{De=void 0}!De||typeof De=="function"||typeof De!="object"&&typeof De!="function"||Pt(De,K)}try{return Object.freeze(I)}catch{return I}}let vt;function bo(I,N){return Et()(I,N)}function Et(){return vt||(vt=Ut()),vt}function Ut(){return w&&typeof w.freezeDeep=="function"?w.freezeDeep:v&&typeof v.freezeDeep=="function"?function(N,K){try{return v.freezeDeep(N,K)}catch{return Pt(N,K)}}:b&&typeof b.freezeDeep=="function"?b.freezeDeep:Pt}function ge(I,N){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof N>"u"?console.warn(I):console.warn(I,N)}catch{}}const ue=(function(){return w&&typeof w.safeWarn=="function"?w.safeWarn:v&&typeof v.safeWarn=="function"?function(K,oe){try{v.safeWarn(K,oe)}catch{ge(K,oe)}}:b&&typeof b.safeWarn=="function"?b.safeWarn:ge})();G=U({status:"unknown",source:"cineOffline"});const We=700,Me=3500,Te=180;let Be=!1;function Ve(I){return!I||typeof I.then!="function"?Promise.resolve(!1):I.then(()=>!0).catch(()=>!1)}function je(I){if(!I)return!1;let N="";try{N=typeof I.message=="string"?I.message:""}catch{N=""}let K="";try{K=typeof I.name=="string"?I.name:""}catch{K=""}const oe=N.toLowerCase(),ce=K.toLowerCase();return ce.includes("cors")||ce.includes("accesscontrol")?!0:oe?!!(oe.includes("access control")||oe.includes("cors")||oe.includes("cross-origin")):!1}function mt(I,N){if(!I)return!1;let K="";try{K=typeof I.message=="string"?I.message:""}catch{K=""}let oe="";try{oe=typeof I.name=="string"?I.name:""}catch{oe=""}const ce=K.toLowerCase(),me=oe.toLowerCase();if(je(I)||me==="aborted"||me==="aborterror"||ce.includes("load failed")||ce.includes("cancelled")||ce.includes("canceled"))return!0;if(typeof DOMException=="function")try{if(I instanceof DOMException&&(I.name==="NetworkError"||I.code===DOMException.NETWORK_ERR))return!0}catch{}if(N&&typeof N=="string")try{const De=typeof location=="object"&&location?Co(location):void 0,Ge=typeof URL=="function"?new URL(N,De||void 0):null;if(Ge&&Ge.protocol&&Ge.protocol!=="http:"&&Ge.protocol!=="https:")return!0}catch{}return!1}function ct(I,N){const K=N||Jt();if(K&&typeof K.safari=="object"&&K.safari&&typeof K.safari.pushNotification=="object")return!0;const oe=I&&typeof I.vendor=="string"?I.vendor:"",ce=I&&typeof I.userAgent=="string"?I.userAgent:"";if(!oe&&!ce)return!1;const De=oe.toLowerCase().trim(),Ge=ce.toLowerCase(),Ue=["crios","fxios","edgios","edga","edge","opr/","opt/","opera","chrome","chromium"];for(let Xo=0;Xo<Ue.length;Xo+=1){const No=Ue[Xo];if(Ge.includes(No))return!1}const Xe=De.includes("apple"),ft=Ge.includes("safari"),Le=Ge.includes("applewebkit"),ot=Ge.includes("version/"),_t=Ge.includes("mobile/"),Lt=Ge.includes("macintosh")||Ge.includes("iphone")||Ge.includes("ipad")||Ge.includes("ipod")||Ge.includes("watch")||Ge.includes("apple tv"),Qt=De.length===0,Gt=ft||Le&&(ot||_t||Lt),ho=Qt&&Le&&Gt;if(!Xe&&!ho)return!1;if(Xe&&Gt||ho)return!0;let Qo=!1;if(I&&typeof I.standalone=="boolean"?Qo=I.standalone:K&&K.navigator&&typeof K.navigator.standalone=="boolean"&&(Qo=K.navigator.standalone),!Qo&&K&&typeof K.matchMedia=="function")try{const Xo=K.matchMedia("(display-mode: standalone)");Xo&&Xo.matches&&(Qo=!0)}catch{}return Qo}function $t(I,N){return typeof He(N)!="function"?!1:ct(I,N)}function fo(I={}){const N=typeof I.nextHref=="string"?I.nextHref:"";if(!N)return null;const K=Jt(I.window),oe=So(I.fetch,K);if(typeof oe!="function")return null;const ce=I.location&&typeof I.location=="object"?I.location:K&&K.location?K.location:null;if(!Tt(ce,N))return null;const me=lr(I.navigator);if(me&&me.onLine===!1)return null;const De=$t(me,K);let Ge=null;if(typeof AbortController=="function")try{Ge=new AbortController}catch{Ge=null}let Ue=!1,Xe=!1;const ft=[],Le=ao=>{typeof ao=="function"&&ft.push(ao)},ot=Ve(I.serviceWorkerPromise).then(ao=>(Ue=!0,ao)),_t=Ve(I.cachePromise).then(ao=>(Xe=!0,ao)),Lt=I.allowCache===!0,Qt=(()=>{const ao=Co(ce),Ir=Wo(ce);if(!Ir)return!1;const cr=Yo(N,ao);return!!cr&&cr===Ir})(),Gt="same-origin",ho=Qt?"same-origin":"omit",Qo=(()=>{const ao=Co(ce),cr=Do(ce,typeof ao=="string"&&ao?ao:N,N);if(typeof cr!="string"||!cr)return"";const Rr=Wo(ce);if(typeof URL=="function"){const Er=typeof ao=="string"&&ao?ao:void 0;try{const rr=new URL(cr,Er);if(Rr&&rr.origin&&rr.origin!==Rr)return"";const $r=`${rr.pathname||""}${rr.search||""}${rr.hash||""}`;if($r)return $r;if(Rr&&(!rr.pathname||rr.pathname==="/"))return"/"}catch{}}if(typeof Rr=="string"&&Rr&&typeof cr=="string"&&cr.startsWith(Rr)){const Er=cr.slice(Rr.length);if(!Er||Er.startsWith("/")||Er.startsWith("?")||Er.startsWith("#"))return Er||"/"}return typeof cr=="string"&&(cr.startsWith("/")||!cr.includes("://"))?cr:""})(),No=(async()=>{const ao=typeof I.warmupWaitMs=="number"?I.warmupWaitMs:Te;try{await Promise.allSettled([no(ot,ao),no(_t,ao)])}catch{}const Ir=Lt&&Ue&&Xe,cr=(Oo={})=>{const Dt={cache:Ir?"reload":"no-store",credentials:ho,mode:Gt,redirect:"follow"};return Ge&&Ge.signal&&(Dt.signal=Ge.signal),Object.assign(Dt,Oo)},Rr=async(Oo={})=>{const Dt=cr(Oo),Fo=Qo||N;return oe.call(K||void 0,Fo,Dt)};Ge&&Le(()=>{try{Ge.abort()}catch{}});const Er=()=>{if(!De)return null;const Oo=He(K);if(typeof Oo!="function")return null;const Dt=Qo||N;if(!Dt)return null;let Fo;try{Fo=new Oo}catch{Fo=null}if(!Fo)return null;let qr=!1;Le(()=>{if(Fo){qr=!0;try{Fo.abort()}catch{}}});const en=new Promise(yr=>{const Kr=Zo=>{yr&&yr(Zo)};Fo.addEventListener("load",()=>{if(qr){Kr(!1);return}try{Fo.responseText}catch{}const Zo=typeof Fo.status=="number"?Fo.status:0;if(!Zo){Kr(!0);return}Kr(Zo>=200&&Zo<400)}),Fo.addEventListener("error",()=>{Kr(!1)}),Fo.addEventListener("abort",()=>{Kr(!1)}),Fo.addEventListener("timeout",()=>{Kr(!1)})});try{Fo.open("GET",Dt,!0)}catch{return null}try{Fo.responseType="text"}catch{}try{Fo.send(null)}catch{return null}return en.then(yr=>!!yr)},rr=()=>Ge&&Ge.signal&&Ge.signal.aborted===!0;let $r=null,Pr=null,Kt=!De;if(De)try{const Oo=await Er();if(Oo===!0)return!0;Oo===!1?Kt=!1:Kt=!0}catch{Kt=!0}if(Kt)try{$r=await Rr()}catch(Oo){Pr=Oo}if(!$r){if(rr()||je(Pr))return!1;let Oo=null,Dt=Pr;const Fo=Ir?"reload":"no-store",qr=[];Ir&&qr.push("no-cache"),qr.push("no-store"),qr.push("default");for(let en=0;en<qr.length&&!Oo;en+=1){const yr=qr[en];if(yr!==Fo)try{Oo=await Rr({cache:yr}),Dt=null}catch(Kr){Dt=Kr||Dt||Pr,Oo=null}}if(!Oo){if(rr())return!1;const en=mt(Dt||Pr,N);return!Be&&!en&&(Be=!0,ue("Reload warmup fetch failed",Dt||Pr)),!1}$r=Oo}if(!$r)return!1;try{const Oo=typeof $r.clone=="function"?$r.clone():$r;Oo&&typeof Oo.text=="function"&&Oo.bodyUsed!==!0&&await Oo.text()}catch{}return!0})();return No&&typeof No.catch=="function"&&No.catch(()=>{}),{cancel(){for(let ao=0;ao<ft.length;ao+=1){const Ir=ft[ao];if(typeof Ir=="function")try{Ir()}catch{}}},promise:No,done:No}}function no(I,N,K,oe){if(!I||typeof I.then!="function")return Promise.resolve({timedOut:!1,result:I});const ce=typeof N=="number"&&N>=0?N:null,me=typeof setTimeout=="function"?setTimeout:null,De=typeof clearTimeout=="function"?clearTimeout:null;if(ce===null||!me)return I.then(Xe=>({timedOut:!1,result:Xe}));let Ge=!1,Ue=null;return new Promise((Xe,ft)=>{I.then(Le=>{if(Ge)return Le;if(Ge=!0,Ue!=null&&De)try{De(Ue)}catch{}return Xe({timedOut:!1,result:Le}),Le},Le=>{if(Ge){if(typeof oe=="function")try{oe(Le)}catch{}return null}if(Ge=!0,Ue!=null&&De)try{De(Ue)}catch{}return ft(Le),null}),Ue=me(()=>{if(!Ge){if(Ge=!0,typeof K=="function")try{K()}catch{}Xe({timedOut:!0,result:void 0})}},ce),Ue&&typeof Ue.unref=="function"&&Ue.unref()})}function Nt(I,N){if(!C||typeof C!="object")return!1;try{return Object.defineProperty(C,I,{configurable:!0,enumerable:!1,value:N,writable:!1}),!0}catch{try{return C[I]=N,!0}catch{return!1}}}const xo=(function(){return w&&typeof w.exposeGlobal=="function"?function(K,oe,ce){try{return w.exposeGlobal(K,oe,ce)}catch{return Nt(K,oe)}}:v&&typeof v.exposeGlobal=="function"?function(K,oe,ce){try{return v.exposeGlobal(K,oe,ce)}catch{return Nt(K,oe)}}:b&&typeof b.exposeGlobal=="function"?function(K,oe,ce){return b.exposeGlobal(K,oe,C,ce)}:Nt})(),Io=["cameraPowerPlanner_schemaCache","cinePowerPlanner_schemaCache"],qo=["","__backup","__legacyMigrationBackup"],eo=new Set;let To=null;function ko(I){if(!(!C||typeof C!="object"&&typeof C!="function"))try{return C[I]}catch{return}}function Jt(I){return I||(typeof window<"u"?window:ko("window"))}function lr(I){if(I)return I;if(typeof navigator<"u")return navigator;const N=Jt();return N&&typeof N.navigator<"u"?N.navigator:ko("navigator")}function pt(I){return!I||typeof I!="object"||typeof I.onLine!="boolean"?!1:I.onLine===!1}function mo(I){if(I)return I;if(typeof caches<"u")return caches;const N=Jt();return N&&typeof N.caches<"u"?N.caches:ko("caches")}function go(I){if(I&&typeof I=="object")return I;const N=Jt();return N&&N.location&&typeof N.location=="object"?N.location:ko("location")}function So(I,N){if(typeof I=="function")return I;if(typeof fetch=="function")return fetch;const K=N||Jt();if(K&&typeof K.fetch=="function")try{return K.fetch.bind(K)}catch{return K.fetch}const oe=ko("fetch");return typeof oe=="function"?oe:null}function k(){if(typeof AbortController!="function")return null;try{return new AbortController}catch{return null}}function Q(I){const N=new Error(I);return N.name="TimeoutError",N.code="ETIMEDOUT",N}function X(I,N,K,oe){if(typeof I!="function")return Promise.resolve({successful:!1,error:new Error("Fetch unavailable"),timedOut:!1});const ce=K?{...K}:{},me=k();let De=null,Ge=!1;if(me&&typeof me.signal<"u")try{ce.signal=me.signal}catch{}let Ue=null;typeof oe=="number"&&oe>0&&typeof setTimeout=="function"&&(Ue=new Promise((ot,_t)=>{try{De=setTimeout(()=>{if(Ge=!0,me&&typeof me.abort=="function")try{me.abort()}catch(Lt){}_t(Q("Connectivity probe timed out"))},oe)}catch{Ue=null}}));const Xe=()=>{if(De)try{clearTimeout(De)}catch{}},ft=(()=>{try{return I(N,ce)}catch(ot){return Xe(),Promise.reject(ot)}})();return(Ue?Promise.race([ft,Ue]):ft).then(ot=>(Xe(),{successful:!0,value:ot,timedOut:!1})).catch(ot=>(Xe(),{successful:!1,error:ot,timedOut:Ge}))}function ae(I){if(!I)return!1;try{if(I.ok===!0)return!0}catch{}let N=0;try{N=typeof I.status=="number"?I.status:0}catch{N=0}return N===0?!0:N>=200&&N<400}function Ae(I,N){if(!I||typeof I!="string"||typeof N>"u"||N===null)return I;let K;if(typeof N=="string")K=N;else try{K=String(N)}catch{return I}if(!K)return I;let oe=I,ce="";const me=oe.indexOf("#");me!==-1&&(ce=oe.slice(me),oe=oe.slice(0,me));const De=oe.indexOf("?")===-1?"?":"&",Ge=encodeURIComponent(o),Ue=encodeURIComponent(K);return`${oe}${De}${Ge}=${Ue}${ce}`}function Se(I){if(!I||!I.headers||typeof I.headers.get!="function")return null;try{const N=I.headers.get(n);if(typeof N=="string"&&N)return N.toLowerCase()}catch{}return null}function Oe(I,N){if(I&&typeof I.nextHref=="string"&&I.nextHref)return I.nextHref;if(I&&typeof I.originalHref=="string"&&I.originalHref)return I.originalHref;const K=Co(N);if(K)return K;const oe=hr(N);return oe||"index.html"}async function Ne({navigatorLike:I,windowLike:N,locationLike:K,fetchFn:oe,forceReloadUrl:ce,timeoutMs:me}){if(pt(I))return{reachable:!1,reason:"offline"};const De=oe||So(void 0,N);if(typeof De!="function")return{reachable:!0,reason:"fetch-unavailable"};const Ge=`${Date.now().toString(36)}-${Math.random().toString(36).slice(2)}`,Ue=Ae(Oe(ce,K),Ge),Xe={"Cache-Control":"no-store, max-age=0",Pragma:"no-cache"};typeof Ge=="string"&&Ge&&(Xe[r]=Ge);let ft=null;const Le=await X(De,Ue,{method:"HEAD",cache:"no-store",credentials:"same-origin",headers:Xe},me);if(Le.successful){let _t=0;try{_t=Le.value&&typeof Le.value.status=="number"?Le.value.status:0}catch{_t=0}const Lt=Se(Le.value);if(Lt&&Lt!==a)ft={source:"head",status:_t,probeResult:Lt||s};else{if(ae(Le.value))return{reachable:!0,reason:"head-ok"};ft={source:"head",status:_t}}}else{if(Le.timedOut)return{reachable:!1,reason:"timeout",detail:Le.error};Le.error&&(ft={source:"head",error:Le.error})}const ot=await X(De,Ue,{method:"GET",cache:"no-store",credentials:"same-origin",headers:{...Xe}},me);if(ot.successful){const _t=Se(ot.value);return _t&&_t!==a?{reachable:!1,reason:"cache-fallback",detail:{status:ot.value&&typeof ot.value.status=="number"?ot.value.status:void 0,head:ft,probeResult:_t||s}}:ae(ot.value)?{reachable:!0,reason:"get-ok"}:{reachable:!1,reason:"get-failed",detail:{status:ot.value&&typeof ot.value.status=="number"?ot.value.status:void 0,head:ft}}}return ot.timedOut?{reachable:!1,reason:"timeout",detail:ot.error}:{reachable:!1,reason:"unreachable",detail:ot.error||ft||Le.error}}function Qe(I){return typeof I!="function"?function(){}:(O.add(I),function(){try{O.delete(I)}catch{}})}function Fe(I){if(typeof I=="function")try{O.delete(I)}catch{}}function _e(I,N){if(!I||typeof I!="object")return;const K=I.detail&&typeof I.detail=="object"?{...I.detail,stage:N&&N.stage||"probe",source:N&&N.source||"probe"}:{stage:N&&N.stage||"probe",source:N&&N.source||"probe"};if(I.reachable){U({status:"online",reason:typeof I.reason=="string"&&I.reason?I.reason:"probe-ok",detail:K,source:N&&N.source||"probe"});return}const oe=I.reason==="offline"?"offline":"degraded";U({status:oe,reason:typeof I.reason=="string"&&I.reason?I.reason:"unknown",detail:K,source:N&&N.source||"probe"})}function He(I){const N=I||Jt();if(N&&typeof N.XMLHttpRequest=="function")return N.XMLHttpRequest;if(typeof XMLHttpRequest=="function")return XMLHttpRequest;const K=ko("XMLHttpRequest");return typeof K=="function"?K:null}function st(I,N,K){if(!N||typeof N!="object"&&typeof N!="function")return;const oe=typeof N.removeItem=="function",ce=typeof N.delete=="function";!oe&&!ce||I.add(N)}function at(I,N,K){if(!N||typeof N!="object"&&typeof N!="function")return;try{st(I,N.SAFE_LOCAL_STORAGE,`${K}.SAFE_LOCAL_STORAGE`)}catch(ce){const me=`${K}.SAFE_LOCAL_STORAGE`;eo.has(me)||(eo.add(me),ue(`Unable to inspect ${me} while clearing UI caches`,ce))}try{st(I,N.localStorage,`${K}.localStorage`)}catch(ce){const me=`${K}.localStorage`;eo.has(me)||(eo.add(me),ue(`Unable to inspect ${me} while clearing UI caches`,ce))}try{st(I,N.sessionStorage,`${K}.sessionStorage`)}catch(ce){const me=`${K}.sessionStorage`;eo.has(me)||(eo.add(me),ue(`Unable to inspect ${me} while clearing UI caches`,ce))}let oe=null;try{oe=N.__cineGlobal}catch(ce){const me=`${K}.__cineGlobal`;eo.has(me)||(eo.add(me),ue(`Unable to inspect ${me} while clearing UI caches`,ce))}oe&&oe!==N&&at(I,oe,`${K}.__cineGlobal`)}function St(I={}){const N=new Set,K=typeof I.resolveSafeLocalStorage=="function"?I.resolveSafeLocalStorage:typeof ko("resolveSafeLocalStorage")=="function"?ko("resolveSafeLocalStorage"):null,oe=I.safeLocalStorage||ko("SAFE_LOCAL_STORAGE");try{const Ge=K?K():null;st(N,Ge,"safeLocalStorage")}catch(Ge){ue("resolveSafeLocalStorage() failed while collecting UI cache storages",Ge)}if(oe)try{st(N,oe,"SAFE_LOCAL_STORAGE")}catch(Ge){const Ue="SAFE_LOCAL_STORAGE";eo.has(Ue)||(eo.add(Ue),ue("Unable to inspect SAFE_LOCAL_STORAGE while clearing UI caches",Ge))}const ce=I.scopeCandidates||[{scope:ko("globalThis"),label:"globalThis"},{scope:Jt(I.window),label:"window"},{scope:typeof self<"u"?self:ko("self"),label:"self"},{scope:ko("global"),label:"global"}],me=typeof C<"u"?C.__cineGlobal:void 0;typeof me<"u"&&ce.push({scope:me,label:"__cineGlobal"}),ce.forEach(({scope:Ge,label:Ue})=>{at(N,Ge,Ue)});const De=Jt(I.window);if(De){try{st(N,De.localStorage,"window.localStorage")}catch(Ge){const Ue="window.localStorage";eo.has(Ue)||(eo.add(Ue),ue("Unable to inspect window.localStorage while clearing UI caches",Ge))}try{st(N,De.sessionStorage,"window.sessionStorage")}catch(Ge){const Ue="window.sessionStorage";eo.has(Ue)||(eo.add(Ue),ue("Unable to inspect window.sessionStorage while clearing UI caches",Ge))}}return N}function kt(I={}){const N=I.storages||St(I);if(!N||!N.size)return!1;let K=!1;return N.forEach(oe=>{Io.forEach(ce=>{typeof ce!="string"||!ce||qo.forEach(me=>{const De=me?`${ce}${me}`:ce;try{typeof oe.removeItem=="function"?(oe.removeItem(De),K=!0):typeof oe.delete=="function"&&(oe.delete(De),K=!0)}catch(Ge){ue("Failed to remove UI cache entry",{entryKey:De,error:Ge})}})})}),K}async function Zt(I){const N=lr(I);if(!N||!N.serviceWorker)return[];const{serviceWorker:K}=N,oe=[],ce=me=>{me&&oe.push(me)};try{if(typeof K.getRegistrations=="function"){const me=await K.getRegistrations();Array.isArray(me)&&me.forEach(ce)}else if(typeof K.getRegistration=="function"){const me=await K.getRegistration();ce(me)}else if(K.ready&&typeof K.ready.then=="function")try{const me=await K.ready;ce(me)}catch(me){ue("Failed to await active service worker",me)}}catch(me){ue("Failed to query service worker registrations",me)}return oe}async function Ht(I){if(!I)return[];try{const N=await Promise.resolve(I);return Array.isArray(N)?N.filter(K=>!!K):[]}catch(N){ue("Failed to resolve prefetched service worker registrations",N)}return[]}async function jo(I,N){const K=lr(I);if(!K||!K.serviceWorker)return!1;let oe=await Ht(N);return oe.length||(oe=await Zt(K)),oe.length?(await Promise.all(oe.map(ce=>!ce||typeof ce.unregister!="function"?Promise.resolve(!1):ce.unregister().catch(me=>(ue("Service worker unregister failed",me),!1)))),!0):!1}function ir(I){const N=lr(I);if(!N||!N.serviceWorker)return null;const{serviceWorker:K}=N;if(!K)return null;let oe=!1,ce=null,me=null,De=!1;const Ge=Xe=>{if(oe)return;oe=!0;const ft=me;if(me=null,typeof ce=="function"){try{ce()}catch{}ce=null}if(typeof ft=="function")try{ft(Xe)}catch{}},Ue=new Promise(Xe=>{if(me=Xe,K.controller){Ge(!0);return}const ft=()=>{Ge(!0)};try{if(typeof K.addEventListener=="function")K.addEventListener("controllerchange",ft),ce=()=>{try{K.removeEventListener("controllerchange",ft)}catch(Le){}},De=!0;else if("oncontrollerchange"in K){const Le=K.oncontrollerchange;K.oncontrollerchange=function(_t){if(typeof Le=="function")try{Le.call(this,_t)}catch(Lt){ue("Existing service worker controllerchange handler failed",Lt)}ft(_t)},ce=()=>{try{K.oncontrollerchange=Le}catch(ot){}},De=!0}else Ge(!1)}catch(Le){ue("Failed to observe service worker controllerchange",Le),Ge(!1)}});return!De&&!K.controller?(Ge(!1),null):{promise:Ue,cancel(){Ge(!1)}}}const sr=["cine-power-planner","cinepowerplanner"];function Ro(){const I=ko("CINE_CACHE_NAME");return typeof I=="string"&&I?I:null}function Ot(I,N,K){if(typeof I!="string"||!I)return!1;if(N&&(I===N||I.toLowerCase()===K))return!0;const oe=I.toLowerCase();for(let ce=0;ce<sr.length;ce+=1)if(oe.includes(sr[ce]))return!0;return!1}async function Lr(I){const N=mo(I);if(!N||typeof N.keys!="function")return!1;const K=Ro(),oe=K?K.toLowerCase():null;try{const ce=await N.keys();if(!Array.isArray(ce)||!ce.length)return!1;const me=ce.filter(Ge=>Ot(Ge,K,oe));if(!me.length)return!1;let De=!1;return await Promise.all(me.map(Ge=>!Ge||typeof N.delete!="function"?Promise.resolve(!1):N.delete(Ge).then(Ue=>(De=De||!!Ue,Ue)).catch(Ue=>(ue("Failed to delete cache",{key:Ge,error:Ue}),!1)))),De}catch(ce){return ue("Cache clear failed",ce),!1}}function Co(I){if(!I||typeof I!="object")return"";try{const N=I.href;return typeof N=="string"?N:""}catch{return""}}function hr(I){if(!I||typeof I!="object")return"";try{const N=I.pathname;return typeof N=="string"?N:""}catch{return""}}function Wo(I){if(!I||typeof I!="object")return"";try{const oe=I.origin;if(typeof oe=="string"&&oe)return oe}catch{}const N=Co(I);if(!N)return"";if(typeof URL=="function")try{return new URL(N).origin}catch{}const K=N.match(/^([a-zA-Z][a-zA-Z\d+.-]*:\/\/[^/]+)/);return K&&K[1]?K[1]:""}function Yo(I,N){if(typeof I!="string"||!I)return"";const K=typeof N=="string"&&N?N:void 0;if(typeof URL=="function")try{const ce=new URL(I,K);if(ce&&typeof ce.origin=="string")return ce.origin}catch{}const oe=I.match(/^([a-zA-Z][a-zA-Z\d+.-]*:\/\/[^/]+)/);return oe&&oe[1]?oe[1]:""}function Tt(I,N){if(typeof N!="string"||!N)return!1;const K=I&&typeof I=="object"?I:typeof window<"u"&&window&&window.location?window.location:null,oe=Co(I)||Co(K),ce=Yo(N,oe);if(!ce)return!0;const me=Wo(I)||Wo(K);return me?ce===me:!1}function $o(I,N){const K=[],oe=new Set,ce=Ue=>{if(typeof Ue!="string")return;const Xe=Ue.trim();!Xe||oe.has(Xe)||(oe.add(Xe),K.push(Xe))},me=Co(I);me&&ce(me),typeof N=="string"&&N&&ce(N);const De=Wo(I),Ge=hr(I);if(De&&(Ge&&ce(`${De}${Ge}`),ce(`${De}/`)),typeof window<"u"&&window&&window.location){const Ue=Co(window.location);Ue&&ce(Ue)}return K}function br(I,N){if(typeof I!="string")return"";const K=I.trim();if(!K)return"";if(typeof URL=="function")try{return new URL(K).toString()}catch{if(typeof N=="string"&&N)try{return new URL(K,N).toString()}catch{}}return K}function Do(I,N,K){if(Tt(I,K))return K;const oe=Co(I),ce=typeof N=="string"&&N?N:"",me=[];oe&&Tt(I,oe)&&me.push(oe),ce&&Tt(I,ce)&&me.push(ce);const De=me.length?me[0]:oe,Ge=Wo(I);if(typeof URL=="function"&&De)try{const Ue=new URL(K,De),Xe=`${Ue.origin||""}${Ue.pathname||""}${Ue.search||""}${Ue.hash||""}`;if(Xe&&Tt(I,Xe))return Xe}catch{}if(typeof K=="string"&&Ge){const Ue=/^[a-zA-Z][a-zA-Z\d+.-]*:\/\/[^/]+(.*)$/,Xe=K.match(Ue);if(Xe&&Xe[1]){const ft=`${Ge}${Xe[1]}`;if(Tt(I,ft))return ft}}return me.length?me[0]:Ge||""}function ur(I,N,K="forceReload"){const oe=N&&typeof N.param=="string"&&N.param?N.param:K,ce=N&&typeof N.timestamp=="string"&&N.timestamp?N.timestamp:Date.now().toString(36),De=(N&&typeof N.originalHref=="string"&&N.originalHref?N.originalHref:Co(I))||Co(I),Ge=N&&typeof N.nextHref=="string"&&N.nextHref?N.nextHref:De,Ue=Do(I,De,Ge);return{originalHref:De,nextHref:Ue,param:oe,timestamp:ce}}function or(I,N){const K=N,oe=Date.now().toString(36),ce=Co(I),me=$o(I,ce);if(!ce)return{originalHref:ce,nextHref:ce,param:K,timestamp:oe};if(typeof URL=="function"){const ot=[ce,...me];for(let _t=0;_t<ot.length;_t+=1){const Lt=ot[_t];try{const Qt=_t===0?new URL(Lt):new URL(ce,Lt);Qt.searchParams.set(K,oe);const Gt=Qt.toString();return{originalHref:ce,nextHref:Do(I,ce,Gt),param:K,timestamp:oe}}catch{}}}let De=ce,Ge="";const Ue=De.indexOf("#");Ue!==-1&&(Ge=De.slice(Ue),De=De.slice(0,Ue));const Xe=new RegExp(`([?&])${K}=[^&]*`),ft=`$1${K}=${oe}`;if(Xe.test(De)?De=De.replace(Xe,ft):De.indexOf("?")!==-1?De+=`&${K}=${oe}`:De&&(De+=`?${K}=${oe}`),typeof URL=="function")for(let ot=0;ot<me.length;ot+=1){const _t=me[ot];try{const Qt=new URL(De+Ge,_t).toString();return{originalHref:ce,nextHref:Do(I,ce,Qt),param:K,timestamp:oe}}catch{}}const Le=De?De+Ge:ce;return{originalHref:ce,nextHref:Do(I,ce,Le),param:K,timestamp:oe}}function Vo(I,N){if(typeof I!="string"||!I)return!1;const K=I.trim();if(!K)return!1;const ce=`#${typeof N=="string"&&N?N:"forceReload"}`;if(!K.startsWith(ce))return!1;if(K.length===ce.length)return!0;const me=K.slice(ce.length);return/^[-=]/.test(me)}function Po(I,N){if(typeof I!="string"||!I)return I;if(typeof URL=="function"){const K=typeof N=="string"&&N?N:void 0;try{const oe=new URL(I,K);return`${oe.pathname||""}${oe.search||""}${oe.hash||""}`||oe.toString()}catch{}}return I}function co(I,N="forceReload"){const K=Jt(I);if(!K||!K.location)return!1;const{location:oe}=K,ce=Co(oe);if(!ce)return!1;const me=typeof N=="string"&&N?N:"forceReload";let De=ce,Ge=!1,Ue=!1;if(typeof URL=="function")try{const Le=new URL(ce);Le.searchParams&&typeof Le.searchParams.delete=="function"&&Le.searchParams.has(me)&&(Le.searchParams.delete(me),Ge=!0),Vo(Le.hash,me)&&(Le.hash="",Ue=!0),De=Le.toString()}catch{}if(!Ge){let Le=De,ot="";const _t=Le.indexOf("#");_t!==-1&&(ot=Le.slice(_t),Le=Le.slice(0,_t));const Lt=Le.indexOf("?");if(Lt!==-1){const Qt=Le.slice(0,Lt),ho=Le.slice(Lt+1).split("&"),Qo=[];for(let Xo=0;Xo<ho.length;Xo+=1){const No=ho[Xo];if(!No)continue;const ao=No.indexOf("=");if((ao===-1?No:No.slice(0,ao))===me){Ge=!0;continue}Qo.push(No)}Le=Qo.length?`${Qt}?${Qo.join("&")}`:Qt}De=ot?`${Le}${ot}`:Le}if(!Ue&&Vo(K.location&&K.location.hash,me)&&(Ue=!0,De=De.replace(/#.*$/,"")),!Ge&&!Ue)return!1;const Xe=br(ce,ce)||ce;let ft=null;try{ft=K.history||null}catch(Le){ue("Force reload cleanup failed to access history object",Le),ft=null}if(ft&&typeof ft.replaceState=="function"){let Le=null,ot=!1;try{Le=ft.state,ot=!0}catch(Lt){ue("Force reload cleanup failed to snapshot history state",Lt)}const _t=Po(De,Xe);try{return ft.replaceState(ot?Le:null,"",_t),!0}catch(Lt){ue("Force reload cleanup failed to update history state",Lt)}}if(Ue)try{if(typeof K.location.hash=="string"&&Vo(K.location.hash,me))return K.location.hash="",!0}catch(Le){ue("Force reload cleanup failed to clear hash fallback",Le)}return!1}function mr(I,N,K,oe,ce,me){let De=null;try{typeof window<"u"&&window&&typeof window.setTimeout=="function"&&(De=window.setTimeout.bind(window))}catch{}if(!De)if(typeof setTimeout=="function")De=setTimeout;else{ue("Forced reload navigation attempt did not update location",{description:K,before:oe,after:me,expected:ce});return}let Ge=!1;const Ue=()=>{const ft=Co(I),Le=br(ft,N);return ce&&(Le===ce||Le===`${ce}#`)||oe!==Le&&Le&&(!ce||Le===ce)?(Ge=!0,{matched:!0,value:Le}):{matched:!1,value:Le}},Xe=[90,240,480];Xe.forEach((ft,Le)=>{const ot=Le===Xe.length-1,_t=()=>{if(Ge)return;const Lt=Ue();Lt.matched||ot&&(Ge=!0,ue("Forced reload navigation attempt did not update location",{description:K,before:oe,after:Lt.value,expected:ce}))};try{De(_t,ft)}catch{ot&&_t()}})}function Sr(I,N,K,oe,ce){if(!I||typeof oe!="function"||typeof N!="string"||!N)return!1;const me=Co(I),De=br(me,K);try{oe(N)}catch(ft){return ue("Forced reload navigation helper failed",{description:ce,error:ft}),!1}const Ge=Co(I),Ue=br(Ge,K),Xe=br(N,K);return Xe&&(Ue===Xe||Ue===`${Xe}#`)||De!==Ue&&Ue&&(!Xe||Ue===Xe)?!0:(mr(I,K,ce,De,Xe,Ue),!1)}function jr(I,N,K,oe){if(!I||!N||typeof K!="string"||!K)return!1;let ce=null;try{ce=I.history||null}catch(Lt){ue("Forced reload history access failed",Lt),ce=null}if(!ce||typeof ce.replaceState!="function")return!1;const me=Co(N),De=br(me,oe),Ge=br(K,oe);let Ue=K;try{const Lt=me||oe||void 0,Qt=typeof URL=="function"?new URL(K,Lt):null;Qt&&(Ue=`${Qt.pathname||""}${Qt.search||""}${Qt.hash||""}`||Qt.toString())}catch(Lt){ue("Forced reload history fallback URL parse failed",Lt),Ue=K}let Xe=null,ft=!1;try{Xe=ce.state,ft=!0}catch(Lt){ue("Forced reload history state snapshot failed",Lt)}try{ce.replaceState(ft?Xe:null,"",Ue)}catch(Lt){return ue("Forced reload history replaceState failed",Lt),!1}const Le=Co(N),ot=br(Le,oe);if(!(Ge&&(ot===Ge||ot===`${Ge}#`)||De!==ot&&ot&&(!Ge||ot===Ge)))return mr(N,oe,"history.replaceState",De,Ge,ot),!1;if(typeof N.reload=="function")try{return N.reload(),!0}catch(Lt){ue("Forced reload via history replaceState reload failed",Lt)}return!0}function Qr(I,N,K={}){if(!I||!N)return;let oe=null;try{typeof I.setTimeout=="function"&&(oe=I.setTimeout.bind(I))}catch{}if(!oe)if(typeof setTimeout=="function")oe=setTimeout;else return;const ce=K.hasReload===!0&&typeof N.reload=="function",me=typeof K.baseHref=="string"?K.baseHref:"",De=typeof K.nextHref=="string"?K.nextHref:"",Ge=typeof K.originalHref=="string"?K.originalHref:"",Ue=De||me||Ge||"",Xe=Ue?Ue.split("#")[0]:me||Ge||"",ft=typeof K.timestamp=="string"&&K.timestamp?K.timestamp:Date.now().toString(36),Le=Xe?`${Xe}#forceReload-${ft}`:"",ot=[];let _t=120;const Lt=120,Qt=Gt=>{ot.push({delay:_t,run:Gt}),_t+=Lt};if(Ue&&(typeof N.assign=="function"&&Qt(()=>{try{N.assign(Ue)}catch(Gt){ue("Forced reload fallback via location.assign failed",Gt)}}),typeof N.replace=="function"&&Qt(()=>{try{N.replace(Ue)}catch(Gt){ue("Forced reload fallback via location.replace failed",Gt)}}),Qt(()=>{try{N.href=Ue}catch(Gt){ue("Forced reload fallback via href assignment failed",Gt)}})),Le&&Le!==Ue&&Qt(()=>{try{N.href=Le}catch(Gt){ue("Forced reload fallback via hash injection failed",Gt)}}),ce){const Gt=ot.length?Math.max(_t,280):280;ot.push({delay:Gt,run(){try{N.reload()}catch(ho){ue("Timed force reload fallback failed",ho)}}})}ot.length&&ot.forEach(Gt=>{try{oe(Gt.run,Gt.delay)}catch(ho){ue("Unable to schedule forced reload fallback",ho)}})}function an(I,N){const K=Jt(I);if(!K||!K.location)return!1;const{location:oe}=K,ce=oe&&typeof oe.replace=="function",me=oe&&typeof oe.assign=="function",De=oe&&typeof oe.reload=="function";let Ge=!1;const Ue=N&&typeof N=="object"?N:or(oe,"forceReload"),Xe=ur(oe,Ue,"forceReload"),Le=(typeof Xe.originalHref=="string"&&Xe.originalHref?Xe.originalHref:Co(oe))||Co(oe),ot=typeof Xe.nextHref=="string"?Xe.nextHref:"",_t=Xe.timestamp,Lt=br(Le,Le)||Le;if(ce&&ot&&(Ge=Sr(oe,ot,Lt,Gt=>{oe.replace(Gt)},"location.replace")),me&&!Ge&&ot&&(Ge=Sr(oe,ot,Lt,Gt=>{oe.assign(Gt)},"location.assign")),!Ge&&ot&&ot!==Le&&(Ge=Sr(oe,ot,Lt,Gt=>{oe.href=Gt},"location.href assignment")),!Ge&&K&&ot&&(Ge=jr(K,oe,ot,Lt)),!Ge&&(!ot||ot===Le)&&De)try{oe.reload(),Ge=!0}catch(Gt){ue("Forced reload via location.reload failed",Gt)}return Ge||Qr(K,oe,{originalHref:Le,baseHref:Lt,nextHref:ot,hasReload:De,timestamp:_t}),Ge}async function Sn(I={}){const N=Jt(I.window),K=go(I.location||N&&N.location),oe=ur(K,or(K,"forceReload"),"forceReload"),ce=lr(I.navigator),me=await Ne({navigatorLike:ce,windowLike:N,locationLike:K,fetchFn:So(I.fetch,N),forceReloadUrl:oe,timeoutMs:typeof I.connectivityProbeTimeoutMs=="number"?I.connectivityProbeTimeoutMs:Me});if(_e(me,{stage:"reload-app-probe",source:"reloadApp.probe"}),!me.reachable){const Kt=typeof I.onOfflineReloadBlocked=="function"?I.onOfflineReloadBlocked:ko("announceForceReloadOfflineNotice");if(typeof Kt=="function")try{Kt({reason:me.reason||"offline",source:"reloadApp"})}catch(Oo){ue("Failed to announce offline reload guard",Oo)}return me.detail&&me.reason!=="offline"&&ue("Connectivity probe blocked forced reload",me.detail),U({status:"degraded",reason:"reload-blocked",detail:{previousReason:me.reason||"offline",stage:"reload-app",source:"reloadApp.blocked"},source:"reloadApp.blocked"}),{blocked:!0,reason:me.reason||"offline",uiCacheCleared:!1,serviceWorkersUnregistered:!1,serviceWorkerStatusKnown:!1,warmupCompleted:!1,cachesCleared:!1,reloadTriggered:!1,navigationTriggered:!1}}const De=ce&&ce.serviceWorker?Zt(ce):Promise.resolve([]);let Ge=!1;const Ue=typeof I.clearUiCacheStorageEntries=="function"?I.clearUiCacheStorageEntries:typeof ko("clearUiCacheStorageEntries")=="function"?ko("clearUiCacheStorageEntries"):null;if(Ue)try{Ue(),Ge=!0}catch(Kt){ue("Failed to clear UI caches via storage helper",Kt)}if(!Ge)try{Ge=kt(I)}catch(Kt){ue("Fallback UI cache clear failed",Kt)}const Xe=(async()=>{try{return await jo(I.navigator,De)}catch(Kt){return ue("Service worker cleanup failed",Kt),!1}})(),ft=(async()=>{try{return await Lr(I.caches)}catch(Kt){return ue("Cache clear failed",Kt),!1}})(),Le=fo({window:N,navigator:I.navigator,fetch:I.fetch,nextHref:oe.nextHref,serviceWorkerPromise:Xe,cachePromise:ft,allowCache:!0,warmupWaitMs:typeof I.warmupWaitMs=="number"?I.warmupWaitMs:void 0}),ot=Kt=>!Kt||typeof Kt!="object"?null:Kt.promise&&typeof Kt.promise.then=="function"?Kt.promise:Kt.done&&typeof Kt.done.then=="function"?Kt.done:null,_t=(Kt,Oo)=>!Oo||typeof Oo.then!="function"?Promise.resolve({source:Kt,value:Oo,successful:!0,error:null}):Promise.resolve(Oo).then(Dt=>({source:Kt,value:Dt,successful:!0,error:null})).catch(Dt=>({source:Kt,value:void 0,successful:!1,error:Dt})),Lt=ot(Le),Qt=ir(I.navigator),Gt=Qt?_t("controllerChange",Qt.promise):null;let ho=!1;const Xo=_t("serviceWorker",Xe).then(Kt=>(!Kt.successful&&Kt.error&&!ho&&(ho=!0,ue("Service worker cleanup promise rejected",Kt.error)),Kt)),No=Lt?_t("warmup",Lt):null,ao=[Xo];No&&ao.push(No),Gt&&ao.push(Gt);const Ir=ao.length>1?Promise.race(ao):ao[0];let cr=!1,Rr=!1,Er=!1;try{const Kt=typeof I.cleanupTimeoutMs=="number"?I.cleanupTimeoutMs:We,Oo=await no(Ir,Kt,()=>{ue("Service worker cleanup or warmup timed out before reload, continuing anyway.",{timeoutMs:Kt})},Dt=>{if(Dt&&Dt.source==="warmup"){const qr=Dt.error||Dt;ue("Reload warmup failed after reload triggered",qr);return}const Fo=Dt&&Dt.error?Dt.error:Dt;ue("Service worker cleanup failed after reload triggered",Fo)});if(Oo&&Oo.timedOut!==!0){const Dt=Oo.result;Dt&&Dt.source==="serviceWorker"?(Er=!0,Dt.successful?cr=!!Dt.value:!ho&&Dt.error&&(ho=!0,ue("Service worker cleanup promise rejected",Dt.error))):Dt&&Dt.source==="controllerChange"?(Er=!0,!Dt.successful&&Dt.error&&ue("Service worker controllerchange watcher rejected",Dt.error)):Dt&&Dt.source==="warmup"&&(Rr=Dt.successful&&Dt.value===!0,!Dt.successful&&Dt.error&&ue("Reload warmup promise rejected before reload triggered",Dt.error))}}catch(Kt){const Oo=Kt&&Kt.error?Kt.error:Kt;ue("Reload preparation gate failed",Oo)}finally{if(Qt)try{Qt.cancel()}catch{}}let rr=!1;const $r=typeof I.reloadWindow=="function"?I.reloadWindow:an;try{rr=$r(I.window,oe)}catch(Kt){ue("Forced reload handler failed",Kt),rr=an(I.window,oe)}if(!rr&&N&&N.location&&typeof N.location.reload=="function")try{N.location.reload(),rr=!0}catch(Kt){ue("Final reload attempt failed",Kt)}let Pr=!1;try{Pr=await ft}catch(Kt){ue("Cache cleanup promise rejected",Kt),Pr=!1}return{uiCacheCleared:Ge,serviceWorkersUnregistered:cr,serviceWorkerStatusKnown:Er,warmupCompleted:Rr,cachesCleared:Pr,reloadTriggered:rr,navigationTriggered:rr}}function Re(I){if(!I||!I.document)return!1;const{document:N}=I;return typeof N.readyState=="string"?N.readyState==="complete":!1}function Ye(I="service-worker.js",N={}){const K=Jt(N.window),oe=lr(N.navigator);if(!oe||!oe.serviceWorker||typeof oe.serviceWorker.register!="function")return Promise.resolve(null);const ce=()=>{try{const Ge=oe.serviceWorker.register(I,N.registrationOptions);return Ge.catch(Ue=>{ue("Service worker registration failed",Ue)}),Ge}catch(Ge){return ue("Service worker registration threw an exception",Ge),Promise.reject(Ge)}},me=Ge=>{const Ue=Promise.resolve(Ge).finally(()=>{To=null});return To=Ue,Ue};if(!K||typeof K.addEventListener!="function")return ce();if(To)return To;if(Re(K)||N.immediate===!0)return me(Promise.resolve().then(()=>ce()));const De=new Promise((Ge,Ue)=>{const Xe=()=>{try{K.removeEventListener("load",Xe)}catch{}try{Ge(ce())}catch(ft){Ue(ft)}};K.addEventListener("load",Xe,{once:!0})});return me(De)}function ke(I){const N=I||Jt();!N||typeof N.addEventListener!="function"||(N.addEventListener("online",()=>{U({status:"online",source:"navigator"})}),N.addEventListener("offline",()=>{U({status:"offline",source:"navigator"})}),typeof N.navigator<"u"&&N.navigator.onLine===!1&&U({status:"offline",source:"navigator-init"}))}const ee={registerServiceWorker:Ye,reloadApp:Sn,getConnectivityState(){return G},subscribeConnectivityStatus:Qe,unsubscribeConnectivityStatus:Fe,__internal:{collectFallbackUiCacheStorages:St,clearUiCacheEntriesFallback:kt,unregisterServiceWorkers:jo,clearCacheStorage:Lr,triggerReload:an,cleanupForceReloadArtifacts:co,coerceForceReloadUrlDescriptor:ur,scheduleReloadWarmup:fo,initConnectivityListeners:ke,updateOfflineUi:W,emitConnectivityState:U}};if(co(),ke(),bo(ee),j("cineOffline",ee),et("cineOffline",ee,{category:"offline",description:"Offline helpers for service worker registration and cache recovery.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},I=>{ue("Unable to register cineOffline in module registry.",I)}),C&&typeof C=="object"){let I=null;try{I=C.cineOffline||null}catch{I=null}I!==ee&&(xo("cineOffline",ee,{configurable:!0,enumerable:!1,writable:!1})||ue("Unable to expose cineOffline globally."))}typeof module<"u"&&module&&module.exports&&(module.exports=ee)})();var define_process_env_default$3={};function detectGlobalScope$j(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}var PRIMARY_SCOPE$4=detectGlobalScope$j();function collectCandidateScopes$6(e){var t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}return o(e),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),t}function tryRequireLocal(e){return null}function resolveFromScopes$3(e){for(var t=collectCandidateScopes$6(PRIMARY_SCOPE$4),o=0;o<t.length;o+=1){var r=t[o];if(r&&typeof r[e]=="object")return r[e]}return null}var MODULE_BASE$9=(function(){return baseApi&&typeof baseApi=="object"?baseApi:resolveFromScopes$3("cineModuleBase")})(),MODULE_ENV$1=(function(){return cineModuleEnvironment&&typeof cineModuleEnvironment=="object"?cineModuleEnvironment:resolveFromScopes$3("cineModuleEnvironment")})(),ENV_BRIDGE$1=(function(){return cineEnvironmentBridge&&typeof cineEnvironmentBridge=="object"?cineEnvironmentBridge:resolveFromScopes$3("cineEnvironmentBridge")})(),GLOBAL_SCOPE$f=(ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.getGlobalScope=="function"?ENV_BRIDGE$1.getGlobalScope():null)||(MODULE_ENV$1&&typeof MODULE_ENV$1.getGlobalScope=="function"?MODULE_ENV$1.getGlobalScope():null)||(MODULE_BASE$9&&typeof MODULE_BASE$9.getGlobalScope=="function"?MODULE_BASE$9.getGlobalScope():null)||PRIMARY_SCOPE$4,PENDING_QUEUE_KEY$1=(function(){if(ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.getPendingQueueKey=="function")try{var t=ENV_BRIDGE$1.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return MODULE_ENV$1&&typeof MODULE_ENV$1.PENDING_QUEUE_KEY=="string"&&MODULE_ENV$1.PENDING_QUEUE_KEY?MODULE_ENV$1.PENDING_QUEUE_KEY:MODULE_BASE$9&&typeof MODULE_BASE$9.PENDING_QUEUE_KEY=="string"&&MODULE_BASE$9.PENDING_QUEUE_KEY?MODULE_BASE$9.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function ensureQueue$2(e){var t=e||GLOBAL_SCOPE$f;if(!t||typeof t!="object")return null;var o=null;try{o=t[PENDING_QUEUE_KEY$1]}catch{o=null}if(Array.isArray(o))return o;try{Object.defineProperty(t,PENDING_QUEUE_KEY$1,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=t[PENDING_QUEUE_KEY$1]}catch{try{Array.isArray(t[PENDING_QUEUE_KEY$1])||(t[PENDING_QUEUE_KEY$1]=[]),o=t[PENDING_QUEUE_KEY$1]}catch{return null}}return o}function isNodeProcessReference$2(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const o=Function.prototype.toString.call(e);if(o&&o.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function shouldBypassDeepFreeze$2(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(isNodeProcessReference$2(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;var t="";try{t=e.constructor&&e.constructor.name}catch(r){}if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){var o=e[Symbol.toStringTag];if(typeof o=="string"&&/Stream|Port/i.test(o))return!0}}catch{}return!1}function fallbackFreezeDeep$3(e,t){var o=t;if(!o)if(typeof WeakSet=="function")o=new WeakSet;else{var r=[];o={add:function(a){r.push(a)},has:function(a){return r.indexOf(a)!==-1}}}if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||shouldBypassDeepFreeze$2(e))return e;if(typeof process<"u"&&process&&define_process_env_default$3&&define_process_env_default$3.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(e===PRIMARY_SCOPE$4||typeof globalThis<"u"&&e===globalThis||typeof window<"u"&&e===window||typeof self<"u"&&e===self||typeof global<"u"&&e===global)return e;try{if(typeof o.has=="function"&&o.has(e))return e}catch{}try{typeof o.add=="function"&&o.add(e)}catch{}try{Object.freeze(e)}catch{}return e}var freezeDeep$8=(function(){return ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.freezeDeep=="function"?function(o,r){try{return ENV_BRIDGE$1.freezeDeep(o,r)}catch{return fallbackFreezeDeep$3(o,r)}}:MODULE_ENV$1&&typeof MODULE_ENV$1.freezeDeep=="function"?MODULE_ENV$1.freezeDeep:MODULE_BASE$9&&typeof MODULE_BASE$9.freezeDeep=="function"?MODULE_BASE$9.freezeDeep:fallbackFreezeDeep$3})();function fallbackSafeWarn$5(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}var safeWarn$b=(function(){return ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.safeWarn=="function"?function(o,r){try{ENV_BRIDGE$1.safeWarn(o,r)}catch{fallbackSafeWarn$5(o,r)}}:MODULE_ENV$1&&typeof MODULE_ENV$1.safeWarn=="function"?MODULE_ENV$1.safeWarn:MODULE_BASE$9&&typeof MODULE_BASE$9.safeWarn=="function"?MODULE_BASE$9.safeWarn:fallbackSafeWarn$5})();function fallbackExposeGlobal$2(e,t,o,r){if(!o||typeof o!="object")return!1;var n={configurable:!r||r.configurable!==!1,enumerable:!!(r&&r.enumerable),value:t,writable:!!(r&&r.writable===!0)};try{return Object.defineProperty(o,e,n),!0}catch{try{return o[e]=t,!0}catch{return!1}}}function exposeGlobalInternal(e,t,o,r){var n=o||GLOBAL_SCOPE$f;if(ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.exposeGlobalScoped=="function")try{var a=ENV_BRIDGE$1.exposeGlobalScoped(e,t,n,r||{});if(typeof a<"u")return a}catch{}if(ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.exposeGlobal=="function")try{return ENV_BRIDGE$1.exposeGlobal(e,t,r||{})}catch{}if(MODULE_ENV$1&&typeof MODULE_ENV$1.exposeGlobal=="function")try{return MODULE_ENV$1.exposeGlobal(e,t,n,r||{})}catch{}if(MODULE_BASE$9&&typeof MODULE_BASE$9.exposeGlobal=="function")try{return MODULE_BASE$9.exposeGlobal(e,t,n,r||{})}catch{}return fallbackExposeGlobal$2(e,t,n,r)}var tryRequire$4=(function(){return ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.tryRequire=="function"?function(o){var r=ENV_BRIDGE$1.tryRequire(o);return typeof r>"u"?tryRequireLocal():r}:MODULE_ENV$1&&typeof MODULE_ENV$1.tryRequire=="function"?MODULE_ENV$1.tryRequire:MODULE_BASE$9&&typeof MODULE_BASE$9.tryRequire=="function"?MODULE_BASE$9.tryRequire:tryRequireLocal})();function resolveModuleRegistry$4(e){var t=e||GLOBAL_SCOPE$f;if(ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.getModuleRegistry=="function")try{var o=ENV_BRIDGE$1.getModuleRegistry(t);if(o)return o}catch{}if(MODULE_ENV$1&&typeof MODULE_ENV$1.getModuleRegistry=="function")try{var r=MODULE_ENV$1.getModuleRegistry(t);if(r)return r}catch{}if(MODULE_BASE$9&&typeof MODULE_BASE$9.getModuleRegistry=="function")try{var n=MODULE_BASE$9.getModuleRegistry(t);if(n)return n}catch{}if(registry$2&&typeof registry$2=="object")return registry$2;for(var a=collectCandidateScopes$6(t),s=0;s<a.length;s+=1){var l=a[s];if(l&&typeof l.cineModules=="object")return l.cineModules}return null}var cachedRegistry=null,hasCachedRegistry=!1;function getModuleRegistry$1(e){return e&&e!==GLOBAL_SCOPE$f?resolveModuleRegistry$4(e):(hasCachedRegistry||(cachedRegistry=resolveModuleRegistry$4(GLOBAL_SCOPE$f),hasCachedRegistry=!0),cachedRegistry)}function shallowCopyOptions(e){if(!e||typeof e!="object")return{};var t={},o=[];try{o=Object.keys(e)}catch{o=[]}for(var r=0;r<o.length;r+=1){var n=o[r];try{t[n]=e[n]}catch{}}return t}function queueModuleRegistration$4(e,t,o,r){if(ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.queueModuleRegistration=="function")try{var n=ENV_BRIDGE$1.queueModuleRegistration(e,t,o);if(typeof n<"u")return n}catch{}if(MODULE_ENV$1&&typeof MODULE_ENV$1.queueModuleRegistration=="function")try{return MODULE_ENV$1.queueModuleRegistration(e,t,o,r||GLOBAL_SCOPE$f)}catch{}if(MODULE_BASE$9&&typeof MODULE_BASE$9.queueModuleRegistration=="function")try{return MODULE_BASE$9.queueModuleRegistration(e,t,o,r||GLOBAL_SCOPE$f)}catch{}var a=ensureQueue$2(r||GLOBAL_SCOPE$f);if(!a)return!1;var s=Object.freeze({name:e,api:t,options:Object.freeze(shallowCopyOptions(o))});try{a.push(s)}catch{a[a.length]=s}return!0}function registerOrQueueModule$8(e,t,o,r,n,a){var s=n||GLOBAL_SCOPE$f,l=a||getModuleRegistry$1(s);if(MODULE_BASE$9&&typeof MODULE_BASE$9.registerOrQueueModule=="function")try{var u=MODULE_BASE$9.registerOrQueueModule(e,t,o,r,s,l);if(u)return recordModule(e,t),!0}catch{}if(ENV_BRIDGE$1&&typeof ENV_BRIDGE$1.registerOrQueueModule=="function")try{var d=ENV_BRIDGE$1.registerOrQueueModule(e,t,o,r,s,l);if(d)return recordModule(e,t),!0}catch{}if(MODULE_ENV$1&&typeof MODULE_ENV$1.registerOrQueueModule=="function")try{var m=MODULE_ENV$1.registerOrQueueModule(e,t,o,r,s,l);if(m)return recordModule(e,t),!0}catch{}if(l&&typeof l.register=="function")try{return l.register(e,t,o||{}),recordModule(e,t),!0}catch(h){if(typeof r=="function")try{r(h)}catch{}}var y=queueModuleRegistration$4(e,t,o,s);return y&&recordModule(e,t),y}var localModuleMap=Object.create(null),waitersMap=Object.create(null);function notifyWaiters(e,t){if(waitersMap[e]){var o=waitersMap[e].slice();waitersMap[e].length=0;for(var r=0;r<o.length;r+=1){var n=o[r];try{n(t)}catch{}}}}function recordModule(e,t){return typeof e!="string"||!e||!t?!1:(localModuleMap[e]=t,notifyWaiters(e,t),!0)}function getModule(e,t){if(typeof e!="string"||!e)return null;if(Object.prototype.hasOwnProperty.call(localModuleMap,e))return localModuleMap[e];var o=t&&t.scope?t.scope:GLOBAL_SCOPE$f;try{if(o&&typeof o=="object"&&typeof o[e]<"u")return o[e]}catch{}var r=getModuleRegistry$1(o);if(r&&typeof r.get=="function")try{var n=r.get(e);if(n)return n}catch{}return null}function whenModuleAvailable(e,t){if(typeof e!="string"||!e||typeof t!="function")return!1;var o=getModule(e);if(o){try{t(o)}catch{}return!0}return waitersMap[e]||(waitersMap[e]=[]),waitersMap[e].push(t),!0}function listRecordedModules(){return Object.freeze(Object.keys(localModuleMap))}function primeKnownModules(){for(var e=[{name:"cineModuleBase",value:MODULE_BASE$9},{name:"cineModuleEnvironment",value:MODULE_ENV$1},{name:"cineEnvironmentBridge",value:ENV_BRIDGE$1},{name:"cineModules",value:getModuleRegistry$1(GLOBAL_SCOPE$f)}],t=0;t<e.length;t+=1){var o=e[t];o.value&&recordModule(o.name,o.value)}}primeKnownModules();var globalApi={scope:GLOBAL_SCOPE$f,moduleBase:MODULE_BASE$9,moduleEnvironment:MODULE_ENV$1,environmentBridge:ENV_BRIDGE$1,getModuleRegistry:getModuleRegistry$1,resolveModuleRegistry:resolveModuleRegistry$4,queueModuleRegistration:queueModuleRegistration$4,registerOrQueueModule:registerOrQueueModule$8,freezeDeep:freezeDeep$8,safeWarn:safeWarn$b,exposeGlobal:function(t,o,r){return exposeGlobalInternal(t,o,GLOBAL_SCOPE$f,r||{})},exposeGlobalScoped:function(t,o,r,n){return exposeGlobalInternal(t,o,r||GLOBAL_SCOPE$f,n||{})},tryRequire:tryRequire$4,collectCandidateScopes:function(t){var o=collectCandidateScopes$6(t||GLOBAL_SCOPE$f);return Object.freeze(o.slice())},getPendingQueueKey:function(){return PENDING_QUEUE_KEY$1},ensureQueue:function(t){return ensureQueue$2(t||GLOBAL_SCOPE$f)},recordModule,getModule,whenModuleAvailable,listRecordedModules},existing$3=null,candidateScopes$1=collectCandidateScopes$6(GLOBAL_SCOPE$f);for(var index=0;index<candidateScopes$1.length;index+=1){var scope$3=candidateScopes$1[index];if(scope$3&&typeof scope$3.cineModuleGlobals=="object"){existing$3=scope$3.cineModuleGlobals;break}}if(existing$3&&existing$3!==globalApi){try{for(var existingKeys=Object.getOwnPropertyNames(existing$3),mergeIndex=0;mergeIndex<existingKeys.length;mergeIndex+=1){var key=existingKeys[mergeIndex];typeof globalApi[key]>"u"&&(globalApi[key]=existing$3[key])}}catch{}if(typeof existing$3.listRecordedModules=="function")try{var names=existing$3.listRecordedModules();if(Array.isArray(names))for(var nameIndex=0;nameIndex<names.length;nameIndex+=1){var moduleName=names[nameIndex];if(!localModuleMap[moduleName]&&typeof existing$3.getModule=="function"){var moduleValue=existing$3.getModule(moduleName);moduleValue&&recordModule(moduleName,moduleValue)}}}catch{}}var frozenApi$1=freezeDeep$8(globalApi);recordModule("cineModuleGlobals",frozenApi$1);var registered=registerOrQueueModule$8("cineModuleGlobals",frozenApi$1,{category:"infrastructure",description:"Shared module globals for cross-script coordination.",replace:!0,connections:["cineModuleBase","cineModuleEnvironment","cineEnvironmentBridge"]},function(e){safeWarn$b("Unable to register cineModuleGlobals module.",e)},GLOBAL_SCOPE$f,getModuleRegistry$1(GLOBAL_SCOPE$f));registered||queueModuleRegistration$4("cineModuleGlobals",frozenApi$1,{category:"infrastructure",description:"Shared module globals for cross-script coordination.",replace:!0,connections:["cineModuleBase","cineModuleEnvironment","cineEnvironmentBridge"]},GLOBAL_SCOPE$f);var exposed$3=exposeGlobalInternal("cineModuleGlobals",frozenApi$1,GLOBAL_SCOPE$f,{configurable:!0,enumerable:!1,writable:!1});exposed$3||safeWarn$b("Unable to expose cineModuleGlobals globally.");var define_process_env_default$2={};const DEFAULT_PENDING_QUEUE_KEY$3="__cinePendingModuleRegistrations__";function fallbackDetectGlobalScope$3(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function fallbackCollectCandidateScopes$4(e,t){const o=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||o.indexOf(n)===-1&&o.push(n)}return r(e||t),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),o}function fallbackTryRequire$4(e){return null}function fallbackDefineHiddenProperty$3(e,t,o){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:o}),!0}catch{}try{return e[t]=o,!0}catch{}return!1}function fallbackEnsureQueue$3(e,t,o){const r=e||o,n=typeof t=="string"&&t?t:DEFAULT_PENDING_QUEUE_KEY$3;if(!r||typeof r!="object")return null;let a=r[n];return Array.isArray(a)?a:!fallbackDefineHiddenProperty$3(r,n,[])||(a=r[n],!Array.isArray(a))?null:a}function isNodeProcessReference$1(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const o=Function.prototype.toString.call(e);if(o&&o.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function shouldBypassDeepFreeze$1(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(isNodeProcessReference$1(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function fallbackResolveSeenTracker$2(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(o){return e.indexOf(o)!==-1},add(o){e.indexOf(o)===-1&&e.push(o)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(o){return t.indexOf(o)!==-1},add(o){t.indexOf(o)===-1&&t.push(o)}}}function fallbackFreezeDeep$2(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||shouldBypassDeepFreeze$1(e))return e;if(typeof process<"u"&&process&&define_process_env_default$2&&define_process_env_default$2.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const o=fallbackResolveSeenTracker$2(t);if(o.has(e))return e;o.add(e);const r=Object.getOwnPropertyNames(e);for(let n=0;n<r.length;n+=1){const a=r[n];let s;try{s=e[a]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||fallbackFreezeDeep$2(s,o)}try{return Object.freeze(e)}catch{return e}}function fallbackSafeWarn$4(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function fallbackResolveFromScopes$1(e,t,o){const r=t||{},n=typeof r.predicate=="function"?r.predicate:null,a=Array.isArray(r.scopes)?r.scopes.slice():fallbackCollectCandidateScopes$4(r.primaryScope||o,o);for(let s=0;s<a.length;s+=1){const l=a[s];if(!l||typeof l!="object"&&typeof l!="function")continue;if(n){try{if(n(l,e))return l}catch{}continue}const u=l[e];if(typeof u<"u")return u}return null}function fallbackQueueModuleRegistration$1(e,t,o,r,n,a){const l=fallbackEnsureQueue$3(e||n,a,n);if(!l)return!1;const u=Object.freeze({name:t,api:o,options:Object.freeze({...r||{}})});try{return l.push(u),!0}catch{}try{return l[l.length]=u,!0}catch{}return!1}function createFallbackKernel(e){const t=e||fallbackDetectGlobalScope$3();return{detectGlobalScope:fallbackDetectGlobalScope$3,getGlobalScope(){return t},collectCandidateScopes(o){return fallbackCollectCandidateScopes$4(o||t,t)},tryRequire:fallbackTryRequire$4,defineHiddenProperty:fallbackDefineHiddenProperty$3,ensureQueue(o,r){return fallbackEnsureQueue$3(o||t,r,t)},freezeDeep:fallbackFreezeDeep$2,safeWarn:fallbackSafeWarn$4,resolveFromScopes(o,r){return fallbackResolveFromScopes$1(o,r,t)},queueModuleRegistration(o,r,n,a){return fallbackQueueModuleRegistration$1(o||t,r,n,a,t,DEFAULT_PENDING_QUEUE_KEY$3)},getPendingQueueKey(){return DEFAULT_PENDING_QUEUE_KEY$3},resolveModuleRegistry(o){const n=fallbackCollectCandidateScopes$4(o||t,t);for(let a=0;a<n.length;a+=1){const s=n[a];if(s&&typeof s.cineModules=="object")return s.cineModules}return null}}}function resolveArchitectureKernel(e){const t=e||fallbackDetectGlobalScope$3();return t&&typeof t.cineModuleArchitectureKernel=="object"?t.cineModuleArchitectureKernel:null}const LOCAL_SCOPE$4=fallbackDetectGlobalScope$3(),RESOLVED_KERNEL=resolveArchitectureKernel(LOCAL_SCOPE$4),ACTIVE_KERNEL=RESOLVED_KERNEL||createFallbackKernel(LOCAL_SCOPE$4);function detectGlobalScope$i(){if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.detectGlobalScope=="function")try{const e=ACTIVE_KERNEL.detectGlobalScope();if(e)return e}catch{}return fallbackDetectGlobalScope$3()}const PRIMARY_SCOPE$3=ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.getGlobalScope=="function"?(function(){try{const t=ACTIVE_KERNEL.getGlobalScope();if(t)return t}catch{}return detectGlobalScope$i()})():detectGlobalScope$i();let pendingQueueKey$1=ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.getPendingQueueKey=="function"?ACTIVE_KERNEL.getPendingQueueKey():DEFAULT_PENDING_QUEUE_KEY$3;function collectCandidateScopes$5(e){if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.collectCandidateScopes=="function")try{const t=ACTIVE_KERNEL.collectCandidateScopes(e||PRIMARY_SCOPE$3);if(Array.isArray(t)&&t.length>0)return t}catch{}return fallbackCollectCandidateScopes$4(e||PRIMARY_SCOPE$3,PRIMARY_SCOPE$3)}function collectScopes(e){const t=collectCandidateScopes$5(e||PRIMARY_SCOPE$3);return Array.isArray(t)?t:[]}function tryRequire$3(e){if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.tryRequire=="function")try{const t=ACTIVE_KERNEL.tryRequire(e);if(typeof t<"u")return t}catch{}return fallbackTryRequire$4()}function defineHiddenProperty$3(e,t,o){if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.defineHiddenProperty=="function")try{if(ACTIVE_KERNEL.defineHiddenProperty(e,t,o))return!0}catch{}return fallbackDefineHiddenProperty$3(e,t,o)}function freezeDeep$7(e){if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.freezeDeep=="function")try{return ACTIVE_KERNEL.freezeDeep(e)}catch{}return fallbackFreezeDeep$2(e)}function safeWarn$a(e,t){if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.safeWarn=="function")try{ACTIVE_KERNEL.safeWarn(e,t);return}catch{}fallbackSafeWarn$4(e,t)}function resolveFromScopes$2(e,t){const o=t?{...t}:{};if(o.primaryScope||(o.primaryScope=PRIMARY_SCOPE$3),o.scopes||(o.scopes=collectScopes(o.primaryScope)),ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.resolveFromScopes=="function")try{const r=ACTIVE_KERNEL.resolveFromScopes(e,o);if(r)return r}catch(r){safeWarn$a(`cineModuleSystem: resolveFromScopes failed for "${e}".`,r)}return fallbackResolveFromScopes$1(e,o,PRIMARY_SCOPE$3)}let cachedModuleBase=null,hasResolvedModuleBase=!1;function updateQueueKeyFromBase(e){e&&typeof e.PENDING_QUEUE_KEY=="string"&&e.PENDING_QUEUE_KEY&&(pendingQueueKey$1=e.PENDING_QUEUE_KEY)}function loadModuleBase(e){const t=e||PRIMARY_SCOPE$3;if(baseApi&&typeof baseApi=="object")return updateQueueKeyFromBase(baseApi),baseApi;const o=resolveFromScopes$2("cineModuleBase",{primaryScope:t,scopes:collectScopes(t)});return o&&typeof o=="object"?(updateQueueKeyFromBase(o),o):null}function getModuleBase(e){return e&&e!==PRIMARY_SCOPE$3?loadModuleBase(e):(hasResolvedModuleBase||(cachedModuleBase=loadModuleBase(PRIMARY_SCOPE$3),hasResolvedModuleBase=!0),cachedModuleBase)}function fallbackResolveModuleRegistry$1(e){const t=e||PRIMARY_SCOPE$3;if(registry$2&&typeof registry$2=="object")return registry$2;const o=resolveFromScopes$2("cineModules",{primaryScope:t,scopes:collectScopes(t)});return o&&typeof o=="object"?o:null}let cachedModuleRegistry=null,hasResolvedModuleRegistry=!1;function resolveModuleRegistry$3(e){const t=e||PRIMARY_SCOPE$3;if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.resolveModuleRegistry=="function")try{const r=ACTIVE_KERNEL.resolveModuleRegistry(t);if(r&&typeof r=="object")return r}catch(r){safeWarn$a("cineModuleSystem: Kernel resolveModuleRegistry failed.",r)}const o=getModuleBase(t);if(o&&typeof o.resolveModuleRegistry=="function")try{const r=o.resolveModuleRegistry(t);if(r&&typeof r=="object")return r}catch(r){safeWarn$a("cineModuleSystem: Base resolveModuleRegistry failed.",r)}return fallbackResolveModuleRegistry$1(t)}function getModuleRegistry(e){return e&&e!==PRIMARY_SCOPE$3?resolveModuleRegistry$3(e):(hasResolvedModuleRegistry||(cachedModuleRegistry=resolveModuleRegistry$3(PRIMARY_SCOPE$3),hasResolvedModuleRegistry=!0),cachedModuleRegistry)}function fallbackExposeGlobal$1(e,t,o,r={}){const n=o||PRIMARY_SCOPE$3;if(!n||typeof n!="object")return!1;const a={configurable:r.configurable!==!1,enumerable:!!r.enumerable,value:t,writable:r.writable===!0};try{return Object.defineProperty(n,e,a),!0}catch{}try{return n[e]=t,!0}catch{}return!1}function exposeGlobal$9(e,t,o,r){const n=o||PRIMARY_SCOPE$3,a=getModuleBase(n);if(a&&typeof a.exposeGlobal=="function")try{return a.exposeGlobal(e,t,n,r||{})}catch(s){safeWarn$a(`cineModuleSystem: Failed to expose "${e}" through module base.`,s)}return fallbackExposeGlobal$1(e,t,n,r||{})}function ensureRegistrationQueue(e){const t=e||PRIMARY_SCOPE$3;if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.ensureQueue=="function")try{const o=ACTIVE_KERNEL.ensureQueue(t,pendingQueueKey$1);if(Array.isArray(o))return o}catch(o){safeWarn$a("cineModuleSystem: ensureQueue failed via kernel.",o)}return fallbackEnsureQueue$3(t,pendingQueueKey$1,PRIMARY_SCOPE$3)}function normalizeName$1(e){if(typeof e=="string"&&e.trim())return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);throw new TypeError("cineModuleSystem expected module name to be a non-empty string.")}function queueModuleRegistration$3(e,t,o,r){const n=r||PRIMARY_SCOPE$3;if(ACTIVE_KERNEL&&typeof ACTIVE_KERNEL.queueModuleRegistration=="function")try{if(ACTIVE_KERNEL.queueModuleRegistration(n,e,t,o))return!0}catch(u){safeWarn$a("cineModuleSystem: queueModuleRegistration failed via kernel.",u)}const a=ensureRegistrationQueue(n);if(!a)return safeWarn$a("cineModuleSystem: Unable to queue module registration.",{name:e}),!1;let s;try{s=normalizeName$1(e)}catch(u){return safeWarn$a("cineModuleSystem: Ignoring registration with invalid name.",u),!1}const l=Object.freeze({name:s,api:t,options:Object.freeze({...o||{}})});try{a.push(l)}catch{try{a[a.length]=l}catch(d){return safeWarn$a("cineModuleSystem: Failed to record pending module registration.",d),!1}}return!0}function registerModule(e,t,o,r,n){const a=r||PRIMARY_SCOPE$3,s=getModuleRegistry(a);if(s&&typeof s.register=="function")try{return s.register(e,t,o||{}),!0}catch(l){if(typeof n=="function")try{n(l)}catch(u){safeWarn$a("cineModuleSystem: Error handler threw while processing registration failure.",u)}else safeWarn$a(`cineModuleSystem: Unable to register module "${e}".`,l)}return queueModuleRegistration$3(e,t,o,a),!1}function getGlobalScope$3(e){const t=e||PRIMARY_SCOPE$3,o=getModuleBase(t);if(o&&typeof o.getGlobalScope=="function")try{const r=o.getGlobalScope();if(r)return r}catch(r){safeWarn$a("cineModuleSystem: Unable to obtain global scope from module base.",r)}return t}function resolveModule(e,t={}){const o=normalizeName$1(e),r=t.scope||PRIMARY_SCOPE$3,n=getModuleRegistry(r);if(n&&typeof n.get=="function")try{const u=n.get(o);if(u)return u}catch(u){safeWarn$a("cineModuleSystem: Registry lookup failed.",u)}const a=t.propertyName||o,s=Array.isArray(t.scopes)&&t.scopes.length>0?t.scopes:collectScopes(r),l=resolveFromScopes$2(a,{primaryScope:r,scopes:s,predicate:t.predicate});if(l)return l;if(typeof t.fallback=="function")try{return t.fallback()}catch(u){safeWarn$a("cineModuleSystem: Fallback resolver threw while resolving module.",u)}return null}function registerAndExpose(e,t,o,r,n){const a=r||PRIMARY_SCOPE$3;return registerModule(e,t,o,a)?exposeGlobal$9(e,t,a,n||{}):!1}function getPendingQueue(e){return ensureRegistrationQueue(e||PRIMARY_SCOPE$3)}const systemApi={getArchitecture(){return ACTIVE_KERNEL&&ACTIVE_KERNEL.architecture||null},detectGlobalScope:detectGlobalScope$i,getGlobalScope:getGlobalScope$3,collectCandidateScopes:collectScopes,tryRequire:tryRequire$3,resolveFromScopes:resolveFromScopes$2,getModuleBase,getModuleRegistry,queueModuleRegistration:queueModuleRegistration$3,registerModule,registerAndExpose,resolveModule,exposeGlobal:exposeGlobal$9,defineHiddenProperty:defineHiddenProperty$3,freezeDeep:freezeDeep$7,safeWarn:safeWarn$a,getPendingQueue,getPendingQueueKey(){return pendingQueueKey$1}};Object.defineProperty(systemApi,"PENDING_QUEUE_KEY",{configurable:!1,enumerable:!0,get(){return pendingQueueKey$1}});const frozenApi=Object.freeze(systemApi);PRIMARY_SCOPE$3&&typeof PRIMARY_SCOPE$3=="object"&&!PRIMARY_SCOPE$3.cineModuleSystem&&defineHiddenProperty$3(PRIMARY_SCOPE$3,"cineModuleSystem",frozenApi);const cineModuleSystem=frozenApi,DEFAULT_PENDING_QUEUE_KEY$2="__cinePendingModuleRegistrations__";function fallbackDetectGlobalScope$2(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function fallbackCollectCandidateScopes$3(e){const t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}return o(e),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),t}function fallbackTryRequire$3(e){return null}function fallbackDefineHiddenProperty$2(e,t,o){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:o}),!0}catch{}try{return e[t]=o,!0}catch{}return!1}function fallbackResolveSeenTracker$1(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(o){return e.indexOf(o)!==-1},add(o){e.indexOf(o)===-1&&e.push(o)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(o){return t.indexOf(o)!==-1},add(o){t.indexOf(o)===-1&&t.push(o)}}}function fallbackFreezeDeep$1(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return e;const o=fallbackResolveSeenTracker$1(t);if(o.has(e))return e;o.add(e);let r=[];try{r=Object.getOwnPropertyNames(e)}catch{}for(let n=0;n<r.length;n+=1){const a=r[n];let s;try{s=e[a]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||fallbackFreezeDeep$1(s,o)}try{try{return Object.freeze(e)}catch(n){return e}}catch{return e}}function fallbackSafeWarn$3(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function fallbackResolveFromScopes(e,t){const o=t||{},r=typeof o.predicate=="function"?o.predicate:null,n=Array.isArray(o.scopes)?o.scopes.slice():fallbackCollectCandidateScopes$3(o.primaryScope);for(let a=0;a<n.length;a+=1){const s=n[a];if(!s||typeof s!="object"&&typeof s!="function")continue;if(r){try{if(r(s,e))return s}catch{}continue}const l=s[e];if(typeof l<"u")return l}return null}function fallbackEnsureQueue$2(e,t){if(!e||typeof e!="object")return null;let o=null;try{o=e[t]}catch{o=null}if(Array.isArray(o))return o;try{if(Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=e[t],Array.isArray(o))return o}catch{}try{e[t]=[],o=e[t]}catch{return null}return Array.isArray(o)?o:null}const LOCAL_SCOPE$3=fallbackDetectGlobalScope$2();function resolveArchitecture(e){const t=e||LOCAL_SCOPE$3;return t&&typeof t.cineModuleArchitecture=="object"?t.cineModuleArchitecture:null}function resolveArchitectureHelpers(e){const t=e||LOCAL_SCOPE$3;return t&&typeof t.cineModuleArchitectureHelpers=="object"?t.cineModuleArchitectureHelpers:null}function resolveModuleSystem(e){const t=e||LOCAL_SCOPE$3;return cineModuleSystem&&typeof cineModuleSystem=="object"?cineModuleSystem:t&&typeof t.cineModuleSystem=="object"?t.cineModuleSystem:null}const ARCHITECTURE_HELPERS=resolveArchitectureHelpers(LOCAL_SCOPE$3);let pendingQueueKey=ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.pendingQueueKey=="string"?ARCHITECTURE_HELPERS.pendingQueueKey:DEFAULT_PENDING_QUEUE_KEY$2;function updatePendingQueueKey(e){if(!(!e||typeof e!="object"&&typeof e!="function")){try{if(typeof e.getPendingQueueKey=="function"){const t=e.getPendingQueueKey();if(typeof t=="string"&&t){pendingQueueKey=t;return}}}catch{}typeof e.PENDING_QUEUE_KEY=="string"&&e.PENDING_QUEUE_KEY&&(pendingQueueKey=e.PENDING_QUEUE_KEY)}}const MODULE_SYSTEM=resolveModuleSystem(LOCAL_SCOPE$3);MODULE_SYSTEM&&updatePendingQueueKey(MODULE_SYSTEM);const ARCHITECTURE$1=(MODULE_SYSTEM&&typeof MODULE_SYSTEM.getArchitecture=="function"?MODULE_SYSTEM.getArchitecture():null)||resolveArchitecture(LOCAL_SCOPE$3);function detectWithFallbackChain(){if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.detectGlobalScope=="function"){try{const e=MODULE_SYSTEM.detectGlobalScope();if(e)return e}catch{}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.detectGlobalScope=="function")try{const e=ARCHITECTURE$1.detectGlobalScope();if(e)return e}catch{}return fallbackDetectGlobalScope$2()}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.detectGlobalScope=="function")try{const e=ARCHITECTURE$1.detectGlobalScope();if(e)return e}catch{}return fallbackDetectGlobalScope$2()}const detectGlobalScope$h=ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.detectGlobalScope=="function"?function(){try{const t=ARCHITECTURE_HELPERS.detectGlobalScope();if(t)return t}catch{}return detectWithFallbackChain()}:detectWithFallbackChain,PRIMARY_SCOPE$2=detectGlobalScope$h();function collectWithFallbackChain(e){const t=e||PRIMARY_SCOPE$2;if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.collectCandidateScopes=="function"){try{const o=MODULE_SYSTEM.collectCandidateScopes(t);if(Array.isArray(o)&&o.length>0)return o}catch{}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.collectCandidateScopes=="function")try{const o=ARCHITECTURE$1.collectCandidateScopes(t);if(Array.isArray(o)&&o.length>0)return o}catch{}return fallbackCollectCandidateScopes$3(t)}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.collectCandidateScopes=="function")try{const o=ARCHITECTURE$1.collectCandidateScopes(t);if(Array.isArray(o)&&o.length>0)return o}catch{}return fallbackCollectCandidateScopes$3(t)}const collectCandidateScopes$4=ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.collectCandidateScopes=="function"?function(t){const o=t||PRIMARY_SCOPE$2;try{const r=ARCHITECTURE_HELPERS.collectCandidateScopes(o);if(Array.isArray(r)&&r.length>0)return r}catch{}return collectWithFallbackChain(o)}:collectWithFallbackChain;function tryRequireWithFallback(e){if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.tryRequire=="function")try{const t=MODULE_SYSTEM.tryRequire(e);if(typeof t<"u")return t}catch{}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.tryRequire=="function")try{const t=ARCHITECTURE$1.tryRequire(e);if(typeof t<"u")return t}catch{}return fallbackTryRequire$3()}const tryRequire$2=ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.tryRequire=="function"?function(t){const o=ARCHITECTURE_HELPERS.tryRequire(t);return typeof o>"u"?tryRequireWithFallback(t):o}:tryRequireWithFallback;function defineHiddenPropertyWithFallback(e,t,o){if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.defineHiddenProperty=="function")try{if(MODULE_SYSTEM.defineHiddenProperty(e,t,o))return!0}catch{}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.defineHiddenProperty=="function")try{if(ARCHITECTURE$1.defineHiddenProperty(e,t,o))return!0}catch{}return fallbackDefineHiddenProperty$2(e,t,o)}const defineHiddenProperty$2=ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.defineHiddenProperty=="function"?function(t,o,r){try{if(ARCHITECTURE_HELPERS.defineHiddenProperty(t,o,r))return!0}catch{}return defineHiddenPropertyWithFallback(t,o,r)}:defineHiddenPropertyWithFallback;function freezeDeepWithFallback(e){if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.freezeDeep=="function")try{return MODULE_SYSTEM.freezeDeep(e)}catch{}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.freezeDeep=="function")try{return ARCHITECTURE$1.freezeDeep(e)}catch{}return fallbackFreezeDeep$1(e)}const freezeDeep$6=ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.freezeDeep=="function"?function(t){try{return ARCHITECTURE_HELPERS.freezeDeep(t)}catch{}return freezeDeepWithFallback(t)}:freezeDeepWithFallback;function safeWarnWithFallback(e,t){if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.safeWarn=="function")try{MODULE_SYSTEM.safeWarn(e,t);return}catch{}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.safeWarn=="function")try{ARCHITECTURE$1.safeWarn(e,t);return}catch{}fallbackSafeWarn$3(e,t)}const safeWarn$9=ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.safeWarn=="function"?function(t,o){try{ARCHITECTURE_HELPERS.safeWarn(t,o);return}catch{}safeWarnWithFallback(t,o)}:safeWarnWithFallback,resolveFromScopes$1=MODULE_SYSTEM&&typeof MODULE_SYSTEM.resolveFromScopes=="function"?function(t,o){const r={...o||{}};return r.primaryScope||(r.primaryScope=PRIMARY_SCOPE$2),r.scopes||(r.scopes=collectCandidateScopes$4(r.primaryScope)),MODULE_SYSTEM.resolveFromScopes(t,r)}:ARCHITECTURE$1&&typeof ARCHITECTURE$1.resolveFromScopes=="function"?function(t,o){const r={...o||{}};return r.primaryScope||(r.primaryScope=PRIMARY_SCOPE$2),r.scopes||(r.scopes=collectCandidateScopes$4(r.primaryScope)),ARCHITECTURE$1.resolveFromScopes(t,r)}:function(t,o){const r={...o||{}};return r.primaryScope||(r.primaryScope=PRIMARY_SCOPE$2),r.scopes||(r.scopes=fallbackCollectCandidateScopes$3(r.primaryScope)),fallbackResolveFromScopes(t,r)};function resolveModuleBase$9(e){const t=e||PRIMARY_SCOPE$2;if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.getModuleBase=="function")try{const r=MODULE_SYSTEM.getModuleBase(t);if(r&&typeof r=="object")return updatePendingQueueKey(r),r}catch(r){safeWarn$9("cineModuleContext: Unable to resolve module base through module system.",r)}if(baseApi&&typeof baseApi=="object")return updatePendingQueueKey(baseApi),baseApi;const o=resolveFromScopes$1("cineModuleBase",{primaryScope:t,scopes:collectCandidateScopes$4(t)});return o&&typeof o=="object"?(updatePendingQueueKey(o),o):null}function ensureQueue$1(e){const t=e||PRIMARY_SCOPE$2;if(ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.ensureQueue=="function")try{const o=ARCHITECTURE_HELPERS.ensureQueue(t,pendingQueueKey);if(Array.isArray(o))return o}catch(o){safeWarn$9("cineModuleContext: Unable to access pending queue via architecture helpers.",o)}if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.getPendingQueue=="function")try{const o=MODULE_SYSTEM.getPendingQueue(t);if(Array.isArray(o))return o}catch(o){safeWarn$9("cineModuleContext: Unable to access pending queue via module system.",o)}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.ensureQueue=="function")try{const o=ARCHITECTURE$1.ensureQueue(t,pendingQueueKey);if(Array.isArray(o))return o}catch(o){safeWarn$9("cineModuleContext: Unable to access pending queue via architecture.",o)}return fallbackEnsureQueue$2(t,pendingQueueKey)}function queueModuleRegistration$2(e,t,o,r){const n=r||PRIMARY_SCOPE$2;if(ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.queueModuleRegistration=="function")try{if(ARCHITECTURE_HELPERS.queueModuleRegistration(n,e,t,o))return!0}catch(l){safeWarn$9("cineModuleContext: Architecture helpers queueModuleRegistration failed.",l)}const a=ensureQueue$1(n);if(!a)return!1;const s=Object.freeze({name:e,api:t,options:Object.freeze({...o||{}})});try{a.push(s)}catch{a[a.length]=s}return!0}function resolveModuleRegistry$2(e){const t=e||PRIMARY_SCOPE$2;if(ARCHITECTURE_HELPERS&&typeof ARCHITECTURE_HELPERS.resolveModuleRegistry=="function")try{const n=ARCHITECTURE_HELPERS.resolveModuleRegistry(t);if(n&&typeof n=="object")return n}catch(n){safeWarn$9("cineModuleContext: Architecture helpers resolveModuleRegistry failed.",n)}if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.getModuleRegistry=="function")try{const n=MODULE_SYSTEM.getModuleRegistry(t);if(n&&typeof n=="object")return n}catch(n){safeWarn$9("cineModuleContext: Unable to resolve module registry via module system.",n)}const o=resolveModuleBase$9(t);if(o&&typeof o=="object"){if(typeof o.getModuleRegistry=="function")try{const n=o.getModuleRegistry(t);if(n&&typeof n=="object")return n}catch(n){safeWarn$9("cineModuleContext: Module base getModuleRegistry failed.",n)}if(typeof o.resolveModuleRegistry=="function")try{const n=o.resolveModuleRegistry(t);if(n&&typeof n=="object")return n}catch(n){safeWarn$9("cineModuleContext: Module base resolveModuleRegistry failed.",n)}}if(registry$2&&typeof registry$2=="object")return registry$2;const r=resolveFromScopes$1("cineModules",{primaryScope:t,scopes:collectCandidateScopes$4(t)});return r&&typeof r=="object"?r:null}function registerOrQueue(e,t,o,r){const n=r||PRIMARY_SCOPE$2;if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.registerModule=="function")try{if(MODULE_SYSTEM.registerModule(e,t,o||{},n))return!0}catch(l){safeWarn$9("cineModuleContext: Module system failed to register module.",l)}const a=resolveModuleRegistry$2(n),s=resolveModuleBase$9(n);if(s&&typeof s.registerOrQueueModule=="function")try{if(s.registerOrQueueModule(e,t,o||{},u=>{safeWarn$9("cineModuleContext: Module base failed to register module.",u)},n,a))return!0}catch(l){safeWarn$9("cineModuleContext: Module base threw while registering module.",l)}if(a&&typeof a.register=="function")try{return a.register(e,t,o||{}),!0}catch(l){safeWarn$9("cineModuleContext: Registry registration failed.",l)}return queueModuleRegistration$2(e,t,o,n)}function exposeGlobal$8(e,t,o,r={}){const n=o||PRIMARY_SCOPE$2;if(!n||typeof n!="object")return!1;if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.exposeGlobal=="function")try{return MODULE_SYSTEM.exposeGlobal(e,t,n,r||{})}catch(s){safeWarn$9("cineModuleContext: Module system failed to expose global.",s)}const a={configurable:r.configurable!==!1,enumerable:!!r.enumerable,value:t,writable:r.writable===!0};try{return Object.defineProperty(n,e,a),!0}catch{}try{return n[e]=t,!0}catch{}return!1}function createModuleContext(e={}){const t=e.scope||PRIMARY_SCOPE$2,o=resolveModuleBase$9(t),r=resolveModuleRegistry$2(t);return Object.freeze({getArchitecture(){return ARCHITECTURE$1||null},getSystem(){return MODULE_SYSTEM||null},getScope(){return t},detectGlobalScope(a){const s=a||t;try{if(MODULE_SYSTEM&&typeof MODULE_SYSTEM.detectGlobalScope=="function"){const l=MODULE_SYSTEM.detectGlobalScope(s);if(l)return l}}catch(l){safeWarn$9("cineModuleContext: detectGlobalScope via system failed.",l)}if(ARCHITECTURE$1&&typeof ARCHITECTURE$1.detectGlobalScope=="function")try{const l=ARCHITECTURE$1.detectGlobalScope(s);if(l)return l}catch(l){safeWarn$9("cineModuleContext: detectGlobalScope via architecture failed.",l)}return fallbackDetectGlobalScope$2()},collectCandidateScopes(a){return collectCandidateScopes$4(a||t)},tryRequire(a){return tryRequire$2(a)},resolveFromScopes(a,s){const l={...s||{}};return l.primaryScope||(l.primaryScope=t),l.scopes||(l.scopes=collectCandidateScopes$4(l.primaryScope)),resolveFromScopes$1(a,l)},defineHiddenProperty(a,s,l){return defineHiddenProperty$2(a,s,l)},freezeDeep(a){return freezeDeep$6(a)},safeWarn(a,s){safeWarn$9(a,s)},ensureQueue(a){return ensureQueue$1(a||t)},getModuleBase(){return o},getModuleRegistry(){return r},queueModuleRegistration(a,s,l,u){return queueModuleRegistration$2(a,s,l,u||t)},registerModule(a,s,l,u){return registerOrQueue(a,s,l,u||t)},exposeGlobal(a,s,l,u){return exposeGlobal$8(a,s,l||t,u||{})}})}const contextApi=freezeDeep$6({getArchitecture(){return ARCHITECTURE$1},getModuleSystem(){return MODULE_SYSTEM},detectGlobalScope:detectGlobalScope$h,collectCandidateScopes:collectCandidateScopes$4,tryRequire:tryRequire$2,resolveFromScopes:resolveFromScopes$1,defineHiddenProperty:defineHiddenProperty$2,freezeDeep:freezeDeep$6,safeWarn:safeWarn$9,ensureQueue:ensureQueue$1,resolveModuleBase:resolveModuleBase$9,resolveModuleRegistry:resolveModuleRegistry$2,queueModuleRegistration:queueModuleRegistration$2,registerOrQueue,exposeGlobal:exposeGlobal$8,createModuleContext,getPrimaryScope(){return PRIMARY_SCOPE$2}});registerOrQueue("cineModuleContext",contextApi,{category:"infrastructure",description:"Shared context helpers that unify architecture, system and registry lookups.",freeze:!1,connections:["cineModuleBase","cineModuleGlobals","cineModuleEnvironment","cineModuleArchitectureKernel"]},PRIMARY_SCOPE$2);exposeGlobal$8("cineModuleContext",contextApi,PRIMARY_SCOPE$2,{configurable:!0,enumerable:!1,writable:!1});const DEFAULT_PENDING_QUEUE_KEY$1="__cinePendingModuleRegistrations__";function fallbackDetectGlobalScope$1(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const LOCAL_SCOPE$2=fallbackDetectGlobalScope$1();function resolveArchitectureCore$1(e){const t=[],o=e||LOCAL_SCOPE$2;o&&typeof o=="object"&&t.push(o),typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleArchitectureCore=="object")return n.cineModuleArchitectureCore}return null}function tryRequireArchitecture(e){const t=e||LOCAL_SCOPE$2;return t&&typeof t.cineModuleArchitecture=="object"?t.cineModuleArchitecture:null}const ARCHITECTURE=tryRequireArchitecture(LOCAL_SCOPE$2),ARCHITECTURE_CORE$1=resolveArchitectureCore$1(LOCAL_SCOPE$2),CORE_INSTANCE=ARCHITECTURE_CORE$1&&typeof ARCHITECTURE_CORE$1.createCore=="function"?ARCHITECTURE_CORE$1.createCore({primaryScope:LOCAL_SCOPE$2,pendingQueueKey:DEFAULT_PENDING_QUEUE_KEY$1}):null;function fallbackCollectCandidateScopes$2(e){const t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}return o(e),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),t}function detectWithArchitecture(){if(CORE_INSTANCE&&typeof CORE_INSTANCE.detectGlobalScope=="function")try{const e=CORE_INSTANCE.detectGlobalScope();if(e)return e}catch{}if(ARCHITECTURE&&typeof ARCHITECTURE.detectGlobalScope=="function")try{const e=ARCHITECTURE.detectGlobalScope();if(e)return e}catch{}return fallbackDetectGlobalScope$1()}const detectGlobalScope$g=ARCHITECTURE&&typeof ARCHITECTURE.detectGlobalScope=="function"?function(){try{const t=ARCHITECTURE.detectGlobalScope();if(t)return t}catch{}return detectWithArchitecture()}:detectWithArchitecture,PRIMARY_SCOPE$1=detectGlobalScope$g();function collectWithArchitecture(e){const t=e||PRIMARY_SCOPE$1;if(CORE_INSTANCE&&typeof CORE_INSTANCE.collectCandidateScopes=="function")try{const o=CORE_INSTANCE.collectCandidateScopes(t);if(Array.isArray(o)&&o.length>0)return o}catch{}if(ARCHITECTURE&&typeof ARCHITECTURE.collectCandidateScopes=="function")try{const o=ARCHITECTURE.collectCandidateScopes(t);if(Array.isArray(o)&&o.length>0)return o}catch{}return fallbackCollectCandidateScopes$2(t)}const collectCandidateScopes$3=function(t){const o=t||PRIMARY_SCOPE$1,r=collectWithArchitecture(o);return Array.isArray(r)&&r.length>0?r:fallbackCollectCandidateScopes$2(o)};function fallbackTryRequire$2(e){return null}function tryRequireWithArchitecture(e){if(CORE_INSTANCE&&typeof CORE_INSTANCE.tryRequire=="function")try{const t=CORE_INSTANCE.tryRequire(e);if(typeof t<"u")return t}catch{}if(ARCHITECTURE&&typeof ARCHITECTURE.tryRequire=="function")try{const t=ARCHITECTURE.tryRequire(e);if(typeof t<"u")return t}catch{}return fallbackTryRequire$2()}function resolveImmutability(e){const t=e||PRIMARY_SCOPE$1;if(CORE_INSTANCE&&typeof CORE_INSTANCE.resolveImmutability=="function")try{const n=CORE_INSTANCE.resolveImmutability(t);if(n&&typeof n=="object")return n}catch{}if(ARCHITECTURE&&typeof ARCHITECTURE.tryRequire=="function")try{const n=ARCHITECTURE.tryRequire("./immutability.js");if(n&&typeof n=="object")return n}catch{}const o=tryRequireWithArchitecture("./immutability.js");if(o&&typeof o=="object")return o;const r=collectCandidateScopes$3(t);for(let n=0;n<r.length;n+=1){const a=r[n];if(a&&typeof a.cineModuleImmutability=="object")return a.cineModuleImmutability}return null}function fallbackDefineHiddenProperty$1(e,t,o){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:o}),!0}catch{}try{return e[t]=o,!0}catch{}return!1}function defineHiddenProperty$1(e,t,o){if(CORE_INSTANCE&&typeof CORE_INSTANCE.defineHiddenProperty=="function")try{if(CORE_INSTANCE.defineHiddenProperty(e,t,o))return!0}catch{}if(ARCHITECTURE&&typeof ARCHITECTURE.defineHiddenProperty=="function")try{if(ARCHITECTURE.defineHiddenProperty(e,t,o))return!0}catch{}return fallbackDefineHiddenProperty$1(e,t,o)}function fallbackEnsureQueue$1(e,t){if(!e||typeof e!="object")return null;let o=null;try{o=e[t]}catch{o=null}if(Array.isArray(o)||defineHiddenProperty$1(e,t,[])&&(o=e[t],Array.isArray(o)))return o;try{e[t]=[],o=e[t]}catch{return null}return Array.isArray(o)?o:null}function ensureQueue(e,t){const o=typeof t=="string"&&t?t:DEFAULT_PENDING_QUEUE_KEY$1,r=e||PRIMARY_SCOPE$1;if(CORE_INSTANCE&&typeof CORE_INSTANCE.ensureQueue=="function")try{const n=CORE_INSTANCE.ensureQueue(r,o);if(Array.isArray(n))return n}catch{}if(ARCHITECTURE&&typeof ARCHITECTURE.ensureQueue=="function")try{const n=ARCHITECTURE.ensureQueue(r,o);if(Array.isArray(n))return n}catch{}return fallbackEnsureQueue$1(r,o)}function createFallbackImmutability(){function e(o){if(!o||typeof o=="function"||typeof o!="object"&&typeof o!="function")return!1;try{if(typeof o.pipe=="function"&&typeof o.unpipe=="function")return!0;if(typeof o.on=="function"&&typeof o.emit=="function"){if(typeof o.write=="function"||typeof o.read=="function")return!0;const r=o.constructor&&o.constructor.name;if(r&&/Stream|Emitter|Port/i.test(r))return!0}if(typeof Symbol<"u"&&o[Symbol.toStringTag]){const r=o[Symbol.toStringTag];if(typeof r=="string"&&/Stream|Port/i.test(r))return!0}}catch{}return!1}function t(o,r=new WeakSet){if(!o||typeof o=="function"||typeof o!="object"&&typeof o!="function"||e(o)||r.has(o))return o;r.add(o);const n=Object.getOwnPropertyNames(o);for(let a=0;a<n.length;a+=1){const s=n[a];let l;try{l=o[s]}catch{l=void 0}!l||typeof l=="function"||typeof l!="object"&&typeof l!="function"||t(l,r)}try{return Object.freeze(o)}catch(a){return console.warn("fallbackCreateImmutability (helpers): Object.freeze failed",a),o}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const FALLBACK_IMMUTABILITY$1=createFallbackImmutability();let activeImmutability=resolveImmutability(PRIMARY_SCOPE$1)||FALLBACK_IMMUTABILITY$1;function getImmutability(){if(activeImmutability!==FALLBACK_IMMUTABILITY$1)return activeImmutability;const e=resolveImmutability(PRIMARY_SCOPE$1);return e&&e!==activeImmutability&&(activeImmutability=e),activeImmutability}function freezeDeep$5(e){if(CORE_INSTANCE&&typeof CORE_INSTANCE.freezeDeep=="function")try{return CORE_INSTANCE.freezeDeep(e)}catch{}const t=getImmutability();try{return t.freezeDeep(e)}catch{}return FALLBACK_IMMUTABILITY$1.freezeDeep(e)}function fallbackSafeWarn$2(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function safeWarn$8(e,t){if(CORE_INSTANCE&&typeof CORE_INSTANCE.safeWarn=="function")try{CORE_INSTANCE.safeWarn(e,t);return}catch{}if(ARCHITECTURE&&typeof ARCHITECTURE.safeWarn=="function")try{ARCHITECTURE.safeWarn(e,t);return}catch{}fallbackSafeWarn$2(e,t)}function resolveModuleRegistry$1(e){const t=e||PRIMARY_SCOPE$1,o=tryRequireWithArchitecture("./registry.js");if(o&&typeof o=="object")return o;const r=collectCandidateScopes$3(t);for(let n=0;n<r.length;n+=1){const a=r[n];if(a&&typeof a.cineModules=="object")return a.cineModules}return null}function queueModuleRegistration$1(e,t,o,r){const a=ensureQueue(e||PRIMARY_SCOPE$1,DEFAULT_PENDING_QUEUE_KEY$1);if(!a)return!1;const s=freezeDeep$5({name:t,api:o,options:Object.freeze({...r||{}})});try{a.push(s)}catch{a[a.length]=s}return!0}const helpers$1=freezeDeep$5({architecture:ARCHITECTURE,architectureCore:ARCHITECTURE_CORE$1,detectGlobalScope:detectGlobalScope$g,getPrimaryScope(){return PRIMARY_SCOPE$1},collectCandidateScopes:collectCandidateScopes$3,tryRequire:tryRequireWithArchitecture,defineHiddenProperty:defineHiddenProperty$1,ensureQueue,freezeDeep:freezeDeep$5,safeWarn:safeWarn$8,resolveModuleRegistry:resolveModuleRegistry$1,queueModuleRegistration:queueModuleRegistration$1,pendingQueueKey:DEFAULT_PENDING_QUEUE_KEY$1,fallbackDetectGlobalScope:fallbackDetectGlobalScope$1}),registry=resolveModuleRegistry$1(PRIMARY_SCOPE$1),registrationOptions={category:"infrastructure",description:"Shared architecture helpers for scope detection, registry resolution and queue management.",replace:!0,connections:["cineModuleArchitectureKernel","cineModuleArchitectureCore"]};if(registry&&typeof registry.register=="function")try{registry.register("cineModuleArchitectureHelpers",helpers$1,registrationOptions)}catch(e){safeWarn$8("cineModuleArchitectureHelpers: immediate registry registration failed.",e),queueModuleRegistration$1(PRIMARY_SCOPE$1,"cineModuleArchitectureHelpers",helpers$1,registrationOptions)}else queueModuleRegistration$1(PRIMARY_SCOPE$1,"cineModuleArchitectureHelpers",helpers$1,registrationOptions);PRIMARY_SCOPE$1&&typeof PRIMARY_SCOPE$1=="object"&&!PRIMARY_SCOPE$1.cineModuleArchitectureHelpers&&defineHiddenProperty$1(PRIMARY_SCOPE$1,"cineModuleArchitectureHelpers",helpers$1);const DEFAULT_PENDING_QUEUE_KEY="__cinePendingModuleRegistrations__";function baseDetectGlobalScope(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function fallbackTryRequire$1(e){return null}function fallbackDefineHiddenProperty(e,t,o){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:o}),!0}catch{}try{return e[t]=o,!0}catch{}return!1}function collectCandidateScopesFallback(e,t,o){const r=typeof o=="function"?o:baseDetectGlobalScope,n=Array.isArray(t)?t:null,a=resolveHelperCollector(r,n);if(a)return a(e);const s=[];function l(u){!u||typeof u!="object"&&typeof u!="function"||s.indexOf(u)===-1&&s.push(u)}e&&l(e);try{l(r())}catch{}if(Array.isArray(n))for(let u=0;u<n.length;u+=1)l(n[u]);return typeof globalThis<"u"&&l(globalThis),typeof window<"u"&&l(window),typeof self<"u"&&l(self),typeof global<"u"&&l(global),l(baseDetectGlobalScope()),s}function resolveFromScopesFallback(e,t){const o=t||{},r=typeof o.predicate=="function"?o.predicate:null,n=Array.isArray(o.scopes)?o.scopes.slice():[],a=typeof o.detect=="function"?o.detect:baseDetectGlobalScope,s=Array.isArray(o.additionalScopes)?o.additionalScopes:void 0,l=o.primaryScope,u=collectCandidateScopesFallback(l,s,a);for(let d=0;d<u.length;d+=1)n.indexOf(u[d])===-1&&n.push(u[d]);for(let d=0;d<n.length;d+=1){const m=n[d];if(!(!m||typeof m!="object"&&typeof m!="function")){if(r)try{if(r(m,e))return m}catch{}try{if(e in m)return m}catch{}}}return null}const LOCAL_SCOPE$1=baseDetectGlobalScope();function resolveScopeUtils(e){const t=e||LOCAL_SCOPE$1;if(api$1&&typeof api$1=="object")return api$1;const o=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||o.indexOf(n)===-1&&o.push(n)}r(t),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global);for(let n=0;n<o.length;n+=1){const a=o[n];try{const s=a&&a.cineScopeUtils;if(s&&typeof s=="object")return s}catch{}}return null}const SCOPE_UTILS=resolveScopeUtils(LOCAL_SCOPE$1),detectGlobalScope$f=SCOPE_UTILS&&typeof SCOPE_UTILS.detectGlobalScope=="function"?function(){try{return SCOPE_UTILS.detectGlobalScope()}catch{}return baseDetectGlobalScope()}:baseDetectGlobalScope,tryRequire$1=SCOPE_UTILS&&typeof SCOPE_UTILS.tryRequire=="function"?SCOPE_UTILS.tryRequire:fallbackTryRequire$1,defineHiddenProperty=SCOPE_UTILS&&typeof SCOPE_UTILS.defineHiddenProperty=="function"?SCOPE_UTILS.defineHiddenProperty:fallbackDefineHiddenProperty,collectCandidateScopes$2=SCOPE_UTILS&&typeof SCOPE_UTILS.collectCandidateScopes=="function"?function(t,o,r){const n=typeof r=="function"?r:detectGlobalScope$f;return SCOPE_UTILS.collectCandidateScopes(t,o,n)}:collectCandidateScopesFallback,resolveFromScopes=SCOPE_UTILS&&typeof SCOPE_UTILS.resolveFromScopes=="function"?function(t,o){const r=o?cloneOptions$1(o):{};return r.primaryScope||(r.primaryScope=LOCAL_SCOPE$1),r.detect||(r.detect=detectGlobalScope$f),SCOPE_UTILS.resolveFromScopes(t,r)||null}:resolveFromScopesFallback;function resolveScopeCollector(){if(createCollector&&typeof createCollector=="function")return{createCollector};const e=collectCandidateScopes$2(LOCAL_SCOPE$1,null,detectGlobalScope$f);for(let t=0;t<e.length;t+=1){const o=e[t];try{const r=o&&o.__cineScopeCollector;if(r&&typeof r.createCollector=="function")return r}catch{}}return null}const SCOPE_COLLECTOR=resolveScopeCollector(),createScopeCollector=SCOPE_COLLECTOR&&typeof SCOPE_COLLECTOR.createCollector=="function"?SCOPE_COLLECTOR.createCollector:null,DEFAULT_EXTRAS_KEY={key:"defaultExtras"},HELPER_COLLECTOR_CACHE=[];function resolveHelperCollector(e,t){if(!createScopeCollector)return null;const o=Array.isArray(t)?t:DEFAULT_EXTRAS_KEY;for(let n=0;n<HELPER_COLLECTOR_CACHE.length;n+=1){const a=HELPER_COLLECTOR_CACHE[n];if(a.detect===e&&a.extras===o)return a.collector}const r=createScopeCollector({detectGlobalScope:e,additionalScopes:Array.isArray(t)?t:void 0});return r?(HELPER_COLLECTOR_CACHE.push({detect:e,extras:o,collector:r}),r):null}function cloneOptions$1(e){if(!e||typeof e!="object")return{};const t={},o=Object.keys(e);for(let r=0;r<o.length;r+=1){const n=o[r];t[n]=e[n]}return t}function fallbackCreateImmutability(){function e(o){if(!o||typeof o=="function"||typeof o!="object"&&typeof o!="function")return!1;try{if(typeof o.pipe=="function"&&typeof o.unpipe=="function")return!0;if(typeof o.on=="function"&&typeof o.emit=="function"){if(typeof o.write=="function"||typeof o.read=="function")return!0;const r=o.constructor&&o.constructor.name;if(r&&/Stream|Emitter|Port/i.test(r))return!0}if(typeof Symbol<"u"&&o[Symbol.toStringTag]){const r=o[Symbol.toStringTag];if(typeof r=="string"&&/Stream|Port/i.test(r))return!0}}catch{}return!1}function t(o,r=new WeakSet){if(!o||typeof o=="function"||typeof o!="object"&&typeof o!="function")return o;if(e(o))return process.stdout.write(`architecture.js bypassed freeze for value: ${typeof o}
`),o;if(r.has(o))return o;r.add(o);const n=Object.getOwnPropertyNames(o);for(let a=0;a<n.length;a+=1){const s=n[a];let l;try{l=o[s]}catch{l=void 0}!l||typeof l=="function"||typeof l!="object"&&typeof l!="function"||t(l,r)}try{return Object.freeze(o)}catch{return o}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const FALLBACK_IMMUTABILITY=fallbackCreateImmutability();function fallbackEnsureQueue(e,t){if(!e||typeof e!="object")return null;const o=typeof t=="string"&&t?t:DEFAULT_PENDING_QUEUE_KEY;let r=e[o];if(Array.isArray(r)||defineHiddenProperty(e,o,[])&&(r=e[o],Array.isArray(r)))return r;try{if(e[o]=[],r=e[o],Array.isArray(r))return r}catch{}return null}function fallbackSafeWarn$1(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function resolveArchitectureCore(e){const t=collectCandidateScopes$2(e,null,detectGlobalScope$f);for(let o=0;o<t.length;o+=1){const r=t[o];if(r&&typeof r.cineModuleArchitectureCore=="object")return r.cineModuleArchitectureCore}return null}function createFallbackCore(e){const t=e||{},o=t&&(t.primaryScope||t.scope)&&(typeof t.primaryScope=="object"||typeof t.primaryScope=="function"?t.primaryScope:typeof t.scope=="object"||typeof t.scope=="function"?t.scope:null),r=typeof t.detectGlobalScope=="function"?t.detectGlobalScope:null,n=typeof t.resolveFromScopes=="function"?t.resolveFromScopes:null,a=typeof t.freezeDeep=="function"?t.freezeDeep:null,s=typeof t.safeWarn=="function"?t.safeWarn:null,l=typeof t.tryRequire=="function"?t.tryRequire:null,u=Array.isArray(t.additionalScopes)?t.additionalScopes.filter(function($){return $&&(typeof $=="object"||typeof $=="function")}):[],d=typeof t.pendingQueueKey=="string"&&t.pendingQueueKey?t.pendingQueueKey:DEFAULT_PENDING_QUEUE_KEY;let m=null;function y(){try{if(r){const $=r();if($)return m=$,$}}catch{}if(m)return m;const B=o||detectGlobalScope$f();return m=B,B}function h(){return y()}function b(B){const $=B||o,V=resolveHelperCollector(y,u);if(V)return V($);const M=[];function F(z){!z||typeof z!="object"&&typeof z!="function"||M.indexOf(z)===-1&&M.push(z)}F($),F(y()),typeof globalThis<"u"&&F(globalThis),typeof window<"u"&&F(window),typeof self<"u"&&F(self),typeof global<"u"&&F(global);for(let z=0;z<u.length;z+=1)F(u[z]);return M}const v=l?function($){try{return l($)}catch{}return tryRequire$1($)}:tryRequire$1;let C=null;function A(B){try{const V=v("./immutability.js");if(V&&typeof V=="object")return C=V,V}catch{}const $=b(B);for(let V=0;V<$.length;V+=1){const M=$[V];if(M&&typeof M.cineModuleImmutability=="object")return C=M.cineModuleImmutability,C}return null}function w(B){if(C&&C!==FALLBACK_IMMUTABILITY)return C;const $=A(h());return $&&$!==C?(C=$,$):(C=FALLBACK_IMMUTABILITY,C)}function R(B,$){if(a)try{return a(B,$)}catch{}const V=w();try{return V.freezeDeep(B,$)}catch{}return FALLBACK_IMMUTABILITY.freezeDeep(B,$)}function _(B,$){const V=typeof $=="string"&&$?$:d;return fallbackEnsureQueue(B||h(),V)}function G(B,$){if(n)try{return n(B,$)}catch{}const V=cloneOptions$1($);return V.scopes||(V.scopes=b(V.primaryScope)),resolveFromScopes(B,V)}function O(B,$){if(s)try{s(B,$);return}catch{}fallbackSafeWarn$1(B,$)}return Object.freeze({detectGlobalScope:y,getPrimaryScope:h,collectCandidateScopes:b,tryRequire:v,resolveFromScopes:G,defineHiddenProperty,ensureQueue:_,freezeDeep:R,safeWarn:O})}const ARCHITECTURE_CORE=resolveArchitectureCore(detectGlobalScope$f()),CORE_FACTORY=ARCHITECTURE_CORE&&typeof ARCHITECTURE_CORE.createCore=="function"?ARCHITECTURE_CORE.createCore:createFallbackCore;function instantiateCore(e){const t=createFallbackCore(e);if(!CORE_FACTORY||typeof CORE_FACTORY!="function")return{primary:t,fallback:t};try{const o=CORE_FACTORY(e||{});if(o&&typeof o=="object")return{primary:o,fallback:t}}catch(o){fallbackSafeWarn$1("cineModuleArchitecture: core factory failed; using fallback core.",o)}return{primary:t,fallback:t}}function wrapMethod(e,t,o,r,n){const a=e&&typeof e[o]=="function"?e[o]:null,s=t&&typeof t[o]=="function"?t[o]:null,l=typeof r=="function"?r:null,u=d=>!d||typeof d.message!="string"?!1:!!(d.message.includes("trap returned extra keys but proxy target is non-extensible")||d.message.includes("Cannot freeze"));return function(){const m=arguments;if(a)try{return a.apply(e,m)}catch(y){if(typeof n=="function")try{u(y)||n("cineModuleArchitecture."+o+": primary implementation failed, using fallback.",y)}catch{}}if(s)return s.apply(t,m);if(l)return l.apply(null,m)}}function createArchitectureInstance(e){const t=instantiateCore(e||{}),o=t.primary,r=t.fallback,n=wrapMethod(o,r,"safeWarn",fallbackSafeWarn$1,null);function a(v,C){return wrapMethod(o,r,v,C,n)}const s=a("detectGlobalScope",baseDetectGlobalScope),l=a("getPrimaryScope",function(){return s()}),u=a("collectCandidateScopes",function(C){const A=C||l();return collectCandidateScopes$2(A)}),d=a("tryRequire",tryRequire$1),m=a("resolveFromScopes",function(C,A){const w=cloneOptions$1(A);return w.scopes||(w.scopes=u(w.primaryScope)),resolveFromScopes(C,w)}),y=a("defineHiddenProperty",defineHiddenProperty),h=a("ensureQueue",function(C,A){const w=C||l();return fallbackEnsureQueue(w,A)}),b=a("freezeDeep",function(C,A){return FALLBACK_IMMUTABILITY.freezeDeep(C,A)});return Object.freeze({detectGlobalScope:s,getPrimaryScope:l,collectCandidateScopes:u,tryRequire:d,resolveFromScopes:m,defineHiddenProperty:y,ensureQueue:h,freezeDeep:b,safeWarn:n})}const defaultInstance=createArchitectureInstance({}),architecture=Object.freeze({detectGlobalScope:defaultInstance.detectGlobalScope,collectCandidateScopes:defaultInstance.collectCandidateScopes,tryRequire:defaultInstance.tryRequire,resolveFromScopes:defaultInstance.resolveFromScopes,defineHiddenProperty:defaultInstance.defineHiddenProperty,ensureQueue:defaultInstance.ensureQueue,freezeDeep:defaultInstance.freezeDeep,safeWarn:defaultInstance.safeWarn});function createModuleArchitecture(e){const t=e||{},o=t&&(t.primaryScope||t.scope)&&(typeof t.primaryScope=="object"||typeof t.primaryScope=="function"?t.primaryScope:typeof t.scope=="object"||typeof t.scope=="function"?t.scope:null),r=typeof t.detectGlobalScope=="function"?t.detectGlobalScope:function(){return o||defaultInstance.detectGlobalScope()},n=Array.isArray(t.additionalScopes)?t.additionalScopes.filter(function(h){return h&&(typeof h=="object"||typeof h=="function")}):[],a=typeof t.tryRequire=="function"?t.tryRequire:defaultInstance.tryRequire,s=typeof t.resolveFromScopes=="function"?t.resolveFromScopes:null,l=typeof t.pendingQueueKey=="string"&&t.pendingQueueKey?t.pendingQueueKey:DEFAULT_PENDING_QUEUE_KEY,u=typeof t.freezeDeep=="function"?t.freezeDeep:defaultInstance.freezeDeep,d=typeof t.safeWarn=="function"?t.safeWarn:defaultInstance.safeWarn,m=createArchitectureInstance({primaryScope:o,detectGlobalScope:r,additionalScopes:n,tryRequire:a,resolveFromScopes:s,pendingQueueKey:l,freezeDeep:u,safeWarn:d});return Object.freeze({detectGlobalScope:m.detectGlobalScope,collectCandidateScopes:m.collectCandidateScopes,tryRequire:m.tryRequire,resolveFromScopes:m.resolveFromScopes,defineHiddenProperty:m.defineHiddenProperty,ensureQueue:m.ensureQueue,freezeDeep:m.freezeDeep,safeWarn:m.safeWarn})}const architectureWithFactory=Object.freeze({...architecture,createModuleArchitecture}),globalScope$6=defaultInstance.getPrimaryScope?defaultInstance.getPrimaryScope():defaultInstance.detectGlobalScope();globalScope$6&&typeof globalScope$6=="object"&&!globalScope$6.cineModuleArchitecture&&architecture.defineHiddenProperty(globalScope$6,"cineModuleArchitecture",architectureWithFactory);globalScope$6&&typeof globalScope$6=="object"&&!globalScope$6.cineModuleArchitectureFactory&&architecture.defineHiddenProperty(globalScope$6,"cineModuleArchitectureFactory",Object.freeze({createModuleArchitecture}));var define_process_env_default$1={};(function(){const e=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};function t(){return typeof e<"u"?e:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null}function o(){if(typeof require=="function")try{const ae=require("./runtime-environment-helpers.js");if(ae&&typeof ae=="object")return ae}catch{}const k=[];function Q(ae){!ae||typeof ae!="object"&&typeof ae!="function"||k.indexOf(ae)===-1&&k.push(ae)}const X=t();Q(X),typeof e<"u"&&Q(e),typeof window<"u"&&Q(window),typeof self<"u"&&Q(self),typeof global<"u"&&Q(global);for(let ae=0;ae<k.length;ae+=1){const Ae=k[ae];try{const Se=Ae&&Ae.cineRuntimeEnvironmentHelpers;if(Se&&typeof Se=="object")return Se}catch{}}return null}const r=o();function n(k,Q,X){if(r&&k&&typeof r[k]=="function")try{const ae=r[k].apply(r,Array.isArray(Q)?Q:[]);if(typeof ae<"u")return ae}catch{}if(typeof X=="function")return X()}function a(){if(r&&typeof r.fallbackDetectGlobalScope=="function")try{const k=r.fallbackDetectGlobalScope();if(k)return k}catch{}return typeof e<"u"?e:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function s(k){if(r&&typeof r.fallbackCollectCandidateScopes=="function")try{const ae=r.fallbackCollectCandidateScopes(k);if(Array.isArray(ae))return ae}catch{}const Q=[];function X(ae){!ae||typeof ae!="object"&&typeof ae!="function"||Q.indexOf(ae)===-1&&Q.push(ae)}return X(k),typeof e<"u"&&X(e),typeof window<"u"&&X(window),typeof self<"u"&&X(self),typeof global<"u"&&X(global),Q}function l(k){return n("fallbackLoadModuleEnvironment",[k],function(){const X=m("./environment.js");if(X&&typeof X=="object")return X;const ae=s(k);for(let Ae=0;Ae<ae.length;Ae+=1){const Se=ae[Ae];if(Se&&typeof Se.cineModuleEnvironment=="object")return Se.cineModuleEnvironment}return null})}function u(k){return n("fallbackLoadEnvironmentBridge",[k],function(){const X=m("./environment-bridge.js");if(X&&typeof X=="object")return X;const ae=s(k);for(let Ae=0;Ae<ae.length;Ae+=1){const Se=ae[Ae];if(Se&&typeof Se.cineEnvironmentBridge=="object")return Se.cineEnvironmentBridge}return null})}function d(k){return n("fallbackResolveModuleGlobals",[k],function(){const X=m("./globals.js");if(X&&typeof X=="object")return X;const ae=s(k);for(let Ae=0;Ae<ae.length;Ae+=1){const Se=ae[Ae];if(Se&&typeof Se.cineModuleGlobals=="object")return Se.cineModuleGlobals}return null})}function m(k){return n("fallbackTryRequire",[k],function(){if(typeof require!="function")return null;try{return require(k)}catch{return null}})}function y(k){return n("resolveModuleLinker",[k],function(){const X=m("./helpers/module-linker.js");if(X&&typeof X=="object")return X;const ae=s(k);for(let Ae=0;Ae<ae.length;Ae+=1){const Se=ae[Ae];try{const Oe=Se&&Se.cineModuleLinker;if(Oe&&typeof Oe=="object")return Oe}catch{}}return null})}const h=a(),b=y(h);function v(k){return n("resolveModuleSystem",[k],function(){const X=k||h,ae=m("./system.js");return ae&&typeof ae=="object"?ae:X&&typeof X.cineModuleSystem=="object"?X.cineModuleSystem:null})}const C=v(h);function A(k){return n("resolveEnvironmentContext",[k||h],function(){const X=k||h,ae=m("./environment-context.js");return ae&&typeof ae=="object"?ae:X&&typeof X.cineModuleEnvironmentContext=="object"?X.cineModuleEnvironmentContext:null})}const w=A(h);function R(){if(w&&typeof w.detectGlobalScope=="function")try{const k=w.detectGlobalScope();if(k)return k}catch{}return a()}const _=C&&typeof C.detectGlobalScope=="function"?function(){try{const Q=C.detectGlobalScope();if(Q)return Q}catch{}return R()}:R,G=(w&&typeof w.getPrimaryScope=="function"?w.getPrimaryScope():null)||_(),O=(function(){if(C&&typeof C.getGlobalScope=="function")try{const Q=C.getGlobalScope(G);if(Q)return Q}catch{}if(w&&typeof w.getGlobalScope=="function")try{const Q=w.getGlobalScope(G);if(Q)return Q}catch{}return G})(),B=typeof WeakMap=="function"?new WeakMap:null;function $(k){const Q=k||O,X=!!B&&Q&&(typeof Q=="object"||typeof Q=="function");if(X)try{const Se=B.get(Q);if(Se&&Array.isArray(Se)&&Se.length>0)return Se.slice()}catch{}if(C&&typeof C.collectCandidateScopes=="function")try{const Se=C.collectCandidateScopes(Q);if(Array.isArray(Se)&&Se.length>0){const Oe=Se.slice();if(X)try{const Ne=typeof Object.freeze=="function"?Object.freeze(Oe.slice()):Oe.slice();B.set(Q,Ne)}catch(Ne){}return Oe}}catch{}if(w&&typeof w.collectCandidateScopes=="function")try{const Se=w.collectCandidateScopes(Q);if(Array.isArray(Se)&&Se.length>0){const Oe=Se.slice();if(X)try{const Ne=typeof Object.freeze=="function"?Object.freeze(Oe.slice()):Oe.slice();B.set(Q,Ne)}catch(Ne){}return Oe}}catch{}const ae=s(Q),Ae=Array.isArray(ae)?ae.slice():[];if(X&&Ae.length>0)try{const Se=typeof Object.freeze=="function"?Object.freeze(Ae.slice()):Ae.slice();B.set(Q,Se)}catch{}return Ae}const V=(b&&typeof b.getModuleEnvironment=="function"?b.getModuleEnvironment():null)||(w&&typeof w.resolveModuleEnvironment=="function"?w.resolveModuleEnvironment(O):null)||l(O),M=(b&&typeof b.getEnvironmentBridge=="function"?b.getEnvironmentBridge():null)||(w&&typeof w.resolveEnvironmentBridge=="function"?w.resolveEnvironmentBridge(O):null)||u(O),F=(b&&typeof b.getModuleGlobals=="function"?b.getModuleGlobals():null)||(w&&typeof w.resolveModuleGlobals=="function"?w.resolveModuleGlobals(O):null)||d(O);function z(k,Q){if(b&&typeof b.recordModule=="function"&&b.recordModule(k,Q),!(!F||typeof F.recordModule!="function"))try{F.recordModule(k,Q)}catch{}}const x=(function(){return b&&typeof b.tryRequire=="function"?b.tryRequire:C&&typeof C.tryRequire=="function"?function(X){const ae=C.tryRequire(X);return typeof ae>"u"?m(X):ae}:w&&typeof w.tryRequire=="function"?function(X){const ae=w.tryRequire(X);return typeof ae>"u"?m(X):ae}:F&&typeof F.tryRequire=="function"?F.tryRequire:M&&typeof M.tryRequire=="function"?function(X){const ae=M.tryRequire(X);return typeof ae>"u"?m(X):ae}:V&&typeof V.tryRequire=="function"?V.tryRequire:m})();function H(k){const Q=k||O;if(b&&typeof b.getModuleRegistry=="function"){const Ae=b.getModuleRegistry(Q);if(Ae)return Ae}if(F&&typeof F.resolveModuleRegistry=="function")try{const Ae=F.resolveModuleRegistry(Q);if(Ae)return Ae}catch{}if(M&&typeof M.getModuleRegistry=="function")try{const Ae=M.getModuleRegistry(Q);if(Ae)return Ae}catch{}if(V&&typeof V.resolveModuleRegistry=="function")try{return V.resolveModuleRegistry(Q)}catch{}const X=x("./registry.js");if(X&&typeof X=="object")return X;const ae=$(Q);for(let Ae=0;Ae<ae.length;Ae+=1){const Se=ae[Ae];if(Se&&typeof Se.cineModules=="object")return Se.cineModules}return null}function W(k){const Q=O;if(C&&typeof C.getModuleRegistry=="function")try{const X=C.getModuleRegistry(Q);if(X)return X}catch{}if(w&&typeof w.resolveModuleRegistry=="function")try{const X=w.resolveModuleRegistry(Q);if(X)return X}catch{}return H(Q)}const U=(function(){if(b&&typeof b.getModuleRegistry=="function"){const k=b.getModuleRegistry(O);if(k)return k}if(C&&typeof C.getModuleRegistry=="function")try{const k=C.getModuleRegistry(O);if(k)return k}catch{}if(F&&typeof F.getModuleRegistry=="function")try{const k=F.getModuleRegistry(O);if(k)return k}catch{}if(M&&typeof M.getModuleRegistry=="function")try{const k=M.getModuleRegistry(O);if(k)return k}catch{}if(V&&typeof V.getModuleRegistry=="function")try{const k=V.getModuleRegistry(O);if(k)return k}catch{}return W()})(),j=(function(){if(b&&typeof b.getPendingQueueKey=="function"){const Q=b.getPendingQueueKey();if(typeof Q=="string"&&Q)return Q}if(C&&typeof C.getPendingQueueKey=="function")try{const Q=C.getPendingQueueKey();if(typeof Q=="string"&&Q)return Q}catch{}if(F&&typeof F.getPendingQueueKey=="function")try{const Q=F.getPendingQueueKey();if(typeof Q=="string"&&Q)return Q}catch{}if(M&&typeof M.getPendingQueueKey=="function")try{const Q=M.getPendingQueueKey();if(typeof Q=="string"&&Q)return Q}catch{}return V&&typeof V.PENDING_QUEUE_KEY=="string"?V.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function Y(k){if(!k||typeof k!="object")return{};const Q={},X=Object.keys(k);for(let ae=0;ae<X.length;ae+=1){const Ae=X[ae];Q[Ae]=k[Ae]}return Q}function le(k){return typeof k=="string"?k:""}function be(k,Q){if(!Array.isArray(k)||!Q)return;let X=0;for(let ae=0;ae<k.length;ae+=1){const Ae=k[ae];(Ae&&typeof Ae.name=="string"?Ae.name:"")!==Q&&(k[X]=Ae,X+=1)}X<k.length&&(k.length=X)}function re(k,Q,X){const ae=le(k);if(C&&typeof C.queueModuleRegistration=="function")try{if(C.queueModuleRegistration(ae||k,Q,X,O))return!0}catch{}if(F&&typeof F.queueModuleRegistration=="function")try{if(F.queueModuleRegistration(ae||k,Q,X,O))return!0}catch{}if(M&&typeof M.queueModuleRegistration=="function")try{if(M.queueModuleRegistration(ae||k,Q,X))return!0}catch{}if(V&&typeof V.queueModuleRegistration=="function")return V.queueModuleRegistration(ae||k,Q,X,O);if(!O||typeof O!="object"||!ae)return!1;const Ae=Object.freeze({name:ae,api:Q,options:Object.freeze(Y(X))});let Se=O[j];if(!Array.isArray(Se))try{Object.defineProperty(O,j,{configurable:!0,enumerable:!1,writable:!0,value:[]}),Se=O[j]}catch{try{Array.isArray(O[j])||(O[j]=[]),Se=O[j]}catch{return!1}}be(Se,ae);try{Se.push(Ae)}catch{Se[Se.length]=Ae}return!0}function de(k,Q,X){if(!U||typeof U.register!="function")return{ok:!1,error:null,reason:"missing-registry"};const ae=typeof k=="string"?k:"";if(!ae)return{ok:!1,error:new TypeError("cineRuntime expected a module name."),reason:"invalid-name"};if(typeof U.has=="function")try{if(U.has(ae)){if(typeof U.get=="function")try{const Ae=U.get(ae);Ae&&z(ae,Ae)}catch(Ae){}return{ok:!0,alreadyRegistered:!0}}}catch(Ae){return{ok:!1,error:Ae,reason:"registry-check-failed"}}try{const Ae=U.register(ae,Q,X);return z(ae,Ae||Q),{ok:!0,registered:!0}}catch(Ae){return{ok:!1,error:Ae,reason:"register-failed"}}}function ne(k,Q,X,ae){if(C&&typeof C.registerModule=="function")return C.registerModule(k,Q,X,O,ae)?(z(k,Q),!0):!1;let Ae=null;const Se=de(k,Q,X);if(Se.ok)return!0;Ae=Se.error||null;const Oe=Me({warn:!1});if(Oe&&(Oe.flushed&&Oe.flushed.processed>0||Oe.ok)){const Ne=de(k,Q,X);if(Ne.ok)return!0;Ne.error&&(Ae=Ne.error)}if(Ae&&typeof ae=="function")try{ae(Ae)}catch{}return re(k,Q,X),!1}const Ce=(function(){return C&&typeof C.registerModule=="function"?function(X,ae,Ae,Se){return C.registerModule(X,ae,Ae,O,Se)?(z(X,ae),!0):!1}:F&&typeof F.registerOrQueueModule=="function"?function(X,ae,Ae,Se){try{if(F.registerOrQueueModule(X,ae,Ae,Se,O,U))return!0}catch{}return ne(X,ae,Ae,Se)}:M&&typeof M.registerOrQueueModule=="function"?function(X,ae,Ae,Se){try{if(M.registerOrQueueModule(X,ae,Ae,Se,O,U))return!0}catch{}return ne(X,ae,Ae,Se)}:V&&typeof V.registerOrQueueModule=="function"?function(X,ae,Ae,Se){return V.registerOrQueueModule(X,ae,Ae,Se,O,U)}:ne})();function Ee(k){if(!k||typeof process>"u"||!process)return!1;if(k===process)return!0;if(typeof k=="object"){try{if(k.constructor&&k.constructor.name==="process")return!0}catch{}if(typeof k.pid=="number"&&typeof k.nextTick=="function"&&typeof k.emit=="function"&&typeof k.binding=="function")return!0}if(typeof k=="function"){if(k===process.binding||k===process._linkedBinding||k===process.dlopen)return!0;try{const Q=k.name||"";if(Q&&(Q==="binding"||Q==="dlopen")){const X=Function.prototype.toString.call(k);if(X&&X.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Pe(k){if(!k||typeof k=="function"||typeof k!="object"&&typeof k!="function")return!1;if(Ee(k)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof module<"u"&&module&&typeof module.constructor=="function"&&k instanceof module.constructor)return!0}catch{}try{if(typeof k.pipe=="function"&&typeof k.unpipe=="function")return!0;if(typeof k.on=="function"&&typeof k.emit=="function"){if(typeof k.write=="function"||typeof k.read=="function")return!0;const Q=k.constructor&&k.constructor.name;if(Q&&/Stream|Emitter|Port/i.test(Q))return!0}if(typeof Symbol<"u"&&k[Symbol.toStringTag]){const Q=k[Symbol.toStringTag];if(typeof Q=="string"&&/Stream|Port/i.test(Q))return!0}}catch{}return!1}const et=typeof WeakSet=="function"?new WeakSet:null;function Je(k){if(k&&typeof k.has=="function"&&typeof k.add=="function")return k;if(Array.isArray(k))return{has(X){return k.indexOf(X)!==-1},add(X){k.indexOf(X)===-1&&k.push(X)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const Q=[];return{has(X){return Q.indexOf(X)!==-1},add(X){Q.indexOf(X)===-1&&Q.push(X)}}}function it(k,Q){if(!k||typeof k!="object"||Pe(k))return k;if(typeof process<"u"&&process&&define_process_env_default$1&&define_process_env_default$1.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(k)}catch{}return k}if(et&&et.has(k))return k;const X=Je(Q);if(X.has(k))return k;X.add(k);let ae=!1;if(typeof Object.isFrozen=="function")try{ae=Object.isFrozen(k)}catch{ae=!1}let Ae=[];try{Ae=Object.getOwnPropertyNames(k)}catch{if(typeof Reflect<"u"&&typeof Reflect.ownKeys=="function")try{Ae=Reflect.ownKeys(k).filter(function(Ne){return typeof Ne=="string"})}catch{Ae=[]}}for(let Se=0;Se<Ae.length;Se+=1){const Oe=Ae[Se];if(Oe==="web3"&&k===O)continue;let Ne=!0;try{Ne=Object.prototype.hasOwnProperty.call(k,Oe)}catch{Ne=!0}if(!Ne)continue;let Qe;try{Qe=k[Oe]}catch{Qe=void 0}if(!(!Qe||typeof Qe=="function"||typeof Qe!="object"&&typeof Qe!="function"))try{it(Qe,X)}catch{}}if(ae){if(et)try{et.add(k)}catch{}return k}try{const Se=Object.freeze(k);if(et)try{et.add(Se||k)}catch(Oe){}return Se}catch{return k}}const rt=(function(){return C&&typeof C.freezeDeep=="function"?C.freezeDeep:F&&typeof F.freezeDeep=="function"?F.freezeDeep:M&&typeof M.freezeDeep=="function"?function(X,ae){try{return M.freezeDeep(X,ae)}catch{return it(X,ae)}}:V&&typeof V.freezeDeep=="function"?V.freezeDeep:it})();function Pt(k){if(!k||typeof k!="object"&&typeof k!="function")return k;try{typeof Object.preventExtensions=="function"&&Object.preventExtensions(k)}catch{}try{typeof Object.seal=="function"&&Object.seal(k)}catch{}const Q=[];try{const X=Object.getOwnPropertyNames(k);for(let ae=0;ae<X.length;ae+=1)Q.push(X[ae])}catch{}if(typeof Object.getOwnPropertySymbols=="function")try{const X=Object.getOwnPropertySymbols(k);for(let ae=0;ae<X.length;ae+=1)Q.push(X[ae])}catch{}for(let X=0;X<Q.length;X+=1){const ae=Q[X];let Ae;try{Ae=Object.getOwnPropertyDescriptor(k,ae)}catch{Ae=null}if(!Ae||!(Ae.configurable===!0||"writable"in Ae&&Ae.writable===!0))continue;const Oe={configurable:!1,enumerable:!!Ae.enumerable};Object.prototype.hasOwnProperty.call(Ae,"value")?(Oe.value=Ae.value,Oe.writable=!1):(Oe.get=Ae.get,Oe.set=Ae.set);try{Object.defineProperty(k,ae,Oe)}catch{}}return k}function vt(k){const Q=rt(k);if(Object.isFrozen(Q))return Q;try{const X=Object.freeze(Q);if(Object.isFrozen(X))return X}catch{}return Pt(Q),Q}function bo(k,Q){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof Q>"u"?console.warn(k):console.warn(k,Q)}catch{}}const Et=(function(){return C&&typeof C.safeWarn=="function"?C.safeWarn:F&&typeof F.safeWarn=="function"?F.safeWarn:M&&typeof M.safeWarn=="function"?function(X,ae){try{M.safeWarn(X,ae)}catch{bo(X,ae)}}:V&&typeof V.safeWarn=="function"?V.safeWarn:bo})();function Ut(k,Q){if(!k||typeof k!="object"&&typeof k!="function")return{ok:!1,reason:"invalid-scope"};const X=Q||U;if(!X)return{ok:!1,reason:"missing-registry"};try{return k.cineModules===X?{ok:!0,already:!0}:(Object.defineProperty(k,"cineModules",{configurable:!0,enumerable:!1,value:X,writable:!0}),{ok:!0,updated:!0})}catch(ae){try{if(k.cineModules=X,k.cineModules===X)return{ok:!0,updated:!0}}catch(Ae){return{ok:!1,reason:"expose-failed",error:Ae||ae}}}return{ok:!0,updated:!0}}function ge(k,Q){if(!k||typeof k!="object"&&typeof k!="function")return null;try{const X=k[Q];return Array.isArray(X)?X:null}catch{return null}}function ue(k,Q){if(!Array.isArray(k))return;const X=Q&&typeof Q.name=="string"?Q.name:"";X&&be(k,X);try{k.push(Q)}catch{k[k.length]=Q}}function We(k={}){const Q=k.registry||U,X=typeof k.queueKey=="string"&&k.queueKey?k.queueKey:j;if(!Q||typeof Q.register!="function")return vt({ok:!1,processed:0,requeued:0,scopes:0,queueKey:X,failures:vt([{reason:"missing-registry"}])});const ae=Array.isArray(k.scopes)&&k.scopes.length>0?k.scopes.slice():$(k.scope||O);let Ae=0,Se=0,Oe=0;const Ne=[];for(let Qe=0;Qe<ae.length;Qe+=1){const Fe=ae[Qe],_e=ge(Fe,X);if(!_e||_e.length===0)continue;Oe+=1;const He=_e.slice();_e.length=0;for(let st=0;st<He.length;st+=1){const at=He[st];if(!at||typeof at!="object")continue;const St=typeof at.name=="string"?at.name:"";if(!St)continue;const kt=at.api,Zt=Y(at.options);if(typeof Q.has=="function"){let Ht=!1;try{Ht=Q.has(St)}catch(jo){Ne.push({name:St,message:jo&&typeof jo.message=="string"?jo.message:null,reason:"has-check-failed",scopeIndex:Qe})}if(Ht){Ae+=1;continue}}try{const Ht=Q.register(St,kt,Zt);z(St,Ht||kt),Ae+=1}catch(Ht){Se+=1,ue(_e,at),Ne.push({name:St,message:Ht&&typeof Ht.message=="string"?Ht.message:null,reason:"register-failed",scopeIndex:Qe})}}}return Ne.length>0&&k.warn&&Et("cineRuntime.flushPendingModuleQueues() encountered issues while replaying module registrations.",Ne),vt({ok:Ne.length===0,processed:Ae,requeued:Se,scopes:Oe,queueKey:X,failures:Ne.length>0?vt(Ne):vt([])})}function Me(k={}){const Q=k.registry||U,X=typeof k.queueKey=="string"&&k.queueKey?k.queueKey:j,ae=Array.isArray(k.scopes)&&k.scopes.length>0?k.scopes.slice():$(k.scope||O),Ae=[],Se=[];for(let Fe=0;Fe<ae.length;Fe+=1){const _e=ae[Fe],He=Ut(_e,Q);Ae.push({scopeIndex:Fe,ok:!!He.ok,updated:!!He.updated,already:!!He.already,reason:typeof He.reason=="string"?He.reason:null}),!He.ok&&He.reason!=="missing-registry"&&Se.push({scopeIndex:Fe,reason:He.reason||"expose-failed",message:He.error&&typeof He.error.message=="string"?He.error.message:null})}Se.length>0&&k.warn!==!1&&Et("cineRuntime.synchronizeModuleLinks() could not expose cineModules on every scope.",Se);const Oe=We({registry:Q,queueKey:X,scopes:ae,warn:k.warn!==!1}),Ne=[];if(Array.isArray(Oe.failures))for(let Fe=0;Fe<Oe.failures.length;Fe+=1)Ne.push(Oe.failures[Fe]);if(Se.length>0)for(let Fe=0;Fe<Se.length;Fe+=1)Ne.push(Se[Fe]);const Qe={ok:Oe.ok&&Se.length===0,queueKey:X,exposures:Ae,flushed:Oe,failures:Ne};return vt(Qe)}const Te=Me({warn:!1});function Be(k={}){const Q=k.registry||U;if(!Q||typeof Q.list!="function"||typeof Q.describe!="function")return vt({ok:!1,reason:"missing-registry",modules:[],missingConnections:[],errors:[]});let X;try{X=Q.list()}catch(Qe){return vt({ok:!1,reason:"list-failed",modules:[],missingConnections:[],errors:vt([{type:"list",message:Qe&&typeof Qe.message=="string"?Qe.message:null}])})}const ae=Array.isArray(X)?X.slice():[],Ae=[],Se=[],Oe=[],Ne=typeof Q.has=="function"?function(Fe){try{return Q.has(Fe)}catch(_e){return Oe.push({type:"has",module:Fe,message:_e&&typeof _e.message=="string"?_e.message:null}),ae.indexOf(Fe)!==-1}}:function(Fe){return ae.indexOf(Fe)!==-1};for(let Qe=0;Qe<ae.length;Qe+=1){const Fe=ae[Qe];let _e=null;try{_e=Q.describe(Fe)}catch(St){Oe.push({type:"describe",module:Fe,message:St&&typeof St.message=="string"?St.message:null})}const He=new Set,st=[],at=[];if(_e&&_e.connections&&typeof _e.connections[Symbol.iterator]=="function")for(const St of _e.connections){if(typeof St!="string")continue;const kt=St.trim();!kt||He.has(kt)||(He.add(kt),st.push(kt),Ne(kt)||(at.push(kt),Se.push({from:Fe,to:kt})))}Ae.push(vt({name:Fe,connections:st,missing:at,ok:at.length===0}))}return vt({ok:Se.length===0,modules:Ae,missingConnections:Se,errors:Oe})}function Ve(k,Q){if(!O||typeof O!="object")return!1;try{return Object.defineProperty(O,k,{configurable:!0,enumerable:!1,value:Q,writable:!1}),!0}catch{try{return O[k]=Q,!0}catch{return!1}}}const je=(function(){return C&&typeof C.exposeGlobal=="function"?function(X,ae,Ae){try{return C.exposeGlobal(X,ae,O,Ae)}catch{return Ve(X,ae)}}:F&&typeof F.exposeGlobal=="function"?function(X,ae,Ae){try{return F.exposeGlobal(X,ae,Ae)}catch{return Ve(X,ae)}}:M&&typeof M.exposeGlobal=="function"?function(X,ae,Ae){try{return M.exposeGlobal(X,ae,Ae)}catch{return Ve(X,ae)}}:V&&typeof V.exposeGlobal=="function"?function(X,ae,Ae){return V.exposeGlobal(X,ae,O,Ae)}:Ve})(),mt=["cinePersistence","cineOffline","cineUi"],ct=["storage.loadDeviceData","storage.saveDeviceData","storage.loadSetups","storage.saveSetups","storage.saveSetup","storage.loadSetup","storage.deleteSetup","storage.renameSetup","storage.loadSessionState","storage.saveSessionState","storage.saveProject","storage.loadProject","storage.deleteProject","storage.exportAllData","storage.importAllData","storage.clearAllData","storage.loadFavorites","storage.saveFavorites","storage.loadFeedback","storage.saveFeedback","storage.loadAutoGearRules","storage.saveAutoGearRules","storage.loadAutoGearBackups","storage.saveAutoGearBackups","storage.loadAutoGearSeedFlag","storage.saveAutoGearSeedFlag","storage.loadAutoGearBackupRetention","storage.saveAutoGearBackupRetention","storage.getAutoGearBackupRetentionDefault","storage.loadAutoGearPresets","storage.saveAutoGearPresets","storage.loadAutoGearActivePresetId","storage.saveAutoGearActivePresetId","storage.loadAutoGearAutoPresetId","storage.saveAutoGearAutoPresetId","storage.loadAutoGearMonitorDefaults","storage.saveAutoGearMonitorDefaults","storage.loadAutoGearBackupVisibility","storage.saveAutoGearBackupVisibility","storage.loadFullBackupHistory","storage.saveFullBackupHistory","storage.recordFullBackupHistoryEntry","storage.requestPersistentStorage","storage.clearUiCacheStorageEntries","storage.ensureCriticalStorageBackups","storage.getLastCriticalStorageGuardResult","autosave.saveSession","autosave.autoSaveSetup","autosave.saveGearList","autosave.restoreSessionState","backups.collectFullBackupData","backups.createSettingsBackup","backups.captureStorageSnapshot","backups.sanitizeBackupPayload","backups.autoBackup","backups.formatFullBackupFilename","backups.downloadPayload","backups.recordFullBackupHistoryEntry","restore.proceed","restore.abort","share.downloadProject","share.encodeSharedSetup","share.decodeSharedSetup","share.applySharedSetup","share.applySharedSetupFromUrl"],$t=["registerServiceWorker","reloadApp"],fo=[{name:"deviceManagerSection",actions:["show","hide","toggle"]},{name:"shareDialog",actions:["open","submit","cancel","dismiss"]},{name:"sharedImportDialog",actions:["submit","cancel","dismiss","changeMode"]},{name:"backupSettings",actions:["execute"]},{name:"restoreSettings",actions:["openPicker","processFile"]}],no=["saveSetup","deleteSetup","shareOpen","shareSubmit","shareCancel","shareApplyFile","shareInputChange","sharedImportSubmit","sharedImportCancel","performBackup","openRestorePicker","applyRestoreFile"],Nt=["saveSetup","autoBackupBeforeDeletion","shareProject","sharedImport","backupSettings","restoreSettings"];function xo(k){if(!k||!mt.includes(k))throw new TypeError(`cineRuntime cannot resolve unknown module "${k}".`);if(U&&typeof U.get=="function")try{const Q=U.get(k);if(Q)return Q}catch{}if(O&&typeof O=="object")try{const Q=O[k];if(Q)return Q}catch{}switch(k){case"cinePersistence":return x("./persistence.js");case"cineOffline":return x("./offline.js");case"cineUi":return x("./ui.js");default:return null}}function Io(k,Q={}){const X=xo(k);if(!X&&Q.optional)return null;if(!X)throw new Error(`cineRuntime could not locate ${k}.`);return X}function qo(k){if(Array.isArray(k))return k.slice();if(typeof k=="string"&&k.trim())return k.split(".");throw new TypeError("cineRuntime expected check paths to be strings or arrays.")}function eo(k,Q,X,ae,Ae){const Se=qo(Q);let Oe=k,Ne=`${Ae}`;for(let _e=0;_e<Se.length;_e+=1){const He=Se[_e];if(Ne=Ne?`${Ne}.${He}`:He,!Oe||typeof Oe!="object"&&typeof Oe!="function"){X.push(Ne),ae[Ne]=!1;return}Oe=Oe[He]}const Qe=`${Ae}.${Se.join(".")}`,Fe=typeof Oe=="function";Fe||X.push(Qe),ae[Qe]=Fe}function To(k,Q,X){if(!k||typeof k!="object")return;for(let Se=0;Se<ct.length;Se+=1)eo(k,ct[Se],Q,X,"cinePersistence");const ae=k.__internal,Ae=ae&&typeof ae.inspectBinding=="function"?ae.inspectBinding.bind(ae):null;if(!Ae){const Se="cinePersistence.__internal.inspectBinding";Q.push(Se),X[Se]=!1;return}for(let Se=0;Se<ct.length;Se+=1){const Oe=ct[Se],Ne=qo(Oe),Qe=Ne[Ne.length-1],Fe=`cinePersistence.bindings.${Qe}`;let _e=null;try{_e=Ae(Qe,{refresh:!0})}catch{_e=null}const He=!!(_e&&_e.available);He||Q.push(Fe),X[Fe]=He,_e&&(X[`${Fe}.provider`]=_e.providerName||null)}}function ko(k,Q,X){for(let ae=0;ae<$t.length;ae+=1){const Ae=$t[ae],Se=k?k[Ae]:null,Oe=`cineOffline.${Ae}`,Ne=typeof Se=="function";Ne||Q.push(Oe),X[Oe]=Ne}}function Jt(k,Q,X){const ae=k&&k.controllers,Ae=ae&&typeof ae.get=="function"?ae.get.bind(ae):null;for(let Se=0;Se<fo.length;Se+=1){const Oe=fo[Se],Ne=`cineUi.controllers.${Oe.name}`;if(!Ae){Q.push(Ne),X[Ne]=!1;continue}let Qe=null;try{Qe=Ae(Oe.name)}catch{Qe=null}if(!(!!Qe&&typeof Qe=="object")){Q.push(Ne),X[Ne]=!1;continue}X[Ne]=!0;for(let _e=0;_e<Oe.actions.length;_e+=1){const He=Oe.actions[_e],st=`${Ne}.${He}`,St=typeof Qe[He]=="function";St||Q.push(st),X[st]=St}}}function lr(k,Q,X){const ae=k&&k.interactions,Ae=ae&&typeof ae.get=="function"?ae.get.bind(ae):null;for(let Se=0;Se<no.length;Se+=1){const Oe=no[Se],Ne=`cineUi.interactions.${Oe}`;if(!Ae){Q.push(Ne),X[Ne]=!1;continue}let Qe=null;try{Qe=Ae(Oe)}catch{Qe=null}const Fe=typeof Qe=="function";Fe||Q.push(Ne),X[Ne]=Fe}}function pt(k,Q,X){const ae=k&&k.help,Ae=ae&&typeof ae.resolve=="function"?ae.resolve.bind(ae):null;for(let Se=0;Se<Nt.length;Se+=1){const Oe=Nt[Se],Ne=`cineUi.help.${Oe}`;if(!Ae){Q.push(Ne),X[Ne]=!1;continue}let Qe=null;try{Qe=Ae(Oe)}catch{Qe=null}const Fe=typeof Qe=="string"&&!!Qe.trim();Fe||Q.push(Ne),X[Ne]=Fe}}function mo(){return vt({cinePersistence:ct.slice(),cineOffline:$t.slice(),cineUi:{controllers:fo.map(k=>({name:k.name,actions:k.actions.slice()})),interactions:no.slice(),help:Nt.slice()}})}function go(k={}){const Q=Me({warn:k.warnOnFailure}),X=[],ae={};Q&&typeof Q=="object"&&(ae["synchronization.ok"]=!!Q.ok,Array.isArray(Q.failures)&&Q.failures.length>0&&(ae["synchronization.failures"]=Q.failures),Q.ok||X.push("cineRuntime synchronization"));let Ae=null;if(U&&typeof U.assertRegistered=="function")try{Ae=U.assertRegistered(mt)}catch(He){Et("cineRuntime.verifyCriticalFlows() could not inspect cineModules registry.",He)}const Se=xo("cinePersistence"),Oe=xo("cineOffline"),Ne=xo("cineUi"),Qe={cinePersistence:!!Se,cineOffline:!!Oe,cineUi:!!Ne};if(Ae&&Ae.detail){const He={},st=Object.keys(Ae.detail);for(let at=0;at<st.length;at+=1){const St=st[at],kt=!!Ae.detail[St];He[St]=kt,ae[`${St}.registered`]=kt,kt||X.push(`${St} (not registered)`)}Qe.registry=He}Se?(ae.cinePersistence=!0,Object.isFrozen(Se)?ae["cinePersistence.frozen"]=!0:(X.push("cinePersistence (not frozen)"),ae["cinePersistence.frozen"]=!1),To(Se,X,ae)):(X.push("cinePersistence"),ae.cinePersistence=!1),Oe?(ae.cineOffline=!0,Object.isFrozen(Oe)?ae["cineOffline.frozen"]=!0:(X.push("cineOffline (not frozen)"),ae["cineOffline.frozen"]=!1),ko(Oe,X,ae)):(X.push("cineOffline"),ae.cineOffline=!1),Ne?(ae.cineUi=!0,Object.isFrozen(Ne)?ae["cineUi.frozen"]=!0:(X.push("cineUi (not frozen)"),ae["cineUi.frozen"]=!1),Jt(Ne,X,ae),lr(Ne,X,ae),pt(Ne,X,ae)):(X.push("cineUi"),ae.cineUi=!1);const Fe=X.length===0,_e=vt({ok:Fe,missing:X.slice(),modules:vt(Qe),details:vt(ae),registry:Ae?vt(Ae):null,checks:mo(),synchronization:Q});if(!Fe&&(k.warnOnFailure&&Et("cineRuntime.verifyCriticalFlows() detected missing safeguards.",X),k.throwOnFailure)){const He=new Error("cineRuntime integrity verification failed.");throw He.details=_e,He}return _e}const So=vt({getPersistence(k){return Io("cinePersistence",k)},getOffline(k){return Io("cineOffline",k)},getUi(k){return Io("cineUi",k)},getModuleRegistry(){return U||null},synchronizeModules(k){return Me(k||{})},inspectModuleConnections(k){return Be(k||{})},listCriticalChecks:mo,verifyCriticalFlows:go,__internal:vt({resolveModule:xo,ensureModule:Io,listCriticalChecks:mo,moduleRegistry:U||null,synchronizeModuleLinks:Me,flushPendingModuleQueues:We,initialSynchronization:Te,inspectModuleConnections:Be})});if(z("cineRuntime",So),Ce("cineRuntime",So,{category:"runtime",description:"Runtime orchestrator ensuring persistence, offline, and UI safeguards stay intact.",replace:!0,connections:["cinePersistence","cineOffline","cineUi","cineModuleGlobals","cineModuleContext"]},k=>{Et("Unable to register cineRuntime module.",k)}),O&&typeof O=="object"){let k=null;try{k=O.cineRuntime||null}catch{k=null}k!==So&&(je("cineRuntime",So,{configurable:!0,enumerable:!1,writable:!1})||Et("Unable to expose cineRuntime globally."))}if(typeof module<"u"&&module&&module.exports)if(module.exports&&module.exports!==So&&typeof module.exports=="object"&&Object.keys(module.exports).length>0)try{module.exports.cineRuntime!==So&&Object.defineProperty(module.exports,"cineRuntime",{configurable:!0,enumerable:!1,value:So,writable:!0})}catch(k){Et("Unable to attach cineRuntime to existing module.exports.",k)}else module.exports=So;return So})();(function(){function e(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const t=e();function o(_){const G=_&&(typeof _=="object"||typeof _=="function")?_:e(),O=G&&(typeof G=="object"||typeof G=="function")?G:null;if(!O)return null;let B=null;try{O&&typeof O.cineModuleBase=="object"&&(B=O.cineModuleBase)}catch{B=null}if(B)return B;const $=Object.create(null),V=Object.create(null),M=(j,Y)=>{if(typeof j!="string"||!j)return;const le=V[j];if(!(!Array.isArray(le)||le.length===0)){V[j]=[];for(let be=0;be<le.length;be+=1){const re=le[be];if(typeof re=="function")try{re(Y)}catch{}}}},F=(j,Y)=>{typeof j!="string"||!j||($[j]=Y,M(j,Y))},z=j=>typeof j!="string"||!j?null:Object.prototype.hasOwnProperty.call($,j)?$[j]:null,x=(j,Y)=>{if(typeof Y!="function"||typeof j!="string"||!j)return!1;const le=z(j);if(le){try{Y(le)}catch{}return!0}return Array.isArray(V[j])||(V[j]=[]),V[j].push(Y),!0},H=()=>{let j=null;try{j=O.cineModuleGlobals}catch{j=null}(!j||typeof j!="object")&&(j={}),typeof j.getModule!="function"&&(j.getModule=Y=>z(Y)),typeof j.whenModuleAvailable!="function"&&(j.whenModuleAvailable=(Y,le)=>x(Y,le)),typeof j.register!="function"&&(j.register=(Y,le)=>(F(Y,le),!0));try{Object.defineProperty(O,"cineModuleGlobals",{configurable:!0,enumerable:!1,writable:!0,value:j})}catch{try{O.cineModuleGlobals=j}catch{}}return j},W=()=>{let j=null;try{j=O.cineModules}catch{j=null}(!j||typeof j!="object")&&(j={}),typeof j.get!="function"&&(j.get=Y=>z(Y)),typeof j.register!="function"&&(j.register=(Y,le)=>(F(Y,le),!0));try{Object.defineProperty(O,"cineModules",{configurable:!0,enumerable:!1,writable:!0,value:j})}catch{try{O.cineModules=j}catch{}}return j},U={freezeDeep(j){return j},safeWarn(j,Y){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof Y>"u"?console.warn(j):console.warn(j,Y)}catch{}},informModuleGlobals(j,Y){const le=H();if(le&&typeof le.register=="function")try{return le.register(j,Y),!0}catch{}return F(j,Y),!0},registerOrQueueModule(j,Y){const le=W();if(le&&typeof le.register=="function")try{le.register(j,Y)}catch{F(j,Y)}else F(j,Y);return H(),!0},exposeGlobal(j,Y,le,be={}){const re=le&&(typeof le=="object"||typeof le=="function")?le:O;if(!re||typeof re!="object"&&typeof re!="function")return!1;const de={configurable:be.configurable!==!1,enumerable:!!be.enumerable,writable:be.writable===!0,value:Y};try{return Object.defineProperty(re,j,de),!0}catch{try{return re[j]=Y,!0}catch{}}return!1}};return U.registerOrQueueModule("cineModuleBase",U),U.exposeGlobal("cineModuleBase",U,O,{configurable:!0,enumerable:!1,writable:!1}),H(),W(),U}function r(_){if(typeof cineModuleBase=="object"&&cineModuleBase)return cineModuleBase;if(typeof require=="function")try{const G=require("./base.js");if(G&&typeof G=="object")return G}catch{}return _&&typeof _.cineModuleBase=="object"?_.cineModuleBase:null}const n=r(t)||o(t);if(!n)return;const a=typeof n.freezeDeep=="function"?function(G){try{return n.freezeDeep(G)}catch{}return G}:function(G){return G},s=typeof n.safeWarn=="function"?function(G,O){try{n.safeWarn(G,O)}catch{}}:function(G,O){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof O>"u"?console.warn(G):console.warn(G,O)}catch{}},l=typeof n.informModuleGlobals=="function"?function(G,O){try{n.informModuleGlobals(G,O)}catch{}}:function(){},u=typeof n.registerOrQueueModule=="function"?function(G,O,B,$){try{n.registerOrQueueModule(G,O,B,$)}catch(V){if(typeof $=="function")try{$(V)}catch{}else s("cineSettingsAppearance: Unable to register module.",V)}}:function(){},d=typeof n.exposeGlobal=="function"?function(G,O,B){try{return n.exposeGlobal(G,O,t,B)}catch{return!1}}:function(G,O){if(!t||typeof t!="object")return!1;try{return t[G]=O,!0}catch{}return!1};function m(_){if(!_||typeof _!="object")return{};const G={},O=Object.keys(_);for(let B=0;B<O.length;B+=1){const $=O[B];G[$]=_[$]}return G}function y(){return{getDocument:()=>typeof document<"u"?document:null,getWindow:()=>typeof window<"u"?window:null,settings:{},elements:{},accent:{},icons:{},storage:{},preferences:{},autoBackups:{},mountVoltages:{},helpers:{}}}function h(_){if(!_)return null;if(typeof _.getDocument=="function")try{const G=_.getDocument();if(G&&typeof G=="object")return G}catch{}return _.document&&typeof _.document=="object"?_.document:typeof document<"u"&&document?document:null}function b(_){if(!_)return null;if(typeof _.getWindow=="function")try{const G=_.getWindow();if(G&&typeof G=="object")return G}catch{}return _.window&&typeof _.window=="object"?_.window:typeof window<"u"&&window?window:null}function v(_){const G=_.storage||{};if(G&&typeof G.getLocalStorage=="function")try{const O=G.getLocalStorage();if(O)return O}catch{}return G&&G.localStorage?G.localStorage:typeof localStorage<"u"?localStorage:null}function C(_,G,O){if(typeof _!="function")return O;try{return _.apply(null,Array.isArray(G)?G:[])}catch(B){return s("cineSettingsAppearance: helper invocation failed.",B),O}}function A(_){const G=m(y()),O=m(_),B=Object.keys(O);for(let Re=0;Re<B.length;Re+=1){const Ye=B[Re],ke=O[Ye];ke&&typeof ke=="object"&&!Array.isArray(ke)?G[Ye]=m(ke):G[Ye]=ke}const $=h(G),V=b(G),M=G.elements||{},F=G.settings||{},z=G.accent||{},x=G.icons||{},H=G.preferences||{},W=G.autoBackups||{},U=G.mountVoltages||{};G.helpers;const j=G.storage||{},Y=(function(){const Ye=Object.create(null);return{getItem(ke){return Object.prototype.hasOwnProperty.call(Ye,ke)?Ye[ke]:null},setItem(ke,ee){Ye[ke]=String(ee)},removeItem(ke){Object.prototype.hasOwnProperty.call(Ye,ke)&&delete Ye[ke]}}})();function le(){const Re=[];function Ye(ke,ee){if(!(!ee||typeof ee.getItem!="function")){for(let I=0;I<Re.length;I+=1)if(Re[I]&&Re[I].storage===ee)return;Re.push({name:ke,storage:ee})}}if(j&&typeof j.getSafeLocalStorage=="function")try{Ye("safeLocalStorage",j.getSafeLocalStorage())}catch(ke){s("cineSettingsAppearance: getSafeLocalStorage failed for theme preference.",ke)}if(j&&typeof j.resolveSafeLocalStorage=="function")try{Ye("resolvedSafeLocalStorage",j.resolveSafeLocalStorage())}catch(ke){s("cineSettingsAppearance: resolveSafeLocalStorage failed for theme preference.",ke)}if(j&&typeof j.getLocalStorage=="function")try{Ye("localStorage",j.getLocalStorage())}catch(ke){s("cineSettingsAppearance: getLocalStorage failed for theme preference.",ke)}return Ye("memoryStorage",Y),Re}function be(Re){const Ye=le(),ke=Re?"true":"false";for(let ee=0;ee<Ye.length;ee+=1){const I=Ye[ee];if(!(!I||!I.storage||typeof I.storage.setItem!="function"))try{I.storage.setItem("darkMode",ke)}catch(N){s("cineSettingsAppearance: Unable to persist theme preference.",{name:I.name,error:N})}}}function re(){const Re=le();for(let Ye=0;Ye<Re.length;Ye+=1){const ke=Re[Ye];if(!(!ke||!ke.storage||typeof ke.storage.getItem!="function"))try{const ee=ke.storage.getItem("darkMode");if(ee==="true"||ee==="false")return ee==="true"}catch(ee){s("cineSettingsAppearance: Unable to read theme preference.",{name:ke.name,error:ee})}}return null}let de=null,ne=0,Ce=0;const Ee=[];let Pe=null;const et=G.pinkModeIconAnimationResetDelay||400,Je=G.pinkModeIconAnimationClass||"pink-mode-icon-animate",it=G.pinkModeIconIntervalMs||1500,rt=typeof G.pinkModeIconPressResetMs=="number"&&G.pinkModeIconPressResetMs>=0?G.pinkModeIconPressResetMs:0,Pt=typeof G.pinkModeIconPressBurstWindowMs=="number"&&G.pinkModeIconPressBurstWindowMs>=0?G.pinkModeIconPressBurstWindowMs:1200;let vt=!1,bo=!1,Et="celsius",Ut="metric",ge=!1;const ue="cameraPowerPlanner_pinkMode",We="pinkMode";function Me(){return $&&$.documentElement?$.documentElement:null}function Te(){return $&&$.body?$.body:null}function Be(){return typeof z.getAccentColor=="function"?z.getAccentColor():z.accentColor||"#001589"}function Ve(Re){typeof z.setAccentColor=="function"?z.setAccentColor(Re):z.accentColor=Re}function je(){return typeof z.getPrevAccentColor=="function"?z.getPrevAccentColor():z.prevAccentColor||Be()}function mt(Re){typeof z.setPrevAccentColor=="function"?z.setPrevAccentColor(Re):z.prevAccentColor=Re}function ct(){return typeof z.getHighContrastAccentColor=="function"?z.getHighContrastAccentColor():z.highContrastAccentColor||"#ffffff"}function $t(){if(typeof z.isHighContrastActive=="function")try{return!!z.isHighContrastActive()}catch(Ye){s("cineSettingsAppearance: isHighContrastActive failed.",Ye)}const Re=Te();return!!(Re&&Re.classList&&Re.classList.contains("high-contrast"))}function fo(){if(typeof z.updateAccentColorResetButtonState=="function")try{z.updateAccentColorResetButtonState()}catch(Re){s("cineSettingsAppearance: updateAccentColorResetButtonState failed.",Re)}}function no(){if(typeof z.clearAccentColorOverrides=="function")try{z.clearAccentColorOverrides()}catch(Re){s("cineSettingsAppearance: clearAccentColorOverrides failed.",Re)}}function Nt(Re){if(typeof z.applyAccentColor=="function")try{z.applyAccentColor(Re)}catch(Ye){s("cineSettingsAppearance: applyAccentColor failed.",Ye)}}function xo(Re){if(typeof z.refreshDarkModeAccentBoost=="function")try{z.refreshDarkModeAccentBoost(Re)}catch(Ye){s("cineSettingsAppearance: refreshDarkModeAccentBoost failed.",Ye)}}function Io(Re){return typeof x.ensureSvgHasAriaHidden=="function"?x.ensureSvgHasAriaHidden(Re):Re}function qo(Re,Ye){if(typeof x.applyIconGlyph=="function")try{x.applyIconGlyph(Re,Ye)}catch(ke){s("cineSettingsAppearance: applyIconGlyph failed.",ke)}}function eo(Re){if(!Re)return null;if(typeof x.getIconGlyph=="function")try{return x.getIconGlyph(Re)}catch(ke){return s("cineSettingsAppearance: getIconGlyph failed.",ke),null}const Ye=x.registry&&typeof x.registry=="object"?x.registry:null;return Ye&&Ye[Re]?Ye[Re]:typeof t.ICON_GLYPHS=="object"&&t.ICON_GLYPHS&&t.ICON_GLYPHS[Re]||null}function To(Re){const Ye=$;if(!Ye||typeof Ye.querySelector!="function")return;const ke=Ye.querySelector('meta[name="theme-color"]');if(ke)try{ke.setAttribute("content",Re?"#1c1c1e":"#ffffff")}catch(ee){s("cineSettingsAppearance: unable to update theme-color meta tag.",ee)}}function ko(Re,Ye){if(!Re)return;let ke=Re.querySelector&&Re.querySelector(".icon-glyph");if(!ke&&$&&typeof $.createElement=="function"){ke=$.createElement("span"),ke.className="icon-glyph",ke.setAttribute("aria-hidden","true");try{Re.textContent="",Re.appendChild(ke)}catch(N){s("cineSettingsAppearance: unable to attach toggle icon.",N);return}}if(!ke)return;if(ke._lottieAnim){try{ke._lottieAnim.destroy()}catch{}ke._lottieAnim=null}const ee=Ye&&typeof Ye=="object"&&(Ye.markup||Ye.className||Ye.lottiePath)?Ye:{value:Ye},I=["icon-glyph"];if(ee.className&&I.push(ee.className),ke.className=I.join(" "),(ee.lottiePath||ee.lottieData)&&typeof x.ensurePinkModeLottieRuntime=="function"){const N=()=>{ke.classList.remove("pink-mode-icon-pop"),ke.offsetWidth,ke.classList.add("pink-mode-icon-pop");const K=Date.now()+Math.random();ke._lottieRequestId=K,x.ensurePinkModeLottieRuntime().then(oe=>{if(oe&&ke._lottieRequestId===K&&!(!ke||!document.body.contains(Re)))try{let ce=ke.querySelector(".lottie-container");ce?ce.innerHTML="":(ce=$.createElement("div"),ce.className="lottie-container",ce.style.width="100%",ce.style.height="100%",ce.style.display="flex",ce.style.justifyContent="center",ce.style.alignItems="center",ce.style.position="absolute",ce.style.top="0",ce.style.left="0",ce.style.zIndex="2",ke.appendChild(ce),ke.style.position="relative",getComputedStyle(ke).display==="inline"&&(ke.style.display="inline-block"));const me={container:ce,renderer:"svg",loop:!0,autoplay:!0};ee.lottieData?me.animationData=ee.lottieData:ee.lottiePath&&(me.path=ee.lottiePath);const De=oe.loadAnimation(me);ke._lottieAnim=De;const Ge=()=>{const Xe=ke.querySelector(".icon-fallback");Xe?(Xe.style.opacity="0",setTimeout(()=>{Xe.style.opacity==="0"&&(Xe.style.display="none",ce&&(ce.style.position="relative",ce.style.top="",ce.style.left=""))},200)):ce&&(ce.style.position="relative",ce.style.top="",ce.style.left="")};De.addEventListener("DOMLoaded",Ge);const Ue=()=>{ce&&ce.parentNode&&ce.parentNode.removeChild(ce);const Xe=ke.querySelector(".icon-fallback");Xe&&(Xe.style.display="",Xe.style.opacity="1")};De.addEventListener("data_failed",Ue),De.addEventListener("error",Ue)}catch{}}).catch(()=>{})};if(ee.markup){const K=Io(ee.markup);let oe=ke.querySelector(".icon-fallback");if(!oe){const ce=ke.querySelector("svg:not(.lottie-container svg)");ce&&(ce.classList.add("icon-fallback"),oe=ce)}if(oe){const ce=$.createElement("div");ce.innerHTML=K;const me=ce.firstElementChild;me&&(me.classList.add("icon-fallback"),me.style.transition="opacity 0.2s ease",oe.parentNode===ke&&ke.replaceChild(me,oe))}else{const ce=$.createElement("div");ce.innerHTML=K;const me=ce.firstElementChild;me&&(me.classList.add("icon-fallback"),me.style.transition="opacity 0.2s ease",me.style.position="relative",me.style.zIndex="1",ke.prepend(me))}}N()}else ee.markup?(ke.innerHTML=Io(ee.markup),ke.removeAttribute("data-icon-font"),ke.classList.remove("pink-mode-icon-pop"),ke.offsetWidth,ke.classList.add("pink-mode-icon-pop")):qo(ke,ee.value)}function Jt(Re){const Ye=Me(),ke=Te();if(!Ye||!ke)return;if(Re){if(ke.classList.add("dark-mode"),Ye.classList.add("dark-mode"),ke.classList.remove("light-mode"),Ye.classList.remove("light-mode"),M.darkModeToggle){const N=eo("sun");N&&ko(M.darkModeToggle,N),M.darkModeToggle.setAttribute("aria-pressed","true")}}else if(ke.classList.remove("dark-mode"),Ye.classList.remove("dark-mode"),ke.classList.add("light-mode"),Ye.classList.add("light-mode"),M.darkModeToggle){const N=eo("moon");N&&ko(M.darkModeToggle,N),M.darkModeToggle.setAttribute("aria-pressed","false")}const ee=$t(),I=ee?ct():Be();xo({color:I,highContrast:ee}),To(Re),F.darkMode&&(F.darkMode.checked=!!Re)}function lr(){if(!V||typeof V.matchMedia!="function")return null;try{return!!V.matchMedia("(prefers-color-scheme: dark)").matches}catch(Re){s("cineSettingsAppearance: matchMedia failed while detecting system theme preference.",Re)}return null}function pt(Re,Ye){if(Ye)return Ye;if(!Re||typeof Re.tagName!="string")return"button";const ke=Re.tagName.toLowerCase();return ke==="select"?"select":ke==="input"&&(typeof Re.getAttribute=="function"?(Re.getAttribute("type")||"").toLowerCase():"")==="checkbox"?"checkbox":"button"}function mo(Re,Ye,ke,ee){return typeof ke=="function"?ke:Ye==="select"?()=>!!(Re&&Re.value==="dark"):Ye==="checkbox"?()=>!!(Re&&Re.checked):()=>!ee()}function go(Re,Ye,ke){return typeof ke=="function"?ke:Ye==="select"?ee=>{if(!Re)return;const I=ee?"dark":"light";Re.value!==I&&(Re.value=I)}:Ye==="checkbox"?ee=>{Re&&(Re.checked=!!ee)}:ee=>{!Re||typeof Re.setAttribute!="function"||Re.setAttribute("aria-pressed",ee?"true":"false")}}function So(Re,Ye){if(Ye)return Ye;if(!Re||typeof Re.tagName!="string")return"button";const ke=Re.tagName.toLowerCase();return ke==="select"?"select":ke==="input"&&(typeof Re.getAttribute=="function"?(Re.getAttribute("type")||"").toLowerCase():"")==="checkbox"?"checkbox":"button"}function k(Re,Ye,ke,ee){return typeof ke=="function"?ke:Ye==="select"?()=>!!(Re&&Re.value==="enabled"):Ye==="checkbox"?()=>!!(Re&&Re.checked):()=>!ee()}function Q(Re,Ye,ke){return typeof ke=="function"?ke:Ye==="select"?ee=>{if(!Re)return;const I=ee?"enabled":"disabled";Re.value!==I&&(Re.value=I)}:Ye==="checkbox"?ee=>{if(!Re)return;const I=!!ee;Re.checked!==I&&(Re.checked=I)}:ee=>{!Re||typeof Re.setAttribute!="function"||Re.setAttribute("aria-pressed",ee?"true":"false")}}function X(){const Re=[];let Ye=!1,ke=Co();const ee=()=>ke;function I(me,De){const Ge=De&&typeof De=="object"?De:{},Ue=!!me,Xe=ke;ke=Ue,Ye=!0;try{for(let ft=0;ft<Re.length;ft+=1){const Le=Re[ft];if(!(!Le||Le===Ge.source||typeof Le.write!="function"))try{Le.write(Ue,{previous:Xe})}catch(ot){s("cineSettingsAppearance: Unable to sync pink mode control.",ot)}}try{Lr(Ue)}catch(ft){s("cineSettingsAppearance: applyPinkMode failed during update.",ft)}}finally{Ye=!1}if(Ge.source&&typeof Ge.source.write=="function")try{Ge.source.write(Ue,{previous:Xe})}catch(ft){s("cineSettingsAppearance: Unable to sync source pink mode control.",ft)}return Ge.persist!==!1&&hr(Ue),Xe!==Ue}function N(me,De){if(!me)return()=>{};const Ge=De&&typeof De=="object"?De:{},Ue=So(me,Ge.type),Xe=k(me,Ue,Ge.read,ee),ft=Q(me,Ue,Ge.write),Le=Ge.event||(Ue==="button"?"click":"change"),ot={element:me,type:Ue,read:Xe,write:ft,eventType:Le},_t=Lt=>{if(Ye)return;let Qt;try{Qt=ot.read(ke,Lt)}catch(Gt){s("cineSettingsAppearance: Unable to read pink mode control value.",Gt),Qt=ke}I(!!Qt,{source:ot})};typeof me.addEventListener=="function"&&me.addEventListener(Le,_t),ot.handler=_t,Re.push(ot);try{ot.write(ke)}catch(Lt){s("cineSettingsAppearance: Unable to apply pink mode preference to control during registration.",Lt)}return function(){for(let Qt=Re.length-1;Qt>=0;Qt-=1){const Gt=Re[Qt];if(!(!Gt||Gt.element!==me)){Re.splice(Qt,1),me&&typeof me.removeEventListener=="function"&&me.removeEventListener(Gt.eventType,Gt.handler);break}}}}function K(me,De){I(me,{persist:(De&&typeof De=="object"?De:{}).persist!==!1})}function oe(){return ke}function ce(me){const De=me&&typeof me=="object"?me:{};let Ge=null;try{const Ue=localStorage.getItem(ue)||localStorage.getItem(We);(Ue==="true"||Ue==="false")&&(Ge=Ue==="true")}catch{}return Ge===null?(De.persist!==!1&&hr(ke),ke):(I(Ge,{persist:De.persist!==!1}),Ge)}return{registerControl:N,setValue:K,getValue:oe,reloadFromStorage:ce,persist:hr}}function ae(Re){const Ye=Re&&typeof Re=="object"?Re:{},ke=[];let ee=!1,I=!1;const N=()=>I;function K(Xe,ft){const Le=ft&&typeof ft=="object"?ft:{},ot=!!Xe,_t=I;I=ot,ee=!0;try{for(let Lt=0;Lt<ke.length;Lt+=1){const Qt=ke[Lt];if(!(!Qt||Qt===Le.source||typeof Qt.write!="function"))try{Qt.write(ot,{previous:_t})}catch(Gt){s("cineSettingsAppearance: Unable to sync theme control.",Gt)}}try{Jt(ot)}catch(Lt){s("cineSettingsAppearance: applyDarkMode failed during theme update.",Lt)}}finally{ee=!1}if(Le.source&&typeof Le.source.write=="function")try{Le.source.write(ot,{previous:_t})}catch(Lt){s("cineSettingsAppearance: Unable to sync source theme control.",Lt)}return Le.persist!==!1&&be(ot),_t!==ot}function oe(Xe,ft){if(!Xe)return()=>{};const Le=ft&&typeof ft=="object"?ft:{},ot=pt(Xe,Le.type),_t=mo(Xe,ot,Le.read,N),Lt=go(Xe,ot,Le.write),Qt=Le.event||(ot==="button"?"click":"change"),Gt={element:Xe,type:ot,read:_t,write:Lt,eventType:Qt},ho=Qo=>{if(ee)return;let Xo;try{Xo=Gt.read(I,Qo)}catch(No){s("cineSettingsAppearance: Unable to read theme control value.",No),Xo=I}typeof Xo=="string"&&(Xo=Xo==="dark"),K(!!Xo,{source:Gt})};typeof Xe.addEventListener=="function"&&Xe.addEventListener(Qt,ho),Gt.handler=ho,ke.push(Gt);try{Gt.write(I)}catch(Qo){s("cineSettingsAppearance: Unable to apply theme preference to control during registration.",Qo)}return function(){for(let Xo=ke.length-1;Xo>=0;Xo-=1){const No=ke[Xo];if(!(!No||No.element!==Xe)){ke.splice(Xo,1),Xe&&typeof Xe.removeEventListener=="function"&&Xe.removeEventListener(No.eventType,No.handler);break}}}}function ce(Xe,ft){const Le=ft&&typeof ft=="object"?ft:{};K(Xe,{persist:Le.persist!==!1,source:Le.source||null})}function me(){return I}function De(Xe){const ft=Xe&&typeof Xe=="object"?Xe:{},Le=re();return Le===null?(ft.persist!==!1&&be(I),I):(K(Le,{persist:ft.persist!==!1}),Le)}const Ge=re();let Ue=typeof Ge=="boolean"?Ge:null;if(Ue===null){if(typeof Ye.detectSystemPreference=="function")try{const Xe=Ye.detectSystemPreference();typeof Xe=="boolean"&&(Ue=Xe)}catch(Xe){s("cineSettingsAppearance: detectSystemPreference option failed.",Xe)}if(Ue===null){const Xe=lr();typeof Xe=="boolean"&&(Ue=Xe)}}return Ue===null&&(Ue=!1),K(Ue,{persist:!0}),{registerControl:oe,setValue:ce,getValue:me,reloadFromStorage:De,persist:be}}function Ae(Re){const Ye=Me(),ke=Te();Ye&&(Re?(ke&&ke.classList.add("high-contrast"),Ye.classList.add("high-contrast"),Nt(Be()),ke&&ke.classList.contains("pink-mode")&&no()):(ke&&ke.classList.remove("high-contrast"),Ye.classList.remove("high-contrast"),ke&&ke.classList.contains("pink-mode")?no():Nt(Be())),F.highContrast&&(F.highContrast.checked=!!Re))}function Se(Re){const Ye=Me(),ke=Te();Ye&&Ye.classList.toggle("reduce-motion",!!Re),ke&&ke.classList.toggle("reduce-motion",!!Re),F.reduceMotion&&(F.reduceMotion.checked=!!Re),Re?Ot():Co()&&Ro()}function Oe(Re){const Ye=Me(),ke=Te();Ye&&Ye.classList.toggle("relaxed-spacing",!!Re),ke&&ke.classList.toggle("relaxed-spacing",!!Re),F.relaxedSpacing&&(F.relaxedSpacing.checked=!!Re)}function Ne(){if(de){try{clearInterval(de)}catch(Re){s("cineSettingsAppearance: unable to stop pink mode rotation.",Re)}de=null}}function Qe(Re,Ye){if(!Re)return;const ke=Ye&&Ye.animate===!0,ee=M.pinkModeToggle||null,I=M.pinkModeHelpIcon||null;ee&&ko(ee,Re),I&&(I.className="help-icon icon-glyph icon-svg pink-mode-icon",I.innerHTML=Re.markup||""),ke&&Fe()}function Fe(){const Re=[],Ye=M.pinkModeToggle||null;if(Ye){const ke=Ye.querySelector&&Ye.querySelector(".pink-mode-icon");ke&&Re.push(ke)}if(M.pinkModeHelpIcon&&Re.push(M.pinkModeHelpIcon),!!Re.length)for(let ke=0;ke<Re.length;ke+=1){const ee=Re[ke];try{ee.classList.remove(Je),typeof ee.getBoundingClientRect=="function"&&ee.getBoundingClientRect(),ee.classList.add(Je)}catch(I){s("cineSettingsAppearance: unable to animate pink mode icon.",I)}et>0&&setTimeout(()=>{try{ee.classList.remove(Je)}catch(I){s("cineSettingsAppearance: failed to reset pink mode animation.",I)}},et)}}function _e(){const ke='<svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="m1 40c0-8 3-17 3-17a4.84 4.84 0 0 0-1.829-3.064 1 1 0 0 1 .45-1.716 19.438 19.438 0 0 1 4.379-.22c.579-2.317-1.19-3.963-2.782-4.938a1 1 0 0 1 .393-1.85 14.128 14.128 0 0 1 6.389.788c0-.958-1.147-2.145-2.342-3.122a1 1 0 0 1 .708-1.773 40.655 40.655 0 0 1 6.634.895 3.723 3.723 0 0 0-1.049-2.264 1 1 0 0 1 .823-1.652c6.151.378 9.226 1.916 9.226 1.916l10-1s8.472-2.311 15.954.5a1 1 0 0 1-.084 1.9c-1.455.394-2.87 1.143-2.87 2.6 0 0 4.426.738 5.675 4.114a1 1 0 0 1-1.228 1.317c-1.64-.48-4.273-.88-6.447.569Z" fill="#805333" /><path d="m30.18 42.82c1.073 2.7 2.6 9.993 3.357 13.8a2 2 0 0 1-1.964 2.38h-28.573a2 2 0 0 1-2-2v-18c0-2.55 10.03-22.11 23.99-23.87Z" fill="#a56a43" /><path d="m55.67 48.46-6.34 2.97a6 6 0 0 1-7.98-2.88l-.25-.54-.76-1.6a4.956 4.956 0 0 0-4.68-2.87c-.22.01-.44.02-.66.02a16.019 16.019 0 0 1-8.28-29.66c-1.81-2.97-3.45-8.03 2.03-12.49a2.1 2.1 0 0 1 2.5 0c4.23 3.45 4.21 7.25 3.16 10.17a16 16 0 0 1 15.91 11.36l5.31 11.31 2.92 6.22a6.008 6.008 0 0 1-2.88 7.99Z" fill="#cb8252" /><circle cx="42" cy="26" r="3" fill="#2c2f38" /><circle cx="54" cy="43" r="1" fill="#805333" /><path d="m58.55 40.47-2.92-6.22-14.53 13.76.25.54a6 6 0 0 0 7.98 2.88l6.34-2.97a6.008 6.008 0 0 0 2.88-7.99Zm-4.55 3.53a1 1 0 1 1 1-1 1 1 0 0 1-1 1Z" fill="#cf976a" /><circle cx="41" cy="25" r="1.25" fill="#ecf0f1" /></svg>'.replace("</svg>",'<path d="m40 18 12-14-4 15.5z" filter="drop-shadow(0 0 2px #fff)" fill="#ffd700" />'+"</svg>"),ee=ke.replace(/#805333/g,"#d63384").replace(/#a56a43/g,"#e83e8c").replace(/#cb8252/g,"#fd7e14").replace(/#cf976a/g,"#ffc0cb"),I=ke.replace(/#805333/g,"#6f42c1").replace(/#a56a43/g,"#d63384").replace(/#cb8252/g,"#e83e8c").replace(/#cf976a/g,"#e0cffc"),N=ke.replace(/#805333/g,"#0dcaf0").replace(/#a56a43/g,"#6f42c1").replace(/#cb8252/g,"#d63384").replace(/#cf976a/g,"#9ec5fe"),oe=[{className:"icon-svg pink-mode-icon",markup:ee,lottiePath:"src/animations/unicorn.json"},{className:"icon-svg pink-mode-icon",markup:I,lottiePath:"src/animations/horn.json"},{className:"icon-svg pink-mode-icon",markup:N,lottiePath:"src/animations/rainbow.json"}];if(console.log("Pink Mode Rotation Start. Sequence Length:",oe?oe.length:"undefined"),!oe.length){Qe(x.pinkModeIcons?x.pinkModeIcons.off:null,{animate:!1});return}Ne();const ce=M.pinkModeToggle||null,me=M.pinkModeHelpIcon||null;if(!(!ce&&!me)){ne=0,Qe(oe[ne],{animate:!0});try{if(de=setInterval(()=>{ne=(ne+1)%oe.length,Qe(oe[ne],{animate:!0})},it),de&&typeof de.unref=="function")try{de.unref()}catch(De){}}catch(De){de&&clearInterval(de),de=null,s("cineSettingsAppearance: unable to schedule pink mode rotation.",De)}}}function He(){if(Pe){try{clearTimeout(Pe)}catch(Re){s("cineSettingsAppearance: unable to clear pink mode press reset timer.",Re)}Pe=null}}function st(){if(!(rt<=0)){He();try{Pe=setTimeout(()=>{Pe=null,Ce=0,Ee.length=0},rt),Pe&&typeof Pe.unref=="function"&&Pe.unref()}catch(Re){Pe=null,s("cineSettingsAppearance: unable to schedule pink mode press reset.",Re)}}}function at(){Ce=0,He(),Ee.length=0}function St(){const Re=Date.now();Ee.push(Re);const Ye=Math.max(Pt,0);if(Ye>0){const ke=Re-Ye;for(;Ee.length&&Ee[0]<ke;)Ee.shift()}return Ee.length}class kt{constructor(){this.active=!1}activate(){this.active=!0,document.body.classList.add("pink-mode-active")}deactivate(){this.active=!1,document.body.classList.remove("pink-mode-active")}triggerRain(){}}const Zt=new kt;function Ht(){}function jo(){Ce=St(),rt>0&&st(),!(Ce<3)&&rt<=0&&Ce>3&&(Ce=3)}function ir(){Zt.activate(),typeof x.startPinkModeAnimatedIcons=="function"&&x.startPinkModeAnimatedIcons()}function sr(){Zt.deactivate(),typeof x.stopPinkModeAnimatedIcons=="function"&&x.stopPinkModeAnimatedIcons()}function Ro(){_e(),ir()}function Ot(){sr(),Ne(),at()}function Lr(Re){const Ye=Me(),ke=Te();!Ye||!ke||(Re?(ke.classList.add("pink-mode"),Ye.classList.add("pink-mode"),z.accentColorInput&&(z.accentColorInput.disabled=!0),no(),M.pinkModeToggle&&M.pinkModeToggle.setAttribute("aria-pressed","true"),Ro()):(Ot(),ke.classList.remove("pink-mode"),Ye.classList.remove("pink-mode"),z.accentColorInput&&(z.accentColorInput.disabled=!1),Nt(Be()),x.pinkModeIcons&&x.pinkModeIcons.off&&Qe(x.pinkModeIcons.off,{animate:!1}),M.pinkModeToggle&&M.pinkModeToggle.setAttribute("aria-pressed","false")),F.pinkMode&&(F.pinkMode.checked=!!Re),fo())}function Co(){const Re=Te();return!!(Re&&Re.classList&&Re.classList.contains("pink-mode"))}function hr(Re){vt=!!Re,Lr(vt);const Ye=v(G);if(Ye){try{Ye.setItem(ue,vt)}catch(ke){s("cineSettingsAppearance: Could not save pink mode preference.",ke)}try{Ye.setItem(We,vt)}catch(ke){s("cineSettingsAppearance: Could not save pink mode preference.",ke)}}}function Wo(){bo=Co()}function Yo(){Co()!==bo&&hr(bo)}function Tt(){return typeof H.getTemperatureUnit=="function"?H.getTemperatureUnit():H.temperatureUnit||"celsius"}function $o(Re){typeof H.setTemperatureUnit=="function"?H.setTemperatureUnit(Re):H.temperatureUnit=Re}function br(){return typeof H.getFocusScale=="function"?H.getFocusScale():H.focusScale||"metric"}function Do(Re){typeof H.setFocusScale=="function"?H.setFocusScale(Re):H.focusScale=Re}function ur(){const Re=Tt();Et=typeof Re=="string"?Re:"celsius"}function or(){const Re=typeof Et=="string"?Et:"celsius",Ye=H.applyTemperatureUnitPreference;if(typeof Ye=="function")if(Tt()!==Re)try{Ye(Re,{persist:!1,forceUpdate:!0}),$o(Re)}catch(ke){s("cineSettingsAppearance: Failed to revert temperature unit preference.",ke)}else F.temperatureUnit&&(F.temperatureUnit.value=Re);else F.temperatureUnit&&(F.temperatureUnit.value=Re)}function Vo(){const Re=br();Ut=typeof Re=="string"?Re:"metric"}function Po(){const Re=typeof Ut=="string"?Ut:"metric",Ye=H.applyFocusScalePreference;if(typeof Ye=="function")if(br()!==Re)try{Ye(Re,{persist:!1,forceUpdate:!0}),Do(Re)}catch(ke){s("cineSettingsAppearance: Failed to revert focus scale preference.",ke)}else F.focusScale&&(F.focusScale.value=Re);else F.focusScale&&(F.focusScale.value=Re)}function co(){return typeof H.getShowAutoBackups=="function"?!!H.getShowAutoBackups():typeof H.showAutoBackups=="boolean"?H.showAutoBackups:!1}function mr(Re){typeof H.setShowAutoBackups=="function"?H.setShowAutoBackups(Re):H.showAutoBackups=!!Re}function Sr(Re,Ye){const ke=Ye&&typeof Ye=="object"?Ye:{},ee=ke.persist!==!1,I=!!ke.forceRepopulate,N=!!Re,K=co(),oe=N!==K;if(mr(N),N&&typeof H.ensureAutoBackupsFromProjects=="function"&&C(H.ensureAutoBackupsFromProjects),ee){const Ue=v(G);if(Ue)try{Ue.setItem("showAutoBackups",N)}catch(Xe){s("cineSettingsAppearance: Could not save auto backup visibility preference.",Xe)}}if(!oe&&!I){F.showAutoBackups&&(F.showAutoBackups.checked=N);return}const ce=W.setupSelect||null,me=W.setupNameInput||null,De=ce?ce.value:"",Ge=me?me.value:"";if(typeof W.populateSetupSelect=="function")try{W.populateSetupSelect()}catch(Ue){s("cineSettingsAppearance: Failed to refresh setup selector.",Ue)}if(ce)try{N||!De||!De.startsWith("auto-backup-")?ce.value=De:ce.value=""}catch(Ue){s("cineSettingsAppearance: Failed to update setup select after auto backup change.",Ue)}if(me)try{me.value=Ge}catch(Ue){s("cineSettingsAppearance: Unable to restore setup name after auto backup change.",Ue)}F.showAutoBackups&&(F.showAutoBackups.checked=N)}function jr(){ge=!!co()}function Qr(){const Re=!!ge;!!co()!==Re?Sr(Re,{forceRepopulate:!0}):F.showAutoBackups&&(F.showAutoBackups.checked=Re)}function an(){if(typeof U.rememberBaseline=="function"){try{U.rememberBaseline()}catch(Re){s("cineSettingsAppearance: rememberBaseline for mount voltages failed.",Re)}return}if(typeof U.getPreferencesClone=="function")try{U.settingsInitial=U.getPreferencesClone()}catch(Re){s("cineSettingsAppearance: Failed to clone mount voltage preferences.",Re)}}function Sn(){if(typeof U.revertBaseline=="function"){try{U.revertBaseline()}catch(me){s("cineSettingsAppearance: revertBaseline for mount voltages failed.",me)}return}const Re=U.getPreferencesClone,Ye=U.applyPreferences,ke=U.updateInputsFromState,ee=U.warnMissingHelper||(()=>{}),I=Array.isArray(U.supportedTypes)?U.supportedTypes:[],N=U.defaultVoltages&&typeof U.defaultVoltages=="object"?U.defaultVoltages:{};let K=U.settingsInitial;!K&&typeof Re=="function"&&(K=Re());let oe=K;if(typeof Re=="function")try{oe=Re()}catch(me){ee("getMountVoltagePreferencesClone",me)}if(I.some(me=>{const De=K&&K[me]?K[me]:N[me],Ge=oe&&oe[me]?oe[me]:N[me];return!De||!Ge?!1:Number(De.high)!==Number(Ge.high)||Number(De.low)!==Number(Ge.low)})){if(typeof Ye=="function")try{Ye(K,{persist:!0,triggerUpdate:!0})}catch(me){ee("applyMountVoltagePreferences",me)}}else if(typeof ke=="function")try{ke()}catch(me){ee("updateMountVoltageInputsFromState",me)}}return a({updateThemeColor:To,setToggleIcon:ko,applyDarkMode:Jt,applyHighContrast:Ae,applyReduceMotion:Se,applyRelaxedSpacing:Oe,applyPinkMode:Lr,persistPinkModePreference:hr,rememberSettingsPinkModeBaseline:Wo,revertSettingsPinkModeIfNeeded:Yo,rememberSettingsTemperatureUnitBaseline:ur,revertSettingsTemperatureUnitIfNeeded:or,rememberSettingsFocusScaleBaseline:Vo,revertSettingsFocusScaleIfNeeded:Po,applyShowAutoBackupsPreference:Sr,rememberSettingsShowAutoBackupsBaseline:jr,revertSettingsShowAutoBackupsIfNeeded:Qr,rememberSettingsMountVoltagesBaseline:an,revertSettingsMountVoltagesIfNeeded:Sn,handlePinkModeIconPress:jo,triggerPinkModeIconAnimation:Fe,triggerPinkModeIconRain:Ht,startPinkModeIconRotation:_e,stopPinkModeIconRotation:Ne,applyPinkModeIcon:Qe,startPinkModeAnimatedIcons:ir,stopPinkModeAnimatedIcons:sr,startPinkModeAnimatedIconRotation:Ro,stopPinkModeAnimatedIconRotation:Ot,isPinkModeActive:Co,createThemePreferenceController:ae,createPinkModePreferenceController:X,setAccentColor:Ve,setPrevAccentColor:mt,getAccentColor:Be,getPrevAccentColor:je,setShowAutoBackups:mr,getShowAutoBackups:co})}function w(_){return A(_||{})}const R=a({initialize:w});l("cineSettingsAppearance",R),u("cineSettingsAppearance",R,{category:"ui",description:"Appearance and settings helpers for the application UI.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineUi"]},_=>{s("cineSettingsAppearance: Unable to register module.",_)}),d("cineSettingsAppearance",R,{configurable:!0,enumerable:!1,writable:!1}),typeof module<"u"&&module&&module.exports&&(module.exports=R)})();function __cineIsArray(e){return typeof Array<"u"&&typeof Array.isArray=="function"?Array.isArray(e):Object.prototype.toString.call(e)==="[object Array]"}function __cineToComparableString(e){if(typeof e=="string")return e;if(e===null||typeof e>"u")return"";try{return String(e)}catch{return""}}function __cineFallbackLocaleSort(e,t){var o=__cineToComparableString(e),r=__cineToComparableString(t);try{if(typeof o.localeCompare=="function")return o.localeCompare(r,void 0,{sensitivity:"accent",numeric:!0})}catch{}return o<r?-1:o>r?1:0}function __cineToFiniteInteger(e){if(e===null||typeof e>"u")return null;var t=Number(e);if(!Number.isFinite(t))return null;var o=Math.round(t);return Number.isFinite(o)?o:null}function __cineResolveRetentionBounds(e){var t=__cineFallbackResolveAutoGearBackupRetentionMin(e),o=null,r=[];e&&Object.prototype.hasOwnProperty.call(e,"AUTO_GEAR_BACKUP_RETENTION_MAX")&&r.push(e.AUTO_GEAR_BACKUP_RETENTION_MAX),e&&Object.prototype.hasOwnProperty.call(e,"MAX_AUTO_BACKUPS")&&r.push(e.MAX_AUTO_BACKUPS),e&&e.__cineStorageApi&&Object.prototype.hasOwnProperty.call(e.__cineStorageApi,"AUTO_GEAR_BACKUP_RETENTION_MAX")&&r.push(e.__cineStorageApi.AUTO_GEAR_BACKUP_RETENTION_MAX);for(var n=0;n<r.length;n+=1){var a=__cineToFiniteInteger(r[n]);typeof a=="number"&&(a<t&&(a=t),(o===null||a>o)&&(o=a))}return o===null&&(o=Math.max(t,120)),{min:t,max:o}}function __cineFallbackResolveAutoGearBackupRetentionMin(e){var t=[];e&&Object.prototype.hasOwnProperty.call(e,"AUTO_GEAR_BACKUP_RETENTION_MIN")&&t.push(e.AUTO_GEAR_BACKUP_RETENTION_MIN),e&&e.__cineStorageApi&&Object.prototype.hasOwnProperty.call(e.__cineStorageApi,"AUTO_GEAR_BACKUP_RETENTION_MIN")&&t.push(e.__cineStorageApi.AUTO_GEAR_BACKUP_RETENTION_MIN);for(var o=0;o<t.length;o+=1){var r=__cineToFiniteInteger(t[o]);if(typeof r=="number"&&r>=1)return r<1?1:r}return 1}function __cineFallbackResolveAutoGearBackupRetentionDefault(e){var t=__cineResolveRetentionBounds(e),o=t.min,r=t.max,n=[];e&&typeof e.getAutoGearBackupRetentionDefault=="function"&&n.push(function(){return e.getAutoGearBackupRetentionDefault()}),e&&e.__cineStorageApi&&typeof e.__cineStorageApi.getAutoGearBackupRetentionDefault=="function"&&n.push(function(){return e.__cineStorageApi.getAutoGearBackupRetentionDefault()}),n.push(function(){return e&&Object.prototype.hasOwnProperty.call(e,"AUTO_GEAR_BACKUP_RETENTION_DEFAULT")?e.AUTO_GEAR_BACKUP_RETENTION_DEFAULT:null});for(var a=0;a<n.length;a+=1)try{var s=n[a](),l=__cineToFiniteInteger(s);if(typeof l=="number")return l<o?l=o:l>r&&(l=r),l}catch{}var u=__cineToFiniteInteger(36);return typeof u!="number"&&(u=o),u<o&&(u=o),u>r&&(u=r),u}(function(){var t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!t||typeof t!="object"&&typeof t!="function")return;function o(l,u){var d;try{d=t[l]}catch{d=void 0}typeof d!="string"&&(d=u);try{t[l]=d}catch{}return d}function r(l){var u;try{u=t[l]}catch{u=void 0}__cineIsArray(u)||(u=[]);try{t[l]=u}catch{}return u}function n(l,u){var d;try{d=t[l]}catch{d=void 0}typeof d!="function"&&(d=u);try{t[l]=d}catch{}return d}function a(l){var u;try{u=t[l]}catch{u=void 0}typeof u>"u"&&(u=null);try{t[l]=u}catch{}return u}function s(l){if(!l||typeof l!="object")return"";var u;try{u=Object.keys(l)}catch{return""}if(!u||!u.length)return"";var d=u[0],m=l[d],y=typeof d=="string"?d.replace(/_/g," "):"connector";return m?y+": "+m:y}o("autoGearAutoPresetId",""),r("baseAutoGearRules"),a("autoGearScenarioModeSelect"),a("autoGearRuleNameInput"),o("autoGearSummaryFocus","all"),r("autoGearMonitorDefaultControls"),a("iosPwaHelpDialog"),a("iosPwaHelpClose"),a("totalPowerElem"),n("safeGenerateConnectorSummary",s),a("CORE_RUNTIME_SHARED"),a("CORE_GLOBAL_SCOPE"),a("autoGearAddOwnGearSelect"),a("autoGearRemoveOwnGearSelect"),a("newSubcategorySelect"),n("syncAutoGearMonitorFieldVisibility",function(){}),o("currentLang","en"),n("localeSort",__cineFallbackLocaleSort),n("resolveAutoGearBackupRetentionMin",function(){var l=__cineFallbackResolveAutoGearBackupRetentionMin(t);if(t&&(typeof t.AUTO_GEAR_BACKUP_RETENTION_MIN!="number"||!Number.isFinite(t.AUTO_GEAR_BACKUP_RETENTION_MIN)))try{t.AUTO_GEAR_BACKUP_RETENTION_MIN=l}catch{}return l}),n("resolveAutoGearBackupRetentionDefault",function(){var l=__cineFallbackResolveAutoGearBackupRetentionDefault(t);if(t&&(typeof t.AUTO_GEAR_BACKUP_RETENTION_DEFAULT!="number"||!Number.isFinite(t.AUTO_GEAR_BACKUP_RETENTION_DEFAULT)))try{t.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=l}catch{}return l})})();function __cineResolveGlobalValue(e,t){var o=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!o||typeof o!="object"&&typeof o!="function")return t;var r;try{r=o[e]}catch{r=void 0}return typeof r>"u"?t:r}function __cineCommitGlobalValue(e,t){var o=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!o||typeof o!="object"&&typeof o!="function")return t;try{o[e]=t}catch{}return t}function __cineCommitGlobalNumericBinding(e,t){var o=t;try{var r=__cineResolveGlobalValue(e,t);typeof r=="number"&&Number.isFinite(r)&&(o=r)}catch{o=t}try{__cineCommitGlobalValue(e,o)}catch{}try{typeof Function=="function"&&Function("value","try { if (typeof "+e+" === 'undefined') { "+e+" = value; } } catch (e) { void e; } return value;")(o)}catch{}return o}var autoGearAutoPresetId=typeof autoGearAutoPresetId<"u"&&typeof autoGearAutoPresetId=="string"?autoGearAutoPresetId:(function(){var t=__cineResolveGlobalValue("autoGearAutoPresetId",""),o=typeof t=="string"?t:"";return __cineCommitGlobalValue("autoGearAutoPresetId",o)})(),baseAutoGearRules=typeof baseAutoGearRules<"u"&&__cineIsArray(baseAutoGearRules)?baseAutoGearRules:(function(){var t=__cineResolveGlobalValue("baseAutoGearRules",[]),o=__cineIsArray(t)?t:[];return __cineCommitGlobalValue("baseAutoGearRules",o)})(),autoGearScenarioModeSelect$1=typeof autoGearScenarioModeSelect$1<"u"&&(autoGearScenarioModeSelect$1===null||typeof autoGearScenarioModeSelect$1=="object")?autoGearScenarioModeSelect$1:(function(){var t=__cineResolveGlobalValue("autoGearScenarioModeSelect",null),o=typeof t>"u"||t===null||typeof t=="object"?t:null;return __cineCommitGlobalValue("autoGearScenarioModeSelect",o)})(),autoGearRuleNameInput$2=typeof autoGearRuleNameInput$2<"u"&&(autoGearRuleNameInput$2===null||typeof autoGearRuleNameInput$2=="object")?autoGearRuleNameInput$2:(function(){var t=__cineResolveGlobalValue("autoGearRuleNameInput",null),o=typeof t>"u"||t===null||typeof t=="object"?t:null;return __cineCommitGlobalValue("autoGearRuleNameInput",o)})(),autoGearSummaryFocus$1=typeof autoGearSummaryFocus$1<"u"&&typeof autoGearSummaryFocus$1=="string"?autoGearSummaryFocus$1:(function(){var t=__cineResolveGlobalValue("autoGearSummaryFocus","all"),o=typeof t=="string"?t:"all";return __cineCommitGlobalValue("autoGearSummaryFocus",o)})(),autoGearMonitorDefaultControls$1=typeof autoGearMonitorDefaultControls$1<"u"&&__cineIsArray(autoGearMonitorDefaultControls$1)?autoGearMonitorDefaultControls$1:(function(){var t=__cineResolveGlobalValue("autoGearMonitorDefaultControls",[]),o=__cineIsArray(t)?t:[];return __cineCommitGlobalValue("autoGearMonitorDefaultControls",o)})(),safeGenerateConnectorSummary=typeof safeGenerateConnectorSummary<"u"&&typeof safeGenerateConnectorSummary=="function"?safeGenerateConnectorSummary:(function(){var t=__cineResolveGlobalValue("safeGenerateConnectorSummary",null),o=typeof t=="function"?t:function(n){if(!n||typeof n!="object")return"";var a;try{a=Object.keys(n)}catch{return""}if(!a||!a.length)return"";var s=a[0],l=n[s],u=typeof s=="string"?s.replace(/_/g," "):"connector";return l?u+": "+l:u};return __cineCommitGlobalValue("safeGenerateConnectorSummary",o)})(),localeSort$1=typeof localeSort$1=="function"?localeSort$1:(function(){var t=null;if(typeof Intl<"u"&&Intl&&typeof Intl.Collator=="function")try{t=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0})}catch{t=null}var o=t?function(n,a){return t.compare(n==null?"":String(n),a==null?"":String(a))}:function(n,a){var s=n==null?"":String(n),l=a==null?"":String(a);return s===l?0:s<l?-1:1};return __cineCommitGlobalValue("localeSort",o)})(),resolveAutoGearBackupRetentionMin$1=typeof resolveAutoGearBackupRetentionMin$1=="function"?resolveAutoGearBackupRetentionMin$1:(function(){var t=1;function o(n){var a=Number(n);if(!Number.isFinite(a)||a<=0)return t;var s=Math.round(a);return s>0?s:t}function r(){var n=__cineResolveGlobalValue("AUTO_GEAR_BACKUP_RETENTION_MIN",void 0),a=o(n);return __cineCommitGlobalValue("AUTO_GEAR_BACKUP_RETENTION_MIN",a),a}return __cineCommitGlobalValue("resolveAutoGearBackupRetentionMin",r)})(),resolveAutoGearBackupRetentionDefault$1=typeof resolveAutoGearBackupRetentionDefault$1=="function"?resolveAutoGearBackupRetentionDefault$1:(function(){function t(r){var n=resolveAutoGearBackupRetentionMin$1(),a=__cineResolveGlobalValue("AUTO_GEAR_BACKUP_RETENTION_MAX",void 0),s=Number.isFinite(Number(a)),l=s?Math.max(Math.round(Number(a)),n):null,u=Number(r);if(!Number.isFinite(u))return n;var d=Math.round(u);return d<n?n:s&&l!==null&&d>l?l:d}function o(){var r=__cineResolveGlobalValue("AUTO_GEAR_BACKUP_RETENTION_DEFAULT",void 0),n=t(r);return __cineCommitGlobalValue("AUTO_GEAR_BACKUP_RETENTION_DEFAULT",n),n}return __cineCommitGlobalValue("resolveAutoGearBackupRetentionDefault",o)})(),CORE_RUNTIME_SHARED$3=typeof CORE_RUNTIME_SHARED$3<"u"?CORE_RUNTIME_SHARED$3:__cineCommitGlobalValue("CORE_RUNTIME_SHARED",null),CORE_GLOBAL_SCOPE$2=typeof CORE_GLOBAL_SCOPE$2<"u"?CORE_GLOBAL_SCOPE$2:__cineCommitGlobalValue("CORE_GLOBAL_SCOPE",null),autoGearAddOwnGearSelect$2=typeof autoGearAddOwnGearSelect$2<"u"?autoGearAddOwnGearSelect$2:__cineCommitGlobalValue("autoGearAddOwnGearSelect",null),autoGearRemoveOwnGearSelect$2=typeof autoGearRemoveOwnGearSelect$2<"u"?autoGearRemoveOwnGearSelect$2:__cineCommitGlobalValue("autoGearRemoveOwnGearSelect",null),currentLang$2=typeof currentLang$2<"u"&&typeof currentLang$2=="string"?currentLang$2:__cineCommitGlobalValue("currentLang","en"),getLanguageTexts$1=typeof getLanguageTexts$1=="function"?getLanguageTexts$1:(function(){function t(a){if(typeof a=="string"&&a)try{return a.trim().toLowerCase()}catch{}return""}function o(){var a=__cineResolveGlobalValue("DEFAULT_LANGUAGE",null);return typeof a=="string"&&a?a:"en"}function r(){var a=__cineResolveGlobalValue("texts",null);return a&&typeof a=="object"?a:{}}function n(a){var s=r();if(!s||typeof s!="object")return{};var l=t(a),u=o(),d=t(u);if(l&&Object.prototype.hasOwnProperty.call(s,l)){var m=s[l];if(m&&typeof m=="object")return m}if(l&&l.length>2){var y=l.slice(0,2);if(Object.prototype.hasOwnProperty.call(s,y)){var h=s[y];if(h&&typeof h=="object")return h}}if(d&&Object.prototype.hasOwnProperty.call(s,d)){var b=s[d];if(b&&typeof b=="object")return b}if(Object.prototype.hasOwnProperty.call(s,"en")){var v=s.en;if(v&&typeof v=="object")return v}var C=null;try{for(var A in s)if(Object.prototype.hasOwnProperty.call(s,A)){C=A;break}}catch{}if(C){var w=s[C];if(w&&typeof w=="object")return w}return{}}return __cineCommitGlobalValue("getLanguageTexts",n)})(),resolveTextEntry$2=typeof resolveTextEntry$2=="function"?resolveTextEntry$2:(function(){function t(r){if(typeof r=="string"){try{const n=r.trim();if(n)return n}catch{}return""}if(typeof r=="number"&&Number.isFinite(r))return String(r);if(Array.isArray(r)){const n=r.map(a=>typeof a=="string"?a.trim():typeof a=="number"&&Number.isFinite(a)?String(a):"").filter(Boolean);if(n.length)return n.join(", ")}return""}function o(r,n,a,s){const l=[];r&&typeof r=="object"&&l.push(r),n&&typeof n=="object"&&n!==r&&l.push(n);for(let u=0;u<l.length;u+=1){const d=l[u];if(!d||typeof d!="object")continue;let m;try{m=d[a]}catch{m=void 0}const y=t(m);if(y)return y}return typeof s=="string"?s:typeof s=="number"&&Number.isFinite(s)?String(s):""}return __cineCommitGlobalValue("resolveTextEntry",o)})(),TEMPERATURE_STORAGE_KEY$2=typeof TEMPERATURE_STORAGE_KEY$2=="string"&&TEMPERATURE_STORAGE_KEY$2?TEMPERATURE_STORAGE_KEY$2:__cineCommitGlobalValue("TEMPERATURE_STORAGE_KEY","cameraPowerPlanner_temperatureUnit"),resolveTemperatureStorageKey$1=typeof resolveTemperatureStorageKey$1=="function"?resolveTemperatureStorageKey$1:__cineCommitGlobalValue("resolveTemperatureStorageKey",function(){return TEMPERATURE_STORAGE_KEY$2});function __cineNormalizeTemperatureUnits(e){const t={};return e&&typeof e=="object"&&(typeof e.celsius=="string"&&e.celsius.trim()&&(t.celsius=e.celsius.trim().toLowerCase()),typeof e.fahrenheit=="string"&&e.fahrenheit.trim()&&(t.fahrenheit=e.fahrenheit.trim().toLowerCase())),t.celsius||(t.celsius="celsius"),t.fahrenheit||(t.fahrenheit="fahrenheit"),t}(function(){var t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,o=null;try{o=t&&typeof t.TEMPERATURE_UNITS=="object"?t.TEMPERATURE_UNITS:null}catch{o=null}var r=__cineNormalizeTemperatureUnits(o||{celsius:"celsius",fahrenheit:"fahrenheit"});try{__cineCommitGlobalValue("TEMPERATURE_UNITS",r)}catch{}try{typeof Function=="function"&&Function("value","try { TEMPERATURE_UNITS = value; } catch (error) { try { this.TEMPERATURE_UNITS = value; } catch (assignError) { void assignError; } } return (typeof TEMPERATURE_UNITS !== 'undefined' ? TEMPERATURE_UNITS : this && this.TEMPERATURE_UNITS);").call(t||null,r)}catch{}})();function __cineNormalizeTemperatureScenarios(e){if(!Array.isArray(e))return[];const t=[];for(let o=0;o<e.length;o+=1){const r=e[o];if(!r||typeof r!="object")continue;const n={};typeof r.id=="string"&&r.id.trim()&&(n.id=r.id.trim()),typeof r.key=="string"&&r.key.trim()&&(n.key=r.key.trim()),typeof r.label=="string"&&r.label.trim()&&(n.label=r.label.trim()),Object.keys(n).length&&t.push(n)}return t}(function(){var t=[];try{var o=__cineResolveGlobalValue("TEMPERATURE_SCENARIOS",[]);Array.isArray(o)&&(t=__cineNormalizeTemperatureScenarios(o))}catch{}try{__cineCommitGlobalValue("TEMPERATURE_SCENARIOS",t)}catch{}try{typeof Function=="function"&&Function("value","try { this.TEMPERATURE_SCENARIOS = value; } catch (assignError) { void assignError; } return this && this.TEMPERATURE_SCENARIOS;").call(typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,t)}catch{}})();__cineCommitGlobalNumericBinding("FEEDBACK_TEMPERATURE_MIN",-20);__cineCommitGlobalNumericBinding("FEEDBACK_TEMPERATURE_MAX_LIMIT",50);var FOCUS_SCALE_STORAGE_KEY$1=typeof FOCUS_SCALE_STORAGE_KEY$1=="string"&&FOCUS_SCALE_STORAGE_KEY$1?FOCUS_SCALE_STORAGE_KEY$1:__cineCommitGlobalValue("FOCUS_SCALE_STORAGE_KEY","cameraPowerPlanner_focusScale"),FOCUS_SCALE_VALUES=typeof FOCUS_SCALE_VALUES<"u"&&Array.isArray(FOCUS_SCALE_VALUES)?__cineCommitGlobalValue("FOCUS_SCALE_VALUES",FOCUS_SCALE_VALUES.slice()):__cineCommitGlobalValue("FOCUS_SCALE_VALUES",["metric","imperial"]),SUPPORTED_MOUNT_VOLTAGE_TYPES$2=typeof SUPPORTED_MOUNT_VOLTAGE_TYPES$2<"u"&&Array.isArray(SUPPORTED_MOUNT_VOLTAGE_TYPES$2)?__cineCommitGlobalValue("SUPPORTED_MOUNT_VOLTAGE_TYPES",SUPPORTED_MOUNT_VOLTAGE_TYPES$2.slice()):__cineCommitGlobalValue("SUPPORTED_MOUNT_VOLTAGE_TYPES",["V-Mount","Gold-Mount","B-Mount"]);function __cineNormalizeMountVoltageDefaults(e){const t={},o=Array.isArray(SUPPORTED_MOUNT_VOLTAGE_TYPES$2)?SUPPORTED_MOUNT_VOLTAGE_TYPES$2:["V-Mount","Gold-Mount","B-Mount"];for(let r=0;r<o.length;r+=1){const n=o[r],a=e&&e[n]?e[n]:null,s=a&&typeof a.high=="number"&&Number.isFinite(a.high)?a.high:n==="B-Mount"?33.6:14.4,l=a&&typeof a.low=="number"&&Number.isFinite(a.low)?a.low:n==="B-Mount"?21.6:12;t[n]={high:s,low:l}}return t}var DEFAULT_MOUNT_VOLTAGES$2=typeof DEFAULT_MOUNT_VOLTAGES$2<"u"&&DEFAULT_MOUNT_VOLTAGES$2&&typeof DEFAULT_MOUNT_VOLTAGES$2=="object"?__cineCommitGlobalValue("DEFAULT_MOUNT_VOLTAGES",__cineNormalizeMountVoltageDefaults(DEFAULT_MOUNT_VOLTAGES$2)):__cineCommitGlobalValue("DEFAULT_MOUNT_VOLTAGES",__cineNormalizeMountVoltageDefaults({})),MOUNT_VOLTAGE_RUNTIME_EXPORTS$1=typeof MOUNT_VOLTAGE_RUNTIME_EXPORTS$1<"u"&&MOUNT_VOLTAGE_RUNTIME_EXPORTS$1&&typeof MOUNT_VOLTAGE_RUNTIME_EXPORTS$1=="object"?__cineCommitGlobalValue("MOUNT_VOLTAGE_RUNTIME_EXPORTS",MOUNT_VOLTAGE_RUNTIME_EXPORTS$1):__cineCommitGlobalValue("MOUNT_VOLTAGE_RUNTIME_EXPORTS",{});(function(){var t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!t||typeof t!="object"&&typeof t!="function")return;var o="cameraPowerPlanner_mountVoltages",r="__cineMountVoltageSessionState",n="__cineMountVoltageSyncTimer";function a(){var x=null;try{x=t.MOUNT_VOLTAGE_RUNTIME_EXPORTS}catch{x=null}return x&&typeof x=="object"?x:null}function s(x){var H=a();return H&&typeof H[x]=="function"?H[x]:null}function l(x,H){if(typeof H=="function"&&typeof t[x]!="function"){try{t[x]=H;return}catch{}try{Object.defineProperty(t,x,{configurable:!0,writable:!0,value:H})}catch{}}}function u(){var x;try{x=t.SUPPORTED_MOUNT_VOLTAGE_TYPES}catch{x=null}return Array.isArray(x)&&x.length?x.slice():["V-Mount","Gold-Mount","B-Mount"]}function d(){var x;try{x=t.DEFAULT_MOUNT_VOLTAGES}catch{x=null}if(x&&typeof x=="object")return x;for(var H={},W=u(),U=0;U<W.length;U+=1){var j=W[U];j==="B-Mount"?H[j]={high:33.6,low:21.6}:H[j]={high:14.4,low:12}}return H}function m(x){if(!Number.isFinite(x))return 0;var H=Math.min(1e3,Math.max(.1,x));return Math.round(H*100)/100}function y(x,H){if(typeof x=="number")return m(x);if(typeof x=="string"){var W=x.replace(",","."),U=Number.parseFloat(W);if(Number.isFinite(U))return m(U)}if(typeof H=="number")return m(H);if(typeof H=="string"){var j=Number.parseFloat(H.replace(",","."));if(Number.isFinite(j))return m(j)}return 0}function h(x){for(var H=d(),W=u(),U={},j=0;j<W.length;j+=1){var Y=W[j],le=x&&x[Y]?x[Y]:H[Y],be=H[Y]||{high:0,low:0};U[Y]={high:y(le&&le.high,be.high),low:y(le&&le.low,be.low)}}return U}function b(x){return h(!x||typeof x!="object"?null:x)}function v(){var x="",H="";try{x=typeof t.getMountVoltageStorageKeyName=="function"&&t.getMountVoltageStorageKeyName()||typeof t.MOUNT_VOLTAGE_STORAGE_KEY=="string"&&t.MOUNT_VOLTAGE_STORAGE_KEY||typeof t.MOUNT_VOLTAGE_STORAGE_KEY_RESOLVED=="string"&&t.MOUNT_VOLTAGE_STORAGE_KEY_RESOLVED||o}catch{x=o}try{H=typeof t.getMountVoltageStorageBackupKeyName=="function"&&t.getMountVoltageStorageBackupKeyName()||typeof t.MOUNT_VOLTAGE_STORAGE_BACKUP_KEY=="string"&&t.MOUNT_VOLTAGE_STORAGE_BACKUP_KEY||typeof t.MOUNT_VOLTAGE_STORAGE_BACKUP_KEY_RESOLVED=="string"&&t.MOUNT_VOLTAGE_STORAGE_BACKUP_KEY_RESOLVED||(x?x+"__backup":o+"__backup")}catch{H=x?x+"__backup":o+"__backup"}return x||(x=o),H||(H=x+"__backup"),{primary:x,backup:H}}function C(x){var H=null;try{H=t.localStorage}catch{H=null}if(!H||typeof H.setItem!="function")return!1;var W;try{W=JSON.stringify(x)}catch(j){return t.console&&typeof t.console.warn=="function"&&t.console.warn("Mount voltage fallback: unable to serialize preferences.",j),!1}var U=v();try{H.setItem(U.primary,W)}catch(j){t.console&&typeof t.console.warn=="function"&&t.console.warn("Mount voltage fallback: unable to persist primary preferences.",j)}try{H.setItem(U.backup,W)}catch(j){t.console&&typeof t.console.warn=="function"&&t.console.warn("Mount voltage fallback: unable to persist backup preferences.",j)}return!0}function A(x){if(!x)return null;try{if(typeof x=="string"){var H=JSON.parse(x);return b(H)}if(typeof x=="object")return b(x)}catch(W){t.console&&typeof t.console.warn=="function"&&t.console.warn("Mount voltage fallback: unable to parse stored voltages.",W)}return null}function w(){var x=null;try{x=t[r]}catch{x=null}!x||typeof x!="object"?x={preferences:h(null),pendingPersist:!1,pendingUpdate:!1}:!x.preferences||typeof x.preferences!="object"?x.preferences=h(null):x.preferences=h(x.preferences);try{t[r]=x}catch{}return x}var R=w();function _(){if(!(!R.pendingPersist&&!R.pendingUpdate)){var x=null;try{x=t.setTimeout}catch{x=null}if(typeof x!="function")try{x=setTimeout}catch{x=null}if(typeof x=="function"){var H=null;try{H=t[n]}catch{H=null}if(!H){var W=function(){try{t[n]=null}catch{}var j=a(),Y=j&&typeof j.applyMountVoltagePreferences=="function"?j.applyMountVoltagePreferences:null,le=j&&typeof j.cloneMountVoltageMap=="function"?j.cloneMountVoltageMap:null;if(!Y||!le){_();return}var be=R.preferences;try{be=le(R.preferences)}catch{}try{Y(be,{persist:R.pendingPersist,triggerUpdate:R.pendingUpdate}),R.pendingPersist=!1,R.pendingUpdate=!1}catch(re){t.console&&typeof t.console.warn=="function"&&t.console.warn("Mount voltage fallback: runtime sync failed.",re),_()}},U=x(W,50);try{t[n]=U}catch{}}}}}function G(x,H){var W=function(){var U=s(x);if(U){try{t[x]===W&&(t[x]=U)}catch{}var j=a()||t;try{return U.apply(j,arguments)}catch(Y){t.console&&typeof t.console.warn=="function"&&t.console.warn("Mount voltage delegate: runtime helper invocation failed.",Y)}}return H.apply(this,arguments)};return W}var O=function(x){var H=s("cloneMountVoltageMap");return H?H(x):h(x)},B=function(){var x=s("getMountVoltagePreferencesClone");if(x)return x();var H=h(R.preferences);return R.preferences=h(H),h(H)},$=function(x,H){var W=s("applyMountVoltagePreferences");if(W)return W(x,H);var U=b(x);R.preferences=h(U);var j=!H||H.persist!==!1,Y=!H||H.triggerUpdate!==!1;return j&&(C(R.preferences),R.pendingPersist=!0),Y&&(R.pendingUpdate=!0),_(),U},V=function(x){var H=s("parseStoredMountVoltages");return H?H(x):A(x)},M=function(x){return $(d(),x)},F=function(){var x=s("updateMountVoltageInputsFromState");if(x)return x();R.pendingUpdate=!0,_()},z=function(x){var H=s("persistMountVoltagePreferences");if(H)return H(x);var W=b(x);return R.preferences=h(W),R.pendingPersist=!0,_(),C(R.preferences)};if(l("parseVoltageValue",G("parseVoltageValue",y)),l("cloneMountVoltageMap",G("cloneMountVoltageMap",O)),l("getMountVoltagePreferencesClone",G("getMountVoltagePreferencesClone",B)),l("applyMountVoltagePreferences",G("applyMountVoltagePreferences",$)),l("parseStoredMountVoltages",G("parseStoredMountVoltages",V)),l("resetMountVoltagePreferences",G("resetMountVoltagePreferences",M)),l("updateMountVoltageInputsFromState",G("updateMountVoltageInputsFromState",F)),l("persistMountVoltagePreferences",G("persistMountVoltagePreferences",z)),typeof t.mountVoltageInputs>"u")try{t.mountVoltageInputs=null}catch{}})();var syncMountVoltageResetButtonGlobal$2=typeof syncMountVoltageResetButtonGlobal$2=="function"?syncMountVoltageResetButtonGlobal$2:(function(){function t(){for(var n=[__cineResolveGlobalValue("CORE_GLOBAL_SCOPE",null),typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null],a=0;a<n.length;a+=1){var s=n[a];if(s&&(typeof s=="object"||typeof s=="function"))return s}return null}function o(n,a){if(n){var s=n.cineCoreMountVoltage;if(s&&typeof s.syncMountVoltageResetButtonGlobal=="function")try{s.syncMountVoltageResetButtonGlobal(a);return}catch{}try{n.mountVoltageResetButton=a}catch{}}}function r(n){var a=t();return o(a,n),n}return __cineCommitGlobalValue("syncMountVoltageResetButtonGlobal",r)})(),totalPowerElem$1=typeof totalPowerElem$1<"u"&&(totalPowerElem$1===null||typeof totalPowerElem$1=="object")?totalPowerElem$1:(function(){var t=__cineResolveGlobalValue("totalPowerElem",null),o=typeof t>"u"||t===null||typeof t=="object"?t:null;return __cineCommitGlobalValue("totalPowerElem",o)})();function getGlobalScopeCandidates(){const e=[];return typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&e.push(CORE_GLOBAL_SCOPE),typeof globalThis<"u"&&globalThis&&e.push(globalThis),typeof window<"u"&&window&&e.push(window),typeof self<"u"&&self&&e.push(self),typeof global<"u"&&global&&e.push(global),e}function getPrimaryGlobalScope(){const e=getGlobalScopeCandidates();for(let t=0;t<e.length;t+=1){const o=e[t];if(o&&typeof o=="object")return o}return null}function fallbackResolveRuntimeModuleLoader$1(){const e=getPrimaryGlobalScope();return e&&typeof e.cineCoreRuntimeModuleLoader=="object"&&e.cineCoreRuntimeModuleLoader?e.cineCoreRuntimeModuleLoader:typeof cineCoreRuntimeModuleLoader<"u"&&cineCoreRuntimeModuleLoader&&typeof cineCoreRuntimeModuleLoader=="object"?cineCoreRuntimeModuleLoader:null}function fallbackRequireCoreRuntimeModule$1(e,t){const o=fallbackResolveRuntimeModuleLoader$1();if(o&&typeof o.resolveCoreRuntimeModule=="function")try{return o.resolveCoreRuntimeModule(e,t)}catch{}return null}function exposeCoreRuntimeConstant$2(e,t){if(typeof e!="string"||!e)return;const o=getPrimaryGlobalScope();if(!o||typeof o!="object")return;let r=null;try{r=Object.getOwnPropertyDescriptor(o,e)}catch{r=null}if(!(r&&r.configurable===!1&&r.writable===!1)){try{o[e]=t;return}catch{}try{Object.defineProperty(o,e,{configurable:!0,writable:!0,value:t})}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Unable to expose ${e} globally`,n)}}}function exposeCoreRuntimeConstants$1(e){!e||typeof e!="object"||Object.keys(e).forEach(t=>{exposeCoreRuntimeConstant$2(t,e[t])})}const CORE_BOOT_QUEUE_KEY$1=(function(t){const o="__coreRuntimeBootQueue",r=t&&typeof t=="object"?t:getPrimaryGlobalScope();if(r){const n=r.__cineCoreBootQueueKey,a=r.CORE_BOOT_QUEUE_KEY;if(typeof a=="string"&&a){try{r.__cineCoreBootQueueKey=a}catch{r.__cineCoreBootQueueKey=a}return a}if(typeof n=="string"&&n){if(typeof r.CORE_BOOT_QUEUE_KEY!="string"||!r.CORE_BOOT_QUEUE_KEY)try{r.CORE_BOOT_QUEUE_KEY=n}catch{r.CORE_BOOT_QUEUE_KEY=n}return n}}if(r){try{r.__cineCoreBootQueueKey=o}catch{r.__cineCoreBootQueueKey=o}try{r.CORE_BOOT_QUEUE_KEY=o}catch{r.CORE_BOOT_QUEUE_KEY=o}}return o})(typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null),CORE_BOOT_QUEUE$1=(function(t){if(Array.isArray(t))return t;const o=typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:getPrimaryGlobalScope();if(o&&typeof o=="object"){const r=o.cineCoreShared;if(r&&typeof r=="object"){const n=r[CORE_BOOT_QUEUE_KEY$1];if(Array.isArray(n))return n;if(Object.isExtensible(r))return r[CORE_BOOT_QUEUE_KEY$1]=[],r[CORE_BOOT_QUEUE_KEY$1]}return Array.isArray(o.CORE_BOOT_QUEUE)||(o.CORE_BOOT_QUEUE=[]),o.CORE_BOOT_QUEUE}return[]})(typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE.CORE_BOOT_QUEUE:null);typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE&&CORE_GLOBAL_SCOPE.CORE_BOOT_QUEUE!==CORE_BOOT_QUEUE$1&&(CORE_GLOBAL_SCOPE.CORE_BOOT_QUEUE=CORE_BOOT_QUEUE$1);function enqueueCoreBootTask$3(e){if(typeof e=="function")try{CORE_BOOT_QUEUE$1.push(e)}catch{try{e()}catch(o){console.error("Failed to run fallback core boot task",o)}}}function processCoreBootQueue(){const e=CORE_BOOT_QUEUE$1;if(console.log("[Runtime Bootstrap] Processing boot queue. Length:",Array.isArray(e)?e.length:"invalid"),!Array.isArray(e))return;const t=e.splice(0,e.length);console.log("[Runtime Bootstrap] Snapshot size:",t.length);for(let o=0;o<t.length;o+=1){const r=t[o];if(typeof r=="function")try{r()}catch(n){console.error("Failed to process core boot task",n)}}console.log("[Runtime Bootstrap] Queue processing complete.")}const GRID_SNAP_STATE_STORAGE_KEY="__cineGridSnapState";function getGridSnapStateScopes(){const e=[],t=typeof CORE_RUNTIME_STATE<"u"&&CORE_RUNTIME_STATE&&typeof CORE_RUNTIME_STATE=="object"?CORE_RUNTIME_STATE:null;if(t&&typeof t.getScopes=="function")try{const r=t.getScopes();if(Array.isArray(r))for(let n=0;n<r.length;n+=1){const a=r[n];a&&e.indexOf(a)===-1&&e.push(a)}}catch{}const o=getGlobalScopeCandidates();for(let r=0;r<o.length;r+=1){const n=o[r];n&&e.indexOf(n)===-1&&e.push(n)}return e}function normaliseGridSnapPreference(e,t=!1){if(e===!0||e===!1)return e===!0;if(typeof e=="string"){const o=e.trim().toLowerCase();return o?["true","1","yes","on","enabled","enable"].includes(o)?!0:["false","0","no","off","disabled","disable"].includes(o)?!1:t:t}if(typeof e=="number")return Number.isFinite(e)?e>0:t;if(e&&typeof e=="object"){if(Object.prototype.hasOwnProperty.call(e,"enabled"))return normaliseGridSnapPreference(e.enabled,t);if(Object.prototype.hasOwnProperty.call(e,"value"))return normaliseGridSnapPreference(e.value,t)}return t}function readInitialGridSnapPreference(){const e=getGridSnapStateScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object")){try{if(Object.prototype.hasOwnProperty.call(o,GRID_SNAP_STATE_STORAGE_KEY)){const r=o[GRID_SNAP_STATE_STORAGE_KEY],n=normaliseGridSnapPreference(r,void 0);if(typeof n=="boolean")return n}}catch{}try{if(Object.prototype.hasOwnProperty.call(o,"gridSnap")){const r=o.gridSnap,n=normaliseGridSnapPreference(r,void 0);if(typeof n=="boolean")return n}}catch{}}}}let gridSnapState=normaliseGridSnapPreference(readInitialGridSnapPreference(),!1);function assignGridSnapToScope(e,t){if(!(!e||typeof e!="object")){try{e[GRID_SNAP_STATE_STORAGE_KEY]=t}catch{try{Object.defineProperty(e,GRID_SNAP_STATE_STORAGE_KEY,{configurable:!0,writable:!0,value:t})}catch{}}try{e.gridSnap=t}catch{try{Object.defineProperty(e,"gridSnap",{configurable:!0,writable:!0,value:t})}catch{}}}}function syncGridSnapStateToScopes(e,t=null,o={}){const r=getGridSnapStateScopes(),n=o&&o.persist!==!1;for(let s=0;s<r.length;s+=1){const l=r[s];if(!(!l||typeof l!="object")){if(n!==!1)try{l[GRID_SNAP_STATE_STORAGE_KEY]=e}catch{try{Object.defineProperty(l,GRID_SNAP_STATE_STORAGE_KEY,{configurable:!0,writable:!0,value:e})}catch{}}if(t!==l)try{l.gridSnap=e}catch{try{Object.defineProperty(l,"gridSnap",{configurable:!0,writable:!0,value:e})}catch{}}}}const a=getPrimaryGlobalScope();return a&&typeof a=="object"&&n!==!1&&assignGridSnapToScope(a,e),e}function getGridSnapState$2(){return gridSnapState}function setGridSnapState$1(e){const t=normaliseGridSnapPreference(e,gridSnapState);return gridSnapState=t,syncGridSnapStateToScopes(t),gridSnapState}function applyLegacyGridSnapValue$2(e){const t=normaliseGridSnapPreference(e,gridSnapState);return gridSnapState=t,syncGridSnapStateToScopes(t,null,{persist:!1}),gridSnapState}syncGridSnapStateToScopes(gridSnapState);function publishRuntimeBootstrapExports(e){if(!e||typeof e!="object")return;const t=getPrimaryGlobalScope();if(!t||typeof t!="object")return;const o=t.cineRuntimeBootstrapExports;if(o&&typeof o=="object"){Object.keys(e).forEach(r=>{o[r]=e[r]});return}try{t.cineRuntimeBootstrapExports=e}catch{}}const runtimeBootstrapExports$1={fallbackResolveRuntimeModuleLoader:fallbackResolveRuntimeModuleLoader$1,fallbackRequireCoreRuntimeModule:fallbackRequireCoreRuntimeModule$1,exposeCoreRuntimeConstant:exposeCoreRuntimeConstant$2,exposeCoreRuntimeConstants:exposeCoreRuntimeConstants$1,CORE_BOOT_QUEUE_KEY:CORE_BOOT_QUEUE_KEY$1,CORE_BOOT_QUEUE:CORE_BOOT_QUEUE$1,enqueueCoreBootTask:enqueueCoreBootTask$3,processCoreBootQueue,GRID_SNAP_STATE_STORAGE_KEY,getGridSnapStateScopes,normaliseGridSnapPreference,readInitialGridSnapPreference,syncGridSnapStateToScopes,getGridSnapState:getGridSnapState$2,setGridSnapState:setGridSnapState$1,applyLegacyGridSnapValue:applyLegacyGridSnapValue$2};if(typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE)CORE_GLOBAL_SCOPE.fallbackRequireCoreRuntimeModule||(CORE_GLOBAL_SCOPE.fallbackRequireCoreRuntimeModule=fallbackRequireCoreRuntimeModule$1),CORE_GLOBAL_SCOPE.exposeCoreRuntimeConstant||(CORE_GLOBAL_SCOPE.exposeCoreRuntimeConstant=exposeCoreRuntimeConstant$2);else{const e=getPrimaryGlobalScope();e&&(e.fallbackRequireCoreRuntimeModule||(e.fallbackRequireCoreRuntimeModule=fallbackRequireCoreRuntimeModule$1),e.exposeCoreRuntimeConstant||(e.exposeCoreRuntimeConstant=exposeCoreRuntimeConstant$2))}typeof window<"u"&&(window.processCoreBootQueue=processCoreBootQueue);if(typeof module<"u"&&module)try{module.exports=runtimeBootstrapExports$1}catch{}else if(typeof exports<"u"&&exports)try{exports.runtimeBootstrapExports=runtimeBootstrapExports$1}catch{}publishRuntimeBootstrapExports(runtimeBootstrapExports$1);const _resolveCoreSupportModule=typeof resolveCoreSupportModule$1=="function"?resolveCoreSupportModule$1:()=>null,_CORE_RUNTIME_SHARED=typeof CORE_RUNTIME_SHARED<"u"?CORE_RUNTIME_SHARED:null,_CORE_ENVIRONMENT_HELPERS=typeof CORE_ENVIRONMENT_HELPERS<"u"?CORE_ENVIRONMENT_HELPERS:null,CORE_RUNTIME_CANDIDATE_SCOPE_BRIDGE=_resolveCoreSupportModule("cineCoreRuntimeCandidateScopes","./modules/core/runtime-candidate-scopes.js"),CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT_TOOLS=_resolveCoreSupportModule("cineCoreAppRuntimeCandidateScopeSupport","./modules/app-core/runtime.js"),resolveRuntimeCandidateScopeSupport=(CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT_TOOLS&&typeof CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT_TOOLS.resolveRuntimeCandidateScopeSupport=="function"?CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT_TOOLS.resolveRuntimeCandidateScopeSupport:null)||(function(){const t=[typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r!="object"))try{const n=r.cineCoreAppRuntimeCandidateScopeSupport;if(n&&typeof n.resolveRuntimeCandidateScopeSupport=="function")return n.resolveRuntimeCandidateScopeSupport}catch{}}return null})(),createFallbackRuntimeCandidateScopeSupport=(CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT_TOOLS&&typeof CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT_TOOLS.createFallbackRuntimeCandidateScopeSupport=="function"?CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT_TOOLS.createFallbackRuntimeCandidateScopeSupport:null)||(function(){const t=[typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r!="object"))try{const n=r.cineCoreAppRuntimeCandidateScopeSupport;if(n&&typeof n.createFallbackRuntimeCandidateScopeSupport=="function")return n.createFallbackRuntimeCandidateScopeSupport}catch{}}return null})(),RUNTIME_CANDIDATE_SCOPE_FALLBACK_TOOLS=_resolveCoreSupportModule("cineCoreAppRuntimeCandidateScopeFallback","./modules/app-core/runtime.js"),createRuntimeCandidateScopeSupportFallback=RUNTIME_CANDIDATE_SCOPE_FALLBACK_TOOLS&&typeof RUNTIME_CANDIDATE_SCOPE_FALLBACK_TOOLS.createRuntimeCandidateScopeSupportFallback=="function"?RUNTIME_CANDIDATE_SCOPE_FALLBACK_TOOLS.createRuntimeCandidateScopeSupportFallback:(function(){return function(o){const r={collectCandidateScopes(){return[]},collectCandidateScopesWithFallback(){return[]},resolveCandidateScopes(n){return(n&&Array.isArray(n.currentCandidateScopes)?n.currentCandidateScopes:null)||[]},syncCandidateScopes(n,a){const s=Array.isArray(n)?n:[],l=a&&typeof a.assignCurrentCandidateScopes=="function"?a.assignCurrentCandidateScopes:o&&typeof o.assignCurrentCandidateScopes=="function"?o.assignCurrentCandidateScopes:null;if(l)try{l(s)}catch{}return s},ensureCandidateScopes(n){const a=n||{},s=r.resolveCandidateScopes(a);return r.syncCandidateScopes(s,a)}};return r}})(),FALLBACK_RUNTIME_CANDIDATE_SCOPE_SUPPORT=typeof createFallbackRuntimeCandidateScopeSupport=="function"?createFallbackRuntimeCandidateScopeSupport({runtimeShared:_CORE_RUNTIME_SHARED,environmentHelpers:_CORE_ENVIRONMENT_HELPERS}):createRuntimeCandidateScopeSupportFallback({runtimeShared:_CORE_RUNTIME_SHARED,environmentHelpers:_CORE_ENVIRONMENT_HELPERS,candidateScopeBridge:CORE_RUNTIME_CANDIDATE_SCOPE_BRIDGE,corePartRuntimeScope:typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,coreGlobalScope:typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,assignCurrentCandidateScopes(e){try{CORE_RUNTIME_CANDIDATE_SCOPES=e}catch{}}}),CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT=(typeof resolveRuntimeCandidateScopeSupport=="function"?resolveRuntimeCandidateScopeSupport({resolveCoreSupportModule:_resolveCoreSupportModule,requireFn:typeof require=="function"?require:null,runtimeScope:typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,coreGlobalScope:typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,runtimeShared:_CORE_RUNTIME_SHARED,environmentHelpers:_CORE_ENVIRONMENT_HELPERS}):null)||FALLBACK_RUNTIME_CANDIDATE_SCOPE_SUPPORT,RUNTIME_CANDIDATE_SCOPE_RESOLVER_TOOLS=_resolveCoreSupportModule("cineCoreAppRuntimeCandidateScopeResolvers","./modules/app-core/runtime.js"),createRuntimeCandidateScopeResolvers=RUNTIME_CANDIDATE_SCOPE_RESOLVER_TOOLS&&typeof RUNTIME_CANDIDATE_SCOPE_RESOLVER_TOOLS.createRuntimeCandidateScopeResolvers=="function"?RUNTIME_CANDIDATE_SCOPE_RESOLVER_TOOLS.createRuntimeCandidateScopeResolvers:(function(){return null})();function createInlineRuntimeCandidateScopeResolvers(e){const t=e&&e.runtimeCandidateScopeSupport?e.runtimeCandidateScopeSupport:null,o=e&&e.fallbackRuntimeCandidateScopeSupport?e.fallbackRuntimeCandidateScopeSupport:null;function r(l,u){if(!l||typeof l.collectCandidateScopes!="function")return null;try{const d=l.collectCandidateScopes(u);return Array.isArray(d)?d:null}catch{}return null}function n(l,u){if(!l||typeof l.ensureCandidateScopes!="function")return null;try{const d=l.ensureCandidateScopes(u);return Array.isArray(d)?d:null}catch{}return null}function a(l){const u=r(t,l);if(u)return u;const d=r(o,l);return d||[]}function s(l){const u=l&&typeof l=="object"?l:{},d=n(t,u);if(d&&d.length)return d;const m=n(o,u);return m&&m.length?m:a(u.primaryScope)}return{collectCoreRuntimeCandidateScopes:a,ensureCoreRuntimeCandidateScopes:s}}const runtimeCandidateScopeResolvers=(typeof createRuntimeCandidateScopeResolvers=="function"?createRuntimeCandidateScopeResolvers({runtimeCandidateScopeSupport:CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT,fallbackRuntimeCandidateScopeSupport:FALLBACK_RUNTIME_CANDIDATE_SCOPE_SUPPORT}):null)||createInlineRuntimeCandidateScopeResolvers({runtimeCandidateScopeSupport:CORE_RUNTIME_CANDIDATE_SCOPE_SUPPORT,fallbackRuntimeCandidateScopeSupport:FALLBACK_RUNTIME_CANDIDATE_SCOPE_SUPPORT}),COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE=typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE||typeof globalThis<"u"&&typeof globalThis=="object"&&globalThis||typeof window<"u"&&typeof window=="object"&&window||typeof self<"u"&&typeof self=="object"&&self||typeof global<"u"&&typeof global=="object"&&global||null,collectRuntimeCandidateScopesFromResolvers=runtimeCandidateScopeResolvers&&typeof runtimeCandidateScopeResolvers.collectCoreRuntimeCandidateScopes=="function"?runtimeCandidateScopeResolvers.collectCoreRuntimeCandidateScopes:inlineCollectCoreRuntimeCandidateScopes,collectRuntimeCandidateScopesFromGlobal=COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE&&typeof COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE.collectCoreRuntimeCandidateScopes=="function"?COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE.collectCoreRuntimeCandidateScopes:null,resolvedCollectCoreRuntimeCandidateScopes$1=collectRuntimeCandidateScopesFromGlobal||collectRuntimeCandidateScopesFromResolvers;COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE&&typeof COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE.collectCoreRuntimeCandidateScopes!="function"&&(COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE.collectCoreRuntimeCandidateScopes=resolvedCollectCoreRuntimeCandidateScopes$1);COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE&&(COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE.resolvedCollectCoreRuntimeCandidateScopes=resolvedCollectCoreRuntimeCandidateScopes$1);const CORE_RUNTIME_CANDIDATE_SCOPES_RESOLVED=(function(){const t=typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,o=runtimeCandidateScopeResolvers&&typeof runtimeCandidateScopeResolvers.ensureCoreRuntimeCandidateScopes=="function"?runtimeCandidateScopeResolvers.ensureCoreRuntimeCandidateScopes:null,r={primaryScope:t,currentCandidateScopes:typeof CORE_RUNTIME_CANDIDATE_SCOPES<"u"&&CORE_RUNTIME_CANDIDATE_SCOPES&&typeof CORE_RUNTIME_CANDIDATE_SCOPES.length=="number"?CORE_RUNTIME_CANDIDATE_SCOPES:null,globalScope:typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,assignCurrentCandidateScopes(n){try{CORE_RUNTIME_CANDIDATE_SCOPES=n}catch{}}};if(typeof o=="function")try{const n=o(r);if(Array.isArray(n))return n}catch{}return resolvedCollectCoreRuntimeCandidateScopes$1(t)})();COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE&&(COLLECT_RUNTIME_CANDIDATE_SCOPES_GLOBAL_SCOPE.CORE_RUNTIME_CANDIDATE_SCOPES_RESOLVED=CORE_RUNTIME_CANDIDATE_SCOPES_RESOLVED,typeof window<"u"&&(window.CORE_RUNTIME_CANDIDATE_SCOPES_RESOLVED=CORE_RUNTIME_CANDIDATE_SCOPES_RESOLVED));const FALLBACK_HUMANIZE_OVERRIDES={powerDrawWatts:"Power (W)",capacity:"Capacity (Wh)",pinA:"Pin A",dtapA:"D-Tap A",mount_type:"Mount",screenSizeInches:"Screen Size (in)",brightnessNits:"Brightness (nits)",torqueNm:"Torque (Nm)",internalController:"Internal Controller",powerSource:"Power Source",batteryType:"Battery Type",connectivity:"Connectivity"};function fallbackStableStringify(e){if(e===null)return"null";if(typeof e>"u")return"undefined";if(Array.isArray(e)){let t="[";for(let o=0;o<e.length;o+=1)o>0&&(t+=","),t+=fallbackStableStringify(e[o]);return t+="]",t}if(typeof e=="object"&&e){const t=Object.keys(e).sort();let o="{";for(let r=0;r<t.length;r+=1){const n=t[r];r>0&&(o+=","),o+=`${JSON.stringify(n)}:${fallbackStableStringify(e[n])}`}return o+="}",o}return JSON.stringify(e)}function fallbackHumanizeKey(e){return e&&Object.prototype.hasOwnProperty.call(FALLBACK_HUMANIZE_OVERRIDES,e)?FALLBACK_HUMANIZE_OVERRIDES[e]:(typeof e=="string"?e:String(e||"")).replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,o=>o.toUpperCase())}function createArrayFromCandidates(e,t,o){const r=[];e&&(typeof e=="object"||typeof e=="function")&&r.push(e),t&&(typeof t=="object"||typeof t=="function")&&r.push(t),o&&(typeof o=="object"||typeof o=="function")&&r.push(o),r.push(typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null);const n=[];for(let a=0;a<r.length;a+=1){const s=r[a];if(!s||typeof s!="object"&&typeof s!="function")continue;let l=!1;for(let u=0;u<n.length;u+=1)if(n[u]===s){l=!0;break}l||n.push(s)}return n}function createDefaultLanguageTexts(e){return e&&typeof e=="object"&&e.texts&&typeof e.texts=="object"&&e.texts.en&&typeof e.texts.en=="object"?e.texts.en:{}}function fallbackNormalizeAutoGearWeightOperator(e){if(typeof e!="string")return"greater";const t=e.trim().toLowerCase();return!t||t===">"||t==="gt"||t==="greaterthan"||t==="above"||t==="over"?"greater":t==="<"||t==="lt"||t==="lessthan"||t==="below"||t==="under"?"less":t==="="||t==="=="||t==="equal"||t==="equals"||t==="exactly"||t==="match"||t==="matches"?"equal":"greater"}function fallbackNormalizeAutoGearWeightValue(e){if(typeof e=="number"&&Number.isFinite(e)){const t=Math.round(e);return t>=0?t:null}if(typeof e=="string"){const t=e.trim();if(!t)return null;const o=t.replace(/[^0-9.,-]/g,"").replace(/,/g,".");if(!o)return null;const r=Number.parseFloat(o);if(!Number.isFinite(r))return null;const n=Math.round(r);return n>=0?n:null}return null}function fallbackFormatAutoGearWeight(e){if(!Number.isFinite(e))return"";try{if(typeof Intl<"u"&&typeof Intl.NumberFormat=="function")return new Intl.NumberFormat().format(e)}catch{}return String(e)}function createFallbackGetAutoGearCameraWeightOperatorLabel(e,t){return function(r,n){const a=n||{},s=t(),l=e(r);return l==="less"?a.autoGearCameraWeightOperatorLess||s.autoGearCameraWeightOperatorLess||"Lighter than":l==="equal"?a.autoGearCameraWeightOperatorEqual||s.autoGearCameraWeightOperatorEqual||"Exactly":a.autoGearCameraWeightOperatorGreater||s.autoGearCameraWeightOperatorGreater||"Heavier than"}}function createFallbackFormatAutoGearCameraWeight(e,t){return function(r,n){if(!r||!Number.isFinite(r.value))return"";const a=t(r.operator,n),s=e(r.value);return a?`${a} ${s} g`:`${s} g`}}function fallbackCreateRuntimeScopeCandidates(e,t,o){return typeof collectRuntimeScopeCandidates=="function"?collectRuntimeScopeCandidates([e,t,o]):createArrayFromCandidates(e,t,o)}function fallbackReadCoreScopeValue(e,t){if(!(typeof e!="string"||!e)&&!(!Array.isArray(t)||t.length===0))for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r!="object"&&typeof r!="function"))try{if(e in r){const n=r[e];if(typeof n<"u")return n}}catch{}}}function fallbackWriteCoreScopeValue(e,t,o){if(typeof e!="string"||!e||!Array.isArray(o)||o.length===0)return!1;for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function")){try{return n[e]=t,!0}catch{}try{return Object.defineProperty(n,e,{configurable:!0,writable:!0,value:t}),!0}catch{}}}return!1}function fallbackDeclareCoreFallbackBinding(e,t,o){const r=fallbackReadCoreScopeValue(e,o);if(typeof r<"u")return r;const n=typeof t=="function"?t():t;return fallbackWriteCoreScopeValue(e,n,o),n}function resolveAutoGearWeightHelpers(e){const t=e||{},o=t.coreShared&&typeof t.coreShared=="object"?t.coreShared:null,r=t.globalScope&&typeof t.globalScope=="object"?t.globalScope:null,n=function(){return createDefaultLanguageTexts(r||(typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null))},a=o&&typeof o.normalizeAutoGearWeightOperator=="function"?function(v){try{return o.normalizeAutoGearWeightOperator(v)||fallbackNormalizeAutoGearWeightOperator(v)}catch{}return fallbackNormalizeAutoGearWeightOperator(v)}:fallbackNormalizeAutoGearWeightOperator,s=o&&typeof o.normalizeAutoGearWeightValue=="function"?function(v){try{const C=o.normalizeAutoGearWeightValue(v);if(typeof C=="number"||C===null)return C}catch{}return fallbackNormalizeAutoGearWeightValue(v)}:fallbackNormalizeAutoGearWeightValue,l=o&&typeof o.normalizeAutoGearCameraWeightCondition=="function"?function(v){try{return o.normalizeAutoGearCameraWeightCondition(v)||null}catch{}return null}:function(){return null},u=o&&typeof o.formatAutoGearWeight=="function"?function(v){try{const C=o.formatAutoGearWeight(v);if(typeof C=="string")return C}catch{}return fallbackFormatAutoGearWeight(v)}:fallbackFormatAutoGearWeight,d=createFallbackGetAutoGearCameraWeightOperatorLabel(a,n),m=o&&typeof o.getAutoGearCameraWeightOperatorLabel=="function"?function(v,C){try{const A=o.getAutoGearCameraWeightOperatorLabel(v,C);if(typeof A=="string"&&A)return A}catch{}return d(v,C)}:d,y=createFallbackFormatAutoGearCameraWeight(u,m),h=o&&typeof o.formatAutoGearCameraWeight=="function"?function(v,C){try{const A=o.formatAutoGearCameraWeight(v,C);if(typeof A=="string")return A}catch{}return y(v,C)}:y;return{normalizeAutoGearWeightOperator:a,normalizeAutoGearWeightValue:s,normalizeAutoGearCameraWeightCondition:l,formatAutoGearWeight:u,getAutoGearCameraWeightOperatorLabel:m,formatAutoGearCameraWeight:h,fallbackGetAutoGearCameraWeightOperatorLabel:d,fallbackFormatAutoGearCameraWeight:y,fallbackNormalizeAutoGearCameraWeightCondition:function(v){return null}}}function resolveRuntimeScopeTools(e){const t=e||{},o=typeof t.runtimeScope<"u"?t.runtimeScope:typeof CORE_PART2_RUNTIME_SCOPE<"u"?CORE_PART2_RUNTIME_SCOPE:null,r=typeof t.sharedScope<"u"?t.sharedScope:typeof CORE_SHARED_SCOPE_PART2<"u"?CORE_SHARED_SCOPE_PART2:null,n=typeof t.globalScope<"u"?t.globalScope:typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null;let a=fallbackCreateRuntimeScopeCandidates(o,r,n);const s=typeof t.resolveSupportModule=="function"?t.resolveSupportModule:typeof resolveCoreSupportModule=="function"?resolveCoreSupportModule:null;let l=null;if(s)try{const y=s("cineCoreAppRuntimeScopeBridge","./modules/app-core/runtime.js");y&&typeof y=="object"&&typeof y.createRuntimeScopeBridge=="function"&&(l=y.createRuntimeScopeBridge({primaryScope:o,additionalScopes:[r,n]}))}catch{}l&&typeof l=="object"&&Array.isArray(l.candidates)&&l.candidates.length>0&&(a=l.candidates);function u(y){return fallbackReadCoreScopeValue(y,a)}function d(y,h){return fallbackWriteCoreScopeValue(y,h,a)}function m(y,h){return fallbackDeclareCoreFallbackBinding(y,h,a)}return{runtimeScopeBridge:l,runtimeScopeCandidates:a,readCoreScopeValue:l&&typeof l.readValue=="function"?l.readValue:u,writeCoreScopeValue:l&&typeof l.writeValue=="function"?l.writeValue:d,declareCoreFallbackBinding:l&&typeof l.declareFallbackBinding=="function"?l.declareFallbackBinding:m,fallbackReadCoreScopeValue:u,fallbackWriteCoreScopeValue:d,fallbackDeclareCoreFallbackBinding:m}}var CORE_PART2_RUNTIME_HELPERS$1=(function(){let t=null;if(typeof resolveCoreSupportModule=="function")try{const o=resolveCoreSupportModule("cineCorePart2RuntimeHelpers","./modules/app-core/runtime.js");o&&typeof o=="object"&&(t=o)}catch{}return t&&typeof t=="object"?t:{resolveAutoGearWeightHelpers,resolveRuntimeScopeTools,fallbackStableStringify,fallbackHumanizeKey,fallbackNormalizeAutoGearWeightOperator,fallbackNormalizeAutoGearWeightValue,fallbackFormatAutoGearWeight,fallbackNormalizeAutoGearCameraWeightCondition:function(r){return null},fallbackGetAutoGearCameraWeightOperatorLabel:createFallbackGetAutoGearCameraWeightOperatorLabel(fallbackNormalizeAutoGearWeightOperator,function(){return createDefaultLanguageTexts(typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null)}),fallbackFormatAutoGearCameraWeight:createFallbackFormatAutoGearCameraWeight(fallbackFormatAutoGearWeight,createFallbackGetAutoGearCameraWeightOperatorLabel(fallbackNormalizeAutoGearWeightOperator,function(){return createDefaultLanguageTexts(typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null)})),fallbackCreateRuntimeScopeCandidates,fallbackReadCoreScopeValue,fallbackWriteCoreScopeValue,fallbackDeclareCoreFallbackBinding}})();(function(t){if(!t||typeof t!="object")return;const o=createArrayFromCandidates(typeof CORE_PART2_RUNTIME_SCOPE<"u"?CORE_PART2_RUNTIME_SCOPE:null,typeof CORE_SHARED_SCOPE_PART2<"u"?CORE_SHARED_SCOPE_PART2:null,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null);for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function"))try{const a=n.cineCorePart2RuntimeHelpers;if(a&&typeof a=="object"){if(typeof Object.assign=="function")Object.assign(a,t);else for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(a[s]=t[s]);continue}n.cineCorePart2RuntimeHelpers=t}catch{}}})(CORE_PART2_RUNTIME_HELPERS$1);(function(t){if(!t||typeof t!="object")return;const o=createArrayFromCandidates(typeof CORE_PART2_RUNTIME_SCOPE<"u"?CORE_PART2_RUNTIME_SCOPE:null,typeof CORE_SHARED_SCOPE_PART2<"u"?CORE_SHARED_SCOPE_PART2:null,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null);for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function"))try{if(n.cineCoreShared&&typeof n.cineCoreShared=="object"){const a=n.cineCoreShared.cineCoreRuntimeHelpers;if(!a||typeof a!="object")n.cineCoreShared.cineCoreRuntimeHelpers=t;else if(typeof Object.assign=="function")Object.assign(a,t);else for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(a[s]=t[s])}}catch{}}})(CORE_PART2_RUNTIME_HELPERS$1);function resolveRuntimeModuleLoader(){return typeof cineCoreRuntimeModuleLoader<"u"&&cineCoreRuntimeModuleLoader&&typeof cineCoreRuntimeModuleLoader=="object"?cineCoreRuntimeModuleLoader:typeof globalThis<"u"&&globalThis&&typeof globalThis.cineCoreRuntimeModuleLoader=="object"?globalThis.cineCoreRuntimeModuleLoader:typeof window<"u"&&window&&typeof window.cineCoreRuntimeModuleLoader=="object"?window.cineCoreRuntimeModuleLoader:typeof self<"u"&&self&&typeof self.cineCoreRuntimeModuleLoader=="object"?self.cineCoreRuntimeModuleLoader:typeof global<"u"&&global&&typeof global.cineCoreRuntimeModuleLoader=="object"?global.cineCoreRuntimeModuleLoader:null}function requireCoreRuntimeModule(e,t){const o=resolveRuntimeModuleLoader();if(o&&typeof o.resolveCoreRuntimeModule=="function")try{return o.resolveCoreRuntimeModule(e,t)}catch{}return null}(function(){const t=[typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null];let o=null;for(let n=0;n<t.length;n+=1){const a=t[n];if(a)try{if(a.ICON_GLYPHS&&typeof a.ICON_GLYPHS=="object"){o=a.ICON_GLYPHS;break}}catch{}}o||(o={});for(let n=0;n<t.length;n+=1){const a=t[n];if(a)try{typeof a.ICON_GLYPHS>"u"&&(a.ICON_GLYPHS=o)}catch{}}let r=!1;try{r=typeof ICON_GLYPHS<"u"}catch{r=!1}if(!r)try{ICON_GLYPHS=o}catch{}})();var CORE_ENVIRONMENT_HELPERS$1=(function(){var t=null;if(typeof resolveCoreSupportModule$1=="function"&&(t=resolveCoreSupportModule$1("cineRuntimeEnvironmentHelpers","./modules/runtime-environment-helpers.js")),t)return t;for(var o=[typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null],r=0;r<o.length;r+=1){var n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function"))try{var a=n.cineRuntimeEnvironmentHelpers;if(a&&typeof a=="object"){t=a;break}}catch{}}return t})(),CORE_RUNTIME_SHARED$2=typeof CORE_RUNTIME_SHARED$2<"u"&&CORE_RUNTIME_SHARED$2?CORE_RUNTIME_SHARED$2:(function(){var t=null;if(typeof resolveCoreSupportModule$1=="function"&&(t=resolveCoreSupportModule$1("cineCoreRuntimeShared","./modules/core/runtime-shared.js")),!t){var o=null;o&&typeof o=="object"&&(t=o)}if(t)return t;for(var r=[typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null],n=0;n<r.length;n+=1){var a=r[n];if(!(!a||typeof a!="object"))try{var s=a.cineCoreRuntimeShared;if(s&&typeof s=="object")return s}catch{}}return null})();function collectEnvironmentRuntimeCandidateScopes(e){if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.collectCandidateScopes=="function")try{var t=CORE_RUNTIME_SHARED$2.collectCandidateScopes(e,CORE_ENVIRONMENT_HELPERS$1);if(Array.isArray(t))return t}catch{}var o=[];function r(l){!l||typeof l!="object"&&typeof l!="function"||o.indexOf(l)===-1&&o.push(l)}if(CORE_ENVIRONMENT_HELPERS$1&&typeof CORE_ENVIRONMENT_HELPERS$1.fallbackCollectCandidateScopes=="function")try{var n=CORE_ENVIRONMENT_HELPERS$1.fallbackCollectCandidateScopes(e);if(Array.isArray(n))for(var a=0;a<n.length;a+=1)r(n[a])}catch{}r(e),r(typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null),r(typeof window<"u"&&typeof window=="object"?window:null),r(typeof self<"u"&&typeof self=="object"?self:null),r(typeof global<"u"&&typeof global=="object"?global:null);var s=null;if(CORE_ENVIRONMENT_HELPERS$1&&typeof CORE_ENVIRONMENT_HELPERS$1.fallbackDetectGlobalScope=="function")try{s=CORE_ENVIRONMENT_HELPERS$1.fallbackDetectGlobalScope()}catch{s=null}else typeof globalThis<"u"&&typeof globalThis=="object"?s=globalThis:typeof window<"u"&&typeof window=="object"?s=window:typeof self<"u"&&typeof self=="object"?s=self:typeof global<"u"&&typeof global=="object"&&(s=global);return r(s),o}var CORE_RUNTIME_CANDIDATE_SCOPES$1=(function(){if(typeof CORE_RUNTIME_CANDIDATE_SCOPES$1<"u"&&CORE_RUNTIME_CANDIDATE_SCOPES$1&&typeof CORE_RUNTIME_CANDIDATE_SCOPES$1.length=="number")return CORE_RUNTIME_CANDIDATE_SCOPES$1;var t=null;if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.resolveCandidateScopes=="function")try{t=CORE_RUNTIME_SHARED$2.resolveCandidateScopes(typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,CORE_ENVIRONMENT_HELPERS$1)}catch{t=null}if(t||(t=collectEnvironmentRuntimeCandidateScopes(typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null)),CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.syncCandidateScopes=="function")try{CORE_RUNTIME_SHARED$2.syncCandidateScopes(t,typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,CORE_ENVIRONMENT_HELPERS$1)}catch{}else{var o=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(o&&(!o.CORE_RUNTIME_CANDIDATE_SCOPES||o.CORE_RUNTIME_CANDIDATE_SCOPES!==t))try{o.CORE_RUNTIME_CANDIDATE_SCOPES=t}catch{}}return t})(),CORE_RUNTIME_STATE_SUPPORT_PART2=(function(){function t(){var u=[];if(typeof globalThis<"u"&&u.push(globalThis),typeof window<"u"&&u.push(window),typeof self<"u"&&u.push(self),typeof global<"u"&&u.push(global),Array.isArray(CORE_RUNTIME_CANDIDATE_SCOPES$1))for(var d=0;d<CORE_RUNTIME_CANDIDATE_SCOPES$1.length;d+=1)u.push(CORE_RUNTIME_CANDIDATE_SCOPES$1[d]);for(var m=0;m<u.length;m+=1){var y=u[m];if(!(!y||typeof y!="object"))try{if(y.CORE_RUNTIME_STATE_SUPPORT)return y.CORE_RUNTIME_STATE_SUPPORT;if(y.cineCoreRuntimeState)return y.cineCoreRuntimeState}catch{}}return null}var o=t();if(o)return o;var r=null;if(typeof resolveCoreSupportModule$1=="function"&&(r=resolveCoreSupportModule$1("cineCoreRuntimeState","./modules/core/runtime-state.js")),!r){var n=requireCoreRuntimeModule("modules/core/runtime-state.js");n&&typeof n=="object"&&(r=n)}if(r){if(!t()&&typeof globalThis<"u")try{globalThis.CORE_RUNTIME_STATE_SUPPORT=r}catch{}return r}for(var a=0;a<CORE_RUNTIME_CANDIDATE_SCOPES$1.length;a+=1){var s=CORE_RUNTIME_CANDIDATE_SCOPES$1[a];if(!(!s||typeof s!="object"))try{var l=s.cineCoreRuntimeState;if(l&&typeof l=="object"){if(!t()&&typeof globalThis<"u")try{globalThis.CORE_RUNTIME_STATE_SUPPORT=l}catch(u){}return l}}catch{}}return null})(),CORE_TEMPERATURE_KEY_DEFAULTS=(function(){var t={queueKey:"__cinePendingTemperatureNote",renderName:"renderTemperatureNote"};if(CORE_RUNTIME_STATE_SUPPORT_PART2&&typeof CORE_RUNTIME_STATE_SUPPORT_PART2.resolveTemperatureKeyDefaults=="function")try{var o=CORE_RUNTIME_STATE_SUPPORT_PART2.resolveTemperatureKeyDefaults();o&&typeof o=="object"&&(typeof o.queueKey=="string"&&o.queueKey&&(t.queueKey=o.queueKey),typeof o.renderName=="string"&&o.renderName&&(t.renderName=o.renderName))}catch{}return(typeof t.queueKey!="string"||!t.queueKey)&&(t.queueKey="__cinePendingTemperatureNote"),(typeof t.renderName!="string"||!t.renderName)&&(t.renderName="renderTemperatureNote"),t})();const CORE_TEMPERATURE_QUEUE_KEY=CORE_TEMPERATURE_KEY_DEFAULTS.queueKey,CORE_TEMPERATURE_RENDER_NAME=CORE_TEMPERATURE_KEY_DEFAULTS.renderName;var CORE_SAFE_FREEZE_REGISTRY=(function(){if(CORE_RUNTIME_STATE_SUPPORT_PART2&&typeof CORE_RUNTIME_STATE_SUPPORT_PART2.ensureSafeFreezeRegistry=="function")try{return CORE_RUNTIME_STATE_SUPPORT_PART2.ensureSafeFreezeRegistry()}catch{}if(CORE_RUNTIME_STATE_SUPPORT_PART2&&typeof CORE_RUNTIME_STATE_SUPPORT_PART2.createSafeFreezeRegistry=="function")try{return CORE_RUNTIME_STATE_SUPPORT_PART2.createSafeFreezeRegistry()}catch{}return typeof WeakSet=="function"?new WeakSet:[]})();function coreSafeFreezeRegistryHas$1(e){if(!e||!CORE_SAFE_FREEZE_REGISTRY)return!1;if(CORE_RUNTIME_STATE_SUPPORT_PART2&&typeof CORE_RUNTIME_STATE_SUPPORT_PART2.hasSafeFreezeEntry=="function")try{return CORE_RUNTIME_STATE_SUPPORT_PART2.hasSafeFreezeEntry(CORE_SAFE_FREEZE_REGISTRY,e)}catch{}if(typeof CORE_SAFE_FREEZE_REGISTRY.has=="function")try{return CORE_SAFE_FREEZE_REGISTRY.has(e)}catch{return!1}for(var t=0;t<CORE_SAFE_FREEZE_REGISTRY.length;t+=1)if(CORE_SAFE_FREEZE_REGISTRY[t]===e)return!0;return!1}function coreSafeFreezeRegistryAdd$1(e){if(!(!e||!CORE_SAFE_FREEZE_REGISTRY)){if(CORE_RUNTIME_STATE_SUPPORT_PART2&&typeof CORE_RUNTIME_STATE_SUPPORT_PART2.registerSafeFreezeEntry=="function")try{CORE_RUNTIME_STATE_SUPPORT_PART2.registerSafeFreezeEntry(CORE_SAFE_FREEZE_REGISTRY,e);return}catch{}if(typeof CORE_SAFE_FREEZE_REGISTRY.add=="function"){try{CORE_SAFE_FREEZE_REGISTRY.add(e)}catch{}return}for(var t=0;t<CORE_SAFE_FREEZE_REGISTRY.length;t+=1)if(CORE_SAFE_FREEZE_REGISTRY[t]===e)return;CORE_SAFE_FREEZE_REGISTRY.push(e)}}function createLocalRuntimeStateFallback(e){var t=[],o=typeof Set=="function"?new Set:null;function r(A){if(!(!A||typeof A!="object"&&typeof A!="function")){if(o){if(o.has(A))return;o.add(A),t.push(A);return}t.indexOf(A)===-1&&t.push(A)}}if(Array.isArray(e))for(var n=0;n<e.length;n+=1)try{r(e[n])}catch{}function a(A){if(typeof A=="function")for(var w=0;w<t.length;w+=1)try{A(t[w],w)}catch{}}function s(){return t.slice()}function l(){return t.length>0?t[0]:null}function u(A,w){var R=typeof w=="function"?w:function(){return w};if(typeof A!="string"||!A)try{return R()}catch{return}for(var _=0;_<t.length;_+=1){var G=t[_];if(!(!G||typeof G!="object"&&typeof G!="function"))try{return typeof G[A]>"u"&&(G[A]=R()),G[A]}catch{}}try{return R()}catch{return}}function d(A,w,R){var _=typeof R=="function"?R:function(){return R},G=typeof w=="function"?w:function(){return!0};a(function(B){try{G(B[A])||(B[A]=_())}catch($){}})}function m(A){for(var w=0;w<t.length;w+=1){var R=t[w];if(!(!R||typeof R!="object"&&typeof R!="function"))try{if(A in R)return R[A]}catch{}}}var y=null;function h(A){typeof A=="function"&&(y=A,a(function(R){if(!(!R||typeof R!="object"&&typeof R!="function"))try{R[CORE_TEMPERATURE_RENDER_NAME]=A;var _=R[CORE_TEMPERATURE_QUEUE_KEY];if(_&&typeof _=="object"){if(Object.prototype.hasOwnProperty.call(_,"latestHours")){var G=_.latestHours;if(typeof G<"u")try{A(G)}catch(O){typeof console<"u"&&typeof console.error=="function"&&console.error("Failed to apply pending temperature note render",O)}}try{delete _.latestHours}catch(O){_.latestHours=void 0}}}catch(O){}}))}function b(){return y}var v={isReferenceError:function(){return!1},repair:function(){}};function C(A){!A||typeof A!="object"||(typeof A.isReferenceError=="function"&&(v.isReferenceError=A.isReferenceError),typeof A.repair=="function"&&(v.repair=A.repair))}return{registerScope:r,withEachScope:a,getScopes:s,getPrimaryScope:l,ensureValue:u,normaliseValue:d,readValue:m,assignTemperatureRenderer:h,getAssignedTemperatureRenderer:b,autoGearGuards:v,setAutoGearGuards:C}}function createLocalRuntimeState(e){if(CORE_RUNTIME_STATE_SUPPORT_PART2&&typeof CORE_RUNTIME_STATE_SUPPORT_PART2.createLocalRuntimeState=="function")try{return CORE_RUNTIME_STATE_SUPPORT_PART2.createLocalRuntimeState(e,{temperatureQueueKey:CORE_TEMPERATURE_QUEUE_KEY,temperatureRenderName:CORE_TEMPERATURE_RENDER_NAME})}catch{}return createLocalRuntimeStateFallback(e)}var CORE_RUNTIME_STATE$2=(function(){for(var t=null,o=0;o<CORE_RUNTIME_CANDIDATE_SCOPES$1.length;o+=1){var r=CORE_RUNTIME_CANDIDATE_SCOPES$1[o];if(r&&typeof r.__cineRuntimeState=="object"){t=r.__cineRuntimeState;break}}if(!t)for(var n=0;n<CORE_RUNTIME_CANDIDATE_SCOPES$1.length;n+=1){var a=CORE_RUNTIME_CANDIDATE_SCOPES$1[n],s=a&&typeof a.__cineCreateRuntimeState=="function"?a.__cineCreateRuntimeState:null;if(typeof s=="function"){try{t=s(CORE_RUNTIME_CANDIDATE_SCOPES$1)}catch{t=null}if(t)break}}t||(t=createLocalRuntimeState(CORE_RUNTIME_CANDIDATE_SCOPES$1));var l=CORE_RUNTIME_CANDIDATE_SCOPES$1.length?CORE_RUNTIME_CANDIDATE_SCOPES$1[0]:null;if(l&&t)try{Object.defineProperty(l,"__cineRuntimeState",{configurable:!0,enumerable:!1,writable:!0,value:t})}catch{try{l.__cineRuntimeState=t}catch{}}return t})();function registerRuntimeScope(e){if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.registerScope=="function")try{CORE_RUNTIME_SHARED$2.registerScope(CORE_RUNTIME_STATE$2,e);return}catch{}if(!(!CORE_RUNTIME_STATE$2||typeof CORE_RUNTIME_STATE$2.registerScope!="function"))try{CORE_RUNTIME_STATE$2.registerScope(e)}catch{}}for(var CORE_RUNTIME_SCOPE_INDEX=0;CORE_RUNTIME_SCOPE_INDEX<CORE_RUNTIME_CANDIDATE_SCOPES$1.length;CORE_RUNTIME_SCOPE_INDEX+=1)registerRuntimeScope(CORE_RUNTIME_CANDIDATE_SCOPES$1[CORE_RUNTIME_SCOPE_INDEX]);function getCoreRuntimeScopesSnapshot$1(){if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.getScopesSnapshot=="function")try{var e=CORE_RUNTIME_SHARED$2.getScopesSnapshot(CORE_RUNTIME_STATE$2,CORE_RUNTIME_CANDIDATE_SCOPES$1);if(Array.isArray(e))return e}catch{}if(CORE_RUNTIME_STATE$2&&typeof CORE_RUNTIME_STATE$2.getScopes=="function")try{return CORE_RUNTIME_STATE$2.getScopes()}catch{}return CORE_RUNTIME_CANDIDATE_SCOPES$1.slice()}(function(){for(var t=[typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null],o=function(n){if(!(!n||typeof n!="object"&&typeof n!="function")&&typeof n.getCoreRuntimeScopesSnapshot!="function")try{n.getCoreRuntimeScopesSnapshot=getCoreRuntimeScopesSnapshot$1}catch{try{Object.defineProperty(n,"getCoreRuntimeScopesSnapshot",{configurable:!0,enumerable:!1,writable:!0,value:getCoreRuntimeScopesSnapshot$1})}catch{}}},r=0;r<t.length;r+=1)o(t[r])})();var CORE_PART2_RUNTIME_SCOPE$2=CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.ensurePrimaryScope=="function"?(function(){try{return CORE_RUNTIME_SHARED$2.ensurePrimaryScope(CORE_RUNTIME_STATE$2,CORE_RUNTIME_CANDIDATE_SCOPES$1)}catch{}return null})():null;if(!CORE_PART2_RUNTIME_SCOPE$2&&CORE_RUNTIME_STATE$2&&typeof CORE_RUNTIME_STATE$2.getPrimaryScope=="function")try{CORE_PART2_RUNTIME_SCOPE$2=CORE_RUNTIME_STATE$2.getPrimaryScope()}catch{CORE_PART2_RUNTIME_SCOPE$2=null}if(!CORE_PART2_RUNTIME_SCOPE$2){var runtimeScopesSnapshot=getCoreRuntimeScopesSnapshot$1();CORE_PART2_RUNTIME_SCOPE$2=runtimeScopesSnapshot.length?runtimeScopesSnapshot[0]:null}function readGlobalScopeValue$1(e){if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.readValue=="function")try{var t=CORE_RUNTIME_SHARED$2.readValue(CORE_RUNTIME_STATE$2,e,getCoreRuntimeScopesSnapshot$1());if(typeof t<"u")return t}catch{}if(CORE_RUNTIME_STATE$2&&typeof CORE_RUNTIME_STATE$2.readValue=="function")return CORE_RUNTIME_STATE$2.readValue(e);for(var o=getCoreRuntimeScopesSnapshot$1(),r=0;r<o.length;r+=1){var n=o[r];if(!(!n||typeof n!="object"))try{if(e in n)return n[e]}catch{}}}function writeGlobalScopeValue(e,t){if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.writeValue=="function")try{return CORE_RUNTIME_SHARED$2.writeValue(CORE_RUNTIME_STATE$2,e,t,getCoreRuntimeScopesSnapshot$1()),!0}catch{}if(CORE_RUNTIME_STATE$2&&typeof CORE_RUNTIME_STATE$2.writeValue=="function")try{return CORE_RUNTIME_STATE$2.writeValue(e,t),!0}catch{}for(var o=getCoreRuntimeScopesSnapshot$1(),r=0;r<o.length;r+=1){var n=o[r];if(!(!n||typeof n!="object"))try{return n[e]=t,!0}catch{}}return!1}function ensureGlobalFallback(e,t){if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.ensureValue=="function")try{return CORE_RUNTIME_SHARED$2.ensureValue(CORE_RUNTIME_STATE$2,e,t,getCoreRuntimeScopesSnapshot$1())}catch{}if(CORE_RUNTIME_STATE$2&&typeof CORE_RUNTIME_STATE$2.ensureValue=="function")return CORE_RUNTIME_STATE$2.ensureValue(e,t);for(var o=typeof t=="function"?t:function(){return t},r=getCoreRuntimeScopesSnapshot$1(),n=0;n<r.length;n+=1){var a=r[n];try{return typeof a[e]>"u"&&(a[e]=o()),a[e]}catch{}}try{return o()}catch{return}}function normaliseGlobalValue(e,t,o){if(CORE_RUNTIME_SHARED$2&&typeof CORE_RUNTIME_SHARED$2.normaliseValue=="function")try{CORE_RUNTIME_SHARED$2.normaliseValue(CORE_RUNTIME_STATE$2,e,t,o,getCoreRuntimeScopesSnapshot$1());return}catch{}if(CORE_RUNTIME_STATE$2&&typeof CORE_RUNTIME_STATE$2.normaliseValue=="function"){CORE_RUNTIME_STATE$2.normaliseValue(e,t,o);return}for(var r=typeof o=="function"?o:function(){return o},n=getCoreRuntimeScopesSnapshot$1(),a=0;a<n.length;a+=1){var s=n[a];try{t(s[e])||(s[e]=r())}catch{}}}var AUTO_GEAR_GLOBAL_FALLBACKS={autoGearAutoPresetId:function(){return""},baseAutoGearRules:function(){return[]},autoGearScenarioModeSelect:function(){return null},autoGearRuleNameInput:function(){return null},autoGearSummaryFocus:function(){return"all"},autoGearMonitorDefaultControls:function(){return[]},safeGenerateConnectorSummary:function(){return createFallbackSafeGenerateConnectorSummary$1()},totalPowerElem:function(){return null}},AUTO_GEAR_REFERENCE_NAMES=Object.keys(AUTO_GEAR_GLOBAL_FALLBACKS);function isAutoGearGlobalReferenceError$1(e){if(!e||typeof e!="object")return!1;var t=typeof e.message=="string"?e.message:"";return e.name==="ReferenceError"&&AUTO_GEAR_REFERENCE_NAMES.some(function(r){return t.indexOf(r)!==-1})}function ensureAutoGearGlobal(e,t){var o=AUTO_GEAR_GLOBAL_FALLBACKS[t];if(typeof o=="function"){var r=o();if(typeof e[t]>"u")try{e[t]=r}catch{try{Object.defineProperty(e,t,{configurable:!0,writable:!0,enumerable:!1,value:r})}catch{}}try{var n=e&&e.Function||Function;if(typeof n=="function"){var a=n("value","if (typeof "+t+" === 'undefined') { var "+t+" = value; } else { "+t+` = value; }
           return `+t+";"),s=typeof e[t]>"u"?r:e[t];a(s)}}catch{}}}function repairAutoGearGlobals$1(e){if(!(!e||typeof e!="object"&&typeof e!="function"))for(var t=0;t<AUTO_GEAR_REFERENCE_NAMES.length;t+=1){var o=AUTO_GEAR_REFERENCE_NAMES[t];try{ensureAutoGearGlobal(e,o)}catch{}}}if(CORE_RUNTIME_STATE$2&&typeof CORE_RUNTIME_STATE$2.setAutoGearGuards=="function")try{CORE_RUNTIME_STATE$2.setAutoGearGuards({isReferenceError:isAutoGearGlobalReferenceError$1,repair:repairAutoGearGlobals$1})}catch{}ensureGlobalFallback("autoGearAutoPresetId","");ensureGlobalFallback("baseAutoGearRules",function(){return[]});ensureGlobalFallback("autoGearScenarioModeSelect",null);function createFallbackSafeGenerateConnectorSummary$1(){return function(t){if(!t||typeof t!="object")return"";if(typeof generateConnectorSummary=="function")try{return generateConnectorSummary(t)}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("generateConnectorSummary failed, using fallback",o)}typeof console<"u"&&typeof console.warn=="function"&&console.warn("Using fallback connector summary generator. Core bindings may have failed to initialise.");try{const o=Object.keys(t);if(!o.length)return"";const r=o[0],n=t[r],a=typeof r=="string"?r.replace(/_/g," "):"connector";return n?`${a}: ${n}`:a}catch{return""}}}ensureGlobalFallback("createFallbackSafeGenerateConnectorSummary",function(){return createFallbackSafeGenerateConnectorSummary$1});ensureGlobalFallback("safeGenerateConnectorSummary",function(){return createFallbackSafeGenerateConnectorSummary$1()});ensureGlobalFallback("readGlobalScopeValue",function(){return readGlobalScopeValue$1});normaliseGlobalValue("baseAutoGearRules",function(t){return Array.isArray(t)},function(){return[]});normaliseGlobalValue("safeGenerateConnectorSummary",function(t){return typeof t=="function"},function(){return createFallbackSafeGenerateConnectorSummary$1()});function createFallbackIconFontKeys(){return Object.freeze({ESSENTIAL:"essential",FILM:"film",GADGET:"gadget",UICONS:"uicons",TEXT:"text"})}ensureGlobalFallback("ICON_FONT_KEYS",function(){return createFallbackIconFontKeys()});ensureGlobalFallback("iconGlyph",function(){const e=ensureGlobalFallback("ICON_FONT_KEYS",function(){return createFallbackIconFontKeys()}),t=e&&typeof e.UICONS=="string"?e.UICONS:"uicons";return function(r,n){const a=typeof r=="string"?r:"",s=n&&typeof n=="string"?n:t;try{return Object.freeze({char:a,font:s})}catch{return{char:a,font:s}}}});ensureGlobalFallback("resolveIconGlyph",function(){const e=ensureGlobalFallback("ICON_FONT_KEYS",function(){return createFallbackIconFontKeys()}),t=new Set(Object.values(e||{}).filter(a=>typeof a=="string"&&a)),o=e&&e.UICONS?e.UICONS:"uicons";function r(a,s){const l=parseInt(a,s);if(!Number.isFinite(l)||l<0)return null;try{if(typeof String.fromCodePoint=="function")return String.fromCodePoint(l)}catch{}return l<=65535?String.fromCharCode(l):null}function n(a){if(typeof a!="string")return"";const s=a.trim();if(!s)return"";const l=s.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(l){const y=r(l[1],16);if(y)return y}const u=s.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(u){const y=r(u[1],16);if(y)return y}const d=s.match(/^&#x([0-9A-Fa-f]+);$/i);if(d){const y=r(d[1],16);if(y)return y}const m=s.match(/^&#(\d+);$/);if(m){const y=r(m[1],10);if(y)return y}return s}return function(s){if(!s)return{char:"",font:o,className:""};if(s.markup){const l=Number.isFinite(s.size)?s.size:void 0;return{markup:s.markup,className:s.className||"",font:o,size:l}}if(typeof s=="string")return{char:n(s),font:o,className:""};if(typeof s=="object"){const l=typeof s.char=="string"?n(s.char):"",u=s.font&&t.has(s.font)?s.font:o,d=typeof s.className=="string"?s.className:"",m=Number.isFinite(s.size)?s.size:void 0;return s.markup?{markup:s.markup,className:d,font:u,size:m}:{char:l,font:u,className:d,size:m}}return{char:"",font:o,className:""}}});ensureGlobalFallback("formatSvgCoordinate",function(){return function(t){if(!Number.isFinite(t))return"0";const o=Math.round(t*100)/100;return Number.isInteger(o)?String(o):o.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}});ensureGlobalFallback("positionSvgMarkup",function(){const e=ensureGlobalFallback("formatSvgCoordinate",function(){return function(o){if(!Number.isFinite(o))return"0";const r=Math.round(o*100)/100;return Number.isInteger(r)?String(r):r.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}});return function(o,r,n,a=24){if(typeof o!="string")return{markup:"",x:"0",y:"0"};const s=o.trim();if(!s)return{markup:"",x:"0",y:"0"};const l=a/2,u=e(r),d=e(n),m=e(a),y=e(a);return{markup:s.replace(/<svg\b([^>]*)>/i,(b,v="")=>{let C=v.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const A=[],w=/(?:^|\s)width\s*=/i.test(C),R=/(?:^|\s)height\s*=/i.test(C);return w||A.push(`width="${m}"`),R||A.push(`height="${y}"`),A.push(`x="-${e(l)}"`),A.push(`y="-${e(l)}"`),C=[C].concat(A).filter(Boolean).join(" ").trim(),C?`<svg ${C}>`:"<svg>"}),x:u,y:d}}});ensureGlobalFallback("applyIconGlyph",function(){const e=ensureGlobalFallback("resolveIconGlyph",function(){return function(r){return r&&typeof r=="object"?r:{char:typeof r=="string"?r:"",font:"uicons"}}}),t=ensureGlobalFallback("ensureSvgHasAriaHidden",function(){return function(r){return r}});return function(r,n){if(!r)return;const a=e(n);if(a&&a.markup){r.innerHTML=t(a.markup),r.setAttribute("aria-hidden","true"),a.className&&r.classList&&a.className.split(/\s+/).filter(Boolean).forEach(l=>r.classList.add(l)),r.removeAttribute("data-icon-font");return}const s=a&&a.char||"";r.textContent=s,s?r.setAttribute("data-icon-font",a.font||"uicons"):r.removeAttribute("data-icon-font")}});function ensureCorePart2Placeholder(e,t){for(var o=[CORE_PART2_RUNTIME_SCOPE$2&&typeof CORE_PART2_RUNTIME_SCOPE$2=="object"?CORE_PART2_RUNTIME_SCOPE$2:null,typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null].filter(Boolean),r=typeof t=="function"?t:function(){return t},n=0;n<o.length;n+=1){var a=o[n];try{return typeof a[e]>"u"&&(a[e]=r()),a[e]}catch{}}return r()}ensureCorePart2Placeholder("autoGearAutoPresetId","");ensureCorePart2Placeholder("baseAutoGearRules",function(){return[]});ensureCorePart2Placeholder("autoGearScenarioModeSelect",null);ensureCorePart2Placeholder("safeGenerateConnectorSummary",function(){return createFallbackSafeGenerateConnectorSummary$1()});function resolveInitialPart2Value(e){const t=[CORE_PART2_RUNTIME_SCOPE$2&&typeof CORE_PART2_RUNTIME_SCOPE$2=="object"?CORE_PART2_RUNTIME_SCOPE$2:null,typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null].filter(Boolean);for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r!="object"))try{if(e in r){const n=r[e];if(typeof n<"u")return n}}catch{}}}resolveInitialPart2Value("autoGearAutoPresetId");resolveInitialPart2Value("baseAutoGearRules");resolveInitialPart2Value("autoGearScenarioModeSelect");const safeGenerateConnectorSummarySeed=resolveInitialPart2Value("safeGenerateConnectorSummary");let safeGenerateConnectorSummaryFn=typeof safeGenerateConnectorSummarySeed=="function"?safeGenerateConnectorSummarySeed:createFallbackSafeGenerateConnectorSummary$1(),connectorSummaryWarningIssued=!1;function generateSafeConnectorSummary$1(e){const t=[];typeof safeGenerateConnectorSummaryFn=="function"&&t.push(safeGenerateConnectorSummaryFn);const o=readGlobalScopeValue$1("safeGenerateConnectorSummary");typeof o=="function"&&t.push(o),typeof CORE_SHARED$2<"u"&&CORE_SHARED$2&&typeof CORE_SHARED$2.safeGenerateConnectorSummary=="function"&&t.push(CORE_SHARED$2.safeGenerateConnectorSummary);for(let r=0;r<t.length;r+=1){const n=t[r];try{const a=n(e);if(typeof a=="string")return a;if(typeof a>"u"||a===null)continue;return String(a)}catch(a){connectorSummaryWarningIssued||(connectorSummaryWarningIssued=!0,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to generate connector summary. Falling back to empty summary.",a))}}return""}const CORE_SHARED$2={};typeof globalThis<"u"&&(globalThis.coreSafeFreezeRegistryHas=coreSafeFreezeRegistryHas$1,globalThis.coreSafeFreezeRegistryAdd=coreSafeFreezeRegistryAdd$1,globalThis.generateSafeConnectorSummary=generateSafeConnectorSummary$1,globalThis.readGlobalScopeValue=readGlobalScopeValue$1,globalThis.writeGlobalScopeValue=writeGlobalScopeValue,globalThis.collectEnvironmentRuntimeCandidateScopes=collectEnvironmentRuntimeCandidateScopes,globalThis.createLocalRuntimeStateFallback=createLocalRuntimeStateFallback);const cineUiCache={_cache:{},getElement:function(e){if(this._cache[e])return this._cache[e];if(typeof document<"u"){const t=document.getElementById(e);if(t)return this._cache[e]=t,t}return null},clear:function(){this._cache={}}},elementIds=["toggleDeviceManager","device-manager","saveSetupBtn","setupName","deleteSetupBtn","addDeviceBtn","cancelEditBtn","languageSelect","skipLink","importDataBtn","importFileInput","exportDataBtn","generateGearListBtn","deleteGearListProjectBtn","gearItemEditExtra","newSubcategory","newCategory","subcategoryField","lensFocusScaleUnit","newName","newWatt","newCapacity","newPinA","newDtapA","menuToggle","darkModeToggle","pinkModeToggle","settingsButton","helpButton","reloadButton","closeMenuButton","openContactsBtn","shareSetupBtn","applySharedLinkBtn","generateOverviewBtn","runtimeFeedbackBtn","zoomOut","zoomIn","resetView","gridSnapToggle","accentColorReset","localFontsButton","documentationTrackerAddRelease","mountVoltageReset","autoGearSavePreset","autoGearDeletePreset","autoGearBackupRestore","autoGearAddRule","autoGearResetFactory","autoGearHighlightToggle","closePrintPreviewBtn","printPreviewExportBtn","printPreviewPrintBtn","cameraWatt","monitorWatt","viewfinderWatt","cameraVoltage","cameraPortType","monitorScreenSize","monitorBrightness","monitorVoltage","monitorPortType","monitorLatency","monitorAudioOutput","viewfinderScreenSize","viewfinderBrightness","viewfinderVoltage","viewfinderPortType","viewfinderLatency","batteryFields","cameraFields","monitorFields","viewfinderFields","videoFields","motorFields","controllerFields","distanceFields","lensFields","wattField","dynamicFields"];elementIds.forEach(function(e){Object.defineProperty(cineUiCache,e,{get:function(){return this.getElement(e)},enumerable:!0,configurable:!0})});typeof globalThis<"u"?globalThis.cineUiCache=cineUiCache:typeof window<"u"?window.cineUiCache=cineUiCache:typeof self<"u"?self.cineUiCache=cineUiCache:typeof global<"u"&&(global.cineUiCache=cineUiCache);function detectGlobalScope$e(){return typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:typeof window<"u"&&window&&typeof window=="object"?window:typeof self<"u"&&self&&typeof self=="object"?self:typeof global<"u"&&global&&typeof global=="object"?global:null}const GLOBAL_SCOPE$e=detectGlobalScope$e();function resolveDocument$2(){return GLOBAL_SCOPE$e&&GLOBAL_SCOPE$e.document&&typeof GLOBAL_SCOPE$e.document=="object"?GLOBAL_SCOPE$e.document:typeof document<"u"&&document&&typeof document=="object"?document:null}let escapeDiv=null;function escapeHtml$4(e){if(!escapeDiv){const t=resolveDocument$2();t&&(escapeDiv=t.createElement("div"))}return escapeDiv?(escapeDiv.textContent=e,escapeDiv.innerHTML):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function escapeButtonLabelSafely$1(e){if(typeof e!="string"||e==="")return"";try{return escapeHtml$4(e)}catch{}return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function getIconMarkupFunction(){try{if(typeof iconMarkup=="function")return iconMarkup}catch(e){if(!(e&&e.name==="ReferenceError"))throw e}return GLOBAL_SCOPE$e&&typeof GLOBAL_SCOPE$e.iconMarkup=="function"?GLOBAL_SCOPE$e.iconMarkup:null}function isFiniteNumber(e){return typeof e!="number"?!1:typeof Number.isFinite=="function"?Number.isFinite(e):isFinite(e)}function fallbackToCodePointChar(e,t){const o=parseInt(e,t);if(!isFiniteNumber(o)||o<0)return"";try{if(typeof String.fromCodePoint=="function")return String.fromCodePoint(o)}catch{}return o<=65535?String.fromCharCode(o):""}function fallbackNormalizeGlyphChar(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const o=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(o){const s=fallbackToCodePointChar(o[1],16);if(s)return s}const r=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(r){const s=fallbackToCodePointChar(r[1],16);if(s)return s}const n=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(n){const s=fallbackToCodePointChar(n[1],16);if(s)return s}const a=t.match(/^&#(\d+);$/);if(a){const s=fallbackToCodePointChar(a[1],10);if(s)return s}return t}function fallbackEscapeAttribute(e){if(typeof e=="string")return escapeButtonLabelSafely$1(e);if(e===null||typeof e>"u")return"";try{return escapeButtonLabelSafely$1(String(e))}catch{}return""}function normalizeFallbackGlyphConfig(e){if(!e)return null;if(typeof e=="string"){const d=fallbackNormalizeGlyphChar(e);return d?{char:d,font:"uicons",className:""}:null}if(typeof e!="object")return null;const t=typeof e.markup=="string"?e.markup.trim():"",o=typeof e.className=="string"?e.className:"",r=typeof e.style=="string"?e.style:"",n=e.size,a=e.scale;if(t)return{markup:t,className:o,style:r,size:n,scale:a};const s=typeof e.char=="string"&&e.char?e.char:typeof e.character=="string"&&e.character?e.character:typeof e.glyph=="string"&&e.glyph?e.glyph:typeof e.unicode=="string"&&e.unicode?e.unicode:"",l=fallbackNormalizeGlyphChar(s);if(!l)return null;const u=typeof e.font=="string"&&e.font.trim()?e.font.trim():"uicons";return{char:l,font:u,className:o,style:r,size:n,scale:a}}function createFallbackIconMarkup(e,t){const o=normalizeFallbackGlyphConfig(e);if(!o)return"";const r=["icon-glyph"];r.unshift(t),o.className&&o.className.split(/\s+/).filter(Boolean).forEach(d=>{r.indexOf(d)===-1&&r.push(d)});const n=[];isFiniteNumber(o.size)&&o.size>0?n.push(`--icon-size: ${o.size}px`):typeof o.size=="string"&&o.size.trim()&&n.push(`--icon-size: ${o.size.trim()}`),isFiniteNumber(o.scale)&&o.scale>0?n.push(`--icon-scale: ${o.scale}`):typeof o.scale=="string"&&o.scale.trim()&&n.push(`--icon-scale: ${o.scale.trim()}`),typeof o.style=="string"&&o.style.trim()&&n.push(o.style.trim());const a=n.length?` style="${n.join(";")}"`:"";if(o.markup)return`<span class="${r.join(" ")}"${a} aria-hidden="true">${o.markup}</span>`;const s=typeof o.char=="string"?o.char:"";if(!s)return"";const l=typeof o.font=="string"?o.font:"uicons",u=l?` data-icon-font="${fallbackEscapeAttribute(l)}"`:"";return`<span class="${r.join(" ")}"${a}${u} aria-hidden="true">${escapeHtml$4(s)}</span>`}function resolveButtonIconMarkup$1(e){if(!e)return"";const t=getIconMarkupFunction();if(!t)return createFallbackIconMarkup(e,"btn-icon");try{return t(e,"btn-icon")}catch{}return createFallbackIconMarkup(e,"btn-icon")}function resolveDefaultGlyph(e){if(typeof e<"u")return e;try{if(typeof ICON_GLYPHS=="object"&&ICON_GLYPHS&&ICON_GLYPHS.save)return ICON_GLYPHS.save}catch{}return e}function setButtonLabelWithIcon$1(e,t,o){if(!e)return;const r=resolveDocument$2(),n=resolveDefaultGlyph(o),a=resolveButtonIconMarkup$1(n),s=typeof t=="string"?t:"";if(e.firstChild)for(;e.firstChild;)e.removeChild(e.firstChild);if(r&&a){const l=r.createElement("span");for(l.innerHTML=a;l.firstChild;)e.appendChild(l.firstChild)}else if(!r&&a&&typeof e.innerHTML=="string"){e.innerHTML=`${a}${escapeButtonLabelSafely$1(s)}`;return}r?e.appendChild(r.createTextNode(s)):typeof e.textContent=="string"?e.textContent=s:typeof e.innerHTML=="string"&&(e.innerHTML=escapeButtonLabelSafely$1(s))}function whenElementAvailable$1(e,t,o={}){if(!e||typeof t!="function")return!1;const r=resolveDocument$2();if(!r)return!1;const n=m=>{let y=r.getElementById(m);if(!y)try{y=r.querySelector(m)}catch{}return y},a=n(e);if(a){try{t(a)}catch(m){typeof console<"u"&&console&&typeof console.error=="function"&&console.error(`whenElementAvailable: handler for ${e} failed`,m)}return!0}const s=typeof o.maxAttempts=="number"?o.maxAttempts:150,l=typeof o.interval=="number"&&o.interval>0?o.interval:100;let u=0;const d=()=>{u+=1;const m=n(e);if(m){try{t(m)}catch(y){typeof console<"u"&&console&&typeof console.error=="function"&&console.error(`whenElementAvailable: polled handler for ${e} failed`,y)}return}if(u<s)setTimeout(d,l);else if(typeof o.onTimeout=="function")try{o.onTimeout()}catch{}};return setTimeout(d,l),!0}const namespace$4={escapeHtml:escapeHtml$4,escapeButtonLabelSafely:escapeButtonLabelSafely$1,resolveButtonIconMarkup:resolveButtonIconMarkup$1,setButtonLabelWithIcon:setButtonLabelWithIcon$1,whenElementAvailable:whenElementAvailable$1};if(GLOBAL_SCOPE$e){const e=GLOBAL_SCOPE$e.cineCoreUiHelpers&&typeof GLOBAL_SCOPE$e.cineCoreUiHelpers=="object"?GLOBAL_SCOPE$e.cineCoreUiHelpers:{};e.escapeHtml=escapeHtml$4,e.escapeButtonLabelSafely=escapeButtonLabelSafely$1,e.resolveButtonIconMarkup=resolveButtonIconMarkup$1,e.setButtonLabelWithIcon=setButtonLabelWithIcon$1,e.whenElementAvailable=whenElementAvailable$1;try{GLOBAL_SCOPE$e.cineCoreUiHelpers=e}catch{}}const cineCoreUiHelpers=namespace$4,TEXT_ENTRY_SEPARATOR=`
`;function normaliseTextEntryValue(e,t=TEXT_ENTRY_SEPARATOR){const o=typeof t=="string"&&t?t:TEXT_ENTRY_SEPARATOR;if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"){try{return String(e)}catch{}return""}if(Array.isArray(e)){const r=[];for(let n=0;n<e.length;n+=1){const a=normaliseTextEntryValue(e[n],o);a&&r.push(a)}return r.join(o)}if(e&&typeof e=="object"){if(typeof e.text=="string")return e.text;if(Array.isArray(e.text))return normaliseTextEntryValue(e.text,o);if(typeof e.label=="string")return e.label;try{const r=String(e);if(r&&r!=="[object Object]")return r}catch{}}return""}function resolveTextEntry$1(e,t,o,r="",n=TEXT_ENTRY_SEPARATOR){const a=typeof r=="string"?r:"",s=[];e&&(typeof e=="object"||typeof e=="function")&&s.push(e),t&&t!==e&&(typeof t=="object"||typeof t=="function")&&s.push(t);for(let l=0;l<s.length;l+=1){const u=s[l];let d;try{d=u[o]}catch{d=void 0}if(typeof d>"u"||d===null)continue;const m=normaliseTextEntryValue(d,n);if(typeof m=="string")return m}return a}function detectGlobalScope$d(){return typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:typeof window<"u"&&window&&typeof window=="object"?window:typeof self<"u"&&self&&typeof self=="object"?self:typeof global<"u"&&global&&typeof global=="object"?global:null}const globalScope$5=detectGlobalScope$d();if(globalScope$5){const e=globalScope$5.cineCoreTextEntries&&typeof globalScope$5.cineCoreTextEntries=="object"?globalScope$5.cineCoreTextEntries:{};e.TEXT_ENTRY_SEPARATOR=TEXT_ENTRY_SEPARATOR,e.normaliseTextEntryValue=normaliseTextEntryValue,e.resolveTextEntry=resolveTextEntry$1;try{globalScope$5.cineCoreTextEntries=e}catch{}}console.log("DEBUG: app-core-new-1.js STARTING");typeof window<"u"&&(window.__APP_CORE_STARTED=!0);function renderFeedbackTable(e){return{count:0}}(function(){typeof window<"u"&&(window.ensureSvgHasAriaHidden||(window.ensureSvgHasAriaHidden=function(e){return e}))})();const globalShim=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{};var CORE_PART1_RUNTIME_SCOPE$1=globalShim;typeof globalShim.CORE_PART1_RUNTIME_SCOPE>"u"&&(globalShim.CORE_PART1_RUNTIME_SCOPE=CORE_PART1_RUNTIME_SCOPE$1);var CORE_PART2_RUNTIME_SCOPE$1=globalShim;typeof globalShim.CORE_PART2_RUNTIME_SCOPE>"u"&&(globalShim.CORE_PART2_RUNTIME_SCOPE=CORE_PART2_RUNTIME_SCOPE$1);var CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1=globalShim;typeof globalShim.CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE>"u"&&(globalShim.CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE=CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1);var AppCore=globalShim.AppCore||{};globalShim.AppCore=AppCore;var localization=globalShim.localization||{};globalShim.localization=localization;let devices$1=typeof window<"u"?window.devices:void 0,texts$1=typeof window<"u"?window.texts:void 0;const resolvedCollectCoreRuntimeCandidateScopes=resolvedCollectCoreRuntimeCandidateScopes$1;function resolveAutoGearUIHelper(e){if(typeof window<"u"&&typeof window[e]=="function")return window[e];const t=typeof globalThis<"u"&&globalThis.AUTO_GEAR_UI_HELPERS||typeof window<"u"&&window.AUTO_GEAR_UI_HELPERS||null;if(t&&typeof t[e]=="function")return t[e]}function resolveAutoGearNormalizer(e){if(typeof window<"u"&&typeof window[e]=="function")return window[e];const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||{};if(typeof t[e]=="function")return t[e];const o=t.AUTO_GEAR_NORMALIZER_EXPORTS;if(o&&typeof o[e]=="function")return o[e]}function resolveAutoGearStorageHelper(e){if(typeof window<"u"&&typeof window[e]=="function")return window[e];const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||{};if(typeof t[e]=="function")return t[e];const o=t.AUTO_GEAR_STORAGE_EXPORTS;if(o&&typeof o[e]=="function")return o[e]}function createDeferredAutoGearRefresherFallback(e){return function(t){if(typeof callCoreFunctionIfAvailable$1=="function")return callCoreFunctionIfAvailable$1(e,[t],{defer:!0})}}let createDeferredAutoGearRefresher=resolveAutoGearUIHelper("createDeferredAutoGearRefresher")||createDeferredAutoGearRefresherFallback,focusAutoGearConditionPicker=resolveAutoGearUIHelper("focusAutoGearConditionPicker")||function(){},configureAutoGearConditionButtons=resolveAutoGearUIHelper("configureAutoGearConditionButtons")||function(){},AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS=typeof window<"u"&&window.AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS||typeof globalThis<"u"&&globalThis.AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS||{},AUTO_GEAR_MONITOR_DEFAULT_TYPES$1=typeof window<"u"&&window.AUTO_GEAR_MONITOR_DEFAULT_TYPES||typeof globalThis<"u"&&globalThis.AUTO_GEAR_MONITOR_DEFAULT_TYPES||{"on-camera":"On-Camera",director:"Director","video-village":"Video Village",wireless:"Wireless"};function createSafeShim(e,t,o){const r=(...n)=>{const a=t(e);return a&&a!==r&&typeof a=="function"?a(...n):o(...n)};return r}const normalizeAutoGearTriggerValue$1=createSafeShim("normalizeAutoGearTriggerValue",resolveAutoGearNormalizer,e=>typeof e=="string"?e.trim():""),normalizeAutoGearScenarioLogic$1=createSafeShim("normalizeAutoGearScenarioLogic",resolveAutoGearNormalizer,e=>e==="any"||e==="multiplier"?e:"all"),normalizeAutoGearScenarioPrimary$1=createSafeShim("normalizeAutoGearScenarioPrimary",resolveAutoGearNormalizer,e=>typeof e=="string"?e.trim():""),normalizeAutoGearScenarioMultiplier$1=createSafeShim("normalizeAutoGearScenarioMultiplier",resolveAutoGearNormalizer,e=>{const t=Number(e);return Number.isFinite(t)&&t>0?t:1}),normalizeAutoGearSelectorType=createSafeShim("normalizeAutoGearSelectorType",resolveAutoGearNormalizer,e=>typeof e=="string"?e.trim():"none"),normalizeAutoGearSelectorDefault=createSafeShim("normalizeAutoGearSelectorDefault",resolveAutoGearNormalizer,(e,t)=>typeof t=="string"?t.trim():""),normalizeAutoGearMonitorDefaults$1=createSafeShim("normalizeAutoGearMonitorDefaults",resolveAutoGearNormalizer,e=>({focus:"",handheld7:"",combo15:"",director15:""})),normalizeAutoGearRule$1=createSafeShim("normalizeAutoGearRule",resolveAutoGearNormalizer,e=>e),normalizeAutoGearPreset$1=createSafeShim("normalizeAutoGearPreset",resolveAutoGearNormalizer,e=>e),normalizeAutoGearItem$1=createSafeShim("normalizeAutoGearItem",resolveAutoGearNormalizer,e=>e),normalizeAutoGearConditionLogic$1=createSafeShim("normalizeAutoGearConditionLogic",resolveAutoGearNormalizer,e=>e),normalizeAutoGearShootingDaysCondition$1=createSafeShim("normalizeAutoGearShootingDaysCondition",resolveAutoGearNormalizer,e=>e),readAutoGearRulesFromStorage=createSafeShim("readAutoGearRulesFromStorage",resolveAutoGearStorageHelper,()=>[]),readAutoGearBackupRetentionFromStorage=createSafeShim("readAutoGearBackupRetentionFromStorage",resolveAutoGearStorageHelper,()=>0),readAutoGearBackupsFromStorage=createSafeShim("readAutoGearBackupsFromStorage",resolveAutoGearStorageHelper,e=>[]),readAutoGearPresetsFromStorage=createSafeShim("readAutoGearPresetsFromStorage",resolveAutoGearStorageHelper,()=>[]),readActiveAutoGearPresetIdFromStorage=createSafeShim("readActiveAutoGearPresetIdFromStorage",resolveAutoGearStorageHelper,()=>null),readAutoGearAutoPresetIdFromStorage=createSafeShim("readAutoGearAutoPresetIdFromStorage",resolveAutoGearStorageHelper,()=>""),readAutoGearBackupVisibilityFromStorage=createSafeShim("readAutoGearBackupVisibilityFromStorage",resolveAutoGearStorageHelper,()=>!1),readAutoGearMonitorDefaultsFromStorage=createSafeShim("readAutoGearMonitorDefaultsFromStorage",resolveAutoGearStorageHelper,()=>({})),persistAutoGearBackupRetention=createSafeShim("persistAutoGearBackupRetention",resolveAutoGearStorageHelper,e=>{});typeof globalThis<"u"&&(globalThis.createDeferredAutoGearRefresher=createDeferredAutoGearRefresher,globalThis.focusAutoGearConditionPicker=focusAutoGearConditionPicker,globalThis.configureAutoGearConditionButtons=configureAutoGearConditionButtons,globalThis.AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS=AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS,globalThis.AUTO_GEAR_MONITOR_DEFAULT_TYPES=AUTO_GEAR_MONITOR_DEFAULT_TYPES$1,globalThis.normalizeAutoGearTriggerValue=normalizeAutoGearTriggerValue$1,globalThis.normalizeAutoGearScenarioLogic=normalizeAutoGearScenarioLogic$1,globalThis.normalizeAutoGearScenarioPrimary=normalizeAutoGearScenarioPrimary$1,globalThis.normalizeAutoGearScenarioMultiplier=normalizeAutoGearScenarioMultiplier$1,globalThis.normalizeAutoGearSelectorType=normalizeAutoGearSelectorType,globalThis.normalizeAutoGearSelectorDefault=normalizeAutoGearSelectorDefault,globalThis.normalizeAutoGearMonitorDefaults=normalizeAutoGearMonitorDefaults$1,globalThis.normalizeAutoGearRule=normalizeAutoGearRule$1,globalThis.normalizeAutoGearPreset=normalizeAutoGearPreset$1,globalThis.normalizeAutoGearItem=normalizeAutoGearItem$1,globalThis.normalizeAutoGearConditionLogic=normalizeAutoGearConditionLogic$1,globalThis.normalizeAutoGearShootingDaysCondition=normalizeAutoGearShootingDaysCondition$1,globalThis.readAutoGearRulesFromStorage=readAutoGearRulesFromStorage,globalThis.readAutoGearBackupRetentionFromStorage=readAutoGearBackupRetentionFromStorage,globalThis.readAutoGearBackupsFromStorage=readAutoGearBackupsFromStorage,globalThis.readAutoGearPresetsFromStorage=readAutoGearPresetsFromStorage,globalThis.readActiveAutoGearPresetIdFromStorage=readActiveAutoGearPresetIdFromStorage,globalThis.readAutoGearAutoPresetIdFromStorage=readAutoGearAutoPresetIdFromStorage,globalThis.readAutoGearBackupVisibilityFromStorage=readAutoGearBackupVisibilityFromStorage,globalThis.readAutoGearMonitorDefaultsFromStorage=readAutoGearMonitorDefaultsFromStorage,globalThis.persistAutoGearBackupRetention=persistAutoGearBackupRetention,globalThis.ensureGearListActions=createSafeShim("ensureGearListActions",resolveAutoGearUIHelper,()=>{}),globalThis.setInstallBannerOffset=createSafeShim("setInstallBannerOffset",resolveAutoGearUIHelper,()=>{}));var localResolveDocumentDirection=typeof cineLocale<"u"&&cineLocale&&typeof cineLocale.resolveDocumentDirection=="function"?cineLocale.resolveDocumentDirection:function(t){return"ltr"};const localApplyLocaleMetadata=typeof cineLocale<"u"&&cineLocale&&typeof cineLocale.applyLocaleMetadata=="function"?cineLocale.applyLocaleMetadata:function(t,o,r){},runtimeBootstrapExports=(function(){if(typeof require=="function")try{const r=require("./runtime/bootstrap.js");if(r&&typeof r=="object")return r}catch{}const t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}o(typeof CORE_GLOBAL_SCOPE$3=="object"&&CORE_GLOBAL_SCOPE$3?CORE_GLOBAL_SCOPE$3:null),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const a=n&&n.cineRuntimeBootstrapExports;if(a&&typeof a=="object")return a}catch{}}return null})(),defaultCoreBootQueue=[],{fallbackResolveRuntimeModuleLoader=function(){return null},fallbackRequireCoreRuntimeModule=function(){return null},exposeCoreRuntimeConstant:exposeCoreRuntimeConstant$1=function(t,o){typeof window<"u"&&(window[t]=o),typeof globalThis<"u"&&(globalThis[t]=o)},exposeCoreRuntimeConstants=function(){},CORE_BOOT_QUEUE_KEY="__coreRuntimeBootQueue",CORE_BOOT_QUEUE:resolvedCoreBootQueue=defaultCoreBootQueue,enqueueCoreBootTask:resolvedEnqueueCoreBootTask,getGridSnapState:getGridSnapState$1=function(){return"normal"},setGridSnapState:resolvedSetGridSnapState,applyLegacyGridSnapValue:resolvedApplyLegacyGridSnapValue}=runtimeBootstrapExports||{},CORE_BOOT_QUEUE=resolvedCoreBootQueue,enqueueCoreBootTask$2=typeof resolvedEnqueueCoreBootTask=="function"?resolvedEnqueueCoreBootTask:function(t){if(typeof t=="function")try{CORE_BOOT_QUEUE.push(t)}catch{try{t()}catch{}}return CORE_BOOT_QUEUE.length},applyLegacyGridSnapValue$1=typeof resolvedApplyLegacyGridSnapValue=="function"?resolvedApplyLegacyGridSnapValue:function(t){return typeof t>"u"?getGridSnapState$1():t},TEMPERATURE_SCOPE_CANDIDATES=[typeof CORE_GLOBAL_SCOPE$3=="object"&&CORE_GLOBAL_SCOPE$3,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null].filter(e=>e&&(typeof e=="object"||typeof e=="function")),TEMPERATURE_UNITS_FALLBACK=Object.freeze({fahrenheit:"fahrenheit",celsius:"celsius"}),{normalizeVideoType:normalizeVideoType$1,normalizeFizConnectorType:normalizeFizConnectorType$1,normalizeViewfinderType:normalizeViewfinderType$1,normalizePowerPortType,fixPowerInput:fixPowerInput$1,applyFixPowerInput,ensureList:ensureList$1,markDevicesNormalized:localMarkDevicesNormalized,hasNormalizedDevicesMarker,unifyDevices:unifyDevices$1,normalizeDevicesForPersistence}=typeof cineDeviceNormalization<"u"?cineDeviceNormalization:typeof globalThis<"u"&&globalThis.cineDeviceNormalization||{};typeof window<"u"&&(window.normalizeDevicesForPersistence=normalizeDevicesForPersistence);const CORE_TEMPERATURE_STORAGE_KEY="__cineTemperatureNote",FOCUS_SCALE_STORAGE_KEY="__cineFocusScale",CORE_TEMPERATURE_UNITS=(function(){const t=TEMPERATURE_SCOPE_CANDIDATES;for(let o=0;o<t.length;o+=1){const r=t[o];try{const n=r.TEMPERATURE_UNITS;if(n&&typeof n=="object"&&typeof n.fahrenheit=="string"&&typeof n.celsius=="string")return n}catch{}}return t.forEach(o=>{try{o.TEMPERATURE_UNITS||(o.TEMPERATURE_UNITS=TEMPERATURE_UNITS_FALLBACK)}catch{}}),TEMPERATURE_UNITS_FALLBACK})();var TEMPERATURE_SCENARIOS=(function(){const t=TEMPERATURE_SCOPE_CANDIDATES;for(let o=0;o<t.length;o+=1){const r=t[o];try{if(Array.isArray(r.TEMPERATURE_SCENARIOS))return r.TEMPERATURE_SCENARIOS}catch{}}return t.forEach(o=>{try{Array.isArray(o.TEMPERATURE_SCENARIOS)||(o.TEMPERATURE_SCENARIOS=[])}catch{}}),[]})();const FOCUS_SCALE_VALUES_FALLBACK=Object.freeze(["metric","imperial"]),focusScaleValues=(function(){const t=TEMPERATURE_SCOPE_CANDIDATES;for(let o=0;o<t.length;o+=1){const r=t[o];try{if(Array.isArray(r.FOCUS_SCALE_VALUES)&&r.FOCUS_SCALE_VALUES.length)return r.FOCUS_SCALE_VALUES}catch{}}return t.forEach(o=>{try{(!Array.isArray(o.FOCUS_SCALE_VALUES)||!o.FOCUS_SCALE_VALUES.length)&&(o.FOCUS_SCALE_VALUES=FOCUS_SCALE_VALUES_FALLBACK)}catch{}}),FOCUS_SCALE_VALUES_FALLBACK})();function resolveFeedbackTemperatureBound(e,t){const o=TEMPERATURE_SCOPE_CANDIDATES;for(let r=0;r<o.length;r+=1){const n=o[r];try{const a=n&&n[e];if(typeof a=="number"&&Number.isFinite(a))return a}catch{}}return o.forEach(r=>{try{const n=r&&r[e];(typeof n!="number"||!Number.isFinite(n))&&(r[e]=t)}catch{}}),t}globalThis.FEEDBACK_TEMPERATURE_MIN_VALUE=resolveFeedbackTemperatureBound("FEEDBACK_TEMPERATURE_MIN",-20);globalThis.FEEDBACK_TEMPERATURE_MAX_VALUE=resolveFeedbackTemperatureBound("FEEDBACK_TEMPERATURE_MAX_LIMIT",50);globalThis.INSTALL_BANNER_DISMISSED_KEY="cine_install_banner_dismissed";globalThis.AUTO_GEAR_BACKUP_RETENTION_MIN_VALUE=1;const CORE_RUNTIME_SUPPORT_EXPORT_NAMESPACE=(function(){const t=[];try{typeof CORE_RUNTIME_SUPPORT_EXPORTS=="object"&&CORE_RUNTIME_SUPPORT_EXPORTS&&t.push(CORE_RUNTIME_SUPPORT_EXPORTS)}catch{}try{typeof cineCoreRuntimeSupportExports<"u"&&cineCoreRuntimeSupportExports&&typeof cineCoreRuntimeSupportExports=="object"&&t.push(cineCoreRuntimeSupportExports)}catch{}for(let o=0;o<t.length;o+=1){const r=t[o];if(r&&typeof r=="object")return r}return null})(),resolveRuntimeModuleLoaderNamespaceResolver=CORE_RUNTIME_SUPPORT_EXPORT_NAMESPACE&&typeof CORE_RUNTIME_SUPPORT_EXPORT_NAMESPACE.resolveRuntimeModuleLoader=="function"?function(){return CORE_RUNTIME_SUPPORT_EXPORT_NAMESPACE.resolveRuntimeModuleLoader()}:fallbackResolveRuntimeModuleLoader,resolvedRuntimeModuleLoader=typeof globalThis=="object"&&globalThis&&typeof globalThis.resolveRuntimeModuleLoader=="function"?globalThis.resolveRuntimeModuleLoader:resolveRuntimeModuleLoaderNamespaceResolver;typeof globalThis=="object"&&globalThis&&typeof globalThis.resolveRuntimeModuleLoader!="function"&&(globalThis.resolveRuntimeModuleLoader=resolvedRuntimeModuleLoader);const requireCoreRuntimeModuleNamespaceResolver=CORE_RUNTIME_SUPPORT_EXPORT_NAMESPACE&&typeof CORE_RUNTIME_SUPPORT_EXPORT_NAMESPACE.requireCoreRuntimeModule=="function"?function(t,o){return CORE_RUNTIME_SUPPORT_EXPORT_NAMESPACE.requireCoreRuntimeModule(t,o)}:fallbackRequireCoreRuntimeModule,resolvedRequireCoreRuntimeModule=typeof globalThis=="object"&&globalThis&&typeof globalThis.requireCoreRuntimeModule=="function"?globalThis.requireCoreRuntimeModule:requireCoreRuntimeModuleNamespaceResolver;typeof globalThis=="object"&&globalThis&&typeof globalThis.requireCoreRuntimeModule!="function"&&(globalThis.requireCoreRuntimeModule=resolvedRequireCoreRuntimeModule);typeof resolveCoreSupportModule>"u"&&(window.resolveCoreSupportModule=function(e,t){if(typeof require=="function")try{return require(t)}catch{return null}return null});let localizationBootstrapWiringRef=typeof localizationBootstrapWiring<"u"?localizationBootstrapWiring:null;if(!localizationBootstrapWiringRef&&typeof require=="function")try{localizationBootstrapWiringRef=require("./app-core-bootstrap.js").localizationBootstrapWiring}catch{}const{localizationSupport:APP_CORE_LOCALIZATION_SUPPORT,localizationRuntimeEnvironment,localizationBridge:CORE_LOCALIZATION_BRIDGE,localizationFallbacks:CORE_LOCALIZATION_FALLBACKS,inlineLocalizationFallbacks:CORE_INLINE_LOCALIZATION_FALLBACKS,localizationFallbackSupport:LOCALIZATION_FALLBACK_SUPPORT,createBasicLocalizationFallbackResolvers,localizationFallbackRegistry:LOCALIZATION_FALLBACK_REGISTRY,localizationFallbackResolvers:LOCALIZATION_FALLBACK_RESOLVERS,localizationFallbackNamespace:LOCALIZATION_FALLBACK_NAMESPACE,fallbackResolveLocaleModule,createLocaleFallbacks}=localizationBootstrapWiringRef||{};resolveCoreSupportModule("cineCoreRuntimeTools","./modules/core/runtime-tools.js");const CORE_RUNTIME_TOOL_FALLBACK_NAMESPACE=resolveCoreSupportModule("cineCoreRuntimeToolFallbacks","./modules/core/runtime-tool-fallbacks.js");resolveCoreSupportModule("cineCoreAppRuntimeToolInlineFallbacks","./modules/app-core/runtime.js");const SETTINGS_DOCUMENTATION_TRACKER_TOOLS=resolveCoreSupportModule("cineCoreAppSettingsDocumentationTracker","./modules/app-core/settings-documentation-tracker.js");let pinkModeSupportApiRef=typeof PINK_MODE_SUPPORT_API<"u"?PINK_MODE_SUPPORT_API:null;pinkModeSupportApiRef||(typeof cineCorePinkModeSupport<"u"?pinkModeSupportApiRef=cineCorePinkModeSupport:typeof window<"u"&&window.cineCorePinkModeSupport?pinkModeSupportApiRef=window.cineCorePinkModeSupport:typeof globalThis<"u"&&globalThis.cineCorePinkModeSupport&&(pinkModeSupportApiRef=globalThis.cineCorePinkModeSupport));if(!pinkModeSupportApiRef&&typeof require=="function")try{pinkModeSupportApiRef=require("./app-core-pink-mode.js").PINK_MODE_SUPPORT_API}catch{}const{pinkModeIcons:pinkModeIcons$2,setPinkModeIconSequence:setPinkModeIconSequence$1,loadPinkModeIconsFromFiles:loadPinkModeIconsFromFiles$1,ensurePinkModeLottieRuntime:ensurePinkModeLottieRuntime$2,resolvePinkModeLottieRuntime:localResolvePinkModeLottieRuntime,startPinkModeAnimatedIcons:startPinkModeAnimatedIcons$1,stopPinkModeAnimatedIcons:stopPinkModeAnimatedIcons$2,triggerPinkModeIconRain:triggerPinkModeIconRain$1,getPinkModeIconRotationTimer,setPinkModeIconRotationTimer,getPinkModeIconIndex,setPinkModeIconIndex,PINK_MODE_ICON_INTERVAL_MS:PINK_MODE_ICON_INTERVAL_MS$1,PINK_MODE_ICON_ANIMATION_CLASS:PINK_MODE_ICON_ANIMATION_CLASS$1,PINK_MODE_ICON_ANIMATION_RESET_DELAY:PINK_MODE_ICON_ANIMATION_RESET_DELAY$1,PINK_MODE_ICON_FALLBACK_MARKUP:PINK_MODE_ICON_FALLBACK_MARKUP$1}=pinkModeSupportApiRef||{};let ensureSvgHasAriaHidden$2=function(e){return e||""};pinkModeSupportApiRef&&typeof pinkModeSupportApiRef.ensureSvgHasAriaHidden=="function"?ensureSvgHasAriaHidden$2=pinkModeSupportApiRef.ensureSvgHasAriaHidden:typeof window<"u"&&typeof window.ensureSvgHasAriaHidden=="function"&&(ensureSvgHasAriaHidden$2=window.ensureSvgHasAriaHidden);function iconMarkup$1(e,t="info-icon",o=null){if(!e)return"";let r={},n="info-icon";typeof t=="string"||t===null?(n=t||"",o&&typeof o=="object"&&(r=o)):t&&typeof t=="object"&&(r=t,n=t.className||"info-icon"),typeof r.className=="string"&&(n=r.className);const a=[];typeof r.size=="string"&&r.size.trim()&&a.push(`--icon - size: ${r.size.trim()} `),typeof r.scale=="string"&&r.scale.trim()&&a.push(`--icon - scale: ${r.scale.trim()} `),typeof r.style=="string"&&r.style.trim()&&a.push(r.style.trim());const s=a.length?` style = "${a.join(";")}"`:"",l=resolveIconGlyph(e),u=["icon-glyph"];if(n&&u.unshift(n),l.markup){l.className&&l.className.split(/\s+/).filter(Boolean).forEach(y=>u.push(y));const m=ensureSvgHasAriaHidden$2(l.markup);return`<span class="${u.join(" ")}"${s} aria-hidden="true">${m}</span>`}const d=l.char||"";return d?`<span class="${u.join(" ")}"${s} data-icon-font="${l.font}" aria-hidden="true">${d}</span>`:""}const PRODUCTION_COMPANY_ICON=iconGlyph$1("",ICON_FONT_KEYS.UICONS),RENTAL_HOUSE_ICON=iconGlyph$1("",ICON_FONT_KEYS.UICONS),ASPECT_RATIO_ICON=iconGlyph$1("",ICON_FONT_KEYS.UICONS),REQUIRED_SCENARIOS_ICON=iconGlyph$1("",ICON_FONT_KEYS.UICONS),MONITORING_SUPPORT_ICON=iconGlyph$1("",ICON_FONT_KEYS.UICONS);exposeCoreRuntimeConstant$1("iconGlyph",iconGlyph$1);exposeCoreRuntimeConstant$1("resolveIconGlyph",resolveIconGlyph);exposeCoreRuntimeConstant$1("applyIconGlyph",applyIconGlyph);exposeCoreRuntimeConstant$1("formatSvgCoordinate",formatSvgCoordinate);exposeCoreRuntimeConstant$1("positionSvgMarkup",positionSvgMarkup);exposeCoreRuntimeConstant$1("iconMarkup",iconMarkup$1);exposeCoreRuntimeConstant$1("ICON_GLYPHS",ICON_GLYPHS);exposeCoreRuntimeConstant$1("pinkModeIcons",pinkModeIcons$2);exposeCoreRuntimeConstant$1("setPinkModeIconSequence",setPinkModeIconSequence$1);exposeCoreRuntimeConstant$1("ensureSvgHasAriaHidden",ensureSvgHasAriaHidden$2);exposeCoreRuntimeConstant$1("ensurePinkModeLottieRuntime",ensurePinkModeLottieRuntime$2);exposeCoreRuntimeConstant$1("resolvePinkModeLottieRuntime",localResolvePinkModeLottieRuntime);exposeCoreRuntimeConstant$1("startPinkModeAnimatedIcons",startPinkModeAnimatedIcons$1);exposeCoreRuntimeConstant$1("stopPinkModeAnimatedIcons",stopPinkModeAnimatedIcons$2);exposeCoreRuntimeConstant$1("triggerPinkModeIconRain",triggerPinkModeIconRain$1);const CORE_RUNTIME_STATE_SUPPORT=(function(){let t=null;if(typeof resolveCoreSupportModule=="function")try{t=resolveCoreSupportModule("cineCoreRuntimeState","./modules/core/runtime-state.js")}catch{t=null}if(!t){const r=resolvedRequireCoreRuntimeModule("modules/core/runtime-state.js");r&&typeof r=="object"&&(t=r)}if(t)return t;const o=resolvedCollectCoreRuntimeCandidateScopes(typeof CORE_GLOBAL_SCOPE$3=="object"?CORE_GLOBAL_SCOPE$3:null);for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object"))try{const a=n.cineCoreRuntimeState;if(a&&typeof a=="object")return a}catch{}}return null})(),CORE_RUNTIME_LOCALIZATION=(function(){if(typeof resolveCoreSupportModule=="function")try{const r=resolveCoreSupportModule("cineCoreRuntimeLocalization","./modules/core/runtime-localization.js");if(r&&typeof r=="object")return r}catch{}const t=[CORE_PART1_RUNTIME_SCOPE$1&&typeof CORE_PART1_RUNTIME_SCOPE$1=="object"?CORE_PART1_RUNTIME_SCOPE$1:null,typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&window&&typeof window=="object"?window:null,typeof self<"u"&&self&&typeof self=="object"?self:null,typeof global<"u"&&global&&typeof global=="object"?global:null];for(let r=0;r<t.length;r+=1){const n=t[r];if(!(!n||typeof n!="object"))try{const a=n.cineCoreRuntimeLocalization;if(a&&typeof a=="object")return a}catch{}}const o=resolvedRequireCoreRuntimeModule("modules/core/runtime-localization.js",{primaryScope:CORE_PART1_RUNTIME_SCOPE$1});return o&&typeof o=="object"?o:null})();CORE_RUNTIME_LOCALIZATION&&typeof CORE_RUNTIME_LOCALIZATION.createLocalizationRuntime=="function"&&CORE_RUNTIME_LOCALIZATION.createLocalizationRuntime({runtimeScope:CORE_PART1_RUNTIME_SCOPE$1,coreGlobalScope:CORE_PART1_RUNTIME_SCOPE$1,localizationBridge:CORE_LOCALIZATION_BRIDGE,localizationFallbacks:CORE_LOCALIZATION_FALLBACKS,inlineLocalizationFallbacks:CORE_INLINE_LOCALIZATION_FALLBACKS,localizationFallbackNamespace:LOCALIZATION_FALLBACK_NAMESPACE,localizationFallbackSupport:LOCALIZATION_FALLBACK_SUPPORT,localizationFallbackRegistry:LOCALIZATION_FALLBACK_REGISTRY,localizationFallbackResolvers:LOCALIZATION_FALLBACK_RESOLVERS,fallbackResolveLocaleModule,createLocaleFallbacks,translationsRequirePath:"./translations.js"});if(CORE_PART1_RUNTIME_SCOPE$1&&CORE_PART1_RUNTIME_SCOPE$1.__cineCorePart1Initialized)typeof console<"u"&&typeof console.warn=="function"&&console.warn("Cine Power Planner core runtime (part 1) already initialized. Skipping duplicate load.");else if(CORE_PART1_RUNTIME_SCOPE$1)try{Object.defineProperty(CORE_PART1_RUNTIME_SCOPE$1,"__cineCorePart1Initialized",{configurable:!0,writable:!0,value:!0})}catch{CORE_PART1_RUNTIME_SCOPE$1.__cineCorePart1Initialized=!0}var localAutoGearConditionSections={},CORE_RUNTIME_TOOL_FALLBACK_FACTORY$1=CORE_RUNTIME_TOOL_FALLBACK_NAMESPACE&&typeof CORE_RUNTIME_TOOL_FALLBACK_NAMESPACE.createRuntimeToolFallbacks=="function"?CORE_RUNTIME_TOOL_FALLBACK_NAMESPACE.createRuntimeToolFallbacks:null;if(!CORE_RUNTIME_TOOL_FALLBACK_FACTORY$1){const e=resolvedRequireCoreRuntimeModule("modules/core/runtime-tool-fallbacks.js",{primaryScope:CORE_PART1_RUNTIME_SCOPE$1});e&&typeof e.createRuntimeToolFallbacks=="function"&&(CORE_RUNTIME_TOOL_FALLBACK_FACTORY$1=e.createRuntimeToolFallbacks)}(function(){const t={queueKey:CORE_TEMPERATURE_QUEUE_KEY,renderName:CORE_TEMPERATURE_RENDER_NAME};if(CORE_RUNTIME_STATE_SUPPORT&&typeof CORE_RUNTIME_STATE_SUPPORT.resolveTemperatureKeyDefaults=="function")try{const o=CORE_RUNTIME_STATE_SUPPORT.resolveTemperatureKeyDefaults();o&&typeof o=="object"&&(typeof o.queueKey=="string"&&o.queueKey&&(t.queueKey=o.queueKey),typeof o.renderName=="string"&&o.renderName&&(t.renderName=o.renderName))}catch{}return(typeof t.queueKey!="string"||!t.queueKey)&&(t.queueKey="__cinePendingTemperatureNote"),(typeof t.renderName!="string"||!t.renderName)&&(t.renderName="renderTemperatureNote"),t})();const CORE_RUNTIME_UI_BRIDGE=(function(){const t=[];if(typeof require=="function")try{const r=require("./app-core-runtime-ui.js");r&&typeof r=="object"&&t.push(r)}catch{}const o=[];try{typeof CORE_GLOBAL_SCOPE$3<"u"&&CORE_GLOBAL_SCOPE$3&&o.push(CORE_GLOBAL_SCOPE$3)}catch{}typeof globalThis<"u"&&globalThis&&o.push(globalThis),typeof window<"u"&&window&&o.push(window),typeof self<"u"&&self&&o.push(self),typeof global<"u"&&global&&o.push(global);for(let r=0;r<o.length;r+=1){const n=o[r];if(n)try{const a=n.cineCoreRuntimeUiBridge;a&&typeof a=="object"&&t.push(a)}catch{}}for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n=="object")return n}return{}})();var escapeHtml$3=typeof CORE_RUNTIME_UI_BRIDGE.escapeHtml=="function"?CORE_RUNTIME_UI_BRIDGE.escapeHtml:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};const escapeButtonLabelSafelyHelper=typeof CORE_RUNTIME_UI_BRIDGE.escapeButtonLabelSafely=="function"?CORE_RUNTIME_UI_BRIDGE.escapeButtonLabelSafely:function(t){return typeof t!="string"||t===""?"":escapeHtml$3(t)},resolveButtonIconMarkupHelper=typeof CORE_RUNTIME_UI_BRIDGE.resolveButtonIconMarkup=="function"?CORE_RUNTIME_UI_BRIDGE.resolveButtonIconMarkup:function(){return""},setButtonLabelWithIconBinding$1=ensureCoreGlobalValue("setButtonLabelWithIcon",function(){return typeof CORE_RUNTIME_UI_BRIDGE.setButtonLabelWithIcon=="function"?CORE_RUNTIME_UI_BRIDGE.setButtonLabelWithIcon:function(o,r,n){if(!o)return;let a=n;if(typeof a>"u")try{typeof ICON_GLYPHS=="object"&&ICON_GLYPHS&&ICON_GLYPHS.save&&(a=ICON_GLYPHS.save)}catch{}const s=resolveButtonIconMarkupHelper(a),l=escapeButtonLabelSafelyHelper(typeof r=="string"?r:"");try{o.innerHTML=`${s}${l} `}catch{}}});if(CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object")try{CORE_GLOBAL_SCOPE$3.setButtonLabelWithIcon=setButtonLabelWithIconBinding$1}catch{CORE_GLOBAL_SCOPE$3.setButtonLabelWithIcon=setButtonLabelWithIconBinding$1}function dispatchTemperatureNoteRender(e){const t=getCoreGlobalObject$1();let o=null;if(!o&&CORE_RUNTIME_STATE$1&&typeof CORE_RUNTIME_STATE$1.getAssignedTemperatureRenderer=="function")try{o=CORE_RUNTIME_STATE$1.getAssignedTemperatureRenderer()}catch{}try{typeof renderTemperatureNote=="function"&&(o=renderTemperatureNote)}catch(n){if(!(n&&(n.name==="ReferenceError"||/is not defined|Cannot access uninitialized/i.test(String(n&&n.message)))))throw n}if(!o&&t&&typeof t=="object")try{const n=t[CORE_TEMPERATURE_RENDER_NAME];typeof n=="function"&&(o=n)}catch{}if(typeof o=="function"){try{o(e)}catch(n){typeof console<"u"&&typeof console.error=="function"&&console.error("Temperature note renderer failed",n)}return}if(!t||typeof t!="object")return;let r=t[CORE_TEMPERATURE_QUEUE_KEY];(!r||typeof r!="object")&&(r={}),r.latestHours=e;try{r.updatedAt=Date.now?Date.now():new Date().getTime()}catch{r.updatedAt=0}t[CORE_TEMPERATURE_QUEUE_KEY]=r}function exposeCoreRuntimeBindings(e){if(!e||typeof e!="object")return;const t=CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object"?CORE_GLOBAL_SCOPE$3:typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;!t||typeof t!="object"||Object.entries(e).forEach(([o,r])=>{if(typeof o!="string"||!o)return;const n=r&&typeof r.get=="function"?r.get:null,a=r&&typeof r.set=="function"?r.set:null;if(n){try{Object.defineProperty(t,o,{configurable:!0,enumerable:!1,get:n,set:a||void 0});return}catch{}try{t[o]=n()}catch{}}})}function runCoreRuntimeSegment(e){if(typeof e!="function")return!1;const t=CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object"?CORE_GLOBAL_SCOPE$3:typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;try{return e.call(t||this),!0}catch(o){typeof console<"u"&&typeof console.error=="function"&&console.error("Cine Power Planner core runtime segment failed to evaluate.",o)}return!1}if(CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object")try{Object.defineProperty(CORE_GLOBAL_SCOPE$3,"__cineCorePart1Runner",{configurable:!0,enumerable:!1,writable:!0,value:runCoreRuntimeSegment})}catch{CORE_GLOBAL_SCOPE$3.__cineCorePart1Runner=runCoreRuntimeSegment}function resolveCoreRuntimeHelpers(){const e=[];if(typeof CORE_PART2_RUNTIME_HELPERS<"u"&&CORE_PART2_RUNTIME_HELPERS&&e.push(CORE_PART2_RUNTIME_HELPERS),CORE_SHARED$2&&typeof CORE_SHARED$2.cineCoreRuntimeHelpers=="object"&&e.push(CORE_SHARED$2.cineCoreRuntimeHelpers),typeof CORE_GLOBAL_SCOPE$3<"u"&&CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3.cineCoreRuntimeHelpers=="object"&&e.push(CORE_GLOBAL_SCOPE$3.cineCoreRuntimeHelpers),typeof CORE_SHARED_SCOPE_PART2<"u"&&CORE_SHARED_SCOPE_PART2&&typeof CORE_SHARED_SCOPE_PART2.cineCoreRuntimeHelpers=="object"&&e.push(CORE_SHARED_SCOPE_PART2.cineCoreRuntimeHelpers),typeof globalThis<"u"&&globalThis&&typeof globalThis.cineCoreRuntimeHelpers=="object"&&e.push(globalThis.cineCoreRuntimeHelpers),typeof window<"u"&&window&&typeof window.cineCoreRuntimeHelpers=="object"&&e.push(window.cineCoreRuntimeHelpers),typeof self<"u"&&self&&typeof self.cineCoreRuntimeHelpers=="object"&&e.push(self.cineCoreRuntimeHelpers),typeof global<"u"&&global&&typeof global.cineCoreRuntimeHelpers=="object"&&e.push(global.cineCoreRuntimeHelpers),typeof require=="function")try{const t=require("./app-core-runtime-helpers.js");t&&typeof t=="object"&&e.push(t)}catch{}for(let t=0;t<e.length;t+=1){const o=e[t];if(o&&typeof o=="object")return o}return null}const CORE_RUNTIME_HELPERS=resolveCoreRuntimeHelpers(),CORE_RUNTIME_FALLBACKS=CORE_RUNTIME_HELPERS&&typeof CORE_RUNTIME_HELPERS=="object"?CORE_RUNTIME_HELPERS:{};function createCoreRuntimeStateFallback(e){const t=[],o=typeof Set=="function"?new Set:null;function r(C){if(!(!C||typeof C!="object"&&typeof C!="function")){if(o){if(o.has(C))return;o.add(C),t.push(C);return}t.indexOf(C)===-1&&t.push(C)}}if(Array.isArray(e))for(let C=0;C<e.length;C+=1)try{r(e[C])}catch{}function n(C){if(typeof C=="function")for(let A=0;A<t.length;A+=1)try{C(t[A],A)}catch{}}function a(){return t.slice()}function s(){return t.length>0?t[0]:null}function l(C,A){const w=typeof A=="function"?A:function(){return A};if(typeof C!="string"||!C)try{return w()}catch{return}for(let R=0;R<t.length;R+=1){const _=t[R];if(!(!_||typeof _!="object"&&typeof _!="function"))try{return typeof _[C]>"u"&&(_[C]=w()),_[C]}catch{}}try{return w()}catch{return}}function u(C,A,w){const R=typeof w=="function"?w:function(){return w},_=typeof A=="function"?A:function(){return!0};n(G=>{try{_(G[C])||(G[C]=R())}catch(O){}})}function d(C){for(let A=0;A<t.length;A+=1){const w=t[A];if(!(!w||typeof w!="object"&&typeof w!="function"))try{if(C in w)return w[C]}catch{}}}let m=null;function y(C){typeof C=="function"&&(m=C,n(A=>{if(!(!A||typeof A!="object"&&typeof A!="function"))try{A[CORE_TEMPERATURE_RENDER_NAME]=C;const w=A[CORE_TEMPERATURE_QUEUE_KEY];if(w&&typeof w=="object"){if(Object.prototype.hasOwnProperty.call(w,"latestHours")){const R=w.latestHours;if(typeof R<"u")try{C(R)}catch(_){typeof console<"u"&&typeof console.error=="function"&&console.error("Failed to apply pending temperature note render",_)}}try{delete w.latestHours}catch(R){w.latestHours=void 0}}}catch(w){}}))}function h(){return m}const b={isReferenceError(){return!1},repair(){}};function v(C){!C||typeof C!="object"||(typeof C.isReferenceError=="function"&&(b.isReferenceError=C.isReferenceError),typeof C.repair=="function"&&(b.repair=C.repair))}return{registerScope:r,withEachScope:n,getScopes:a,getPrimaryScope:s,ensureValue:l,normaliseValue:u,readValue:d,assignTemperatureRenderer:y,getAssignedTemperatureRenderer:h,autoGearGuards:b,setAutoGearGuards:v}}function createCoreRuntimeState(e){if(CORE_RUNTIME_STATE_SUPPORT&&typeof CORE_RUNTIME_STATE_SUPPORT.createLocalRuntimeState=="function")try{return CORE_RUNTIME_STATE_SUPPORT.createLocalRuntimeState(e,{temperatureQueueKey:CORE_TEMPERATURE_QUEUE_KEY,temperatureRenderName:CORE_TEMPERATURE_RENDER_NAME})}catch{}return createCoreRuntimeStateFallback(e)}var CORE_RUNTIME_STATE$1=ensureCoreGlobalValue("__cineRuntimeState",()=>{const e=CORE_RUNTIME_CANDIDATE_SCOPES_RESOLVED.length?CORE_RUNTIME_CANDIDATE_SCOPES_RESOLVED:resolvedCollectCoreRuntimeCandidateScopes(typeof CORE_GLOBAL_SCOPE$3=="object"?CORE_GLOBAL_SCOPE$3:null);return createCoreRuntimeState(e)});if(CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object")try{Object.defineProperty(CORE_GLOBAL_SCOPE$3,"__cineCreateRuntimeState",{configurable:!0,enumerable:!1,writable:!0,value:createCoreRuntimeState})}catch{try{CORE_GLOBAL_SCOPE$3.__cineCreateRuntimeState=createCoreRuntimeState}catch{}}function isAutoGearGlobalReferenceError(e){if(!CORE_RUNTIME_STATE$1||!CORE_RUNTIME_STATE$1.autoGearGuards)return!1;const t=CORE_RUNTIME_STATE$1.autoGearGuards.isReferenceError;if(typeof t!="function")return!1;try{return t(e)===!0}catch{}return!1}function repairAutoGearGlobals(e){if(!CORE_RUNTIME_STATE$1||!CORE_RUNTIME_STATE$1.autoGearGuards)return;const t=CORE_RUNTIME_STATE$1.autoGearGuards.repair;if(typeof t=="function")try{t(e)}catch{}}function callCoreFunctionIfAvailable$1(e,t=[],o={}){const r=CORE_GLOBAL_SCOPE$3||(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null),n=typeof e=="string"?r&&r[e]:e;if(typeof n=="function"){if(n.__cineSessionProxy__===!0){const s=o&&typeof o=="object"?o:{},l=typeof s.attempts=="number"&&Number.isFinite(s.attempts)?s.attempts:0;if(typeof enqueueCoreBootTask$2=="function"&&l<3){const u={...s,defer:!1,attempts:l+1};enqueueCoreBootTask$2(()=>{callCoreFunctionIfAvailable$1(e,t,u)})}return Object.prototype.hasOwnProperty.call(s,"defaultValue")?s.defaultValue:void 0}if(n.__cineDeferredPlaceholder__===!0){const s=o&&typeof o=="object"?o:{},l=typeof s.attempts=="number"&&Number.isFinite(s.attempts)?s.attempts:0;if(typeof enqueueCoreBootTask$2=="function"&&l<3){const u={...s,defer:!1,attempts:l+1};enqueueCoreBootTask$2(()=>{callCoreFunctionIfAvailable$1(e,t,u)})}return}let a=0;for(;a<2;)try{return n.apply(r,t)}catch(s){if(a===0&&isAutoGearGlobalReferenceError(s)){repairAutoGearGlobals(r),a+=1;continue}typeof console<"u"&&typeof console.error=="function"&&console.error(`Failed to invoke ${e} `,s);break}return}return o&&o.defer===!0&&enqueueCoreBootTask$2(()=>{callCoreFunctionIfAvailable$1(e,t,{...o,defer:!1})}),typeof o<"u"&&Object.prototype.hasOwnProperty.call(o,"defaultValue")?o.defaultValue:void 0}exposeCoreRuntimeConstant$1("applyLegacyGridSnapValue",applyLegacyGridSnapValue$1);function safeFormatAutoGearItemSummary(e,t={}){if(typeof formatAutoGearItemSummary=="function")try{return formatAutoGearItemSummary(e,t)}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to format automatic gear item summary via direct formatter.",r)}const o=callCoreFunctionIfAvailable$1("formatAutoGearItemSummary",[e,t],{defaultValue:""});if(typeof o=="string")return o;if(o===null||typeof o>"u")return"";try{return String(o)}catch{return""}}function formatWithPlaceholdersSafe(e,...t){if(typeof formatWithPlaceholders=="function")try{return formatWithPlaceholders(e,...t)}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to format placeholder template via direct formatter.",n)}const o=callCoreFunctionIfAvailable$1("formatWithPlaceholders",[e,...t],{defaultValue:null});if(typeof o=="string"&&o)return o;let r=typeof e=="string"?e:String(e||"");for(let n=0;n<t.length;n+=1){const a=t[n];r=r.replace("%s",a)}return r}(function(){const t=(typeof CORE_GLOBAL_SCOPE$3<"u"?CORE_GLOBAL_SCOPE$3:null)||(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null);if(typeof window<"u")try{window.populateSelect=void 0}catch{}if(!t||typeof t!="object")return;if(typeof t.populateSelect!="function"){const r=function(a,s={},l=!0){if(!a)return;const u=s&&typeof s=="object"?s:{};try{if(a.innerHTML="",l){const d=document.createElement("option");d.value="None";const m={de:"Keine Auswahl",es:"Ninguno",fr:"Aucun"},y=typeof currentLang$1=="string"?currentLang$1:"en";d.textContent=m[y]||"None",a.appendChild(d)}Object.keys(u).filter(d=>d!=="None").sort(typeof localeSort=="function"?localeSort:void 0).forEach(d=>{const m=document.createElement("option");m.value=d,m.textContent=d,a.appendChild(m)})}catch(d){typeof console<"u"&&typeof console.warn=="function"&&console.warn("populateSelect placeholder failed to render options immediately",d)}enqueueCoreBootTask$2(()=>{const d=t&&typeof t.populateSelect=="function"&&t.populateSelect!==r?t.populateSelect:null;d&&d(a,s,l)})};r.__cineDeferredPlaceholder__=!0;try{t.populateSelect=r,typeof window<"u"&&(window.populateSelect=r)}catch(n){console.warn("Failed to assign populateSelect",n)}}const o=r=>{if(typeof r!="string"||!r||typeof t[r]=="function")return;const n=function(...s){return callCoreFunctionIfAvailable$1(r,s,{defer:!0,attempts:0})};n.__cineDeferredPlaceholder__=!0;try{t[r]=n}catch{}};if(o("checkSetupChanged"),o("updateCalculations"),typeof t.feedbackCancelBtn>"u")try{t.feedbackCancelBtn=null}catch{}})();var stableStringify$1=typeof CORE_SHARED$2.stableStringify=="function"?CORE_SHARED$2.stableStringify:typeof CORE_SHARED$2.fallbackStableStringify=="function"?CORE_SHARED$2.fallbackStableStringify:typeof CORE_RUNTIME_FALLBACKS.fallbackStableStringify=="function"?CORE_RUNTIME_FALLBACKS.fallbackStableStringify:function(t){try{return JSON.stringify(t)}catch{}return String(t)};const humanizeKey$1=typeof CORE_SHARED$2.humanizeKey=="function"?CORE_SHARED$2.humanizeKey:typeof CORE_SHARED$2.fallbackHumanizeKey=="function"?CORE_SHARED$2.fallbackHumanizeKey:typeof CORE_RUNTIME_FALLBACKS.fallbackHumanizeKey=="function"?CORE_RUNTIME_FALLBACKS.fallbackHumanizeKey:function(t){const o=typeof t=="string"?t:String(t||"");return o.charAt(0).toUpperCase()+o.slice(1)};function fallbackResolveConnectorSummaryGenerator(){const e=[];typeof globalThis<"u"&&e.push(globalThis),typeof window<"u"&&e.push(window),typeof global<"u"&&e.push(global),typeof self<"u"&&e.push(self);for(const t of e)if(t&&typeof t.generateConnectorSummary=="function")return t.generateConnectorSummary;return null}const resolveConnectorSummaryGenerator=typeof CORE_SHARED$2.resolveConnectorSummaryGenerator=="function"?CORE_SHARED$2.resolveConnectorSummaryGenerator:fallbackResolveConnectorSummaryGenerator;let sessionSafeGenerateConnectorSummary=typeof CORE_SHARED$2.safeGenerateConnectorSummary=="function"?CORE_SHARED$2.safeGenerateConnectorSummary:function(t){if(!t)return"";const o=resolveConnectorSummaryGenerator();if(typeof o!="function")return"";try{return o(t)||""}catch(r){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to generate connector summary",r),""}};const normalizeAutoGearWeightOperator=typeof CORE_SHARED$2.normalizeAutoGearWeightOperator=="function"?CORE_SHARED$2.normalizeAutoGearWeightOperator:typeof CORE_RUNTIME_FALLBACKS.fallbackNormalizeAutoGearWeightOperator=="function"?CORE_RUNTIME_FALLBACKS.fallbackNormalizeAutoGearWeightOperator:function(){return"greater"};typeof CORE_SHARED$2.normalizeAutoGearWeightValue=="function"?CORE_SHARED$2.normalizeAutoGearWeightValue:typeof CORE_RUNTIME_FALLBACKS.fallbackNormalizeAutoGearWeightValue=="function"&&CORE_RUNTIME_FALLBACKS.fallbackNormalizeAutoGearWeightValue;const normalizeAutoGearCameraWeightCondition$1=typeof CORE_SHARED$2.normalizeAutoGearCameraWeightCondition=="function"?CORE_SHARED$2.normalizeAutoGearCameraWeightCondition:typeof CORE_RUNTIME_FALLBACKS.fallbackNormalizeAutoGearCameraWeightCondition=="function"?CORE_RUNTIME_FALLBACKS.fallbackNormalizeAutoGearCameraWeightCondition:function(){return null},formatAutoGearWeight=typeof CORE_SHARED$2.formatAutoGearWeight=="function"?CORE_SHARED$2.formatAutoGearWeight:typeof CORE_RUNTIME_FALLBACKS.fallbackFormatAutoGearWeight=="function"?CORE_RUNTIME_FALLBACKS.fallbackFormatAutoGearWeight:function(t){return Number.isFinite(t)?String(t):""},fallbackGetAutoGearCameraWeightOperatorLabel=typeof CORE_RUNTIME_FALLBACKS.fallbackGetAutoGearCameraWeightOperatorLabel=="function"?CORE_RUNTIME_FALLBACKS.fallbackGetAutoGearCameraWeightOperatorLabel:function(t,o){const r=o||{},n=normalizeAutoGearWeightOperator(t);return n==="less"?r.autoGearCameraWeightOperatorLess||"Lighter than":n==="equal"?r.autoGearCameraWeightOperatorEqual||"Exactly":r.autoGearCameraWeightOperatorGreater||"Heavier than"},getAutoGearCameraWeightOperatorLabel=typeof CORE_SHARED$2.getAutoGearCameraWeightOperatorLabel=="function"?CORE_SHARED$2.getAutoGearCameraWeightOperatorLabel:fallbackGetAutoGearCameraWeightOperatorLabel,fallbackFormatAutoGearCameraWeight=typeof CORE_RUNTIME_FALLBACKS.fallbackFormatAutoGearCameraWeight=="function"?CORE_RUNTIME_FALLBACKS.fallbackFormatAutoGearCameraWeight:function(t,o){if(!t||!Number.isFinite(t.value))return"";const r=getAutoGearCameraWeightOperatorLabel(t.operator,o),n=formatAutoGearWeight(t.value);return r?`${r} ${n} g`:`${n} g`},formatAutoGearCameraWeight=typeof CORE_SHARED$2.formatAutoGearCameraWeight=="function"?CORE_SHARED$2.formatAutoGearCameraWeight:fallbackFormatAutoGearCameraWeight;var LZString$1=CORE_SHARED$2.LZString;!LZString$1&&typeof CORE_SHARED$2.getLZString=="function"&&(LZString$1=CORE_SHARED$2.getLZString());LZString$1||(LZString$1={compressToEncodedURIComponent:e=>e,decompressFromEncodedURIComponent:e=>e});var generatePrintableOverview$2;try{({generatePrintableOverview:generatePrintableOverview$2}=require("./overview.js"))}catch{}function resolveAppVersionScope(){return typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null}function extractAppVersion(e){return e?typeof e=="string"?e:typeof e.APP_VERSION=="string"?e.APP_VERSION:typeof e.default=="string"?e.default:typeof e.version=="string"?e.version:null:null}function resolveAppVersionValue(){if(typeof CORE_SHARED$2.APP_VERSION=="string"&&CORE_SHARED$2.APP_VERSION)return CORE_SHARED$2.APP_VERSION;const e=resolveAppVersionScope();if(e&&typeof e.CPP_APP_VERSION=="string"&&e.CPP_APP_VERSION)return e.CPP_APP_VERSION;if(e&&typeof e.APP_VERSION=="string"&&e.APP_VERSION)return e.APP_VERSION;if(typeof require=="function")try{const t=require("../../app-version.js"),o=extractAppVersion(t);if(o)return o}catch{}return"0.0.0"}var APP_VERSION$2=resolveAppVersionValue();typeof localResolvePinkModeLottieRuntime=="function"?localResolvePinkModeLottieRuntime():typeof window.resolvePinkModeLottieRuntime=="function"&&window.resolvePinkModeLottieRuntime();var IOS_PWA_HELP_STORAGE_KEY$1="iosPwaHelpShown";const INSTALL_BANNER_DISMISSED_KEY="installPromptDismissed";function resolveInstallBannerGlobalScope$1(){return typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null}const installBannerGlobalScope=resolveInstallBannerGlobalScope$1();installBannerGlobalScope&&typeof installBannerGlobalScope.installBannerDismissedInSession!="boolean"&&(installBannerGlobalScope.installBannerDismissedInSession=!1);const HELP_MODULE_CACHE_KEY="__cineResolvedHelpModule";function createHelpModuleFallback(){return{resolveIosPwaHelpStorageKey(e){return typeof e=="string"&&e?e:IOS_PWA_HELP_STORAGE_KEY$1},isIosDevice(){return!1},isAndroidDevice(){return!1},isStandaloneDisplayMode(){return!1},hasDismissedIosPwaHelp(){return!1},markIosPwaHelpDismissed(){},shouldShowIosPwaHelp(){return!1}}}function resolveHelpModuleApi$1(){const e=getCoreGlobalObject$1();if(e&&e[HELP_MODULE_CACHE_KEY])return e[HELP_MODULE_CACHE_KEY];const t=typeof cineModuleBase=="object"&&cineModuleBase||(e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null);function o(l,u){if(t&&typeof t.safeWarn=="function")try{t.safeWarn(l,u);return}catch{}if(typeof console<"u"&&console&&typeof console.warn=="function")try{typeof u>"u"?console.warn(l):console.warn(l,u)}catch{}}const r=[];if(t&&typeof t.getModuleRegistry=="function"){let l=null;try{l=t.getModuleRegistry(e)}catch(u){o("Unable to resolve cine.features.help module registry.",u)}if(l&&typeof l.get=="function")try{const u=l.get("cine.features.help");u&&r.indexOf(u)===-1&&r.push(u)}catch(u){o("Unable to read cine.features.help module.",u)}}const n=[];e&&n.indexOf(e)===-1&&n.push(e),typeof globalThis<"u"&&n.indexOf(globalThis)===-1&&n.push(globalThis),typeof window<"u"&&n.indexOf(window)===-1&&n.push(window),typeof self<"u"&&n.indexOf(self)===-1&&n.push(self),typeof global<"u"&&n.indexOf(global)===-1&&n.push(global);for(let l=0;l<n.length;l+=1){const u=n[l];if(!(!u||typeof u!="object"&&typeof u!="function")){try{const d=u.cineFeaturesHelp;d&&r.indexOf(d)===-1&&r.push(d)}catch{}try{const d=u.cineHelpModule;d&&typeof d=="object"&&d&&typeof d.help=="object"&&r.indexOf(d.help)===-1&&r.push(d.help)}catch{}if(typeof u.__cineCreateHelpModule=="function")try{const d=u.__cineCreateHelpModule();d&&typeof d=="object"&&(typeof d.help=="object"&&r.indexOf(d.help)===-1?r.push(d.help):r.indexOf(d)===-1&&r.push(d))}catch(d){o("Unable to instantiate cine.features.help module.",d)}}}let a=null;for(let l=0;l<r.length;l+=1){const u=r[l];if(u&&typeof u=="object"&&typeof u.isIosDevice=="function"){a=u;break}if(u&&typeof u=="object"&&typeof u.help=="object"&&typeof u.help.isIosDevice=="function"){a=u.help;break}}const s=a||createHelpModuleFallback();if(e)try{e[HELP_MODULE_CACHE_KEY]=s}catch{}return s}const CONTACTS_MODULE_CACHE_KEY="__cineContactsModuleCache__",OWN_GEAR_MODULE_CACHE_KEY="__cineOwnGearModuleCache__",LEGACY_CONTACTS_OWN_GEAR_MODULE_CACHE_KEY="__cineContactsOwnGearModuleCache__";function cacheFeatureModule(e,t,o){try{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:o});return}catch{}try{e[t]=o}catch{}}function resolveLegacyContactsOwnGearModule(){const e=getCoreGlobalObject$1();if(!e||typeof e!="object"&&typeof e!="function")return null;if(Object.prototype.hasOwnProperty.call(e,LEGACY_CONTACTS_OWN_GEAR_MODULE_CACHE_KEY))return e[LEGACY_CONTACTS_OWN_GEAR_MODULE_CACHE_KEY];const t=[],o=typeof cineModuleBase=="object"&&cineModuleBase||(e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null);if(o&&typeof o.getModuleRegistry=="function")try{const a=o.getModuleRegistry(e);if(a&&typeof a.get=="function"){const s=a.get("cine.features.contactsOwnGear");s&&t.indexOf(s)===-1&&t.push(s)}}catch{}const r=[];r.indexOf(e)===-1&&r.push(e),typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let a=0;a<r.length;a+=1){const s=r[a];if(!(!s||typeof s!="object"&&typeof s!="function"))try{const l=s.cineFeaturesContactsOwnGear;l&&typeof l=="object"&&t.indexOf(l)===-1&&t.push(l)}catch{}}const n=t.find(a=>a&&typeof a=="object")||null;return cacheFeatureModule(e,LEGACY_CONTACTS_OWN_GEAR_MODULE_CACHE_KEY,n),n}function resolveContactsModule(){const e=getCoreGlobalObject$1();if(!e||typeof e!="object"&&typeof e!="function")return null;if(Object.prototype.hasOwnProperty.call(e,CONTACTS_MODULE_CACHE_KEY))return e[CONTACTS_MODULE_CACHE_KEY];const t=[],o=typeof cineModuleBase=="object"&&cineModuleBase||(e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null);if(o&&typeof o.getModuleRegistry=="function")try{const a=o.getModuleRegistry(e);if(a&&typeof a.get=="function"){const s=a.get("cine.features.contacts");s&&t.indexOf(s)===-1&&t.push(s)}}catch{}const r=[];r.indexOf(e)===-1&&r.push(e),typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let a=0;a<r.length;a+=1){const s=r[a];if(!(!s||typeof s!="object"&&typeof s!="function"))try{const l=s.cineFeaturesContacts;l&&typeof l=="object"&&t.indexOf(l)===-1&&t.push(l)}catch{}}const n=t.find(a=>a&&typeof a=="object")||resolveLegacyContactsOwnGearModule()||null;return cacheFeatureModule(e,CONTACTS_MODULE_CACHE_KEY,n),n}function resolveOwnGearModule$1(){const e=getCoreGlobalObject$1();if(!e||typeof e!="object"&&typeof e!="function")return null;if(Object.prototype.hasOwnProperty.call(e,OWN_GEAR_MODULE_CACHE_KEY))return e[OWN_GEAR_MODULE_CACHE_KEY];const t=[],o=typeof cineModuleBase=="object"&&cineModuleBase||(e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null);if(o&&typeof o.getModuleRegistry=="function")try{const a=o.getModuleRegistry(e);if(a&&typeof a.get=="function"){const s=a.get("cine.features.ownGear");s&&t.indexOf(s)===-1&&t.push(s)}}catch{}const r=[];r.indexOf(e)===-1&&r.push(e),typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let a=0;a<r.length;a+=1){const s=r[a];if(!(!s||typeof s!="object"&&typeof s!="function"))try{const l=s.cineFeaturesOwnGear;l&&typeof l=="object"&&t.indexOf(l)===-1&&t.push(l)}catch{}}const n=t.find(a=>a&&typeof a=="object")||resolveLegacyContactsOwnGearModule()||null;return cacheFeatureModule(e,OWN_GEAR_MODULE_CACHE_KEY,n),n}var helpModuleApi=resolveHelpModuleApi$1();globalThis.helpModuleApi=helpModuleApi;var deviceSchema$1=null;function resolveCoreDeviceSchema(){const e=[];typeof CORE_GLOBAL_SCOPE$3<"u"&&CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object"&&e.push(CORE_GLOBAL_SCOPE$3),typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"&&e.push(globalThis),typeof window<"u"&&window&&typeof window=="object"&&e.push(window),typeof self<"u"&&self&&typeof self=="object"&&e.push(self),typeof global<"u"&&global&&typeof global=="object"&&e.push(global);for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object")){if(o.CORE_DEVICE_SCHEMA&&typeof o.CORE_DEVICE_SCHEMA=="object")return o.CORE_DEVICE_SCHEMA;if(o.cineCoreDeviceSchema&&typeof o.cineCoreDeviceSchema=="object")return o.cineCoreDeviceSchema}}return null}const deviceSchemaManager=(function(){const t=resolveCoreDeviceSchema();if(t&&typeof t.createDeviceSchemaManager=="function")try{return t.createDeviceSchemaManager({onSchemaChange:o=>{deviceSchema$1=o},populateCategoryOptions:()=>{try{populateCategoryOptions()}catch(o){console.error("populateCategoryOptions failed during scheduled execution",o)}}})}catch(o){console.warn("Failed to initialize device schema manager from core module",o)}return null})(),DEVICE_SCHEMA_PATH$1=deviceSchemaManager&&deviceSchemaManager.DEVICE_SCHEMA_PATH||"src/data/schema.json",loadDeviceSchemaFromCacheStorage$1=deviceSchemaManager&&typeof deviceSchemaManager.loadDeviceSchemaFromCacheStorage=="function"?deviceSchemaManager.loadDeviceSchemaFromCacheStorage:async()=>null,finalizeDeviceSchemaLoad=deviceSchemaManager&&typeof deviceSchemaManager.finalizeDeviceSchemaLoad=="function"?deviceSchemaManager.finalizeDeviceSchemaLoad:()=>{},isValidDeviceSchema$1=deviceSchemaManager&&typeof deviceSchemaManager.isValidDeviceSchema=="function"?deviceSchemaManager.isValidDeviceSchema:e=>e&&typeof e=="object"&&!Array.isArray(e),cachedDeviceSchema=deviceSchemaManager&&typeof deviceSchemaManager.getCachedDeviceSchema=="function"?deviceSchemaManager.getCachedDeviceSchema():null;if(deviceSchemaManager&&typeof deviceSchemaManager.getDeviceSchema=="function"){const e=deviceSchemaManager.getDeviceSchema();e&&(deviceSchema$1=e)}const applyDeviceSchema=deviceSchemaManager&&typeof deviceSchemaManager.setDeviceSchema=="function"?e=>deviceSchemaManager.setDeviceSchema(e):e=>(isValidDeviceSchema$1(e)?deviceSchema$1=e:deviceSchema$1||(deviceSchema$1={}),deviceSchema$1);let bundledSchema=null,contactsProfileModule=null,contactsListModule=null;const CONTACTS_PROFILE_GLOBAL_KEY="CINE_CONTACTS_PROFILE_MODULE",CONTACTS_LIST_GLOBAL_KEY="CINE_CONTACTS_LIST_MODULE",canRequireModule=typeof require=="function";if(canRequireModule){try{bundledSchema=require("../data/schema.json")}catch{}try{contactsProfileModule=require("./contacts/profile.js")}catch(e){console.warn("Failed to load contacts profile module",e)}try{contactsListModule=require("./contacts/list.js")}catch(e){console.warn("Failed to load contacts list module",e)}}const contactsModuleGlobalScope=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof window<"u"&&window||typeof global<"u"&&global||null,readContactsModuleFromGlobal=e=>{if(!contactsModuleGlobalScope||!e)return null;try{return contactsModuleGlobalScope[e]||null}catch(t){return console.warn("Failed to read contacts module from global scope",t),null}};contactsProfileModule||(contactsProfileModule=readContactsModuleFromGlobal(CONTACTS_PROFILE_GLOBAL_KEY));contactsListModule||(contactsListModule=readContactsModuleFromGlobal(CONTACTS_LIST_GLOBAL_KEY));(!contactsProfileModule||!contactsListModule)&&console.warn("Module loader is not available in this environment. Contacts features limited.");const fallbackSanitizeContactValue=e=>typeof e=="string"?e.trim():"",fallbackNormalizeContactEntry=e=>({id:fallbackSanitizeContactValue(e&&e.id)||`contact - ${Date.now().toString(36)} `,name:fallbackSanitizeContactValue(e&&e.name),role:fallbackSanitizeContactValue(e&&e.role),phone:fallbackSanitizeContactValue(e&&e.phone),email:fallbackSanitizeContactValue(e&&e.email),website:fallbackSanitizeContactValue(e&&e.website),avatar:typeof e?.avatar=="string"?e.avatar:"",createdAt:Number.isFinite(e?.createdAt)?e.createdAt:Date.now(),updatedAt:Number.isFinite(e?.updatedAt)?e.updatedAt:Date.now()});function createFallbackProfileController(){const e={name:"",role:"",avatar:"",phone:"",email:""},t=new Set,o=()=>({...e}),r=()=>{const n=o();return t.forEach(a=>{try{a(n)}catch(s){console.warn("Profile listener failed in fallback controller",s)}}),n};return{assignUserProfileState(n={}){return Object.assign(e,n),r()},getUserProfileSnapshot:o,handleFieldInput(n,a){return n?(e[n]=typeof a=="string"?a:"",r(),!0):!1},handleFieldBlur(){},load(n){return n&&typeof n=="object"&&Object.assign(e,n),r()},setAvatar(n){e.avatar=typeof n=="string"?n:"",r()},clearAvatar(){return e.avatar?(e.avatar="",r(),!0):!1},onChange(n){return typeof n!="function"?()=>{}:(t.add(n),()=>t.delete(n))},schedulePersist(){},markDirty(){},setPendingAnnouncement(){}}}const{CONTACT_AVATAR_MAX_BYTES:resolvedContactAvatarMaxBytes=300*1024,CONTACT_AVATAR_MAX_SOURCE_BYTES:resolvedContactAvatarMaxSourceBytes=6*1024*1024,CONTACT_AVATAR_MAX_DIMENSION:resolvedContactAvatarMaxDimension=256,CONTACT_AVATAR_JPEG_QUALITY:resolvedContactAvatarJpegQuality=.85,CONTACT_AVATAR_JPEG_MIN_QUALITY:resolvedContactAvatarJpegMinQuality=.55,createProfileController:resolvedCreateProfileController,estimateDataUrlSize:resolvedEstimateDataUrlSize,optimiseAvatarDataUrl:resolvedOptimiseAvatarDataUrl,readAvatarFile:resolvedReadAvatarFile,isSafeImageUrl:resolvedIsSafeImageUrl}=contactsProfileModule||{},{sanitizeContactValue:resolvedSanitizeContactValue,normalizeContactEntry:resolvedNormalizeContactEntry,sortContacts:resolvedSortContacts,parseVCard:resolvedParseVCardEntries,mergeImportedContacts:resolvedMergeImportedContacts,createCrewRowSync:resolvedCreateCrewRowSync}=contactsListModule||{},localCreateProfileController=typeof resolvedCreateProfileController=="function"?resolvedCreateProfileController:createFallbackProfileController,localReadAvatarFile=typeof resolvedReadAvatarFile=="function"?resolvedReadAvatarFile:typeof readAvatarFile=="function"?readAvatarFile:typeof window<"u"&&typeof window.readAvatarFile=="function"?window.readAvatarFile:(e,t,o)=>{if(e)try{const r=new FileReader;r.onload=()=>{typeof t=="function"&&t(r.result)},r.onerror=()=>{typeof o=="function"&&o("readError")},r.readAsDataURL(e)}catch{typeof o=="function"&&o("readError")}},localIsSafeImageUrl=typeof resolvedIsSafeImageUrl=="function"?resolvedIsSafeImageUrl:e=>typeof e!="string"?!1:e.startsWith("data:image/"),sanitizeContactValueHelper=typeof resolvedSanitizeContactValue=="function"?resolvedSanitizeContactValue:fallbackSanitizeContactValue,normalizeContactEntryHelper=typeof resolvedNormalizeContactEntry=="function"?resolvedNormalizeContactEntry:fallbackNormalizeContactEntry,sortContactsHelper=typeof resolvedSortContacts=="function"?resolvedSortContacts:e=>Array.isArray(e)?e.slice():[],parseVCardEntries=typeof resolvedParseVCardEntries=="function"?resolvedParseVCardEntries:()=>[],mergeImportedContactEntries=typeof resolvedMergeImportedContacts=="function"?resolvedMergeImportedContacts:e=>({contacts:sortContactsHelper([...e?.existing||[],...e?.imported||[]]),added:Array.isArray(e?.imported)?e.imported.length:0,updated:0}),localCreateCrewRowSync=typeof resolvedCreateCrewRowSync=="function"?resolvedCreateCrewRowSync:(e={},t={})=>({...e,...t});try{if(console.log("[deviceSchema] Attempting to apply bundledSchema:",bundledSchema?"exists":"null"),bundledSchema){const e=applyDeviceSchema(bundledSchema);e&&(deviceSchema$1=e,console.log("[deviceSchema] Successfully applied bundledSchema"))}if(!deviceSchema$1||!Object.keys(deviceSchema$1).length){if(console.log("[deviceSchema] bundledSchema not available, attempting fetch from:",DEVICE_SCHEMA_PATH$1),!deviceSchema$1&&cachedDeviceSchema){const e=applyDeviceSchema(cachedDeviceSchema);e&&(deviceSchema$1=e,console.log("[deviceSchema] Applied cached schema as fallback"))}typeof fetch=="function"?fetch(DEVICE_SCHEMA_PATH$1).then(e=>{if(!e||!e.ok)throw new Error(`Unexpected response when loading schema.json: ${e?e.status:"no response"} `);return e.json()}).then(e=>{console.log("[deviceSchema] Successfully fetched schema.json, applying..."),finalizeDeviceSchemaLoad(e),e&&typeof e=="object"&&(deviceSchema$1=e,console.log("[deviceSchema] deviceSchema updated from fetch. Categories:",Object.keys(deviceSchema$1)))}).catch(e=>{console.warn("Failed to fetch schema.json",e),loadDeviceSchemaFromCacheStorage$1().then(t=>{isValidDeviceSchema$1(t)?finalizeDeviceSchemaLoad(t):finalizeDeviceSchemaLoad(deviceSchema$1)}).catch(t=>{console.warn("Failed to load schema.json from cache storage",t),finalizeDeviceSchemaLoad(deviceSchema$1)})}):finalizeDeviceSchemaLoad(deviceSchema$1)}}catch(e){console.error("[deviceSchema] Error in schema loading:",e)}const LEGAL_LINKS={de:{imprint:"legal/impressum.html",privacy:"legal/datenschutz.html"},en:{imprint:"legal/impressum-en.html",privacy:"legal/datenschutz-en.html"},es:{imprint:"legal/impressum-es.html",privacy:"legal/datenschutz-es.html"},fr:{imprint:"legal/impressum-fr.html",privacy:"legal/datenschutz-fr.html"},it:{imprint:"legal/impressum-it.html",privacy:"legal/datenschutz-it.html"}};function resolveAutoGearStorageKey(e,t){const o=readGlobalAutoGearValue(e);return typeof o=="string"&&o?o:t}const AUTO_GEAR_RULES_KEY$1=resolveAutoGearStorageKey("AUTO_GEAR_RULES_STORAGE_KEY","cameraPowerPlanner_autoGearRules"),AUTO_GEAR_ANY_MOTOR_TOKEN$1="__any__";typeof globalThis<"u"&&(globalThis.AUTO_GEAR_ANY_MOTOR_TOKEN=AUTO_GEAR_ANY_MOTOR_TOKEN$1);const AUTO_GEAR_SEEDED_KEY=resolveAutoGearStorageKey("AUTO_GEAR_SEEDED_STORAGE_KEY","cameraPowerPlanner_autoGearSeeded"),AUTO_GEAR_RETENTION_DEFAULT_FALLBACK=36,AUTO_GEAR_RETENTION_MIN_FALLBACK=1,AUTO_GEAR_RETENTION_MAX_FALLBACK=50,AUTO_GEAR_BACKUP_RETENTION_MAX$1=50;function readGlobalAutoGearValue(e){const t=[CORE_PART1_RUNTIME_SCOPE$1&&typeof CORE_PART1_RUNTIME_SCOPE$1=="object"?CORE_PART1_RUNTIME_SCOPE$1:null,CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1&&(typeof CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1=="object"||typeof CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1=="function")?CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r!="object"&&typeof r!="function"))try{const n=r[e];if(typeof n<"u")return n}catch{}}}function resolveAutoGearBackupRetentionMin(){const e=[],t=readGlobalAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_MIN");typeof t<"u"&&e.push(t);for(let o=0;o<e.length;o+=1){const r=Number(e[o]);if(!Number.isFinite(r))continue;const n=Math.round(r);if(n>=AUTO_GEAR_RETENTION_MIN_FALLBACK)return n}return AUTO_GEAR_RETENTION_MIN_FALLBACK}function resolveAutoGearBackupRetentionDefault(){const e=resolveAutoGearBackupRetentionMin(),t=typeof CORE_GLOBAL_SCOPE$3<"u"&&CORE_GLOBAL_SCOPE$3?CORE_GLOBAL_SCOPE$3:typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null,o=t&&typeof t.AUTO_GEAR_BACKUP_RETENTION_MAX<"u"?t.AUTO_GEAR_BACKUP_RETENTION_MAX:void 0,r=typeof o<"u"?o:readGlobalAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_MAX"),n=Number(r),a=Number.isFinite(n)&&n>=e?Math.min(Math.round(n),AUTO_GEAR_RETENTION_MAX_FALLBACK):AUTO_GEAR_RETENTION_MAX_FALLBACK,s=y=>{const h=Number(y);if(!Number.isFinite(h))return null;const b=Math.round(h);return b<e?e:b>a?a:b},l=[],u=t&&typeof t.AUTO_GEAR_BACKUP_RETENTION_DEFAULT<"u"?t.AUTO_GEAR_BACKUP_RETENTION_DEFAULT:void 0;typeof u<"u"&&l.push(u);const d=readGlobalAutoGearValue("AUTO_GEAR_BACKUP_RETENTION_DEFAULT");if(typeof d<"u"&&l.push(d),typeof getAutoGearBackupRetentionDefault=="function")try{l.push(getAutoGearBackupRetentionDefault())}catch{}for(let y=0;y<l.length;y+=1){const h=s(l[y]);if(h!==null)return h}const m=s(AUTO_GEAR_RETENTION_DEFAULT_FALLBACK);return m===null?e:m}resolveAutoGearStorageKey("AUTO_GEAR_BACKUPS_STORAGE_KEY","cameraPowerPlanner_autoGearBackups");resolveAutoGearStorageKey("AUTO_GEAR_PRESETS_STORAGE_KEY","cameraPowerPlanner_autoGearPresets");resolveAutoGearStorageKey("AUTO_GEAR_ACTIVE_PRESET_STORAGE_KEY","cameraPowerPlanner_autoGearActivePreset");resolveAutoGearStorageKey("AUTO_GEAR_AUTO_PRESET_STORAGE_KEY","cameraPowerPlanner_autoGearAutoPreset");resolveAutoGearStorageKey("AUTO_GEAR_BACKUP_VISIBILITY_STORAGE_KEY","cameraPowerPlanner_autoGearShowBackups");resolveAutoGearStorageKey("AUTO_GEAR_BACKUP_RETENTION_STORAGE_KEY","cameraPowerPlanner_autoGearBackupRetention");resolveAutoGearStorageKey("AUTO_GEAR_MONITOR_DEFAULTS_STORAGE_KEY","cameraPowerPlanner_autoGearMonitorDefaults");const AUTO_GEAR_BACKUP_RETENTION_MIN_VALUE=resolveAutoGearBackupRetentionMin(),AUTO_GEAR_BACKUP_RETENTION_DEFAULT=resolveAutoGearBackupRetentionDefault(),AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS$1=1;var AUTO_GEAR_CUSTOM_CATEGORY$1="";const GEAR_LIST_CATEGORIES$1=["Camera","Camera Support","Media","Lens","Lens Support","Matte box + filter","LDS (FIZ)","Camera Batteries","Monitoring Batteries","Chargers","Monitoring","Monitoring support","Rigging","Power","Grip","Carts and Transportation","Miscellaneous","Consumables"],AUTO_GEAR_SELECTOR_TYPES=["none","monitor","directorMonitor","tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader","fizHandUnit"],AUTO_GEAR_SELECTOR_TYPE_MAP$1=AUTO_GEAR_SELECTOR_TYPES.reduce((e,t)=>(e[t.toLowerCase()]=t,e),Object.create(null)),AUTO_GEAR_SELECTOR_TYPE_SET$1=new Set(Object.keys(AUTO_GEAR_SELECTOR_TYPE_MAP$1)),AUTO_GEAR_MONITOR_FALLBACKS=["SmallHD Ultra 7","SmallHD Focus","SmallHD Cine 7"],AUTO_GEAR_TRIPOD_SELECTOR_TYPES$1=new Set(["tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader"]),AUTO_GEAR_TRIPOD_FIELD_IDS$1={tripodHeadBrand:"tripodHeadBrand",tripodBowl:"tripodBowl",tripodTypes:"tripodTypes",tripodSpreader:"tripodSpreader"};exposeCoreRuntimeConstant$1("AUTO_GEAR_SELECTOR_TYPE_MAP",AUTO_GEAR_SELECTOR_TYPE_MAP$1);exposeCoreRuntimeConstant$1("AUTO_GEAR_SELECTOR_TYPE_SET",AUTO_GEAR_SELECTOR_TYPE_SET$1);exposeCoreRuntimeConstant$1("AUTO_GEAR_TRIPOD_SELECTOR_TYPES",AUTO_GEAR_TRIPOD_SELECTOR_TYPES$1);exposeCoreRuntimeConstant$1("AUTO_GEAR_TRIPOD_FIELD_IDS",AUTO_GEAR_TRIPOD_FIELD_IDS$1);exposeCoreRuntimeConstant$1("AUTO_GEAR_CUSTOM_CATEGORY",AUTO_GEAR_CUSTOM_CATEGORY$1);exposeCoreRuntimeConstant$1("GEAR_LIST_CATEGORIES",GEAR_LIST_CATEGORIES$1);const AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUP_DATA=Object.freeze([{key:"tilta-nucleus-m",label:"Tilta Nucleus ecosystem (M / M II)",motors:Object.freeze(["Tilta Nucleus M","Tilta Nucleus M II"]),options:Object.freeze(["Tilta Nucleus-M FIZ Hand Unit","Tilta Nucleus-M II FIZ Hand Unit","Tilta Nucleus Nano II Hand Controller"]),defaultOption:"Tilta Nucleus-M FIZ Hand Unit"},{key:"tilta-nucleus-nano",label:"Tilta Nucleus Nano ecosystem",motors:Object.freeze(["Tilta Nucleus Nano (Original)","Tilta Nucleus Nano II"]),options:Object.freeze(["Tilta Nucleus Nano Hand Wheel Controller","Tilta Nucleus Nano II Hand Controller"]),defaultOption:"Tilta Nucleus Nano Hand Wheel Controller"},{key:"arri-lbus",label:"ARRI / cmotion LBUS ecosystem",motors:Object.freeze(["Arri Cforce Mini","Arri Cforce Plus","Arri CLM-3","Arri CLM-4 (K2.72114.0)","Arri CLM-5 (K2.0006361)","Arri cforce mini RF (KK.0040345)","Cmotion cPRO"]),options:Object.freeze(["Arri Hi-5","Arri WCU-4","Arri SXU-1","cmotion cPRO hand unit"]),defaultOption:"Arri Hi-5"},{key:"teradek-rt",label:"Teradek RT ecosystem",motors:Object.freeze(["Teradek RT Motion FIZ (MOTR.S)"]),options:Object.freeze(["Teradek RT CTRL.3"]),defaultOption:"Teradek RT CTRL.3"},{key:"preston",label:"Preston ecosystem",motors:Object.freeze(["Preston DM1X","Preston DM2","Preston DM2X","Preston DM-A","Preston DM-C"]),options:Object.freeze(["Preston Hand Unit 4 (HU4)"]),defaultOption:"Preston Hand Unit 4 (HU4)"},{key:"chrosziel",label:"Chrosziel MagNum ecosystem",motors:Object.freeze(["Chrosziel CDM-100 Digital","Chrosziel CDM-M (Universal Zoom Servo Drive)"]),options:Object.freeze(["Chrosziel MagNum Hand Unit (MN-100R)"]),defaultOption:"Chrosziel MagNum Hand Unit (MN-100R)"},{key:"dji-focus",label:"DJI Focus ecosystem",motors:Object.freeze(["DJI Focus (Original)"]),options:Object.freeze(["DJI Focus Hand Unit"]),defaultOption:"DJI Focus Hand Unit"},{key:"dji-focus-pro",label:"DJI Focus Pro ecosystem",motors:Object.freeze(["DJI RS Focus (2022)","DJI Focus Pro Motor"]),options:Object.freeze(["DJI RS Focus Wheel (2022)","DJI Focus Pro Hand Unit"]),defaultOption:"DJI Focus Pro Hand Unit"},{key:"smallrig-magicfiz",label:"SmallRig MagicFIZ ecosystem",motors:Object.freeze(["SmallRig Wireless Follow Focus"]),options:Object.freeze(["SmallRig MagicFIZ Wireless Handgrip"]),defaultOption:"SmallRig MagicFIZ Wireless Handgrip"},{key:"redrock-microremote",label:"Redrock microRemote ecosystem",motors:Object.freeze(["Redrock MicroRemote Torque"]),options:Object.freeze(["Redrock microRemote Hand Controller"]),defaultOption:"Redrock microRemote Hand Controller"}]),AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS$1=(()=>{const e=Object.create(null);return AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUP_DATA.forEach(t=>{if(!t||!t.key||!Array.isArray(t.options)||!t.options.length)return;const o=t.key,r=Array.from(new Set(t.options.filter(Boolean)));r.length&&(e[o]=Object.freeze({key:o,label:t.label||"",motors:t.motors||[],options:Object.freeze(r),defaultOption:r.includes(t.defaultOption)?t.defaultOption:r[0]}))}),Object.freeze(e)})(),AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP$1=(()=>{const e=Object.create(null);return Object.values(AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS$1).forEach(t=>{!t||!Array.isArray(t.motors)||t.motors.forEach(o=>{const r=normalizeAutoGearTriggerValue$1(o);!r||Object.prototype.hasOwnProperty.call(e,r)||(e[r]=t.key)})}),Object.freeze(e)})();typeof globalThis<"u"&&(globalThis.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS=AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS$1,globalThis.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP=AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP$1);var autoGearRules$2=typeof readAutoGearRulesFromStorage=="function"?readAutoGearRulesFromStorage():[],baseAutoGearRulesState$1=autoGearRules$2.slice(),projectScopedAutoGearRules$1=null,autoGearBackupRetention$1=typeof readAutoGearBackupRetentionFromStorage=="function"?readAutoGearBackupRetentionFromStorage():AUTO_GEAR_BACKUP_RETENTION_DEFAULT,autoGearBackups$1=typeof readAutoGearBackupsFromStorage=="function"?readAutoGearBackupsFromStorage(autoGearBackupRetention$1):[];typeof readAutoGearPresetsFromStorage=="function"&&readAutoGearPresetsFromStorage();typeof readActiveAutoGearPresetIdFromStorage=="function"&&readActiveAutoGearPresetIdFromStorage();var autoGearAutoPresetIdState=typeof readAutoGearAutoPresetIdFromStorage=="function"?readAutoGearAutoPresetIdFromStorage():"";typeof readAutoGearBackupVisibilityFromStorage=="function"&&readAutoGearBackupVisibilityFromStorage();var autoGearMonitorDefaults=typeof readAutoGearMonitorDefaultsFromStorage=="function"?readAutoGearMonitorDefaultsFromStorage():{};typeof persistAutoGearBackupRetention=="function"&&persistAutoGearBackupRetention(autoGearBackupRetention$1);var autoGearEditorDraft$1=null,autoGearEditorActiveItem$1=null,autoGearScenarioFilter$1="all";function updateAutoGearItemButtonState(e){const t=e==="remove"?"remove":"add",o=t==="remove"?autoGearRemoveItemButton$1:autoGearAddItemButton$1;if(!o)return;const r=getLanguageTexts(currentLang$1),n=getLanguageTexts(DEFAULT_LANGUAGE_SAFE$1),a=autoGearEditorActiveItem$1?.listType===t,s=t==="remove"?"autoGearRemoveItemButton":"autoGearAddItemButton",l=r[s]||n[s]||o.textContent||"",u=r.autoGearUpdateItemButton||n.autoGearUpdateItemButton||l,d=a?u:l,m=a?ICON_GLYPHS.save:t==="remove"?ICON_GLYPHS.minus:ICON_GLYPHS.add;setButtonLabelWithIconBinding$1(o,d,m),o.setAttribute("data-help",d)}function getAutoGearConfigurationSignature$1(e=baseAutoGearRulesState$1,t=autoGearMonitorDefaults){return stableStringify$1({rules:Array.isArray(e)?e:[],monitorDefaults:normalizeAutoGearMonitorDefaults$1(t)})}const initialAutoGearRulesSignature=getAutoGearConfigurationSignature$1(autoGearRules$2,autoGearMonitorDefaults);autoGearBackups$1.length&&getAutoGearConfigurationSignature$1(autoGearBackups$1[0].rules,autoGearBackups$1[0].monitorDefaults);enqueueCoreBootTask$2(()=>{callCoreFunctionIfAvailable$1("reconcileAutoGearAutoPresetState",[{persist:!0,skipRender:!0}],{defer:!0}),callCoreFunctionIfAvailable$1("alignActiveAutoGearPreset",[{skipRender:!0}],{defer:!0})});function assignAutoGearRules$1(e){return autoGearRules$2=Array.isArray(e)?e.map(normalizeAutoGearRule$1).filter(Boolean):[],autoGearRules$2}function syncBaseAutoGearRulesState(){getAutoGearConfigurationSignature$1()}function persistAutoGearRules(){if(typeof saveAutoGearRules<"u"&&typeof saveAutoGearRules=="function")try{saveAutoGearRules(autoGearRules$2);return}catch(e){console.warn("Failed to save automatic gear rules",e)}if(!(typeof localStorage>"u"))try{localStorage.setItem(AUTO_GEAR_RULES_KEY$1,JSON.stringify(autoGearRules$2))}catch(e){console.warn("Failed to save automatic gear rules",e)}}function getAutoGearMonitorDefault$1(e){return Object.prototype.hasOwnProperty.call(AUTO_GEAR_MONITOR_DEFAULT_TYPES$1,e)?normalizeAutoGearSelectorDefault(AUTO_GEAR_MONITOR_DEFAULT_TYPES$1[e],autoGearMonitorDefaults[e]):""}function setAutoGearMonitorDefaults$1(e,{skipRender:t=!1,skipRefresh:o=!1}={}){const r=normalizeAutoGearMonitorDefaults$1(e);let n=!1;return Object.keys(AUTO_GEAR_MONITOR_DEFAULT_TYPES$1).forEach(a=>{const s=autoGearMonitorDefaults[a]||"",l=r[a]||"";s!==l&&(n=!0)}),n?(autoGearMonitorDefaults=persistAutoGearMonitorDefaults(r),syncBaseAutoGearRulesState(),t||(callCoreFunctionIfAvailable$1("updateAutoGearMonitorDefaultOptions",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearMonitorDefaultsControls",[],{defer:!0})),!o&&typeof refreshGearListIfVisible=="function"&&refreshGearListIfVisible(),autoGearMonitorDefaults):(t||(callCoreFunctionIfAvailable$1("updateAutoGearMonitorDefaultOptions",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearMonitorDefaultsControls",[],{defer:!0})),autoGearMonitorDefaults)}function setAutoGearMonitorDefault(e,t,o={}){if(!Object.prototype.hasOwnProperty.call(AUTO_GEAR_MONITOR_DEFAULT_TYPES$1,e))return getAutoGearMonitorDefault$1(e);const r=autoGearMonitorDefaults[e]||"",n=normalizeAutoGearSelectorDefault(AUTO_GEAR_MONITOR_DEFAULT_TYPES$1[e],t);if(r===n)return o.skipRender||(callCoreFunctionIfAvailable$1("updateAutoGearMonitorDefaultOptions",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearMonitorDefaultsControls",[],{defer:!0})),n;const a={...autoGearMonitorDefaults,[e]:n};return setAutoGearMonitorDefaults$1(a,o),n}function setAutoGearRules$1(e){const t=assignAutoGearRules$1(e);baseAutoGearRulesState$1=t.slice(),projectScopedAutoGearRules$1=null,persistAutoGearRules(),syncBaseAutoGearRulesState(),callCoreFunctionIfAvailable$1("alignActiveAutoGearPreset",[{skipRender:!0}],{defer:!0}),callCoreFunctionIfAvailable$1("syncAutoGearAutoPreset",[t],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearPresetsControls",[],{defer:!0})}function getAutoGearRules$1(){return autoGearRules$2.slice()}function syncAutoGearRulesFromStorage$1(e){Array.isArray(e)?setAutoGearRules$1(e):(baseAutoGearRulesState$1=typeof readAutoGearRulesFromStorage=="function"?readAutoGearRulesFromStorage():[],projectScopedAutoGearRules$1=null,assignAutoGearRules$1(baseAutoGearRulesState$1),syncBaseAutoGearRulesState()),autoGearBackupRetention$1=typeof readAutoGearBackupRetentionFromStorage=="function"?readAutoGearBackupRetentionFromStorage():AUTO_GEAR_BACKUP_RETENTION_DEFAULT,autoGearBackups$1=typeof readAutoGearBackupsFromStorage=="function"?readAutoGearBackupsFromStorage(autoGearBackupRetention$1):[],typeof readAutoGearPresetsFromStorage=="function"&&readAutoGearPresetsFromStorage(),typeof readActiveAutoGearPresetIdFromStorage=="function"&&readActiveAutoGearPresetIdFromStorage(),autoGearAutoPresetIdState=typeof readAutoGearAutoPresetIdFromStorage=="function"?readAutoGearAutoPresetIdFromStorage():"",typeof readAutoGearBackupVisibilityFromStorage=="function"&&readAutoGearBackupVisibilityFromStorage(),autoGearMonitorDefaults=typeof readAutoGearMonitorDefaultsFromStorage=="function"?readAutoGearMonitorDefaultsFromStorage():{},autoGearBackups$1.length?getAutoGearConfigurationSignature$1(autoGearBackups$1[0].rules,autoGearBackups$1[0].monitorDefaults):getAutoGearConfigurationSignature$1(),getAutoGearConfigurationSignature$1(),callCoreFunctionIfAvailable$1("reconcileAutoGearAutoPresetState",[{persist:!0,skipRender:!0}],{defer:!0}),callCoreFunctionIfAvailable$1("syncAutoGearAutoPreset",[baseAutoGearRulesState$1],{defer:!0}),callCoreFunctionIfAvailable$1("alignActiveAutoGearPreset",[{skipRender:!0}],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearBackupControls",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearPresetsControls",[],{defer:!0}),callCoreFunctionIfAvailable$1("closeAutoGearEditor",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearRulesList",[],{defer:!0}),callCoreFunctionIfAvailable$1("updateAutoGearCatalogOptions",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearMonitorDefaultsControls",[],{defer:!0})}function clearProjectAutoGearRules$1(){if(!projectScopedAutoGearRules$1||!projectScopedAutoGearRules$1.length){projectScopedAutoGearRules$1=null,assignAutoGearRules$1(baseAutoGearRulesState$1);return}projectScopedAutoGearRules$1=null,assignAutoGearRules$1(baseAutoGearRulesState$1)}function getProjectScopedAutoGearRules$1(){return projectScopedAutoGearRules$1?projectScopedAutoGearRules$1.slice():null}if(typeof window<"u"){window.getProjectScopedAutoGearRules=getProjectScopedAutoGearRules$1,window.getAutoGearRules=getAutoGearRules$1,window.setAutoGearRules=setAutoGearRules$1,window.collectAutoGearCatalogNames=collectAutoGearCatalogNames$1,window.GEAR_LIST_CATEGORIES=GEAR_LIST_CATEGORIES$1,window.collectAutoGearMonitorNames=collectAutoGearMonitorNames$1,window.collectAutoGearTripodNames=collectAutoGearTripodNames$1,window.collectDeviceManagerCategories=collectDeviceManagerCategories,window.hasSeededAutoGearDefaults=hasSeededAutoGearDefaults$1,window.activateSettingsTab=activateSettingsTab$1,window.clearAllAutoGearConditions=clearAllAutoGearConditions$1,window.callCoreFunctionIfAvailable=callCoreFunctionIfAvailable$1;const liveVariables=["autoScenarioFilter","autoGearRules","baseAutoGearRulesState","projectScopedAutoGearRules","autoGearBackups","autoGearPresets","autoGearAutoPresetIdState","autoGearBackupsVisible","autoGearMonitorDefaults","autoGearEditorDraft","autoGearEditorActiveItem","autoGearDraftPendingWarnings","autoGearSearchQuery","autoGearSummaryFocus","autoGearSearchInput","autoGearFilterClearButton","autoGearRulesList","autoGearPresetSelect","autoGearSavePresetButton","autoGearDeletePresetButton","autoGearEditor","autoGearFilterScenarioSelect","activeSettingsTabId","gearItemTranslations","openDialog","isDialogOpen","scheduleSettingsTabsOverflowUpdate","clearAllAutoGearConditions","callCoreFunctionIfAvailable","autoGearCameraSelect","autoGearOwnGearSelect","autoGearMonitorSelect","autoGearMotorsSelect","autoGearControllersSelect","autoGearDistanceSelect","autoGearWirelessSelect","autoGearVideoDistributionSelect","autoGearTripodHeadBrandSelect","autoGearTripodBowlSelect","autoGearTripodTypesSelect","autoGearTripodSpreaderSelect","autoGearCrewPresentSelect","autoGearCrewAbsentSelect","autoGearDeliveryResolutionSelect","autoGearMatteboxSelect","autoGearViewfinderExtensionSelect","autoGearScenariosSelect","autoGearAddOwnGearSelect","autoGearRemoveOwnGearSelect","autoGearAddCategorySelect","autoGearRemoveCategorySelect","autoGearScenarioModeSelect","autoGearCameraWeightModeSelect","autoGearAddSelectorTypeSelect","autoGearRemoveSelectorTypeSelect","autoGearAddSelectorDefaultInput","autoGearRemoveSelectorDefaultInput","getAutoGearOwnGearItems","findAutoGearOwnGearById","formatOwnGearQuantityText","collectAutoGearSelectedValues","autoGearAddNameInput","autoGearAddQuantityInput","autoGearAddScreenSizeInput","autoGearAddNotesInput","autoGearRemoveNameInput","autoGearRemoveQuantityInput","autoGearRemoveScreenSizeInput","autoGearRemoveNotesInput","autoGearImportInput","autoGearBackupRetentionInput","autoGearAddItemButton","autoGearRemoveItemButton","autoGearSaveRuleButton","autoGearCancelEditButton","autoGearExportButton","autoGearImportButton","autoGearAddList","autoGearRemoveList","autoGearDraftImpactContainer","autoGearDraftImpactList","autoGearDraftWarningContainer","autoGearDraftWarningList","autoGearSummarySection","autoGearSummaryHeadingElem","autoGearSummaryDescriptionElem","autoGearSummaryCards","autoGearSummaryDetails","autoGearSummaryLast","autoGearMonitorDefaultsSection","autoGearCameraWeightSection","autoGearHeadingElem","autoGearMonitorDefaultsHeading","autoGearAddItemsHeading","autoGearRemoveItemsHeading","autoGearDraftImpactHeading","autoGearDraftWarningHeading","autoGearBackupsHeading","autoGearDescriptionElem","autoGearMonitorDefaultsDescription","autoGearSearchLabel","autoGearFilterScenarioLabel","autoGearPresetDescription","autoGearPresetLabel","autoGearConditionSelectLabel","autoGearAlwaysLabel","autoGearAlwaysHelp","autoGearDefaultFocusMonitorLabel","autoGearDefaultHandheldMonitorLabel","autoGearDefaultComboMonitorLabel","autoGearDefaultDirectorMonitorLabel","autoGearBackupsDescription","autoGearDraftImpactDescription","autoGearDefaultFocusMonitorSelect","autoGearDefaultHandheldMonitorSelect","autoGearDefaultComboMonitorSelect","autoGearDefaultDirectorMonitorSelect","autoGearConditionSelect","autoGearSavePresetButton","autoGearDeletePresetButton","autoGearAddRuleBtn","autoGearResetFactoryButton","autoGearConditionAddButton","autoGearMonitorDefaultControls","autoGearRulesList","autoGearConditionControls","autoGearConditionList","autoGearConditionAddShortcuts","autoGearConditionRemoveButtons","autoGearSummaryFocus","markAutoGearDefaultsSeeded","clearAutoGearDefaultsSeeded"];liveVariables.forEach(name=>{try{Object.defineProperty(window,name,{configurable:!0,enumerable:!0,get:()=>{try{return eval(name)}catch(e){return}},set:val=>{try{eval(`${name} = val`)}catch(e){}}})}catch(err){try{window[name]=eval(name)}catch(e){}}}),typeof window.autoGearScenarioFilter>"u"&&Object.defineProperty(window,"autoGearScenarioFilter",{configurable:!0,get:()=>autoGearScenarioFilter$1,set:e=>{autoGearScenarioFilter$1=e}})}function looksLikeGearName(e){return typeof e=="string"&&e!=="None"&&(/[A-Z]/.test(e)||/\d/.test(e)||e.includes(" "))}function hasSeededAutoGearDefaults$1(){if(typeof loadAutoGearSeedFlag<"u"&&typeof loadAutoGearSeedFlag=="function")try{return!!loadAutoGearSeedFlag()}catch(e){return console.warn("Failed to read automatic gear seed flag",e),!1}if(typeof localStorage>"u")return!1;try{return localStorage.getItem(AUTO_GEAR_SEEDED_KEY)==="1"}catch(e){return console.warn("Failed to read automatic gear seed flag",e),!1}}function collectAutoGearCatalogNames$1(){const e=new Set,t=n=>{looksLikeGearName(n)&&e.add(n)},o=typeof WeakSet=="function"?new WeakSet:null,r=n=>{if(!(!n||typeof n!="object")){if(o){if(o.has(n))return;o.add(n)}Object.entries(n).forEach(([a,s])=>{!s||typeof s!="object"||Array.isArray(s)||(t(a),r(s))})}};return typeof devices$1=="object"&&devices$1&&r(devices$1),getAutoGearOwnGearItems$1().forEach(n=>{n&&typeof n.name=="string"&&t(n.name)}),autoGearRules$2.forEach(n=>{[...n.add,...n.remove].forEach(a=>t(a.name))}),Array.from(e).sort((n,a)=>n.localeCompare(a,void 0,{sensitivity:"base"}))}function normalizeAutoGearMonitorCatalogMode(e){const t=normalizeAutoGearSelectorType(e);return t==="monitor"||t==="directorMonitor"||AUTO_GEAR_TRIPOD_SELECTOR_TYPES$1.has(t)?t:"none"}var autoGearMonitorCatalogMode="none",autoGearAddMonitorFieldGroup=null,autoGearRemoveMonitorFieldGroup=null;function collectAutoGearMonitorNames$1(e=autoGearMonitorCatalogMode){const t=normalizeAutoGearMonitorCatalogMode(e);if(t==="none")return[];const o=t==="monitor",r=t==="directorMonitor",n=new Set;o&&n.add("monitor"),r&&n.add("directorMonitor");const a=new Set,s=l=>{if(typeof l=="string"){const u=l.trim();u&&a.add(u)}};if(o){const l=devices$1&&devices$1.monitors?devices$1.monitors:null;l&&typeof l=="object"&&Object.keys(l).forEach(s)}if(r){const l=devices$1&&devices$1.directorMonitors?devices$1.directorMonitors:null;l&&typeof l=="object"&&Object.keys(l).filter(u=>u&&u!=="None").forEach(s)}return autoGearRules$2.forEach(l=>{const u=d=>{if(!d||typeof d!="object")return;const m=d.selectorDefault;if(!m)return;const y=normalizeAutoGearSelectorType(d.selectorType);n.has(y)&&s(m)};(l.add||[]).forEach(u),(l.remove||[]).forEach(u)}),AUTO_GEAR_MONITOR_FALLBACKS.forEach(s),Array.from(a).sort(localeSort)}function collectAutoGearSelectorValuesFromRules(e){const t=normalizeAutoGearSelectorType(e);if(t==="none")return[];const o=new Set,r=n=>{if(typeof n!="string")return;const a=n.trim();a&&o.add(a)};return autoGearRules$2.forEach(n=>{const a=s=>{!s||typeof s!="object"||normalizeAutoGearSelectorType(s.selectorType)===t&&r(s.selectorDefault)};(n.add||[]).forEach(a),(n.remove||[]).forEach(a)}),Array.from(o)}function collectAutoGearTripodNames$1(e){if(!AUTO_GEAR_TRIPOD_SELECTOR_TYPES$1.has(e))return[];const t=collectTripodPreferenceOptions(e),o=new Set,r=[];return t.forEach(a=>{if(!a||!a.value)return;const s=a.value.trim().toLowerCase();o.has(s)||(o.add(s),r.push({value:a.value.trim(),label:a.label||a.value.trim()}))}),collectAutoGearSelectorValuesFromRules(e).map(a=>a.trim()).filter(Boolean).sort(localeSort).forEach(a=>{const s=a.toLowerCase();o.has(s)||(o.add(s),r.push({value:a,label:a}))}),r}var getCssVariableValue$1=(e,t="")=>{if(typeof document>"u")return t;const o=document.documentElement;if(!o)return t;const r=typeof window<"u"&&typeof window.getComputedStyle=="function"?window.getComputedStyle(o).getPropertyValue(e).trim():"";return r||o.style.getPropertyValue(e).trim()||t};typeof window<"u"&&"serviceWorker"in navigator&&window.addEventListener("load",()=>{const e=typeof globalThis<"u"&&globalThis&&globalThis.cineOffline||typeof window<"u"&&window&&window.cineOffline||null;if(e&&typeof e.registerServiceWorker=="function"){e.registerServiceWorker("service-worker.js",{immediate:!0,window,navigator});return}try{navigator.serviceWorker.register("service-worker.js")}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Service worker registration failed via fallback path.",t)}});function getElementHeight(e){if(!e)return 0;const t=typeof e.getBoundingClientRect=="function"?e.getBoundingClientRect():null;return t&&typeof t.height=="number"&&t.height>0?t.height:e.offsetHeight||0}function setInstallBannerOffset$1(e){if(typeof document>"u")return;const t=document.documentElement;t&&(e>0?t.style.setProperty("--install-banner-offset",`${Math.ceil(e)} px`):t.style.removeProperty("--install-banner-offset"))}let pendingInstallBannerPositionUpdate=!1;const LOCAL_FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK="Force reload requires an internet connection. Try again once you are back online.";function scheduleInstallBannerPositionUpdate(){if(pendingInstallBannerPositionUpdate||typeof window>"u")return;const e=typeof window.requestAnimationFrame=="function"&&window.requestAnimationFrame.bind(window)||typeof window.setTimeout=="function"&&(t=>window.setTimeout(t,0));e&&(pendingInstallBannerPositionUpdate=!0,e(()=>{pendingInstallBannerPositionUpdate=!1,updateInstallBannerPosition()}))}function updateInstallBannerPosition(){if(typeof document>"u")return;const e=document.getElementById("installPromptBanner");if(!e){setInstallBannerOffset$1(0);return}const t=document.getElementById("offlineIndicator"),r=!!(t&&!t.hasAttribute("hidden"))?getElementHeight(t):0;r>0?e.style.top=`${r} px`:e.style.removeProperty("top");const n=!e.hasAttribute("hidden"),a=n?getElementHeight(e):0,s=r+a;setInstallBannerOffset$1(s),n&&!a&&scheduleInstallBannerPositionUpdate()}function setupOfflineIndicator(){if(typeof document>"u"||typeof document.getElementById!="function"||typeof navigator>"u")return;const e=document.getElementById("offlineIndicator");if(!e)return;const t=document.getElementById("reloadButton"),o=e.dataset||{},r=typeof e.textContent=="string"&&e.textContent.trim()?e.textContent.trim():"Offline";if(e.dataset){(!o.baseLabel||!o.baseLabel.trim())&&(e.dataset.baseLabel=r);const x=typeof e.getAttribute=="function"?e.getAttribute("data-help"):null;(!e.dataset.baseHelp||!e.dataset.baseHelp.trim())&&(typeof x=="string"&&x.trim()?e.dataset.baseHelp=x.trim():e.dataset.baseHelp=e.dataset.baseLabel||r),(!e.dataset.forceReloadNotice||!e.dataset.forceReloadNotice.trim())&&(e.dataset.forceReloadNotice=LOCAL_FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK),(!e.dataset.degradedLabel||!e.dataset.degradedLabel.trim())&&(e.dataset.degradedLabel=e.dataset.forceReloadNotice||LOCAL_FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK),(!e.dataset.degradedHelp||!e.dataset.degradedHelp.trim())&&(e.dataset.degradedHelp=e.dataset.baseHelp||r),(!e.dataset.reasonCacheFallback||!e.dataset.reasonCacheFallback.trim())&&(e.dataset.reasonCacheFallback=e.dataset.forceReloadNotice||LOCAL_FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK),(!e.dataset.reasonGetFailed||!e.dataset.reasonGetFailed.trim())&&(e.dataset.reasonGetFailed=e.dataset.reasonCacheFallback),(!e.dataset.reasonTimeout||!e.dataset.reasonTimeout.trim())&&(e.dataset.reasonTimeout=e.dataset.reasonCacheFallback),(!e.dataset.reasonUnreachable||!e.dataset.reasonUnreachable.trim())&&(e.dataset.reasonUnreachable=e.dataset.reasonCacheFallback),(!e.dataset.reasonReloadBlocked||!e.dataset.reasonReloadBlocked.trim())&&(e.dataset.reasonReloadBlocked=e.dataset.forceReloadNotice||LOCAL_FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK),(!e.dataset.reasonUnknown||!e.dataset.reasonUnknown.trim())&&(e.dataset.reasonUnknown=e.dataset.degradedHelp||r)}const n="cine-sw:connectivity-status",a="cine-sw-logs";let s=null,l=null,u=!1,d=null;const m=()=>{const x=e.dataset?.forceReloadNotice;if(typeof x=="string"&&x.trim())return x.trim();const H=t?.dataset?.offlineNotice;return typeof H=="string"&&H.trim()?H.trim():LOCAL_FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK},y=()=>typeof navigator.onLine=="boolean"?navigator.onLine!==!1:!0,h=()=>e.dataset?.baseLabel&&e.dataset.baseLabel.trim()?e.dataset.baseLabel.trim():r,b=()=>e.dataset?.baseHelp&&e.dataset.baseHelp.trim()?e.dataset.baseHelp.trim():h(),v=()=>e.dataset?.degradedLabel&&e.dataset.degradedLabel.trim()?e.dataset.degradedLabel.trim():m(),C=()=>e.dataset?.degradedHelp&&e.dataset.degradedHelp.trim()?e.dataset.degradedHelp.trim():v(),A={"cache-fallback":"reasonCacheFallback","get-failed":"reasonGetFailed",timeout:"reasonTimeout",unreachable:"reasonUnreachable","reload-blocked":"reasonReloadBlocked",offline:"forceReloadNotice"},w=x=>{if(!x){const U=e.dataset?.reasonUnknown;return typeof U=="string"&&U.trim()?U.trim():""}if(x==="navigator-offline")return m();const H=A[x]||"reasonUnknown",W=e.dataset?.[H];if(typeof W=="string"&&W.trim())return W.trim();if(H!=="reasonUnknown"){const U=e.dataset?.reasonUnknown;if(typeof U=="string"&&U.trim())return U.trim()}return""},R=x=>{if(!x)return"";if(typeof x=="string")return x.trim();if(typeof x!="object")return"";const H=[];if(typeof x.status=="number"&&Number.isFinite(x.status)&&H.push(`HTTP ${x.status} `),typeof x.statusText=="string"&&x.statusText.trim()&&H.push(x.statusText.trim()),typeof x.message=="string"&&x.message.trim()&&H.push(x.message.trim()),typeof x.error=="string"&&x.error.trim()&&H.push(x.error.trim()),!H.length&&x.error&&typeof x.error=="object"){const W=R(x.error);W&&H.push(W)}return!H.length&&x.reason&&typeof x.reason=="string"&&H.push(x.reason.trim()),H.join(" ").trim()},_=(x,H)=>{if(!t)return;const W=typeof H=="string"&&H.trim()?H.trim():m();if(t.dataset){if(!t.dataset.onlineTitle||!t.dataset.onlineTitle.trim()){const U=t.getAttribute("title");typeof U=="string"&&U.trim()?t.dataset.onlineTitle=U.trim():t.dataset.onlineTitle="Force reload"}if(!t.dataset.onlineHelp||!t.dataset.onlineHelp.trim()){const U=t.getAttribute("data-help");typeof U=="string"&&U.trim()?t.dataset.onlineHelp=U.trim():t.dataset.onlineHelp=t.dataset.onlineTitle}if(!t.dataset.onlineAriaLabel||!t.dataset.onlineAriaLabel.trim()){const U=t.getAttribute("aria-label");typeof U=="string"&&U.trim()?t.dataset.onlineAriaLabel=U.trim():t.dataset.onlineAriaLabel=t.dataset.onlineTitle}(!t.dataset.offlineNotice||!t.dataset.offlineNotice.trim())&&(t.dataset.offlineNotice=W)}if(x==="online"){t.removeAttribute("disabled"),t.removeAttribute("aria-disabled");const U=t.dataset?.onlineTitle||"Force reload",j=t.dataset?.onlineHelp||U;t.setAttribute("title",U),t.setAttribute("data-help",j);const Y=t.dataset?.onlineAriaLabel||U;t.setAttribute("aria-label",Y)}else t.setAttribute("disabled","disabled"),t.setAttribute("aria-disabled","true"),t.setAttribute("title",W),t.setAttribute("data-help",W),t.setAttribute("aria-label",W),t.dataset&&(t.dataset.offlineNotice=W,t.dataset.degradedNotice=W)},G=x=>{if(!x||typeof x!="object")return null;const H=typeof x.status=="string"&&x.status?x.status:"unknown",W=typeof x.reason=="string"&&x.reason?x.reason:null,U=typeof x.timestamp=="number"&&Number.isFinite(x.timestamp)?x.timestamp:Date.now();let j=null;return x.detail&&typeof x.detail=="object"?j=x.detail:typeof x.detail=="string"&&x.detail.trim()&&(j=x.detail.trim()),{status:H,reason:W,detail:j,timestamp:U}},O=()=>{const x=y();let H=x?"online":"offline",W=x?null:"navigator-offline",U=null,j=null;if(s){const Y=s.status;Y==="offline"?(H="offline",W=s.reason||W||"offline",U=s.detail||null,j=s.timestamp||null):Y==="degraded"&&H!=="offline"?(H="degraded",W=s.reason||"unknown",U=s.detail||null,j=s.timestamp||null):Y==="online"&&x&&(H="online",W=s.reason||null,U=s.detail||null,j=s.timestamp||null)}if(e.dataset&&(e.dataset.connectivityStatus=H,W?e.dataset.connectivityReason=W:e.dataset.connectivityReason&&delete e.dataset.connectivityReason,j?e.dataset.connectivityTimestamp=String(j):e.dataset.connectivityTimestamp&&delete e.dataset.connectivityTimestamp),H==="online"){const Y=h(),le=b();(typeof e.textContent=="string"||typeof e.textContent=="object")&&(e.textContent=Y),e.setAttribute("data-help",le),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.hasAttribute("hidden")||e.setAttribute("hidden",""),_("online",m())}else if(H==="offline"){const Y=m();e.dataset&&(e.dataset.forceReloadNotice=Y,e.dataset.reloadNotice=Y),(typeof e.textContent=="string"||typeof e.textContent=="object")&&(e.textContent=Y),e.setAttribute("data-help",Y),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.removeAttribute("hidden"),_("offline",Y)}else{const Y=v(),le=w(W),be=R(U),re=[];le&&re.push(le),be&&be!==le&&re.push(be);const de=re.join(" ").trim(),ne=de?`${Y} — ${de} `:Y,Ce=C(),Ee=[];de&&Ee.push(de),Ce&&(!de||Ce.indexOf(de)===-1)&&Ee.push(Ce);const Pe=Ee.join(" ").trim()||Ce||ne;e.dataset&&(e.dataset.forceReloadNotice=ne,e.dataset.reloadNotice=ne),(typeof e.textContent=="string"||typeof e.textContent=="object")&&(e.textContent=ne),e.setAttribute("data-help",Pe),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.removeAttribute("hidden"),_("degraded",ne)}typeof updateInstallBannerPosition=="function"&&updateInstallBannerPosition()},B=x=>{const H=G(x);H&&(s&&s.status===H.status&&s.reason===H.reason&&s.timestamp===H.timestamp||(s=H,O(),typeof callCoreFunctionIfAvailable$1=="function"&&callCoreFunctionIfAvailable$1("updateStorageSummary",[],{defer:!0})))},$=x=>{if(!x)return;let H=null;try{H=x.data||null}catch{H=null}if(!(!H||typeof H!="object")&&H.type===n){const W=H.state&&typeof H.state=="object"?H.state:null;W&&B(W)}},V=()=>{if(!(l||u)){if(typeof BroadcastChannel!="function"){u=!0;return}try{l=new BroadcastChannel(a),l.addEventListener("message",$)}catch(x){u=!0,typeof console<"u"&&typeof console.warn=="function"&&console.warn("setupOfflineIndicator: Unable to listen for connectivity updates",x)}}},F=(()=>{try{if(typeof cineOffline<"u"&&cineOffline)return cineOffline}catch{}const x=[typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let H=0;H<x.length;H+=1){const W=x[H];if(W&&typeof W.cineOffline=="object")return W.cineOffline}return null})();if(F&&typeof F.subscribeConnectivityStatus=="function")try{d=F.subscribeConnectivityStatus(B)}catch{d=null}const z=F&&typeof F.getConnectivityState=="function"?F.getConnectivityState():typeof window<"u"&&window&&typeof window.cineConnectivityStatus=="object"?window.cineConnectivityStatus:null;return z&&B(z),V(),typeof window<"u"&&typeof window.addEventListener=="function"&&(window.addEventListener("online",O),window.addEventListener("offline",O)),O(),d}typeof window<"u"&&setupOfflineIndicator();function closeSideMenu(){const e=document.getElementById("sideMenu"),t=document.getElementById("menuOverlay"),o=document.getElementById("menuToggle"),r=typeof document<"u"?document.body:null;!e||!t||!o||(e.classList.remove("open"),e.setAttribute("hidden",""),o.setAttribute("aria-expanded","false"),r&&r.classList.remove("menu-open"),o.focus())}typeof window<"u"&&(window.closeSideMenu=closeSideMenu);function openSideMenu(){const e=document.getElementById("sideMenu"),t=document.getElementById("menuOverlay"),o=document.getElementById("menuToggle"),r=document.getElementById("closeMenuButton"),n=typeof document<"u"?document.body:null;if(!e||!t||!o||e.classList.contains("open"))return;e.classList.add("open"),e.removeAttribute("hidden"),o.setAttribute("aria-expanded","true");const a=o.dataset?.closeLabel||r?.getAttribute("aria-label")||"Close menu",s=o.dataset?.closeHelp||r?.getAttribute("data-help")||a;o.setAttribute("aria-label",a),o.setAttribute("data-help",s),n?.classList.add("menu-open")}typeof window<"u"&&(window.openSideMenu=openSideMenu);function setupSideMenu(){const e=document.getElementById("menuToggle"),t=document.getElementById("sideMenu"),o=document.getElementById("menuOverlay"),r=document.getElementById("closeMenuButton");if(!e||!t||!o){document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",setupSideMenu);return}if(e.dataset.menuInitialized)return;e.dataset.menuInitialized="true",o.style.display,e.addEventListener("click",()=>{t.classList.contains("open")?closeSideMenu():openSideMenu()}),o.addEventListener("click",closeSideMenu),r?.addEventListener("click",()=>{closeSideMenu(),e.focus()}),typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").addEventListener("change",s=>{!s.matches&&t.classList.contains("open")&&closeSideMenu()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&t.classList.contains("open")&&(closeSideMenu(),e.focus())}),t.querySelectorAll("a").forEach(a=>{a.addEventListener("click",s=>{const l=a.getAttribute("href");l&&l.startsWith("#")&&(s.preventDefault(),document.querySelector(l)?.scrollIntoView(),history.replaceState(null,"",window.location.pathname+window.location.search)),closeSideMenu()})});const n=a=>{a&&(a==="open-settings"?document.getElementById("settingsButton")?.click():a==="open-help"?document.getElementById("helpButton")?.click():a==="open-own-gear"?typeof openOwnGearDialog=="function"&&openOwnGearDialog():a==="open-contacts"&&(initializeContactsModule(),openDialog$1(contactsDialog)))};t.querySelectorAll("[data-sidebar-action]").forEach(a=>{a.addEventListener("click",s=>{s.preventDefault(),n(a.dataset.sidebarAction)})})}typeof window<"u"&&(window.setupSideMenu=setupSideMenu);function setupResponsiveControls(){const e=document.getElementById("topBar"),t=e?.querySelector(".feature-search"),o=e?.querySelector(".controls"),r=document.querySelector("#sideMenu .sidebar-controls");if(!e||!t||!o||!r||typeof window.matchMedia!="function"){document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",setupResponsiveControls);return}if(e.dataset.responsiveInitialized)return;e.dataset.responsiveInitialized="true";const n=window.matchMedia("(max-width: 768px)"),a=()=>{n.matches?(r.appendChild(t),r.appendChild(o)):(e.appendChild(t),e.appendChild(o))};n.addEventListener("change",a),a()}typeof window<"u"&&(window.setupResponsiveControls=setupResponsiveControls);let ownGearStoreModuleCache=null,ownGearStoreInstance=null,ownGearViewModuleCache=null,ownGearViewInstance=null,fallbackAutoGearCache={items:[],map:new Map};function detectOwnGearGlobalScope(){return typeof CORE_GLOBAL_SCOPE$3=="object"&&CORE_GLOBAL_SCOPE$3?CORE_GLOBAL_SCOPE$3:typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null}function resolveOwnGearStoreModule(){if(ownGearStoreModuleCache)return ownGearStoreModuleCache;if(typeof require=="function")try{const t=require("./own-gear/store.js");if(t&&typeof t.createOwnGearStore=="function")return ownGearStoreModuleCache=t,ownGearStoreModuleCache}catch{}const e=detectOwnGearGlobalScope();return e&&typeof e.cineOwnGearStore=="object"&&e.cineOwnGearStore?(ownGearStoreModuleCache=e.cineOwnGearStore,ownGearStoreModuleCache):typeof cineOwnGearStore=="object"&&cineOwnGearStore?(ownGearStoreModuleCache=cineOwnGearStore,ownGearStoreModuleCache):null}function getOwnGearStore(){if(ownGearStoreInstance)return ownGearStoreInstance;const e=resolveOwnGearStoreModule();if(e&&typeof e.createOwnGearStore=="function")try{return ownGearStoreInstance=e.createOwnGearStore(),ownGearStoreInstance}catch{}return null}function resolveOwnGearViewModule(){if(ownGearViewModuleCache)return ownGearViewModuleCache;if(typeof require=="function")try{const t=require("./own-gear/view.js");if(t&&typeof t.createOwnGearView=="function")return ownGearViewModuleCache=t,ownGearViewModuleCache}catch{}const e=detectOwnGearGlobalScope();return e&&typeof e.cineOwnGearView=="object"&&e.cineOwnGearView?(ownGearViewModuleCache=e.cineOwnGearView,ownGearViewModuleCache):typeof cineOwnGearView=="object"&&cineOwnGearView?(ownGearViewModuleCache=cineOwnGearView,ownGearViewModuleCache):null}function resolveOwnGearViewOptions(){return{scope:detectOwnGearGlobalScope()||{},document:typeof document<"u"?document:null,getLanguageTexts,defaultLanguage:DEFAULT_LANGUAGE_SAFE$1,getCurrentLanguage:()=>currentLang$1,formatWithPlaceholders:formatWithPlaceholdersSafe,setButtonLabelWithIconBinding:setButtonLabelWithIconBinding$1,iconMarkup:iconMarkup$1,iconGlyphs:ICON_GLYPHS,openDialog:openDialog$1,closeDialog:closeDialog$1,formatQuantityText:formatOwnGearQuantityText$1,devices:devices$1,gearItemTranslations:gearItemTranslations$1,looksLikeGearName}}function getOwnGearView(){if(ownGearViewInstance)return ownGearViewInstance;const e=resolveOwnGearViewModule(),t=getOwnGearStore();if(!e||typeof e.createOwnGearView!="function"||!t)return null;try{return ownGearViewInstance=e.createOwnGearView(t,resolveOwnGearViewOptions()),ownGearViewInstance}catch{}return null}function invalidateAutoGearOwnGearCache(){const e=getOwnGearStore();if(e&&typeof e.invalidateCache=="function")try{e.invalidateCache();return}catch{}fallbackAutoGearCache={items:[],map:new Map}}function refreshAutoGearOwnGearCache(){const e=getOwnGearStore();if(e&&typeof e.refreshCache=="function")try{const a=e.refreshCache();return{items:Array.isArray(a.items)?a.items.slice():[],map:a.map instanceof Map?a.map:new Map}}catch{}const t=resolveOwnGearModule$1();let o=[];if(t&&typeof t.loadStoredOwnGearItems=="function")try{o=t.loadStoredOwnGearItems()}catch(a){console.warn("Unable to load own gear items for automatic gear rules via module.",a)}(!Array.isArray(o)||!o.length)&&(o=loadStoredOwnGearItems());const r=Array.isArray(o)?o.map(normalizeOwnGearRecord$1).filter(Boolean):[],n=new Map;return r.forEach(a=>{!a||!a.id||n.set(a.id,a)}),fallbackAutoGearCache={items:r,map:n},fallbackAutoGearCache}function getAutoGearOwnGearCache(){const e=getOwnGearStore();if(e&&typeof e.getCacheSnapshot=="function")try{const t=e.getCacheSnapshot();return{items:Array.isArray(t.items)?t.items.slice():[],map:t.map instanceof Map?t.map:new Map}}catch{}return fallbackAutoGearCache&&Array.isArray(fallbackAutoGearCache.items)&&fallbackAutoGearCache.items.length?fallbackAutoGearCache:refreshAutoGearOwnGearCache()}function getAutoGearOwnGearItems$1(){return getAutoGearOwnGearCache().items.slice()}function findAutoGearOwnGearById$1(e){if(!e)return null;const t=getOwnGearStore();if(t&&typeof t.findCachedById=="function")try{return t.findCachedById(e)}catch{}return getAutoGearOwnGearCache().map.get(e)||null}function generateOwnGearId$1(){const e=getOwnGearStore();if(e&&typeof e.generateOwnGearId=="function")try{return e.generateOwnGearId()}catch{}const t=resolveOwnGearModule$1();if(t&&typeof t.generateOwnGearId=="function")try{return t.generateOwnGearId()}catch(n){console.warn("Unable to generate own gear id via module.",n)}if(typeof crypto<"u"&&crypto&&typeof crypto.randomUUID=="function")try{return crypto.randomUUID()}catch{}const o=Date.now().toString(36),r=Math.floor(Math.random()*1e8).toString(36);return`own - ${o} -${r} `}function normalizeOwnGearRecord$1(e){const t=getOwnGearStore();if(t&&typeof t.normalizeOwnGearRecord=="function")try{return t.normalizeOwnGearRecord(e)}catch{}const o=resolveOwnGearModule$1();if(o&&typeof o.normalizeOwnGearRecord=="function")try{return o.normalizeOwnGearRecord(e)}catch(a){console.warn("Unable to normalize own gear entry via module.",a)}if(!e||typeof e!="object")return null;const r=typeof e.name=="string"?e.name.trim():"";if(!r)return null;const n={id:typeof e.id=="string"&&e.id.trim()?e.id.trim():generateOwnGearId$1(),name:r};return typeof e.quantity=="string"&&e.quantity.trim()?n.quantity=e.quantity.trim():typeof e.quantity=="number"&&Number.isFinite(e.quantity)&&(n.quantity=String(e.quantity)),typeof e.notes=="string"&&e.notes.trim()&&(n.notes=e.notes.trim()),typeof e.source=="string"&&e.source.trim()&&(n.source=e.source.trim()),n}function loadStoredOwnGearItems(){const e=getOwnGearStore();if(e&&typeof e.loadStoredOwnGearItems=="function")try{return e.loadStoredOwnGearItems()}catch{}const t=resolveOwnGearModule$1();if(t&&typeof t.loadStoredOwnGearItems=="function")try{return t.loadStoredOwnGearItems()}catch(o){console.warn("Unable to load own gear items via module.",o)}if(typeof loadOwnGear!="function")return[];try{const o=loadOwnGear();if(!Array.isArray(o))return[];const r=new Set;return o.map(normalizeOwnGearRecord$1).filter(n=>!n||r.has(n.id)?!1:(r.add(n.id),!0))}catch(o){return console.warn("Failed to load own gear items from storage",o),[]}}function formatOwnGearQuantityText$1(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const o=Number(t.replace(",","."));if(!Number.isNaN(o)&&Number.isFinite(o)){const r=Math.round(o*1e3)/1e3;return String(r).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return t}function openOwnGearDialog(){const e=getOwnGearView();if(e&&typeof e.openDialog=="function")try{e.openDialog()}catch{}}function applyOwnGearLocalization(e){const t=getOwnGearView();if(t&&typeof t.applyLocalization=="function")try{t.applyLocalization(e)}catch{}}function initializeLayoutControls(){setupSideMenu(),setupResponsiveControls()}function initializeOwnGearManager(){const e=getOwnGearView();if(e){try{e.initialize()}catch{}try{exposeCoreRuntimeConstant$1("openOwnGearDialog",openOwnGearDialog)}catch{const o=detectOwnGearGlobalScope();o&&(o.openOwnGearDialog=openOwnGearDialog)}}}if(typeof window<"u"&&typeof document<"u")var runLayoutInitialization=()=>{initializeLayoutControls(),initializeOwnGearManager(),initializeContactsModule()},scheduleLayoutInitialization=()=>{const t=()=>{typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout(runLayoutInitialization,0):runLayoutInitialization()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()};const CORE_AUTO_BACKUP_NAMESPACE=(()=>{if(typeof require=="function")try{return require("./app-core-auto-backup.js")}catch{}let e=null;if(typeof fallbackRequireCoreRuntimeModule=="function")e=fallbackRequireCoreRuntimeModule("./app-core-auto-backup.js");else if(typeof cineRuntimeBootstrapExports=="object"&&cineRuntimeBootstrapExports&&typeof cineRuntimeBootstrapExports.fallbackRequireCoreRuntimeModule=="function")e=cineRuntimeBootstrapExports.fallbackRequireCoreRuntimeModule("./app-core-auto-backup.js");else{const o=(typeof CORE_GLOBAL_SCOPE$3<"u"?CORE_GLOBAL_SCOPE$3:null)||(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null);o&&typeof o.fallbackRequireCoreRuntimeModule=="function"&&(e=o.fallbackRequireCoreRuntimeModule("./app-core-auto-backup.js"))}if(e&&typeof e=="object")return e;const t=[typeof CORE_GLOBAL_SCOPE$3<"u"?CORE_GLOBAL_SCOPE$3:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r!="object"&&typeof r!="function"))try{if(r.CORE_AUTO_BACKUP&&typeof r.CORE_AUTO_BACKUP=="object")return r.CORE_AUTO_BACKUP}catch{}}return null})(),AUTO_BACKUP_NAME_PREFIX=CORE_AUTO_BACKUP_NAMESPACE&&typeof CORE_AUTO_BACKUP_NAMESPACE.AUTO_BACKUP_NAME_PREFIX=="string"?CORE_AUTO_BACKUP_NAMESPACE.AUTO_BACKUP_NAME_PREFIX:"auto-backup-",AUTO_BACKUP_DELETION_PREFIX=CORE_AUTO_BACKUP_NAMESPACE&&typeof CORE_AUTO_BACKUP_NAMESPACE.AUTO_BACKUP_DELETION_PREFIX=="string"?CORE_AUTO_BACKUP_NAMESPACE.AUTO_BACKUP_DELETION_PREFIX:"auto-backup-before-delete-";var localLogAutoBackupEvent=CORE_AUTO_BACKUP_NAMESPACE&&typeof CORE_AUTO_BACKUP_NAMESPACE.logAutoBackupEvent=="function"?CORE_AUTO_BACKUP_NAMESPACE.logAutoBackupEvent:function e(t,o,r,n){const a=typeof t=="string"&&t?t.toLowerCase():"info",s=typeof o=="string"&&o?o:"Auto backup event";if(typeof console>"u"||!console)return;let l=null;if(a==="error"&&typeof console.error=="function"?l=console.error:a==="warn"&&typeof console.warn=="function"?l=console.warn:a==="info"&&typeof console.info=="function"?l=console.info:a==="debug"&&typeof console.debug=="function"?l=console.debug:typeof console.log=="function"&&(l=console.log),typeof l=="function")try{l.call(console,`[auto - backup] ${s} `,r||null,n||null)}catch{}};const rawCloneProjectEntryForSetup=CORE_AUTO_BACKUP_NAMESPACE&&typeof CORE_AUTO_BACKUP_NAMESPACE.cloneProjectEntryForSetup=="function"?CORE_AUTO_BACKUP_NAMESPACE.cloneProjectEntryForSetup:null,rawEnsureAutoBackupsFromProjects=CORE_AUTO_BACKUP_NAMESPACE&&typeof CORE_AUTO_BACKUP_NAMESPACE.ensureAutoBackupsFromProjects=="function"?CORE_AUTO_BACKUP_NAMESPACE.ensureAutoBackupsFromProjects:null;var showAutoBackups$2=!1;try{typeof localStorage<"u"&&(showAutoBackups$2=localStorage.getItem("showAutoBackups")==="true")}catch(e){localLogAutoBackupEvent("warn","Could not load auto backup visibility preference",e)}function cloneProjectEntryForSetup(e){if(rawCloneProjectEntryForSetup)return rawCloneProjectEntryForSetup(e,{deepClone:CORE_DEEP_CLONE,log:localLogAutoBackupEvent});if(!e||typeof e!="object")return{};try{return CORE_DEEP_CLONE(e)}catch(t){localLogAutoBackupEvent("warn","Fallback auto backup project clone failed",t);const o={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r]);return o}}function ensureAutoBackupsFromProjects$1(){return rawEnsureAutoBackupsFromProjects?rawEnsureAutoBackupsFromProjects({loadProject:typeof loadProject=="function"?loadProject:null,getSetups:getSetups$2,storeSetups:storeSetups$1,log:localLogAutoBackupEvent,cloneProjectEntry:e=>cloneProjectEntryForSetup(e),autoBackupNamePrefix:AUTO_BACKUP_NAME_PREFIX,autoBackupDeletionPrefix:AUTO_BACKUP_DELETION_PREFIX}):!1}if(showAutoBackups$2)try{ensureAutoBackupsFromProjects$1()}catch(e){localLogAutoBackupEvent("warn","Failed to prepare auto backups from project storage",e)}function getSetups$2(){return loadSetups()}exposeCoreRuntimeConstant$1("getSetups",getSetups$2);function storeSetups$1(e){saveSetups(e)}exposeCoreRuntimeConstant$1("storeSetups",storeSetups$1);function loadSession(){return typeof loadSessionState=="function"?loadSessionState():null}exposeCoreRuntimeConstant$1("loadSession",loadSession);function storeSession$1(e){typeof saveSessionState=="function"&&saveSessionState(e)}exposeCoreRuntimeConstant$1("storeSession",storeSession$1);function toggleDialog(e,t){e&&(t?typeof e.showModal=="function"?e.showModal():e.setAttribute("open",""):typeof e.close=="function"?e.close():e.removeAttribute("open"))}function openDialog$1(e){toggleDialog(e,!0)}function closeDialog$1(e){toggleDialog(e,!1)}function isDialogOpen$1(e){return e?typeof e.open=="boolean"?!!(e.open||typeof e.hasAttribute=="function"&&e.hasAttribute("open")):typeof e.hasAttribute=="function"&&e.hasAttribute("open"):!1}exposeCoreRuntimeConstant$1("normalizeDevicesForPersistence",normalizeDevicesForPersistence);function resolveUpdateDevicesReferenceFunction(){let e=null;try{e=typeof updateGlobalDevicesReference=="function"?updateGlobalDevicesReference:null}catch{e=null}if(e)return e;const t=[],o=r=>{!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)};try{o(typeof CORE_PART1_RUNTIME_SCOPE$1<"u"?CORE_PART1_RUNTIME_SCOPE$1:null)}catch{}try{o(typeof CORE_GLOBAL_SCOPE$3<"u"?CORE_GLOBAL_SCOPE$3:null)}catch{}try{o(typeof DEVICE_GLOBAL_SCOPE<"u"?DEVICE_GLOBAL_SCOPE:null)}catch{}try{o(typeof CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1<"u"?CORE_RUNTIME_PRIMARY_SCOPE_CANDIDATE$1:null)}catch{}o(typeof globalThis<"u"?globalThis:null),o(typeof window<"u"?window:null),o(typeof self<"u"?self:null),o(typeof global<"u"?global:null);for(let r=0;r<t.length;r+=1){const n=t[r];try{const a=n&&n.updateGlobalDevicesReference;if(typeof a=="function")return a}catch{}}return null}window.defaultDevices===void 0&&(window.defaultDevices=CORE_DEEP_CLONE(window.devices),localMarkDevicesNormalized(window.defaultDevices),unifyDevices$1(window.defaultDevices));let storedDevices=loadDeviceData();if(storedDevices){const e=CORE_DEEP_CLONE(window.defaultDevices);for(const[o,r]of Object.entries(storedDevices))if(o==="fiz"&&r&&typeof r=="object"){e.fiz=e.fiz||{};for(const[n,a]of Object.entries(r))e.fiz[n]={...e.fiz[n]||{},...a||{}}}else e[o]&&typeof e[o]=="object"?e[o]={...e[o],...r||{}}:e[o]=r;window.devices=devices$1=e;const t=resolveUpdateDevicesReferenceFunction();if(typeof t=="function")try{t(devices$1)}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to update global devices reference during initialization",o)}}unifyDevices$1(devices$1,{force:!0});function getBatteryPlateSupport(e){const t=devices$1.cameras&&devices$1.cameras[e];return!t||!t.power||!Array.isArray(t.power.batteryPlateSupport)?[]:t.power.batteryPlateSupport.filter(Boolean).map(o=>!o||typeof o!="object"?o:o.type==="Gold Mount"?{...o,type:"Gold-Mount"}:o)}function getSupportedBatteryPlates(e){return getBatteryPlateSupport(e).map(t=>t.type).filter(Boolean)}function getAvailableBatteryPlates(e){const t=getBatteryPlateSupport(e);if(!t.length)return[];const o=new Set(t.filter(r=>r.mount==="native"&&r.type).map(r=>r.type));return o.size===1&&o.has("B-Mount")?["B-Mount"]:[...new Set(getSupportedBatteryPlates(e))]}var batteryPlateSelect$2;function ensureBatteryPlateElements(){if(typeof document>"u"){typeof batteryPlateSelect$2>"u"&&(batteryPlateSelect$2=null);return}document.getElementById("batteryPlateRow"),batteryPlateSelect$2=document.getElementById("batteryPlateSelect")}function getSelectedPlate$1(){ensureBatteryPlateElements();const e=typeof cameraSelect$2?.value=="string"?cameraSelect$2.value:"",t=typeof getAvailableBatteryPlates=="function"?getAvailableBatteryPlates(e):[];if(!Array.isArray(t)||!t.length)return null;const o=typeof batteryPlateSelect$2?.value=="string"?batteryPlateSelect$2.value:"";return o||(t.includes("V-Mount")?"V-Mount":t[0])}function sdiRate(e){const t=/([\d.]+)G-SDI/i.exec(e||"");return t?parseFloat(t[1]):/SDI/i.test(e||"")?1:null}function connectionLabel(e,t){if(!e||!t)return"";if(/HDMI/i.test(e)&&/HDMI/i.test(t))return"HDMI";if(/SDI/i.test(e)&&/SDI/i.test(t)){const o=Math.min(sdiRate(e)||0,sdiRate(t)||0)||sdiRate(e)||sdiRate(t)||0;return o>=12?"12G-SDI":o>=6?"6G-SDI":o>=3?"3G-SDI":o>=1.5?"1.5G-SDI":"SDI"}return/HDMI/i.test(e)?"HDMI":/SDI/i.test(e)?"SDI":""}function updateBatteryLabel(){const e=document.getElementById("batteryLabel");if(!e)return;const t=getLanguageTexts(currentLang$1),o=getLanguageTexts(DEFAULT_LANGUAGE_SAFE$1),r=resolveTextEntryInternal(t,o,"batterySelectHelp","");r?e.setAttribute("data-help",r):e.removeAttribute("data-help"),getSelectedPlate$1()==="B-Mount"?e.textContent=resolveTextEntryInternal(t,o,"batteryBMountLabel","B-Mount Battery:"):e.textContent=resolveTextEntryInternal(t,o,"batteryLabel","Battery:")}const BRAND_KEYWORDS={arri:"arri",cmotion:"cmotion",focusbug:"focusbug",tilta:"tilta",preston:"preston",chrosziel:"chrosziel",smallrig:"smallrig",dji:"dji",redrock:"redrock",teradek:"teradek"};function detectBrand$1(e){if(!e)return null;const t=String(e).trim().toLowerCase();if(t==="none")return null;for(const[o,r]of Object.entries(BRAND_KEYWORDS))if(t.includes(o))return r;return"other"}const STATUS_CLASS_BY_LEVEL={info:"status-message--info",success:"status-message--success",note:"status-message--note",warning:"status-message--warning",danger:"status-message--danger"};function setStatusLevel$1(e,t){if(!e)return;const o=Object.values(STATUS_CLASS_BY_LEVEL);if(e.classList)o.forEach(r=>e.classList.remove(r));else if(typeof e.className=="string"){const r=e.className.split(/\s+/).filter(Boolean).filter(n=>!o.includes(n));e.className=r.join(" ")}e.dataset&&"statusLevel"in e.dataset?delete e.dataset.statusLevel:e.removeAttribute&&e.removeAttribute("data-status-level")}var gearItemTranslations$1={};function resolveTranslationsRuntime(){var e=[];function t(){return typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null}try{e.push(typeof CORE_GLOBAL_SCOPE$3<"u"?CORE_GLOBAL_SCOPE$3:null)}catch{}e.push(t());for(var o=0;o<e.length;o+=1){var r=e[o];if(!(!r||typeof r!="object"))try{var n=r.translations;if(n&&typeof n.loadLanguage=="function")return n}catch{}}return typeof translations<"u"&&translations&&typeof translations.loadLanguage=="function"?translations:null}var translationsRuntime=resolveTranslationsRuntime();if(typeof texts$1>"u"){var translations=null,globalScope$4=(function(){return typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null})();translationsRuntime&&translationsRuntime.texts&&translationsRuntime.categoryNames&&translationsRuntime.gearItems?translations={texts:translationsRuntime.texts,categoryNames:translationsRuntime.categoryNames,gearItems:translationsRuntime.gearItems}:globalScope$4&&globalScope$4.texts&&globalScope$4.categoryNames&&globalScope$4.gearItems&&(translations={texts:globalScope$4.texts,categoryNames:globalScope$4.categoryNames,gearItems:globalScope$4.gearItems}),translations?(globalScope$4&&(!globalScope$4.texts&&translations.texts&&(globalScope$4.texts=translations.texts),!globalScope$4.categoryNames&&translations.categoryNames&&(globalScope$4.categoryNames=translations.categoryNames),!globalScope$4.gearItems&&translations.gearItems&&(globalScope$4.gearItems=translations.gearItems)),gearItemTranslations$1=translations.gearItems||{}):gearItemTranslations$1={}}else gearItemTranslations$1=typeof gearItems<"u"?gearItems:{};var autoGearHeadingElem=null,autoGearDescriptionElem=null,autoGearMonitorDefaultsHeading=null,autoGearMonitorDefaultsDescription=null,autoGearDefaultFocusMonitorSelect=null,autoGearDefaultHandheldMonitorSelect=null,autoGearDefaultComboMonitorSelect=null,autoGearDefaultDirectorMonitorSelect=null,autoGearDefaultFocusMonitorLabel=null,autoGearDefaultHandheldMonitorLabel=null,autoGearDefaultComboMonitorLabel=null,autoGearDefaultDirectorMonitorLabel=null,autoGearMonitorDefaultControls=[],autoGearSearchInput$1=null,autoGearSearchLabel=null,autoGearFilterScenarioLabel=null,autoGearFilterScenarioSelect$1=null,autoGearFilterClearButton$1=null,autoGearPresetDescription=null,autoGearPresetLabel=null,autoGearPresetSelect$1=null,autoGearSavePresetButton$1=null,autoGearDeletePresetButton$1=null,autoGearAddRuleBtn$1=null,autoGearResetFactoryButton$1=null,autoGearEditor$1=null,autoGearConditionSelectLabel=null,autoGearConditionSelect$1=null,autoGearConditionAddButton$1=null,autoGearAlwaysLabel$1=null,autoGearAlwaysHelp=null,autoGearConditionAddShortcuts={},autoGearConditionRemoveButtons={};const AUTO_GEAR_UI_EXPORTS$1=(function e(){if(typeof resolveCoreSupportModule=="function")try{const t=resolveCoreSupportModule("cineCoreAutoGearUi","./app-core-auto-gear-ui.js");if(t&&typeof t=="object")return t}catch{}try{if(typeof cineCoreAutoGearUi=="object"&&cineCoreAutoGearUi)return cineCoreAutoGearUi}catch{}try{const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(t&&typeof t.cineCoreAutoGearUi=="object"&&t.cineCoreAutoGearUi)return t.cineCoreAutoGearUi}catch{}return{}})();var autoGearRuleNameInput$1=AUTO_GEAR_UI_EXPORTS$1.autoGearRuleNameInput!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearRuleNameInput:null,autoGearRuleNameLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearRuleNameLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearRuleNameLabel:null,autoGearScenariosSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearScenariosSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearScenariosSelect:null,autoGearScenariosLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearScenariosLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearScenariosLabel:null,autoGearScenarioModeLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioModeLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioModeLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioMultiplierContainer!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioMultiplierContainer;var autoGearScenarioBaseSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioBaseSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioBaseSelect:null,autoGearScenarioBaseLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioBaseLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioBaseLabel:null,autoGearScenarioFactorInput$2=AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioFactorInput!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioFactorInput:null,autoGearScenarioFactorLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioFactorLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioFactorLabel:null,autoGearShootingDaysMode$1=AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysMode!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysMode:null,autoGearShootingDaysInput$1=AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysInput!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysInput:null,autoGearShootingDaysLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysLabel:null,autoGearShootingDaysHelp$1=AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysHelp!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysHelp:null,autoGearShootingDaysValueLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysValueLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearShootingDaysValueLabel:null,autoGearMatteboxSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxSelect:null,autoGearMatteboxLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearMatteboxModeSelect;var autoGearCameraHandleSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleSelect:null,autoGearCameraHandleLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCameraHandleModeSelect;var autoGearViewfinderExtensionSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionSelect:null,autoGearViewfinderExtensionLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearViewfinderExtensionModeSelect;var autoGearDeliveryResolutionSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionSelect:null,autoGearDeliveryResolutionLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearDeliveryResolutionModeSelect;var autoGearVideoDistributionSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionSelect:null,autoGearVideoDistributionLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearVideoDistributionModeSelect;var autoGearCameraSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraSelect:null,autoGearCameraLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearCameraModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCameraModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearCameraModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCameraModeSelect;var autoGearOwnGearLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearModeSelect;var autoGearOwnGearSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearOwnGearSelect:null,autoGearCameraWeightLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightLabel:null,autoGearCameraWeightOperator$2=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightOperator!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightOperator:null,autoGearCameraWeightOperatorLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightOperatorLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightOperatorLabel:null,autoGearCameraWeightValueInput$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightValueInput!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightValueInput:null,autoGearCameraWeightValueLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightValueLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightValueLabel:null,autoGearCameraWeightHelp$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightHelp!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCameraWeightHelp:null,autoGearMonitorSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorSelect:null,autoGearMonitorLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearMonitorModeSelect;var autoGearTripodHeadBrandSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandSelect:null,autoGearTripodHeadBrandLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodHeadBrandModeSelect;var autoGearTripodBowlSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlSelect:null,autoGearTripodBowlLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodBowlModeSelect;var autoGearTripodTypesSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesSelect:null,autoGearTripodTypesLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodTypesModeSelect;var autoGearTripodSpreaderSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderSelect:null,autoGearTripodSpreaderLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearTripodSpreaderModeSelect;var autoGearCrewPresentSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentSelect:null,autoGearCrewPresentLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCrewPresentModeSelect;var autoGearCrewAbsentSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentSelect:null,autoGearCrewAbsentLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearCrewAbsentModeSelect;var autoGearWirelessSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessSelect:null,autoGearWirelessLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearWirelessModeSelect;var autoGearMotorsSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsSelect:null,autoGearMotorsLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearMotorsModeSelect;var autoGearControllersSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearControllersSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearControllersSelect:null,autoGearControllersLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearControllersLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearControllersLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearControllersModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearControllersModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearControllersModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearControllersModeSelect;var autoGearDistanceSelect$2=AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceSelect!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceSelect:null,autoGearDistanceLabel$1=AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceLabel!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceLabel:null;AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceModeLabel!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceModeLabel;AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceModeSelect!==void 0&&AUTO_GEAR_UI_EXPORTS$1.autoGearDistanceModeSelect;var autoGearConditionLabels$1=AUTO_GEAR_UI_EXPORTS$1.autoGearConditionLabels!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearConditionLabels:{},autoGearConditionSelects$1=AUTO_GEAR_UI_EXPORTS$1.autoGearConditionSelects!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearConditionSelects:{},autoGearConditionLogicLabels$1=AUTO_GEAR_UI_EXPORTS$1.autoGearConditionLogicLabels!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearConditionLogicLabels:{},autoGearConditionLogicSelects$1=AUTO_GEAR_UI_EXPORTS$1.autoGearConditionLogicSelects!==void 0?AUTO_GEAR_UI_EXPORTS$1.autoGearConditionLogicSelects:{};const getAutoGearScenarioModeSelectElementRef=typeof AUTO_GEAR_UI_EXPORTS$1.getAutoGearScenarioModeSelectElement=="function"?AUTO_GEAR_UI_EXPORTS$1.getAutoGearScenarioModeSelectElement:()=>AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioModeSelectElement||null,setAutoGearScenarioModeSelectElementRef=typeof AUTO_GEAR_UI_EXPORTS$1.setAutoGearScenarioModeSelectElement=="function"?AUTO_GEAR_UI_EXPORTS$1.setAutoGearScenarioModeSelectElement:e=>{AUTO_GEAR_UI_EXPORTS$1.autoGearScenarioModeSelectElement=e||null};let autoGearScenarioModeSelectElement=getAutoGearScenarioModeSelectElementRef();setAutoGearScenarioModeSelectElementRef(autoGearScenarioModeSelectElement);var AUTO_GEAR_CONDITION_KEYS$1=Array.isArray(AUTO_GEAR_UI_EXPORTS$1.AUTO_GEAR_CONDITION_KEYS)?AUTO_GEAR_UI_EXPORTS$1.AUTO_GEAR_CONDITION_KEYS:["always","scenarios","shootingDays","mattebox","cameraHandle","viewfinderExtension","deliveryResolution","videoDistribution","camera","ownGear","cameraWeight","monitor","tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader","crewPresent","crewAbsent","wireless","motors","controllers","distance"];const AUTO_GEAR_REPEATABLE_CONDITIONS=AUTO_GEAR_UI_EXPORTS$1.AUTO_GEAR_REPEATABLE_CONDITIONS instanceof Set?AUTO_GEAR_UI_EXPORTS$1.AUTO_GEAR_REPEATABLE_CONDITIONS:new Set(["scenarios","mattebox","cameraHandle","viewfinderExtension","deliveryResolution","videoDistribution","camera","ownGear","monitor","tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader","crewPresent","crewAbsent","wireless","motors","controllers","distance"]);var AUTO_GEAR_CONDITION_FALLBACK_LABELS=AUTO_GEAR_UI_EXPORTS$1.AUTO_GEAR_CONDITION_FALLBACK_LABELS||{always:"Always include",scenarios:"Required scenarios",shootingDays:"Shooting days condition",mattebox:"Mattebox options",cameraHandle:"Camera handles",viewfinderExtension:"Viewfinder extension",deliveryResolution:"Delivery resolution",videoDistribution:"Video distribution",camera:"Camera",ownGear:"Own gear items",cameraWeight:"Camera weight",monitor:"Onboard monitor",tripodHeadBrand:"Tripod head brand",tripodBowl:"Tripod bowl size",tripodTypes:"Tripod types",tripodSpreader:"Tripod spreader",crewPresent:"Crew present",crewAbsent:"Crew absent",wireless:"Wireless transmitter",motors:"FIZ motors",controllers:"FIZ controllers",distance:"FIZ distance devices"};function resolveFocusScalePreference(){if(typeof resolveGlobalFocusScalePreference=="function")try{const e=resolveGlobalFocusScalePreference();if(e==="imperial"||e==="metric")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="imperial"||t==="metric")return t}}catch(e){console.warn("resolveGlobalFocusScalePreference helper threw an error while resolving a focus scale label",e)}if(typeof focusScalePreference=="string"){const e=focusScalePreference.trim().toLowerCase();if(e==="imperial"||e==="metric")return e}return""}function normalizeFocusScaleForLabel(e){const t=r=>{if(typeof normalizeFocusScale=="function")try{const n=normalizeFocusScale(r);if(n==="imperial"||n==="metric")return n;if(n===""||n===null)return""}catch(n){console.warn("normalizeFocusScale helper threw an error while resolving a focus scale label",n)}if(typeof r=="string"){const n=r.trim().toLowerCase();if(n==="imperial")return"imperial";if(n==="metric")return"metric";if(!n)return""}return""},o=t(e);if(o===""&&(typeof e>"u"||e===null||typeof e=="string"&&!e.trim())){const r=resolveFocusScalePreference(),n=t(r);if(n==="imperial"||n==="metric")return n}return o}function getFocusScaleLabelForLang(e=currentLang$1,t){const o=normalizeFocusScaleForLabel(t),r=getLanguageTexts(e)||{},n=getLanguageTexts("en")||{},a=r.focusScaleMetric||n.focusScaleMetric||r.focusScaleSetting||n.focusScaleSetting||"Metric",s=r.focusScaleImperial||n.focusScaleImperial||r.focusScaleSetting||n.focusScaleSetting||"Imperial";if(o==="imperial")return s;if(o==="metric")return a;if(typeof t=="string"){const l=t.trim();if(l)return l}return r.focusScaleSetting||r.lensFocusScaleLabel||n.focusScaleSetting||n.lensFocusScaleLabel||a}const DEFAULT_LANGUAGE_SAFE$1=(function e(){const t=[function(){try{if(typeof DEFAULT_LANGUAGE=="string"&&DEFAULT_LANGUAGE)return DEFAULT_LANGUAGE}catch{}return null},function(){try{if(typeof LOCALE_MODULE=="object"&&LOCALE_MODULE&&typeof LOCALE_MODULE.DEFAULT_LANGUAGE=="string"&&LOCALE_MODULE.DEFAULT_LANGUAGE)return LOCALE_MODULE.DEFAULT_LANGUAGE}catch{}return null},function(){try{if(typeof ACTIVE_LOCALIZATION_ACCESSORS=="object"&&ACTIVE_LOCALIZATION_ACCESSORS&&typeof ACTIVE_LOCALIZATION_ACCESSORS.defaultLanguage=="string"&&ACTIVE_LOCALIZATION_ACCESSORS.defaultLanguage)return ACTIVE_LOCALIZATION_ACCESSORS.defaultLanguage}catch{}return null},function(){try{const r=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(r&&typeof r.DEFAULT_LANGUAGE=="string"&&r.DEFAULT_LANGUAGE)return r.DEFAULT_LANGUAGE;if(r&&typeof r.CPP_DEFAULT_LANGUAGE_SAFE=="string"&&r.CPP_DEFAULT_LANGUAGE_SAFE)return r.CPP_DEFAULT_LANGUAGE_SAFE}catch{}return null}];for(let o=0;o<t.length;o+=1){const r=t[o]();if(typeof r=="string"&&r)return r}return"en"})();if(translationsRuntime&&typeof translationsRuntime.loadLanguage=="function")try{var runtimeLoadResult=translationsRuntime.loadLanguage(DEFAULT_LANGUAGE_SAFE$1);runtimeLoadResult&&typeof runtimeLoadResult.then=="function"&&runtimeLoadResult.catch(function(t){console.warn("Failed to eagerly load default translations",t)})}catch(e){console.warn("Failed to trigger default translation load",e)}const SUPPORTED_LANGUAGES=(()=>{const e=new Set,t=o=>{if(typeof o!="string")return;const r=o.trim().toLowerCase();if(!r)return;e.add(r);const n=r.slice(0,2);n&&n!==r&&e.add(n)};if(typeof texts$1=="object"&&texts$1!==null&&Object.keys(texts$1).forEach(t),translationsRuntime&&typeof translationsRuntime=="object"&&(translationsRuntime.texts&&typeof translationsRuntime.texts=="object"&&Object.keys(translationsRuntime.texts).forEach(t),typeof translationsRuntime.getAvailableLanguages=="function"))try{const o=translationsRuntime.getAvailableLanguages();Array.isArray(o)&&o.forEach(t)}catch(o){console.warn("Failed to read available languages from translations runtime",o)}return t(DEFAULT_LANGUAGE_SAFE$1),Array.from(e)})();function resolveLanguagePreference(e){if(!e)return{language:DEFAULT_LANGUAGE_SAFE$1,matched:!1};const t=String(e).toLowerCase();if(SUPPORTED_LANGUAGES.includes(t))return{language:t,matched:!0};const o=t.slice(0,2);return SUPPORTED_LANGUAGES.includes(o)?{language:o,matched:!0}:{language:DEFAULT_LANGUAGE_SAFE$1,matched:!1}}try{const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;e&&typeof e=="object"&&((typeof e.CPP_DEFAULT_LANGUAGE_SAFE!="string"||!e.CPP_DEFAULT_LANGUAGE_SAFE)&&(e.CPP_DEFAULT_LANGUAGE_SAFE=DEFAULT_LANGUAGE_SAFE$1),(typeof e.DEFAULT_LANGUAGE!="string"||!e.DEFAULT_LANGUAGE)&&(e.DEFAULT_LANGUAGE=DEFAULT_LANGUAGE_SAFE$1))}catch(e){}var currentLang$1=DEFAULT_LANGUAGE_SAFE$1;let lastRuntimeHours$1=null;try{const e=localStorage.getItem("language"),t=resolveLanguagePreference(e);e&&t.matched&&(currentLang$1=t.language)}catch(e){console.warn("Could not load language from localStorage",e)}try{typeof document<"u"&&document&&document.documentElement&&(document.documentElement.lang=currentLang$1)}catch(e){}const syncLanguageSelectorsWithCurrentLang=()=>{try{if(typeof document<"u"&&document){const e=document.getElementById("languageSelect");e&&(e.value=currentLang$1);const t=document.getElementById("settingsLanguage");t&&(t.value=currentLang$1)}}catch(e){console.warn("Could not synchronize language selectors with initial language",e)}};syncLanguageSelectorsWithCurrentLang();typeof document<"u"&&document&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",syncLanguageSelectorsWithCurrentLang,{once:!0}):syncLanguageSelectorsWithCurrentLang());async function setLanguage$1(e,t={}){const o=typeof e=="string"?e:"",r=resolveLanguagePreference(o);let n=r.language;if(translationsRuntime&&typeof translationsRuntime.resolveLocaleKey=="function")try{n=translationsRuntime.resolveLocaleKey(n)}catch(T){console.warn("Failed to normalize language via runtime",T)}if(translationsRuntime&&typeof translationsRuntime.loadLanguage=="function")try{typeof translationsRuntime.showLoadingState=="function"&&translationsRuntime.showLoadingState(n);const T=translationsRuntime.loadLanguage(n);T&&typeof T.then=="function"&&await T}catch(T){console.warn(`Failed to load translations for "${n}"`,T)}finally{typeof translationsRuntime.clearLoadingState=="function"&&translationsRuntime.clearLoadingState()}const a=typeof texts$1=="object"&&texts$1||translationsRuntime&&translationsRuntime.texts||{};a[n]||(console.warn(`Missing translation bundle for "${n}".Falling back to ${DEFAULT_LANGUAGE_SAFE$1}.`),n=DEFAULT_LANGUAGE_SAFE$1),o&&n===DEFAULT_LANGUAGE_SAFE$1&&!r.matched&&o.slice(0,2).toLowerCase()!==DEFAULT_LANGUAGE_SAFE$1&&console.warn(`Unsupported language preference "${o}".Falling back to ${DEFAULT_LANGUAGE_SAFE$1}.`),e=n,!a[e]&&a[DEFAULT_LANGUAGE_SAFE$1]&&(a[e]=a[DEFAULT_LANGUAGE_SAFE$1]);const s=currentLang$1;currentLang$1=e,ensureInstallPromptElements();const l=s!==e,u=()=>{if(typeof window<"u"&&typeof window.dispatchEvent=="function"&&typeof Event=="function")try{window.dispatchEvent(new Event("languagechange"))}catch(T){console.warn("Failed to dispatch languagechange event",T)}};l&&(typeof queueMicrotask=="function"?queueMicrotask(u):typeof setTimeout=="function"?setTimeout(u,0):u());try{localStorage.setItem("language",e)}catch(T){console.warn("Could not save language to localStorage",T)}languageSelect&&(languageSelect.value=e),settingsLanguage$1&&(settingsLanguage$1.value=e),document.documentElement.lang=e,document.title=a[e].appTitle,document.getElementById("mainTitle")&&(document.getElementById("mainTitle").textContent=a[e].appTitle),document.getElementById("tagline")&&(document.getElementById("tagline").textContent=a[e].tagline);const d=typeof document<"u"?document:null,m=getCoreGlobalObject$1(),y=()=>{let T=null;if(typeof refreshDeviceLists=="function"?T=refreshDeviceLists:m&&typeof m.refreshDeviceLists=="function"&&(T=m.refreshDeviceLists.bind(m)),typeof T!="function")return!1;try{T()}catch(J){console.warn("setLanguage: refreshDeviceLists execution failed",J)}return!0};if(!y()){const T=()=>{y()};typeof queueMicrotask=="function"?queueMicrotask(T):typeof setTimeout=="function"&&setTimeout(T,0)}const h=a[DEFAULT_LANGUAGE_SAFE$1]||{},b=T=>{if(typeof normalizeTemperatureUnit=="function")try{return normalizeTemperatureUnit(T)}catch(J){console.warn("normalizeTemperatureUnit helper threw an error; falling back to safe normalization",J)}if(typeof T=="string"){const J=T.trim().toLowerCase();if(J===CORE_TEMPERATURE_UNITS?.fahrenheit||J==="fahrenheit"||J==="f")return CORE_TEMPERATURE_UNITS?.fahrenheit||"fahrenheit";if(J===CORE_TEMPERATURE_UNITS?.celsius||J==="celsius"||J==="c")return CORE_TEMPERATURE_UNITS?.celsius||"celsius"}return CORE_TEMPERATURE_UNITS?.celsius||"celsius"},v=T=>{if(typeof T=="string"){const J=T.trim().toLowerCase();if(J==="imperial"||J==="feet"||J==="ft")return"imperial";if(J==="metric"||J==="metre"||J==="meter"||J==="m")return"metric"}return"metric"};(()=>{if(typeof normalizeFocusScale=="function")return normalizeFocusScale;const T=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;if(T&&typeof T.normalizeFocusScale=="function")return T.normalizeFocusScale;if(T)try{Object.defineProperty(T,"normalizeFocusScale",{value:v,writable:!0,configurable:!0})}catch{T.normalizeFocusScale=v}return v})();const A=T=>{if(typeof normalizeFocusScale=="function")try{const J=normalizeFocusScale(T);if(J==="imperial"||J==="metric")return J}catch(J){console.warn("normalizeFocusScale helper threw an error; falling back to safe normalization",J)}return v(T)},w=()=>{const T=qe=>typeof qe=="string"&&qe?A(qe):null,J=[()=>typeof focusScalePreference<"u"?focusScalePreference:null,()=>typeof sessionFocusScale<"u"?sessionFocusScale:null,()=>{try{const qe=m&&m.preferences&&typeof m.preferences.getFocusScale=="function"?m.preferences.getFocusScale:null;if(qe)return qe()}catch(qe){console.warn("Failed to resolve focus scale preference from runtime scope; using fallback",qe)}return null}];for(const qe of J){const Rt=T(qe());if(Rt)return Rt}return"metric"},R=T=>{if(!T)return"";const J=texts$1[e],qe=J&&typeof J[T]=="string"?J[T]:null;return qe&&qe.trim()?qe:typeof h[T]=="string"?h[T]:""},_=(T,J,qe="")=>{if(!T)return;const Rt=R(J)||qe;T.textContent=Rt},G=(T,J,{target:qe,highlight:Rt,isButton:Vt=!0}={})=>{if(!d)return null;const Go=d.createElement("a");return Go.className=Vt?"help-link button-link":"help-link",Go.href=T,qe&&Go.setAttribute("data-help-target",qe),Rt&&Go.setAttribute("data-help-highlight",Rt),Go.textContent=J,Go},O=(T,J,qe=[])=>{if(!T||!d)return;const Rt=R(J);if(T.innerHTML="",!Rt){T.setAttribute("hidden","");return}T.removeAttribute("hidden");const Vt=d.createDocumentFragment(),Go=/%(?:(\d+)\$)?s/g;let zo=0,gr=0,It;for(;(It=Go.exec(Rt))!==null;){const Vr=It.index;Vr>zo&&Vt.appendChild(d.createTextNode(Rt.slice(zo,Vr)));const Nr=typeof It[1]=="string"?Math.max(parseInt(It[1],10)-1,0):gr++,Xt=qe[Nr];if(typeof Xt=="function"){const po=Xt();po&&Vt.appendChild(po)}zo=Go.lastIndex}zo<Rt.length&&Vt.appendChild(d.createTextNode(Rt.slice(zo))),T.appendChild(Vt)},B=(T,J)=>{if(!T)return;const qe=R(J);T.textContent=qe,qe?T.removeAttribute("hidden"):T.setAttribute("hidden","")},$=T=>{if(T){if(m&&typeof m=="object")try{if(T in m)return m[T]}catch{}if(typeof globalThis<"u"&&globalThis!==m)try{if(T in globalThis)return globalThis[T]}catch{}}},V=(T,J)=>{if(!T||!J)return J;try{exposeCoreRuntimeConstant$1(T,J)}catch{}return J},M=(T,J)=>{let qe=null;try{qe=$(T)}catch(Rt){console.warn(`Failed to resolve runtime value for "${T}"`,Rt),qe=null}if(qe&&typeof qe=="object")return qe;if(d&&typeof d.getElementById=="function"&&J)try{const Rt=d.getElementById(J);return V(T,Rt)}catch(Rt){return console.warn(`Failed to resolve document element "${J}"`,Rt),null}return null},F=M("settingsShowAutoBackups","settingsShowAutoBackups"),z=M("backupSettings","backupSettings"),x=M("backupDiffToggleButton","backupDiffToggleButton"),H=M("backupDiffHeading","backupDiffHeading"),W=M("backupDiffIntro","backupDiffIntro"),U=M("backupDiffPrimaryLabel","backupDiffPrimaryLabel"),j=M("backupDiffPrimarySelect","backupDiffPrimary"),Y=M("backupDiffSecondaryLabel","backupDiffSecondaryLabel"),le=M("backupDiffSecondarySelect","backupDiffSecondary"),be=M("backupDiffEmptyState","backupDiffEmptyState"),re=M("backupDiffNotesLabel","backupDiffNotesLabel"),de=M("backupDiffNotes","backupDiffNotes"),ne=M("backupDiffExportButton","backupDiffExport"),Ce=M("backupDiffCloseButton","backupDiffClose"),Ee=M("restoreRehearsalButton","restoreRehearsalButton"),Pe=M("restoreRehearsalHeading","restoreRehearsalHeading"),et=M("restoreRehearsalIntro","restoreRehearsalIntro"),Je=M("restoreRehearsalModeLabel","restoreRehearsalModeLabel"),it=M("restoreRehearsalModeBackupText","restoreRehearsalModeBackupText"),rt=M("restoreRehearsalModeProjectText","restoreRehearsalModeProjectText"),Pt=M("restoreRehearsalFileLabel","restoreRehearsalFileLabel"),vt=M("restoreRehearsalBrowse","restoreRehearsalBrowse"),bo=M("restoreRehearsalFileName","restoreRehearsalFileName"),Et=M("restoreRehearsalStatus","restoreRehearsalStatus"),Ut=M("restoreRehearsalRuleHeading","restoreRehearsalRuleHeading"),ge=M("restoreRehearsalRuleIntro","restoreRehearsalRuleIntro"),ue=M("restoreRehearsalRuleEmpty","restoreRehearsalRuleEmpty"),We=M("restoreRehearsalTableCaption","restoreRehearsalTableCaption"),Me=M("restoreRehearsalMetricHeader","restoreRehearsalMetricHeader"),Te=M("restoreRehearsalLiveHeader","restoreRehearsalLiveHeader"),Be=M("restoreRehearsalSandboxHeader","restoreRehearsalSandboxHeader"),Ve=M("restoreRehearsalDifferenceHeader","restoreRehearsalDifferenceHeader"),je=M("restoreRehearsalCloseButton","restoreRehearsalClose"),mt=M("restoreRehearsalProceedButton","restoreRehearsalProceed"),ct=M("restoreRehearsalAbortButton","restoreRehearsalAbort");skipLink&&(skipLink.textContent=texts$1[e].skipToContent);const $t=document.getElementById("offlineIndicator");if($t){const T=texts$1[e].offlineIndicator,J=texts$1[e].reloadAppOfflineNotice||T,qe=texts$1[e].offlineIndicatorHelp||J,Rt=typeof navigator<"u"&&typeof navigator.onLine=="boolean"?navigator.onLine===!1:!1;$t.dataset&&($t.dataset.baseLabel=T,$t.dataset.baseHelp=qe,$t.dataset.forceReloadNotice=J,$t.dataset.degradedLabel=texts$1[e].offlineIndicatorDegraded||J,$t.dataset.degradedHelp=texts$1[e].offlineIndicatorDegradedHelp||qe,$t.dataset.reasonCacheFallback=texts$1[e].offlineIndicatorReasonCacheFallback||J,$t.dataset.reasonGetFailed=texts$1[e].offlineIndicatorReasonGetFailed||J,$t.dataset.reasonTimeout=texts$1[e].offlineIndicatorReasonTimeout||J,$t.dataset.reasonUnreachable=texts$1[e].offlineIndicatorReasonUnreachable||J,$t.dataset.reasonReloadBlocked=texts$1[e].offlineIndicatorReasonReloadBlocked||J,$t.dataset.reasonUnknown=texts$1[e].offlineIndicatorReasonUnknown||qe),Rt?($t.textContent=J,$t.setAttribute("data-help",J),$t.removeAttribute("hidden")):($t.textContent=T,$t.setAttribute("data-help",qe))}applyInstallTexts(e);const fo=LEGAL_LINKS[e]||LEGAL_LINKS.en,no=document.getElementById("impressumLink");no&&(no.textContent=texts$1[e].impressum,fo?.imprint&&no.setAttribute("href",fo.imprint));const Nt=document.getElementById("privacyLink");Nt&&(Nt.textContent=texts$1[e].privacy,fo?.privacy&&Nt.setAttribute("href",fo.privacy));const xo=document.getElementById("setupManageHeading");xo&&(xo.textContent=texts$1[e].setupManageHeading,xo.setAttribute("data-help",texts$1[e].setupManageHeadingHelp));const Io=document.getElementById("deviceSelectionHeading");Io&&(Io.textContent=texts$1[e].deviceSelectionHeading,Io.setAttribute("data-help",texts$1[e].deviceSelectionHeadingHelp));const qo=document.getElementById("resultsHeading");qo&&(qo.textContent=texts$1[e].resultsHeading,qo.setAttribute("data-help",texts$1[e].resultsHeadingHelp));const eo=document.getElementById("deviceManagerHeading");eo&&(eo.textContent=texts$1[e].deviceManagerHeading,eo.setAttribute("data-help",texts$1[e].deviceManagerHeadingHelp));const To=document.getElementById("batteryComparisonHeading"),ko=document.getElementById("batteryComparisonDescription"),Jt=document.getElementById("batteryTable"),lr=document.getElementById("setupDiagramHeading");lr&&(lr.textContent=texts$1[e].setupDiagramHeading,lr.setAttribute("data-help",texts$1[e].setupDiagramHeadingHelp)),document.querySelectorAll("#sideMenu [data-nav-key]").forEach(T=>{if(!T||!T.dataset)return;const J=T.dataset.navKey;if(!J)return;const qe=texts$1[e][J];qe&&(J==="contactsNav"&&typeof setButtonLabelWithIconBinding$1=="function"&&T?.tagName==="BUTTON"?setButtonLabelWithIconBinding$1(T,qe,typeof ICON_GLYPHS=="object"&&ICON_GLYPHS&&ICON_GLYPHS.contacts?ICON_GLYPHS.contacts:iconGlyph$1("\\uF404",ICON_FONT_KEYS.UICONS)):T.textContent=qe,T.setAttribute("aria-label",qe));const Rt=`${J}Help`,Vt=texts$1[e][Rt];if(Vt)T.setAttribute("title",Vt),T.setAttribute("data-help",Vt);else{if(J==="projectRequirementsNav"){const Go=`${J}Help`;texts$1[e]&&!texts$1[e][Go]&&console.warn(`[Cine Power Planner] Missing help text for ${J} in lang ${e} `)}T.removeAttribute("title"),T.removeAttribute("data-help")}}),applyOwnGearLocalization(e);const mo=document.getElementById("savedSetupsLabel");mo&&(mo.textContent=texts$1[e].savedSetupsLabel,mo.setAttribute("data-help",texts$1[e].setupSelectHelp));const go=document.getElementById("setupNameLabel");go&&(go.textContent=texts$1[e].setupNameLabel,go.setAttribute("data-help",texts$1[e].setupNameHelp)),typeof deleteSetupBtn<"u"&&deleteSetupBtn&&setButtonLabelWithIconBinding$1(deleteSetupBtn,texts$1[e].deleteSetupBtn,ICON_GLYPHS.trash);const So=document.getElementById("sharedLinkLabel");So&&(So.textContent=texts$1[e].sharedLinkLabel,So.setAttribute("data-help",texts$1[e].sharedLinkHelp)),typeof applySharedLinkBtn<"u"&&applySharedLinkBtn&&setButtonLabelWithIconBinding$1(applySharedLinkBtn,texts$1[e].loadSharedLinkBtn,ICON_GLYPHS.fileImport);const k=typeof setupSelect$2<"u"?setupSelect$2:document.getElementById("setupSelect");k&&k.setAttribute("data-help",texts$1[e].setupSelectHelp);const Q=typeof setupNameInput$2<"u"?setupNameInput$2:document.getElementById("setupNameInput");Q&&Q.setAttribute("data-help",texts$1[e].setupNameHelp);const X=deleteSetupBtn;X&&typeof X.setAttribute=="function"&&(X.setAttribute("title",texts$1[e].deleteSetupHelp),X.setAttribute("aria-label",texts$1[e].deleteSetupHelp),X.setAttribute("data-help",texts$1[e].deleteSetupHelp));const ae=saveSetupBtn$1;ae&&(ae.setAttribute("title",texts$1[e].saveSetupHelp),ae.setAttribute("aria-label",texts$1[e].saveSetupHelp),ae.setAttribute("data-help",texts$1[e].saveSetupHelp));const Ae=generateOverviewBtn;Ae&&(Ae.setAttribute("title",texts$1[e].generateOverviewBtn),Ae.setAttribute("data-help",texts$1[e].generateOverviewHelp));const Se=generateGearListBtn;Se&&(Se.setAttribute("title",texts$1[e].generateGearListBtn),Se.setAttribute("data-help",texts$1[e].generateGearListHelp));try{const T=texts$1[e].deleteGearListBtnHelp||texts$1[e].deleteGearListBtn,J=deleteGearListProjectBtn;J&&typeof J.setAttribute=="function"&&(setButtonLabelWithIconBinding$1(J,texts$1[e].deleteGearListBtn,ICON_GLYPHS.trash),J.setAttribute("title",T),J.setAttribute("data-help",T),J.setAttribute("aria-label",T))}catch(T){console.warn("Error setting deleteGearListProjectBtn attributes",T)}const Oe=document.getElementById("editProjectBtn");Oe&&typeof Oe.setAttribute=="function"&&(Oe.textContent=texts$1[e].editProjectBtn,Oe.setAttribute("title",texts$1[e].editProjectBtn),Oe.setAttribute("data-help",texts$1[e].editProjectBtn));const Ne=document.getElementById("addExtraGearBtn");if(Ne&&typeof Ne.setAttribute=="function"){const T=texts$1[e].addExtraGearBtn||texts$1.en?.addExtraGearBtn||"Add temporary extra gear";Ne.textContent=T,Ne.setAttribute("title",T),Ne.setAttribute("data-help",T)}if(shareSetupBtn$1&&(shareSetupBtn$1.setAttribute("title",texts$1[e].shareSetupBtn),shareSetupBtn$1.setAttribute("data-help",texts$1[e].shareSetupHelp)),shareDialogHeadingElem){const T=texts$1[e].shareDialogTitle||texts$1.en?.shareDialogTitle||shareDialogHeadingElem.textContent;shareDialogHeadingElem.textContent=T}if(shareFilenameLabelElem){const T=texts$1[e].shareFilenameLabel||texts$1.en?.shareFilenameLabel||shareFilenameLabelElem.textContent;shareFilenameLabelElem.textContent=T}if(shareConfirmBtn){const T=texts$1[e].shareDialogConfirm||texts$1.en?.shareDialogConfirm||shareConfirmBtn.textContent;setButtonLabelWithIconBinding$1(shareConfirmBtn,T,ICON_GLYPHS.fileExport),shareConfirmBtn.setAttribute("title",T),shareConfirmBtn.setAttribute("aria-label",T),shareConfirmBtn.setAttribute("data-help",texts$1[e].shareSetupHelp)}if(shareCancelBtn){const T=texts$1[e].shareDialogCancel||texts$1.en?.shareDialogCancel||shareCancelBtn.textContent;setButtonLabelWithIconBinding$1(shareCancelBtn,T,ICON_GLYPHS.circleX),shareCancelBtn.setAttribute("title",T),shareCancelBtn.setAttribute("aria-label",T)}if(shareIncludeAutoGearText){const T=texts$1[e].shareIncludeAutoGearLabel||texts$1.en?.shareIncludeAutoGearLabel||shareIncludeAutoGearText.textContent;shareIncludeAutoGearText.textContent=T;const J=texts$1[e].shareIncludeAutoGearHelp||texts$1.en?.shareIncludeAutoGearHelp||T;shareIncludeAutoGearLabelElem&&typeof shareIncludeAutoGearLabelElem.setAttribute=="function"&&shareIncludeAutoGearLabelElem.setAttribute("data-help",J),shareIncludeAutoGearCheckbox&&shareIncludeAutoGearCheckbox.setAttribute("aria-label",T)}if(shareIncludeOwnedGearText){const T=texts$1[e].shareIncludeOwnedGearLabel||texts$1.en?.shareIncludeOwnedGearLabel||shareIncludeOwnedGearText.textContent;shareIncludeOwnedGearText.textContent=T;const J=texts$1[e].shareIncludeOwnedGearHelp||texts$1.en?.shareIncludeOwnedGearHelp||T;shareIncludeOwnedGearLabelElem&&typeof shareIncludeOwnedGearLabelElem.setAttribute=="function"&&shareIncludeOwnedGearLabelElem.setAttribute("data-help",J),shareIncludeOwnedGearCheckbox&&shareIncludeOwnedGearCheckbox.setAttribute("aria-label",T)}let Qe=sharedImportLegend?sharedImportLegend.textContent:"";if(sharedImportDialogHeading){const T=texts$1[e].sharedImportDialogTitle||texts$1.en?.sharedImportDialogTitle||sharedImportDialogHeading.textContent;sharedImportDialogHeading.textContent=T}if(sharedImportDialogMessage){const T=texts$1[e].sharedImportDialogMessage||texts$1.en?.sharedImportDialogMessage||sharedImportDialogMessage.textContent;sharedImportDialogMessage.textContent=T,sharedImportDialogMessage.setAttribute("data-help",T)}if(sharedImportConfirmBtn){const T=texts$1[e].sharedImportDialogConfirm||texts$1.en?.sharedImportDialogConfirm||sharedImportConfirmBtn.textContent;setButtonLabelWithIconBinding$1(sharedImportConfirmBtn,T,ICON_GLYPHS.check),sharedImportConfirmBtn.setAttribute("data-help",T)}if(sharedImportCancelBtn){const T=texts$1[e].sharedImportDialogCancel||texts$1.en?.sharedImportDialogCancel||sharedImportCancelBtn.textContent;setButtonLabelWithIconBinding$1(sharedImportCancelBtn,T,ICON_GLYPHS.circleX),sharedImportCancelBtn.setAttribute("data-help",T)}if(sharedImportLegend){const T=texts$1[e].sharedImportAutoGearLabel||texts$1.en?.sharedImportAutoGearLabel||sharedImportLegend.textContent;sharedImportLegend.textContent=T,Qe=T,sharedImportOptions&&sharedImportOptions.setAttribute("data-help",T)}if(sharedImportModeSelect&&Qe&&(sharedImportModeSelect.setAttribute("aria-label",Qe),sharedImportModeSelect.setAttribute("data-help",Qe)),sharedImportModeNoneOption){const T=texts$1[e].sharedImportAutoGearNone||texts$1.en?.sharedImportAutoGearNone||sharedImportModeNoneOption.textContent;sharedImportModeNoneOption.textContent=T;const J=texts$1[e].sharedImportAutoGearNoneHelp||texts$1.en?.sharedImportAutoGearNoneHelp||T;sharedImportModeNoneOption.setAttribute("data-help",J),sharedImportModeNoneOption.setAttribute("title",J),sharedImportModeNoneOption.setAttribute("aria-label",T)}if(sharedImportModeProjectOption){const T=texts$1[e].sharedImportAutoGearProject||texts$1.en?.sharedImportAutoGearProject||sharedImportModeProjectOption.textContent;sharedImportModeProjectOption.textContent=T;const J=texts$1[e].sharedImportAutoGearProjectHelp||texts$1.en?.sharedImportAutoGearProjectHelp||T;sharedImportModeProjectOption.setAttribute("data-help",J),sharedImportModeProjectOption.setAttribute("title",J),sharedImportModeProjectOption.setAttribute("aria-label",T)}if(sharedImportModeGlobalOption){const T=texts$1[e].sharedImportAutoGearGlobal||texts$1.en?.sharedImportAutoGearGlobal||sharedImportModeGlobalOption.textContent;sharedImportModeGlobalOption.textContent=T;const J=texts$1[e].sharedImportAutoGearGlobalHelp||texts$1.en?.sharedImportAutoGearGlobalHelp||T;sharedImportModeGlobalOption.setAttribute("data-help",J),sharedImportModeGlobalOption.setAttribute("title",J),sharedImportModeGlobalOption.setAttribute("aria-label",T)}applySharedLinkBtn&&(applySharedLinkBtn.setAttribute("title",texts$1[e].loadSharedLinkBtn),applySharedLinkBtn.setAttribute("data-help",texts$1[e].applySharedLinkHelp)),runtimeFeedbackBtn&&(runtimeFeedbackBtn.setAttribute("title",texts$1[e].runtimeFeedbackBtn),runtimeFeedbackBtn.setAttribute("data-help",texts$1[e].runtimeFeedbackBtnHelp),setButtonLabelWithIconBinding$1(runtimeFeedbackBtn,texts$1[e].runtimeFeedbackBtn,ICON_GLYPHS.feedback)),setupSelect$2&&setupSelect$2.options&&setupSelect$2.options.length>0&&(setupSelect$2.options[0].textContent=texts$1[e].newSetupOption),checkSetupChanged();const Fe=document.getElementById("cameraLabel");Fe&&(Fe.textContent=texts$1[e].cameraLabel,Fe.setAttribute("data-help",texts$1[e].cameraSelectHelp));const _e=document.getElementById("monitorLabel");_e&&(_e.textContent=texts$1[e].monitorLabel,_e.setAttribute("data-help",texts$1[e].monitorSelectHelp));const He=document.getElementById("videoLabel");He&&(He.textContent=texts$1[e].videoLabel,He.setAttribute("data-help",texts$1[e].videoSelectHelp));const st=document.getElementById("cageLabel");st&&(st.textContent=texts$1[e].cageLabel,st.setAttribute("data-help",texts$1[e].cageSelectHelp));const at=document.getElementById("distanceLabel");at&&(at.textContent=texts$1[e].distanceLabel,at.setAttribute("data-help",texts$1[e].distanceSelectHelp));const St=document.getElementById("batteryPlateLabel");St&&(St.textContent=texts$1[e].batteryPlateLabel,St.setAttribute("data-help",texts$1[e].batteryPlateSelectHelp));const kt=document.getElementById("batteryHotswapLabel");kt&&(kt.textContent=texts$1[e].batteryHotswapLabel,kt.setAttribute("data-help",texts$1[e].batteryHotswapSelectHelp)),updateBatteryLabel();const Zt=document.getElementById("fizLegend");Zt&&(Zt.textContent=texts$1[e].fizLegend,Zt.setAttribute("data-help",texts$1[e].fizLegendHelp));const Ht=document.getElementById("fizMotorsLabel");Ht&&(Ht.textContent=texts$1[e].fizMotorsLabel,Ht.setAttribute("data-help",texts$1[e].fizMotorsHelp));const jo=document.getElementById("fizControllersLabel");jo&&(jo.textContent=texts$1[e].fizControllersLabel,jo.setAttribute("data-help",texts$1[e].fizControllersHelp)),document.querySelectorAll("#motorNotesLabel,#controllerNotesLabel,#distanceNotesLabel").forEach(T=>{T.textContent=texts$1[e].notesLabel});var ir=typeof cineResults=="object"?cineResults:null,sr=!1;if(ir&&typeof ir.localizeResultsSection=="function")try{sr=ir.localizeResultsSection({lang:e,langTexts:texts$1[e]||{},fallbackTexts:texts$1.en||{},document,breakdownListElem:typeof breakdownListElem<"u"&&breakdownListElem?breakdownListElem:null,elements:{totalPowerLabel:document.getElementById("totalPowerLabel"),batteryCountLabel:document.getElementById("batteryCountLabel"),pinWarning:typeof pinWarnElem$1<"u"?pinWarnElem$1:null,dtapWarning:typeof dtapWarnElem$1<"u"?dtapWarnElem$1:null,hotswapWarning:typeof hotswapWarnElem$1<"u"?hotswapWarnElem$1:null,powerWarningTitle:typeof powerWarningTitleElem<"u"?powerWarningTitleElem:null,powerWarningLimitsHeading:typeof powerWarningLimitsHeadingElem<"u"?powerWarningLimitsHeadingElem:null,powerWarningAdvice:typeof powerWarningAdviceElem<"u"?powerWarningAdviceElem:null,powerWarningCloseBtn:typeof powerWarningCloseBtn<"u"?powerWarningCloseBtn:null,batteryLifeUnit:document.getElementById("batteryLifeUnit"),batteryLifeLabel:typeof batteryLifeLabelElem$1<"u"?batteryLifeLabelElem$1:document.getElementById("batteryLifeLabel"),runtimeAverageNote:typeof runtimeAverageNoteElem$1<"u"?runtimeAverageNoteElem$1:document.getElementById("runtimeAverageNote"),tempNote:document.getElementById("temperatureNote")},refreshTotalCurrentLabels:typeof refreshTotalCurrentLabels=="function"?refreshTotalCurrentLabels:null,updateMountVoltageSettingLabels:typeof updateMountVoltageSettingLabels=="function"?updateMountVoltageSettingLabels:null,getCurrentSetupKey:typeof getCurrentSetupKey=="function"?getCurrentSetupKey:null,renderFeedbackTable:typeof renderFeedbackTable=="function"?renderFeedbackTable:null,dispatchTemperatureNoteRender:typeof dispatchTemperatureNoteRender=="function"?dispatchTemperatureNoteRender:null,refreshFeedbackTemperatureLabel:typeof refreshFeedbackTemperatureLabel=="function"?refreshFeedbackTemperatureLabel:null,updateFeedbackTemperatureOptions:typeof updateFeedbackTemperatureOptions$1=="function"?updateFeedbackTemperatureOptions$1:null,lastRuntimeHours:typeof lastRuntimeHours$1<"u"?lastRuntimeHours$1:null,temperatureUnit:typeof temperatureUnit<"u"?temperatureUnit:null,setButtonLabelWithIcon:typeof setButtonLabelWithIconBinding$1=="function"?setButtonLabelWithIconBinding$1:null,iconGlyphs:typeof ICON_GLYPHS<"u"?ICON_GLYPHS:null})}catch(T){console.warn("cineResults.localizeResultsSection failed",T),sr=!1}var Ro=!1;if(ir&&typeof ir.localizeBatteryComparisonSection=="function")try{Ro=ir.localizeBatteryComparisonSection({lang:e,langTexts:texts$1[e]||{},fallbackTexts:texts$1.en||{},document,batteryComparisonHeading:To,batteryComparisonDescription:ko,batteryComparisonTable:Jt})}catch(T){console.warn("cineResults.localizeBatteryComparisonSection failed",T),Ro=!1}if(Ro||(To&&(To.textContent=texts$1[e].batteryComparisonHeading,To.setAttribute("data-help",texts$1[e].batteryComparisonHeadingHelp)),ko&&(ko.textContent=texts$1[e].batteryComparisonDescription,texts$1[e].batteryComparisonDescriptionHelp?ko.setAttribute("data-help",texts$1[e].batteryComparisonDescriptionHelp):ko.removeAttribute("data-help")),Jt&&(texts$1[e].batteryComparisonTableHelp?Jt.setAttribute("data-help",texts$1[e].batteryComparisonTableHelp):Jt.removeAttribute("data-help"))),!sr){const T=document.getElementById("resultsPlainSummary");T&&T.setAttribute("data-help",texts$1[e].resultsPlainSummaryHelp);const J=document.getElementById("resultsPlainSummaryTitle");J&&(J.textContent=texts$1[e].resultsPlainSummaryTitle);const qe=document.getElementById("resultsPlainSummaryText");qe&&(qe.textContent=texts$1[e].resultsPlainSummaryPrompt);const Rt=document.getElementById("resultsPlainSummaryNote");Rt&&(Rt.textContent=texts$1[e].resultsPlainSummaryNote);const Vt=typeof breakdownListElem<"u"&&breakdownListElem?breakdownListElem:document.getElementById("breakdownList");Vt&&Vt.setAttribute("data-help",texts$1[e].breakdownListHelp);const Go=document.getElementById("totalPowerLabel");Go&&texts$1[e]&&(Go.textContent=texts$1[e].totalPowerLabel,Go.setAttribute("data-help",texts$1[e].totalPowerHelp)),typeof refreshTotalCurrentLabels=="function"&&refreshTotalCurrentLabels(e),updateMountVoltageSettingLabels(e);const zo=document.getElementById("batteryCountLabel");zo&&(zo.textContent=texts$1[e].batteryCountLabel,zo.setAttribute("data-help",texts$1[e].batteryCountHelp)),pinWarnElem$1&&pinWarnElem$1.setAttribute("data-help",texts$1[e].pinWarningHelp),dtapWarnElem$1&&dtapWarnElem$1.setAttribute("data-help",texts$1[e].dtapWarningHelp),hotswapWarnElem$1&&hotswapWarnElem$1.setAttribute("data-help",texts$1[e].hotswapWarningHelp),powerWarningTitleElem&&(powerWarningTitleElem.textContent=texts$1[e].powerWarningTitle),powerWarningLimitsHeadingElem&&(powerWarningLimitsHeadingElem.textContent=texts$1[e].powerWarningLimitsHeading),powerWarningAdviceElem&&(powerWarningAdviceElem.textContent=texts$1[e].powerWarningAdvice),powerWarningCloseBtn&&setButtonLabelWithIconBinding$1(powerWarningCloseBtn,texts$1[e].powerWarningClose,ICON_GLYPHS.check);const gr=document.getElementById("batteryLifeUnit");gr&&(gr.textContent=texts$1[e].batteryLifeUnit);const It=renderFeedbackTable(getCurrentSetupKey());if(batteryLifeLabelElem$1){let Nr=texts$1[e].batteryLifeLabel;if(It){const Xt=texts$1[e].runtimeUserCountNote.replace("{count}",It.count),po=Nr.indexOf(")");po!==-1&&(Nr=`${Nr.slice(0,po)}, ${Xt}${Nr.slice(po)} `)}batteryLifeLabelElem$1.textContent=Nr,batteryLifeLabelElem$1.setAttribute("data-help",texts$1[e].batteryLifeHelp)}runtimeAverageNoteElem$1&&(runtimeAverageNoteElem$1.textContent=It&&It.count>4?texts$1[e].runtimeAverageNote:""),dispatchTemperatureNoteRender(lastRuntimeHours$1),typeof refreshFeedbackTemperatureLabel=="function"&&refreshFeedbackTemperatureLabel(e,temperatureUnit),updateFeedbackTemperatureOptions$1(e,temperatureUnit);const Vr=document.getElementById("temperatureNote");Vr&&Vr.setAttribute("data-help",texts$1[e].temperatureNoteHelp)}const Ot=(T,J)=>{const qe=document.getElementById(T);return qe&&J!==void 0&&(qe.textContent=J),qe},Lr=(T,J,qe)=>{const Rt=document.getElementById(T);return Rt&&J&&qe!==void 0&&Rt.setAttribute(J,qe),Rt};if(Ot("addDeviceHeading",texts$1[e].addDeviceHeading),Ot("categoryLabel",texts$1[e].categoryLabel),Ot("subcategoryLabel",texts$1[e].subcategoryLabel),Ot("deviceNameLabel",texts$1[e].deviceNameLabel),Ot("consumptionLabel",texts$1[e].consumptionLabel),Ot("capacityLabel",texts$1[e].capacityLabel),Ot("pinLabel",texts$1[e].pinLabel),Ot("dtapLabel",texts$1[e].dtapLabel),Ot("cameraWattLabel",texts$1[e].cameraWattLabel),Ot("cameraVoltageLabel",texts$1[e].cameraVoltageLabel),Ot("cameraPortTypeLabel",texts$1[e].cameraPortTypeLabel),Ot("cameraPlatesLabel",texts$1[e].cameraPlatesLabel),Ot("cameraMediaLabel",texts$1[e].cameraMediaLabel),Ot("cameraLensMountLabel",texts$1[e].cameraLensMountLabel),Ot("cameraPowerDistLabel",texts$1[e].powerDistributionLabel),Ot("cameraVideoOutputsLabel",texts$1[e].videoOutputsLabel),Ot("cameraFIZConnectorLabel",texts$1[e].fizConnectorLabel),Ot("cameraViewfinderLabel",texts$1[e].viewfinderLabel),Ot("cameraTimecodeLabel",texts$1[e].timecodeLabel),Ot("powerInputsHeading",texts$1[e].powerInputsHeading),Ot("powerDistributionHeading",texts$1[e].powerDistributionHeading),Ot("videoOutputsHeading",texts$1[e].videoOutputsHeading),Ot("fizConnectorHeading",texts$1[e].fizConnectorHeading),Ot("mediaHeading",texts$1[e].mediaHeading),Ot("viewfinderHeading",texts$1[e].viewfinderHeading),Ot("lensMountHeading",texts$1[e].lensMountHeading),Ot("lensDeviceMountHeading",texts$1[e].lensDeviceMountHeading),Ot("lensDeviceMountLabel",texts$1[e].lensDeviceMountLabel)&&Lr("lensDeviceMountLabel","data-help",texts$1[e].lensDeviceMountHelp),Ot("lensFocusScaleUnitLabel",texts$1[e].lensFocusScaleLabel||texts$1[e].focusScaleSetting)){const T=texts$1[e].lensFocusScaleLabel||texts$1[e].focusScaleSetting,J=texts$1[e].lensFocusScaleHelp||texts$1[e].lensFocusScaleLabel||texts$1[e].focusScaleSettingHelp||T;Lr("lensFocusScaleUnitLabel","data-help",J),lensFocusScaleSelect$1&&(lensFocusScaleSelect$1.setAttribute("data-help",J),lensFocusScaleSelect$1.setAttribute("aria-label",T))}updateLensFocusScaleSelectOptions$1(e),Ot("timecodeHeading",texts$1[e].timecodeHeading),Ot("monitorScreenSizeLabel",texts$1[e].monitorScreenSizeLabel),Ot("monitorBrightnessLabel",texts$1[e].monitorBrightnessLabel),Ot("monitorWattLabel",texts$1[e].monitorWattLabel),Ot("monitorVoltageLabel",texts$1[e].monitorVoltageLabel),Ot("monitorPortTypeLabel",texts$1[e].monitorPortTypeLabel),Ot("monitorVideoInputsHeading",texts$1[e].monitorVideoInputsHeading),Ot("monitorVideoOutputsHeading",texts$1[e].monitorVideoOutputsHeading),Ot("monitorVideoInputsLabel",texts$1[e].monitorVideoInputsLabel),Ot("monitorVideoOutputsLabel",texts$1[e].monitorVideoOutputsLabel),Ot("monitorWirelessTxLabel",texts$1[e].monitorWirelessTxLabel);const Wo=Ot("monitorLatencyLabel",texts$1[e].monitorLatencyLabel);if(Wo){const T=texts$1[e].monitorLatencyHelp;T?(Wo.setAttribute("data-help",T),Wo.setAttribute("title",T),monitorLatencyInput$1&&(monitorLatencyInput$1.setAttribute("data-help",T),monitorLatencyInput$1.setAttribute("title",T))):(Wo.removeAttribute("data-help"),Wo.removeAttribute("title"),monitorLatencyInput$1&&(monitorLatencyInput$1.removeAttribute("data-help"),monitorLatencyInput$1.removeAttribute("title")))}Ot("monitorAudioOutputLabel",texts$1[e].monitorAudioOutputLabel),Ot("viewfinderDetailsHeading",texts$1[e].viewfinderDetailsHeading),Ot("viewfinderScreenSizeLabel",texts$1[e].viewfinderScreenSizeLabel),Ot("viewfinderBrightnessLabel",texts$1[e].viewfinderBrightnessLabel),Ot("viewfinderWattLabel",texts$1[e].viewfinderWattLabel),Ot("viewfinderVoltageLabel",texts$1[e].viewfinderVoltageLabel),Ot("viewfinderPortTypeLabel",texts$1[e].viewfinderPortTypeLabel),Ot("viewfinderVideoInputsHeading",texts$1[e].viewfinderVideoInputsHeading),Ot("viewfinderVideoOutputsHeading",texts$1[e].viewfinderVideoOutputsHeading),Ot("viewfinderVideoInputsLabel",texts$1[e].viewfinderVideoInputsLabel),Ot("viewfinderVideoOutputsLabel",texts$1[e].viewfinderVideoOutputsLabel),Ot("viewfinderWirelessTxLabel",texts$1[e].viewfinderWirelessTxLabel);const Yo=Ot("viewfinderLatencyLabel",texts$1[e].viewfinderLatencyLabel);if(Yo){Yo.textContent=texts$1[e].viewfinderLatencyLabel;const T=texts$1[e].viewfinderLatencyHelp;T?(Yo.setAttribute("data-help",T),Yo.setAttribute("title",T),viewfinderLatencyInput$1&&(viewfinderLatencyInput$1.setAttribute("data-help",T),viewfinderLatencyInput$1.setAttribute("title",T))):(Yo.removeAttribute("data-help"),Yo.removeAttribute("title"),viewfinderLatencyInput$1&&(viewfinderLatencyInput$1.removeAttribute("data-help"),viewfinderLatencyInput$1.removeAttribute("title")))}Ot("videoPowerInputsHeading",texts$1[e].videoPowerInputsHeading||texts$1[e].powerInputsHeading||"Power Inputs");const Tt=document.getElementById("videoPowerInputLabel");if(Tt){Tt.textContent=texts$1[e].videoPowerInputLabel||texts$1[e].powerInputsHeading;const T=texts$1[e].videoPowerInputHelp||"";T?(Tt.setAttribute("data-help",T),Tt.setAttribute("title",T)):(Tt.removeAttribute("data-help"),Tt.removeAttribute("title"))}Ot("videoVideoInputsHeading",texts$1[e].videoVideoInputsHeading),Ot("videoVideoInputsLabel",texts$1[e].videoVideoInputsLabel),Ot("videoVideoOutputsHeading",texts$1[e].videoVideoOutputsHeading),Ot("videoVideoOutputsLabel",texts$1[e].videoVideoOutputsLabel),Ot("monitorDetailsHeading",texts$1[e].monitorDetailsHeading),Ot("monitorPowerHeading",texts$1[e].monitorPowerHeading);const $o=texts$1[e]&&texts$1[e].addDeviceBtn||"Add",br=texts$1[e]&&texts$1[e].updateDeviceBtn||"Update",Do=document.getElementById("addDeviceBtn");Do&&(Do.dataset&&Do.dataset.mode==="edit"?(setButtonLabelWithIconBinding$1(Do,br,ICON_GLYPHS.save),Do.setAttribute("data-help",texts$1[e]&&texts$1[e].updateDeviceBtnHelp||"")):(setButtonLabelWithIconBinding$1(Do,$o,ICON_GLYPHS.add),Do.setAttribute("data-help",texts$1[e]&&texts$1[e].addDeviceBtnHelp||"")));const ur=document.getElementById("cancelEditBtn");ur&&(setButtonLabelWithIconBinding$1(ur,texts$1[e].cancelEditBtn,ICON_GLYPHS.circleX),ur.setAttribute("data-help",texts$1[e].cancelEditBtnHelp));const or=document.getElementById("exportDataBtn");or&&(setButtonLabelWithIconBinding$1(or,texts$1[e].exportDataBtn,ICON_GLYPHS.fileExport),or.setAttribute("data-help",texts$1[e].exportDataHelp));const Vo=document.getElementById("importDataBtn");Vo&&(setButtonLabelWithIconBinding$1(Vo,texts$1[e].importDataBtn,ICON_GLYPHS.fileImport),Vo.setAttribute("data-help",texts$1[e].importDataHelp)),typeof setupNameInput$2<"u"&&setupNameInput$2&&(setupNameInput$2.placeholder=(texts$1[e].setupNameLabel||"").replace(":","")),typeof newNameInput$1<"u"&&newNameInput$1&&(newNameInput$1.placeholder=texts$1[e].placeholder_deviceName),typeof newWattInput$1<"u"&&newWattInput$1&&(newWattInput$1.placeholder=texts$1[e].placeholder_watt),typeof newCapacityInput$1<"u"&&newCapacityInput$1&&(newCapacityInput$1.placeholder=texts$1[e].placeholder_capacity),typeof newPinAInput$1<"u"&&newPinAInput$1&&(newPinAInput$1.placeholder=texts$1[e].placeholder_pin),typeof newDtapAInput$1<"u"&&newDtapAInput$1&&(newDtapAInput$1.placeholder=texts$1[e].placeholder_dtap),typeof cameraVoltageInput$1<"u"&&cameraVoltageInput$1&&(cameraVoltageInput$1.placeholder=texts$1[e].placeholder_voltage),typeof monitorVoltageInput$1<"u"&&monitorVoltageInput$1&&(monitorVoltageInput$1.placeholder=texts$1[e].placeholder_voltage),updateDeviceManagerLocalization(e);const Po=document.getElementById("toggleDeviceManager"),co=document.getElementById("device-manager");co&&Po&&(co.classList.contains("hidden")?(setButtonLabelWithIconBinding$1(Po,texts$1[e].toggleDeviceManager,ICON_GLYPHS.gears),Po.setAttribute("title",texts$1[e].toggleDeviceManager),Po.setAttribute("data-help",texts$1[e].toggleDeviceManagerHelp),Po.setAttribute("aria-expanded","false")):(setButtonLabelWithIconBinding$1(Po,texts$1[e].hideDeviceManager,ICON_GLYPHS.minus),Po.setAttribute("title",texts$1[e].hideDeviceManager),Po.setAttribute("data-help",texts$1[e].hideDeviceManagerHelp),Po.setAttribute("aria-expanded","true")));const mr=document.getElementById("newCategory");mr&&mr.options&&Array.from(mr.options).forEach(T=>{T.textContent=getCategoryLabel(T.value,e)});const Sr={de:"Keine Auswahl",es:"Ninguno",fr:"Aucun"};document.querySelectorAll('select option[value="None"]').forEach(T=>{T.textContent=Sr[e]||"None"});try{localStorage.setItem("language",e)}catch(T){console.warn("Could not save language to localStorage",T)}typeof refreshDeviceLists=="function"?refreshDeviceLists():typeof window<"u"&&typeof window.refreshDeviceLists=="function"&&window.refreshDeviceLists(),applyFilters$1(),t?.skipUpdateCalculations||updateCalculations();const jr=typeof document<"u"?document.getElementById("existingDevicesHeading"):null;jr&&(jr.textContent=texts$1[e].existingDevicesHeading),darkModeToggle$1&&(darkModeToggle$1.setAttribute("title",texts$1[e].darkModeLabel),darkModeToggle$1.setAttribute("aria-label",texts$1[e].darkModeLabel),darkModeToggle$1.setAttribute("data-help",texts$1[e].darkModeHelp||texts$1[e].darkModeLabel)),pinkModeToggle$1&&(pinkModeToggle$1.setAttribute("title",texts$1[e].pinkModeLabel),pinkModeToggle$1.setAttribute("aria-label",texts$1[e].pinkModeLabel),pinkModeToggle$1.setAttribute("data-help",texts$1[e].pinkModeHelp||texts$1[e].pinkModeLabel)),settingsButton$1&&(settingsButton$1.setAttribute("title",texts$1[e].settingsButton),settingsButton$1.setAttribute("aria-label",texts$1[e].settingsButton),settingsButton$1.setAttribute("data-help",texts$1[e].settingsButtonHelp||texts$1[e].settingsButton));const Qr=document.getElementById("settingsTitle");Qr&&(Qr.textContent=texts$1[e].settingsHeading,Qr.setAttribute("data-help",texts$1[e].settingsHeadingHelp||texts$1[e].settingsHeading));const an=document.getElementById("settingsTablist");if(an){const T=texts$1[e].settingsSectionsLabel||texts$1.en?.settingsSectionsLabel||an.getAttribute("aria-label")||texts$1[e].settingsHeading||"Settings sections";an.setAttribute("aria-label",T)}const Sn=T=>{if(!T||typeof T!="object")return"";const J=T.querySelector?.(".settings-tab-label");if(J&&typeof J.textContent=="string"){const qe=J.textContent.trim();if(qe)return qe}return typeof T.textContent=="string"?T.textContent.trim():""},Re=T=>{if(typeof T!="string")return"";const J=T.trim();if(!J)return"";const qe=J.match(/^[^.!?。！？]*[.!?。！？]/u);if(qe&&qe[0]){const zo=qe[0].trim();if(zo.length>=24||J.length<=90)return zo}if(J.length<=90)return J;const Rt=J.slice(0,90);let Vt=Rt.length;for(;Vt>0&&Rt[Vt-1]&&Rt[Vt-1].trim()!=="";)Vt-=1;return`${(Vt>0?Rt.slice(0,Vt).trimEnd():"")||Rt.trim()}…`},Ye=(T,J,qe)=>{if(!T)return;const Rt=(J||Sn(T)||"").trim(),Vt=T.querySelector?.(".settings-tab-label");Vt?Vt.textContent=Rt:T.textContent=Rt,Rt?T.setAttribute("aria-label",Rt):T.removeAttribute("aria-label");const Go=(qe||Rt||"").trim();Go?(T.setAttribute("data-help",Go),T.setAttribute("title",Go)):(T.removeAttribute("data-help"),T.removeAttribute("title"));const zo=Re(Go);zo?T.setAttribute("data-summary",zo):T.removeAttribute("data-summary");const gr=T.querySelector?.(".settings-tab-caption");if(gr){const It=zo||Rt;gr.textContent=It,It?gr.removeAttribute("hidden"):gr.setAttribute("hidden","")}};if(settingsTabGeneral){const T=texts$1[e].settingsTabGeneral||texts$1.en?.settingsTabGeneral||Sn(settingsTabGeneral)||"General",J=texts$1[e].settingsTabGeneralHelp||texts$1.en?.settingsTabGeneralHelp||texts$1[e].settingsHeadingHelp||T;if(Ye(settingsTabGeneral,T,J),generalSettingsHeading&&(generalSettingsHeading.textContent=T,generalSettingsHeading.setAttribute("data-help",J)),generalLanguageHeading){const qe=texts$1[e].generalSectionLanguageHeading||texts$1.en?.generalSectionLanguageHeading||generalLanguageHeading.textContent;generalLanguageHeading.textContent=qe}if(generalAppearanceHeading){const qe=texts$1[e].generalSectionAppearanceHeading||texts$1.en?.generalSectionAppearanceHeading||generalAppearanceHeading.textContent;generalAppearanceHeading.textContent=qe}if(generalTypographyHeading){const qe=texts$1[e].generalSectionTypographyHeading||texts$1.en?.generalSectionTypographyHeading||generalTypographyHeading.textContent;generalTypographyHeading.textContent=qe}if(generalBrandingHeading){const qe=texts$1[e].generalSectionBrandingHeading||texts$1.en?.generalSectionBrandingHeading||generalBrandingHeading.textContent;generalBrandingHeading.textContent=qe}documentationTrackerController.updateLocalization({language:e,texts:texts$1[e]||{},fallbackTexts:texts$1[DEFAULT_LANGUAGE_SAFE$1]||texts$1.en||{}}),documentationTrackerController.isInitialized()&&documentationTrackerController.render()}Ye(settingsTabAutoGear,texts$1[e].settingsTabAutoGear||texts$1.en?.settingsTabAutoGear||texts$1[e].autoGearHeading||texts$1.en?.autoGearHeading,texts$1[e].settingsTabAutoGearHelp||texts$1.en?.settingsTabAutoGearHelp||texts$1[e].autoGearHeadingHelp||texts$1.en?.autoGearHeadingHelp),Ye(settingsTabAccessibility,texts$1[e].settingsTabAccessibility||texts$1.en?.settingsTabAccessibility||texts$1[e].accessibilityHeading||texts$1.en?.accessibilityHeading,texts$1[e].settingsTabAccessibilityHelp||texts$1.en?.settingsTabAccessibilityHelp||texts$1[e].accessibilityHeadingHelp||texts$1.en?.accessibilityHeadingHelp),Ye(settingsTabBackup,texts$1[e].settingsTabBackup||texts$1.en?.settingsTabBackup||texts$1[e].backupHeading||texts$1.en?.backupHeading,texts$1[e].settingsTabBackupHelp||texts$1.en?.settingsTabBackupHelp||texts$1[e].backupHeadingHelp||texts$1.en?.backupHeadingHelp),Ye(settingsTabData,texts$1[e].settingsTabData||texts$1.en?.settingsTabData||texts$1[e].dataHeading||texts$1.en?.dataHeading,texts$1[e].settingsTabDataHelp||texts$1.en?.settingsTabDataHelp||texts$1[e].dataHeadingHelp||texts$1.en?.dataHeadingHelp),Ye(settingsTabAbout,texts$1[e].settingsTabAbout||texts$1.en?.settingsTabAbout||texts$1[e].aboutHeading||texts$1.en?.aboutHeading,texts$1[e].settingsTabAboutHelp||texts$1.en?.settingsTabAboutHelp||texts$1[e].aboutHeadingHelp||texts$1.en?.aboutHeadingHelp);const ke=document.getElementById("settingsLanguageLabel");if(ke){ke.textContent=texts$1[e].languageSetting;const T=texts$1[e].settingsLanguageHelp||texts$1[e].languageSetting;ke.setAttribute("data-help",T),settingsLanguage$1&&(settingsLanguage$1.setAttribute("data-help",T),settingsLanguage$1.setAttribute("aria-label",texts$1[e].languageSetting))}const ee=document.getElementById("settingsDarkModeLabel");if(ee){ee.textContent=texts$1[e].darkModeSetting;const T=texts$1[e].settingsDarkModeHelp||texts$1[e].darkModeSetting;ee.setAttribute("data-help",T),settingsDarkMode$1&&(settingsDarkMode$1.setAttribute("data-help",T),settingsDarkMode$1.setAttribute("aria-label",texts$1[e].darkModeSetting))}const I=document.getElementById("settingsPinkModeLabel");if(I){I.textContent=texts$1[e].pinkModeSetting;const T=texts$1[e].settingsPinkModeHelp||texts$1[e].pinkModeSetting;I.setAttribute("data-help",T),settingsPinkMode$1&&(settingsPinkMode$1.setAttribute("data-help",T),settingsPinkMode$1.setAttribute("aria-label",texts$1[e].pinkModeSetting))}const N=document.getElementById("accentColorLabel"),K=texts$1[e].accentColorHelp||texts$1[e].accentColorSetting;if(N&&(N.textContent=texts$1[e].accentColorSetting,N.setAttribute("data-help",K)),accentColorInput$1&&(accentColorInput$1.setAttribute("data-help",K),accentColorInput$1.setAttribute("aria-label",texts$1[e].accentColorSetting)),cameraColorsDescription){const T=texts$1[e].cameraColorSettingDescription||texts$1.en?.cameraColorSettingDescription||cameraColorsDescription.textContent;cameraColorsDescription.textContent=T}const oe=texts$1[e].cameraColorInputHelp||texts$1.en?.cameraColorInputHelp||"";if([["A",cameraColorALabel,cameraColorA],["B",cameraColorBLabel,cameraColorB],["C",cameraColorCLabel,cameraColorC],["D",cameraColorDLabel,cameraColorD],["E",cameraColorELabel,cameraColorE]].forEach(([T,J,qe])=>{if(!J)return;const Rt=`cameraColor${T} Label`,Vt=texts$1[e][Rt]||texts$1.en?.[Rt]||J.textContent;J.textContent=Vt;const Go=oe?oe.replace("%s",T):"";Go?J.setAttribute("data-help",Go):J.removeAttribute("data-help"),qe&&(Go?(qe.setAttribute("data-help",Go),qe.setAttribute("aria-label",Go)):(qe.removeAttribute("data-help"),qe.setAttribute("aria-label",Vt)))}),accentColorResetButton){const T=texts$1[e]&&texts$1[e].accentColorReset||texts$1.en&&texts$1.en.accentColorReset||accentColorResetButton.textContent||"Reset to default",J=texts$1[e]&&texts$1[e].accentColorResetHelp||K;accentColorResetButton.textContent=T,accentColorResetButton.setAttribute("data-help",J),accentColorResetButton.setAttribute("aria-label",J),accentColorResetButton.setAttribute("title",J)}const me=document.getElementById("settingsTemperatureUnitLabel");if(me){me.textContent=texts$1[e].temperatureUnitSetting;const T=texts$1[e].temperatureUnitSettingHelp||texts$1[e].temperatureUnitSetting;me.setAttribute("data-help",T),typeof settingsTemperatureUnit$1<"u"&&settingsTemperatureUnit$1&&(settingsTemperatureUnit$1.setAttribute("data-help",T),settingsTemperatureUnit$1.setAttribute("aria-label",texts$1[e].temperatureUnitSetting),Array.from(settingsTemperatureUnit$1.options||[]).forEach(J=>{if(!J)return;const qe=b(J.value);J.textContent=getTemperatureUnitLabelForLang(e,qe)}),settingsTemperatureUnit$1.value=temperatureUnit)}const De=document.getElementById("settingsFocusScaleLabel");if(De){De.textContent=texts$1[e].focusScaleSetting;const T=texts$1[e].focusScaleSettingHelp||texts$1[e].focusScaleSetting;De.setAttribute("data-help",T),typeof settingsFocusScale$1<"u"&&settingsFocusScale$1&&(settingsFocusScale$1.setAttribute("data-help",T),settingsFocusScale$1.setAttribute("aria-label",texts$1[e].focusScaleSetting),Array.from(settingsFocusScale$1.options||[]).forEach(J=>{if(!J)return;const qe=A(J.value);J.textContent=getFocusScaleLabelForLang(e,qe)}),settingsFocusScale$1.value=w())}const Ge=document.getElementById("settingsFontSizeLabel");if(Ge){Ge.textContent=texts$1[e].fontSizeSetting;const T=texts$1[e].fontSizeSettingHelp||texts$1[e].fontSizeSetting;Ge.setAttribute("data-help",T),settingsFontSize$1&&(settingsFontSize$1.setAttribute("data-help",T),settingsFontSize$1.setAttribute("aria-label",texts$1[e].fontSizeSetting))}const Ue=document.getElementById("settingsFontFamilyLabel");if(Ue){Ue.textContent=texts$1[e].fontFamilySetting;const T=texts$1[e].fontFamilySettingHelp||texts$1[e].fontFamilySetting;Ue.setAttribute("data-help",T),settingsFontFamily$1&&(settingsFontFamily$1.setAttribute("data-help",T),settingsFontFamily$1.setAttribute("aria-label",texts$1[e].fontFamilySetting))}if(localFontsButton){const T=texts$1[e].localFontsButtonHelp||localFontsButton.textContent;localFontsButton.setAttribute("data-help",T),localFontsButton.setAttribute("title",T),localFontsButton.setAttribute("aria-label",T)}if(bundledFontGroup){const T=texts$1[e]&&texts$1[e].bundledFontsGroup||texts$1.en&&texts$1.en.bundledFontsGroup||bundledFontGroup.label;T&&(bundledFontGroup.label=T)}if(localFontsGroup$1){const T=texts$1[e]&&texts$1[e].localFontsGroup||texts$1.en&&texts$1.en.localFontsGroup||localFontsGroup$1.label;T&&(localFontsGroup$1.label=T)}if(localFontsButton){const T=texts$1[e]&&texts$1[e].localFontsButton||texts$1.en&&texts$1.en.localFontsButton||localFontsButton.textContent;T&&(setButtonLabelWithIconBinding$1(localFontsButton,T,ICON_GLYPHS.add),localFontsButton.setAttribute("aria-label",T),localFontsButton.setAttribute("title",T))}if(localFontsStatus&&localFontsStatus.dataset.statusKey){const T=localFontsStatus.dataset.statusKey,J=localFontsStatus.dataset.statusArg;let qe=texts$1[e]&&texts$1[e][T]||texts$1.en&&texts$1.en[T]||"";qe&&J!==void 0&&J!==null?qe=qe.replace("%s",J):!qe&&J!==void 0&&J!==null&&(qe=J),localFontsStatus.textContent=qe}const Xe=document.getElementById("settingsLogoLabel");if(Xe){Xe.textContent=texts$1[e].logoSetting;const T=texts$1[e].logoSettingHelp||texts$1[e].logoSetting;Xe.setAttribute("data-help",T),settingsLogo$1&&(settingsLogo$1.setAttribute("data-help",T),settingsLogo$1.setAttribute("aria-label",texts$1[e].logoSetting))}if(autoGearHeadingElem){autoGearHeadingElem.textContent=texts$1[e].autoGearHeading||texts$1.en?.autoGearHeading||"Automatic Gear Rules";const T=texts$1[e].autoGearHeadingHelp||texts$1.en?.autoGearHeadingHelp;T&&autoGearHeadingElem.setAttribute("data-help",T)}if(autoGearDescriptionElem&&(autoGearDescriptionElem.textContent=texts$1[e].autoGearDescription||texts$1.en?.autoGearDescription||""),autoGearMonitorDefaultsHeading){const T=texts$1[e].autoGearMonitorDefaultsHeading||texts$1.en?.autoGearMonitorDefaultsHeading||autoGearMonitorDefaultsHeading.textContent;autoGearMonitorDefaultsHeading.textContent=T}if(autoGearMonitorDefaultsDescription){const T=texts$1[e].autoGearMonitorDefaultsDescription||texts$1.en?.autoGearMonitorDefaultsDescription||autoGearMonitorDefaultsDescription.textContent;autoGearMonitorDefaultsDescription.textContent=T}if(autoGearMonitorDefaultControls.forEach(T=>{if(!T)return;const J=AUTO_GEAR_MONITOR_DEFAULT_LABEL_KEYS[T.key],qe=J&&(texts$1[e][J]||texts$1.en?.[J])||T.label?.textContent;T.label&&qe&&(T.label.textContent=qe,T.label.setAttribute("data-help",qe)),T.select&&qe&&(T.select.setAttribute("aria-label",qe),T.select.setAttribute("data-help",qe))}),callCoreFunctionIfAvailable$1("updateAutoGearMonitorDefaultOptions",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearMonitorDefaultsControls",[],{defer:!0}),autoGearPresetDescription&&(autoGearPresetDescription.textContent=texts$1[e].autoGearPresetDescription||texts$1.en?.autoGearPresetDescription||""),autoGearPresetLabel){const T=texts$1[e].autoGearPresetLabel||texts$1.en?.autoGearPresetLabel||autoGearPresetLabel.textContent,J=texts$1[e].autoGearPresetDescription||texts$1.en?.autoGearPresetDescription||T;autoGearPresetLabel.textContent=T,autoGearPresetLabel.setAttribute("data-help",J),autoGearPresetSelect$1&&(autoGearPresetSelect$1.setAttribute("aria-label",T),autoGearPresetSelect$1.setAttribute("data-help",J))}if(autoGearSavePresetButton$1){const T=texts$1[e].autoGearSavePresetButton||texts$1.en?.autoGearSavePresetButton||autoGearSavePresetButton$1.textContent;setButtonLabelWithIconBinding$1(autoGearSavePresetButton$1,T,ICON_GLYPHS.save),autoGearSavePresetButton$1.setAttribute("data-help",T),autoGearSavePresetButton$1.setAttribute("aria-label",T)}if(autoGearDeletePresetButton$1){const T=texts$1[e].autoGearDeletePresetButton||texts$1.en?.autoGearDeletePresetButton||autoGearDeletePresetButton$1.textContent;setButtonLabelWithIconBinding$1(autoGearDeletePresetButton$1,T,ICON_GLYPHS.trash),autoGearDeletePresetButton$1.setAttribute("data-help",T),autoGearDeletePresetButton$1.setAttribute("aria-label",T)}if(autoGearAddRuleBtn$1){const T=texts$1[e].autoGearAddRule||texts$1.en?.autoGearAddRule||autoGearAddRuleBtn$1.textContent;setButtonLabelWithIconBinding$1(autoGearAddRuleBtn$1,T,ICON_GLYPHS.add);const J=texts$1[e].autoGearHeadingHelp||texts$1.en?.autoGearHeadingHelp||T;autoGearAddRuleBtn$1.setAttribute("data-help",J)}if(autoGearResetFactoryButton$1){const T=texts$1[e].autoGearResetFactoryButton||texts$1.en?.autoGearResetFactoryButton||autoGearResetFactoryButton$1.textContent,J=texts$1[e].autoGearResetFactoryHelp||texts$1.en?.autoGearResetFactoryHelp||T;setButtonLabelWithIconBinding$1(autoGearResetFactoryButton$1,T,ICON_GLYPHS.reload),autoGearResetFactoryButton$1.setAttribute("data-help",J),autoGearResetFactoryButton$1.setAttribute("title",J),autoGearResetFactoryButton$1.setAttribute("aria-label",T)}if(autoGearExportButton$1){const T=texts$1[e].autoGearExportButton||texts$1.en?.autoGearExportButton||autoGearExportButton$1.textContent,J=texts$1[e].autoGearExportHelp||texts$1.en?.autoGearExportHelp||T;setButtonLabelWithIconBinding$1(autoGearExportButton$1,T,ICON_GLYPHS.fileExport),autoGearExportButton$1.setAttribute("data-help",J),autoGearExportButton$1.setAttribute("title",J),autoGearExportButton$1.setAttribute("aria-label",T)}if(autoGearImportButton$1){const T=texts$1[e].autoGearImportButton||texts$1.en?.autoGearImportButton||autoGearImportButton$1.textContent,J=texts$1[e].autoGearImportHelp||texts$1.en?.autoGearImportHelp||T;setButtonLabelWithIconBinding$1(autoGearImportButton$1,T,ICON_GLYPHS.fileImport),autoGearImportButton$1.setAttribute("data-help",J),autoGearImportButton$1.setAttribute("title",J),autoGearImportButton$1.setAttribute("aria-label",T)}if(autoGearSearchLabel){const T=texts$1[e].autoGearSearchLabel||texts$1.en?.autoGearSearchLabel||autoGearSearchLabel.textContent,J=texts$1[e].autoGearSearchHelp||texts$1.en?.autoGearSearchHelp||T;if(autoGearSearchLabel.textContent=T,autoGearSearchLabel.setAttribute("data-help",J),autoGearSearchInput$1){const qe=texts$1[e].autoGearSearchPlaceholder||texts$1.en?.autoGearSearchPlaceholder||autoGearSearchInput$1.getAttribute("placeholder")||"";autoGearSearchInput$1.setAttribute("placeholder",qe),autoGearSearchInput$1.setAttribute("aria-label",T),autoGearSearchInput$1.setAttribute("data-help",J)}}if(autoGearFilterScenarioLabel){const T=texts$1[e].autoGearFilterScenarioLabel||texts$1.en?.autoGearFilterScenarioLabel||autoGearFilterScenarioLabel.textContent,J=texts$1[e].autoGearFilterScenarioHelp||texts$1.en?.autoGearFilterScenarioHelp||T;autoGearFilterScenarioLabel.textContent=T,autoGearFilterScenarioLabel.setAttribute("data-help",J),autoGearFilterScenarioSelect$1&&(autoGearFilterScenarioSelect$1.setAttribute("aria-label",T),autoGearFilterScenarioSelect$1.setAttribute("data-help",J))}if(autoGearFilterClearButton$1){const T=texts$1[e].autoGearFilterClear||texts$1.en?.autoGearFilterClear||autoGearFilterClearButton$1.textContent;setButtonLabelWithIconBinding$1(autoGearFilterClearButton$1,T,ICON_GLYPHS.circleX),autoGearFilterClearButton$1.setAttribute("data-help",T),autoGearFilterClearButton$1.setAttribute("aria-label",T)}if(refreshAutoGearScenarioFilterOptions$1(getAutoGearRules$1()),autoGearBackupsHeading&&(autoGearBackupsHeading.textContent=texts$1[e].autoGearBackupsHeading||texts$1.en?.autoGearBackupsHeading||autoGearBackupsHeading.textContent),autoGearBackupsDescription){const T=texts$1[e].autoGearBackupsDescription||texts$1.en?.autoGearBackupsDescription||"";autoGearBackupsDescription.textContent=T,T&&autoGearBackupsDescription.setAttribute("data-help",T)}if(autoGearShowBackupsLabel){const T=texts$1[e].autoGearShowBackupsLabel||texts$1.en?.autoGearShowBackupsLabel||autoGearShowBackupsLabel.textContent,J=texts$1[e].autoGearShowBackupsHelp||texts$1.en?.autoGearShowBackupsHelp||T;autoGearShowBackupsLabel.textContent=T,autoGearShowBackupsLabel.setAttribute("data-help",J),autoGearShowBackupsCheckbox$1&&(autoGearShowBackupsCheckbox$1.setAttribute("aria-label",T),autoGearShowBackupsCheckbox$1.setAttribute("data-help",J))}if(autoGearBackupsHiddenNotice$1){const T=texts$1[e].autoGearBackupsHidden||texts$1.en?.autoGearBackupsHidden||autoGearBackupsHiddenNotice$1.textContent;autoGearBackupsHiddenNotice$1.textContent=T}if(autoGearBackupRetentionLabel){const T=texts$1[e].autoGearBackupRetentionLabel||texts$1.en?.autoGearBackupRetentionLabel||autoGearBackupRetentionLabel.textContent,J=texts$1[e].autoGearBackupRetentionHelp||texts$1.en?.autoGearBackupRetentionHelp||T;autoGearBackupRetentionLabel.textContent=T,autoGearBackupRetentionLabel.setAttribute("data-help",J),autoGearBackupRetentionInput$1&&(autoGearBackupRetentionInput$1.setAttribute("aria-label",T),autoGearBackupRetentionInput$1.setAttribute("title",T))}if(autoGearBackupRetentionSummary$1&&callCoreFunctionIfAvailable$1("renderAutoGearBackupRetentionControls",[],{defer:!0}),autoGearBackupSelectLabel){const T=texts$1[e].autoGearBackupSelectLabel||texts$1.en?.autoGearBackupSelectLabel||autoGearBackupSelectLabel.textContent;autoGearBackupSelectLabel.textContent=T,autoGearBackupSelect$1&&(autoGearBackupSelect$1.setAttribute("aria-label",T),autoGearBackupSelect$1.setAttribute("title",T))}if(autoGearBackupRestoreButton$1){const T=texts$1[e].autoGearBackupRestore||texts$1.en?.autoGearBackupRestore||autoGearBackupRestoreButton$1.textContent;setButtonLabelWithIconBinding$1(autoGearBackupRestoreButton$1,T,ICON_GLYPHS.fileImport),autoGearBackupRestoreButton$1.setAttribute("aria-label",T),autoGearBackupRestoreButton$1.setAttribute("title",T)}if(autoGearBackupEmptyMessage$1){const T=texts$1[e].autoGearBackupEmpty||texts$1.en?.autoGearBackupEmpty||autoGearBackupEmptyMessage$1.textContent;autoGearBackupEmptyMessage$1.textContent=T}if(autoGearBackupSelect$1&&callCoreFunctionIfAvailable$1("renderAutoGearBackupControls",[],{defer:!0}),autoGearRuleNameLabel$1){const T=texts$1[e].autoGearRuleNameLabel||texts$1.en?.autoGearRuleNameLabel||autoGearRuleNameLabel$1.textContent;autoGearRuleNameLabel$1.textContent=T;const J=texts$1[e].autoGearRuleNameHelp||texts$1.en?.autoGearRuleNameHelp||T;autoGearRuleNameLabel$1.setAttribute("data-help",J),autoGearRuleNameInput$1&&(autoGearRuleNameInput$1.setAttribute("data-help",J),autoGearRuleNameInput$1.setAttribute("aria-label",T))}if(autoGearConditionSelectLabel){const T=texts$1[e].autoGearConditionSelectLabel||texts$1.en?.autoGearConditionSelectLabel||autoGearConditionSelectLabel.textContent||"Add a condition",J=texts$1[e].autoGearConditionSelectHelp||texts$1.en?.autoGearConditionSelectHelp||T;autoGearConditionSelectLabel.textContent=T,autoGearConditionSelectLabel.setAttribute("data-help",J),autoGearConditionSelect$1&&(autoGearConditionSelect$1.setAttribute("aria-label",T),autoGearConditionSelect$1.setAttribute("data-help",J))}if(autoGearConditionAddButton$1){const T=texts$1[e].autoGearAddCondition||texts$1.en?.autoGearAddCondition||autoGearConditionAddButton$1.textContent||"Add condition";setButtonLabelWithIconBinding$1(autoGearConditionAddButton$1,T,ICON_GLYPHS.add),autoGearConditionAddButton$1.setAttribute("aria-label",T),autoGearConditionAddButton$1.setAttribute("data-help",T)}if(autoGearAlwaysLabel$1){const T=texts$1[e].autoGearAlwaysLabel||texts$1.en?.autoGearAlwaysLabel||autoGearAlwaysLabel$1.textContent||"Always include",J=texts$1[e].autoGearAlwaysHelp||texts$1.en?.autoGearAlwaysHelp||T;autoGearAlwaysLabel$1.textContent=T,autoGearAlwaysLabel$1.setAttribute("data-help",J),autoGearAlwaysHelp&&(autoGearAlwaysHelp.textContent=J,autoGearAlwaysHelp.setAttribute("data-help",J))}if(configureAutoGearConditionButtons(),refreshAutoGearConditionPicker(),updateAutoGearConditionAddButtonState$1(),autoGearScenariosLabel$1){const T=texts$1[e].autoGearScenariosLabel||texts$1.en?.autoGearScenariosLabel||autoGearScenariosLabel$1.textContent;autoGearScenariosLabel$1.textContent=T;const J=texts$1[e].autoGearScenariosHelp||texts$1.en?.autoGearScenariosHelp||T;if(autoGearScenariosLabel$1.setAttribute("data-help",J),autoGearScenariosSelect$2&&(autoGearScenariosSelect$2.setAttribute("data-help",J),autoGearScenariosSelect$2.setAttribute("aria-label",T)),autoGearScenarioModeLabel$1){const qe=texts$1[e].autoGearScenarioModeLabel||texts$1.en?.autoGearScenarioModeLabel||autoGearScenarioModeLabel$1.textContent||"Scenario matching",Rt=texts$1[e].autoGearScenarioModeHelp||texts$1.en?.autoGearScenarioModeHelp||qe;autoGearScenarioModeLabel$1.textContent=qe,autoGearScenarioModeLabel$1.setAttribute("data-help",Rt),autoGearScenarioModeSelectElement&&(autoGearScenarioModeSelectElement.setAttribute("data-help",Rt),autoGearScenarioModeSelectElement.setAttribute("aria-label",qe))}if(autoGearScenarioBaseLabel$1){const qe=texts$1[e].autoGearScenarioBaseLabel||texts$1.en?.autoGearScenarioBaseLabel||autoGearScenarioBaseLabel$1.textContent||"Base scenario",Rt=texts$1[e].autoGearScenarioBaseHelp||texts$1.en?.autoGearScenarioBaseHelp||qe;autoGearScenarioBaseLabel$1.textContent=qe,autoGearScenarioBaseLabel$1.setAttribute("data-help",Rt),autoGearScenarioBaseSelect$2&&(autoGearScenarioBaseSelect$2.setAttribute("data-help",Rt),autoGearScenarioBaseSelect$2.setAttribute("aria-label",qe))}if(autoGearScenarioFactorLabel$1){const qe=texts$1[e].autoGearScenarioFactorLabel||texts$1.en?.autoGearScenarioFactorLabel||autoGearScenarioFactorLabel$1.textContent||"Multiplier factor",Rt=texts$1[e].autoGearScenarioFactorHelp||texts$1.en?.autoGearScenarioFactorHelp||qe;autoGearScenarioFactorLabel$1.textContent=qe,autoGearScenarioFactorLabel$1.setAttribute("data-help",Rt),autoGearScenarioFactorInput$2&&(autoGearScenarioFactorInput$2.setAttribute("data-help",Rt),autoGearScenarioFactorInput$2.setAttribute("aria-label",qe))}}if(autoGearShootingDaysLabel$1){const T=texts$1[e].autoGearShootingDaysLabel||texts$1.en?.autoGearShootingDaysLabel||autoGearShootingDaysLabel$1.textContent||"Shooting days condition",J=texts$1[e].autoGearShootingDaysHelp||texts$1.en?.autoGearShootingDaysHelp||T,qe=texts$1[e].autoGearShootingDaysModeMinimum||texts$1.en?.autoGearShootingDaysModeMinimum||"Minimum",Rt=texts$1[e].autoGearShootingDaysModeMaximum||texts$1.en?.autoGearShootingDaysModeMaximum||"Maximum",Vt=texts$1[e].autoGearShootingDaysModeEvery||texts$1.en?.autoGearShootingDaysModeEvery||"Every",Go=texts$1[e].autoGearShootingDaysValueLabel||texts$1.en?.autoGearShootingDaysValueLabel||"Shooting days value";autoGearShootingDaysLabel$1.textContent=T,autoGearShootingDaysLabel$1.setAttribute("data-help",J),autoGearShootingDaysMode$1&&(autoGearShootingDaysMode$1.setAttribute("data-help",J),autoGearShootingDaysMode$1.setAttribute("aria-label",T),Array.from(autoGearShootingDaysMode$1.options||[]).forEach(zo=>{!zo||typeof zo.value!="string"||(zo.value==="minimum"?zo.textContent=qe:zo.value==="maximum"?zo.textContent=Rt:zo.value==="every"&&(zo.textContent=Vt))})),autoGearShootingDaysValueLabel$1&&(autoGearShootingDaysValueLabel$1.textContent=Go,autoGearShootingDaysValueLabel$1.setAttribute("data-help",J)),autoGearShootingDaysInput$1&&(autoGearShootingDaysInput$1.setAttribute("data-help",J),autoGearShootingDaysInput$1.setAttribute("aria-label",Go)),autoGearShootingDaysHelp$1&&(autoGearShootingDaysHelp$1.textContent=J,autoGearShootingDaysHelp$1.setAttribute("data-help",J))}if(autoGearMatteboxLabel$1){const T=texts$1[e].autoGearMatteboxLabel||texts$1.en?.autoGearMatteboxLabel||autoGearMatteboxLabel$1.textContent;autoGearMatteboxLabel$1.textContent=T;const J=texts$1[e].autoGearMatteboxHelp||texts$1.en?.autoGearMatteboxHelp||T;autoGearMatteboxLabel$1.setAttribute("data-help",J),autoGearMatteboxSelect$2&&(autoGearMatteboxSelect$2.setAttribute("data-help",J),autoGearMatteboxSelect$2.setAttribute("aria-label",T))}if(autoGearCameraHandleLabel$1){const T=texts$1[e].autoGearCameraHandleLabel||texts$1.en?.autoGearCameraHandleLabel||autoGearCameraHandleLabel$1.textContent;autoGearCameraHandleLabel$1.textContent=T;const J=texts$1[e].autoGearCameraHandleHelp||texts$1.en?.autoGearCameraHandleHelp||T;autoGearCameraHandleLabel$1.setAttribute("data-help",J),autoGearCameraHandleSelect$2&&(autoGearCameraHandleSelect$2.setAttribute("data-help",J),autoGearCameraHandleSelect$2.setAttribute("aria-label",T))}if(autoGearViewfinderExtensionLabel$1){const T=texts$1[e].autoGearViewfinderExtensionLabel||texts$1.en?.autoGearViewfinderExtensionLabel||autoGearViewfinderExtensionLabel$1.textContent;autoGearViewfinderExtensionLabel$1.textContent=T;const J=texts$1[e].autoGearViewfinderExtensionHelp||texts$1.en?.autoGearViewfinderExtensionHelp||T;autoGearViewfinderExtensionLabel$1.setAttribute("data-help",J),autoGearViewfinderExtensionSelect$2&&(autoGearViewfinderExtensionSelect$2.setAttribute("data-help",J),autoGearViewfinderExtensionSelect$2.setAttribute("aria-label",T))}if(autoGearDeliveryResolutionLabel$1){const T=texts$1[e].autoGearDeliveryResolutionLabel||texts$1.en?.autoGearDeliveryResolutionLabel||autoGearDeliveryResolutionLabel$1.textContent;autoGearDeliveryResolutionLabel$1.textContent=T;const J=texts$1[e].autoGearDeliveryResolutionHelp||texts$1.en?.autoGearDeliveryResolutionHelp||T;autoGearDeliveryResolutionLabel$1.setAttribute("data-help",J),autoGearDeliveryResolutionSelect$2&&(autoGearDeliveryResolutionSelect$2.setAttribute("data-help",J),autoGearDeliveryResolutionSelect$2.setAttribute("aria-label",T))}if(autoGearVideoDistributionLabel$1){const T=texts$1[e].autoGearVideoDistributionLabel||texts$1.en?.autoGearVideoDistributionLabel||autoGearVideoDistributionLabel$1.textContent;autoGearVideoDistributionLabel$1.textContent=T;const J=texts$1[e].autoGearVideoDistributionHelp||texts$1.en?.autoGearVideoDistributionHelp||T;autoGearVideoDistributionLabel$1.setAttribute("data-help",J),autoGearVideoDistributionSelect$2&&(autoGearVideoDistributionSelect$2.setAttribute("data-help",J),autoGearVideoDistributionSelect$2.setAttribute("aria-label",T))}if(autoGearCameraLabel$1){const T=texts$1[e].autoGearCameraLabel||texts$1.en?.autoGearCameraLabel||autoGearCameraLabel$1.textContent;autoGearCameraLabel$1.textContent=T;const J=texts$1[e].autoGearCameraHelp||texts$1.en?.autoGearCameraHelp||T;autoGearCameraLabel$1.setAttribute("data-help",J),autoGearCameraSelect$2&&(autoGearCameraSelect$2.setAttribute("data-help",J),autoGearCameraSelect$2.setAttribute("aria-label",T))}if(autoGearOwnGearLabel$1){const T=texts$1[e].autoGearConditionOwnGearLabel||texts$1[e].autoGearOwnGearLabel||texts$1.en?.autoGearConditionOwnGearLabel||texts$1.en?.autoGearOwnGearLabel||autoGearOwnGearLabel$1.textContent,J=texts$1[e].autoGearConditionOwnGearHelp||texts$1.en?.autoGearConditionOwnGearHelp||texts$1[e].autoGearOwnGearHelp||texts$1.en?.autoGearOwnGearHelp||T;autoGearOwnGearLabel$1.textContent=T,autoGearOwnGearLabel$1.setAttribute("data-help",J),autoGearOwnGearSelect$2&&(autoGearOwnGearSelect$2.setAttribute("data-help",J),autoGearOwnGearSelect$2.setAttribute("aria-label",T))}if(autoGearCameraWeightLabel$1){const T=texts$1[e].autoGearCameraWeightLabel||texts$1.en?.autoGearCameraWeightLabel||autoGearCameraWeightLabel$1.textContent||"Camera weight",J=texts$1[e].autoGearCameraWeightHelp||texts$1.en?.autoGearCameraWeightHelp||T;autoGearCameraWeightLabel$1.textContent=T,autoGearCameraWeightLabel$1.setAttribute("data-help",J)}if(autoGearCameraWeightOperatorLabel$1){const T=texts$1[e].autoGearCameraWeightOperatorLabel||texts$1.en?.autoGearCameraWeightOperatorLabel||autoGearCameraWeightOperatorLabel$1.textContent||"Weight comparison";if(autoGearCameraWeightOperatorLabel$1.textContent=T,autoGearCameraWeightOperatorLabel$1.setAttribute("data-help",T),autoGearCameraWeightOperator$2){autoGearCameraWeightOperator$2.setAttribute("data-help",T),autoGearCameraWeightOperator$2.setAttribute("aria-label",T);const J=texts$1[e].autoGearCameraWeightOperatorGreater||texts$1.en?.autoGearCameraWeightOperatorGreater||"Heavier than",qe=texts$1[e].autoGearCameraWeightOperatorLess||texts$1.en?.autoGearCameraWeightOperatorLess||"Lighter than",Rt=texts$1[e].autoGearCameraWeightOperatorEqual||texts$1.en?.autoGearCameraWeightOperatorEqual||"Exactly";Array.from(autoGearCameraWeightOperator$2.options||[]).forEach(Vt=>{Vt&&(Vt.value==="greater"?Vt.textContent=J:Vt.value==="less"?Vt.textContent=qe:Vt.value==="equal"&&(Vt.textContent=Rt))})}}if(autoGearCameraWeightValueLabel$1){const T=texts$1[e].autoGearCameraWeightValueLabel||texts$1.en?.autoGearCameraWeightValueLabel||autoGearCameraWeightValueLabel$1.textContent||"Weight threshold (grams)",J=texts$1[e].autoGearCameraWeightHelp||texts$1.en?.autoGearCameraWeightHelp||T;autoGearCameraWeightValueLabel$1.textContent=T,autoGearCameraWeightValueLabel$1.setAttribute("data-help",J),autoGearCameraWeightValueInput$1&&(autoGearCameraWeightValueInput$1.setAttribute("data-help",J),autoGearCameraWeightValueInput$1.setAttribute("aria-label",T))}if(autoGearCameraWeightHelp$1){const T=texts$1[e].autoGearCameraWeightHelp||texts$1.en?.autoGearCameraWeightHelp||autoGearCameraWeightHelp$1.textContent||"";autoGearCameraWeightHelp$1.textContent=T,T&&autoGearCameraWeightHelp$1.setAttribute("data-help",T)}if(autoGearMonitorLabel$1){const T=texts$1[e].autoGearMonitorLabel||texts$1.en?.autoGearMonitorLabel||autoGearMonitorLabel$1.textContent;autoGearMonitorLabel$1.textContent=T;const J=texts$1[e].autoGearMonitorHelp||texts$1.en?.autoGearMonitorHelp||T;autoGearMonitorLabel$1.setAttribute("data-help",J),autoGearMonitorSelect$2&&(autoGearMonitorSelect$2.setAttribute("data-help",J),autoGearMonitorSelect$2.setAttribute("aria-label",T))}if(autoGearTripodHeadBrandLabel$1){const T=texts$1[e].autoGearTripodHeadBrandLabel||texts$1.en?.autoGearTripodHeadBrandLabel||autoGearTripodHeadBrandLabel$1.textContent;autoGearTripodHeadBrandLabel$1.textContent=T;const J=texts$1[e].autoGearTripodHeadBrandHelp||texts$1.en?.autoGearTripodHeadBrandHelp||T;autoGearTripodHeadBrandLabel$1.setAttribute("data-help",J),autoGearTripodHeadBrandSelect$2&&(autoGearTripodHeadBrandSelect$2.setAttribute("data-help",J),autoGearTripodHeadBrandSelect$2.setAttribute("aria-label",T))}if(autoGearTripodBowlLabel$1){const T=texts$1[e].autoGearTripodBowlLabel||texts$1.en?.autoGearTripodBowlLabel||autoGearTripodBowlLabel$1.textContent;autoGearTripodBowlLabel$1.textContent=T;const J=texts$1[e].autoGearTripodBowlHelp||texts$1.en?.autoGearTripodBowlHelp||T;autoGearTripodBowlLabel$1.setAttribute("data-help",J),autoGearTripodBowlSelect$2&&(autoGearTripodBowlSelect$2.setAttribute("data-help",J),autoGearTripodBowlSelect$2.setAttribute("aria-label",T))}if(autoGearTripodTypesLabel$1){const T=texts$1[e].autoGearTripodTypesLabel||texts$1.en?.autoGearTripodTypesLabel||autoGearTripodTypesLabel$1.textContent;autoGearTripodTypesLabel$1.textContent=T;const J=texts$1[e].autoGearTripodTypesHelp||texts$1.en?.autoGearTripodTypesHelp||T;autoGearTripodTypesLabel$1.setAttribute("data-help",J),autoGearTripodTypesSelect$2&&(autoGearTripodTypesSelect$2.setAttribute("data-help",J),autoGearTripodTypesSelect$2.setAttribute("aria-label",T))}if(autoGearTripodSpreaderLabel$1){const T=texts$1[e].autoGearTripodSpreaderLabel||texts$1.en?.autoGearTripodSpreaderLabel||autoGearTripodSpreaderLabel$1.textContent;autoGearTripodSpreaderLabel$1.textContent=T;const J=texts$1[e].autoGearTripodSpreaderHelp||texts$1.en?.autoGearTripodSpreaderHelp||T;autoGearTripodSpreaderLabel$1.setAttribute("data-help",J),autoGearTripodSpreaderSelect$2&&(autoGearTripodSpreaderSelect$2.setAttribute("data-help",J),autoGearTripodSpreaderSelect$2.setAttribute("aria-label",T))}if(autoGearCrewPresentLabel$1){const T=texts$1[e].autoGearCrewPresentLabel||texts$1.en?.autoGearCrewPresentLabel||autoGearCrewPresentLabel$1.textContent;autoGearCrewPresentLabel$1.textContent=T;const J=texts$1[e].autoGearCrewPresentHelp||texts$1.en?.autoGearCrewPresentHelp||T;autoGearCrewPresentLabel$1.setAttribute("data-help",J),autoGearCrewPresentSelect$2&&(autoGearCrewPresentSelect$2.setAttribute("data-help",J),autoGearCrewPresentSelect$2.setAttribute("aria-label",T))}if(autoGearCrewAbsentLabel$1){const T=texts$1[e].autoGearCrewAbsentLabel||texts$1.en?.autoGearCrewAbsentLabel||autoGearCrewAbsentLabel$1.textContent;autoGearCrewAbsentLabel$1.textContent=T;const J=texts$1[e].autoGearCrewAbsentHelp||texts$1.en?.autoGearCrewAbsentHelp||T;autoGearCrewAbsentLabel$1.setAttribute("data-help",J),autoGearCrewAbsentSelect$2&&(autoGearCrewAbsentSelect$2.setAttribute("data-help",J),autoGearCrewAbsentSelect$2.setAttribute("aria-label",T))}if(autoGearWirelessLabel$1){const T=texts$1[e].autoGearWirelessLabel||texts$1.en?.autoGearWirelessLabel||autoGearWirelessLabel$1.textContent;autoGearWirelessLabel$1.textContent=T;const J=texts$1[e].autoGearWirelessHelp||texts$1.en?.autoGearWirelessHelp||T;autoGearWirelessLabel$1.setAttribute("data-help",J),autoGearWirelessSelect$2&&(autoGearWirelessSelect$2.setAttribute("data-help",J),autoGearWirelessSelect$2.setAttribute("aria-label",T))}if(autoGearMotorsLabel$1){const T=texts$1[e].autoGearMotorsLabel||texts$1.en?.autoGearMotorsLabel||autoGearMotorsLabel$1.textContent;autoGearMotorsLabel$1.textContent=T;const J=texts$1[e].autoGearMotorsHelp||texts$1.en?.autoGearMotorsHelp||T;autoGearMotorsLabel$1.setAttribute("data-help",J),autoGearMotorsSelect$2&&(autoGearMotorsSelect$2.setAttribute("data-help",J),autoGearMotorsSelect$2.setAttribute("aria-label",T))}if(autoGearControllersLabel$1){const T=texts$1[e].autoGearControllersLabel||texts$1.en?.autoGearControllersLabel||autoGearControllersLabel$1.textContent;autoGearControllersLabel$1.textContent=T;const J=texts$1[e].autoGearControllersHelp||texts$1.en?.autoGearControllersHelp||T;autoGearControllersLabel$1.setAttribute("data-help",J),autoGearControllersSelect$2&&(autoGearControllersSelect$2.setAttribute("data-help",J),autoGearControllersSelect$2.setAttribute("aria-label",T))}if(autoGearDistanceLabel$1){const T=texts$1[e].autoGearDistanceLabel||texts$1.en?.autoGearDistanceLabel||autoGearDistanceLabel$1.textContent;autoGearDistanceLabel$1.textContent=T;const J=texts$1[e].autoGearDistanceHelp||texts$1.en?.autoGearDistanceHelp||T;autoGearDistanceLabel$1.setAttribute("data-help",J),autoGearDistanceSelect$2&&(autoGearDistanceSelect$2.setAttribute("data-help",J),autoGearDistanceSelect$2.setAttribute("aria-label",T))}const ft=texts$1[e].autoGearConditionLogicLabel||texts$1.en?.autoGearConditionLogicLabel||"Match behavior",Le=texts$1[e].autoGearConditionLogicHelp||texts$1.en?.autoGearConditionLogicHelp||ft,ot={all:texts$1[e]?.autoGearConditionLogicAll||texts$1.en?.autoGearConditionLogicAll||"Require every selected value",any:texts$1[e]?.autoGearConditionLogicAny||texts$1.en?.autoGearConditionLogicAny||"Match any selected value",none:texts$1[e]?.autoGearConditionLogicNone||texts$1.en?.autoGearConditionLogicNone||"Require none of the selected values",multiplier:texts$1[e]?.autoGearConditionLogicMultiplier||texts$1.en?.autoGearConditionLogicMultiplier||"Multiply by matched values"};if(Object.entries(autoGearConditionLogicSelects$1).forEach(([T,J])=>{const qe=autoGearConditionLogicLabels$1[T];qe&&(qe.textContent=ft,qe.setAttribute("data-help",Le)),J&&(J.setAttribute("aria-label",ft),J.setAttribute("data-help",Le),J.setAttribute("title",Le),Array.from(J.options||[]).forEach(Rt=>{if(!Rt)return;const Vt=ot[Rt.value];Vt&&(Rt.textContent=Vt)}))}),autoGearAddItemsHeading&&(autoGearAddItemsHeading.textContent=texts$1[e].autoGearAddItemsHeading||texts$1.en?.autoGearAddItemsHeading||autoGearAddItemsHeading.textContent),autoGearAddOwnGearLabel){const T=texts$1[e].autoGearOwnGearLabel||texts$1.en?.autoGearOwnGearLabel||autoGearAddOwnGearLabel.textContent,J=texts$1[e].autoGearOwnGearHelp||texts$1.en?.autoGearOwnGearHelp||T,qe=texts$1[e].autoGearOwnGearPlaceholder||texts$1.en?.autoGearOwnGearPlaceholder||"";autoGearAddOwnGearLabel.textContent=T,autoGearAddOwnGearLabel.setAttribute("data-help",J),autoGearAddOwnGearSelect$1&&(autoGearAddOwnGearSelect$1.setAttribute("aria-label",T),autoGearAddOwnGearSelect$1.setAttribute("data-help",J),qe?autoGearAddOwnGearSelect$1.setAttribute("data-placeholder",qe):autoGearAddOwnGearSelect$1.removeAttribute("data-placeholder"))}if(autoGearAddItemLabel){const T=texts$1[e].autoGearAddItemLabel||texts$1.en?.autoGearAddItemLabel||autoGearAddItemLabel.textContent,J=texts$1[e].autoGearAddMultipleHint||texts$1.en?.autoGearAddMultipleHint||"",qe=J?`${T} – ${J} `:T;autoGearAddItemLabel.textContent=T,autoGearAddItemLabel.setAttribute("data-help",qe),autoGearAddNameInput$1&&(autoGearAddNameInput$1.setAttribute("aria-label",T),autoGearAddNameInput$1.setAttribute("data-help",qe),J?autoGearAddNameInput$1.setAttribute("placeholder",J):autoGearAddNameInput$1.removeAttribute("placeholder"))}if(autoGearAddCategoryLabel){const T=texts$1[e].autoGearAddCategoryLabel||texts$1.en?.autoGearAddCategoryLabel||autoGearAddCategoryLabel.textContent;autoGearAddCategoryLabel.textContent=T,autoGearAddCategorySelect$1&&autoGearAddCategorySelect$1.setAttribute("aria-label",T)}if(autoGearAddQuantityLabel){const T=texts$1[e].autoGearAddQuantityLabel||texts$1.en?.autoGearAddQuantityLabel||autoGearAddQuantityLabel.textContent;autoGearAddQuantityLabel.textContent=T,autoGearAddQuantityInput$1&&autoGearAddQuantityInput$1.setAttribute("aria-label",T)}if(autoGearAddScreenSizeLabel){const T=texts$1[e].autoGearAddScreenSizeLabel||texts$1.en?.autoGearAddScreenSizeLabel||autoGearAddScreenSizeLabel.textContent;autoGearAddScreenSizeLabel.textContent=T,autoGearAddScreenSizeInput$1&&autoGearAddScreenSizeInput$1.setAttribute("aria-label",T)}if(autoGearAddSelectorTypeLabel){const T=texts$1[e].autoGearAddSelectorTypeLabel||texts$1.en?.autoGearAddSelectorTypeLabel||autoGearAddSelectorTypeLabel.textContent;if(autoGearAddSelectorTypeLabel.textContent=T,autoGearAddSelectorTypeSelect$1){autoGearAddSelectorTypeSelect$1.setAttribute("aria-label",T);const J=texts$1[e].autoGearSelectorNoneOption||texts$1.en?.autoGearSelectorNoneOption||"No selector",qe=texts$1[e].autoGearSelectorMonitorOption||texts$1.en?.autoGearSelectorMonitorOption||"Monitor selector",Rt=texts$1[e].autoGearSelectorDirectorOption||texts$1.en?.autoGearSelectorDirectorOption||"Director monitor selector",Vt=texts$1[e].autoGearSelectorTripodHeadOption||texts$1.en?.autoGearSelectorTripodHeadOption||"Tripod head selector",Go=texts$1[e].autoGearSelectorTripodBowlOption||texts$1.en?.autoGearSelectorTripodBowlOption||"Tripod bowl selector",zo=texts$1[e].autoGearSelectorTripodTypesOption||texts$1.en?.autoGearSelectorTripodTypesOption||"Tripod type selector",gr=texts$1[e].autoGearSelectorTripodSpreaderOption||texts$1.en?.autoGearSelectorTripodSpreaderOption||"Tripod spreader selector",It=new Map([["none",J],["monitor",qe],["directorMonitor",Rt],["tripodHeadBrand",Vt],["tripodBowl",Go],["tripodTypes",zo],["tripodSpreader",gr]]);Array.from(autoGearAddSelectorTypeSelect$1.options||[]).forEach(Vr=>{const Nr=It.get(Vr.value);Nr&&(Vr.textContent=Nr)})}}if(autoGearAddSelectorDefaultLabel){const T=texts$1[e].autoGearAddSelectorDefaultLabel||texts$1.en?.autoGearAddSelectorDefaultLabel||autoGearAddSelectorDefaultLabel.textContent;autoGearAddSelectorDefaultLabel.textContent=T,autoGearAddSelectorDefaultInput$1&&autoGearAddSelectorDefaultInput$1.setAttribute("aria-label",T)}if(autoGearAddNotesLabel){const T=texts$1[e].autoGearAddNotesLabel||texts$1.en?.autoGearAddNotesLabel||autoGearAddNotesLabel.textContent;autoGearAddNotesLabel.textContent=T,autoGearAddNotesInput$1&&autoGearAddNotesInput$1.setAttribute("aria-label",T)}if(autoGearAddItemButton$1&&typeof updateAutoGearItemButtonState=="function"&&updateAutoGearItemButtonState("add"),autoGearRemoveItemsHeading&&(autoGearRemoveItemsHeading.textContent=texts$1[e].autoGearRemoveItemsHeading||texts$1.en?.autoGearRemoveItemsHeading||autoGearRemoveItemsHeading.textContent),autoGearRemoveOwnGearLabel){const T=texts$1[e].autoGearOwnGearLabel||texts$1.en?.autoGearOwnGearLabel||autoGearRemoveOwnGearLabel.textContent,J=texts$1[e].autoGearOwnGearHelp||texts$1.en?.autoGearOwnGearHelp||T,qe=texts$1[e].autoGearOwnGearPlaceholder||texts$1.en?.autoGearOwnGearPlaceholder||"";autoGearRemoveOwnGearLabel.textContent=T,autoGearRemoveOwnGearLabel.setAttribute("data-help",J),autoGearRemoveOwnGearSelect$1&&(autoGearRemoveOwnGearSelect$1.setAttribute("aria-label",T),autoGearRemoveOwnGearSelect$1.setAttribute("data-help",J),qe?autoGearRemoveOwnGearSelect$1.setAttribute("data-placeholder",qe):autoGearRemoveOwnGearSelect$1.removeAttribute("data-placeholder"))}if(autoGearRemoveItemLabel){const T=texts$1[e].autoGearRemoveItemLabel||texts$1.en?.autoGearRemoveItemLabel||autoGearRemoveItemLabel.textContent,J=texts$1[e].autoGearRemoveMultipleHint||texts$1.en?.autoGearRemoveMultipleHint||"",qe=J?`${T} – ${J} `:T;autoGearRemoveItemLabel.textContent=T,autoGearRemoveItemLabel.setAttribute("data-help",qe),autoGearRemoveNameInput$1&&(autoGearRemoveNameInput$1.setAttribute("aria-label",T),autoGearRemoveNameInput$1.setAttribute("data-help",qe),J?autoGearRemoveNameInput$1.setAttribute("placeholder",J):autoGearRemoveNameInput$1.removeAttribute("placeholder"))}if(autoGearRemoveCategoryLabel){const T=texts$1[e].autoGearRemoveCategoryLabel||texts$1.en?.autoGearRemoveCategoryLabel||autoGearRemoveCategoryLabel.textContent;autoGearRemoveCategoryLabel.textContent=T,autoGearRemoveCategorySelect$1&&autoGearRemoveCategorySelect$1.setAttribute("aria-label",T)}if(autoGearRemoveQuantityLabel){const T=texts$1[e].autoGearRemoveQuantityLabel||texts$1.en?.autoGearRemoveQuantityLabel||autoGearRemoveQuantityLabel.textContent;autoGearRemoveQuantityLabel.textContent=T,autoGearRemoveQuantityInput$1&&autoGearRemoveQuantityInput$1.setAttribute("aria-label",T)}if(autoGearRemoveScreenSizeLabel){const T=texts$1[e].autoGearRemoveScreenSizeLabel||texts$1.en?.autoGearRemoveScreenSizeLabel||autoGearRemoveScreenSizeLabel.textContent;autoGearRemoveScreenSizeLabel.textContent=T,autoGearRemoveScreenSizeInput$1&&autoGearRemoveScreenSizeInput$1.setAttribute("aria-label",T)}if(autoGearRemoveSelectorTypeLabel){const T=texts$1[e].autoGearRemoveSelectorTypeLabel||texts$1.en?.autoGearRemoveSelectorTypeLabel||autoGearRemoveSelectorTypeLabel.textContent;if(autoGearRemoveSelectorTypeLabel.textContent=T,autoGearRemoveSelectorTypeSelect$1){autoGearRemoveSelectorTypeSelect$1.setAttribute("aria-label",T);const J=texts$1[e].autoGearSelectorNoneOption||texts$1.en?.autoGearSelectorNoneOption||"No selector",qe=texts$1[e].autoGearSelectorMonitorOption||texts$1.en?.autoGearSelectorMonitorOption||"Monitor selector",Rt=texts$1[e].autoGearSelectorDirectorOption||texts$1.en?.autoGearSelectorDirectorOption||"Director monitor selector",Vt=texts$1[e].autoGearSelectorTripodHeadOption||texts$1.en?.autoGearSelectorTripodHeadOption||"Tripod head selector",Go=texts$1[e].autoGearSelectorTripodBowlOption||texts$1.en?.autoGearSelectorTripodBowlOption||"Tripod bowl selector",zo=texts$1[e].autoGearSelectorTripodTypesOption||texts$1.en?.autoGearSelectorTripodTypesOption||"Tripod type selector",gr=texts$1[e].autoGearSelectorTripodSpreaderOption||texts$1.en?.autoGearSelectorTripodSpreaderOption||"Tripod spreader selector",It=new Map([["none",J],["monitor",qe],["directorMonitor",Rt],["tripodHeadBrand",Vt],["tripodBowl",Go],["tripodTypes",zo],["tripodSpreader",gr]]);Array.from(autoGearRemoveSelectorTypeSelect$1.options||[]).forEach(Vr=>{const Nr=It.get(Vr.value);Nr&&(Vr.textContent=Nr)})}}if(autoGearRemoveSelectorDefaultLabel){const T=texts$1[e].autoGearRemoveSelectorDefaultLabel||texts$1.en?.autoGearRemoveSelectorDefaultLabel||autoGearRemoveSelectorDefaultLabel.textContent;autoGearRemoveSelectorDefaultLabel.textContent=T,autoGearRemoveSelectorDefaultInput$1&&autoGearRemoveSelectorDefaultInput$1.setAttribute("aria-label",T)}if(autoGearRemoveNotesLabel){const T=texts$1[e].autoGearRemoveNotesLabel||texts$1.en?.autoGearRemoveNotesLabel||autoGearRemoveNotesLabel.textContent;autoGearRemoveNotesLabel.textContent=T,autoGearRemoveNotesInput$1&&autoGearRemoveNotesInput$1.setAttribute("aria-label",T)}if(updateAutoGearOwnGearOptions(),autoGearDraftImpactHeading){const T=texts$1[e].autoGearDraftImpactHeading||texts$1.en?.autoGearDraftImpactHeading||autoGearDraftImpactHeading.textContent;autoGearDraftImpactHeading.textContent=T}if(autoGearDraftImpactDescription){const T=texts$1[e].autoGearDraftImpactDescription||texts$1.en?.autoGearDraftImpactDescription||autoGearDraftImpactDescription.textContent;autoGearDraftImpactDescription.textContent=T,autoGearDraftImpactHeading&&autoGearDraftImpactHeading.setAttribute("data-help",T),autoGearDraftImpactContainer&&autoGearDraftImpactContainer.setAttribute("data-help",T)}if(autoGearDraftWarningHeading){const T=texts$1[e].autoGearDraftWarningHeading||texts$1.en?.autoGearDraftWarningHeading||autoGearDraftWarningHeading.textContent;autoGearDraftWarningHeading.textContent=T}if(autoGearRemoveItemButton$1&&typeof updateAutoGearItemButtonState=="function"&&updateAutoGearItemButtonState("remove"),autoGearSaveRuleButton$1){const T=texts$1[e].autoGearSaveRule||texts$1.en?.autoGearSaveRule||autoGearSaveRuleButton$1.textContent;setButtonLabelWithIconBinding$1(autoGearSaveRuleButton$1,T),autoGearSaveRuleButton$1.setAttribute("data-help",T)}if(autoGearCancelEditButton$1){const T=texts$1[e].autoGearCancelEdit||texts$1.en?.autoGearCancelEdit||autoGearCancelEditButton$1.textContent;setButtonLabelWithIconBinding$1(autoGearCancelEditButton$1,T,ICON_GLYPHS.circleX),autoGearCancelEditButton$1.setAttribute("data-help",T)}autoGearAddCategorySelect$1&&populateAutoGearCategorySelect(autoGearAddCategorySelect$1,autoGearAddCategorySelect$1.value),autoGearRemoveCategorySelect$1&&populateAutoGearCategorySelect(autoGearRemoveCategorySelect$1,autoGearRemoveCategorySelect$1.value),syncAutoGearMonitorFieldVisibility$1(),autoGearScenariosSelect$2&&refreshAutoGearScenarioOptions(autoGearEditorDraft$1?.scenarios),autoGearMatteboxSelect$2&&refreshAutoGearMatteboxOptions(autoGearEditorDraft$1?.mattebox),autoGearCameraHandleSelect$2&&refreshAutoGearCameraHandleOptions(autoGearEditorDraft$1?.cameraHandle),autoGearViewfinderExtensionSelect$2&&refreshAutoGearViewfinderExtensionOptions(autoGearEditorDraft$1?.viewfinderExtension),autoGearDeliveryResolutionSelect$2&&refreshAutoGearDeliveryResolutionOptions(autoGearEditorDraft$1?.deliveryResolution),autoGearVideoDistributionSelect$2&&refreshAutoGearVideoDistributionOptions(autoGearEditorDraft$1?.videoDistribution),callCoreFunctionIfAvailable$1("seedAutoGearRulesFromCurrentProject",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearRulesList",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearDraftLists",[],{defer:!0}),callCoreFunctionIfAvailable$1("updateAutoGearCatalogOptions",[],{defer:!0}),callCoreFunctionIfAvailable$1("renderAutoGearPresetsControls",[],{defer:!0}),callCoreFunctionIfAvailable$1("applyAutoGearBackupVisibility",[],{defer:!0});const _t=document.getElementById("settingsHighContrastLabel");if(_t){_t.textContent=texts$1[e].highContrastSetting;const T=texts$1[e].highContrastSettingHelp||texts$1[e].highContrastSetting;_t.setAttribute("data-help",T),settingsHighContrast&&(settingsHighContrast.setAttribute("data-help",T),settingsHighContrast.setAttribute("aria-label",texts$1[e].highContrastSetting))}const Lt=document.getElementById("accessibilityHeading");Lt&&(Lt.textContent=texts$1[e].accessibilityHeading,Lt.setAttribute("data-help",texts$1[e].accessibilityHeadingHelp||texts$1[e].accessibilityHeading));const Qt=document.getElementById("backupHeading");Qt&&(Qt.textContent=texts$1[e].backupHeading,Qt.setAttribute("data-help",texts$1[e].backupHeadingHelp||texts$1[e].backupHeading));const Gt=typeof document<"u"?document.getElementById("projectBackupsHeading"):null;if(Gt){const T=texts$1[e].projectBackupsHeading||"Project Backups";Gt.textContent=T;const J=texts$1[e].projectBackupsDescription||"";J?Gt.setAttribute("data-help",J):Gt.removeAttribute("data-help")}const ho=typeof document<"u"?document.getElementById("projectBackupsDescription"):null;if(ho){const T=texts$1[e].projectBackupsDescription||"";T?(ho.textContent=T,ho.hidden=!1):(ho.textContent="",ho.hidden=!0)}if(dataHeading){dataHeading.textContent=texts$1[e].dataHeading;const T=texts$1[e].dataHeadingHelp||texts$1[e].dataHeading;dataHeading.setAttribute("data-help",T)}if(storageSummaryIntro&&(storageSummaryIntro.textContent=texts$1[e].storageSummaryIntro),storageSummaryFootnote&&(storageSummaryFootnote.textContent=texts$1[e].storageSummaryFootnote),storageSummaryEmpty&&(storageSummaryEmpty.textContent=texts$1[e].storageSummaryEmpty),storagePersistenceHeading){const T=texts$1[e].storagePersistenceHeading||texts$1.en?.storagePersistenceHeading||storagePersistenceHeading.textContent;storagePersistenceHeading.textContent=T;const J=texts$1[e].storagePersistenceHeadingHelp||texts$1.en?.storagePersistenceHeadingHelp||T;storagePersistenceHeading.setAttribute("data-help",J)}if(storagePersistenceIntro&&(storagePersistenceIntro.textContent=texts$1[e].storagePersistenceIntro||texts$1.en?.storagePersistenceIntro||storagePersistenceIntro.textContent),storagePersistenceRequestButton){const T=texts$1[e].storagePersistenceRequest||texts$1.en?.storagePersistenceRequest||storagePersistenceRequestButton.textContent;setButtonLabelWithIconBinding$1(storagePersistenceRequestButton,T,ICON_GLYPHS.save),storagePersistenceRequestButton.dataset.defaultLabel=T;const J=texts$1[e].storagePersistenceRequestHelp||texts$1.en?.storagePersistenceRequestHelp||T;storagePersistenceRequestButton.setAttribute("data-help",J),storagePersistenceRequestButton.setAttribute("title",J),storagePersistenceRequestButton.setAttribute("aria-label",J)}if(storagePersistenceStatus){const T=texts$1[e].storagePersistenceStatusIdle||texts$1.en?.storagePersistenceStatusIdle||storagePersistenceStatus.textContent;storagePersistenceStatus.textContent=T,storagePersistenceStatus.setAttribute("data-help",T)}if(callCoreFunctionIfAvailable$1("renderStoragePersistenceStatus",[],{defer:!0}),storageActionsHeading){const T=texts$1[e].storageActionsHeading||texts$1.en?.storageActionsHeading||storageActionsHeading.textContent;storageActionsHeading.textContent=T;const J=texts$1[e].storageActionsHeadingHelp||texts$1.en?.storageActionsHeadingHelp||T;storageActionsHeading.setAttribute("data-help",J)}if(storageActionsIntro&&(storageActionsIntro.textContent=texts$1[e].storageActionsIntro||texts$1.en?.storageActionsIntro||storageActionsIntro.textContent),storageBackupNowButton){const T=texts$1[e].storageBackupNow||texts$1.en?.storageBackupNow||storageBackupNowButton.textContent;setButtonLabelWithIconBinding$1(storageBackupNowButton,T,ICON_GLYPHS.fileExport);const J=texts$1[e].storageBackupNowHelp||texts$1.en?.storageBackupNowHelp||T;storageBackupNowButton.setAttribute("data-help",J),storageBackupNowButton.setAttribute("title",J)}if(storageOpenBackupTabButton){const T=texts$1[e].storageOpenBackupTab||texts$1.en?.storageOpenBackupTab||storageOpenBackupTabButton.textContent;setButtonLabelWithIconBinding$1(storageOpenBackupTabButton,T,ICON_GLYPHS.settingsBackup);const J=texts$1[e].storageOpenBackupTabHelp||texts$1.en?.storageOpenBackupTabHelp||T;storageOpenBackupTabButton.setAttribute("data-help",J),storageOpenBackupTabButton.setAttribute("title",J)}if(storageStatusHeading){const T=texts$1[e].storageStatusHeading||texts$1.en?.storageStatusHeading||storageStatusHeading.textContent;storageStatusHeading.textContent=T;const J=texts$1[e].storageStatusHeadingHelp||texts$1.en?.storageStatusHeadingHelp||T;storageStatusHeading.setAttribute("data-help",J)}storageStatusLastProjectLabel&&(storageStatusLastProjectLabel.textContent=texts$1[e].storageStatusLastProjectLabel||texts$1.en?.storageStatusLastProjectLabel||storageStatusLastProjectLabel.textContent),storageStatusLastAutoBackupLabel&&(storageStatusLastAutoBackupLabel.textContent=texts$1[e].storageStatusLastAutoBackupLabel||texts$1.en?.storageStatusLastAutoBackupLabel||storageStatusLastAutoBackupLabel.textContent),storageStatusLastFullBackupLabel&&(storageStatusLastFullBackupLabel.textContent=texts$1[e].storageStatusLastFullBackupLabel||texts$1.en?.storageStatusLastFullBackupLabel||storageStatusLastFullBackupLabel.textContent);const Qo=texts$1[e].storageStatusNever||texts$1.en?.storageStatusNever||(storageStatusLastProjectValue$1?storageStatusLastProjectValue$1.textContent:"");if(storageStatusLastProjectValue$1&&(storageStatusLastProjectValue$1.textContent=Qo),storageStatusLastAutoBackupValue$1&&(storageStatusLastAutoBackupValue$1.textContent=Qo),storageStatusLastFullBackupValue$1&&(storageStatusLastFullBackupValue$1.textContent=Qo),storageStatusReminder$1&&(storageStatusReminder$1.textContent="",storageStatusReminder$1.setAttribute("hidden",""),storageStatusReminder$1.classList.remove("storage-status-reminder--warning","storage-status-reminder--ok"),storageStatusReminder$1.removeAttribute("data-help")),loggingSection){const T=texts$1[e].loggingSectionHelp||texts$1[e].loggingHeadingHelp||texts$1.en?.loggingHeadingHelp||"";T?loggingSection.setAttribute("data-help",T):loggingSection.removeAttribute("data-help")}if(loggingHeading){const T=texts$1[e].loggingHeading||texts$1.en?.loggingHeading||loggingHeading.textContent||"Diagnostics log";loggingHeading.textContent=T;const J=texts$1[e].loggingHeadingHelp||texts$1.en?.loggingHeadingHelp||T;loggingHeading.setAttribute("data-help",J)}if(loggingIntro&&(loggingIntro.textContent=texts$1[e].loggingIntro||texts$1.en?.loggingIntro||loggingIntro.textContent),loggingLevelFilterLabel){const T=texts$1[e].loggingLevelFilterLabel||texts$1.en?.loggingLevelFilterLabel||loggingLevelFilterLabel.textContent;loggingLevelFilterLabel.textContent=T,loggingLevelFilterLabel.setAttribute("data-help",T)}if(loggingLevelFilter){const T={all:texts$1[e].loggingLevelFilterAll||texts$1.en?.loggingLevelFilterAll||"All levels",info:texts$1[e].loggingLevelFilterInfo||texts$1.en?.loggingLevelFilterInfo||"Info and above",warn:texts$1[e].loggingLevelFilterWarn||texts$1.en?.loggingLevelFilterWarn||"Warnings and errors",error:texts$1[e].loggingLevelFilterError||texts$1.en?.loggingLevelFilterError||"Errors only"};Array.from(loggingLevelFilter.options||[]).forEach(qe=>{if(!qe||typeof qe.value!="string")return;const Rt=qe.value;Object.prototype.hasOwnProperty.call(T,Rt)&&(qe.textContent=T[Rt])});const J=texts$1[e].loggingLevelFilterHelp||texts$1.en?.loggingLevelFilterHelp||"";J?loggingLevelFilter.setAttribute("data-help",J):loggingLevelFilter.removeAttribute("data-help")}if(loggingNamespaceFilterLabel){const T=texts$1[e].loggingNamespaceFilterLabel||texts$1.en?.loggingNamespaceFilterLabel||loggingNamespaceFilterLabel.textContent;loggingNamespaceFilterLabel.textContent=T}if(loggingNamespaceFilter){const T=texts$1[e].loggingNamespaceFilterPlaceholder||texts$1.en?.loggingNamespaceFilterPlaceholder||"";T&&loggingNamespaceFilter.setAttribute("placeholder",T);const J=texts$1[e].loggingNamespaceFilterHelp||texts$1.en?.loggingNamespaceFilterHelp||T;J&&(loggingNamespaceFilter.setAttribute("data-help",J),loggingNamespaceFilterLabel&&loggingNamespaceFilterLabel.setAttribute("data-help",J)),loggingNamespaceFilterHelp&&(loggingNamespaceFilterHelp.textContent=J,J?loggingNamespaceFilterHelp.removeAttribute("hidden"):loggingNamespaceFilterHelp.setAttribute("hidden",""))}if(loggingHistoryLimitLabel){const T=texts$1[e].loggingHistoryLimitLabel||texts$1.en?.loggingHistoryLimitLabel||loggingHistoryLimitLabel.textContent;loggingHistoryLimitLabel.textContent=T}if(loggingHistoryLimitHelp){const T=texts$1[e].loggingHistoryLimitHelp||texts$1.en?.loggingHistoryLimitHelp||loggingHistoryLimitHelp.textContent;loggingHistoryLimitHelp.textContent=T}if(loggingHistoryLimit){const T=texts$1[e].loggingHistoryLimitHelp||texts$1.en?.loggingHistoryLimitHelp||"";T?loggingHistoryLimit.setAttribute("data-help",T):loggingHistoryLimit.removeAttribute("data-help");const J=texts$1[e].loggingHistoryLimitAria||texts$1.en?.loggingHistoryLimitAria||"";J&&loggingHistoryLimit.setAttribute("aria-label",J)}if(loggingConsoleOutputLabel){const T=texts$1[e].loggingConsoleOutputLabel||texts$1.en?.loggingConsoleOutputLabel||loggingConsoleOutputLabel.textContent;loggingConsoleOutputLabel.textContent=T}if(loggingConsoleOutputHelp){const T=texts$1[e].loggingConsoleOutputHelp||texts$1.en?.loggingConsoleOutputHelp||loggingConsoleOutputHelp.textContent;loggingConsoleOutputHelp.textContent=T}if(loggingCaptureConsoleLabel){const T=texts$1[e].loggingCaptureConsoleLabel||texts$1.en?.loggingCaptureConsoleLabel||loggingCaptureConsoleLabel.textContent;loggingCaptureConsoleLabel.textContent=T}if(loggingCaptureConsoleHelp){const T=texts$1[e].loggingCaptureConsoleHelp||texts$1.en?.loggingCaptureConsoleHelp||loggingCaptureConsoleHelp.textContent;loggingCaptureConsoleHelp.textContent=T}if(loggingCaptureErrorsLabel){const T=texts$1[e].loggingCaptureErrorsLabel||texts$1.en?.loggingCaptureErrorsLabel||loggingCaptureErrorsLabel.textContent;loggingCaptureErrorsLabel.textContent=T}if(loggingCaptureErrorsHelp){const T=texts$1[e].loggingCaptureErrorsHelp||texts$1.en?.loggingCaptureErrorsHelp||loggingCaptureErrorsHelp.textContent;loggingCaptureErrorsHelp.textContent=T}if(loggingPersistSessionLabel){const T=texts$1[e].loggingPersistSessionLabel||texts$1.en?.loggingPersistSessionLabel||loggingPersistSessionLabel.textContent;loggingPersistSessionLabel.textContent=T}if(loggingPersistSessionHelp){const T=texts$1[e].loggingPersistSessionHelp||texts$1.en?.loggingPersistSessionHelp||loggingPersistSessionHelp.textContent;loggingPersistSessionHelp.textContent=T}if(loggingExportButton){const T=texts$1[e].loggingExportButton||texts$1.en?.loggingExportButton||loggingExportButton.textContent;setButtonLabelWithIconBinding$1(loggingExportButton,T,ICON_GLYPHS.fileExport),loggingExportButton.setAttribute("data-help",T),loggingExportButton.setAttribute("title",T),loggingExportButton.setAttribute("aria-label",T)}if(loggingExportHelp){const T=texts$1[e].loggingExportHelp||texts$1.en?.loggingExportHelp||loggingExportHelp.textContent;loggingExportHelp.textContent=T,loggingExportHelp.setAttribute("data-help",T)}if(loggingStatus){const T=texts$1[e].loggingStatusIdle||texts$1.en?.loggingStatusIdle||"";loggingStatus.textContent=T,T&&loggingStatus.setAttribute("data-help",T)}if(loggingEmpty){const T=texts$1[e].loggingEmptyState||texts$1.en?.loggingEmptyState||loggingEmpty.textContent;loggingEmpty.textContent=T,T&&loggingEmpty.setAttribute("data-help",T)}loggingUnavailable&&(loggingUnavailable.textContent=texts$1[e].loggingUnavailable||texts$1.en?.loggingUnavailable||loggingUnavailable.textContent);const Xo=document.getElementById("settingsShowAutoBackupsLabel");if(Xo){Xo.textContent=texts$1[e].showAutoBackupsSetting;const T=texts$1[e].showAutoBackupsHelp||texts$1[e].showAutoBackupsSetting;Xo.setAttribute("data-help",T),F&&(F.setAttribute("data-help",T),F.setAttribute("aria-label",texts$1[e].showAutoBackupsSetting))}if(x){const T=texts$1[e].versionCompareButton||"Compare versions";setButtonLabelWithIconBinding$1(x,T,ICON_GLYPHS.note);const J=texts$1[e].versionCompareButtonHelp||T;x.setAttribute("data-help",J),x.setAttribute("title",J)}if(H&&(H.textContent=texts$1[e].versionCompareHeading||"Version comparison"),W&&(W.textContent=texts$1[e].versionCompareIntro||""),U){const T=texts$1[e].versionComparePrimaryLabel||"Baseline version";U.textContent=T,j&&j.setAttribute("aria-label",T)}if(Y){const T=texts$1[e].versionCompareSecondaryLabel||"Comparison version";Y.textContent=T,le&&le.setAttribute("aria-label",T)}if(be&&(be.textContent=texts$1[e].versionCompareEmpty||"Save a project or wait for auto-backups to start comparing versions."),re&&(re.textContent=texts$1[e].versionCompareNotesLabel||"Incident notes"),de){const T=texts$1[e].versionCompareNotesPlaceholder||"Record context, on-set observations, or required follow-up.";de.placeholder=T}if(ne){const T=texts$1[e].versionCompareExport||"Export log";setButtonLabelWithIconBinding$1(ne,T,ICON_GLYPHS.fileExport);const J=texts$1[e].versionCompareExportHelp||T;ne.setAttribute("data-help",J),ne.setAttribute("title",J)}if(Ce){const T=texts$1[e].versionCompareClose||texts$1[e].cancelSettings||"Close";setButtonLabelWithIconBinding$1(Ce,T,ICON_GLYPHS.circleX)}if(z){const T=texts$1[e].backupSettings;setButtonLabelWithIconBinding$1(z,T,ICON_GLYPHS.fileExport);const J=texts$1[e].backupSettingsHelp||T;z.setAttribute("data-help",J),z.setAttribute("title",J),z.setAttribute("aria-label",J)}if(restoreSettings){const T=texts$1[e].restoreSettings;setButtonLabelWithIconBinding$1(restoreSettings,T,ICON_GLYPHS.fileImport);const J=texts$1[e].restoreSettingsHelp||T;restoreSettings.setAttribute("data-help",J),restoreSettings.setAttribute("title",J),restoreSettings.setAttribute("aria-label",J)}if(Ee){const T=texts$1[e].restoreRehearsalButton||"Restore rehearsal";setButtonLabelWithIconBinding$1(Ee,T,ICON_GLYPHS.load);const J=texts$1[e].restoreRehearsalButtonHelp||T;Ee.setAttribute("data-help",J),Ee.setAttribute("title",J),Ee.setAttribute("aria-label",J)}if(Pe&&(Pe.textContent=texts$1[e].restoreRehearsalHeading||Pe.textContent),et&&(et.textContent=texts$1[e].restoreRehearsalIntro||et.textContent),Je&&(Je.textContent=texts$1[e].restoreRehearsalModeLabel||Je.textContent),it&&(it.textContent=texts$1[e].restoreRehearsalModeBackup||it.textContent),rt&&(rt.textContent=texts$1[e].restoreRehearsalModeProject||rt.textContent),Pt&&(Pt.textContent=texts$1[e].restoreRehearsalFileLabel||Pt.textContent),vt){const T=texts$1[e].restoreRehearsalFileButton||"Choose file";setButtonLabelWithIconBinding$1(vt,T,ICON_GLYPHS.fileImport),vt.setAttribute("data-help",T),vt.setAttribute("title",T),vt.setAttribute("aria-label",T)}bo&&(bo.textContent=texts$1[e].restoreRehearsalNoFile||bo.textContent),Et&&(Et.textContent=texts$1[e].restoreRehearsalReady||""),Ut&&(Ut.textContent=texts$1[e].restoreRehearsalRuleHeading||texts$1.en?.restoreRehearsalRuleHeading||Ut.textContent),ge&&(ge.textContent=texts$1[e].restoreRehearsalRuleIntro||texts$1.en?.restoreRehearsalRuleIntro||ge.textContent),ue&&(ue.textContent=texts$1[e].restoreRehearsalRuleEmpty||texts$1.en?.restoreRehearsalRuleEmpty||ue.textContent),We&&(We.textContent=texts$1[e].restoreRehearsalTableCaption||We.textContent),Me&&(Me.textContent=texts$1[e].restoreRehearsalMetricColumn||Me.textContent),Te&&(Te.textContent=texts$1[e].restoreRehearsalLiveColumn||Te.textContent),Be&&(Be.textContent=texts$1[e].restoreRehearsalSandboxColumn||Be.textContent),Ve&&(Ve.textContent=texts$1[e].restoreRehearsalDifferenceColumn||Ve.textContent);const No=typeof je<"u"?je:M("restoreRehearsalCloseButton","restoreRehearsalClose");if(No){const T=texts$1[e].restoreRehearsalClose||texts$1[e].cancelSettings||"Close";setButtonLabelWithIconBinding$1(No,T,ICON_GLYPHS.circleX),No.setAttribute("title",T),No.setAttribute("aria-label",T)}if(mt){const T=texts$1[e].restoreRehearsalProceed||texts$1.en?.restoreRehearsalProceed||"Resume restore rehearsal",J=texts$1[e].restoreRehearsalProceedHelp||texts$1.en?.restoreRehearsalProceedHelp||T;setButtonLabelWithIconBinding$1(mt,T,ICON_GLYPHS.check),mt.setAttribute("data-help",J),mt.setAttribute("title",J),mt.setAttribute("aria-label",J)}if(ct){const T=texts$1[e].restoreRehearsalAbort||texts$1.en?.restoreRehearsalAbort||"Abort rehearsal",J=texts$1[e].restoreRehearsalAbortHelp||texts$1.en?.restoreRehearsalAbortHelp||T;setButtonLabelWithIconBinding$1(ct,T,ICON_GLYPHS.circleX),ct.setAttribute("data-help",J),ct.setAttribute("title",J),ct.setAttribute("aria-label",J)}if(factoryResetButton){const T=texts$1[e].factoryResetButton||"Factory reset",J=texts$1[e].factoryResetButtonHelp||T;setButtonLabelWithIconBinding$1(factoryResetButton,T,ICON_GLYPHS.reload),factoryResetButton.setAttribute("data-help",J),factoryResetButton.setAttribute("title",J),factoryResetButton.setAttribute("aria-label",J)}const ao=document.getElementById("aboutHeading");ao&&(ao.textContent=texts$1[e].aboutHeading,ao.setAttribute("data-help",texts$1[e].aboutHeadingHelp||texts$1[e].aboutHeading));const Ir=typeof document<"u"?document.getElementById("aboutVersion"):null;Ir&&(Ir.textContent=`${texts$1[e].versionLabel} ${APP_VERSION$2} `);const cr=[{id:"supportLink",textKey:"supportLink",helpKey:"supportLinkHelp"},{id:"reportBugLink",textKey:"reportBugLink",helpKey:"reportBugLinkHelp"},{id:"suggestFeatureLink",textKey:"suggestFeatureLink",helpKey:"suggestFeatureLinkHelp"}],Rr=texts$1&&texts$1[e]||{},Er=texts$1&&texts$1.en||{};if(cr.forEach(T=>{const J=typeof document<"u"?document.getElementById(T.id):null;if(!J)return;const qe=typeof Rr[T.textKey]=="string"&&Rr[T.textKey]||typeof Er[T.textKey]=="string"&&Er[T.textKey]||J.textContent;J.textContent=qe;const Rt=typeof Rr[T.helpKey]=="string"&&Rr[T.helpKey]||typeof Er[T.helpKey]=="string"&&Er[T.helpKey]||qe;J.setAttribute("data-help",Rt),J.setAttribute("title",Rt),J.setAttribute("aria-label",Rt)}),settingsSave){const T=texts$1[e].saveSettings||texts$1.en?.saveSettings||settingsSave.textContent;setButtonLabelWithIconBinding$1(settingsSave,T);const J=texts$1[e].saveSettingsHelp||texts$1[e].saveSettings||T;settingsSave.setAttribute("data-help",J),settingsSave.setAttribute("title",J),settingsSave.setAttribute("aria-label",J)}if(settingsCancel){const T=texts$1[e].cancelSettings||texts$1.en?.cancelSettings||settingsCancel.textContent;setButtonLabelWithIconBinding$1(settingsCancel,T,ICON_GLYPHS.circleX);const J=texts$1[e].cancelSettingsHelp||texts$1[e].cancelSettings||T;settingsCancel.setAttribute("data-help",J),settingsCancel.setAttribute("title",J),settingsCancel.setAttribute("aria-label",J)}const rr=document.getElementById("menuToggle");if(rr){const T=texts$1[e].menuToggleLabel||texts$1.en?.menuToggleLabel||rr.getAttribute("aria-label")||"Menu",J=texts$1[e].sideMenuClose||texts$1.en?.sideMenuClose||rr.dataset.closeLabel||"Close menu",qe=texts$1[e].sideMenuCloseHelp||J;rr.setAttribute("title",T),rr.setAttribute("aria-label",T);const Rt=texts$1[e].menuToggleHelp||T;rr.setAttribute("data-help",Rt),rr.dataset.menuLabel=T,rr.dataset.menuHelp=Rt,rr.dataset.closeLabel=J,rr.dataset.closeHelp=qe}const $r=document.getElementById("sideMenu");if($r){const T=texts$1[e].sideMenuHelp;T?$r.setAttribute("data-help",T):$r.removeAttribute("data-help")}const Pr=document.getElementById("sideMenuTitle");if(Pr){const T=texts$1[e].sideMenuTitle||texts$1.en?.sideMenuTitle||Pr.textContent;Pr.textContent=T;const J=texts$1[e].sideMenuTitleHelp||texts$1[e].sideMenuHelp||T;Pr.setAttribute("data-help",J)}const Kt=document.getElementById("closeMenuButton"),Oo=document.getElementById("closeMenuLabel");if(Kt){const T=texts$1[e].sideMenuClose||texts$1.en?.sideMenuClose||Kt.getAttribute("aria-label")||"Close menu",J=texts$1[e].sideMenuCloseHelp||T;Kt.setAttribute("aria-label",T),Kt.setAttribute("title",J),Kt.setAttribute("data-help",J),Oo&&(Oo.textContent=T)}if(typeof window<"u"&&(window.openSideMenu=openSideMenu),reloadButton$1){const T=texts$1[e].reloadAppLabel,J=texts$1[e].reloadAppHelp||T,qe=texts$1[e].reloadAppOfflineNotice||T;reloadButton$1.setAttribute("title",T),reloadButton$1.setAttribute("aria-label",T),reloadButton$1.setAttribute("data-help",J),reloadButton$1.dataset&&(reloadButton$1.dataset.onlineTitle=T,reloadButton$1.dataset.onlineHelp=J,reloadButton$1.dataset.offlineNotice=qe),reloadButton$1.hasAttribute("aria-disabled")&&(reloadButton$1.setAttribute("title",qe),reloadButton$1.setAttribute("data-help",qe))}if(featureSearch&&(featureSearch.setAttribute("placeholder",texts$1[e].featureSearchPlaceholder),featureSearch.setAttribute("aria-label",texts$1[e].featureSearchLabel),featureSearch.setAttribute("data-help",texts$1[e].featureSearchHelp||texts$1[e].featureSearchLabel)),helpButton$1){helpButton$1.setAttribute("title",texts$1[e].helpButtonTitle||texts$1[e].helpButtonLabel),helpButton$1.setAttribute("aria-label",texts$1[e].helpButtonLabel),helpButton$1.setAttribute("data-help",texts$1[e].helpButtonHelp||texts$1[e].helpButtonTitle||texts$1[e].helpButtonLabel);const T=texts$1[e].helpButtonShortcuts;typeof T=="string"&&T.trim()?helpButton$1.setAttribute("data-shortcuts",T):helpButton$1.removeAttribute("data-shortcuts");const J=texts$1[e].helpButtonAriaShortcuts||"F1 Control+Slash Meta+Slash Shift+Slash KeyH";typeof J=="string"&&J.trim()?helpButton$1.setAttribute("aria-keyshortcuts",J):helpButton$1.removeAttribute("aria-keyshortcuts"),hoverHelpButton$1&&(setButtonLabelWithIconBinding$1(hoverHelpButton$1,texts$1[e].hoverHelpButtonLabel,ICON_GLYPHS.note),hoverHelpButton$1.setAttribute("aria-label",texts$1[e].hoverHelpButtonLabel),hoverHelpButton$1.setAttribute("data-help",texts$1[e].hoverHelpButtonHelp||texts$1[e].hoverHelpButtonLabel)),helpSearch$1&&(helpSearch$1.setAttribute("placeholder",texts$1[e].helpSearchPlaceholder),helpSearch$1.setAttribute("aria-label",texts$1[e].helpSearchLabel),helpSearch$1.setAttribute("data-help",texts$1[e].helpSearchHelp||texts$1[e].helpSearchLabel)),helpSearchClear$1&&(helpSearchClear$1.setAttribute("title",texts$1[e].helpSearchClear),helpSearchClear$1.setAttribute("aria-label",texts$1[e].helpSearchClear),helpSearchClear$1.setAttribute("data-help",texts$1[e].helpSearchClearHelp||texts$1[e].helpSearchClear)),closeHelpBtn&&(setButtonLabelWithIconBinding$1(closeHelpBtn,texts$1[e].helpClose,ICON_GLYPHS.circleX),closeHelpBtn.setAttribute("title",texts$1[e].helpClose),closeHelpBtn.setAttribute("aria-label",texts$1[e].helpClose),closeHelpBtn.setAttribute("data-help",texts$1[e].helpCloseHelp||texts$1[e].helpClose)),document.getElementById("helpTitle")&&(document.getElementById("helpTitle").textContent=texts$1[e].helpTitle),helpNoResults$1&&_(helpNoResults$1,"helpNoResults","No help topics match your search. Try shorter keywords, synonyms or clear the field to browse everything."),helpNoResultsSuggestionsHeading&&_(helpNoResultsSuggestionsHeading,"helpNoResultsSuggestionsHeading","Need a different result?"),helpNoResultsSuggestionsIntro&&_(helpNoResultsSuggestionsIntro,"helpNoResultsSuggestionsIntro","Try these steps to get back on track while keeping your data safe:");const qe=d&&d.querySelector?d.querySelector("#helpQuickStartGuide h4"):null;if(qe){const gr=qe.textContent||"Quick start checklist";_(qe,"helpQuickStartChecklistTitle",gr)}const Rt=d?d.getElementById("helpOnboardingTutorialCopy"):null;if(Rt){const gr=Rt.textContent||"to walk through every workflow before configuring your first project.";_(Rt,"helpOnboardingTutorialCopy",gr)}const Vt=d&&d.querySelector?d.querySelector("#helpDataSafety h4"):null;if(Vt){const gr=Vt.textContent||"Protect your work";_(Vt,"helpDataSafetyTitle",gr)}const Go=d?d.getElementById("helpRestoreDrillHeading"):null;if(Go){const gr=Go.textContent||"Restore rehearsal drill";_(Go,"helpRestoreDrillTitle",gr)}const zo=d?d.getElementById("helpRestoreDrillNote"):null;if(zo){const gr=zo.textContent||"Record the filename, timestamp and verification results in your backup log before closing the rehearsal so every drill leaves behind a documented recovery point.";_(zo,"helpRestoreDrillNote",gr)}if(helpDataAuditHeading){const gr=helpDataAuditHeading.textContent||"Monthly data health check";_(helpDataAuditHeading,"helpDataAuditTitle",gr)}if(O(helpDataAuditStep1,"helpDataAuditStep1",[()=>G("#settingsButton",R("settingsButton")||"Settings",{target:"#settingsButton"}),()=>G("#dataHeading",R("dataHeading")||"Data & Storage",{target:"#dataHeading",highlight:"#settingsDialog"}),()=>G("#storageBackupNow",R("storageBackupNow")||"Download full backup",{target:"#storageBackupNow",highlight:"#storageActions"}),()=>G("#storageActionsHeading",R("storageActionsHeading")||"Quick safeguards",{target:"#storageActionsHeading",highlight:"#storageActions",isButton:!1})]),O(helpDataAuditStep2,"helpDataAuditStep2",[()=>G("#shareSetupBtn",R("shareSetupBtn")||"Export Project",{target:"#shareSetupBtn",highlight:"#setup-manager"})]),O(helpDataAuditStep3,"helpDataAuditStep3",[()=>G("#reloadButton",R("reloadAppLabel")||"Force reload",{target:"#reloadButton"}),()=>G("#offlineIndicator",R("offlineIndicator")||"Offline",{target:"#offlineIndicator"}),()=>G("#applySharedLinkBtn",R("loadSharedLinkBtn")||"Import Project",{target:"#applySharedLinkBtn",highlight:"#setup-manager"})]),O(helpDataAuditStep4,"helpDataAuditStep4",[()=>G("#restoreRehearsalButton",R("restoreRehearsalButton")||"Restore rehearsal",{target:"#restoreRehearsalButton",highlight:"#restoreRehearsalSection"}),()=>{const gr=d.createElement("code");return gr.textContent="window.cineRuntime.verifyCriticalFlows({ warnOnFailure: true })",gr}]),helpDataAuditNote){const gr=helpDataAuditNote.textContent||"Log the results in your backup rotation checklist so you always know which copies were verified offline.";_(helpDataAuditNote,"helpDataAuditNote",gr)}O(helpNoResultsSuggestionClear,"helpNoResultsSuggestionClear",[()=>G("#helpSearchClear",R("helpSearchClear")||"Clear search",{target:"#helpSearchClear",highlight:"#helpSearchContainer"})]),B(helpNoResultsSuggestionSynonyms,"helpNoResultsSuggestionSynonyms"),O(helpNoResultsSuggestionQuickStart,"helpNoResultsSuggestionQuickStart",[()=>G("#helpQuickStartGuide",R("helpQuickStartChecklistTitle")||"Quick start checklist",{target:"#helpQuickStartGuide",highlight:"#helpQuickStartGuide"})]),O(helpNoResultsSuggestionBackup,"helpNoResultsSuggestionBackup",[()=>G("#helpDataSafety",R("helpDataSafetyTitle")||"Protect your work",{target:"#helpDataSafety",highlight:"#helpDataSafety"}),()=>G("#helpRestoreDrillHeading",R("helpRestoreDrillTitle")||"Restore rehearsal drill",{target:"#helpRestoreDrillHeading",highlight:"#helpDataSafety",isButton:!1})])}setButtonLabelWithIconBinding$1(document.getElementById("generateOverviewBtn"),texts$1[e].generateOverviewBtn,ICON_GLYPHS.overview),setButtonLabelWithIconBinding$1(document.getElementById("generateGearListBtn"),texts$1[e].generateGearListBtn,ICON_GLYPHS.gearList),setButtonLabelWithIconBinding$1(document.getElementById("shareSetupBtn"),texts$1[e].shareSetupBtn,ICON_GLYPHS.fileExport);const Dt=document.getElementById("exportAndRevertBtn");Dt&&(setButtonLabelWithIconBinding$1(Dt,texts$1[e].exportAndRevertBtn,ICON_GLYPHS.reload),Dt.setAttribute("data-help",texts$1[e].exportAndRevertBtnHelp));const Fo=typeof downloadDiagramBtn<"u"&&downloadDiagramBtn||(typeof document<"u"&&document&&typeof document.getElementById=="function"?document.getElementById("downloadDiagram"):null);if(Fo&&(Fo.textContent=texts$1[e].downloadDiagramBtn,Fo.setAttribute("title",texts$1[e].downloadDiagramBtn),Fo.setAttribute("aria-label",texts$1[e].downloadDiagramBtn),Fo.setAttribute("data-help",texts$1[e].downloadDiagramHelp)),gridSnapToggleBtn){setButtonLabelWithIconBinding$1(gridSnapToggleBtn,texts$1[e].gridSnapToggle,ICON_GLYPHS.magnet),gridSnapToggleBtn.setAttribute("title",texts$1[e].gridSnapToggle),gridSnapToggleBtn.setAttribute("aria-label",texts$1[e].gridSnapToggle),gridSnapToggleBtn.setAttribute("data-help",texts$1[e].gridSnapToggleHelp);let T=!1;try{T=!!getGridSnapState$1()}catch{try{T=!!gridSnap}catch{}}gridSnapToggleBtn.setAttribute("aria-pressed",T?"true":"false")}const qr=typeof document<"u"?document.getElementById("resetView"):null;qr&&(setButtonLabelWithIconBinding$1(qr,texts$1[e].resetViewBtn,ICON_GLYPHS.resetView),qr.setAttribute("title",texts$1[e].resetViewBtn),qr.setAttribute("aria-label",texts$1[e].resetViewBtn),qr.setAttribute("data-help",texts$1[e].resetViewHelp));const en=typeof document<"u"?document.getElementById("zoomIn"):null;en&&(setButtonLabelWithIconBinding$1(en,"",ICON_GLYPHS.add),en.setAttribute("title",texts$1[e].zoomInLabel),en.setAttribute("aria-label",texts$1[e].zoomInLabel),en.setAttribute("data-help",texts$1[e].zoomInHelp));const yr=typeof document<"u"?document.getElementById("zoomOut"):null;yr&&(setButtonLabelWithIconBinding$1(yr,"",ICON_GLYPHS.minus),yr.setAttribute("title",texts$1[e].zoomOutLabel),yr.setAttribute("aria-label",texts$1[e].zoomOutLabel),yr.setAttribute("data-help",texts$1[e].zoomOutHelp));const Kr=typeof document<"u"?document.getElementById("diagramHint"):null;Kr&&(Kr.textContent=texts$1[e].diagramMoveHint);const Zo=texts$1.en&&texts$1.en.projectForm?texts$1.en.projectForm:{},Cr=texts$1[e].projectForm||Zo;if(Cr){resolveContactsDomRefs();const T=(Xt,po)=>{if(!Xt)return;const Wr=Cr[po]||Zo[po];Wr&&(Xt.textContent=Wr)},J=(Xt,po)=>{if(!Xt)return;const Wr=Cr[po]||Zo[po];Wr&&Xt.setAttribute("placeholder",Wr)},qe=(Xt,po)=>{if(!Xt)return;const Wr=Cr[po]||Zo[po];Wr&&(Xt.textContent=Wr)};if(T(projectDialogHeading,"heading"),T(projectNameLabel,"projectName"),T(productionCompanyLabel,"productionCompany"),T(productionCompanyAddressLabel,"productionCompanyAddress"),T(productionCompanyStreetLabel,"productionCompanyStreet"),T(productionCompanyStreet2Label,"productionCompanyStreet2"),T(productionCompanyCityLabel,"productionCompanyCity"),T(productionCompanyRegionLabel,"productionCompanyRegion"),T(productionCompanyPostalCodeLabel,"productionCompanyPostalCode"),T(productionCompanyCountryLabel,"productionCompanyCountry"),J(productionCompanyStreetInput,"productionCompanyStreetPlaceholder"),J(productionCompanyStreet2Input,"productionCompanyStreet2Placeholder"),J(productionCompanyCityInput,"productionCompanyCityPlaceholder"),J(productionCompanyRegionInput,"productionCompanyRegionPlaceholder"),J(productionCompanyPostalCodeInput,"productionCompanyPostalCodePlaceholder"),J(productionCompanyCountryInput,"productionCompanyCountryPlaceholder"),T(rentalHouseLabel,"rentalHouse"),T(crewHeadingElem,"crewHeading"),crewLabelElem){const Xt=Cr.crewHeading||Zo.crewHeading;Xt&&(crewLabelElem.textContent=`${Xt}: `)}if(T(prepLabelElem,"prepLabel"),T(shootLabelElem,"shootLabel"),T(returnLabelElem,"returnLabel"),T(deliveryResolutionLabel,"deliveryResolution"),T(recordingResolutionLabel,"recordingResolution"),T(sensorModeLabel,"sensorMode"),T(aspectRatioLabel,"aspectRatio"),T(codecLabel,"codec"),T(baseFrameRateLabel,"baseFrameRate"),T(recordingFrameRateLabel,"recordingFrameRate"),recordingFrameRateHintElem){const Xt=Cr.recordingFrameRateRangeHint||Zo.recordingFrameRateRangeHint||"",po=Cr.recordingFrameRateDefaultHint||Zo.recordingFrameRateDefaultHint||"";Xt?recordingFrameRateHintElem.setAttribute("data-range-template",Xt):recordingFrameRateHintElem.removeAttribute("data-range-template"),po?(recordingFrameRateHintElem.setAttribute("data-default-message",po),recordingFrameRateHintElem.textContent=po,recordingFrameRateHintElem.hidden=!1):(recordingFrameRateHintElem.removeAttribute("data-default-message"),recordingFrameRateHintElem.textContent="",recordingFrameRateHintElem.hidden=!0)}if(slowMotionLegendElem){const Xt=Cr.slowMotionHeading||Zo.slowMotionHeading;Xt&&(slowMotionLegendElem.textContent=Xt)}if(T(slowMotionRecordingResolutionLabel,"slowMotionRecordingResolution"),T(slowMotionSensorModeLabel,"slowMotionSensorMode"),T(slowMotionAspectRatioLabel,"slowMotionAspectRatio"),T(slowMotionBaseFrameRateLabel,"slowMotionBaseFrameRate"),T(slowMotionRecordingFrameRateLabel,"slowMotionRecordingFrameRate"),slowMotionRecordingFrameRateHintElem){const Xt=Cr.slowMotionRecordingFrameRateRangeHint||Zo.slowMotionRecordingFrameRateRangeHint||"",po=Cr.slowMotionRecordingFrameRateDefaultHint||Zo.slowMotionRecordingFrameRateDefaultHint||"";Xt?slowMotionRecordingFrameRateHintElem.setAttribute("data-range-template",Xt):slowMotionRecordingFrameRateHintElem.removeAttribute("data-range-template"),po?(slowMotionRecordingFrameRateHintElem.setAttribute("data-default-message",po),slowMotionRecordingFrameRateHintElem.textContent=po,slowMotionRecordingFrameRateHintElem.hidden=!1):(slowMotionRecordingFrameRateHintElem.removeAttribute("data-default-message"),slowMotionRecordingFrameRateHintElem.textContent="",slowMotionRecordingFrameRateHintElem.hidden=!0)}if(T(lensesHeadingElem,"lensesHeading"),T(lensManufacturerLabel,"lensManufacturerStep"),T(lensSeriesLabel,"lensSeriesStep"),T(lensesLabelElem,"lensesLabel"),T(lensSelectionsHeadingElem,"lensSelectionsLabel"),T(lensSelectionsHintElem,"lensSelectionsHint"),qe(lensManufacturerPlaceholderOption,"lensManufacturerPlaceholder"),qe(lensSeriesPlaceholderOption,"lensSeriesPlaceholder"),lensSeriesEmptyElem){const Xt=Cr.lensSeriesEmpty||Zo.lensSeriesEmpty;Xt&&(lensSeriesEmptyElem.textContent=Xt)}if(lensOptionsEmptyElem){const Xt=Cr.lensOptionsEmpty||Zo.lensOptionsEmpty;Xt&&(lensOptionsEmptyElem.textContent=Xt)}if(lensSelectionChipsElem){const Xt=Cr.lensRemoveLabel||Zo.lensRemoveLabel,po=Cr.lensMountLabel||Zo.lensMountLabel;Xt&&lensSelectionChipsElem.setAttribute("data-remove-template",Xt),po&&lensSelectionChipsElem.setAttribute("data-mount-label",po)}if(lensSelectionManager&&typeof lensSelectionManager.refreshCatalog=="function")try{lensSelectionManager.refreshCatalog({preserveSelections:!0,skipEvent:!0,skipDirty:!0})}catch{}if(T(riggingHeadingElem,"riggingHeading"),T(requiredScenariosLabel,"requiredScenarios"),updateRequiredScenariosTranslations(e),T(cameraHandleLabel,"cameraHandle"),T(viewfinderExtensionLabel,"viewfinderExtension"),T(matteboxFilterHeadingElem,"matteboxFilterHeading"),T(matteboxLabel,"mattebox"),T(filterLabel,"filter"),T(storageHeading,"storageHeading"),T(storageNeedsLabel,"storageNeedsLabel"),updateStorageRequirementTranslations(Cr,Zo),updateStorageRequirementTypeOptions$1(),T(monitoringHeadingElem,"monitoringHeading"),T(monitoringConfigurationLabel,"monitoringConfiguration"),T(viewfinderSettingsLabel,"viewfinderSettings"),T(frameGuidesLabel,"frameGuides"),T(aspectMaskOpacityLabel,"aspectMaskOpacity"),T(videoDistributionLabel,"videoDistribution"),T(monitorUserButtonsLabel,"monitorUserButtons"),T(cameraUserButtonsLabel,"cameraUserButtons"),T(viewfinderUserButtonsLabel,"viewfinderUserButtons"),T(tripodPreferencesHeading$1,"tripodPreferencesHeading"),T(tripodHeadBrandLabel,"tripodHeadBrand"),T(tripodBowlLabel,"tripodBowl"),T(tripodTypesLabel,"tripodTypes"),T(tripodSpreaderLabel,"tripodSpreader"),viewfinderExtensionSelect&&viewfinderExtensionSelect.options.length>=2){const Xt=Cr.viewfinderExtensionNone||Zo.viewfinderExtensionNone,po=Cr.viewfinderExtensionYes||Zo.viewfinderExtensionYes;Xt&&(viewfinderExtensionSelect.options[0].textContent=Xt),po&&(viewfinderExtensionSelect.options[1].textContent=po)}const Rt=typeof document<"u"?document.getElementById("projectCancel"):null,Vt=Cr.cancel||Zo.cancel||(Rt?Rt.textContent:projectDialogCloseBtn$1?.getAttribute("aria-label"))||"Cancel";if(Rt&&setButtonLabelWithIconBinding$1(Rt,Vt,ICON_GLYPHS.circleX),projectDialogCloseBtn$1&&(projectDialogCloseBtn$1.innerHTML=iconMarkup$1(ICON_GLYPHS.circleX,"btn-icon"),projectDialogCloseBtn$1.setAttribute("aria-label",Vt),projectDialogCloseBtn$1.setAttribute("title",Vt),projectDialogCloseBtn$1.setAttribute("data-help",Vt)),projectSubmitBtn){const Xt=Cr.submit||Zo.submit;Xt&&(setButtonLabelWithIconBinding$1(projectSubmitBtn,Xt,ICON_GLYPHS.check),projectSubmitBtn.setAttribute("aria-label",Xt))}const Go={name:Cr.crewNamePlaceholder||Zo.crewNamePlaceholder,phone:Cr.crewPhonePlaceholder||Zo.crewPhonePlaceholder,email:Cr.crewEmailPlaceholder||Zo.crewEmailPlaceholder,website:Cr.crewWebsitePlaceholder||Zo.crewWebsitePlaceholder},zo=texts$1[e].crewRoles||texts$1.en&&texts$1.en.crewRoles||{},gr=texts$1.en?.contacts||{},It=texts$1[e]?.contacts||gr;if(contactsDialogHeading&&It.heading&&(contactsDialogHeading.textContent=It.heading),contactsDialogDescription&&It.description&&(contactsDialogDescription.textContent=It.description),contactsAddButtonLabel&&It.addContactButton&&(contactsAddButtonLabel.textContent=It.addContactButton),contactsAddButton&&It.addContactButton&&(contactsAddButton.setAttribute("aria-label",It.addContactButton),contactsAddButton.setAttribute("data-help",It.addContactButton)),contactsImportButtonLabel&&It.importButton&&(contactsImportButtonLabel.textContent=It.importButton),contactsImportButton&&It.importButton&&(contactsImportButton.setAttribute("aria-label",It.importButton),contactsImportButton.setAttribute("data-help",It.importButton)),contactsImportHint&&It.importHint&&(contactsImportHint.textContent=It.importHint),contactsEmptyState&&It.emptyState&&(contactsEmptyState.textContent=It.emptyState),userProfileHeading&&It.userProfileHeading&&(userProfileHeading.textContent=It.userProfileHeading),userProfileDescription&&It.userProfileDescription&&(userProfileDescription.textContent=It.userProfileDescription),userProfileNameLabel&&It.userProfileNameLabel&&(userProfileNameLabel.textContent=It.userProfileNameLabel),userProfileNameInput&&It.userProfileNamePlaceholder&&userProfileNameInput.setAttribute("placeholder",It.userProfileNamePlaceholder),userProfileRoleLabel&&It.userProfileRoleLabel&&(userProfileRoleLabel.textContent=It.userProfileRoleLabel),userProfileRoleInput){const Xt=profileController?.getUserProfileSnapshot?profileController.getUserProfileSnapshot():{role:""};populateUserProfileRoleSelect({selected:Xt.role||""})}userProfilePhoneLabel&&It.userProfilePhoneLabel&&(userProfilePhoneLabel.textContent=It.userProfilePhoneLabel),userProfilePhoneInput&&It.userProfilePhonePlaceholder&&userProfilePhoneInput.setAttribute("placeholder",It.userProfilePhonePlaceholder),userProfileEmailLabel&&It.userProfileEmailLabel&&(userProfileEmailLabel.textContent=It.userProfileEmailLabel),userProfileEmailInput&&It.userProfileEmailPlaceholder&&userProfileEmailInput.setAttribute("placeholder",It.userProfileEmailPlaceholder),userProfileHint&&It.userProfileHint&&(userProfileHint.textContent=It.userProfileHint),userProfileAvatarButtonLabel&&It.userProfileAvatarButton&&(userProfileAvatarButtonLabel.textContent=It.userProfileAvatarButton),userProfileAvatarButton&&It.userProfileAvatarButton&&(userProfileAvatarButton.setAttribute("aria-label",It.userProfileAvatarButton),userProfileAvatarButton.removeAttribute("data-help"),userProfileAvatarButton.removeAttribute("title")),userProfileAvatarClearButton&&It.userProfileAvatarRemove&&(userProfileAvatarClearButton.textContent=It.userProfileAvatarRemove,userProfileAvatarClearButton.setAttribute("aria-label",It.userProfileAvatarRemove)),avatarOptionsTitleElem&&It.avatarOptionsTitle&&(avatarOptionsTitleElem.textContent=It.avatarOptionsTitle),avatarOptionsDescriptionElem&&It.avatarOptionsDescription&&(avatarOptionsDescriptionElem.textContent=It.avatarOptionsDescription),avatarOptionsCloseLabel&&It.avatarOptionsClose&&(avatarOptionsCloseLabel.textContent=It.avatarOptionsClose),avatarOptionsCloseButton&&It.avatarOptionsClose&&(avatarOptionsCloseButton.setAttribute("aria-label",It.avatarOptionsClose),avatarOptionsCloseButton.setAttribute("title",It.avatarOptionsClose),avatarOptionsCloseButton.setAttribute("data-help",It.avatarOptionsClose)),avatarOptionsDeleteButton&&It.avatarDelete&&(setButtonLabelWithIconBinding$1(avatarOptionsDeleteButton,It.avatarDelete,ICON_GLYPHS.trash),avatarOptionsDeleteButton.setAttribute("aria-label",It.avatarDelete),avatarOptionsDeleteButton.setAttribute("title",It.avatarDelete),avatarOptionsDeleteButton.setAttribute("data-help",It.avatarDelete)),avatarEditZoomLabelElem&&It.avatarEditZoomLabel&&(avatarEditZoomLabelElem.textContent=It.avatarEditZoomLabel),contactsCloseButton&&It.close&&(contactsCloseButton.textContent=It.close),renderContactsList$1(),document.querySelectorAll("#crewContainer .person-row").forEach(Xt=>{const po=Xt.querySelector("select");if(po){const $e=po.value;Array.from(po.options).forEach(ze=>{const yt=ze.value;ze.textContent=zo[yt]||yt}),po.value=$e}const Wr=Xt.querySelector(".person-name");Wr&&Go.name&&(Wr.placeholder=Go.name);const Pn=Xt.querySelector(".person-phone");Pn&&Go.phone&&(Pn.placeholder=Go.phone);const Kn=Xt.querySelector(".person-email");Kn&&Go.email&&(Kn.placeholder=Go.email);const Z=Xt.querySelector(".person-website");Z&&Go.website&&(Z.placeholder=Go.website);const he=Xt.querySelector(".person-contact-select");he&&setContactSelectOptions(he,he.value);const fe=Xt.querySelector(".person-save-contact");fe&&setButtonLabelWithIconBinding$1(fe,getContactsText$1("saveContact","Save to contacts"),ICON_GLYPHS.save);const xe=Xt.querySelector(".person-manage-contacts");xe&&setButtonLabelWithIconBinding$1(xe,getContactsText$1("openManager","Open contacts"),ICON_GLYPHS.gears),updateRowLinkedBadge(Xt)});const Vr=Xt=>typeof Xt=="string"?Xt.replace(/[\s\u00a0]*[:：]\s*$/,""):Xt,Nr=Cr.addEntry||Zo.addEntry||"Add";if(addPersonBtn){const Xt=Vr(Cr.crewHeading||Zo.crewHeading||"Crew"),po=`${Nr} ${Xt} `.trim();setButtonLabelWithIconBinding$1(addPersonBtn,po,ICON_GLYPHS.add),addPersonBtn.setAttribute("aria-label",po),addPersonBtn.setAttribute("data-help",po)}if(addPrepBtn){const Xt=Vr(Cr.prepLabel||Zo.prepLabel||"Prep"),po=`${Nr} ${Xt} `.trim();setButtonLabelWithIconBinding$1(addPrepBtn,po,ICON_GLYPHS.add),addPrepBtn.setAttribute("aria-label",po),addPrepBtn.setAttribute("data-help",po)}if(addShootBtn){const Xt=Vr(Cr.shootLabel||Zo.shootLabel||"Shoot"),po=`${Nr} ${Xt} `.trim();setButtonLabelWithIconBinding$1(addShootBtn,po,ICON_GLYPHS.add),addShootBtn.setAttribute("aria-label",po),addShootBtn.setAttribute("data-help",po)}if(addReturnBtn){const Xt=Vr(Cr.returnLabel||Zo.returnLabel||"Return Day"),po=`${Nr} ${Xt} `.trim();setButtonLabelWithIconBinding$1(addReturnBtn,po,ICON_GLYPHS.add),addReturnBtn.setAttribute("aria-label",po),addReturnBtn.setAttribute("data-help",po)}}if(iosPwaHelpTitle&&(iosPwaHelpTitle.textContent=texts$1[e].iosPwaHelpTitle),iosPwaHelpIntro&&(iosPwaHelpIntro.textContent=texts$1[e].iosPwaHelpIntro),iosPwaHelpStep1&&(iosPwaHelpStep1.textContent=texts$1[e].iosPwaHelpStep1),iosPwaHelpStep2&&(iosPwaHelpStep2.textContent=texts$1[e].iosPwaHelpStep2),iosPwaHelpStep3&&(iosPwaHelpStep3.textContent=texts$1[e].iosPwaHelpStep3),iosPwaHelpStep4&&(iosPwaHelpStep4.textContent=texts$1[e].iosPwaHelpStep4),iosPwaHelpNote&&(iosPwaHelpNote.textContent=texts$1[e].iosPwaHelpNote),iosPwaHelpClose){const T=texts$1[e].iosPwaHelpClose;setButtonLabelWithIconBinding$1(iosPwaHelpClose,T,ICON_GLYPHS.check),iosPwaHelpClose.setAttribute("aria-label",T)}document.querySelectorAll(".favorite-toggle").forEach(T=>{T.setAttribute("aria-label",texts$1[e].favoriteToggleLabel),T.setAttribute("title",texts$1[e].favoriteToggleLabel),T.setAttribute("data-help",texts$1[e].favoriteToggleHelp||texts$1[e].favoriteToggleLabel)}),ensureGearListActions(),updateDiagramLegend(),updateStorageSummary(),callCoreFunctionIfAvailable$1("populateFeatureSearch",[],{defer:!0})}var cameraSelect$2=document.getElementById("cameraSelect");typeof window<"u"&&(window.cameraSelect=cameraSelect$2);var monitorSelect$2=document.getElementById("monitorSelect");typeof window<"u"&&(window.monitorSelect=monitorSelect$2);var videoSelect$1=document.getElementById("videoSelect");typeof window<"u"&&(window.videoSelect=videoSelect$1);var videoDistributionSelect$1=document.getElementById("videoDistribution");typeof window<"u"&&(window.videoDistributionSelect=videoDistributionSelect$1);var cageSelect$1=document.getElementById("cageSelect");typeof window<"u"&&(window.cageSelect=cageSelect$1);var motorSelects$1=[document.getElementById("motor1Select"),document.getElementById("motor2Select"),document.getElementById("motor3Select"),document.getElementById("motor4Select")];typeof window<"u"&&(window.motorSelects=motorSelects$1);var controllerSelects$1=[document.getElementById("controller1Select"),document.getElementById("controller2Select"),document.getElementById("controller3Select"),document.getElementById("controller4Select")];typeof window<"u"&&(window.controllerSelects=controllerSelects$1);var distanceSelect$1=document.getElementById("distanceSelect");typeof window<"u"&&(window.distanceSelect=distanceSelect$1);var batterySelect$1=document.getElementById("batterySelect");typeof window<"u"&&(window.batterySelect=batterySelect$1);var hotswapSelect$2=document.getElementById("batteryHotswapSelect");typeof window<"u"&&(window.hotswapSelect=hotswapSelect$2);var lensSelect$1=document.getElementById("lenses");typeof window<"u"&&(window.lensSelect=lensSelect$1);var requiredScenariosSelect$1=document.getElementById("requiredScenarios");document.getElementById("requiredScenariosSummary");var remoteHeadOption$1=requiredScenariosSelect$1?requiredScenariosSelect$1.querySelector('option[value="Remote Head"]'):null;typeof window<"u"&&(window.remoteHeadOption=remoteHeadOption$1);document.getElementById("tripodPreferencesSection");document.getElementById("tripodPreferencesRow");var tripodPreferencesHeading$1=document.getElementById("tripodPreferencesHeading"),tripodHeadBrandSelect$1=document.getElementById("tripodHeadBrand");typeof window<"u"&&(window.tripodHeadBrandSelect=tripodHeadBrandSelect$1);var tripodBowlSelect$1=document.getElementById("tripodBowl");typeof window<"u"&&(window.tripodBowlSelect=tripodBowlSelect$1);var tripodTypesSelect$1=document.getElementById("tripodTypes");typeof window<"u"&&(window.tripodTypesSelect=tripodTypesSelect$1);var tripodSpreaderSelect$1=document.getElementById("tripodSpreader");typeof window<"u"&&(window.tripodSpreaderSelect=tripodSpreaderSelect$1);document.getElementById("monitoringConfiguration");document.getElementById("viewfinderSettingsRow");document.getElementById("viewfinderExtensionRow");const projectDialogHeading=document.getElementById("projectDialogHeading");var projectDialogCloseBtn$1=document.getElementById("projectDialogClose");const projectNameLabel=document.getElementById("projectNameLabel"),productionCompanyLabel=document.getElementById("productionCompanyLabel"),productionCompanyAddressLabel=document.getElementById("productionCompanyAddressLabel"),productionCompanyStreetLabel=document.getElementById("productionCompanyStreetLabel"),productionCompanyStreet2Label=document.getElementById("productionCompanyStreet2Label"),productionCompanyCityLabel=document.getElementById("productionCompanyCityLabel"),productionCompanyRegionLabel=document.getElementById("productionCompanyRegionLabel"),productionCompanyPostalCodeLabel=document.getElementById("productionCompanyPostalCodeLabel"),productionCompanyCountryLabel=document.getElementById("productionCompanyCountryLabel"),productionCompanyStreetInput=document.getElementById("productionCompanyStreet"),productionCompanyStreet2Input=document.getElementById("productionCompanyStreet2"),productionCompanyCityInput=document.getElementById("productionCompanyCity"),productionCompanyRegionInput=document.getElementById("productionCompanyRegion"),productionCompanyPostalCodeInput=document.getElementById("productionCompanyPostalCode"),productionCompanyCountryInput=document.getElementById("productionCompanyCountry"),rentalHouseLabel=document.getElementById("rentalHouseLabel"),crewHeadingElem=document.getElementById("crewHeading"),crewLabelElem=document.getElementById("crewLabel"),prepLabelElem=document.getElementById("prepLabel"),shootLabelElem=document.getElementById("shootLabel"),returnLabelElem=document.getElementById("returnLabel"),deliveryResolutionLabel=document.getElementById("deliveryResolutionLabel");document.getElementById("deliveryResolution");const recordingResolutionLabel=document.getElementById("recordingResolutionLabel"),recordingFrameRateLabel=document.getElementById("recordingFrameRateLabel"),recordingFrameRateHintElem=document.getElementById("recordingFrameRateHint"),slowMotionLegendElem=document.getElementById("slowMotionFrameRateLegend"),slowMotionRecordingResolutionLabel=document.getElementById("slowMotionRecordingResolutionLabel"),slowMotionSensorModeLabel=document.getElementById("slowMotionSensorModeLabel"),slowMotionAspectRatioLabel=document.getElementById("slowMotionAspectRatioLabel"),slowMotionBaseFrameRateLabel=document.getElementById("slowMotionBaseFrameRateLabel"),slowMotionRecordingFrameRateLabel=document.getElementById("slowMotionRecordingFrameRateLabel"),slowMotionRecordingFrameRateHintElem=document.getElementById("slowMotionRecordingFrameRateHint"),sensorModeLabel=document.getElementById("sensorModeLabel"),aspectRatioLabel=document.getElementById("aspectRatioLabel"),codecLabel=document.getElementById("codecLabel"),baseFrameRateLabel=document.getElementById("baseFrameRateLabel"),lensManufacturerLabel=document.getElementById("lensManufacturerLabel"),lensManufacturerPlaceholderOption=document.getElementById("lensManufacturerPlaceholder"),lensSeriesLabel=document.getElementById("lensSeriesLabel"),lensSeriesPlaceholderOption=document.getElementById("lensSeriesPlaceholder"),lensSeriesEmptyElem=document.getElementById("lensSeriesEmpty"),lensOptionsEmptyElem=document.getElementById("lensOptionsEmpty"),lensesHeadingElem=document.getElementById("lensesHeading"),lensesLabelElem=document.getElementById("lensesLabel"),lensSelectionsHeadingElem=document.getElementById("lensSelectionsLabel"),lensSelectionsHintElem=document.getElementById("lensSelectionsHint"),lensSelectionChipsElem=document.getElementById("lensSelectionChips"),riggingHeadingElem=document.getElementById("riggingHeading"),requiredScenariosLabel=document.getElementById("requiredScenariosLabel"),cameraHandleLabel=document.getElementById("cameraHandleLabel"),viewfinderExtensionLabel=document.getElementById("viewfinderExtensionLabel"),viewfinderExtensionSelect=document.getElementById("viewfinderExtension"),matteboxFilterHeadingElem=document.getElementById("matteboxFilterHeading"),matteboxLabel=document.getElementById("matteboxLabel"),filterLabel=document.getElementById("filterLabel"),storageHeading=document.getElementById("storageHeading"),storageNeedsLabel=document.getElementById("storageNeedsLabel"),monitoringHeadingElem=document.getElementById("monitoringHeading"),monitoringConfigurationLabel=document.getElementById("monitoringConfigurationLabel"),viewfinderSettingsLabel=document.getElementById("viewfinderSettingsLabel"),frameGuidesLabel=document.getElementById("frameGuidesLabel"),aspectMaskOpacityLabel=document.getElementById("aspectMaskOpacityLabel"),videoDistributionLabel=document.getElementById("videoDistributionLabel"),monitorUserButtonsLabel=document.getElementById("monitorUserButtonsLabel"),cameraUserButtonsLabel=document.getElementById("cameraUserButtonsLabel"),viewfinderUserButtonsLabel=document.getElementById("viewfinderUserButtonsLabel"),tripodHeadBrandLabel=document.getElementById("tripodHeadBrandLabel"),tripodBowlLabel=document.getElementById("tripodBowlLabel"),tripodTypesLabel=document.getElementById("tripodTypesLabel"),tripodSpreaderLabel=document.getElementById("tripodSpreaderLabel"),projectSubmitBtn=document.getElementById("projectSubmit");var crewContainer$1=document.getElementById("crewContainer");const addPersonBtn=document.getElementById("addPersonBtn");var prepContainer$1=document.getElementById("prepContainer");const addPrepBtn=document.getElementById("addPrepBtn");var shootContainer$1=document.getElementById("shootContainer");const addShootBtn=document.getElementById("addShootBtn");var returnContainer$1=document.getElementById("returnContainer");const addReturnBtn=document.getElementById("addReturnBtn");var storageNeedsContainer$1=document.getElementById("storageNeedsContainer"),contactsDialog=null,contactsForm=null,contactsDialogHeading=null,contactsDialogDescription=null,contactsAddButton=null,contactsAddButtonLabel=null,contactsImportButton=null,contactsImportButtonLabel=null,contactsImportInput=null,contactsImportHint=null,contactsList=null,contactsEmptyState=null,contactsCloseButton=null,contactsAnnouncement=null,openContactsBtn=null,userProfileSection=null,userProfileHeading=null,userProfileDescription=null,userProfileNameInput=null,userProfileNameLabel=null,userProfileRoleInput=null,userProfileRoleLabel=null,userProfilePhoneInput=null,userProfilePhoneLabel=null,userProfileEmailInput=null,userProfileEmailLabel=null,userProfileHint=null,userProfileAvatarContainer=null,userProfileAvatarButton=null,userProfileAvatarButtonLabel=null,userProfileAvatarInput=null,userProfileAvatarClearButton=null,avatarOptionsDialog=null,avatarOptionsForm=null,avatarOptionsTitleElem=null,avatarOptionsDescriptionElem=null,avatarOptionsCloseButton=null,avatarOptionsCloseLabel=null,avatarOptionsDeleteButton=null,avatarEditViewport=null,avatarEditImage=null,avatarPlaceholder=null,avatarControls=null,avatarEditZoomInput=null,avatarEditZoomLabelElem=null,avatarOptionsContext=null,avatarEditState=null,avatarEditLastViewportSize=0,avatarUploadInput=null,avatarSaveButton=null,avatarCancelButton=null;function resolveContactsDomRefs(){typeof document>"u"||(contactsDialog=contactsDialog||document.getElementById("contactsDialog"),contactsForm=contactsForm||document.getElementById("contactsForm"),contactsDialogHeading=contactsDialogHeading||document.getElementById("contactsDialogHeading"),contactsDialogDescription=contactsDialogDescription||document.getElementById("contactsDialogDescription"),contactsAddButton=contactsAddButton||document.getElementById("contactsAddButton"),contactsAddButtonLabel=contactsAddButtonLabel||document.getElementById("contactsAddButtonLabel"),contactsImportButton=contactsImportButton||document.getElementById("contactsImportButton"),contactsImportButtonLabel=contactsImportButtonLabel||document.getElementById("contactsImportButtonLabel"),contactsImportInput=contactsImportInput||document.getElementById("contactsImportInput"),contactsImportHint=contactsImportHint||document.getElementById("contactsImportHint"),contactsList=contactsList||document.getElementById("contactsList"),contactsEmptyState=contactsEmptyState||document.getElementById("contactsEmptyState"),contactsCloseButton=contactsCloseButton||document.getElementById("contactsCloseButton"),contactsAnnouncement=contactsAnnouncement||document.getElementById("contactsAnnouncement"),openContactsBtn=openContactsBtn||document.getElementById("openContactsBtn"),userProfileSection=userProfileSection||document.getElementById("contactsUserProfile"),userProfileHeading=userProfileHeading||document.getElementById("contactsUserProfileHeading"),userProfileDescription=userProfileDescription||document.getElementById("contactsUserProfileDescription"),userProfileNameInput=userProfileNameInput||document.getElementById("userProfileName"),userProfileNameLabel=userProfileNameLabel||document.getElementById("userProfileNameLabel"),userProfileRoleInput=userProfileRoleInput||document.getElementById("userProfileRole"),userProfileRoleLabel=userProfileRoleLabel||document.getElementById("userProfileRoleLabel"),userProfilePhoneInput=userProfilePhoneInput||document.getElementById("userProfilePhone"),userProfilePhoneLabel=userProfilePhoneLabel||document.getElementById("userProfilePhoneLabel"),userProfileEmailInput=userProfileEmailInput||document.getElementById("userProfileEmail"),userProfileEmailLabel=userProfileEmailLabel||document.getElementById("userProfileEmailLabel"),userProfileHint=userProfileHint||document.getElementById("userProfileHint"),userProfileAvatarContainer=userProfileAvatarContainer||document.getElementById("userProfileAvatar"),userProfileAvatarButton=userProfileAvatarButton||document.getElementById("userProfileAvatarButton"),userProfileAvatarButtonLabel=userProfileAvatarButtonLabel||document.getElementById("userProfileAvatarButtonLabel"),userProfileAvatarInput=userProfileAvatarInput||document.getElementById("userProfileAvatarInput"),userProfileAvatarClearButton=userProfileAvatarClearButton||document.getElementById("userProfileAvatarClear"),avatarOptionsDialog=avatarOptionsDialog||document.getElementById("avatarOptionsDialog"),avatarOptionsForm=avatarOptionsForm||document.getElementById("avatarOptionsForm"),avatarOptionsTitleElem=avatarOptionsTitleElem||document.getElementById("avatarOptionsTitle"),avatarOptionsDescriptionElem=avatarOptionsDescriptionElem||document.getElementById("avatarOptionsDescription"),avatarOptionsCloseButton=avatarOptionsCloseButton||document.getElementById("avatarOptionsClose"),avatarOptionsCloseLabel=avatarOptionsCloseLabel||document.getElementById("avatarOptionsCloseLabel"),avatarEditViewport=avatarEditViewport||document.getElementById("avatarEditViewport"),avatarEditImage=avatarEditImage||document.getElementById("avatarEditImage"),avatarPlaceholder=avatarPlaceholder||document.getElementById("avatarPlaceholder"),avatarControls=avatarControls||document.getElementById("avatarControls"),avatarEditZoomInput=avatarEditZoomInput||document.getElementById("avatarEditZoom"),avatarEditZoomLabelElem=avatarEditZoomLabelElem||document.getElementById("avatarEditZoomLabel"),avatarUploadInput=avatarUploadInput||document.getElementById("avatarUploadInput"),avatarOptionsDeleteButton=avatarOptionsDeleteButton||document.getElementById("avatarDeleteButton"),avatarSaveButton=avatarSaveButton||document.getElementById("avatarSaveButton"),avatarCancelButton=avatarCancelButton||document.getElementById("avatarCancelButton"))}var crewRoles$1=["DoP","Steadicam Operator","Camera Operator","B-Camera Operator","Drone Operator","DIT","1st AC","2nd AC","Video Operator","Key Grip","Dolly Grip","Best Boy Grip","Rigging Grip","Grip","Key Gaffer","Gaffer","Rigging Gaffer","Best Boy Electric","Electrician","Director","Assistant Director","Producer","Production Manager","Production Assistant"];function getCrewRoleLabels(){return texts$1?.[typeof currentLang$1=="string"?currentLang$1:"en"]?.crewRoles||texts$1?.en?.crewRoles||{}}function populateUserProfileRoleSelect(e={}){if(resolveContactsDomRefs(),!userProfileRoleInput)return;const t=userProfileRoleInput.ownerDocument||(typeof document<"u"?document:null);if(!t)return;const o=getCrewRoleLabels(),r=getContactsText$1("rolePlaceholder","Select role"),n=getContactsText$1("userProfileRolePlaceholder",r)||r,a=e&&typeof e.selected=="string"?e.selected:profileController?.getUserProfileSnapshot?profileController.getUserProfileSnapshot().role:"",s=userProfileRoleInput.scrollTop;userProfileRoleInput.textContent="";const l=t.createElement("option");l.value="",l.textContent=n,userProfileRoleInput.appendChild(l),crewRoles$1.forEach(d=>{const m=t.createElement("option");m.value=d,m.textContent=o[d]||d,userProfileRoleInput.appendChild(m)});const u=typeof a=="string"?a.trim():"";if(u&&!crewRoles$1.includes(u)){const d=t.createElement("option");d.value=u,d.textContent=o[u]||u,userProfileRoleInput.appendChild(d)}userProfileRoleInput.value=u||"",userProfileRoleInput.scrollTop=s}function ensureUserProfileRoleOption(e){if(resolveContactsDomRefs(),!userProfileRoleInput)return;const t=typeof e=="string"?e.trim():"";if(!t||Array.from(userProfileRoleInput.options||[]).some(s=>s.value===t))return;const r=userProfileRoleInput.ownerDocument||(typeof document<"u"?document:null);if(!r)return;const n=getCrewRoleLabels(),a=r.createElement("option");a.value=t,a.textContent=n[t]||t,userProfileRoleInput.appendChild(a)}var projectFieldIcons$1={productionCompany:PRODUCTION_COMPANY_ICON,productionCompanyAddress:ICON_GLYPHS.pin,rentalHouse:RENTAL_HOUSE_ICON,rentalHouseContact:ICON_GLYPHS.contacts,rentalHouseAddress:ICON_GLYPHS.pin,crew:iconGlyph$1("",ICON_FONT_KEYS.UICONS),prepDays:iconGlyph$1("",ICON_FONT_KEYS.UICONS),returnDays:iconGlyph$1("",ICON_FONT_KEYS.UICONS),shootingDays:iconGlyph$1("",ICON_FONT_KEYS.UICONS),deliveryResolution:iconGlyph$1("",ICON_FONT_KEYS.UICONS),recordingResolution:ICON_GLYPHS.camera,recordingFrameRate:iconGlyph$1("",ICON_FONT_KEYS.UICONS),slowMotionRecordingResolution:ICON_GLYPHS.camera,slowMotionRecordingFrameRate:iconGlyph$1("",ICON_FONT_KEYS.UICONS),aspectRatio:ASPECT_RATIO_ICON,codec:ICON_GLYPHS.codec,baseFrameRate:iconGlyph$1("",ICON_FONT_KEYS.UICONS),slowMotionBaseFrameRate:iconGlyph$1("",ICON_FONT_KEYS.UICONS),sensorMode:ICON_GLYPHS.sensor,slowMotionSensorMode:ICON_GLYPHS.sensor,slowMotionAspectRatio:ASPECT_RATIO_ICON,requiredScenarios:REQUIRED_SCENARIOS_ICON,lenses:iconGlyph$1("",ICON_FONT_KEYS.UICONS),cameraHandle:iconGlyph$1("",ICON_FONT_KEYS.UICONS),viewfinderExtension:iconGlyph$1("",ICON_FONT_KEYS.UICONS),gimbal:iconGlyph$1("",ICON_FONT_KEYS.UICONS),monitoringSupport:MONITORING_SUPPORT_ICON,monitoringConfiguration:iconGlyph$1("",ICON_FONT_KEYS.UICONS),monitorUserButtons:iconGlyph$1("",ICON_FONT_KEYS.UICONS),cameraUserButtons:iconGlyph$1("",ICON_FONT_KEYS.UICONS),viewfinderUserButtons:iconGlyph$1("",ICON_FONT_KEYS.UICONS),storageRequirements:ICON_GLYPHS.save};function updateSelectIconBoxes$1(e){if(!e)return;const t=e.multiple?Array.from(e.selectedOptions||[]):[],o=e.multiple?t.some(s=>typeof s.value=="string"?s.value.trim()!=="":!!s.value):typeof e.value=="string"?e.value.trim()!=="":e.value!==null&&e.value!==void 0&&String(e.value).trim()!=="";if(e.classList.toggle("select-placeholder",!o),e.id==="requiredScenarios")return;const r=e.parentNode;if(!r||typeof r.querySelector!="function")return;let n=r.querySelector(".icon-box-summary");n||(n=document.createElement("div"),n.className="icon-box-summary",r.insertBefore(n,e.nextSibling)),n.innerHTML="",(e.multiple?t:o&&e.selectedIndex>=0?[e.options[e.selectedIndex]]:[]).forEach(s=>{const l=document.createElement("span");l.className="icon-box";const u=document.createElement("span");u.className="icon icon-glyph";let d=projectFieldIcons$1[e.name]||ICON_GLYPHS.pin;s.dataset.icon&&(d=iconGlyph$1(s.dataset.icon,s.dataset.iconFont||ICON_FONT_KEYS.UICONS)),applyIconGlyph(u,d),l.appendChild(u),l.appendChild(document.createTextNode(s.value)),n.appendChild(l)})}try{typeof globalThis<"u"&&typeof globalThis.updateSelectIconBoxes!="function"&&(globalThis.updateSelectIconBoxes=updateSelectIconBoxes$1)}catch(e){console.warn("Failed to expose updateSelectIconBoxes globally",e)}function getLocalizedPathText(e,t=""){if(!e)return t;const o=Array.isArray(e)?e:typeof e=="string"?[e]:[];if(!o.length)return t;const r=texts$1&&texts$1[currentLang$1]||{},n=texts$1&&texts$1.en||{},a=u=>o.reduce((d,m)=>{if(d&&Object.prototype.hasOwnProperty.call(d,m))return d[m]},u),s=a(r);if(s!=null&&s!=="")return String(s);const l=a(n);return l!=null&&l!==""?String(l):t}function configureIconOnlyButton(e,t,o={}){if(!e)return;const{contextPaths:r=[],fallbackContext:n="",actionKey:a="addEntry"}=o||{};setButtonLabelWithIconBinding$1(e,"",t||ICON_GLYPHS.add);const s=getLocalizedPathText(["projectForm",a],a==="removeEntry"?"Remove":"Add"),l=Array.isArray(r)?r:[r];let u="";for(const y of l){if(!y)continue;const h=getLocalizedPathText(y,"");if(h){u=h;break}}!u&&typeof n=="string"&&(u=n);const d=u?u.replace(/[:：]\s*$/,"").trim():"",m=[s,d].filter(Boolean).join(" ").trim();m&&(e.setAttribute("aria-label",m),e.setAttribute("title",m))}exposeCoreRuntimeConstant$1("configureIconOnlyButton",configureIconOnlyButton);let generatedFieldIdCounter=0;function sanitizeForId(e,t="field"){return e==null?t:String(e).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||t}function ensureElementId$1(e,t="field"){if(!e)return"";if(e.id)return e.id;const o=sanitizeForId(t,"field");let r="";do generatedFieldIdCounter+=1,r=`${o} -${generatedFieldIdCounter} `;while(document.getElementById(r));return e.id=r,r}function createHiddenLabel$1(e,t){const o=document.createElement("label");return o.className="visually-hidden",o.setAttribute("for",e),o.textContent=typeof t=="string"?t:"",o}try{typeof globalThis<"u"&&(typeof globalThis.ensureElementId!="function"&&(globalThis.ensureElementId=ensureElementId$1),typeof globalThis.createHiddenLabel!="function"&&(globalThis.createHiddenLabel=createHiddenLabel$1))}catch(e){console.warn("Failed to expose accessibility helpers globally",e)}function getProjectFormText(e,t=""){const o=texts$1?.en?.projectForm||{},r=texts$1?.[currentLang$1]?.projectForm||o,n=r&&typeof r[e]=="string"?r[e].trim():"";return n||(o&&typeof o[e]=="string"?o[e].trim():"")||t}const CONTACTS_STORAGE_KEY_DEFAULT="cameraPowerPlanner_contacts";function resolveContactsStorageKey(){try{const e=resolveContactsModule();if(e&&typeof e.CONTACTS_STORAGE_KEY=="string"&&e.CONTACTS_STORAGE_KEY)return e.CONTACTS_STORAGE_KEY}catch(e){console.warn("Failed to resolve contacts storage key via module.",e)}return CONTACTS_STORAGE_KEY_DEFAULT}var contactsCache$1=[],contactsInitialized=!1;const profileController=localCreateProfileController({loadProfile:()=>{try{return typeof loadUserProfile=="function"?loadUserProfile():null}catch(e){return console.warn("Failed to resolve stored user profile",e),null}},saveProfile:e=>{if(typeof saveUserProfile=="function")try{saveUserProfile(e)}catch(t){console.warn("Failed to persist user profile",t)}},announce:e=>announceContactsMessage(e),getText:getContactsText$1,dispatchChange:()=>dispatchGearProviderDataChanged$1("user-profile")});function getContactsText$1(e,t=""){const o=texts$1?.en?.contacts||{},r=texts$1?.[currentLang$1]?.contacts||o,n=r&&typeof r[e]=="string"?r[e].trim():"";return n||(o&&typeof o[e]=="string"?o[e].trim():"")||t}function generateContactId(){const e=resolveContactsModule();if(e&&typeof e.generateContactId=="function")try{return e.generateContactId()}catch(t){console.warn("Unable to generate contact id via module.",t)}return`contact - ${Date.now().toString(36)} -${Math.random().toString(36).slice(2,8)} `}function sanitizeContactValue$2(e){return sanitizeContactValueHelper(e)}function normalizeContactEntry$2(e){return normalizeContactEntryHelper(e)}function sortContacts$2(e){return sortContactsHelper(e)}function loadStoredContacts(){const e=resolveContactsModule();if(e&&typeof e.loadStoredContacts=="function")try{return e.loadStoredContacts()}catch(t){console.warn("Unable to load contacts via module.",t)}if(typeof localStorage>"u")return[];try{const t=resolveContactsStorageKey(),o=localStorage.getItem(t);if(!o)return[];const r=JSON.parse(o);return Array.isArray(r)?sortContacts$2(r):[]}catch(t){return console.warn("Failed to load contacts from storage",t),[]}}function saveContactsToStorage$1(e){const t=resolveContactsModule();if(t&&typeof t.saveContactsToStorage=="function")try{t.saveContactsToStorage(e);return}catch(o){console.warn("Unable to save contacts via module.",o)}if(!(typeof localStorage>"u"))try{const o=resolveContactsStorageKey();localStorage.setItem(o,JSON.stringify(e))}catch(o){console.warn("Failed to save contacts to storage",o)}}function getContactById$1(e){return e&&contactsCache$1.find(t=>t.id===e)||null}function getContactDisplayLabel$1(e){if(!e)return"";const t=texts$1?.[currentLang$1]?.crewRoles||texts$1?.en?.crewRoles||{},o=e.name||e.email||e.phone||e.website||e.role||e.id,r=e.role?t[e.role]||e.role:"";return o&&r&&r!==o?`${o} — ${r} `:o||r||e.id}typeof window<"u"&&(window.updateTripodOptions=updateTripodOptions);function setContactSelectOptions(e,t){if(!e)return;const o=typeof t=="string"?t:e.value;let r=e.lang;!r&&typeof document<"u"&&document&&document.documentElement&&(r=document.documentElement.lang||""),r||(r=currentLang$1||DEFAULT_LANGUAGE_SAFE$1);const n=e.dir||localResolveDocumentDirection(r||currentLang$1||DEFAULT_LANGUAGE_SAFE$1);for(;e.firstChild;)e.removeChild(e.firstChild);const a=document.createElement("option");if(a.value="",a.textContent=getContactsText$1("selectPlaceholder","Select contact"),localApplyLocaleMetadata(a,r,n),e.appendChild(a),contactsCache$1.forEach(s=>{const l=document.createElement("option");l.value=s.id,l.textContent=getContactDisplayLabel$1(s),localApplyLocaleMetadata(l,r,n),s.id===o&&(l.selected=!0),e.appendChild(l)}),o&&!contactsCache$1.some(s=>s.id===o)){const s=document.createElement("option");s.value=o,s.textContent=getContactsText$1("missingContactFallback","Saved contact"),s.selected=!0,localApplyLocaleMetadata(s,r,n),e.appendChild(s)}}function updateContactPickers$1(){if(!crewContainer$1)return;crewContainer$1.querySelectorAll(".person-contact-select").forEach(t=>setContactSelectOptions(t)),dispatchGearProviderDataChanged$1("contacts")}function getAvatarInitial(e){if(typeof e=="string"){const t=e.trim();if(t)return t.charAt(0).toUpperCase()}return"•"}function updateAvatarVisual(e,t,o,r){if(!e)return;const n=e.querySelector(".person-avatar-visual, .contact-card-avatar-visual");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);if(t&&localIsSafeImageUrl(t)){const a=document.createElement("img");a.src=t,a.alt="",n.appendChild(a)}else{const a=document.createElement("span");a.className=r,a.textContent=getAvatarInitial(o),n.appendChild(a)}}}function setRowAvatar(e,t,o={}){if(!e)return;const r=e.querySelector(".person-avatar-data");r&&(r.value=t||"");const n=e.querySelector(".person-name"),a=o&&Object.prototype.hasOwnProperty.call(o,"name")?o.name:n?.value,s=e.querySelector(".person-avatar");updateAvatarVisual(s,t,a,"person-avatar-initial")}function parseDataUrlMimeType(e){if(typeof e!="string"||!e.startsWith("data:"))return"";const t=e.indexOf(";");return t===-1?"":e.slice(5,t).trim()}function updateAvatarOptionsPreview(e,t){resolveContactsDomRefs()}function stopAvatarEditing(e={}){const{restoreFocus:t=!1}=e||{};if(avatarControls&&avatarControls.classList.add("hidden"),avatarEditViewport){try{avatarEditViewport.releasePointerCapture(avatarEditState?.pointerId??-1)}catch{}t&&avatarEditViewport.blur()}avatarEditImage&&avatarEditImage.removeAttribute("style"),avatarEditState=null,typeof avatarOptionsContext?.getAvatar=="function"&&avatarOptionsContext.getAvatar(),typeof avatarOptionsContext?.getName=="function"&&avatarOptionsContext.getName(),updateAvatarOptionsPreview(),updateAvatarOptionsPreview()}function closeAvatarOptionsDialog(){avatarOptionsDialog&&(stopAvatarEditing(),avatarOptionsContext=null,closeDialog$1(avatarOptionsDialog))}function handleAvatarOptionsDialogClosed(){stopAvatarEditing(),avatarOptionsContext=null}function openAvatarOptionsDialog(e=null){console.log("openAvatarOptionsDialog called",e),resolveContactsDomRefs(),console.log("avatarOptionsDialog ref:",avatarOptionsDialog),avatarOptionsDialog&&(avatarOptionsContext=e||null,typeof e?.getAvatar=="function"&&e.getAvatar(),typeof e?.getName=="function"&&e.getName(),updateAvatarOptionsPreview(),stopAvatarEditing(),stopAvatarEditing(),openDialog$1(avatarOptionsDialog))}function clampAvatarEditOffsets(e){if(!e)return;const t=Math.min(0,e.viewportSize-e.displayWidth),o=Math.min(0,e.viewportSize-e.displayHeight);e.offsetX=Math.max(t,Math.min(0,e.offsetX)),e.offsetY=Math.max(o,Math.min(0,e.offsetY))}function updateAvatarEditMetrics(e){if(!e||!e.image)return;const t=e.image.naturalWidth||e.image.width||0,o=e.image.naturalHeight||e.image.height||0,r=t*e.baseScale*e.zoom,n=o*e.baseScale*e.zoom;e.displayWidth=r,e.displayHeight=n,clampAvatarEditOffsets(e),avatarEditImage&&(avatarEditImage.style.width=`${r} px`,avatarEditImage.style.height=`${n} px`,avatarEditImage.style.transform=`translate(${e.offsetX}px, ${e.offsetY}px)`)}function measureAvatarEditViewportSize(){if(resolveContactsDomRefs(),!avatarEditViewport)return 0;let e=!1,t="",o="";avatarEditViewport&&avatarEditViewport.classList.contains("hidden")&&(e=!0,t=avatarEditViewport.style.visibility||"",o=avatarEditViewport.style.pointerEvents||"",avatarEditViewport.style.visibility="hidden",avatarEditViewport.style.pointerEvents="none",avatarEditViewport.classList.remove("hidden"));let r=0;try{const n=avatarEditViewport.getBoundingClientRect();r=Math.round(Math.max(avatarEditViewport.offsetWidth||0,n.width||0,n.height||0))}finally{e&&avatarEditViewport&&(avatarEditViewport.classList.add("hidden"),avatarEditViewport.style.visibility=t,avatarEditViewport.style.pointerEvents=o)}return!r&&avatarEditLastViewportSize?avatarEditLastViewportSize:(r&&(avatarEditLastViewportSize=r),r)}function initializeAvatarEditState(e){if(resolveContactsDomRefs(),!avatarEditViewport||!avatarEditImage)return;if(!e){announceContactsMessage(getContactsText$1("avatarMissingImage","Add a photo before editing."));return}const t=measureAvatarEditViewportSize();if(!t){announceContactsMessage(getContactsText$1("avatarEditUnavailable","Photo editor unavailable."));return}const o=new Image;o.decoding="async";const r=parseDataUrlMimeType(e);o.onload=()=>{if(!o.naturalWidth||!o.naturalHeight){announceContactsMessage(getContactsText$1("avatarReadError","Could not read the selected image."));return}const n=Math.max(t/o.naturalWidth,t/o.naturalHeight);avatarEditState={active:!0,dataUrl:e,image:o,mime:r,viewportSize:t,baseScale:n,zoom:1,offsetX:(t-o.naturalWidth*n)/2,offsetY:(t-o.naturalHeight*n)/2,pointerId:null,pointerStartX:0,pointerStartY:0,offsetStartX:0,offsetStartY:0,displayWidth:0,displayHeight:0},avatarEditImage.src=e,avatarEditViewport&&avatarEditViewport.classList.add("has-image"),avatarControls&&avatarControls.classList.remove("hidden"),avatarEditZoomInput&&(avatarEditZoomInput.value="100"),updateAvatarEditMetrics(avatarEditState);try{avatarEditViewport.focus()}catch{}},o.onerror=()=>{announceContactsMessage(getContactsText$1("avatarReadError","Could not read the selected image."))},o.src=e}function handleAvatarEditZoomInputChange(e){if(!avatarEditState||!avatarEditState.active)return;const t=Number(e?.target?.value)||100,o=Math.max(50,t)/100,r=avatarEditState.displayWidth||1,n=avatarEditState.displayHeight||1,a=-avatarEditState.offsetX+avatarEditState.viewportSize/2,s=-avatarEditState.offsetY+avatarEditState.viewportSize/2,l=a/r,u=s/n;avatarEditState.zoom=o,updateAvatarEditMetrics(avatarEditState);const d=avatarEditState.displayWidth*l,m=avatarEditState.displayHeight*u;avatarEditState.offsetX=-(d-avatarEditState.viewportSize/2),avatarEditState.offsetY=-(m-avatarEditState.viewportSize/2),clampAvatarEditOffsets(avatarEditState),updateAvatarEditMetrics(avatarEditState)}function handleAvatarEditPointerDown(e){if(!(!avatarEditState||!avatarEditState.active||!avatarEditViewport)&&avatarEditState.pointerId===null){avatarEditState.pointerId=e.pointerId,avatarEditState.pointerStartX=e.clientX,avatarEditState.pointerStartY=e.clientY,avatarEditState.offsetStartX=avatarEditState.offsetX,avatarEditState.offsetStartY=avatarEditState.offsetY;try{avatarEditViewport.setPointerCapture(e.pointerId)}catch{}e.preventDefault()}}function handleAvatarEditPointerMove(e){if(!avatarEditState||!avatarEditState.active||avatarEditState.pointerId!==e.pointerId)return;const t=e.clientX-avatarEditState.pointerStartX,o=e.clientY-avatarEditState.pointerStartY;avatarEditState.offsetX=avatarEditState.offsetStartX+t,avatarEditState.offsetY=avatarEditState.offsetStartY+o,clampAvatarEditOffsets(avatarEditState),updateAvatarEditMetrics(avatarEditState),e.preventDefault()}function clearAvatarEditPointerState(){avatarEditState&&(avatarEditState.pointerId=null)}function handleAvatarEditPointerUp(e){if(!(!avatarEditState||!avatarEditState.active)&&avatarEditState.pointerId===e.pointerId){if(clearAvatarEditPointerState(),avatarEditViewport)try{avatarEditViewport.releasePointerCapture(e.pointerId)}catch{}e.preventDefault()}}function handleAvatarEditPointerCancel(e){if(!(!avatarEditState||!avatarEditState.active)&&avatarEditState.pointerId===e.pointerId&&(clearAvatarEditPointerState(),avatarEditViewport))try{avatarEditViewport.releasePointerCapture(e.pointerId)}catch{}}function handleAvatarEditKeyDown(e){if(!avatarEditState||!avatarEditState.active)return;const t=e.shiftKey?10:2;let o=!1;switch(e.key){case"ArrowUp":avatarEditState.offsetY-=t,o=!0;break;case"ArrowDown":avatarEditState.offsetY+=t,o=!0;break;case"ArrowLeft":avatarEditState.offsetX-=t,o=!0;break;case"ArrowRight":avatarEditState.offsetX+=t,o=!0;break}o&&(clampAvatarEditOffsets(avatarEditState),updateAvatarEditMetrics(avatarEditState),e.preventDefault())}function exportAvatarEditResult(){if(!avatarEditState||!avatarEditState.image)return"";const e=avatarEditState.baseScale*avatarEditState.zoom;if(!e)return"";const t=avatarEditState.viewportSize/e,o=Math.max(0,Math.min(avatarEditState.image.naturalWidth-t,-avatarEditState.offsetX/e)),r=Math.max(0,Math.min(avatarEditState.image.naturalHeight-t,-avatarEditState.offsetY/e)),n=document.createElement("canvas");n.width=CONTACT_AVATAR_MAX_DIMENSION,n.height=CONTACT_AVATAR_MAX_DIMENSION;const a=n.getContext("2d");if(!a)return"";a.clearRect(0,0,n.width,n.height),a.drawImage(avatarEditState.image,o,r,t,t,0,0,n.width,n.height);const s=avatarEditState.mime&&avatarEditState.mime.startsWith("image/")?avatarEditState.mime:"image/png";try{return n.toDataURL(s)}catch{try{return n.toDataURL("image/png")}catch{return""}}}function applyAvatarEditChanges(){if(!avatarEditState||!avatarEditState.active)return;const e=exportAvatarEditResult();if(!e){announceContactsMessage(getContactsText$1("avatarEditFailed","Could not update the photo framing."));return}typeof avatarOptionsContext?.onEditSave=="function"&&avatarOptionsContext.onEditSave(e),typeof avatarOptionsContext?.getName=="function"&&avatarOptionsContext.getName(),updateAvatarOptionsPreview(),stopAvatarEditing({restoreFocus:!0}),closeAvatarOptionsDialog()}function handleAvatarDrop(e){if(!e)return;e.preventDefault(),e.stopPropagation(),avatarEditViewport&&avatarEditViewport.classList.remove("drag-over");const t=e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0];t&&processAvatarFile(t)}function handleAvatarDragOver(e){e&&(e.preventDefault(),e.stopPropagation(),avatarEditViewport&&avatarEditViewport.classList.add("drag-over"))}function handleAvatarDragLeave(e){e&&(e.preventDefault(),e.stopPropagation(),avatarEditViewport&&avatarEditViewport.classList.remove("drag-over"))}function handleAvatarUpload(e){const t=e.target&&e.target.files&&e.target.files[0];t&&processAvatarFile(t),e.target&&(e.target.value="")}function processAvatarFile(e){localReadAvatarFile(e,t=>{const o=typeof avatarOptionsContext?.getName=="function"?avatarOptionsContext.getName():"";updateAvatarOptionsPreview(t,o),initializeAvatarEditState(t)},t=>{announceContactsMessage(getContactsText$1("avatarReadError","Could not read image."))})}function handleAvatarSave(){if(avatarEditState&&avatarEditState.active){const e=exportAvatarEditResult();e&&typeof avatarOptionsContext?.onEditSave=="function"&&avatarOptionsContext.onEditSave(e)}closeAvatarOptionsDialog()}function handleAvatarOptionsDialogPointerDown(e){if(!avatarOptionsDialog||!isDialogOpen$1(avatarOptionsDialog)||e&&typeof e.button=="number"&&e.button!==0)return;const t=e?.target||null,o=typeof Element<"u"&&t instanceof Element?t:null,r=typeof e?.composedPath=="function"?e.composedPath():null;if(!(avatarOptionsForm&&(o&&avatarOptionsForm.contains(o)||Array.isArray(r)&&r.includes(avatarOptionsForm)))){if(avatarEditState&&avatarEditState.active){applyAvatarEditChanges();return}closeAvatarOptionsDialog()}}function dispatchGearProviderDataChanged$1(e){if(!(typeof document>"u"))try{document.dispatchEvent(new CustomEvent("gear-provider-data-changed",{detail:{reason:e}}))}catch{}}function assignUserProfileState(e={}){!profileController||typeof profileController.assignUserProfileState!="function"||profileController.assignUserProfileState(e)}function getUserProfileSnapshot$2(){return!profileController||typeof profileController.getUserProfileSnapshot!="function"?{name:"",role:"",avatar:"",phone:"",email:""}:profileController.getUserProfileSnapshot()}function applyUserProfileToDom(e={}){resolveContactsDomRefs();const t=getUserProfileSnapshot$2(),o=e&&e.preserveSelectionTarget?e.preserveSelectionTarget:e&&e.preserveSelection?document.activeElement:null;if(userProfileNameInput)if(o===userProfileNameInput){const r=userProfileNameInput.selectionStart,n=userProfileNameInput.selectionEnd;userProfileNameInput.value=t.name;try{userProfileNameInput.setSelectionRange(r,n)}catch{}}else userProfileNameInput.value=t.name;if(userProfileRoleInput&&(ensureUserProfileRoleOption(t.role),o!==userProfileRoleInput&&(userProfileRoleInput.value=t.role||"")),userProfilePhoneInput)if(o===userProfilePhoneInput){const r=userProfilePhoneInput.selectionStart,n=userProfilePhoneInput.selectionEnd;userProfilePhoneInput.value=t.phone;try{userProfilePhoneInput.setSelectionRange(r,n)}catch{}}else userProfilePhoneInput.value=t.phone;if(userProfileEmailInput)if(o===userProfileEmailInput){const r=userProfileEmailInput.selectionStart,n=userProfileEmailInput.selectionEnd;userProfileEmailInput.value=t.email;try{userProfileEmailInput.setSelectionRange(r,n)}catch{}}else userProfileEmailInput.value=t.email;if(userProfileAvatarContainer&&updateAvatarVisual(userProfileAvatarContainer,t.avatar||"",t.name,"contact-card-avatar-initial"),userProfileAvatarClearButton){const r=!!t.avatar;userProfileAvatarClearButton.disabled=!r,userProfileAvatarClearButton.setAttribute("aria-disabled",r?"false":"true")}}function loadUserProfileState(){if(!profileController||typeof profileController.load!="function"){applyUserProfileToDom();return}profileController.load(),applyUserProfileToDom()}function setAvatar(e){assignUserProfileState({avatar:typeof e=="string"?e:""}),persistUserProfileState()}function clearAvatar(){assignUserProfileState({avatar:""}),persistUserProfileState()}typeof window<"u"&&(typeof window.setAvatar!="function"&&(window.setAvatar=setAvatar),typeof window.clearAvatar!="function"&&(window.clearAvatar=clearAvatar),typeof window.assignUserProfileState!="function"&&(window.assignUserProfileState=assignUserProfileState),typeof window.persistUserProfileState!="function"&&(window.persistUserProfileState=persistUserProfileState));function persistUserProfileState(e={}){if(!profileController||typeof profileController.schedulePersist!="function")return;const t=typeof document<"u"?document.activeElement:null,o=t===userProfileNameInput||t===userProfileRoleInput||t===userProfilePhoneInput||t===userProfileEmailInput?t:null;profileController.schedulePersist({announce:!!(e&&e.announce)}),applyUserProfileToDom({preserveSelectionTarget:o})}function handleUserProfileNameInput(){if(!userProfileNameInput)return;const e=typeof userProfileNameInput.value=="string"?userProfileNameInput.value:"",t=getUserProfileSnapshot$2();e.trim()!==t.name.trim()&&(profileController&&typeof profileController.handleFieldInput=="function"?profileController.handleFieldInput("name",e):assignUserProfileState({name:e}),persistUserProfileState())}function handleUserProfileRoleInput(){if(!userProfileRoleInput)return;const t=(typeof userProfileRoleInput.value=="string"?userProfileRoleInput.value:"").trim(),o=getUserProfileSnapshot$2();t!==o.role.trim()&&(ensureUserProfileRoleOption(t),profileController&&typeof profileController.handleFieldInput=="function"?profileController.handleFieldInput("role",t):assignUserProfileState({role:t}),persistUserProfileState())}function handleUserProfilePhoneInput(){if(!userProfilePhoneInput)return;const e=typeof userProfilePhoneInput.value=="string"?userProfilePhoneInput.value:"",t=getUserProfileSnapshot$2();e.trim()!==t.phone.trim()&&(profileController&&typeof profileController.handleFieldInput=="function"?profileController.handleFieldInput("phone",e):assignUserProfileState({phone:e}),persistUserProfileState())}function handleUserProfileEmailInput(){if(!userProfileEmailInput)return;const e=typeof userProfileEmailInput.value=="string"?userProfileEmailInput.value:"",t=getUserProfileSnapshot$2();e.trim()!==t.email.trim()&&(profileController&&typeof profileController.handleFieldInput=="function"?profileController.handleFieldInput("email",e):assignUserProfileState({email:e}),persistUserProfileState())}function handleUserProfileFieldBlur(){profileController&&typeof profileController.handleFieldBlur=="function"&&profileController.handleFieldBlur()}function handleUserProfileAvatarCleared(){getUserProfileSnapshot$2().avatar&&(assignUserProfileState({avatar:""}),persistUserProfileState(),announceContactsMessage(getContactsText$1("avatarCleared","Profile photo removed.")),isDialogOpen$1(avatarOptionsDialog)&&closeAvatarOptionsDialog())}function handleUserProfileAvatarButtonClick(){const e=getUserProfileSnapshot$2(),t=!!(e&&e.avatar);if(console.log("handleUserProfileAvatarButtonClick",{hasAvatar:t,profile:e}),!t&&userProfileAvatarInput&&typeof userProfileAvatarInput.click=="function")try{userProfileAvatarInput.click();return}catch{}openAvatarOptionsDialog({getAvatar:()=>getUserProfileSnapshot$2().avatar||"",getName:()=>getUserProfileSnapshot$2().name||userProfileNameInput?.value||"",onDelete:()=>{handleUserProfileAvatarCleared()},onChange:()=>{if(userProfileAvatarInput&&typeof userProfileAvatarInput.click=="function")try{userProfileAvatarInput.click()}catch{}},onEditSave:o=>{o&&(assignUserProfileState({name:getUserProfileSnapshot$2().name||userProfileNameInput?.value||"",avatar:o}),persistUserProfileState(),announceContactsMessage(getContactsText$1("avatarUpdated","Profile photo updated.")),closeAvatarOptionsDialog())}})}function handleUserProfileAvatarInputChange(){if(!userProfileAvatarInput)return;const[e]=userProfileAvatarInput.files||[];e&&(localReadAvatarFile(e,t=>{const o=getUserProfileSnapshot$2();assignUserProfileState({name:o.name||"",avatar:t}),persistUserProfileState(),announceContactsMessage(getContactsText$1("avatarUpdated","Profile photo updated.")),isDialogOpen$1(avatarOptionsDialog)&&closeAvatarOptionsDialog()},t=>{announceContactsMessage(t==="tooLarge"?getContactsText$1("avatarTooLarge","Choose an image under 300 KB."):getContactsText$1("avatarReadError","Could not read the selected image."))}),userProfileAvatarInput.value="")}function refreshRowAvatarInitial(e){if(!e)return;const t=e.querySelector(".person-avatar-data");if(t&&t.value)return;const o=e.querySelector(".person-name"),r=e.querySelector(".person-avatar");updateAvatarVisual(r,"",o?o.value:"","person-avatar-initial")}function detachCrewRowContact(e,t={}){if(!e)return;const{preserveSelect:o=!1}=t||{};if(delete e.dataset.contactId,!o){const r=e.querySelector(".person-contact-select");r&&(r.value="")}updateRowLinkedBadge(e)}function updateRowLinkedBadge(e){if(!e)return;const t=e.querySelector(".person-linked-badge");if(!t)return;const o=e.dataset.contactId,r=e.dataset.userProfileLinked==="1";if(o){const n=getContactById$1(o),a=getContactsText$1("linkedBadge","Linked to contact");n&&n.name?t.textContent=`${a}: ${n.name} `:t.textContent=a,t.hidden=!1;return}if(r){t.textContent=getContactsText$1("linkedProfileBadge","Linked to user profile"),t.hidden=!1;return}t.textContent=getContactsText$1("linkedBadge","Linked to contact"),t.hidden=!0}function handleCrewRowManualChange(e,t=!1){if(typeof window<"u"&&window.cineSuppressAutosave||!e||e.dataset.syncingContact==="1")return;e.dataset.contactId&&(detachCrewRowContact(e),announceContactsMessage(getContactsText$1("contactDetached","Crew row disconnected from saved contact."))),refreshRowAvatarInitial(e),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),scheduleProjectAutoSave(t)}function handleAvatarFileSelection(e,t){localReadAvatarFile(t,o=>{setRowAvatar(e,o),e.dataset.contactId&&detachCrewRowContact(e),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),scheduleProjectAutoSave(!0),announceContactsMessage(getContactsText$1("avatarUpdated","Profile photo updated.")),isDialogOpen$1(avatarOptionsDialog)&&closeAvatarOptionsDialog()},o=>{announceContactsMessage(o==="tooLarge"?getContactsText$1("avatarTooLarge","Choose an image under 300 KB."):getContactsText$1("avatarReadError","Could not read the selected image."))})}function announceContactsMessage(e){resolveContactsDomRefs(),contactsAnnouncement&&(contactsAnnouncement.textContent=e||"")}function applyContactToCrewRow(e,t,o={}){if(!e||!t)return;const{skipDirty:r=!1,skipAnnouncement:n=!1}=o||{},a=getCrewRowSnapshot(e)||{},s=typeof localCreateCrewRowSync=="function"?localCreateCrewRowSync(a,t):{role:t.role||"",name:t.name||"",phone:t.phone||"",email:t.email||"",website:t.website||"",avatar:t.avatar||"",contactId:t.id||""};e.dataset.syncingContact="1";try{const l=e.querySelector('select[name="crewRole"]');if(l){if(s.role&&!Array.from(l.options).some(b=>b.value===s.role)){const b=document.createElement("option");b.value=s.role;const v=texts$1?.[currentLang$1]?.crewRoles||texts$1?.en?.crewRoles||{};b.textContent=v[s.role]||s.role,l.appendChild(b)}s.role&&(l.value=s.role)}const u=e.querySelector(".person-name");u&&(u.value=s.name||"");const d=e.querySelector(".person-phone");d&&(d.value=s.phone||"");const m=e.querySelector(".person-email");m&&(m.value=s.email||"");const y=e.querySelector(".person-website");y&&(y.value=s.website||""),setRowAvatar(e,s.avatar||"",{name:s.name}),e.dataset.contactId=s.contactId||t.id;const h=e.querySelector(".person-contact-select");h&&setContactSelectOptions(h,s.contactId||t.id)}finally{delete e.dataset.syncingContact}updateRowLinkedBadge(e),!r&&typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),r||scheduleProjectAutoSave(!0),n||announceContactsMessage(getContactsText$1("contactApplied","Crew row updated from contact."))}function updateCrewRowsForContact(e){if(!crewContainer$1||!e)return;crewContainer$1.querySelectorAll(".person-row").forEach(o=>{o.dataset.contactId===e.id&&applyContactToCrewRow(o,e,{skipAnnouncement:!0})})}function getCrewRowSnapshot(e){if(!e)return null;const t=e.querySelector('select[name="crewRole"]'),o=e.querySelector(".person-name"),r=e.querySelector(".person-phone"),n=e.querySelector(".person-email"),a=e.querySelector(".person-website"),s=e.querySelector(".person-avatar-data");return{role:sanitizeContactValue$2(t?.value||""),name:sanitizeContactValue$2(o?.value||""),phone:sanitizeContactValue$2(r?.value||""),email:sanitizeContactValue$2(n?.value||""),website:sanitizeContactValue$2(a?.value||""),avatar:sanitizeContactValue$2(s?.value||""),contactId:sanitizeContactValue$2(e.dataset.contactId||"")}}function deleteContact(e){if(!e)return;const t=contactsCache$1.findIndex(o=>o.id===e);t!==-1&&(contactsCache$1.splice(t,1),contactsCache$1=sortContacts$2(contactsCache$1),saveContactsToStorage$1(contactsCache$1),renderContactsList$1(),updateContactPickers$1(),crewContainer$1&&crewContainer$1.querySelectorAll(".person-row").forEach(r=>{r.dataset.contactId===e&&detachCrewRowContact(r)}),announceContactsMessage(getContactsText$1("contactDeleted","Contact removed. Project rows keep their details.")))}function saveCrewRowAsContact(e){const t=getCrewRowSnapshot(e);if(!t)return;if(!t.name&&!t.email&&!t.phone&&!t.website){announceContactsMessage(getContactsText$1("contactMissingDetails","Enter a name, email, phone number or website before saving this contact."));return}const o=Date.now();if(t.contactId){const n=getContactById$1(t.contactId);if(n){n.name=t.name||n.name,n.role=t.role||n.role,n.phone=t.phone||n.phone,n.email=t.email||n.email,n.website=t.website||n.website,t.avatar?n.avatar=t.avatar:n.avatar||delete n.avatar,n.updatedAt=o,contactsCache$1=sortContacts$2(contactsCache$1),saveContactsToStorage$1(contactsCache$1),renderContactsList$1({focusContactId:n.id}),updateContactPickers$1(),updateCrewRowsForContact(n),announceContactsMessage(getContactsText$1("contactUpdated","Contact updated."));return}}const r=normalizeContactEntry$2({id:t.contactId||generateContactId(),name:t.name,role:t.role,phone:t.phone,email:t.email,website:t.website,avatar:t.avatar,createdAt:o,updatedAt:o});contactsCache$1.push(r),contactsCache$1=sortContacts$2(contactsCache$1),saveContactsToStorage$1(contactsCache$1),renderContactsList$1({focusContactId:r.id}),updateContactPickers$1(),applyContactToCrewRow(e,r,{skipAnnouncement:!0}),announceContactsMessage(getContactsText$1("contactSaved","Contact saved for future projects."))}function parseVCard$1(e){return parseVCardEntries(e,{sanitize:sanitizeContactValue$2})}function mergeImportedContacts$1(e){if(!Array.isArray(e)||!e.length)return announceContactsMessage(getContactsText$1("importNone","No new contacts found in the file.")),{added:0,updated:0};const t=mergeImportedContactEntries({existing:contactsCache$1,imported:e,now:()=>Date.now(),generateContactId}),{contacts:o,added:r=0,updated:n=0}=t;if(contactsCache$1=Array.isArray(o)?o:contactsCache$1,saveContactsToStorage$1(contactsCache$1),renderContactsList$1(),updateContactPickers$1(),Array.isArray(o)&&o.forEach(a=>updateCrewRowsForContact(a)),r||n){const a=getContactsText$1("importSummary","{added} added, {updated} updated.");announceContactsMessage(a.replace("{added}",r).replace("{updated}",n))}else announceContactsMessage(getContactsText$1("importNone","No new contacts found in the file."));return{added:r,updated:n}}function createContactCard(e){const t=document.createElement("article");t.className="contact-card",t.setAttribute("role","listitem"),t.dataset.contactId=e.id;const o=document.createElement("div");o.className="contact-card-header";const r=document.createElement("div");r.className="contact-card-avatar";const n=document.createElement("div");n.className="contact-card-avatar-visual",r.appendChild(n),updateAvatarVisual(r,e.avatar||"",e.name,"contact-card-avatar-initial");const a=document.createElement("button");a.type="button";const s=getContactsText$1("avatarChange","Change photo");a.setAttribute("aria-label",s),a.removeAttribute("title"),a.removeAttribute("data-help"),a.innerHTML="",r.appendChild(a);const l=document.createElement("input");l.type="file",l.accept="image/*",l.className="visually-hidden",l.tabIndex=-1,r.appendChild(l),o.appendChild(r);const u=document.createElement("strong");u.textContent=e.name||getContactsText$1("contactFallbackName","Crew contact"),o.appendChild(u),t.appendChild(o);const d=document.createElement("div");d.className="contact-card-fields";const m=texts$1?.[currentLang$1]?.crewRoles||texts$1?.en?.crewRoles||{},y=document.createElement("input");y.type="text",y.value=e.name||"";const h=ensureElementId$1(y,`${e.id} -name`),b=document.createElement("label");b.setAttribute("for",h),b.textContent=getContactsText$1("nameLabel","Name");const v=document.createElement("div");v.className="contact-field",v.append(b,y),d.appendChild(v);const C=document.createElement("select"),A=ensureElementId$1(C,`${e.id} -role`),w=document.createElement("option");if(w.value="",w.textContent=getContactsText$1("rolePlaceholder","Select role"),C.appendChild(w),crewRoles$1.forEach(re=>{const de=document.createElement("option");de.value=re,de.textContent=m[re]||re,C.appendChild(de)}),e.role&&!crewRoles$1.includes(e.role)){const re=document.createElement("option");re.value=e.role,re.textContent=m[e.role]||e.role,C.appendChild(re)}C.value=e.role||"";const R=document.createElement("label");R.setAttribute("for",A),R.textContent=getContactsText$1("roleLabel","Crew role");const _=document.createElement("div");_.className="contact-field",_.append(R,C),d.appendChild(_);const G=document.createElement("input");G.type="tel",G.value=e.phone||"";const O=ensureElementId$1(G,`${e.id} -phone`),B=document.createElement("label");B.setAttribute("for",O),B.textContent=getContactsText$1("phoneLabel","Phone");const $=document.createElement("div");$.className="contact-field",$.append(B,G),d.appendChild($);const V=document.createElement("input");V.type="email",V.value=e.email||"";const M=ensureElementId$1(V,`${e.id} -email`),F=document.createElement("label");F.setAttribute("for",M),F.textContent=getContactsText$1("emailLabel","Email");const z=document.createElement("div");z.className="contact-field",z.append(F,V),d.appendChild(z);const x=document.createElement("input");x.type="url",x.inputMode="url",x.autocomplete="url",x.value=e.website||"",x.placeholder=getContactsText$1("websitePlaceholder","https://example.com");const H=ensureElementId$1(x,`${e.id} -website`),W=document.createElement("label");W.setAttribute("for",H),W.textContent=getContactsText$1("websiteLabel","Website");const U=document.createElement("div");U.className="contact-field",U.append(W,x),d.appendChild(U),t.appendChild(d);const j=document.createElement("div");j.className="contact-card-actions";const Y=document.createElement("button");Y.type="button",setButtonLabelWithIconBinding$1(Y,getContactsText$1("useInProject","Add to project crew"),ICON_GLYPHS.add),Y.addEventListener("click",()=>{createCrewRow$1({...e,contactId:e.id}),closeDialog$1(contactsDialog),announceContactsMessage(getContactsText$1("contactAddedToProject","Contact added to the current project."))}),j.appendChild(Y);const le=document.createElement("button");le.type="button",setButtonLabelWithIconBinding$1(le,getContactsText$1("deleteContact","Delete contact"),ICON_GLYPHS.trash),le.addEventListener("click",()=>{const re=getContactsText$1("deleteConfirm","Remove this contact? Project rows will keep their details."),de=()=>deleteContact(e.id);if(typeof window.cineShowConfirmDialog=="function"){window.cineShowConfirmDialog({title:getContactsText$1("deleteContact","Delete contact"),message:re,confirmLabel:getContactsText$1("deleteButton","Delete")||"Delete",cancelLabel:getContactsText$1("cancel","Cancel")||"Cancel",danger:!0,onConfirm:de});return}console.warn("Missing window.cineShowConfirmDialog for delete contact")}),j.appendChild(le),t.appendChild(j);const be=(re=!1)=>{e.updatedAt=Date.now(),saveContactsToStorage$1(contactsCache$1),updateContactPickers$1(),updateCrewRowsForContact(e),re&&(contactsCache$1=sortContacts$2(contactsCache$1),renderContactsList$1({focusContactId:e.id}))};return y.addEventListener("input",()=>{e.name=sanitizeContactValue$2(y.value),u.textContent=e.name||getContactsText$1("contactFallbackName","Crew contact"),updateAvatarVisual(r,e.avatar||"",e.name,"contact-card-avatar-initial"),be()}),y.addEventListener("blur",re=>{const de=re?.relatedTarget||(typeof document<"u"?document.activeElement:null);if(de&&de!==y&&t.contains(de)){be();return}be(!0)}),C.addEventListener("change",()=>{e.role=sanitizeContactValue$2(C.value),be()}),G.addEventListener("input",()=>{e.phone=sanitizeContactValue$2(G.value),be()}),V.addEventListener("input",()=>{e.email=sanitizeContactValue$2(V.value),be()}),x.addEventListener("input",()=>{e.website=sanitizeContactValue$2(x.value),be()}),a.addEventListener("click",()=>{if(!e.avatar&&l&&typeof l.click=="function")try{l.click();return}catch{}openAvatarOptionsDialog({getAvatar:()=>e.avatar||"",getName:()=>e.name||"",onDelete:()=>{e.avatar&&(e.avatar="",updateAvatarVisual(r,"",e.name,"contact-card-avatar-initial"),be(),announceContactsMessage(getContactsText$1("avatarCleared","Profile photo removed.")))},onChange:()=>{if(l&&typeof l.click=="function")try{l.click()}catch{}},onEditSave:re=>{re&&(e.avatar=re,updateAvatarVisual(r,re,e.name,"contact-card-avatar-initial"),be(),announceContactsMessage(getContactsText$1("avatarUpdated","Profile photo updated.")))}})}),l.addEventListener("change",()=>{const[re]=l.files||[];re&&(localReadAvatarFile(re,de=>{e.avatar=de,updateAvatarVisual(r,de,e.name,"contact-card-avatar-initial"),be(),announceContactsMessage(getContactsText$1("avatarUpdated","Profile photo updated.")),isDialogOpen$1(avatarOptionsDialog)&&closeAvatarOptionsDialog()},de=>{announceContactsMessage(de==="tooLarge"?getContactsText$1("avatarTooLarge","Choose an image under 300 KB."):getContactsText$1("avatarReadError","Could not read the selected image."))}),l.value="")}),{card:t,focusTarget:y}}function renderContactsList$1(e={}){if(resolveContactsDomRefs(),!contactsList)return;const{focusContactId:t=null}=e||{};for(;contactsList.firstChild;)contactsList.removeChild(contactsList.firstChild);if(!contactsCache$1.length){contactsEmptyState&&(contactsEmptyState.hidden=!1);return}contactsEmptyState&&(contactsEmptyState.hidden=!0);let o=null;contactsCache$1.forEach(r=>{const{card:n,focusTarget:a}=createContactCard(r);contactsList.appendChild(n),t&&r.id===t&&(o=a)}),o&&requestAnimationFrame(()=>o.focus())}function enableAvatarDragAndDrop(e,t){if(!e)return;const o=a=>{a.preventDefault(),a.stopPropagation(),e.classList.add("avatar-drag-over")},r=a=>{a.preventDefault(),a.stopPropagation(),e.classList.remove("avatar-drag-over")},n=a=>{a.preventDefault(),a.stopPropagation(),e.classList.remove("avatar-drag-over");const s=a.dataTransfer&&a.dataTransfer.files&&a.dataTransfer.files[0];s&&t(s)};e.addEventListener("dragenter",o),e.addEventListener("dragover",o),e.addEventListener("dragleave",r),e.addEventListener("drop",n)}function initializeContactsModule(){console.log("initializeContactsModule called"),resolveContactsDomRefs(),!(contactsInitialized&&contactsList&&userProfileAvatarButton)&&(console.log("initializeContactsModule running (re-init or first run)"),contactsCache$1=loadStoredContacts(),loadUserProfileState(),populateUserProfileRoleSelect(),renderContactsList$1(),updateContactPickers$1(),applyUserProfileToDom(),console.log("userProfileAvatarButton found (first-run):",!!userProfileAvatarButton),userProfileNameInput&&(userProfileNameInput.addEventListener("input",handleUserProfileNameInput),userProfileNameInput.addEventListener("blur",handleUserProfileFieldBlur)),userProfileRoleInput&&(userProfileRoleInput.addEventListener("input",handleUserProfileRoleInput),userProfileRoleInput.addEventListener("change",handleUserProfileRoleInput),userProfileRoleInput.addEventListener("blur",handleUserProfileFieldBlur)),userProfilePhoneInput&&(userProfilePhoneInput.addEventListener("input",handleUserProfilePhoneInput),userProfilePhoneInput.addEventListener("blur",handleUserProfileFieldBlur)),userProfileEmailInput&&(userProfileEmailInput.addEventListener("input",handleUserProfileEmailInput),userProfileEmailInput.addEventListener("blur",handleUserProfileFieldBlur)),userProfileAvatarButton&&userProfileAvatarButton.addEventListener("click",handleUserProfileAvatarButtonClick),userProfileAvatarClearButton&&userProfileAvatarClearButton.addEventListener("click",handleUserProfileAvatarCleared),userProfileAvatarInput&&userProfileAvatarInput.addEventListener("change",handleUserProfileAvatarInputChange),userProfileAvatarContainer&&enableAvatarDragAndDrop(userProfileAvatarContainer,e=>{localReadAvatarFile(e,t=>{const o=getUserProfileSnapshot$2();assignUserProfileState({name:o.name||"",avatar:t}),persistUserProfileState(),announceContactsMessage(getContactsText$1("avatarUpdated","Profile photo updated.")),isDialogOpen$1(avatarOptionsDialog)&&closeAvatarOptionsDialog()},t=>{announceContactsMessage(t==="tooLarge"?getContactsText$1("avatarTooLarge","Choose an image under 300 KB."):getContactsText$1("avatarReadError","Could not read the selected image."))})}),contactsAddButton&&contactsAddButton.addEventListener("click",()=>{const e=normalizeContactEntry$2({id:generateContactId(),name:"",role:"",phone:"",email:"",avatar:"",createdAt:Date.now(),updatedAt:Date.now()});contactsCache$1.push(e),renderContactsList$1({focusContactId:e.id}),saveContactsToStorage$1(contactsCache$1),updateContactPickers$1(),announceContactsMessage(getContactsText$1("contactDraftCreated","New contact ready. Fill in the details."))}),contactsImportButton&&contactsImportInput&&(contactsImportButton.addEventListener("click",()=>contactsImportInput.click()),contactsImportInput.addEventListener("change",()=>{const[e]=contactsImportInput.files||[];e&&e.text().then(t=>mergeImportedContacts$1(parseVCard$1(t))).catch(()=>{announceContactsMessage(getContactsText$1("importError","Could not import the selected file."))}).finally(()=>{contactsImportInput.value=""})})),avatarOptionsCloseButton?.addEventListener("click",()=>closeAvatarOptionsDialog()),avatarOptionsForm?.addEventListener("submit",e=>e.preventDefault()),avatarOptionsDialog?.addEventListener("cancel",e=>{e.preventDefault(),closeAvatarOptionsDialog()}),avatarOptionsDialog?.addEventListener("close",handleAvatarOptionsDialogClosed),avatarOptionsDialog?.addEventListener("pointerdown",handleAvatarOptionsDialogPointerDown),avatarOptionsDialog?.addEventListener("pointerdown",handleAvatarOptionsDialogPointerDown),avatarEditViewport&&(avatarEditViewport.addEventListener("dragenter",handleAvatarDragOver),avatarEditViewport.addEventListener("dragover",handleAvatarDragOver),avatarEditViewport.addEventListener("dragleave",handleAvatarDragLeave),avatarEditViewport.addEventListener("drop",handleAvatarDrop),avatarEditViewport.addEventListener("click",()=>avatarUploadInput&&avatarUploadInput.click()),avatarEditViewport.addEventListener("pointerdown",handleAvatarEditPointerDown),avatarEditViewport.addEventListener("pointermove",handleAvatarEditPointerMove),avatarEditViewport.addEventListener("pointerup",handleAvatarEditPointerUp),avatarEditViewport.addEventListener("pointercancel",handleAvatarEditPointerCancel),avatarEditViewport.addEventListener("keydown",handleAvatarEditKeyDown)),avatarUploadInput?.addEventListener("change",handleAvatarUpload),avatarSaveButton?.addEventListener("click",handleAvatarSave),avatarCancelButton?.addEventListener("click",()=>closeAvatarOptionsDialog()),avatarEditZoomInput?.addEventListener("input",handleAvatarEditZoomInputChange),avatarEditZoomInput?.addEventListener("change",handleAvatarEditZoomInputChange),contactsCloseButton?.addEventListener("click",()=>closeDialog$1(contactsDialog)),contactsForm?.addEventListener("submit",e=>{e.preventDefault(),closeDialog$1(contactsDialog)}),contactsDialog?.addEventListener("cancel",e=>{e.preventDefault(),closeDialog$1(contactsDialog)}),contactsDialog?.addEventListener("click",e=>{e.target===contactsDialog&&closeDialog$1(contactsDialog)}),openContactsBtn?.addEventListener("click",e=>{e.preventDefault(),openDialog$1(contactsDialog)}),contactsList&&userProfileAvatarButton&&(contactsInitialized=!0))}function createCrewRow$1(e={}){if(crewContainer$1||typeof document<"u"&&(crewContainer$1=document.getElementById("crewContainer")),!crewContainer$1)return;const t=document.createElement("div");t.className="person-row",e.userProfileLinked&&(t.dataset.userProfileLinked="1");let o="";typeof document<"u"&&document&&document.documentElement&&(o=document.documentElement.lang||"");const r=o||currentLang$1||DEFAULT_LANGUAGE_SAFE$1,n=localResolveDocumentDirection(r);localApplyLocaleMetadata(t,r,n);const a=typeof texts$1<"u"&&texts$1?.en?.projectForm||{},s=typeof texts$1<"u"&&texts$1?.[currentLang$1]?.projectForm||a,l=typeof texts$1<"u"&&(texts$1?.[currentLang$1]?.crewRoles||texts$1?.en?.crewRoles)||{},u=s.crewRoleLabel||a.crewRoleLabel||"Crew role",d=s.crewNameLabel||a.crewNameLabel||"Crew member name",m=s.crewPhoneLabel||a.crewPhoneLabel||"Crew member phone",y=s.crewEmailLabel||a.crewEmailLabel||"Crew member email",h=s.crewWebsiteLabel||a.crewWebsiteLabel||"Crew member website",b=getContactsText$1("selectLabel","Saved contacts"),v=getContactsText$1("avatarChange","Change photo"),C=document.createElement("input");C.type="hidden",C.className="person-avatar-data",C.value=typeof e.avatar=="string"?e.avatar:"",t.appendChild(C);const A=document.createElement("div");A.className="person-avatar";const w=document.createElement("div");w.className="person-avatar-visual",A.appendChild(w);const R=document.createElement("button");R.type="button",R.setAttribute("aria-label",v),R.removeAttribute("title"),R.removeAttribute("data-help"),R.innerHTML="",A.appendChild(R);const _=document.createElement("input");_.type="file",_.accept="image/*",_.className="visually-hidden",_.tabIndex=-1,A.appendChild(_),enableAvatarDragAndDrop(A,Ee=>{handleAvatarFileSelection(t,Ee)});const G=document.createElement("select");if(G.name="crewRole",G.className="person-role-select",localApplyLocaleMetadata(G,r,n),crewRoles$1.forEach(Ee=>{const Pe=document.createElement("option");Pe.value=Ee,Pe.textContent=l[Ee]||Ee,localApplyLocaleMetadata(Pe,r,n),G.appendChild(Pe)}),e.role&&!crewRoles$1.includes(e.role)){const Ee=document.createElement("option");Ee.value=e.role,Ee.textContent=l[e.role]||e.role,localApplyLocaleMetadata(Ee,r,n),G.appendChild(Ee)}e.role?G.value=e.role:G.options.length>0&&(G.selectedIndex=0);const O=document.createElement("input");O.type="text",O.name="crewName",O.className="person-name",O.placeholder=s.crewNamePlaceholder||a.crewNamePlaceholder||"Name",O.value=e.name||"",localApplyLocaleMetadata(O,r,n);const B=document.createElement("input");B.type="tel",B.name="crewPhone",B.className="person-phone",B.placeholder=s.crewPhonePlaceholder||a.crewPhonePlaceholder||"Phone",B.value=e.phone||"",localApplyLocaleMetadata(B,r,n);const $=document.createElement("input");$.type="email",$.name="crewEmail",$.className="person-email",$.placeholder=s.crewEmailPlaceholder||a.crewEmailPlaceholder||"Email",$.value=e.email||"",localApplyLocaleMetadata($,r,n);const V=document.createElement("input");V.type="text",V.inputMode="url",V.autocomplete="url",V.name="crewWebsite",V.className="person-website",V.placeholder=s.crewWebsitePlaceholder||a.crewWebsitePlaceholder||"Website",V.value=e.website||"",localApplyLocaleMetadata(V,r,n);const M=document.createElement("select");M.className="person-contact-select",localApplyLocaleMetadata(M,r,n),setContactSelectOptions(M,e.contactId);const F=createHiddenLabel$1(ensureElementId$1(G,u),u),z=createHiddenLabel$1(ensureElementId$1(O,d),d),x=createHiddenLabel$1(ensureElementId$1(B,m),m),H=createHiddenLabel$1(ensureElementId$1($,y),y),W=createHiddenLabel$1(ensureElementId$1(V,h),h),U=createHiddenLabel$1(ensureElementId$1(M,b),b),j=document.createElement("span");j.className="person-linked-badge",e.userProfileLinked?(j.textContent=getContactsText$1("linkedProfileBadge","Linked to user profile"),j.hidden=!1):(j.textContent=getContactsText$1("linkedBadge","Linked to contact"),j.hidden=!0);const Y=document.createElement("button");Y.type="button",Y.className="person-save-contact",setButtonLabelWithIconBinding$1(Y,getContactsText$1("saveContact","Save to contacts"),ICON_GLYPHS.save),Y.addEventListener("click",()=>saveCrewRowAsContact(t));const le=document.createElement("button");le.type="button",le.className="person-manage-contacts",setButtonLabelWithIconBinding$1(le,getContactsText$1("openManager","Open contacts"),ICON_GLYPHS.gears),le.addEventListener("click",()=>openDialog$1(contactsDialog));const be=document.createElement("button");be.type="button",be.className="person-remove-btn";const re=texts$1[currentLang$1]?.projectForm?.removeEntry||texts$1.en?.projectForm?.removeEntry||"Remove",de=texts$1[currentLang$1]?.projectForm?.crewHeading||texts$1.en?.projectForm?.crewHeading||"Crew",ne=`${re} ${de} `.trim();be.innerHTML=iconMarkup$1(ICON_GLYPHS.minus,"btn-icon"),be.setAttribute("aria-label",ne),be.setAttribute("title",ne),be.setAttribute("data-help",ne),be.addEventListener("click",()=>{t.remove(),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),scheduleProjectAutoSave()});const Ce=document.createElement("div");Ce.className="person-actions",Ce.append(Y,le,be),[F,z,x,H,W,U].forEach(Ee=>t.appendChild(Ee)),t.appendChild(A),t.appendChild(M),t.appendChild(j),t.appendChild(G),t.appendChild(O),t.appendChild(B),t.appendChild($),t.appendChild(V),t.appendChild(Ce),e.contactId&&(t.dataset.contactId=e.contactId),setRowAvatar(t,C.value,{name:e.name}),updateRowLinkedBadge(t),R.addEventListener("click",()=>{if(!C.value&&_&&typeof _.click=="function")try{_.click();return}catch{}openAvatarOptionsDialog({getAvatar:()=>C.value||"",getName:()=>O.value||"",onDelete:()=>{C.value&&(setRowAvatar(t,""),handleCrewRowManualChange(t),announceContactsMessage(getContactsText$1("avatarCleared","Profile photo removed.")))},onChange:()=>{if(_&&typeof _.click=="function")try{_.click()}catch{}},onEditSave:Ee=>{Ee&&(setRowAvatar(t,Ee,{name:O.value}),t.dataset.contactId&&detachCrewRowContact(t),handleCrewRowManualChange(t),announceContactsMessage(getContactsText$1("avatarUpdated","Profile photo updated.")))}})}),_.addEventListener("change",()=>{const[Ee]=_.files||[];Ee&&handleAvatarFileSelection(t,Ee),_.value=""}),G.addEventListener("change",()=>handleCrewRowManualChange(t,!1)),O.addEventListener("input",()=>{refreshRowAvatarInitial(t)}),M.addEventListener("change",()=>{const Ee=M.value;if(!Ee){detachCrewRowContact(t,{preserveSelect:!0}),handleCrewRowManualChange(t);return}const Pe=getContactById$1(Ee);Pe?applyContactToCrewRow(t,Pe):(announceContactsMessage(getContactsText$1("contactMissingDetails","Saved contact not available.")),detachCrewRowContact(t,{preserveSelect:!0}))}),crewContainer$1.appendChild(t),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty()}typeof window<"u"&&(window.createCrewRow=createCrewRow$1,window.createPrepRow=createPrepRow$1,window.createShootRow=createShootRow$1,window.createReturnRow=createReturnRow$1);function createPrepRow$1(e={}){if(!prepContainer$1)return;const t=document.createElement("div");t.className="period-row";const o=document.createElement("input");o.type="date",o.name="prepStart",o.className="prep-start",o.value=e.start||"",o.setAttribute("aria-labelledby","prepLabel");const r=document.createElement("span");r.textContent="to";const n=document.createElement("input");n.type="date",n.name="prepEnd",n.className="prep-end",n.value=e.end||"",n.setAttribute("aria-labelledby","prepLabel");const a=document.createElement("button");a.type="button";const s=texts$1[currentLang$1]?.projectForm?.removeEntry||texts$1.en?.projectForm?.removeEntry||"Remove",l=texts$1[currentLang$1]?.projectForm?.prepLabel||texts$1.en?.projectForm?.prepLabel||"Prep",u=`${s} ${l} `.trim();a.innerHTML=iconMarkup$1(ICON_GLYPHS.minus,"btn-icon"),a.setAttribute("aria-label",u),a.setAttribute("title",u),a.setAttribute("data-help",u),a.addEventListener("click",()=>{t.remove(),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),scheduleProjectAutoSave()}),t.append(o,r,n,a),prepContainer$1.appendChild(t),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty()}function createShootRow$1(e={}){if(!shootContainer$1)return;const t=document.createElement("div");t.className="period-row";const o=document.createElement("input");o.type="date",o.name="shootStart",o.className="shoot-start",o.value=e.start||"",o.setAttribute("aria-labelledby","shootLabel");const r=document.createElement("span");r.textContent="to";const n=document.createElement("input");n.type="date",n.name="shootEnd",n.className="shoot-end",n.value=e.end||"",n.setAttribute("aria-labelledby","shootLabel");const a=document.createElement("button");a.type="button";const s=texts$1[currentLang$1]?.projectForm?.removeEntry||texts$1.en?.projectForm?.removeEntry||"Remove",l=texts$1[currentLang$1]?.projectForm?.shootLabel||texts$1.en?.projectForm?.shootLabel||"Shoot",u=`${s} ${l} `.trim();a.innerHTML=iconMarkup$1(ICON_GLYPHS.minus,"btn-icon"),a.setAttribute("aria-label",u),a.setAttribute("title",u),a.setAttribute("data-help",u),a.addEventListener("click",()=>{t.remove(),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),scheduleProjectAutoSave()}),t.append(o,r,n,a),shootContainer$1.appendChild(t),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty()}function createReturnRow$1(e={}){if(!returnContainer$1)return;const t=document.createElement("div");t.className="period-row";const o=document.createElement("input");o.type="date",o.name="returnStart",o.className="return-start",o.value=e.start||"",o.setAttribute("aria-labelledby","returnLabel");const r=document.createElement("span");r.textContent="to";const n=document.createElement("input");n.type="date",n.name="returnEnd",n.className="return-end",n.value=e.end||"",n.setAttribute("aria-labelledby","returnLabel");const a=document.createElement("button");a.type="button";const s=texts$1[currentLang$1]?.projectForm?.removeEntry||texts$1.en?.projectForm?.removeEntry||"Remove",l=texts$1[currentLang$1]?.projectForm?.returnLabel||texts$1.en?.projectForm?.returnLabel||"Return Day",u=`${s} ${l} `.trim();a.innerHTML=iconMarkup$1(ICON_GLYPHS.minus,"btn-icon"),a.setAttribute("aria-label",u),a.setAttribute("title",u),a.setAttribute("data-help",u),a.addEventListener("click",()=>{t.remove(),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),scheduleProjectAutoSave()}),t.append(o,r,n,a),returnContainer$1.appendChild(t),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty()}function formatCapacity(e,t){const o=Number(e);return!Number.isFinite(o)||o<=0?"":`${Number.isInteger(o)?String(o):o.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:0})} ${t} `}function gatherMediaEntriesForType(e){const t=[];if(!e)return t;const o=devices$1?.cameras||{},r=typeof cameraSelect$2?.value=="string"?cameraSelect$2.value:"",n=a=>{!a||!Array.isArray(a.recordingMedia)||a.recordingMedia.forEach(s=>{s&&s.type===e&&t.push(s)})};return r&&o[r]&&n(o[r]),Object.keys(o).forEach(a=>{a!==r&&n(o[a])}),t}function getAvailableStorageMediaTypes(){const e=devices$1?.cameras||{},t=devices$1?.gearList?.media||{},o=[],r=new Set,n=u=>{if(!u||typeof u!="string")return;const d=u.trim();if(!d)return;const m=d.toLowerCase();r.has(m)||(r.add(m),o.push(d))},a=typeof cameraSelect$2?.value=="string"?cameraSelect$2.value:"";if(a&&e[a])return(e[a].recordingMedia||[]).forEach(d=>{d&&d.type&&n(d.type)}),o;const s=u=>{u&&(u.recordingMedia||[]).forEach(d=>{d&&d.type&&n(d.type)})};Object.values(e).forEach(u=>s(u));const l=u=>{Object.values(u).forEach(d=>{if(d)if(d.brand||d.model||d.type||d.capacityGB||d.capacity){d.type&&n(d.type);const m=typeof d.interface=="string"?d.interface.trim():"";m&&n(m),Array.isArray(d.supportedMedia)&&d.supportedMedia.forEach(y=>n(y))}else typeof d=="object"&&l(d)})};return l(t),o.sort(localeSort)}function getStorageVariantOptions(e){const t=[];if(!e)return t;const o=e.toLowerCase(),r=[],n=devices$1?.gearList?.media||{},a=d=>{Object.entries(d).forEach(([m,y])=>{y&&(y.brand||y.model||y.type||y.capacityGB||y.capacity?r.push({id:m,...y}):typeof y=="object"&&a(y))})};a(n);const s=new Set,l=(d,m)=>{if(!d||s.has(d))return;const y=(m||d).toLowerCase();y.includes("dual slots")||y.includes("slot 1")||y==="adapter"||y.includes("via adapter")||y==="red pro"||/\d/.test(y)&&(t.push({value:d,label:m||d}),s.add(d))};r.forEach(d=>{let m=!1;if(d.type&&(m=d.type.toLowerCase()===o),m||(m=[d.id,d.model,d.interface].some(w=>typeof w=="string"&&w.toLowerCase().includes(o))),!m)return;const y=[];d.brand&&y.push(d.brand);const h=d.model||"";h&&(!d.brand||h.toLowerCase()!==d.brand.toLowerCase())&&y.push(h);const b=Number(d.capacityGB||d.capacity),v=Number(d.capacityTb);let C="";Number.isFinite(b)&&b>0?b>=1e3?C=formatCapacity(b/1e3,"TB"):C=formatCapacity(b,"GB"):Number.isFinite(v)&&v>0&&(C=formatCapacity(v,"TB")),C&&y.push(C),l(d.id,y.length?y.join(" • "):d.id)});const u=new Set;return gatherMediaEntriesForType(e).forEach(d=>{const m=typeof d?.notes=="string"?d.notes:"";m&&m.split(/[,;/]/).forEach(y=>{const h=y.trim();h&&u.add(h)})}),u.forEach(d=>{const m=`${e} ${d} `.trim();l(m,d)}),t.length||l(e,e),t.sort((d,m)=>localeSort(d.label,m.label))}function updateStorageVariantOptions(e,t,o){if(!e)return;const r=getStorageVariantOptions(t),n=getProjectFormText("storageVariantPlaceholder","Select brand & size"),a=o!==void 0?o:e.value;e.innerHTML="";const s=document.createElement("option");if(s.value="",s.textContent=n,e.appendChild(s),r.forEach(l=>{const u=document.createElement("option");u.value=l.value,u.textContent=l.label,e.appendChild(u)}),a){if(!(e.options&&Array.from(e.options).some(u=>u.value===a))){const u=document.createElement("option");u.value=a,u.textContent=a,u.dataset.extraOption="true",e.appendChild(u)}e.value=a}else e.value=""}function updateStorageRequirementTypeOptions$1(){if(!storageNeedsContainer$1)return;const e=getAvailableStorageMediaTypes(),t=getProjectFormText("storageTypePlaceholder","Select media type");Array.from(storageNeedsContainer$1.querySelectorAll(".storage-row")).forEach(o=>{const r=o.querySelector(".storage-type"),n=o.querySelector(".storage-variant");if(!r)return;const a=r.value,s=n?n.value:"";r.innerHTML="";const l=document.createElement("option");if(l.value="",l.textContent=t,r.appendChild(l),e.forEach(u=>{const d=document.createElement("option");d.value=u,d.textContent=u,r.appendChild(d)}),a){if(!e.includes(a)){const d=document.createElement("option");d.value=a,d.textContent=a,d.dataset.extraOption="true",r.appendChild(d)}r.value=a}else r.value="";updateStorageVariantOptions(n,r.value,s)})}typeof window<"u"&&(window.getAvailableStorageMediaTypes=getAvailableStorageMediaTypes,window.getStorageVariantOptions=getStorageVariantOptions,window.updateStorageRequirementTypeOptions=updateStorageRequirementTypeOptions$1,window.createStorageRequirementRow=createStorageRequirementRow$1);function createStorageRequirementRow$1(e={}){if(!storageNeedsContainer$1)return null;const t=document.createElement("div");t.className="storage-row form-row";const o=document.createElement("input");o.type="number",o.min="1",o.step="1",o.name="storageQuantity",o.className="storage-quantity";const r=Number(e.quantity);Number.isFinite(r)&&r>0&&(o.value=r);const n=getProjectFormText("storageQuantityLabel","Quantity"),a=ensureElementId$1(o,n),s=document.createElement("label");s.className="form-row-label storage-quantity-label",s.setAttribute("for",a),s.textContent=n,s.dataset.storageLabelKey="storageQuantityLabel";const l=document.createElement("select");l.name="storageMediaType",l.className="storage-type",l.value=typeof e.type=="string"?e.type:"";const u=getProjectFormText("storageTypeLabel","Media type"),d=createHiddenLabel$1(ensureElementId$1(l,u),u);d.dataset.storageLabelKey="storageTypeLabel";const m=document.createElement("select");m.name="storageMediaVariant",m.className="storage-variant",m.value=typeof e.variant=="string"?e.variant:"";const y=getProjectFormText("storageVariantLabel","Brand & capacity"),h=createHiddenLabel$1(ensureElementId$1(m,y),y);h.dataset.storageLabelKey="storageVariantLabel";const b=document.createElement("input");b.type="text",b.name="storageMediaNotes",b.className="storage-notes",b.value=typeof e.notes=="string"?e.notes:"",b.placeholder=getProjectFormText("storageNotesPlaceholder","");const v=getProjectFormText("storageNotesLabel","Notes"),C=createHiddenLabel$1(ensureElementId$1(b,v),v);C.dataset.storageLabelKey="storageNotesLabel",l.addEventListener("change",()=>{updateStorageVariantOptions(m,l.value),scheduleProjectAutoSave()});const A=document.createElement("button");A.type="button";const w=getProjectFormText("removeEntry","Remove"),R=getProjectFormText("storageNeedsLabel","Recording media needs"),_=`${w} ${R} `.trim();A.innerHTML=iconMarkup$1(ICON_GLYPHS.minus,"btn-icon"),A.setAttribute("aria-label",_),A.setAttribute("title",_),A.setAttribute("data-help",_),A.dataset.storageActionKey="storageRemoveEntry",A.addEventListener("click",()=>{t.remove(),storageNeedsContainer$1.querySelector(".storage-row")?updateStorageRequirementTypeOptions$1():createStorageRequirementRow$1(),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),scheduleProjectAutoSave()});const G=document.createElement("button");G.type="button",G.className="storage-duplicate-btn",G.innerHTML=iconMarkup$1(ICON_GLYPHS.add,"btn-icon"),G.dataset.storageActionKey="storageDuplicateEntry";const O=getProjectFormText("storageDuplicateEntry","Duplicate media row");G.setAttribute("aria-label",O),G.setAttribute("title",O),G.setAttribute("data-help",O),G.addEventListener("click",()=>{const $={quantity:o?o.value:"",type:l?l.value:"",variant:m?m.value:"",notes:b?b.value:""},V=createStorageRequirementRow$1($);if(V&&typeof storageNeedsContainer$1?.insertBefore=="function"){storageNeedsContainer$1.insertBefore(V,t.nextSibling);const M=V.querySelector(".storage-quantity");M&&(M.focus(),typeof M.select=="function"&&M.select())}scheduleProjectAutoSave()});const B=document.createElement("div");return B.className="storage-row-actions",B.append(G,A),t.append(s,o,d,l,h,m,C,b,B),storageNeedsContainer$1.appendChild(t),updateStorageRequirementTypeOptions$1(),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),t}function updateRequiredScenariosTranslations(e){const t=document.getElementById("requiredScenarios");if(!t)return;const r=(texts$1[e]||{}).scenarios||{},n=texts$1.en&&texts$1.en.scenarios?texts$1.en.scenarios:{};t.options&&Array.from(t.options).forEach(a=>{const s=a.value,l=r[s]||n[s]||a.value;a.textContent=l})}function updateStorageRequirementTranslations(e,t){const o=e.storageHeading||t.storageHeading||"Storage & Media";storageHeading&&(storageHeading.textContent=o);const r=e.storageNeedsLabel||t.storageNeedsLabel||"Recording media needs:";storageNeedsLabel&&(storageNeedsLabel.textContent=r);const n=y=>{const h=e[y]||t[y];h&&document.querySelectorAll(`#storageNeedsContainer [data-storage-label-key="${y}"]`).forEach(b=>{b.textContent=h})};["storageQuantityLabel","storageTypeLabel","storageVariantLabel","storageNotesLabel"].forEach(n);const a=e.storageTypePlaceholder||t.storageTypePlaceholder||"Select media type",s=e.storageVariantPlaceholder||t.storageVariantPlaceholder||"Select brand & size",l=e.storageNotesPlaceholder||t.storageNotesPlaceholder||"",u=e.storageDuplicateEntry||t.storageDuplicateEntry||"Duplicate media row",d=e.removeEntry||t.removeEntry||"Remove";document.querySelectorAll("#storageNeedsContainer .storage-type").forEach(y=>{if(!y.options)return;const h=y.options[0];h&&(h.textContent=a)}),document.querySelectorAll("#storageNeedsContainer .storage-variant").forEach(y=>{if(!y.options)return;const h=y.options[0];h&&(h.textContent=s)}),document.querySelectorAll("#storageNeedsContainer .storage-notes").forEach(y=>{y.placeholder=l}),document.querySelectorAll('#storageNeedsContainer [data-storage-action-key="storageDuplicateEntry"]').forEach(y=>{y.setAttribute("aria-label",u),y.setAttribute("title",u),y.setAttribute("data-help",u)});const m=`${d} ${r} `.trim();document.querySelectorAll('#storageNeedsContainer [data-storage-action-key="storageRemoveEntry"]').forEach(y=>{y.setAttribute("aria-label",m),y.setAttribute("title",m),y.setAttribute("data-help",m)})}addPersonBtn&&addPersonBtn.addEventListener("click",()=>{createCrewRow$1()});addPrepBtn&&addPrepBtn.addEventListener("click",()=>createPrepRow$1());addShootBtn&&addShootBtn.addEventListener("click",()=>createShootRow$1());addReturnBtn&&addReturnBtn.addEventListener("click",()=>createReturnRow$1());function updateTripodOptions(){const e=tripodHeadBrandSelect$1?tripodHeadBrandSelect$1.value:"",t=tripodBowlSelect$1?tripodBowlSelect$1.value:"",o=tripodHeadBrandSelect$1&&tripodHeadBrandSelect$1.options?Array.from(tripodHeadBrandSelect$1.options):[],r=tripodBowlSelect$1&&tripodBowlSelect$1.options?Array.from(tripodBowlSelect$1.options):[];if(o.forEach(n=>{n.hidden=!1}),r.forEach(n=>{n.hidden=!1}),e==="OConnor"){const n=r.find(a=>a.value==="75mm bowl");n&&(n.hidden=!0),tripodBowlSelect$1.value==="75mm bowl"&&(tripodBowlSelect$1.value="")}if(e==="Sachtler"){const n=r.find(a=>a.value==="Mitchell Mount");n&&(n.hidden=!0),tripodBowlSelect$1.value==="Mitchell Mount"&&(tripodBowlSelect$1.value="")}if(t==="75mm bowl"){const n=o.find(a=>a.value==="OConnor");n&&(n.hidden=!0),tripodHeadBrandSelect$1.value==="OConnor"&&(tripodHeadBrandSelect$1.value="")}if(t==="Mitchell Mount"){const n=o.find(a=>a.value==="Sachtler");n&&(n.hidden=!0),tripodHeadBrandSelect$1.value==="Sachtler"&&(tripodHeadBrandSelect$1.value="")}}typeof window<"u"&&(window.updateTripodOptions=updateTripodOptions);document.getElementById("totalPower")||document.getElementById("heroTotalDraw");document.getElementById("totalCurrent144")||document.getElementById("heroCurrent144");document.getElementById("totalCurrent12")||document.getElementById("heroCurrent12");document.getElementById("batteryLife")||document.getElementById("heroRuntime");var batteryLifeLabelElem$1=document.getElementById("batteryLifeLabel"),runtimeAverageNoteElem$1=document.getElementById("runtimeAverageNote");document.getElementById("batteryCount")||document.getElementById("heroBatteryCount");var pinWarnElem$1=document.getElementById("pinWarning"),dtapWarnElem$1=document.getElementById("dtapWarning"),hotswapWarnElem$1=document.getElementById("hotswapWarning"),powerWarningDialog=document.getElementById("powerWarningDialog"),powerWarningTitleElem=document.getElementById("powerWarningTitle");document.getElementById("powerWarningMessage");var powerWarningLimitsHeadingElem=document.getElementById("powerWarningLimitsHeading");document.getElementById("powerWarningPinsDetail");document.getElementById("powerWarningDtapDetail");var powerWarningAdviceElem=document.getElementById("powerWarningAdvice"),powerWarningCloseBtn=document.getElementById("powerWarningCloseBtn"),heroCard=document.getElementById("heroCard"),heroTotalDraw=document.getElementById("heroTotalDraw"),heroAvailablePower=document.getElementById("heroAvailablePower"),heroBatteryLabel=document.getElementById("heroBatteryLabel");document.getElementById("heroRuntime");document.getElementById("heroCurrent144");document.getElementById("heroCurrent12");document.getElementById("heroBatteryCount");var powerDiagramElem=document.getElementById("powerDiagram"),powerDiagramBarElem=document.getElementById("powerDiagramBar"),maxPowerTextElem=document.getElementById("maxPowerText"),powerDiagramLegendElem=document.getElementById("powerDiagramLegend");function updatePowerSummary(){}function closePowerWarningDialog$1(e={}){powerWarningDialog&&(isDialogOpen$1(powerWarningDialog)?closeDialog$1(powerWarningDialog):powerWarningDialog.removeAttribute&&powerWarningDialog.removeAttribute("open"),e.keepDismissed)}function dismissPowerWarningDialog(){powerWarningDialog&&closePowerWarningDialog$1({keepDismissed:!0})}powerWarningCloseBtn&&powerWarningCloseBtn.addEventListener("click",dismissPowerWarningDialog);powerWarningDialog&&powerWarningDialog.addEventListener("cancel",e=>{e.preventDefault(),dismissPowerWarningDialog()});function drawPowerDiagram$1(e,t,o){const r=(t||[]).reduce((a,s)=>a+s.power,0);if(heroTotalDraw&&(heroTotalDraw.textContent=`${r.toFixed(0)} W`),!heroCard)return;if(!e||e<=0){heroCard.classList.add("hidden"),powerDiagramElem&&powerDiagramElem.classList.add("hidden"),powerDiagramBarElem&&(powerDiagramBarElem.innerHTML=""),powerDiagramLegendElem&&(powerDiagramLegendElem.innerHTML=""),maxPowerTextElem&&(maxPowerTextElem.textContent="",setStatusLevel$1(maxPowerTextElem));return}heroCard.classList.remove("hidden"),powerDiagramElem&&powerDiagramElem.classList.remove("hidden"),powerDiagramBarElem&&(powerDiagramBarElem.innerHTML=""),powerDiagramLegendElem&&(powerDiagramLegendElem.innerHTML="");const n=r/e;if(heroTotalDraw&&(heroTotalDraw.classList.remove("glow-safe","glow-warning","glow-danger"),n>1?heroTotalDraw.classList.add("glow-danger"):n>=.8?heroTotalDraw.classList.add("glow-warning"):heroTotalDraw.classList.add("glow-safe")),heroAvailablePower&&(heroAvailablePower.textContent=`${e.toFixed(0)} W`),heroBatteryLabel&&batterySelect$1&&batterySelect$1.options){const a=batterySelect$1.options[batterySelect$1.selectedIndex],s=a?a.text:"";heroBatteryLabel.textContent=`Camera Setup draws ${r.toFixed(0)}W from the ${e.toFixed(0)}W available on the ${s} `}if(powerDiagramBarElem&&powerDiagramLegendElem){const a=100/Math.max(e,r),s=e*a,l=document.createElement("div");if(l.className="power-bar-inner",powerDiagramBarElem.appendChild(l),t.forEach(d=>{const m=d.power*a;if(m<=0)return;const y=document.createElement("div");y.className=`segment ${d.className} `,y.style.width=`${m}% `,y.setAttribute("title",`${d.label} ${d.power.toFixed(1)} W`),l.appendChild(y);const h=document.createElement("span"),b=document.createElement("span");b.className=`swatch ${d.className} `,h.appendChild(b),h.appendChild(document.createTextNode(d.label.replace(/:$/,""))),powerDiagramLegendElem.appendChild(h)}),r>e){const d=document.createElement("div");d.className="over-usage",d.style.left=`${s}% `,d.style.right="0",l.appendChild(d)}const u=document.createElement("div");if(u.className="limit-line",u.style.left=`${s}% `,typeof o=="number"&&o>0){const d=document.createElement("span");d.className="limit-label",d.textContent=`${texts$1[currentLang$1].pinLabel} ${o} A`,u.appendChild(d)}powerDiagramBarElem.appendChild(u),powerDiagramElem&&powerDiagramElem.classList.toggle("over",r>e)}maxPowerTextElem&&(maxPowerTextElem.textContent="")}var setupSelect$2=document.getElementById("setupSelect"),setupNameInput$2=document.getElementById("setupName"),saveSetupBtn$1=document.getElementById("saveSetupBtn"),deleteSetupBtn=document.getElementById("deleteSetupBtn"),shareSetupBtn$1=document.getElementById("shareSetupBtn");document.getElementById("sharedLinkRow");var sharedLinkInput=document.getElementById("sharedLinkInput");document.getElementById("shareLinkMessage");document.getElementById("shareDialog");document.getElementById("shareForm");const shareDialogHeadingElem=document.getElementById("shareDialogHeading");var shareFilenameInput=document.getElementById("shareFilename");const shareFilenameLabelElem=document.getElementById("shareFilenameLabel");var shareFilenameMessage=document.getElementById("shareFilenameMessage"),shareCancelBtn=document.getElementById("shareCancelBtn");const shareConfirmBtn=document.getElementById("shareConfirmBtn"),shareIncludeAutoGearText=document.getElementById("shareIncludeAutoGearText");var shareIncludeAutoGearLabelElem=document.getElementById("shareIncludeAutoGearLabel");const shareIncludeOwnedGearText=document.getElementById("shareIncludeOwnedGearText");var shareIncludeOwnedGearLabelElem=document.getElementById("shareIncludeOwnedGearLabel"),shareIncludeAutoGearCheckbox=document.getElementById("shareIncludeAutoGear"),shareIncludeOwnedGearCheckbox=document.getElementById("shareIncludeOwnedGear");shareFilenameInput&&shareFilenameMessage&&shareFilenameInput.setAttribute("aria-describedby","shareFilenameMessage");var sharedImportDialog=document.getElementById("sharedImportDialog");document.getElementById("sharedImportForm");const sharedImportDialogHeading=document.getElementById("sharedImportDialogHeading"),sharedImportDialogMessage=document.getElementById("sharedImportDialogMessage"),sharedImportMetadata=document.getElementById("sharedImportMetadata"),sharedImportOptions=document.getElementById("sharedImportOptions"),sharedImportLegend=document.getElementById("sharedImportLegend");var sharedImportModeSelect=document.getElementById("sharedImportModeSelect");const sharedImportModeNoneOption=document.getElementById("sharedImportModeNoneOption"),sharedImportModeProjectOption=document.getElementById("sharedImportModeProjectOption"),sharedImportModeGlobalOption=document.getElementById("sharedImportModeGlobalOption"),sharedImportConfirmBtn=document.getElementById("sharedImportConfirmBtn");var sharedImportCancelBtn=document.getElementById("sharedImportCancelBtn");sharedImportModeSelect&&Array.from(sharedImportModeSelect.options||[]).forEach(e=>{e.value!=="none"&&(e.disabled=!0)});var pendingSharedLinkListener$1=null;setupSelect$2&&setupSelect$2.value;var applySharedLinkBtn=document.getElementById("applySharedLinkBtn");const sharedKeyMap={setupName:"s",camera:"c",monitor:"m",video:"v",cage:"g",motors:"o",controllers:"r",distance:"d",batteryPlate:"p",battery:"b",batteryHotswap:"h",powerSelection:"w",projectInfo:"i",projectHtml:"q",gearSelectors:"e",gearList:"l",ownedGearMarkers:"u",changedDevices:"x",feedback:"f",autoGearRules:"a",autoGearCoverage:"z",diagramPositions:"y",metadata:"t",contacts:"n"},sharedKeyMapKeys=Object.keys(sharedKeyMap),sharedHasOwn=Object.prototype.hasOwnProperty;function formatSharedImportMetadataSummary(e){return""}function updateSharedImportMetadataSummary(e){if(!sharedImportMetadata)return;const t=formatSharedImportMetadataSummary();t?(sharedImportMetadata.textContent=t,sharedImportMetadata.classList.remove("hidden")):(sharedImportMetadata.textContent="",sharedImportMetadata.classList.add("hidden"))}function clearStoredSharedImportData$1(){updateSharedImportMetadataSummary()}function resetSharedImportStateForFactoryReset$1(){clearStoredSharedImportData$1(),sharedImportDialog&&closeDialog$1(sharedImportDialog),typeof configureSharedImportOptions$1=="function"&&configureSharedImportOptions$1([]),sharedLinkInput&&(pendingSharedLinkListener$1&&typeof sharedLinkInput.removeEventListener=="function"&&sharedLinkInput.removeEventListener("change",pendingSharedLinkListener$1),sharedLinkInput.value=""),pendingSharedLinkListener$1=null}function configureSharedImportOptions$1(e){if(!sharedImportModeSelect)return Array.isArray(e)&&e.length>0;const t=Array.isArray(e)&&e.length>0;return Array.from(sharedImportModeSelect.options||[]).forEach(r=>{r.value==="none"?(r.disabled=!1,r.selected=!t):(r.disabled=!t,r.selected=t&&r.value==="project")}),t}function encodeSharedSetup$1(e){if(!e||typeof e!="object")return{};const t={};for(let o=0;o<sharedKeyMapKeys.length;o+=1){const r=sharedKeyMapKeys[o];if(r==="gearList"||r==="projectHtml")continue;const n=e[r];n!=null&&(t[sharedKeyMap[r]]=n)}return t}function decodeSharedSetup$1(e){if(!e||typeof e!="object")return{};let t=!1,o=!1;const r=[];for(let a=0;a<sharedKeyMapKeys.length;a+=1){const s=sharedKeyMapKeys[a],l=sharedKeyMap[s],u=sharedHasOwn.call(e,s),d=sharedHasOwn.call(e,l);u&&(t=!0),d&&(o=!0,!u&&e[l]!=null&&r.push(s))}if(!t&&!o)return{};if(!t){const a={};for(let s=0;s<sharedKeyMapKeys.length;s+=1){const l=sharedKeyMapKeys[s],u=sharedKeyMap[l],d=e[u];d!=null&&(a[l]=d)}return a}if(!r.length)return e;const n={...e};for(let a=0;a<r.length;a+=1){const s=r[a];if(!sharedHasOwn.call(n,s)){const l=sharedKeyMap[s],u=e[l];u!=null&&(n[s]=u)}}return n}var deviceManagerSection$1=typeof deviceManagerSection$1<"u"&&deviceManagerSection$1?deviceManagerSection$1:typeof document<"u"&&typeof document.getElementById=="function"?document.getElementById("device-manager"):null,toggleDeviceBtn$1=typeof toggleDeviceBtn$1<"u"&&toggleDeviceBtn$1?toggleDeviceBtn$1:typeof document<"u"&&typeof document.getElementById=="function"?document.getElementById("toggleDeviceManager"):null,deviceListContainerRef=null;function resolveDeviceListContainer(){const e=document.getElementById("deviceListContainer");return e?(deviceListContainerRef=e,e):deviceListContainerRef}const deviceManagerLists=(()=>{const e=typeof CORE_GLOBAL_SCOPE$3<"u"&&CORE_GLOBAL_SCOPE$3?CORE_GLOBAL_SCOPE$3:typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null;if(e&&e.deviceManagerLists&&e.deviceManagerLists instanceof Map)return e.deviceManagerLists;const t=new Map;if(e&&typeof e=="object")try{e.deviceManagerLists=t}catch{e.deviceManagerLists=t}return t})();var filterHelperScope=typeof CORE_GLOBAL_SCOPE$3<"u"&&CORE_GLOBAL_SCOPE$3?CORE_GLOBAL_SCOPE$3:typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null;function fallbackFilterSelect(e,t){if(!e||typeof e!="object")return;const o=(t||"").toLowerCase();Array.from(e.options||[]).forEach(r=>{if(!r||typeof r!="object")return;const n=r.value==="None"||o===""||(r.textContent||"").toLowerCase().includes(o);r.hidden=!n,r.disabled=!n})}function fallbackFilterDeviceList(e,t){if(!e||typeof e!="object")return;const o=(t||"").toLowerCase();Array.from(e.querySelectorAll?e.querySelectorAll("li"):[]).forEach(r=>{if(!r||typeof r!="object")return;const n=r.querySelector?r.querySelector(".device-summary span"):null,a=n&&typeof n.textContent=="string"?n.textContent.toLowerCase():"";r.style.display=o===""||a.includes(o)?"":"none"})}function fallbackAddInputClearButton(e,t){if(!e||typeof e!="object"||typeof e.insertAdjacentElement!="function")return;const o=typeof texts$1=="object"&&texts$1||typeof window<"u"&&typeof window.texts=="object"&&window.texts||null,r=o&&o[currentLang$1]&&o[currentLang$1].clearFilter||"Clear filter",n=document.createElement("button");n.type="button",n.className="clear-input-btn",n.innerHTML=iconMarkup$1(ICON_GLYPHS.circleX,"clear-icon"),n.setAttribute("aria-label",r),n.title=r,n.hidden=!0,n.addEventListener("click",()=>{e.value="",typeof t=="function"&&t(),typeof e.focus=="function"&&e.focus()}),e.insertAdjacentElement("afterend",n);const a=()=>{n.hidden=!e.value};e.addEventListener("input",a),a()}function fallbackBindFilterInput(e,t){if(!e||typeof e!="object")return;const o=typeof t=="function"?t:()=>{};e.addEventListener("input",o),e.addEventListener("keydown",r=>{r&&r.key==="Escape"&&(e.value="",o())}),fallbackAddInputClearButton(e,o)}function ensureFilterHelpers(){const e=filterHelperScope&&typeof filterHelperScope=="object"?filterHelperScope:{},t=(o,r)=>{if(typeof e[o]!="function")try{e[o]=r}catch{try{Object.defineProperty(e,o,{configurable:!0,writable:!0,value:r})}catch{}}};return t("filterSelect",fallbackFilterSelect),t("filterDeviceList",fallbackFilterDeviceList),t("bindFilterInput",fallbackBindFilterInput),t("addInputClearButton",fallbackAddInputClearButton),e}ensureFilterHelpers();function applyFilters$1(){const e=ensureFilterHelpers(),t=typeof e.filterDeviceList=="function"?e.filterDeviceList:fallbackFilterDeviceList;deviceManagerLists instanceof Map&&deviceManagerLists.forEach(o=>{if(!o||typeof o!="object")return;const{list:r,filterInput:n}=o;if(!r||typeof r!="object")return;const a=n&&typeof n.value=="string"?n.value:"";try{t(r,a)}catch(s){console.warn("Failed to apply device manager filters",s)}})}const DEVICE_MANAGER_DEFAULT_ORDER=Object.freeze(["cameras","viewfinders","monitors","video","wirelessReceivers","directorMonitors","iosVideo","lenses","fiz.motors","fiz.controllers","fiz.handUnits","fiz.distance","batteries","batteryHotswaps","accessories.batteries","accessories.powerPlates","accessories.cables","accessories.cages","accessories.cameraSupport","accessories.cameraStabiliser","accessories.chargers","accessories.videoAssist","accessories.media","accessories.cardReaders","accessories.filters","accessories.matteboxes","accessories.rigging","accessories.grip","accessories.sliders","accessories.tripodHeads","accessories.tripods","accessories.carts"]);function getDeviceManagerPreferredOrder(){const e=filterHelperScope,t=e&&Array.isArray(e.deviceManagerPreferredOrder)?e.deviceManagerPreferredOrder:null;return t&&t.every(o=>typeof o=="string"&&o)?t:DEVICE_MANAGER_DEFAULT_ORDER}function normalizeCategoryKey(e){return!e||e==="accessories"||e==="fiz"||e==="filterOptions"?null:e.startsWith("accessories.cables.")?"accessories.cables":e==="videoAssist"&&devices$1?.accessories?.videoAssist?"accessories.videoAssist":e==="media"&&devices$1?.accessories?.media?"accessories.media":e==="cardReaders"&&devices$1?.accessories?.cardReaders?"accessories.cardReaders":e}function getCategoryLabel(e,t=currentLang$1){if(!e)return"";const o=typeof categoryNames=="object"&&categoryNames&&categoryNames[t]||{};if(o[e])return o[e];const r=typeof categoryNames=="object"&&categoryNames&&categoryNames.en||{};return r[e]?r[e]:e==="batteries"||e==="accessories.batteries"?t==="en"?"Battery":t==="de"?"Akku":"Battery":e.split(".").map(a=>humanizeKey$1(a)).join(" ")}function collectDeviceManagerCategories(){const e=new Set,t=l=>{const u=normalizeCategoryKey(l);u&&e.add(u)},o=(l,u=[])=>{if(!(u.length>20)&&!(!l||typeof l!="object")){if(Array.isArray(l.attributes)){const d=u.length,m=u[0];(d===1||d>1&&(m==="accessories"||m==="fiz"))&&t(u.join("."))}Object.entries(l).forEach(([d,m])=>{d!=="attributes"&&m&&typeof m=="object"&&o(m,u.concat(d))})}};deviceSchema$1&&o(deviceSchema$1,[]),(l=>{!l||typeof l!="object"||Array.isArray(l)||Object.entries(l).forEach(([u,d])=>{u==="accessories"?d&&typeof d=="object"&&Object.entries(d).forEach(([m,y])=>{y&&typeof y=="object"&&!Array.isArray(y)&&t(`accessories.${m} `)}):u==="fiz"?d&&typeof d=="object"&&Object.entries(d).forEach(([m,y])=>{y&&typeof y=="object"&&!Array.isArray(y)&&t(`fiz.${m} `)}):d&&typeof d=="object"&&!Array.isArray(d)&&t(u)})})(devices$1);const n=Array.from(e),a=getDeviceManagerPreferredOrder(),s=new Map(a.map((l,u)=>[l,u]));return n.sort((l,u)=>{const d=s.has(l)?s.get(l):a.length,m=s.has(u)?s.get(u):a.length;return d!==m?d-m:l.localeCompare(u)}),n}function createDeviceCategorySection(e){const t=resolveDeviceListContainer();if(!t||deviceManagerLists.has(e))return deviceManagerLists.get(e)||null;const o=document.createElement("div");o.className="device-category";const r=e.replace(/[^a-z0-9]+/gi,"_"),n=document.createElement("h4");n.id=`category_${r} `,n.dataset.categoryKey=e,o.appendChild(n);const a=document.createElement("input");a.type="search",a.className="list-filter",a.id=`${r} ListFilter`,a.dataset.categoryKey=e;const s=createHiddenLabel$1(ensureElementId$1(a,`${r} -list - filter`),`Filter ${e} `);o.appendChild(s),o.appendChild(a);const l=document.createElement("ul");l.className="device-ul";const u=r==="cameras"?"cameraList":`${r} List`;l.id=u,r==="cameras"&&l.setAttribute("data-current-id","camerasList"),o.appendChild(l),t.appendChild(o);const d=()=>typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null,m=()=>{const h=d(),b=h&&h.bindFilterInput,v=h&&h.filterDeviceList;return typeof b!="function"||typeof v!="function"?!1:(b(a,()=>v(l,a.value)),!0)};m()||enqueueCoreBootTask$2(()=>{m()});const y={section:o,heading:n,filterInput:a,filterLabel:s,list:l,sanitizedId:r};return deviceManagerLists.set(e,y),y}function updateDeviceManagerLocalization(e=currentLang$1){if(!deviceManagerLists.size)return;const t=texts$1[e]&&texts$1[e].placeholder_filter||"Filter {item}...",o=texts$1[e]&&texts$1[e].clearFilter||"Clear filter",r=document.getElementById("deviceLibrarySearch"),n=document.getElementById("deviceLibrarySearchLabel"),a=texts$1[e]&&texts$1[e].deviceLibrarySearchHelp||"Filter all categories and press Enter to jump to the best match.",s=texts$1[e]&&texts$1[e].deviceLibrarySearchPlaceholder||"Search all device categories…",l=texts$1[e]&&texts$1[e].deviceLibrarySearchLabel||"Search entire library";n&&(n.textContent=l),r&&(r.placeholder=s,r.setAttribute("aria-label",s),r.setAttribute("data-help",a),r.setAttribute("autocomplete","off"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false")),deviceManagerLists.forEach((d,m)=>{const y=getCategoryLabel(m,e);if(d.heading&&(d.heading.textContent=y),d.filterInput){const h=t.replace("{item}",y.toLowerCase());if(d.filterInput.placeholder=h,d.filterInput.setAttribute("aria-label",h),d.filterInput.setAttribute("autocomplete","off"),d.filterInput.setAttribute("autocorrect","off"),d.filterInput.setAttribute("autocapitalize","off"),d.filterInput.setAttribute("spellcheck","false"),d.filterInput.setAttribute("inputmode","search"),d.filterLabel){const v=h.replace(/\s*(?:\.{3}|\u2026)$/,"");d.filterLabel.textContent=v}const b=d.filterInput.nextElementSibling;b&&b.classList.contains("clear-input-btn")&&(b.setAttribute("aria-label",o),b.title=o)}});const u=filterHelperScope&&typeof filterHelperScope.updateDeviceLibrarySearchLocalization=="function"?filterHelperScope.updateDeviceLibrarySearchLocalization:null;u&&u()}function syncDeviceManagerCategories$1(){const e=resolveDeviceListContainer();if(!e)return;const t=collectDeviceManagerCategories(),o=new Set(t),r=Array.from(deviceManagerLists.keys());t.forEach(n=>{deviceManagerLists.has(n)||createDeviceCategorySection(n)}),r.forEach(n=>{if(!o.has(n)){const a=deviceManagerLists.get(n);a&&a.section&&a.section.parentNode&&a.section.parentNode.removeChild(a.section),deviceManagerLists.delete(n)}}),t.forEach(n=>{const a=deviceManagerLists.get(n);a&&a.section&&e.appendChild(a.section)}),updateDeviceManagerLocalization(currentLang$1)}exposeCoreRuntimeConstant$1("syncDeviceManagerCategories",syncDeviceManagerCategories$1);function getCurrentProjectName(){const e=(setupNameInput$2&&typeof setupNameInput$2.value=="string"?setupNameInput$2.value.trim():"")||"";return e||setupSelect$2&&setupSelect$2.value||""}exposeCoreRuntimeConstant$1("getCurrentProjectName",getCurrentProjectName);var newCategorySelect$1=document.getElementById("newCategory");document.getElementById("newSubcategory");document.getElementById("subcategoryField");var newNameInput$1=document.getElementById("newName"),newWattInput$1=document.getElementById("newWatt"),wattFieldDiv$1=document.getElementById("wattField");document.getElementById("dynamicFields");document.getElementById("cameraFields");document.getElementById("cameraWatt");var cameraVoltageInput$1=document.getElementById("cameraVoltage");document.getElementById("cameraPortType");document.getElementById("monitorFields");document.getElementById("monitorScreenSize");document.getElementById("monitorBrightness");document.getElementById("monitorWatt");var monitorVoltageInput$1=document.getElementById("monitorVoltage");document.getElementById("monitorPortType");document.getElementById("monitorVideoInputsContainer");document.getElementById("lensFields");document.getElementById("lensMountOptionsContainer");function populateCategoryOptions(){if(!newCategorySelect$1&&typeof document<"u"&&(newCategorySelect$1=document.getElementById("newCategory")),!newCategorySelect$1)return;newCategorySelect$1.options?newCategorySelect$1.options.length=0:newCategorySelect$1.innerHTML="";const e=t=>{const o=document.createElement("option");o.value=t,o.textContent=getCategoryLabel(t,currentLang$1),newCategorySelect$1.appendChild(o)};if(deviceSchema$1){const t=new Set;if(deviceSchema$1.accessories)for(const[r,n]of Object.entries(deviceSchema$1.accessories))r==="cables"?t.add("accessories.cables"):n&&n.attributes&&t.add(`accessories.${r} `);for(const[r,n]of Object.entries(deviceSchema$1))r==="accessories"||r==="fiz"||n&&n.attributes&&t.add(r);const o=Array.from(t).sort((r,n)=>{const a=getCategoryLabel(r,currentLang$1),s=getCategoryLabel(n,currentLang$1);return a.localeCompare(s,currentLang$1)});for(const r of o)e(r);if(deviceSchema$1.fiz)for(const[r,n]of Object.entries(deviceSchema$1.fiz))n&&n.attributes&&e(`fiz.${r} `);if(newCategorySelect$1&&typeof newCategorySelect$1.dispatchEvent=="function")try{newCategorySelect$1.dispatchEvent(new Event("change",{bubbles:!0}))}catch(r){console.warn("Failed to dispatch change event in populateCategoryOptions",r)}}if(typeof devices$1=="object"){const t=new Set(newCategorySelect$1.options?Array.from(newCategorySelect$1.options).map(r=>r.value):[]),o=r=>{t.has(r)||(e(r),t.add(r))};for(const[r,n]of Object.entries(devices$1))if(r==="accessories")for(const a of Object.keys(n||{}))o(`accessories.${a} `);else if(r==="fiz")for(const a of Object.keys(n||{}))o(`fiz.${a} `);else n&&typeof n=="object"&&!Array.isArray(n)&&o(r)}}populateCategoryOptions();document.getElementById("monitorVideoOutputsContainer");document.getElementById("monitorWirelessTx");var monitorLatencyInput$1=document.getElementById("monitorLatency");document.getElementById("monitorAudioOutput");document.getElementById("viewfinderFields");document.getElementById("viewfinderScreenSize");document.getElementById("viewfinderBrightness");document.getElementById("viewfinderWatt");document.getElementById("viewfinderVoltage");document.getElementById("viewfinderPortType");document.getElementById("viewfinderVideoInputsContainer");document.getElementById("viewfinderVideoOutputsContainer");document.getElementById("viewfinderWirelessTx");var viewfinderLatencyInput$1=document.getElementById("viewfinderLatency");document.getElementById("videoFields");document.getElementById("videoPowerInputsContainer");document.getElementById("videoVideoInputsContainer");document.getElementById("videoVideoOutputsContainer");document.getElementById("videoFrequency");document.getElementById("videoLatency");function resolveFeedbackTemperatureBounds(){return{min:typeof FEEDBACK_TEMPERATURE_MIN_VALUE=="number"?FEEDBACK_TEMPERATURE_MIN_VALUE:typeof FEEDBACK_TEMPERATURE_MIN=="number"?FEEDBACK_TEMPERATURE_MIN:-20,max:typeof FEEDBACK_TEMPERATURE_MAX_VALUE=="number"?FEEDBACK_TEMPERATURE_MAX_VALUE:typeof FEEDBACK_TEMPERATURE_MAX_LIMIT=="number"?FEEDBACK_TEMPERATURE_MAX_LIMIT:50}}function ensureFeedbackTemperatureOptions$1(e){if(!e)return;const{min:t,max:o}=resolveFeedbackTemperatureBounds(),r=o-t+2,n=e.getAttribute("data-temp-min"),a=e.getAttribute("data-temp-max");if(e.options.length===r&&n===String(t)&&a===String(o))return;const s=e.value;e.innerHTML="";const l=document.createElement("option");l.value="",l.textContent="",e.appendChild(l);for(let u=t;u<=o;u+=1){const d=document.createElement("option");d.value=String(u),d.textContent=String(u),e.appendChild(d)}e.setAttribute("data-temp-min",String(t)),e.setAttribute("data-temp-max",String(o)),s&&Array.from(e.options).find(d=>d.value===s)&&(e.value=s)}function refreshFeedbackTemperatureLabel(e=currentLang$1,t){const o=getTemperatureColumnLabelForLang(e,typeof t>"u"?getRuntimeTemperatureUnit():t),r=document.getElementById("fbTemperatureLabelText");r&&(r.textContent=`${o}:`),document.querySelectorAll('a.help-link[href="#fbTemperature"]').forEach(a=>{a&&(a.textContent=o)})}function updateFeedbackTemperatureOptions$1(e=currentLang$1,t){const o=document.getElementById("fbTemperature");if(!o)return;ensureFeedbackTemperatureOptions$1(o);const r=typeof e=="string"?e:currentLang$1,n=typeof t>"u"?getRuntimeTemperatureUnit():t,a=getTemperatureUnitSymbolForLang(r,n);Array.from(o.options).forEach(s=>{if(!s)return;if(s.value===""){s.textContent="";return}const l=Number(s.value);if(!Number.isFinite(l)){s.textContent=s.value;return}const u=typeof formatTemperatureForDisplay=="function"?formatTemperatureForDisplay(l,{unit:n,lang:r,includeSign:!1}):"";s.textContent=u||`${l} ${a}`.trim()})}typeof window<"u"&&(window.ensureFeedbackTemperatureOptions=ensureFeedbackTemperatureOptions$1,window.refreshFeedbackTemperatureLabel=refreshFeedbackTemperatureLabel,window.updateFeedbackTemperatureOptions=updateFeedbackTemperatureOptions$1);function normalizeTemperatureUnit(e){if(typeof e=="string"){const t=e.trim().toLowerCase();if(t===CORE_TEMPERATURE_UNITS.fahrenheit)return CORE_TEMPERATURE_UNITS.fahrenheit;if(t===CORE_TEMPERATURE_UNITS.celsius)return CORE_TEMPERATURE_UNITS.celsius}return e===CORE_TEMPERATURE_UNITS.fahrenheit?CORE_TEMPERATURE_UNITS.fahrenheit:CORE_TEMPERATURE_UNITS.celsius}function getRuntimeTemperatureUnit(){const e=[];typeof temperatureUnit<"u"&&e.push(temperatureUnit),typeof CORE_GLOBAL_SCOPE$3<"u"&&CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object"&&e.push(CORE_GLOBAL_SCOPE$3.temperatureUnit),typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"&&e.push(globalThis.temperatureUnit),typeof window<"u"&&window&&typeof window=="object"&&e.push(window.temperatureUnit),typeof self<"u"&&self&&typeof self=="object"&&e.push(self.temperatureUnit),typeof global<"u"&&global&&typeof global=="object"&&e.push(global.temperatureUnit);for(let t=0;t<e.length;t+=1){const o=e[t];if(typeof o=="string"&&o)return o}return CORE_TEMPERATURE_UNITS.celsius}function convertCelsiusToUnit$1(e,t){const o=Number(e);return Number.isFinite(o)?normalizeTemperatureUnit(typeof t>"u"?getRuntimeTemperatureUnit():t)===CORE_TEMPERATURE_UNITS.fahrenheit?o*9/5+32:o:Number.NaN}function getTemperatureUnitSymbolForLang(e=currentLang$1,t){const o=normalizeTemperatureUnit(typeof t>"u"?getRuntimeTemperatureUnit():t),r=getLanguageTexts(e),n=getLanguageTexts("en"),a=o===CORE_TEMPERATURE_UNITS.fahrenheit?"temperatureUnitSymbolFahrenheit":"temperatureUnitSymbolCelsius";return r[a]||n[a]||(o===CORE_TEMPERATURE_UNITS.fahrenheit?"°F":"°C")}function getTemperatureUnitLabelForLang(e=currentLang$1,t){const o=normalizeTemperatureUnit(typeof t>"u"?getRuntimeTemperatureUnit():t),r=getLanguageTexts(e),n=getLanguageTexts("en"),a=o===CORE_TEMPERATURE_UNITS.fahrenheit?"temperatureUnitFahrenheit":"temperatureUnitCelsius";return r[a]||n[a]||(o===CORE_TEMPERATURE_UNITS.fahrenheit?"Fahrenheit (°F)":"Celsius (°C)")}function getTemperatureColumnLabelForLang(e=currentLang$1,t){const o=getLanguageTexts(e),r=getLanguageTexts("en"),n=o.temperatureLabel||r.temperatureLabel||"Temperature",a=getTemperatureUnitSymbolForLang(e,typeof t>"u"?getRuntimeTemperatureUnit():t);return`${n} (${a})`}function formatTemperatureForDisplay(e,t={}){const{unit:o,lang:r=currentLang$1,includeSign:n=!0}=t||{},a=normalizeTemperatureUnit(typeof o>"u"?getRuntimeTemperatureUnit():o);let s=convertCelsiusToUnit$1(e,a);if(!Number.isFinite(s))return"";const l=getLanguageTexts(r),u=getLanguageTexts("en"),d=a===CORE_TEMPERATURE_UNITS.fahrenheit?l.temperatureFormatterFahrenheit||u.temperatureFormatterFahrenheit:l.temperatureFormatterCelsius||u.temperatureFormatterCelsius;if(typeof d=="function")return d(s,{includeSign:n});const m=Math.round(s*10)/10,y=n&&m>0?`+ ${m} `:String(m),h=getTemperatureUnitSymbolForLang(r,a);return`${y} ${h} `.trim()}(function e(){const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},o=typeof document<"u"&&!!document&&typeof document.createElement=="function",r=(re,de)=>{if(typeof t[re]=="function")return t[re];const ne=typeof de=="function"?de():de;if(typeof ne=="function")try{t[re]=ne}catch{}return ne},n=(re,de)=>{if(Array.isArray(t[re]))return t[re];const ne=Array.isArray(de)?de.slice():[];try{t[re]=ne}catch{t[re]=ne}return t[re]},a=["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI"],s=["Electronic Viewfinder","Optical Viewfinder","LCD Monitor","OLED Viewfinder"],l=["BNC","Mini BNC","HDMI","Mini HDMI","Micro HDMI"],u=typeof localeSort=="function"?localeSort:(re,de)=>String(re||"").localeCompare(String(de||""),void 0,{sensitivity:"base"}),d=()=>typeof devices$1<"u"&&devices$1&&typeof devices$1=="object"?devices$1:{},m=(re,de)=>{const ne=new Set((re||[]).filter(Boolean));try{de(ne)}catch{}return Array.from(ne).filter(Boolean).sort(u)},y=()=>{const re=m(s,de=>{const ne=d();Object.values(ne.cameras||{}).forEach(Ce=>{if(!Ce)return;(Array.isArray(Ce.viewfinder)?Ce.viewfinder:[]).forEach(Pe=>{const et=typeof Pe?.type=="string"?Pe.type.trim():"";et&&de.add(et)})})});return n("viewfinderTypeOptions",re),re},h=()=>{const re=m(l,de=>{const ne=d();Object.values(ne.cameras||{}).forEach(Ce=>{if(!Ce)return;(Array.isArray(Ce.viewfinder)?Ce.viewfinder:[]).forEach(Pe=>{const et=typeof Pe?.connector=="string"?Pe.connector.trim():"";et&&de.add(et)})})});return n("viewfinderConnectorOptions",re),re},b=()=>m(a,de=>{const ne=d(),Ce=Ee=>{Array.isArray(Ee)&&Ee.forEach(Pe=>{if(typeof Pe=="string"){const it=Pe.trim();it&&de.add(it);return}const et=typeof Pe?.type=="string"?Pe.type.trim():"";et&&de.add(et);const Je=typeof Pe?.portType=="string"?Pe.portType.trim():"";Je&&de.add(Je)})};Object.values(ne.cameras||{}).forEach(Ee=>{Ee&&(Ce(Ee.videoInputs),Ce(Ee.videoOutputs))}),Object.values(ne.monitors||{}).forEach(Ee=>{Ee&&(Ce(Ee.videoInputs),Ce(Ee.videoOutputs))})});if(r("getAllViewfinderTypes",()=>y),r("getAllViewfinderConnectors",()=>h),!o){r("setViewfinders",()=>function(){}),r("getViewfinders",()=>function(){return[]}),r("clearViewfinders",()=>function(){}),r("setViewfinderVideoInputs",()=>function(){}),r("getViewfinderVideoInputs",()=>function(){return[]}),r("clearViewfinderVideoInputs",()=>function(){}),r("setViewfinderVideoOutputs",()=>function(){}),r("getViewfinderVideoOutputs",()=>function(){return[]}),r("clearViewfinderVideoOutputs",()=>function(){});return}const v=re=>{if(!o||typeof document?.getElementById!="function")return null;try{return document.getElementById(re)}catch{return null}},C=v("viewfinderContainer"),A=v("viewfinderVideoInputsContainer"),w=v("viewfinderVideoOutputsContainer");if([["setViewfinders",C],["getViewfinders",C],["clearViewfinders",C]].some(([re,de])=>de?!1:(r(re,()=>re==="getViewfinders"?()=>[]:()=>{}),!0)))return;let G=0;const O=(re,de)=>{if(!re)return"";if(re.id)return re.id;const ne=typeof de=="string"&&de?de:"field";G+=1;const Ce=`${ne.toLowerCase().replace(/[^a-z0-9]+/g,"-")||"field"} -${G} `;try{re.id=Ce}catch{}return re.id||Ce},B=(re,de)=>{const ne=document.createElement("label");return ne.className="visually-hidden",re&&ne.setAttribute("for",re),ne.textContent=typeof de=="string"?de:"",ne},$=(re,de)=>{const ne=document.createElement("div");ne.className="field-with-label",ne.dataset.label=de;const Ce=O(re,de);return ne.appendChild(B(Ce,de)),ne.appendChild(re),ne},V=(re,de,ne)=>{if(!re)return;const Ce=new Set;re.innerHTML="";const Ee=(Pe,et)=>{if(Ce.has(Pe))return;const Je=document.createElement("option");Je.value=Pe,Je.textContent=typeof et=="string"?et:Pe,re.appendChild(Je),Ce.add(Pe)};Ee("",""),de.forEach(Pe=>{if(typeof Pe!="string")return;const et=Pe.trim();et&&Ee(et,et)}),typeof ne=="string"&&ne&&!Ce.has(ne)&&Ee(ne,ne),re.value=typeof ne=="string"?ne:""},M=(re="",de="",ne="",Ce="")=>{const Ee=document.createElement("div");Ee.className="form-row";const Pe=document.createElement("select");Pe.className="viewfinder-type-select",Pe.name="viewfinderType",V(Pe,y(),typeof re=="string"?re.trim():""),Ee.appendChild($(Pe,"Type"));const et=document.createElement("input");et.type="text",et.name="viewfinderResolution",et.placeholder="Resolution",et.value=typeof de=="string"?de:"",Ee.appendChild($(et,"Resolution"));const Je=document.createElement("select");Je.className="viewfinder-connector-select",Je.name="viewfinderConnector",V(Je,h(),typeof ne=="string"?ne.trim():""),Ee.appendChild($(Je,"Connector"));const it=document.createElement("input");it.type="text",it.name="viewfinderNotes",it.placeholder="Notes",it.value=typeof Ce=="string"?Ce:"",Ee.appendChild($(it,"Notes"));const rt=document.createElement("button");rt.type="button",configureIconOnlyButton(rt,ICON_GLYPHS.add,{contextPaths:["viewfinderHeading",["cameraViewfinderLabel"]],fallbackContext:"Viewfinder",actionKey:"addEntry"}),rt.addEventListener("click",()=>{Ee.after(M())}),Ee.appendChild(rt);const Pt=document.createElement("button");return Pt.type="button",configureIconOnlyButton(Pt,ICON_GLYPHS.minus,{contextPaths:["viewfinderHeading",["cameraViewfinderLabel"]],fallbackContext:"Viewfinder",actionKey:"removeEntry"}),Pt.addEventListener("click",()=>{C&&C.children.length>1?Ee.remove():Array.from(Ee.querySelectorAll("select, input")).forEach(vt=>{vt&&(vt.value="")})}),Ee.appendChild(Pt),Ee},F=(re,de,ne,Ce,Ee,Pe="")=>{if(!re)return null;const et=document.createElement("div");et.className="form-row";const Je=document.createElement("select");Je.name=de,Je.className=`${de} -select`,V(Je,b(),typeof Pe=="string"?Pe.trim():""),et.appendChild($(Je,"Type"));const it=document.createElement("button");it.type="button",configureIconOnlyButton(it,ICON_GLYPHS.add,{contextPaths:[ne,[Ce]],fallbackContext:Ee,actionKey:"addEntry"}),it.addEventListener("click",()=>{et.after(F(re,de,ne,Ce,Ee))}),et.appendChild(it);const rt=document.createElement("button");return rt.type="button",configureIconOnlyButton(rt,ICON_GLYPHS.minus,{contextPaths:[ne,[Ce]],fallbackContext:Ee,actionKey:"removeEntry"}),rt.addEventListener("click",()=>{re.children.length>1?et.remove():Je.value=""}),et.appendChild(rt),et},z=re=>{if(!C)return;C.innerHTML="";const de=Array.isArray(re)?re:[];if(!de.length){C.appendChild(M());return}de.forEach(ne=>{const Ce=typeof ne?.type=="string"?ne.type:"",Ee=typeof ne?.resolution=="string"?ne.resolution:"",Pe=typeof ne?.connector=="string"?ne.connector:"",et=typeof ne?.notes=="string"?ne.notes:"";C.appendChild(M(Ce,Ee,Pe,et))})},x=()=>C?Array.from(C.querySelectorAll(".form-row")).map(re=>{const[de,ne,Ce,Ee]=re.querySelectorAll("select, input");return{type:de?de.value:"",resolution:ne?ne.value:"",connector:Ce?Ce.value:"",notes:Ee?Ee.value:""}}).filter(re=>re.type):[],H=()=>{z([])},W=re=>{if(!A)return;A.innerHTML="";const de=Array.isArray(re)?re:[];if(!de.length){const ne=F(A,"viewfinderVideoInput","viewfinderVideoInputsHeading","viewfinderVideoInputsLabel","Video Inputs");ne&&A.appendChild(ne);return}de.forEach(ne=>{const Ce=typeof ne=="string"?ne:typeof ne?.type=="string"?ne.type:"",Ee=F(A,"viewfinderVideoInput","viewfinderVideoInputsHeading","viewfinderVideoInputsLabel","Video Inputs",Ce);Ee&&A.appendChild(Ee)})},U=()=>A?Array.from(A.querySelectorAll("select")).map(re=>({type:re.value})).filter(re=>re.type):[],j=()=>{W([])},Y=re=>{if(!w)return;w.innerHTML="";const de=Array.isArray(re)?re:[];if(!de.length){const ne=F(w,"viewfinderVideoOutput","viewfinderVideoOutputsHeading","viewfinderVideoOutputsLabel","Video Outputs");ne&&w.appendChild(ne);return}de.forEach(ne=>{const Ce=typeof ne=="string"?ne:typeof ne?.type=="string"?ne.type:"",Ee=F(w,"viewfinderVideoOutput","viewfinderVideoOutputsHeading","viewfinderVideoOutputsLabel","Video Outputs",Ce);Ee&&w.appendChild(Ee)})},le=()=>w?Array.from(w.querySelectorAll("select")).map(re=>({type:re.value})).filter(re=>re.type):[],be=()=>{Y([])};r("setViewfinders",()=>z),r("getViewfinders",()=>x),r("clearViewfinders",()=>H),r("setViewfinderVideoInputs",()=>W),r("getViewfinderVideoInputs",()=>U),r("clearViewfinderVideoInputs",()=>j),r("setViewfinderVideoOutputs",()=>Y),r("getViewfinderVideoOutputs",()=>le),r("clearViewfinderVideoOutputs",()=>be),C&&!C.children.length&&z([]),A&&!A.children.length&&W([]),w&&!w.children.length&&Y([])})();wattFieldDiv$1&&wattFieldDiv$1.parentNode;function placeWattField$2(e,t){const o=document.getElementById("addDeviceForm"),r=document.getElementById("wattField"),n=document.getElementById("videoFields"),a=document.getElementById("cameraFields");if(!r||!o)return;const s=e==="video"||e==="wirelessReceivers"||e==="iosVideo";try{s&&n&&n.parentNode===o?o.insertBefore(r,n):a&&a.parentNode===o?o.insertBefore(r,a):o.appendChild(r)}catch(l){console.warn("placeWattField failed to insert element safely",l)}}try{exposeCoreRuntimeConstant$1("placeWattField",placeWattField$2)}catch(e){typeof window<"u"&&(window.placeWattField=placeWattField$2)}document.getElementById("motorFields");document.getElementById("motorConnector");document.getElementById("motorInternal");document.getElementById("motorTorque");document.getElementById("motorGearTypes");document.getElementById("motorNotes");document.getElementById("controllerFields");document.getElementById("controllerConnector");document.getElementById("controllerPower");document.getElementById("controllerBattery");document.getElementById("controllerConnectivity");document.getElementById("controllerNotes");document.getElementById("distanceFields");document.getElementById("distanceConnection");document.getElementById("distanceMethod");document.getElementById("distanceRange");document.getElementById("distanceAccuracy");document.getElementById("distanceOutput");document.getElementById("distanceNotes");document.getElementById("batteryPlatesContainer");document.getElementById("cameraMediaContainer");document.getElementById("lensMountContainer");var lensFocusScaleSelect$1=document.getElementById("lensFocusScaleUnit");document.getElementById("powerDistContainer");document.getElementById("videoOutputsContainer");document.getElementById("fizConnectorContainer");document.getElementById("viewfinderContainer");document.getElementById("timecodeContainer");document.getElementById("batteryFields");var newCapacityInput$1=document.getElementById("newCapacity"),newPinAInput$1=document.getElementById("newPinA"),newDtapAInput$1=document.getElementById("newDtapA");newDtapAInput$1&&newDtapAInput$1.parentElement;document.getElementById("addDeviceBtn");document.getElementById("cancelEditBtn");document.getElementById("exportDataBtn");document.getElementById("exportOutput");document.getElementById("importFileInput");document.getElementById("importDataBtn");var skipLink=document.getElementById("skipLink");function resolveGlobalFocusScalePreference(){const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,o=(e&&typeof e.focusScalePreference=="string"?e.focusScalePreference:null)||(typeof focusScalePreference=="string"?focusScalePreference:null)||"metric";if(typeof normalizeFocusScale=="function")try{const n=normalizeFocusScale(o);if(n==="imperial"||n==="metric")return n}catch{}return(typeof o=="string"?o.trim().toLowerCase():"")==="imperial"?"imperial":"metric"}function updateLensFocusScaleSelectOptions$1(e=currentLang$1,{preserveValue:t=!0}={}){if(!lensFocusScaleSelect$1)return;const o=t?lensFocusScaleSelect$1.value:"",r=typeof e=="string"?e:currentLang$1,n=texts$1&&r&&texts$1[r]?texts$1[r]:texts$1?.en||{},a=n.lensFocusScaleDefault||n.focusScaleSetting||"Use global focus scale",s=n.focusScaleMetric||"Metric",l=n.focusScaleImperial||"Imperial",d=resolveGlobalFocusScalePreference()==="imperial"?`${a} (${l})`:`${a} (${s})`,m=o&&(o==="metric"||o==="imperial")?o:"";lensFocusScaleSelect$1.innerHTML="";const y=(h,b)=>{const v=document.createElement("option");v.value=h,v.textContent=b,lensFocusScaleSelect$1.appendChild(v)};y("",d),y("metric",s),y("imperial",l),lensFocusScaleSelect$1.value=m}var languageSelect=document.getElementById("languageSelect"),settingsTablist=document.getElementById("settingsTablist"),pinkModeToggle$1=document.getElementById("pinkModeToggle");document.getElementById("pinkModeHelpIcon");var darkModeToggle$1=document.getElementById("darkModeToggle"),helpButton$1=document.getElementById("helpButton"),reloadButton$1=document.getElementById("reloadButton");document.getElementById("helpDialog");var closeHelpBtn=document.getElementById("closeHelp"),helpSearch$1=document.getElementById("helpSearch"),helpNoResults$1=document.getElementById("helpNoResults");document.getElementById("helpNoResultsSuggestions");var helpNoResultsSuggestionsHeading=document.getElementById("helpNoResultsSuggestionsHeading"),helpNoResultsSuggestionsIntro=document.getElementById("helpNoResultsSuggestionsIntro"),helpNoResultsSuggestionClear=document.getElementById("helpNoResultsSuggestionClear"),helpNoResultsSuggestionSynonyms=document.getElementById("helpNoResultsSuggestionSynonyms"),helpNoResultsSuggestionQuickStart=document.getElementById("helpNoResultsSuggestionQuickStart"),helpNoResultsSuggestionBackup=document.getElementById("helpNoResultsSuggestionBackup"),helpDataAuditHeading=document.getElementById("helpDataAuditHeading"),helpDataAuditStep1=document.getElementById("helpDataAuditStep1"),helpDataAuditStep2=document.getElementById("helpDataAuditStep2"),helpDataAuditStep3=document.getElementById("helpDataAuditStep3"),helpDataAuditStep4=document.getElementById("helpDataAuditStep4"),helpDataAuditNote=document.getElementById("helpDataAuditNote");document.getElementById("helpResultsSummary");document.getElementById("helpResultsAssist");var helpSearchClear$1=document.getElementById("helpSearchClear");document.getElementById("helpSections");document.getElementById("helpQuickLinks");document.getElementById("helpQuickLinksHeading");document.getElementById("helpQuickLinksList");var installPromptBanner$1,installPromptBannerText$1,installPromptBannerAction$1,installPromptBannerIcon$1,installPromptBannerDismiss$1,installGuideDialog$1,installGuideTitle$1,installGuideIntro$1,installGuideSteps$1,installGuideNote$1,installGuideMigration$1,installGuideMigrationTitle$1,installGuideMigrationIntro$1,installGuideMigrationSteps$1,installGuideMigrationNote$1,installGuideClose$1,iosPwaHelpDialog=document.getElementById("iosPwaHelpDialog"),iosPwaHelpTitle,iosPwaHelpIntro,iosPwaHelpStep1,installPromptElementsInitialized=!1;function ensureInstallPromptElements(){if(!(installPromptElementsInitialized&&installPromptBanner$1)){if(typeof document>"u"){installPromptElementsInitialized=!0,installPromptBanner$1=installPromptBanner$1||null,installPromptBannerText$1=installPromptBannerText$1||null,installPromptBannerAction$1=installPromptBannerAction$1||null,installPromptBannerIcon$1=installPromptBannerIcon$1||null,installPromptBannerDismiss$1=installPromptBannerDismiss$1||null,installGuideDialog$1=installGuideDialog$1||null,installGuideTitle$1=installGuideTitle$1||null,installGuideIntro$1=installGuideIntro$1||null,installGuideSteps$1=installGuideSteps$1||null,installGuideNote$1=installGuideNote$1||null,installGuideMigration$1=installGuideMigration$1||null,installGuideMigrationTitle$1=installGuideMigrationTitle$1||null,installGuideMigrationIntro$1=installGuideMigrationIntro$1||null,installGuideMigrationSteps$1=installGuideMigrationSteps$1||null,installGuideMigrationNote$1=installGuideMigrationNote$1||null,installGuideClose$1=installGuideClose$1||null,iosPwaHelpTitle=iosPwaHelpTitle||null,iosPwaHelpIntro=iosPwaHelpIntro||null,iosPwaHelpStep1=iosPwaHelpStep1||null;return}installPromptBanner$1=document.getElementById("installPromptBanner"),installPromptBannerText$1=document.getElementById("installPromptBannerText"),installPromptBannerAction$1=document.getElementById("installPromptBannerAction"),installPromptBannerIcon$1=document.getElementById("installPromptBannerIcon"),installPromptBannerDismiss$1=document.getElementById("installPromptBannerDismiss"),installGuideDialog$1=document.getElementById("installGuideDialog"),installGuideTitle$1=document.getElementById("installGuideTitle"),installGuideIntro$1=document.getElementById("installGuideIntro"),installGuideSteps$1=document.getElementById("installGuideSteps"),installGuideNote$1=document.getElementById("installGuideNote"),installGuideMigration$1=document.getElementById("installGuideMigration"),installGuideMigrationTitle$1=document.getElementById("installGuideMigrationTitle"),installGuideMigrationIntro$1=document.getElementById("installGuideMigrationIntro"),installGuideMigrationSteps$1=document.getElementById("installGuideMigrationSteps"),installGuideMigrationNote$1=document.getElementById("installGuideMigrationNote"),installGuideClose$1=document.getElementById("installGuideClose"),iosPwaHelpTitle=document.getElementById("iosPwaHelpTitle"),iosPwaHelpIntro=document.getElementById("iosPwaHelpIntro"),iosPwaHelpStep1=document.getElementById("iosPwaHelpStep1"),installPromptElementsInitialized=!0}}const syncResetButtonGlobal=(typeof globalThis<"u"&&globalThis&&typeof globalThis.syncMountVoltageResetButtonGlobal=="function"?globalThis.syncMountVoltageResetButtonGlobal:null)||(typeof syncMountVoltageResetButtonGlobal=="function"?syncMountVoltageResetButtonGlobal:function e(){}),mountVoltageSectionElem$1=document.getElementById("mountVoltageSettings"),mountVoltageHeadingElem$1=document.getElementById("mountVoltageHeading"),mountVoltageDescriptionElem$1=document.getElementById("mountVoltageDescription"),mountVoltageNoteElem$1=document.getElementById("mountVoltageNote"),mountVoltageResetButton$1=document.getElementById("mountVoltageReset");syncResetButtonGlobal(mountVoltageResetButton$1);const mountVoltageTitleElems$1={V:document.getElementById("mountVoltageVTitle"),Gold:document.getElementById("mountVoltageGoldTitle"),B:document.getElementById("mountVoltageBTitle")},mountVoltageInputs$1={"V-Mount":{high:document.getElementById("mountVoltageVHigh"),low:document.getElementById("mountVoltageVLow"),highLabel:document.getElementById("mountVoltageVHighLabel"),lowLabel:document.getElementById("mountVoltageVLowLabel")},"Gold-Mount":{high:document.getElementById("mountVoltageGoldHigh"),low:document.getElementById("mountVoltageGoldLow"),highLabel:document.getElementById("mountVoltageGoldHighLabel"),lowLabel:document.getElementById("mountVoltageGoldLowLabel")},"B-Mount":{high:document.getElementById("mountVoltageBHigh"),low:document.getElementById("mountVoltageBLow"),highLabel:document.getElementById("mountVoltageBHighLabel"),lowLabel:document.getElementById("mountVoltageBLowLabel")}},mountVoltageNamespace=typeof setMountVoltageDomReferences=="function"?{setDomReferences:setMountVoltageDomReferences}:CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object"&&CORE_GLOBAL_SCOPE$3.cineCoreMountVoltage&&typeof CORE_GLOBAL_SCOPE$3.cineCoreMountVoltage.setMountVoltageDomReferences=="function"?{setDomReferences:CORE_GLOBAL_SCOPE$3.cineCoreMountVoltage.setMountVoltageDomReferences}:null;if(mountVoltageNamespace&&typeof mountVoltageNamespace.setDomReferences=="function")mountVoltageNamespace.setDomReferences({section:mountVoltageSectionElem$1,heading:mountVoltageHeadingElem$1,description:mountVoltageDescriptionElem$1,note:mountVoltageNoteElem$1,resetButton:mountVoltageResetButton$1,titles:mountVoltageTitleElems$1,inputs:mountVoltageInputs$1});else if(CORE_GLOBAL_SCOPE$3&&typeof CORE_GLOBAL_SCOPE$3=="object")try{CORE_GLOBAL_SCOPE$3.mountVoltageInputs=mountVoltageInputs$1}catch{}typeof updateMountVoltageInputsFromState=="function"&&updateMountVoltageInputsFromState();typeof updateMountVoltageSettingLabels=="function"&&updateMountVoltageSettingLabels(currentLang$1);const iosPwaHelpStep2=document.getElementById("iosPwaHelpStep2"),iosPwaHelpStep3=document.getElementById("iosPwaHelpStep3");setPinkModeIconSequence$1(PINK_MODE_ICON_FALLBACK_MARKUP$1);typeof window<"u"&&typeof document<"u"&&loadPinkModeIconsFromFiles$1().catch(()=>{});const iosPwaHelpStep4=document.getElementById("iosPwaHelpStep4"),iosPwaHelpNote=document.getElementById("iosPwaHelpNote");var iosPwaHelpClose=document.getElementById("iosPwaHelpClose"),installBannerSetupComplete=!1,currentInstallGuidePlatform=null,lastActiveBeforeInstallGuide=null,lastActiveBeforeIosHelp=null;function parseRgbComponent(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.min(255,Math.round(e)));if(typeof e!="string")return null;const t=e.trim();if(!t)return null;if(t.endsWith("%")){const r=Number.parseFloat(t.slice(0,-1));return Number.isNaN(r)?null:Math.max(0,Math.min(255,Math.round(r/100*255)))}const o=Number.parseFloat(t);return Number.isNaN(o)?null:Math.max(0,Math.min(255,Math.round(o)))}function parseColorToRgb$1(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const o=t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(o){const n=o[1];return n.length===3?{r:Number.parseInt(n[0]+n[0],16),g:Number.parseInt(n[1]+n[1],16),b:Number.parseInt(n[2]+n[2],16)}:{r:Number.parseInt(n.slice(0,2),16),g:Number.parseInt(n.slice(2,4),16),b:Number.parseInt(n.slice(4,6),16)}}const r=t.match(/^rgba?\(([^)]+)\)$/i);if(r){const n=r[1].split(",");if(n.length<3)return null;const[a,s,l]=n,u=parseRgbComponent(a),d=parseRgbComponent(s),m=parseRgbComponent(l);return[u,d,m].some(y=>y===null)?null:{r:u,g:d,b:m}}return null}function computeRelativeLuminance$1(e){if(!e||typeof e!="object")return 0;const t=s=>{const l=Number(s);return Number.isFinite(l)?Math.min(1,Math.max(0,l/255)):0},o=s=>s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),r=o(t(e.r)),n=o(t(e.g)),a=o(t(e.b));return .2126*r+.7152*n+.0722*a}function isIosDevice(){try{if(helpModuleApi&&typeof helpModuleApi.isIosDevice=="function")return!!helpModuleApi.isIosDevice()}catch(e){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("isIosDevice() failed",e)}return!1}function isAndroidDevice(){try{if(helpModuleApi&&typeof helpModuleApi.isAndroidDevice=="function")return!!helpModuleApi.isAndroidDevice()}catch(e){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("isAndroidDevice() failed",e)}return!1}function isStandaloneDisplayMode(){try{if(helpModuleApi&&typeof helpModuleApi.isStandaloneDisplayMode=="function")return!!helpModuleApi.isStandaloneDisplayMode()}catch(e){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("isStandaloneDisplayMode() failed",e)}return!1}function markIosPwaHelpDismissed(){try{helpModuleApi&&typeof helpModuleApi.markIosPwaHelpDismissed=="function"&&helpModuleApi.markIosPwaHelpDismissed()}catch(e){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("markIosPwaHelpDismissed() failed",e)}}function getInstallBannerDismissedInSession(){return!installBannerGlobalScope||typeof installBannerGlobalScope!="object"?!1:typeof installBannerGlobalScope.installBannerDismissedInSession!="boolean"?(installBannerGlobalScope.installBannerDismissedInSession=!1,!1):installBannerGlobalScope.installBannerDismissedInSession}function setInstallBannerDismissedInSession(e){!installBannerGlobalScope||typeof installBannerGlobalScope!="object"||(installBannerGlobalScope.installBannerDismissedInSession=!!e)}function hasDismissedInstallBanner(){if(getInstallBannerDismissedInSession())return!0;if(typeof localStorage>"u")return!1;try{const t=localStorage.getItem(INSTALL_BANNER_DISMISSED_KEY)==="1";return t&&setInstallBannerDismissedInSession(!0),t}catch(e){return console.warn("Could not read install banner dismissal flag",e),getInstallBannerDismissedInSession()}}function markInstallBannerDismissed(){if(setInstallBannerDismissedInSession(!0),!(typeof localStorage>"u"))try{localStorage.setItem(INSTALL_BANNER_DISMISSED_KEY,"1")}catch(e){console.warn("Could not store install banner dismissal",e)}}function shouldShowInstallBanner(){return ensureInstallPromptElements(),!installPromptBanner$1||isStandaloneDisplayMode()||hasDismissedInstallBanner()?!1:isIosDevice()||isAndroidDevice()}function updateInstallBannerVisibility(){if(ensureInstallPromptElements(),!installPromptBanner$1)return;const e=shouldShowInstallBanner(),t=typeof document<"u"?document.documentElement:null;t&&typeof t.classList<"u"&&t.classList.toggle("install-banner-visible",e),e?(installPromptBanner$1.removeAttribute("hidden"),updateInstallBannerColors(),updateInstallBannerPosition()):(installPromptBanner$1.setAttribute("hidden",""),setInstallBannerOffset$1(0),installPromptBanner$1.style.removeProperty("top"))}function updateInstallBannerColors(){if(ensureInstallPromptElements(),!!installPromptBanner$1&&!(typeof window>"u"||typeof window.getComputedStyle!="function"))try{const e=document.documentElement;if(!e)return;const o=window.getComputedStyle(e).getPropertyValue("--accent-color").trim();if(!o){installPromptBanner$1.style.removeProperty("--install-banner-text-color");return}const r=parseColorToRgb$1(o);if(!r)return;const a=computeRelativeLuminance$1(r)>.55?"#000000":"#ffffff";installPromptBanner$1.style.setProperty("--install-banner-text-color",a)}catch(e){console.warn("Unable to update install banner colors",e)}}function renderInstallGuideContent(e,t=currentLang$1){if(ensureInstallPromptElements(),!installGuideDialog$1)return;const o=texts$1.en||{},r=texts$1[t]||o,n=e==="ios",a=n?"installHelpTitleIos":"installHelpTitleAndroid",s=n?"installHelpIntroIos":"installHelpIntroAndroid",l=n?"installHelpStepsIos":"installHelpStepsAndroid",u=n?"installHelpNoteIos":"installHelpNoteAndroid",d=r[a]||o[a]||"";installGuideTitle$1&&(installGuideTitle$1.textContent=d);const m=r[s]||o[s]||"";installGuideIntro$1&&(installGuideIntro$1.textContent=m);const y=r[l],h=o[l],b=R=>R?Array.isArray(R)?R:[R]:[],v=b(y),C=b(h),A=v.length?v:C;installGuideSteps$1&&(installGuideSteps$1.textContent="",A.forEach(R=>{if(!R)return;const _=document.createElement("li");_.textContent=R,installGuideSteps$1.appendChild(_)}));const w=r[u]||o[u]||"";if(installGuideNote$1&&(installGuideNote$1.textContent=w),installGuideDialog$1.setAttribute("data-platform",e),!(!installGuideMigration$1||!installGuideMigrationTitle$1||!installGuideMigrationIntro$1||!installGuideMigrationSteps$1||!installGuideMigrationNote$1))if(n){installGuideMigration$1.removeAttribute("hidden");const R=r.installHelpMigrationTitle||o.installHelpMigrationTitle||"";installGuideMigrationTitle$1.textContent=R;const _=r.iosPwaHelpIntro||o.iosPwaHelpIntro||"";installGuideMigrationIntro$1.textContent=_;const G=[r.iosPwaHelpStep1||o.iosPwaHelpStep1,r.iosPwaHelpStep2||o.iosPwaHelpStep2,r.iosPwaHelpStep3||o.iosPwaHelpStep3,r.iosPwaHelpStep4||o.iosPwaHelpStep4].filter(Boolean);installGuideMigrationSteps$1.textContent="",G.forEach(B=>{const $=document.createElement("li");$.textContent=B,installGuideMigrationSteps$1.appendChild($)});const O=r.iosPwaHelpNote||o.iosPwaHelpNote||"";installGuideMigrationNote$1.textContent=O}else installGuideMigration$1.setAttribute("hidden",""),installGuideMigrationTitle$1.textContent="",installGuideMigrationIntro$1.textContent="",installGuideMigrationSteps$1.textContent="",installGuideMigrationNote$1.textContent=""}function openInstallGuide(e){if(ensureInstallPromptElements(),!installGuideDialog$1)return;currentInstallGuidePlatform=e,lastActiveBeforeInstallGuide=document.activeElement,renderInstallGuideContent(e),installGuideDialog$1.removeAttribute("hidden");const t=installGuideClose$1||installGuideDialog$1.querySelector('button, [href], [tabindex]:not([tabindex="-1"])');if(t&&typeof t.focus=="function")try{t.focus()}catch{t.focus()}}function closeInstallGuide(){if(ensureInstallPromptElements(),!!installGuideDialog$1&&(installGuideDialog$1.setAttribute("hidden",""),currentInstallGuidePlatform=null,lastActiveBeforeInstallGuide&&typeof lastActiveBeforeInstallGuide.focus=="function"))try{lastActiveBeforeInstallGuide.focus()}catch{lastActiveBeforeInstallGuide.focus()}}function setupInstallBanner(){if(ensureInstallPromptElements(),!installPromptBanner$1)return!1;if(installBannerSetupComplete)return applyInstallTexts(currentLang$1),updateInstallBannerColors(),updateInstallBannerVisibility(),updateInstallBannerPosition(),!0;if(installBannerSetupComplete=!0,installPromptBannerIcon$1&&typeof applyIconGlyph=="function"&&applyIconGlyph(installPromptBannerIcon$1,ICON_GLYPHS.installApp),installPromptBannerAction$1&&installPromptBannerAction$1.addEventListener("click",e=>{e.preventDefault();const t=isIosDevice()?"ios":"android";openInstallGuide(t)}),installPromptBannerDismiss$1&&installPromptBannerDismiss$1.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),markInstallBannerDismissed(),updateInstallBannerVisibility()}),installGuideClose$1&&installGuideClose$1.addEventListener("click",()=>{closeInstallGuide()}),installGuideDialog$1&&installGuideDialog$1.addEventListener("click",e=>{e.target===installGuideDialog$1&&closeInstallGuide()}),applyInstallTexts(currentLang$1),updateInstallBannerColors(),updateInstallBannerVisibility(),updateInstallBannerPosition(),typeof window<"u"&&(window.addEventListener("resize",updateInstallBannerPosition),window.addEventListener("appinstalled",updateInstallBannerVisibility),typeof window.matchMedia=="function"))try{const e=window.matchMedia("(display-mode: standalone)"),t=()=>updateInstallBannerVisibility();typeof e.addEventListener=="function"?e.addEventListener("change",t):typeof e.addListener=="function"&&e.addListener(t)}catch(e){console.warn("matchMedia display-mode listener failed",e)}return!0}function applyInstallTexts(e){ensureInstallPromptElements();const t=texts$1.en||{},o=texts$1[e]||t,r=o.installBannerText||t.installBannerText||"";installPromptBannerText$1&&r&&(installPromptBannerText$1.textContent=r),installPromptBanner$1&&(r?(installPromptBanner$1.setAttribute("aria-label",r),installPromptBanner$1.setAttribute("title",r)):(installPromptBanner$1.removeAttribute("aria-label"),installPromptBanner$1.removeAttribute("title"))),installPromptBannerAction$1&&(r?(installPromptBannerAction$1.setAttribute("aria-label",r),installPromptBannerAction$1.setAttribute("title",r)):(installPromptBannerAction$1.removeAttribute("aria-label"),installPromptBannerAction$1.removeAttribute("title")));const n=o.installHelpClose||t.installHelpClose||"",a=o.installBannerDismiss||t.installBannerDismiss||n||"";if(installPromptBannerDismiss$1){const s=a||"";if(typeof setButtonLabelWithIconBinding$1=="function"&&setButtonLabelWithIconBinding$1(installPromptBannerDismiss$1,"",ICON_GLYPHS.circleX),Array.from(installPromptBannerDismiss$1.querySelectorAll(".visually-hidden")).forEach(l=>{l&&l.parentNode===installPromptBannerDismiss$1&&installPromptBannerDismiss$1.removeChild(l)}),s){installPromptBannerDismiss$1.setAttribute("aria-label",s),installPromptBannerDismiss$1.setAttribute("title",s);const l=document.createElement("span");l.className="visually-hidden",l.textContent=s,installPromptBannerDismiss$1.appendChild(l)}else installPromptBannerDismiss$1.removeAttribute("aria-label"),installPromptBannerDismiss$1.removeAttribute("title")}installGuideClose$1&&(n&&typeof setButtonLabelWithIconBinding$1=="function"?(setButtonLabelWithIconBinding$1(installGuideClose$1,n,ICON_GLYPHS.circleX),installGuideClose$1.setAttribute("aria-label",n),installGuideClose$1.setAttribute("title",n)):n||(installGuideClose$1.removeAttribute("aria-label"),installGuideClose$1.removeAttribute("title"))),installGuideDialog$1&&!installGuideDialog$1.hasAttribute("hidden")&&currentInstallGuidePlatform&&renderInstallGuideContent(currentInstallGuidePlatform,e),updateInstallBannerPosition(),updateInstallBannerColors()}function shouldShowIosPwaHelp(){try{if(helpModuleApi&&typeof helpModuleApi.shouldShowIosPwaHelp=="function")return!!helpModuleApi.shouldShowIosPwaHelp(()=>iosPwaHelpDialog)}catch(e){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("shouldShowIosPwaHelp() failed",e)}return!1}function openIosPwaHelp(){if(!iosPwaHelpDialog||!shouldShowIosPwaHelp())return;lastActiveBeforeIosHelp=document.activeElement,iosPwaHelpDialog.removeAttribute("hidden");const e=iosPwaHelpClose||iosPwaHelpDialog.querySelector('button, [href], [tabindex]:not([tabindex="-1"])');if(e&&typeof e.focus=="function")try{e.focus()}catch{e.focus()}}function closeIosPwaHelp(e=!1){if(iosPwaHelpDialog&&(iosPwaHelpDialog.setAttribute("hidden",""),e&&markIosPwaHelpDismissed(),lastActiveBeforeIosHelp&&typeof lastActiveBeforeIosHelp.focus=="function"))try{lastActiveBeforeIosHelp.focus()}catch{lastActiveBeforeIosHelp.focus()}}function maybeShowIosPwaHelp$1(){openIosPwaHelp()}iosPwaHelpClose&&iosPwaHelpClose.addEventListener("click",()=>closeIosPwaHelp(!0));iosPwaHelpDialog&&iosPwaHelpDialog.addEventListener("click",e=>{e.target===iosPwaHelpDialog&&closeIosPwaHelp(!0)});document.addEventListener("keydown",e=>{if(e.key!=="Escape"&&e.key!=="Esc")return;let t=!1;iosPwaHelpDialog&&!iosPwaHelpDialog.hasAttribute("hidden")&&(closeIosPwaHelp(!0),t=!0),installGuideDialog$1&&!installGuideDialog$1.hasAttribute("hidden")&&(closeInstallGuide(),t=!0),t&&e.preventDefault()});var hoverHelpButton$1=document.getElementById("hoverHelpButton"),settingsButton$1=document.getElementById("settingsButton");const settingsButtonIcon=settingsButton$1?.querySelector?.(".settings-button-icon");var settingsDialog$1=document.getElementById("settingsDialog");settingsButton$1&&settingsButton$1.setAttribute("data-allow-hover-help","");settingsButtonIcon&&(applyIconGlyph(settingsButtonIcon,ICON_GLYPHS.gears),settingsButtonIcon.setAttribute("aria-hidden","true"));settingsDialog$1&&settingsDialog$1.setAttribute("data-allow-hover-help","");const settingsTabButtons=settingsTablist?Array.from(settingsTablist.querySelectorAll('[role="tab"]')):[],settingsTabsContainer=settingsTablist?settingsTablist.closest(".settings-tabs-container")||settingsTablist:null,settingsTabsScrollPrev=document.getElementById("settingsTabsScrollPrev"),settingsTabsScrollNext=document.getElementById("settingsTabsScrollNext");let settingsTabsOverflowFrame=0;const SETTINGS_TABS_SIDEBAR_QUERY="(max-width: 720px)",settingsTabsOrientationQuery=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia(SETTINGS_TABS_SIDEBAR_QUERY):null;function applySettingsTabsOrientation(e){settingsTablist&&(settingsTablist.setAttribute("aria-orientation",e?"vertical":"horizontal"),scheduleSettingsTabsOverflowUpdate$1())}if(settingsTabsOrientationQuery)try{applySettingsTabsOrientation(settingsTabsOrientationQuery.matches);const e=t=>{applySettingsTabsOrientation(t.matches)};typeof settingsTabsOrientationQuery.addEventListener=="function"?settingsTabsOrientationQuery.addEventListener("change",e):typeof settingsTabsOrientationQuery.addListener=="function"&&settingsTabsOrientationQuery.addListener(e)}catch{applySettingsTabsOrientation(!1)}else settingsTablist&&settingsTablist.setAttribute("aria-orientation","horizontal");function updateSettingsTabsOverflowIndicators(){if(!settingsTablist||!settingsTabsContainer){settingsTabsScrollPrev&&(settingsTabsScrollPrev.hidden=!0),settingsTabsScrollNext&&(settingsTabsScrollNext.hidden=!0);return}const e=typeof settingsTablist.scrollWidth=="number"?settingsTablist.scrollWidth:0,t=typeof settingsTablist.clientWidth=="number"?settingsTablist.clientWidth:0,o=typeof settingsTablist.scrollLeft=="number"?settingsTablist.scrollLeft:Number(settingsTablist.scrollLeft)||0,r=Math.max(0,e-t),n=Math.min(r,Math.max(0,o)),a=e>t+4,s=!a||n<=1,l=!a||Math.abs(e-t-n)<=1;settingsTabsContainer.classList.toggle("is-scrollable",a),settingsTabsContainer.classList.toggle("is-at-start",s),settingsTabsContainer.classList.toggle("is-at-end",l),settingsTabsScrollPrev&&(settingsTabsScrollPrev.hidden=!a,settingsTabsScrollPrev.disabled=s),settingsTabsScrollNext&&(settingsTabsScrollNext.hidden=!a,settingsTabsScrollNext.disabled=l)}function scheduleSettingsTabsOverflowUpdate$1(){settingsTablist&&(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?(settingsTabsOverflowFrame&&(typeof window.cancelAnimationFrame=="function"&&window.cancelAnimationFrame(settingsTabsOverflowFrame),settingsTabsOverflowFrame=0),settingsTabsOverflowFrame=window.requestAnimationFrame(()=>{settingsTabsOverflowFrame=0,updateSettingsTabsOverflowIndicators()})):updateSettingsTabsOverflowIndicators())}function scrollSettingsTabs(e){if(!settingsTablist)return;const t=settingsTablist.clientWidth?settingsTablist.clientWidth*.75:200,o=e*t;if(typeof settingsTablist.scrollBy=="function")try{settingsTablist.scrollBy({left:o,behavior:"smooth"})}catch{settingsTablist.scrollLeft+=o}else settingsTablist.scrollLeft+=o;scheduleSettingsTabsOverflowUpdate$1()}settingsTabsScrollPrev&&settingsTabsScrollPrev.addEventListener("click",()=>{scrollSettingsTabs(-1)});settingsTabsScrollNext&&settingsTabsScrollNext.addEventListener("click",()=>{scrollSettingsTabs(1)});if(settingsTablist){let e=!1;if(typeof window<"u"&&typeof window.addEventListener=="function")try{const t=()=>{},o=Object.defineProperty({},"passive",{get(){return e={passive:!0},!1}});window.addEventListener("testPassive",t,o),window.removeEventListener("testPassive",t,o)}catch{e=!1}settingsTablist.addEventListener("scroll",()=>{scheduleSettingsTabsOverflowUpdate$1()},e),typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("resize",scheduleSettingsTabsOverflowUpdate$1,e)}var settingsTabPanels=settingsDialog$1?Array.from(settingsDialog$1.querySelectorAll(".settings-panel")):[],settingsTabGeneral=document.getElementById("settingsTab-general"),settingsTabAutoGear=document.getElementById("settingsTab-autoGear"),settingsTabAccessibility=document.getElementById("settingsTab-accessibility"),settingsTabBackup=document.getElementById("settingsTab-backup"),settingsTabData=document.getElementById("settingsTab-data"),settingsTabAbout=document.getElementById("settingsTab-about"),settingsTabIconAssignments=[[settingsTabGeneral,ICON_GLYPHS.settingsGeneral],[settingsTabAutoGear,ICON_GLYPHS.settingsAutoGear],[settingsTabAccessibility,ICON_GLYPHS.settingsAccessibility],[settingsTabBackup,ICON_GLYPHS.settingsBackup],[settingsTabData,ICON_GLYPHS.settingsData],[settingsTabAbout,ICON_GLYPHS.settingsAbout]];settingsTabIconAssignments.forEach(([e,t])=>{if(!e||!t)return;const o=e.querySelector?.(".settings-tab-icon");o&&(applyIconGlyph(o,t),o.setAttribute("aria-hidden","true"))});const generalSettingsHeading=document.getElementById("generalSettingsHeading"),generalLanguageHeading=document.getElementById("generalLanguageHeading"),generalAppearanceHeading=document.getElementById("generalAppearanceHeading"),generalTypographyHeading=document.getElementById("generalTypographyHeading"),generalBrandingHeading=document.getElementById("generalBrandingHeading");document.getElementById("generalCameraColorsHeading");const cameraColorsDescription=document.getElementById("cameraColorsDescription"),cameraColorALabel=document.getElementById("cameraColorALabel"),cameraColorBLabel=document.getElementById("cameraColorBLabel"),cameraColorCLabel=document.getElementById("cameraColorCLabel"),cameraColorDLabel=document.getElementById("cameraColorDLabel"),cameraColorELabel=document.getElementById("cameraColorELabel");var cameraColorA=document.getElementById("cameraColorA"),cameraColorB=document.getElementById("cameraColorB"),cameraColorC=document.getElementById("cameraColorC"),cameraColorD=document.getElementById("cameraColorD"),cameraColorE=document.getElementById("cameraColorE"),settingsLanguage$1=document.getElementById("settingsLanguage"),settingsDarkMode$1=document.getElementById("settingsDarkMode"),settingsPinkMode$1=document.getElementById("settingsPinkMode"),accentColorInput$1=document.getElementById("accentColorInput"),accentColorResetButton=document.getElementById("accentColorReset"),settingsTemperatureUnit$1=document.getElementById("settingsTemperatureUnit"),settingsFocusScale$1=document.getElementById("settingsFocusScale"),settingsFontSize$1=document.getElementById("settingsFontSize"),settingsFontFamily$1=document.getElementById("settingsFontFamily"),localFontsButton=document.getElementById("localFontsButton");document.getElementById("localFontsInput");var localFontsStatus=document.getElementById("localFontsStatus"),localFontsGroup$1=document.getElementById("localFontsGroup");const bundledFontGroup=document.getElementById("bundledFontOptions");var settingsLogo$1=document.getElementById("settingsLogo");document.getElementById("settingsLogoPreview");const documentationTrackerController=(()=>{const e=SETTINGS_DOCUMENTATION_TRACKER_TOOLS&&typeof SETTINGS_DOCUMENTATION_TRACKER_TOOLS.createDocumentationTrackerManager=="function"?(()=>{try{return SETTINGS_DOCUMENTATION_TRACKER_TOOLS.createDocumentationTrackerManager({document:typeof document<"u"?document:null})}catch(o){return console.warn("Failed to create documentation tracker manager",o),null}})():null;if(e)return{initialize(){try{e.initialize()}catch(o){console.warn("Failed to initialise documentation tracker",o)}},updateLocalization(o){try{e.updateLocalization(o)}catch(r){console.warn("Failed to update documentation tracker localisation",r)}},render(){try{e.render()}catch(o){console.warn("Failed to render documentation tracker",o)}},isInitialized(){try{return typeof e.isInitialized=="function"?e.isInitialized()===!0:!1}catch{}return!1}};const t=()=>{};return{initialize:t,updateLocalization:t,render:t,isInitialized(){return!1}}})();var activeSettingsTabId$1="";if(settingsTabButtons.length){activeSettingsTabId$1=settingsTabButtons.find(t=>t.getAttribute("aria-selected")==="true")?.id||settingsTabButtons[0].id;try{const t=localStorage.getItem("settingsActiveTab");t&&settingsTabButtons.some(o=>o.id===t)&&(activeSettingsTabId$1=t)}catch(t){console.warn("Could not load settings tab preference",t)}}function activateSettingsTab$1(e,t={}){if(!settingsTabButtons.length)return;const{focusTab:o=!1}=t||{};let r=settingsTabButtons.find(n=>n.id===e);if(r||(r=settingsTabButtons[0]),!!r){if(settingsTabButtons.forEach(n=>{const a=n===r;if(n.setAttribute("aria-selected",a?"true":"false"),n.tabIndex=a?0:-1,a&&o)try{n.focus({preventScroll:!0})}catch{n.focus()}n.classList.toggle("active",a)}),settingsTabPanels.forEach(n=>{if(!n)return;(n.getAttribute("aria-labelledby")||"").split(/\s+/).map(l=>l.trim()).filter(Boolean).includes(r.id)?n.removeAttribute("hidden"):n.setAttribute("hidden","")}),settingsTablist&&typeof settingsTablist.scrollWidth=="number"&&typeof settingsTablist.clientWidth=="number"&&settingsTablist.scrollWidth>settingsTablist.clientWidth+4&&typeof r.scrollIntoView=="function")try{r.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"})}catch{r.scrollIntoView()}scheduleSettingsTabsOverflowUpdate$1(),activeSettingsTabId$1=r.id;try{typeof safeSetLocalStorage=="function"?safeSetLocalStorage("settingsActiveTab",activeSettingsTabId$1):localStorage.setItem("settingsActiveTab",activeSettingsTabId$1)}catch(n){console.warn("Could not save settings tab preference",n)}}}documentationTrackerController.initialize();settingsTabButtons.length&&(activateSettingsTab$1(activeSettingsTabId$1),settingsTabButtons.forEach(e=>{e.addEventListener("click",()=>{activateSettingsTab$1(e.id)}),e.addEventListener("keydown",t=>{const{key:o}=t;if(!o||!["ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Home","End"].includes(o))return;t.preventDefault();const r=settingsTabButtons.indexOf(e);if(r===-1)return;let n=r;o==="ArrowLeft"||o==="ArrowUp"?n=(r-1+settingsTabButtons.length)%settingsTabButtons.length:o==="ArrowRight"||o==="ArrowDown"?n=(r+1)%settingsTabButtons.length:o==="Home"?n=0:o==="End"&&(n=settingsTabButtons.length-1);const a=settingsTabButtons[n];a&&activateSettingsTab$1(a.id,{focusTab:!0})})}));storageOpenBackupTabButton&&storageOpenBackupTabButton.addEventListener("click",()=>{activateSettingsTab$1("settingsTab-backup",{focusTab:!0});const e=document.getElementById("backupSettings");if(e&&typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}});var autoGearConditionConfigs=AUTO_GEAR_CONDITION_KEYS$1.reduce((e,t)=>{const o=localAutoGearConditionSections[t]||null;return e[t]={key:t,section:o,label:autoGearConditionLabels$1[t]||null,select:autoGearConditionSelects$1[t]||null,addShortcut:autoGearConditionAddShortcuts[t]||null,removeButton:autoGearConditionRemoveButtons[t]||null,logicLabel:autoGearConditionLogicLabels$1[t]||null,logicSelect:autoGearConditionLogicSelects$1[t]||null},o&&o.setAttribute("aria-hidden",o.hidden?"true":"false"),e},{});const autoGearExports=typeof AUTO_GEAR_UI_EXPORTS$1<"u"?AUTO_GEAR_UI_EXPORTS$1:globalThis.AUTO_GEAR_UI_EXPORTS||{},refreshAutoGearShootingDaysValue=typeof autoGearExports.refreshAutoGearShootingDaysValue=="function"?autoGearExports.refreshAutoGearShootingDaysValue:function e(){},refreshAutoGearScenarioOptions=typeof autoGearExports.refreshAutoGearScenarioOptions=="function"?autoGearExports.refreshAutoGearScenarioOptions:function e(){};typeof autoGearExports.refreshAutoGearScenarioBaseSelect=="function"&&autoGearExports.refreshAutoGearScenarioBaseSelect;const refreshAutoGearMatteboxOptions=typeof autoGearExports.refreshAutoGearMatteboxOptions=="function"?autoGearExports.refreshAutoGearMatteboxOptions:function e(){},refreshAutoGearCameraHandleOptions=typeof autoGearExports.refreshAutoGearCameraHandleOptions=="function"?autoGearExports.refreshAutoGearCameraHandleOptions:function e(){},refreshAutoGearViewfinderExtensionOptions=typeof autoGearExports.refreshAutoGearViewfinderExtensionOptions=="function"?autoGearExports.refreshAutoGearViewfinderExtensionOptions:function e(){},refreshAutoGearDeliveryResolutionOptions=typeof autoGearExports.refreshAutoGearDeliveryResolutionOptions=="function"?autoGearExports.refreshAutoGearDeliveryResolutionOptions:function e(){},refreshAutoGearVideoDistributionOptions=typeof autoGearExports.refreshAutoGearVideoDistributionOptions=="function"?autoGearExports.refreshAutoGearVideoDistributionOptions:function e(){};typeof autoGearExports.collectAutoGearSelectedValues=="function"&&autoGearExports.collectAutoGearSelectedValues;var autoGearConditionRefreshers={always:null,scenarios:refreshAutoGearScenarioOptions,shootingDays:refreshAutoGearShootingDaysValue,mattebox:refreshAutoGearMatteboxOptions,cameraHandle:refreshAutoGearCameraHandleOptions,viewfinderExtension:refreshAutoGearViewfinderExtensionOptions,deliveryResolution:refreshAutoGearDeliveryResolutionOptions,videoDistribution:refreshAutoGearVideoDistributionOptions,camera:createDeferredAutoGearRefresher("refreshAutoGearCameraOptions"),ownGear:refreshAutoGearOwnGearConditionOptions,cameraWeight:createDeferredAutoGearRefresher("refreshAutoGearCameraWeightCondition"),monitor:createDeferredAutoGearRefresher("refreshAutoGearMonitorOptions"),tripodHeadBrand:createDeferredAutoGearRefresher("refreshAutoGearTripodHeadOptions"),tripodBowl:createDeferredAutoGearRefresher("refreshAutoGearTripodBowlOptions"),tripodTypes:createDeferredAutoGearRefresher("refreshAutoGearTripodTypesOptions"),tripodSpreader:createDeferredAutoGearRefresher("refreshAutoGearTripodSpreaderOptions"),crewPresent:e=>callCoreFunctionIfAvailable$1("refreshAutoGearCrewOptions",[autoGearCrewPresentSelect$2,e,"crewPresent"],{defer:!0}),crewAbsent:e=>callCoreFunctionIfAvailable$1("refreshAutoGearCrewOptions",[autoGearCrewAbsentSelect$2,e,"crewAbsent"],{defer:!0}),wireless:createDeferredAutoGearRefresher("refreshAutoGearWirelessOptions"),motors:createDeferredAutoGearRefresher("refreshAutoGearMotorsOptions"),controllers:createDeferredAutoGearRefresher("refreshAutoGearControllersOptions"),distance:createDeferredAutoGearRefresher("refreshAutoGearDistanceOptions")},autoGearActiveConditions=typeof window<"u"&&window.autoGearActiveConditions||new Set;typeof window<"u"&&!window.autoGearActiveConditions&&(window.autoGearActiveConditions=autoGearActiveConditions);function getAutoGearConditionConfig$1(e){return e&&Object.prototype.hasOwnProperty.call(autoGearConditionConfigs,e)?autoGearConditionConfigs[e]:null}function getAutoGearConditionLabel(e){const t=getAutoGearConditionConfig$1(e);if(t&&t.label&&typeof t.label.textContent=="string"){const r=t.label.textContent.trim();if(r)return r}const o=AUTO_GEAR_CONDITION_FALLBACK_LABELS[e];return typeof o=="string"&&o?o:typeof e=="string"&&e?e.replace(/([A-Z])/g," $1").replace(/^./,r=>r.toUpperCase()):""}function refreshAutoGearConditionPicker(){if(!autoGearConditionSelect$1)return;const e=autoGearConditionSelect$1.value||"",t=texts$1[currentLang$1]?.autoGearConditionPlaceholder||texts$1.en?.autoGearConditionPlaceholder||"Choose a condition";autoGearConditionSelect$1.innerHTML="";const o=document.createElement("option");o.value="",o.textContent=t,autoGearConditionSelect$1.appendChild(o);const r=AUTO_GEAR_CONDITION_KEYS$1.filter(n=>autoGearActiveConditions.has(n)?AUTO_GEAR_REPEATABLE_CONDITIONS.has(n):!0);r.forEach(n=>{const a=document.createElement("option");a.value=n,a.textContent=getAutoGearConditionLabel(n),autoGearConditionSelect$1.appendChild(a)}),e&&r.includes(e)?autoGearConditionSelect$1.value=e:autoGearConditionSelect$1.value="",autoGearConditionSelect$1.disabled=r.length===0}function updateAutoGearConditionAddButtonState$1(){const e=autoGearConditionSelect$1&&autoGearConditionSelect$1.value,t=autoGearConditionSelect$1?autoGearConditionSelect$1.disabled:!0;autoGearConditionAddButton$1&&(autoGearConditionAddButton$1.disabled=!e||t);const o=AUTO_GEAR_CONDITION_KEYS$1.some(r=>autoGearActiveConditions.has(r)?AUTO_GEAR_REPEATABLE_CONDITIONS.has(r):!0);AUTO_GEAR_CONDITION_KEYS$1.forEach(r=>{const n=autoGearConditionAddShortcuts[r];n&&(n.disabled=!o)})}function removeAutoGearCondition$1(e,t={}){const o=getAutoGearConditionConfig$1(e);if(!o||!autoGearActiveConditions.has(e))return!1;autoGearActiveConditions.delete(e),o.section&&(o.section.hidden=!0,o.section.setAttribute("aria-hidden","true")),o.logicSelect&&(o.logicSelect.value="all",o.logicSelect.disabled=!0),t.preserveDraft,o.select&&(Array.from(o.select.options||[]).forEach(n=>{n.selected=!1}),o.select.value=""),e==="cameraWeight"&&(autoGearCameraWeightOperator$2&&(autoGearCameraWeightOperator$2.value="greater"),autoGearCameraWeightValueInput$1&&(autoGearCameraWeightValueInput$1.value="")),e==="shootingDays"&&(autoGearShootingDaysMode$1&&(autoGearShootingDaysMode$1.value="minimum"),autoGearShootingDaysInput$1&&(autoGearShootingDaysInput$1.value=""));const r=autoGearConditionRefreshers[e];return typeof r=="function"&&r(e==="shootingDays"?null:[]),refreshAutoGearConditionPicker(),updateAutoGearConditionAddButtonState$1(),t.focusPicker&&focusAutoGearConditionPicker(),!0}function clearAllAutoGearConditions$1(e={}){const{preserveDraft:t=!1}=e||{};Array.from(autoGearActiveConditions).forEach(o=>{removeAutoGearCondition$1(o,{preserveDraft:t,focusPicker:!1})}),AUTO_GEAR_CONDITION_KEYS$1.forEach(o=>{if(autoGearActiveConditions.has(o))return;const r=getAutoGearConditionConfig$1(o);if(!r)return;r.section&&(r.section.hidden=!0,r.section.setAttribute("aria-hidden","true")),r.select&&(Array.from(r.select.options||[]).forEach(a=>{a.selected=!1}),r.select.value=""),r.logicSelect&&(r.logicSelect.value="all",r.logicSelect.disabled=!0),o==="cameraWeight"&&(autoGearCameraWeightOperator$2&&(autoGearCameraWeightOperator$2.value="greater"),autoGearCameraWeightValueInput$1&&(autoGearCameraWeightValueInput$1.value="")),o==="shootingDays"&&(autoGearShootingDaysMode$1&&(autoGearShootingDaysMode$1.value="minimum"),autoGearShootingDaysInput$1&&(autoGearShootingDaysInput$1.value=""));const n=autoGearConditionRefreshers[o];typeof n=="function"&&n(o==="shootingDays"?null:t?autoGearEditorDraft$1?.[o]:[])}),autoGearActiveConditions.clear(),refreshAutoGearConditionPicker(),updateAutoGearConditionAddButtonState$1()}refreshAutoGearConditionPicker();updateAutoGearConditionAddButtonState$1();configureAutoGearConditionButtons();if(autoGearShootingDaysMode$1){const e=()=>{updateAutoGearShootingDaysDraft(),callCoreFunctionIfAvailable$1("renderAutoGearDraftImpact",[],{defer:!0})};autoGearShootingDaysMode$1.addEventListener("input",e),autoGearShootingDaysMode$1.addEventListener("change",e)}if(autoGearShootingDaysInput$1){const e=()=>{updateAutoGearShootingDaysDraft(),callCoreFunctionIfAvailable$1("renderAutoGearDraftImpact",[],{defer:!0})};autoGearShootingDaysInput$1.addEventListener("input",e),autoGearShootingDaysInput$1.addEventListener("change",e),autoGearShootingDaysInput$1.addEventListener("blur",e)}Object.entries(autoGearConditionLogicSelects$1).forEach(([e,t])=>{if(!t)return;AUTO_GEAR_CONDITION_LOGIC_FIELDS[e];const o=()=>{const r=normalizeAutoGearConditionLogic$1(t.value);t.value=r,callCoreFunctionIfAvailable$1("renderAutoGearDraftImpact",[],{defer:!0})};t.addEventListener("input",o),t.addEventListener("change",o)});if(autoGearCameraWeightOperator$2){const e=()=>{updateAutoGearCameraWeightDraft(),callCoreFunctionIfAvailable$1("renderAutoGearDraftImpact",[],{defer:!0})};autoGearCameraWeightOperator$2.addEventListener("input",e),autoGearCameraWeightOperator$2.addEventListener("change",e)}if(autoGearCameraWeightValueInput$1){const e=()=>{updateAutoGearCameraWeightDraft(),callCoreFunctionIfAvailable$1("renderAutoGearDraftImpact",[],{defer:!0})};autoGearCameraWeightValueInput$1.addEventListener("input",e),autoGearCameraWeightValueInput$1.addEventListener("change",e),autoGearCameraWeightValueInput$1.addEventListener("blur",e)}var autoGearAddItemsHeading=document.getElementById("autoGearAddItemsHeading"),autoGearAddOwnGearLabel=document.getElementById("autoGearAddOwnGearLabel"),autoGearAddItemLabel=document.getElementById("autoGearAddItemLabel"),autoGearAddCategoryLabel=document.getElementById("autoGearAddCategoryLabel"),autoGearAddQuantityLabel=document.getElementById("autoGearAddQuantityLabel"),autoGearAddScreenSizeLabel=document.getElementById("autoGearAddScreenSizeLabel"),autoGearAddSelectorTypeLabel=document.getElementById("autoGearAddSelectorTypeLabel"),autoGearAddSelectorDefaultLabel=document.getElementById("autoGearAddSelectorDefaultLabel"),autoGearAddNotesLabel=document.getElementById("autoGearAddNotesLabel"),autoGearAddOwnGearSelect$1=document.getElementById("autoGearAddOwnGear"),autoGearAddNameInput$1=document.getElementById("autoGearAddName"),autoGearAddCategorySelect$1=document.getElementById("autoGearAddCategory"),autoGearAddQuantityInput$1=document.getElementById("autoGearAddQuantity"),autoGearAddScreenSizeInput$1=document.getElementById("autoGearAddScreenSize"),autoGearAddSelectorTypeSelect$1=document.getElementById("autoGearAddSelectorType"),autoGearAddSelectorDefaultInput$1=document.getElementById("autoGearAddSelectorDefault"),autoGearAddNotesInput$1=document.getElementById("autoGearAddNotes"),autoGearAddItemButton$1=document.getElementById("autoGearAddItemButton");document.getElementById("autoGearAddList");var autoGearRemoveItemsHeading=document.getElementById("autoGearRemoveItemsHeading"),autoGearRemoveOwnGearLabel=document.getElementById("autoGearRemoveOwnGearLabel"),autoGearRemoveItemLabel=document.getElementById("autoGearRemoveItemLabel"),autoGearRemoveCategoryLabel=document.getElementById("autoGearRemoveCategoryLabel"),autoGearRemoveQuantityLabel=document.getElementById("autoGearRemoveQuantityLabel"),autoGearRemoveScreenSizeLabel=document.getElementById("autoGearRemoveScreenSizeLabel"),autoGearRemoveSelectorTypeLabel=document.getElementById("autoGearRemoveSelectorTypeLabel"),autoGearRemoveSelectorDefaultLabel=document.getElementById("autoGearRemoveSelectorDefaultLabel"),autoGearRemoveNotesLabel=document.getElementById("autoGearRemoveNotesLabel"),autoGearRemoveOwnGearSelect$1=document.getElementById("autoGearRemoveOwnGear"),autoGearRemoveNameInput$1=document.getElementById("autoGearRemoveName"),autoGearRemoveCategorySelect$1=document.getElementById("autoGearRemoveCategory"),autoGearRemoveQuantityInput$1=document.getElementById("autoGearRemoveQuantity"),autoGearRemoveScreenSizeInput$1=document.getElementById("autoGearRemoveScreenSize"),autoGearRemoveSelectorTypeSelect$1=document.getElementById("autoGearRemoveSelectorType"),autoGearRemoveSelectorDefaultInput$1=document.getElementById("autoGearRemoveSelectorDefault"),autoGearRemoveNotesInput$1=document.getElementById("autoGearRemoveNotes"),autoGearRemoveItemButton$1=document.getElementById("autoGearRemoveItemButton");document.getElementById("autoGearRemoveList");var autoGearDraftImpactContainer=document.getElementById("autoGearDraftImpact"),autoGearDraftImpactHeading=document.getElementById("autoGearDraftImpactHeading"),autoGearDraftImpactDescription=document.getElementById("autoGearDraftImpactDescription");document.getElementById("autoGearDraftImpactList");document.getElementById("autoGearDraftWarningContainer");var autoGearDraftWarningHeading=document.getElementById("autoGearDraftWarningHeading");document.getElementById("autoGearDraftWarningList");var autoGearSaveRuleButton$1=document.getElementById("autoGearSaveRule"),autoGearCancelEditButton$1=document.getElementById("autoGearCancelEdit");document.getElementById("autoGearItemCatalog");updateAutoGearOwnGearOptions();typeof document<"u"&&document&&document.addEventListener("own-gear-data-changed",()=>{invalidateAutoGearOwnGearCache(),updateAutoGearOwnGearOptions(),updateAutoGearCatalogOptions()});function enableAutoGearMultiSelectToggle(e){if(!e||!e.multiple)return;const t=o=>{if(!e.multiple||o.defaultPrevented||typeof PointerEvent<"u"&&o instanceof PointerEvent&&o.pointerType&&o.pointerType!=="mouse"||typeof o.button=="number"&&o.button!==0||o.ctrlKey||o.metaKey||o.shiftKey||o.altKey)return;const n=o.target instanceof HTMLOptionElement?o.target:null;if(!n||n.disabled)return;o.preventDefault(),n.selected=!n.selected;const a=s=>{try{const l=new Event(s,{bubbles:!0});e.dispatchEvent(l)}catch{const l=document.createEvent("Event");l.initEvent(s,!0,!0),e.dispatchEvent(l)}};if(a("input"),a("change"),typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}};typeof window<"u"&&typeof window.PointerEvent<"u"?e.addEventListener("pointerdown",t):e.addEventListener("mousedown",t)}[autoGearScenariosSelect$2,autoGearMatteboxSelect$2,autoGearCameraHandleSelect$2,autoGearViewfinderExtensionSelect$2,autoGearVideoDistributionSelect$2,autoGearCameraSelect$2,autoGearOwnGearSelect$2,autoGearMonitorSelect$2,autoGearCrewPresentSelect$2,autoGearCrewAbsentSelect$2,autoGearWirelessSelect$2,autoGearMotorsSelect$2,autoGearControllersSelect$2,autoGearDistanceSelect$2].forEach(enableAutoGearMultiSelectToggle);var autoGearAddScreenSizeField=autoGearAddScreenSizeInput$1?.closest(".auto-gear-field")||autoGearAddScreenSizeLabel?.closest(".auto-gear-field")||null,autoGearAddSelectorTypeField=autoGearAddSelectorTypeSelect$1?.closest(".auto-gear-field")||autoGearAddSelectorTypeLabel?.closest(".auto-gear-field")||null,autoGearAddSelectorDefaultField=autoGearAddSelectorDefaultInput$1?.closest(".auto-gear-field")||autoGearAddSelectorDefaultLabel?.closest(".auto-gear-field")||null,autoGearRemoveScreenSizeField=autoGearRemoveScreenSizeInput$1?.closest(".auto-gear-field")||autoGearRemoveScreenSizeLabel?.closest(".auto-gear-field")||null,autoGearRemoveSelectorTypeField=autoGearRemoveSelectorTypeSelect$1?.closest(".auto-gear-field")||autoGearRemoveSelectorTypeLabel?.closest(".auto-gear-field")||null,autoGearRemoveSelectorDefaultField=autoGearRemoveSelectorDefaultInput$1?.closest(".auto-gear-field")||autoGearRemoveSelectorDefaultLabel?.closest(".auto-gear-field")||null;autoGearAddMonitorFieldGroup={select:autoGearAddCategorySelect$1,screenSizeField:autoGearAddScreenSizeField,screenSizeInput:autoGearAddScreenSizeInput$1,selectorTypeField:autoGearAddSelectorTypeField,selectorTypeSelect:autoGearAddSelectorTypeSelect$1,selectorDefaultField:autoGearAddSelectorDefaultField,selectorDefaultInput:autoGearAddSelectorDefaultInput$1};autoGearRemoveMonitorFieldGroup={select:autoGearRemoveCategorySelect$1,screenSizeField:autoGearRemoveScreenSizeField,screenSizeInput:autoGearRemoveScreenSizeInput$1,selectorTypeField:autoGearRemoveSelectorTypeField,selectorTypeSelect:autoGearRemoveSelectorTypeSelect$1,selectorDefaultField:autoGearRemoveSelectorDefaultField,selectorDefaultInput:autoGearRemoveSelectorDefaultInput$1};[{selectorTypeSelect:autoGearAddSelectorTypeSelect$1,selectorDefaultInput:autoGearAddSelectorDefaultInput$1},{selectorTypeSelect:autoGearRemoveSelectorTypeSelect$1,selectorDefaultInput:autoGearRemoveSelectorDefaultInput$1}].filter(e=>e.selectorDefaultInput);function syncAutoGearMonitorFieldVisibility$1(){const e=typeof window<"u"&&window.updateAutoGearMonitorFieldGroup;typeof e=="function"&&(autoGearAddMonitorFieldGroup&&e(autoGearAddMonitorFieldGroup),autoGearRemoveMonitorFieldGroup&&e(autoGearRemoveMonitorFieldGroup))}exposeCoreRuntimeConstant$1("syncAutoGearMonitorFieldVisibility",syncAutoGearMonitorFieldVisibility$1);var autoGearExportButton$1=document.getElementById("autoGearExport"),autoGearImportButton$1=document.getElementById("autoGearImport");document.getElementById("autoGearImportInput");document.getElementById("autoGearBackupsSection");var autoGearBackupsHeading=document.getElementById("autoGearBackupsHeading"),autoGearBackupsDescription=document.getElementById("autoGearBackupsDescription"),autoGearBackupSelectLabel=document.getElementById("autoGearBackupSelectLabel"),autoGearBackupSelect$1=document.getElementById("autoGearBackupSelect"),autoGearBackupRestoreButton$1=document.getElementById("autoGearBackupRestore");document.getElementById("autoGearBackupControls");var autoGearBackupEmptyMessage$1=document.getElementById("autoGearBackupEmpty"),autoGearBackupRetentionLabel=document.getElementById("autoGearBackupRetentionLabel"),autoGearBackupRetentionInput$1=document.getElementById("autoGearBackupRetention"),autoGearBackupRetentionSummary$1=document.getElementById("autoGearBackupRetentionSummary");document.getElementById("autoGearBackupRetentionWarning");var autoGearShowBackupsCheckbox$1=document.getElementById("autoGearShowBackups"),autoGearShowBackupsLabel=document.getElementById("autoGearShowBackupsLabel"),autoGearBackupsHiddenNotice$1=document.getElementById("autoGearBackupsHidden");const dataHeading=document.getElementById("dataHeading"),storageSummaryIntro=document.getElementById("storageSummaryIntro"),storageSummaryList=document.getElementById("storageSummaryList");typeof globalThis<"u"&&(globalThis.storageSummaryList=storageSummaryList);const storageSummaryEmpty=document.getElementById("storageSummaryEmpty"),storageSummaryFootnote=document.getElementById("storageSummaryFootnote");document.getElementById("storagePersistence");const storagePersistenceHeading=document.getElementById("storagePersistenceHeading"),storagePersistenceIntro=document.getElementById("storagePersistenceIntro"),storagePersistenceRequestButton=document.getElementById("storagePersistenceRequest"),storagePersistenceStatus=document.getElementById("storagePersistenceStatus");var storageActionsHeading=document.getElementById("storageActionsHeading"),storageActionsIntro=document.getElementById("storageActionsIntro"),storageBackupNowButton=document.getElementById("storageBackupNow"),storageOpenBackupTabButton=document.getElementById("storageOpenBackupTab"),storageStatusHeading=document.getElementById("storageStatusHeading"),storageStatusLastProjectLabel=document.getElementById("storageStatusLastProjectLabel"),storageStatusLastProjectValue$1=document.getElementById("storageStatusLastProjectValue"),storageStatusLastAutoBackupLabel=document.getElementById("storageStatusLastAutoBackupLabel"),storageStatusLastAutoBackupValue$1=document.getElementById("storageStatusLastAutoBackupValue"),storageStatusLastFullBackupLabel=document.getElementById("storageStatusLastFullBackupLabel"),storageStatusLastFullBackupValue$1=document.getElementById("storageStatusLastFullBackupValue"),storageStatusReminder$1=document.getElementById("storageStatusReminder");const loggingSection=document.getElementById("loggingSection"),loggingHeading=document.getElementById("loggingHeading"),loggingIntro=document.getElementById("loggingIntro"),loggingLevelFilterLabel=document.getElementById("loggingLevelFilterLabel"),loggingLevelFilter=document.getElementById("loggingLevelFilter"),loggingNamespaceFilterLabel=document.getElementById("loggingNamespaceFilterLabel"),loggingNamespaceFilter=document.getElementById("loggingNamespaceFilter"),loggingNamespaceFilterHelp=document.getElementById("loggingNamespaceFilterHelp"),loggingHistoryLimitLabel=document.getElementById("loggingHistoryLimitLabel"),loggingHistoryLimit=document.getElementById("loggingHistoryLimit"),loggingHistoryLimitHelp=document.getElementById("loggingHistoryLimitHelp"),loggingConsoleOutputLabel=document.getElementById("loggingConsoleOutputLabel"),loggingConsoleOutputHelp=document.getElementById("loggingConsoleOutputHelp"),loggingCaptureConsoleLabel=document.getElementById("loggingCaptureConsoleLabel"),loggingCaptureConsoleHelp=document.getElementById("loggingCaptureConsoleHelp"),loggingCaptureErrorsLabel=document.getElementById("loggingCaptureErrorsLabel"),loggingCaptureErrorsHelp=document.getElementById("loggingCaptureErrorsHelp"),loggingPersistSessionLabel=document.getElementById("loggingPersistSessionLabel"),loggingPersistSessionHelp=document.getElementById("loggingPersistSessionHelp"),loggingExportButton=document.getElementById("loggingExportBtn"),loggingExportHelp=document.getElementById("loggingExportHelp"),loggingStatus=document.getElementById("loggingStatus"),loggingEmpty=document.getElementById("loggingEmpty"),loggingUnavailable=document.getElementById("loggingUnavailable");if(autoGearBackupRetentionInput$1){const e=t=>{callCoreFunctionIfAvailable$1(t,[],{defer:!0})};autoGearBackupRetentionInput$1.addEventListener("input",()=>{e("handleAutoGearBackupRetentionInput")}),autoGearBackupRetentionInput$1.addEventListener("blur",()=>{e("handleAutoGearBackupRetentionBlur")}),autoGearBackupRetentionInput$1.addEventListener("change",()=>{e("handleAutoGearBackupRetentionChange")})}function autoGearRuleMatchesScenario$1(e,t){return!t||t==="all"?!0:!e||!Array.isArray(e.scenarios)?!1:e.scenarios.some(o=>o===t)}function autoGearRuleMatchesSearch$1(e,t){const o=typeof t=="string"?t.trim().toLowerCase():"";if(!o)return!0;const r=[],n=l=>{Array.isArray(l)&&l.forEach(u=>{typeof u=="string"&&u&&r.push(u)})};if(e&&typeof e.label=="string"&&r.push(e.label),e&&e.always){r.push("always");const l=texts$1[currentLang$1]?.autoGearAlwaysMeta||texts$1.en?.autoGearAlwaysMeta||"Always active";r.push(l)}n(e?.scenarios),n(e?.mattebox),n(e?.cameraHandle),n(e?.viewfinderExtension),n(e?.deliveryResolution),n(e?.videoDistribution),n(e?.camera),n(e?.monitor),n(e?.crewPresent),n(e?.crewAbsent),n(e?.wireless),n(e?.motors),n(e?.controllers),n(e?.distance);const a=normalizeAutoGearShootingDaysCondition$1(e?.shootingDays);if(a){const l=texts$1[currentLang$1]?.autoGearShootingDaysLabel||texts$1.en?.autoGearShootingDaysLabel||"Shooting days condition",u=texts$1[currentLang$1]?.autoGearShootingDaysModeMinimum||texts$1.en?.autoGearShootingDaysModeMinimum||"Minimum",d=texts$1[currentLang$1]?.autoGearShootingDaysModeMaximum||texts$1.en?.autoGearShootingDaysModeMaximum||"Maximum",m=texts$1[currentLang$1]?.autoGearShootingDaysModeEvery||texts$1.en?.autoGearShootingDaysModeEvery||"Every";r.push(l),r.push(String(a.value)),a.mode==="minimum"?r.push(u):a.mode==="maximum"?r.push(d):a.mode==="every"&&r.push(m)}const s=l=>{Array.isArray(l)&&l.forEach(u=>{!u||typeof u!="object"||(typeof u.name=="string"&&u.name&&r.push(u.name),typeof u.notes=="string"&&u.notes&&r.push(u.notes),typeof u.category=="string"&&u.category&&r.push(u.category),typeof u.screenSize=="string"&&u.screenSize&&r.push(u.screenSize),u.selector&&typeof u.selector=="object"&&(typeof u.selector.type=="string"&&u.selector.type&&r.push(u.selector.type),typeof u.selector.default=="string"&&u.selector.default&&r.push(u.selector.default)),r.push(safeFormatAutoGearItemSummary(u)))})};return s(e?.add),s(e?.remove),r.some(l=>typeof l=="string"&&l.toLowerCase().includes(o))}const AUTO_GEAR_SCENARIO_FALLBACK_VALUES=Object.freeze(["Indoor","Outdoor","Studio","Tripod","Handheld","Easyrig","Cine Saddle","Steadybag","Dolly","Slider","Steadicam","Gimbal","Trinity","Rollcage","Car Mount","Jib","Undersling mode","Crane","Remote Head","Extreme cold (snow)","Extreme rain","Extreme heat","Rain Machine","Slow Motion","Battery Belt"]);function getAutoGearScenarioFallbackOptions(){const e=n=>{if(!n||typeof n!="object")return null;const{value:a,label:s}=n;if(typeof a!="string")return null;const l=a.trim();if(!l)return null;const u=typeof s=="string"&&s.trim()?s.trim():l;return{value:l,label:u}},t=()=>{const n=callCoreFunctionIfAvailable$1("getRequiredScenarioOptionEntries",[],{defaultValue:null});if(Array.isArray(n)&&n.length){const a=n.map(e).filter(Boolean);if(a.length)return a}return null},o=()=>{const n=getCoreGlobalObject$1(),a=n&&n.scenarioIcons;if(!a||typeof a!="object")return null;const s=Object.keys(a).filter(l=>typeof l=="string").map(l=>l.trim()).filter(Boolean).map(l=>({value:l,label:l}));return s.length?s:null},r=()=>AUTO_GEAR_SCENARIO_FALLBACK_VALUES.map(n=>({value:n,label:n}));return(t()||o()||r()).sort((n,a)=>localeSort(n.label,a.label))}function collectAutoGearScenarioFilterOptions(e){const t=new Map,o=document.getElementById("requiredScenarios");return o&&Array.from(o.options||[]).forEach(r=>{const n=typeof r.value=="string"?r.value.trim():"";if(!n)return;const a=r.textContent||n;t.has(n)||t.set(n,a)}),Array.isArray(e)&&e.forEach(r=>{!r||!Array.isArray(r.scenarios)||r.scenarios.forEach(n=>{if(typeof n!="string")return;const a=n.trim();a&&(t.has(a)||t.set(a,a))})}),t.size||getAutoGearScenarioFallbackOptions().forEach(({value:r,label:n})=>{t.has(r)||t.set(r,n)}),Array.from(t.entries()).map(([r,n])=>({value:r,label:n})).sort((r,n)=>localeSort(r.label,n.label))}function refreshAutoGearScenarioFilterOptions$1(e){if(!autoGearFilterScenarioSelect$1)return autoGearScenarioFilter$1;const t=collectAutoGearScenarioFilterOptions(e),o=texts$1[currentLang$1]?.autoGearFilterScenarioAny||texts$1.en?.autoGearFilterScenarioAny||"All scenarios";autoGearFilterScenarioSelect$1.innerHTML="";const r=document.createElement("option");r.value="all",r.textContent=o,autoGearFilterScenarioSelect$1.appendChild(r),t.forEach(({value:a,label:s})=>{const l=document.createElement("option");l.value=a,l.textContent=s,a===autoGearScenarioFilter$1&&(l.selected=!0),autoGearFilterScenarioSelect$1.appendChild(l)});const n=t.length>0;return autoGearFilterScenarioSelect$1.disabled=!n,(!n&&autoGearScenarioFilter$1!=="all"||autoGearScenarioFilter$1!=="all"&&!t.some(a=>a.value===autoGearScenarioFilter$1))&&(autoGearScenarioFilter$1="all"),autoGearFilterScenarioSelect$1.value=autoGearScenarioFilter$1,autoGearScenarioFilter$1}exposeCoreRuntimeConstant$1("setupInstallBanner",setupInstallBanner);exposeCoreRuntimeConstant$1("maybeShowIosPwaHelp",maybeShowIosPwaHelp$1);exposeCoreRuntimeConstant$1("updateSelectIconBoxes",updateSelectIconBoxes$1);exposeCoreRuntimeConstant$1("updateGlobalDevicesReference",updateGlobalDevicesReference);exposeCoreRuntimeConstant$1("setLanguage",setLanguage$1);exposeCoreRuntimeConstant$1("configureIconOnlyButton",configureIconOnlyButton);exposeCoreRuntimeConstant$1("encodeSharedSetup",encodeSharedSetup$1);exposeCoreRuntimeConstant$1("decodeSharedSetup",decodeSharedSetup$1);exposeCoreRuntimeConstant$1("iconMarkup",iconMarkup$1);exposeCoreRuntimeConstant$1("ICON_GLYPHS",ICON_GLYPHS);exposeCoreRuntimeConstant$1("iconGlyph",iconGlyph$1);exposeCoreRuntimeConstant$1("resolveIconGlyph",resolveIconGlyph);exposeCoreRuntimeConstant$1("applyIconGlyph",applyIconGlyph);exposeCoreRuntimeConstant$1("positionSvgMarkup",positionSvgMarkup);exposeCoreRuntimeConstant$1("formatSvgCoordinate",formatSvgCoordinate);const CORE_RUNTIME_CONSTANTS={CORE_GLOBAL_SCOPE:CORE_GLOBAL_SCOPE$3,CORE_BOOT_QUEUE_KEY,CORE_BOOT_QUEUE,CORE_SHARED:CORE_SHARED$2,INSTALL_BANNER_DISMISSED_KEY,AUTO_GEAR_ANY_MOTOR_TOKEN:AUTO_GEAR_ANY_MOTOR_TOKEN$1,AUTO_GEAR_BACKUP_RETENTION_MIN_VALUE,AUTO_GEAR_BACKUP_RETENTION_MAX:AUTO_GEAR_BACKUP_RETENTION_MAX$1,AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS$1,AUTO_GEAR_MONITOR_DEFAULT_TYPES:AUTO_GEAR_MONITOR_DEFAULT_TYPES$1,GEAR_LIST_CATEGORIES:GEAR_LIST_CATEGORIES$1,TEMPERATURE_STORAGE_KEY:CORE_TEMPERATURE_STORAGE_KEY,TEMPERATURE_UNITS:CORE_TEMPERATURE_UNITS,TEMPERATURE_SCENARIOS,FOCUS_SCALE_STORAGE_KEY,FOCUS_SCALE_VALUES:focusScaleValues,FEEDBACK_TEMPERATURE_MIN:globalThis.FEEDBACK_TEMPERATURE_MIN_VALUE,FEEDBACK_TEMPERATURE_MAX:globalThis.FEEDBACK_TEMPERATURE_MAX_VALUE};Object.assign(CORE_RUNTIME_CONSTANTS,MOUNT_VOLTAGE_RUNTIME_EXPORTS);exposeCoreRuntimeConstants(CORE_RUNTIME_CONSTANTS);exposeCoreRuntimeBindings({updatePowerSummary:{get:()=>updatePowerSummary},drawPowerDiagram:{get:()=>drawPowerDiagram$1},safeGenerateConnectorSummary:{get:()=>sessionSafeGenerateConnectorSummary,set:e=>{typeof e=="function"&&(sessionSafeGenerateConnectorSummary=e)}},baseAutoGearRules:{get:()=>baseAutoGearRulesState$1,set:e=>{Array.isArray(e)&&(baseAutoGearRulesState$1=e)}},autoGearAutoPresetId:{get:()=>autoGearAutoPresetIdState,set:e=>{typeof e=="string"?autoGearAutoPresetIdState=e:(e===null||typeof e>"u")&&(autoGearAutoPresetIdState="")}},autoGearScenarioModeSelect:{get:()=>autoGearScenarioModeSelectElement,set:e=>{autoGearScenarioModeSelectElement=e||null,setAutoGearScenarioModeSelectElementRef(autoGearScenarioModeSelectElement)}},pinkModeIconRotationTimer:{get:()=>typeof getPinkModeIconRotationTimer=="function"?getPinkModeIconRotationTimer():null,set:e=>{typeof setPinkModeIconRotationTimer=="function"&&setPinkModeIconRotationTimer(e)}},pinkModeIconIndex:{get:()=>typeof getPinkModeIconIndex=="function"?getPinkModeIconIndex():0,set:e=>{typeof setPinkModeIconIndex=="function"&&setPinkModeIconIndex(e)}}});var scheduleLayoutInitialization=function(){typeof initializeLayoutControls=="function"&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(initializeLayoutControls):setTimeout(initializeLayoutControls,0))};scheduleLayoutInitialization();typeof globalThis<"u"&&(globalThis.encodeSharedSetup=encodeSharedSetup$1,globalThis.decodeSharedSetup=decodeSharedSetup$1);function initAppCoreNewDomReferences(){initAppCoreNewDomReferences.done||(initAppCoreNewDomReferences.done=!0,!(typeof document>"u")&&(localAutoGearConditionSections={always:document.getElementById("autoGearCondition-always"),scenarios:document.getElementById("autoGearCondition-scenarios"),shootingDays:document.getElementById("autoGearCondition-shootingDays"),mattebox:document.getElementById("autoGearCondition-mattebox"),cameraHandle:document.getElementById("autoGearCondition-cameraHandle"),viewfinderExtension:document.getElementById("autoGearCondition-viewfinderExtension"),deliveryResolution:document.getElementById("autoGearCondition-deliveryResolution"),videoDistribution:document.getElementById("autoGearCondition-videoDistribution"),camera:document.getElementById("autoGearCondition-camera"),ownGear:document.getElementById("autoGearCondition-ownGear"),cameraWeight:document.getElementById("autoGearCondition-cameraWeight"),monitor:document.getElementById("autoGearCondition-monitor"),tripodHeadBrand:document.getElementById("autoGearCondition-tripodHeadBrand"),tripodBowl:document.getElementById("autoGearCondition-tripodBowl"),tripodTypes:document.getElementById("autoGearCondition-tripodTypes"),tripodSpreader:document.getElementById("autoGearCondition-tripodSpreader"),crewPresent:document.getElementById("autoGearCondition-crewPresent"),crewAbsent:document.getElementById("autoGearCondition-crewAbsent"),wireless:document.getElementById("autoGearCondition-wireless"),motors:document.getElementById("autoGearCondition-motors"),controllers:document.getElementById("autoGearCondition-controllers"),distance:document.getElementById("autoGearCondition-distance")},autoGearHeadingElem=document.getElementById("autoGearHeading"),autoGearDescriptionElem=document.getElementById("autoGearDescription"),document.getElementById("autoGearMonitorDefaultsSection"),autoGearMonitorDefaultsHeading=document.getElementById("autoGearMonitorDefaultsHeading"),autoGearMonitorDefaultsDescription=document.getElementById("autoGearMonitorDefaultsDescription"),autoGearDefaultFocusMonitorSelect=document.getElementById("autoGearDefaultFocusMonitor"),autoGearDefaultHandheldMonitorSelect=document.getElementById("autoGearDefaultHandheldMonitor"),autoGearDefaultComboMonitorSelect=document.getElementById("autoGearDefaultComboMonitor"),autoGearDefaultDirectorMonitorSelect=document.getElementById("autoGearDefaultDirectorMonitor"),autoGearDefaultFocusMonitorLabel=document.getElementById("autoGearDefaultFocusMonitorLabel"),autoGearDefaultHandheldMonitorLabel=document.getElementById("autoGearDefaultHandheldMonitorLabel"),autoGearDefaultComboMonitorLabel=document.getElementById("autoGearDefaultComboMonitorLabel"),autoGearDefaultDirectorMonitorLabel=document.getElementById("autoGearDefaultDirectorMonitorLabel"),autoGearSearchInput$1=document.getElementById("autoGearSearch"),autoGearSearchLabel=document.getElementById("autoGearSearchLabel"),autoGearFilterScenarioLabel=document.getElementById("autoGearFilterScenarioLabel"),autoGearFilterScenarioSelect$1=document.getElementById("autoGearFilterScenario"),autoGearFilterClearButton$1=document.getElementById("autoGearFilterClear"),document.getElementById("autoGearSummary"),document.getElementById("autoGearSummaryHeading"),document.getElementById("autoGearSummaryDescription"),document.getElementById("autoGearSummaryCards"),document.getElementById("autoGearSummaryDetails"),document.getElementById("autoGearRulesList"),autoGearPresetDescription=document.getElementById("autoGearPresetDescription"),autoGearPresetLabel=document.getElementById("autoGearPresetLabel"),autoGearPresetSelect$1=document.getElementById("autoGearPresetSelect"),autoGearSavePresetButton$1=document.getElementById("autoGearSavePreset"),autoGearDeletePresetButton$1=document.getElementById("autoGearDeletePreset"),autoGearAddRuleBtn$1=document.getElementById("autoGearAddRule"),autoGearResetFactoryButton$1=document.getElementById("autoGearResetFactory"),autoGearEditor$1=document.getElementById("autoGearEditor"),document.getElementById("autoGearConditionControls"),autoGearConditionSelectLabel=document.getElementById("autoGearConditionSelectLabel"),autoGearConditionSelect$1=document.getElementById("autoGearConditionSelect"),autoGearConditionAddButton$1=document.getElementById("autoGearConditionAdd"),document.getElementById("autoGearConditionList"),autoGearAlwaysLabel$1=document.getElementById("autoGearAlwaysLabel"),autoGearAlwaysHelp=document.getElementById("autoGearAlwaysHelp"),document.getElementById("autoGearCondition-cameraWeight"),autoGearMonitorDefaultControls=[{key:"focus",select:autoGearDefaultFocusMonitorSelect,label:autoGearDefaultFocusMonitorLabel},{key:"handheld7",select:autoGearDefaultHandheldMonitorSelect,label:autoGearDefaultHandheldMonitorLabel},{key:"combo15",select:autoGearDefaultComboMonitorSelect,label:autoGearDefaultComboMonitorLabel},{key:"director15",select:autoGearDefaultDirectorMonitorSelect,label:autoGearDefaultDirectorMonitorLabel}],autoGearMonitorDefaultControls.forEach(e=>{!e||!e.select||e.select.addEventListener("change",t=>{setAutoGearMonitorDefault(e.key,t.target.value)})}),autoGearConditionAddShortcuts={always:localAutoGearConditionSections.always?.querySelector(".auto-gear-condition-add")||null,scenarios:localAutoGearConditionSections.scenarios?.querySelector(".auto-gear-condition-add")||null,shootingDays:localAutoGearConditionSections.shootingDays?.querySelector(".auto-gear-condition-add")||null,mattebox:localAutoGearConditionSections.mattebox?.querySelector(".auto-gear-condition-add")||null,cameraHandle:localAutoGearConditionSections.cameraHandle?.querySelector(".auto-gear-condition-add")||null,viewfinderExtension:localAutoGearConditionSections.viewfinderExtension?.querySelector(".auto-gear-condition-add")||null,deliveryResolution:localAutoGearConditionSections.deliveryResolution?.querySelector(".auto-gear-condition-add")||null,videoDistribution:localAutoGearConditionSections.videoDistribution?.querySelector(".auto-gear-condition-add")||null,camera:localAutoGearConditionSections.camera?.querySelector(".auto-gear-condition-add")||null,ownGear:localAutoGearConditionSections.ownGear?.querySelector(".auto-gear-condition-add")||null,cameraWeight:localAutoGearConditionSections.cameraWeight?.querySelector(".auto-gear-condition-add")||null,monitor:localAutoGearConditionSections.monitor?.querySelector(".auto-gear-condition-add")||null,tripodHeadBrand:localAutoGearConditionSections.tripodHeadBrand?.querySelector(".auto-gear-condition-add")||null,tripodBowl:localAutoGearConditionSections.tripodBowl?.querySelector(".auto-gear-condition-add")||null,tripodTypes:localAutoGearConditionSections.tripodTypes?.querySelector(".auto-gear-condition-add")||null,tripodSpreader:localAutoGearConditionSections.tripodSpreader?.querySelector(".auto-gear-condition-add")||null,crewPresent:localAutoGearConditionSections.crewPresent?.querySelector(".auto-gear-condition-add")||null,crewAbsent:localAutoGearConditionSections.crewAbsent?.querySelector(".auto-gear-condition-add")||null,wireless:localAutoGearConditionSections.wireless?.querySelector(".auto-gear-condition-add")||null,motors:localAutoGearConditionSections.motors?.querySelector(".auto-gear-condition-add")||null,controllers:localAutoGearConditionSections.controllers?.querySelector(".auto-gear-condition-add")||null,distance:localAutoGearConditionSections.distance?.querySelector(".auto-gear-condition-add")||null},autoGearConditionRemoveButtons={always:localAutoGearConditionSections.always?.querySelector(".auto-gear-condition-remove")||null,scenarios:localAutoGearConditionSections.scenarios?.querySelector(".auto-gear-condition-remove")||null,shootingDays:localAutoGearConditionSections.shootingDays?.querySelector(".auto-gear-condition-remove")||null,mattebox:localAutoGearConditionSections.mattebox?.querySelector(".auto-gear-condition-remove")||null,cameraHandle:localAutoGearConditionSections.cameraHandle?.querySelector(".auto-gear-condition-remove")||null,viewfinderExtension:localAutoGearConditionSections.viewfinderExtension?.querySelector(".auto-gear-condition-remove")||null,deliveryResolution:localAutoGearConditionSections.deliveryResolution?.querySelector(".auto-gear-condition-remove")||null,videoDistribution:localAutoGearConditionSections.videoDistribution?.querySelector(".auto-gear-condition-remove")||null,camera:localAutoGearConditionSections.camera?.querySelector(".auto-gear-condition-remove")||null,ownGear:localAutoGearConditionSections.ownGear?.querySelector(".auto-gear-condition-remove")||null,cameraWeight:localAutoGearConditionSections.cameraWeight?.querySelector(".auto-gear-condition-remove")||null,monitor:localAutoGearConditionSections.monitor?.querySelector(".auto-gear-condition-remove")||null,tripodHeadBrand:localAutoGearConditionSections.tripodHeadBrand?.querySelector(".auto-gear-condition-remove")||null,tripodBowl:localAutoGearConditionSections.tripodBowl?.querySelector(".auto-gear-condition-remove")||null,tripodTypes:localAutoGearConditionSections.tripodTypes?.querySelector(".auto-gear-condition-remove")||null,tripodSpreader:localAutoGearConditionSections.tripodSpreader?.querySelector(".auto-gear-condition-remove")||null,crewPresent:localAutoGearConditionSections.crewPresent?.querySelector(".auto-gear-condition-remove")||null,crewAbsent:localAutoGearConditionSections.crewAbsent?.querySelector(".auto-gear-condition-remove")||null,wireless:localAutoGearConditionSections.wireless?.querySelector(".auto-gear-condition-remove")||null,motors:localAutoGearConditionSections.motors?.querySelector(".auto-gear-condition-remove")||null,controllers:localAutoGearConditionSections.controllers?.querySelector(".auto-gear-condition-remove")||null,distance:localAutoGearConditionSections.distance?.querySelector(".auto-gear-condition-remove")||null},autoGearAddRuleBtn$1&&(autoGearAddRuleBtn$1.setAttribute("aria-controls","autoGearEditor"),autoGearAddRuleBtn$1.setAttribute("aria-expanded",autoGearEditor$1&&!autoGearEditor$1.hidden?"true":"false")),autoGearEditor$1&&autoGearEditor$1.setAttribute("aria-hidden",autoGearEditor$1.hidden?"true":"false")))}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initAppCoreNewDomReferences):initAppCoreNewDomReferences());typeof window<"u"&&(window.AppCore=AppCore);typeof window<"u"&&(window.syncAutoGearRulesFromStorage=syncAutoGearRulesFromStorage$1,window.clearProjectAutoGearRules=clearProjectAutoGearRules$1,window.resetSharedImportStateForFactoryReset=resetSharedImportStateForFactoryReset$1,window.getCssVariableValue=getCssVariableValue$1,window.autoGearRuleMatchesScenario=autoGearRuleMatchesScenario$1,window.autoGearRuleMatchesSearch=autoGearRuleMatchesSearch$1,window.getAutoGearRules=getAutoGearRules$1,window.refreshAutoGearScenarioFilterOptions=refreshAutoGearScenarioFilterOptions$1,window.normalizeAutoGearCameraWeightCondition=normalizeAutoGearCameraWeightCondition$1,window.formatAutoGearCameraWeight=formatAutoGearCameraWeight,window.findAutoGearOwnGearById=findAutoGearOwnGearById$1);console.log("DEBUG: app-core-new-1.js FINISHED");if(CORE_PART2_RUNTIME_SCOPE&&CORE_PART2_RUNTIME_SCOPE.__cineCorePart2Initialized)typeof console<"u"&&typeof console.warn=="function"&&console.warn("Cine Power Planner core runtime (part 2) already initialized. Skipping duplicate load.");else{let e=function(){console.log("app-core-new-2.js: corePart2Runtime starting");const r=CORE_PART2_RUNTIME_SCOPE;function n(){if(r&&r.cineCoreShared)return r.cineCoreShared;if(typeof require=="function")try{return require("./modules/core-shared.js")}catch{}return null}const a=typeof CORE_SHARED<"u"&&CORE_SHARED?CORE_SHARED:n()||{};console.log("app-core-new-2.js: CORE_SHARED_LOCAL resolved");const s=(function(){const f=[a,CORE_PART2_RUNTIME_SCOPE,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null].filter(p=>p&&(typeof p=="object"||typeof p=="function"));for(let p=0;p<f.length;p+=1){const g=f[p];try{const S=g.autoGear&&g.autoGear.collectAutoGearSelectedValues||g.autoGearUi&&g.autoGearUi.collectAutoGearSelectedValues||g.collectAutoGearSelectedValues;if(typeof S=="function")return S}catch{}}return function(){return[]}})();console.log("app-core-new-2.js: collectAutoGearSelectedValues resolved");function l(){const c=[];if(typeof CORE_PART2_RUNTIME_HELPERS<"u"&&CORE_PART2_RUNTIME_HELPERS&&c.push(CORE_PART2_RUNTIME_HELPERS),a&&typeof a.cineCoreRuntimeHelpers=="object"&&c.push(a.cineCoreRuntimeHelpers),typeof CORE_PART2_RUNTIME_SCOPE<"u"&&CORE_PART2_RUNTIME_SCOPE&&typeof CORE_PART2_RUNTIME_SCOPE.cineCoreRuntimeHelpers=="object"&&c.push(CORE_PART2_RUNTIME_SCOPE.cineCoreRuntimeHelpers),typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE.cineCoreRuntimeHelpers=="object"&&c.push(CORE_GLOBAL_SCOPE.cineCoreRuntimeHelpers),typeof globalThis<"u"&&globalThis&&typeof globalThis.cineCoreRuntimeHelpers=="object"&&c.push(globalThis.cineCoreRuntimeHelpers),typeof window<"u"&&window&&typeof window.cineCoreRuntimeHelpers=="object"&&c.push(window.cineCoreRuntimeHelpers),typeof self<"u"&&self&&typeof self.cineCoreRuntimeHelpers=="object"&&c.push(self.cineCoreRuntimeHelpers),typeof global<"u"&&global&&typeof global.cineCoreRuntimeHelpers=="object"&&c.push(global.cineCoreRuntimeHelpers),typeof require=="function")try{const f=require("./app-core-runtime-helpers.js");f&&typeof f=="object"&&c.push(f)}catch{}for(let f=0;f<c.length;f+=1){const p=c[f];if(p&&typeof p=="object")return p}return null}const u=typeof CORE_PART2_RUNTIME_HELPERS=="object"&&CORE_PART2_RUNTIME_HELPERS?CORE_PART2_RUNTIME_HELPERS:null,d=l()||{};console.log("app-core-new-2.js: CORE_RUNTIME_FALLBACKS resolved");const m=(function(){const f=[];if(typeof require=="function")try{const g=require("./app-core-runtime-ui.js");g&&typeof g=="object"&&f.push(g)}catch{}const p=[];try{typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&p.push(CORE_GLOBAL_SCOPE)}catch{}try{typeof CORE_PART2_RUNTIME_SCOPE<"u"&&CORE_PART2_RUNTIME_SCOPE&&p.push(CORE_PART2_RUNTIME_SCOPE)}catch{}typeof globalThis<"u"&&globalThis&&p.push(globalThis),typeof window<"u"&&window&&p.push(window),typeof self<"u"&&self&&p.push(self),typeof global<"u"&&global&&p.push(global);for(let g=0;g<p.length;g+=1){const S=p[g];if(S)try{const E=S.cineCoreRuntimeUiBridge;E&&typeof E=="object"&&f.push(E)}catch{}}for(let g=0;g<f.length;g+=1){const S=f[g];if(S&&typeof S=="object")return S}return{}})();console.log("app-core-new-2.js: CORE_RUNTIME_UI_BRIDGE resolved");var y=typeof m.escapeHtml=="function"?m.escapeHtml:function(f){return String(f).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};const h=typeof m.setButtonLabelWithIcon=="function"?m.setButtonLabelWithIcon:function(f,p){if(!f)return;const g=typeof p=="string"?p:"";try{f.textContent=y(g)}catch{}},b=u&&typeof u.resolveAutoGearWeightHelpers=="function"?u.resolveAutoGearWeightHelpers({coreShared:a,globalScope:typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null}):null;console.log("app-core-new-2.js: autoGearHelpers resolved");const v=typeof d.fallbackNormalizeAutoGearWeightOperator=="function"?d.fallbackNormalizeAutoGearWeightOperator:function(){return"greater"},C=typeof d.fallbackNormalizeAutoGearWeightValue=="function"?d.fallbackNormalizeAutoGearWeightValue:function(){return null},A=typeof d.fallbackFormatAutoGearWeight=="function"?d.fallbackFormatAutoGearWeight:function(){return""},w=typeof d.fallbackGetAutoGearCameraWeightOperatorLabel=="function"?d.fallbackGetAutoGearCameraWeightOperatorLabel:function(f,p){const g=p||{},S=v(f);return S==="less"?g.autoGearCameraWeightOperatorLess||"":S==="equal"?g.autoGearCameraWeightOperatorEqual||"":g.autoGearCameraWeightOperatorGreater||""},R=typeof d.fallbackFormatAutoGearCameraWeight=="function"?d.fallbackFormatAutoGearCameraWeight:function(f,p){if(!f||!Number.isFinite(f.value))return"";const g=w(f.operator,p),S=A(f.value);return g?`${g} ${S} g`:`${S} g`},_=b&&typeof b.normalizeAutoGearWeightOperator=="function"?b.normalizeAutoGearWeightOperator:v;b&&typeof b.normalizeAutoGearWeightValue=="function"&&b.normalizeAutoGearWeightValue;const G=b&&typeof b.normalizeAutoGearCameraWeightCondition=="function"?b.normalizeAutoGearCameraWeightCondition:typeof d.fallbackNormalizeAutoGearCameraWeightCondition=="function"?d.fallbackNormalizeAutoGearCameraWeightCondition:function(){return null};b&&typeof b.formatAutoGearWeight=="function"&&b.formatAutoGearWeight;const O=b&&typeof b.getAutoGearCameraWeightOperatorLabel=="function"?b.getAutoGearCameraWeightOperatorLabel:function(f,p){return w(f,p)},B=b&&typeof b.formatAutoGearCameraWeight=="function"?b.formatAutoGearCameraWeight:R,$=u&&typeof u.resolveRuntimeScopeTools=="function"?u.resolveRuntimeScopeTools({runtimeScope:CORE_PART2_RUNTIME_SCOPE,sharedScope:r,globalScope:typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null}):null;let V=$&&Array.isArray($.runtimeScopeCandidates)?$.runtimeScopeCandidates:u&&typeof u.fallbackCreateRuntimeScopeCandidates=="function"?u.fallbackCreateRuntimeScopeCandidates(CORE_PART2_RUNTIME_SCOPE,r,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null):[];$&&$.runtimeScopeBridge&&$.runtimeScopeBridge;const M=$&&typeof $.readCoreScopeValue=="function"?$.readCoreScopeValue:u&&typeof u.fallbackReadCoreScopeValue=="function"?function(f){return u.fallbackReadCoreScopeValue(f,V)}:function(){},F=(c,f)=>{const p=f;let g=M(c);if(typeof g>"u"||g===null)try{const S=typeof CORE_PART2_RUNTIME_SCOPE<"u"&&CORE_PART2_RUNTIME_SCOPE||typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||null;S&&c in S&&(g=S[c])}catch{g=void 0}return typeof g>"u"||g===null?p:g},z=$&&typeof $.writeCoreScopeValue=="function"?$.writeCoreScopeValue:u&&typeof u.fallbackWriteCoreScopeValue=="function"?function(f,p){return u.fallbackWriteCoreScopeValue(f,p,V)}:function(){return!1},x=$&&typeof $.declareCoreFallbackBinding=="function"?$.declareCoreFallbackBinding:u&&typeof u.fallbackDeclareCoreFallbackBinding=="function"?function(f,p){return u.fallbackDeclareCoreFallbackBinding(f,p,V)}:function(f,p){return typeof p=="function"?p():p},H=V;var W=F("normalizePowerPortType",()=>[]),U=F("motorPriority",()=>0),j=F("controllerPriority",()=>0),Y=F("isArri",()=>!1),le=F("isArriOrCmotion",()=>!1),be=F("fizNeedsPower",()=>!1),re=F("fizPowerPort",()=>""),de=F("controllerDistancePort",()=>""),ne=F("controllerCamPort",()=>""),Ce=F("cameraFizPort",()=>""),Ee=F("motorFizPort",()=>""),Pe=F("getSelectedPlate",()=>null),et=F("isSelectedPlateNative",()=>!1);const Je=F("formatConnLabel",()=>""),it=F("connectionLabel",()=>""),rt=F("fizPort",()=>""),Pt=F("iconGlyph",()=>""),vt=F("ICON_FONT_KEYS",{});function bo(c,f){if(typeof c!="string"||!c)return null;const p=[];if(Array.isArray(f))for(let L=0;L<f.length;L+=1){const P=f[L];typeof P=="function"&&p.push(P)}else typeof f=="function"&&p.push(f);const g=L=>{if(!L||typeof L!="object"&&typeof L!="function")return null;try{const P=L[c];if(typeof P=="function"){for(let D=0;D<p.length;D+=1)if(P===p[D])return null;return P}}catch{}return null},S=[m,d,u];for(let L=0;L<S.length;L+=1){const P=g(S[L]);if(P)return P}if(Array.isArray(H))for(let L=0;L<H.length;L+=1){const P=H[L],D=g(P);if(D)return D}const E=[];typeof CORE_PART2_RUNTIME_SCOPE<"u"&&CORE_PART2_RUNTIME_SCOPE&&(typeof CORE_PART2_RUNTIME_SCOPE=="object"||typeof CORE_PART2_RUNTIME_SCOPE=="function")&&E.push(CORE_PART2_RUNTIME_SCOPE),r&&(typeof r=="object"||typeof r=="function")&&E.push(r),typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&(typeof CORE_GLOBAL_SCOPE=="object"||typeof CORE_GLOBAL_SCOPE=="function")&&E.push(CORE_GLOBAL_SCOPE),typeof globalThis<"u"&&globalThis&&E.push(globalThis),typeof window<"u"&&window&&E.push(window),typeof self<"u"&&self&&E.push(self),typeof global<"u"&&global&&E.push(global);for(let L=0;L<E.length;L+=1){const P=g(E[L]);if(P)return P}return null}function Et(c,f){const p=typeof f=="function"?f:function(E){return E};function g(){const S=Array.prototype.slice.call(arguments),E=bo(c,g);if(typeof E=="function")try{return E.apply(this,S)}catch{}return p.apply(this,S)}return g}function Ut(c){if(c==="__none__"){const f=typeof currentLang=="string"&&currentLang?currentLang:"en",p=typeof texts=="object"&&texts?texts[f]||texts.en||{}:{};return p.viewfinderExtensionNone||p.autoGearViewfinderExtensionNone||"No"}return typeof c=="string"?c:""}function ge(c){if(c==="__none__"){const f=typeof currentLang=="string"&&currentLang?currentLang:"en";return(typeof texts=="object"&&texts?texts[f]||texts.en||{}:{}).autoGearVideoDistributionNone||"No video distribution selected"}return typeof c=="string"?c:""}const ue=Et("getViewfinderFallbackLabel",Ut),We=Et("getVideoDistributionFallbackLabel",ge);function Me(c,f){if(typeof c!="string"||!c||typeof f!="function")return;const p=g=>{if(!(!g||typeof g!="object"&&typeof g!="function"))try{typeof g[c]!="function"&&(g[c]=f)}catch{}};typeof CORE_PART2_RUNTIME_SCOPE<"u"&&CORE_PART2_RUNTIME_SCOPE&&p(CORE_PART2_RUNTIME_SCOPE),p(r),typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&p(CORE_GLOBAL_SCOPE),typeof globalThis<"u"&&globalThis&&p(globalThis),typeof window<"u"&&window&&p(window),typeof self<"u"&&self&&p(self),typeof global<"u"&&global&&p(global)}Me("getViewfinderFallbackLabel",ue),Me("getVideoDistributionFallbackLabel",We),Me("clearMonitorVideoInputs",Gc),Me("ensureDefaultProjectInfoSnapshot",ns),Me("storeLoadedSetupState",ic),Me("attachSelectSearch",si),Me("clearViewfinderVideoInputs",Md),Me("clearVideoPowerInputs",Dd),Me("clearVideoInputs",$d),Me("clearVideoOutputsIO",Fd),Me("refreshDeviceLists",El),Me("clearMonitorVideoOutputs",Bd),Me("storeLoadedSetupState",ic),Me("attachSelectSearch",si),Me("powerInputTypes",pa),Me("checkSetupChanged",is),Me("hasProjectInfoData",rs),Me("getCurrentProjectInfo",dd),Me("getCurrentSetupKey",hl),Me("updateStorageSummary",Is);var Te=x("autoGearAutoPresetId",()=>{if(typeof loadAutoGearAutoPresetId=="function")try{const c=loadAutoGearAutoPresetId();return typeof c=="string"?c:""}catch(c){typeof console<"u"&&typeof console.error=="function"&&console.error("Failed to recover automatic gear auto preset identifier from storage.",c)}return""}),Be=x("baseAutoGearRules",()=>{if(typeof loadAutoGearRules=="function")try{const c=loadAutoGearRules();return Array.isArray(c)?c.slice():[]}catch(c){typeof console<"u"&&typeof console.error=="function"&&console.error("Failed to recover automatic gear rules from storage.",c)}return[]}),Ve=x("autoGearScenarioModeSelect",()=>null);x("safeGenerateConnectorSummary",()=>createFallbackSafeGenerateConnectorSummary());var je=null;let mt=null,ct="";var $t=!1,fo=!1;let no=null;const Nt=(function(f){if(f&&typeof f=="object"){const p=f.CORE_BOOT_QUEUE_KEY,g=f.__cineCoreBootQueueKey;if(typeof p=="string"&&p)return p;if(typeof g=="string"&&g)return g}return"__coreRuntimeBootQueue"})(r),xo=(function(f){if(Array.isArray(f))return f;if(r&&typeof r=="object"){const p=r.cineCoreShared;if(p&&typeof p=="object"){const g=p[Nt];if(Array.isArray(g))return g;if(Object.isExtensible(p))return p[Nt]=[],p[Nt]}return Array.isArray(r.CORE_BOOT_QUEUE)||(r.CORE_BOOT_QUEUE=[]),r.CORE_BOOT_QUEUE}return[]})(r&&r.CORE_BOOT_QUEUE);r&&r.CORE_BOOT_QUEUE!==xo&&(r.CORE_BOOT_QUEUE=xo);function Io(){if(!Array.isArray(xo)||xo.length===0)return;const c=xo.splice(0,xo.length);for(let f=0;f<c.length;f+=1){const p=c[f];if(typeof p=="function")try{p()}catch(g){typeof console<"u"&&typeof console.error=="function"&&console.error("Core boot task failed",g)}}}const qo=typeof globalThis<"u"&&globalThis.AUTO_GEAR_ANY_MOTOR_TOKEN?globalThis.AUTO_GEAR_ANY_MOTOR_TOKEN:"__any__",eo=typeof a.stableStringify=="function"?a.stableStringify:typeof a.fallbackStableStringify=="function"?a.fallbackStableStringify:typeof d.fallbackStableStringify=="function"?d.fallbackStableStringify:function(f){try{return JSON.stringify(f)}catch{}return String(f)},To=typeof a.humanizeKey=="function"?a.humanizeKey:typeof a.fallbackHumanizeKey=="function"?a.fallbackHumanizeKey:typeof d.fallbackHumanizeKey=="function"?d.fallbackHumanizeKey:function(f){const p=typeof f=="string"?f:String(f||"");return p.charAt(0).toUpperCase()+p.slice(1)},ko=(()=>{const c=[CORE_PART2_RUNTIME_SCOPE&&typeof CORE_PART2_RUNTIME_SCOPE=="object"?CORE_PART2_RUNTIME_SCOPE:null,typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null].filter(Boolean);for(let g=0;g<c.length;g+=1){const S=c[g];if(S&&S.deviceManagerLists instanceof Map)return S.deviceManagerLists}const f=new Map,p=c.find(g=>g&&Object.isExtensible(g));if(p)try{p.deviceManagerLists=f}catch{try{Object.defineProperty(p,"deviceManagerLists",{configurable:!0,writable:!0,value:f})}catch{}}return f})(),Jt=(()=>{const c=[CORE_PART2_RUNTIME_SCOPE&&typeof CORE_PART2_RUNTIME_SCOPE=="object"?CORE_PART2_RUNTIME_SCOPE:null,r&&typeof r=="object"?r:null,typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null].filter(Boolean);for(let p=0;p<c.length;p+=1){const g=c[p],S=g&&g.deviceManagerLists;if(S instanceof Map)return S}const f=ko instanceof Map?ko:new Map;for(let p=0;p<c.length;p+=1){const g=c[p];if(!(!g||!(typeof Object.isExtensible!="function"||Object.isExtensible(g))))try{g.deviceManagerLists=f}catch{try{Object.defineProperty(g,"deviceManagerLists",{configurable:!0,writable:!0,value:f})}catch{}}}return f})();function lr(c,f=[],p={}){if(typeof callCoreFunctionIfAvailable=="function")return callCoreFunctionIfAvailable(c,f,p);const g=r||(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null),S=g&&g[c];if(typeof S=="function"){try{return S.apply(g,f)}catch(E){typeof console<"u"&&typeof console.error=="function"&&console.error(`Failed to invoke ${c}`,E)}return}return p&&p.defer===!0&&Array.isArray(xo)&&xo.push(()=>{lr(c,f,{...p,defer:!1})}),p&&Object.prototype.hasOwnProperty.call(p,"defaultValue")?p.defaultValue:void 0}const mo=resolveCoreSupportModule("cineCoreAppRuntimeAutoGearCrew","./modules/app-core/runtime.js")||typeof globalThis<"u"&&globalThis.cineCoreAppRuntimeAutoGearCrew||typeof window<"u"&&window.cineCoreAppRuntimeAutoGearCrew||typeof self<"u"&&self.cineCoreAppRuntimeAutoGearCrew||typeof global<"u"&&global.cineCoreAppRuntimeAutoGearCrew||(typeof require=="function"?(function(){try{return require("./modules/app-core/runtime.js")}catch{return console.log("DEBUG: app-core-new-2.js line 1000 REACHED"),null}})():null),go=mo&&typeof mo.createAutoGearCrewOptionHelpers=="function"?mo.createAutoGearCrewOptionHelpers({documentRef:typeof document<"u"?document:null,collectSelectedValues:s,computeMultiSelectSize:computeAutoGearMultiSelectSize,getCrewRoleEntries,autoGearFlexMinRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS,getLocalizedTexts:()=>texts[currentLang]||texts.en||{},getDefaultLanguageTexts:()=>texts.en||{}}):null,So=go&&typeof go.refreshCrewOptions=="function"?go.refreshCrewOptions:function(f,p,g){if(!f||typeof document>"u")return;const S=s(p,g);f.innerHTML="",f.multiple=!0;const E=getCrewRoleEntries(),L=new Set,P=(q,ie)=>{if(!q||L.has(q))return;const se=document.createElement("option");se.value=q,se.textContent=ie,S.includes(q)&&(se.selected=!0),f.appendChild(se),L.add(q)};E.forEach(q=>P(q.value,q.label)),S.forEach(q=>{L.has(q)||P(q,q)});const D=Array.from(f.options||[]).filter(q=>!q.disabled);f.size=computeAutoGearMultiSelectSize(D.length,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})},k=go&&typeof go.getCrewRoleLabel=="function"?go.getCrewRoleLabel:function(f){if(typeof f!="string")return"";const p=f.trim();return p?((texts[currentLang]||texts.en||{}).crewRoles||texts.en?.crewRoles||{})?.[p]||p:""};function Q(c){if(!autoGearCameraSelect)return;const f=s(c,"camera");autoGearCameraSelect.innerHTML="",autoGearCameraSelect.multiple=!0;const p=new Set,g=E=>{if(!E||p.has(E))return;const L=document.createElement("option");L.value=E,L.textContent=E,f.includes(E)&&(L.selected=!0),autoGearCameraSelect.appendChild(L),p.add(E)};cameraSelect&&Array.from(cameraSelect.options||[]).forEach(E=>{if(!E||!E.value||E.value==="None")return;const L=(E.textContent||E.value||"").trim();L&&g(L)}),f.forEach(E=>{p.has(E)||g(E)});const S=Array.from(autoGearCameraSelect.options||[]).filter(E=>!E.disabled).length;autoGearCameraSelect.size=computeAutoGearMultiSelectSize(S)}function X(c){const f=c&&typeof c=="object"&&!Array.isArray(c)?c:Array.isArray(c)&&c.length?c.length>=2?{operator:c[0],value:c[1]}:{value:c[0]}:so?.cameraWeight?so.cameraWeight:null,p=_(f?.operator);autoGearCameraWeightOperator&&(autoGearCameraWeightOperator.value=p);const g=G(f);Vn&&(g?Vn.value=String(g.value):f&&typeof f?.value=="string"?Vn.value=f.value:f&&typeof f?.value=="number"&&Number.isFinite(f.value)?Vn.value=String(Math.round(f.value)):Vn.value="")}function ae(){if(!so)return;if(!isAutoGearConditionActive("cameraWeight")){so.cameraWeight=null;return}const c=autoGearCameraWeightOperator?autoGearCameraWeightOperator.value:"",f=Vn?Vn.value:"",p=G({operator:c,value:f});p?so.cameraWeight={...p}:c?so.cameraWeight={operator:_(c),value:null}:so.cameraWeight=null}function Ae(){if(!so)return;if(!isAutoGearConditionActive("shootingDays")){so.shootingDays=null;return}const c=Ki?Ki.value:"minimum",f=Wi?Wi.value:"",p=normalizeAutoGearShootingDaysCondition({mode:c,value:f});if(p){so.shootingDays={...p};return}const g=typeof normalizeAutoGearShootingDayMode=="function"?normalizeAutoGearShootingDayMode(c):typeof c=="string"&&c?c.trim().toLowerCase():"minimum";g?so.shootingDays={mode:g,value:null}:so.shootingDays=null}function Se(c){if(!autoGearMonitorSelect)return;const f=s(c,"monitor");autoGearMonitorSelect.innerHTML="",autoGearMonitorSelect.multiple=!0;const p=new Set,g=E=>{if(!E||p.has(E))return;const L=document.createElement("option");L.value=E,L.textContent=E,f.includes(E)&&(L.selected=!0),autoGearMonitorSelect.appendChild(L),p.add(E)};monitorSelect&&Array.from(monitorSelect.options||[]).forEach(E=>{if(!E||!E.value||E.value==="None")return;const L=(E.textContent||E.value||"").trim();L&&g(L)}),f.forEach(E=>{p.has(E)||g(E)});const S=Array.from(autoGearMonitorSelect.options||[]).filter(E=>!E.disabled).length;autoGearMonitorSelect.size=computeAutoGearMultiSelectSize(S)}function Oe(c,f,p,g,S){if(!c)return;const E=s(f,p);c.innerHTML="",c.multiple=!0;const P=(texts[currentLang]||texts.en||{})[g]||texts.en?.[g]||"Select options",D=collectAutoGearTripodNames(S).map(te=>typeof te=="string"?{value:te,label:te}:te).filter(Boolean),q=new Set,ie=(te,ye)=>{if(typeof te!="string")return;const ve=te.trim();if(!ve)return;const Ke=ve.toLowerCase();if(q.has(Ke))return;const Ze=document.createElement("option");Ze.value=ve,Ze.textContent=ye||formatAutoGearSelectorValue(S,ve),E.includes(ve)&&(Ze.selected=!0),c.appendChild(Ze),q.add(Ke)};if(D.forEach(te=>{te&&ie(te.value,te.label)}),E.forEach(te=>{if(!te)return;const ye=te.trim().toLowerCase();ye&&!q.has(ye)&&ie(te,formatAutoGearSelectorValue(S,te))}),!c.options.length){const te=document.createElement("option");te.value="",te.textContent=P,te.disabled=!0,te.selected=!0,c.appendChild(te)}const se=Array.from(c.options||[]).filter(te=>!te.disabled).length;c.size=computeAutoGearMultiSelectSize(se,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})}function Ne(c){Oe(autoGearTripodHeadBrandSelect,c,"tripodHeadBrand","autoGearTripodHeadBrandPlaceholder","tripodHeadBrand")}function Qe(c){Oe(autoGearTripodBowlSelect,c,"tripodBowl","autoGearTripodBowlPlaceholder","tripodBowl")}function Fe(c){Oe(autoGearTripodTypesSelect,c,"tripodTypes","autoGearTripodTypesPlaceholder","tripodTypes")}function _e(c){Oe(autoGearTripodSpreaderSelect,c,"tripodSpreader","autoGearTripodSpreaderPlaceholder","tripodSpreader")}function He(c){if(!autoGearWirelessSelect)return;const f=s(c,"wireless");autoGearWirelessSelect.innerHTML="",autoGearWirelessSelect.multiple=!0;const p=new Set,g=E=>{if(!E||p.has(E))return;const L=document.createElement("option");L.value=E,L.textContent=E,f.includes(E)&&(L.selected=!0),autoGearWirelessSelect.appendChild(L),p.add(E)};videoSelect&&Array.from(videoSelect.options||[]).forEach(E=>{if(!E||!E.value||E.value==="None")return;const L=(E.textContent||E.value||"").trim();L&&g(L)}),f.forEach(E=>{p.has(E)||g(E)});const S=Array.from(autoGearWirelessSelect.options||[]).filter(E=>!E.disabled).length;autoGearWirelessSelect.size=computeAutoGearMultiSelectSize(S)}function st(c){if(!autoGearMotorsSelect)return;const f=s(c,"motors"),p=texts[currentLang]||texts.en||{};autoGearMotorsSelect.innerHTML="",autoGearMotorsSelect.multiple=!0;const g=new Set,S=P=>{if(!P||g.has(P))return;const D=document.createElement("option");D.value=P,D.textContent=Fo(P,p),f.includes(P)&&(D.selected=!0),autoGearMotorsSelect.appendChild(D),g.add(P)};(Array.isArray(motorSelects)?motorSelects:[]).forEach(P=>{Array.from(P?.options||[]).forEach(D=>{if(!D||!D.value||D.value==="None")return;const q=(D.textContent||D.value||"").trim();q&&S(q)})}),f.forEach(P=>{g.has(P)||S(P)});const L=Array.from(autoGearMotorsSelect.options||[]).filter(P=>!P.disabled).length;autoGearMotorsSelect.size=computeAutoGearMultiSelectSize(L)}function at(c){if(!autoGearControllersSelect)return;const f=s(c,"controllers");autoGearControllersSelect.innerHTML="",autoGearControllersSelect.multiple=!0;const p=new Set,g=L=>{if(!L||p.has(L))return;const P=document.createElement("option");P.value=L,P.textContent=L,f.includes(L)&&(P.selected=!0),autoGearControllersSelect.appendChild(P),p.add(L)};(Array.isArray(controllerSelects)?controllerSelects:[]).forEach(L=>{Array.from(L?.options||[]).forEach(P=>{if(!P||!P.value||P.value==="None")return;const D=(P.textContent||P.value||"").trim();D&&g(D)})}),f.forEach(L=>{p.has(L)||g(L)});const E=Array.from(autoGearControllersSelect.options||[]).filter(L=>!L.disabled).length;autoGearControllersSelect.size=computeAutoGearMultiSelectSize(E)}function St(c){if(!autoGearDistanceSelect)return;const f=s(c,"distance");autoGearDistanceSelect.innerHTML="",autoGearDistanceSelect.multiple=!0;const p=new Set,g=E=>{if(!E||p.has(E))return;const L=document.createElement("option");L.value=E,L.textContent=E,f.includes(E)&&(L.selected=!0),autoGearDistanceSelect.appendChild(L),p.add(E)};distanceSelect&&Array.from(distanceSelect.options||[]).forEach(E=>{if(!E||!E.value||E.value==="None")return;const L=(E.textContent||E.value||"").trim();L&&g(L)}),f.forEach(E=>{p.has(E)||g(E)});const S=Array.from(autoGearDistanceSelect.options||[]).filter(E=>!E.disabled).length;autoGearDistanceSelect.size=computeAutoGearMultiSelectSize(S,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})}function kt(c,f){if(!c)return;const p=typeof f=="string"?f:"";c.innerHTML="",Array.from(GEAR_LIST_CATEGORIES).sort((E,L)=>E.localeCompare(L,currentLang||"en",{sensitivity:"base"})).forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p===E&&(L.selected=!0),c.appendChild(L)});const S=document.createElement("option");S.value=AUTO_GEAR_CUSTOM_CATEGORY,S.textContent=texts[currentLang]?.autoGearCustomCategory||texts.en?.autoGearCustomCategory||"Custom Additions",p||(S.selected=!0),c.appendChild(S)}function Zt(){if(!Bs)return;const c=collectAutoGearCatalogNames();Bs.innerHTML="",c.forEach(f=>{const p=document.createElement("option");p.value=f,Bs.appendChild(p)}),updateAutoGearMonitorCatalogOptions(),Ht()}function Ht(c=lu){const f=Array.isArray(c)?c:[c],p=getAutoGearMonitorDefaultPlaceholder();f.forEach(g=>{if(!g||!g.select||!Object.prototype.hasOwnProperty.call(AUTO_GEAR_MONITOR_DEFAULT_TYPES,g.key))return;const S=g.select,E=AUTO_GEAR_MONITOR_DEFAULT_TYPES[g.key],L=collectAutoGearMonitorNames(E==="directorMonitor"?"directorMonitor":"monitor"),P=S.value||"";S.innerHTML="";const D=document.createElement("option");D.value="",D.textContent=p,S.appendChild(D);const q=new Set([""]);L.forEach(te=>{if(!te)return;const ye=te.toLowerCase();if(q.has(ye))return;const ve=document.createElement("option");ve.value=te,ve.textContent=formatAutoGearSelectorValue(E,te),S.appendChild(ve),q.add(ye)});const ie=getAutoGearMonitorDefault(g.key);let se="";if(ie){const te=L.find(ye=>ye.toLowerCase()===ie.toLowerCase());if(te)se=te;else{const ye=document.createElement("option");ye.value=ie,ye.textContent=formatAutoGearSelectorValue(E,ie),S.appendChild(ye),se=ie}}S.value=se,!se&&P&&S.value!==P&&S.querySelector(`option[value="${P}"]`)&&(S.value=P),S.disabled=L.length===0&&!se})}function jo(){lu.forEach(c=>{if(!c||!c.select||!Object.prototype.hasOwnProperty.call(AUTO_GEAR_MONITOR_DEFAULT_TYPES,c.key))return;const f=c.select,p=AUTO_GEAR_MONITOR_DEFAULT_TYPES[c.key],g=getAutoGearMonitorDefault(c.key);if(g&&!Array.from(f.options||[]).some(E=>E.value===g)){const E=document.createElement("option");E.value=g,E.textContent=formatAutoGearSelectorValue(p,g),f.appendChild(E)}const S=g||"";f.value!==S&&(f.value=S)})}function ir(c,f,p){const g=texts[currentLang]||texts.en||{};if(c===1){const E=g[f]||texts.en?.[f];return E?E.replace("%s","1"):"1"}const S=g[p]||texts.en?.[p];return S?S.replace("%s",String(c)):String(c)}function sr(c,f={}){if(!c||typeof c!="object")return"";const p=normalizeAutoGearItem(c);if(!p)return"";const{quantity:g,name:S,category:E,screenSize:L,selectorType:P,selectorDefault:D,selectorEnabled:q,notes:ie}=p,se=texts[currentLang]||texts.en||{},te=!!f.includeSign,ye=f.listType||(f.includeSign?"add":""),ve=f.includeCategory!==!1,Ke=normalizeAutoGearQuantity(g),Ze=te?ye==="remove"?"−":"+":"",ut=Ze?`${Ze}${Ke}`:String(Ke),Ft=S||"";if(!Ft)return ut;const Mo=E||se.autoGearCustomCategory||texts.en?.autoGearCustomCategory||"";let Yt;if(ve&&Mo){const Bt=se.autoGearItemSummaryWithCategory||texts.en?.autoGearItemSummaryWithCategory||"%s × %s (%s)";Yt=Ro(Bt,ut,Ft,Mo)}else{const Bt=se.autoGearItemSummary||texts.en?.autoGearItemSummary||"%s × %s";Yt=Ro(Bt,ut,Ft)}const oo=[];if(L&&oo.push(L),P&&P!=="none"){const Bt=getAutoGearSelectorLabel(P),_r=D?formatAutoGearSelectorValue(P,D):"";if(q){const At=_r?se.autoGearSelectorSummaryWithDefault||texts.en?.autoGearSelectorSummaryWithDefault||"%s selector (default: %s)":se.autoGearSelectorSummary||texts.en?.autoGearSelectorSummary||"%s selector",gt=_r?Ro(At,Bt,_r):Ro(At,Bt);oo.push(gt)}else if(_r){const At=se.autoGearSelectorSummaryNoSelector||texts.en?.autoGearSelectorSummaryNoSelector||"%s default: %s";oo.push(Ro(At,Bt,_r))}else Bt&&oo.push(Bt)}if(ie&&oo.push(ie),p.ownGearId){const Bt=se.autoGearOwnGearBadge||texts.en?.autoGearOwnGearBadge||"Own gear";oo.push(Bt)}return oo.length&&(Yt+=` – ${oo.join(" – ")}`),Yt}function Ro(c,...f){return typeof c!="string"?f.join(" "):f.reduce((p,g)=>p.replace("%s",g),c)}function Ot(c){const f=texts[currentLang]||texts.en||{};if(c===1){const g=f.autoGearRulesCountOne||texts.en?.autoGearRulesCountOne;return g?g.replace("%s","1"):"1"}const p=f.autoGearRulesCountOther||texts.en?.autoGearRulesCountOther;return p?p.replace("%s",String(c)):String(c)}let Lr=null,Co="";function hr(){const c=vn(currentLang);if(Lr&&Co===c)return Lr;if(typeof Intl<"u"&&typeof Intl.DateTimeFormat=="function")try{return Lr=new Intl.DateTimeFormat(c,{dateStyle:"medium",timeStyle:"short"}),Co=c,Lr}catch(f){console.warn("Failed to create automatic gear backup date formatter",f)}return null}let Wo="",Yo=null,Tt=[],$o=[],br=null,Do=null,ur=null,or=null;function Vo(c){const f=texts[currentLang]||texts.en||{},p=texts.en||{};if(c===1){const S=f.storageAutoBackupsCountOne||p.storageAutoBackupsCountOne;return typeof S=="string"&&S.includes("%s")?S.replace("%s","1"):"1 auto backup"}const g=f.storageAutoBackupsCountOther||p.storageAutoBackupsCountOther;return typeof g=="string"&&g.includes("%s")?g.replace("%s",String(c)):`${c} auto backups`}function Po(c){if(typeof c!="string")return"";const f=new Date(c);if(Number.isNaN(f.valueOf()))return c;const p=hr();if(p)try{return p.format(f)}catch(g){console.warn("Failed to format automatic gear backup timestamp",g)}return typeof f.toLocaleString=="function"?f.toLocaleString():f.toISOString()}function co(c){if(!c)return"";const f=texts[currentLang]||texts.en||{},p=Po(c.createdAt),g=Array.isArray(c.rules)?c.rules.length:0,S=g===0?f.autoGearBackupClearsRules||texts.en?.autoGearBackupClearsRules||"Clears all rules":Ot(g),E=f.autoGearBackupMeta||texts.en?.autoGearBackupMeta,L=E&&E.includes("%s")?Ro(E,p,S):`${p} · ${S}`,P=typeof c.note=="string"?c.note.trim():"";return P?`${L} – ${P}`:L}function mr(){return texts[currentLang]?.autoGearBackupSelectPlaceholder||texts.en?.autoGearBackupSelectPlaceholder||"Select a backup to restore"}function Sr(){if(!Yi)return;const c=!!(Mn&&Mn.value);Yi.disabled=!c}function jr(c=""){Wo=typeof c=="string"?c:"",autoGearBackupRetentionWarning&&(Wo?(autoGearBackupRetentionWarning.textContent=Wo,autoGearBackupRetentionWarning.hidden=!1):(autoGearBackupRetentionWarning.textContent="",autoGearBackupRetentionWarning.hidden=!0))}function Qr(){const c=clampAutoGearBackupRetentionLimit(autoGearBackupRetention);if(vi&&(vi.setAttribute("min",String(globalThis.AUTO_GEAR_BACKUP_RETENTION_MIN_VALUE)),vi.setAttribute("max",String(AUTO_GEAR_BACKUP_RETENTION_MAX)),vi.value!==String(c)&&(vi.value=String(c))),autoGearBackupRetentionSummary){const f=texts[currentLang]?.autoGearBackupRetentionSummary||texts.en?.autoGearBackupRetentionSummary||"Keeping the latest {limit}. Currently {stored} stored.",p=Vo(c),g=Vo($o.length),S=f.replace("{limit}",p).replace("{stored}",g);autoGearBackupRetentionSummary.textContent=S}jr(Wo)}function an(c){return c&&Tt.find(f=>f.id===c)||null}function Sn(){return(texts[currentLang]||texts.en||{}).autoGearAutoPresetLabel||texts.en?.autoGearAutoPresetLabel||"Autosaved rules"}function Re(c,f={}){const p=typeof c=="string"?c:"",g=f.persist!==!1,S=f.skipRender===!0;if(Te===p){S||K();return}Te=p,z("autoGearAutoPresetId",Te),g&&persistAutoGearAutoPresetId(Te),S||K()}function Ye(c={}){if(!Te)return c.persist!==!1&&persistAutoGearAutoPresetId(""),!1;const f=Tt.some(g=>g.id===Te),p=Tt.some(g=>g.id!==Te);return!f||p?(Re("",{persist:c.persist!==!1,skipRender:c.skipRender===!0}),!0):!1}function ke(c){const f=Array.isArray(c)?c:[];if(Ye({persist:!0,skipRender:!0}),!Te){if(Tt.length>0)return!1;const E=Sn(),L=normalizeAutoGearPreset({id:generateAutoGearId("preset"),label:E,rules:f});return L?(Tt.push(L),Tt=sortAutoGearPresets(Tt.slice()),persistAutoGearPresets(Tt),Re(L.id,{persist:!0,skipRender:!0}),ee(L.id,{persist:!0,skipRender:!0}),!0):!1}const p=Tt.findIndex(E=>E.id===Te);if(p===-1)return Re("",{persist:!0,skipRender:!0}),!1;if(Tt.length>1)return Re("",{persist:!0,skipRender:!0}),!1;const g=Tt[p],S=normalizeAutoGearPreset({id:g.id,label:g.label,rules:f});return S?(g.fingerprint!==S.fingerprint&&(Tt[p]=S,Tt=sortAutoGearPresets(Tt.slice()),persistAutoGearPresets(Tt)),ee(S.id,{persist:!0,skipRender:!0}),g.fingerprint!==S.fingerprint):(Tt.splice(p,1),Tt=sortAutoGearPresets(Tt.slice()),persistAutoGearPresets(Tt),Re("",{persist:!0,skipRender:!0}),ee("",{persist:!0,skipRender:!0}),!0)}function ee(c,f={}){const p=typeof c=="string"?c:"",g=f.persist!==!1,S=f.skipRender===!0;if(Yo===p){S||K();return}Yo=p,g&&persistActiveAutoGearPresetId(Yo),S||K()}function I(){if(Array.isArray(Be))return Be;const c=M("baseAutoGearRules");if(Array.isArray(c))return c;for(let f=0;f<H.length;f+=1){const p=H[f];if(!(!p||typeof p!="object"))try{const g=p.baseAutoGearRules;if(Array.isArray(g))return g}catch{}}return[]}function N(c={}){const f=c.skipRender===!0,p=I(),g=createAutoGearRulesFingerprint(p),S=Tt.find(E=>E.fingerprint===g)||null;S?ee(S.id,{persist:!0,skipRender:!0}):Yo&&ee("",{persist:!0,skipRender:!0}),f||K()}function K(){if(!autoGearPresetSelect)return;const c=texts[currentLang]?.autoGearPresetPlaceholder||texts.en?.autoGearPresetPlaceholder||"Custom rules",f=sortAutoGearPresets(Tt.slice());Tt=f,autoGearPresetSelect.innerHTML="";const p=document.createElement("option");p.value="",p.textContent=c,autoGearPresetSelect.appendChild(p),f.forEach(S=>{const E=document.createElement("option");E.value=S.id,E.textContent=S.label,autoGearPresetSelect.appendChild(E)});const g=Yo||"";autoGearPresetSelect.value=g,g||(p.selected=!0),autoGearPresetSelect.disabled=f.length===0,autoGearPresetSelect.setAttribute("aria-disabled",f.length===0?"true":"false"),autoGearDeletePresetButton&&(autoGearDeletePresetButton.disabled=!Yo)}let oe=null,ce=null,me="",De=null,Ge=null,Ue=!1;function Xe(){if(br)return br;if(typeof document>"u")return null;const c=document.getElementById("autoGearPresetPanel");if(!c)return null;const f=document.createElement("div");f.className="auto-gear-preset-name-dialog",f.hidden=!0,f.setAttribute("aria-hidden","true"),f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true");const p=document.createElement("div");p.className="auto-gear-preset-name-card";const g=document.createElement("form");g.className="auto-gear-preset-name-form";const S=document.createElement("label");S.className="auto-gear-preset-name-label",S.id="autoGearPresetNamePromptLabel",S.setAttribute("for","autoGearPresetNameInput");const E=document.createElement("input");E.type="text",E.id="autoGearPresetNameInput",E.className="auto-gear-preset-name-input",E.autocomplete="off",E.spellcheck=!0;const L=document.createElement("p");L.id="autoGearPresetNameError",L.className="auto-gear-preset-name-error",L.setAttribute("aria-live","polite");const P=document.createElement("div");P.className="dialog-actions";const D=document.createElement("button");D.type="button";const q=document.createElement("button");return q.type="submit",P.append(D,q),g.append(S,E,L,P),p.appendChild(g),f.appendChild(p),c.appendChild(f),f.setAttribute("aria-labelledby",S.id),E.setAttribute("aria-describedby",L.id),br=f,Do=S,ur=E,or=L,oe=D,ce=q,g.addEventListener("submit",ot),D.addEventListener("click",Lt),f.addEventListener("keydown",Le),br}function ft(){return[ur,oe,ce].filter(c=>c&&typeof c.focus=="function"&&!c.disabled)}function Le(c){if(!(!br||br.hidden)){if(c.key==="Escape"){c.preventDefault(),Lt();return}if(c.key==="Tab"){const f=ft();if(!f.length)return;const p=document.activeElement;let g=f.indexOf(p);g===-1&&(g=0),c.shiftKey?g=(g-1+f.length)%f.length:g=(g+1)%f.length,c.preventDefault();const S=f[g];S&&S.focus({preventScroll:!0})}}}function ot(c){if(c&&c.preventDefault(),!ur)return;const f=ur.value.trim();if(!f){or&&me&&(or.textContent=me),ur.focus({preventScroll:!0}),ur.select();return}_t(f)}function _t(c){if(!br)return;br.classList.remove("is-visible"),br.setAttribute("aria-hidden","true"),br.hidden=!0,or&&(or.textContent=""),ur&&(ur.value=""),me="";const f=De;if(De=null,typeof f=="function"?f():autoGearSavePresetButton&&typeof autoGearSavePresetButton.focus=="function"&&autoGearSavePresetButton.focus({preventScroll:!0}),Ge){const{resolve:p}=Ge;Ge=null,p(typeof c=="string"?c:null)}}function Lt(){_t(null)}function Qt(c,f,p){if(typeof window<"u"&&typeof window.prompt=="function"){let P,D=null;const q=Date.now();try{P=window.prompt(c,f)}catch(te){D=te}const ie=Date.now()-q;if(typeof P=="string")return Promise.resolve(P.trim());const se=D||ie<20;if(!se&&P===null)return Promise.resolve(null);se&&console.warn("Prompt unavailable, falling back to inline auto gear preset dialog",D)}const g=Xe();if(!g)return Promise.resolve(f?f.trim():"");const S=texts[currentLang]?.autoGearSavePresetButton||texts.en?.autoGearSavePresetButton||"Save preset",E=texts[currentLang]?.autoGearCancelEdit||texts.en?.autoGearCancelEdit||"Cancel";me=p,Do&&(Do.textContent=c),ce&&(ce.textContent=S,ce.setAttribute("aria-label",S)),oe&&(oe.textContent=E,oe.setAttribute("aria-label",E)),or&&(or.textContent=""),ur&&(ur.value=f||""),g.hidden=!1,g.setAttribute("aria-hidden","false"),g.classList.add("is-visible");const L=typeof document<"u"?document.activeElement:null;return De=()=>{L&&typeof L.focus=="function"?L.focus({preventScroll:!0}):autoGearSavePresetButton&&typeof autoGearSavePresetButton.focus=="function"&&autoGearSavePresetButton.focus({preventScroll:!0})},setTimeout(()=>{ur&&(ur.focus({preventScroll:!0}),ur.select())},0),new Promise(P=>{Ge={resolve:P}})}function Gt(){const c=!!Ue;autoGearShowBackupsCheckbox&&(autoGearShowBackupsCheckbox.checked=c,autoGearShowBackupsCheckbox.setAttribute("aria-pressed",c?"true":"false")),autoGearBackupsSection&&(autoGearBackupsSection.classList.toggle("auto-gear-backups-collapsed",!c),autoGearBackupsSection.setAttribute("aria-expanded",c?"true":"false")),autoGearBackupControls&&(autoGearBackupControls.hidden=!c,autoGearBackupControls.setAttribute("aria-hidden",c?"false":"true")),autoGearBackupsHiddenNotice&&(autoGearBackupsHiddenNotice.hidden=c),c?Sr():(Mn&&(Mn.disabled=!0),Yi&&(Yi.disabled=!0))}function ho(c){const f=!!c;if(Ue===f){Gt();return}Ue=f,persistAutoGearBackupVisibility(Ue),Ue?ao():Gt()}function Qo(c){if(!c||!autoGearPresetSelect)return;const f=c.target.value;if(!f){ee("",{persist:!0});return}const p=an(f);if(!p){ee("",{persist:!0}),K();return}const g=texts[currentLang]?.autoGearPresetApplyConfirm||texts.en?.autoGearPresetApplyConfirm||`Replace your automatic gear rules with the preset "${p.label}"?`,S=g.includes("%s")?Ro(g,p.label):g,E=()=>{setAutoGearRules(p.rules),Zt(),yr();const L=texts[currentLang]?.autoGearPresetApplied||texts.en?.autoGearPresetApplied||"Preset applied.";showNotification("success",L)};if(typeof window.cineShowConfirmDialog=="function"){window.cineShowConfirmDialog({title:texts[currentLang]?.autoGearPresetApplyTitle||"Apply Preset",message:S,confirmLabel:texts[currentLang]?.apply||"Apply",cancelLabel:texts[currentLang]?.cancel||"Cancel",onConfirm:E,onCancel:()=>{autoGearPresetSelect.value=Yo||""}});return}console.warn("Missing window.cineShowConfirmDialog for handleAutoGearPresetSelection")}async function Xo(){const c=getAutoGearRules(),f=an(Yo),p=Te,g=texts[currentLang]?.autoGearPresetNamePrompt||texts.en?.autoGearPresetNamePrompt||"Name this preset",S=f?f.label:"",E=texts[currentLang]?.autoGearPresetNameRequired||texts.en?.autoGearPresetNameRequired||"Enter a preset name to continue.",L=await Qt(g,S,E);if(L===null)return;const P=typeof L=="string"?L.trim():"";if(!P){typeof window.alert=="function"&&window.alert(E);return}const D=P,q=Tt.find(Ke=>Ke.label.toLowerCase()===D.toLowerCase());let ie=f?.id||"";if(q&&q.id!==ie){const Ke=texts[currentLang]?.autoGearPresetOverwriteConfirm||texts.en?.autoGearPresetOverwriteConfirm||`Replace the existing preset "${D}"?`,Ze=Ke.includes("%s")?Ro(Ke,D):Ke;let ut=!0;if(typeof window.cineShowConfirmDialog=="function")ut=await new Promise(Ft=>{window.cineShowConfirmDialog({title:texts[currentLang]?.autoGearPresetOverwriteTitle||"Overwrite Preset",message:Ze,confirmLabel:texts[currentLang]?.save||"Save",cancelLabel:texts[currentLang]?.cancel||"Cancel",onConfirm:()=>Ft(!0),onCancel:()=>Ft(!1)})});else{console.warn("Missing window.cineShowConfirmDialog for handleAutoGearSavePreset");return}if(!ut)return;ie=q.id}const se=ie||generateAutoGearId("preset"),te=normalizeAutoGearPreset({id:se,label:D,rules:c});if(!te){const Ke=texts[currentLang]?.autoGearPresetNameRequired||texts.en?.autoGearPresetNameRequired||"Enter a preset name to continue.";typeof window.alert=="function"&&window.alert(Ke);return}p&&Re("",{persist:!0,skipRender:!0});const ye=Tt.findIndex(Ke=>Ke.id===te.id);if(ye>=0)Tt[ye]=te;else{if(p){const Ke=Tt.findIndex(Ze=>Ze&&Ze.id===p);Ke>=0&&Tt.splice(Ke,1)}Tt.push(te)}Tt=sortAutoGearPresets(Tt.slice()),persistAutoGearPresets(Tt),ee(te.id,{persist:!0,skipRender:!0}),K();const ve=texts[currentLang]?.autoGearPresetSaved||texts.en?.autoGearPresetSaved||"Automatic gear preset saved.";showNotification("success",ve)}function No(){if(!Yo)return;const c=an(Yo),f=c?c.label:"",p=texts[currentLang]?.autoGearPresetDeleteConfirm||texts.en?.autoGearPresetDeleteConfirm||"Delete this preset?",g=f&&p.includes("%s")?Ro(p,f):p,S=()=>{Te&&Te===Yo&&Re("",{persist:!0,skipRender:!0}),Tt=Tt.filter(L=>L.id!==Yo),Tt=sortAutoGearPresets(Tt.slice()),persistAutoGearPresets(Tt),ee("",{persist:!0,skipRender:!0}),K();const E=texts[currentLang]?.autoGearPresetDeleted||texts.en?.autoGearPresetDeleted||"Automatic gear preset deleted.";showNotification("success",E)};if(typeof window.cineShowConfirmDialog=="function"){window.cineShowConfirmDialog({title:texts[currentLang]?.autoGearPresetDeleteTitle||"Delete Preset",message:g,confirmLabel:texts[currentLang]?.delete||"Delete",cancelLabel:texts[currentLang]?.cancel||"Cancel",danger:!0,onConfirm:S});return}console.warn("Missing window.cineShowConfirmDialog for handleAutoGearDeletePreset")}function ao(){if(!Mn||!autoGearBackupEmptyMessage)return;const c=Mn.value,f=mr();Mn.innerHTML="";const p=document.createElement("option");p.value="",p.textContent=f,p.disabled=!0,Mn.appendChild(p);const g=new Set($o.map(E=>E.id)),S=c&&g.has(c);$o.forEach(E=>{const L=document.createElement("option");L.value=E.id,L.textContent=co(E),E.createdAt&&(L.title=E.createdAt),S&&E.id===c&&(L.selected=!0),Mn.appendChild(L)}),$o.length?(Mn.disabled=!1,autoGearBackupEmptyMessage.hidden=!0,S?(p.selected=!1,Mn.value=c):(p.selected=!0,Mn.value="")):(p.selected=!0,Mn.value="",Mn.disabled=!0,autoGearBackupEmptyMessage.hidden=!1),Sr(),Gt(),Qr()}function Ir(c){return!c||typeof c!="object"?{always:!1,scenarioLogic:"all",scenarioPrimary:"",scenarioMultiplier:1,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],deliveryResolution:[],videoDistribution:[],camera:[],ownGear:[],monitor:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],shootingDays:null}:{always:!!c.always,scenarioLogic:normalizeAutoGearScenarioLogic(c.scenarioLogic),scenarioPrimary:normalizeAutoGearScenarioPrimary(c.scenarioPrimary),scenarioMultiplier:normalizeAutoGearScenarioMultiplier(c.scenarioMultiplier),scenarios:Array.isArray(c.scenarios)?c.scenarios.slice():[],mattebox:Array.isArray(c.mattebox)?c.mattebox.slice():[],cameraHandle:Array.isArray(c.cameraHandle)?c.cameraHandle.slice():[],viewfinderExtension:Array.isArray(c.viewfinderExtension)?c.viewfinderExtension.slice():[],deliveryResolution:Array.isArray(c.deliveryResolution)?c.deliveryResolution.slice():[],videoDistribution:Array.isArray(c.videoDistribution)?c.videoDistribution.slice():[],camera:Array.isArray(c.camera)?c.camera.slice():[],ownGear:Array.isArray(c.ownGear)?c.ownGear.slice():[],monitor:Array.isArray(c.monitor)?c.monitor.slice():[],crewPresent:Array.isArray(c.crewPresent)?c.crewPresent.slice():[],crewAbsent:Array.isArray(c.crewAbsent)?c.crewAbsent.slice():[],wireless:Array.isArray(c.wireless)?c.wireless.slice():[],motors:Array.isArray(c.motors)?c.motors.slice():[],controllers:Array.isArray(c.controllers)?c.controllers.slice():[],distance:Array.isArray(c.distance)?c.distance.slice():[],shootingDays:c.shootingDays?normalizeAutoGearShootingDaysCondition(c.shootingDays):null}}function cr(c,f){if(!c||typeof c!="object")return null;const p=Number.isInteger(f)?f:0,g=typeof c.id=="string"&&c.id?c.id:`rule-${p+1}`,S=typeof c.label=="string"?c.label:"",E=c.enabled!==!1,L=Ir(c),P=Array.isArray(c.add)?c.add.map(autoGearItemSnapshot).filter(Boolean):[],D=Array.isArray(c.remove)?c.remove.map(autoGearItemSnapshot).filter(Boolean):[];return{id:g,label:S,index:p,position:p+1,enabled:E,add:P,remove:D,...L}}function Rr(c){if(!c||typeof c!="object")return null;const f=Number.isInteger(c.index)?c.index:0,p=Number.isInteger(c.position)?c.position:f+1,g=typeof c.id=="string"&&c.id?c.id:`rule-${p}`,S=typeof c.label=="string"?c.label:"",E=c.enabled!==!1;return{id:g,label:S,index:f,position:p,enabled:E}}function Er(c){const f=[],p=new Set;return(Array.isArray(c)?c:[]).forEach(g=>{if(!g||typeof g!="object")return;const S=g.id||`index-${g.index}`;p.has(S)||(p.add(S),f.push({...g}))}),f}function rr(c){const f=autoGearItemSnapshot(c);return f?eo({name:f.name||"",category:f.category||"",quantity:normalizeAutoGearQuantity(f.quantity),screenSize:f.screenSize||"",selectorType:f.selectorType||"none",selectorDefault:f.selectorDefault||"",selectorEnabled:!!f.selectorEnabled,notes:f.notes||""}):""}function $r(c){const f=Ir(c),p={...f,scenarios:f.scenarios.slice().sort(localeSort),mattebox:f.mattebox.slice().sort(localeSort),cameraHandle:f.cameraHandle.slice().sort(localeSort),viewfinderExtension:f.viewfinderExtension.slice().sort(localeSort),deliveryResolution:f.deliveryResolution.slice().sort(localeSort),videoDistribution:f.videoDistribution.slice().sort(localeSort),camera:f.camera.slice().sort(localeSort),ownGear:f.ownGear.slice().sort(localeSort),monitor:f.monitor.slice().sort(localeSort),crewPresent:f.crewPresent.slice().sort(localeSort),crewAbsent:f.crewAbsent.slice().sort(localeSort),wireless:f.wireless.slice().sort(localeSort),motors:f.motors.slice().sort(localeSort),controllers:f.controllers.slice().sort(localeSort),distance:f.distance.slice().sort(localeSort),shootingDays:f.shootingDays?{mode:f.shootingDays.mode,value:f.shootingDays.value}:null};return eo(p)}function Pr(){if(typeof document>"u")return[];const c=document.getElementById("requiredScenarios");if(!c)return[];const f=new Map;return Array.from(c.options||[]).forEach(p=>{const g=typeof p.value=="string"?p.value.trim():"";if(!g)return;const S=normalizeAutoGearTriggerValue(g)||g;f.has(S)||f.set(S,{value:g,label:p.textContent||g,normalized:S})}),Array.from(f.values()).sort((p,g)=>localeSort(p.label,g.label))}function Kt(c={}){const f=Array.isArray(c.rules)?c.rules:getAutoGearRules(),p=[];(Array.isArray(f)?f:[]).forEach((At,gt)=>{const xt=cr(At,gt);xt&&p.push(xt)});const g=p.filter(At=>At.enabled!==!1),S=p.filter(At=>At.enabled===!1),E={generatedAt:new Date().toISOString(),totalRules:g.length,allRules:p.length,disabledRules:Er(S.map(Rr).filter(Boolean))},L=Pr();if(!g.length)return E.duplicates={totalGroups:0,totalRules:0,groups:[]},E.conflicts={totalItems:0,totalRules:0,items:[]},E.net={addItems:0,addQuantity:0,removeItems:0,removeQuantity:0,netQuantity:0},E.scenarios={catalog:L,coverage:[],uncovered:L.map(At=>({value:At.value,label:At.label,normalized:At.normalized})),overlaps:[],rulesWithoutScenarios:[],total:L.length,coveredCount:0},E;const P=new Map,D=new Set;g.forEach(At=>{const gt=$r(At);P.has(gt)||P.set(gt,{triggers:Ir(At),rules:[]});const xt=Rr(At);xt&&P.get(gt).rules.push(xt)});const q=[];P.forEach(At=>{const gt=Er(At.rules);gt.length<=1||(gt.forEach(xt=>D.add(xt.id||`index-${xt.index}`)),q.push({triggers:At.triggers,rules:gt}))}),E.duplicates={totalGroups:q.length,totalRules:D.size,groups:q};const ie=new Map,se=new Set;g.forEach(At=>{const gt=Rr(At);gt&&(At.add.forEach(xt=>{const nt=rr(xt);nt&&(ie.has(nt)||ie.set(nt,{item:xt,adds:[],removes:[]}),ie.get(nt).adds.push(gt))}),At.remove.forEach(xt=>{const nt=rr(xt);nt&&(ie.has(nt)||ie.set(nt,{item:xt,adds:[],removes:[]}),ie.get(nt).removes.push(gt))}))});const te=[];ie.forEach(At=>{const gt=Er(At.adds),xt=Er(At.removes);!gt.length||!xt.length||(gt.forEach(nt=>se.add(nt.id||`index-${nt.index}`)),xt.forEach(nt=>se.add(nt.id||`index-${nt.index}`)),te.push({item:At.item,adds:gt,removes:xt}))}),E.conflicts={totalItems:te.length,totalRules:se.size,items:te};let ye=0,ve=0,Ke=0,Ze=0;g.forEach(At=>{At.add.forEach(gt=>{ye+=1,ve+=normalizeAutoGearQuantity(gt.quantity)}),At.remove.forEach(gt=>{Ke+=1,Ze+=normalizeAutoGearQuantity(gt.quantity)})}),E.net={addItems:ye,addQuantity:ve,removeItems:Ke,removeQuantity:Ze,netQuantity:ve-Ze};const ut=new Map;L.forEach(At=>{ut.set(At.normalized,At.label),ut.set(At.value,At.label)});const Ft=new Map;g.forEach(At=>{const gt=Rr(At);if(!gt)return;(Array.isArray(At.scenarios)?At.scenarios:[]).forEach(nt=>{if(typeof nt!="string")return;const Mt=nt.trim();if(!Mt)return;const lo=normalizeAutoGearTriggerValue(Mt)||Mt;Ft.has(lo)||Ft.set(lo,{value:Mt,normalized:lo,rules:[]}),Ft.get(lo).rules.push(gt)})});const Mo=Array.from(Ft.values()).map(At=>{const gt=Er(At.rules);return{value:At.value,normalized:At.normalized,label:ut.get(At.normalized)||ut.get(At.value)||At.value,rules:gt}}).sort((At,gt)=>localeSort(At.label,gt.label)),Yt=new Set(Mo.map(At=>At.normalized)),oo=L.filter(At=>!Yt.has(At.normalized)).map(At=>({value:At.value,label:At.label,normalized:At.normalized}));oo.sort((At,gt)=>localeSort(At.label,gt.label));const Bt=Mo.filter(At=>At.rules.length>1),_r=Er(g.filter(At=>!At.always&&(!Array.isArray(At.scenarios)||!At.scenarios.length)).map(Rr).filter(Boolean));return E.scenarios={catalog:L,coverage:Mo,uncovered:oo,overlaps:Bt,rulesWithoutScenarios:_r,total:L.length,coveredCount:Mo.length},E}function Oo(c,f){if(!c||typeof c!="object")return"";const p=c.label||f.autoGearRuleBadgeUnnamed||texts.en?.autoGearRuleBadgeUnnamed||"Automatic rule",g=c.enabled===!1?f.autoGearRuleDisabledLabel||texts.en?.autoGearRuleDisabledLabel||"Disabled":"",S=g?`${p} — ${g}`:p,E=Gr(currentLang,c.position||1);return c.label?(f.autoGearSummaryRuleReference||texts.en?.autoGearSummaryRuleReference||"Rule {position}: {label}").replace("{position}",E).replace("{label}",S):(f.autoGearSummaryRuleReferenceUntitled||texts.en?.autoGearSummaryRuleReferenceUntitled||"Rule {position}").replace("{position}",E)}function Dt(c){const f=texts.en||{};return(c||f).autoGearMotorsAny||f.autoGearMotorsAny||"Any motor selected"}function Fo(c,f){return(typeof c=="string"?c.trim().toLowerCase():"")===qo?Dt(f):c}function qr(c,f,p){if(!c)return"";const g=[];c.always&&g.push(p.autoGearAlwaysMeta||texts.en?.autoGearAlwaysMeta||"Always active");const S=new Map;(f?.scenarios?.catalog||[]).forEach(D=>{S.set(D.normalized,D.label),S.set(D.value,D.label)}),(f?.scenarios?.coverage||[]).forEach(D=>{S.set(D.normalized,D.label)});const E=D=>{const q=normalizeAutoGearTriggerValue(D)||D;return S.get(q)||D};if(Array.isArray(c.scenarios)&&c.scenarios.length){const D=c.scenarios.map(E).filter(Boolean),q=p.autoGearScenariosLabel||texts.en?.autoGearScenariosLabel||"Required scenarios";g.push(`${q}: ${Wa(currentLang,D)}`)}const L=normalizeAutoGearScenarioLogic(c.scenarioLogic);if(L){const D=L==="any"?p.autoGearScenarioModeAny||texts.en?.autoGearScenarioModeAny||"Match any selected scenario":L==="multiplier"?p.autoGearScenarioModeMultiplier||texts.en?.autoGearScenarioModeMultiplier||"Multiply when combined":p.autoGearScenarioModeAll||texts.en?.autoGearScenarioModeAll||"Require every selected scenario",q=p.autoGearScenarioModeLabel||texts.en?.autoGearScenarioModeLabel||"Scenario matching";let ie=D;if(L==="multiplier"){const se=p.autoGearScenarioFactorLabel||texts.en?.autoGearScenarioFactorLabel||"Multiplier factor",te=normalizeAutoGearScenarioMultiplier(c.scenarioMultiplier),ye=Gr(currentLang,te||1),ve=c.scenarioPrimary?E(c.scenarioPrimary):c.scenarios&&c.scenarios.length?E(c.scenarios[0]):"";ie=ve?`${D} (${se}: ×${ye}, ${ve})`:`${D} (×${ye})`}g.push(`${q}: ${ie}`)}if([{key:"mattebox",labelKey:"autoGearMatteboxLabel"},{key:"cameraHandle",labelKey:"autoGearCameraHandleLabel"},{key:"viewfinderExtension",labelKey:"autoGearViewfinderExtensionLabel",formatter:ue},{key:"deliveryResolution",labelKey:"autoGearDeliveryResolutionLabel"},{key:"videoDistribution",labelKey:"autoGearVideoDistributionLabel",formatter:We},{key:"camera",labelKey:"autoGearCameraLabel"},{key:"ownGear",labelKey:"autoGearConditionOwnGearLabel",formatter:D=>{if(typeof D!="string")return"";const q=D.trim();if(!q)return"";const ie=typeof findAutoGearOwnGearById=="function"?findAutoGearOwnGearById(q):null;return ie?(typeof formatAutoGearOwnGearLabel=="function"?formatAutoGearOwnGearLabel(ie):"")||ie.name||q:`${p.autoGearOwnGearMissing||texts.en?.autoGearOwnGearMissing||"Missing own gear"} (${q})`}},{key:"monitor",labelKey:"autoGearMonitorLabel"},{key:"crewPresent",labelKey:"autoGearCrewPresentLabel"},{key:"crewAbsent",labelKey:"autoGearCrewAbsentLabel"},{key:"wireless",labelKey:"autoGearWirelessLabel"},{key:"motors",labelKey:"autoGearMotorsLabel",formatter:D=>Fo(D,p)},{key:"controllers",labelKey:"autoGearControllersLabel"},{key:"distance",labelKey:"autoGearDistanceLabel"}].forEach(D=>{const q=Array.isArray(c[D.key])?c[D.key].filter(Boolean):[];if(!q.length)return;const ie=p[D.labelKey]||texts.en?.[D.labelKey]||D.labelKey,se=q.map(te=>{if(!D.formatter)return te;try{return D.formatter(te)}catch{return te}}).filter(Boolean);se.length&&g.push(`${ie}: ${Wa(currentLang,se)}`)}),Array.isArray(c.ownGear)&&c.ownGear.length){const D=normalizeAutoGearConditionLogic(c.ownGearLogic);if(D&&D!=="all"){const q=p.autoGearConditionLogicLabel||texts.en?.autoGearConditionLogicLabel||"Match behavior";let ie="";D==="none"?ie=p.autoGearConditionLogicNone||texts.en?.autoGearConditionLogicNone||"":D==="any"?ie=p.autoGearConditionLogicAny||texts.en?.autoGearConditionLogicAny||"":D==="or"?ie=p.autoGearConditionLogicOr||texts.en?.autoGearConditionLogicOr||"":D==="multiplier"&&(ie=p.autoGearConditionLogicMultiplier||texts.en?.autoGearConditionLogicMultiplier||""),ie&&g.push(`${q}: ${ie}`)}}if(c.shootingDays&&c.shootingDays.value){const D=p.autoGearShootingDaysLabel||texts.en?.autoGearShootingDaysLabel||"Shooting days condition",q=c.shootingDays.mode==="maximum"?"autoGearShootingDaysModeMaximum":c.shootingDays.mode==="every"?"autoGearShootingDaysModeEvery":"autoGearShootingDaysModeMinimum",ie=p[q]||texts.en?.[q]||c.shootingDays.mode,se=Gr(currentLang,c.shootingDays.value);g.push(`${D}: ${ie} ${se}`)}return g.join("; ")}function en(c,f={}){if(!autoGearSummarySection||!autoGearSummaryHeadingElem||!autoGearSummaryDescriptionElem||!autoGearSummaryCards||!autoGearSummaryDetails)return;const p=texts[currentLang]||texts.en||{},g=p.autoGearSummaryHeading||texts.en?.autoGearSummaryHeading||autoGearSummaryHeadingElem.textContent||"Rule coverage overview";if(autoGearSummaryHeadingElem.textContent=g,!c||typeof c.totalRules!="number"){autoGearSummarySection.hidden=!0;return}autoGearSummarySection.hidden=!1,autoGearSummaryCards.innerHTML="",autoGearSummaryDetails.innerHTML="";const S=c.totalRules,E=typeof f.filteredRules=="number"?f.filteredRules:S,L=typeof f.visibleRules=="number"?f.visibleRules:E,P=f.focus||autoGearSummaryFocus||"all",D=!!f.hasSearchFilters,q=!!f.focusApplied,ie=Array.isArray(c.disabledRules)?c.disabledRules:[],se=ie.length;typeof c.allRules=="number"?c.allRules:S+se;const te=typeof c.scenarios?.total=="number"?c.scenarios.total:Array.isArray(c.scenarios?.catalog)?c.scenarios.catalog.length:0,ye=typeof c.scenarios?.coveredCount=="number"?c.scenarios.coveredCount:Array.isArray(c.scenarios?.coverage)?c.scenarios.coverage.length:0,ve=Array.isArray(c.scenarios?.overlaps)?c.scenarios.overlaps.length:0,Ke=te>0,Ze=Ke&&te?Math.round(ye/te*100):0;if(!S&&!se){autoGearSummaryDescriptionElem.textContent=p.autoGearSummaryEmpty||texts.en?.autoGearSummaryEmpty||"Add a rule to unlock coverage insights.";return}if(!S&&se)autoGearSummaryDescriptionElem.textContent=p.autoGearSummaryAllDisabled||texts.en?.autoGearSummaryAllDisabled||"All automatic gear rules are disabled.";else if(D||P!=="all"&&P!=="uncovered"||q){const gt=p.autoGearSummaryFilteredDescription||texts.en?.autoGearSummaryFilteredDescription||"Showing {visible} of {total} rules after filters.";autoGearSummaryDescriptionElem.textContent=gt.replace("{visible}",Gr(currentLang,L)).replace("{filtered}",Gr(currentLang,E)).replace("{total}",Gr(currentLang,S))}else autoGearSummaryDescriptionElem.textContent=p.autoGearSummaryDescription||texts.en?.autoGearSummaryDescription||"Review duplicates, coverage gaps and conflicts before exporting or printing.";if(se&&S){const gt=p.autoGearSummaryDisabledSuffix||texts.en?.autoGearSummaryDisabledSuffix||"{count} disabled rules are ignored in coverage.";autoGearSummaryDescriptionElem.textContent=`${autoGearSummaryDescriptionElem.textContent} ${gt.replace("{count}",Gr(currentLang,se))}`.trim()}const ut=gt=>(gt===1?p.autoGearRulesCountOne||texts.en?.autoGearRulesCountOne||"%s rule":p.autoGearRulesCountOther||texts.en?.autoGearRulesCountOther||"%s rules").replace("%s",Gr(currentLang,gt)),Ft=Ke?`${Gr(currentLang,Ze)}%`:Gr(currentLang,ye),Mo=Ke?(p.autoGearSummaryCoverageDescription||texts.en?.autoGearSummaryCoverageDescription||"{covered} of {total} scenarios covered").replace("{covered}",Gr(currentLang,ye)).replace("{total}",Gr(currentLang,te)):p.autoGearSummaryCoverageEmpty||texts.en?.autoGearSummaryCoverageEmpty||"Add scenarios to measure coverage.",Yt=gt=>{const{label:xt,value:nt,description:Mt,focusKey:lo}=gt,tr=!!lo,xr=document.createElement(tr?"button":"div");xr.className="auto-gear-summary-card",tr&&(xr.type="button",xr.classList.add("auto-gear-summary-action"),xr.dataset.focus=lo,xr.setAttribute("aria-pressed",autoGearSummaryFocus===lo?"true":"false"));const nn=document.createElement("p");nn.className="auto-gear-summary-label",nn.textContent=xt;const xn=document.createElement("p");if(xn.className="auto-gear-summary-value",xn.textContent=nt,xr.appendChild(nn),xr.appendChild(xn),Mt){const Gn=document.createElement("p");Gn.className="auto-gear-summary-description",Gn.textContent=Mt,xr.appendChild(Gn)}autoGearSummaryCards.appendChild(xr)},oo=`${Gr(currentLang,c.net.addQuantity)} / −${Gr(currentLang,c.net.removeQuantity)}`;Yt({label:p.autoGearSummaryTotalLabel||texts.en?.autoGearSummaryTotalLabel||"Rules",value:Gr(currentLang,S),description:p.autoGearSummaryTotalDescription||texts.en?.autoGearSummaryTotalDescription||"Saved in this setup"}),Yt({label:p.autoGearSummaryCoverageLabel||texts.en?.autoGearSummaryCoverageLabel||"Scenario coverage",value:Ft,description:Mo}),Yt({label:p.autoGearSummaryNetLabel||texts.en?.autoGearSummaryNetLabel||"Net change",value:oo,description:(p.autoGearSummaryNetDescription||texts.en?.autoGearSummaryNetDescription||"Adds {adds} · Removes {removes}").replace("{adds}",Gr(currentLang,c.net.addItems)).replace("{removes}",Gr(currentLang,c.net.removeItems))}),Yt({label:p.autoGearSummaryDuplicatesLabel||texts.en?.autoGearSummaryDuplicatesLabel||"Duplicated triggers",value:Gr(currentLang,c.duplicates.totalGroups),description:c.duplicates.totalGroups?(p.autoGearSummaryDuplicatesSome||texts.en?.autoGearSummaryDuplicatesSome||"{rules} across {groups} groups").replace("{rules}",ut(c.duplicates.totalRules)).replace("{groups}",Gr(currentLang,c.duplicates.totalGroups)):p.autoGearSummaryDuplicatesNone||texts.en?.autoGearSummaryDuplicatesNone||"No duplicate triggers.",focusKey:"duplicates"}),Yt({label:p.autoGearSummaryConflictsLabel||texts.en?.autoGearSummaryConflictsLabel||"Potential conflicts",value:Gr(currentLang,c.conflicts.totalItems),description:c.conflicts.totalItems?(p.autoGearSummaryConflictsSome||texts.en?.autoGearSummaryConflictsSome||"{rules} affected across {items} items").replace("{rules}",ut(c.conflicts.totalRules)).replace("{items}",Gr(currentLang,c.conflicts.totalItems)):p.autoGearSummaryConflictsNone||texts.en?.autoGearSummaryConflictsNone||"No conflicting adds/removes.",focusKey:"conflicts"}),Yt({label:p.autoGearSummaryOverlapsLabel||texts.en?.autoGearSummaryOverlapsLabel||"Stacked scenarios",value:Gr(currentLang,ve),description:ve?(p.autoGearSummaryOverlapsSome||texts.en?.autoGearSummaryOverlapsSome||"{count} scenarios touched by multiple rules").replace("{count}",Gr(currentLang,ve)):p.autoGearSummaryOverlapsNone||texts.en?.autoGearSummaryOverlapsNone||"No scenarios currently stack multiple rules.",focusKey:"overlaps"}),Yt({label:p.autoGearSummaryUncoveredLabel||texts.en?.autoGearSummaryUncoveredLabel||"Uncovered scenarios",value:Gr(currentLang,c.scenarios.uncovered.length),description:c.scenarios.uncovered.length?(p.autoGearSummaryUncoveredSome||texts.en?.autoGearSummaryUncoveredSome||"Review {count} scenario gaps").replace("{count}",Gr(currentLang,c.scenarios.uncovered.length)):p.autoGearSummaryUncoveredNone||texts.en?.autoGearSummaryUncoveredNone||"All required scenarios covered.",focusKey:"uncovered"});const Bt=document.createDocumentFragment(),_r=document.createElement("p");_r.className="auto-gear-summary-detail-text",_r.textContent=p.autoGearSummaryDetailsIntro||texts.en?.autoGearSummaryDetailsIntro||"Use the dashboard to audit coverage, overlaps and conflicts before exporting or printing.",Bt.appendChild(_r);const At=(gt,xt)=>{const nt=p.autoGearSummaryJumpToRule||texts.en?.autoGearSummaryJumpToRule||"Show rule";xt.forEach((Mt,lo)=>{const tr=document.createElement("button");tr.type="button",tr.dataset.autoGearRule=Mt.id;const xr=Oo(Mt,p),nn=p.autoGearRuleDisabledLabel||texts.en?.autoGearRuleDisabledLabel||"Disabled";tr.textContent=xr,tr.setAttribute("title",nt),Mt.enabled===!1&&(tr.dataset.disabled="true",tr.setAttribute("aria-label",`${xr} — ${nn}`)),gt.appendChild(tr),lo<xt.length-1&&gt.appendChild(document.createTextNode(", "))})};if(se){const gt=document.createElement("p");if(gt.className="auto-gear-summary-detail-text auto-gear-summary-disabled-note",gt.textContent=p.autoGearSummaryDisabledNote||texts.en?.autoGearSummaryDisabledNote||"Disabled rules are visible below but ignored until re-enabled.",Bt.appendChild(gt),ie.length){const xt=document.createElement("ul");xt.className="auto-gear-summary-list";const nt=document.createElement("li");At(nt,ie),xt.appendChild(nt),Bt.appendChild(xt)}}if(P==="duplicates"){const gt=document.createElement("p");if(gt.className="auto-gear-summary-detail-title",gt.textContent=p.autoGearSummaryDetailsDuplicatesHeading||texts.en?.autoGearSummaryDetailsDuplicatesHeading||"Rules sharing the same triggers",Bt.appendChild(gt),c.duplicates.groups.length)c.duplicates.groups.forEach(xt=>{const nt=qr(xt.triggers,c,p),Mt=document.createElement("p");if(Mt.className="auto-gear-summary-detail-text",Mt.textContent=(p.autoGearSummaryDuplicateGroupTitle||texts.en?.autoGearSummaryDuplicateGroupTitle||"Matching triggers")+(nt?` — ${nt}`:""),Bt.appendChild(Mt),xt.rules.length){const lo=document.createElement("ul");lo.className="auto-gear-summary-list";const tr=document.createElement("li");At(tr,xt.rules),lo.appendChild(tr),Bt.appendChild(lo)}});else{const xt=document.createElement("p");xt.className="auto-gear-summary-detail-text",xt.textContent=p.autoGearSummaryDuplicatesNone||texts.en?.autoGearSummaryDuplicatesNone||"No duplicate triggers.",Bt.appendChild(xt)}}else if(P==="conflicts"){const gt=document.createElement("p");if(gt.className="auto-gear-summary-detail-title",gt.textContent=p.autoGearSummaryDetailsConflictsHeading||texts.en?.autoGearSummaryDetailsConflictsHeading||"Gear touched by adds and removes",Bt.appendChild(gt),c.conflicts.items.length)c.conflicts.items.forEach(xt=>{const nt=document.createElement("p");nt.className="auto-gear-summary-detail-text",nt.textContent=sr(xt.item),Bt.appendChild(nt);const Mt=document.createElement("ul");Mt.className="auto-gear-summary-list";const lo=document.createElement("li");lo.textContent=(p.autoGearSummaryConflictAddsLabel||texts.en?.autoGearSummaryConflictAddsLabel||"Added by")+": ",At(lo,xt.adds),Mt.appendChild(lo);const tr=document.createElement("li");tr.textContent=(p.autoGearSummaryConflictRemovesLabel||texts.en?.autoGearSummaryConflictRemovesLabel||"Removed by")+": ",At(tr,xt.removes),Mt.appendChild(tr),Bt.appendChild(Mt)});else{const xt=document.createElement("p");xt.className="auto-gear-summary-detail-text",xt.textContent=p.autoGearSummaryConflictsNone||texts.en?.autoGearSummaryConflictsNone||"No conflicting adds/removes.",Bt.appendChild(xt)}}else if(P==="overlaps"){const gt=document.createElement("p");if(gt.className="auto-gear-summary-detail-title",gt.textContent=p.autoGearSummaryDetailsOverlapsHeading||texts.en?.autoGearSummaryDetailsOverlapsHeading||"Scenarios with stacked rules",Bt.appendChild(gt),c.scenarios.overlaps.length){const xt=document.createElement("ul");xt.className="auto-gear-summary-list",c.scenarios.overlaps.forEach(nt=>{const Mt=document.createElement("li"),lo=document.createElement("button");lo.type="button",lo.dataset.autoGearScenario=nt.value,lo.textContent=`${nt.label} — ${ut(nt.rules.length)}`,lo.setAttribute("title",(p.autoGearSummarySetScenarioFilter||texts.en?.autoGearSummarySetScenarioFilter||"Filter to scenario").replace("{scenario}",nt.label)),Mt.appendChild(lo),nt.rules.length&&(Mt.appendChild(document.createTextNode(" · ")),At(Mt,nt.rules)),xt.appendChild(Mt)}),Bt.appendChild(xt)}else{const xt=document.createElement("p");xt.className="auto-gear-summary-detail-text",xt.textContent=p.autoGearSummaryDetailsOverlapsNone||texts.en?.autoGearSummaryDetailsOverlapsNone||"No scenarios currently stack multiple rules.",Bt.appendChild(xt)}}else if(P==="uncovered"){const gt=document.createElement("p");if(gt.className="auto-gear-summary-detail-title",gt.textContent=p.autoGearSummaryDetailsUncoveredHeading||texts.en?.autoGearSummaryDetailsUncoveredHeading||"Scenarios without dedicated rules",Bt.appendChild(gt),c.scenarios.uncovered.length){const xt=document.createElement("ul");xt.className="auto-gear-summary-list",c.scenarios.uncovered.forEach(nt=>{const Mt=document.createElement("li"),lo=document.createElement("button");lo.type="button",lo.dataset.autoGearScenario=nt.value,lo.textContent=nt.label,lo.setAttribute("title",(p.autoGearSummarySetScenarioFilter||texts.en?.autoGearSummarySetScenarioFilter||"Filter to scenario").replace("{scenario}",nt.label)),Mt.appendChild(lo),xt.appendChild(Mt)}),Bt.appendChild(xt)}else{const xt=document.createElement("p");xt.className="auto-gear-summary-detail-text",xt.textContent=p.autoGearSummaryUncoveredNone||texts.en?.autoGearSummaryUncoveredNone||"All required scenarios covered.",Bt.appendChild(xt)}}else{if(c.scenarios.overlaps.length){const gt=document.createElement("p");gt.className="auto-gear-summary-detail-title",gt.textContent=p.autoGearSummaryDetailsOverlapsHeading||texts.en?.autoGearSummaryDetailsOverlapsHeading||"Scenarios with stacked rules",Bt.appendChild(gt);const xt=document.createElement("ul");xt.className="auto-gear-summary-list",c.scenarios.overlaps.forEach(nt=>{const Mt=document.createElement("li"),lo=document.createElement("button");lo.type="button",lo.dataset.autoGearScenario=nt.value,lo.textContent=`${nt.label} — ${ut(nt.rules.length)}`,lo.setAttribute("title",(p.autoGearSummarySetScenarioFilter||texts.en?.autoGearSummarySetScenarioFilter||"Filter to scenario").replace("{scenario}",nt.label)),Mt.appendChild(lo),nt.rules.length&&(Mt.appendChild(document.createTextNode(" · ")),At(Mt,nt.rules)),xt.appendChild(Mt)}),Bt.appendChild(xt)}else{const gt=document.createElement("p");gt.className="auto-gear-summary-detail-text",gt.textContent=p.autoGearSummaryDetailsOverlapsNone||texts.en?.autoGearSummaryDetailsOverlapsNone||"No scenarios currently stack multiple rules.",Bt.appendChild(gt)}if(c.scenarios.uncovered.length){const gt=document.createElement("p");gt.className="auto-gear-summary-detail-title",gt.textContent=p.autoGearSummaryDetailsUncoveredHeading||texts.en?.autoGearSummaryDetailsUncoveredHeading||"Scenarios without dedicated rules",Bt.appendChild(gt);const xt=document.createElement("ul");xt.className="auto-gear-summary-list",c.scenarios.uncovered.forEach(nt=>{const Mt=document.createElement("li"),lo=document.createElement("button");lo.type="button",lo.dataset.autoGearScenario=nt.value,lo.textContent=nt.label,lo.setAttribute("title",(p.autoGearSummarySetScenarioFilter||texts.en?.autoGearSummarySetScenarioFilter||"Filter to scenario").replace("{scenario}",nt.label)),Mt.appendChild(lo),xt.appendChild(Mt)}),Bt.appendChild(xt)}}if(P!=="all"){const gt=document.createElement("button");gt.type="button",gt.className="auto-gear-summary-reset",gt.dataset.autoGearSummaryReset="true",gt.textContent=p.autoGearSummaryResetFocus||texts.en?.autoGearSummaryResetFocus||"Clear dashboard filter",Bt.appendChild(gt)}else if(!c.duplicates.groups.length&&!c.conflicts.items.length&&!c.scenarios.uncovered.length){const gt=document.createElement("p");gt.className="auto-gear-summary-detail-text",gt.textContent=p.autoGearSummaryDetailsFocusEmpty||texts.en?.autoGearSummaryDetailsFocusEmpty||"Everything looks covered—no overlaps or conflicts detected.",Bt.appendChild(gt)}autoGearSummaryDetails.appendChild(Bt)}function yr(){if(!autoGearRulesList)return;autoGearEditor&&!autoGearEditor.hidden&&!so&&Wr(),autoGearRulesList.innerHTML="";const c=getAutoGearRules(),f=Kt({rules:c}),p=refreshAutoGearScenarioFilterOptions(c),g=typeof autoGearSearchQuery=="string"?autoGearSearchQuery:"",S=g.trim().toLowerCase(),E=c.filter(te=>autoGearRuleMatchesScenario(te,p)&&autoGearRuleMatchesSearch(te,S)),L=new Map;c.forEach((te,ye)=>{!te||typeof te!="object"||L.set(te,ye)});let P=autoGearSummaryFocus||"all";const D=(()=>{if(P==="duplicates"&&f?.duplicates?.groups?.length){const te=new Set;return f.duplicates.groups.forEach(ye=>{(ye.rules||[]).forEach(ve=>{!ve||typeof ve!="object"||(ve.id&&te.add(ve.id),te.add(`index-${ve.index}`))})}),te.size?te:null}if(P==="conflicts"&&f?.conflicts?.items?.length){const te=new Set;return f.conflicts.items.forEach(ye=>{(ye.adds||[]).forEach(ve=>{!ve||typeof ve!="object"||(ve.id&&te.add(ve.id),te.add(`index-${ve.index}`))}),(ye.removes||[]).forEach(ve=>{!ve||typeof ve!="object"||(ve.id&&te.add(ve.id),te.add(`index-${ve.index}`))})}),te.size?te:null}return P!=="all"&&P!=="uncovered"&&(P="all"),null})();autoGearSummaryFocus!==P&&(autoGearSummaryFocus=P);const q=!!S||p!=="all"||P!=="all",ie=c.length>0||!!g.trim();Qi&&(Qi.value!==g&&(Qi.value=g),Qi.disabled=!ie),autoGearFilterScenarioSelect&&(autoGearFilterScenarioSelect.value=autoGearScenarioFilter,autoGearFilterScenarioSelect.disabled?autoGearFilterScenarioSelect.setAttribute("aria-disabled","true"):autoGearFilterScenarioSelect.removeAttribute("aria-disabled")),autoGearFilterClearButton&&(autoGearFilterClearButton.hidden=!q,autoGearFilterClearButton.disabled=!q);const se=D?E.filter(te=>{const ye=typeof te?.id=="string"?te.id:"";if(ye&&D.has(ye))return!0;const ve=L.get(te);return!!(typeof ve=="number"&&D.has(`index-${ve}`))}):E;if(en(f,{focus:P,totalRules:c.length,filteredRules:E.length,visibleRules:se.length,hasSearchFilters:!!S||p!=="all",focusApplied:!!D}),!se.length){const te=document.createElement("p");te.className="auto-gear-empty",!c.length&&!q?te.textContent=texts[currentLang]?.autoGearNoRules||texts.en?.autoGearNoRules||"No custom rules yet.":D&&E.length?te.textContent=texts[currentLang]?.autoGearNoFocusMatches||texts.en?.autoGearNoFocusMatches||"No rules match the selected dashboard filter.":te.textContent=texts[currentLang]?.autoGearNoMatches||texts.en?.autoGearNoMatches||"No rules match your filters.",autoGearRulesList.appendChild(te);return}se.forEach(te=>{const ye=L.get(te),ve=document.createElement("div");ve.className="auto-gear-rule",ve.dataset.ruleId=te.id;const Ke=te.enabled!==!1;Ke||ve.classList.add("auto-gear-rule-disabled"),typeof ye=="number"&&ye>=0?ve.dataset.ruleIndex=String(ye):delete ve.dataset.ruleIndex;const Ze=document.createElement("div");Ze.className="auto-gear-rule-info";const ut=document.createElement("p");ut.className="auto-gear-rule-title";const Ft=Array.isArray(te.scenarios)?te.scenarios:[],Mo=Array.isArray(te.mattebox)?te.mattebox:[],Yt=Array.isArray(te.cameraHandle)?te.cameraHandle:[],oo=Array.isArray(te.viewfinderExtension)?te.viewfinderExtension:[],Bt=oo.map(ue),At=(Array.isArray(te.videoDistribution)?te.videoDistribution:[]).map(We),gt=Array.isArray(te.deliveryResolution)?te.deliveryResolution:[],xt=Array.isArray(te.camera)?te.camera:[],nt=Array.isArray(te.ownGear)?te.ownGear:[],Mt=G(te.cameraWeight),lo=Array.isArray(te.monitor)?te.monitor:[],tr=Array.isArray(te.crewPresent)?te.crewPresent:[],xr=Array.isArray(te.crewAbsent)?te.crewAbsent:[],nn=Array.isArray(te.wireless)?te.wireless:[],xn=Array.isArray(te.motors)?te.motors:[],Gn=texts[currentLang]||texts.en||{},wa=xn.map(wo=>Fo(wo,Gn)),ea=Array.isArray(te.controllers)?te.controllers:[],xa=Array.isArray(te.distance)?te.distance:[],_n=normalizeAutoGearShootingDaysCondition(te.shootingDays),$a=Gn.autoGearOwnGearMissing||texts.en?.autoGearOwnGearMissing||"Missing own gear",ta=nt.map(wo=>{if(typeof wo!="string"||!wo.trim())return"";const Wt=typeof findAutoGearOwnGearById=="function"?findAutoGearOwnGearById(wo):null;return Wt?(typeof formatAutoGearOwnGearLabel=="function"?formatAutoGearOwnGearLabel(Wt):"")||Wt.name||wo:`${$a} (${wo})`}).filter(Boolean),vl=_n?[String(_n.value)]:[],li=Mt?B(Mt,Gn):"",ga=[xt,li?[li]:[],lo,tr,xr,nn,wa,ea,xa,ta,Mo,Yt,Bt,gt,At,vl],Ta=Ft.length?Ft:ga.find(wo=>Array.isArray(wo)&&wo.length)||[],Na=Ta.length?Ta.join(" + "):"";if(ut.textContent=te.label||Na,Ze.appendChild(ut),!Ke){const wo=document.createElement("p");wo.className="auto-gear-rule-meta auto-gear-rule-disabled-meta",wo.textContent=texts[currentLang]?.autoGearRuleDisabledLabel||texts.en?.autoGearRuleDisabledLabel||"Disabled",Ze.appendChild(wo)}if(te.always){const wo=texts[currentLang]?.autoGearAlwaysMeta||texts.en?.autoGearAlwaysMeta||"Always active",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=wo,Ze.appendChild(Wt)}if(Ft.length){const wo=texts[currentLang]?.projectFields?.requiredScenarios||texts.en?.projectFields?.requiredScenarios||"Required Scenarios",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${Ft.join(" + ")}`,Ze.appendChild(Wt)}if(xt.length){const wo=texts[currentLang]?.autoGearCameraLabel||texts.en?.autoGearCameraLabel||"Camera selection",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${xt.join(" + ")}`,Ze.appendChild(Wt)}if(nt.length){const wo=texts[currentLang]?.autoGearConditionOwnGearLabel||texts[currentLang]?.autoGearOwnGearLabel||texts.en?.autoGearConditionOwnGearLabel||texts.en?.autoGearOwnGearLabel||"Own gear";if(ta.length){const Un=document.createElement("p");Un.className="auto-gear-rule-meta",Un.textContent=`${wo}: ${ta.join(" + ")}`,Ze.appendChild(Un)}const Wt=normalizeAutoGearConditionLogic(te.ownGearLogic);if(Wt&&Wt!=="all"){const Un=texts[currentLang]?.autoGearConditionLogicLabel||texts.en?.autoGearConditionLogicLabel||"Match behavior";let In="";if(Wt==="none"?In=texts[currentLang]?.autoGearConditionLogicNone||texts.en?.autoGearConditionLogicNone||"":Wt==="any"?In=texts[currentLang]?.autoGearConditionLogicAny||texts.en?.autoGearConditionLogicAny||"":Wt==="or"?In=texts[currentLang]?.autoGearConditionLogicOr||texts.en?.autoGearConditionLogicOr||"":Wt==="multiplier"&&(In=texts[currentLang]?.autoGearConditionLogicMultiplier||texts.en?.autoGearConditionLogicMultiplier||""),In){const ya=document.createElement("p");ya.className="auto-gear-rule-meta",ya.textContent=`${wo} – ${Un}: ${In}`,Ze.appendChild(ya)}}}if(Mt&&li){const wo=texts[currentLang]?.autoGearCameraWeightLabel||texts.en?.autoGearCameraWeightLabel||"Camera weight",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${li}`,Ze.appendChild(Wt)}if(lo.length){const wo=texts[currentLang]?.autoGearMonitorLabel||texts.en?.autoGearMonitorLabel||"Onboard monitors",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${lo.join(" + ")}`,Ze.appendChild(Wt)}if(tr.length){const wo=texts[currentLang]?.autoGearCrewPresentLabel||texts.en?.autoGearCrewPresentLabel||"Crew present",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta";const Un=tr.map(In=>k(In)).filter(Boolean);Wt.textContent=`${wo}: ${Un.join(" + ")}`,Ze.appendChild(Wt)}if(xr.length){const wo=texts[currentLang]?.autoGearCrewAbsentLabel||texts.en?.autoGearCrewAbsentLabel||"Crew absent",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta";const Un=xr.map(In=>k(In)).filter(Boolean);Wt.textContent=`${wo}: ${Un.join(" + ")}`,Ze.appendChild(Wt)}if(nn.length){const wo=texts[currentLang]?.autoGearWirelessLabel||texts.en?.autoGearWirelessLabel||"Wireless transmitters",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${nn.join(" + ")}`,Ze.appendChild(Wt)}if(xn.length){const wo=texts[currentLang]?.autoGearMotorsLabel||texts.en?.autoGearMotorsLabel||"FIZ motors",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${wa.join(" + ")}`,Ze.appendChild(Wt)}if(ea.length){const wo=texts[currentLang]?.autoGearControllersLabel||texts.en?.autoGearControllersLabel||"FIZ controllers",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${ea.join(" + ")}`,Ze.appendChild(Wt)}if(xa.length){const wo=texts[currentLang]?.autoGearDistanceLabel||texts.en?.autoGearDistanceLabel||"FIZ distance devices",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${xa.join(" + ")}`,Ze.appendChild(Wt)}if(_n){const wo=texts[currentLang]?.autoGearShootingDaysLabel||texts.en?.autoGearShootingDaysLabel||"Shooting days condition",Wt=texts[currentLang]?.autoGearShootingDaysModeMinimum||texts.en?.autoGearShootingDaysModeMinimum||"Minimum",Un=texts[currentLang]?.autoGearShootingDaysModeMaximum||texts.en?.autoGearShootingDaysModeMaximum||"Maximum",In=texts[currentLang]?.autoGearShootingDaysModeEvery||texts.en?.autoGearShootingDaysModeEvery||"Every",ya=document.createElement("p");ya.className="auto-gear-rule-meta";let As=String(_n.value);_n.mode==="minimum"?(As=`≥ ${_n.value}`,ya.textContent=`${wo}: ${Wt} ${As.replace("≥ ","")}`):_n.mode==="maximum"?(As=`≤ ${_n.value}`,ya.textContent=`${wo}: ${Un} ${As.replace("≤ ","")}`):_n.mode==="every"?ya.textContent=`${wo}: ${In} ${_n.value}`:ya.textContent=`${wo}: ${As}`,Ze.appendChild(ya)}if(Mo.length){const wo=texts[currentLang]?.autoGearMatteboxLabel||texts.en?.autoGearMatteboxLabel||"Mattebox options",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${Mo.join(" + ")}`,Ze.appendChild(Wt)}if(Yt.length){const wo=texts[currentLang]?.autoGearCameraHandleLabel||texts.en?.autoGearCameraHandleLabel||"Camera handles",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${Yt.join(" + ")}`,Ze.appendChild(Wt)}if(oo.length){const wo=texts[currentLang]?.autoGearViewfinderExtensionLabel||texts.en?.autoGearViewfinderExtensionLabel||"Viewfinder extension",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${Bt.join(" + ")}`,Ze.appendChild(Wt)}if(At.length){const wo=texts[currentLang]?.autoGearVideoDistributionLabel||texts.en?.autoGearVideoDistributionLabel||"Video distribution",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${At.join(" + ")}`,Ze.appendChild(Wt)}if(gt.length){const wo=texts[currentLang]?.autoGearDeliveryResolutionLabel||texts.en?.autoGearDeliveryResolutionLabel||"Delivery resolution",Wt=document.createElement("p");Wt.className="auto-gear-rule-meta",Wt.textContent=`${wo}: ${gt.join(" + ")}`,Ze.appendChild(Wt)}const og=ir(te.add.length,"autoGearAddsCountOne","autoGearAddsCountOther"),rg=ir(te.remove.length,"autoGearRemovalsCountOne","autoGearRemovalsCountOther"),ou=document.createElement("p");if(ou.className="auto-gear-rule-meta",ou.textContent=`${og} · ${rg}`,Ze.appendChild(ou),te.add.length){const wo=document.createElement("p");wo.className="auto-gear-rule-meta auto-gear-rule-items-label",wo.textContent=texts[currentLang]?.autoGearAddsListLabel||texts.en?.autoGearAddsListLabel||"Adds",Ze.appendChild(wo);const Wt=document.createElement("ul");Wt.className="auto-gear-rule-items",te.add.forEach(Un=>{const In=document.createElement("li");In.className="auto-gear-rule-item",In.textContent=sr(Un),Wt.appendChild(In)}),Ze.appendChild(Wt)}ve.appendChild(Ze);const Mi=document.createElement("div");Mi.className="auto-gear-rule-actions";const Ll=document.createElement("label");Ll.className="auto-gear-rule-toggle";const Fa=document.createElement("input");Fa.type="checkbox",Fa.className="auto-gear-enabled-toggle",Fa.checked=Ke,Fa.dataset.ruleId=te.id,typeof ye=="number"&&ye>=0&&(Fa.dataset.ruleIndex=String(ye));const ng=texts[currentLang]?.autoGearRuleToggleEnable||texts.en?.autoGearRuleToggleEnable||"Enable rule",ag=texts[currentLang]?.autoGearRuleToggleDisable||texts.en?.autoGearRuleToggleDisable||"Disable rule",Ef=Ke?ag:ng;Fa.setAttribute("aria-label",Ef),Fa.title=Ef;const Cf=document.createElement("span");Cf.textContent=Ke?texts[currentLang]?.autoGearRuleEnabledLabel||texts.en?.autoGearRuleEnabledLabel||"Enabled":texts[currentLang]?.autoGearRuleDisabledLabel||texts.en?.autoGearRuleDisabledLabel||"Disabled",Ll.appendChild(Fa),Ll.appendChild(Cf),Mi.appendChild(Ll);const Ua=document.createElement("button");Ua.type="button",Ua.className="auto-gear-edit",Ua.dataset.ruleId=te.id,typeof ye=="number"&&ye>=0?Ua.dataset.ruleIndex=String(ye):delete Ua.dataset.ruleIndex;const Af=texts[currentLang]?.editBtn||texts.en?.editBtn||"Edit";Ua.textContent=Af,Ua.setAttribute("data-help",Af),Mi.appendChild(Ua);const Ha=document.createElement("button");Ha.type="button",Ha.className="auto-gear-duplicate",Ha.dataset.ruleId=te.id,typeof ye=="number"&&ye>=0?Ha.dataset.ruleIndex=String(ye):delete Ha.dataset.ruleIndex;const vf=texts[currentLang]?.autoGearDuplicateRule||texts.en?.autoGearDuplicateRule||"Duplicate";Ha.textContent=vf,Ha.setAttribute("data-help",vf),Mi.appendChild(Ha);const ja=document.createElement("button");ja.type="button",ja.className="auto-gear-delete",ja.dataset.ruleId=te.id,typeof ye=="number"&&ye>=0?ja.dataset.ruleIndex=String(ye):delete ja.dataset.ruleIndex;const Lf=texts[currentLang]?.autoGearDeleteRule||texts.en?.autoGearDeleteRule||"Delete";ja.textContent=Lf,ja.setAttribute("data-help",Lf),Mi.appendChild(ja),ve.appendChild(Mi),autoGearRulesList.appendChild(ve)})}function Kr(c){const p=(c==="remove"?"remove":"add")==="add",g=p?autoGearAddNameInput:autoGearRemoveNameInput,S=p?autoGearAddQuantityInput:autoGearRemoveQuantityInput,E=p?autoGearAddScreenSizeInput:autoGearRemoveScreenSizeInput,L=p?autoGearAddSelectorTypeSelect:autoGearRemoveSelectorTypeSelect,P=p?autoGearAddSelectorDefaultInput:autoGearRemoveSelectorDefaultInput,D=p?autoGearAddNotesInput:autoGearRemoveNotesInput,q=p?autoGearAddOwnGearSelect:autoGearRemoveOwnGearSelect;g&&(g.value=""),S&&(S.value="1"),E&&(E.value=""),L&&(L.value="none"),P&&(P.value=""),P&&Object.prototype.hasOwnProperty.call(P.dataset,"autoGearPreferredDefault")&&delete P.dataset.autoGearPreferredDefault,D&&(D.value=""),q&&(q.value="",Array.from(q.querySelectorAll('option[data-auto-gear-fallback="true"]')).forEach(se=>se.remove())),g&&g.dataset&&(delete g.dataset.autoGearOwnGearId,delete g.dataset.autoGearOwnGearName);const ie=L?L.value:"none";updateAutoGearMonitorCatalogOptions(ie,P)}function Zo(c){const f=c==="remove"?"remove":"add",p=f==="remove"?iu:su;if(!p)return;const g=texts[currentLang]||texts.en||{},S=autoGearEditorActiveItem?.listType===f,E=f==="remove"?"autoGearRemoveItemButton":"autoGearAddItemButton",L=g[E]||texts.en?.[E]||p.textContent||"",P=g.autoGearUpdateItemButton||texts.en?.autoGearUpdateItemButton||L,D=S?P:L,q=S?ICON_GLYPHS.save:f==="remove"?ICON_GLYPHS.minus:ICON_GLYPHS.add;h(p,D,q),p.setAttribute("data-help",D)}function Cr(c){if(!c)return null;const f=c.selectedOptions?c.selectedOptions[0]:null;if(!f||!f.value)return null;const p=f.dataset.name||f.textContent||"";return{id:f.value,name:p,label:f.textContent||p,notes:f.dataset.notes||""}}function T(c){const f=c==="remove"?"remove":"add",p=f==="remove"?autoGearRemoveOwnGearSelect:autoGearAddOwnGearSelect,g=f==="remove"?autoGearRemoveNameInput:autoGearAddNameInput,S=f==="remove"?autoGearRemoveNotesInput:autoGearAddNotesInput;if(!p||!g)return;const E=Cr(p);if(!E){g.dataset&&(delete g.dataset.autoGearOwnGearId,delete g.dataset.autoGearOwnGearName),Array.from(p.querySelectorAll('option[data-auto-gear-fallback="true"]')).forEach(L=>L.remove());return}E.name&&(g.value=E.name),g.dataset&&(g.dataset.autoGearOwnGearId=E.id,g.dataset.autoGearOwnGearName=E.name||E.label||""),S&&!S.value&&E.notes&&(S.value=E.notes)}function J(){Zo("add"),Zo("remove")}function qe(c){const f=normalizeAutoGearItem(c);if(!f)return null;const p=Array.isArray(f.contextNotes)?f.contextNotes.map(S=>typeof S=="string"?S.trim():"").filter(Boolean).sort((S,E)=>S.localeCompare(E)):[];return{identity:[f.name||"",f.category||"",f.screenSize||"",f.selectorType||"none",f.selectorDefault||"",f.selectorEnabled?"1":"0",f.notes||"",f.ownGearId||"",p.join("|")].join("||"),item:{...f,contextNotes:p.slice()}}}function Rt(c){if(!c||typeof c!="object")return null;const f=Array.isArray(c.add)?c.add.map(normalizeAutoGearItem).filter(Boolean):[],p=Array.isArray(c.remove)?c.remove.map(normalizeAutoGearItem).filter(Boolean):[];return!f.length&&!p.length?null:{id:typeof c.id=="string"&&c.id?c.id:"",add:f,remove:p}}function Vt(c,f={}){const p=!!f.allowDraftPreviewRules,g=new Map;return(Array.isArray(c)?c:[]).forEach(E=>{let L=normalizeAutoGearRule(E);if(!L&&p&&(L=Rt(E)),!L)return;const P=typeof L.id=="string"?L.id:"";L.add.forEach(D=>{const q=qe(D);if(!q)return;const{identity:ie,item:se}=q,te=normalizeAutoGearQuantity(se.quantity);if(!Number.isFinite(te))return;const ye=g.get(ie)||{item:se,add:0,remove:0,addRules:new Set,removeRules:new Set};ye.add+=te,P&&ye.addRules.add(P),g.set(ie,ye)}),L.remove.forEach(D=>{const q=qe(D);if(!q)return;const{identity:ie,item:se}=q,te=normalizeAutoGearQuantity(se.quantity);if(!Number.isFinite(te))return;const ye=g.get(ie)||{item:se,add:0,remove:0,addRules:new Set,removeRules:new Set};ye.remove+=te,P&&ye.removeRules.add(P),g.set(ie,ye)})}),g}function Go(){if(!so)return{available:!1,entries:[],warnings:null};const c=getAutoGearRules();let p=normalizeAutoGearRule(so),g=!1;if(p||(p=Rt(so),g=!!p),!p)return{available:!1,entries:[],warnings:null};const S=c.slice(),E=S.findIndex(se=>se&&se.id===p.id);E>=0?S[E]=p:S.push(p);const L=Vt(c),P=Vt(S,{allowDraftPreviewRules:g}),D=new Set([...L.keys(),...P.keys()]),q=[],ie={critical:[],conflict:[],redundant:[]};return D.forEach(se=>{const te=L.get(se),ye=P.get(se);if(!te&&!ye)return;const ve=ye?.item||te?.item;if(!ve)return;const Ke=cloneAutoGearDraftItem(ve),Ze=te?te.add-te.remove:0,ut=ye?ye.add-ye.remove:0,Ft=ut-Ze,Mo=ye?ye.addRules.size:0,Yt=ye?ye.removeRules.size:0,oo=te?te.addRules.size:0,Bt=ye?ye.add>0&&ye.remove>0:!1,_r=Mo>1;if(!(Ft!==0||_r||Bt))return;q.push({identity:se,item:Ke,baseNet:Ze,previewNet:ut,delta:Ft,addRulesCount:Mo,removeRulesCount:Yt,conflict:Bt,stacked:_r}),Ze>0&&ut<=0&&ie.critical.push({item:Ke,baseNet:Ze,previewNet:ut}),Bt&&ie.conflict.push({item:Ke,addRulesCount:Mo,removeRulesCount:Yt}),Mo-oo>0&&ut<=Ze&&ie.redundant.push({item:Ke,addRulesCount:Mo,baseAddRulesCount:oo})}),q.sort((se,te)=>{const ye=Math.abs(te.delta)-Math.abs(se.delta);if(ye!==0)return ye;const ve=Math.abs(te.previewNet)-Math.abs(se.previewNet);return ve!==0?ve:(se.item.name||"").localeCompare(te.item.name||"")}),{available:!0,entries:q,warnings:ie}}function zo(c){if(!Number.isFinite(c))return"0";const f=Math.round(c);if(typeof Intl<"u"&&typeof Intl.NumberFormat=="function")try{return new Intl.NumberFormat().format(f)}catch{}return String(f)}function gr(c){if(!Number.isFinite(c)||c===0)return"0";const f=Math.round(c),p=Math.abs(f),g=zo(p);return f>0?`+${g}`:`−${g}`}function It(c,f){const p=autoGearItemSnapshot(c);if(!p)return"";const g=Number.isFinite(f)&&f!==0?Math.abs(Math.round(f)):normalizeAutoGearQuantity(p.quantity)||1,S={...p,quantity:g>0?g:1};return sr(S,{includeSign:!1})}function Vr(c,f){if(!c)return[];const p=[],g=texts.en||{},S=(E,L)=>{const P=f[E]||g[E];P?p.push(Ro(P,L)):L&&p.push(L)};return(Array.isArray(c.critical)?c.critical:[]).forEach(E=>{const L=It(E.item,E.baseNet);S("autoGearDraftWarningCritical",L)}),(Array.isArray(c.conflict)?c.conflict:[]).forEach(E=>{const L=It(E.item,E.addRulesCount||E.removeRulesCount||1);S("autoGearDraftWarningConflict",L)}),(Array.isArray(c.redundant)?c.redundant:[]).forEach(E=>{const L=It(E.item,E.addRulesCount||1);S("autoGearDraftWarningRedundant",L)}),Array.from(new Set(p))}function Nr(){if(!autoGearDraftImpactList)return;const c=texts[currentLang]||texts.en||{};if(autoGearDraftImpactList.innerHTML="",autoGearDraftWarningList&&(autoGearDraftWarningList.innerHTML=""),autoGearDraftPendingWarnings=null,!so){const p=c.autoGearDraftImpactUnavailable||texts.en?.autoGearDraftImpactUnavailable||"";if(p){const g=document.createElement("li");g.className="auto-gear-impact-empty",g.textContent=p,autoGearDraftImpactList.appendChild(g)}autoGearDraftWarningContainer&&(autoGearDraftWarningContainer.hidden=!0);return}const f=Go();if(autoGearDraftPendingWarnings=f.available?f.warnings:null,!f.available){const p=c.autoGearDraftImpactUnavailable||texts.en?.autoGearDraftImpactUnavailable||"";if(p){const g=document.createElement("li");g.className="auto-gear-impact-empty",g.textContent=p,autoGearDraftImpactList.appendChild(g)}autoGearDraftWarningContainer&&(autoGearDraftWarningContainer.hidden=!0);return}if(f.entries.length){const p=c.autoGearDraftImpactTotals||texts.en?.autoGearDraftImpactTotals||"Current total: %s → After save: %s",g=c.autoGearDraftImpactChange||texts.en?.autoGearDraftImpactChange||"Change: %s";f.entries.forEach(S=>{const E=document.createElement("li");E.className="auto-gear-impact-item",S.delta>0?E.classList.add("auto-gear-impact-positive"):S.delta<0&&E.classList.add("auto-gear-impact-negative"),S.stacked&&E.classList.add("auto-gear-impact-stacked");const L=document.createElement("div");L.className="auto-gear-impact-summary",L.textContent=It(S.item,S.previewNet||S.baseNet||S.delta),E.appendChild(L);const P=document.createElement("div");P.className="auto-gear-impact-totals",P.textContent=Ro(p,zo(S.baseNet),zo(S.previewNet)),E.appendChild(P);const D=document.createElement("div");D.className="auto-gear-impact-delta",D.textContent=Ro(g,gr(S.delta)),E.appendChild(D);const q=[];if(S.stacked){const ie=S.addRulesCount===1?"autoGearDraftImpactStackedOne":"autoGearDraftImpactStackedOther",se=c[ie]||texts.en?.[ie];se&&q.push(Ro(se,zo(S.addRulesCount)))}if(S.conflict&&S.removeRulesCount>0){const ie=S.removeRulesCount===1?"autoGearDraftImpactConflictOne":"autoGearDraftImpactConflictOther",se=c[ie]||texts.en?.[ie];se&&q.push(Ro(se,zo(S.removeRulesCount)))}if(q.length){const ie=document.createElement("div");ie.className="auto-gear-impact-meta",ie.textContent=q.join(" "),E.appendChild(ie)}autoGearDraftImpactList.appendChild(E)})}else{const p=c.autoGearDraftImpactEmpty||texts.en?.autoGearDraftImpactEmpty||"";if(p){const g=document.createElement("li");g.className="auto-gear-impact-empty",g.textContent=p,autoGearDraftImpactList.appendChild(g)}}if(autoGearDraftWarningContainer){const p=Vr(autoGearDraftPendingWarnings,c);p.length?(autoGearDraftWarningContainer.hidden=!1,autoGearDraftWarningList&&p.forEach(g=>{const S=document.createElement("li");S.className="auto-gear-impact-warning-item",S.textContent=g,autoGearDraftWarningList.appendChild(S)})):autoGearDraftWarningContainer.hidden=!0}}function Xt(){if(J(),!so){autoGearAddList&&(autoGearAddList.innerHTML=""),autoGearRemoveList&&(autoGearRemoveList.innerHTML=""),Nr();return}const c=(f,p,g)=>{if(f){if(f.innerHTML="",!p.length){const S=document.createElement("li");S.className="auto-gear-empty",S.textContent=texts[currentLang]?.autoGearEmptyList||texts.en?.autoGearEmptyList||"No items yet.",f.appendChild(S);return}p.forEach(S=>{const E=document.createElement("li");E.className="auto-gear-item",autoGearEditorActiveItem&&autoGearEditorActiveItem.listType===g&&autoGearEditorActiveItem.itemId===S.id&&E.classList.add("auto-gear-item-editing");const L=document.createElement("span");L.textContent=sr(S,{includeSign:!0,listType:g}),E.appendChild(L);const P=document.createElement("span");P.className="auto-gear-item-actions";const D=document.createElement("button");D.type="button",D.className="auto-gear-edit-entry",D.dataset.listType=g,D.dataset.itemId=S.id;const q=texts[currentLang]?.autoGearListEdit||texts.en?.autoGearListEdit||"Edit";D.textContent=q,D.setAttribute("data-help",q),D.setAttribute("aria-pressed",autoGearEditorActiveItem&&autoGearEditorActiveItem.listType===g&&autoGearEditorActiveItem.itemId===S.id?"true":"false"),P.appendChild(D);const ie=document.createElement("button");ie.type="button",ie.className="auto-gear-remove-entry",ie.dataset.listType=g,ie.dataset.itemId=S.id;const se=texts[currentLang]?.autoGearListRemove||texts.en?.autoGearListRemove||"Remove";ie.textContent=se,ie.setAttribute("data-help",se),P.appendChild(ie),E.appendChild(P),f.appendChild(E)})}};c(autoGearAddList,so.add,"add"),c(autoGearRemoveList,so.remove,"remove"),Nr()}function po(c,f={}){if(!autoGearEditor)return;const{initialDraft:p,highlightLabel:g=!1,ruleIndex:S=null}=f,E=getAutoGearRules();let L=null;if(p?L=p:c&&(L=E.find(P=>P&&P.id===c)||null),!L&&S!==null&&S!==void 0){const P=typeof S=="number"?S:Number.parseInt(S,10);Number.isInteger(P)&&P>=0&&P<E.length&&(L=E[P]||null)}if(!L&&!p&&(L=null),so=createAutoGearDraft(L),autoGearEditorActiveItem=null,autoGearEditor.hidden=!1,autoGearEditor.setAttribute("aria-hidden","false"),autoGearAddRuleBtn&&autoGearAddRuleBtn.setAttribute("aria-expanded","true"),Zn&&(Zn.value=so.label||""),initializeAutoGearConditionsFromDraft(),kt(autoGearAddCategorySelect,so.add[0]?.category||""),kt(autoGearRemoveCategorySelect,so.remove[0]?.category||""),Kr("add"),Kr("remove"),syncAutoGearMonitorFieldVisibility(),J(),Xt(),Zn){if(Zn.focus(),g&&typeof Zn.select=="function"&&Zn.value)try{Zn.select()}catch{}console.log("DEBUG: app-core-new-2.js line 5000 REACHED")}}function Wr(){autoGearEditor&&(autoGearEditor.hidden=!0,autoGearEditor.setAttribute("aria-hidden","true"),autoGearAddRuleBtn&&autoGearAddRuleBtn.setAttribute("aria-expanded","false"),so=null,autoGearEditorActiveItem=null,Zn&&(Zn.value=""),clearAllAutoGearConditions(),Kr("add"),Kr("remove"),syncAutoGearMonitorFieldVisibility(),J(),Xt())}autoGearAddOwnGearSelect&&autoGearAddOwnGearSelect.addEventListener("change",()=>T("add")),autoGearRemoveOwnGearSelect&&autoGearRemoveOwnGearSelect.addEventListener("change",()=>T("remove"));function Pn(){if(!so)return;const c=isAutoGearConditionActive("scenarios")&&autoGearScenariosSelect?Array.from(autoGearScenariosSelect.selectedOptions||[]).map(qt=>qt.value).filter(Boolean):[],f=Ve?normalizeAutoGearScenarioLogic(Ve.value):"all",p=Il?Il.value:"1",g=normalizeAutoGearScenarioMultiplier(p);let S=f;S==="multiplier"&&c.length<2&&(S="all");const E=autoGearScenarioBaseSelect?autoGearScenarioBaseSelect.value:"",L=S==="multiplier"?normalizeAutoGearScenarioPrimary(E):"";S==="multiplier"&&L&&!c.includes(L)&&c.push(L);const P=isAutoGearConditionActive("mattebox")&&autoGearMatteboxSelect?Array.from(autoGearMatteboxSelect.selectedOptions||[]).map(qt=>qt.value).filter(Boolean):[],D=isAutoGearConditionActive("cameraHandle")&&autoGearCameraHandleSelect?Array.from(autoGearCameraHandleSelect.selectedOptions||[]).map(qt=>qt.value).filter(Boolean):[],q=isAutoGearConditionActive("viewfinderExtension")&&autoGearViewfinderExtensionSelect?Array.from(autoGearViewfinderExtensionSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],ie=isAutoGearConditionActive("deliveryResolution")&&autoGearDeliveryResolutionSelect?Array.from(autoGearDeliveryResolutionSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[];let se=isAutoGearConditionActive("videoDistribution")&&autoGearVideoDistributionSelect?Array.from(autoGearVideoDistributionSelect.selectedOptions||[]).map(qt=>qt.value).filter(Boolean):[];se.includes("__none__")&&se.length>1&&(se=se.filter(qt=>qt!=="__none__"));const te=isAutoGearConditionActive("camera")&&autoGearCameraSelect?Array.from(autoGearCameraSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],ye=isAutoGearConditionActive("ownGear")&&autoGearOwnGearSelect?Array.from(autoGearOwnGearSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],ve=(()=>{if(!isAutoGearConditionActive("cameraWeight"))return null;const qt=autoGearCameraWeightOperator?autoGearCameraWeightOperator.value:"",ga=Vn?Vn.value:"",Ta=G({operator:qt,value:ga});if(Ta)return Ta;const Na=_(qt);return Na?{operator:Na,value:null}:null})(),Ke=isAutoGearConditionActive("monitor")&&autoGearMonitorSelect?Array.from(autoGearMonitorSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],Ze=isAutoGearConditionActive("crewPresent")&&autoGearCrewPresentSelect?Array.from(autoGearCrewPresentSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],ut=isAutoGearConditionActive("crewAbsent")&&autoGearCrewAbsentSelect?Array.from(autoGearCrewAbsentSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],Ft=isAutoGearConditionActive("wireless")&&autoGearWirelessSelect?Array.from(autoGearWirelessSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],Mo=isAutoGearConditionActive("motors")&&autoGearMotorsSelect?Array.from(autoGearMotorsSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],Yt=isAutoGearConditionActive("controllers")&&autoGearControllersSelect?Array.from(autoGearControllersSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],oo=isAutoGearConditionActive("distance")&&autoGearDistanceSelect?Array.from(autoGearDistanceSelect.selectedOptions||[]).map(qt=>qt.value).filter(qt=>typeof qt=="string"&&qt.trim()):[],Bt={};S!=="all"&&(Bt.scenarios=S);const _r=autoGearMatteboxModeSelect?normalizeAutoGearConditionLogic(autoGearMatteboxModeSelect.value):"all",At=autoGearCameraHandleModeSelect?normalizeAutoGearConditionLogic(autoGearCameraHandleModeSelect.value):"all",gt=autoGearViewfinderExtensionModeSelect?normalizeAutoGearConditionLogic(autoGearViewfinderExtensionModeSelect.value):"all",xt=autoGearDeliveryResolutionModeSelect?normalizeAutoGearConditionLogic(autoGearDeliveryResolutionModeSelect.value):"all",nt=autoGearVideoDistributionModeSelect?normalizeAutoGearConditionLogic(autoGearVideoDistributionModeSelect.value):"all",Mt=autoGearCameraModeSelect?normalizeAutoGearConditionLogic(autoGearCameraModeSelect.value):"all",lo=autoGearOwnGearModeSelect?normalizeAutoGearConditionLogic(autoGearOwnGearModeSelect.value):"all",tr=autoGearMonitorModeSelect?normalizeAutoGearConditionLogic(autoGearMonitorModeSelect.value):"all",xr=autoGearCrewPresentModeSelect?normalizeAutoGearConditionLogic(autoGearCrewPresentModeSelect.value):"all",nn=autoGearCrewAbsentModeSelect?normalizeAutoGearConditionLogic(autoGearCrewAbsentModeSelect.value):"all",xn=autoGearWirelessModeSelect?normalizeAutoGearConditionLogic(autoGearWirelessModeSelect.value):"all",Gn=autoGearMotorsModeSelect?normalizeAutoGearConditionLogic(autoGearMotorsModeSelect.value):"all",wa=autoGearControllersModeSelect?normalizeAutoGearConditionLogic(autoGearControllersModeSelect.value):"all",ea=autoGearDistanceModeSelect?normalizeAutoGearConditionLogic(autoGearDistanceModeSelect.value):"all";_r!=="all"&&(Bt.mattebox=_r),At!=="all"&&(Bt.cameraHandle=At),gt!=="all"&&(Bt.viewfinderExtension=gt),xt!=="all"&&(Bt.deliveryResolution=xt),nt!=="all"&&(Bt.videoDistribution=nt),Mt!=="all"&&(Bt.camera=Mt),lo!=="all"&&(Bt.ownGear=lo),tr!=="all"&&(Bt.monitor=tr),xr!=="all"&&(Bt.crewPresent=xr),nn!=="all"&&(Bt.crewAbsent=nn),xn!=="all"&&(Bt.wireless=xn),Gn!=="all"&&(Bt.motors=Gn),wa!=="all"&&(Bt.controllers=wa),ea!=="all"&&(Bt.distance=ea);const xa=(()=>{if(!isAutoGearConditionActive("shootingDays")||!Wi)return null;const ga={mode:Ki?Ki.value:"minimum",value:Wi.value};return normalizeAutoGearShootingDaysCondition(ga)})(),_n=isAutoGearConditionActive("always");if(!_n&&!c.length&&!P.length&&!D.length&&!q.length&&!ie.length&&!se.length&&!te.length&&!ye.length&&!ve&&!Ke.length&&!Ze.length&&!ut.length&&!Ft.length&&!Mo.length&&!Yt.length&&!oo.length&&!xa){const qt=texts[currentLang]?.autoGearRuleConditionRequired||texts.en?.autoGearRuleConditionRequired||texts[currentLang]?.autoGearRuleScenarioRequired||texts.en?.autoGearRuleScenarioRequired||"Select at least one scenario, mattebox option, camera handle, viewfinder extension, delivery resolution or video distribution before saving.";window.alert(qt);return}if(isAutoGearConditionActive("cameraWeight")&&(!ve||!Number.isFinite(ve.value))){const qt=texts[currentLang]?.autoGearCameraWeightValueRequired||texts.en?.autoGearCameraWeightValueRequired||"Enter a camera weight threshold before saving.";if(window.alert(qt),Vn)try{Vn.focus({preventScroll:!0})}catch{Vn.focus()}return}if(Zn&&(so.label=Zn.value.trim()),so.always=_n?["always"]:[],so.scenarioLogic=S,so.scenarioMultiplier=S==="multiplier"?g:1,so.scenarioPrimary=S==="multiplier"?L:"",so.scenarios=c,so.mattebox=P,so.cameraHandle=D,so.viewfinderExtension=q,so.deliveryResolution=ie,so.videoDistribution=se,so.camera=te,so.ownGear=ye,so.cameraWeight=ve?{...ve}:null,so.monitor=Ke,so.crewPresent=Ze,so.crewAbsent=ut,so.wireless=Ft,so.motors=Mo,so.controllers=Yt,so.distance=oo,so.matteboxLogic=_r,so.cameraHandleLogic=At,so.viewfinderExtensionLogic=gt,so.deliveryResolutionLogic=xt,so.videoDistributionLogic=nt,so.cameraLogic=Mt,so.ownGearLogic=lo,so.monitorLogic=tr,so.crewPresentLogic=xr,so.crewAbsentLogic=nn,so.wirelessLogic=xn,so.motorsLogic=Gn,so.controllersLogic=wa,so.distanceLogic=ea,so.conditionLogic=Bt,so.shootingDays=xa,!so.add.length&&!so.remove.length){const qt=texts[currentLang]?.autoGearRuleNeedsItems||texts.en?.autoGearRuleNeedsItems||"Add at least one item to add or remove.";window.alert(qt);return}Nr();const $a=normalizeAutoGearRule(so);if(!$a)return;const ta=texts[currentLang]||texts.en||{},vl=Vr(autoGearDraftPendingWarnings,ta),li=()=>{const qt=getAutoGearRules(),ga=qt.findIndex(Na=>Na.id===$a.id);ga>=0?qt[ga]=$a:qt.push($a),setAutoGearRules(qt),Zt(),yr();const Ta=texts[currentLang]?.autoGearRuleSaved||texts.en?.autoGearRuleSaved||"Automatic gear rule saved.";showNotification("success",Ta),Wr()};if(vl.length){const qt=ta.autoGearDraftWarningConfirm||texts.en?.autoGearDraftWarningConfirm||"Save anyway? Review the impact warnings below before confirming.",ga=vl.map(Na=>`• ${Na}`).join(`
`),Ta=`${qt}

${ga}`;if(typeof window.cineShowConfirmDialog=="function"){window.cineShowConfirmDialog({title:ta.autoGearDraftWarningTitle||"Save with Warnings",message:Ta,confirmLabel:ta.saveAnyway||"Save Anyway",cancelLabel:ta.cancel||"Cancel",danger:!0,onConfirm:li});return}}li()}function Kn(c,f,p){const g=getAutoGearRules();let S=-1;if(c&&(S=g.findIndex(D=>D&&D.id===c)),S<0&&p!==null&&p!==void 0){const D=typeof p=="number"?p:Number.parseInt(p,10);Number.isInteger(D)&&D>=0&&D<g.length&&(S=D)}if(S<0)return!1;const E=f!==!1,L=normalizeAutoGearRule({...g[S],enabled:E});if(!L)return!1;const P=g.slice();return P[S]=L,setAutoGearRules(P),Zt(),yr(),typeof refreshGearListIfVisible=="function"&&refreshGearListIfVisible(),so&&so.id===L.id&&(so.enabled=E),E}function Z(c){if(!c||typeof c!="object")return null;const f={},p=(S,E)=>{if(typeof E!="string")return;const L=E.trim();L&&(!Object.prototype.hasOwnProperty.call(f,S)||!f[S])&&(f[S]=L)};if(p("type",c.type),p("version",c.version),[["createdAt","createdAt"],["created_at","createdAt"],["created","createdAt"],["timestamp","timestamp"],["exportedAt","exportedAt"],["exported_at","exportedAt"],["savedAt","savedAt"],["saved_at","savedAt"],["updatedAt","updatedAt"],["updated_at","updatedAt"],["modifiedAt","updatedAt"],["modified_at","updatedAt"]].forEach(([S,E])=>{f[E]||p(E,c[S])}),!f.timestamp){const S=["createdAt","timestamp","exportedAt","savedAt","updatedAt"];for(let E=0;E<S.length;E+=1){const L=S[E];if(f[L]){f.timestamp=f[L],f.timestampSource=L;break}}}return f.timestamp&&!f.timestampSource&&(f.timestampSource="timestamp"),Object.keys(f).length?f:null}function he(...c){const f=[],p=new Set,g={},S=E=>{!E||typeof E!="object"||p.has(E)||(p.add(E),f.push(E))};for(c.forEach(E=>S(E));f.length;){const E=f.shift(),L=Z(E);L&&["type","version","createdAt","exportedAt","savedAt","updatedAt","timestamp","timestampSource"].forEach(P=>{L[P]&&(!Object.prototype.hasOwnProperty.call(g,P)||!g[P])&&(g[P]=L[P])}),E.meta&&typeof E.meta=="object"&&S(E.meta),E.metadata&&typeof E.metadata=="object"&&S(E.metadata)}return Object.keys(g).length?g:null}function fe(c){const f=D=>!D||typeof D!="object"?null:D.monitorDefaults&&typeof D.monitorDefaults=="object"?D.monitorDefaults:D.autoGearMonitorDefaults&&typeof D.autoGearMonitorDefaults=="object"?D.autoGearMonitorDefaults:null,p=D=>{if(typeof D!="string")return D;const q=D.trim();if(!q)return D;try{const ie=JSON.parse(q);return ie===D?ie:p(ie)}catch{return D}},g=new Set,S=[],E=(D,q,ie,se)=>{const te=p(D);!te||typeof te!="object"||g.has(te)||(g.add(te),S.push({value:te,parent:q&&typeof q=="object"?q:null,root:ie&&typeof ie=="object"?ie:null,key:typeof se=="string"?se:""}))},L=p(c);if(Array.isArray(L)){const D=he(L);return{rules:L,monitorDefaults:null,metadata:D}}if(!L||typeof L!="object")return null;const P=Array.isArray(L)?null:L;for(E(L,null,P,"");S.length;){const{value:D,parent:q,root:ie,key:se}=S.shift(),te=ie||(D&&typeof D=="object"&&!Array.isArray(D)?D:null);if(Array.isArray(D)){if(!q||se==="rules"||se==="autoGearRules"){const oo=(q?f(q):null)||(ie?f(ie):null)||null,Bt=he(q,D,ie,te);return{rules:D,monitorDefaults:oo,metadata:Bt}}D.forEach(oo=>{oo&&typeof oo=="object"&&E(oo,q,te,"")});continue}if(!D||typeof D!="object")continue;const ye=f(D),ve=q?f(q):null,Ke=ie?f(ie):null,Ze=ye||ve||Ke||null,ut=Object.prototype.hasOwnProperty.call(D,"autoGearRules")?p(D.autoGearRules):null;if(Array.isArray(ut)){const Yt=he(D,q,ie,te);return{rules:ut,monitorDefaults:Ze,metadata:Yt}}const Ft=Object.prototype.hasOwnProperty.call(D,"rules")?p(D.rules):null;if(Array.isArray(Ft)){const Yt=he(D,q,ie,te);return{rules:Ft,monitorDefaults:Ze,metadata:Yt}}if(Ft&&typeof Ft=="object"){const Yt=Object.prototype.hasOwnProperty.call(Ft,"autoGearRules")?p(Ft.autoGearRules):null;if(Array.isArray(Yt)){const oo=f(Ft)||Ze,Bt=he(Ft,D,q,ie,te);return{rules:Yt,monitorDefaults:oo,metadata:Bt}}}[{value:D.data,key:"data"},{value:D.payload,key:"payload"},{value:D.bundle,key:"bundle"},{value:D.project,key:"project"},{value:D.config,key:"config"},{value:D.settings,key:"settings"},{value:D.content,key:"content"},{value:D.body,key:"body"},{value:D.autoGear,key:"autoGear"},{value:D.rules,key:"rules"},{value:D.autoGearRules,key:"autoGearRules"},{value:D.meta,key:"meta"},{value:D.metadata,key:"metadata"}].forEach(Yt=>{Yt.value&&E(Yt.value,D,te,Yt.key)}),Object.keys(D).forEach(Yt=>{if(!Object.prototype.hasOwnProperty.call(D,Yt)||Yt==="monitorDefaults"||Yt==="autoGearMonitorDefaults"||Yt==="rules"||Yt==="autoGearRules")return;const oo=D[Yt];if(!(!oo||typeof oo=="function")){if(typeof oo=="object")E(oo,D,te,Yt);else if(typeof oo=="string"){const Bt=p(oo);Bt&&Bt!==oo&&typeof Bt=="object"&&E(Bt,D,te,Yt)}}})}return null}function xe(c){if(typeof c!="string")return null;const f=c.trim();if(!f)return null;const p=f.match(/^(\d+)\.(\d+)\.(\d+)(?:[-+].*)?$/);return p?{major:Number.parseInt(p[1],10),minor:Number.parseInt(p[2],10),patch:Number.parseInt(p[3],10),raw:f}:null}function $e(c,f){return!c||!f?null:c.major!==f.major?c.major>f.major?1:-1:c.minor!==f.minor?c.minor>f.minor?1:-1:c.patch!==f.patch?c.patch>f.patch?1:-1:0}function ze(c){if(typeof c!="string")return!1;const f=c.trim();if(!f)return!1;const p=Date.parse(f);return Number.isNaN(p)?!1:Number.isFinite(p)}function yt(c){const p={metadata:c?.metadata&&typeof c.metadata=="object"?{...c.metadata}:{},warnings:[],errors:[]};if(!c||!Array.isArray(c.rules))return p.errors.push({code:"invalid-rules"}),p;const g=p.metadata,S="camera-power-planner/auto-gear-rules",E=typeof g.type=="string"?g.type.trim():"";E?E!==S?p.errors.push({code:"type-mismatch",expected:S,actual:E}):g.type=E:p.warnings.push({code:"missing-metadata",field:"type"});let L="";typeof g.version=="string"?(L=g.version.trim(),L||p.warnings.push({code:"missing-metadata",field:"version"})):g.version!=null?p.warnings.push({code:"invalid-metadata",field:"version"}):p.warnings.push({code:"missing-metadata",field:"version"});const P=xe(L);L&&!P&&p.warnings.push({code:"invalid-version-format",value:L}),g.version=L;const D=typeof g.timestamp=="string"?g.timestamp.trim():"";D?ze(D)||p.warnings.push({code:"invalid-timestamp",value:D}):p.warnings.push({code:"missing-metadata",field:"timestamp"}),g.timestamp=D;const q=typeof APP_VERSION=="string"?xe(APP_VERSION):null;if(P&&q){const ie=$e(P,q);ie>0?p.warnings.push({code:"newer-version",importedVersion:P.raw,currentVersion:q.raw}):ie<0&&p.warnings.push({code:"older-version",importedVersion:P.raw,currentVersion:q.raw})}return!g.type&&!g.version&&!g.timestamp&&(p.metadata=null),p}function dt(c){const f=Zr(currentLang),p=Zr("en"),g=c==="timestamp"?"autoGearImportMetadataLabelTimestamp":c==="version"?"autoGearImportMetadataLabelVersion":"autoGearImportMetadataLabelType";return f?.[g]||p?.[g]||c}function ht(c,f){const p=Zr(currentLang),g=Zr("en");switch(c.code){case"newer-version":return(p?.autoGearImportNewerVersionWarning||g?.autoGearImportNewerVersionWarning||"Imported rules were created with version {importVersion}, which is newer than this build ({appVersion}).").replace("{importVersion}",c.importedVersion||f?.version||"").replace("{appVersion}",c.currentVersion||APP_VERSION||"");case"older-version":return(p?.autoGearImportOlderVersionWarning||g?.autoGearImportOlderVersionWarning||"Imported rules were created with version {importVersion}, which is older than this build ({appVersion}).").replace("{importVersion}",c.importedVersion||f?.version||"").replace("{appVersion}",c.currentVersion||APP_VERSION||"");case"invalid-version-format":return(p?.autoGearImportInvalidVersionWarning||g?.autoGearImportInvalidVersionWarning||'Imported rules report version "{value}", which is not a valid semantic version string.').replace("{value}",c.value||f?.version||"");case"invalid-timestamp":return(p?.autoGearImportInvalidTimestampWarning||g?.autoGearImportInvalidTimestampWarning||'The import timestamp "{value}" could not be verified.').replace("{value}",c.value||f?.timestamp||"");default:return""}}function uo(c,f){if(!Array.isArray(c)||!c.length)return;const p=[],g=[];c.forEach(L=>{if(!(!L||typeof L!="object"))if(L.code==="missing-metadata"&&L.field)p.includes(L.field)||p.push(L.field);else if(L.code==="invalid-metadata"&&L.field)g.includes(L.field)||g.push(L.field);else{const P=ht(L,f);P&&showNotification("warning",P)}});const S=Zr(currentLang),E=Zr("en");if(p.length){const L=p.map(q=>dt(q)),P=Wa(currentLang,L),D=S?.autoGearImportMissingMetadataWarning||E?.autoGearImportMissingMetadataWarning||"Imported rules are missing required metadata: {fields}.";showNotification("warning",D.replace("{fields}",P))}if(g.length){const L=g.map(q=>dt(q)),P=Wa(currentLang,L),D=S?.autoGearImportInvalidMetadataWarning||E?.autoGearImportInvalidMetadataWarning||"Imported rules include invalid metadata: {fields}.";showNotification("warning",D.replace("{fields}",P))}}function wt(c,f={}){const p=getAutoGearRules(),g=getAutoGearMonitorDefaultsSnapshot(),S=fe(c);if(!S||!Array.isArray(S.rules)){const L=new Error("Invalid automatic gear rules import payload");throw L.userMessage=texts[currentLang]?.autoGearImportSchemaError||texts.en?.autoGearImportSchemaError||"Import failed. The file does not match the automatic gear rules export format.",L.validationWarnings=[],L.validationMetadata=null,L}const E=yt(S);if(E.errors.length){const L=texts[currentLang]?.autoGearImportSchemaError||texts.en?.autoGearImportSchemaError||"Import failed. The file does not match the automatic gear rules export format.",P=new Error(L);throw P.userMessage=L,P.validationErrors=E.errors,P.validationWarnings=E.warnings,P.validationMetadata=E.metadata,P}try{setAutoGearRules(S.rules),S.monitorDefaults&&typeof S.monitorDefaults=="object"?setAutoGearMonitorDefaults(S.monitorDefaults):(Ht(),jo()),Wr(),yr(),Zt(),typeof refreshGearListIfVisible=="function"&&refreshGearListIfVisible()}catch(L){throw setAutoGearRules(p),setAutoGearMonitorDefaults(g,{skipRender:!0,skipRefresh:!0}),yr(),Zt(),jo(),typeof refreshGearListIfVisible=="function"&&refreshGearListIfVisible(),L}if(!f.silent){const L=texts[currentLang]?.autoGearImportSuccess||texts.en?.autoGearImportSuccess||"Automatic gear rules imported.";showNotification("success",L)}return uo(E.warnings,E.metadata),getAutoGearRules()}function Ao(c){const{iso:f}=formatFullBackupFilename(c);return`${f.replace(/[:]/g,"-")} auto gear rules.json`}function nr(){if(typeof document>"u")return null;try{const c=getBaseAutoGearRules(),f=getAutoGearMonitorDefaultsSnapshot(),p=Kt({rules:c}),g={type:"camera-power-planner/auto-gear-rules",version:APP_VERSION,createdAt:new Date().toISOString(),rules:c,monitorDefaults:f};p&&(g.coverage=p);const S=JSON.stringify(g,null,2);if(typeof Blob!="function"||!URL||typeof URL.createObjectURL!="function")throw new Error("Blob or URL APIs unavailable");const E=new Blob([S],{type:"application/json;charset=utf-8"}),L=URL.createObjectURL(E),P=document.createElement("a");P.href=L;const D=Ao(new Date);P.download=D,document.body.appendChild(P),P.click(),setTimeout(()=>{document.body.removeChild(P)},1500),typeof URL.revokeObjectURL=="function"&&setTimeout(()=>{URL.revokeObjectURL(L)},6e4);const q=texts[currentLang]?.autoGearExportSuccess||texts.en?.autoGearExportSuccess||"Automatic gear rules downloaded.";return showNotification("success",q),D}catch(c){console.warn("Automatic gear rules export failed",c);const f=texts[currentLang]?.autoGearExportError||texts.en?.autoGearExportError||"Automatic gear rules export failed.";return showNotification("error",f),null}}function dr(c){const{iso:f}=formatFullBackupFilename(c);return`${f.replace(/[:]/g,"-")} auto gear presets.json`}function fr(c){if(!c||typeof c!="object")return null;const f=typeof c.label=="string"?c.label:"";if(!f)return null;const p=typeof c.id=="string"&&c.id?c.id:generateAutoGearId("preset"),g=Array.isArray(c.rules)?c.rules:[];let S=[];if(g.length===0)S=[];else try{S=JSON.parse(JSON.stringify(g))}catch{S=g.map(P=>!P||typeof P!="object"?P:{...P})}const E=typeof c.fingerprint=="string"&&c.fingerprint?c.fingerprint:createAutoGearRulesFingerprint(S);return{id:p,label:f,rules:S,fingerprint:E}}function ar(c={}){const f=typeof c=="object"&&c!==null?c:{},p=f.notifySuccess!==!1,g=f.notifyFailure!==!1,E=(Array.isArray(Tt)?Tt:[]).map(fr).filter(Boolean);if(!E.length)return{status:"skipped",reason:"empty"};if(typeof document>"u"||typeof Blob!="function"||!URL||typeof URL.createObjectURL!="function"){if(g){const L=texts[currentLang]?.autoGearPresetExportError||texts.en?.autoGearPresetExportError||"Automatic gear preset export failed.";showNotification("error",L)}return{status:"failed",reason:"unsupported"}}try{const L={type:"camera-power-planner/auto-gear-presets",version:typeof APP_VERSION<"u"?APP_VERSION:"",createdAt:new Date().toISOString(),presets:E,activePresetId:typeof Yo=="string"?Yo:"",autoPresetId:typeof Te=="string"?Te:""},P=JSON.stringify(L,null,2),D=new Blob([P],{type:"application/json;charset=utf-8"}),q=URL.createObjectURL(D),ie=document.createElement("a");ie.href=q;const se=dr(new Date);if(ie.download=se,document.body.appendChild(ie),ie.click(),setTimeout(()=>{document.body.removeChild(ie)},1500),typeof URL.revokeObjectURL=="function"&&setTimeout(()=>{URL.revokeObjectURL(q)},6e4),p){const te=texts[currentLang]?.autoGearPresetExportSuccess||texts.en?.autoGearPresetExportSuccess||"Automatic gear presets downloaded.";showNotification("success",te)}return{status:"exported",fileName:se}}catch(L){if(console.warn("Automatic gear preset export failed",L),g){const P=texts[currentLang]?.autoGearPresetExportError||texts.en?.autoGearPresetExportError||"Automatic gear preset export failed.";showNotification("error",P)}return{status:"failed",reason:"error",error:L}}}function Jo(c={}){const f=typeof c=="object"&&c!==null?c:{},p=f.force===!0,g=f.notifySuccess!==!1,S=f.notifyFailure!==!1,E=typeof f.note=="string"?f.note.trim():"";if(!p&&!autoGearRulesDirtySinceBackup)return{status:"skipped",reason:"clean"};const L=getBaseAutoGearRules(),P=getAutoGearMonitorDefaultsSnapshot(),D=getAutoGearConfigurationSignature(L,P);if(!p&&D===autoGearRulesLastBackupSignature)return autoGearRulesDirtySinceBackup=!1,{status:"skipped",reason:"unchanged"};const q={id:generateAutoGearId("backup"),createdAt:new Date().toISOString(),rules:L,monitorDefaults:P};E&&(q.note=E);const ie=clampAutoGearBackupRetentionLimit(autoGearBackupRetention),se=Math.max(1,ie),te=[q,...$o].slice(0,se);try{const ye=persistAutoGearBackups(te)||[],ve=Array.isArray(ye)?ye:[];$o=ve;const Ke=ve[0]||q,Ze=ve.length?getAutoGearConfigurationSignature(ve[0].rules,ve[0].monitorDefaults):D;if(autoGearRulesLastBackupSignature=Ze,autoGearRulesLastPersistedSignature=Ze,autoGearRulesDirtySinceBackup=!1,ao(),Qr(),g){const ut=texts[currentLang]?.autoGearBackupSaved||texts.en?.autoGearBackupSaved||"Automatic gear backup saved.";showNotification("success",ut)}return{status:"created",entry:Ke}}catch(ye){if(console.warn("Automatic gear backup failed",ye),autoGearRulesDirtySinceBackup=!0,S){const ve=texts[currentLang]?.autoGearBackupFailed||texts.en?.autoGearBackupFailed||"Automatic gear backup failed.";showNotification("error",ve)}return{status:"error",error:ye}}}function Mr(c={}){return Jo(c).status==="created"}function Or(c){if(!c)return!1;const f=$o.find(S=>S.id===c);if(!f)return!1;const p=texts[currentLang]?.autoGearBackupRestoreConfirm||texts.en?.autoGearBackupRestoreConfirm||"Replace your automatic gear rules with this backup?",g=()=>{try{setAutoGearRules(Array.isArray(f.rules)?f.rules:[]),f.monitorDefaults&&setAutoGearMonitorDefaults(f.monitorDefaults,{skipRefresh:!0}),Wr(),yr(),Zt(),jo(),typeof refreshGearListIfVisible=="function"&&refreshGearListIfVisible(),autoGearRulesLastBackupSignature=getAutoGearConfigurationSignature(f.rules,f.monitorDefaults),autoGearRulesLastPersistedSignature=autoGearRulesLastBackupSignature,autoGearRulesDirtySinceBackup=!1;const S=texts[currentLang]?.autoGearBackupRestoreSuccess||texts.en?.autoGearBackupRestoreSuccess||"Automatic gear backup restored.";showNotification("success",S)}catch(S){console.warn("Failed to restore automatic gear backup",S);const E=texts[currentLang]?.autoGearBackupRestoreError||texts.en?.autoGearBackupRestoreError||"Automatic gear backup restore failed.";showNotification("error",E)}};return typeof window.cineShowConfirmDialog=="function"?(window.cineShowConfirmDialog({title:texts[currentLang]?.autoGearBackupRestoreTitle||"Restore Backup",message:p,confirmLabel:texts[currentLang]?.restore||"Restore",cancelLabel:texts[currentLang]?.cancel||"Cancel",danger:!0,onConfirm:g}),!0):(console.warn("Missing window.cineShowConfirmDialog for restoreAutoGearBackup"),!1)}function Uo(c){const f=c?.target,p=f&&f.files&&f.files[0];if(!p)return;const g=texts[currentLang]?.autoGearImportConfirm||texts.en?.autoGearImportConfirm||"Replace your automatic gear rules with the imported file?",S=()=>{if(typeof FileReader>"u"){const L=texts[currentLang]?.autoGearImportError||texts.en?.autoGearImportError||"Import failed. Please choose a valid automatic gear rules file.";showNotification("error",L),f&&(f.value="");return}const E=new FileReader;E.onload=L=>{try{const P=L?.target?.result,D=JSON.parse(typeof P=="string"?P:"");wt(D)}catch(P){console.warn("Automatic gear rules import failed",P),Array.isArray(P?.validationWarnings)&&P.validationWarnings.length&&uo(P.validationWarnings,P.validationMetadata||null);const D=texts[currentLang]?.autoGearImportError||texts.en?.autoGearImportError||"Import failed. Please choose a valid automatic gear rules file.",q=typeof P?.userMessage=="string"&&P.userMessage.trim()?P.userMessage:D;showNotification("error",q)}finally{f&&(f.value="")}},E.onerror=()=>{const L=texts[currentLang]?.autoGearImportError||texts.en?.autoGearImportError||"Import failed. Please choose a valid automatic gear rules file.";showNotification("error",L),f&&(f.value="")},E.readAsText(p)};if(typeof window.cineShowConfirmDialog=="function"){window.cineShowConfirmDialog({title:texts[currentLang]?.autoGearImportTitle||"Import Rules",message:g,confirmLabel:texts[currentLang]?.import||"Import",cancelLabel:texts[currentLang]?.cancel||"Cancel",danger:!0,onConfirm:S,onCancel:()=>{f&&(f.value="")}});return}console.warn("Missing window.cineShowConfirmDialog for handleAutoGearImportSelection")}let Ko=null,yo=null;function En(){function c(P){return typeof P=="string"&&P?P:typeof IOS_PWA_HELP_STORAGE_KEY=="string"&&IOS_PWA_HELP_STORAGE_KEY?IOS_PWA_HELP_STORAGE_KEY:typeof globalThis<"u"&&globalThis&&typeof globalThis.IOS_PWA_HELP_STORAGE_KEY=="string"&&globalThis.IOS_PWA_HELP_STORAGE_KEY?globalThis.IOS_PWA_HELP_STORAGE_KEY:typeof window<"u"&&window&&typeof window.IOS_PWA_HELP_STORAGE_KEY=="string"&&window.IOS_PWA_HELP_STORAGE_KEY?window.IOS_PWA_HELP_STORAGE_KEY:"iosPwaHelpShown"}function f(P){const D=P||(typeof navigator<"u"?navigator:null);if(!D)return!1;const q=D.userAgent||"",ie=D.platform||"",se=typeof D.maxTouchPoints=="number"&&D.maxTouchPoints>1;return/iphone|ipad|ipod/i.test(q)||ie==="MacIntel"&&se}function p(P){const D=P||(typeof navigator<"u"?navigator:null);if(!D)return!1;const q=D.userAgent||"",ie=D.vendor||"";return/android/i.test(q)||/android/i.test(ie)}function g(P,D){const q=P||(typeof window<"u"?window:null),ie=D||(typeof navigator<"u"?navigator:null);if(!q)return!1;if(typeof q.matchMedia=="function")try{if(q.matchMedia("(display-mode: standalone)").matches)return!0}catch(se){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("matchMedia display-mode check failed",se)}return ie&&typeof ie.standalone=="boolean"?ie.standalone:!1}function S(P){const D=c(P);if(typeof localStorage>"u"||!localStorage||typeof localStorage.getItem!="function")return!1;try{return localStorage.getItem(D)==="1"}catch(q){return typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Could not read iOS PWA help dismissal flag",q),!1}}function E(P){const D=c(P);if(!(typeof localStorage>"u"||!localStorage||typeof localStorage.setItem!="function"))try{localStorage.setItem(D,"1")}catch(q){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Could not store iOS PWA help dismissal",q)}}function L(P){return!(!(typeof P=="function"?P():P||null)||!f()||!g()||S())}return{resolveIosPwaHelpStorageKey:c,isIosDevice:f,isAndroidDevice:p,isStandaloneDisplayMode:g,hasDismissedIosPwaHelp:S,markIosPwaHelpDismissed:E,shouldShowIosPwaHelp:L}}const Fr=(()=>{if(typeof resolveHelpModuleApi=="function")try{return resolveHelpModuleApi()}catch(f){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("resolveHelpModuleApi() failed in part 2",f)}const c=En();try{const f=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;f&&!f.__cineResolvedHelpModule&&(f.__cineResolvedHelpModule=c)}catch{}return c})(),wr="__cineResolvedFeatureSearchModule",er="__cineResolvedFeatureSearchNormalizationModule";function ro(){const c=typeof getCoreGlobalObject=="function"?getCoreGlobalObject():typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;if(c&&c[er])return c[er];if(typeof require=="function")try{require("./modules/features/feature-search-normalization.js")}catch{}const f=typeof cineModuleBase=="object"&&cineModuleBase||(c&&typeof c.cineModuleBase=="object"?c.cineModuleBase:null);let p=null;if(f&&typeof f.getModuleRegistry=="function"){const g=f.getModuleRegistry(c);if(g&&typeof g.get=="function")try{p=g.get("cine.features.featureSearchNormalization")}catch{}}if(!p){const g=[];c&&g.push(c),typeof globalThis<"u"&&g.indexOf(globalThis)===-1&&g.push(globalThis),typeof window<"u"&&g.indexOf(window)===-1&&g.push(window),typeof self<"u"&&g.indexOf(self)===-1&&g.push(self),typeof global<"u"&&g.indexOf(global)===-1&&g.push(global);for(let S=0;S<g.length;S+=1){const E=g[S];if(!(!E||typeof E!="object"&&typeof E!="function"))try{const L=E.cineFeaturesFeatureSearchNormalization;if(L){p=L;break}}catch{}}}if(c)try{c[er]=p}catch{}return p}function Br(){const c=ro();return c&&typeof c.normalizeSearchValue=="function"?c.normalizeSearchValue:f=>typeof f=="string"?f.trim().toLowerCase():""}function Xr(){const c=Br();return{normalizeSearchValue(f){return c(f)},sanitizeHighlightTokens(f){if(!Array.isArray(f)||!f.length)return[];const p=[];for(let g=0;g<f.length;g+=1){const S=f[g];if(typeof S!="string")continue;const E=S.trim().toLowerCase();E&&p.indexOf(E)===-1&&p.push(E)}return p},collectHighlightRanges(){return[]},applyHighlight(f,p){if(!f)return;const g=typeof p=="string"?p:"";f.textContent=g},normalizeDetail(f){return typeof f=="string"?f.trim():""}}}function Bo(){const c=typeof getCoreGlobalObject=="function"?getCoreGlobalObject():typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;if(c&&c[wr])return c[wr];const f=typeof cineModuleBase=="object"&&cineModuleBase||(c&&typeof c.cineModuleBase=="object"?c.cineModuleBase:null);function p(P,D){if(f&&typeof f.safeWarn=="function")try{f.safeWarn(P,D);return}catch{}if(typeof console<"u"&&console&&typeof console.warn=="function")try{typeof D>"u"?console.warn(P):console.warn(P,D)}catch{}}const g=[];if(f&&typeof f.getModuleRegistry=="function"){let P=null;try{P=f.getModuleRegistry(c)}catch(D){p("Unable to resolve cine.features.featureSearch module registry.",D)}if(P&&typeof P.get=="function")try{const D=P.get("cine.features.featureSearch");D&&g.indexOf(D)===-1&&g.push(D)}catch(D){p("Unable to read cine.features.featureSearch module.",D)}}const S=[];c&&S.indexOf(c)===-1&&S.push(c),typeof globalThis<"u"&&S.indexOf(globalThis)===-1&&S.push(globalThis),typeof window<"u"&&S.indexOf(window)===-1&&S.push(window),typeof self<"u"&&S.indexOf(self)===-1&&S.push(self),typeof global<"u"&&S.indexOf(global)===-1&&S.push(global);for(let P=0;P<S.length;P+=1){const D=S[P];if(!(!D||typeof D!="object"&&typeof D!="function"))try{const q=D.cineFeaturesFeatureSearch;q&&g.indexOf(q)===-1&&g.push(q)}catch{}}let E=null;for(let P=0;P<g.length;P+=1){const D=g[P];if(D&&typeof D=="object"&&typeof D.normalizeSearchValue=="function"){E=D;break}}const L=E||Xr();if(c)try{c[wr]=L}catch{}return L}const we=Bo(),jt=Xr();function _o(){try{if(Fr&&typeof Fr.isIosDevice=="function")return!!Fr.isIosDevice()}catch(c){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("isIosDevice() failed",c)}return!1}function Yr(){try{if(Fr&&typeof Fr.isAndroidDevice=="function")return!!Fr.isAndroidDevice()}catch(c){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("isAndroidDevice() failed",c)}return!1}function Ar(){try{if(Fr&&typeof Fr.isStandaloneDisplayMode=="function")return!!Fr.isStandaloneDisplayMode()}catch(c){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("isStandaloneDisplayMode() failed",c)}return!1}function tn(){try{Fr&&typeof Fr.markIosPwaHelpDismissed=="function"&&Fr.markIosPwaHelpDismissed()}catch(c){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("markIosPwaHelpDismissed() failed",c)}}function Cn(){const c=[];if(typeof resolveInstallBannerGlobalScope=="function")try{const p=resolveInstallBannerGlobalScope();p&&c.push(p)}catch(p){console.warn("Failed to resolve shared install banner scope",p)}const f=getCoreRuntimeScopesSnapshot();for(let p=0;p<f.length;p+=1){const g=f[p];g&&typeof g=="object"&&c.push(g)}typeof globalThis<"u"&&globalThis&&!c.includes(globalThis)&&c.push(globalThis),typeof window<"u"&&window&&!c.includes(window)&&c.push(window),typeof self<"u"&&self&&!c.includes(self)&&c.push(self),typeof global<"u"&&global&&!c.includes(global)&&c.push(global);for(let p=0;p<c.length;p+=1){const g=c[p];if(g&&typeof g=="object")return g}return null}function sn(c){if(typeof c!="string"||!c)return null;for(let f=0;f<H.length;f+=1){const p=H[f];if(!(!p||typeof p!="object"&&typeof p!="function"))try{const g=p[c];if(typeof g=="function")return g}catch{}}return null}function pr(c,f,p={}){const g=sn("configureIconOnlyButton");if(typeof g=="function")try{g(c,f,p);return}catch(Ze){typeof console<"u"&&typeof console.warn=="function"&&console.warn("configureIconOnlyButton failed, applying fallback configuration",Ze)}if(!c)return;const S=f||(()=>{const Ze=M("ICON_GLYPHS");return Ze&&typeof Ze=="object"&&Ze.add?Ze.add:null})(),E=sn("setButtonLabelWithIcon");if(typeof E=="function")try{E(c,"",S)}catch(Ze){typeof console<"u"&&typeof console.warn=="function"&&console.warn("setButtonLabelWithIcon fallback failed",Ze)}const{contextPaths:L=[],fallbackContext:P="",actionKey:D="addEntry"}=p||{},q=sn("getLocalizedPathText"),ie=Ze=>Array.isArray(Ze)?Ze:Ze==null?[]:[Ze];let se=D==="removeEntry"?"Remove":"Add";if(typeof q=="function")try{se=q(["projectForm",D],D==="removeEntry"?"Remove":"Add")}catch(Ze){typeof console<"u"&&typeof console.warn=="function"&&console.warn("getLocalizedPathText failed to resolve action label",Ze)}let te="";const ye=ie(L);if(typeof q=="function")for(let Ze=0;Ze<ye.length;Ze+=1){const ut=ye[Ze];if(ut)try{const Ft=q(ut,"");if(Ft){te=Ft;break}}catch{}}!te&&typeof P=="string"&&P&&(te=P);const ve=te?te.replace(/[:：]\s*$/,"").trim():"",Ke=[se,ve].filter(Boolean).join(" ").trim();if(Ke)try{c.setAttribute("aria-label",Ke),c.setAttribute("title",Ke)}catch{}}function ki(){const c=Cn();return c?typeof c.installBannerDismissedInSession!="boolean"?(c.installBannerDismissedInSession=!1,!1):c.installBannerDismissedInSession:!1}function pe(c){const f=Cn();f&&(f.installBannerDismissedInSession=!!c)}function Ie(){if(ki())return!0;if(typeof localStorage>"u")return!1;try{const f=localStorage.getItem(globalThis.INSTALL_BANNER_DISMISSED_KEY)==="1";return f&&pe(!0),f}catch(c){return console.warn("Could not read install banner dismissal flag",c),ki()}}function bt(){if(pe(!0),!(typeof localStorage>"u"))try{localStorage.setItem(globalThis.INSTALL_BANNER_DISMISSED_KEY,"1")}catch(c){console.warn("Could not store install banner dismissal",c)}}function zt(){return!installPromptBanner||Ar()||Ie()?!1:_o()||Yr()}function io(){if(!installPromptBanner)return;const c=zt(),f=typeof document<"u"?document.documentElement:null;f&&typeof f.classList<"u"&&f.classList.toggle("install-banner-visible",c),c?(installPromptBanner.removeAttribute("hidden"),lt(),Eo()):(installPromptBanner.setAttribute("hidden",""),setInstallBannerOffset(0),installPromptBanner.style.removeProperty("top"))}function lt(){if(installPromptBanner&&!(typeof window>"u"||typeof window.getComputedStyle!="function"))try{const c=document.documentElement;if(!c)return;const p=window.getComputedStyle(c).getPropertyValue("--accent-color").trim();if(!p){installPromptBanner.style.removeProperty("--install-banner-text-color");return}const g=ql(p);if(!g)return;const E=Kl(g)>.55?"#000000":"#ffffff";installPromptBanner.style.setProperty("--install-banner-text-color",E)}catch(c){console.warn("Unable to update install banner colors",c)}}function Eo(){installPromptBanner}function Tr(c,f=currentLang){if(!installGuideDialog)return;const p=texts.en||{},g=texts[f]||p,S=c==="ios",E=S?"installHelpTitleIos":"installHelpTitleAndroid",L=S?"installHelpIntroIos":"installHelpIntroAndroid",P=S?"installHelpStepsIos":"installHelpStepsAndroid",D=S?"installHelpNoteIos":"installHelpNoteAndroid",q=g[E]||p[E]||"";installGuideTitle&&(installGuideTitle.textContent=q);const ie=g[L]||p[L]||"";installGuideIntro&&(installGuideIntro.textContent=ie);const se=g[P],te=p[P],ye=Ft=>Ft?Array.isArray(Ft)?Ft:[Ft]:[],ve=ye(se),Ke=ye(te),Ze=ve.length?ve:Ke;installGuideSteps&&(installGuideSteps.textContent="",Ze.forEach(Ft=>{if(!Ft)return;const Mo=document.createElement("li");Mo.textContent=Ft,installGuideSteps.appendChild(Mo)}));const ut=g[D]||p[D]||"";if(installGuideNote&&(installGuideNote.textContent=ut),installGuideDialog&&installGuideDialog.setAttribute("data-platform",c),!(!installGuideMigration||!installGuideMigrationTitle||!installGuideMigrationIntro||!installGuideMigrationSteps||!installGuideMigrationNote))if(S){installGuideMigration.removeAttribute("hidden");const Ft=g.installHelpMigrationTitle||p.installHelpMigrationTitle||"";installGuideMigrationTitle.textContent=Ft;const Mo=g.iosPwaHelpIntro||p.iosPwaHelpIntro||"";installGuideMigrationIntro.textContent=Mo;const Yt=[g.iosPwaHelpStep1||p.iosPwaHelpStep1,g.iosPwaHelpStep2||p.iosPwaHelpStep2,g.iosPwaHelpStep3||p.iosPwaHelpStep3,g.iosPwaHelpStep4||p.iosPwaHelpStep4].filter(Boolean);installGuideMigrationSteps.textContent="",Yt.forEach(Bt=>{const _r=document.createElement("li");_r.textContent=Bt,installGuideMigrationSteps.appendChild(_r)});const oo=g.iosPwaHelpNote||p.iosPwaHelpNote||"";installGuideMigrationNote.textContent=oo}else installGuideMigration.setAttribute("hidden",""),installGuideMigrationTitle.textContent="",installGuideMigrationIntro.textContent="",installGuideMigrationSteps.textContent="",installGuideMigrationNote.textContent=""}function Ur(c){if(!installGuideDialog)return;yo=c,Ko=document.activeElement,Tr(c),installGuideDialog.removeAttribute("hidden");const f=installGuideClose||installGuideDialog.querySelector('button, [href], [tabindex]:not([tabindex="-1"])');f&&typeof f.focus=="function"&&f.focus()}function Ho(){installGuideDialog&&(installGuideDialog.setAttribute("hidden",""),yo=null,Ko&&typeof Ko.focus=="function"&&Ko.focus())}function on(){if(installPromptBanner&&(installPromptBannerIcon&&applyIconGlyph(installPromptBannerIcon,ICON_GLYPHS.installApp),installPromptBannerAction&&installPromptBannerAction.addEventListener("click",c=>{c.preventDefault();const f=_o()?"ios":"android";Ur(f)}),installPromptBannerDismiss&&installPromptBannerDismiss.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),bt(),io()}),installGuideClose&&installGuideClose.addEventListener("click",Ho),installGuideDialog&&installGuideDialog.addEventListener("click",c=>{c.target===installGuideDialog&&Ho()}),zr(currentLang),lt(),io(),Eo(),typeof window<"u"&&(window.addEventListener("resize",Eo),window.addEventListener("appinstalled",io),typeof window.matchMedia=="function")))try{const c=window.matchMedia("(display-mode: standalone)"),f=()=>io();typeof c.addEventListener=="function"?c.addEventListener("change",f):typeof c.addListener=="function"&&c.addListener(f)}catch(c){console.warn("matchMedia display-mode listener failed",c)}}function zr(c){const f=texts.en||{},p=texts[c]||f,g=p.installBannerText||f.installBannerText;installPromptBannerText&&g&&(installPromptBannerText.textContent=g),installPromptBanner&&(g?(installPromptBanner.setAttribute("aria-label",g),installPromptBanner.setAttribute("title",g)):(installPromptBanner.removeAttribute("aria-label"),installPromptBanner.removeAttribute("title"))),installPromptBannerAction&&(g?(installPromptBannerAction.setAttribute("aria-label",g),installPromptBannerAction.setAttribute("title",g)):(installPromptBannerAction.removeAttribute("aria-label"),installPromptBannerAction.removeAttribute("title")));const S=p.installHelpClose||f.installHelpClose,E=p.installBannerDismiss||f.installBannerDismiss||S||"";if(installPromptBannerDismiss){const L=E||"";if(h(installPromptBannerDismiss,"",ICON_GLYPHS.circleX),L){installPromptBannerDismiss.setAttribute("aria-label",L),installPromptBannerDismiss.setAttribute("title",L);const P=document.createElement("span");P.className="visually-hidden",P.textContent=L,installPromptBannerDismiss.appendChild(P)}else installPromptBannerDismiss.removeAttribute("aria-label"),installPromptBannerDismiss.removeAttribute("title")}installGuideClose&&S&&(h(installGuideClose,S,ICON_GLYPHS.circleX),installGuideClose.setAttribute("aria-label",S),installGuideClose.setAttribute("title",S)),installGuideDialog&&!installGuideDialog.hasAttribute("hidden")&&yo&&Tr(yo,c),Eo()}function kr(c,f){if(typeof c!="string"||!c)return null;const p=S=>{if(!S||typeof S!="object")return null;try{CORE_PART2_RUNTIME_SCOPE[c]=S}catch{}return S},g=readGlobalScopeValue(c);if(g&&typeof g=="object"){const S=p(g);if(S)return S}if(typeof document<"u"&&document&&typeof document.getElementById=="function")try{const S=typeof f=="string"&&f?f:c,E=document.getElementById(S);if(E&&typeof E=="object"){const L=p(E);if(L)return L}}catch{}return null}function ln(){return kr("iosPwaHelpDialog","iosPwaHelpDialog")}function Rn(){return kr("iosPwaHelpClose","iosPwaHelpClose")}const gn=typeof exposeCoreRuntimeConstant=="function"?exposeCoreRuntimeConstant:function(){};function oa(c=!1){const f=ln();f&&(f.setAttribute("hidden",""),c&&tn())}const sa=Rn();sa&&sa.addEventListener("click",()=>oa(!0));const fn=ln();fn&&fn.addEventListener("click",c=>{c.target===fn&&oa(!0)}),document.addEventListener("keydown",c=>{if(c.key!=="Escape"&&c.key!=="Esc")return;let f=!1;const p=ln();p&&!p.hasAttribute("hidden")&&(oa(!0),f=!0),installGuideDialog&&!installGuideDialog.hasAttribute("hidden")&&(Ho(),f=!0),f&&c.preventDefault()});function un(c){if(settingsLogoPreview)if(c){settingsLogoPreview.textContent="";const f=document.createElement("img");f.src=c,f.alt="",settingsLogoPreview.appendChild(f),settingsLogoPreview.removeAttribute("hidden")}else settingsLogoPreview.textContent="",settingsLogoPreview.setAttribute("hidden","")}function Bn(){if(!settingsLogoPreview||typeof localStorage>"u")return;let c=null;try{c=localStorage.getItem("customLogo")}catch(f){console.warn("Could not load custom logo preview",f)}un(c)}const to=c=>c!==null&&typeof c=="object"&&!Array.isArray(c),An=["cameras","monitors","video","viewfinders","directorMonitors","iosVideo","videoAssist","media","lenses","fiz","batteries","batteryHotswaps","wirelessReceivers","accessories"],Hn=["motors","handUnits","controllers","distance"],Di=["chargers","cages","powerPlates","cameraSupport","matteboxes","filters","rigging","batteries","cables","videoAssist","media","cardReaders","tripodHeads","tripods","sliders","cameraStabiliser","grip","carts"],ci=5;function ra(c){if(to(c))return{...c};if(!Array.isArray(c))return;if(!c.length)return{};const f={};for(const p of c){if(Array.isArray(p)&&p.length>=2){const[E,L]=p;if(typeof E=="string"&&to(L)){f[E]=L;continue}}if(!to(p))continue;const g=typeof p.name=="string"?p.name:typeof p.label=="string"?p.label:typeof p.title=="string"?p.title:typeof p.id=="string"?p.id:null;let S=null;if(to(p.data))S=p.data;else if(g){const E={...p};delete E.name,delete E.label,delete E.title,delete E.id,to(E)&&Object.keys(E).length&&(S=E)}g&&to(S)&&(f[g]=S)}if(Object.keys(f).length)return f}function la(c,f=[]){const p={};if(to(c))for(const[g,S]of Object.entries(c)){const E=ra(S);E!==void 0?p[g]=E:S==null?p[g]={}:to(S)?p[g]={...S}:p[g]=S}for(const g of f){if(Object.prototype.hasOwnProperty.call(p,g)&&to(p[g]))continue;const S=ra(c&&c[g]);S!==void 0?p[g]=S:(!Object.prototype.hasOwnProperty.call(p,g)||p[g]==null)&&(p[g]={})}return p}const xi={batteryadapters:"batteryHotswaps",batteryadapter:"batteryHotswaps",batterieshotswap:"batteryHotswaps",director:"directorMonitors",directormonitors:"directorMonitors",directorsmonitor:"directorMonitors",ios:"iosVideo",iosvideo:"iosVideo",iosdevices:"iosVideo",ios_video:"iosVideo",iosmonitor:"iosVideo",wireless:"wirelessReceivers",wirelessvideo:"wirelessReceivers",wirelessreceiver:"wirelessReceivers"},ui=An.map(c=>({key:c,normalized:c.replace(/[^a-z0-9]+/gi,"").toLowerCase()}));function ca(c){if(typeof c!="string")return null;const f=c.trim();if(!f)return null;if(An.includes(f))return f;const p=f.replace(/[^a-z0-9]+/gi,"").toLowerCase();if(Object.prototype.hasOwnProperty.call(xi,p))return xi[p];for(let g=0;g<ui.length;g+=1){const S=ui[g];if(S.normalized===p)return S.key}return f?f.charAt(0).toLowerCase()+f.slice(1):null}const ha=["devices","entries","items","values","collection","collections","data","value"];function na(c){if(c==null)return c;if(isMapLike(c)){const p=convertMapLikeToObject(c);if(p)return na(p)}const f=ra(c);if(f!==void 0)return f;if(Array.isArray(c)){const p={};let g=!1;return c.forEach(S=>{if(Array.isArray(S)&&S.length>=2){const D=ca(S[0]);if(!D)return;p[D]=na(S[1]),g=!0;return}if(!to(S))return;let E=null;typeof S.category=="string"?E=S.category:typeof S.key=="string"?E=S.key:typeof S.name=="string"?E=S.name:typeof S.id=="string"?E=S.id:typeof S.type=="string"?E=S.type:typeof S.section=="string"?E=S.section:typeof S.title=="string"&&(E=S.title);let L=null;for(let D=0;D<ha.length;D+=1){const q=ha[D];if(Object.prototype.hasOwnProperty.call(S,q)){L=S[q];break}}if(L==null){const D={...S};delete D.category,delete D.key,delete D.name,delete D.id,delete D.type,delete D.section,delete D.title,Object.keys(D).length&&(L=D)}const P=ca(E);P&&(p[P]=na(L),g=!0)}),g?p:c}if(to(c)){for(let g=0;g<ha.length;g+=1){const S=ha[g];if(Array.isArray(c[S])){const E=ra(c[S]);if(E!==void 0)return E}if(isMapLike(c[S])){const E=convertMapLikeToObject(c[S]);if(E)return na(E)}}const p=["categories","sections","collections"];for(let g=0;g<p.length;g+=1){const S=p[g];if(Array.isArray(c[S])){const E=na(c[S]);if(E&&typeof E=="object")return E}}}return c}function Va(c){if(!Array.isArray(c))return null;const f={};let p=0;return c.forEach(g=>{if(g==null)return;if(Array.isArray(g)&&g.length>=2){const P=ca(g[0]);if(!P)return;f[P]=na(g[1]),p+=1;return}if(!to(g))return;let S=null;typeof g.category=="string"?S=g.category:typeof g.key=="string"?S=g.key:typeof g.name=="string"?S=g.name:typeof g.id=="string"?S=g.id:typeof g.type=="string"?S=g.type:typeof g.section=="string"?S=g.section:typeof g.title=="string"&&(S=g.title);let E=null;for(let P=0;P<ha.length;P+=1){const D=ha[P];if(Object.prototype.hasOwnProperty.call(g,D)){E=g[D];break}}if(E==null){const P={...g};delete P.category,delete P.key,delete P.name,delete P.id,delete P.type,delete P.section,delete P.title,Object.keys(P).length&&(E=P)}const L=ca(S);L&&(f[L]=na(E),p+=1)}),p?f:null}function za(c,f){if(!f||typeof f!="object")return!1;let p=!1;return Object.entries(f).forEach(([g,S])=>{if(S!==void 0){if(!Object.prototype.hasOwnProperty.call(c,g)){c[g]=S,p=!0;return}to(c[g])&&to(S)&&(c[g]={...S,...c[g]},p=!0)}}),p}function ba(c){if(c==null)return c;if(isMapLike(c)){const E=convertMapLikeToObject(c);if(E)return ba(E)}if(Array.isArray(c))return Va(c)||c;if(!to(c))return c;const f={...c};let p=!1;const g=["categories","sections","collections"];for(let E=0;E<g.length;E+=1){const L=g[E];if(Array.isArray(c[L])){const P=Va(c[L]);P&&za(f,P)&&(p=!0)}}const S=["data","dataset","values","entries"];for(let E=0;E<S.length;E+=1){const L=S[E];if(!Object.prototype.hasOwnProperty.call(c,L))continue;const P=ba(c[L]);P&&to(P)&&di(P)&&za(f,P)&&(p=!0)}return p?f:c}function Rl(c){if(!to(c))return c;const f={...c};for(const p of An){if(p==="fiz"){const E=Sa();f.fiz=la(c.fiz,E);continue}if(p==="accessories"){const E=jn();f.accessories=la(c.accessories,E);continue}const g=c[p],S=ra(g);S!==void 0?f[p]=S:g==null?f[p]={}:to(g)?f[p]={...g}:f[p]=g}return f}function $i(c){return to(c)?Object.values(c).some(f=>f===null||typeof f!="object"||Array.isArray(f)):!1}function Ni(c){if(!to(c))return 0;let f=0;for(const[p,g]of Object.entries(c))p==="filterOptions"||p==="None"||to(g)&&($i(g)?f+=1:f+=Ni(g));return f}function di(c){if(!to(c))return!1;let f=0;for(const p of An)Object.prototype.hasOwnProperty.call(c,p)&&(f+=1);return f>=3}function Sa(){const c=typeof globalThis<"u"&&to(globalThis.defaultDevices)?globalThis.defaultDevices:typeof globalThis<"u"&&to(globalThis.devices)?globalThis.devices:null;if(c&&to(c.fiz)){const f=Object.keys(c.fiz).filter(Boolean);if(f.length)return f}return Hn}function jn(){const c=typeof globalThis<"u"&&to(globalThis.defaultDevices)?globalThis.defaultDevices:typeof globalThis<"u"&&to(globalThis.devices)?globalThis.devices:null;if(c&&to(c.accessories)){const f=Object.keys(c.accessories).filter(Boolean);if(f.length)return f}return Di}function Ga(c){if(!to(c))return{devices:null,errors:["Imported data must be a JSON object."]};const f=[],p=[];for(const P of An){if(P==="fiz"){if(!to(c.fiz)){p.push("fiz");continue}const q=Sa().filter(ie=>!to(c.fiz[ie]));q.length&&f.push(`Missing FIZ categories: ${q.join(", ")}`);continue}if(P==="accessories"){if(!to(c.accessories)){p.push("accessories");continue}const q=jn().filter(ie=>!to(c.accessories[ie]));q.length&&f.push(`Missing accessory categories: ${q.join(", ")}`);continue}to(c[P])||p.push(P)}if(p.length&&f.push(`Missing categories: ${p.join(", ")}`),c.accessories!==void 0)if(!to(c.accessories))f.push("Accessory collections must be objects.");else for(const[P,D]of Object.entries(c.accessories))to(D)||f.push(`Accessory category "${P}" must be an object.`);if(c.filterOptions!==void 0&&!Array.isArray(c.filterOptions)&&f.push("Filter options must be provided as an array."),c.fiz&&to(c.fiz))for(const[P,D]of Object.entries(c.fiz))D!==void 0&&!to(D)&&f.push(`FIZ category "${P}" must be an object.`);const g=[],S=(P,D=[])=>{if(to(P))for(const[q,ie]of Object.entries(P)){if(q==="None"||q==="filterOptions")continue;const se=D.concat(q);if(to(ie)?$i(ie)||S(ie,se):Array.isArray(ie)||g.push(`${se.join(".")} must be an object.`),g.length>=ci)return}};S(c),f.push(...g),Ni(c)||f.push("The imported database does not contain any devices.");const L=[];for(const P of f)if(P&&!L.includes(P)&&L.push(P),L.length>=ci)break;return{devices:L.length?null:c,errors:L}}function $n(c){if(Array.isArray(c)){const g=ba(c);if(!to(g))return{devices:null,errors:["Import file must contain a JSON object, but found an array."]};c=g}if(!to(c))return{devices:null,errors:["Import file must contain a JSON object."]};if(Object.prototype.hasOwnProperty.call(c,"devices")&&!to(c.devices))return{devices:null,errors:['The "devices" property must be an object.']};let f=Object.prototype.hasOwnProperty.call(c,"devices")&&to(c.devices)?c.devices:di(c)?c:null;if(!f){const g=ba(c);g&&di(g)&&(f=g)}if(!f)return{devices:null,errors:["Could not find a device database in the selected file."]};const p=Rl(f);return Ga(p)}function vn(c){return c&&texts&&Object.prototype.hasOwnProperty.call(texts,c)?c:"en"}function Zr(c){const f=vn(c);return texts&&texts[f]||texts.en||{}}const Wn="__default__",Yn=new Map,Ea=new Map,Fi=new Map,qa=Object.freeze({style:"long",type:"conjunction"});function vs(c){if(!c||typeof c!="object")return c==null?Wn:String(c);const f=[];for(const[p,g]of Object.entries(c)){if(typeof g>"u")continue;let S;g&&typeof g=="object"?S=vs(g):S=String(g),f.push(`${p}:${S}`)}return f.length?f.sort().join("|"):Wn}function _a(c,f,p,g){const S=vs(p);let E=c.get(f);if(E||(E=new Map,c.set(f,E)),E.has(S))return E.get(S);try{const L=g(f,p);return E.set(S,L),L}catch(L){throw E.delete(S),L}}function Ka(c,f){return _a(Yn,c,f,(p,g)=>new Intl.NumberFormat(p,g))}function Ui(c){return _a(Ea,c,void 0,f=>new Intl.PluralRules(f))}function Ls(c){return _a(Fi,c,qa,f=>new Intl.ListFormat(f,qa))}function Gr(c,f,p){const g=vn(c);try{return Ka(g,p).format(f)}catch(S){if(g!=="en")try{return Ka("en",p).format(f)}catch(E){return console.warn("Number formatting failed",S,E),String(f)}return console.warn("Number formatting failed",S),String(f)}}function Ca(c,f,p,g){const S=vn(c),E=f||Zr(S),L=Zr("en");let P="Other";try{Ui(S).select(g)==="one"&&(E[`${p}One`]||L[`${p}One`])&&(P="One")}catch(se){if(S!=="en")try{Ui("en").select(g)==="one"&&(E[`${p}One`]||L[`${p}One`])&&(P="One")}catch(te){console.warn("Plural rules failed",se,te),g===1&&(E[`${p}One`]||L[`${p}One`])&&(P="One")}else g===1&&(E[`${p}One`]||L[`${p}One`])&&(P="One")}const D=`${p}${P}`,q=E[D]||L[D]||"%s",ie=Gr(S,g);return q.replace("%s",ie)}function Wa(c,f){const p=vn(c);if(!Array.isArray(f)||!f.length)return"";try{return Ls(p).format(f)}catch(g){if(p!=="en")try{return Ls("en").format(f)}catch(S){return console.warn("List formatting failed",g,S),f.join(", ")}return console.warn("List formatting failed",g),f.join(", ")}}function Qn(){if(typeof Jc!="function")return{total:0,categories:[]};const c=Jc();if(!c||typeof c!="object")return{total:0,categories:[]};const f=[];let p=0;return Object.entries(c).forEach(([g,S])=>{if(to(S))if(g==="fiz")Object.entries(S).forEach(([E,L])=>{if(!to(L))return;const P=Object.keys(L);P.length&&(f.push({key:`fiz.${E}`,count:P.length}),p+=P.length)});else{const E=Object.keys(S);if(!E.length)return;f.push({key:g,count:E.length}),p+=E.length}}),{total:p,categories:f}}function Rs(c){if(!c)return!1;if(typeof c=="string")return c.trim().length>0;if(!to(c))return!1;if(typeof c.gearList=="string")return c.gearList.trim().length>0;if(to(c.gearList))return Object.values(c.gearList).some(g=>typeof g=="string"&&g.trim().length>0);const f=typeof c.projectHtml=="string"&&c.projectHtml.trim().length>0,p=typeof c.gearHtml=="string"&&c.gearHtml.trim().length>0;return!!(f||p)}function Hi(c,f){let p=0;const g=new Set,S=(E,L)=>{if(!Rs(L))return;const P=typeof E=="string"?E:"";g.has(P)||(g.add(P),p+=1)};return typeof c=="string"?S("",c):Array.isArray(c)?c.forEach((E,L)=>{const P=to(E)&&typeof E.name=="string"?E.name:`legacy-${L}`;S(P,E)}):to(c)?Object.entries(c).forEach(([E,L])=>{S(E,L)}):S("",c),to(f)&&Object.entries(f).forEach(([E,L])=>{S(E,L)}),p}function Os(c){return to(c)?Object.values(c).reduce((f,p)=>Array.isArray(p)?f+p.length:f,0):0}function ws(c){return to(c)?Object.values(c).reduce((f,p)=>Array.isArray(p)?f+p.length:to(p)&&Array.isArray(p.entries)?f+p.entries.length:f,0):0}function Nn(c){if(Array.isArray(c)){const f=c.map(p=>Nn(p)).filter(p=>p!==void 0);return f.length?f:void 0}if(to(c)){const f={};return Object.entries(c).forEach(([p,g])=>{const S=Nn(g);S!==void 0&&(f[p]=S)}),Object.keys(f).length?f:void 0}if(c!=null)return typeof c=="string"?c.trim()?c:void 0:c}function Ya(c){if(c==null)return null;if(typeof c=="string")return c.trim()?{gearList:c}:null;if(Array.isArray(c)){const ye=Nn(c);return ye!==void 0?{gearList:ye}:null}if(!to(c))return null;const f=to(c.project)?c.project:c,p={},g=f.projectInfo??c.projectInfo,S=Nn(g);S!==void 0&&(p.projectInfo=S);const E=f.gearList??c.gearList;if(typeof E=="string")E.trim()&&(p.gearList=E);else{const ye=Nn(E);ye!==void 0&&(p.gearList=ye)}const L=f.gearSelectors??c.gearSelectors,P=Nn(L);P!==void 0&&(p.gearSelectors=P);const D=f.diagramPositions??c.diagramPositions,q=Nn(D);q!==void 0&&(p.diagramPositions=q);const ie=f.powerSelection??c.powerSelection,se=Nn(ie);se!==void 0&&(p.powerSelection=se);const te=f.autoGearRules??c.autoGearRules;if(Array.isArray(te)){const ye=Nn(te);ye!==void 0&&ye.length&&(p.autoGearRules=ye)}return Object.keys(p).length?p:null}function Ol(c){if(!to(c))return;const f={};return Object.entries(c).forEach(([p,g])=>{const S=Ya(g);S&&(f[p]=S)}),Object.keys(f).length?f:void 0}function Ts(c){const f={};to(c)&&Object.entries(c).forEach(([S,E])=>{if(S==="project"||S==="setups"||S==="autoGearRules")return;const L=Nn(E);L!==void 0&&(f[S]=L)});const p=Ya(c.project),g=Ol(c.setups);if(p&&(f.project=p),g&&(f.setups=g),Array.isArray(c.autoGearRules)){const S=Nn(c.autoGearRules);S!==void 0&&S.length&&(f.autoGearRules=S)}return f}function Gs(c){if(typeof localStorage>"u")return 0;try{const f={};for(let E=0;E<localStorage.length;E+=1){const L=localStorage.key(E);typeof L=="string"&&(f[L]=localStorage.getItem(L))}const p=to(c)?Ts(c):{},g={version:typeof APP_VERSION<"u"?APP_VERSION:"",generatedAt:new Date().toISOString(),settings:f,data:p},S=JSON.stringify(g);return typeof TextEncoder<"u"?new TextEncoder().encode(S).length:S.length}catch(f){return console.warn("Could not calculate backup size preview",f),0}}function _s(c,f,p){const g=vn(c);if(!Number.isFinite(p)||p<=0){const D=Gr(g,0,{maximumFractionDigits:0});return(f.storageTotalSizeValue||texts.en?.storageTotalSizeValue||"~%s KB").replace("%s",D)}const S=p/1024;let E;S>=100?E={maximumFractionDigits:0}:S>=10?E={minimumFractionDigits:1,maximumFractionDigits:1}:E={minimumFractionDigits:2,maximumFractionDigits:2};const L=Gr(g,S,E);return(f.storageTotalSizeValue||texts.en?.storageTotalSizeValue||"~%s KB").replace("%s",L)}function tt(c,f){if(!Array.isArray(f)||!f.length)return"";const p=vn(c),g=typeof categoryNames<"u"&&categoryNames||{},S=g[p]||g.en||{},E=g.en||{},L=f.map(({key:P,count:D})=>{const q=S[P]||E[P]||P,ie=Gr(p,D,{maximumFractionDigits:0});return{label:q,text:`${q} (${ie})`}}).sort((P,D)=>P.label.localeCompare(D.label,p,{sensitivity:"base"})).map(P=>P.text);return Wa(p,L)}const Ct=(()=>{if(typeof require=="function")try{return require("./app-core-auto-backup.js")}catch{}const c=[typeof CORE_PART2_RUNTIME_SCOPE<"u"?CORE_PART2_RUNTIME_SCOPE:null,typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let f=0;f<c.length;f+=1){const p=c[f];if(!(!p||typeof p!="object"&&typeof p!="function"))try{if(p.CORE_AUTO_BACKUP&&typeof p.CORE_AUTO_BACKUP=="object")return p.CORE_AUTO_BACKUP}catch{}}return null})(),vo=Ct&&typeof Ct.AUTO_BACKUP_NAME_PREFIX=="string"?Ct.AUTO_BACKUP_NAME_PREFIX:"auto-backup-",Lo=Ct&&typeof Ct.AUTO_BACKUP_DELETION_PREFIX=="string"?Ct.AUTO_BACKUP_DELETION_PREFIX:"auto-backup-before-delete-",vr=new Set(["timestamp","createdat","created_at","savedat","saved_at","updatedat","updated_at","generatedat","generated_at","generatedon","generated_on","exportedat","exported_at","modifiedat","modified_at","iso"]),rn=/^(\d{4})-(\d{2})-(\d{2})(?:[T\s](\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{1,3}))?)?)?(?:Z|[+-]\d{2}:\d{2})?$/;function pn(c){return typeof c!="string"?!1:c.startsWith(vo)||c.startsWith(Lo)}function Ln(c){if(typeof c!="string")return null;let f="";if(c.startsWith(vo))f=c.slice(vo.length);else if(c.startsWith(Lo))f=c.slice(Lo.length);else return null;const p=f.split("-");if(p.length<6)return null;const g=p.slice(0,6).map(se=>parseInt(se,10));if(g.some(se=>Number.isNaN(se)))return null;const[S,E,L,P,D,q]=g,ie=new Date(S,E-1,L,P,D,q);return Number.isNaN(ie.getTime())?null:ie}function yn(c){if(!c)return null;const f=new Set,p=[c];let g=null;const S=E=>{E instanceof Date&&(Number.isNaN(E.getTime())||(!g||E>g)&&(g=E))};for(;p.length;){const E=p.shift();if(E!=null){if(typeof E=="string"){const L=E.trim();if(!L)continue;rn.test(L)&&S(new Date(L));continue}if(typeof E=="object"&&!f.has(E)){if(f.add(E),Array.isArray(E)){E.forEach(L=>{(L&&typeof L=="object"||typeof L=="string")&&p.push(L)});continue}Object.entries(E).forEach(([L,P])=>{const D=typeof L=="string"?L.toLowerCase():"";if(typeof P=="string"){const q=P.trim();if(!q)return;(vr.has(D)||rn.test(q))&&S(new Date(q));return}P&&typeof P=="object"&&p.push(P)})}}}return g}function hn(c){const f={hasAny:!1,date:null,name:""};return to(c)&&Object.entries(c).forEach(([p,g])=>{if(!p||typeof p!="string"||pn(p))return;f.hasAny=!0;const S=yn(g);S&&(!f.date||S>f.date)&&(f.date=S,f.name=p)}),f}function Xn(c){const f={hasAny:Array.isArray(c)&&c.length>0,date:null,name:""};return Array.isArray(c)&&c.forEach(p=>{const g=Ln(p);g&&(!f.date||g>f.date)&&(f.date=g,f.name=p)}),f}function Qa(c){const f={hasAny:Array.isArray(c)&&c.length>0,date:null,name:""};return Array.isArray(c)&&c.forEach(p=>{if(p){if(typeof p=="string"){const g=p.trim();if(!g)return;const S=new Date(g);if(Number.isNaN(S.getTime()))return;(!f.date||S>f.date)&&(f.date=S,f.name=g);return}if(typeof p=="object"){const g=yn(p);if(!g)return;(!f.date||g>f.date)&&(f.date=g,typeof p.fileName=="string"&&p.fileName.trim()?f.name=p.fileName.trim():typeof p.name=="string"&&p.name.trim()?f.name=p.name.trim():typeof p.createdAt=="string"&&p.createdAt.trim()?f.name=p.createdAt.trim():typeof p.iso=="string"&&p.iso.trim()?f.name=p.iso.trim():typeof p.timestamp=="string"&&p.timestamp.trim()?f.name=p.timestamp.trim():f.name="")}}}),f}function Ia(c,f){if(!(c instanceof Date)||Number.isNaN(c.getTime()))return"";const p=vn(f||currentLang);if(typeof Intl<"u"&&typeof Intl.DateTimeFormat=="function")try{return new Intl.DateTimeFormat(p,{dateStyle:"medium",timeStyle:"short"}).format(c)}catch(g){console.warn("Failed to format absolute timestamp",g)}return c.toISOString().replace("T"," ").replace(/Z$/," UTC")}function Pa(c,f){if(!(c instanceof Date)||Number.isNaN(c.getTime())||typeof Intl>"u"||typeof Intl.RelativeTimeFormat!="function")return"";const p=vn(f||currentLang),g=c.getTime()-Date.now(),S=Math.abs(g);let E="minute",L=6e4;S>=864e5?(E="day",L=864e5):S>=36e5?(E="hour",L=36e5):S<6e4&&(E="second",L=1e3);const P=new Intl.RelativeTimeFormat(p,{numeric:"auto"}),D=Math.round(g/L);try{return P.format(D,E)}catch(q){return console.warn("Failed to format relative timestamp",q),""}}function Ba(c,f,p){if(!(c instanceof Date)||Number.isNaN(c.getTime()))return"";const g=Ia(c,f),S=Pa(c,f);return S?(p.storageStatusTimestamp||texts.en?.storageStatusTimestamp||"{relative} ({absolute})").replace("{relative}",S).replace("{absolute}",g):(p.storageStatusTimestampAbsolute||texts.en?.storageStatusTimestampAbsolute||"{absolute}").replace("{absolute}",g)}function fi(c,f,p,g,S){if(!c)return;if(f&&f.date instanceof Date&&!Number.isNaN(f.date.getTime())){const L=Ba(f.date,p,g),P=f.name?(g.storageStatusWithName||texts.en?.storageStatusWithName||"{name} — {time}").replace("{name}",f.name).replace("{time}",L):L;c.textContent=P,P?c.setAttribute("data-help",P):c.removeAttribute("data-help");const D=Ia(f.date,p);D?c.setAttribute("title",D):c.removeAttribute("title");return}if(S){const L=g.storageStatusStoredWithoutTimestamp||texts.en?.storageStatusStoredWithoutTimestamp||g.storageStatusNever||texts.en?.storageStatusNever||"";c.textContent=L,L?c.setAttribute("data-help",L):c.removeAttribute("data-help"),c.removeAttribute("title");return}const E=g.storageStatusNever||texts.en?.storageStatusNever||"";c.textContent=E,E?c.setAttribute("data-help",E):c.removeAttribute("data-help"),c.removeAttribute("title")}const Rf=1e3*60*60*48,Of=1e3*60*60*12,wf=1e3*60*60*24*7;let On=typeof storageStatusReminder<"u"?storageStatusReminder:typeof document<"u"?document.getElementById("storageStatusReminder"):null;function Aa(c,f,p=""){return c&&typeof c[f]=="string"&&c[f].trim()?c[f]:texts.en&&typeof texts.en[f]=="string"&&texts.en[f].trim()?texts.en[f]:p}const ru={offline:"reloadAppOfflineNotice","cache-fallback":"offlineIndicatorReasonCacheFallback","get-failed":"offlineIndicatorReasonGetFailed",timeout:"offlineIndicatorReasonTimeout",unreachable:"offlineIndicatorReasonUnreachable","reload-blocked":"offlineIndicatorReasonReloadBlocked",default:"offlineIndicatorReasonUnknown"};function Tf(c,f){const p=ru[f]||ru.default;return Aa(c,p)}function wl(c){return c instanceof Date&&!Number.isNaN(c.getTime())}function Gf(c,f,p,g,S){if(!On)return;for(;On.firstChild;)On.removeChild(On.firstChild);On.classList.remove("storage-status-reminder--warning","storage-status-reminder--ok");const E=[],L=Date.now(),P=c&&wl(c.date)?c.date:null,D=f&&wl(f.date)?f.date:null,q=p&&wl(p.date)?p.date:null;document.getElementById("storageSummaryList");const ie=typeof window<"u"&&window&&typeof window.cineConnectivityStatus=="object"?window.cineConnectivityStatus:null;if(ie){const Ke=typeof ie.status=="string"?ie.status:null;if(Ke==="offline"||Ke==="degraded"){const Ze=typeof ie.reason=="string"?ie.reason:null,ut=Aa(S,"storageStatusReminderConnectivity");if(ut){const Ft=Tf(S,Ze),Mo=ut.replace("{reason}",Ft||"").replace(/\s+/g," ").trim();Mo&&E.push(Mo)}}}const se=P?Ba(P,g,S)||Ia(P,g):"",te=D?Ba(D,g,S)||Ia(D,g):"",ye=q?Ba(q,g,S)||Ia(q,g):"";if(!c||c.hasAny!==!0){const Ke=Aa(S,"storageStatusReminderSaveProject");Ke&&E.push(Ke)}else if(P&&L-P.getTime()>Rf){const Ke=Aa(S,"storageStatusReminderRefreshProject");Ke&&E.push(Ke.replace("{time}",se))}if(!f||f.hasAny!==!0){const Ke=Aa(S,"storageStatusReminderAutoBackupFirst");Ke&&E.push(Ke)}else if(D&&L-D.getTime()>Of){const Ke=Aa(S,"storageStatusReminderAutoBackup");Ke&&E.push(Ke.replace("{time}",te))}if(!p||p.hasAny!==!0){const Ke=Aa(S,"storageStatusReminderFullBackupFirst");Ke&&E.push(Ke)}else if(q&&L-q.getTime()>wf){const Ke=Aa(S,"storageStatusReminderFullBackup");Ke&&E.push(Ke.replace("{time}",ye))}if(E.length>0){const Ke=document.createElement("ul");if(Ke.className="storage-status-reminder-list",E.forEach(Ze=>{if(!Ze)return;const ut=document.createElement("li");ut.textContent=Ze,Ke.appendChild(ut)}),Ke.childElementCount>0){On.appendChild(Ke),On.classList.add("storage-status-reminder--warning"),On.removeAttribute("hidden"),On.setAttribute("data-help",Ke.textContent||E.join(" "));return}}const ve=Aa(S,"storageStatusReminderUpToDate");if(ve){const Ke=document.createElement("p");Ke.className="storage-status-reminder-text",Ke.textContent=ve,On.appendChild(Ke),On.classList.add("storage-status-reminder--ok"),On.removeAttribute("hidden"),On.setAttribute("data-help",ve);return}On.setAttribute("hidden",""),On.removeAttribute("data-help")}function _f(c){const f=document.createElement("li");f.className="storage-summary-item";const p=document.createElement("div");p.className="storage-summary-header";const g=document.createElement("span");if(g.className="storage-summary-label",g.textContent=c.label,p.appendChild(g),c.storageKey){const S=document.createElement("code");S.className="storage-summary-key",S.textContent=c.storageKey,p.appendChild(S)}if(f.appendChild(p),c.value){const S=document.createElement("p");S.className="storage-summary-value",S.textContent=c.value,f.appendChild(S)}if(c.description){const S=document.createElement("p");S.className="storage-summary-description",S.textContent=c.description,f.appendChild(S)}return c.extra&&(Array.isArray(c.extra)?c.extra:[c.extra]).filter(Boolean).forEach(E=>{const L=document.createElement("p");L.className="storage-summary-extra",L.textContent=E,f.appendChild(L)}),f}function If(){const c=g=>{if(typeof g!="function")return null;try{return g()}catch(S){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to read critical storage guard result",S),null}},f=typeof getLastCriticalStorageGuardResult=="function"?c(()=>getLastCriticalStorageGuardResult()):null;if(f&&typeof f=="object")return f;const p=[r,a,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let g=0;g<p.length;g+=1){const S=p[g];if(!S||typeof S!="object")continue;const E=S.__cineCriticalStorageGuard||S.cineCriticalStorageGuard;if(E&&typeof E=="object")return E}return null}function Is(){if(typeof document>"u"||!document)return;const c=document.getElementById("storageSummaryList"),f=document.getElementById("storageSummaryEmpty");if(!c)return;for(;c.firstChild;)c.removeChild(c.firstChild);const p=vn(currentLang),g=Zr(p),S=typeof exportAllData=="function"?exportAllData():null,E=to(S)?S:{},L=to(E.setups)?E.setups:{},P=Object.keys(L),D=P.length,q=P.filter(nt=>pn(nt)),ie=q.length,se=P.filter(nt=>typeof nt=="string"&&!pn(nt)),te=Hi(E.project,L),ye=Os(E.favorites),ve=ws(E.feedback),Ke=E.session,Ze=!!(to(Ke)&&Object.keys(Ke).length||Array.isArray(Ke)&&Ke.length||typeof Ke=="string"&&Ke.trim()),ut=Qn(),Ft=Gs(E),Mo=Array.isArray(E.fullBackupHistory)?E.fullBackupHistory:Array.isArray(E.fullBackups)?E.fullBackups:[],Yt=Mo.reduce((nt,Mt)=>{if(!Mt)return nt;if(typeof Mt=="string")return Mt.trim()?nt+1:nt;if(typeof Mt=="object"){const lo=typeof Mt.createdAt=="string"?Mt.createdAt.trim():"",tr=typeof Mt.iso=="string"?Mt.iso.trim():"",xr=typeof Mt.timestamp=="string"?Mt.timestamp.trim():"";if(lo||tr||xr)return nt+1}return nt},0),oo=hn(L),Bt=Xn(q),_r=Qa(Mo),At=If();let gt=g.storageIntegrityGuardStatus||"Active";if(At&&typeof At=="object"){const nt=Array.isArray(At.ensured)?At.ensured.length:0,Mt=Array.isArray(At.errors)?At.errors.length:0,lo=Array.isArray(At.skipped)?At.skipped.filter(tr=>tr&&tr.reason==="missing").length:0;Mt>0?gt=(g.storageIntegrityGuardStatusIssue||"{count} issue(s) — check console").replace("{count}",String(Mt)):nt>0?gt=(g.storageIntegrityGuardStatusCreated||"Mirrored {count} key(s) this session").replace("{count}",String(nt)):lo>0?gt=(g.storageIntegrityGuardStatusMissing||"Waiting for first save").replace("{count}",String(lo)):g.storageIntegrityGuardStatus&&(gt=g.storageIntegrityGuardStatus)}[{storageKey:"cameraPowerPlanner_setups",label:g.storageKeyProjects||"Saved projects",value:Ca(p,g,"storageProjectsCount",D),description:g.storageKeyProjectsDesc||""},{label:g.storageKeyAutoBackups||"Auto backups",value:Ca(p,g,"storageAutoBackupsCount",ie),description:g.storageKeyAutoBackupsDesc||""},{storageKey:"cameraPowerPlanner_project",label:g.storageKeyGearLists||"Gear list snapshots",value:Ca(p,g,"storageGearListsCount",te),description:g.storageKeyGearListsDesc||""},{storageKey:"cameraPowerPlanner_devices",label:g.storageKeyDevices||"Custom or modified devices",value:Ca(p,g,"storageDevicesCount",ut.total),description:g.storageKeyDevicesDesc||"",extra:ut.total>0&&ut.categories.length?(g.storageDeviceCategories||texts.en?.storageDeviceCategories||"Affected categories: %s").replace("%s",tt(p,ut.categories)):null},{storageKey:"cameraPowerPlanner_favorites",label:g.storageKeyFavorites||"Pinned favorites",value:Ca(p,g,"storageFavoritesCount",ye),description:g.storageKeyFavoritesDesc||""},{storageKey:"cameraPowerPlanner_feedback",label:g.storageKeyFeedback||"Runtime feedback",value:Ca(p,g,"storageFeedbackCount",ve),description:g.storageKeyFeedbackDesc||""},{storageKey:"cameraPowerPlanner_session",label:g.storageKeySession||"Unsaved session",value:Ze?g.storageSessionStored||texts.en?.storageSessionStored||"Stored":g.storageSessionNotStored||texts.en?.storageSessionNotStored||"Not stored",description:g.storageKeySessionDesc||""},{storageKey:"cameraPowerPlanner_fullBackups",label:g.storageKeyFullBackups||"Full app backups",value:Ca(p,g,"storageFullBackupsCount",Yt),description:g.storageKeyFullBackupsDesc||""},{label:g.storageKeyIntegrityGuard||"Backup guardian",value:gt,description:g.storageKeyIntegrityGuardDesc||""},{storageKey:"localStorage",label:g.storageKeyTotalSize||"Approximate backup size",value:_s(p,g,Ft),description:g.storageKeyTotalSizeDesc||""}].forEach(nt=>{c.appendChild(_f(nt))}),fi(storageStatusLastProjectValue,oo,p,g,se.length>0),fi(storageStatusLastAutoBackupValue,Bt,p,g,q.length>0),fi(storageStatusLastFullBackupValue,_r,p,g,Yt>0),Gf(oo,Bt,_r,p,g),f&&(!!(D||te||ut.total||ye||ve||Ze||Yt)?f.setAttribute("hidden",""):f.removeAttribute("hidden"))}typeof exposeCoreRuntimeConstant=="function"?exposeCoreRuntimeConstant("updateStorageSummary",Is):typeof window<"u"&&(window.updateStorageSummary=Is);let pi=null,Xa=null,dn=null,Ps=null,ji=null,nu=null,au=null,Tl=null,Gl=null,Vi=null,zi=null,_l=null,qi=null,mi=null,gi=null,yi=null,hi=null,bi=null,Si=null,Ei=null,Ki=null,Za=null,Ci=null,Wi=null,Bs=null,Yi=null,Mn=null,iu=null,su=null,so=null,lu=[],Ai=null,vi=null,Vn=null,Il=null,Zn=null,Qi=null;function cu(){typeof document>"u"||(pi=kr("settingsLogo","settingsLogo"),pi&&pi.addEventListener("change",()=>{const c=pi.files&&pi.files[0];if(!c){Bn();return}if(c.type!=="image/svg+xml"&&!c.name.toLowerCase().endsWith(".svg")){showNotification("error",texts[currentLang].logoFormatError||"Unsupported logo format"),pi.value="",Bn();return}const f=new FileReader;f.onload=()=>{un(f.result)},f.readAsDataURL(c)}),document.getElementById("settingsHighContrast"),document.getElementById("settingsReduceMotion"),document.getElementById("settingsRelaxedSpacing"),document.getElementById("backupSettings"),document.getElementById("restoreSettings"),document.getElementById("factoryResetButton"),document.getElementById("restoreSettingsInput"),document.getElementById("restoreRehearsalButton"),document.getElementById("restoreRehearsalSection"),document.getElementById("restoreRehearsalHeading"),document.getElementById("restoreRehearsalIntro"),document.getElementById("restoreRehearsalModeLabel"),document.getElementById("restoreRehearsalModeBackupText"),document.getElementById("restoreRehearsalModeProjectText"),document.getElementById("restoreRehearsalFileLabel"),document.getElementById("restoreRehearsalBrowse"),document.getElementById("restoreRehearsalFileName"),document.getElementById("restoreRehearsalStatus"),document.getElementById("restoreRehearsalRuleHeading"),document.getElementById("restoreRehearsalRuleIntro"),document.getElementById("restoreRehearsalRuleEmpty"),document.getElementById("restoreRehearsalProceed"),document.getElementById("restoreRehearsalAbort"),document.getElementById("restoreRehearsalTable"),mi=document.getElementById("motorConnectorInput"),gi=document.getElementById("controllerConnectorInput"),yi=document.getElementById("controllerPowerInput"),hi=document.getElementById("controllerBatteryInput"),bi=document.getElementById("controllerConnectivityInput"),document.getElementById("fizConnectorInput"),Si=document.getElementById("distanceConnectionInput"),Ei=document.getElementById("distanceMethodInput"),Ki=document.getElementById("autoGearShootingDaysMode"),Za=document.getElementById("cameraPortTypeInput"),Ci=document.getElementById("monitorPortTypeInput"),Wi=document.getElementById("autoGearShootingDaysInput"),Bs=document.getElementById("autoGearItemCatalog"),Yi=document.getElementById("autoGearBackupRestoreButton"),Mn=document.getElementById("autoGearBackupSelect"),iu=document.getElementById("autoGearRemoveItemButton"),su=document.getElementById("autoGearAddItemButton"),Ai=document.getElementById("distanceOutputInput"),vi=document.getElementById("autoGearBackupRetentionInput"),Vn=document.getElementById("autoGearCameraWeightValueInput"),document.getElementById("autoGearCameraWeightModeSelect"),Il=document.getElementById("autoGearScenarioFactorInput"),Zn=document.getElementById("autoGearRuleNameInput"),Qi=document.getElementById("autoGearSearchInput"),On=document.getElementById("storageStatusReminder"),so||(so={add:[],remove:[],cameraWeight:null,shootingDays:null}),document.getElementById("restoreRehearsalTableCaption"),document.getElementById("restoreRehearsalMetricHeader"),document.getElementById("restoreRehearsalLiveHeader"),document.getElementById("restoreRehearsalSandboxHeader"),document.getElementById("restoreRehearsalDifferenceHeader"),document.getElementById("restoreRehearsalClose"),document.getElementById("projectBackupsHeading"),document.getElementById("projectBackupsDescription"),document.getElementById("settingsShowAutoBackups"),document.getElementById("backupDiffToggleButton"),document.getElementById("backupDiffSection"),document.getElementById("backupDiffHeading"),document.getElementById("backupDiffIntro"),document.getElementById("backupDiffPrimaryLabel"),document.getElementById("backupDiffSecondaryLabel"),document.getElementById("backupDiffPrimary"),document.getElementById("backupDiffSecondary"),document.getElementById("backupDiffEmptyState"),document.getElementById("backupDiffSummary"),document.getElementById("backupDiffList"),document.getElementById("backupDiffListContainer"),document.getElementById("backupDiffNotesLabel"),document.getElementById("backupDiffNotes"),document.getElementById("backupDiffExport"),document.getElementById("backupDiffClose"),document.getElementById("aboutVersion"),document.getElementById("supportLink"),document.getElementById("settingsSave"),document.getElementById("settingsCancel"),Xa=document.getElementById("featureSearch"),dn=document.getElementById("featureSearchDropdown"))}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",cu):cu());var Pl=new Map,uu=new Map;const Ms=new Map,du="featureSearchHistory",Bl=50,Pf=5;let Ml=!1,Li=!1;console.log("DEBUG: app-core-new-2.js line 10000 REACHED");let Ri=null;const Bf=1e3,ua=new Map;let kl=null;const fu=()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage;if(typeof globalThis<"u"&&globalThis.localStorage)return globalThis.localStorage}catch(c){console.warn("Feature search history storage unavailable",c)}return null},Dl=(c,f="feature")=>c?`${f}:${c}`:"",Mf=()=>{if(kl!=null)return;const c=fu();!c||typeof c.setItem!="function"||(kl=setTimeout(()=>{kl=null;try{const f=Array.from(ua.values()).slice().sort((p,g)=>g.lastUsed-p.lastUsed).map(p=>({key:p.id,type:p.type,count:p.count,lastUsed:p.lastUsed,label:p.label}));c.setItem(du,JSON.stringify(f))}catch(f){console.warn("Could not persist feature search history",f)}},200))},kf=()=>{if(ua.size<=Bl)return;const c=Array.from(ua.entries()).sort((p,g)=>p[1].lastUsed-g[1].lastUsed),f=c.length-Bl;for(let p=0;p<f;p+=1)ua.delete(c[p][0])},Df=()=>{Ri&&(typeof clearTimeout=="function"&&clearTimeout(Ri),Ri=null)},pu=()=>{Ri||typeof setTimeout!="function"||(Ri=setTimeout(()=>{Ri=null,Li=!1,ks()},Bf))},ks=()=>{if(Ml||Li)return;Li=!0;const c=fu();if(!c||typeof c.getItem!="function"){Li=!1,pu();return}let f=null;try{f=c.getItem(du)}catch(g){Li=!1,Ml=!1,console.warn("Could not read feature search history",g),pu();return}if(Li=!1,Ml=!0,Df(),!f)return;let p=null;try{p=JSON.parse(f)}catch(g){console.warn("Invalid feature search history payload",g);return}Array.isArray(p)&&(p.forEach(g=>{if(!g||typeof g!="object")return;const S=typeof g.id=="string"?g.id:typeof g.key=="string"?g.key:null,E=typeof g.type=="string"?g.type:"feature",L=Dl(S,E);if(!L)return;const P=Number.isFinite(g.count)&&g.count>0?Math.min(Math.floor(g.count),1e6):0,D=Number.isFinite(g.lastUsed)?g.lastUsed:0,q=typeof g.label=="string"?g.label:"";ua.set(L,{key:L,id:S,type:E,count:P,lastUsed:D,label:q})}),kf())},xf=()=>{let c=!1;for(const f of ua.keys())Ms.has(f)||(ua.delete(f),c=!0);c&&Mf()},$f=(c,f)=>{if(!c)return null;ks();const p=Dl(c,f);return ua.get(p)||null},Nf=()=>{const c=xl();if(!c.length)return[];const f=[],p=new Set;for(const g of c){const S=wi(g);if(!(!S||!S.value||p.has(S.value))&&(p.add(S.value),f.push(S),f.length>=Pf))break}return f},xl=()=>{if(ks(),!ua.size)return[];const c=Array.from(ua.values()).slice().sort((g,S)=>S.lastUsed-g.lastUsed),f=[],p=new Set;for(const g of c){if(!g||!g.key||p.has(g.key))continue;p.add(g.key);const S=Ms.get(g.key);if(S&&(f.push(S),f.length>=Bl))break}return f},Ff=Br(),mu=c=>{try{if(we&&typeof we.normalizeSearchValue=="function")return we.normalizeSearchValue(c)}catch(f){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("normalizeSearchValue() failed",f)}return Ff(c)};gn("normalizeSearchValue",mu);const Uf="[data-feature-search]",gu=c=>{if(!c)return"feature";const f=c.dataset?.featureSearchType||c.getAttribute("data-feature-search-type");if(f&&f.trim())return f.trim().toLowerCase();const p=c.tagName?c.tagName.toLowerCase():"",g=c.getAttribute("role")?.toLowerCase()||"";if(p==="button"||p==="a"&&c.hasAttribute("href"))return"action";if(p==="input"){const S=c.getAttribute("type")?.toLowerCase();if(S&&["button","submit","reset","image"].includes(S))return"action"}return g==="button"||g==="menuitem"?"action":"feature"},Hf=c=>{if(!c)return"";const{dataset:f}=c,p=f?.featureSearchLabel||c.getAttribute("data-feature-search-label");if(p&&p.trim())return p.trim();const g=c.getAttribute("aria-label");if(g&&g.trim())return g.trim();const S=c.getAttribute("title");if(S&&S.trim())return S.trim();const E=c.textContent;return E&&E.trim()?E.trim():""},jf=c=>{if(!c)return"";const{dataset:f}=c,p=f?.featureSearchKeywords||c.getAttribute("data-feature-search-keywords");return p&&p.trim()?p.trim():""};var Vf=(c,f)=>{if(!Xa||typeof c!="string")return;const p=c.trim();if(!p){Xa.value="",Ma();return}f&&p.toLowerCase()===f||(Xa.value=c,Ma())},$l=new Map,Ja=new Map,zf=()=>{},Jn=[],Oi=[];let yu=[];const qf=c=>{try{if(we&&typeof we.sanitizeHighlightTokens=="function")return we.sanitizeHighlightTokens(c)}catch(f){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("sanitizeFeatureSearchHighlightTokens() failed",f)}return jt.sanitizeHighlightTokens(c)},hu=c=>{yu=qf(c)},bu=(c,f)=>{const p=yu;try{if(we&&typeof we.applyHighlight=="function"){we.applyHighlight(c,f,p);return}}catch(g){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("applyFeatureSearchHighlight() failed",g)}jt.applyHighlight(c,f,p)},ei=c=>{try{if(we&&typeof we.normalizeDetail=="function")return we.normalizeDetail(c)}catch(f){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("normalizeFeatureSearchDetail() failed",f)}return jt.normalizeDetail(c)},Su=new Map,Eu=new Set;let Cu=0;const Kf=c=>{if(c==null)return"";let f=String(c).trim();if(!f)return"";if(typeof f.normalize=="function")try{f=f.normalize("NFKD")}catch{}return f=f.replace(/[\u0300-\u036f]/g,""),f=f.toLowerCase().replace(/[^a-z0-9]+/g,"-"),f.replace(/^-+|-+$/g,"")},Ds=c=>{const f=c==null?"":String(c),p=Su.get(f);if(p)return p;const g=Kf(f);let S=g?`featureSearchOption-${g}`:"";S||(Cu+=1,S=`featureSearchOption-generated-${Cu}`);let E=S,L=1;for(;Eu.has(E);)E=`${S}-${L}`,L+=1;return Eu.add(E),Su.set(f,E),E},wi=c=>{if(!c)return null;const f=typeof c=="string"?c:c.display;if(!f)return null;const p=typeof c=="string"?c:c.optionLabel||c.display||"",g=typeof c=="object"&&c!==null?ei(c.detail):"";let S=p||f;g&&(S=`${S} — ${g}`);const E=Ds(f),L=typeof c=="object"&&c!==null&&c.key||"",P=typeof c=="object"&&c!==null&&c.type||"feature",D={value:f,label:S||f,id:E,entry:c,entryKey:L,entryType:P};return D},Wf=c=>{if(!c)return null;if(typeof c=="object"){const f=c.value||c.display||"";if(!f)return null;const p=c.label||c.optionLabel||f,g=typeof c.id=="string"&&c.id.trim()?c.id.trim():Ds(f);return{value:f,label:p,id:g,entry:c.entry,entryKey:c.entryKey,entryType:c.entryType}}return typeof c=="string"?{value:c,label:c,id:Ds(c)}:null},Yf=()=>!dn||typeof dn.closest!="function"?null:dn.closest(".feature-search"),Nl=c=>{const f=Yf();f&&(c?f.classList.add("feature-search-open"):f.classList.remove("feature-search-open"))},Au=c=>{if(!dn)return;dn.innerHTML="";const f=dn.__optionEntries instanceof Map?dn.__optionEntries:new Map;if(f.clear(),dn.__optionEntries=f,!Array.isArray(c)||c.length===0){dn.dataset.count="0",dn.dataset.open="false",dn.hidden=!0,dn.setAttribute("aria-expanded","false"),Nl(!1);return}const p=document.createElement("div");p.className="feature-search-dropdown-list",c.forEach((g,S)=>{if(!g||!g.value)return;const E=document.createElement("button");E.type="button",E.className="feature-search-option";const L=g.id||Ds(g.value);L&&(E.id=L),E.setAttribute("role","option"),E.setAttribute("tabindex",S===0?"0":"-1"),E.setAttribute("data-value",g.value),g.entryKey&&E.setAttribute("data-entry-key",g.entryKey),g.entryType&&E.setAttribute("data-entry-type",g.entryType),E.setAttribute("aria-label",g.label||g.value),E.setAttribute("aria-selected","false"),L&&f.set(L,g.entry||null);const P=g.entry&&typeof g.entry=="object"?g.entry.value:null,D=P&&P.icon?P.icon:null;if(D){const ve=document.createElement("span");ve.className="feature-search-option-icon",applyIconGlyph(ve,D),E.appendChild(ve)}const q=document.createElement("div");q.className="feature-search-option-content";const ie=document.createElement("span");ie.className="feature-search-option-label";const se=g.label||g.value;bu(ie,se),q.appendChild(ie);const te=(se||"").trim().toLowerCase(),ye=g.value.trim().toLowerCase();if(ye&&te&&ye!==te){const ve=document.createElement("span");ve.className="feature-search-option-value",bu(ve,g.value),q.appendChild(ve)}E.appendChild(q),p.appendChild(E)}),dn.appendChild(p),dn.dataset.count=String(c.length),dn.dataset.activeIndex="",dn.dataset.open==="true"?(dn.hidden=!1,dn.setAttribute("aria-expanded","true"),Nl(!0)):(dn.hidden=!0,dn.setAttribute("aria-expanded","false"),Nl(!1))},va=c=>{if(!Array.isArray(c)){Au([]);return}const f=[];for(const p of c){const g=Wf(p);!g||!g.value||f.push(g)}Au(f)},xs=40;function Ma(){hu([]);const c=[],f=new Set,p=Nf();for(const g of p)!g||!g.value||f.has(g.value)||(f.add(g.value),c.push(g));for(const g of Oi)!g||!g.value||f.has(g.value)||(f.add(g.value),c.push(g));va(c.length?c:Oi)}const ti={none:0,fuzzy:1,partial:2,keySubset:3,keyPrefix:4,token:5,exactKey:6},Qf={feature:8,action:10,device:6,help:1};let vu=null,Fl=null,Ul=null;const Lu=()=>{const c=typeof currentLang=="string"&&currentLang.trim()?currentLang.trim():"en";if(vu===c&&Fl&&Ul)return{filterAliases:Fl,stopWords:Ul};const f=typeof Zr=="function"?Zr(c):texts?.[c]||texts?.en||{},p=typeof Zr=="function"?Zr("en"):texts?.en||{},g=f&&typeof f.featureSearchFilterAliases=="object"?f.featureSearchFilterAliases:null,S=p&&typeof p.featureSearchFilterAliases=="object"?p.featureSearchFilterAliases:null,E=new Set([...Object.keys(S||{}),...Object.keys(g||{})]),L=new Map;for(const se of E){const te=String(se||"").trim().toLowerCase();if(!te)continue;const ye=g&&Array.isArray(g[se])?g[se]:null,ve=S&&Array.isArray(S[se])?S[se]:null,Ke=ye&&ye.length?ye:ve||[];for(const Ze of Ke){if(typeof Ze!="string")continue;const ut=Ze.trim().toLowerCase();ut&&L.set(ut,te)}}const P=Array.isArray(f?.featureSearchStopWords)?f.featureSearchStopWords:null,D=Array.isArray(p?.featureSearchStopWords)?p.featureSearchStopWords:[],q=P&&P.length?P:D,ie=new Set;for(const se of q){if(typeof se!="string")continue;const te=se.trim().toLowerCase();te&&ie.add(te)}return vu=c,Fl=L,Ul=ie,{filterAliases:L,stopWords:ie}},Xf=/^[\s:> /=\-?,.]+/,Zf=/[“”„«»]/g,Jf=3,ep=c=>{if(!Array.isArray(c)||c.length===0)return[];const f=c.filter(p=>{if(!p)return!1;const g=typeof p=="string"?p.trim().toLowerCase():String(p).trim().toLowerCase();if(!g)return!1;const{stopWords:S}=Lu(),E=S.has(g);return g.length<Jf,!E});return f.length>0?f:c.filter(Boolean)},tp=c=>typeof c=="string"?c.replace(Zf,'"'):"",op=c=>{if(typeof c!="string")return[];const f=tp(c);if(!f)return[];const p=[],g=/"([^"]+)"/g;let S;for(;S=g.exec(f);){const E=(S[1]||"").trim();E.length<2||p.push(E)}return p},rp=c=>{if(typeof c!="string")return{filterType:null,queryText:""};const f=c.trim();if(!f)return{filterType:null,queryText:""};const p=f.match(/^([a-z]+)/i);if(!p)return{filterType:null,queryText:f};const g=p[1].toLowerCase(),{filterAliases:S}=Lu(),E=S.get(g)||null;if(!E)return{filterType:null,queryText:f};const L=f.slice(p[0].length);if(!L)return{filterType:E,queryText:""};const P=L.replace(Xf,"").trim();return{filterType:E,queryText:P}};function Ru(c,f,p,g,S=[]){if(!c||!c.key||!c.display)return null;const L=c.key,P=Array.isArray(c.tokens)?c.tokens:[],D=Array.isArray(c.primaryTokens)?c.primaryTokens:[],q=Array.isArray(p)?p.filter(Boolean):[],ie=q.length?_u(P,q):{score:0,matched:0},se=q.length?_u(D,q):{score:0,matched:0},te=c.type||"feature",ye=$f(L,te),ve=ye?.count||0,Ke=ye?.lastUsed||0,Ze=q.length,ut=Ze>0&&ie.matched>=Ze,Ft=fp(c,q,g),Mo=pp(c,S),Yt=dp(c,g),oo=typeof Date=="function"&&typeof Date.now=="function"?Date.now():new Date().getTime(),Bt=mp(ve,Ke,oo);let _r="none",At=ti.none,gt=Number.POSITIVE_INFINITY;const xt=nt=>{const Mt=ti[nt]||ti.none;Mt>At&&(_r=nt,At=Mt)};if(f&&(L===f&&xt("exactKey"),L.startsWith(f)&&xt("keyPrefix"),f.startsWith(L)&&xt("keySubset"),(L.includes(f)||f.includes(L))&&xt("partial")),ie.score>0&&xt("token"),At===ti.none&&f&&L){const nt=gp(L,f);hp(L,f,nt)&&(gt=nt,xt("fuzzy"))}return{entry:c,entryType:te,typePriority:Qf[te]||0,allTokensMatched:ut,matchType:_r,priority:At,tokenScore:ie.score,tokenMatches:ie.matched,primaryTokenScore:se.score,primaryTokenMatches:se.matched,phraseScore:Ft.score,phraseMatched:Ft.matched,fuzzyDistance:gt,keyDistance:f?Math.abs(L.length-f.length):Number.POSITIVE_INFINITY,keyLength:L.length,historyCount:ve,historyLastUsed:Ke,labelMatchLevel:Yt.level,labelMatchScore:Yt.score,historyBoostScore:Bt,quotedPhraseScore:Mo.score,quotedPhraseMatches:Mo.matched}}const Ou=(c,f)=>{if(!c&&!f)return 0;if(!c)return 1;if(!f)return-1;if(f.priority!==c.priority)return f.priority-c.priority;if(f.typePriority!==c.typePriority)return f.typePriority-c.typePriority;if(Number(f.allTokensMatched)!==Number(c.allTokensMatched))return Number(f.allTokensMatched)-Number(c.allTokensMatched);const p=typeof c.labelMatchLevel=="number"?c.labelMatchLevel:0,g=typeof f.labelMatchLevel=="number"?f.labelMatchLevel:0;if(g!==p)return g-p;const S=typeof c.labelMatchScore=="number"?c.labelMatchScore:0,E=typeof f.labelMatchScore=="number"?f.labelMatchScore:0;if(E!==S)return E-S;const L=typeof c.phraseScore=="number"?c.phraseScore:0,P=typeof f.phraseScore=="number"?f.phraseScore:0;if(P!==L)return P-L;if(Number(f.phraseMatched)!==Number(c.phraseMatched))return Number(f.phraseMatched)-Number(c.phraseMatched);const D=typeof c.quotedPhraseMatches=="number"?c.quotedPhraseMatches:0,q=typeof f.quotedPhraseMatches=="number"?f.quotedPhraseMatches:0;if(q!==D)return q-D;const ie=typeof c.quotedPhraseScore=="number"?c.quotedPhraseScore:0,se=typeof f.quotedPhraseScore=="number"?f.quotedPhraseScore:0;if(se!==ie)return se-ie;const te=typeof c.primaryTokenScore=="number"?c.primaryTokenScore:0,ye=typeof f.primaryTokenScore=="number"?f.primaryTokenScore:0;if(ye!==te)return ye-te;const ve=typeof c.primaryTokenMatches=="number"?c.primaryTokenMatches:0,Ke=typeof f.primaryTokenMatches=="number"?f.primaryTokenMatches:0;if(Ke!==ve)return Ke-ve;if(f.tokenScore!==c.tokenScore)return f.tokenScore-c.tokenScore;if(f.tokenMatches!==c.tokenMatches)return f.tokenMatches-c.tokenMatches;const Ze=typeof c.historyBoostScore=="number"?c.historyBoostScore:0,ut=typeof f.historyBoostScore=="number"?f.historyBoostScore:0;if(ut!==Ze)return ut-Ze;if(f.typePriority!==c.typePriority)return f.typePriority-c.typePriority;if(f.historyCount!==c.historyCount)return f.historyCount-c.historyCount;if(f.historyLastUsed!==c.historyLastUsed)return f.historyLastUsed-c.historyLastUsed;if(c.priority===ti.fuzzy&&f.priority===ti.fuzzy&&c.fuzzyDistance!==f.fuzzyDistance)return c.fuzzyDistance-f.fuzzyDistance;if(c.keyDistance!==f.keyDistance)return c.keyDistance-f.keyDistance;if(c.keyLength!==f.keyLength)return c.keyLength-f.keyLength;const Ft=c.entry?.display||"",Mo=f.entry?.display||"";return Ft.localeCompare(Mo,void 0,{sensitivity:"base"})};function Hl(c){if(!c){Ma();return}if(c==="recent"){const E=xl();if(!E.length){va([]);return}const L=[],P=new Set;for(const D of E){if(L.length>=xs)break;const q=wi(D);!q||!q.value||P.has(q.value)||(P.add(q.value),L.push(q))}va(L);return}const f=Jn.filter(E=>(E?.type||"feature")===c);if(!f.length){va([]);return}const p=f.map(E=>Ru(E,"",[],"")).filter(Boolean).sort(Ou),g=[],S=new Set;for(const E of p){if(g.length>=xs)break;const L=wi(E.entry);!L||!L.value||S.has(L.value)||(S.add(L.value),g.push(L))}if(g.length===0){const E=f.slice().sort((L,P)=>(L.display||"").localeCompare(P.display||"",void 0,{sensitivity:"base"}));for(const L of E){if(g.length>=xs)break;const P=wi(L);!P||!P.value||S.has(P.value)||(S.add(P.value),g.push(P))}}va(g)}function wu(c){const p=(typeof c=="string"?c:"").trim(),{filterType:g,queryText:S}=rp(p),E=S.trim(),L=op(S),P=L.map(oo=>typeof oo=="string"?oo.replace(/\s+/g," ").trim().toLowerCase():"").filter(Boolean);if(!E&&!g){Ma();return}const D=E?E.split(/[^a-z0-9]+/i).filter(Boolean):[],q=E?ka(E):"",ie=E?kn(E):[],se=ep(ie),te=[...D,...se,...P];hu(te);const ye=g==="recent";if(!E&&ye){Hl(g);return}const ve=ye?xl():g?Jn.filter(oo=>(oo?.type||"feature")===g):Jn;if(ve.length===0){va([]);return}if(!q&&(!Array.isArray(se)||se.length===0)&&!g){Ma();return}const Ke=ve.map(oo=>Ru(oo,q,se,E,L)).filter(Boolean),Ze=P.length>0?Ke.filter(oo=>Number(oo.quotedPhraseMatches)>=P.length):Ke;if(Ze.length===0){if(P.length>0){va([]);return}g?Hl(g):Ma();return}const ut=E?Ze.filter(oo=>oo.priority>ti.none||oo.tokenScore>0||oo.primaryTokenScore>0||oo.phraseScore>0||oo.quotedPhraseScore>0):[],Ft=(ut.length>0?ut:Ze).sort(Ou),Mo=[],Yt=new Set;for(const oo of Ft){if(Mo.length>=xs)break;const Bt=wi(oo.entry);!Bt||!Bt.value||Yt.has(Bt.value)||(Yt.add(Bt.value),Mo.push(Bt))}if(Mo.length===0){g?Hl(g):Ma();return}va(Mo)}const $s="__cineResolvedFeatureSearchEngineModule";function np(){function f(se){if(typeof se!="string"||!se)return{cleaned:"",number:null};const te=se.replace(/[^a-z0-9]+/gi,"").toLowerCase();return te?/^\d+$/.test(te)?{cleaned:te,number:parseInt(te,10)}:{cleaned:te,number:null}:{cleaned:"",number:null}}const p=new Map([["zero",0],["one",1],["two",2],["three",3],["four",4],["five",5],["six",6],["seven",7],["eight",8],["nine",9]]),g=new Map([["ten",10],["eleven",11],["twelve",12],["thirteen",13],["fourteen",14],["fifteen",15],["sixteen",16],["seventeen",17],["eighteen",18],["nineteen",19]]),S=new Map([["twenty",20],["thirty",30],["forty",40],["fifty",50],["sixty",60],["seventy",70],["eighty",80],["ninety",90]]),E=new Map([...p,...g,...S]),L=Array.from(E.keys()).sort((se,te)=>te.length-se.length),P=Array.from(p.keys()).sort((se,te)=>te.length-se.length),D=E.size>0?new RegExp(`\\b(?:${L.join("|")})(?:[\\s-](?:${P.join("|")}))?\\b`,"gi"):null;function q(se){return!D||typeof se!="string"||!se?se:se.replace(D,te=>{const ye=te.toLowerCase();if(E.has(ye))return String(E.get(ye));const ve=ye.split(/[\s-]+/).filter(Boolean);if(ve.length===2){const Ke=S.get(ve[0]),Ze=p.get(ve[1]);if(typeof Ke=="number"&&typeof Ze=="number")return String(Ke+Ze)}return te})}function ie(se){return se?String(se).toLowerCase().split(/[^a-z0-9]+/).filter(Boolean):[]}return{FEATURE_SEARCH_FUZZY_MAX_DISTANCE:2,searchKey(se){if(!se)return"";const te=String(se).toLowerCase();return q(te).replace(/[^a-z0-9]+/g,"")},searchTokens(se){if(!se)return[];const te=String(se).toLowerCase(),ye=q(te),ve=new Set;return ie(te).forEach(Ke=>ve.add(Ke)),ye!==te&&ie(ye).forEach(Ke=>ve.add(Ke)),Array.from(ve)},computeTokenMatchDetails(){return{score:0,matched:0}},findBestSearchMatch(){return null},getFuzzyDistance(){return Number.POSITIVE_INFINITY},computeFuzzyTokenScore(){return 0},parseMarkSuffix:f,normaliseMarkVariants(se){return typeof se!="string"||!se?se:se.replace(/\bmark\s*(\d+)\b/gi,"mk$1")},normalizeUnicodeFractions(se){return se},normalizeNumberWords(se){return typeof se!="string"||!se?se:q(se)},normalizeSpellingVariants(se){return se},applySearchTokenSynonyms(){}}}function ap(){const c=typeof getCoreGlobalObject=="function"?getCoreGlobalObject():typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;if(c&&c[$s])return c[$s];const f=typeof cineModuleBase=="object"&&cineModuleBase||(c&&typeof c.cineModuleBase=="object"?c.cineModuleBase:null);function p(E,L){if(f&&typeof f.safeWarn=="function")try{f.safeWarn(E,L);return}catch{}if(typeof console<"u"&&console&&typeof console.warn=="function")try{typeof L>"u"?console.warn(E):console.warn(E,L)}catch{}}const g=[];if(f&&typeof f.getModuleRegistry=="function"){let E=null;try{E=f.getModuleRegistry(c)}catch(L){p("Unable to resolve cine.features.featureSearchEngine module registry.",L)}if(E&&typeof E.get=="function")try{const L=E.get("cine.features.featureSearchEngine");L&&g.indexOf(L)===-1&&g.push(L)}catch(L){p("Unable to read cine.features.featureSearchEngine module.",L)}}const S=[];c&&S.indexOf(c)===-1&&S.push(c),typeof globalThis<"u"&&S.indexOf(globalThis)===-1&&S.push(globalThis),typeof window<"u"&&S.indexOf(window)===-1&&S.push(window),typeof self<"u"&&S.indexOf(self)===-1&&S.push(self),typeof global<"u"&&S.indexOf(global)===-1&&S.push(global);for(let E=0;E<S.length;E+=1){const L=S[E];if(!(!L||typeof L!="object"&&typeof L!="function"))try{const P=L.cineFeaturesFeatureSearchEngine;P&&g.indexOf(P)===-1&&g.push(P)}catch{}}for(let E=0;E<g.length;E+=1){const L=g[E];if(L&&typeof L.createEngine=="function"){if(c&&!c[$s])try{c[$s]=L}catch{}return L}}return null}const Xi=ap(),Fn=np(),Jr=Xi&&typeof Xi.createEngine=="function"?Xi.createEngine():Fn;Number.isFinite(Xi?.FEATURE_SEARCH_FUZZY_MAX_DISTANCE)?Xi.FEATURE_SEARCH_FUZZY_MAX_DISTANCE:Jr.FEATURE_SEARCH_FUZZY_MAX_DISTANCE||Fn.FEATURE_SEARCH_FUZZY_MAX_DISTANCE,typeof Jr.parseMarkSuffix=="function"?Jr.parseMarkSuffix:Fn.parseMarkSuffix;const Tu=typeof Jr.normaliseMarkVariants=="function"?Jr.normaliseMarkVariants:Fn.normaliseMarkVariants;Me("normaliseMarkVariants",Tu),typeof Jr.normalizeUnicodeFractions=="function"?Jr.normalizeUnicodeFractions:Fn.normalizeUnicodeFractions,typeof Jr.normalizeNumberWords=="function"?Jr.normalizeNumberWords:Fn.normalizeNumberWords;const Gu=typeof Jr.normalizeSpellingVariants=="function"?Jr.normalizeSpellingVariants:Fn.normalizeSpellingVariants;typeof Jr.applySearchTokenSynonyms=="function"?Jr.applySearchTokenSynonyms:Fn.applySearchTokenSynonyms;const ka=typeof Jr.searchKey=="function"?c=>Jr.searchKey(c):Fn.searchKey,kn=typeof Jr.searchTokens=="function"?c=>Jr.searchTokens(c):Fn.searchTokens,_u=typeof Jr.computeTokenMatchDetails=="function"?(c,f)=>Jr.computeTokenMatchDetails(c,f):Fn.computeTokenMatchDetails,Iu=typeof Jr.findBestSearchMatch=="function"?(c,f,p=[])=>Jr.findBestSearchMatch(c,f,p):Fn.findBestSearchMatch;typeof Jr.getFuzzyDistance=="function"||Fn.getFuzzyDistance,typeof Jr.computeFuzzyTokenScore=="function"||Fn.computeFuzzyTokenScore;const ip=3,sp=c=>c.replace(/\b([a-z])/g,(f,p)=>p.toUpperCase()),lp=c=>{if(!c)return"";const f=c.replace(/[-_]+/g," ").replace(/([a-z\d])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim();return f?sp(f):""},Ns=(c,f,p,g)=>{if(!p)return;const S=p.trim();if(!S)return;const E=S.toLowerCase();E===g||f.has(E)||(c.push(S),f.add(E))},Pu=(c,f)=>{if(!c||!c.parentElement)return[];const p=[],g=new Set;let S=c.parentElement;for(;S&&p.length<ip;){typeof S.dataset?.featureContext=="string"&&S.dataset.featureContext.split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>Ns(p,g,P,f));const E=S.getAttribute("aria-labelledby");E&&E.split(/\s+/).map(P=>P&&typeof document<"u"&&document&&typeof document.getElementById=="function"?document.getElementById(P):null).filter(P=>P&&P!==c).forEach(P=>{Ns(p,g,P.textContent||"",f)});const L=S.querySelector(":scope > h1, :scope > h2, :scope > h3, :scope > h4, :scope > legend");L&&L!==c&&Ns(p,g,L.textContent||"",f),S.id&&Ns(p,g,lp(S.id),f),S=S.parentElement}return p.reverse()},jl=c=>{if(!c)return[];const f=new Set,p=4,g=D=>{if(typeof D!="string")return"";const q=D.replace(/\s+/g," ").trim();return q?q.length>160?q.slice(0,160):q:""},S=D=>{if(f.size>=p)return;const q=g(D);q&&f.add(q)},E=D=>{D&&(S(D.getAttribute("data-help")),S(D.getAttribute("aria-description")),S(D.getAttribute("title")))};S(c.getAttribute("data-help")),S(c.getAttribute("aria-description")),S(c.getAttribute("title"));const L=c.ownerDocument||(typeof document<"u"?document:null),P=(D,q)=>{if(!L)return;const ie=c.getAttribute(D);ie&&ie.split(/\s+/).map(se=>se&&typeof L.getElementById=="function"?L.getElementById(se):null).filter(Boolean).forEach(q)};if(P("aria-describedby",E),P("aria-labelledby",E),c.labels&&typeof c.labels=="object"&&Array.from(c.labels).forEach(E),typeof c.closest=="function"){const D=c.closest("label");D&&E(D)}return Array.from(f)},Bu=c=>{if(!c||typeof c!="object")return"";const f=ei(c.displayLabel||c.baseLabel||c.label||"").toLowerCase(),p=[];Array.isArray(c.helpTexts)&&c.helpTexts.length&&p.push(...c.helpTexts),c.element&&jl(c.element).forEach(g=>{p.push(g)});for(const g of p){const S=ei(g);if(S&&(!f||S.toLowerCase()!==f))return S}return""},cp=c=>{if(!c)return"";const f=[],p=c.getAttribute("data-help-summary");p&&f.push(p);const g=c.querySelector("[data-help-summary]");g&&g.textContent&&f.push(g.textContent);const S=c.getAttribute("aria-label");S&&f.push(S);const E=c.querySelector("p");if(E&&E.textContent&&f.push(E.textContent),!E){const L=c.querySelector("li");L&&L.textContent&&f.push(L.textContent)}for(const L of f){const P=ei(L);if(P)return P}return""},Mu=c=>{if(!c||typeof c!="object")return"";if(c.entryType==="deviceLibrary"){const E=[];return c.categoryLabel&&E.push(c.categoryLabel),c.summary&&E.push(c.summary),E.join(" — ")}const f=c.select;if(!f)return"";const p=ei(c.label||"").toLowerCase(),g=jl(f);for(const E of g){const L=ei(E);if(L&&(!p||L.toLowerCase()!==p))return L}const S=Pu(f,p);if(S.length){const E=ei(S.join(" › "));if(E&&(!p||E.toLowerCase()!==p))return E}return""},ku=(c,{label:f,keywords:p=""})=>{if(!c||!f)return null;const g=f.trim();if(!g)return null;const S=ka(g);if(!S)return null;const E=g.toLowerCase(),L=Pu(c,E),D=typeof c.hasAttribute=="function"&&c.hasAttribute("data-feature-search")?jl(c):[];let q=g;L.length&&(q=`${g} (${L.join(" › ")})`);const ie=[g,L.join(" ")].filter(Boolean).join(" "),se=[g,L.join(" "),p,D.join(" ")].filter(Boolean).join(" ");let te=gu(c);if(te==="feature"&&(typeof c.tagName=="string"?c.tagName.toLowerCase():"")==="option"){const Ft=typeof c.closest=="function"?c.closest("select"):null;te=(Ft?.dataset?.featureSearchType||Ft?.getAttribute?.("data-feature-search-type"))?.trim()?.toLowerCase()||"device"}const ye=kn(ie),ve={element:c,label:g,baseLabel:g,displayLabel:q,context:L,primaryTokens:ye,tokens:kn(se),key:S,optionValue:q,helpTexts:D,entryType:te},Ke=te==="action"?uu:Pl,Ze=Ke.get(S);return Ze?Array.isArray(Ze)?Ze.some(ut=>ut&&ut.element===c)||Ze.push(ve):Ze.element!==c&&Ke.set(S,[Ze,ve]):Ke.set(S,ve),ve},up=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Du=c=>{const f=[],p=S=>{if(typeof S!="string")return;const E=S.trim().toLowerCase();E&&f.push(E)};if(!c||typeof c!="object")return f;p(c.optionLabel),c.display&&c.display!==c.optionLabel&&p(c.display),c.detail&&p(c.detail);const g=c.value;return g&&typeof g=="object"&&(p(g.baseLabel),p(g.displayLabel),Array.isArray(g.context)&&g.context.length&&p(g.context.join(" ")),Array.isArray(g.helpTexts)&&g.helpTexts.length&&p(g.helpTexts.join(" "))),f},dp=(c,f="")=>{const p=typeof f=="string"?f.replace(/\s+/g," ").trim().toLowerCase():"";if(!p)return{level:0,score:0};const g=new Set,S=q=>{if(typeof q!="string")return;const ie=q.replace(/\s+/g," ").trim().toLowerCase();ie&&g.add(ie)};if(c&&typeof c=="object"){S(c.optionLabel),S(c.display);const q=c.value&&typeof c.value=="object"?c.value:null;q&&(S(q.baseLabel),S(q.displayLabel),Array.isArray(q.context)&&q.context.forEach(S))}if(g.size===0)return{level:0,score:0};const E=p.length;let L=0,P=0;const D=/[a-z0-9]/;return g.forEach(q=>{if(q===p){L=Math.max(L,4),P=Math.max(P,Math.max(q.length*8,80));return}q.startsWith(p)&&(L=Math.max(L,3),P=Math.max(P,Math.max(E*4,36)));const ie=q.indexOf(p);if(ie!==-1){const se=ie>0?q.charAt(ie-1):"",te=ie+E,ye=te<q.length?q.charAt(te):"",ve=ie===0||!D.test(se),Ke=te>=q.length||!D.test(ye);ve&&Ke?(L=Math.max(L,2),P=Math.max(P,Math.max(E*3,28))):(L=Math.max(L,1),P=Math.max(P,Math.max(E*2,14)))}}),{level:L,score:P}},fp=(c,f=[],p="")=>{const g=Array.isArray(f)?f.map(D=>D&&D.replace(/[^a-z0-9]+/g,"")).filter(Boolean):[],S=typeof p=="string"?p.trim().toLowerCase():"";if(!g.length&&!S)return{score:0,matched:!1};const E=Du(c);if(!E.length)return{score:0,matched:!1};let L=0,P=!1;if(S){for(const D of E)if(D.includes(S)){P=!0,L=Math.max(L,Math.max(1,S.length));break}}if(g.length>1){const D=g.map(up).join("[\\s\\-_/·›>]*");if(D){const q=new RegExp(`\\b${D}`,"i");for(const ie of E)if(q.test(ie)){P=!0,L=Math.max(L,g.length*6);break}}}return{score:L,matched:P}},pp=(c,f=[])=>{if(!Array.isArray(f)||f.length===0)return{score:0,matched:0};const p=f.map(L=>typeof L=="string"?L.replace(/\s+/g," ").trim().toLowerCase():"").filter(L=>L.length>1);if(!p.length)return{score:0,matched:0};const g=Du(c);if(!g.length)return{score:0,matched:0};let S=0,E=0;return p.forEach(L=>{let P=!1;for(const D of g)if(D.includes(L)){P=!0;break}P&&(S+=1,E+=Math.max(L.length*4,24))}),S===0?{score:0,matched:0}:{score:E,matched:S}},mp=(c=0,f=0,p=NaN)=>{const g=Number.isFinite(c)&&c>0?c:0;let E=Math.min(Math.max(g,0),50)*2;const L=Number.isFinite(f)&&f>0?f:0;if(L>0){const P=Number.isFinite(p)?p:typeof Date=="function"&&typeof Date.now=="function"?Date.now():new Date().getTime(),D=Math.max(0,P-L),q=1440*60*1e3;D<=q?E+=20:D<=7*q?E+=12:D<=30*q?E+=6:D<=90*q&&(E+=3)}return E},gp=(c,f)=>{if(c===f)return 0;if(typeof c!="string"||typeof f!="string")return Number.POSITIVE_INFINITY;const p=c.length,g=f.length;if(p===0)return g;if(g===0)return p;const S=new Array(g+1),E=new Array(g+1);for(let L=0;L<=g;L+=1)S[L]=L;for(let L=1;L<=p;L+=1){E[0]=L;const P=c.charCodeAt(L-1);for(let D=1;D<=g;D+=1){const q=P===f.charCodeAt(D-1)?0:1,ie=S[D]+1,se=E[D-1]+1,te=S[D-1]+q;E[D]=Math.min(ie,se,te)}for(let D=0;D<=g;D+=1)S[D]=E[D]}return S[g]},yp=c=>!Number.isFinite(c)||c<=0?0:c<=4?2:c<=8?3:c<=12?4:5,hp=(c,f,p)=>{if(!Number.isFinite(p)||p<=0||typeof c!="string"||typeof f!="string")return!1;const g=Math.max(c.length,f.length);if(g===0)return!1;const S=yp(g);return p<=S};document.getElementById("existingDevicesHeading");const xu=document.getElementById("batteryComparison"),$u=document.getElementById("batteryTable"),Fs=document.getElementById("breakdownList");if(Fs)try{gn("breakdownListElem",Fs)}catch{}document.getElementById("runtimeFeedbackBtn");let Us=document.getElementById("generateGearListBtn"),Hs=document.getElementById("deleteGearListProjectBtn"),Dr=document.getElementById("gearListOutput"),mn=document.getElementById("projectRequirementsOutput");const Zi="#001589";let Ji=Zi,Vl=Ji;const Nu="#ffffff",Fu=Zi.toLowerCase(),Uu=c=>typeof c=="string"?c.trim().toLowerCase():"",zn=kr("accentColorInput","accentColorInput"),oi=kr("accentColorResetButton","accentColorReset"),ri=()=>{if(!oi)return;const c=typeof document<"u"?document.body:null,f=!!(c&&c.classList.contains("pink-mode")),p=!zn||zn.disabled,g=zn?Uu(zn.value||""):"",E=f||p||(!g||g===Fu);oi.disabled=E,E?oi.setAttribute("aria-disabled","true"):oi.removeAttribute("aria-disabled")},bp="dark-accent-boost",Sp="#ff69b4",Ep=.06,Cp=.6,Ap=.35;function zl(c){const f=c.trim();if(!f)return null;if(f.endsWith("%")){const g=Number.parseFloat(f.slice(0,-1));return Number.isNaN(g)?null:Math.max(0,Math.min(255,Math.round(g/100*255)))}const p=Number.parseFloat(f);return Number.isNaN(p)?null:Math.max(0,Math.min(255,Math.round(p)))}function ql(c){if(typeof c!="string")return null;const f=c.trim();if(!f)return null;const p=f.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(p){const S=p[1];return S.length===3?{r:Number.parseInt(S[0]+S[0],16),g:Number.parseInt(S[1]+S[1],16),b:Number.parseInt(S[2]+S[2],16)}:{r:Number.parseInt(S.slice(0,2),16),g:Number.parseInt(S.slice(2,4),16),b:Number.parseInt(S.slice(4,6),16)}}const g=f.match(/^rgba?\(([^)]+)\)$/i);if(g){const S=g[1].split(",");if(S.length<3)return null;const[E,L,P]=S,D=zl(E),q=zl(L),ie=zl(P);return[D,q,ie].some(se=>se===null)?null:{r:D,g:q,b:ie}}return null}function Kl(c){if(!c||typeof c!="object")return 0;const f=L=>{const P=Number(L);return Number.isFinite(P)?Math.min(1,Math.max(0,P/255)):0},p=L=>L<=.03928?L/12.92:Math.pow((L+.055)/1.055,2.4),g=p(f(c.r)),S=p(f(c.g)),E=p(f(c.b));return .2126*g+.7152*S+.0722*E}function vp(c){if(!c||typeof c!="object")return 0;const f=P=>{const D=Number(P);return Number.isFinite(D)?Math.max(0,Math.min(1,D/255)):0},p=f(c.r),g=f(c.g),S=f(c.b),E=Math.max(p,g,S),L=Math.min(p,g,S);return E===0||E===L?0:(E-L)/E}const Lp=(()=>{const c=ql(Sp);return c?Kl(c):.35})();function Rp({color:c,highContrast:f}={}){if(typeof document>"u"||!document.body||!document.body.classList.contains("dark-mode")||document.body.classList.contains("pink-mode")||f||typeof c!="string"||!c)return!1;const p=ql(c);if(!p)return!1;const g=Kl(p);if(Math.abs(g-Lp)<=Ep)return!0;const S=vp(p);return g>=Cp&&S>=Ap}function Wl(c={}){if(typeof document>"u"||!document.body)return;const f=Rp(c);document.body.classList.toggle(bp,f),lt()}var Yl=()=>typeof document<"u"&&(document.documentElement.classList.contains("high-contrast")||document.body&&document.body.classList.contains("high-contrast")),es=c=>{const f=Yl(),p=f?Nu:c,g=document.documentElement.style;if(g.setProperty("--accent-color",p),f?g.removeProperty("--link-color"):g.setProperty("--link-color",c),document.body){const S=document.body.style;S.setProperty("--accent-color",p),f?S.removeProperty("--link-color"):S.setProperty("--link-color",c)}Wl({color:p,highContrast:f})},Hu=()=>{const c=document.documentElement,f=c&&c.style;if(f&&(f.removeProperty("--accent-color"),f.removeProperty("--link-color")),document.body){const p=document.body.style;p.removeProperty("--accent-color"),p.removeProperty("--link-color")}Wl({color:null,highContrast:Yl()})};try{const c=localStorage.getItem("accentColor");c&&(Ji=c,es(Ji))}catch(c){console.warn("Could not load accent color",c)}Vl=Ji,ri(),zn&&zn.addEventListener("input",()=>{if(typeof document<"u"&&document.body&&document.body.classList.contains("pink-mode")){ri();return}const c=zn.value;es(c),ri()}),oi&&zn&&oi.addEventListener("click",()=>{if(oi.disabled||zn.disabled)return;if(typeof document<"u"&&document.body&&document.body.classList.contains("pink-mode")){ri();return}if(Uu(zn.value||"")===Fu){ri();return}zn.value=Zi;let f=!1;try{const p=new Event("input",{bubbles:!0});f=zn.dispatchEvent(p)}catch{if(typeof document<"u"&&document.createEvent){const g=document.createEvent("Event");g.initEvent("input",!0,!0),f=zn.dispatchEvent(g)}}f||es(Zi),ri()});var Da="16";if(typeof window<"u")try{Object.defineProperty(window,"fontSize",{get:function(){return Da},set:function(c){Da=c},configurable:!0})}catch{}if(typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE=="object")try{Object.defineProperty(CORE_GLOBAL_SCOPE,"fontSize",{get:function(){return Da},set:function(c){Da=c},configurable:!0})}catch{}var La="'Ubuntu', sans-serif";const ju=document.documentElement,Vu={"--page-padding":20,"--gap-size":10,"--button-size":32,"--border-radius":5,"--form-label-width":150,"--form-label-min-width":120,"--form-action-width":110},zu=Object.keys(Vu),qu={...Vu};let js=16;if(ju)try{const c=getComputedStyle(ju),f=parseFloat(c.fontSize);Number.isFinite(f)&&f>0&&(js=f);for(const p of zu){const g=parseFloat(c.getPropertyValue(p));Number.isFinite(g)&&g>0&&(qu[p]=g)}}catch(c){console.warn("Unable to read computed styles for UI scaling",c)}const Ku=typeof CUSTOM_FONT_STORAGE_KEY_NAME<"u"?CUSTOM_FONT_STORAGE_KEY_NAME:typeof CUSTOM_FONT_STORAGE_KEY<"u"?CUSTOM_FONT_STORAGE_KEY:"cameraPowerPlanner_customFonts";var Ra=new Map;const Op=new Set(["font/ttf","font/otf","font/woff","font/woff2","application/font-woff","application/font-woff2","application/x-font-ttf","application/x-font-opentype"]),wp=[".ttf",".otf",".ttc",".woff",".woff2"];function Tp(){if(typeof localStorage>"u")return[];try{const c=localStorage.getItem(Ku);if(!c)return[];const f=JSON.parse(c);return Array.isArray(f)?f.map(p=>({id:p&&typeof p.id=="string"?p.id:null,name:p&&typeof p.name=="string"?p.name:"",data:p&&typeof p.data=="string"?p.data:""})).filter(p=>p.id&&p.name&&p.data):[]}catch(c){return console.warn("Failed to load stored custom fonts",c),[]}}function Gp(){if(typeof localStorage>"u")return!0;try{const c=Array.from(Ra.values()).map(f=>({id:f.id,name:f.name,data:f.data}));return localStorage.setItem(Ku,JSON.stringify(c)),!0}catch(c){return console.warn("Could not save custom fonts",c),!1}}function Ql(c){if(!c)return"Custom Font";const f=String(c).trim();return f?f.replace(/\s+/g," ").slice(0,80):"Custom Font"}function _p(c){if(!c)return"Custom Font";const f=typeof c.name=="string"?c.name:"";if(!f)return"Custom Font";const g=f.replace(/\.[^.]+$/,"")||f;return Ql(g)}function Ip(c){const f=Ql(c);if(!cn)return f;let p=f,g=2;for(;Array.from(cn.options).some(S=>S.value===Ws(p));)p=`${f} ${g}`,g+=1;return p}function Wu(c){return typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(c):String(c).replace(/['"\\]/g,f=>`\\${f}`)}async function Yu(c,f,p){if(!c||!f||typeof document>"u")return!1;let g=!1;if(typeof FontFace=="function"&&document.fonts&&typeof document.fonts.add=="function")try{const S=new FontFace(c,`url(${f})`);await S.load(),document.fonts.add(S),g=!0}catch(S){console.warn("Failed to load custom font via FontFace",S)}if(!g)try{const E=`customFontStyle-${p||Wu(c).replace(/[^a-z0-9_-]+/gi,"-")}`;let L=document.getElementById(E);L||(L=document.createElement("style"),L.id=E,document.head?document.head.appendChild(L):document.body.appendChild(L));const P=Wu(c);L.textContent=`@font-face { font-family: '${P}'; src: url(${f}); font-display: swap; }`,g=!0}catch(S){return console.warn("Failed to inject custom font style",S),!1}return g}async function Pp(c){if(!c||!c.id)return null;const f=Ws(c.name),{option:p}=Ys(f,c.name,localFontsGroup,"uploaded");return p&&(p.dataset.fontId=c.id),await Yu(c.name,c.data,c.id),f}async function Bp(){const c=Tp();if(c.length)for(const f of c){const p={id:f.id,name:Ql(f.name),data:f.data};Ra.set(p.id,p);try{await Pp(p)}catch(g){console.warn("Failed to restore custom font",p.name,g)}}}function Mp(){const c=Ra&&typeof Ra.size=="number"?Ra.size>0:!1;Ra&&typeof Ra.clear=="function"&&Ra.clear();let f=!1;if(cn&&cn.options){const p=Array.from(cn.options||[]);p.forEach(S=>{if(!S||!S.dataset||S.dataset.source!=="uploaded")return;f=!0;const E=S.dataset.fontId||"";if(S.parentNode&&typeof S.parentNode.removeChild=="function"?S.parentNode.removeChild(S):typeof cn.removeChild=="function"&&cn.removeChild(S),E&&typeof document<"u"){const L=`customFontStyle-${E}`,P=document.getElementById(L);P&&P.parentNode&&P.parentNode.removeChild(P)}}),p.some(S=>S&&S.value===cn.value)||(cn.options.length?cn.selectedIndex=0:cn.value="")}typeof document<"u"&&document.querySelectorAll&&document.querySelectorAll('style[id^="customFontStyle-"]').forEach(g=>{g&&g.parentNode&&g.parentNode.removeChild(g)}),typeof wn=="function"&&(c||f)&&wn(null)}function kp(c){if(!c)return!1;const f=typeof c.type=="string"?c.type.toLowerCase():"";if(f&&Op.has(f))return!0;const p=typeof c.name=="string"?c.name.toLowerCase():"";return wp.some(g=>p.endsWith(g))}function Dp(c){return new Promise((f,p)=>{if(typeof FileReader!="function"){p(new Error("FileReader is unavailable"));return}const g=new FileReader;g.onload=()=>f(g.result),g.onerror=()=>p(g.error||new Error("Failed to read file"));try{g.readAsDataURL(c)}catch(S){p(S)}})}async function xp(c,f,{persist:p=!0}={}){const g=Ip(c),S=Ws(g),{option:E}=Ys(S,g,localFontsGroup,"uploaded");if(!E)return{name:g,value:S,persisted:!1};let L=E.dataset.fontId;L||(L=`custom-font-${Date.now()}-${Math.random().toString(36).slice(2)}`,E.dataset.fontId=L);const P={id:L,name:g,data:f};Ra.set(L,P),await Yu(g,f,L);let D=!0;return p&&!Gp()&&(D=!1),{name:g,value:S,persisted:D}}async function $p(c){if(!c||c.length===0){wn("localFontsNoFonts");return}da&&(da.disabled=!0);const f=[],p=[],g=[];let S=!1;for(const E of Array.from(c)){if(!kp(E)){p.push(E&&typeof E.name=="string"?E.name:"");continue}try{const L=await Dp(E);if(!L){g.push(E&&E.name?E.name:"");continue}const P=await xp(_p(E),L);f.push(P),P.persisted||(S=!0)}catch(L){console.warn("Failed to import custom font",L),g.push(E&&typeof E.name=="string"?E.name:"")}}if(f.length>0?(cn&&(cn.value=f[0].value),wn("localFontsAdded",f.map(E=>E.name).join(", "))):p.length>0?wn("localFontsUnsupportedFiles",p.join(", ")):g.length>0?wn("localFontsError"):wn("localFontsNoFonts"),S){const E=Ks("localFontsSaveError");E&&showNotification("warning",E)}if(p.length>0&&f.length>0){const E=Ks("localFontsUnsupportedFiles");E&&showNotification("warning",E.replace("%s",p.join(", ")))}if(g.length>0){const E=Ks("localFontsError");E&&showNotification("error",E)}da&&(da.disabled=!1)}async function Qu(c){if(!c)return[];if(Array.isArray(c))return c;const f=typeof Symbol=="function",p=f&&Symbol.asyncIterator;if(p&&typeof c[p]=="function"){const S=[];for await(const E of c)S.push(E);return S}const g=f&&Symbol.iterator;return g&&typeof c[g]=="function"?Array.from(c):[]}const Xl=(()=>{if(typeof window>"u")return null;if(typeof window.queryLocalFonts=="function")return async c=>Qu(await window.queryLocalFonts(c));if(typeof navigator<"u"&&navigator&&navigator.fonts&&typeof navigator.fonts.query=="function"){const{fonts:c}=navigator;return async f=>Qu(await c.query.call(c,f))}return null})(),Vs=typeof Xl=="function",da=kr("localFontsButton","localFontsButton");var aa=kr("localFontsStatus","localFontsStatus");const fa=kr("localFontsInput","localFontsInput");var cn=typeof cn<"u"?cn:kr("settingsFontFamily","settingsFontFamily"),zs=typeof zs<"u"?zs:kr("settingsFontSize","settingsFontSize");const qs=!!(fa&&typeof window<"u"&&typeof window.FileReader=="function"&&typeof fa.click=="function");function Ks(c){return texts[currentLang]&&texts[currentLang][c]?texts[currentLang][c]:texts.en&&texts.en[c]?texts.en[c]:""}function Np(c){if(!c)return"sans-serif";const f=c.toLowerCase();return/(mono|code|console|courier|menlo|fixed|inconsolata|monaco)/.test(f)?"monospace":/(serif|times|garamond|georgia|baskerville|roman|palatino|bodoni|bookman)/.test(f)?"serif":/(script|hand|brush|cursive|calligraphy|marker)/.test(f)?"cursive":"sans-serif"}function Ws(c){return c?`'${c.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}', ${Np(c)}`:La}function Xu(c){if(!c)return"";const f=c.trim();if(!f)return"";const p=f[0];if(p==="'"||p==='"'){let S="";for(let E=1;E<f.length;E+=1){const L=f[E];if(L==="\\")E+1<f.length&&(S+=f[E+1],E+=1);else{if(L===p)return S;S+=L}}return S}const g=f.indexOf(",");return g!==-1?f.slice(0,g).trim():f}function Ys(c,f,p,g){if(!cn||!c)return{option:null,created:!1};const S=Array.from(cn.options).find(P=>P.value===c);if(S)return g&&(S.dataset.source=g),f&&!S.textContent.trim()&&(S.textContent=f),{option:S,created:!1};const E=document.createElement("option");return E.value=c,E.textContent=f||Xu(c),g&&(E.dataset.source=g),(p&&typeof p.appendChild=="function"?p:cn).appendChild(E),{option:E,created:!0}}function wn(c,f){if(!aa||!c){aa&&(aa.textContent="",aa.setAttribute("hidden",""),delete aa.dataset.statusKey,delete aa.dataset.statusArg);return}const p=Ks(c),g=f!=null;let S=p;if(g){const E=String(f);S=p?p.replace("%s",E):E,aa.dataset.statusArg=E}else delete aa.dataset.statusArg;aa.dataset.statusKey=c,aa.textContent=S,aa.removeAttribute("hidden")}async function Fp(){if(!(!Vs||!da||!Xl)){da.disabled=!0;try{const c=await Xl();if(!Array.isArray(c)||c.length===0){wn("localFontsNoFonts");return}const f=[],p=[],g=new Set;for(const S of c){const E=S&&(S.family||S.fullName||S.postscriptName),L=E?String(E).trim():"";if(!L)continue;const P=Ws(L);if(g.has(P)){p.push(L);continue}const{option:D,created:q}=Ys(P,L,localFontsGroup,"local");D&&(g.add(D.value),q?f.push({name:L,value:D.value}):p.push(L))}f.length>0?(cn&&(cn.value=f[0].value),wn("localFontsAdded",f.map(S=>S.name).join(", "))):p.length>0?wn("localFontsAlreadyAdded",p.join(", ")):wn("localFontsNoFonts")}catch(c){console.error("Could not access local fonts",c),c&&(c.name==="NotAllowedError"||c.name==="SecurityError")&&qs?wn("localFontsPermissionNeeded"):wn("localFontsError")}finally{da.disabled=!1}}}da&&(Vs||qs?(da.removeAttribute("hidden"),da.addEventListener("click",()=>{Vs?Fp():qs&&fa&&fa.click()}),!Vs&&qs&&wn("localFontsFileFallback")):wn("localFontsUnsupported")),fa&&fa.addEventListener("change",()=>{fa.files&&fa.files.length>0?$p(fa.files):wn("localFontsNoFonts");try{fa.value=""}catch{}}),Bp().catch(c=>{console.warn("Unable to restore stored custom fonts",c)});function Up(c){const f=parseFloat(c);if(!Number.isFinite(f)||f<=0||(document.documentElement.style.fontSize=`${f}px`,!Number.isFinite(js)||js<=0))return;const p=f/js;for(const g of zu){const S=qu[g];!Number.isFinite(S)||S<=0||document.documentElement.style.setProperty(g,`${S*p}px`)}document.documentElement.style.setProperty("--ui-scale",String(p))}function Hp(c){document.documentElement.style.setProperty("--font-family",c)}try{const c=localStorage.getItem("fontSize");c&&(Da=c,Up(Da));const f=localStorage.getItem("fontFamily");f&&(La=f,Hp(La))}catch(c){console.warn("Could not load font preferences",c)}zs&&(zs.value=Da),cn&&(!Array.from(cn.options).some(f=>f.value===La)&&La&&Ys(La,Xu(La),localFontsGroup,"local"),cn.value=La);var jp=()=>{if(document.body&&document.body.classList.contains("pink-mode")){Hu();return}es(Vl)};let Zl=null;function Zu(){Zl&&clearTimeout(Zl),Zl=setTimeout(Vp,100)}function Vp(){console.log("DEBUG: populateFeatureSearch ENTERED, NODE_ENV:",typeof process<"u"?"production":"undefined"),Pl.clear(),$l.clear(),Ja.clear(),Jn=[],Oi=[],Ms.clear();const c=new Set,f=E=>{const L=wi(E);!L||!L.value||c.has(L.value)||(c.add(L.value),Oi.push(L))},p=(E,L,P={})=>{if(!E||!L)return!1;const D=P&&P.skipIfExists===!0;if(!Ja.has(E))return Ja.set(E,L),!0;if(D)return!1;const q=Ja.get(E);return Array.isArray(q)?q.push(L):Ja.set(E,[q,L]),!0},g=()=>{Oa.length||yl(),Oa.length&&Oa.forEach(E=>{if(!E||!E.label)return;const L=E.key||ka(E.label),P=E.tokens||kn(E.label),D=E.primaryTokens||kn(E.label),q={entryType:"deviceLibrary",label:E.label,value:E.label,tokens:P,primaryTokens:D,element:E.focusTarget||E.element,rawElement:E.element,categoryKey:E.categoryKey,categoryLabel:E.categoryLabel,summary:E.summary,focusLibraryEntry:()=>bf(E,{skipScroll:!0}),highlightLibraryEntry:()=>hf(E.focusTarget||E.element)};p(L,q);const ie=`${E.label} · ${E.categoryLabel}`,se=Mu(q)||E.summary||E.categoryLabel,te={type:"device",key:L,display:ie,tokens:P,primaryTokens:D,value:q,detail:se};f(te),Jn.push(te)})};g(),document.querySelectorAll("h2[id], legend[id], h3[id], h4[id]").forEach(E=>{if(helpDialog&&helpDialog.contains(E))return;const L=E.textContent.trim();if(!L)return;const P=E.dataset?.searchKeywords||E.getAttribute("data-search-keywords")||"",D=ku(E,{label:L,keywords:P});if(!D||!D.key)return;const q=D.optionValue||D.displayLabel||D.baseLabel;if(!q)return;const ie={type:"feature",key:D.key,display:q,tokens:Array.isArray(D.tokens)?D.tokens:[],primaryTokens:Array.isArray(D.primaryTokens)?D.primaryTokens:[],value:D,optionLabel:D.displayLabel||D.baseLabel||q,detail:Bu(D)};f(ie),Jn.push(ie)});try{const E=document.querySelectorAll(Uf);let L=0;E.forEach((P,D)=>{if(L>100||(L++,P.tagName==="BUTTON")||!P||helpDialog&&helpDialog.contains(P))return;const q=Hf(P);if(!q)return;const ie=jf(P),se=ku(P,{label:q,keywords:ie});if(!se||!se.key)return;const te=se.optionValue||se.displayLabel||se.baseLabel;if(!te)return;const ve={type:gu(P),key:se.key,display:te,tokens:Array.isArray(se.tokens)?se.tokens:[],primaryTokens:Array.isArray(se.primaryTokens)?se.primaryTokens:[],value:se,optionLabel:se.displayLabel||se.baseLabel||te,detail:Bu(se)};f(ve),Jn.push(ve)})}catch(E){typeof console<"u"&&typeof console.warn=="function"&&console.warn("app-core-new-2.js: error querying extra elements",E)}helpDialog&&helpDialog.querySelectorAll("section[data-help-section]").forEach(E=>{const L=E.querySelector("h3");if(!L)return;const P=L.textContent.trim();if(!P)return;const D=E.dataset.helpKeywords||"",q=ka(P),ie=kn(`${P} ${D}`.trim()),se=kn(P),te={section:E,label:P,tokens:ie};$l.set(q,te);const ye=`${P} (help)`,ve={type:"help",key:q,display:ye,tokens:ie,primaryTokens:se,value:te,optionLabel:P,detail:cp(E)};f(ve),Jn.push(ve)}),document.querySelectorAll("select").forEach(E=>{E.querySelectorAll("option").forEach(L=>{const P=L.textContent.trim();if(!P||L.value==="None")return;const D=ka(P);if(Ja.has(D))return;const q=L.dataset?.searchKeywords||L.getAttribute("data-search-keywords")||E.dataset?.searchKeywords||E.getAttribute("data-search-keywords")||"",ie=kn(`${P} ${q}`.trim()),se=kn(P),te={select:E,value:L.value,label:P,tokens:ie};if(!p(D,te,{skipIfExists:!0}))return;const ve={type:"device",key:D,display:P,tokens:ie,primaryTokens:se,value:te,optionLabel:P,detail:Mu(te)};f(ve),Jn.push(ve)})}),[{label:"Create New Project",key:"action-create-new-project",action:"create-new-project",keywords:"new clear reset start scratch empty",detail:"Clear current project and start fresh",icon:ICON_GLYPHS.resetView},{label:"Save Project",key:"action-save-project",action:"save-project",keywords:"save download keep store backup",detail:"Save current configuration to file",icon:ICON_GLYPHS.save},{label:"Export Project",key:"action-export-project",action:"export-project",keywords:"export share send bundle package",detail:"Create a shareable bundle",icon:ICON_GLYPHS.share},{label:"Toggle Dark Mode",key:"action-toggle-dark-mode",action:"toggle-dark-mode",keywords:"dark light theme mode night day switch toggle",detail:"Switch between light and dark themes",icon:ICON_GLYPHS.moon},{label:"Toggle Pink Mode",key:"action-toggle-pink-mode",action:"toggle-pink-mode",keywords:"pink barbie theme mode color style switch toggle",detail:"Toggle the special Pink Mode theme",icon:ICON_GLYPHS.star},{label:"Open Settings",key:"action-open-settings",action:"open-settings",keywords:"settings preferences config options gear setup",detail:"Open application settings dialog",icon:ICON_GLYPHS.gears},{label:"Open Help Center",key:"action-open-help",action:"open-help",keywords:"help support guide manual docs documentation info",detail:"Open the Help Center",icon:ICON_GLYPHS.note},{label:"Force Reload",key:"action-force-reload",action:"force-reload",keywords:"reload refresh restart update clear cache",detail:"Reload the application and clear caches",icon:ICON_GLYPHS.reload}].forEach(E=>{const L=E.key,P=kn(`${E.label} ${E.keywords}`.trim()),D=kn(E.label),q={type:"action",key:L,display:E.label,tokens:P,primaryTokens:D,value:{type:"action",action:E.action,label:E.label,key:L,icon:E.icon},optionLabel:E.label,detail:E.detail};f(q),Jn.push(q)}),g(),Jn.forEach(E=>{if(!E||!E.key)return;const L=E.type||"feature",P=Dl(E.key,L);Ms.set(P,E)}),ks(),xf(),va(Oi),Xa&&Xa.value&&wu(Xa.value)}function zp(){const c=texts[currentLang]||texts.en||{},f=texts.en||{},p=c.editProjectBtn||f.editProjectBtn||"Edit Project requirements",g=c.addExtraGearBtn||f.addExtraGearBtn||"Add temporary extra gear",S=document.getElementById("editProjectBtn");S&&(S.textContent!==p&&(S.textContent=p),S.getAttribute("title")!==p&&S.setAttribute("title",p),S.getAttribute("data-help")!==p&&S.setAttribute("data-help",p));const E=document.getElementById("addExtraGearBtn");E&&(E.textContent!==g&&(E.textContent=g),E.getAttribute("title")!==g&&E.setAttribute("title",g),E.getAttribute("data-help")!==g&&E.setAttribute("data-help",g))}function qp(){let c=null;if(mn&&mn.classList&&!mn.classList.contains("hidden")?c=mn:Dr&&Dr.classList&&!Dr.classList.contains("hidden")&&(c=Dr),!c){const E=document.getElementById("editProjectBtn");E&&E.remove();const L=document.getElementById("addExtraGearBtn");L&&L.remove();return}let f=document.getElementById("editProjectBtn");f||(f=document.createElement("button"),f.id="editProjectBtn");const p=f.parentElement;p&&p!==c&&p.id!=="editProjectBtn"&&p.removeChild(f),f.dataset.editProjectBound||(f.type="button",f.addEventListener("click",()=>{const E=typeof getProjectDialogSeedInfo=="function"?getProjectDialogSeedInfo():je?{...je}:ji?collectProjectFormData():{};typeof openProjectDialogWithInfo=="function"?openProjectDialogWithInfo(E):(ji&&populateProjectForm(E||{}),openDialog(Ps))}),f.dataset.editProjectBound="true");let g=document.getElementById("addExtraGearBtn");g||(g=document.createElement("button"),g.id="addExtraGearBtn"),g.dataset.extraGearBound||(g.type="button",g.addEventListener("click",()=>{try{typeof document<"u"&&document.dispatchEvent(new CustomEvent("gearlist:add-extra-gear"))}catch(E){console.warn("Unable to request extra gear addition",E)}}),g.dataset.extraGearBound="true");const S=c.querySelector("h2");S&&f.parentElement!==c?(S.insertAdjacentElement("afterend",f),g.parentElement!==c&&f.insertAdjacentElement("afterend",g)):S?f.parentElement===c&&g.parentElement!==c&&f.insertAdjacentElement("afterend",g):(g.parentElement!==c&&c.prepend(g),f.parentElement!==c&&c.prepend(f)),f.type!=="button"&&(f.type="button"),g.type!=="button"&&(g.type="button"),zp()}function Ju(){if(Dr&&!Dr.classList.contains("hidden")&&Dr.innerHTML.trim()!=="")Us&&Us.classList.add("hidden"),Hs&&Hs.classList.remove("hidden"),qp();else{Us&&Us.classList.remove("hidden"),Hs&&Hs.classList.add("hidden");const f=document.getElementById("editProjectBtn");f&&f.remove();const p=document.getElementById("addExtraGearBtn");p&&p.remove()}}function Jl(c){if(typeof c!="string")return"";let f=c.replace(/\s+/g," ").trim();return f.endsWith("+")&&(f=f.substring(0,f.length-1).trim()),f}function ed(c){if(!c)return"";let f="";c.dataset&&typeof c.dataset.gearTableCategory=="string"&&(f=c.dataset.gearTableCategory),f||(f=c.getAttribute("data-gear-table-category")||"");const p=c.querySelector(".category-row td");if(p){const g=p.querySelector(".gear-category-label");if(g&&g.textContent)f=g.textContent;else{const S=p.getAttribute("data-gear-category-label");S?f=S:p.textContent&&(f=p.textContent)}}return Jl(f)}function td(c,f,p){if(!c)return;const g=Jl(f),S=typeof p=="string"?p.trim():"";S&&c.setAttribute("data-gear-custom-key",S),c.querySelectorAll("[data-gear-custom-category]").forEach(E=>{g&&E.setAttribute("data-gear-custom-category",g),S&&(E.setAttribute("data-gear-custom-key",S),E.getAttribute("data-gear-custom-list")!==null&&E.setAttribute("data-gear-custom-list",S),E.getAttribute("data-gear-custom-add")!==null&&E.setAttribute("data-gear-custom-add",S),E.getAttribute("data-gear-custom-suggestions")!==null&&E.setAttribute("data-gear-custom-suggestions",S))})}function od(c,f){if(!c||!f)return;const p=Jl(f);if(!p)return;c.setAttribute("data-gear-table-category",p),c.dataset&&(c.dataset.gearTableCategory=p);const g=c.querySelector(".category-row td");if(!g)return;g.setAttribute("data-gear-category-label",p);const S=g.querySelector(".gear-category-label");S?S.textContent.trim()!==p&&(S.textContent=p):g.textContent.trim()!==p&&(g.textContent=p)}function rd(c){if(!c)return;const f=(E,L)=>{if(!E||!L||E===L)return;const P=E.ownerDocument||(typeof document<"u"?document:null),D=se=>{if(!se)return;if(E.childNodes.length>0){const ye=E.lastElementChild,ve=ye&&ye.tagName&&ye.tagName.toLowerCase()==="br",Ke=se.nodeType===3&&se.textContent.trim(),Ze=se.nodeType===1,ut=Ze&&se.tagName?se.tagName.toLowerCase():"";(Ke||Ze&&!(ut==="div"||ut==="section"||ut==="table"||ut==="ul"||ut==="ol"))&&!ve&&P&&E.appendChild(P.createElement("br"))}E.appendChild(se)},q=E.querySelector(".gear-standard-items");L.querySelectorAll(".gear-standard-items").forEach(se=>{if(q){for(;se.firstChild;)q.appendChild(se.firstChild);se.remove()}else{const te=E.querySelector(".gear-custom-section");te?E.insertBefore(se,te):E.appendChild(se)}});const ie=E.querySelector(".gear-custom-section");for(L.querySelectorAll(".gear-custom-section").forEach(se=>{if(!ie){E.appendChild(se);return}let te=ie.querySelector(".gear-custom-items");!te&&P&&(te=P.createElement("div"),te.className="gear-custom-items",ie.appendChild(te));const ye=se.querySelector(".gear-custom-items");if(ye&&te)for(;ye.firstChild;)te.appendChild(ye.firstChild);se.querySelectorAll(".gear-custom-item").forEach(ve=>{te?te.appendChild(ve):ie.appendChild(ve)}),se.remove()});L.firstChild;)D(L.firstChild)},p=E=>{if(!E)return null;const L=Array.from(E.querySelectorAll("tr")).filter(ie=>!ie.classList.contains("category-row")),P=E.ownerDocument||(typeof document<"u"?document:null);let D=L.shift();if(!D&&P&&(D=P.createElement("tr"),E.appendChild(D)),!D)return null;let q=D.querySelector("td");return!q&&P&&(q=P.createElement("td"),D.appendChild(q)),q?(L.forEach(ie=>{const se=ie.querySelector("td")||ie;f(q,se),ie.remove()}),q):null},g=Array.from(c.querySelectorAll("tbody.category-group")),S=new Map;g.forEach(E=>{const L=ed(E);if(!L)return;const P=L.toLowerCase(),D=S.get(P);if(!D){S.set(P,E),od(E,L);return}const q=D.getAttribute("data-gear-custom-key")||"",ie=E.getAttribute("data-gear-custom-key")||"",se=q||ie;se&&q!==se&&D.setAttribute("data-gear-custom-key",se);const te=p(D),ye=Array.from(E.querySelectorAll("tr")).filter(ve=>!ve.classList.contains("category-row"));te?ye.forEach(ve=>{const Ke=ve.querySelector("td")||ve;f(te,Ke),ve.remove()}):ye.forEach(ve=>D.appendChild(ve)),p(D),td(D,L,se),E.remove()})}function nd(c){if(!c)return;c.querySelectorAll("tbody.category-group").forEach(p=>{const g=ed(p);if(!g)return;od(p,g);const S=p.getAttribute("data-gear-custom-key")||"";td(p,g,S)})}function Kp(c){if(!c)return;const f=c.ownerDocument||(typeof document<"u"?document:null);if(!f)return;const p=c.querySelectorAll("tbody.category-group");if(p.length){p.forEach(L=>{L.classList.contains("category-group")||L.classList.add("category-group")}),c.querySelectorAll("tbody").forEach(L=>{L.querySelector("tr.category-row")&&L.classList.add("category-group")}),nd(c);return}const g=Array.from(c.rows||[]);if(!g.length)return;const S=[];let E=null;g.forEach(L=>{L.classList.contains("category-row")?(E=f.createElement("tbody"),E.className="category-group",E.appendChild(L),S.push(E)):(E||(E=f.createElement("tbody"),E.className="category-group",S.push(E)),E.appendChild(L))}),Array.from(c.tBodies||[]).forEach(L=>{(!L.rows.length||!L.classList.contains("category-group"))&&L.remove()}),S.forEach(L=>{L.rows.length&&c.appendChild(L)}),nd(c),rd(c)}let ts=null;function Wp(){if(ts&&ts.length)return ts;const c=new Set;return typeof texts=="object"&&texts!==null&&Object.values(texts).forEach(f=>{const p=f&&typeof f.overviewTitle=="string"?f.overviewTitle.trim():"";p&&c.add(p)}),c.add("Project Overview and Gear List"),c.add("Project Overview"),ts=Array.from(c).filter(Boolean).sort((f,p)=>p.length-f.length),ts}function Yp(c){if(!c)return"";if(typeof c.getAttribute=="function"){const P=c.getAttribute("data-project-name");if(typeof P=="string"){const D=P.trim();if(D)return D}}const f=typeof c.textContent=="string"?c.textContent.replace(/\s+/g," ").trim():"";if(!f)return"";const p=f.match(/[“"']([^“”"']+)[”"']/);if(p&&p[1]&&p[1].trim())return p[1].trim();const g=f.match(/[«‹]([^»›]+)[»›]/);if(g&&g[1]&&g[1].trim())return g[1].trim();const S=Wp(),E=f.toLowerCase();for(const P of S){const D=P.trim();if(!D)continue;const q=D.toLowerCase();if(E.startsWith(q)){let ie=f.slice(D.length).trim();return ie?(ie=ie.replace(/^(?:for|pour|für|per|para)\b\s*/i,"").trim(),ie=ie.replace(/^(?:the|le|la|les|den|die|das|el|los|las)\b\s*/i,"").trim(),ie=ie.replace(/^[–—:-]+/,"").trim(),ie=ie.replace(/^["'“”«»‹›]+/,"").replace(/["'“”«»‹›]+$/,"").trim(),ie||""):""}}if(S.some(P=>E===P.toLowerCase()))return"";const L=f.replace(/^["'“”«»‹›]+/,"").replace(/["'“”«»‹›]+$/,"").trim();return L&&L!==f?L:f}function ad(c){if(!c)return{projectHtml:"",gearHtml:""};if(typeof c=="object"){const te=c.projectHtml||c.project||"",ye=c.gearHtml||c.gear||"";if(te||ye)return{projectHtml:te,gearHtml:ye};c=c.gearList||""}const f=new DOMParser().parseFromString(c,"text/html"),p=f.querySelector("h2"),g=f.querySelector(".requirements-grid"),S=p?p.outerHTML:"";let E="",L=null;if(g){const te=ut=>!!(ut&&/^H[1-6]$/i.test(ut.tagName)),ye=ut=>!!(p&&ut&&typeof ut.isSameNode=="function"&&ut.isSameNode(p)),ve=ut=>!ut||typeof ut.compareDocumentPosition!="function"?!1:!!(ut.compareDocumentPosition(g)&Node.DOCUMENT_POSITION_FOLLOWING);let Ke=null,Ze=g.previousElementSibling;for(;Ze;){if(te(Ze)&&!ye(Ze)&&ve(Ze)){Ke=Ze;break}Ze=Ze.previousElementSibling}if(!Ke){const ut=g.parentElement;if(ut){const Ft=Array.from(ut.querySelectorAll("h1, h2, h3, h4, h5, h6"));for(let Mo=Ft.length-1;Mo>=0;Mo-=1){const Yt=Ft[Mo];if(te(Yt)&&!ye(Yt)&&ve(Yt)){Ke=Yt;break}}}}if(Ke)L=Ke,E=Ke.outerHTML;else{const ut=g.getAttribute("data-heading")||"Project Requirements";E=`<h3>${y(ut)}</h3>`}}const P=g?S+E+g.outerHTML:"",D=Yp(p);let q=f.querySelector(".gear-table");if(!q){const te=Array.from(f.querySelectorAll("table"));te.length===1?q=te[0]:te.length>1&&(q=te.find(ve=>{const Ke=ve.previousElementSibling;return Ke&&Ke.matches("h3")&&/gear list/i.test(Ke.textContent||"")})||te[0])}const ie=D?`<h2>Gear List: “${y(D)}”</h2>`:"";let se="";if(q&&(Kp(q),se=ie+q.outerHTML),!se){const te=f.body?f.body.cloneNode(!0):null,ye=f.body?f.body.innerHTML.trim():"";if(te){if(p){const Ke=te.querySelector("h2");Ke&&Ke.remove()}if(L){const Ke=L.tagName?L.tagName.toLowerCase():"",Ze=L.textContent?L.textContent.trim():"",ut=Ke?te.querySelector(Ke):null;ut&&(!Ze||(ut.textContent||"").trim()===Ze)&&ut.remove()}else{const Ke=te.querySelector("h3");Ke&&/project requirements/i.test(Ke.textContent||"")&&Ke.remove()}if(g){const Ke=te.querySelector(".requirements-grid");Ke&&Ke.remove()}const ve=te.innerHTML.trim();ve?se=ve:ye&&(se=ye)}else ye&&(se=ye)}return{projectHtml:P,gearHtml:se}}Qp(ad);function Qp(c){var f=[];if(typeof cineGearList=="object"&&cineGearList&&f.push(cineGearList),typeof global<"u"&&global&&typeof global.cineGearList=="object"&&global.cineGearList&&f.indexOf(global.cineGearList)===-1&&f.push(global.cineGearList),typeof require=="function")try{var p=require("./modules/gear-list.js");p&&typeof p=="object"&&f.indexOf(p)===-1&&f.push(p)}catch{}for(var g=0;g<f.length;g+=1){var S=f[g];if(!(!S||typeof S.setImplementation!="function"))try{return S.setImplementation({splitGearListHtml:c},{source:"app-core-new-2"}),!0}catch(E){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Unable to register splitGearListHtml implementation with cineGearList.",E)}}return typeof global<"u"&&(global.splitGearListHtml=c),!1}function Xp(c){const f=c?.key;if(!f||!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(f)||!mn)return;const p=Array.from(mn.querySelectorAll(".requirement-box"));if(!p.length)return;const g=c.currentTarget,S=p.indexOf(g);if(S===-1)return;c.preventDefault();let E=S;f==="ArrowLeft"||f==="ArrowUp"?E=(S-1+p.length)%p.length:f==="ArrowRight"||f==="ArrowDown"?E=(S+1)%p.length:f==="Home"?E=0:f==="End"&&(E=p.length-1);const L=p[E];if(!(!L||typeof L.focus!="function"))try{L.focus({preventScroll:!0})}catch{L.focus()}}const Zp=Object.freeze({Camera:{summary:"Primary camera body chosen for the current setup.",logic:"Always included so the crew preps the selected camera package."},"Camera Support":{summary:"Baseplates, cages and handle accessories for mounting the camera.",logic:"Matched to your camera body, selected handles and any scenario add-ons."},Media:{summary:"Recording media that works with the selected camera.",logic:"Picks capacities that cover the camera codecs without running out of space."},Lens:{summary:"Optics selected in the project requirements.",logic:"Pulled directly from your lens choices so they travel with the kit."},"Lens Support":{summary:"Lens support brackets, rails and rings sized for your glass.",logic:"Added automatically when lenses or matte box setups require additional support."},"Matte box + filter":{summary:"Matte boxes, trays and filter packs.",logic:"Generated from your matte box preference and filter selections, including required adapters."},"LDS (FIZ)":{summary:"Focus, iris and zoom control hardware.",logic:"Reflects the motors and controllers picked in the wireless FIZ section."},"Camera Batteries":{summary:"Batteries dedicated to powering the camera body.",logic:"Sized from the camera power draw, runtime targets and hot-swap rules."},"Monitoring Batteries":{summary:"Power for handheld and field monitors.",logic:"Ensures each monitor package includes enough charged batteries for the day."},Chargers:{summary:"Charging stations for included battery systems.",logic:"Adds compatible chargers so battery rotations stay balanced during the shoot."},Monitoring:{summary:"On-set monitoring packages for the crew.",logic:"Derived from monitoring configuration and distribution preferences in project details."},"Monitoring support":{summary:"Stands, brackets, straps and cages supporting monitors.",logic:"Auto-matched to monitor sizes and usage (handheld, stand or cart setups)."},Rigging:{summary:"Arms, clamps and mounting hardware for accessories.",logic:"Includes core rigging plus extras triggered by scenarios like Steadicam or gimbal use."},Power:{summary:"Power distribution cables and adapters.",logic:"Covers how accessories receive power from the main battery ecosystem."},Grip:{summary:"Support gear like sliders, stabilisers and Easyrig options.",logic:"Reflects stabilisation preferences and active shooting scenarios."},"Carts and Transportation":{summary:"Carts, cases and transport aids for the camera department.",logic:"Included so the crew can move, stage and secure the package efficiently."},Miscellaneous:{summary:"Utility items that keep the crew efficient and comfortable.",logic:"Adds weather protection and helpful tools based on scenarios and best practices."},Consumables:{summary:"Expendables such as tapes, wipes and covers.",logic:"Scaled to shoot length and weather needs so consumables never run short."}}),id=Object.freeze({summary:"Automatically generated grouping of related equipment.",logic:"Filled using your project requirements, selections and saved auto gear rules."}),ec=c=>c&&Zp[c]||id,Jp=c=>{const f=ec(c),p=[];return c?p.push(`${c} – ${f.summary}`):p.push(f.summary),f.logic&&p.push(`Logic: ${f.logic}`),p.join(" ")},em=c=>typeof c!="string"||!c.trim()?"":c.replace(/[_-]+/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").split(/\s+/).filter(Boolean).map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" "),tm=c=>!Array.isArray(c)||!c.length?"":c.map(f=>em(f)).filter(Boolean).join(" › "),om=new Set(["script","style","template","iframe","object","embed","link","meta","base"]),rm=new Set(["formaction","action","srcdoc"]);function nm(c){if(typeof c!="string")return!1;const f=c.trim();if(!f||f.startsWith("#"))return!0;if(/^(?:javascript|vbscript|data):/i.test(f))return!1;try{const p=typeof window<"u"&&window.location?window.location.href:"https://localhost",g=new URL(f,p);if(/^(?:javascript|vbscript|data):/i.test(g.protocol))return!1;if(typeof window<"u"&&window.location&&window.location.origin)return g.origin===window.location.origin;if(!/^[a-z][a-z0-9+.-]*:/i.test(f))return!0}catch{if(!/^[a-z][a-z0-9+.-]*:/i.test(f))return!0}return!1}function tc(c){if(!c)return"";if(typeof c!="string")return tc(String(c));let f;try{f=new DOMParser().parseFromString(c,"text/html")}catch(p){return console.warn("Failed to parse shared HTML for sanitization",p),""}return!f||!f.body?"":(om.forEach(p=>{f.body.querySelectorAll(p).forEach(g=>{g.remove()})}),f.body.querySelectorAll("*").forEach(p=>{Array.from(p.attributes).forEach(g=>{const S=g.name.toLowerCase();if(S.startsWith("on")){p.removeAttribute(g.name);return}if(S==="style"){p.removeAttribute(g.name);return}if(rm.has(S)){p.removeAttribute(g.name);return}if(S==="href"||S==="xlink:href"||S==="src"||S==="srcset"){const E=g.value||"";(S==="srcset"?E.split(",").map(P=>P.trim().split(/\s+/)[0]).filter(Boolean):[E]).every(nm)||p.removeAttribute(g.name);return}S==="target"&&p.removeAttribute(g.name)})}),f.body.innerHTML)}function am(c){const{projectHtml:f,gearHtml:p}=ad(c),g=tc(f),S=tc(p);if(mn&&(g?mn._lastRendered!==g&&(mn.innerHTML=g,mn._lastRendered=g,mn.classList&&mn.classList.remove("hidden"),Array.from(mn.querySelectorAll(".requirement-box")).forEach(P=>{P.removeAttribute("title"),P.removeAttribute("data-help"),P.hasAttribute("tabindex")||P.setAttribute("tabindex","0"),P.hasAttribute("role")||P.setAttribute("role","group"),P.addEventListener("keydown",Xp),P.querySelectorAll(".req-label, .req-value").forEach(D=>{D.removeAttribute("title"),D.removeAttribute("data-help")})}),pl(mn)):mn._lastRendered!==""&&(mn.innerHTML="",mn._lastRendered="",mn.classList&&mn.classList.add("hidden"))),Dr){if(S){if(Dr._lastRendered!==S){Dr.innerHTML=S,Dr._lastRendered=S;const L=Dr.querySelector(".gear-table")||Dr.querySelector("table");L&&rd(L),typeof ensureGearListCustomControls=="function"&&ensureGearListCustomControls(Dr),Dr.classList&&Dr.classList.remove("hidden"),typeof enhanceGearListItems=="function"&&enhanceGearListItems(Dr),applyFilterSelectionsToGearList(),renderFilterDetails();const P=q=>{if(typeof q!="string"||!q.trim())return{info:null,category:"",categoryPath:[]};const ie=new Set,se=(ye,ve)=>{if(!to(ye)||ie.has(ye))return null;if(ie.add(ye),Object.prototype.hasOwnProperty.call(ye,q)&&to(ye[q]))return{info:ye[q],categoryPath:ve};for(const[Ke,Ze]of Object.entries(ye)){if(!to(Ze))continue;const ut=se(Ze,ve.concat(Ke));if(ut)return ut}return null},te=se(devices,[]);return te?{info:te.info,category:tm(te.categoryPath),categoryPath:te.categoryPath}:{info:null,category:"",categoryPath:[]}},D=({name:q,countText:ie,deviceInfo:se,libraryCategory:te,tableCategory:ye})=>{const ve=[],Ke=`${ie||""}${q}`.trim();Ke&&ve.push(Ke);const Ze=ec(ye),ut=[];if(ye&&ut.push(`Gear list section: ${ye}`),Ze.summary&&ut.push(Ze.summary),Ze.logic&&ut.push(`Logic: ${Ze.logic}`),!ye&&!ut.length){const Ft=ec("");Ft.summary&&ut.push(Ft.summary),Ft.logic&&ut.push(`Logic: ${Ft.logic}`)}if(ut.length&&ve.push(ut.join(" – ")),te&&ve.push(`Device library category: ${te}`),se){let Ft=generateSafeConnectorSummary(se);Ft=Ft?(function(Yt){let oo;do oo=Yt,Yt=Yt.replace(/<[^>]+>/g,"");while(Yt!==oo);return Yt.replace(/\s+/g," ").trim()})(Ft):"",se.notes&&(Ft=Ft?`${Ft}; Notes: ${se.notes}`:se.notes),Ft&&ve.push(Ft)}return ve.join(" – ")};Dr.querySelectorAll("tbody.category-group").forEach(q=>{const ie=q.querySelector(".category-row td");if(!ie)return;const se=ie.textContent.trim();q.setAttribute("data-gear-table-category",se);const te=Jp(se);ie.setAttribute("title",te),ie.setAttribute("data-help",te)}),Dr.querySelectorAll(".gear-item").forEach(q=>{const ie=q.getAttribute("data-gear-name")||q.textContent.trim(),{info:se,category:te}=P(ie),ye=q.textContent.trim().match(/^(\d+)x\s+/),ve=ye?`${ye[1]}x `:"",Ke=q.closest("tbody.category-group")?.getAttribute("data-gear-table-category"),Ze=D({name:ie,countText:ve,deviceInfo:se,libraryCategory:te,tableCategory:Ke||""});q.setAttribute("title",Ze),q.setAttribute("data-help",Ze),q.querySelectorAll("select").forEach(ut=>{ut.setAttribute("title",Ze),ut.setAttribute("data-help",Ze),Qc(ut)})}),Dr.querySelectorAll("select").forEach(q=>{if(q.getAttribute("data-help"))return;const ie=q.selectedOptions&&q.selectedOptions[0],se=ie?ie.textContent.trim():q.value,{info:te,category:ye}=P(se),ve=q.closest("tbody.category-group")?.getAttribute("data-gear-table-category"),Ke=D({name:se,countText:"1x ",deviceInfo:te,libraryCategory:ye,tableCategory:ve||""});q.setAttribute("title",Ke),q.setAttribute("data-help",Ke),Qc(q)}),pl(Dr)}}else Dr._lastRendered!==""&&(Dr.innerHTML="",Dr._lastRendered="",Dr.classList&&Dr.classList.add("hidden"));if(typeof ensureGearListActions=="function")ensureGearListActions();else if(!Dr.querySelector("#gearListActions")){const L=document.createElement("div");L.id="gearListActions";const P=document.createElement("p");P.id="gearListAutosaveNote",P.className="gear-list-autosave-note",P.hidden=!0,P.setAttribute("hidden",""),L.appendChild(P),Dr.appendChild(L)}}mt&&(os(mt.sliderBowl||""),Qs(mt.easyrig||""));const E=`${g||""}${S||""}`.trim();E&&typeof globalThis<"u"&&(globalThis.__cineLastGearListHtml=E),Ju(),lr("updateAutoGearHighlightToggleButton",[],{defer:!0})}function oc(){return Dr?Dr.querySelector("#gearListSliderBowl"):null}function sd(){const c=oc();return c?c.value:mt&&mt.sliderBowl?mt.sliderBowl:""}function os(c){const f=oc();f&&c&&Array.from(f.options).some(p=>p.value===c)&&(f.value=c,Pi(f))}function rc(){return Dr?Dr.querySelector("#gearListEasyrig"):null}function ld(){const c=rc();return c?c.value:mt&&mt.easyrig?mt.easyrig:""}function Qs(c){const f=rc();f&&c&&Array.from(f.options).some(p=>p.value===c)&&(f.value=c,Pi(f))}function cd(c){if(c!=null){if(typeof c=="string"){const f=c.trim();return f||void 0}if(typeof c=="number")return Number.isNaN(c)?void 0:c;if(typeof c=="boolean")return c||void 0;if(Array.isArray(c)){const f=c.map(p=>cd(p)).filter(p=>p!==void 0);return f.length?f:void 0}if(typeof c=="object")return ud(c)||void 0}}function ud(c){if(!c||typeof c!="object")return null;const f={};return Object.entries(c).forEach(([p,g])=>{const S=cd(g);S!==void 0&&(f[p]=S)}),Object.keys(f).length>0?f:null}function rs(c){return c==null?!1:typeof c=="string"?c.trim().length>0:typeof c=="number"?!Number.isNaN(c):typeof c=="boolean"?c:Array.isArray(c)?c.some(f=>rs(f)):typeof c=="object"?Object.keys(c).some(f=>rs(c[f])):!1}function nc(c,f){if(c===f)return!0;if(!c||!f)return!1;if(Array.isArray(c)&&Array.isArray(f)){if(c.length!==f.length)return!1;for(let p=0;p<c.length;p+=1)if(!nc(c[p],f[p]))return!1;return!0}if(typeof c=="object"&&typeof f=="object"){const p=Object.keys(c),g=Object.keys(f);return p.length!==g.length?!1:p.every(S=>nc(c[S],f[S]))}return!1}function ns(){no===null&&(no={})}function ac(c){ns();const f=ud(c);return f?no&&nc(f,no)?null:f:rs(c)&&rs(je)?je:null}function im(c){je=c}function dd(){return je}function fd(c){return c?[c.camera||"",c.monitor||"",c.video||"",c.cage||"",eo(c.motors||[]),eo(c.controllers||[]),c.distance||"",c.batteryPlate||"",c.battery||"",c.batteryHotswap||"",c.sliderBowl||"",c.easyrig||"",eo(c.projectInfo||null),eo(c.autoGearRules||null),eo(c.diagramPositions||null)].join("||"):""}function ic(c){mt=c,ct=fd(c)}function as(){const c=ji?collectProjectFormData():{};c.sliderBowl=sd(),c.easyrig=ld();const p={projectInfo:ac(c)},g=(L,P)=>{if(P!=null)if(typeof P=="string"){const D=P.trim();if(!D||D==="None")return;p[L]=D}else if(Array.isArray(P)){const D=P.filter(q=>typeof q=="string"&&q.trim()&&q!=="None");D.length&&(p[L]=D)}else p[L]=P};g("camera",cameraSelect&&cameraSelect.value),g("monitor",monitorSelect&&monitorSelect.value),g("video",videoSelect&&videoSelect.value),g("cage",cageSelect&&cageSelect.value),Array.isArray(motorSelects)&&g("motors",motorSelects.map(L=>L&&L.value)),Array.isArray(controllerSelects)&&g("controllers",controllerSelects.map(L=>L&&L.value)),g("distance",distanceSelect&&distanceSelect.value),g("batteryPlate",batteryPlateSelect&&normalizeBatteryPlateValue(batteryPlateSelect.value,batterySelect&&batterySelect.value)),g("battery",batterySelect&&batterySelect.value),g("batteryHotswap",hotswapSelect&&hotswapSelect.value),g("sliderBowl",c.sliderBowl),g("easyrig",c.easyrig);const S=getProjectScopedAutoGearRules();S&&S.length&&(p.autoGearRules=S);const E=md();return Object.keys(E).length&&(p.diagramPositions=E),p}function sm(c){if(!c)return!1;const f=g=>{if(Array.isArray(g))return g.some(E=>f(E));if(g==null)return!1;const S=typeof g=="string"?g.trim():g;return!(!S||typeof S=="string"&&S.toLowerCase()==="none")};return!!([c.camera,c.monitor,c.video,c.cage,c.batteryPlate,c.battery,c.batteryHotswap].some(g=>f(g))||f(c.motors)||f(c.controllers))}function is(){if(!saveSetupBtn)return;const c=document.getElementById("setupName"),f=texts[currentLang]||{},p=texts.en||{},g=f.saveSetupBtn||p.saveSetupBtn||"",S=f.updateSetupBtn||p.updateSetupBtn||g,E=c&&typeof c.value=="string"?c.value.trim():"",L=setupSelect&&typeof setupSelect.value=="string"?setupSelect.value:"";if(L&&E&&E!==L){h(saveSetupBtn,S);return}if(mt&&L&&E===L&&fd(as())!==ct){h(saveSetupBtn,S);return}h(saveSetupBtn,g)}Ps=document.getElementById("projectDialog"),ji=document.getElementById("projectForm"),nu=document.getElementById("filter"),au=document.getElementById("filterDetails"),document.getElementById("mattebox"),Tl=document.getElementById("projectCancel"),Gl=document.getElementById("projectDialogClose"),document.getElementById("feedbackDialog"),document.getElementById("feedbackForm"),Vi=document.getElementById("fbCancel"),zi=document.getElementById("fbUseLocationBtn");const sc=document.getElementById("fbSubmit");if(Vi){const c=Vi.textContent?.trim()||texts[currentLang]?.cancelEditBtn||texts.en?.cancelEditBtn||"Cancel";h(Vi,c,ICON_GLYPHS.circleX)}if(zi){const c=zi.textContent?.trim()||"Use Current Location";h(zi,c,ICON_GLYPHS.pin)}if(sc){const c=sc.textContent?.trim()||texts[currentLang]?.feedbackSubmit||texts.en?.feedbackSubmit||"Save & Submit";h(sc,c,ICON_GLYPHS.paperPlane)}var lc=typeof loadFeedback=="function"?loadFeedback:()=>({}),pd=typeof saveFeedback=="function"?saveFeedback:()=>{};_l=document.getElementById("diagramArea"),document.getElementById("diagramLegend"),document.getElementById("downloadDiagram"),document.getElementById("zoomIn"),document.getElementById("zoomOut"),document.getElementById("resetView"),document.getElementById("gridSnapToggle"),document.getElementById("diagramHint");const lm=()=>{try{if(typeof getGridSnapState=="function")return!!getGridSnapState()}catch{}const c=readGlobalScopeValue("gridSnap");if(typeof c=="boolean")return c;if(typeof gridSnap<"u")try{return!!gridSnap}catch{}return!1};let md=()=>({}),cm=()=>{},ni=()=>{},gd=()=>{},yd=()=>{},um=()=>"",Xs={},hd={},bd=null,cc={};const Zs=typeof cineFeaturesConnectionDiagram=="object"&&cineFeaturesConnectionDiagram||typeof GLOBAL_SCOPE<"u"&&GLOBAL_SCOPE.cineFeaturesConnectionDiagram||null;function pa(c){const f=[];if(!c)return f;const p=S=>{W(S).forEach(E=>f.push(E))};c.powerInput&&String(c.powerInput).split("/").forEach(S=>{S.trim()&&p(S.trim())});const g=c.power?.input;if(Array.isArray(g))g.forEach(S=>{const E=S&&(S.type||S.portType);E&&p(E)});else if(g){const S=g.type||g.portType;S&&p(S)}return f}function dm(c){const f=pa(c);return f.length?f[0]:""}function uc(){const c=new Set;return console.log("DEBUG: app-core-new-2.js line 15000 REACHED"),Object.values(devices.cameras||{}).forEach(f=>pa(f).forEach(p=>c.add(p))),Object.values(devices.viewfinders||{}).forEach(f=>pa(f).forEach(p=>c.add(p))),Object.values(devices.monitors||{}).forEach(f=>pa(f).forEach(p=>c.add(p))),Object.values(devices.video||{}).forEach(f=>pa(f).forEach(p=>c.add(p))),Object.values(devices.fiz?.motors||{}).forEach(f=>pa(f).forEach(p=>c.add(p))),Object.values(devices.fiz?.controllers||{}).forEach(f=>pa(f).forEach(p=>c.add(p))),Object.values(devices.fiz?.distance||{}).forEach(f=>pa(f).forEach(p=>c.add(p))),Array.from(c).sort(localeSort)}if(Zs&&typeof Zs.createConnectionDiagram=="function")try{const c=typeof globalThis<"u"&&typeof globalThis.scheduleProjectAutoSave=="function"?globalThis.scheduleProjectAutoSave:null,f=typeof saveCurrentSession=="function"?saveCurrentSession:typeof globalThis<"u"&&typeof globalThis.saveCurrentSession=="function"?(...S)=>globalThis.saveCurrentSession(...S):void 0,p={document,window,navigator,getTexts:()=>texts,getCurrentLang:()=>currentLang,getDevices:()=>devices,getCameraSelect:()=>document.getElementById("cameraSelect"),getMonitorSelect:()=>document.getElementById("monitorSelect"),getVideoSelect:()=>document.getElementById("videoSelect"),getDistanceSelect:()=>document.getElementById("distanceSelect"),getBatterySelect:()=>document.getElementById("batterySelect"),getMotorSelects:()=>[document.getElementById("motor1Select"),document.getElementById("motor2Select"),document.getElementById("motor3Select"),document.getElementById("motor4Select")],getControllerSelects:()=>[document.getElementById("controller1Select"),document.getElementById("controller2Select"),document.getElementById("controller3Select"),document.getElementById("controller4Select")],getSetupDiagramContainer:()=>document.getElementById("diagramArea"),getDiagramLegend:()=>document.getElementById("diagramLegend"),getDiagramHint:()=>document.getElementById("diagramHint"),getDownloadDiagramBtn:()=>document.getElementById("downloadDiagramBtn"),getZoomInBtn:()=>document.getElementById("zoomIn"),getZoomOutBtn:()=>document.getElementById("zoomOut"),getResetViewBtn:()=>document.getElementById("resetView"),getGridSnapToggleBtn:()=>document.getElementById("gridSnapToggle"),getCurrentGridSnap:lm,scheduleProjectAutoSave:c,saveCurrentSession:f,checkSetupChanged:is,motorPriority:U,controllerPriority:j,isArri:Y,isArriOrCmotion:le,fizNeedsPower:be,fizPowerPort:re,controllerDistancePort:de,controllerCamPort:ne,cameraFizPort:Ce,motorFizPort:Ee,getSelectedPlate:Pe,isSelectedPlateNative:et,firstPowerInputType:dm,formatConnLabel:Je,connectionLabel:it,fizPort:rt,iconGlyph:Pt,ICON_FONT_KEYS:vt,applyIconGlyph,resolveIconGlyph,positionSvgMarkup,ensureSvgHasAriaHidden,formatSvgCoordinate},g=Zs.createConnectionDiagram(p);ni=()=>Zs.createConnectionDiagram(p),g&&typeof g=="object"&&(typeof g.renderSetupDiagram=="function"&&(ni=g.renderSetupDiagram),typeof g.enableDiagramInteractions=="function"&&(gd=g.enableDiagramInteractions),typeof g.updateDiagramLegend=="function"&&(yd=g.updateDiagramLegend),typeof g.getDiagramManualPositions=="function"&&(md=g.getDiagramManualPositions),typeof g.setManualDiagramPositions=="function"&&(cm=g.setManualDiagramPositions),typeof g.getDiagramCss=="function"&&(um=g.getDiagramCss),g.diagramConnectorIcons&&(Xs=g.diagramConnectorIcons,typeof window<"u"?window.diagramConnectorIcons=Xs:typeof globalThis<"u"&&(globalThis.diagramConnectorIcons=Xs)),g.overviewSectionIcons&&(hd=g.overviewSectionIcons),g.diagramIcons&&(cc=g.diagramIcons),g.DIAGRAM_MONITOR_ICON&&(bd=g.DIAGRAM_MONITOR_ICON))}catch(c){console.warn("Unable to initialize connection diagram module",c)}const Sd=document.getElementById("cameraProjectLegendIcon");Sd&&applyIconGlyph&&cc.camera&&applyIconGlyph(Sd,cc.camera),document.getElementById("generateOverviewBtn");const ai=["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI"];function Ed(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{Array.isArray(f.fizConnectors)&&f.fizConnectors.forEach(p=>{p&&p.type&&c.add(p.type)})}),Array.from(c).sort(localeSort)}let Js=Ed();function dc(){Js=Ed(),document.querySelectorAll(".fiz-connector-select").forEach(c=>{const f=c.value;c.innerHTML="",Js.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),Js.includes(f)&&(c.value=f)})}function Cd(){const c=new Set;return Object.values(devices.fiz?.motors||{}).forEach(f=>{f&&f.fizConnector&&c.add(f.fizConnector)}),Array.from(c).filter(Boolean).sort(localeSort)}let fc=Cd();function pc(){if(fc=Cd(),mi){const c=mi.value;mi.innerHTML="",fc.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,mi.appendChild(p)}),fc.includes(c)&&(mi.value=c)}}function Ad(){const c=new Set;return Object.values(devices.fiz?.controllers||{}).forEach(f=>{f&&Array.isArray(f.fizConnectors)&&f.fizConnectors.forEach(p=>{p&&p.type&&c.add(p.type)})}),Array.from(c).filter(Boolean).sort(localeSort)}function vd(){const c=new Set;return Object.values(devices.fiz?.controllers||{}).forEach(f=>{f&&f.powerSource&&c.add(f.powerSource)}),Array.from(c).filter(Boolean).sort(localeSort)}function Ld(){const c=new Set;return Object.values(devices.fiz?.controllers||{}).forEach(f=>{f&&f.batteryType&&c.add(f.batteryType)}),Array.from(c).filter(Boolean).sort(localeSort)}function Rd(){const c=new Set;return Object.values(devices.fiz?.controllers||{}).forEach(f=>{f&&f.connectivity&&c.add(f.connectivity)}),Array.from(c).filter(Boolean).sort(localeSort)}let mc=Ad(),gc=vd(),yc=Ld(),hc=Rd();function Od(){if(mc=Ad(),gi){const c=gi.value;gi.innerHTML="",mc.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,gi.appendChild(p)}),mc.includes(c)&&(gi.value=c)}}function wd(){if(gc=vd(),yi){const c=yi.value;yi.innerHTML="",gc.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,yi.appendChild(p)}),gc.includes(c)&&(yi.value=c)}}function Td(){if(yc=Ld(),hi){const c=hi.value;hi.innerHTML="",yc.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,hi.appendChild(p)}),yc.includes(c)&&(hi.value=c)}}function Gd(){if(hc=Rd(),bi){const c=bi.value;bi.innerHTML="",hc.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,bi.appendChild(p)}),hc.includes(c)&&(bi.value=c)}}function _d(){const c=new Set;return Object.values(devices.fiz?.distance||{}).forEach(f=>{f&&f.connectionCompatibility&&c.add(f.connectionCompatibility)}),Array.from(c).filter(Boolean).sort(localeSort)}function Id(){const c=new Set;return Object.values(devices.fiz?.distance||{}).forEach(f=>{f&&f.measurementMethod&&c.add(f.measurementMethod)}),Array.from(c).filter(Boolean).sort(localeSort)}function Pd(){const c=new Set;return Object.values(devices.fiz?.distance||{}).forEach(f=>{f&&f.outputDisplay&&c.add(f.outputDisplay)}),Array.from(c).filter(Boolean).sort(localeSort)}let bc=_d(),Sc=Id(),Ec=Pd();function Cc(){if(bc=_d(),Si){const c=Si.value;Si.innerHTML="",bc.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,Si.appendChild(p)}),bc.includes(c)&&(Si.value=c)}}function Ac(){if(Sc=Id(),Ei){const c=Ei.value;Ei.innerHTML="",Sc.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,Ei.appendChild(p)}),Sc.includes(c)&&(Ei.value=c)}}function vc(){if(Ec=Pd(),Ai){const c=Ai.value;Ai.innerHTML="",Ec.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,Ai.appendChild(p)}),Ec.includes(c)&&(Ai.value=c)}}var ii=null,el=0;function Lc(c,f){if(!c)return"";if(c.id)return c.id;var p=typeof f=="string"&&f?f:"field",g=p.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");g||(g="field"),el+=1;var S=g+"-"+el;if(typeof document<"u"&&document&&typeof document.getElementById=="function")for(;document.getElementById(S);)el+=1,S=g+"-"+el;return c.id=S,S}function fm(){if(ii&&typeof ii=="function")return ii;var c=typeof ensureElementId=="function"?ensureElementId:null;if(!c&&typeof globalThis<"u"&&globalThis){var f=globalThis.ensureElementId;typeof f=="function"&&(c=f)}if(typeof c=="function")return ii=c,ii;if(ii=Lc,typeof globalThis<"u"&&globalThis&&typeof globalThis.ensureElementId!="function")try{globalThis.ensureElementId=Lc}catch{}return ii}function pm(){return typeof createHiddenLabel=="function"?createHiddenLabel:typeof globalThis<"u"&&globalThis&&typeof globalThis.createHiddenLabel=="function"?globalThis.createHiddenLabel:function(f,p){var g=document.createElement("label");return g.className="visually-hidden",f&&g.setAttribute("for",f),g.textContent=typeof p=="string"?p:"",g}}function Hr(c,f){const p=document.createElement("div");p.className="field-with-label",p.dataset.label=f;const g=fm(),S=typeof g=="function"?g(c,f):Lc(c,f),L=pm()(S,f);return p.appendChild(L),p.appendChild(c),p}function Dn(c,f="type"){return Array.isArray(c)?c.filter(p=>{if(typeof p=="string")return p&&p!=="None";if(p&&Object.prototype.hasOwnProperty.call(p,f)){const g=p[f];return g!=null&&g!==""&&g!=="None"}return!0}):[]}function Rc(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="video-output-select",p.name="videoOutput",ai.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["videoOutputsHeading",["cameraVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after(Rc())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["videoOutputsHeading",["cameraVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"removeEntry"}),S.addEventListener("click",()=>{videoOutputsContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function Oc(c){if(!videoOutputsContainer)return;videoOutputsContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type;videoOutputsContainer.appendChild(Rc(g))}):videoOutputsContainer.appendChild(Rc())}function mm(){return Array.from(videoOutputsContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None")}function gm(){Oc([])}function wc(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="monitor-video-input-select",p.name="monitorVideoInput",ai.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["monitorVideoInputsHeading",["monitorVideoInputsLabel"]],fallbackContext:"Video Inputs",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after(wc())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["monitorVideoInputsHeading",["monitorVideoInputsLabel"]],fallbackContext:"Video Inputs",actionKey:"removeEntry"}),S.addEventListener("click",()=>{monitorVideoInputsContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function Tc(c){if(!monitorVideoInputsContainer)return;monitorVideoInputsContainer.innerHTML="";const f=Dn(c,"type");f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type||p.portType;monitorVideoInputsContainer.appendChild(wc(g))}):monitorVideoInputsContainer.appendChild(wc())}function ym(){return Array.from(monitorVideoInputsContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None")}function Gc(){Tc([])}function _c(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="monitor-video-output-select",p.name="monitorVideoOutput",ai.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["monitorVideoOutputsHeading",["monitorVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after(_c())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["monitorVideoOutputsHeading",["monitorVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"removeEntry"}),S.addEventListener("click",()=>{monitorVideoOutputsContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function Ic(c){if(!monitorVideoOutputsContainer)return;monitorVideoOutputsContainer.innerHTML="";const f=Dn(c,"type");f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type||p.portType;monitorVideoOutputsContainer.appendChild(_c(g))}):monitorVideoOutputsContainer.appendChild(_c())}function hm(){return Array.from(monitorVideoOutputsContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None")}function Bd(){Ic([])}function Pc(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="viewfinder-video-input-select",p.name="viewfinderVideoInput",ai.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["viewfinderVideoInputsHeading",["viewfinderVideoInputsLabel"]],fallbackContext:"Video Inputs",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after(Pc())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["viewfinderVideoInputsHeading",["viewfinderVideoInputsLabel"]],fallbackContext:"Video Inputs",actionKey:"removeEntry"}),S.addEventListener("click",()=>{viewfinderVideoInputsContainer&&viewfinderVideoInputsContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function tl(c){if(!viewfinderVideoInputsContainer)return;viewfinderVideoInputsContainer.innerHTML="";const f=Dn(c,"type");f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type||p.portType;viewfinderVideoInputsContainer.appendChild(Pc(g))}):viewfinderVideoInputsContainer.appendChild(Pc())}function bm(){return viewfinderVideoInputsContainer?Array.from(viewfinderVideoInputsContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None"):[]}function Md(){tl([])}function Bc(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="viewfinder-video-output-select",p.name="viewfinderVideoOutput",ai.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["viewfinderVideoOutputsHeading",["viewfinderVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after(Bc())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["viewfinderVideoOutputsHeading",["viewfinderVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"removeEntry"}),S.addEventListener("click",()=>{viewfinderVideoOutputsContainer&&viewfinderVideoOutputsContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function ol(c){if(!viewfinderVideoOutputsContainer)return;viewfinderVideoOutputsContainer.innerHTML="";const f=Dn(c,"type");f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type||p.portType;viewfinderVideoOutputsContainer.appendChild(Bc(g))}):viewfinderVideoOutputsContainer.appendChild(Bc())}function Sm(){return viewfinderVideoOutputsContainer?Array.from(viewfinderVideoOutputsContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None"):[]}function Em(){ol([])}tl([]),ol([]);const kd=(function(){if(typeof require=="function")try{const f=require("./modules/video-power-inputs.js");if(f&&typeof f.normalizePowerInputList=="function")return f}catch{}return{}})();let rl=null;function Mc(){if(rl&&typeof rl.querySelector=="function")return rl;let c=null;if(typeof qi<"u"&&qi&&(c=qi),!c&&typeof document<"u"&&(c=document.getElementById("videoPowerInputsContainer")),c){if(rl=c,typeof qi<"u")qi=c;else if(typeof globalThis<"u")try{globalThis.videoPowerInputsContainer=c}catch{}}return c}let qn=[];function Cm(){if(!qn||qn.length===0)try{qn=uc()}catch{qn=[]}return qn}function ss(c,f){const p=typeof Zr=="function"?Zr(currentLang):texts?.[currentLang],g=typeof Zr=="function"?Zr("en"):texts?.en;return p&&p[c]||g&&g[c]||f}function Am(c){if(!c)return[];const f=[],p=g=>{if(!g)return;const E=((Array.isArray(g.type)?g.type:[g.type||g.portType||g.connectorType])||[]).filter(q=>typeof q=="string"&&q.trim()).map(q=>q.trim()),L=typeof g.voltageRange=="string"?g.voltageRange:"",P=typeof g.notes=="string"?g.notes:"";if(!E.length&&!L&&!P)return;const D={type:E};L&&(D.voltageRange=L),P&&(D.notes=P),f.push(D)};return Array.isArray(c)?c.forEach(p):typeof c=="string"&&c.trim()?p({type:c.trim()}):typeof c=="object"&&p(c),f}const vm=typeof kd.normalizePowerInputList=="function"?kd.normalizePowerInputList:Am;function kc(c={}){const f=Cm(),p=Array.isArray(c.type)?c.type.filter(Boolean):[],g=p.length?p[0]:"",S=typeof c.voltageRange=="string"?c.voltageRange:"",E=typeof c.notes=="string"?c.notes:"",L=document.createElement("div");L.className="form-row video-power-row";const P=document.createElement("select");if(P.className="video-power-type-select",P.name="videoPowerType",f.forEach(te=>{const ye=document.createElement("option");ye.value=te,ye.textContent=te,P.appendChild(ye)}),g&&!f.includes(g)){const te=document.createElement("option");te.value=g,te.textContent=g,P.appendChild(te)}if(P.value=g,P.dataset.originalValue=g,p.length)try{L.dataset.originalTypeValues=JSON.stringify(p)}catch{}P.addEventListener("change",()=>{if(L)if(P.value===P.dataset.originalValue&&p.length)try{L.dataset.originalTypeValues=JSON.stringify(p)}catch{delete L.dataset.originalTypeValues}else delete L.dataset.originalTypeValues}),L.appendChild(Hr(P,ss("videoPowerTypeLabel","Connector")));const D=document.createElement("input");D.type="text",D.className="video-power-voltage-input",D.value=S,D.placeholder=ss("videoPowerVoltagePlaceholder","Voltage range (e.g. 6-28V)"),L.appendChild(Hr(D,ss("videoPowerVoltageLabel","Voltage range")));const q=document.createElement("input");q.type="text",q.className="video-power-notes-input",q.value=E,q.placeholder=ss("videoPowerNotesPlaceholder","Notes (mount, adapter, etc.)"),L.appendChild(Hr(q,ss("videoPowerNotesLabel","Notes")));const ie=document.createElement("button");ie.type="button",pr(ie,ICON_GLYPHS.add,{contextPaths:["videoPowerInputsHeading",["videoPowerInputLabel"]],fallbackContext:"Power Inputs",actionKey:"addEntry"}),ie.addEventListener("click",()=>{L.after(kc())}),L.appendChild(ie);const se=document.createElement("button");return se.type="button",pr(se,ICON_GLYPHS.minus,{contextPaths:["videoPowerInputsHeading",["videoPowerInputLabel"]],fallbackContext:"Power Inputs",actionKey:"removeEntry"}),se.addEventListener("click",()=>{const te=Mc();te&&te.children.length>1&&L.remove()}),L.appendChild(se),L}function Dc(c){const f=Mc();if(!f)return;f.innerHTML="";const p=vm(c);p.length?p.forEach(g=>{f.appendChild(kc(g))}):f.appendChild(kc())}function Lm(){const c=Mc();if(!c)return;const p=Array.from(c.querySelectorAll(".video-power-row")).map(g=>{const S=g.querySelector(".video-power-type-select");if(!S)return null;const E=g.dataset.originalTypeValues;let L;if(E&&S.value===(S.dataset.originalValue||""))try{const te=JSON.parse(E);Array.isArray(te)&&te.length&&(L=te.filter(ye=>typeof ye=="string"&&ye.trim()))}catch{L=void 0}if((!L||!L.length)&&(typeof S.value=="string"&&S.value&&S.value!=="None"?L=[S.value]:L=[]),!L.length)return null;const P=g.querySelector(".video-power-voltage-input"),D=g.querySelector(".video-power-notes-input"),q=P&&typeof P.value=="string"?P.value.trim():"",ie=D&&typeof D.value=="string"?D.value.trim():"",se={type:L.slice()};return q&&(se.voltageRange=q),ie&&(se.notes=ie),se}).filter(Boolean);if(p.length)return p.length===1?p[0]:p}function Dd(){Dc([])}function xc(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="video-input-select",p.name="videoInput",ai.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["videoVideoInputsHeading",["videoVideoInputsLabel"]],fallbackContext:"Video Inputs",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after(xc())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["videoVideoInputsHeading",["videoVideoInputsLabel"]],fallbackContext:"Video Inputs",actionKey:"removeEntry"}),S.addEventListener("click",()=>{videoVideoInputsContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function xd(c){videoVideoInputsContainer.innerHTML="";const f=Dn(c,"type");f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type||p.portType;videoVideoInputsContainer.appendChild(xc(g))}):videoVideoInputsContainer.appendChild(xc())}function Rm(){return Array.from(videoVideoInputsContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None")}function $d(){xd([])}function $c(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="video-output-select-io",p.name="videoIOOutput",ai.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["videoVideoOutputsHeading",["videoVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after($c())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["videoVideoOutputsHeading",["videoVideoOutputsLabel"]],fallbackContext:"Video Outputs",actionKey:"removeEntry"}),S.addEventListener("click",()=>{videoVideoOutputsContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function Nd(c){videoVideoOutputsContainer.innerHTML="";const f=Dn(c,"type");f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type||p.portType;videoVideoOutputsContainer.appendChild($c(g))}):videoVideoOutputsContainer.appendChild($c())}function Om(){return Array.from(videoVideoOutputsContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None")}function Fd(){Nd([])}function Nc(c=""){const f=document.createElement("div");f.className="form-row";const p=document.createElement("select");p.className="fiz-connector-select",p.name="fizConnector",Js.forEach(E=>{const L=document.createElement("option");L.value=E,L.textContent=E,p.appendChild(L)}),p.value=c,f.appendChild(Hr(p,"Type"));const g=document.createElement("button");g.type="button",pr(g,ICON_GLYPHS.add,{contextPaths:["fizConnectorHeading",["cameraFIZConnectorLabel"]],fallbackContext:"FIZ Connector",actionKey:"addEntry"}),g.addEventListener("click",()=>{f.after(Nc())}),f.appendChild(g);const S=document.createElement("button");return S.type="button",pr(S,ICON_GLYPHS.minus,{contextPaths:["fizConnectorHeading",["cameraFIZConnectorLabel"]],fallbackContext:"FIZ Connector",actionKey:"removeEntry"}),S.addEventListener("click",()=>{fizConnectorContainer.children.length>1&&f.remove()}),f.appendChild(S),f}function Fc(c){if(!fizConnectorContainer)return;fizConnectorContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const g=typeof p=="string"?p:p.type;fizConnectorContainer.appendChild(Nc(g))}):fizConnectorContainer.appendChild(Nc())}function wm(){return Array.from(fizConnectorContainer.querySelectorAll("select")).map(c=>({type:c.value})).filter(c=>c.type&&c.type!=="None")}function Tm(){Fc([])}function Ud(){const c=cameraSelect&&typeof cameraSelect.value=="string"?cameraSelect.value.trim():"",f=c==="None"?"":c,p=f&&devices&&devices.cameras?devices.cameras[f]:null,S=Array.isArray(p?.recordingMedia)&&p.recordingMedia.length>0?[p]:Object.values(devices?.cameras||{}),E=new Set;return S.forEach(L=>{!L||!Array.isArray(L.recordingMedia)||L.recordingMedia.forEach(P=>{if(!P)return;const D=typeof P=="string"?P:P.type;D&&E.add(D)})}),Array.from(E).sort(localeSort)}let ls=Ud();function Gm(){const c=texts?.en&&texts.en.projectForm||{},p=(texts?.[currentLang]&&texts[currentLang].projectForm||c).storageTypePlaceholder||c.storageTypePlaceholder||"Select media type";return(typeof p=="string"?p.trim():"")||"Select media type"}function Hd(c){if(!c)return;const f=document.createElement("option");f.value="",f.textContent=Gm(),f.dataset.placeholder="true",c.appendChild(f)}function nl(){ls=Ud(),document.querySelectorAll(".recording-media-select").forEach(c=>{const f=c.value;if(c.innerHTML="",Hd(c),ls.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),ls.includes(f))c.value=f;else if(f&&f!=="None"){const p=document.createElement("option");p.value=f,p.textContent=f,p.dataset.extraOption="true",c.appendChild(p),c.value=f}else c.value=""})}function Uc(c="",f="",p=""){const g=document.createElement("div");g.className="form-row";const S=document.createElement("select");if(S.className="recording-media-select",S.name="recordingMediaType",Hd(S),ls.forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,S.appendChild(ve)}),c){if(!ls.includes(c)){const ye=document.createElement("option");ye.value=c,ye.textContent=c,S.appendChild(ye)}S.value=c}else S.value="";g.appendChild(Hr(S,"Type"));const E=typeof devices<"u"&&devices.recordingMediaBrands||[],L=typeof devices<"u"&&devices.recordingMediaSizes||[],P=f||"",D=document.createElement("select");if(D.className="recording-media-brand-select",D.name="recordingMediaBrand",E.forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,D.appendChild(ve)}),p&&!E.includes(p)){const ye=document.createElement("option");ye.value=p,ye.textContent=p,ye.dataset.custom="true",D.appendChild(ye)}D.value=p,g.appendChild(Hr(D,"Brand"));const q=document.createElement("select");if(q.className="recording-media-size-select",q.name="recordingMediaSize",L.forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,q.appendChild(ve)}),P&&!L.includes(P)){const ye=document.createElement("option");ye.value=P,ye.textContent=P,ye.dataset.custom="true",q.appendChild(ye)}q.value=P,g.appendChild(Hr(q,"Size"));const ie=document.createElement("input");ie.type="text",ie.placeholder="Extra details...",ie.className="recording-media-extra-notes",g.appendChild(Hr(ie,"Notes"));const se=document.createElement("button");se.type="button",pr(se,ICON_GLYPHS.add,{contextPaths:["mediaHeading",["cameraMediaLabel"]],fallbackContext:"Recording Media",actionKey:"addEntry"}),se.addEventListener("click",()=>{g.after(Uc())}),g.appendChild(se);const te=document.createElement("button");return te.type="button",pr(te,ICON_GLYPHS.minus,{contextPaths:["mediaHeading",["cameraMediaLabel"]],fallbackContext:"Recording Media",actionKey:"removeEntry"}),te.addEventListener("click",()=>{cameraMediaContainer.children.length>1&&g.remove()}),g.appendChild(te),g}const cs=c=>{if(!cameraMediaContainer)return;cameraMediaContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const{type:g="",notes:S="",brand:E=""}=p||{};cameraMediaContainer.appendChild(Uc(g,S,E))}):cameraMediaContainer.appendChild(Uc())};z("setRecordingMedia",cs);function us(){return Array.from(cameraMediaContainer.querySelectorAll(".form-row")).map(c=>{const f=c.querySelector(".recording-media-select"),p=c.querySelector(".recording-media-brand-select"),g=c.querySelector(".recording-media-size-select"),S=c.querySelector(".recording-media-extra-notes");if(!f)return null;const E=f.value,L=p?p.value:"",P=g?g.value:"",D=S?S.value:"";let q=P;return D&&(q=q?q+" "+D:D),{type:E,brand:L,notes:q}}).filter(c=>c&&c.type&&c.type!=="None")}z("getRecordingMedia",us),z("updateRecordingMediaOptions",nl);function al(){cs([])}qn=uc(),Dc([]);function jd(){if(typeof Za>"u"||!Za)return;qn=uc();const c=Za.value;if(Za.innerHTML="",qn.forEach(f=>{const p=document.createElement("option");p.value=f,p.textContent=f,Za.appendChild(p)}),qn.includes(c)&&(Za.value=c),Ci){const f=Ci.value;Ci.innerHTML="",qn.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,Ci.appendChild(g)}),qn.includes(f)&&(Ci.value=f)}typeof document<"u"&&document.querySelectorAll(".video-power-type-select").forEach(f=>{const p=f.value;if(f.innerHTML="",qn.forEach(g=>{const S=document.createElement("option");S.value=g,S.textContent=g,f.appendChild(S)}),p&&!qn.includes(p)){const g=document.createElement("option");g.value=p,g.textContent=p,f.appendChild(g)}f.value=p})}function Vd(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{const p=f.power?.batteryPlateSupport;Array.isArray(p)&&p.forEach(g=>{g&&g.type&&c.add(g.type)})}),Array.from(c).sort(localeSort)}let ds=Vd();function zd(){ds=Vd(),document.querySelectorAll(".battery-plate-type-select").forEach(c=>{const f=c.value;c.innerHTML="",ds.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),ds.includes(f)&&(c.value=f)})}function Hc(c="",f="native",p=""){const g=document.createElement("div");g.className="form-row";const S=document.createElement("select");if(S.className="battery-plate-type-select",S.name="batteryPlateType",ds.forEach(q=>{const ie=document.createElement("option");ie.value=q,ie.textContent=q,S.appendChild(ie)}),c&&!ds.includes(c)){const q=document.createElement("option");q.value=c,q.textContent=c,S.appendChild(q)}S.value=c,g.appendChild(Hr(S,"Type"));const E=document.createElement("select");E.name="batteryPlateMount",["native","adapted"].forEach(q=>{const ie=document.createElement("option");ie.value=q,ie.textContent=q,E.appendChild(ie)}),E.value=f||"",g.appendChild(Hr(E,"Mount"));const L=document.createElement("input");L.type="text",L.placeholder="Notes",L.value=p,L.name="batteryPlateNotes",g.appendChild(Hr(L,"Notes"));const P=document.createElement("button");P.type="button",pr(P,ICON_GLYPHS.add,{contextPaths:["cameraPlatesLabel",["powerInputsHeading"]],fallbackContext:"Battery Plates",actionKey:"addEntry"}),P.addEventListener("click",()=>{g.after(Hc())}),g.appendChild(P);const D=document.createElement("button");return D.type="button",pr(D,ICON_GLYPHS.minus,{contextPaths:["cameraPlatesLabel",["powerInputsHeading"]],fallbackContext:"Battery Plates",actionKey:"removeEntry"}),D.addEventListener("click",()=>{batteryPlatesContainer.children.length>1&&g.remove()}),g.appendChild(D),g}const Ti=c=>{if(!batteryPlatesContainer)return;batteryPlatesContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const{type:g="",mount:S="native",notes:E=""}=p||{};batteryPlatesContainer.appendChild(Hc(g,S,E))}):batteryPlatesContainer.appendChild(Hc())};z("setBatteryPlates",Ti),Me("setBatteryPlates",Ti);function Gi(){return Array.from(batteryPlatesContainer.querySelectorAll(".form-row")).map(c=>{const[f,p,g]=c.querySelectorAll("select, input");return{type:f.value,mount:p.value,notes:g.value}}).filter(c=>c.type&&c.type!=="None")}z("getBatteryPlates",Gi),Me("getBatteryPlates",Gi);function qd(){Ti([])}typeof window<"u"&&(window.clearBatteryPlates=qd);function _i(){if(!batterySelect||!batteryPlatesContainer)return;const c=batterySelect.value,f=(devices.batteries||{})[c];f&&(f.mount==="gold-mount"||f.mount==="v-mount")?(batteryPlatesContainer.closest(".form-section")?.removeAttribute("hidden"),batteryPlatesContainer.removeAttribute("hidden")):(batteryPlatesContainer.closest(".form-section")?.setAttribute("hidden",""),batteryPlatesContainer.setAttribute("hidden",""))}z("updateBatteryPlateVisibility",_i),Me("updateBatteryPlateVisibility",_i);function Ii(){typeof _i=="function"&&_i()}z("updateBatteryOptions",Ii),Me("updateBatteryOptions",Ii);function _m(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{Array.isArray(f.viewfinder)&&f.viewfinder.forEach(p=>{p&&p.type&&c.add(p.type)})}),Array.from(c).sort(localeSort)}function Im(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{Array.isArray(f.viewfinder)&&f.viewfinder.forEach(p=>{p&&p.connector&&c.add(p.connector)})}),Array.from(c).filter(f=>f).sort(localeSort)}var Kd=_m(),Wd=Im();function jc(c="",f="",p="",g=""){const S=document.createElement("div");S.className="form-row";const E=document.createElement("select");if(E.className="viewfinder-type-select",E.name="viewfinderType",Kd.forEach(se=>{const te=document.createElement("option");te.value=se,te.textContent=se,E.appendChild(te)}),c&&!Kd.includes(c)){const se=document.createElement("option");se.value=c,se.textContent=c,E.appendChild(se)}E.value=c,S.appendChild(Hr(E,"Type"));const L=document.createElement("input");L.type="text",L.placeholder="Resolution",L.value=f,L.name="viewfinderResolution",S.appendChild(Hr(L,"Resolution"));const P=document.createElement("select");if(P.className="viewfinder-connector-select",P.name="viewfinderConnector",Wd.forEach(se=>{const te=document.createElement("option");te.value=se,te.textContent=se,P.appendChild(te)}),p&&!Wd.includes(p)){const se=document.createElement("option");se.value=p,se.textContent=p,P.appendChild(se)}P.value=p,S.appendChild(Hr(P,"Connector"));const D=document.createElement("input");D.type="text",D.placeholder="Notes",D.value=g,D.name="viewfinderNotes",S.appendChild(Hr(D,"Notes"));const q=document.createElement("button");q.type="button",pr(q,ICON_GLYPHS.add,{contextPaths:["viewfinderHeading",["cameraViewfinderLabel"]],fallbackContext:"Viewfinder",actionKey:"addEntry"}),q.addEventListener("click",()=>{S.after(jc())}),S.appendChild(q);const ie=document.createElement("button");return ie.type="button",pr(ie,ICON_GLYPHS.minus,{contextPaths:["viewfinderHeading",["cameraViewfinderLabel"]],fallbackContext:"Viewfinder",actionKey:"removeEntry"}),ie.addEventListener("click",()=>{viewfinderContainer.children.length>1&&S.remove()}),S.appendChild(ie),S}function Yd(c){if(!viewfinderContainer)return;viewfinderContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const{type:g="",resolution:S="",connector:E="",notes:L=""}=p||{};viewfinderContainer.appendChild(jc(g,S,E,L))}):viewfinderContainer.appendChild(jc())}function Qd(){return Array.from(viewfinderContainer.querySelectorAll(".form-row")).map(c=>{const[f,p,g,S]=c.querySelectorAll("select, input");return{type:f.value,resolution:p.value,connector:g.value,notes:S.value}}).filter(c=>c.type&&c.type!=="None")}function Pm(){Yd([])}function Xd(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{Array.isArray(f.lensMount)&&f.lensMount.forEach(p=>{p&&p.type&&c.add(p.type)})}),Object.values(devices.lenses||{}).forEach(f=>{if(!f)return;Array.isArray(f.mountOptions)&&f.mountOptions.forEach(g=>{g&&g.type&&c.add(g.type)});const p=typeof f.mount=="string"?f.mount.trim():"";p&&c.add(p)}),Array.from(c).sort(localeSort)}let fs=Xd();function il(){fs=Xd(),document.querySelectorAll(".lens-mount-type-select").forEach(c=>{const f=c.value;c.innerHTML="",fs.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),fs.includes(f)&&(c.value=f)})}function sl(c="",f="native",p){const g=document.createElement("div");g.className="form-row";const S=document.createElement("select");if(S.className="lens-mount-type-select",S.name="lensMountType",fs.forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,S.appendChild(ve)}),c&&!fs.includes(c)){const ye=document.createElement("option");ye.value=c,ye.textContent=c,S.appendChild(ye)}S.value=c||"",g.appendChild(Hr(S,"Type"));const E=document.createElement("select");E.name="lensMount",["native","adapted"].forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,E.appendChild(ve)}),E.value=f||"native",g.appendChild(Hr(E,"Mount"));const L=document.createElement("button");L.type="button";const P=p?.headingId||"lensMountHeading",D=p?.labelId||"cameraLensMountLabel",q=p?.fallbackContext||"Lens Mount",ie=p?.container||lensMountContainer,se=Number.isFinite(p?.minRows)?p.minRows:1;pr(L,ICON_GLYPHS.add,{contextPaths:[P,[D]],fallbackContext:q,actionKey:"addEntry"}),L.addEventListener("click",()=>{const ye=sl("","native",p);ie?g.nextSibling?ie.insertBefore(ye,g.nextSibling):ie.appendChild(ye):g.after(ye)}),g.appendChild(L);const te=document.createElement("button");return te.type="button",pr(te,ICON_GLYPHS.minus,{contextPaths:[P,[D]],fallbackContext:q,actionKey:"removeEntry"}),te.addEventListener("click",()=>{const ye=ie||g.parentElement;if(!ye)return;const ve=se<1?1:se;ye.children.length>ve&&g.remove()}),g.appendChild(te),g}function ll(c){if(!lensMountContainer)return;lensMountContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const{type:g="",mount:S="native"}=p||{};lensMountContainer.appendChild(sl(g,S))}):lensMountContainer.appendChild(sl())}z("setLensMounts",ll);function Zd(){return Array.from(lensMountContainer.querySelectorAll(".form-row")).map(c=>{const[f,p]=c.querySelectorAll("select");return{type:f.value,mount:p.value}}).filter(c=>c.type&&c.type!=="None")}z("getLensMounts",Zd);function Vc(){ll([])}function Bm(){return{container:lensMountOptionsContainer,headingId:"lensDeviceMountHeading",labelId:"lensDeviceMountLabel",fallbackContext:"Lens Mount",minRows:1}}function Jd(c,f=""){if(!lensMountOptionsContainer)return;lensMountOptionsContainer.innerHTML="";const p=Array.isArray(c)?Dn(c):[],g=p.length?p.slice():[],S=typeof f=="string"?f.trim():"";!g.length&&S&&g.push({type:S,mount:"native"}),g.length||g.push({type:"",mount:"native"});const E=Bm();g.forEach(L=>{const P=L&&typeof L.type=="string"?L.type:"",D=L&&typeof L.mount=="string"?L.mount:"native";lensMountOptionsContainer.appendChild(sl(P,D,E))}),il()}function Mm(){return lensMountOptionsContainer?Array.from(lensMountOptionsContainer.querySelectorAll(".form-row")).map(c=>{const f=c?c.querySelectorAll("select"):null;if(!f||f.length<2)return null;const p=(f[0].value||"").trim();if(!p)return null;const g=(f[1].value||"").trim().toLowerCase();return{type:p,mount:g==="adapted"?"adapted":"native"}}).filter(Boolean):[]}function km(){Jd([])}function ef(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{const p=f.power?.powerDistributionOutputs;Array.isArray(p)&&p.forEach(g=>{g&&g.type&&c.add(g.type)})}),Array.from(c).sort(localeSort)}let ps=ef();function tf(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{const p=f.power?.powerDistributionOutputs;Array.isArray(p)&&p.forEach(g=>{g&&g.voltage&&c.add(g.voltage)})}),Array.from(c).filter(f=>f).sort(localeSort)}function of(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{const p=f.power?.powerDistributionOutputs;Array.isArray(p)&&p.forEach(g=>{g&&g.current&&c.add(g.current)})}),Array.from(c).filter(f=>f).sort(localeSort)}let ms=tf(),gs=of();function rf(){ms=tf(),document.querySelectorAll(".power-dist-voltage-select").forEach(c=>{const f=c.value;c.innerHTML="",ms.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),ms.includes(f)&&(c.value=f)})}function nf(){gs=of(),document.querySelectorAll(".power-dist-current-select").forEach(c=>{const f=c.value;c.innerHTML="",gs.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),gs.includes(f)&&(c.value=f)})}function af(){ps=ef(),document.querySelectorAll(".power-dist-type-select").forEach(c=>{const f=c.value;c.innerHTML="",ps.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),ps.includes(f)&&(c.value=f)})}function zc(c="",f="",p="",g="",S=""){const E=document.createElement("div");E.className="form-row";const L=document.createElement("select");if(L.className="power-dist-type-select",L.name="powerDistType",ps.forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,L.appendChild(ve)}),c&&!ps.includes(c)){const ye=document.createElement("option");ye.value=c,ye.textContent=c,L.appendChild(ye)}L.value=c,E.appendChild(Hr(L,"Type"));const P=document.createElement("select");if(P.className="power-dist-voltage-select",P.name="powerDistVoltage",ms.forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,P.appendChild(ve)}),f&&!ms.includes(f)){const ye=document.createElement("option");ye.value=f,ye.textContent=f,P.appendChild(ye)}P.value=f,E.appendChild(Hr(P,"Voltage"));const D=document.createElement("select");if(D.className="power-dist-current-select",D.name="powerDistCurrent",gs.forEach(ye=>{const ve=document.createElement("option");ve.value=ye,ve.textContent=ye,D.appendChild(ve)}),p&&!gs.includes(p)){const ye=document.createElement("option");ye.value=p,ye.textContent=p,D.appendChild(ye)}D.value=p,E.appendChild(Hr(D,"Current"));const q=document.createElement("input");q.type="number",q.step="0.1",q.placeholder="W",q.value=g??"",q.name="powerDistWatt",E.appendChild(Hr(q,"W"));const ie=document.createElement("input");ie.type="text",ie.placeholder="Notes",ie.value=S,ie.name="powerDistNotes",E.appendChild(Hr(ie,"Notes"));const se=document.createElement("button");se.type="button",pr(se,ICON_GLYPHS.add,{contextPaths:["powerDistributionHeading",["cameraPowerDistLabel"]],fallbackContext:"Power Distribution",actionKey:"addEntry"}),se.addEventListener("click",()=>{E.after(zc())}),E.appendChild(se);const te=document.createElement("button");return te.type="button",pr(te,ICON_GLYPHS.minus,{contextPaths:["powerDistributionHeading",["cameraPowerDistLabel"]],fallbackContext:"Power Distribution",actionKey:"removeEntry"}),te.addEventListener("click",()=>{powerDistContainer.children.length>1&&E.remove()}),E.appendChild(te),E}function qc(c){if(typeof powerDistContainer>"u"||!powerDistContainer)return;powerDistContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const{type:g="",voltage:S="",current:E="",wattage:L="",notes:P=""}=p||{};powerDistContainer.appendChild(zc(g,S,E,L,P))}):powerDistContainer.appendChild(zc())}function Dm(){return Array.from(powerDistContainer.querySelectorAll(".form-row")).map(c=>{const[f,p,g,S,E]=c.querySelectorAll("select, input");return{type:f.value,voltage:p.value,current:g.value,wattage:S.value?parseFloat(S.value):null,notes:E.value}}).filter(c=>c.type&&c.type!=="None")}function xm(){qc([])}function sf(){const c=new Set;return Object.values(devices.cameras||{}).forEach(f=>{const p=f.timecode;Array.isArray(p)&&p.forEach(g=>{g&&g.type&&c.add(g.type)})}),Array.from(c).sort(localeSort)}let ys=sf();function lf(){ys=sf(),document.querySelectorAll(".timecode-type-select").forEach(c=>{const f=c.value;c.innerHTML="",ys.forEach(p=>{const g=document.createElement("option");g.value=p,g.textContent=p,c.appendChild(g)}),ys.includes(f)&&(c.value=f)})}function Kc(c="",f=""){const p=document.createElement("div");p.className="form-row";const g=document.createElement("select");if(g.className="timecode-type-select",g.name="timecodeType",ys.forEach(P=>{const D=document.createElement("option");D.value=P,D.textContent=P,g.appendChild(D)}),c&&!ys.includes(c)){const P=document.createElement("option");P.value=c,P.textContent=c,g.appendChild(P)}g.value=c,p.appendChild(Hr(g,"Type"));const S=document.createElement("input");S.type="text",S.placeholder="Notes",S.value=f,S.name="timecodeNotes",p.appendChild(Hr(S,"Notes"));const E=document.createElement("button");E.type="button",pr(E,ICON_GLYPHS.add,{contextPaths:["timecodeHeading",["cameraTimecodeLabel"]],fallbackContext:"Timecode",actionKey:"addEntry"}),E.addEventListener("click",()=>{p.after(Kc())}),p.appendChild(E);const L=document.createElement("button");return L.type="button",pr(L,ICON_GLYPHS.minus,{contextPaths:["timecodeHeading",["cameraTimecodeLabel"]],fallbackContext:"Timecode",actionKey:"removeEntry"}),L.addEventListener("click",()=>{timecodeContainer.children.length>1&&p.remove()}),p.appendChild(L),p}function Wc(c){if(!timecodeContainer)return;timecodeContainer.innerHTML="";const f=Dn(c);f.length?f.forEach(p=>{const{type:g="",notes:S=""}=p||{};timecodeContainer.appendChild(Kc(g,S))}):timecodeContainer.appendChild(Kc())}function $m(){return Array.from(timecodeContainer.querySelectorAll(".form-row")).map(c=>{const[f,p]=c.querySelectorAll("select, input");return{type:f.value,notes:p.value}}).filter(c=>c.type&&c.type!=="None")}function Nm(){Wc([])}function cf(c){const f=typeof loadFavorites=="function"?loadFavorites():{};return Array.isArray(f[c])?f[c]:[]}const cl=new WeakMap,uf=new WeakMap,ul=new WeakMap;function Yc(c){if(!c||!c.id)return;const f=cf(c.id);if(!f.length)return;const p=Array.from(c.options),g=p.find(P=>P.value==="None"),S=p.filter(P=>P!==g),E=[],L=[];S.forEach(P=>f.includes(P.value)?E.push(P):L.push(P)),E.sort((P,D)=>localeSort(P.textContent,D.textContent)),L.sort((P,D)=>localeSort(P.textContent,D.textContent)),c.innerHTML="",g&&c.appendChild(g),E.forEach(P=>c.appendChild(P)),L.forEach(P=>c.appendChild(P))}function df(c){const f=cl.get(c);return f&&f.isConnected?f:null}function dl(c){if(!c)return;const f=df(c);if(!f)return;const p=cf(c.id),g=c.value,S=p.includes(g);f.innerHTML=iconMarkup(ICON_GLYPHS.star,"favorite-icon"),f.classList.toggle("favorited",S),f.disabled=g==="None",f.setAttribute("aria-pressed",S?"true":"false")}function ff(c){if(!c||!c.id)return;const f=c.value;if(f==="None")return;const p=loadFavorites(),g=Array.isArray(p[c.id])?p[c.id]:[],S=g.indexOf(f);S===-1?g.push(f):g.splice(S,1),g.length?p[c.id]=g:delete p[c.id],saveFavorites(p),Yc(c),dl(c),Pi(c)}let fl=null;function Fm(){if(fl&&fl.isConnected)return fl;const c=document.createElement("span");return c.className="gear-select-width-measure",Object.assign(c.style,{position:"absolute",visibility:"hidden",whiteSpace:"pre",pointerEvents:"none",top:"-9999px",left:"-9999px",padding:"0",margin:"0",border:"0"}),(document.body||document.documentElement).appendChild(c),fl=c,c}function Um(c,f,p){const g=f&&f.length?f:" ",S=p||window.getComputedStyle(c);if(!S)return g.length*8;const E=Fm(),L=document.body||document.documentElement;return E.parentElement!==L&&L.appendChild(E),S.font&&S.font!=="normal normal normal medium/normal serif"?E.style.font=S.font:(E.style.fontStyle=S.fontStyle||"normal",E.style.fontVariant=S.fontVariant||"normal",E.style.fontWeight=S.fontWeight||"400",E.style.fontStretch=S.fontStretch||"normal",E.style.fontSize=S.fontSize||"16px",E.style.fontFamily=S.fontFamily||"sans-serif",E.style.lineHeight=S.lineHeight||"normal"),E.style.letterSpacing=S.letterSpacing||"normal",E.style.textTransform=S.textTransform||"none",E.textContent=g,E.getBoundingClientRect().width}function Pi(c){if(!c||c.multiple||c.size>1||!c.closest("#gearListOutput, #projectRequirementsOutput"))return;const p=window.getComputedStyle(c);if(!p||p.display==="none"){c.style.removeProperty("--gear-select-width");return}const g=c.selectedOptions&&c.selectedOptions[0],S=g?g.textContent.trim():c.value||"",E=Um(c,S,p),L=parseFloat(p.paddingLeft)||0,P=parseFloat(p.paddingRight)||0,D=parseFloat(p.borderLeftWidth)||0,q=parseFloat(p.borderRightWidth)||0,ie=parseFloat(p.fontSize)||16,se=Math.max(ie*.5,10),te=Math.max(ie*4,56),ye=Math.max(Math.ceil(E+L+P+D+q+se),te);c.style.setProperty("--gear-select-width",`${ye}px`)}function pl(c){c&&c.querySelectorAll("select").forEach(f=>Pi(f))}function Hm(c){if(!c)return null;let f=c.parentElement;if(!f||!f.classList.contains("select-wrapper"))if(f&&f.tagName==="LABEL"){const p=f;f=document.createElement("div"),f.className="select-wrapper",p.parentElement.insertBefore(f,p.nextSibling),f.appendChild(c)}else f=document.createElement("div"),f.className="select-wrapper",c.insertAdjacentElement("beforebegin",f),f.appendChild(c);return f}function Qc(c){if(!c||!c.id||c.multiple||c.hidden)return;const f=Hm(c),p=c.closest(".gear-item");function g(D,q=null){if(!D)return;const ie=ul.get(D);ie&&(D.removeEventListener("click",ie),ul.delete(D)),q&&cl.get(q)===D&&cl.delete(q),D.remove()}let S=df(c);if(f){const D=Array.from(f.querySelectorAll(".favorite-toggle"));S&&!D.includes(S)&&(S=null),!S&&D.length>0&&([S]=D),D.forEach(q=>{q!==S&&g(q,c)})}p&&Array.from(p.querySelectorAll(".favorite-toggle")).filter(D=>D!==S&&D.getAttribute("data-fav-select-id")===c.id).forEach(D=>g(D)),S?f&&S.parentElement!==f&&f.appendChild(S):(S=document.createElement("button"),f?f.appendChild(S):c.after(S));const E=ul.get(S);E&&S.removeEventListener("click",E),S.type="button",S.className="favorite-toggle",S.innerHTML=iconMarkup(ICON_GLYPHS.star,"favorite-icon"),S.setAttribute("aria-pressed","false"),S.setAttribute("data-fav-select-id",c.id);const L=()=>ff(c);if(S.addEventListener("click",L),ul.set(S,L),!uf.has(c)){const D=()=>dl(c);c.addEventListener("change",D),uf.set(c,D)}cl.set(c,S),S.setAttribute("data-fav-select-id",c.id);const P=(()=>{const D=typeof texts=="object"&&texts||typeof GLOBAL_SCOPE<"u"&&GLOBAL_SCOPE&&GLOBAL_SCOPE.texts||{},q=D?.[currentLang],ie=[];typeof DEFAULT_LANGUAGE_SAFE=="string"&&D?.[DEFAULT_LANGUAGE_SAFE]&&ie.push(DEFAULT_LANGUAGE_SAFE),D?.en&&ie.push("en");const se=ie.map(ve=>D?.[ve]).find(ve=>ve&&typeof ve=="object")||{},te=q&&q.favoriteToggleLabel||se.favoriteToggleLabel||"Toggle favorite",ye=q&&q.favoriteToggleHelp||se.favoriteToggleHelp||te;return{label:te,help:ye}})();S.setAttribute("aria-label",P.label),S.setAttribute("title",P.label),S.setAttribute("data-help",P.help),Yc(c),dl(c),Pi(c)}function pf(c,f,p){if(!c)return;if(typeof setSelectValue=="function"){setSelectValue(c,f);return}const g=f??"";c.value=g,c.value!==g&&(g==="None"&&p?(c.value="None",c.value!=="None"&&(c.selectedIndex=-1)):c.selectedIndex=-1)}function jm(c,f,p,g){if(!c)return;const S=Array.from(c.options||[]);if(p){if(S.some(L=>L&&L.value===f)){pf(c,f,g);return}if(g&&S.some(L=>L&&L.value==="None")){pf(c,"None",g);return}}else{c.selectedIndex=-1;return}S.length||(c.selectedIndex=-1)}function Tn(c,f={},p=!0){if(!c)return;let g=typeof c.value=="string"?c.value:"",S=c.selectedIndex!==-1;c.dataset&&c.dataset.pendingValue&&(g=c.dataset.pendingValue,S=!0);const E=f&&typeof f=="object"?f:{};if(c.innerHTML="",p){const L=document.createElement("option");L.value="None";const P={de:"Keine Auswahl",es:"Ninguno",fr:"Aucun"};L.textContent=P[currentLang]||"None",c.appendChild(L)}Object.keys(E).filter(L=>L!=="None").sort(localeSort).forEach(L=>{const P=document.createElement("option");P.value=L,P.textContent=L,c.appendChild(P)}),Qc(c),jm(c,g,S,p)}function ml(){const c=typeof monitorSelect<"u"?monitorSelect:typeof document<"u"?document.getElementById("monitorSelect"):null;if(!c)return;const f=devices.monitors||{},p=typeof cameraSelect<"u"?cameraSelect:typeof document<"u"?document.getElementById("cameraSelect"):null,g=p?p.value:"",S=Object.fromEntries(Object.entries(f).filter(([E])=>E==="ARRI CCM-1"?["Arri Alexa 35","Arri Alexa 35 Xtreme","Arri Alexa Mini LF"].includes(g):!0));Tn(c,S,!0)}function Vm(c){const f=devices?.accessories?.cages||{};return!c||c==="None"?f:Object.fromEntries(Object.entries(f).filter(([,p])=>{if(!p||typeof p!="object")return!0;const g=p.compatible;return Array.isArray(g)?g.includes(c):typeof g=="string"&&g?g===c:!g}))}function hs(c){if(cageSelect){if(typeof setSelectValue=="function"){setSelectValue(cageSelect,c);return}if(typeof c=="string"){cageSelect.value=c,cageSelect.value!==c&&(c==="None"?cageSelect.value="None":cageSelect.selectedIndex=-1);return}cageSelect.value=""}}function mf(c){if(!cageSelect)return;const f=cameraSelect?cameraSelect.value:"",p=Vm(f),g=cageSelect.value;if(Tn(cageSelect,p,!0),g&&g!=="None"&&Object.prototype.hasOwnProperty.call(p,g)){hs(g);return}const E=Array.from(cageSelect.options||[]),L=Object.entries(p).find(([q,ie])=>ie&&(ie.brand&&typeof ie.brand=="string"&&ie.brand.toUpperCase()==="ARRI"||typeof q=="string"&&q.toLowerCase().includes("arri")))?.[0];if(L){hs(L);return}const P=E.find(q=>q.value==="None");if(g==="None"&&P){hs("None");return}if(P){hs("None");return}const D=E.find(q=>q.value&&q.value!=="None");hs(D?D.value:"")}function bs(c,f){const p=f.toLowerCase();Array.from(c.options).forEach(g=>{g.value==="None"||p===""||g.textContent.toLowerCase().includes(p)?(g.hidden=!1,g.disabled=!1):(g.hidden=!0,g.disabled=!0)})}function Ss(c,f){const p=f.toLowerCase();Array.from(c.querySelectorAll("li")).forEach(g=>{const S=g.querySelector(".device-summary span"),E=S?S.textContent.toLowerCase():"";p===""||E.includes(p)?g.style.display="":g.style.display="none"})}function si(c){if(!c)return;let f="",p;c.addEventListener("keydown",g=>{if(g.key==="Backspace")f=f.slice(0,-1),bs(c,f),g.preventDefault();else if(g.key==="Escape")f="",bs(c,f);else if(g.key.length===1&&!g.ctrlKey&&!g.metaKey&&!g.altKey)f+=g.key.toLowerCase(),bs(c,f),g.preventDefault();else return;clearTimeout(p),p=setTimeout(()=>{f=""},1e3),typeof p.unref=="function"&&p.unref()}),c.addEventListener("blur",()=>{f="",bs(c,"")})}function gf(c,f){c&&(c.addEventListener("input",f),c.addEventListener("keydown",p=>{p.key==="Escape"&&(c.value="",f())}),yf(c,f))}function yf(c,f){const p=texts[currentLang]&&texts[currentLang].clearFilter||"Clear filter",g=document.createElement("button");g.type="button",g.className="clear-input-btn",g.innerHTML=iconMarkup(ICON_GLYPHS.circleX,"clear-icon"),g.setAttribute("aria-label",p),g.title=p,g.hidden=!0,g.addEventListener("click",()=>{c.value="",f(),c.focus()}),c.insertAdjacentElement("afterend",g);const S=()=>{g.hidden=!c.value};c.addEventListener("input",S),S()}const Oa=[],Es=new Map,Xc=new WeakMap,ia=document.getElementById("deviceLibrarySearch"),gl=document.getElementById("deviceLibrarySearchStatus");function zm(c){if(!c||!c.categoryKey||!(Jt instanceof Map))return;const f=Jt.get(c.categoryKey);if(!f)return;const{list:p,filterInput:g}=f;g&&g.value&&(g.value="",typeof Ss=="function"&&Ss(p,""))}function hf(c){if(!c||typeof c.classList?.add!="function")return;const f=Xc.get(c);f&&clearTimeout(f),c.classList.add("feature-search-focus");const p=setTimeout(()=>{c.classList.remove("feature-search-focus"),Xc.delete(c)},2500);typeof p.unref=="function"&&p.unref(),Xc.set(c,p)}function yl(){Oa.length=0,Es.clear(),Jt instanceof Map&&Jt.forEach(({list:c,heading:f},p)=>{if(!c)return;const g=f&&f.textContent?f.textContent.trim():p;Array.from(c.querySelectorAll("li")).forEach(S=>{const E=S.querySelector(".device-summary span");if(!E)return;const L=E.textContent?E.textContent.trim():"";if(!L||L==="None")return;const P=E.getAttribute("title")||"",D=ka(L),ie={key:D,label:L,summary:P,categoryKey:p,categoryLabel:g,element:S,focusTarget:E,labelLower:L.toLowerCase(),summaryLower:P.toLowerCase(),categoryLabelLower:(g||"").toLowerCase(),tokens:kn(`${L} ${P} ${g}`.trim()),primaryTokens:kn(L)};Oa.push(ie);const se=Es.get(D);se?Array.isArray(se)?se.push(ie):Es.set(D,[se,ie]):Es.set(D,ie)})})}function qm(c,f){if(!gl)return;const p=Oa.length,g=texts&&texts[currentLang]||texts&&texts.en||{},S=Gr(currentLang,p);if(!c){const P=g.deviceLibrarySearchStatusDefault||"Showing all {total} devices.";gl.textContent=P.replace("{total}",S);return}if(!f){const P=g.deviceLibrarySearchNoResults||"No devices match “{query}”.";gl.textContent=P.replace("{query}",c);return}const E=f===1?g.deviceLibrarySearchResultOne||"Showing {visible} of {total} devices.":g.deviceLibrarySearchResultOther||"Showing {visible} of {total} devices.",L=Gr(currentLang,f);gl.textContent=E.replace("{visible}",L).replace("{total}",S).replace("{query}",c)}function bf(c,f={}){if(!c||!c.element)return;zm(c),c.element.hidden=!1;const p=c.element.closest(".device-category");p&&p.classList.remove("device-category--global-empty");const g=c.focusTarget||c.element;if(typeof g.scrollIntoView=="function")try{g.scrollIntoView({behavior:f.behavior||"smooth",block:"center"})}catch{g.scrollIntoView()}hf(g)}function Zc(c){if(!c)return;Oa.length||yl();const f=ka(c),p=kn(c),g=Iu(Es,f,p),S=g&&g.value;S&&bf(S)}function Bi(c={}){if(!ia)return;Oa.length||yl();const f=ia.value?ia.value.trim():"",p=f.toLowerCase();let g=0;Oa.forEach(S=>{const E=!p||S.labelLower.includes(p)||S.categoryLabelLower.includes(p)||S.summaryLower&&S.summaryLower.includes(p);S.element.hidden=p&&!E,E&&(g+=1)}),Jt instanceof Map&&Jt.forEach(({section:S})=>{if(!S)return;if(!p){S.classList.remove("device-category--global-empty");return}const E=Array.from(S.querySelectorAll("li")).some(L=>!L.hidden&&L.style.display!=="none");S.classList.toggle("device-category--global-empty",!E)}),qm(f,g),c.scrollToMatch&&f&&Zc(f)}function Km(){Bi({scrollToMatch:!1})}ia&&(gf(ia,()=>Bi({scrollToMatch:!1})),ia.addEventListener("keydown",c=>{if(c.key==="Enter"){c.preventDefault();const f=ia.value?ia.value.trim():"";f&&Zc(f)}}),ia.addEventListener("search",()=>{Bi({scrollToMatch:!1});const c=ia.value?ia.value.trim():"";c&&Zc(c)}));const bn=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;bn&&(typeof bn.filterSelect!="function"&&(bn.filterSelect=bs),typeof bn.filterDeviceList!="function"&&(bn.filterDeviceList=Ss),typeof bn.attachSelectSearch!="function"&&(bn.attachSelectSearch=si),typeof bn.bindFilterInput!="function"&&(bn.bindFilterInput=gf),typeof bn.addInputClearButton!="function"&&(bn.addInputClearButton=yf),typeof bn.applyDeviceLibrarySearchFilter!="function"&&(bn.applyDeviceLibrarySearchFilter=c=>Bi(c||{})),typeof bn.updateDeviceLibrarySearchLocalization!="function"&&(bn.updateDeviceLibrarySearchLocalization=()=>Km()));function Sf(){Jt instanceof Map&&(Jt.forEach(({list:c,filterInput:f})=>{if(!c)return;const p=f?f.value:"";Ss(c,p)}),Bi({scrollToMatch:!1}))}if(bn&&typeof bn.applyFilters!="function"&&(bn.applyFilters=Sf),Tn(cameraSelect,devices.cameras||{},!0),ml(),Tn(videoSelect,devices.video||{},!0),mf(),Array.isArray(motorSelects)&&motorSelects.forEach(c=>Tn(c,devices.fiz&&devices.fiz.motors||{},!0)),Array.isArray(controllerSelects)&&controllerSelects.forEach(c=>Tn(c,devices.fiz&&devices.fiz.controllers||{},!0)),Tn(distanceSelect,devices.fiz&&devices.fiz.distance||{},!0),Tn(batterySelect,devices.batteries||{},!0),Tn(hotswapSelect,devices.batteryHotswaps||{},!0),_i(),Ii(),[cameraSelect,monitorSelect,videoSelect,cageSelect,distanceSelect,batterySelect,hotswapSelect,lensSelect].forEach(c=>si(c)),Array.isArray(motorSelects)&&motorSelects.forEach(c=>si(c)),Array.isArray(controllerSelects)&&controllerSelects.forEach(c=>si(c)),cameraSelect&&cameraSelect.addEventListener("change",()=>{if(ml(),nl(),typeof window.updateStorageRequirementTypeOptions=="function"&&window.updateStorageRequirementTypeOptions(),typeof document<"u"&&typeof document.dispatchEvent=="function"&&typeof CustomEvent=="function")try{document.dispatchEvent(new CustomEvent("camera-selection-changed"))}catch{}ma()}),[monitorSelect,videoSelect,cageSelect,distanceSelect,hotswapSelect,lensSelect].forEach(c=>{c&&c.addEventListener("change",()=>{ma()})}),Array.isArray(motorSelects)&&motorSelects.forEach(c=>{c&&c.addEventListener("change",()=>{ma()})}),Array.isArray(controllerSelects)&&controllerSelects.forEach(c=>{c&&c.addEventListener("change",()=>{ma()})}),Sf(),Oc([]),Tc([]),Ic([]),Me("clearMonitorVideoInputs",Gc),Me("ensureDefaultProjectInfoSnapshot",ns),tl([]),ol([]),Fc([]),dc(),pc(),Od(),wd(),Td(),Gd(),Cc(),Ac(),vc(),Yd([]),Ti([]),cs([]),nl(),zd(),ll([]),il(),jd(),console.log("DEBUG: updatePowerPortOptions finished"),qc([]),console.log("DEBUG: setPowerDistribution finished"),af(),console.log("DEBUG: updatePowerDistTypeOptions finished"),rf(),console.log("DEBUG: updatePowerDistVoltageOptions finished"),nf(),console.log("DEBUG: updatePowerDistCurrentOptions finished"),Wc([]),console.log("DEBUG: setTimecodes finished"),lf(),console.log("DEBUG: updateTimecodeTypeOptions finished"),Cc(),console.log("DEBUG: updateDistanceConnectionOptions finished (second call)"),Ac(),console.log("DEBUG: updateDistanceMethodOptions finished (second call)"),vc(),console.log("DEBUG: updateDistanceDisplayOptions finished (second call)"),typeof cameraSelect<"u"&&cameraSelect){console.log("DEBUG: processing cameraSelect",cameraSelect.id,cameraSelect.tagName,"Options count:",cameraSelect.options?cameraSelect.options.length:"null");let c=null;if(cameraSelect.options){console.log("DEBUG: cameraSelect options exist, iterating...");for(let f=0;f<cameraSelect.options.length;f++){const p=cameraSelect.options[f];if(p&&p.value==="None"){c=p;break}}}console.log("DEBUG: noneCameraOption resolution finished"),c?cameraSelect.value="None":cameraSelect.selectedIndex=0}[monitorSelect,videoSelect,distanceSelect,batterySelect].forEach(c=>{c&&(Array.from(c.options).find(p=>p.value==="None")?c.value="None":c.selectedIndex=0)}),Array.isArray(motorSelects)&&motorSelects.forEach(c=>{c&&c.options&&c.options.length&&(c.value="None")}),Array.isArray(controllerSelects)&&controllerSelects.forEach(c=>{c&&c.options&&c.options.length&&(c.value="None")});function ma(){const c=typeof cineResults=="object"?cineResults:null,f=(c&&typeof c.updateCalculations=="function"?c.updateCalculations:null)||(typeof window<"u"&&window.cineCoreSession&&typeof window.cineCoreSession.updateCalculations=="function"?window.cineCoreSession.updateCalculations:null)||(typeof globalThis<"u"&&globalThis.cineCoreSession&&typeof globalThis.cineCoreSession.updateCalculations=="function"?globalThis.cineCoreSession.updateCalculations:null);if(!f){console.warn("cineResults.updateCalculations not available");return}try{f({document:typeof document<"u"?document:null,elements:{cameraSelect,monitorSelect,videoSelect,distanceSelect,batterySelect,hotswapSelect,totalPowerElem:typeof totalPowerElem<"u"?totalPowerElem:null,breakdownListElem:typeof Fs<"u"?Fs:null,totalCurrent144Elem:typeof totalCurrent144Elem<"u"?totalCurrent144Elem:null,totalCurrent12Elem:typeof totalCurrent12Elem<"u"?totalCurrent12Elem:null,batteryLifeElem:typeof batteryLifeElem<"u"?batteryLifeElem:null,batteryCountElem:typeof batteryCountElem<"u"?batteryCountElem:null,batteryLifeLabelElem:typeof batteryLifeLabelElem<"u"?batteryLifeLabelElem:null,runtimeAverageNoteElem:typeof runtimeAverageNoteElem<"u"?runtimeAverageNoteElem:null,pinWarnElem:typeof pinWarnElem<"u"?pinWarnElem:null,dtapWarnElem:typeof dtapWarnElem<"u"?dtapWarnElem:null,hotswapWarnElem:typeof hotswapWarnElem<"u"?hotswapWarnElem:null,batteryComparisonSection:typeof xu<"u"?xu:null,batteryTableElem:typeof $u<"u"?$u:null,setupDiagramContainer:typeof _l<"u"?_l:null,connectionDiagram:typeof connectionDiagram<"u"?connectionDiagram:null},state:{appState:typeof appState<"u"?appState:{},currentSetup:as()},motorSelects,controllerSelects,getDevices:()=>devices,getTexts:()=>texts,getCurrentLang:()=>currentLang,getCollator:()=>typeof collator<"u"?collator:null,getSelectedPlate:typeof Pe=="function"?Pe:null,getMountVoltageConfig:typeof getMountVoltageConfig=="function"?getMountVoltageConfig:null,refreshTotalCurrentLabels:typeof refreshTotalCurrentLabels=="function"?refreshTotalCurrentLabels:null,updateBatteryOptions:typeof Ii=="function"?Ii:null,setStatusMessage:typeof setStatusMessage=="function"?setStatusMessage:null,setStatusLevel:typeof setStatusLevel=="function"?setStatusLevel:null,closePowerWarningDialog:typeof closePowerWarningDialog=="function"?closePowerWarningDialog:null,showPowerWarningDialog:typeof showPowerWarningDialog=="function"?showPowerWarningDialog:null,drawPowerDiagram:typeof drawPowerDiagram=="function"?drawPowerDiagram:null,renderFeedbackTable:typeof Cs=="function"?Cs:null,getCurrentSetupKey:typeof hl=="function"?hl:null,renderTemperatureNote:typeof renderTemperatureNote=="function"?renderTemperatureNote:null,checkFizCompatibility:typeof checkFizCompatibility=="function"?checkFizCompatibility:null,checkFizController:typeof checkFizController=="function"?checkFizController:null,checkArriCompatibility:typeof checkArriCompatibility=="function"?checkArriCompatibility:null,renderSetupDiagram:typeof ni=="function"?ni:null,refreshGearListIfVisible:typeof refreshGearListIfVisible=="function"?refreshGearListIfVisible:null,supportsBMountCamera:typeof supportsBMountCamera=="function"?supportsBMountCamera:null,supportsGoldMountCamera:typeof supportsGoldMountCamera=="function"?supportsGoldMountCamera:null,getCssVariableValue:typeof getCssVariableValue=="function"?getCssVariableValue:null,escapeHtml:typeof y=="function"?y:null,getLastRuntimeHours:()=>lastRuntimeHours,setLastRuntimeHours:p=>{lastRuntimeHours=p}})}catch(p){console.warn("cineResults.updateCalculations failed",p)}}typeof window<"u"?window.updateCalculations=ma:typeof globalThis<"u"&&(globalThis.updateCalculations=ma);function hl(){const c=te=>te&&typeof te.value=="string"?te.value:"",f=te=>Array.isArray(te)?te.map(ye=>c(ye)).filter(ye=>ye&&ye!=="None").sort().join(","):"",p=c(cameraSelect),g=c(monitorSelect),S=c(videoSelect),E=c(cageSelect),L=f(motorSelects),P=f(controllerSelects),D=c(distanceSelect),q=c(batterySelect),ie=c(hotswapSelect),se=typeof Pe=="function"&&Pe()||"";return[p,g,S,E,L,P,D,q,ie,se].join("|")}function Wm(c,f){const p=lc();p[c]&&(p[c].splice(f,1),p[c].length||delete p[c],pd(p),ma())}function Cs(c){typeof window<"u"&&!window.renderFeedbackTable&&(window.renderFeedbackTable=Cs);const f=document.getElementById("feedbackTableContainer"),p=document.getElementById("userFeedbackTable"),S=(lc()[c]||[]).map(nt=>{const Mt={...nt};return delete Mt.location,Mt});if(!S.length)return p&&(p.innerHTML="",p.classList.add("hidden")),f&&f.classList.add("hidden"),null;const E=[{key:"username",label:"User"},{key:"date",label:"Date"},{key:"cameraWifi",label:"WIFI"},{key:"resolution",label:"Res"},{key:"codec",label:"Codec"},{key:"framerate",label:"FPS"},{key:"firmware",label:"Firmware"},{key:"batteryAge",label:"Battery Age (in years)"},{key:"monitorBrightness",label:"Monitor Brightness"},{key:"temperature",label:"temp"},{key:"charging",label:"Charging"},{key:"runtime",label:"runtime"},{key:"batteriesPerDay",label:"batteries a day"},{key:"weighting",label:"weight"}],L=nt=>{if(!nt)return null;const Mt=String(nt).toLowerCase(),lo=Mt.match(/(\d+(?:\.\d+)?)\s*k/);if(lo)return parseFloat(lo[1])*1e3;const tr=Mt.match(/(\d{3,4})p/);if(tr)return parseInt(tr[1],10);const xr=Mt.match(/x\s*(\d{3,4})/);if(xr)return parseInt(xr[1],10);const nn=Mt.match(/(\d{3,4})/);return nn?parseInt(nn[1],10):null},P=nt=>{if(!nt)return null;const Mt=String(nt).match(/\d+(?:\.\d+)?/);return Mt?parseFloat(Mt[0]):null},D=nt=>Number.isNaN(nt)||nt>=25?1:nt>=0?1+(25-nt)*.01:nt>=-10?1.25+-nt*.035:nt>=-20?1.6+(-10-nt)*.04:2,q=nt=>nt>=12e3?3:nt>=8e3?2:nt>=4e3?1.5:nt>=1080?1:nt/1080,ie=nt=>{if(!nt)return 1;const Mt=String(nt).toLowerCase();return/(prores\s*raw|braw|arriraw|r3d|redcode|cinema\s*dng|cdng|canon\s*raw|x-ocn|raw)/.test(Mt)?1:/prores/.test(Mt)?1.1:/dnx|avid/.test(Mt)?1.2:/\ball[\s-]?i\b|all\s*intra|intra/.test(Mt)?1.3:/h265|h\.265|hevc|xavc\s*hs|xhevc/.test(Mt)?1.7:/h264|h\.264|avc|xavc|avchd|mpeg-4/.test(Mt)?1.5:1},se=devices?.cameras?.[cameraSelect?.value]?.powerDrawWatts||0,te=devices?.monitors?.[monitorSelect?.value]?.powerDrawWatts||0,ye=devices?.video?.[videoSelect?.value]?.powerDrawWatts||0,ve=motorSelects.reduce((nt,Mt)=>nt+(devices?.fiz?.motors?.[Mt.value]?.powerDrawWatts||0),0),Ke=controllerSelects.reduce((nt,Mt)=>nt+(devices?.fiz?.controllers?.[Mt.value]?.powerDrawWatts||0),0),Ze=devices?.fiz?.distance?.[distanceSelect?.value]?.powerDrawWatts||0,ut=ye+ve+Ke+Ze,Ft=se+te+ut,Mo=devices?.monitors?.[monitorSelect?.value]?.brightnessNits;let Yt=0,oo=0,Bt=0;const _r=S.map(nt=>{const Mt=parseFloat(nt.runtime);if(Number.isNaN(Mt))return null;let lo=1,tr=1;const xr=L(nt.resolution);xr&&(lo*=q(xr));const nn=P(nt.framerate);nn&&(lo*=nn/24);const xn=(nt.cameraWifi||"").toLowerCase();xn.includes("on")&&(lo*=1.1);const Gn=nt.codec;Gn&&(lo*=ie(Gn));const wa=parseFloat(nt.monitorBrightness);if(!Number.isNaN(wa)&&Mo){const ta=wa/Mo;ta<1&&(tr*=ta)}let ea=1;Ft>0&&(ea=(lo*se+tr*te+ut)/Ft);const xa=parseFloat(nt.temperature),_n=D(xa),$a=Mt*_n;return Yt+=$a*ea,oo+=ea,Bt++,{temperature:_n,resolution:xr?q(xr):1,framerate:nn?nn/24:1,wifi:xn.includes("on")?1.1:1,codec:Gn?ie(Gn):1,monitor:tr,weight:ea}}),At=Math.max(..._r.filter(Boolean).map(nt=>nt.weight),0);let gt="<tr>"+E.map(nt=>`<th>${y(nt.label)}</th>`).join("")+"<th></th></tr>";const xt=texts[currentLang]?.deleteSetupBtn||texts.en?.deleteSetupBtn||"Delete";return S.forEach((nt,Mt)=>{gt+="<tr>",E.forEach(lo=>{if(lo.key==="weighting"){const tr=_r[Mt];if(tr){const xr=At?tr.weight/At*100:0,nn=tr.weight*100,xn=`Temp ×${tr.temperature.toFixed(2)}
Res ×${tr.resolution.toFixed(2)}
FPS ×${tr.framerate.toFixed(2)}
Codec ×${tr.codec.toFixed(2)}
Wi-Fi ×${tr.wifi.toFixed(2)}
Monitor ×${tr.monitor.toFixed(2)}
Share ${nn.toFixed(1)}%`;gt+=`<td><div class="weightingRow"><div class="barContainer"><div class="weightBar" style="width:${xr}%" title="${y(xn)}"></div></div><span class="weightingPercent">${nn.toFixed(1)}%</span></div></td>`}else gt+="<td></td>"}else lo.key==="date"?gt+=`<td>${y(Xm(nt[lo.key]))}</td>`:gt+=`<td>${y(nt[lo.key]||"")}</td>`}),gt+=`<td><button data-key="${encodeURIComponent(c)}" data-index="${Mt}" class="deleteFeedbackBtn">${iconMarkup(ICON_GLYPHS.trash,"btn-icon")}${y(xt)}</button></td>`,gt+="</tr>"}),p.innerHTML=gt,p.classList.remove("hidden"),f&&f.classList.remove("hidden"),p.querySelectorAll(".deleteFeedbackBtn").forEach(nt=>{nt.setAttribute("aria-label",xt),nt.setAttribute("title",xt),nt.addEventListener("click",()=>{const Mt=decodeURIComponent(nt.dataset.key),lo=parseInt(nt.dataset.index,10);Wm(Mt,lo)})}),Bt>=3&&oo>0?{runtime:Yt/oo,count:Bt,weight:oo}:null}typeof Me=="function"&&Me("renderFeedbackTable",Cs);function bl(c){if(Array.isArray(c))return c.map(f=>bl(f));if(to(c)){const f={};return Object.keys(c).filter(p=>c[p]!==void 0).sort().forEach(p=>{f[p]=bl(c[p])}),f}return c===void 0?null:c}function Ym(c,f){if(c===f||c==null&&f==null)return!0;if(c==null||f===null||f===void 0)return!1;const p=bl(c),g=bl(f);return JSON.stringify(p)===JSON.stringify(g)}function Jc(){if(!window.defaultDevices)return{};const c={},f=(g,S,E,L)=>{L?(c.fiz=c.fiz||{},c.fiz[L]=c.fiz[L]||{},c.fiz[L][S]=E):(c[g]=c[g]||{},c[g][S]=E)},p=(g,S,E,L)=>{Object.keys(E).forEach(P=>{const D=E[P],q=S[P];(!q||!Ym(D,q))&&f(g,P,D,L)}),Object.keys(S).forEach(P=>{E[P]||f(g,P,null,L)})};return p("cameras",window.defaultDevices.cameras||{},devices.cameras||{}),p("viewfinders",window.defaultDevices.viewfinders||{},devices.viewfinders||{}),p("monitors",window.defaultDevices.monitors||{},devices.monitors||{}),p("video",window.defaultDevices.video||{},devices.video||{}),p("batteries",window.defaultDevices.batteries||{},devices.batteries||{}),p("batteryHotswaps",window.defaultDevices.batteryHotswaps||{},devices.batteryHotswaps||{}),["motors","controllers","distance"].forEach(g=>{const S=window.defaultDevices.fiz?window.defaultDevices.fiz[g]||{}:{},E=devices.fiz?devices.fiz[g]||{}:{};p("fiz",S,E,g),c.fiz&&c.fiz[g]&&!Object.keys(c.fiz[g]).length&&delete c.fiz[g]}),c.fiz&&!Object.keys(c.fiz).length&&delete c.fiz,Object.keys(c).forEach(g=>{g!=="fiz"&&!Object.keys(c[g]).length&&delete c[g]}),c}function Qm(c){if(!c||typeof c!="object")return;const f=(p,g)=>{Object.keys(g).forEach(S=>{const E=g[S];E===null?delete p[S]:p[S]=E})};Object.keys(c).forEach(p=>{p==="fiz"?Object.keys(c.fiz||{}).forEach(g=>{devices.fiz[g]=devices.fiz[g]||{},f(devices.fiz[g],c.fiz[g])}):(devices[p]=devices[p]||{},f(devices[p],c[p]))}),unifyDevices(devices,{force:!0}),storeDevices(devices),El(),il(),Tn(cameraSelect,devices.cameras||{},!0),ml(),Tn(videoSelect,devices.video||{},!0),mf(),Array.isArray(motorSelects)&&motorSelects.forEach(p=>Tn(p,devices.fiz&&devices.fiz.motors||{},!0)),Array.isArray(controllerSelects)&&controllerSelects.forEach(p=>Tn(p,devices.fiz&&devices.fiz.controllers||{},!0)),Tn(distanceSelect,devices.fiz&&devices.fiz.distance||{},!0),Tn(batterySelect,devices.batteries,!0),dc(),pc(),Od(),wd(),Td(),Gd(),Cc(),Ac(),vc()}function Sl(c){if(Array.isArray(c))return c.map(f=>Sl(f)).join("; ");if(c&&typeof c=="object"){const f=[];for(const p in c)c[p]===""||c[p]===null||c[p]===void 0||f.push(`${To(p)}: ${Sl(c[p])}`);return`{ ${f.join(", ")} }`}return typeof c=="boolean"?c?"Yes":"No":String(c)}function eu(c){const f=document.createElement("ul");f.className="device-detail-list";const p=(g,S,E)=>{if(S===""||S===null||S===void 0)return;const L=document.createElement("li"),P=document.createElement("strong");if(P.textContent=To(g)+":",L.appendChild(P),Array.isArray(S))if(S.length&&typeof S[0]=="object"){const D=document.createElement("ul");D.className="device-detail-list",S.forEach(q=>{const ie=document.createElement("li");ie.appendChild(eu(q)),D.appendChild(ie)}),L.appendChild(D)}else L.appendChild(document.createTextNode(S.map(D=>Sl(D)).join(", ")));else S&&typeof S=="object"?L.appendChild(eu(S)):L.appendChild(document.createTextNode(Sl(S)));E.appendChild(L)};return typeof c!="object"?p("powerDrawWatts",c,f):Object.keys(c).forEach(g=>p(g,c[g],f)),f}function Xm(c){if(!c)return"";const f=new Date(c);return Number.isNaN(f.getTime())?String(c):f.toISOString().split("T")[0]}function Zm(c,f){f.innerHTML="";let p=devices[c];const g=typeof texts=="object"&&texts||typeof window<"u"&&typeof window.texts=="object"&&window.texts||{},S=typeof g.en=="object"&&g.en||{},E=currentLang&&typeof g[currentLang]=="object"&&g[currentLang]||S,L=(D,q)=>E&&typeof E[D]<"u"?E[D]:S&&typeof S[D]<"u"?S[D]:q||"";if(c.includes(".")){const[D,q]=c.split(".");p=devices[D]&&devices[D][q]}if(!p)return;const P=(D,q,ie)=>{if(D==="None")return;const se=document.createElement("li"),te=document.createElement("div");te.className="device-summary";const ye=document.createElement("span");ye.textContent=D;let ve=generateSafeConnectorSummary(q);if(ve){let At;do At=ve,ve=ve.replace(/<[^>]+>/g,"");while(ve!==At);ve=ve.replace(/\s+/g," ").trim()}else ve="";q.notes&&(ve=ve?`${ve}; Notes: ${q.notes}`:q.notes),ve&&(ye.setAttribute("title",ve),ye.setAttribute("data-help",ve)),te.appendChild(ye);const Ke=document.createElement("button");Ke.className="detail-toggle",Ke.type="button",Ke.setAttribute("aria-expanded","false");const Ze=L("showDetails","Show Details");Ke.textContent=Ze,Ke.setAttribute("data-help",Ze),Ke.dataset.name=D,Ke.dataset.category=c,ie&&(Ke.dataset.subcategory=ie),te.appendChild(Ke);const ut=document.createElement("button");ut.className="edit-btn",ut.dataset.name=D,ut.dataset.category=c,ie&&(ut.dataset.subcategory=ie);const Ft=L("editBtn","Edit"),Mo=L("editBtnHelp",Ft);ut.textContent=Ft,ut.setAttribute("data-help",Mo||Ft),te.appendChild(ut);const Yt=document.createElement("button");Yt.className="delete-btn",Yt.dataset.name=D,Yt.dataset.category=c,ie&&(Yt.dataset.subcategory=ie);const oo=L("deleteDeviceBtn","Delete"),Bt=L("deleteDeviceBtnHelp",oo);Yt.textContent=oo,Yt.setAttribute("data-help",Bt||oo),te.appendChild(Yt),se.appendChild(te);const _r=document.createElement("div");_r.className="device-details",_r.style.display="none",_r.appendChild(eu(q)),se.appendChild(_r),f.appendChild(se)};c==="accessories.cables"&&p&&typeof p=="object"?Object.keys(p).sort(localeSort).forEach(D=>{const q=p[D]||{};Object.keys(q).filter(ie=>ie!=="None").sort(localeSort).forEach(ie=>{P(ie,q[ie],D)})}):p&&typeof p=="object"&&Object.keys(p).filter(D=>D!=="None").sort(localeSort).forEach(D=>{P(D,p[D])})}function El(){if(syncDeviceManagerCategories(),Jt instanceof Map){Jt.forEach(({list:c,filterInput:f},p)=>{if(!c)return;Zm(p,c);const g=f?f.value:"";Ss(c,g)}),yl(),Bi({scrollToMatch:!1});try{Zu()}catch{}}}const Cl={adjustGearListSelectWidths:pl,populateSelect:Tn,populateMonitorSelect:ml,refreshDeviceLists:El,hasAnyDeviceSelection:sm,refreshAutoGearCameraOptions:Q,refreshAutoGearCameraWeightCondition:X,refreshAutoGearMonitorOptions:Se,refreshAutoGearTripodHeadOptions:Ne,refreshAutoGearTripodBowlOptions:Qe,refreshAutoGearTripodTypesOptions:Fe,refreshAutoGearTripodSpreaderOptions:_e,refreshAutoGearWirelessOptions:He,refreshAutoGearMotorsOptions:st,refreshAutoGearControllersOptions:at,refreshAutoGearCrewOptions:So,refreshAutoGearDistanceOptions:St,exportAutoGearRules:nr,exportAutoGearPresets:ar,updateAutoGearCameraWeightDraft:ae,updateAutoGearShootingDaysDraft:Ae,checkSetupChanged:is,updateCalculations:ma,feedbackCancelBtn:Vi,alignActiveAutoGearPreset:N,closeAutoGearEditor:Wr,reconcileAutoGearAutoPresetState:Ye,renderAutoGearBackupControls:ao,renderAutoGearBackupRetentionControls:Qr,renderAutoGearDraftImpact:Nr,renderAutoGearDraftLists:Xt,renderAutoGearMonitorDefaultsControls:jo,renderAutoGearPresetsControls:K,renderAutoGearRulesList:yr,openAutoGearEditor:po,setAutoGearRuleEnabled:Kn,overviewSectionIcons:hd,saveAutoGearRuleFromEditor:Pn,handleAutoGearImportSelection:Uo,handleAutoGearPresetSelection:Qo,handleAutoGearSavePreset:Xo,handleAutoGearDeletePreset:No,applyAutoGearBackupVisibility:Gt,setAutoGearBackupsVisible:ho,setAutoGearAutoPresetId:Re,syncAutoGearAutoPreset:ke,updateAutoGearCatalogOptions:Zt,updateAutoGearItemButtonState:Zo,updateAutoGearMonitorDefaultOptions:Ht,applyFavoritesToSelect:Yc,updateFavoriteButton:dl,toggleFavorite:ff,accentColor:Ji,loadStoredLogoPreview:Bn,renderSettingsLogoPreview:un,normalizeSpellingVariants:Gu,prevAccentColor:Vl,revertAccentColor:jp,DEFAULT_ACCENT_COLOR:Zi,HIGH_CONTRAST_ACCENT_COLOR:Nu,applyAccentColor:es,clearAccentColorOverrides:Hu,updateAccentColorResetButtonState:ri,restoringSession:$t,currentProjectInfo:je,deriveProjectInfo:ac,projectForm:ji,filterSelectElem:nu,filterDetailsStorage:au,loadFeedbackSafe:lc,saveFeedbackSafe:pd,ensureDefaultProjectInfoSnapshot:ns,skipNextGearListRefresh:fo,refreshDarkModeAccentBoost:Wl,isHighContrastActive:Yl,feedbackUseLocationBtn:zi,getSliderBowlValue:sd,getEasyrigValue:ld,setEasyrigValue:Qs,fontSize:Da,fontFamily:La,normalizeSearchValue:mu,clearRecordingMedia:al,setSliderBowlValue:os};function Jm(){const c={},f=document.getElementById("gear-list");return f&&f.querySelectorAll("select").forEach(g=>{g.id&&(c[g.id]=g.value)}),c}function eg(c){!c||typeof c!="object"||Object.keys(c).forEach(f=>{const p=document.getElementById(f);if(p){const g=c[f];typeof setSelectValue=="function"?setSelectValue(p,g):p.value=g}})}const tg=[["setBatteryPlates",()=>Ti],["getBatteryPlates",()=>Gi],["setRecordingMedia",()=>cs],["getRecordingMedia",()=>us],["applyDarkMode",()=>applyDarkMode],["applyPinkMode",()=>applyPinkMode],["applyHighContrast",()=>applyHighContrast],["setupInstallBanner",()=>on],["generatePrintableOverview",()=>generatePrintableOverview],["generateGearListHtml",()=>generateGearListHtml],["displayGearAndRequirements",()=>am],["updateGearListButtonVisibility",()=>Ju],["ensureZoomRemoteSetup",()=>ensureZoomRemoteSetup],["encodeSharedSetup",()=>encodeSharedSetup],["decodeSharedSetup",()=>decodeSharedSetup],["applySharedSetupFromUrl",()=>applySharedSetupFromUrl],["applySharedSetup",()=>applySharedSetup],["updateBatteryPlateVisibility",()=>_i],["updateBatteryOptions",()=>Ii],["updatePlateTypeOptions",()=>zd],["updatePowerPortOptions",()=>jd],["updatePowerDistTypeOptions",()=>af],["updatePowerDistVoltageOptions",()=>rf],["updatePowerDistCurrentOptions",()=>nf],["updateTimecodeTypeOptions",()=>lf],["setPowerDistribution",()=>qc],["getPowerDistribution",()=>Dm],["renderSetupDiagram",()=>ni],["enableDiagramInteractions",()=>gd],["updateDiagramLegend",()=>yd],["cameraFizPort",()=>Ce],["controllerCamPort",()=>ne],["controllerDistancePort",()=>de],["detectBrand",()=>detectBrand],["connectionLabel",()=>it],["setBatteryPlates",()=>Ti],["getBatteryPlates",()=>Gi],["setRecordingMedia",()=>cs],["getRecordingMedia",()=>us],["generateConnectorSummary",()=>generateConnectorSummary],["diagramConnectorIcons",()=>Xs],["DIAGRAM_MONITOR_ICON",()=>bd],["exportDiagramSvg",()=>exportDiagramSvg],["ensureDefaultProjectInfoSnapshot",()=>ns],["attachSelectSearch",()=>si],["fixPowerInput",()=>fixPowerInput],["powerInputTypes",()=>pa],["ensureList",()=>ensureList],["normalizeVideoType",()=>normalizeVideoType],["normalizeFizConnectorType",()=>normalizeFizConnectorType],["normalizeViewfinderType",()=>normalizeViewfinderType],["normalizePowerPortType",()=>W],["setMonitorVideoInputs",()=>Tc],["getMonitorVideoInputs",()=>ym],["clearMonitorVideoInputs",()=>Gc],["setMonitorVideoOutputs",()=>Ic],["getMonitorVideoOutputs",()=>hm],["clearMonitorVideoOutputs",()=>Bd],["setVideoPowerInputs",()=>Dc],["getVideoPowerInputs",()=>Lm],["clearVideoPowerInputs",()=>Dd],["setVideoInputs",()=>xd],["getVideoInputs",()=>Rm],["clearVideoInputs",()=>$d],["setVideoOutputs",()=>Oc],["getVideoOutputs",()=>mm],["setVideoOutputsIO",()=>Nd],["getVideoOutputsIO",()=>Om],["clearVideoOutputsIO",()=>Fd],["setViewfinderVideoInputs",()=>tl],["getViewfinderVideoInputs",()=>bm],["clearViewfinderVideoInputs",()=>Md],["setViewfinderVideoOutputs",()=>ol],["getViewfinderVideoOutputs",()=>Sm],["clearViewfinderVideoOutputs",()=>Em],["updateFizConnectorOptions",()=>dc],["updateMotorConnectorOptions",()=>pc],["getCurrentSetupKey",()=>hl],["renderFeedbackTable",()=>Cs],["saveCurrentGearList",()=>saveCurrentGearList],["getPowerSelectionSnapshot",()=>getPowerSelectionSnapshot],["applyStoredPowerSelection",()=>applyStoredPowerSelection],["getGearListSelectors",()=>Jm],["applyGearListSelectors",()=>eg],["scenarioIcons",()=>scenarioIcons],["collectProjectFormData",()=>collectProjectFormData],["populateProjectForm",()=>populateProjectForm],["renderFilterDetails",()=>renderFilterDetails],["collectFilterSelections",()=>collectFilterSelections],["parseFilterTokens",()=>parseFilterTokens],["applyFilterSelectionsToGearList",()=>applyFilterSelectionsToGearList],["adjustGearListSelectWidth",()=>Pi],["adjustGearListSelectWidths",()=>pl],["getDeviceChanges",()=>Jc],["applyDeviceChanges",()=>Qm],["deviceMap",()=>Ja],["helpMap",()=>$l],["featureSearchEntries",()=>Jn],["featureSearchDefaultOptions",()=>Oi],["populateFeatureSearch",()=>Zu],["restoreFeatureSearchDefaults",()=>Ma],["updateFeatureSearchValue",()=>Vf],["updateFeatureSearchSuggestions",()=>wu],["setCurrentProjectInfo",()=>im],["getCurrentProjectInfo",()=>dd],["getCurrentSetupState",()=>as],["setSliderBowlValue",()=>os],["getSliderBowlSelect",()=>oc],["getEasyrigSelect",()=>rc],["crewRoles",()=>crewRoles],["formatFullBackupFilename",()=>formatFullBackupFilename],["computeGearListCount",()=>Hi],["autoBackup",()=>autoBackup],["createSettingsBackup",()=>createSettingsBackup],["captureStorageSnapshot",()=>captureStorageSnapshot],["sanitizeBackupPayload",()=>sanitizeBackupPayload],["extractBackupSections",()=>extractBackupSections],["searchKey",()=>ka],["searchTokens",()=>kn],["findBestSearchMatch",()=>Iu],["runFeatureSearch",()=>zf],["collectAutoGearCatalogNames",()=>collectAutoGearCatalogNames],["featureMap",()=>Pl],["actionMap",()=>uu],["buildDefaultVideoDistributionAutoGearRules",()=>buildDefaultVideoDistributionAutoGearRules],["applyAutoGearRulesToTableHtml",()=>applyAutoGearRulesToTableHtml],["importAutoGearRulesFromData",()=>wt],["getAutoGearRuleCoverageSummary",()=>Kt],["createAutoGearBackup",()=>Mr],["restoreAutoGearBackup",()=>Or],["getAutoGearRules",()=>getAutoGearRules],["syncAutoGearRulesFromStorage",()=>syncAutoGearRulesFromStorage],["normalizeAutoGearCameraWeightCondition",()=>G],["updateAutoGearItemButtonState",()=>Zo],["loadStoredLogoPreview",()=>Bn],["normalizeSpellingVariants",()=>Gu],["parseDeviceDatabaseImport",()=>$n],["countDeviceDatabaseEntries",()=>Ni],["sanitizeShareFilename",()=>sanitizeShareFilename],["ensureJsonExtension",()=>ensureJsonExtension],["getDefaultShareFilename",()=>getDefaultShareFilename],["promptForSharedFilename",()=>promptForSharedFilename],["downloadSharedProject",()=>downloadSharedProject],["clearBatteryPlates",()=>qd],["updateRecordingMediaOptions",()=>nl],["clearRecordingMedia",()=>al],["setLensMounts",()=>ll],["getLensMounts",()=>Zd],["clearLensMounts",()=>Vc],["setLensDeviceMountOptions",()=>Jd],["getLensDeviceMountOptions",()=>Mm],["clearLensDeviceMountOptions",()=>km],["updateMountTypeOptions",()=>il],["clearPowerDistribution",()=>xm],["clearVideoOutputs",()=>gm],["setFizConnectors",()=>Fc],["getFizConnectors",()=>wm],["clearFizConnectors",()=>Tm],["clearViewfinders",()=>Pm],["setTimecodes",()=>Wc],["getTimecodes",()=>$m],["clearTimecodes",()=>Nm],["confirmAutoGearSelection",()=>confirmAutoGearSelection],["configureSharedImportOptions",()=>configureSharedImportOptions],["resolveSharedImportMode",()=>resolveSharedImportMode],["resetPlannerStateAfterFactoryReset",()=>resetPlannerStateAfterFactoryReset],["resetCustomFontsForFactoryReset",()=>Mp],["updateStorageSummary",()=>Is],["normaliseMarkVariants",()=>Tu],["storeLoadedSetupState",()=>ic]].reduce((c,[f,p])=>{try{const g=p();typeof g<"u"&&(c[f]=g)}catch{}return c},{});Object.assign(Cl,tg),(function(){const f=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!f)return;const p=f.cineModuleBase,g=!!(p&&p.__cineSafeFreezeWrapped)||coreSafeFreezeRegistryHas(p);if(p&&typeof p.freezeDeep=="function"&&!g){const E=p.freezeDeep;try{p.freezeDeep=function(te,ye){try{return E(te,ye)}catch(ve){try{typeof console<"u"&&typeof console.warn=="function"&&console.warn("cineModuleBase.freezeDeep fallback triggered for core module export.",ve)}catch(Ke){}return te}},coreSafeFreezeRegistryAdd(p)}catch{}let L=!1;const P="__cineSafeFreezeWrapped",D=Object.prototype.hasOwnProperty.call(p,P);if(D)try{L=!!p[P]}catch{L=!0}let q=!0;if(!L&&!D&&typeof Object.isExtensible=="function")try{q=Object.isExtensible(p)}catch{q=!0}const ie=!L&&q;if(ie)try{p[P]=!0,p[P]&&(L=!0)}catch{}if(!L&&ie&&typeof Object.isExtensible=="function")try{Object.isExtensible(p)||(q=!1)}catch{}if(!L&&q&&typeof Object.defineProperty=="function")try{Object.defineProperty(p,P,{configurable:!1,enumerable:!1,writable:!1,value:!0}),L=!0}catch{}!L&&!coreSafeFreezeRegistryHas(p)&&coreSafeFreezeRegistryAdd(p)}Object.entries({cineCoreProject:["deriveProjectInfo","updateCalculations","checkSetupChanged","currentProjectInfo","setCurrentProjectInfo","getCurrentProjectInfo","collectProjectFormData","populateProjectForm","renderFilterDetails","collectFilterSelections","collectFilterTokens","parseFilterTokens","applyFilterSelectionsToGearList","normalizeSpellingVariants","normalizeSearchValue","getPowerSelectionSnapshot","applyStoredPowerSelection","getGearListSelectors","applyGearListSelectors"],cineCoreGuard:["ensureDefaultProjectInfoSnapshot","skipNextGearListRefresh","alignActiveAutoGearPreset","reconcileAutoGearAutoPresetState","openAutoGearEditor","closeAutoGearEditor","saveAutoGearRuleFromEditor","handleAutoGearImportSelection","handleAutoGearPresetSelection","handleAutoGearSavePreset","handleAutoGearDeletePreset","applyAutoGearBackupVisibility","renderAutoGearBackupControls","renderAutoGearBackupRetentionControls","renderAutoGearDraftImpact","renderAutoGearDraftLists","renderAutoGearMonitorDefaultsControls","renderAutoGearPresetsControls","renderAutoGearRulesList","updateAutoGearCameraWeightDraft","updateAutoGearShootingDaysDraft","setAutoGearAutoPresetId","syncAutoGearAutoPreset","updateAutoGearCatalogOptions","updateAutoGearItemButtonState","updateAutoGearMonitorDefaultOptions","applyFavoritesToSelect","updateFavoriteButton","toggleFavorite","loadStoredLogoPreview","renderSettingsLogoPreview","loadFeedbackSafe","saveFeedbackSafe","saveCurrentGearList"],cineCoreExperience:["populateSelect","refreshDeviceLists","hasAnyDeviceSelection","refreshAutoGearCameraOptions","refreshAutoGearCameraWeightCondition","refreshAutoGearMonitorOptions","refreshAutoGearTripodHeadOptions","refreshAutoGearTripodBowlOptions","refreshAutoGearTripodTypesOptions","refreshAutoGearTripodSpreaderOptions","refreshAutoGearWirelessOptions","refreshAutoGearMotorsOptions","refreshAutoGearControllersOptions","refreshAutoGearCrewOptions","refreshAutoGearDistanceOptions","exportAutoGearRules","exportAutoGearPresets","generatePrintableOverview","generateGearListHtml","displayGearAndRequirements","updateGearListButtonVisibility","overviewSectionIcons","scenarioIcons","populateFeatureSearch","restoreFeatureSearchDefaults","updateFeatureSearchValue","updateFeatureSearchSuggestions","featureSearchEntries","featureSearchDefaultOptions","applyAccentColor","clearAccentColorOverrides","updateAccentColorResetButtonState","refreshDarkModeAccentBoost","isHighContrastActive","accentColor","prevAccentColor","revertAccentColor","DEFAULT_ACCENT_COLOR","HIGH_CONTRAST_ACCENT_COLOR","fontSize","fontFamily","applyDarkMode","applyPinkMode","applyHighContrast","setupInstallBanner","ensureZoomRemoteSetup","generateConnectorSummary","diagramConnectorIcons","DIAGRAM_MONITOR_ICON","cameraFizPort","controllerCamPort","controllerDistancePort","checkSetupChanged","getCurrentProjectInfo","setBatteryPlates","getBatteryPlates","setRecordingMedia","getRecordingMedia","runFeatureSearch","featureMap","actionMap","deviceMap","helpMap","featureSearch"]}).forEach(([E,L])=>{const P=f[E];if(!P||typeof P.install!="function")return;const D={};let q=!1;for(let ie=0;ie<L.length;ie+=1){const se=L[ie];Object.prototype.hasOwnProperty.call(Cl,se)&&(D[se]=Cl[se],q=!0)}if(q)try{P.install(D)}catch(ie){try{typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Failed to install exports for ${E}.`,ie)}catch{}}})})();const Al=r||(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null),tu=(function(f){return!f||typeof f!="object"?null:f.cineCoreRuntime&&typeof f.cineCoreRuntime=="object"?f.cineCoreRuntime:Object.isExtensible(f)?(f.cineCoreRuntime={},f.cineCoreRuntime):null})(Al);Object.entries(Cl).forEach(([c,f])=>{Al&&Object.isExtensible(Al)&&(Al[c]=f),tu&&Object.isExtensible(tu)&&(tu[c]=f)}),Io(),El(),typeof module<"u"&&module.exports&&Object.assign(module.exports,{normalizeAutoGearCameraWeightCondition:G,normalizeAutoGearWeightOperator:_,formatAutoGearCameraWeight:B,getAutoGearCameraWeightOperatorLabel:O}),typeof globalThis<"u"?(globalThis.deriveProjectInfo=ac,globalThis.checkSetupChanged=is,globalThis.updateCalculations=ma,globalThis.projectDialog=Ps,globalThis.projectDialogCloseBtn=Gl,globalThis.projectCancelBtn=Tl,globalThis.renderSetupDiagram=ni,globalThis.clearRecordingMedia=al,globalThis.setSliderBowlValue=os,globalThis.setEasyrigValue=Qs,globalThis.clearLensMounts=Vc,globalThis.getCurrentSetupState=as,globalThis.getRecordingMedia=us,globalThis.getBatteryPlates=Gi,globalThis.getViewfinders=Qd,globalThis.renderAutoGearBackupControls=ao,globalThis.renderAutoGearBackupRetentionControls=Qr):typeof window<"u"&&(window.checkSetupChanged=is,window.updateCalculations=ma,window.projectDialog=Ps,window.projectDialogCloseBtn=Gl,window.projectCancelBtn=Tl,window.renderSetupDiagram=ni,window.clearRecordingMedia=al,window.setSliderBowlValue=os,window.setEasyrigValue=Qs,window.clearLensMounts=Vc,window.getCurrentSetupState=as,window.getRecordingMedia=us,window.getBatteryPlates=Gi,window.getViewfinders=Qd,window.renderAutoGearBackupControls=ao,window.renderAutoGearBackupRetentionControls=Qr),console.log("app-core-new-2.js: corePart2Runtime complete")};if(CORE_PART2_RUNTIME_SCOPE)try{Object.defineProperty(CORE_PART2_RUNTIME_SCOPE,"__cineCorePart2Initialized",{configurable:!0,writable:!0,value:!0})}catch{CORE_PART2_RUNTIME_SCOPE.__cineCorePart2Initialized=!0}const t=CORE_PART2_RUNTIME_SCOPE&&CORE_PART2_RUNTIME_SCOPE.__cineCorePart1Runner;typeof t=="function"&&t(e)||e()}function isScope(e){return!!e&&(typeof e=="object"||typeof e=="function")}function readRuntimeModulesThroughRequire(){if(typeof require!="function")return null;try{const e=require("./runtime.js");if(e&&typeof e=="object")return e}catch{}return null}function readRuntimeModulesFromScopes(){const e=[typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let t=0;t<e.length;t+=1){const o=e[t];if(isScope(o))try{const r=o.cineCoreRuntimeModules;if(r&&typeof r=="object")return r}catch{}}return null}function readLoaderFromNamespace(e){if(!e||typeof e!="object")return null;const t=e["modules/core/runtime-module-loader.js"];return t&&typeof t=="object"?t:null}function createFallbackLoader(){const e=Object.prototype.hasOwnProperty;function t(s){const l=[];function u(y){isScope(y)&&l.indexOf(y)===-1&&l.push(y)}const d=s&&s.primaryScope,m=s&&s.candidateScopes;if(u(d),Array.isArray(m))for(let y=0;y<m.length;y+=1)u(m[y]);return typeof globalThis<"u"&&u(globalThis),typeof window<"u"&&u(window),typeof self<"u"&&u(self),typeof global<"u"&&u(global),l}function o(s){if(!isScope(s))return null;try{const l=s.cineCoreRuntimeModules;return l&&typeof l=="object"?l:null}catch{}return null}function r(){if(typeof require!="function")return null;const s=["./runtime.js"];for(let l=0;l<s.length;l+=1){const u=s[l];try{const d=require(u);if(d&&typeof d=="object")return d}catch{}}return null}function n(s){const l=t(s||{});for(let u=0;u<l.length;u+=1){const d=o(l[u]);if(d)return d}return r()}function a(s,l){if(typeof s!="string"||!s)return null;const u=n(l||{});return!u||typeof u!="object"?null:e.call(u,s)?u[s]:null}return{resolveCoreRuntimeModulesNamespace:n,resolveCoreRuntimeModule:a}}let loader=readLoaderFromNamespace(readRuntimeModulesThroughRequire())||readLoaderFromNamespace(readRuntimeModulesFromScopes());try{!loader&&typeof window<"u"&&window.cineCoreRuntimeModuleLoader&&typeof window.cineCoreRuntimeModuleLoader=="object"&&(loader=window.cineCoreRuntimeModuleLoader)}catch(e){}loader||(loader=createFallbackLoader());function isValidScope$1(e){return!!e&&(typeof e=="object"||typeof e=="function")}function isScopeList(e){return!!e&&typeof e.length=="number"}function registerScope(e,t,o){if(Array.isArray(e)&&isValidScope$1(o)){if(t){if(t.has(o))return;t.add(o),e.push(o);return}e.indexOf(o)===-1&&e.push(o)}}function detectFallbackGlobalScope(e){return isValidScope$1(e)?e:typeof globalThis<"u"&&isValidScope$1(globalThis)?globalThis:typeof window<"u"&&isValidScope$1(window)?window:typeof self<"u"&&isValidScope$1(self)?self:typeof global<"u"&&isValidScope$1(global)?global:null}function collectCandidateScopesWithFallback(e,t,o){if(t&&typeof t.collectCandidateScopes=="function")try{const a=t.collectCandidateScopes(e,o);if(Array.isArray(a))return a}catch{}const r=[],n=typeof Set=="function"?new Set:null;return registerScope(r,n,e),registerScope(r,n,typeof globalThis<"u"?globalThis:null),registerScope(r,n,typeof window<"u"?window:null),registerScope(r,n,typeof self<"u"?self:null),registerScope(r,n,typeof global<"u"?global:null),r}function resolveCandidateScopes(e){const t=e&&e.primaryScope,o=e&&e.runtimeShared,r=e&&e.environmentHelpers,n=e&&e.currentCandidateScopes;if(isScopeList(n))return n;let a=null;if(o&&typeof o.resolveCandidateScopes=="function")try{a=o.resolveCandidateScopes(t,r)}catch{a=null}return a||(a=collectCandidateScopesWithFallback(t,o,r)),a}function syncCandidateScopes(e,t){const o=t&&t.runtimeShared,r=t&&t.environmentHelpers,n=t&&t.primaryScope,a=t&&t.globalScope||detectFallbackGlobalScope(n),s=t&&t.assignCurrentCandidateScopes;if(o&&typeof o.syncCandidateScopes=="function")try{return o.syncCandidateScopes(e,n,r),e}catch{}if(isValidScope$1(a)&&(!a.CORE_RUNTIME_CANDIDATE_SCOPES||a.CORE_RUNTIME_CANDIDATE_SCOPES!==e))try{a.CORE_RUNTIME_CANDIDATE_SCOPES=e}catch{}if(typeof s=="function")try{s(e)}catch{}return e}function ensureCandidateScopes(e){const t=resolveCandidateScopes(e||{});return syncCandidateScopes(t,e||{})}const namespace$3={collectCandidateScopesWithFallback,resolveCandidateScopes,syncCandidateScopes,ensureCandidateScopes},globalScope$3=detectFallbackGlobalScope(),targetName$2="cineCoreRuntimeCandidateScopes",existing$2=globalScope$3&&typeof globalScope$3[targetName$2]=="object"?globalScope$3[targetName$2]:{},target$1=existing$2;for(const e of Object.keys(namespace$3))target$1[e]=namespace$3[e];if(isValidScope$1(globalScope$3))try{globalScope$3[targetName$2]=target$1}catch{}function isValidScope(e){return!!e&&(typeof e=="object"||typeof e=="function")}function detectGlobalScope$c(e){return isValidScope(e)?e:typeof globalThis<"u"&&isValidScope(globalThis)?globalThis:typeof window<"u"&&isValidScope(window)?window:typeof self<"u"&&isValidScope(self)?self:typeof global<"u"&&isValidScope(global)?global:null}function toArray$1(e){return e?Array.isArray(e)?e:[e]:[]}function normaliseLanguageInput(e){if(typeof e=="string"&&e)try{const t=String(e).trim().toLowerCase();if(t)return t}catch{}return""}function createLocalizationRuntime(e){const t=e&&typeof e=="object"?e:{},o=t.runtimeScope,r=t.coreGlobalScope,n=detectGlobalScope$c(r||o),a=t.localizationBridge&&typeof t.localizationBridge=="object"?t.localizationBridge:null,s=typeof t.fallbackResolveLocaleModule=="function"?t.fallbackResolveLocaleModule:function(H){return null},l=typeof t.createLocaleFallbacks=="function"?t.createLocaleFallbacks:function(){return null};function u(){if(a&&typeof a.resolveLocaleModule=="function")try{const x=a.resolveLocaleModule(o);if(x&&typeof x=="object")return x}catch{}try{const x=s(o);if(x&&typeof x=="object")return x}catch{}return t.localeModule&&typeof t.localeModule=="object"?t.localeModule:null}const d=u(),m=(function(){if(a&&typeof a.getDefaultLanguage=="function")try{const H=a.getDefaultLanguage(o);if(typeof H=="string"&&H)return H}catch{}return d&&typeof d.DEFAULT_LANGUAGE=="string"?d.DEFAULT_LANGUAGE:typeof t.defaultLanguage=="string"?t.defaultLanguage:"en"})(),y=(function(){if(a&&typeof a.getRtlLanguageCodes=="function")try{const H=a.getRtlLanguageCodes(o);if(Array.isArray(H)&&H.length>0)return H}catch{}return d&&Array.isArray(d.RTL_LANGUAGE_CODES)&&d.RTL_LANGUAGE_CODES.length>0?d.RTL_LANGUAGE_CODES:Array.isArray(t.defaultRtlCodes)?t.defaultRtlCodes:["ar","fa","he","ur"]})(),h=(function(){try{return l({defaultLanguage:m,rtlLanguageCodes:y,localizationFallbackNamespace:t.localizationFallbackNamespace,localizationFallbackSupport:t.localizationFallbackSupport,localizationFallbacks:t.localizationFallbacks,inlineLocalizationFallbacks:t.inlineLocalizationFallbacks})}catch{}return null})(),b=h&&typeof h.normalizeLanguageCode=="function"?function(H){return h.normalizeLanguageCode(H)}:function(H){return normaliseLanguageInput(H)||m},v=h&&typeof h.isRtlLanguage=="function"?function(H){return h.isRtlLanguage(H)}:function(H){const U=b(H).split("-")[0];return y.indexOf(U)!==-1},C=h&&typeof h.resolveDocumentDirection=="function"?function(H){return h.resolveDocumentDirection(H)}:function(H){if(typeof document<"u"&&document&&document.documentElement)try{const W=document.documentElement.getAttribute("dir");if(W)return W}catch{}return v(H)?"rtl":"ltr"},A=h&&typeof h.applyLocaleMetadata=="function"?function(H,W,U){return h.applyLocaleMetadata(H,W,U)}:function(H,W,U){if(H){if(W)try{H.lang=W}catch{}if(U)try{H.dir=U}catch{}}},w=a&&typeof a.normalizeLanguageCode=="function"?function(H){try{return a.normalizeLanguageCode(H,o)}catch{}return b(H)}:b,R=a&&typeof a.isRtlLanguage=="function"?function(H){try{return a.isRtlLanguage(H,o)}catch{}return v(H)}:v,_=a&&typeof a.resolveDocumentDirection=="function"?function(H){try{return a.resolveDocumentDirection(H,o)}catch{}return C(H)}:C,G=a&&typeof a.applyLocaleMetadata=="function"?function(H,W,U){try{return a.applyLocaleMetadata(H,W,U,o)}catch{}return A(H,W,U)}:A,O=toArray$1(t.translationAdditionalScopes).filter(isValidScope);function B(){const x=[],H=typeof Set=="function"?new Set:null;function W(U){if(isValidScope(U)){if(H){if(H.has(U))return;H.add(U),x.push(U);return}x.indexOf(U)===-1&&x.push(U)}}W(o),W(n),W(t.localizationFallbackNamespace),W(t.localizationFallbackSupport);for(let U=0;U<O.length;U+=1)W(O[U]);return W(typeof globalThis<"u"?globalThis:null),W(typeof window<"u"?window:null),W(typeof self<"u"?self:null),W(typeof global<"u"?global:null),x}function $(){const x=B();for(let H=0;H<x.length;H+=1){const W=x[H];if(!W||typeof W!="object")continue;const U=W.texts;if(U&&typeof U=="object")return U}return typeof t.translationsRequirePath=="string"&&t.translationsRequirePath&&t.translationsRequirePath,{}}function V(x){const H=$(),W=typeof m=="string"&&m?m:"en",U=normaliseLanguageInput(x);let j=U&&Object.prototype.hasOwnProperty.call(H,U)?U:"";if(!j&&U){const be=U.split("-")[0];be&&Object.prototype.hasOwnProperty.call(H,be)&&(j=be)}j||(j=W);const Y=H&&j&&typeof H[j]=="object"?H[j]:null;if(Y)return Y;if(j!==W){const be=H&&typeof H[W]=="object"?H[W]:null;if(be)return be}if(H&&typeof H.en=="object")return H.en;const le=H?Object.keys(H):[];if(le.length){const be=le[0],re=H[be];if(re&&typeof re=="object")return re}return{}}function M(){const x=B();for(let H=0;H<x.length;H+=1){const W=x[H];if(!W||typeof W!="object")continue;const U=W.getLanguageTexts;if(typeof U=="function")return U}return null}const F=(function(){const H=M();return H?function(U){try{const j=H.call(null,U);if(j&&typeof j=="object")return j}catch(j){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Existing getLanguageTexts helper failed. Falling back to local resolution.",j)}return V(U)}:function(U){return V(U)}})();function z(){const x=B();for(let H=0;H<x.length;H+=1){const W=x[H];if(!(!W||typeof W!="object")&&typeof W.getLanguageTexts!="function")try{W.getLanguageTexts=F}catch{}}}return z(),{localeModule:d,defaultLanguage:m,rtlLanguageCodes:y,normalizeLanguageCode:w,isRtlLanguage:R,resolveDocumentDirection:_,applyLocaleMetadata:G,getLanguageTexts:F,fallbackNormalizeLanguageCode:b,fallbackIsRtlLanguage:v,fallbackResolveDocumentDirection:C,fallbackApplyLocaleMetadata:A,resolveTranslationDataset:$,ensureGlobalGetLanguageTextsAvailability:z}}const namespace$2={createLocalizationRuntime},globalScope$2=detectGlobalScope$c(),targetName$1="cineCoreRuntimeLocalization",existing$1=globalScope$2&&typeof globalScope$2[targetName$1]=="object"?globalScope$2[targetName$1]:{},target=existing$1;for(const e of Object.keys(namespace$2))target[e]=namespace$2[e];if(isValidScope(globalScope$2))try{globalScope$2[targetName$1]=target}catch{}function detectGlobalScope$b(){return typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:typeof window<"u"&&window&&typeof window=="object"?window:typeof self<"u"&&self&&typeof self=="object"?self:typeof global<"u"&&global&&typeof global=="object"?global:null}const primaryCoreScope$1=typeof globalThis<"u"&&globalThis&&typeof globalThis.CORE_GLOBAL_SCOPE=="object"?globalThis.CORE_GLOBAL_SCOPE:null,CORE_SCOPE$1=primaryCoreScope$1&&typeof primaryCoreScope$1=="object"?primaryCoreScope$1:detectGlobalScope$b(),DEFAULT_DEVICE_SCHEMA_PATH="src/data/schema.json",DEFAULT_DEVICE_SCHEMA_STORAGE_KEY="cameraPowerPlanner_schemaCache",DEVICE_SCHEMA_PATH=CORE_SCOPE$1&&typeof CORE_SCOPE$1=="object"&&typeof CORE_SCOPE$1.DEVICE_SCHEMA_PATH=="string"&&CORE_SCOPE$1.DEVICE_SCHEMA_PATH?CORE_SCOPE$1.DEVICE_SCHEMA_PATH:DEFAULT_DEVICE_SCHEMA_PATH,DEVICE_SCHEMA_STORAGE_KEY=CORE_SCOPE$1&&typeof CORE_SCOPE$1=="object"&&typeof CORE_SCOPE$1.DEVICE_SCHEMA_STORAGE_KEY=="string"&&CORE_SCOPE$1.DEVICE_SCHEMA_STORAGE_KEY?CORE_SCOPE$1.DEVICE_SCHEMA_STORAGE_KEY:DEFAULT_DEVICE_SCHEMA_STORAGE_KEY,schemaStorage=(()=>{if(typeof window>"u")return null;try{if(!("localStorage"in window))return null;const{localStorage:e}=window,t="__schema_cache__";return e.setItem(t,"1"),e.removeItem(t),e}catch(e){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("Device schema cache disabled",e),null}})();function loadCachedDeviceSchema(){if(!schemaStorage)return null;try{const e=schemaStorage.getItem(DEVICE_SCHEMA_STORAGE_KEY);if(!e)return null;const t=JSON.parse(e);return t&&typeof t=="object"&&!Array.isArray(t)?t:null}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to read cached device schema",e);try{schemaStorage.removeItem(DEVICE_SCHEMA_STORAGE_KEY)}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to clear invalid cached device schema",t)}return null}}function persistDeviceSchema(e){if(schemaStorage)try{schemaStorage.setItem(DEVICE_SCHEMA_STORAGE_KEY,JSON.stringify(e))}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to cache device schema",t)}}function isValidDeviceSchema(e){return!!e&&typeof e=="object"&&!Array.isArray(e)}async function loadDeviceSchemaFromCacheStorage(e=DEVICE_SCHEMA_PATH){if(typeof caches>"u"||!caches||typeof caches.match!="function")return null;const t=new Set([e]);if(typeof e=="string"&&!e.startsWith("./")&&t.add(`./${e}`),typeof window<"u"&&window&&window.location)try{t.add(new URL(e,window.location.href).toString())}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to resolve schema.json cache URL",o)}for(const o of t)try{const r=await caches.match(o,{ignoreSearch:!0});if(r)return await r.clone().json()}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to read schema.json from cache entry",o,r)}return null}function createPopulateScheduler(e){return function(){const o=()=>{try{e()}catch(r){typeof console<"u"&&typeof console.error=="function"&&console.error("populateCategoryOptions failed during scheduled execution",r)}};typeof window<"u"&&window&&typeof window.setTimeout=="function"?window.setTimeout(o,0):typeof setTimeout=="function"?setTimeout(o,0):o()}}function createDeviceSchemaManager(e={}){const t=e&&typeof e.onSchemaChange=="function"?e.onSchemaChange:()=>{},o=e&&typeof e.populateCategoryOptions=="function"?e.populateCategoryOptions:()=>{const u=detectGlobalScope$b();if(!u)return;let d=null;const m=e&&typeof e.populateCategoryOptionsName=="string"?e.populateCategoryOptionsName:"populateCategoryOptions";if(m&&typeof u[m]=="function"?d=u[m]:typeof u.populateCategoryOptions=="function"&&(d=u.populateCategoryOptions),d)try{d()}catch(y){typeof console<"u"&&typeof console.error=="function"&&console.error("populateCategoryOptions execution failed",y)}};let r=loadCachedDeviceSchema(),n=r&&isValidDeviceSchema(r)?r:null;t(n);const a=createPopulateScheduler(o);function s(u){return isValidDeviceSchema(u)?(n=u,r=u):n||(n={}),t(n),n}function l(u){isValidDeviceSchema(u)?(s(u),persistDeviceSchema(u)):n||s(r||{}),a()}return{DEVICE_SCHEMA_PATH,DEVICE_SCHEMA_STORAGE_KEY,loadCachedDeviceSchema,persistDeviceSchema,isValidDeviceSchema,loadDeviceSchemaFromCacheStorage,schedulePopulateCategoryOptions:a,finalizeDeviceSchemaLoad:l,getCachedDeviceSchema:()=>r&&isValidDeviceSchema(r)?r:null,getDeviceSchema:()=>n,setDeviceSchema:s}}const namespace$1={DEVICE_SCHEMA_PATH,DEVICE_SCHEMA_STORAGE_KEY,loadCachedDeviceSchema,persistDeviceSchema,isValidDeviceSchema,loadDeviceSchemaFromCacheStorage,createDeviceSchemaManager},globalScope$1=detectGlobalScope$b(),targetName="cineCoreDeviceSchema",aliasName="CORE_DEVICE_SCHEMA";let existingAlias=null;if(globalScope$1&&(typeof globalScope$1=="object"||typeof globalScope$1=="function"))try{const e=globalScope$1[aliasName];e&&typeof e=="object"&&(existingAlias=e)}catch{existingAlias=null}let existing=existingAlias;if((!existing||typeof existing!="object")&&globalScope$1&&(typeof globalScope$1=="object"||typeof globalScope$1=="function"))try{const e=globalScope$1[targetName];e&&typeof e=="object"&&(existing=e)}catch{existing=null}(!existing||typeof existing!="object")&&(existing={});for(const e of Object.keys(namespace$1))existing[e]=namespace$1[e];if(globalScope$1&&(typeof globalScope$1=="object"||typeof globalScope$1=="function")){try{globalScope$1[targetName]=existing}catch{}try{globalScope$1[aliasName]=existing}catch{}}const GLOBAL_SCOPE$d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:global,PINK_MODE_ANIMATED_ICON_FILES=Object.freeze(["src/animations/unicorn.json","src/animations/pink-mode/dog.json","src/animations/pink-mode/fox-2.json","src/animations/pink-mode/fox-3.json","src/animations/pink-mode/fox.json","src/animations/pink-mode/horse.json","src/animations/pink-mode/mountains.json","src/animations/pink-mode/movie-camera.json","src/animations/pink-mode/pinata.json","src/animations/pink-mode/script.json","src/animations/pink-mode/video-camera.json"]);function ensurePinkModeLottieRuntime$1(){return GLOBAL_SCOPE$d.lottie?Promise.resolve(GLOBAL_SCOPE$d.lottie):GLOBAL_SCOPE$d.bodymovin?Promise.resolve(GLOBAL_SCOPE$d.bodymovin):document.querySelector('script[data-loader="pink-mode-lottie"]')?new Promise(e=>{const t=document.querySelector('script[data-loader="pink-mode-lottie"]');t.dataset.loaded==="true"?e(GLOBAL_SCOPE$d.lottie):t.addEventListener("load",()=>e(GLOBAL_SCOPE$d.lottie),{once:!0})}):new Promise((e,t)=>{const o=document.createElement("script");o.src="src/vendor/lottie.min.js",o.async=!0,o.setAttribute("data-loader","pink-mode-lottie"),o.onload=()=>{o.dataset.loaded="true",e(GLOBAL_SCOPE$d.lottie)},o.onerror=t,document.head.appendChild(o)})}class PinkModeManager{constructor(){this.active=!1}activate(){this.active=!0,document.body.classList.add("pink-mode-active")}deactivate(){this.active=!1,document.body.classList.remove("pink-mode-active")}triggerRain(){}}const manager=new PinkModeManager,HORSE_SVG_MARKUP='<svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="m1 40c0-8 3-17 3-17a4.84 4.84 0 0 0-1.829-3.064 1 1 0 0 1 .45-1.716 19.438 19.438 0 0 1 4.379-.22c.579-2.317-1.19-3.963-2.782-4.938a1 1 0 0 1 .393-1.85 14.128 14.128 0 0 1 6.389.788c0-.958-1.147-2.145-2.342-3.122a1 1 0 0 1 .708-1.773 40.655 40.655 0 0 1 6.634.895 3.723 3.723 0 0 0-1.049-2.264 1 1 0 0 1 .823-1.652c6.151.378 9.226 1.916 9.226 1.916l10-1s8.472-2.311 15.954.5a1 1 0 0 1-.084 1.9c-1.455.394-2.87 1.143-2.87 2.6 0 0 4.426.738 5.675 4.114a1 1 0 0 1-1.228 1.317c-1.64-.48-4.273-.88-6.447.569Z" fill="#805333" /><path d="m30.18 42.82c1.073 2.7 2.6 9.993 3.357 13.8a2 2 0 0 1-1.964 2.38h-28.573a2 2 0 0 1-2-2v-18c0-2.55 10.03-22.11 23.99-23.87Z" fill="#a56a43" /><path d="m55.67 48.46-6.34 2.97a6 6 0 0 1-7.98-2.88l-.25-.54-.76-1.6a4.956 4.956 0 0 0-4.68-2.87c-.22.01-.44.02-.66.02a16.019 16.019 0 0 1-8.28-29.66c-1.81-2.97-3.45-8.03 2.03-12.49a2.1 2.1 0 0 1 2.5 0c4.23 3.45 4.21 7.25 3.16 10.17a16 16 0 0 1 15.91 11.36l5.31 11.31 2.92 6.22a6.008 6.008 0 0 1-2.88 7.99Z" fill="#cb8252" /><circle cx="42" cy="26" r="3" fill="#2c2f38" /><circle cx="54" cy="43" r="1" fill="#805333" /><path d="m58.55 40.47-2.92-6.22-14.53 13.76.25.54a6 6 0 0 0 7.98 2.88l6.34-2.97a6.008 6.008 0 0 0 2.88-7.99Zm-4.55 3.53a1 1 0 1 1 1-1 1 0 0 1-1 1Z" fill="#cf976a" /><circle cx="41" cy="25" r="1.25" fill="#ecf0f1" /></svg>',HORN_MARKUP='<path d="M44 19 L56 5 L49 22 Z" fill="#ffd700" />',UNICORN_BASE_MARKUP=HORSE_SVG_MARKUP.replace("</svg>",HORN_MARKUP+"</svg>"),UNICORN_1_MARKUP=UNICORN_BASE_MARKUP.replace(/#805333/g,"#d63384").replace(/#a56a43/g,"#e83e8c").replace(/#cb8252/g,"#fd7e14").replace(/#cf976a/g,"#ffc0cb"),UNICORN_2_MARKUP=UNICORN_BASE_MARKUP.replace(/#805333/g,"#6f42c1").replace(/#a56a43/g,"#d63384").replace(/#cb8252/g,"#e83e8c").replace(/#cf976a/g,"#e0cffc"),UNICORN_3_MARKUP=UNICORN_BASE_MARKUP.replace(/#805333/g,"#0dcaf0").replace(/#a56a43/g,"#6f42c1").replace(/#cb8252/g,"#d63384").replace(/#cf976a/g,"#9ec5fe"),PINK_MODE_TOGGLE_SEQUENCE=[{className:"icon-svg pink-mode-icon",markup:UNICORN_1_MARKUP,lottiePath:"src/animations/horn.json"},{className:"icon-svg pink-mode-icon",markup:UNICORN_2_MARKUP,lottiePath:"src/animations/unicorn.json"},{className:"icon-svg pink-mode-icon",markup:UNICORN_3_MARKUP,lottiePath:"src/animations/rainbow.json"}],icons={off:{className:"icon-svg pink-mode-icon",markup:HORSE_SVG_MARKUP},onSequence:PINK_MODE_TOGGLE_SEQUENCE},pinkModeIcons$1=icons,ensureSvgHasAriaHidden$1=e=>e,setPinkModeIconSequence=()=>{},loadPinkModeIconsFromFiles=()=>Promise.resolve(),ensurePinkModeLottieRuntimeExport=ensurePinkModeLottieRuntime$1,resolvePinkModeLottieRuntime=()=>GLOBAL_SCOPE$d.lottie,startPinkModeAnimatedIcons=()=>manager.activate(),stopPinkModeAnimatedIcons$1=()=>manager.deactivate(),triggerPinkModeIconRain=()=>{},startPinkModeIconPreload=()=>{},PINK_MODE_ICON_INTERVAL_MS=3e4,PINK_MODE_ICON_ANIMATION_CLASS="pink-mode-icon-pop",PINK_MODE_ICON_ANIMATION_RESET_DELAY=450,PINK_MODE_ICON_FALLBACK_MARKUP=[],PinkModeAnimations=Object.freeze(Object.defineProperty({__proto__:null,PINK_MODE_ANIMATED_ICON_FILES,PINK_MODE_ICON_ANIMATION_CLASS,PINK_MODE_ICON_ANIMATION_RESET_DELAY,PINK_MODE_ICON_FALLBACK_MARKUP,PINK_MODE_ICON_INTERVAL_MS,PinkModeManager,ensurePinkModeLottieRuntimeExport,ensureSvgHasAriaHidden:ensureSvgHasAriaHidden$1,loadPinkModeIconsFromFiles,pinkModeIcons:pinkModeIcons$1,resolvePinkModeLottieRuntime,setPinkModeIconSequence,startPinkModeAnimatedIcons,startPinkModeIconPreload,stopPinkModeAnimatedIcons:stopPinkModeAnimatedIcons$1,triggerPinkModeIconRain},Symbol.toStringTag,{value:"Module"}));function detectScope(){return typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:typeof window<"u"&&window&&typeof window=="object"?window:typeof self<"u"&&self&&typeof self=="object"?self:typeof global<"u"&&global&&typeof global=="object"?global:null}function isObject(e){return!!e&&(typeof e=="object"||typeof e=="function")}function createFallbackSupport(){const e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:global;function t(l){return typeof Promise<"u"&&typeof Promise.resolve=="function"?Promise.resolve(l):{then:u=>t(u?u(l):l),catch:()=>this}}function o(){return e.lottie?t(e.lottie):e.bodymovin?t(e.bodymovin):typeof document>"u"?t(null):document.querySelector('script[data-loader="pink-mode-lottie"]')?new Promise(l=>{const u=document.querySelector('script[data-loader="pink-mode-lottie"]');u.dataset.loaded==="true"?l(e.lottie):u.addEventListener("load",()=>l(e.lottie),{once:!0})}):new Promise(l=>{const u=document.createElement("script");u.src="src/vendor/lottie.min.js",u.async=!0,u.setAttribute("data-loader","pink-mode-lottie"),u.onload=()=>{u.dataset.loaded="true",l(e.lottie)},u.onerror=()=>{l(null)},document.head.appendChild(u)})}class r{constructor(){this.active=!1}activate(){this.active=!0,document.body.classList.add("pink-mode-active")}deactivate(){this.active=!1,document.body.classList.remove("pink-mode-active")}triggerRain(){}}const n=new r,s=Object.freeze({off:Object.freeze({className:"icon-svg pink-mode-icon",markup:'<svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="m1 40c0-8 3-17 3-17a4.84 4.84 0 0 0-1.829-3.064 1 1 0 0 1 .45-1.716 19.438 19.438 0 0 1 4.379-.22c.579-2.317-1.19-3.963-2.782-4.938a1 1 0 0 1 .393-1.85 14.128 14.128 0 0 1 6.389.788c0-.958-1.147-2.145-2.342-3.122a1 1 0 0 1 .708-1.773 40.655 40.655 0 0 1 6.634.895 3.723 3.723 0 0 0-1.049-2.264 1 1 0 0 1 .823-1.652c6.151.378 9.226 1.916 9.226 1.916l10-1s8.472-2.311 15.954.5a1 1 0 0 1-.084 1.9c-1.455.394-2.87 1.143-2.87 2.6 0 0 4.426.738 5.675 4.114a1 1 0 0 1-1.228 1.317c-1.64-.48-4.273-.88-6.447.569Z" fill="#805333" /><path d="m30.18 42.82c1.073 2.7 2.6 9.993 3.357 13.8a2 2 0 0 1-1.964 2.38h-28.573a2 2 0 0 1-2-2v-18c0-2.55 10.03-22.11 23.99-23.87Z" fill="#a56a43" /><path d="m55.67 48.46-6.34 2.97a6 6 0 0 1-7.98-2.88l-.25-.54-.76-1.6a4.956 4.956 0 0 0-4.68-2.87c-.22.01-.44.02-.66.02a16.019 16.019 0 0 1-8.28-29.66c-1.81-2.97-3.45-8.03 2.03-12.49a2.1 2.1 0 0 1 2.5 0c4.23 3.45 4.21 7.25 3.16 10.17a16 16 0 0 1 15.91 11.36l5.31 11.31 2.92 6.22a6.008 6.008 0 0 1-2.88 7.99Z" fill="#cb8252" /><circle cx="42" cy="26" r="3" fill="#2c2f38" /><circle cx="54" cy="43" r="1" fill="#805333" /><path d="m58.55 40.47-2.92-6.22-14.53 13.76.25.54a6 6 0 0 0 7.98 2.88l6.34-2.97a6.008 6.008 0 0 0 2.88-7.99Zm-4.55 3.53a1 1 0 1 1 1-1 1 0 0 1-1 1Z" fill="#cf976a" /><circle cx="41" cy="25" r="1.25" fill="#ecf0f1" /></svg>'}),onSequence:Object.freeze(pinkModeIcons$1.onSequence)});return{pinkModeIcons:s,ensureSvgHasAriaHidden:l=>typeof l=="string"?l.trim():"",setPinkModeIconSequence:()=>!1,loadPinkModeIconsFromFiles(){return t(s)},ensurePinkModeLottieRuntime:o,resolvePinkModeLottieRuntime(){return o()},startPinkModeAnimatedIcons:()=>n.activate(),stopPinkModeAnimatedIcons:()=>n.deactivate(),triggerPinkModeIconRain:()=>{},startPinkModeIconPreload:()=>{},getPinkModeIconRotationTimer:()=>null,setPinkModeIconRotationTimer:()=>{},getPinkModeIconIndex:()=>0,setPinkModeIconIndex:()=>{},PINK_MODE_ICON_INTERVAL_MS:3e4,PINK_MODE_ICON_ANIMATION_CLASS:"pink-mode-icon-pop",PINK_MODE_ICON_ANIMATION_RESET_DELAY:450,PINK_MODE_ICON_FALLBACK_MARKUP:[]}}function resolvePinkModeAnimations(e){return typeof cineCorePinkModeAnimations<"u"&&isObject(cineCorePinkModeAnimations)?cineCorePinkModeAnimations:e&&isObject(e.cineCorePinkModeAnimations)?e.cineCorePinkModeAnimations:PinkModeAnimations}function resolvePinkModeSupport(e){const t=createFallbackSupport(),o=resolvePinkModeAnimations(e);return isObject(o)?{pinkModeIcons:isObject(o.pinkModeIcons)?o.pinkModeIcons:t.pinkModeIcons,ensureSvgHasAriaHidden:typeof o.ensureSvgHasAriaHidden=="function"?o.ensureSvgHasAriaHidden:t.ensureSvgHasAriaHidden,setPinkModeIconSequence:typeof o.setPinkModeIconSequence=="function"?o.setPinkModeIconSequence:t.setPinkModeIconSequence,loadPinkModeIconsFromFiles:typeof o.loadPinkModeIconsFromFiles=="function"?o.loadPinkModeIconsFromFiles:t.loadPinkModeIconsFromFiles,ensurePinkModeLottieRuntime:typeof o.ensurePinkModeLottieRuntime=="function"?o.ensurePinkModeLottieRuntime:t.ensurePinkModeLottieRuntime,resolvePinkModeLottieRuntime:typeof o.resolvePinkModeLottieRuntime=="function"?o.resolvePinkModeLottieRuntime:t.resolvePinkModeLottieRuntime,startPinkModeAnimatedIcons:typeof o.startPinkModeAnimatedIcons=="function"?o.startPinkModeAnimatedIcons:t.startPinkModeAnimatedIcons,stopPinkModeAnimatedIcons:typeof o.stopPinkModeAnimatedIcons=="function"?o.stopPinkModeAnimatedIcons:t.stopPinkModeAnimatedIcons,triggerPinkModeIconRain:typeof o.triggerPinkModeIconRain=="function"?o.triggerPinkModeIconRain:t.triggerPinkModeIconRain,startPinkModeIconPreload:typeof o.startPinkModeIconPreload=="function"?o.startPinkModeIconPreload:t.startPinkModeIconPreload,getPinkModeIconRotationTimer:typeof o.getPinkModeIconRotationTimer=="function"?o.getPinkModeIconRotationTimer:t.getPinkModeIconRotationTimer,setPinkModeIconRotationTimer:typeof o.setPinkModeIconRotationTimer=="function"?o.setPinkModeIconRotationTimer:t.setPinkModeIconRotationTimer,getPinkModeIconIndex:typeof o.getPinkModeIconIndex=="function"?o.getPinkModeIconIndex:t.getPinkModeIconIndex,setPinkModeIconIndex:typeof o.setPinkModeIconIndex=="function"?o.setPinkModeIconIndex:t.setPinkModeIconIndex,PINK_MODE_ICON_INTERVAL_MS:typeof o.PINK_MODE_ICON_INTERVAL_MS=="number"?o.PINK_MODE_ICON_INTERVAL_MS:t.PINK_MODE_ICON_INTERVAL_MS,PINK_MODE_ICON_ANIMATION_CLASS:typeof o.PINK_MODE_ICON_ANIMATION_CLASS=="string"?o.PINK_MODE_ICON_ANIMATION_CLASS:t.PINK_MODE_ICON_ANIMATION_CLASS,PINK_MODE_ICON_ANIMATION_RESET_DELAY:typeof o.PINK_MODE_ICON_ANIMATION_RESET_DELAY=="number"?o.PINK_MODE_ICON_ANIMATION_RESET_DELAY:t.PINK_MODE_ICON_ANIMATION_RESET_DELAY,PINK_MODE_ICON_FALLBACK_MARKUP:Array.isArray(o.PINK_MODE_ICON_FALLBACK_MARKUP)?o.PINK_MODE_ICON_FALLBACK_MARKUP:t.PINK_MODE_ICON_FALLBACK_MARKUP}:t}const scope$2=detectScope(),support=resolvePinkModeSupport(scope$2),api={resolvePinkModeSupport(){return support},createFallbackSupport,pinkModeIcons:support.pinkModeIcons,ensureSvgHasAriaHidden:support.ensureSvgHasAriaHidden,setPinkModeIconSequence:support.setPinkModeIconSequence,loadPinkModeIconsFromFiles:support.loadPinkModeIconsFromFiles,ensurePinkModeLottieRuntime:support.ensurePinkModeLottieRuntime,resolvePinkModeLottieRuntime:support.resolvePinkModeLottieRuntime,startPinkModeAnimatedIcons:support.startPinkModeAnimatedIcons,stopPinkModeAnimatedIcons:support.stopPinkModeAnimatedIcons,triggerPinkModeIconRain:support.triggerPinkModeIconRain,startPinkModeIconPreload:support.startPinkModeIconPreload||function(){},getPinkModeIconRotationTimer:support.getPinkModeIconRotationTimer,setPinkModeIconRotationTimer:support.setPinkModeIconRotationTimer,getPinkModeIconIndex:support.getPinkModeIconIndex,setPinkModeIconIndex:support.setPinkModeIconIndex,PINK_MODE_ICON_INTERVAL_MS:support.PINK_MODE_ICON_INTERVAL_MS,PINK_MODE_ICON_ANIMATION_CLASS:support.PINK_MODE_ICON_ANIMATION_CLASS,PINK_MODE_ICON_ANIMATION_RESET_DELAY:support.PINK_MODE_ICON_ANIMATION_RESET_DELAY,PINK_MODE_ICON_FALLBACK_MARKUP:support.PINK_MODE_ICON_FALLBACK_MARKUP};scope$2&&isObject(scope$2)&&(scope$2.cineCorePinkModeSupport=api);function detectGlobalScope$a(){return typeof globalThis<"u"&&globalThis&&typeof globalThis=="object"?globalThis:typeof window<"u"&&window&&typeof window=="object"?window:typeof self<"u"&&self&&typeof self=="object"?self:typeof global<"u"&&global&&typeof global=="object"?global:null}const primaryCoreScope=typeof globalThis<"u"&&globalThis&&typeof globalThis.CORE_GLOBAL_SCOPE=="object"?globalThis.CORE_GLOBAL_SCOPE:null,CORE_SCOPE=primaryCoreScope&&typeof primaryCoreScope=="object"?primaryCoreScope:detectGlobalScope$a(),MOUNT_VOLTAGE_STORAGE_KEY_FALLBACK="cameraPowerPlanner_mountVoltages";let cachedMountVoltagePrimaryKey="",cachedMountVoltageBackupKey="",mountVoltageKeysResolved=!1;const readGlobalMountVoltageKey=e=>{if(!CORE_SCOPE||typeof CORE_SCOPE!="object")return"";const t=CORE_SCOPE[e];return typeof t=="string"&&t?t:""},assignGlobalMountVoltageKey=(e,t)=>{if(!CORE_SCOPE||typeof CORE_SCOPE!="object"||typeof t!="string"||!t)return;let o=null;try{o=Object.getOwnPropertyDescriptor(CORE_SCOPE,e)}catch{o=null}if(!(o&&o.configurable===!1&&o.writable===!1))try{CORE_SCOPE[e]=t}catch{}},resolveMountVoltageStorageKeys=()=>{if(mountVoltageKeysResolved)return;let e=readGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_KEY")||readGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_KEY_RESOLVED");if(!e&&typeof getMountVoltageStorageKeyName=="function")try{const o=getMountVoltageStorageKeyName();typeof o=="string"&&o&&(e=o)}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve mount voltage storage key name",o)}!e&&typeof MOUNT_VOLTAGE_STORAGE_KEY_NAME=="string"&&MOUNT_VOLTAGE_STORAGE_KEY_NAME&&(e=MOUNT_VOLTAGE_STORAGE_KEY_NAME),e||(e=MOUNT_VOLTAGE_STORAGE_KEY_FALLBACK);let t=readGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_BACKUP_KEY")||readGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_BACKUP_KEY_RESOLVED");if(!t&&typeof getMountVoltageStorageBackupKeyName=="function")try{const o=getMountVoltageStorageBackupKeyName();typeof o=="string"&&o&&(t=o)}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve mount voltage storage backup key name",o)}t||(t=`${e}__backup`),cachedMountVoltagePrimaryKey=e||MOUNT_VOLTAGE_STORAGE_KEY_FALLBACK,cachedMountVoltageBackupKey=t||`${cachedMountVoltagePrimaryKey}__backup`,mountVoltageKeysResolved=!0,assignGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_KEY",cachedMountVoltagePrimaryKey),assignGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_KEY_RESOLVED",cachedMountVoltagePrimaryKey),assignGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_BACKUP_KEY",cachedMountVoltageBackupKey),assignGlobalMountVoltageKey("MOUNT_VOLTAGE_STORAGE_BACKUP_KEY_RESOLVED",cachedMountVoltageBackupKey)},getMountVoltagePrimaryStorageKey=()=>(resolveMountVoltageStorageKeys(),cachedMountVoltagePrimaryKey||MOUNT_VOLTAGE_STORAGE_KEY_FALLBACK),getMountVoltageBackupStorageKey=()=>(resolveMountVoltageStorageKeys(),cachedMountVoltageBackupKey||`${getMountVoltagePrimaryStorageKey()}__backup`),SUPPORTED_MOUNT_VOLTAGE_TYPES$1=(function e(){if(CORE_SCOPE&&Array.isArray(CORE_SCOPE.SUPPORTED_MOUNT_VOLTAGE_TYPES)&&CORE_SCOPE.SUPPORTED_MOUNT_VOLTAGE_TYPES.length>0)return CORE_SCOPE.SUPPORTED_MOUNT_VOLTAGE_TYPES;const t=Object.freeze(["V-Mount","Gold-Mount","B-Mount"]);if(CORE_SCOPE&&typeof CORE_SCOPE=="object")try{CORE_SCOPE.SUPPORTED_MOUNT_VOLTAGE_TYPES=t}catch{}return t})(),DEFAULT_MOUNT_VOLTAGES$1=(function e(){if(CORE_SCOPE&&CORE_SCOPE.DEFAULT_MOUNT_VOLTAGES&&typeof CORE_SCOPE.DEFAULT_MOUNT_VOLTAGES=="object")return CORE_SCOPE.DEFAULT_MOUNT_VOLTAGES;const t=Object.freeze({"V-Mount":Object.freeze({high:14.4,low:12}),"Gold-Mount":Object.freeze({high:14.4,low:12}),"B-Mount":Object.freeze({high:33.6,low:21.6})});if(CORE_SCOPE&&typeof CORE_SCOPE=="object")try{CORE_SCOPE.DEFAULT_MOUNT_VOLTAGES=t}catch{}return t})(),TOTAL_CURRENT_LABEL_FALLBACK="Total Current (at {voltage}V):",TOTAL_CURRENT_HELP_HIGH_FALLBACK="Current draw at the battery's main output ({voltage}V).",TOTAL_CURRENT_HELP_LOW_FALLBACK="Current draw at auxiliary outputs ({voltage}V).";function parseVoltageValue(e,t){let o=Number.NaN;if(typeof e=="number")o=e;else if(typeof e=="string"){const n=e.replace(",",".");o=Number.parseFloat(n)}if(!Number.isFinite(o)||o<=0)return t;const r=Math.min(1e3,Math.max(.1,o));return Math.round(r*100)/100}function cloneMountVoltageMap(e=DEFAULT_MOUNT_VOLTAGES$1){const t={};return SUPPORTED_MOUNT_VOLTAGE_TYPES$1.forEach(o=>{const r=e&&e[o]?e[o]:DEFAULT_MOUNT_VOLTAGES$1[o],n=parseVoltageValue(r&&r.high,DEFAULT_MOUNT_VOLTAGES$1[o].high),a=parseVoltageValue(r&&r.low,DEFAULT_MOUNT_VOLTAGES$1[o].low);t[o]={high:n,low:a}}),t}function normalizeMountVoltageSource(e){return cloneMountVoltageMap(!e||typeof e!="object"?DEFAULT_MOUNT_VOLTAGES$1:e)}function parseStoredMountVoltages$1(e){if(!e)return null;try{if(typeof e=="string"){const t=JSON.parse(e);return normalizeMountVoltageSource(t)}return normalizeMountVoltageSource(e)}catch(t){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not parse stored mount voltages",t),null}}function getDefaultMountKey(e){return SUPPORTED_MOUNT_VOLTAGE_TYPES$1.includes(e)?e:"V-Mount"}let mountVoltagePreferences$1=cloneMountVoltageMap(DEFAULT_MOUNT_VOLTAGES$1),mountVoltageInputs=null,mountVoltageSectionElem=null,mountVoltageHeadingElem=null,mountVoltageDescriptionElem=null,mountVoltageNoteElem=null,mountVoltageResetButton=CORE_SCOPE&&CORE_SCOPE.mountVoltageResetButton?CORE_SCOPE.mountVoltageResetButton:typeof globalThis<"u"&&globalThis&&globalThis.mountVoltageResetButton?globalThis.mountVoltageResetButton:null,mountVoltageTitleElems=null;function syncMountVoltageResetButtonGlobal$1(e){const t=CORE_SCOPE||detectGlobalScope$a();if(!(!t||typeof t!="object"))try{t.mountVoltageResetButton=e}catch{t.mountVoltageResetButton=e}}function syncMountVoltageInputsGlobal(e){const t=CORE_SCOPE||detectGlobalScope$a();if(!(!t||typeof t!="object"))try{t.mountVoltageInputs=e}catch{t.mountVoltageInputs=e}}syncMountVoltageResetButtonGlobal$1(mountVoltageResetButton);syncMountVoltageInputsGlobal(mountVoltageInputs);function getMountVoltageConfig$1(e){const t=getDefaultMountKey(e),o=mountVoltagePreferences$1[t]||DEFAULT_MOUNT_VOLTAGES$1[t];return{high:parseVoltageValue(o&&o.high,DEFAULT_MOUNT_VOLTAGES$1[t].high),low:parseVoltageValue(o&&o.low,DEFAULT_MOUNT_VOLTAGES$1[t].low)}}function getActiveMountVoltageConfig(){const e=typeof getSelectedPlate=="function"?getSelectedPlate():"V-Mount";return getMountVoltageConfig$1(e)}function getMountVoltagePreferencesClone(){return cloneMountVoltageMap(mountVoltagePreferences$1)}function persistMountVoltagePreferences(e){if(typeof localStorage>"u")return;let t;try{t=JSON.stringify(e)}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not serialize mount voltage preferences",n);return}const o=getMountVoltagePrimaryStorageKey();try{localStorage.setItem(o,t)}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not save mount voltage preferences",n)}const r=getMountVoltageBackupStorageKey();try{localStorage.setItem(r,t)}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not save mount voltage backup copy",n)}}function formatVoltageForDisplay(e,t){const r=typeof t=="string"?t:typeof currentLang=="string"?currentLang:"en",n=Number(e);if(!Number.isFinite(n))return"";const a={maximumFractionDigits:2,minimumFractionDigits:n%1===0?0:1};if(typeof formatNumberForLang=="function")try{return formatNumberForLang(r,n,a)}catch(s){typeof console<"u"&&typeof console.warn=="function"&&console.warn("formatNumberForLang failed for voltage display",s)}try{return new Intl.NumberFormat(r,a).format(n)}catch{}return`${n}`}function formatVoltageInputValue(e){return Number.isFinite(e)?String(Math.round(Number(e)*100)/100):""}function updateMountVoltageInputsFromState$1(){if(!mountVoltageInputs)return;const e=mountVoltagePreferences$1||DEFAULT_MOUNT_VOLTAGES$1;SUPPORTED_MOUNT_VOLTAGE_TYPES$1.forEach(t=>{const o=mountVoltageInputs[t];if(!o)return;const r=e[t]||DEFAULT_MOUNT_VOLTAGES$1[t];o.high&&(o.high.value=formatVoltageInputValue(r&&r.high)),o.low&&(o.low.value=formatVoltageInputValue(r&&r.low))})}function getTemplateString(e,t,o){const r=typeof getLanguageTexts=="function"?getLanguageTexts(e):null,n=typeof getLanguageTexts=="function"&&typeof DEFAULT_LANGUAGE<"u"?getLanguageTexts(DEFAULT_LANGUAGE):null;return r&&typeof r[t]=="string"?r[t]:n&&typeof n[t]=="string"?n[t]:o}function renderVoltageTemplate(e,t,o,r){const n=formatVoltageForDisplay(t,o),a=typeof e=="string"&&e.includes("{voltage}")?e:r;return typeof a!="string"?n?`${n} V`:"":a.replace("{voltage}",n)}function refreshTotalCurrentLabels$1(e,t,o){if(typeof document>"u")return;const n=typeof e=="string"?e:typeof currentLang=="string"?currentLang:"en",a=document.getElementById("totalCurrent144Label"),s=document.getElementById("totalCurrent12Label");if(!a||!s)return;const l=t||(typeof getSelectedPlate=="function"?getSelectedPlate():"V-Mount"),u=o||getMountVoltageConfig$1(l),d=getTemplateString(n,"totalCurrentHighLabelTemplate",TOTAL_CURRENT_LABEL_FALLBACK),m=getTemplateString(n,"totalCurrentLowLabelTemplate",TOTAL_CURRENT_LABEL_FALLBACK),y=getTemplateString(n,"totalCurrentHighHelpTemplate",TOTAL_CURRENT_HELP_HIGH_FALLBACK),h=getTemplateString(n,"totalCurrentLowHelpTemplate",TOTAL_CURRENT_HELP_LOW_FALLBACK);a.textContent=renderVoltageTemplate(d,u.high,n,TOTAL_CURRENT_LABEL_FALLBACK),s.textContent=renderVoltageTemplate(m,u.low,n,TOTAL_CURRENT_LABEL_FALLBACK),a.setAttribute("data-help",renderVoltageTemplate(y,u.high,n,TOTAL_CURRENT_HELP_HIGH_FALLBACK)),s.setAttribute("data-help",renderVoltageTemplate(h,u.low,n,TOTAL_CURRENT_HELP_LOW_FALLBACK))}typeof console<"u"&&console.log("mount-voltage.js: refreshTotalCurrentLabels defined");CORE_SCOPE&&typeof CORE_SCOPE=="object"&&(CORE_SCOPE.refreshTotalCurrentLabels=refreshTotalCurrentLabels$1);typeof globalThis<"u"&&globalThis?(globalThis.refreshTotalCurrentLabels=refreshTotalCurrentLabels$1,globalThis.updateMountVoltageSettingLabels=updateMountVoltageSettingLabels$1):typeof window<"u"&&window&&(window.refreshTotalCurrentLabels=refreshTotalCurrentLabels$1,window.updateMountVoltageSettingLabels=updateMountVoltageSettingLabels$1);function updateMountVoltageSettingLabels$1(e){const t=typeof DEFAULT_LANGUAGE=="string"?DEFAULT_LANGUAGE:"en",o=typeof e=="string"?e:typeof currentLang=="string"?currentLang:"en",r=typeof getLanguageTexts=="function"?getLanguageTexts(o):null,n=typeof getLanguageTexts=="function"?getLanguageTexts(t):null;if(!(!r&&!n)){if(mountVoltageHeadingElem){mountVoltageHeadingElem.textContent=r&&r.mountVoltageSettingsHeading||n&&n.mountVoltageSettingsHeading||"Battery mount voltages";const a=r&&r.mountVoltageSettingsHelp||n&&n.mountVoltageSettingsHelp||"";a&&mountVoltageHeadingElem.setAttribute("data-help",a)}if(mountVoltageDescriptionElem&&(mountVoltageDescriptionElem.textContent=r&&r.mountVoltageDescription||n&&n.mountVoltageDescription||""),mountVoltageNoteElem&&(mountVoltageNoteElem.textContent=r&&r.mountVoltageNote||texts&&texts.en&&texts.en.mountVoltageNote||""),mountVoltageResetButton){mountVoltageResetButton.textContent=r&&r.mountVoltageReset||texts&&texts.en&&texts.en.mountVoltageReset||"Restore defaults";const a=r&&r.mountVoltageResetHelp||texts&&texts.en&&texts.en.mountVoltageResetHelp||"";a&&mountVoltageResetButton.setAttribute("data-help",a)}mountVoltageTitleElems&&(mountVoltageTitleElems.V&&(mountVoltageTitleElems.V.textContent=r&&r.mountVoltageCardLabelV||texts&&texts.en&&texts.en.mountVoltageCardLabelV||"V-Mount"),mountVoltageTitleElems.Gold&&(mountVoltageTitleElems.Gold.textContent=r&&r.mountVoltageCardLabelGold||texts&&texts.en&&texts.en.mountVoltageCardLabelGold||"Gold Mount"),mountVoltageTitleElems.B&&(mountVoltageTitleElems.B.textContent=r&&r.mountVoltageCardLabelB||texts&&texts.en&&texts.en.mountVoltageCardLabelB||"B-Mount")),mountVoltageInputs&&SUPPORTED_MOUNT_VOLTAGE_TYPES$1.forEach(a=>{const s=mountVoltageInputs[a];if(s){if(s.highLabel){s.highLabel.textContent=r&&r.mountVoltageHighLabel||texts&&texts.en&&texts.en.mountVoltageHighLabel||"High-voltage output";const l=r&&r.mountVoltageHighHelp||texts&&texts.en&&texts.en.mountVoltageHighHelp||"";l&&(s.highLabel.setAttribute("data-help",l),s.high&&s.high.setAttribute("data-help",l))}if(s.lowLabel){s.lowLabel.textContent=r&&r.mountVoltageLowLabel||texts&&texts.en&&texts.en.mountVoltageLowLabel||"Low-voltage output";const l=r&&r.mountVoltageLowHelp||texts&&texts.en&&texts.en.mountVoltageLowHelp||"";l&&(s.lowLabel.setAttribute("data-help",l),s.low&&s.low.setAttribute("data-help",l))}}})}}function applyMountVoltagePreferences(e,t){const{persist:o=!0,triggerUpdate:r=!0}=t||{};if(mountVoltagePreferences$1=normalizeMountVoltageSource(e),o&&persistMountVoltagePreferences(mountVoltagePreferences$1),r&&(updateMountVoltageInputsFromState$1(),refreshTotalCurrentLabels$1(typeof currentLang=="string"?currentLang:"en"),typeof updateCalculations=="function"))try{updateCalculations()}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to refresh calculations after voltage change",n)}}function resetMountVoltagePreferences(e){applyMountVoltagePreferences(DEFAULT_MOUNT_VOLTAGES$1,e)}function setMountVoltageDomReferences$1(e){const t=e||{};return mountVoltageSectionElem=t.section||null,mountVoltageHeadingElem=t.heading||null,mountVoltageDescriptionElem=t.description||null,mountVoltageNoteElem=t.note||null,mountVoltageResetButton=t.resetButton||null,mountVoltageTitleElems=t.titles||null,mountVoltageInputs=t.inputs||null,syncMountVoltageResetButtonGlobal$1(mountVoltageResetButton),syncMountVoltageInputsGlobal(mountVoltageInputs),{section:mountVoltageSectionElem,heading:mountVoltageHeadingElem,description:mountVoltageDescriptionElem,note:mountVoltageNoteElem,resetButton:mountVoltageResetButton,titles:mountVoltageTitleElems,inputs:mountVoltageInputs}}function reloadMountVoltagePreferencesFromStorage(){if(!(typeof localStorage>"u"))try{const e=localStorage.getItem(getMountVoltagePrimaryStorageKey()),t=parseStoredMountVoltages$1(e);if(t){mountVoltagePreferences$1=t;return}const o=localStorage.getItem(getMountVoltageBackupStorageKey()),r=parseStoredMountVoltages$1(o);r&&(mountVoltagePreferences$1=r,persistMountVoltagePreferences(r))}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not load mount voltage preferences",e)}}reloadMountVoltagePreferencesFromStorage();const runtimeExports={SUPPORTED_MOUNT_VOLTAGE_TYPES:SUPPORTED_MOUNT_VOLTAGE_TYPES$1,DEFAULT_MOUNT_VOLTAGES:DEFAULT_MOUNT_VOLTAGES$1,parseVoltageValue,cloneMountVoltageMap,getMountVoltagePreferencesClone,applyMountVoltagePreferences,parseStoredMountVoltages:parseStoredMountVoltages$1,resetMountVoltagePreferences,updateMountVoltageInputsFromState:updateMountVoltageInputsFromState$1,persistMountVoltagePreferences};Object.defineProperty(runtimeExports,"mountVoltageInputs",{enumerable:!0,get:()=>mountVoltageInputs});Object.freeze(runtimeExports);const namespace={SUPPORTED_MOUNT_VOLTAGE_TYPES:SUPPORTED_MOUNT_VOLTAGE_TYPES$1,DEFAULT_MOUNT_VOLTAGES:DEFAULT_MOUNT_VOLTAGES$1,parseVoltageValue,cloneMountVoltageMap,getMountVoltagePreferencesClone,applyMountVoltagePreferences,parseStoredMountVoltages:parseStoredMountVoltages$1,resetMountVoltagePreferences,updateMountVoltageInputsFromState:updateMountVoltageInputsFromState$1,persistMountVoltagePreferences,refreshTotalCurrentLabels:refreshTotalCurrentLabels$1,updateMountVoltageSettingLabels:updateMountVoltageSettingLabels$1,getMountVoltageConfig:getMountVoltageConfig$1,getActiveMountVoltageConfig,syncMountVoltageResetButtonGlobal:syncMountVoltageResetButtonGlobal$1,setMountVoltageDomReferences:setMountVoltageDomReferences$1,reloadMountVoltagePreferencesFromStorage,getMountVoltagePrimaryStorageKey,getMountVoltageBackupStorageKey,runtimeExports};Object.defineProperty(namespace,"mountVoltageInputs",{enumerable:!0,get:()=>mountVoltageInputs});if(CORE_SCOPE&&typeof CORE_SCOPE=="object"){const e="cineCoreMountVoltage",t=CORE_SCOPE[e]&&typeof CORE_SCOPE[e]=="object"?CORE_SCOPE[e]:{};for(const s of Object.keys(namespace))t[s]=namespace[s];if(!(()=>{if(!t||typeof t!="object"&&typeof t!="function"||typeof Object.isExtensible=="function"&&!Object.isExtensible(t))return!1;try{return Object.defineProperty(t,"mountVoltageInputs",{configurable:!0,enumerable:!0,get:()=>mountVoltageInputs}),!0}catch{}return!1})())try{t.mountVoltageInputs=mountVoltageInputs}catch{}try{CORE_SCOPE[e]=t}catch{}if(!CORE_SCOPE.SUPPORTED_MOUNT_VOLTAGE_TYPES)try{CORE_SCOPE.SUPPORTED_MOUNT_VOLTAGE_TYPES=SUPPORTED_MOUNT_VOLTAGE_TYPES$1}catch{}if(!CORE_SCOPE.DEFAULT_MOUNT_VOLTAGES)try{CORE_SCOPE.DEFAULT_MOUNT_VOLTAGES=DEFAULT_MOUNT_VOLTAGES$1}catch{}const r="MOUNT_VOLTAGE_RUNTIME_EXPORTS";let n=null;try{n=CORE_SCOPE[r]}catch{n=null}(!n||typeof n!="object")&&(n={});for(const s of Object.keys(runtimeExports))n[s]=runtimeExports[s];if(!(()=>{if(!n||typeof n!="object"&&typeof n!="function"||typeof Object.isExtensible=="function"&&!Object.isExtensible(n))return!1;try{return Object.defineProperty(n,"mountVoltageInputs",{configurable:!0,enumerable:!0,get:()=>mountVoltageInputs}),!0}catch{}return!1})())try{n.mountVoltageInputs=mountVoltageInputs}catch{}try{CORE_SCOPE[r]=n}catch{}}const cineCoreMountVoltage=namespace;function detectGlobalScope$9(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$c=detectGlobalScope$9();function resolveModuleBase$8(e){if(typeof require=="function")try{const t=require("../base.js");if(t&&typeof t=="object")return t}catch{}return e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}function resolveModuleGlobals$2(e){if(e&&typeof e.cineModuleGlobals=="object")return e.cineModuleGlobals;if(typeof require=="function")try{const t=require("../globals.js");if(t&&typeof t=="object")return t}catch{}return null}function fallbackExpose$2(e,t,o,r){const n=o||GLOBAL_SCOPE$c;if(!n||typeof n!="object"&&typeof n!="function")return!1;const a={configurable:r&&r.configurable!==!1,enumerable:!!(r&&r.enumerable),value:t,writable:!!(r&&r.writable)};try{return Object.defineProperty(n,e,a),!0}catch{}try{return n[e]=t,!0}catch{}return!1}function fallbackRegister$2(){return!1}function fallbackWarn$2(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const FALLBACK_BASE$3={exposeGlobal(e,t,o,r){return fallbackExpose$2(e,t,o,r||{})},registerOrQueueModule:fallbackRegister$2,getModuleRegistry(){return null},safeWarn:fallbackWarn$2},MODULE_BASE$8=resolveModuleBase$8(GLOBAL_SCOPE$c)||FALLBACK_BASE$3,MODULE_GLOBALS$3=resolveModuleGlobals$2(GLOBAL_SCOPE$c),moduleRegistry$6=typeof MODULE_BASE$8.getModuleRegistry=="function"?MODULE_BASE$8.getModuleRegistry(GLOBAL_SCOPE$c):null,exposeGlobal$7=typeof MODULE_BASE$8.exposeGlobal=="function"?function e(t,o,r){return MODULE_BASE$8.exposeGlobal(t,o,GLOBAL_SCOPE$c,r||{})}:function e(t,o,r){return fallbackExpose$2(t,o,GLOBAL_SCOPE$c,r||{})},registerOrQueueModule$7=typeof MODULE_BASE$8.registerOrQueueModule=="function"?function e(t,o,r,n){return MODULE_BASE$8.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$c,moduleRegistry$6)}:fallbackRegister$2,safeWarn$7=(function e(){return MODULE_GLOBALS$3&&typeof MODULE_GLOBALS$3.safeWarn=="function"?function(o,r){try{MODULE_GLOBALS$3.safeWarn(o,r)}catch(n){fallbackWarn$2(o,n)}}:MODULE_BASE$8&&typeof MODULE_BASE$8.safeWarn=="function"?function(o,r){try{MODULE_BASE$8.safeWarn(o,r)}catch(n){fallbackWarn$2(o,n)}}:fallbackWarn$2})();function informModuleGlobals$3(e,t){if(!(!MODULE_GLOBALS$3||typeof MODULE_GLOBALS$3.recordModule!="function"))try{MODULE_GLOBALS$3.recordModule(e,t)}catch{}}const EXPERIENCE_EXPORTS=["populateSelect","refreshDeviceLists","hasAnyDeviceSelection","refreshAutoGearCameraOptions","refreshAutoGearCameraWeightCondition","refreshAutoGearMonitorOptions","refreshAutoGearTripodHeadOptions","refreshAutoGearTripodBowlOptions","refreshAutoGearTripodTypesOptions","refreshAutoGearTripodSpreaderOptions","refreshAutoGearWirelessOptions","refreshAutoGearMotorsOptions","refreshAutoGearControllersOptions","refreshAutoGearCrewOptions","refreshAutoGearDistanceOptions","exportAutoGearRules","generatePrintableOverview","generateGearListHtml","displayGearAndRequirements","updateGearListButtonVisibility","overviewSectionIcons","scenarioIcons","populateFeatureSearch","restoreFeatureSearchDefaults","updateFeatureSearchValue","updateFeatureSearchSuggestions","featureSearchEntries","featureSearchDefaultOptions","applyAccentColor","clearAccentColorOverrides","updateAccentColorResetButtonState","refreshDarkModeAccentBoost","isHighContrastActive","accentColor","prevAccentColor","revertAccentColor","DEFAULT_ACCENT_COLOR","HIGH_CONTRAST_ACCENT_COLOR","fontSize","fontFamily","applyDarkMode","applyPinkMode","applyHighContrast","setupInstallBanner","ensureZoomRemoteSetup","generateConnectorSummary","diagramConnectorIcons","DIAGRAM_MONITOR_ICON"],moduleState$2=Object.create(null);function assignExportValue$2(e,t){typeof t>"u"||(moduleState$2[e]=t)}function installExperience(e){if(!e||typeof e!="object")return safeWarn$7("cineCoreExperience.install received invalid payload."),!1;let t=!1;for(let o=0;o<EXPERIENCE_EXPORTS.length;o+=1){const r=EXPERIENCE_EXPORTS[o];Object.prototype.hasOwnProperty.call(e,r)&&(assignExportValue$2(r,e[r]),t=!0)}return t||safeWarn$7("cineCoreExperience.install did not receive any recognised exports."),t}function defineLazyExports$2(e,t){const o={};for(let r=0;r<t.length;r+=1){const n=t[r];o[n]={configurable:!1,enumerable:!0,get(){return moduleState$2[n]}}}Object.defineProperties(e,o)}const experienceAPI={};defineLazyExports$2(experienceAPI,EXPERIENCE_EXPORTS);Object.defineProperty(experienceAPI,"install",{configurable:!1,enumerable:!1,writable:!1,value:installExperience});const frozenExperienceAPI=Object.freeze(experienceAPI);informModuleGlobals$3("cineCoreExperience",frozenExperienceAPI);registerOrQueueModule$7("cineCoreExperience",frozenExperienceAPI,{category:"experience",description:"Experience helpers for UI orchestration, feature discovery, and presentation.",replace:!0,freeze:!1,connections:["cineModuleBase","cineModuleGlobals","cineUi"]},e=>{safeWarn$7("Unable to register cineCoreExperience module.",e)});const exposed$2=exposeGlobal$7("cineCoreExperience",frozenExperienceAPI,{configurable:!0,enumerable:!1,writable:!1});exposed$2||safeWarn$7("Unable to expose cineCoreExperience globally.");function detectGlobalScope$8(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$b=detectGlobalScope$8();function resolveModuleBase$7(e){if(typeof require=="function")try{const t=require("../base.js");if(t&&typeof t=="object")return t}catch{}return e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}function resolveModuleGlobals$1(e){if(e&&typeof e.cineModuleGlobals=="object")return e.cineModuleGlobals;if(typeof require=="function")try{const t=require("../globals.js");if(t&&typeof t=="object")return t}catch{}return null}function fallbackExpose$1(e,t,o,r){const n=o||GLOBAL_SCOPE$b;if(!n||typeof n!="object"&&typeof n!="function")return!1;const a={configurable:r&&r.configurable!==!1,enumerable:!!(r&&r.enumerable),value:t,writable:!!(r&&r.writable)};try{return Object.defineProperty(n,e,a),!0}catch{}try{return n[e]=t,!0}catch{}return!1}function fallbackRegister$1(){return!1}function fallbackWarn$1(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const FALLBACK_BASE$2={exposeGlobal(e,t,o,r){return fallbackExpose$1(e,t,o,r||{})},registerOrQueueModule:fallbackRegister$1,getModuleRegistry(){return null},safeWarn:fallbackWarn$1},MODULE_BASE$7=resolveModuleBase$7(GLOBAL_SCOPE$b)||FALLBACK_BASE$2,MODULE_GLOBALS$2=resolveModuleGlobals$1(GLOBAL_SCOPE$b),moduleRegistry$5=typeof MODULE_BASE$7.getModuleRegistry=="function"?MODULE_BASE$7.getModuleRegistry(GLOBAL_SCOPE$b):null,exposeGlobal$6=typeof MODULE_BASE$7.exposeGlobal=="function"?function e(t,o,r){return MODULE_BASE$7.exposeGlobal(t,o,GLOBAL_SCOPE$b,r||{})}:function e(t,o,r){return fallbackExpose$1(t,o,GLOBAL_SCOPE$b,r||{})},registerOrQueueModule$6=typeof MODULE_BASE$7.registerOrQueueModule=="function"?function e(t,o,r,n){return MODULE_BASE$7.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$b,moduleRegistry$5)}:fallbackRegister$1,safeWarn$6=(function e(){return MODULE_GLOBALS$2&&typeof MODULE_GLOBALS$2.safeWarn=="function"?function(o,r){try{MODULE_GLOBALS$2.safeWarn(o,r)}catch(n){fallbackWarn$1(o,n)}}:MODULE_BASE$7&&typeof MODULE_BASE$7.safeWarn=="function"?function(o,r){try{MODULE_BASE$7.safeWarn(o,r)}catch(n){fallbackWarn$1(o,n)}}:fallbackWarn$1})();function informModuleGlobals$2(e,t){if(!(!MODULE_GLOBALS$2||typeof MODULE_GLOBALS$2.recordModule!="function"))try{MODULE_GLOBALS$2.recordModule(e,t)}catch{}}const GUARD_EXPORTS=["ensureDefaultProjectInfoSnapshot","skipNextGearListRefresh","alignActiveAutoGearPreset","reconcileAutoGearAutoPresetState","openAutoGearEditor","closeAutoGearEditor","saveAutoGearRuleFromEditor","handleAutoGearImportSelection","handleAutoGearPresetSelection","handleAutoGearSavePreset","handleAutoGearDeletePreset","applyAutoGearBackupVisibility","renderAutoGearBackupControls","renderAutoGearBackupRetentionControls","renderAutoGearDraftImpact","renderAutoGearDraftLists","renderAutoGearMonitorDefaultsControls","renderAutoGearPresetsControls","renderAutoGearRulesList","updateAutoGearCameraWeightDraft","updateAutoGearShootingDaysDraft","setAutoGearAutoPresetId","syncAutoGearAutoPreset","updateAutoGearCatalogOptions","updateAutoGearItemButtonState","updateAutoGearMonitorDefaultOptions","applyFavoritesToSelect","updateFavoriteButton","toggleFavorite","loadStoredLogoPreview","renderSettingsLogoPreview","loadFeedbackSafe","saveFeedbackSafe","saveCurrentGearList"],moduleState$1=Object.create(null);function assignExportValue$1(e,t){typeof t>"u"||(moduleState$1[e]=t)}function installPersistenceGuard(e){if(!e||typeof e!="object")return safeWarn$6("cineCoreGuard.install received invalid payload."),!1;let t=!1;for(let o=0;o<GUARD_EXPORTS.length;o+=1){const r=GUARD_EXPORTS[o];Object.prototype.hasOwnProperty.call(e,r)&&(assignExportValue$1(r,e[r]),t=!0)}return t||safeWarn$6("cineCoreGuard.install did not receive any recognised exports."),t}function defineLazyExports$1(e,t){const o={};for(let r=0;r<t.length;r+=1){const n=t[r];o[n]={configurable:!1,enumerable:!0,get(){return moduleState$1[n]}}}Object.defineProperties(e,o)}const guardAPI={};defineLazyExports$1(guardAPI,GUARD_EXPORTS);Object.defineProperty(guardAPI,"install",{configurable:!1,enumerable:!1,writable:!1,value:installPersistenceGuard});const frozenGuardAPI=Object.freeze(guardAPI);informModuleGlobals$2("cineCoreGuard",frozenGuardAPI);registerOrQueueModule$6("cineCoreGuard",frozenGuardAPI,{category:"safety",description:"Persistence guards that preserve autosaves, presets, and backup state across workflows.",replace:!0,freeze:!1,connections:["cineModuleBase","cineModuleGlobals","cinePersistence"]},e=>{safeWarn$6("Unable to register cineCoreGuard module.",e)});const exposed$1=exposeGlobal$6("cineCoreGuard",frozenGuardAPI,{configurable:!0,enumerable:!1,writable:!1});exposed$1||safeWarn$6("Unable to expose cineCoreGuard globally.");function detectGlobalScope$7(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$a=detectGlobalScope$7();function resolveModuleBase$6(e){if(typeof require=="function")try{const t=require("../base.js");if(t&&typeof t=="object")return t}catch{}return e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}function resolveModuleGlobals(e){if(e&&typeof e.cineModuleGlobals=="object")return e.cineModuleGlobals;if(typeof require=="function")try{const t=require("../globals.js");if(t&&typeof t=="object")return t}catch{}return null}function fallbackExpose(e,t,o,r){const n=o||GLOBAL_SCOPE$a;if(!n||typeof n!="object"&&typeof n!="function")return!1;const a={configurable:r&&r.configurable!==!1,enumerable:!!(r&&r.enumerable),value:t,writable:!!(r&&r.writable)};try{return Object.defineProperty(n,e,a),!0}catch{}try{return n[e]=t,!0}catch{}return!1}function fallbackRegister(){return!1}function fallbackWarn(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const FALLBACK_BASE$1={exposeGlobal(e,t,o,r){return fallbackExpose(e,t,o,r||{})},registerOrQueueModule:fallbackRegister,getModuleRegistry(){return null},safeWarn:fallbackWarn},MODULE_BASE$6=resolveModuleBase$6(GLOBAL_SCOPE$a)||FALLBACK_BASE$1,MODULE_GLOBALS$1=resolveModuleGlobals(GLOBAL_SCOPE$a),moduleRegistry$4=typeof MODULE_BASE$6.getModuleRegistry=="function"?MODULE_BASE$6.getModuleRegistry(GLOBAL_SCOPE$a):null,exposeGlobal$5=typeof MODULE_BASE$6.exposeGlobal=="function"?function e(t,o,r){return MODULE_BASE$6.exposeGlobal(t,o,GLOBAL_SCOPE$a,r||{})}:function e(t,o,r){return fallbackExpose(t,o,GLOBAL_SCOPE$a,r||{})},registerOrQueueModule$5=typeof MODULE_BASE$6.registerOrQueueModule=="function"?function e(t,o,r,n){return MODULE_BASE$6.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$a,moduleRegistry$4)}:fallbackRegister,safeWarn$5=(function e(){return MODULE_GLOBALS$1&&typeof MODULE_GLOBALS$1.safeWarn=="function"?function(o,r){try{MODULE_GLOBALS$1.safeWarn(o,r)}catch(n){fallbackWarn(o,n)}}:MODULE_BASE$6&&typeof MODULE_BASE$6.safeWarn=="function"?function(o,r){try{MODULE_BASE$6.safeWarn(o,r)}catch(n){fallbackWarn(o,n)}}:fallbackWarn})();function informModuleGlobals$1(e,t){if(!(!MODULE_GLOBALS$1||typeof MODULE_GLOBALS$1.recordModule!="function"))try{MODULE_GLOBALS$1.recordModule(e,t)}catch{}}const PROJECT_EXPORTS=["deriveProjectInfo","updateCalculations","checkSetupChanged","currentProjectInfo","setCurrentProjectInfo","getCurrentProjectInfo","collectProjectFormData","populateProjectForm","renderFilterDetails","collectFilterSelections","collectFilterTokens","parseFilterTokens","applyFilterSelectionsToGearList","normalizeSpellingVariants","normalizeSearchValue","getPowerSelectionSnapshot","applyStoredPowerSelection","getGearListSelectors","applyGearListSelectors"],moduleState=Object.create(null);function assignExportValue(e,t){typeof t>"u"||(moduleState[e]=t)}function installProjectIntelligence(e){if(!e||typeof e!="object")return safeWarn$5("cineCoreProject.install received invalid payload."),!1;let t=!1;for(let o=0;o<PROJECT_EXPORTS.length;o+=1){const r=PROJECT_EXPORTS[o];Object.prototype.hasOwnProperty.call(e,r)&&(assignExportValue(r,e[r]),t=!0)}return t||safeWarn$5("cineCoreProject.install did not receive any recognised exports."),t}function defineLazyExports(e,t){const o={};for(let r=0;r<t.length;r+=1){const n=t[r];o[n]={configurable:!1,enumerable:!0,get(){return moduleState[n]}}}Object.defineProperties(e,o)}const projectAPI={};defineLazyExports(projectAPI,PROJECT_EXPORTS);Object.defineProperty(projectAPI,"install",{configurable:!1,enumerable:!1,writable:!1,value:installProjectIntelligence});const frozenProjectAPI=Object.freeze(projectAPI);informModuleGlobals$1("cineCoreProject",frozenProjectAPI);registerOrQueueModule$5("cineCoreProject",frozenProjectAPI,{category:"domain",description:"Project intelligence helpers for derived metadata, selectors, and calculations.",replace:!0,freeze:!1,connections:["cineModuleBase","cineModuleGlobals","cineCoreShared"]},e=>{safeWarn$5("Unable to register cineCoreProject module.",e)});const exposed=exposeGlobal$5("cineCoreProject",frozenProjectAPI,{configurable:!0,enumerable:!1,writable:!1});exposed||safeWarn$5("Unable to expose cineCoreProject globally.");var CORE_RUNTIME_SHARED_NAMESPACE_TOOLS=(function e(){const t=typeof CORE_PART1_RUNTIME_SCOPE<"u"&&CORE_PART1_RUNTIME_SCOPE?CORE_PART1_RUNTIME_SCOPE:null,o=typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null,r=[t,o,typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let s=0;s<r.length;s+=1){const l=r[s];if(!(!l||typeof l!="object"))try{const u=l.CORE_RUNTIME_SHARED_NAMESPACE_TOOLS;if(u&&typeof u=="object")return u}catch{}}const n=resolveCoreSupportModule$1("cineCoreAppRuntimeSharedNamespace","./modules/app-core/runtime.js"),a=[t,o];for(let s=0;s<a.length;s+=1){const l=a[s];if(!(!l||typeof l!="object"))try{typeof l.CORE_RUNTIME_SHARED_NAMESPACE_TOOLS>"u"&&Object.defineProperty(l,"CORE_RUNTIME_SHARED_NAMESPACE_TOOLS",{configurable:!0,writable:!0,value:n})}catch{try{l.CORE_RUNTIME_SHARED_NAMESPACE_TOOLS=n}catch{}}}return n})(),RUNTIME_SHARED_BOOTSTRAP_TOOLS=resolveCoreSupportModule$1("cineCoreAppRuntimeSharedBootstrap","./modules/app-core/runtime.js");resolveCoreSupportModule$1("cineCoreAppLocalizationAccessors","./modules/app-core/localization-fixed.js");var RUNTIME_SHARED_BOOTSTRAP_INLINE_TOOLS=resolveCoreSupportModule$1("cineCoreAppRuntimeSharedBootstrapInline","./modules/app-core/runtime.js"),RUNTIME_SHARED_BOOTSTRAP_RESULT_TOOLS=resolveCoreSupportModule$1("cineCoreAppRuntimeSharedBootstrapResult","./modules/app-core/runtime.js"),RUNTIME_SHARED_BOOTSTRAP_LOADER_TOOLS=resolveCoreSupportModule$1("cineCoreAppRuntimeSharedBootstrapLoader","./modules/app-core/runtime.js"),RUNTIME_SHARED_BOOTSTRAP_MANAGER_TOOLS=resolveCoreSupportModule$1("cineCoreAppRuntimeSharedBootstrapManager","./modules/app-core/runtime.js"),RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS=resolveCoreSupportModule$1("cineCoreAppRuntimeSharedBootstrapResolver","./modules/app-core/runtime.js");resolveCoreSupportModule$1("cineCoreAppRuntimeSharedBootstrapContext","./modules/app-core/runtime.js");function getDefaultRuntimeScope(){return typeof CORE_PART1_RUNTIME_SCOPE<"u"&&CORE_PART1_RUNTIME_SCOPE?CORE_PART1_RUNTIME_SCOPE:null}function getDefaultCoreGlobalScope(){return typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE?CORE_GLOBAL_SCOPE:null}var createInlineRuntimeSharedFallback=APP_CORE_BOOTSTRAP_TOOLS&&APP_CORE_BOOTSTRAP_TOOLS.resolver&&typeof APP_CORE_BOOTSTRAP_TOOLS.resolver.createInlineRuntimeSharedFallback=="function"?APP_CORE_BOOTSTRAP_TOOLS.resolver.createInlineRuntimeSharedFallback:function e(){return null},runtimeSharedBootstrapResult=(function e(){const t=getDefaultRuntimeScope(),o=getDefaultCoreGlobalScope(),r=typeof require=="function"?require:null,n=typeof CORE_RUNTIME_SHARED$1<"u"&&CORE_RUNTIME_SHARED$1?CORE_RUNTIME_SHARED$1:null,a=RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS&&typeof RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS.collectBootstrapFallbackScopes=="function"?RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS.collectBootstrapFallbackScopes({fallbackScopes:[],runtimeScope:t,coreGlobalScope:o}):[],s=APP_CORE_BOOTSTRAP_TOOLS,l={bootstrapTools:s,bootstrapFallbackTools:APP_CORE_BOOTSTRAP_FALLBACK_TOOLS,runtimeSharedBootstrapResolverTools:RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS,runtimeSharedBootstrapTools:RUNTIME_SHARED_BOOTSTRAP_TOOLS,runtimeSharedNamespaceTools:CORE_RUNTIME_SHARED_NAMESPACE_TOOLS,runtimeSharedBootstrapInlineTools:RUNTIME_SHARED_BOOTSTRAP_INLINE_TOOLS,runtimeSharedBootstrapResultTools:RUNTIME_SHARED_BOOTSTRAP_RESULT_TOOLS,runtimeSharedBootstrapLoaderTools:RUNTIME_SHARED_BOOTSTRAP_LOADER_TOOLS,runtimeSharedBootstrapManagerTools:RUNTIME_SHARED_BOOTSTRAP_MANAGER_TOOLS,resolveCoreSupportModule:resolveCoreSupportModule$1,requireFn:r,runtimeScope:t,coreGlobalScope:o,currentRuntimeShared:n,fallbackScopes:a,collectFallbackScopes(u){return RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS&&typeof RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS.collectBootstrapFallbackScopes=="function"?RUNTIME_SHARED_BOOTSTRAP_RESOLVER_TOOLS.collectBootstrapFallbackScopes({fallbackScopes:Array.isArray(u)?u:[],runtimeScope:t,coreGlobalScope:o}):[]},createInlineRuntimeSharedFallback,runtimeSharedBootstrapInlineRequirePath:null,runtimeSharedBootstrapResultRequirePath:null};if(APP_CORE_BOOTSTRAP_SUITE&&typeof APP_CORE_BOOTSTRAP_SUITE.createRuntimeSharedBootstrapResult=="function")try{const u=APP_CORE_BOOTSTRAP_SUITE.createRuntimeSharedBootstrapResult(l);if(u&&typeof u=="object")return u}catch{}if(APP_CORE_BOOTSTRAP_RESULTS_TOOLS&&typeof APP_CORE_BOOTSTRAP_RESULTS_TOOLS.resolveRuntimeSharedBootstrapResult=="function")try{const u=APP_CORE_BOOTSTRAP_RESULTS_TOOLS.resolveRuntimeSharedBootstrapResult(l);if(u&&typeof u=="object")return u}catch{}if(s&&typeof s.createRuntimeSharedBootstrapResult=="function")try{const u=s.createRuntimeSharedBootstrapResult(l);if(u&&typeof u=="object")return u}catch{}if(s&&typeof s.createRuntimeSharedBootstrapFallback=="function")try{const u=s.createRuntimeSharedBootstrapFallback(l);if(u&&typeof u=="object")return u}catch{}return createInlineRuntimeSharedFallback(l)})(),CORE_RUNTIME_SHARED_NAMESPACE=runtimeSharedBootstrapResult&&runtimeSharedBootstrapResult.runtimeSharedNamespace?runtimeSharedBootstrapResult.runtimeSharedNamespace:null,CORE_RUNTIME_SHARED_RESOLVER=runtimeSharedBootstrapResult&&typeof runtimeSharedBootstrapResult.runtimeSharedResolver=="function"?runtimeSharedBootstrapResult.runtimeSharedResolver:null,EXISTING_CORE_RUNTIME_SHARED=(runtimeSharedBootstrapResult&&runtimeSharedBootstrapResult.existingRuntimeShared&&typeof runtimeSharedBootstrapResult.existingRuntimeShared=="object"?runtimeSharedBootstrapResult.existingRuntimeShared:null)||(typeof CORE_RUNTIME_SHARED$1<"u"&&CORE_RUNTIME_SHARED$1?CORE_RUNTIME_SHARED$1:null),fallbackResolveRuntimeSharedFromGlobal=runtimeSharedBootstrapResult&&typeof runtimeSharedBootstrapResult.fallbackResolveRuntimeSharedFromGlobal=="function"?runtimeSharedBootstrapResult.fallbackResolveRuntimeSharedFromGlobal:function e(){return null},CORE_RUNTIME_SHARED$1=(runtimeSharedBootstrapResult&&runtimeSharedBootstrapResult.runtimeShared&&typeof runtimeSharedBootstrapResult.runtimeShared=="object"?runtimeSharedBootstrapResult.runtimeShared:null)||(EXISTING_CORE_RUNTIME_SHARED&&typeof EXISTING_CORE_RUNTIME_SHARED=="object"?EXISTING_CORE_RUNTIME_SHARED:null)||(CORE_RUNTIME_SHARED_RESOLVER?(function e(){try{const t=CORE_RUNTIME_SHARED_RESOLVER({currentShared:EXISTING_CORE_RUNTIME_SHARED,resolveCoreSupportModule:resolveCoreSupportModule$1,requireFn:typeof require=="function"?require:null,runtimeScope:typeof CORE_PART1_RUNTIME_SCOPE<"u"?CORE_PART1_RUNTIME_SCOPE:null,coreGlobalScope:typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null});if(t&&typeof t=="object")return t}catch{}return null})():null)||fallbackResolveRuntimeSharedFromGlobal()||Object.create(null);typeof window<"u"&&(window.CORE_RUNTIME_SHARED_NAMESPACE_TOOLS=CORE_RUNTIME_SHARED_NAMESPACE_TOOLS,window.RUNTIME_SHARED_BOOTSTRAP_TOOLS=RUNTIME_SHARED_BOOTSTRAP_TOOLS,window.CORE_RUNTIME_SHARED_NAMESPACE=CORE_RUNTIME_SHARED_NAMESPACE,window.CORE_RUNTIME_SHARED_RESOLVER=CORE_RUNTIME_SHARED_RESOLVER,window.EXISTING_CORE_RUNTIME_SHARED=EXISTING_CORE_RUNTIME_SHARED,window.CORE_RUNTIME_SHARED=CORE_RUNTIME_SHARED$1);function detectGlobalScope$6(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$9=detectGlobalScope$6();function resolveModuleBase$5(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const MODULE_BASE$5=resolveModuleBase$5(GLOBAL_SCOPE$9),freezeDeep$4=MODULE_BASE$5&&typeof MODULE_BASE$5.freezeDeep=="function"?MODULE_BASE$5.freezeDeep:function e(t){if(!t||typeof t=="function"||typeof t!="object"&&typeof t!="function")return t;const o=new WeakSet;function r(n){if(!n||typeof n!="object"&&typeof n!="function")return n;const a=typeof n=="function";if(o.has(n))return n;if(o.add(n),a){try{Object.freeze(n)}catch{}return n}try{const s=Object.getOwnPropertyNames(n);for(let l=0;l<s.length;l+=1){const u=s[l];let d;try{d=n[u]}catch(m){d=void 0}!d||typeof d=="function"||typeof d!="object"&&typeof d!="function"||r(d)}Object.freeze(n)}catch{}return n}return r(t)},exposeGlobal$4=MODULE_BASE$5&&typeof MODULE_BASE$5.exposeGlobal=="function"?function e(t,o,r){return MODULE_BASE$5.exposeGlobal(t,o,GLOBAL_SCOPE$9,r||{})}:function e(t,o){try{return GLOBAL_SCOPE$9[t]=o,!0}catch{return!1}},moduleRegistry$3=MODULE_BASE$5&&typeof MODULE_BASE$5.getModuleRegistry=="function"?MODULE_BASE$5.getModuleRegistry(GLOBAL_SCOPE$9):null,registerOrQueueModule$4=MODULE_BASE$5&&typeof MODULE_BASE$5.registerOrQueueModule=="function"?function e(t,o,r,n){return MODULE_BASE$5.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$9,moduleRegistry$3)}:function e(){return!1},SESSION_AUTO_BACKUP_NAME_PREFIX$1="auto-backup-",SESSION_AUTO_BACKUP_DELETION_PREFIX$1="auto-backup-before-delete-",BACKUP_STORAGE_KEY_PREFIXES=["cameraPowerPlanner_","cinePowerPlanner_"],BACKUP_VAULT_DB_NAME="cinePowerPlannerBackupVault",BACKUP_VAULT_STORE_NAME="queuedBackups",BACKUP_VAULT_DB_VERSION=1,BACKUP_VAULT_FALLBACK_STORAGE_KEY="cineBackupVaultFallbackRecords";let backupVaultDbPromise=null;const backupVaultTransientRecords=new Map;let fallbackVaultStorageInitialized=!1,fallbackVaultStorageReference=null,fallbackVaultStorageType="none",fallbackStorageRecordCount=0,memoryFallbackEntryCount=0,backupVaultFallbackMode=!1,backupVaultFallbackModeDetail={storageType:"indexeddb"};function setBackupVaultFallbackMode(e,t){const o=t&&typeof t=="object"?t:{},r=typeof o.storageType=="string"?o.storageType:e?memoryFallbackEntryCount>0?"memory":"fallback":"indexeddb",n=r!=="memory",a=backupVaultFallbackMode!==!!e||backupVaultFallbackModeDetail.storageType!==r;backupVaultFallbackMode=!!e,backupVaultFallbackModeDetail={storageType:r,durable:n},a&&dispatchBackupVaultEvent("cineBackupVault:fallbackChanged",{active:backupVaultFallbackMode,storageType:r,durable:n})}function refreshBackupVaultFallbackMode(e){const t=memoryFallbackEntryCount>0||fallbackStorageRecordCount>0,o=e&&typeof e=="object"?{...e}:{};t?memoryFallbackEntryCount>0?o.storageType="memory":fallbackStorageRecordCount>0?o.storageType="fallback":typeof o.storageType!="string"&&(o.storageType="indexeddb"):o.storageType="indexeddb",setBackupVaultFallbackMode(t,o)}function getBackupVaultFallbackState(){return{active:backupVaultFallbackMode,storageType:backupVaultFallbackModeDetail.storageType,durable:backupVaultFallbackModeDetail.durable}}function isBackupVaultFallbackActive(){return backupVaultFallbackMode}function createMemoryBackupVault(){let e=[];return{save(t){return e=e.filter(o=>o&&o.id!==t.id),e.push({...t}),e.sort((o,r)=>{const n=typeof o.createdAtMs=="number"?o.createdAtMs:0,a=typeof r.createdAtMs=="number"?r.createdAtMs:0;return n-a}),memoryFallbackEntryCount=e.length,refreshBackupVaultFallbackMode({storageType:"memory"}),Promise.resolve({id:t.id,persisted:!0,durable:!1,storageType:"memory"})},list(){return Promise.resolve(e.map(t=>({...t})))},remove(t){return e=e.filter(o=>o&&o.id!==t),memoryFallbackEntryCount=e.length,refreshBackupVaultFallbackMode(memoryFallbackEntryCount>0?{storageType:"memory"}:null),Promise.resolve(!0)}}}const memoryBackupVault=createMemoryBackupVault();function resetFallbackVaultStorageReference(){fallbackVaultStorageInitialized=!1,fallbackVaultStorageReference=null,fallbackVaultStorageType="none"}function isStorageLike(e){return!e||typeof e!="object"?!1:typeof e.getItem=="function"&&typeof e.setItem=="function"}function getBackupVaultFallbackStorage(){if(fallbackVaultStorageInitialized&&isStorageLike(fallbackVaultStorageReference))return{storage:fallbackVaultStorageReference,type:fallbackVaultStorageType};const e=[()=>{if(typeof getSafeLocalStorage=="function")try{return getSafeLocalStorage()}catch(t){console.warn("getSafeLocalStorage threw while resolving backup vault fallback storage",t)}return null},()=>typeof SAFE_LOCAL_STORAGE<"u"&&SAFE_LOCAL_STORAGE?SAFE_LOCAL_STORAGE:null,()=>GLOBAL_SCOPE$9&&GLOBAL_SCOPE$9.sessionStorage?GLOBAL_SCOPE$9.sessionStorage:null,()=>typeof sessionStorage<"u"?sessionStorage:null,()=>GLOBAL_SCOPE$9&&GLOBAL_SCOPE$9.localStorage?GLOBAL_SCOPE$9.localStorage:null,()=>typeof localStorage<"u"?localStorage:null];for(let t=0;t<e.length;t+=1){const o=e[t];if(typeof o!="function")continue;let r=null;try{r=o()}catch(n){console.warn("Backup vault fallback storage resolver failed",n),r=null}if(isStorageLike(r))return fallbackVaultStorageInitialized=!0,fallbackVaultStorageReference=r,fallbackVaultStorageType=t<=1?"safe-local-storage":t<=3?"session-storage":"local-storage",{storage:fallbackVaultStorageReference,type:fallbackVaultStorageType}}return fallbackVaultStorageInitialized=!0,fallbackVaultStorageReference=null,fallbackVaultStorageType="none",{storage:null,type:"none"}}function readFallbackVaultRecords(){const{storage:e}=getBackupVaultFallbackStorage();if(!isStorageLike(e))return fallbackStorageRecordCount=0,refreshBackupVaultFallbackMode(),[];let t=null;try{t=e.getItem(BACKUP_VAULT_FALLBACK_STORAGE_KEY)}catch(n){return console.warn("Failed to read fallback backup vault storage contents",n),resetFallbackVaultStorageReference(),fallbackStorageRecordCount=0,refreshBackupVaultFallbackMode(memoryFallbackEntryCount>0?{storageType:"memory"}:null),[]}if(typeof t!="string"||!t)return fallbackStorageRecordCount=0,refreshBackupVaultFallbackMode(),[];let o;try{o=JSON.parse(t)}catch(n){return console.warn("Failed to parse fallback backup vault entries",n),fallbackStorageRecordCount=0,refreshBackupVaultFallbackMode(memoryFallbackEntryCount>0?{storageType:"memory"}:null),[]}if(!Array.isArray(o))return fallbackStorageRecordCount=0,refreshBackupVaultFallbackMode(),[];const r=[];for(let n=0;n<o.length;n+=1){const a=o[n];!a||typeof a!="object"||typeof a.id!="string"||r.push({...a})}return fallbackStorageRecordCount=r.length,refreshBackupVaultFallbackMode(r.length>0?{storageType:"fallback"}:null),r}function writeFallbackVaultRecords(e){const{storage:t}=getBackupVaultFallbackStorage();if(!isStorageLike(t))return fallbackStorageRecordCount=0,refreshBackupVaultFallbackMode(memoryFallbackEntryCount>0?{storageType:"memory"}:null),!1;const o=Array.isArray(e)?e:[];if(o.length===0)try{return t.removeItem(BACKUP_VAULT_FALLBACK_STORAGE_KEY),fallbackStorageRecordCount=0,refreshBackupVaultFallbackMode(null),!0}catch(n){return console.warn("Failed to remove fallback backup vault entries",n),!1}let r="[]";try{r=JSON.stringify(o)}catch(n){return console.warn("Failed to serialize fallback backup vault entries",n),!1}try{return t.setItem(BACKUP_VAULT_FALLBACK_STORAGE_KEY,r),fallbackStorageRecordCount=o.length,refreshBackupVaultFallbackMode(o.length>0?{storageType:"fallback"}:null),!0}catch(n){return console.warn("Failed to persist fallback backup vault entries",n),resetFallbackVaultStorageReference(),refreshBackupVaultFallbackMode(memoryFallbackEntryCount>0?{storageType:"memory"}:null),!1}}function persistFallbackVaultRecord(e){const t=readFallbackVaultRecords(),o=new Map;t.forEach(n=>{!n||typeof n!="object"||typeof n.id!="string"||o.set(n.id,{...n})}),o.set(e.id,{...e});const r=Array.from(o.values());return r.sort((n,a)=>{const s=typeof n.createdAtMs=="number"?n.createdAtMs:0,l=typeof a.createdAtMs=="number"?a.createdAtMs:0;return s-l}),writeFallbackVaultRecords(r)?Promise.resolve({id:e.id,persisted:!0,durable:!0,storageType:"fallback"}):memoryBackupVault.save(e)}function removeFallbackVaultRecordEntry(e){if(!e)return Promise.resolve(!1);const t=readFallbackVaultRecords();if(!t.length)return Promise.resolve(!1);const o=t.filter(n=>n&&n.id!==e);if(o.length===t.length)return fallbackStorageRecordCount=t.length,refreshBackupVaultFallbackMode(t.length>0?{storageType:"fallback"}:null),Promise.resolve(!1);const r=writeFallbackVaultRecords(o);return Promise.resolve(!!r)}function combineBackupVaultRecordSets(e,t,o){const r=new Map,n=(s,l)=>{Array.isArray(s)&&s.forEach(u=>{if(!u||typeof u!="object"||typeof u.id!="string")return;const d={...u,storageType:l};l!=="memory"?d.durable=!0:d.durable=!1;const m=r.get(d.id);if(!m){r.set(d.id,d);return}const y=typeof m.createdAtMs=="number"?m.createdAtMs:0;(typeof d.createdAtMs=="number"?d.createdAtMs:0)>=y&&r.set(d.id,d)})};n(e,"indexeddb"),n(t,"fallback"),n(o,"memory");const a=Array.from(r.values());return a.sort((s,l)=>{const u=typeof s.createdAtMs=="number"?s.createdAtMs:0,d=typeof l.createdAtMs=="number"?l.createdAtMs:0;return u-d}),a}function isIndexedDBAvailable(){return typeof indexedDB<"u"&&indexedDB!==null}function openBackupVaultDb(){return isIndexedDBAvailable()?backupVaultDbPromise||(backupVaultDbPromise=new Promise(e=>{let t=!1;try{const o=indexedDB.open(BACKUP_VAULT_DB_NAME,BACKUP_VAULT_DB_VERSION);o.addEventListener("upgradeneeded",r=>{const n=r.target.result;n.objectStoreNames.contains(BACKUP_VAULT_STORE_NAME)||n.createObjectStore(BACKUP_VAULT_STORE_NAME,{keyPath:"id"}).createIndex("createdAtMs","createdAtMs",{unique:!1})}),o.addEventListener("success",()=>{const r=o.result;t=!0,r.onversionchange=()=>{r.close(),backupVaultDbPromise&&(backupVaultDbPromise=null)},e(r)}),o.addEventListener("error",()=>{t||console.warn("Failed to open backup vault IndexedDB database",o.error),e(null)})}catch(o){console.warn("Unable to open backup vault IndexedDB database",o),e(null)}}),backupVaultDbPromise):Promise.resolve(null)}function withBackupVaultStore(e,t){return openBackupVaultDb().then(o=>o?new Promise((r,n)=>{let a=!1;try{const s=o.transaction(BACKUP_VAULT_STORE_NAME,e),l=s.objectStore(BACKUP_VAULT_STORE_NAME),u=t(l,s);s.addEventListener("complete",()=>{a||(a=!0,r(u))}),s.addEventListener("error",()=>{a||(a=!0,n(s.error))})}catch(s){n(s)}}).catch(r=>(console.warn("Backup vault IndexedDB transaction failed",r),t(null))):t(null))}function ensureVaultRecordMetadata(e){const t=e&&typeof e.source=="string"&&e.source?e.source:"automatic",o=e&&typeof e.reason=="string"&&e.reason?e.reason:"unknown",r=e&&typeof e.permissionState=="string"&&e.permissionState?e.permissionState:"unknown",n=e&&typeof e.createdAt=="string"&&e.createdAt?e.createdAt:new Date().toISOString(),a=e&&typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)?e.createdAtMs:Date.now();return{source:t,reason:o,permissionState:r,createdAt:n,createdAtMs:a}}function createBackupVaultRecord(e,t,o={}){const r=typeof e=="string"&&e?e:"cine-power-planner-backup.json",n=ensureVaultRecordMetadata(o);return{id:o&&typeof o.id=="string"&&o.id?o.id:`queued-${n.createdAtMs}-${Math.random().toString(16).slice(2,10)}`,fileName:r,payload:t,createdAt:n.createdAt,createdAtMs:n.createdAtMs,metadata:{source:n.source,reason:n.reason,permissionState:n.permissionState}}}function persistBackupVaultRecord(e){return!e||typeof e!="object"||!e.id?Promise.resolve(null):withBackupVaultStore("readwrite",t=>t?new Promise((o,r)=>{try{const n=t.put(e);n.addEventListener("success",()=>{refreshBackupVaultFallbackMode({storageType:"indexeddb"}),o({id:e.id,persisted:!0,durable:!0,storageType:"indexeddb"})}),n.addEventListener("error",()=>{r(n.error)})}catch(n){r(n)}}).catch(o=>(console.warn("Failed to persist backup vault record to IndexedDB",o),persistFallbackVaultRecord(e))):persistFallbackVaultRecord(e)).catch(t=>(console.warn("Backup vault persistence failed",t),persistFallbackVaultRecord(e)))}function listBackupVaultRecords(){const e=withBackupVaultStore("readonly",r=>r?new Promise((n,a)=>{try{const s=r.getAll();s.addEventListener("success",()=>{n(Array.isArray(s.result)?s.result:[])}),s.addEventListener("error",()=>{a(s.error)})}catch(s){a(s)}}).catch(n=>(console.warn("Failed to read backup vault records from IndexedDB",n),[])):[]).catch(r=>(console.warn("Backup vault record enumeration failed",r),[])),t=Promise.resolve().then(()=>readFallbackVaultRecords()).catch(r=>(console.warn("Failed to enumerate fallback backup vault records",r),[])),o=memoryBackupVault.list().catch(()=>[]);return Promise.all([e,t,o]).then(r=>{const[n,a,s]=r;return combineBackupVaultRecordSets(n,a,s)})}function removeBackupVaultRecord(e){if(!e)return Promise.resolve(!1);backupVaultTransientRecords.delete(e);const t=withBackupVaultStore("readwrite",o=>o?new Promise((r,n)=>{try{const a=o.delete(e);a.addEventListener("success",()=>{refreshBackupVaultFallbackMode(),r(!0)}),a.addEventListener("error",()=>{n(a.error)})}catch(a){n(a)}}).catch(r=>(console.warn("Failed to remove backup vault record from IndexedDB",r),!1)):!1).catch(o=>(console.warn("Backup vault record removal failed",o),!1));return Promise.all([Promise.resolve(t),removeFallbackVaultRecordEntry(e),memoryBackupVault.remove(e)]).then(o=>{const r=o.some(n=>!!n);return r||refreshBackupVaultFallbackMode(),r})}function clearBackupVault(){const e=(async()=>{try{if(backupVaultDbPromise){const t=await backupVaultDbPromise;if(t&&typeof t.close=="function")try{t.close()}catch(o){console.warn("Failed to close backup vault DB before deletion",o)}}}catch(t){console.warn("Failed to await backup vault DB cleanup",t)}return backupVaultDbPromise=null,new Promise((t,o)=>{if(!isIndexedDBAvailable()){t(!0);return}try{const r=indexedDB.deleteDatabase(BACKUP_VAULT_DB_NAME);r.addEventListener("success",()=>{t(!0)}),r.addEventListener("error",()=>{console.warn("Failed to delete backup vault database",r.error),withBackupVaultStore("readwrite",n=>n?new Promise((a,s)=>{const l=n.clear();l.onsuccess=()=>a(!0),l.onerror=()=>s(l.error)}):!1).then(t).catch(o)}),r.addEventListener("blocked",()=>{console.warn("Backup vault database deletion blocked"),withBackupVaultStore("readwrite",n=>n?new Promise((a,s)=>{const l=n.clear();l.onsuccess=()=>a(!0),l.onerror=()=>s(l.error)}):!1).then(()=>{t(!0)}).catch(n=>{console.warn("Failed to clear backup vault store after blocked deletion",n),dispatchBackupVaultEvent("cineBackupVault:clearBlocked",{reason:"blocked",error:n?String(n):"unknown"}),t(!0)})})}catch(r){o(r)}})})();return Promise.allSettled([e,writeFallbackVaultRecords([]),memoryBackupVault.list().then(t=>Promise.all(t.map(o=>memoryBackupVault.remove(o.id))))]).then(t=>{const o=t.filter(r=>r.status==="rejected");return o.length&&(console.warn("clearBackupVault encountered errors",o.map(r=>r.reason)),dispatchBackupVaultEvent("cineBackupVault:clearFailed",{reason:"partial",failedCount:o.length})),refreshBackupVaultFallbackMode(),backupVaultTransientRecords.clear(),!0})}function dispatchBackupVaultEvent(e,t){if(!e)return;const o=[];GLOBAL_SCOPE$9&&typeof GLOBAL_SCOPE$9.dispatchEvent=="function"&&o.push(GLOBAL_SCOPE$9),GLOBAL_SCOPE$9&&GLOBAL_SCOPE$9.document&&typeof GLOBAL_SCOPE$9.document.dispatchEvent=="function"&&o.push(GLOBAL_SCOPE$9.document),GLOBAL_SCOPE$9&&GLOBAL_SCOPE$9.window&&typeof GLOBAL_SCOPE$9.window.dispatchEvent=="function"&&o.push(GLOBAL_SCOPE$9.window);const r=typeof CustomEvent=="function"?CustomEvent:null;o.forEach(n=>{if(!(!n||typeof n.dispatchEvent!="function"))try{if(r)n.dispatchEvent(new CustomEvent(e,{detail:t}));else if(typeof Event=="function"){const a=new Event(e);a.detail=t,n.dispatchEvent(a)}}catch(a){console.warn("Failed to dispatch backup vault event",a)}})}function getQueuedBackupPayloads(){return listBackupVaultRecords().then(e=>{const t=new Map;Array.isArray(e)&&e.forEach(r=>{!r||!r.id||t.has(r.id)||t.set(r.id,{...r})}),backupVaultTransientRecords.forEach((r,n)=>{if(!t.has(n)){const a={...r};typeof a.storageType!="string"&&(a.storageType="transient"),typeof a.durable!="boolean"&&(a.durable=!1),t.set(n,a)}});const o=Array.from(t.values());return o.sort((r,n)=>{const a=typeof r.createdAtMs=="number"?r.createdAtMs:0,s=typeof n.createdAtMs=="number"?n.createdAtMs:0;return a-s}),o})}function queueBackupPayloadForVault(e,t,o){const r=createBackupVaultRecord(e,t,o||{});backupVaultTransientRecords.set(r.id,{...r});try{persistBackupVaultRecord(r).then(n=>{backupVaultTransientRecords.delete(r.id),n&&n.durable===!1&&console.warn("Backup vault record stored using non-durable fallback storage.",n)}).catch(n=>{console.warn("Failed to persist queued backup payload. Using in-memory vault fallback.",n)})}catch(n){console.warn("Queued backup persistence threw unexpectedly",n)}return dispatchBackupVaultEvent("cineBackupVault:queued",{id:r.id,fileName:r.fileName,createdAt:r.createdAt,metadata:r.metadata}),r}function resolveBackupTexts(){const e=GLOBAL_SCOPE$9&&typeof GLOBAL_SCOPE$9.texts=="object"?GLOBAL_SCOPE$9.texts:null,t=GLOBAL_SCOPE$9&&typeof GLOBAL_SCOPE$9.currentLang=="string"?GLOBAL_SCOPE$9.currentLang:GLOBAL_SCOPE$9&&typeof GLOBAL_SCOPE$9.appLanguage=="string"?GLOBAL_SCOPE$9.appLanguage:"en",o=t&&typeof t=="string"?t:"en",r=e&&e[o]?e[o]:null,n=e&&e.en?e.en:null;return{langTexts:r,fallbackTexts:n}}function resolveQueuedBackupMessage(e){const{langTexts:t,fallbackTexts:o}=resolveBackupTexts();return(t&&t.queuedBackupDownloadDeferred||o&&o.queuedBackupDownloadDeferred||"Automatic downloads were blocked. The backup was saved to the local vault.").replace("{fileName}",e||"cine-power-planner-backup.json")}function resolveBackupVaultEmptyMessage(){const{langTexts:e,fallbackTexts:t}=resolveBackupTexts();return e&&e.queuedBackupVaultEmpty||t&&t.queuedBackupVaultEmpty||"No queued backups are stored in the local vault."}function resolveBackupVaultWindowTitle(){const{langTexts:e,fallbackTexts:t}=resolveBackupTexts();return e&&e.queuedBackupVaultTitle||t&&t.queuedBackupVaultTitle||"Local backup vault"}function resolveBackupVaultWindowIntro(){const{langTexts:e,fallbackTexts:t}=resolveBackupTexts();return e&&e.queuedBackupVaultIntro||t&&t.queuedBackupVaultIntro||"Automatic downloads were blocked. Use the actions below to export or copy each backup while offline."}function openQueuedBackupVaultWindow(){return getQueuedBackupPayloads().then(e=>{if(!e||!e.length){const y=resolveBackupVaultEmptyMessage();if(typeof GLOBAL_SCOPE$9.showNotification=="function")try{return GLOBAL_SCOPE$9.showNotification("info",y),!1}catch{}if(typeof GLOBAL_SCOPE$9.cineShowAlertDialog=="function")GLOBAL_SCOPE$9.cineShowAlertDialog({title:resolveBackupVaultWindowTitle(),message:y});else if(typeof alert=="function")try{alert(y)}catch{}return!1}if(typeof window>"u"||typeof document>"u")return console.warn("Cannot open queued backup vault window outside of a browser context"),!1;let t=null;try{t=window.open("","cineBackupVault","noopener,noreferrer,width=780,height=720")}catch(y){console.warn("Failed to open local backup vault window",y),t=null}if(!t){const y=resolveBackupTexts().fallbackTexts&&resolveBackupTexts().fallbackTexts.queuedBackupVaultPopupBlocked?resolveBackupTexts().fallbackTexts.queuedBackupVaultPopupBlocked:"Enable pop-ups to review queued backups stored in the local vault.";if(typeof GLOBAL_SCOPE$9.showNotification=="function")try{return GLOBAL_SCOPE$9.showNotification("error",y),!1}catch{}if(typeof GLOBAL_SCOPE$9.cineShowAlertDialog=="function")GLOBAL_SCOPE$9.cineShowAlertDialog({title:resolveBackupVaultWindowTitle(),message:y});else if(typeof alert=="function")try{alert(y)}catch{}return!1}const o=resolveBackupVaultWindowTitle(),r=resolveBackupVaultWindowIntro(),a=JSON.stringify(e.map(y=>({id:y.id,fileName:y.fileName,createdAt:y.createdAt,createdAtMs:y.createdAtMs,metadata:y.metadata,payload:y.payload}))).replace(/</g,"\\u003c"),s=resolveBackupVaultEmptyMessage(),l=`(() => {
  'use strict';
  try {
    var source = document.getElementById('queued-backups');
    var records = [];
    if (source) {
      var text = source.textContent || '';
      var parsed = JSON.parse(text);
      if (Array.isArray(parsed)) {
        records = parsed;
      }
    }
    var container = document.getElementById('vault');
    if (!container) {
      return;
    }
    if (!records.length) {
      var empty = document.createElement('p');
      empty.className = 'empty';
      empty.textContent = ${JSON.stringify(s)};
      container.appendChild(empty);
      return;
    }
    records.forEach(function (record) {
      var entry = document.createElement('section');
      entry.className = 'backup-entry';
      var header = document.createElement('header');
      var heading = document.createElement('h2');
      heading.textContent = String(record.fileName || 'cine-power-planner-backup.json') + ' — ' + String(record.createdAt || '');
      header.appendChild(heading);
      var downloadButton = document.createElement('button');
      downloadButton.type = 'button';
      downloadButton.textContent = 'Download JSON';
      downloadButton.addEventListener('click', function () {
        try {
          var blob = new Blob([record.payload], { type: 'application/json' });
          var url = URL.createObjectURL(blob);
          var link = document.createElement('a');
          link.href = url;
          link.download = record.fileName || 'cine-power-planner-backup.json';
          link.click();
          setTimeout(function () { URL.revokeObjectURL(url); }, 60000);
        } catch (error) {
          if (typeof window.opener.cineShowAlertDialog === 'function') {
            window.opener.cineShowAlertDialog('Download blocked — copy the JSON below instead.');
          } else {
            alert('Download blocked — copy the JSON below instead.');
          }
        }
      });
      header.appendChild(downloadButton);
      entry.appendChild(header);
      var textArea = document.createElement('textarea');
      textArea.readOnly = true;
      textArea.value = record.payload;
      entry.appendChild(textArea);
      container.appendChild(entry);
    });
  } catch (error) {
    console.error('Failed to bootstrap queued backup vault', error);
  }
})();`,u=`data:text/javascript;charset=utf-8,${encodeURIComponent(l)}`,d=resolveBackupTexts().fallbackTexts&&resolveBackupTexts().fallbackTexts.queuedBackupVaultPopupBlocked?resolveBackupTexts().fallbackTexts.queuedBackupVaultPopupBlocked:"Enable pop-ups to review queued backups stored in the local vault.",m=t.document;try{m.open(),m.write(`<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" />
<title>${o}</title>
<style>
:root { color-scheme: light dark; font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif; }
body { margin: 0; padding: 1.5rem; background: #0f1624; color: #f5f7fb; }
h1 { margin-top: 0; font-size: 1.5rem; }
p { line-height: 1.6; max-width: 38rem; }
.backup-entry { background: rgba(15, 22, 36, 0.65); border: 1px solid rgba(111, 120, 141, 0.35); border-radius: 1rem; padding: 1rem; margin-top: 1rem; }
.backup-entry header { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: baseline; justify-content: space-between; }
.backup-entry h2 { font-size: 1rem; margin: 0; }
.backup-entry button { background: #ffbf3c; border: none; border-radius: 999px; padding: 0.5rem 1.25rem; font-weight: 600; cursor: pointer; color: #11131a; }
.backup-entry button:focus { outline: 2px solid #ffffff; outline-offset: 2px; }
.backup-entry textarea { width: 100%; min-height: 10rem; margin-top: 0.75rem; border-radius: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.12); padding: 0.75rem; background: rgba(6, 10, 18, 0.92); color: #f5f7fb; font-family: 'Fira Code', 'SFMono-Regular', 'Consolas', 'Menlo', monospace; }
.empty { margin-top: 2rem; font-style: italic; color: rgba(245, 247, 251, 0.7); }
.banner { margin-bottom: 1.5rem; padding: 1rem 1.25rem; border-radius: 1rem; background: rgba(255, 191, 60, 0.18); border: 1px solid rgba(255, 191, 60, 0.4); color: #ffe3a4; }
.banner strong { display: block; font-size: 1.1rem; margin-bottom: 0.35rem; }
</style>
</head><body>
<div class="banner"><strong>${o}</strong><p>${r}</p></div>
<main id="vault"></main>
<script type="application/json" id="queued-backups">${a}<\/script>
<script src="${u}"><\/script>
</body></html>`),m.close()}catch(y){console.warn("Failed to render queued backup vault window",y);try{m.close()}catch{}if(t.close(),typeof GLOBAL_SCOPE$9.showNotification=="function")try{GLOBAL_SCOPE$9.showNotification("error",d)}catch{}return!1}return!0})}const BACKUP_STORAGE_KNOWN_KEYS=new Set(["darkMode","pinkMode","highContrast","showAutoBackups","accentColor","fontSize","fontFamily","customLogo","cineRentalPrintSections","language"]);typeof IOS_PWA_HELP_STORAGE_KEY=="string"&&IOS_PWA_HELP_STORAGE_KEY?BACKUP_STORAGE_KNOWN_KEYS.add(IOS_PWA_HELP_STORAGE_KEY):GLOBAL_SCOPE$9&&typeof GLOBAL_SCOPE$9.IOS_PWA_HELP_STORAGE_KEY=="string"&&GLOBAL_SCOPE$9.IOS_PWA_HELP_STORAGE_KEY?BACKUP_STORAGE_KNOWN_KEYS.add(GLOBAL_SCOPE$9.IOS_PWA_HELP_STORAGE_KEY):BACKUP_STORAGE_KNOWN_KEYS.add("iosPwaHelpShown");const BACKUP_METADATA_BASE_KEYS=new Set(["settings","storage","localStorage","values","entries","sessionStorage","sessionState","sessionEntries","payload","plannerData","allData","generatedAt","version","appVersion","applicationVersion"]),BACKUP_DATA_KEYS=["devices","setups","session","feedback","project","projects","gearList","favorites","documentationTracker","ownGear","autoGearRules","autoGearSeeded","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","autoGearActivePresetId","autoGearAutoPresetId","autoGearShowBackups","autoGearBackupRetention","customLogo","customFonts","contacts","userProfile","preferences","schemaCache","fullBackupHistory","fullBackups","documentationTracker"],BACKUP_DATA_COMPLEX_KEYS=new Set(["devices","setups","session","sessions","feedback","project","projects","gearList","favorites","documentationTracker","ownGear","autoGearRules","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","contacts","userProfile","preferences","fullBackupHistory","fullBackups","customFonts","documentationTracker"]),FALLBACK_STORAGE_KEYS=(()=>{const e=new Set;return BACKUP_STORAGE_KNOWN_KEYS&&typeof BACKUP_STORAGE_KNOWN_KEYS.forEach=="function"&&BACKUP_STORAGE_KNOWN_KEYS.forEach(t=>{typeof t=="string"&&t&&e.add(t)}),BACKUP_STORAGE_KEY_PREFIXES.forEach(t=>{typeof t!="string"||!t||BACKUP_DATA_KEYS.forEach(o=>{typeof o!="string"||!o||e.add(`${t}${o}`)})}),e})();function isPlainObject$1(e){if(e===null||typeof e!="object"||Array.isArray(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;let o;try{o=Object.getPrototypeOf(e)}catch{return!1}return o===null||o===Object.prototype}function isMapLike$1(e){if(!e||typeof e!="object")return!1;if(Object.prototype.toString.call(e)==="[object Map]")return!0;if(typeof Map<"u")try{if(e instanceof Map)return!0}catch{}return typeof e.size=="number"&&typeof e.entries=="function"&&typeof e.forEach=="function"&&typeof e.get=="function"&&typeof e.set=="function"}function convertMapLikeKey(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(typeof e=="symbol")return e.description||e.toString();if(e&&typeof e=="object")try{const t=JSON.stringify(e);if(t&&t!=="{}")return t}catch{}try{return String(e)}catch{}return null}function convertMapLikeToObject$1(e){if(!isMapLike$1(e))return null;const t=Object.create(null),o=(n,a)=>{const s=convertMapLikeKey(n);s!=null&&(Object.prototype.hasOwnProperty.call(t,s)||(t[s]=a))};let r=!1;if(typeof e.entries=="function")try{const n=e.entries();if(n&&typeof n.next=="function"){for(let a=n.next();!a.done;a=n.next()){const s=a&&a.value;Array.isArray(s)&&s.length>=2&&o(s[0],s[1])}r=!0}}catch(n){console.warn("Unable to iterate map-like backup value entries",n)}if(!r&&typeof e.forEach=="function")try{e.forEach((n,a)=>{o(a,n)}),r=!0}catch(n){console.warn("Unable to iterate map-like backup value via forEach",n)}return!Object.keys(t).length&&!r?null:t}function formatFullBackupFilename$1(e){const t=e instanceof Date&&!Number.isNaN(e.valueOf())?e:new Date,o=b=>String(b).padStart(2,"0"),r=t.getFullYear(),n=o(t.getMonth()+1),a=o(t.getDate()),s=o(t.getHours()),l=o(t.getMinutes()),u=o(t.getSeconds()),d=t.getTimezoneOffset();let m="Z";if(d!==0){const b=d>0?"-":"+",v=Math.abs(d),C=o(Math.floor(v/60)),A=o(v%60);m=`${b}${C}:${A}`}const y=`${r}-${n}-${a}T${s}:${l}:${u}${m}`,h=y.replace(/[:]/g,"-");return{iso:y,fileName:`cine_power_planner_backup_${h}.json`}}function resolveSafeLocalStorage$1(){if(typeof getSafeLocalStorage=="function")try{const e=getSafeLocalStorage();if(e)return e}catch(e){console.warn("Unable to obtain safe local storage reference",e)}return typeof SAFE_LOCAL_STORAGE<"u"?SAFE_LOCAL_STORAGE:typeof localStorage<"u"?localStorage:null}function captureStorageSnapshot$1(e){const t=Object.create(null);if(!e)return t;const o=(l,u)=>{if(!(typeof l!="string"||!l)&&!Object.prototype.hasOwnProperty.call(t,l))try{const d=typeof u=="function"?u():u;t[l]=d}catch(d){console.warn("Failed to read storage entry for backup",l,d)}},r=()=>{if(typeof e.key!="function"||typeof e.length!="number")return!1;let l=0;try{l=Number(e.length)||0}catch(u){return console.warn("Failed to inspect storage length for backup snapshot",u),!0}for(let u=0;u<l;u+=1){let d;try{d=e.key(u)}catch(m){console.warn("Failed to access storage key for backup snapshot",m);continue}o(d,()=>e.getItem(d))}return!0},n=()=>{if(typeof e.keys!="function")return!1;let l;try{l=e.keys()}catch(d){return console.warn("Failed to enumerate storage keys for backup snapshot",d),!0}return l&&(d=>{if(d){if(typeof d.forEach=="function")d.forEach(m=>o(m,()=>e.getItem(m)));else if(typeof d[Symbol.iterator]=="function")for(const m of d)o(m,()=>e.getItem(m))}})(l),!0},a=()=>{if(typeof e.forEach!="function")return!1;try{e.forEach((l,u)=>{o(u,l)})}catch(l){console.warn("Failed to iterate storage for backup snapshot",l)}return!0};let s=!1;try{s=r()}catch(l){console.warn("Failed to snapshot storage via index enumeration",l)}if(!Object.keys(t).length)try{s=n()||s}catch(l){console.warn("Failed to snapshot storage via key enumeration",l)}if(!Object.keys(t).length&&!s)try{a()}catch(l){console.warn("Failed to snapshot storage via iteration",l)}else Object.keys(t).length||a();return typeof e.getItem=="function"&&FALLBACK_STORAGE_KEYS.size&&FALLBACK_STORAGE_KEYS.forEach(l=>{o(l,()=>e.getItem(l))}),t}function createSafeStorageReader$1(e,t){if(!e||typeof e.getItem!="function")return()=>null;const o=typeof t=="string"&&t?t:"Failed to read storage key";return r=>{if(typeof r!="string")return null;try{return e.getItem(r)}catch(n){return console.warn(`${o}`,r,n),null}}}function restoreSessionStorageSnapshot$1(e){if(typeof sessionStorage>"u"||!sessionStorage)return;const t=e&&typeof e=="object"?Object.entries(e):[],o=new Set(t.map(([n])=>n)),r=[];try{const{length:n}=sessionStorage;for(let a=0;a<n;a+=1){const s=sessionStorage.key(a);typeof s=="string"&&(o.has(s)||r.push(s))}}catch(n){console.warn("Failed to inspect sessionStorage during restore rollback",n)}r.forEach(n=>{try{sessionStorage.removeItem(n)}catch(a){console.warn("Failed to remove sessionStorage key during restore rollback",n,a)}}),t.forEach(([n,a])=>{if(typeof n=="string")try{sessionStorage.setItem(n,typeof a=="string"?a:String(a))}catch(s){console.warn("Failed to reapply sessionStorage key during restore rollback",n,s)}})}function normalizeStoredValue(e){if(typeof e=="string")return e;if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch(t){return console.warn("Failed to serialize stored value for backup compatibility",t),""}try{return String(e)}catch(t){return console.warn("Failed to normalize stored value for backup compatibility",t),""}}function convertEntriesToSnapshot(e){if(!e)return null;let t=e;if(isMapLike$1(t)){const n=convertMapLikeToObject$1(t);n&&(t=n)}if(typeof t=="string"){let n=null;try{n=JSON.parse(t)}catch{n=null}if(n&&(Array.isArray(n)||isPlainObject$1(n)))t=n;else return null}const o=Object.create(null),r=(n,a)=>{typeof n!="string"||!n||(o[n]=normalizeStoredValue(a))};if(Array.isArray(t))t.forEach(n=>{if(n){if(Array.isArray(n)){r(n[0],n[1]);return}if(typeof n=="object"){if(typeof n.key=="string"){r(n.key,n.value??n.val??n.data??n.content??n.string);return}if(typeof n.name=="string"){r(n.name,n.value??n.val??n.data??n.content??n.string);return}Array.isArray(n.entry)&&r(n.entry[0],n.entry[1])}}});else if(isPlainObject$1(t))Object.entries(t).forEach(([n,a])=>{r(n,a)});else return null;return Object.keys(o).length?o:null}function extractFirstMatchingSnapshot(e,t){let o=e;if(!isPlainObject$1(o))if(isMapLike$1(o)){const r=convertMapLikeToObject$1(o);if(r&&isPlainObject$1(r))o=r;else return{snapshot:null,keyUsed:null}}else return{snapshot:null,keyUsed:null};for(let r=0;r<t.length;r+=1){const n=t[r];if(!Object.prototype.hasOwnProperty.call(o,n))continue;const a=convertEntriesToSnapshot(o[n]);if(a)return{snapshot:a,keyUsed:n}}return{snapshot:null,keyUsed:null}}function looksLikeStoredSettingKey(e){return BACKUP_STORAGE_KNOWN_KEYS.has(e)?!0:BACKUP_STORAGE_KEY_PREFIXES.some(t=>e.startsWith(t))}function restoreLocalStorageSnapshot$1(e,t){if(!e||typeof e.setItem!="function")return;const o=t&&typeof t=="object"?Object.entries(t):[],r=new Set(o.map(([a])=>a)),n=[];try{const{length:a}=e;for(let s=0;s<a;s+=1){const l=e.key(s);typeof l=="string"&&!r.has(l)&&looksLikeStoredSettingKey(l)&&n.push(l)}}catch(a){console.warn("Failed to inspect storage during restore rollback",a)}n.forEach(a=>{try{e.removeItem(a)}catch(s){console.warn("Failed to remove storage key during restore rollback",a,s)}}),o.forEach(([a,s])=>{if(typeof a=="string")try{s==null?e.removeItem(a):e.setItem(a,typeof s=="string"?s:String(s))}catch(l){console.warn("Failed to reapply storage key during restore rollback",a,l)}})}function buildLegacyStorageFromRoot(e,t){let o=e;if(isMapLike$1(o)){const n=convertMapLikeToObject$1(o);n&&(o=n)}if(!isPlainObject$1(o))return null;const r=Object.create(null);return Object.entries(o).forEach(([n,a])=>{t.has(n)||looksLikeStoredSettingKey(n)&&(r[n]=normalizeStoredValue(a))}),Object.keys(r).length?r:null}function convertLegacyDataEntriesToObject(e){if(isMapLike$1(e)){const a=convertMapLikeToObject$1(e);if(a)return a}if(!Array.isArray(e))return null;const t=Object.create(null),o=(a,s)=>{typeof a!="string"||!a||Object.prototype.hasOwnProperty.call(t,a)||(t[a]=s)},r=["key","name","section","type"],n=["value","data","content","payload","entries","items","record","snapshot","state","values","settings","sectionData","body"];return e.forEach(a=>{if(!a)return;if(Array.isArray(a)){o(a[0],a[1]);return}if(!isPlainObject$1(a))return;if(Array.isArray(a.entry)){o(a.entry[0],a.entry[1]);return}const s=r.find(u=>{const d=a[u];return typeof d=="string"&&d});if(!s)return;let l;for(let u=0;u<n.length;u+=1){const d=n[u];if(Object.prototype.hasOwnProperty.call(a,d)){l=a[d];break}}l===void 0&&(l=a.value??a.data??a.content??a.payload??a.entries??a.items??a.snapshot??a.state??a.values??a.settings),l!==void 0&&o(a[s],l)}),Object.keys(t).length?t:null}function normalizeBackupDataSection(e){if(isMapLike$1(e)){const t=convertMapLikeToObject$1(e);if(t)return normalizeBackupDataSection(t)}if(isPlainObject$1(e))return e;if(Array.isArray(e)){const t=convertLegacyDataEntriesToObject(e);if(t)return t}if(typeof e=="string"){const t=parseBackupDataString(e);if(t)return t}if(e&&typeof e=="object"&&typeof e.toJSON=="function")try{const t=e.toJSON();if(isPlainObject$1(t)||Array.isArray(t))return normalizeBackupDataSection(t)}catch(t){console.warn("Failed to convert backup data via toJSON",t)}return null}function normalizeBackupDataValue(e,t){if(typeof e=="string"&&BACKUP_DATA_COMPLEX_KEYS.has(e)){const o=normalizeBackupDataSection(t);if(o)return o}return t}function mergeBackupDataSections(e,t){if(!isPlainObject$1(t)||!Object.keys(t).length)return e?{...e}:null;const o=e?{...e}:{};return Object.entries(t).forEach(([r,n])=>{typeof r=="string"&&(Object.prototype.hasOwnProperty.call(o,r)||(o[r]=normalizeBackupDataValue(r,n)))}),o}const CONTROL_CHARACTER_REGEX=new RegExp("[\0-]","g");function sanitizeBackupPayload$1(e){if(e==null)return"";const t=r=>{if(typeof r!="object"||r===null)return null;const n=typeof Buffer<"u"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(r),a=Object.prototype.toString.call(r),s=typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||a==="[object ArrayBuffer]"||a==="[object SharedArrayBuffer]"),l=typeof ArrayBuffer>"u"?!1:typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(r)?!0:!!(r&&typeof r=="object"&&typeof r.buffer=="object"&&typeof r.byteLength=="number"&&typeof r.BYTES_PER_ELEMENT=="number");if(!n&&!s&&!l)return null;const u=()=>{if(n)return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);if(s)return new Uint8Array(r);if(typeof r.buffer=="object"&&typeof r.byteLength=="number"){const b=typeof r.byteOffset=="number"?r.byteOffset:0;return new Uint8Array(r.buffer,b,r.byteLength)}throw new TypeError("Unsupported binary payload type")},d=b=>{if(typeof TextDecoder!="function")return null;try{return new TextDecoder("utf-8",{fatal:!1}).decode(b)}catch(v){return console.warn("Failed to decode backup payload with TextDecoder",v),null}},m=()=>{if(!n)return null;try{return r.toString("utf8")}catch(b){return console.warn("Failed to decode backup payload with Buffer",b),null}},y=b=>{try{let v="";for(let A=0;A<b.length;A+=32768){const w=b.subarray(A,A+32768);v+=String.fromCharCode.apply(null,w)}return v}catch(v){return console.warn("Failed to manually decode backup payload",v),null}},h=u();return d(h)||m()||y(h)};let o;if(typeof e=="string")o=e;else{const r=t(e);if(typeof r=="string")o=r;else try{o=String(e)}catch(n){console.warn("Failed to coerce backup payload to string",n),o=""}}if(typeof o!="string")return"";if(!o.includes("\0"))return o;try{return o.replace(CONTROL_CHARACTER_REGEX,"")}catch(r){return console.warn("Failed to strip control characters from backup payload",r),o}}function parseBackupDataString(e){if(typeof e!="string")return null;const t=sanitizeBackupPayload$1(e);if(!t)return null;const o=t.trim();if(!o)return null;try{const r=JSON.parse(o);if(isPlainObject$1(r))return r;if(Array.isArray(r))return convertLegacyDataEntriesToObject(r)}catch(r){console.warn("Failed to parse backup data string",r)}return null}function extractBackupSections$1(e){let t;if(isPlainObject$1(e))t=e;else if(isMapLike$1(e)){const y=convertMapLikeToObject$1(e);t=isPlainObject$1(y)?y:{}}else t={};const o=typeof t.version=="string"?t.version:typeof t.appVersion=="string"?t.appVersion:typeof t.applicationVersion=="string"?t.applicationVersion:void 0,r=extractFirstMatchingSnapshot(t,["settings","localStorage","storage","storedSettings","values","entries"]),n=extractFirstMatchingSnapshot(t,["sessionStorage","session","sessions","sessionState","sessionEntries"]),a=new Set(BACKUP_METADATA_BASE_KEYS);r.keyUsed&&a.add(r.keyUsed),n.keyUsed&&a.add(n.keyUsed);const s=r.snapshot||buildLegacyStorageFromRoot(t,a),l=n.snapshot;let u=null;const d=["data","payload","plannerData","allData"];for(let y=0;y<d.length;y+=1){const h=d[y];if(!Object.prototype.hasOwnProperty.call(t,h))continue;const b=normalizeBackupDataSection(t[h]);b&&(u=mergeBackupDataSections(u,b))}const m={};return BACKUP_DATA_KEYS.forEach(y=>{a.has(y)||Object.prototype.hasOwnProperty.call(t,y)&&(m[y]=normalizeBackupDataValue(y,t[y]))}),Object.keys(m).length&&(u=mergeBackupDataSections(u,m)),{fileVersion:o,settings:s,sessionStorage:l,data:isPlainObject$1(u)?u:null}}function isUnsupportedDownloadPermissionError(e){if(!e)return!1;const t=typeof e.name=="string"?e.name:"";if(t==="TypeError"||t==="NotSupportedError"||typeof DOMException<"u"&&e instanceof DOMException&&e.code===DOMException.NOT_SUPPORTED_ERR)return!0;if(typeof e.message=="string"){const o=e.message.toLowerCase();if(o.includes("automatic-download")&&o.includes("not a valid enum")||o.includes("downloads")&&o.includes("not a valid enum"))return!0}return!1}function monitorAutomaticDownloadPermission(){if(typeof navigator>"u"||!navigator.permissions||typeof navigator.permissions.query!="function")return null;const e=["automatic-downloads","downloads"];let t=null,o=null;for(let a=0;a<e.length;a+=1){const s=e[a];try{const l=navigator.permissions.query({name:s});if(!l||typeof l.then!="function")continue;t=l,o=s;break}catch(l){if(isUnsupportedDownloadPermissionError(l))continue;return console.warn(`Failed to query automatic download permission (${s})`,l),null}}if(!t||typeof t.then!="function")return null;let r=null;const n={state:"unknown",name:o,supported:!0,initial:t.then(a=>(r=a,!a||typeof a.state!="string"?(n.state="unknown",n.state):(n.state=a.state,n.state))).catch(a=>isUnsupportedDownloadPermissionError(a)?(n.supported=!1,n.state="unknown",n.state):(console.warn(`Failed to query automatic download permission (${o||"unknown"})`,a),n.state="unknown",n.state)),ready:null};return n.ready=n.initial.then(a=>!r||typeof r.state!="string"?n.state:a==="prompt"?new Promise(s=>{const l=()=>{try{r.removeEventListener("change",l)}catch{}n.state=typeof r.state=="string"?r.state:"unknown",s(n.state)};try{r.addEventListener("change",l)}catch(u){console.warn("Failed to observe automatic download permission changes",u),s("unknown")}}):a).catch(a=>(isUnsupportedDownloadPermissionError(a)||console.warn("Failed to observe automatic download permission changes",a),n.state="unknown",n.state)),n}function triggerBackupDownload(e,t){if(typeof document>"u")return!1;const o=document.createElement("a");o.href=e,o.download=t,o.style.display="none",document.body.appendChild(o);let r=!1;try{o.click(),r=!0}catch(n){console.warn("Failed to trigger backup download",n),r=!1}return setTimeout(()=>{try{o.remove()}catch{}},1500),r}function encodeBackupDataUrl(e){if(typeof e!="string")return null;try{return`data:application/json;charset=utf-8,${encodeURIComponent(e)}`}catch(t){return console.warn("Failed to encode backup payload as data URL",t),null}}function openBackupFallbackWindow(e,t){if(typeof window>"u"||typeof document>"u")return!1;let o=null;try{o=window.open("","_blank","noopener")}catch(r){console.warn("Failed to open fallback backup window",r),o=null}if(!o)return!1;try{const r=o.document;if(!r)return!1;const n=document&&document.documentElement&&document.documentElement.getAttribute?document.documentElement.getAttribute("lang"):"en";r.open(),r.write(`<!DOCTYPE html><html lang="${n||"en"}"><head><meta charset="utf-8"><title>Manual download</title></head><body></body></html>`),r.close();try{r.title=t||"backup.json"}catch(y){}const a=r.body;if(!a)return!1;a.style.margin="0",a.style.padding="1.5rem",a.style.background="#f8f9fb",a.style.color="#0f172a",a.style.fontFamily="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";const s=r.createElement("div");s.style.maxWidth="960px",s.style.margin="0 auto",s.style.display="flex",s.style.flexDirection="column",s.style.gap="1rem";const l=r.createElement("h1");l.textContent=t||"Manual backup",l.style.margin="0",l.style.fontSize="1.5rem",l.style.fontWeight="400";const u=r.createElement("p");typeof getManualDownloadFallbackMessage=="function"?u.textContent=getManualDownloadFallbackMessage():u.textContent="Copy the text below and save it to a file ending with .json to keep your data safe.",u.style.margin="0",u.style.lineHeight="1.5";const d=r.createElement("p");typeof getManualDownloadCopyHint=="function"?d.textContent=getManualDownloadCopyHint():d.textContent="Select the text, copy it and paste into your preferred notes app or text editor.",d.style.margin="0",d.style.lineHeight="1.5";const m=r.createElement("textarea");m.value=e,m.readOnly=!0,m.spellcheck=!1,m.style.width="100%",m.style.height="70vh",m.style.resize="vertical",m.style.padding="1rem",m.style.borderRadius="1rem",m.style.border="1px solid rgba(15, 23, 42, 0.15)",m.style.background="#ffffff",m.style.fontFamily="'SFMono-Regular', 'Roboto Mono', 'Menlo', 'Courier New', monospace",m.style.fontSize="0.875rem",m.style.lineHeight="1.5",m.style.boxShadow="0 0.75rem 2.5rem rgba(15, 23, 42, 0.16)",s.appendChild(l),s.appendChild(u),s.appendChild(d),s.appendChild(m),a.appendChild(s);try{m.focus(),m.select()}catch(y){}try{o.focus()}catch(y){}return!0}catch(r){return console.warn("Failed to render manual backup window",r),!1}}function downloadBackupPayload$1(e,t,o={}){const r=monitorAutomaticDownloadPermission(),n=typeof o=="object"&&o!==null?o:{},a=n.skipQueue===!0,s={success:!1,method:null,permission:r,queued:!1,queueMessage:resolveQueuedBackupMessage(t)};let l=typeof t=="string"&&t.trim()?t.trim():"";if(l||(l=`${new Date().toISOString().replace(/[:.]/g,"-")}-backup.json`),l.toLowerCase().endsWith(".json")||(l+=".json"),typeof e!="string"||e.length<2)return s;let u=null;if(typeof Blob<"u")try{u=new Blob([e],{type:"application/json;charset=utf-8"})}catch(y){console.warn("Failed to create backup blob",y),u=null}if(u){if(typeof navigator<"u"&&typeof navigator.msSaveOrOpenBlob=="function")try{if(navigator.msSaveOrOpenBlob(u,l)===!1)console.warn("Saving backup via msSaveOrOpenBlob was cancelled or declined");else return{success:!0,method:"ms-save",permission:r}}catch(y){console.warn("Failed to save backup via msSaveOrOpenBlob",y)}if(typeof URL<"u"&&typeof URL.createObjectURL=="function"){let y=null;try{y=URL.createObjectURL(u)}catch(h){console.warn("Failed to create object URL for backup blob",h),y=null}if(y){const h=triggerBackupDownload(y,l);if(typeof URL.revokeObjectURL=="function"&&setTimeout(()=>{try{URL.revokeObjectURL(y)}catch{}},6e4),h)return{success:!0,method:"blob-url",permission:r}}}}const d=encodeBackupDataUrl(e);if(d&&triggerBackupDownload(d,l))return{success:!0,method:"data-url",permission:r};if(openBackupFallbackWindow(e,l))return{success:!0,method:"manual",permission:r};if(!a){const y=n.queueMetadata&&typeof n.queueMetadata=="object"?n.queueMetadata:{},h=queueBackupPayloadForVault(l,e,{reason:y.reason||n.reason||"download-blocked",permissionState:y.permissionState||(r&&typeof r.state=="string"?r.state:"unknown"),source:y.source||n.source||"automatic",createdAt:y.createdAt||null,createdAtMs:y.createdAtMs||null});s.queued=!0,s.queueEntryId=h&&typeof h.id=="string"?h.id:null}return s}function isAutoBackupName(e){return typeof e=="string"&&(e.startsWith(SESSION_AUTO_BACKUP_NAME_PREFIX$1)||e.startsWith(SESSION_AUTO_BACKUP_DELETION_PREFIX$1))}function parseAutoBackupName$1(e){if(typeof e!="string")return null;const t=e.startsWith(SESSION_AUTO_BACKUP_DELETION_PREFIX$1)?{prefixLength:SESSION_AUTO_BACKUP_DELETION_PREFIX$1.length,type:"auto-backup-before-delete",secondsOptional:!0}:e.startsWith(SESSION_AUTO_BACKUP_NAME_PREFIX$1)?{prefixLength:SESSION_AUTO_BACKUP_NAME_PREFIX$1.length,type:"auto-backup",secondsOptional:!0}:null;if(!t)return null;const r=e.slice(t.prefixLength).split("-");if(r.length<5)return null;const n=r.slice(0,5).map(C=>Number(C));if(n.some(C=>Number.isNaN(C)))return null;const[a,s,l,u,d]=n;let m=!1,y=0,h=5;if(r.length>h){const C=r[h];if(/^\d{1,2}$/u.test(C))m=!0,y=Number(C),h+=1;else if(!t.secondsOptional)return null}else if(!t.secondsOptional)return null;const b=r.slice(h).join("-").trim(),v=new Date(a,s-1,l,u,d,m?y:0,0);return{type:t.type,date:Number.isNaN(v.valueOf())?null:v,label:b,includeSeconds:m}}const backupAPI=freezeDeep$4({formatFullBackupFilename:formatFullBackupFilename$1,resolveSafeLocalStorage:resolveSafeLocalStorage$1,captureStorageSnapshot:captureStorageSnapshot$1,createSafeStorageReader:createSafeStorageReader$1,restoreSessionStorageSnapshot:restoreSessionStorageSnapshot$1,restoreLocalStorageSnapshot:restoreLocalStorageSnapshot$1,sanitizeBackupPayload:sanitizeBackupPayload$1,parseBackupDataString,normalizeBackupDataSection,normalizeBackupDataValue,mergeBackupDataSections,extractBackupSections:extractBackupSections$1,triggerBackupDownload,encodeBackupDataUrl,openBackupFallbackWindow,downloadBackupPayload:downloadBackupPayload$1,queueBackupPayloadForVault,getQueuedBackupPayloads,removeBackupVaultRecord,openQueuedBackupVaultWindow,resolveQueuedBackupMessage,isBackupVaultFallbackActive,getBackupVaultFallbackState,isAutoBackupName,parseAutoBackupName:parseAutoBackupName$1,isPlainObject:isPlainObject$1,constants:freezeDeep$4({SESSION_AUTO_BACKUP_NAME_PREFIX:SESSION_AUTO_BACKUP_NAME_PREFIX$1,SESSION_AUTO_BACKUP_DELETION_PREFIX:SESSION_AUTO_BACKUP_DELETION_PREFIX$1,BACKUP_STORAGE_KEY_PREFIXES:BACKUP_STORAGE_KEY_PREFIXES.slice(),BACKUP_STORAGE_KNOWN_KEYS:Array.from(BACKUP_STORAGE_KNOWN_KEYS),BACKUP_METADATA_BASE_KEYS:Array.from(BACKUP_METADATA_BASE_KEYS),BACKUP_DATA_KEYS:BACKUP_DATA_KEYS.slice(),BACKUP_DATA_COMPLEX_KEYS:Array.from(BACKUP_DATA_COMPLEX_KEYS),BACKUP_VAULT_FALLBACK_STORAGE_KEY})});registerOrQueueModule$4("cineFeatureBackup",backupAPI,{category:"feature",description:"Backup and restore helpers for snapshots, payload normalization, downloads and diff metadata.",replace:!0,connections:["cineModuleBase","cineModuleContext","cinePersistence"]},e=>{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to register cineFeatureBackup module.",e)});const globalExports$2=[["cineFeatureBackup",backupAPI],["formatFullBackupFilename",formatFullBackupFilename$1],["resolveSafeLocalStorage",resolveSafeLocalStorage$1],["captureStorageSnapshot",captureStorageSnapshot$1],["createSafeStorageReader",createSafeStorageReader$1],["restoreSessionStorageSnapshot",restoreSessionStorageSnapshot$1],["restoreLocalStorageSnapshot",restoreLocalStorageSnapshot$1],["sanitizeBackupPayload",sanitizeBackupPayload$1],["parseBackupDataString",parseBackupDataString],["normalizeBackupDataSection",normalizeBackupDataSection],["normalizeBackupDataValue",normalizeBackupDataValue],["mergeBackupDataSections",mergeBackupDataSections],["extractBackupSections",extractBackupSections$1],["triggerBackupDownload",triggerBackupDownload],["encodeBackupDataUrl",encodeBackupDataUrl],["openBackupFallbackWindow",openBackupFallbackWindow],["downloadBackupPayload",downloadBackupPayload$1],["queueBackupPayloadForVault",queueBackupPayloadForVault],["getQueuedBackupPayloads",getQueuedBackupPayloads],["removeBackupVaultRecord",removeBackupVaultRecord],["openQueuedBackupVaultWindow",openQueuedBackupVaultWindow],["resolveQueuedBackupMessage",resolveQueuedBackupMessage],["isBackupVaultFallbackActive",isBackupVaultFallbackActive],["getBackupVaultFallbackState",getBackupVaultFallbackState],["isAutoBackupName",isAutoBackupName],["parseAutoBackupName",parseAutoBackupName$1],["clearBackupVault",clearBackupVault],["SESSION_AUTO_BACKUP_NAME_PREFIX",SESSION_AUTO_BACKUP_NAME_PREFIX$1],["SESSION_AUTO_BACKUP_DELETION_PREFIX",SESSION_AUTO_BACKUP_DELETION_PREFIX$1]];globalExports$2.forEach(([e,t])=>{exposeGlobal$4(e,t,{configurable:!0,writable:!0})});console.log("DEBUG: app-events.js START");let lastSetupName$1="";const EVENTS_UI_HELPERS=cineCoreUiHelpers||{},UI_CACHE=cineUiCache||{getElement:function(e){return typeof document<"u"?document.getElementById(e):null}};function defineUiGetter(e,t){const o=t||e;try{Object.defineProperty(globalThis,e,{get:function(){return UI_CACHE[o]||UI_CACHE.getElement(o)},configurable:!0,enumerable:!0})}catch{globalThis[e]=null}}const DEVICE_STORAGE_KEY_FOR_EVENTS="cameraPowerPlanner_devices";defineUiGetter("toggleDeviceBtn","toggleDeviceManager");defineUiGetter("deviceManagerSection","device-manager");defineUiGetter("saveSetupBtn");defineUiGetter("setupNameInput","setupName");defineUiGetter("deleteSetupBtn");defineUiGetter("addDeviceBtn");defineUiGetter("cancelEditBtn");defineUiGetter("languageSelect");defineUiGetter("skipLink");defineUiGetter("importDataBtn");defineUiGetter("importFileInput");defineUiGetter("exportBtn","exportDataBtn");defineUiGetter("generateGearListBtn");defineUiGetter("deleteGearListProjectBtn");defineUiGetter("gearItemEditExtra");defineUiGetter("newSubcategorySelect","newSubcategory");defineUiGetter("newCategorySelect","newCategory");defineUiGetter("subcategoryFieldDiv","subcategoryField");defineUiGetter("lensFocusScaleSelect","lensFocusScaleUnit");defineUiGetter("newNameInput","newName");defineUiGetter("newWattInput","newWatt");defineUiGetter("newCapacityInput","newCapacity");defineUiGetter("newPinAInput","newPinA");defineUiGetter("newDtapAInput","newDtapA");defineUiGetter("menuToggle");defineUiGetter("darkModeToggle");defineUiGetter("pinkModeToggle");defineUiGetter("settingsButton");defineUiGetter("settingsDialog");defineUiGetter("settingsSave");defineUiGetter("settingsCancel");defineUiGetter("settingsLanguage");defineUiGetter("settingsDarkMode");defineUiGetter("settingsPinkMode");defineUiGetter("settingsHighContrast");defineUiGetter("settingsReduceMotion");defineUiGetter("settingsRelaxedSpacing");defineUiGetter("settingsShowAutoBackups");defineUiGetter("settingsTemperatureUnit");defineUiGetter("settingsFontSize");defineUiGetter("settingsFontFamily");defineUiGetter("settingsLogo");defineUiGetter("settingsLogoPreview");defineUiGetter("accentColorInput");defineUiGetter("helpButton");defineUiGetter("reloadButton");defineUiGetter("closeMenuButton");defineUiGetter("openContactsBtn");defineUiGetter("shareSetupBtn");defineUiGetter("applySharedLinkBtn");defineUiGetter("generateOverviewBtn");defineUiGetter("runtimeFeedbackBtn");defineUiGetter("zoomOut");defineUiGetter("zoomIn");defineUiGetter("resetView");defineUiGetter("gridSnapToggle");defineUiGetter("accentColorReset");defineUiGetter("resolvedLocalFontsButton","localFontsButton");defineUiGetter("documentationTrackerAddRelease");defineUiGetter("mountVoltageReset");defineUiGetter("autoGearSavePreset");defineUiGetter("autoGearDeletePreset");defineUiGetter("autoGearBackupRestore");defineUiGetter("autoGearAddRule");defineUiGetter("autoGearResetFactory");defineUiGetter("autoGearHighlightToggle");defineUiGetter("closePrintPreviewBtn");defineUiGetter("printPreviewExportBtn");defineUiGetter("printPreviewPrintBtn");defineUiGetter("projectForm");defineUiGetter("wattFieldDiv","wattField");defineUiGetter("dtapRow");defineUiGetter("cameraFieldsDiv","cameraFields");defineUiGetter("monitorFieldsDiv","monitorFields");defineUiGetter("viewfinderFieldsDiv","viewfinderFields");defineUiGetter("batteryFieldsDiv","batteryFields");defineUiGetter("lensFieldsDiv","lensFields");defineUiGetter("videoFieldsDiv","videoFields");defineUiGetter("motorFieldsDiv","motorFields");defineUiGetter("controllerFieldsDiv","controllerFields");defineUiGetter("distanceFieldsDiv","distanceFields");defineUiGetter("cameraWattInput","cameraWatt");defineUiGetter("cameraVoltageInput","cameraVoltage");defineUiGetter("cameraPortTypeInput","cameraPortType");defineUiGetter("monitorScreenSizeInput","monitorScreenSize");defineUiGetter("monitorBrightnessInput","monitorBrightness");defineUiGetter("monitorWattInput","monitorWatt");defineUiGetter("monitorVoltageInput","monitorVoltage");defineUiGetter("monitorPortTypeInput","monitorPortType");defineUiGetter("monitorWirelessTxInput","monitorWirelessTx");defineUiGetter("monitorLatencyInput","monitorLatency");defineUiGetter("monitorAudioOutputInput","monitorAudioOutput");defineUiGetter("viewfinderScreenSizeInput","viewfinderScreenSize");defineUiGetter("viewfinderBrightnessInput","viewfinderBrightness");defineUiGetter("viewfinderWattInput","viewfinderWatt");defineUiGetter("viewfinderVoltageInput","viewfinderVoltage");defineUiGetter("viewfinderPortTypeInput","viewfinderPortType");defineUiGetter("viewfinderWirelessTxInput","viewfinderWirelessTx");defineUiGetter("viewfinderLatencyInput","viewfinderLatency");defineUiGetter("videoFrequencyInput");defineUiGetter("videoLatencyInput");defineUiGetter("motorConnectorInput");defineUiGetter("motorInternalInput");defineUiGetter("motorTorqueInput");defineUiGetter("motorGearInput");defineUiGetter("motorNotesInput");defineUiGetter("controllerConnectorInput");defineUiGetter("controllerPowerInput");defineUiGetter("controllerBatteryInput");defineUiGetter("controllerConnectivityInput");defineUiGetter("controllerNotesInput");defineUiGetter("distanceConnectionInput");defineUiGetter("distanceMethodInput");defineUiGetter("distanceRangeInput");defineUiGetter("distanceAccuracyInput");defineUiGetter("distanceOutputInput");defineUiGetter("distanceNotesInput");function initDomReferences(){}typeof document<"u"&&document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",initDomReferences);defineUiGetter("cameraWattInput","cameraWatt");defineUiGetter("monitorWattInput","monitorWatt");defineUiGetter("viewfinderWattInput","viewfinderWatt");defineUiGetter("cameraVoltageInput","cameraVoltage");defineUiGetter("cameraPortTypeInput","cameraPortType");defineUiGetter("monitorScreenSizeInput","monitorScreenSize");defineUiGetter("monitorBrightnessInput","monitorBrightness");defineUiGetter("monitorVoltageInput","monitorVoltage");defineUiGetter("monitorPortTypeInput","monitorPortType");defineUiGetter("monitorLatencyInput","monitorLatency");defineUiGetter("monitorAudioOutputInput","monitorAudioOutput");defineUiGetter("viewfinderScreenSizeInput","viewfinderScreenSize");defineUiGetter("viewfinderBrightnessInput","viewfinderBrightness");defineUiGetter("viewfinderVoltageInput","viewfinderVoltage");defineUiGetter("viewfinderPortTypeInput","viewfinderPortType");defineUiGetter("viewfinderLatencyInput","viewfinderLatency");defineUiGetter("batteryFieldsDiv","batteryFields");defineUiGetter("cameraFieldsDiv","cameraFields");defineUiGetter("monitorFieldsDiv","monitorFields");defineUiGetter("viewfinderFieldsDiv","viewfinderFields");defineUiGetter("videoFieldsDiv","videoFields");defineUiGetter("motorFieldsDiv","motorFields");defineUiGetter("controllerFieldsDiv","controllerFields");defineUiGetter("distanceFieldsDiv","distanceFields");defineUiGetter("lensFieldsDiv","lensFields");defineUiGetter("wattFieldDiv","wattField");defineUiGetter("dynamicFieldsDiv","dynamicFields");const STORAGE_HELPERS_FOR_EVENTS=(function e(){const t={},o=(n,a)=>{if(!n||typeof t[a]=="function")return;const s=n[a];typeof s=="function"&&(t[a]=s)};if(typeof require=="function")try{const n=require("./storage.js");n&&typeof n=="object"&&(o(n,"getSafeLocalStorage"),o(n,"saveDeviceData"),o(n,"clearUiCacheStorageEntries"))}catch{}const r=[];try{typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE&&r.push(CORE_GLOBAL_SCOPE)}catch{}typeof globalThis=="object"&&globalThis&&r.push(globalThis),typeof window=="object"&&window&&r.push(window),typeof self=="object"&&self&&r.push(self),typeof global=="object"&&global&&r.push(global);for(let n=0;n<r.length;n+=1){const a=r[n];if(!(!a||typeof a!="object")&&(o(a,"getSafeLocalStorage"),o(a,"saveDeviceData"),o(a,"clearUiCacheStorageEntries"),typeof t.getSafeLocalStorage=="function"&&typeof t.saveDeviceData=="function"&&typeof t.clearUiCacheStorageEntries=="function"))break}return t})(),STORAGE_BACKUP_SUFFIX_FOR_EVENTS="__backup",STORAGE_MIGRATION_BACKUP_SUFFIX_FOR_EVENTS="__legacyMigrationBackup";function clearDeviceStorageVariantForEvents(e,t){if(typeof e!="string"||!e)return!1;const o=t&&typeof t=="object"?t:{},r=new Set;r.add(e),r.add(`${e}${STORAGE_BACKUP_SUFFIX_FOR_EVENTS}`),r.add(`${e}${STORAGE_MIGRATION_BACKUP_SUFFIX_FOR_EVENTS}`);let n=!1;const a=o.logPrefix||"Failed to clear device storage variant",s=new Set;if(typeof STORAGE_HELPERS_FOR_EVENTS.getSafeLocalStorage=="function")try{const u=STORAGE_HELPERS_FOR_EVENTS.getSafeLocalStorage();u&&s.add(u)}catch(u){try{typeof console<"u"&&typeof console.warn=="function"&&console.warn(`${a}: safe storage lookup failed`,u)}catch{}}try{typeof SAFE_LOCAL_STORAGE<"u"&&SAFE_LOCAL_STORAGE&&s.add(SAFE_LOCAL_STORAGE)}catch{}try{typeof globalThis=="object"&&globalThis&&globalThis.localStorage&&s.add(globalThis.localStorage)}catch{}try{typeof window=="object"&&window&&window.localStorage&&s.add(window.localStorage)}catch{}try{typeof localStorage<"u"&&localStorage&&s.add(localStorage)}catch{}const l=Array.from(r);if(s.forEach(u=>{if(!(!u||typeof u.removeItem!="function"))for(let d=0;d<l.length;d+=1){const m=l[d];if(!(typeof m!="string"||!m))try{u.removeItem(m),n=!0}catch(y){try{typeof console<"u"&&typeof console.warn=="function"&&console.warn(`${a} "${m}"`,y)}catch{}}}}),typeof STORAGE_HELPERS_FOR_EVENTS.clearUiCacheStorageEntries=="function")try{STORAGE_HELPERS_FOR_EVENTS.clearUiCacheStorageEntries(l)}catch(u){try{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to clear UI cache entries for device storage reset",u)}catch{}}return n}function clearAllDeviceStorageVariantsForEvents(){const e=getDeviceStorageKeyVariantsForEvents();if(!e||typeof e.forEach!="function")return!1;let t=!1;return e.forEach(o=>{if(typeof o!="string"||!o)return;if(o===DEVICE_STORAGE_KEY_FOR_EVENTS&&typeof STORAGE_HELPERS_FOR_EVENTS.saveDeviceData=="function")try{STORAGE_HELPERS_FOR_EVENTS.saveDeviceData(null),t=!0}catch(n){try{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to clear primary device storage via saveDeviceData",n)}catch{}}clearDeviceStorageVariantForEvents(o,{logPrefix:"Failed to clear device storage variant"})&&(t=!0)}),t}const CABLE_SUBCATEGORY_FALLBACK_KEYS=Object.freeze(["power","video","fiz","cables"]);function getCableSubcategoryKeysForUi(e){const t=[],o=new Set,r=s=>{if(typeof s!="string")return;const l=s.trim();!l||o.has(l)||(o.add(l),t.push(l))};let n=null;try{const s=typeof deviceSchema<"u"?deviceSchema:null;n=s&&s.accessories&&s.accessories.cables?s.accessories.cables:null}catch{n=null}if(n&&typeof n=="object")try{for(const s of Object.keys(n))r(s)}catch{}for(let s=0;s<CABLE_SUBCATEGORY_FALLBACK_KEYS.length;s+=1)r(CABLE_SUBCATEGORY_FALLBACK_KEYS[s]);let a=null;try{const s=typeof devices<"u"?devices:null;a=s&&s.accessories&&s.accessories.cables?s.accessories.cables:null}catch{a=null}if(a&&typeof a=="object")try{for(const s of Object.keys(a))r(s)}catch{}if(Array.isArray(e))for(let s=0;s<e.length;s+=1)r(e[s]);else r(e);return t}function getDeviceStorageKeyVariantsForEvents(){if(typeof require=="function")try{const t=require("./storage.js");if(t&&typeof t=="object"){if(typeof t.getDeviceStorageKeyVariants=="function"){const o=t.getDeviceStorageKeyVariants();if(o&&typeof o.forEach=="function")return Array.from(o)}if(typeof t.getStorageKeyVariants=="function"){const o=t.getStorageKeyVariants(DEVICE_STORAGE_KEY_FOR_EVENTS);if(o&&typeof o.forEach=="function")return Array.from(o)}}}catch{}const e=new Set;return e.add(DEVICE_STORAGE_KEY_FOR_EVENTS),DEVICE_STORAGE_KEY_FOR_EVENTS.startsWith("cameraPowerPlanner_")?e.add(`cinePowerPlanner_${DEVICE_STORAGE_KEY_FOR_EVENTS.slice(19)}`):DEVICE_STORAGE_KEY_FOR_EVENTS.startsWith("cinePowerPlanner_")&&e.add(`cameraPowerPlanner_${DEVICE_STORAGE_KEY_FOR_EVENTS.slice(17)}`),Array.from(e)}const setButtonLabelWithIconForEvents=(function e(){if(typeof EVENTS_UI_HELPERS.setButtonLabelWithIcon=="function")return EVENTS_UI_HELPERS.setButtonLabelWithIcon;const t=[];try{typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE.setButtonLabelWithIcon=="function"&&t.push(CORE_GLOBAL_SCOPE.setButtonLabelWithIcon)}catch{}return typeof globalThis<"u"&&globalThis&&typeof globalThis.setButtonLabelWithIcon=="function"&&t.push(globalThis.setButtonLabelWithIcon),typeof window<"u"&&window&&typeof window.setButtonLabelWithIcon=="function"&&t.push(window.setButtonLabelWithIcon),typeof self<"u"&&self&&typeof self.setButtonLabelWithIcon=="function"&&t.push(self.setButtonLabelWithIcon),typeof global<"u"&&global&&typeof global.setButtonLabelWithIcon=="function"&&t.push(global.setButtonLabelWithIcon),t.length>0?t[0]:function(r,n){if(r)try{r.textContent=typeof n=="string"?n:""}catch{}}})(),BACKUP_FEATURE_FOR_EVENTS=(function e(){if(typeof require=="function")try{const o=require("./modules/features/backup.js");if(o&&typeof o=="object")return o}catch{}const t=[];try{typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&t.push(CORE_GLOBAL_SCOPE)}catch{}typeof globalThis<"u"&&globalThis&&t.push(globalThis),typeof window<"u"&&window&&t.push(window),typeof self<"u"&&self&&t.push(self),typeof global<"u"&&global&&t.push(global);for(let o=0;o<t.length;o+=1){const r=t[o];if(r)try{const n=r.cineFeatureBackup;if(n&&typeof n=="object")return n}catch{}}return{}})(),queueBackupPayloadForVaultForEvents=typeof BACKUP_FEATURE_FOR_EVENTS.queueBackupPayloadForVault=="function"?BACKUP_FEATURE_FOR_EVENTS.queueBackupPayloadForVault:null,getQueuedBackupPayloadsForEvents=typeof BACKUP_FEATURE_FOR_EVENTS.getQueuedBackupPayloads=="function"?BACKUP_FEATURE_FOR_EVENTS.getQueuedBackupPayloads:null,removeQueuedBackupRecordForEvents=typeof BACKUP_FEATURE_FOR_EVENTS.removeBackupVaultRecord=="function"?BACKUP_FEATURE_FOR_EVENTS.removeBackupVaultRecord:null,openQueuedBackupVaultWindowForEvents=typeof BACKUP_FEATURE_FOR_EVENTS.openQueuedBackupVaultWindow=="function"?BACKUP_FEATURE_FOR_EVENTS.openQueuedBackupVaultWindow:null,resolveQueuedBackupMessageForEvents=typeof BACKUP_FEATURE_FOR_EVENTS.resolveQueuedBackupMessage=="function"?BACKUP_FEATURE_FOR_EVENTS.resolveQueuedBackupMessage:null,downloadBackupPayloadForEvents=typeof BACKUP_FEATURE_FOR_EVENTS.downloadBackupPayload=="function"?BACKUP_FEATURE_FOR_EVENTS.downloadBackupPayload:null,isBackupVaultFallbackActiveForEvents=typeof BACKUP_FEATURE_FOR_EVENTS.isBackupVaultFallbackActive=="function"?BACKUP_FEATURE_FOR_EVENTS.isBackupVaultFallbackActive:null,buildSettingsBackupPackageForEvents=(function e(){if(typeof buildSettingsBackupPackage=="function")return buildSettingsBackupPackage;const t=[];try{typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&t.push(CORE_GLOBAL_SCOPE)}catch{}typeof globalThis<"u"&&globalThis&&t.push(globalThis),typeof window<"u"&&window&&t.push(window),typeof self<"u"&&self&&t.push(self),typeof global<"u"&&global&&t.push(global);for(let o=0;o<t.length;o+=1){const r=t[o];if(r&&typeof r.buildSettingsBackupPackage=="function")return r.buildSettingsBackupPackage}return null})();function collectLoggingResolverScopes(){const e=[],t=getGlobalScope$2();return t&&e.indexOf(t)===-1&&e.push(t),typeof globalThis<"u"&&globalThis&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&window&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&self&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&global&&e.indexOf(global)===-1&&e.push(global),e}function resolveLoggingResolver(){if(typeof require=="function")try{const t=require("./modules/logging-resolver.js");if(t&&typeof t.resolveLogger=="function")return t}catch{}const e=collectLoggingResolverScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const r=o.cineLoggingResolver;if(r&&typeof r.resolveLogger=="function")return r}catch{}}return null}function resolveLegacyEventsLogger(){const e=collectLoggingResolverScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!o||typeof o!="object"&&typeof o!="function")continue;let r=null;try{r=o.cineLogging||null}catch{r=null}if(r&&typeof r.createLogger=="function")try{return r.createLogger("events",{meta:{source:"app-events"}})}catch(n){try{typeof r.error=="function"&&r.error("Failed to create events logger",n,{namespace:"events-bootstrap"})}catch{}}}return null}const eventsLogger=(function e(){const t=resolveLoggingResolver();if(t&&typeof t.resolveLogger=="function")try{const o=t.resolveLogger("events",{meta:{source:"app-events"}});if(o)return o}catch{}return resolveLegacyEventsLogger()})(),APP_EVENTS_AUTO_BACKUP_RENAMED_FLAG=typeof globalThis<"u"&&globalThis.__CINE_AUTO_BACKUP_RENAMED_FLAG?globalThis.__CINE_AUTO_BACKUP_RENAMED_FLAG:"__cineAutoBackupRenamed",_globalScope=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};(!_globalScope.viewfinderTypeOptions||!Array.isArray(_globalScope.viewfinderTypeOptions))&&(_globalScope.viewfinderTypeOptions=[]);(!_globalScope.viewfinderConnectorOptions||!Array.isArray(_globalScope.viewfinderConnectorOptions))&&(_globalScope.viewfinderConnectorOptions=[]);function getGlobalScope$2(){return typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null}const resolvedDeviceManagerElements={categorySelect:null};function resolveNewCategorySelect(){const e=resolvedDeviceManagerElements.categorySelect;if(e&&typeof e=="object"){if(typeof e.isConnected=="boolean"){if(e.isConnected)return e}else if(e.ownerDocument)return e}let t=null;if(typeof newCategorySelect<"u"&&newCategorySelect?t=newCategorySelect:typeof document<"u"&&document&&typeof document.getElementById=="function"&&(t=document.getElementById("newCategory"),t||console.warn("Debug: resolveNewCategorySelect found nothing for ID newCategory")),t){resolvedDeviceManagerElements.categorySelect=t;const o=getGlobalScope$2();if(o&&typeof o=="object")try{o.newCategorySelect=o.newCategorySelect||t}catch{}}return t}const AUTO_BACKUP_CHANGE_THRESHOLD=50,AUTO_BACKUP_INTERVAL_MS=600*1e3,AUTO_GEAR_BACKUP_INTERVAL_MS=600*1e3,AUTO_BACKUP_ALLOWED_REASONS=["interval","project-switch","import","export","export-revert","before-reload","change-threshold"],AUTO_BACKUP_RATE_LIMITED_REASONS=new Set(["import"]),AUTO_BACKUP_CADENCE_EXEMPT_REASONS=new Set(["import","export","export-revert","before-reload","project-switch"]),AUTO_BACKUP_LOG_META={feature:"auto-backup"},DEVICE_IMPORT_LOG_META={feature:"device-import",source:"app-events"},MAX_SANITIZED_IMPORT_ERRORS=10;function sanitizeErrorForLogging(e){if(!e)return null;if(typeof e=="string")return{message:e};if(typeof e!="object")try{return{message:String(e)}}catch{return{message:"Unknown error"}}const t={};if(typeof e.name=="string"&&e.name&&(t.name=e.name),typeof e.message=="string"&&e.message&&(t.message=e.message),(typeof e.code=="string"||typeof e.code=="number")&&(t.code=e.code),typeof e.lineNumber=="number"&&(t.lineNumber=e.lineNumber),typeof e.columnNumber=="number"&&(t.columnNumber=e.columnNumber),Object.keys(t).length>0)return t;try{return{message:String(e)}}catch{return{message:"Unknown error"}}}function sanitizeImportErrors(e){if(!Array.isArray(e)||e.length===0)return[];const t=[];for(let o=0;o<e.length&&t.length<MAX_SANITIZED_IMPORT_ERRORS;o+=1){const r=e[o];if(typeof r=="string")t.push(r);else if(r&&typeof r=="object"){const n={};if(typeof r.message=="string"&&r.message&&(n.message=r.message),(typeof r.code=="string"||typeof r.code=="number")&&(n.code=r.code),Object.keys(n).length>0)t.push(n);else try{t.push(String(r))}catch{}}else try{t.push(String(r))}catch{}}return t}function safeCountDevices(e){if(typeof countDeviceDatabaseEntries!="function")return null;if(!e||typeof e!="object")return e===null?0:null;try{return countDeviceDatabaseEntries(e)}catch{}return null}function buildDeviceCountsSnapshot(e,t){const o={},r=safeCountDevices(e);typeof r=="number"&&(o.existing=r);const n=safeCountDevices(t);return typeof n=="number"&&(o.imported=n),Object.keys(o).length>0?o:null}function logDeviceImportEvent(e,t,o,r){if(!eventsLogger||typeof eventsLogger[e]!="function")return;const n=r&&typeof r=="object"?{...DEVICE_IMPORT_LOG_META,...r}:DEVICE_IMPORT_LOG_META;try{eventsLogger[e](t,o||{},n)}catch{}}function resolveConsoleMethodForLevel(e){if(typeof e!="string")return"log";const t=e.toLowerCase();return t==="warn"||t==="error"||t==="info"||t==="debug"?t==="debug"&&typeof console<"u"&&console&&typeof console.debug!="function"?"log":t:"log"}function resolveCoreAutoBackupNamespace(){if(typeof require=="function")try{return require("./app-core-auto-backup.js")}catch{}const e=[getGlobalScope$2(),typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{if(o.CORE_AUTO_BACKUP&&typeof o.CORE_AUTO_BACKUP=="object")return o.CORE_AUTO_BACKUP}catch{}}return null}const AUTO_BACKUP_LOGGER_NAMESPACE=resolveCoreAutoBackupNamespace(),delegatedAutoBackupLogger=AUTO_BACKUP_LOGGER_NAMESPACE&&typeof AUTO_BACKUP_LOGGER_NAMESPACE.logAutoBackupEvent=="function"?AUTO_BACKUP_LOGGER_NAMESPACE.logAutoBackupEvent:null;function logAutoBackupEvent(e,t,o,r){const n=typeof e=="string"&&e?e:"info",a=typeof t=="string"&&t?t:"Auto backup event",s=AUTO_BACKUP_LOG_META;let l=!1;if(delegatedAutoBackupLogger)try{delegatedAutoBackupLogger(n,a,o,s),l=!0}catch(d){if(l=!1,typeof console<"u"&&typeof console.warn=="function")try{console.warn("Auto backup delegate logging failed",d)}catch{}}let u=!1;if(eventsLogger&&typeof eventsLogger[n]=="function")try{eventsLogger[n](a,o,s),u=!0}catch(d){if(eventsLogger&&typeof eventsLogger.warn=="function")try{eventsLogger.warn("Auto backup logger invocation failed",d,{...s,originalLevel:n,originalMessage:a})}catch{}}if(!(u||l)&&typeof console<"u"&&console){const d=resolveConsoleMethodForLevel(n),m=typeof console[d]=="function"?console[d]:console.log;if(typeof m=="function")try{typeof o<"u"?m.call(console,`[auto-backup] ${a}`,o):m.call(console,`[auto-backup] ${a}`)}catch{}}}function summarizeAutoBackupPayloadForLog(e){if(!e||typeof e!="object")return{hasContent:!1};const t={hasContent:!1,projectInfoKeys:0,gearListLength:0,gearListAndProjectRequirementsGenerated:!!e.gearListAndProjectRequirementsGenerated,powerSelectionKeys:0,gearSelectorGroups:0,diagramPositionCount:0,autoGearRuleCount:0},o=e.projectInfo&&typeof e.projectInfo=="object"?e.projectInfo:null;if(o)try{t.projectInfoKeys=Object.keys(o).length}catch{t.projectInfoKeys=0}typeof e.gearList=="string"&&(t.gearListLength=e.gearList.length);const r=e.powerSelection&&typeof e.powerSelection=="object"?e.powerSelection:null;if(r)try{t.powerSelectionKeys=Object.keys(r).length}catch{t.powerSelectionKeys=0}const n=e.gearSelectors&&typeof e.gearSelectors=="object"?e.gearSelectors:null;if(n)try{t.gearSelectorGroups=Object.keys(n).length}catch{t.gearSelectorGroups=0}const a=e.diagramPositions&&typeof e.diagramPositions=="object"?e.diagramPositions:null;if(a)try{t.diagramPositionCount=Object.keys(a).length}catch{t.diagramPositionCount=0}return Array.isArray(e.autoGearRules)&&(t.autoGearRuleCount=e.autoGearRules.length),t.hasContent=!!(t.projectInfoKeys||t.gearListLength||t.gearListAndProjectRequirementsGenerated||t.powerSelectionKeys||t.gearSelectorGroups||t.diagramPositionCount||t.autoGearRuleCount),t}function resolveAutoBackupLogLevel(e,t){const o=typeof e=="string"?e:"",r=typeof t=="string"?t:"";return o==="error"?"error":o==="success"?"info":o==="skipped"?r==="disallowed"||r==="auto-backup-selected"?"warn":"info":"debug"}function resolveAutoBackupLogMessage(e,t){const o=typeof e=="string"?e:"",r=typeof t=="string"?t:"";return o==="success"?"Auto backup completed successfully":o==="error"?r?`Auto backup failed (${r})`:"Auto backup failed":o==="skipped"?r?`Auto backup skipped (${r})`:"Auto backup skipped":"Auto backup run recorded"}function createDefaultAutoBackupLogDetail(e){if(!e||typeof e!="object")return{status:"unknown"};const t={status:typeof e.status=="string"?e.status:"unknown"};if(typeof e.reason=="string"&&e.reason&&(t.reason=e.reason),typeof e.context=="string"&&e.context&&(t.context=e.context),typeof e.elapsedSinceLastAutoBackupMs=="number"&&Number.isFinite(e.elapsedSinceLastAutoBackupMs)&&(t.elapsedSinceLastAutoBackupMs=Math.max(0,e.elapsedSinceLastAutoBackupMs)),typeof e.remainingIntervalMs=="number"&&Number.isFinite(e.remainingIntervalMs)&&(t.remainingIntervalMs=Math.max(0,e.remainingIntervalMs)),typeof e.changesSinceSnapshot=="number"&&Number.isFinite(e.changesSinceSnapshot)&&(t.changesSinceSnapshot=Math.max(0,e.changesSinceSnapshot)),typeof e.requiredChangeThreshold=="number"&&Number.isFinite(e.requiredChangeThreshold)&&(t.requiredChangeThreshold=Math.max(0,e.requiredChangeThreshold)),typeof e.remainingChanges=="number"&&Number.isFinite(e.remainingChanges)&&(t.remainingChanges=Math.max(0,e.remainingChanges)),typeof e.requiredIntervalMs=="number"&&Number.isFinite(e.requiredIntervalMs)&&(t.requiredIntervalMs=Math.max(0,e.requiredIntervalMs)),typeof e.name=="string"){const o=e.name.trim();t.hasName=o.length>0,t.nameLength=o.length,t.nameWasAutoGenerated=o.startsWith("auto-backup-")}return typeof e.createdAt=="string"&&e.createdAt&&(t.createdAt=e.createdAt),t}const AUTO_BACKUP_REASON_DEDUP_INTERVAL_MS=120*1e3,lastAutoBackupReasonState=new Map,AUTO_BACKUP_IMMEDIATE_COMMIT_DEBOUNCE_MS=800;let autoBackupChangesSinceSnapshot=0,autoBackupThresholdInProgress=!1,autoBackupChangePendingCommit=!1,lastAutoBackupCompletedAtMs=0,lastImmediateAutoBackupCommitAtMs=0;function resetAutoBackupChangeCounter(){autoBackupChangesSinceSnapshot=0}function recordAutoBackupRun(e,t){if(autoBackupThresholdInProgress=!1,!e||typeof e!="object"){logAutoBackupEvent("warn","Auto backup run recorded without result metadata",{status:"unknown"});return}const o=typeof e.status=="string"?e.status:null,r=typeof e.reason=="string"?e.reason:null,n=t&&typeof t=="object"?{...t}:createDefaultAutoBackupLogDetail(e),a=resolveAutoBackupLogLevel(o,r),s=resolveAutoBackupLogMessage(o,r);if(logAutoBackupEvent(a,s,n),o==="skipped"){r==="unchanged"&&resetAutoBackupChangeCounter();return}o&&o!=="error"&&(resetAutoBackupChangeCounter(),o==="success"&&(lastAutoBackupCompletedAtMs=Date.now()))}function isAutoBackupReasonAllowed(e){return typeof e!="string"||!e?!1:AUTO_BACKUP_ALLOWED_REASONS.includes(e)}function showAutoBackupIndicatorSafe(){const e=getGlobalScope$2(),t=e&&typeof e.__cineShowAutoBackupIndicator=="function"?e.__cineShowAutoBackupIndicator:null;if(!t)return()=>{};try{const o=resolveAutoBackupIndicatorMessage(),r=t(o);return typeof r=="function"?r:()=>{}}catch(o){return console.warn("Failed to show auto backup indicator",o),()=>{}}}function triggerAutoBackupForChangeThreshold(e){if(autoBackupThresholdInProgress)return;autoBackupThresholdInProgress=!0;const t=()=>{try{autoBackup$1({suppressSuccess:!0,triggerAutoSaveNotification:!0,reason:"change-threshold"})}catch(r){console.warn("Failed to run auto backup after change threshold",r),autoBackupThresholdInProgress=!1,logAutoBackupEvent("error","Auto backup change-threshold execution failed",{status:"error",reason:"change-threshold-run",errorName:r&&typeof r.name=="string"?r.name:null,errorMessage:r&&typeof r.message=="string"?r.message:null})}};if(typeof queueMicrotask=="function")try{queueMicrotask(t);return}catch(r){console.warn("Failed to queue auto backup microtask",r),logAutoBackupEvent("warn","Auto backup microtask scheduling failed",{status:"skipped",reason:"microtask-scheduling",errorName:r&&typeof r.name=="string"?r.name:null,errorMessage:r&&typeof r.message=="string"?r.message:null})}const o=setTimeout(t,0);o&&typeof o.unref=="function"&&o.unref()}function noteAutoBackupRelevantChange(e={}){if(e&&e.reset===!0){resetAutoBackupChangeCounter(),autoBackupChangePendingCommit=!1,lastImmediateAutoBackupCommitAtMs=0;return}const t=!!(e&&e.pending===!0),o=!!(e&&e.commit===!0),r=e&&typeof e.context=="object"&&e.context!==null?e.context:null;if(t){autoBackupChangePendingCommit=!0;return}if(!(o&&!autoBackupChangePendingCommit&&e.force!==!0)){if(o||autoBackupChangePendingCommit){if(autoBackupChangePendingCommit=!1,!!(r&&r.immediate===!0)){let a=null;if(r&&typeof r.completedAt=="number"&&Number.isFinite(r.completedAt)?a=r.completedAt:r&&typeof r.requestedAt=="number"&&Number.isFinite(r.requestedAt)&&(a=r.requestedAt),Number.isFinite(a)||(a=Date.now()),e.force!==!0&&lastImmediateAutoBackupCommitAtMs>0&&a>=lastImmediateAutoBackupCommitAtMs&&a-lastImmediateAutoBackupCommitAtMs<AUTO_BACKUP_IMMEDIATE_COMMIT_DEBOUNCE_MS){lastImmediateAutoBackupCommitAtMs=a;return}(a>=lastImmediateAutoBackupCommitAtMs||lastImmediateAutoBackupCommitAtMs<=0)&&(lastImmediateAutoBackupCommitAtMs=a)}autoBackupChangesSinceSnapshot=Math.min(AUTO_BACKUP_CHANGE_THRESHOLD,autoBackupChangesSinceSnapshot+1),autoBackupChangesSinceSnapshot>=AUTO_BACKUP_CHANGE_THRESHOLD&&triggerAutoBackupForChangeThreshold();return}autoBackupChangesSinceSnapshot=Math.min(AUTO_BACKUP_CHANGE_THRESHOLD,autoBackupChangesSinceSnapshot+1),autoBackupChangesSinceSnapshot>=AUTO_BACKUP_CHANGE_THRESHOLD&&triggerAutoBackupForChangeThreshold()}}try{const e=getGlobalScope$2();e&&(e.__cineNoteAutoBackupChange=noteAutoBackupRelevantChange)}catch(e){console.warn("Failed to expose auto backup change tracker",e)}function markAutoBackupDataAsRenamed(e){if(!e||typeof e!="object")return;try{e[APP_EVENTS_AUTO_BACKUP_RENAMED_FLAG]=!0}catch{}const t=e.projectInfo;if(t&&typeof t=="object")try{t[APP_EVENTS_AUTO_BACKUP_RENAMED_FLAG]=!0}catch{}}function callEventsCoreFunction(e,t=[],o={}){if(typeof callCoreFunctionIfAvailable=="function")return callCoreFunctionIfAvailable(e,t,o);const r=(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null)||null,n=typeof e=="string"?r&&r[e]:e;if(typeof n=="function"){try{return n.apply(r,t)}catch(a){if(eventsLogger&&typeof eventsLogger.error=="function"){const s={functionName:e,deferred:!!(o&&o.defer),argumentsSnapshot:Array.isArray(t)?t.slice(0,5):null};try{eventsLogger.error(`Failed to invoke ${e}`,a,s)}catch{}}typeof console<"u"&&typeof console.error=="function"&&console.error(`Failed to invoke ${e}`,a)}return}if(o&&o.defer===!0){const a=r&&Array.isArray(r.CORE_BOOT_QUEUE)?r.CORE_BOOT_QUEUE:null;a&&a.push(()=>{callEventsCoreFunction(e,t,{...o,defer:!1})})}return o&&Object.prototype.hasOwnProperty.call(o,"defaultValue")?o.defaultValue:void 0}const CORE_FUNCTION_MISSING_SENTINEL=Object.freeze({missing:!0}),VIDEO_POWER_INPUT_HELPERS=(function e(){if(typeof require=="function")try{const t=require("./modules/video-power-inputs.js");if(t&&typeof t=="object")return t}catch{}return{}})();function invokeCoreFunctionStrict(e,t=[]){const o=callEventsCoreFunction(e,t,{defaultValue:CORE_FUNCTION_MISSING_SENTINEL});if(o===CORE_FUNCTION_MISSING_SENTINEL){const r=new ReferenceError(`Missing core function: ${e}`);if(eventsLogger&&typeof eventsLogger.error=="function")try{eventsLogger.error(`Missing core function: ${e}`,r)}catch{}throw r}return o}function resolveFirstPowerInputType(e){let t;try{t=callEventsCoreFunction("firstPowerInputType",[e])}catch(o){if(eventsLogger&&typeof eventsLogger.warn=="function")try{eventsLogger.warn("Failed to resolve firstPowerInputType from core",o,{namespace:"device-editor"})}catch{}typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to resolve firstPowerInputType from core",o)}if(typeof t=="string")return t;if(Array.isArray(t)&&t.length)return typeof t[0]=="string"?t[0]:"";if(t&&typeof t=="object"){const o=t.type||t.portType;if(typeof o=="string")return o}return""}function resolveCoreOptionsArray(e,t=[]){const o=Array.isArray(t)?t.slice():[];try{const r=callEventsCoreFunction(e);if(Array.isArray(r))return r.slice()}catch(r){if(eventsLogger&&typeof eventsLogger.warn=="function")try{eventsLogger.warn(`Failed to resolve ${e}`,r)}catch{}typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Failed to resolve ${e}`,r)}return o}function readGlobalArraySnapshot(e){const t=getGlobalScope$2();if(!t||!e)return[];const o=t[e];return Array.isArray(o)?o.slice():[]}function publishGlobalArraySnapshot(e,t){const o=getGlobalScope$2();if(!(!o||!e)){if(!Array.isArray(t)){delete o[e];return}try{o[e]=t.slice()}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Failed to persist ${e} options on the global scope`,r)}}}function syncCoreOptionsArray(e,t,o=[]){const r=[],n=new Set,a=u=>{if(Array.isArray(u))for(let d=0;d<u.length;d+=1){const m=u[d];typeof m=="string"&&(n.has(m)||(n.add(m),r.push(m)))}};a(o),a(readGlobalArraySnapshot(e));const s=resolveCoreOptionsArray(t,r),l=Array.isArray(s)?s:r;return publishGlobalArraySnapshot(e,l),l}const initialViewfinderTypeOptions=typeof viewfinderTypeOptions<"u"&&Array.isArray(viewfinderTypeOptions)?viewfinderTypeOptions:[];viewfinderTypeOptions=syncCoreOptionsArray("viewfinderTypeOptions","getAllViewfinderTypes",initialViewfinderTypeOptions);const initialViewfinderConnectorOptions=typeof viewfinderConnectorOptions<"u"&&Array.isArray(viewfinderConnectorOptions)?viewfinderConnectorOptions:[];viewfinderConnectorOptions=syncCoreOptionsArray("viewfinderConnectorOptions","getAllViewfinderConnectors",initialViewfinderConnectorOptions);function readCoreDeviceSelectionHelper(){return typeof globalThis<"u"&&typeof globalThis.hasAnyDeviceSelection=="function"?globalThis.hasAnyDeviceSelection:typeof window<"u"&&typeof window.hasAnyDeviceSelection=="function"?window.hasAnyDeviceSelection:typeof self<"u"&&typeof self.hasAnyDeviceSelection=="function"?self.hasAnyDeviceSelection:typeof global<"u"&&typeof global.hasAnyDeviceSelection=="function"?global.hasAnyDeviceSelection:null}function refreshDeviceListsSafe(){if(typeof refreshDeviceLists=="function")try{refreshDeviceLists();return}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("refreshDeviceLists failed, retrying via core bridge.",e)}if(typeof callEventsCoreFunction=="function")try{callEventsCoreFunction("refreshDeviceLists")}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not refresh device lists via core bridge.",e)}}function hasAnyDeviceSelectionSafe(e){const t=readCoreDeviceSelectionHelper();if(t)try{return t(e)}catch(n){if(eventsLogger&&typeof eventsLogger.warn=="function"){const a=e&&typeof e=="object"?Object.keys(e).slice(0,10):null;try{eventsLogger.warn("Failed to evaluate device selections via core helper",n,{statePreview:a})}catch{}}typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to evaluate device selections via core helper",n)}if(!e||typeof e!="object")return!1;const o=n=>{if(Array.isArray(n))return n.some(s=>o(s));if(n==null)return!1;const a=typeof n=="string"?n.trim():n;if(!a)return!1;if(typeof a=="string"){const s=a.toLowerCase();if(s==="none"||s==="--"||s==="—"||s==="n/a"||s==="tbd"||s==="pending"||s.startsWith("-- ")||s.startsWith("— ")||s.startsWith("select ")||s.startsWith("choose ")||s.startsWith("pick ")||s.startsWith("add "))return!1}return!0};return!!([e.camera,e.monitor,e.video,e.cage,e.batteryPlate,e.battery,e.batteryHotswap].some(n=>o(n))||o(e.motors)||o(e.controllers)||o(e.distance))}function getEventsCoreValue(e,t={}){const o=Object.prototype.hasOwnProperty.call(t,"defaultValue")?t.defaultValue:"",r=callEventsCoreFunction(e,[],{defaultValue:o});if(typeof r=="string")return r;if(r==null)return o;try{return String(r)}catch{return o}}function storeLoadedSetupStateSafe$1(e){callEventsCoreFunction("storeLoadedSetupState",[e],{defaultValue:void 0})}function resolveCineUi(){const e=[];typeof globalThis<"u"&&e.push(globalThis),typeof window<"u"&&e.push(window),typeof self<"u"&&e.push(self),typeof global<"u"&&e.push(global);for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"))try{if(o.cineUi&&typeof o.cineUi=="object")return o.cineUi}catch{}}return null}function getSetupSelectElement(){if(typeof setupSelect<"u"&&setupSelect)return setupSelect;if(typeof document<"u"&&document){const e=document.getElementById("setupSelect");if(e)return e}return null}function addSafeEventListener(e,t,o,r){if(e&&typeof e.addEventListener=="function"){e.addEventListener(t,o,r);return}const n=a=>{let s=document.getElementById(a);if(!s)try{s=document.querySelector(a)}catch{}return s};if(typeof e=="string"){const a=n(e);if(a){a.addEventListener(t,o,r);return}if(EVENTS_UI_HELPERS&&typeof EVENTS_UI_HELPERS.whenElementAvailable=="function"){EVENTS_UI_HELPERS.whenElementAvailable(e,s=>{s&&typeof s.addEventListener=="function"&&s.addEventListener(t,o,r)});return}}document.addEventListener("DOMContentLoaded",()=>{let a=null;typeof e=="string"?a=n(e):e&&e.id&&(a=document.getElementById(e.id)),a&&typeof a.addEventListener=="function"&&a.addEventListener(t,o,r)})}let eventsCineUiRegistered=!1;function enqueueCineUiRegistration$2(e){const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!t||typeof e!="function")return;try{const r=t.cineUi&&typeof t.cineUi=="object"?t.cineUi:null;if(r){e(r);return}}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("cineUi registration callback failed",r);return}const o="__cineUiReadyQueue";Array.isArray(t[o])||(t[o]=[]),t[o].push(e)}enqueueCineUiRegistration$2(registerEventsCineUiInternal);addSafeEventListener("languageSelect","change",e=>{const t=()=>{if(typeof populateUserButtonDropdowns=="function")try{populateUserButtonDropdowns()}catch(o){console.warn("Failed to refresh user button selectors after manual language change",o)}};try{const o=setLanguage(e.target.value);if(o&&typeof o.then=="function"){o.then(t).catch(r=>{console.warn("Language selection update failed",r)});return}}catch(o){console.warn("Language selection handler threw",o)}t()});addSafeEventListener("skipLink","click",()=>{const e=document.getElementById("mainContent");e&&e.focus()});function handleSaveSetupClickInternal(e){const t=e&&e.silent===!0,o=texts[currentLang]||{},r=texts.en||{};if(typeof applyPendingProjectNameCollisionResolution=="function")try{applyPendingProjectNameCollisionResolution()}catch(G){console.warn("Failed to finalize pending project name collision before saving setup",G)}const n=setupNameInput.value.trim();if(!n){t||(typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:o.alertSetupNameTitle||r.alertSetupNameTitle||"Project Name Required",message:texts[currentLang].alertSetupName}):alert(texts[currentLang].alertSetupName));return}const a={...getCurrentSetupState()},s=hasAnyDeviceSelectionSafe(a),l=getCurrentGearListHtml();l&&(a.gearList=l);const u=getSetupSelectElement(),d=u&&typeof u.value=="string"?u.value:"",m=!!(d&&n&&d!==n),y=m&&typeof d=="string"&&d.startsWith("auto-backup-");let h=getSetups();const b=m?JSON.parse(JSON.stringify(h||{})):null;let v=n,C=null,A=!m,w=!1;if(m){if(typeof loadProject=="function")try{C=loadProject(d)}catch(G){console.warn("Failed to load project data while renaming setup",G)}if(typeof renameSetup=="function"){try{const G=renameSetup(d,n);typeof G=="string"&&G&&(v=G)}catch(G){console.warn("Failed to rename setup in storage",G)}h=getSetups()}else Object.prototype.hasOwnProperty.call(h,d)&&(h[n]=h[d],delete h[d],v=n)}const R=typeof v=="string"&&v.startsWith("auto-backup-");if(y&&R&&markAutoBackupDataAsRenamed(a),h[v]=a,storeSetups(h),m&&C&&typeof saveProject=="function"){w=!0;try{y&&R&&markAutoBackupDataAsRenamed(C),saveProject(v,C,{skipOverwriteBackup:!0,renamedFrom:d}),A=!0}catch(G){A=!1,console.warn("Failed to preserve project data during setup rename",G)}if(A&&typeof loadProject=="function")try{const G=loadProject(v);A=!!(G&&typeof G=="object")}catch(G){A=!1,console.warn("Failed to confirm project data after setup rename",G)}}else m&&C&&(w=!0,A=!1);if(m&&w&&!A){b&&(storeSetups(b),h=b),v=d;const G=o.alertSetupRenameSaveFailed||r.alertSetupRenameSaveFailed;if(typeof G=="string"&&G)if(typeof showNotification=="function")try{showNotification("warning",G)}catch{}else typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:o.alertSetupRenameSaveFailedTitle||"Rename Failed",message:G}):alert(G)}if(populateSetupSelect$1(),t||(setupNameInput.value=v),u&&(u.value=v),lastSetupName$1=v,saveCurrentSession(),storeLoadedSetupStateSafe$1(getCurrentSetupState()),checkSetupChanged(),saveCurrentGearList(),m&&d&&d!==v&&A){if(typeof deleteProject=="function")try{deleteProject(d)}catch(G){console.warn("Failed to remove old project entry during setup rename",G)}else if(typeof saveProject=="function")try{saveProject(d,{projectInfo:null,gearList:""},{skipOverwriteBackup:!0})}catch(G){console.warn("Failed to clear legacy project entry during setup rename",G)}}saveSetupBtn&&(saveSetupBtn.disabled=!setupNameInput.value.trim());const _=s?o.alertSetupSaved||r.alertSetupSaved:o.alertSetupSavedNoDevices||r.alertSetupSavedNoDevices||o.alertSetupSaved||r.alertSetupSaved;if(!t&&typeof _=="string"&&_){const G=_.replace("{name}",v);typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:o.alertSetupSavedTitle||r.alertSetupSavedTitle||"Project Saved",message:G}):alert(G)}}function handleSaveSetupClick(e){typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.showLoading("Saving Project..."),typeof setTimeout=="function"?setTimeout(function(){try{handleSaveSetupClickInternal(e)}catch(t){console.error("Save failed:",t),alert("Save failed: "+t.message)}finally{typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.hideLoading()}},50):(handleSaveSetupClickInternal(e),typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.hideLoading())}addSafeEventListener("saveSetupBtn","click",handleSaveSetupClick);setupNameInput&&(addSafeEventListener("setupName","input",function(){if(saveSetupBtn&&(saveSetupBtn.disabled=!setupNameInput.value.trim()),typeof checkSetupChanged=="function")try{checkSetupChanged()}catch(e){console.warn("Failed to evaluate setup change status after name update",e)}}),addSafeEventListener("setupName","keydown",function(e){e.isComposing||e.key==="Enter"&&(e.preventDefault(),handleSaveSetupClick(e))}));function handleDeleteSetupClickInternal(){const e=getSetupSelectElement(),t=e&&typeof e.value=="string"?e.value:"";if(!t){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertNoSetupSelectedTitle||"No Project Selected",message:texts[currentLang].alertNoSetupSelected}):alert(texts[currentLang].alertNoSetupSelected);return}const o=()=>{typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.showLoading("Deleting Project..."),setTimeout(()=>{try{if(!ensureAutoBackupBeforeDeletion$1("delete setup"))return;let n=getSetups();delete n[t],storeSetups(n),typeof deleteProject=="function"&&deleteProject(t),populateSetupSelect$1(),setupNameInput.value="";let a=!1;if(e&&typeof e.dispatchEvent=="function"&&(lastSetupName$1="",e.value="",e.dispatchEvent(new Event("change")),a=!0),!a){gearListOutput&&(gearListOutput.innerHTML="",gearListOutput.classList.add("hidden")),projectRequirementsOutput&&(projectRequirementsOutput.innerHTML="",projectRequirementsOutput.classList.add("hidden")),currentProjectInfo=null,projectForm&&populateProjectForm({}),storeLoadedSetupStateSafe$1(null),updateBatteryPlateVisibility(),updateBatteryOptions(),clearProjectAutoGearRules(),renderAutoGearRulesList(),updateAutoGearCatalogOptions(),[cameraSelect,monitorSelect,videoSelect,cageSelect,distanceSelect,batterySelect,hotswapSelect].forEach(u=>{Array.from(u.options).find(m=>m.value==="None")?u.value="None":u.selectedIndex=0}),typeof updateCageSelectOptions=="function"&&updateCageSelectOptions("None");const l=getSliderBowlSelect();l&&(l.value=""),motorSelects.forEach(u=>{u.options.length&&(u.value="None")}),controllerSelects.forEach(u=>{u.options.length&&(u.value="None")}),updateCalculations()}const s=texts[currentLang].alertSetupDeleted.replace("{name}",t);typeof window.cineShowAlertDialog=="function"&&(window.cineShowAlertDialog({title:texts[currentLang]&&texts[currentLang].deleteSetupTitle||"Project Deleted",message:s}),alert(s))}finally{typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.hideLoading()}},50)};typeof window.cineShowConfirmDialog=="function"?window.cineShowConfirmDialog({title:texts[currentLang]&&texts[currentLang].deleteSetupTitle||"Delete Project",message:texts[currentLang].confirmDeleteSetup.replace("{name}",t),confirmLabel:"Delete",danger:!0,onConfirm:()=>{setTimeout(()=>{window.cineShowConfirmDialog({title:texts[currentLang]&&texts[currentLang].areYouSure||"Are you sure?",message:texts[currentLang].confirmDeleteSetupAgain,confirmLabel:"Confirm Delete",danger:!0,onConfirm:()=>o()})},150)}}):confirm(texts[currentLang].confirmDeleteSetup.replace("{name}",t))&&confirm(texts[currentLang].confirmDeleteSetupAgain)&&o()}function handleDeleteSetupClick(){handleDeleteSetupClickInternal()}addSafeEventListener("deleteSetupBtn","click",handleDeleteSetupClick);function resetSetupStateToDefaults(e={}){const t=typeof suspendProjectPersistence=="function"&&typeof resumeProjectPersistence=="function";if(t)try{suspendProjectPersistence()}catch(n){console.warn("Failed to suspend project persistence during setup reset",n)}const r=!!(typeof e=="object"&&e!==null?e:{}).preserveSetupNameInput;try{!r&&setupNameInput&&(setupNameInput.value="");const n=s=>{if(!s||typeof s!="object")return;const l=s===cameraSelect;Array.from(s.options||[]).find(d=>d.value==="None")?s.value="None":s.options&&s.options.length?s.selectedIndex=0:s.value="",l&&callEventsCoreFunction("updateRecordingMediaOptions")};if([cameraSelect,monitorSelect,videoSelect,cageSelect,distanceSelect,batterySelect,hotswapSelect].forEach(n),typeof updateCageSelectOptions=="function")try{updateCageSelectOptions("None")}catch(s){console.warn("Failed to reset cage options while preparing setup switch",s)}const a=typeof getSliderBowlSelect=="function"?getSliderBowlSelect():null;if(a&&(a.value=""),Array.isArray(motorSelects)&&motorSelects.forEach(n),Array.isArray(controllerSelects)&&controllerSelects.forEach(n),typeof updateBatteryPlateVisibility=="function")try{updateBatteryPlateVisibility()}catch(s){console.warn("Failed to reset battery plate visibility while preparing setup switch",s)}if(typeof updateBatteryOptions=="function")try{updateBatteryOptions()}catch(s){console.warn("Failed to reset battery options while preparing setup switch",s)}if(typeof displayGearAndRequirements=="function")try{displayGearAndRequirements("")}catch(s){console.warn("Failed to reset gear and requirements display while preparing setup switch",s)}if(gearListOutput&&(gearListOutput.innerHTML="",gearListOutput.classList&&gearListOutput.classList.add("hidden")),projectRequirementsOutput&&(projectRequirementsOutput.innerHTML="",projectRequirementsOutput.classList&&projectRequirementsOutput.classList.add("hidden")),currentProjectInfo=null,projectForm)try{populateProjectForm({})}catch(s){console.warn("Failed to reset project form while preparing setup switch",s)}if(typeof clearProjectAutoGearRules=="function")try{clearProjectAutoGearRules()}catch(s){console.warn("Failed to clear project auto gear rules while preparing setup switch",s)}if(typeof setManualDiagramPositions=="function")try{setManualDiagramPositions({},{render:!1})}catch(s){console.warn("Failed to reset manual diagram positions while preparing setup switch",s)}try{storeLoadedSetupStateSafe$1(null)}catch(s){console.warn("Failed to reset stored setup state while preparing setup switch",s)}typeof globalThis<"u"&&(globalThis.__cineLastGearListHtml="")}finally{if(t)try{resumeProjectPersistence()}catch(n){console.warn("Failed to resume project persistence after setup reset",n)}}}function finalizeSetupSelection(e){if(typeof renderAutoGearRulesList=="function")try{renderAutoGearRulesList()}catch(t){console.warn("Failed to render auto gear rules list after setup switch",t)}if(typeof updateAutoGearCatalogOptions=="function")try{updateAutoGearCatalogOptions()}catch(t){console.warn("Failed to update auto gear catalog options after setup switch",t)}if(saveSetupBtn&&(saveSetupBtn.disabled=!setupNameInput.value.trim()),typeof updateCalculations=="function")try{updateCalculations()}catch(t){console.warn("Failed to update calculations after setup switch",t)}if(typeof checkSetupChanged=="function")try{checkSetupChanged()}catch(t){console.warn("Failed to evaluate setup changes after setup switch",t)}typeof setActiveProjectCompressionHold=="function"&&setActiveProjectCompressionHold(e),lastSetupName$1=e}getSetupSelectElement();addSafeEventListener("setupSelect","change",e=>{const t=e.target.value,o=setupNameInput&&typeof setupNameInput.value=="string"?setupNameInput.value:"",r=o.trim(),n=(lastSetupName$1&&typeof lastSetupName$1=="string"?lastSetupName$1:"")||r||"";typeof setActiveProjectCompressionHold=="function"&&setActiveProjectCompressionHold(n);const a=d=>typeof d=="string"?d.replace(/\s+/g," ").trim():"",s=a(lastSetupName$1),l=a(t);let u=!1;if(typeof scheduleProjectAutoSave=="function")try{const d=typeof normalizeSetupName=="function"?normalizeSetupName:(b=>typeof b=="string"?b.trim():""),m=d(typeof lastSetupName$1=="string"?lastSetupName$1:""),y=d(n),h={setupNameState:{typedName:r,selectedName:m,storageKey:y,renameInProgress:!!(m&&r&&r!==m),typedNameHasTrailingWhitespace:!!(r&&typeof o=="string"&&/\s$/.test(o))}};scheduleProjectAutoSave({immediate:!0,overrides:h}),u=!0}catch(d){console.warn("Failed to flush project autosave before switching setups",d)}if(!u)try{typeof saveCurrentSession=="function"&&saveCurrentSession(),typeof saveCurrentGearList=="function"&&saveCurrentGearList()}catch(d){console.warn("Failed to persist project state before switching setups",d)}if(typeof saveProject=="function"){const d=projectForm?collectProjectFormData():{};d&&(d.sliderBowl=getEventsCoreValue("getSliderBowlValue"),d.easyrig=getEventsCoreValue("getEasyrigValue"));const m=deriveProjectInfo(d);currentProjectInfo=m;const y=typeof normalizeSetupName=="function"?normalizeSetupName:(_=>typeof _=="string"?_.trim():""),h=y(n),b=y(r),v=!!(h&&b&&b!==h),C=typeof createProjectInfoSnapshotForStorage=="function"?createProjectInfoSnapshotForStorage(m,{projectNameOverride:v?h:void 0}):m,A=typeof getPowerSelectionSnapshot=="function"?getPowerSelectionSnapshot():null,w={projectInfo:C,gearList:getCurrentGearListHtml()};if(A&&(w.powerSelection=A),typeof getDiagramManualPositions=="function"){const _=getDiagramManualPositions();_&&Object.keys(_).length&&(w.diagramPositions=_)}const R=getProjectScopedAutoGearRules();R&&R.length&&(w.autoGearRules=R),saveProject(n,w,{skipOverwriteBackup:!0})}if(typeof autoBackup$1=="function"&&l!==s)try{autoBackup$1({suppressSuccess:!0,projectNameOverride:a(n),triggerAutoSaveNotification:!0,reason:"project-switch"})}catch(d){console.warn("Failed to auto backup project before loading a different setup",d)}if(resetSetupStateToDefaults(),t===""){finalizeSetupSelection(t);return}{const m=getSetups()[t];if(m){setupNameInput.value=t,cameraSelect.value=m.camera||"None",callEventsCoreFunction("updateRecordingMediaOptions"),updateBatteryPlateVisibility(),batteryPlateSelect.value=m.batteryPlate||batteryPlateSelect.value,applyBatteryPlateSelectionFromBattery(m.battery||"",batteryPlateSelect.value),monitorSelect.value=m.monitor||"None",videoSelect.value=m.video||"None",typeof updateCageSelectOptions=="function"?updateCageSelectOptions(m.cage||"None"):cageSelect&&(cageSelect.value=m.cage||"None"),(m.motors||[]).forEach((w,R)=>{motorSelects[R]&&(motorSelects[R].value=w)}),(m.controllers||[]).forEach((w,R)=>{controllerSelects[R]&&(controllerSelects[R].value=w)}),distanceSelect.value=m.distance||"None",batterySelect.value=m.battery||"None",applyBatteryPlateSelectionFromBattery(m.battery||"",batteryPlateSelect?batteryPlateSelect.value:""),hotswapSelect.value=m.batteryHotswap||"None",setSliderBowlValue(m.sliderBowl||""),setEasyrigValue(m.easyrig||"");let y=!1;m.powerSelection&&typeof applyStoredPowerSelection=="function"&&(y=applyStoredPowerSelection(m.powerSelection,{preferExisting:!1}));const h=typeof loadProject=="function"?loadProject(t):null;!y&&h&&typeof applyStoredPowerSelection=="function"&&h.powerSelection&&(y=applyStoredPowerSelection(h.powerSelection,{preferExisting:!1})),updateBatteryOptions(),!y&&h&&typeof applyStoredPowerSelection=="function"&&h.powerSelection&&(y=applyStoredPowerSelection(h.powerSelection,{preferExisting:!1}),y&&updateBatteryOptions());const b=typeof m.gearList=="string"&&m.gearList?m.gearList:typeof h?.gearList=="string"?h.gearList:"";currentProjectInfo=m.projectInfo||h?.projectInfo||null;const v=w=>callEventsCoreFunction("generateGearListHtml",[w||{}],{defaultValue:""})||"";let C=b;if(C||(C=v(currentProjectInfo||{})),C&&typeof globalThis<"u"&&(globalThis.__cineLastGearListHtml=C),typeof setManualDiagramPositions=="function"){let w={};if(typeof normalizeDiagramPositionsInput=="function"){w=normalizeDiagramPositionsInput(h?.diagramPositions);const R=normalizeDiagramPositionsInput(m.diagramPositions);Object.keys(R).length&&(w={...w,...R})}setManualDiagramPositions(w,{render:!1})}const A=Array.isArray(m.autoGearRules)&&m.autoGearRules.length?m.autoGearRules:Array.isArray(h?.autoGearRules)&&h.autoGearRules.length?h.autoGearRules:null;if(A?useProjectAutoGearRules(A):clearProjectAutoGearRules(),gearListOutput&&(displayGearAndRequirements(C),populateProjectForm(currentProjectInfo||{}),C&&(ensureGearListActions(),bindGearListCageListener(),bindGearListEasyrigListener(),bindGearListSliderBowlListener(),bindGearListEyeLeatherListener(),bindGearListProGaffTapeListener(),bindGearListDirectorMonitorListener()),typeof saveProject=="function")){const w={projectInfo:currentProjectInfo,gearListAndProjectRequirementsGenerated:!!C},R=typeof getPowerSelectionSnapshot=="function"?getPowerSelectionSnapshot():null;if(R&&(w.powerSelection=R),typeof getDiagramManualPositions=="function"){const G=getDiagramManualPositions();G&&Object.keys(G).length&&(w.diagramPositions=G)}const _=getProjectScopedAutoGearRules();_&&_.length&&(w.autoGearRules=_),m.gearSelectors&&Object.keys(m.gearSelectors).length?w.gearSelectors=m.gearSelectors:h?.gearSelectors&&Object.keys(h.gearSelectors).length&&(w.gearSelectors=h.gearSelectors),saveProject(t,w,{skipOverwriteBackup:!0})}}else{const y=typeof loadProject=="function"?loadProject(t):null;if(y&&typeof applyStoredPowerSelection=="function"&&y.powerSelection?applyStoredPowerSelection(y.powerSelection,{preferExisting:!1})&&updateBatteryOptions():updateBatteryOptions(),currentProjectInfo=y?.projectInfo||null,projectForm&&populateProjectForm(currentProjectInfo||{}),gearListOutput){const h=C=>callEventsCoreFunction("generateGearListHtml",[C||{}],{defaultValue:""})||"",v=(typeof y?.gearList=="string"?y.gearList:"")||h(currentProjectInfo||{});displayGearAndRequirements(v),v&&(ensureGearListActions(),bindGearListCageListener(),bindGearListEasyrigListener(),bindGearListSliderBowlListener(),bindGearListEyeLeatherListener(),bindGearListProGaffTapeListener(),bindGearListDirectorMonitorListener())}else displayGearAndRequirements("");if(clearProjectAutoGearRules(),typeof setManualDiagramPositions=="function"){const h=y?.diagramPositions&&typeof normalizeDiagramPositionsInput=="function"?normalizeDiagramPositionsInput(y.diagramPositions):{};setManualDiagramPositions(h||{},{render:!1})}}storeLoadedSetupStateSafe$1(getCurrentSetupState())}finalizeSetupSelection(t)});function populateSetupSelect$1(){const e=typeof getSetups=="function"?getSetups:null,t=getSetupSelectElement();if(!t){console.warn("populateSetupSelect: setup select element unavailable, aborting populate");return}const o=typeof texts=="object"&&texts?texts[currentLang]||texts.en||{}:{},r=typeof o.newSetupOption=="string"&&o.newSetupOption.trim()?o.newSetupOption:"New setup";e||console.warn("populateSetupSelect: getSetups is unavailable, using empty setup list");const n=e?e()||{}:{};t.innerHTML=`<option value="">${r}</option>`;let a=!1;if(typeof loadAutoGearBackupVisibility=="function")a=loadAutoGearBackupVisibility();else if(typeof showAutoBackups=="boolean")a=showAutoBackups;else if(typeof localStorage<"u")try{a=localStorage.getItem("showAutoBackups")==="true"}catch(l){console.warn("Could not read auto backup visibility preference",l)}if(a&&typeof ensureAutoBackupsFromProjects=="function")try{ensureAutoBackupsFromProjects()}catch(l){console.warn("Failed to prepare auto backups before populating selector",l)}const s=Object.keys(n).filter(l=>a||!l.startsWith("auto-backup-")).sort((l,u)=>{const d=l.startsWith("auto-backup-"),m=u.startsWith("auto-backup-");return d!==m?d?1:-1:localeSort(l,u)});for(const l of s){const u=document.createElement("option");u.value=l,u.textContent=l,t.appendChild(u)}if(typeof document<"u"&&document.dispatchEvent&&typeof CustomEvent=="function")try{document.dispatchEvent(new CustomEvent("cine:setupselect:populated",{detail:{count:s.length,timestamp:Date.now()}}))}catch{}}typeof EVENTS_UI_HELPERS.whenElementAvailable=="function"?EVENTS_UI_HELPERS.whenElementAvailable("setupSelect",()=>{populateSetupSelect$1(),typeof checkSetupChanged=="function"&&checkSetupChanged()}):(populateSetupSelect$1(),typeof checkSetupChanged=="function"&&checkSetupChanged());function notifyAutoSaveFromBackup$1(e,t,o){if(typeof e!="string")return;const r=e.trim();if(!r)return;const n="success";if(typeof showNotification=="function")try{showNotification(n,r)}catch(a){console.warn("Failed to display auto save notification after auto backup",a)}if(typeof document<"u"&&typeof CustomEvent=="function"&&document&&typeof document.dispatchEvent=="function")try{document.dispatchEvent(new CustomEvent("cine:auto-save-notification",{detail:{message:r,source:"auto-backup",backupName:t||null,severity:n,timestamp:new Date().toISOString()}}))}catch(a){console.warn("Failed to dispatch auto save notification event after auto backup",a)}}const AUTO_BACKUP_MAX_DELTA_SEQUENCE=30;let lastAutoBackupSignature=null,lastAutoBackupName=null,lastAutoBackupCreatedAtIso=null;function createStableValueSignature(e){if(e===null)return"null";if(e===void 0)return"undefined";if(Array.isArray(e)){let o="[";for(let r=0;r<e.length;r+=1)r>0&&(o+=","),o+=createStableValueSignature(e[r]);return o+="]",o}if(e instanceof Date){const o=e.getTime();return Number.isNaN(o)?"date:invalid":`date:${o}`}const t=typeof e;if(t==="number")return Number.isNaN(e)?"number:NaN":Number.isFinite(e)?`number:${e}`:e>0?"number:Infinity":"number:-Infinity";if(t==="bigint")return`bigint:${e.toString()}`;if(t==="boolean")return e?"boolean:true":"boolean:false";if(t==="string")return`string:${e}`;if(t==="symbol")return`symbol:${String(e)}`;if(t==="function")return`function:${e.name||"anonymous"}`;if(t==="object"){const o=Object.keys(e).sort();let r="{";for(let n=0;n<o.length;n+=1){const a=o[n];n>0&&(r+=","),r+=`${JSON.stringify(a)}:${createStableValueSignature(e[a])}`}return r+="}",r}return`${t}:${String(e)}`}function computeAutoBackupStateSignature(e,t,o){return createStableValueSignature({setup:e||null,gearSelectors:t||null,gearListGenerated:!!o})}function hasMeaningfulAutoBackupContent(e,t,o){const r=hasAnyDeviceSelectionSafe(e),n=!!(e&&typeof e=="object"&&e.projectInfo),a=Array.isArray(e&&e.autoGearRules)&&e.autoGearRules.length>0,s=!!(e&&e.diagramPositions&&typeof e.diagramPositions=="object"&&Object.keys(e.diagramPositions).length>0),l=!!(t&&typeof t=="object"&&Object.keys(t).length>0),u=!!(e&&e.powerSelection&&typeof e.powerSelection=="object"&&Object.keys(e.powerSelection).length>0);return r||n||a||s||l||u||!!o}function getSortedAutoBackupNames(e){return!e||typeof e!="object"?[]:Object.keys(e).filter(t=>typeof t=="string"&&t.startsWith("auto-backup-")).sort()}function resolveLatestAutoBackupEntry(e){const t=getSortedAutoBackupNames(e);if(!t.length)return{name:null,entry:null};const o=t[t.length-1],r=e&&typeof e=="object"?e[o]:null;return{name:o,entry:r}}function computeStoredAutoBackupSignature(e,t){if(!t||typeof t!="object")return createStableValueSignature(null);let o=null;t.gearSelectors&&typeof t.gearSelectors=="object"&&(o=t.gearSelectors);let r=!1;if(typeof loadProject=="function"&&e)try{const n=loadProject(e);n&&typeof n=="object"&&(!o&&n.gearSelectors&&typeof n.gearSelectors=="object"&&(o=n.gearSelectors),typeof n.gearListAndProjectRequirementsGenerated=="boolean"&&(r=n.gearListAndProjectRequirementsGenerated))}catch(n){console.warn("Failed to inspect stored project payload for auto backup signature",n)}return computeAutoBackupStateSignature(t,o,r)}function ensureLastAutoBackupSignatureInitialized(e){if(lastAutoBackupSignature||!e||typeof e!="object")return;const{name:t,entry:o}=resolveLatestAutoBackupEntry(e);if(!(!t||!o||typeof o!="object"))try{lastAutoBackupSignature=computeStoredAutoBackupSignature(t,o),lastAutoBackupName=t;const r=readAutoBackupMetadata(o);if(r&&typeof r.createdAt=="string"){lastAutoBackupCreatedAtIso=r.createdAt;const n=Date.parse(r.createdAt);Number.isNaN(n)||(lastAutoBackupCompletedAtMs=n)}}catch(r){lastAutoBackupSignature=null,console.warn("Failed to prime automatic backup signature cache",r)}}function readAutoBackupMetadata(e){if(!e||typeof e!="object")return null;const t=e.__cineAutoBackupMetadata;return!t||typeof t!="object"?null:t}function attachAutoBackupMetadata(e,t){if(!e||typeof e!="object")return;const o=t&&typeof t=="object"?{version:typeof t.version=="number"?t.version:1,snapshotType:t.snapshotType==="delta"?"delta":"full",base:typeof t.base=="string"?t.base:null,sequence:typeof t.sequence=="number"?t.sequence:0,createdAt:typeof t.createdAt=="string"?t.createdAt:null,changedKeys:Array.isArray(t.changedKeys)?t.changedKeys.slice():[],removedKeys:Array.isArray(t.removedKeys)?t.removedKeys.slice():[]}:null;try{Object.defineProperty(e,"__cineAutoBackupMetadata",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{try{e.__cineAutoBackupMetadata=o}catch{}}}function determineNextAutoBackupPlan(e){if(!e||typeof e!="object")return{snapshotType:"full",base:null,sequence:0};const t=getSortedAutoBackupNames(e);if(!t.length)return{snapshotType:"full",base:null,sequence:0};const o=t[t.length-1],r=e[o],n=readAutoBackupMetadata(r);if(!r||!n)return{snapshotType:"full",base:null,sequence:0};const a=typeof n.sequence=="number"?n.sequence:0;return a>=AUTO_BACKUP_MAX_DELTA_SEQUENCE?{snapshotType:"full",base:null,sequence:0}:{snapshotType:"delta",base:o,sequence:a+1}}function autoBackup$1(e={}){const t=getSetupSelectElement();if(!t)return null;const o=typeof e=="object"&&e!==null?e:{},r=!!o.suppressSuccess,n=!!o.suppressError,a=o.force===!0,s=typeof o.reason=="string"&&o.reason?o.reason:"unspecified",l=typeof o.successMessage=="string"&&o.successMessage?o.successMessage:"Auto backup saved",u=typeof o.errorMessage=="string"&&o.errorMessage?o.errorMessage:"Auto backup failed",d=!!o.triggerAutoSaveNotification,m=typeof o.autoSaveNotificationMessage=="string"&&o.autoSaveNotificationMessage.trim()?o.autoSaveNotificationMessage.trim():l,y=z=>typeof z=="string"?z.replace(/\s+/g," ").trim():"",b=Object.prototype.hasOwnProperty.call(o,"projectNameOverride")?y(o.projectNameOverride):null,v=typeof t.value=="string"?t.value:"",C=setupNameInput&&typeof setupNameInput.value=="string"?setupNameInput.value:"",A=y(v),w=y(C),R=z=>typeof z=="string"&&z.startsWith("auto-backup-"),O=Date.now()-(lastAutoBackupCompletedAtMs||0),B=O>=AUTO_BACKUP_INTERVAL_MS,$=autoBackupChangesSinceSnapshot>=AUTO_BACKUP_CHANGE_THRESHOLD;if(!a&&!AUTO_BACKUP_CADENCE_EXEMPT_REASONS.has(s)&&!B&&!$){const z=Math.max(0,AUTO_BACKUP_INTERVAL_MS-O),x={status:"skipped",reason:"cadence",context:s,elapsedSinceLastAutoBackupMs:O,changesSinceSnapshot:autoBackupChangesSinceSnapshot,requiredIntervalMs:AUTO_BACKUP_INTERVAL_MS,requiredChangeThreshold:AUTO_BACKUP_CHANGE_THRESHOLD,remainingIntervalMs:z,remainingChanges:Math.max(0,AUTO_BACKUP_CHANGE_THRESHOLD-autoBackupChangesSinceSnapshot)};return typeof console<"u"&&typeof console.debug=="function"&&console.debug("Skipping auto backup because cadence requirements are not met.",x),recordAutoBackupRun(x),x}if(!a&&!isAutoBackupReasonAllowed(s)){const z={status:"skipped",reason:"disallowed",context:s||null};return typeof console<"u"&&typeof console.debug=="function"&&console.debug("Skipping auto backup run because the trigger is not permitted.",{trigger:s}),recordAutoBackupRun(z),z}if(!a&&AUTO_BACKUP_RATE_LIMITED_REASONS.has(s)){const W=Date.now()-(lastAutoBackupCompletedAtMs||0)>=AUTO_BACKUP_INTERVAL_MS,U=autoBackupChangesSinceSnapshot>=AUTO_BACKUP_CHANGE_THRESHOLD;if(!W&&!U){const j={status:"skipped",reason:"rate-limited",context:s};return recordAutoBackupRun(j),j}}let M="";if(b!=null){if(b&&R(b)){const z={status:"skipped",reason:"auto-backup-selected",context:s};return recordAutoBackupRun(z),z}M=b}else if(A&&R(A))if(w&&!R(w)&&w!==A)M=w;else{const z={status:"skipped",reason:"auto-backup-selected",context:s};return recordAutoBackupRun(z),z}else A?M=A:w&&(M=w);let F=null;try{F=showAutoBackupIndicatorSafe()}catch(z){console.warn("Failed to prepare auto backup indicator",z),F=null}try{const z=Ut=>String(Ut).padStart(2,"0"),x=new Date,H=`auto-backup-${x.getFullYear()}-${z(x.getMonth()+1)}-${z(x.getDate())}-${z(x.getHours())}-${z(x.getMinutes())}-${z(x.getSeconds())}`,W=M||"",U={...getCurrentSetupState()},j=getSetups();let Y=W?`${H}-${W}`:H;if(j&&typeof j=="object"){let Ut=1;for(;Object.prototype.hasOwnProperty.call(j,Y);){const ge=`copy-${Ut}`,ue=`${H}-${ge}`;Y=W?`${ue}-${W}`:ue,Ut+=1}}ensureLastAutoBackupSignatureInitialized(j);const le=determineNextAutoBackupPlan(j);let be=le;if(le.snapshotType==="delta"){const Ut=le.base&&j?j[le.base]:null;(!Ut||typeof Ut!="object")&&(be={snapshotType:"full",base:null,sequence:0})}const re=getCurrentGearListHtml(),de=!!re;let ne=null;U.gearListAndProjectRequirementsGenerated=de;const Ce=callEventsCoreFunction("getGearListSelectors",[],{defaultValue:{}})||{},Ee=callEventsCoreFunction("cloneGearListSelectors",[Ce],{defaultValue:{}})||{};if(!hasMeaningfulAutoBackupContent(U,Ee,de)){const Ut={status:"skipped",reason:"empty",context:s};return recordAutoBackupRun(Ut),Ut}Ee&&Object.keys(Ee).length&&(U.gearSelectors=Ee);const Pe=computeAutoBackupStateSignature(U,Ee,de),{name:et,entry:Je}=resolveLatestAutoBackupEntry(j);if(!a&&et&&Je)try{if(computeStoredAutoBackupSignature(et,Je)===Pe){const ge=readAutoBackupMetadata(Je),ue=ge&&typeof ge.createdAt=="string"?ge.createdAt:null;return lastAutoBackupSignature=Pe,lastAutoBackupName=et,lastAutoBackupCreatedAtIso=ue,recordAutoBackupRun({status:"skipped",reason:"unchanged",name:et,createdAt:ue,context:s}),lastAutoBackupReasonState.set(s,{timestamp:x.valueOf(),signature:Pe}),{status:"skipped",reason:"unchanged",name:et,createdAt:ue,context:s}}}catch(Ut){console.warn("Failed to compare current auto backup against latest snapshot before saving",Ut)}if(!a){const Ut=lastAutoBackupReasonState.get(s);if(Ut&&x.valueOf()-Ut.timestamp<AUTO_BACKUP_REASON_DEDUP_INTERVAL_MS&&Ut.signature===Pe){const ue={status:"skipped",reason:"duplicate-reason",name:lastAutoBackupName||null,createdAt:lastAutoBackupCreatedAtIso||null,context:s};return recordAutoBackupRun(ue),ue}}if(!a&&lastAutoBackupSignature&&Pe===lastAutoBackupSignature){const Ut={status:"skipped",reason:"unchanged",name:lastAutoBackupName||null,createdAt:lastAutoBackupCreatedAtIso||null,context:s};return recordAutoBackupRun(Ut),Ut}const it=x.toISOString(),rt={version:1,snapshotType:be.snapshotType,base:be.base,sequence:be.sequence,createdAt:it,changedKeys:[],removedKeys:[]};attachAutoBackupMetadata(U,rt);const Pt=j;if(Pt[Y]=U,storeSetups(Pt),typeof saveProject=="function"){const Ut=typeof re=="string"?re:"";let ge=U.projectInfo||null;if(ge&&typeof createProjectInfoSnapshotForStorage=="function")try{ge=createProjectInfoSnapshotForStorage(ge)||ge}catch(Be){console.warn("Failed to normalize project info for auto backup payload",Be)}if(ge&&typeof callEventsCoreFunction=="function")try{const Be=callEventsCoreFunction("cloneProjectInfoForStorage",[ge],{defaultValue:ge});Be&&(ge=Be)}catch(Be){console.warn("Failed to clone project info for auto backup payload",Be)}const ue={projectInfo:ge,gearListAndProjectRequirementsGenerated:!!Ut};Ut&&(ue.gearList=Ut);const We=typeof getPowerSelectionSnapshot=="function"?getPowerSelectionSnapshot():null;if(We&&typeof We=="object"&&Object.keys(We).length&&(ue.powerSelection=We),Ee&&Object.keys(Ee).length&&(ue.gearSelectors=Ee),typeof getDiagramManualPositions=="function")try{const Be=getDiagramManualPositions();Be&&typeof Be=="object"&&Object.keys(Be).length&&(ue.diagramPositions=Be)}catch(Be){console.warn("Failed to capture diagram positions for auto backup payload",Be)}const Me=getProjectScopedAutoGearRules();if(Me&&Me.length){let Be=Me;if(typeof callEventsCoreFunction=="function")try{Be=callEventsCoreFunction("cloneProjectInfoForStorage",[Me],{defaultValue:Me})||Me}catch(Ve){console.warn("Failed to clone auto gear rules for auto backup payload",Ve)}ue.autoGearRules=Be}(ue.projectInfo&&typeof ue.projectInfo=="object"&&Object.keys(ue.projectInfo).length||ue.gearList||ue.gearListAndProjectRequirementsGenerated||ue.powerSelection&&Object.keys(ue.powerSelection).length||ue.gearSelectors&&Object.keys(ue.gearSelectors).length||ue.diagramPositions&&Object.keys(ue.diagramPositions).length||ue.autoGearRules&&ue.autoGearRules.length)&&(attachAutoBackupMetadata(ue,rt),saveProject(Y,ue)),ne=summarizeAutoBackupPayloadForLog(ue)}const vt=t.value,bo=setupNameInput?setupNameInput.value:"";populateSetupSelect$1(),t.value=vt,setupNameInput&&(setupNameInput.value=bo),!r&&typeof showNotification=="function"&&showNotification("success",l),d&&notifyAutoSaveFromBackup$1(m,Y),lastAutoBackupSignature=Pe,lastAutoBackupName=Y,lastAutoBackupCreatedAtIso=it;const Et={status:"success",reason:s,context:s,snapshotType:be.snapshotType,hasPlanBase:!!be.base,sequence:be.sequence,appendedProjectName:!!M,backupNameLength:typeof Y=="string"?Y.length:0,changesSinceSnapshot:autoBackupChangesSinceSnapshot,elapsedSinceLastAutoBackupMs:O,force:a,gearListGenerated:de,payloadSummary:ne||null};return recordAutoBackupRun({status:"success",name:Y,createdAt:it,context:s},Et),lastAutoBackupReasonState.set(s,{timestamp:x.valueOf(),signature:Pe}),Y}catch(z){console.warn("Auto backup failed",z),!n&&typeof showNotification=="function"&&showNotification("error",u);const x={status:"error",reason:"exception",context:s,errorName:z&&typeof z.name=="string"?z.name:null,errorMessage:z&&typeof z.message=="string"?z.message:null};if(z&&typeof z.stack=="string"&&z.stack){const H=z.stack.split(`
`).slice(0,5).join(`
`);x.errorStackPreview=H}return recordAutoBackupRun({status:"error",reason:"exception",context:s},x),null}finally{if(typeof F=="function")try{F()}catch(z){console.warn("Failed to hide auto backup indicator",z)}}}function ensureAutoBackupBeforeDeletion$1(e,t={}){const o=typeof t=="object"&&t!==null?t:{},r=texts[currentLang]||{},n=texts.en||{},a=o.successMessage||r.preDeleteBackupSuccess||n.preDeleteBackupSuccess||"Automatic backup saved. Restore it anytime from Saved Projects.",s=o.failureMessage||r.preDeleteBackupFailed||n.preDeleteBackupFailed||"Automatic backup failed. The action was cancelled.",l=getSetupSelectElement(),u=A=>typeof A=="string"?A.replace(/\s+/g," ").trim():"",d=l&&typeof l.value=="string"?u(l.value):"",m=setupNameInput&&typeof setupNameInput.value=="string"?u(setupNameInput.value):"",y=u(typeof lastSetupName$1=="string"?lastSetupName$1:""),h=A=>typeof A=="string"&&A.startsWith("auto-backup-"),v=[d,m,y].find(A=>A&&!h(A))||"";if(!v)return o.notifyFailure!==!1&&showNotification("error",s),null;if(typeof scheduleProjectAutoSave=="function")try{scheduleProjectAutoSave(!0)}catch(A){console.warn("Failed to flush project autosave before deletion backup",A)}let C={status:"unsupported"};if(typeof createProjectDeletionBackup=="function")try{C=createProjectDeletionBackup(v)}catch(A){console.error(`Automatic backup before ${e} failed`,A),C={status:"failed"}}return C.status==="created"||C.status==="skipped"?(C.status==="created"&&noteAutoBackupRelevantChange({reset:!0}),o.notifySuccess!==!1&&showNotification("success",a),typeof C.backupName=="string"&&C.backupName?C.backupName:v):(typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Automatic backup before ${e} failed.`,C),o.notifyFailure!==!1&&showNotification("error",s),null)}const QUEUED_BACKUP_GESTURE_EVENTS=["pointerdown","keydown","touchstart"];let queuedBackupBanner=null,queuedBackupBannerMessageEl=null,queuedBackupBannerActionEl=null,queuedBackupGestureBound=!1,queuedBackupFlushScheduled=!1,queuedBackupFlushInProgress=!1,autoBackupSchedulerTimer=null,autoGearBackupSchedulerTimer=null,hourlyBackupSchedulerTimer=null;function getQueuedBackupBannerTexts(){const e=typeof texts=="object"&&texts&&texts[currentLang]||{},t=typeof texts=="object"&&texts&&texts.en||{};return{singular:e.queuedBackupBannerMessageOne||t.queuedBackupBannerMessageOne||"1 backup saved in the local vault.",plural:e.queuedBackupBannerMessageOther||t.queuedBackupBannerMessageOther||"{count} backups saved in the local vault.",gesture:e.queuedBackupBannerGesture||t.queuedBackupBannerGesture||"Interact with the planner to export them safely.",action:e.queuedBackupBannerAction||t.queuedBackupBannerAction||"Open local backup vault",fallbackHint:e.queuedBackupFallbackHint||t.queuedBackupFallbackHint||"Emergency fallback storage active. Export queued backups immediately."}}function ensureQueuedBackupBannerElements(){if(typeof document>"u")return null;if(queuedBackupBanner&&queuedBackupBannerMessageEl&&queuedBackupBannerActionEl)return queuedBackupBanner;const e=document.createElement("section");e.id="cineQueuedBackupBanner",e.style.position="fixed",e.style.right="1.5rem",e.style.left="1.5rem",e.style.bottom="1.5rem",e.style.maxWidth="28rem",e.style.marginLeft="auto",e.style.padding="1rem 1.25rem",e.style.borderRadius="1.25rem",e.style.background="rgba(15, 22, 36, 0.92)",e.style.color="#f5f7fb",e.style.boxShadow="0 1.5rem 3.5rem rgba(5, 8, 17, 0.28)",e.style.zIndex="9999",e.style.display="none",e.style.flexDirection="column",e.style.gap="0.75rem",e.setAttribute("role","status"),e.setAttribute("aria-live","assertive"),e.setAttribute("aria-hidden","true");const t=document.createElement("p");t.style.margin="0",t.style.lineHeight="1.5",t.style.fontSize="0.95rem";const o=document.createElement("button");o.type="button",o.style.alignSelf="flex-start",o.style.background="#ffbf3c",o.style.color="#11131a",o.style.border="none",o.style.borderRadius="999px",o.style.padding="0.55rem 1.5rem",o.style.fontWeight="600",o.style.cursor="pointer",o.addEventListener("click",r=>{try{r.preventDefault()}catch{}typeof openQueuedBackupVaultWindowForEvents=="function"&&Promise.resolve().then(()=>openQueuedBackupVaultWindowForEvents()).catch(n=>{console.warn("Failed to open queued backup vault window",n)})}),e.appendChild(t),e.appendChild(o);try{(document.body||document.documentElement).appendChild(e)}catch(r){console.warn("Failed to attach queued backup banner to document",r)}return queuedBackupBanner=e,queuedBackupBannerMessageEl=t,queuedBackupBannerActionEl=o,e}function showQueuedBackupBanner(e,t){const o=ensureQueuedBackupBannerElements();if(!o||!queuedBackupBannerMessageEl||!queuedBackupBannerActionEl)return;const r=getQueuedBackupBannerTexts(),n=typeof e=="number"&&Number.isFinite(e)?e:1,s=(n===1?r.singular:r.plural).replace("{count}",String(n)),l=r.gesture.replace("{count}",String(n)),u=[`${s} ${l}`.trim()];t&&u.push(r.fallbackHint),queuedBackupBannerMessageEl.textContent=u.join(" ").trim(),queuedBackupBannerActionEl.textContent=r.action,o.style.display="flex",o.setAttribute("aria-hidden","false"),attachQueuedBackupGestureListeners()}function hideQueuedBackupBanner(){queuedBackupBanner&&(queuedBackupBanner.style.display="none",queuedBackupBanner.setAttribute("aria-hidden","true"))}function attachQueuedBackupGestureListeners(){if(queuedBackupGestureBound||typeof document>"u")return;const e=handleQueuedBackupGesture;for(let t=0;t<QUEUED_BACKUP_GESTURE_EVENTS.length;t+=1){const o=QUEUED_BACKUP_GESTURE_EVENTS[t];try{document.addEventListener(o,e,{passive:!0})}catch{document.addEventListener(o,e)}}queuedBackupGestureBound=!0}function detachQueuedBackupGestureListeners(){if(!queuedBackupGestureBound||typeof document>"u")return;const e=handleQueuedBackupGesture;for(let t=0;t<QUEUED_BACKUP_GESTURE_EVENTS.length;t+=1){const o=QUEUED_BACKUP_GESTURE_EVENTS[t];try{document.removeEventListener(o,e,{passive:!0})}catch{document.removeEventListener(o,e)}}queuedBackupGestureBound=!1}function handleQueuedBackupGesture(){requestQueuedBackupFlush("gesture")}function requestQueuedBackupFlush(e){queuedBackupFlushScheduled||typeof getQueuedBackupPayloadsForEvents!="function"||typeof downloadBackupPayloadForEvents!="function"||(queuedBackupFlushScheduled=!0,Promise.resolve().then(()=>{queuedBackupFlushScheduled=!1,flushQueuedBackupVault(e)}))}function updateQueuedBackupBannerFromVault(){return typeof getQueuedBackupPayloadsForEvents!="function"?(hideQueuedBackupBanner(),detachQueuedBackupGestureListeners(),Promise.resolve(0)):Promise.resolve(getQueuedBackupPayloadsForEvents()).then(e=>{const t=Array.isArray(e)?e.length:0,o=typeof isBackupVaultFallbackActiveForEvents=="function"?!!isBackupVaultFallbackActiveForEvents():!1;return t>0?showQueuedBackupBanner(t,o):(hideQueuedBackupBanner(),detachQueuedBackupGestureListeners()),t}).catch(e=>(console.warn("Failed to update queued backup banner from vault",e),hideQueuedBackupBanner(),detachQueuedBackupGestureListeners(),0))}async function flushQueuedBackupVault(e){if(!queuedBackupFlushInProgress&&!(typeof getQueuedBackupPayloadsForEvents!="function"||typeof downloadBackupPayloadForEvents!="function")){queuedBackupFlushInProgress=!0;try{const t=await Promise.resolve(getQueuedBackupPayloadsForEvents()).then(o=>Array.isArray(o)?o:[]).catch(o=>(console.warn("Failed to read queued backups for deferred download",o),[]));if(!t.length){hideQueuedBackupBanner(),detachQueuedBackupGestureListeners();return}for(let o=0;o<t.length;o+=1){const r=t[o];let n=null;try{n=downloadBackupPayloadForEvents(r.payload,r.fileName,{skipQueue:!0,source:r&&r.metadata&&r.metadata.source?r.metadata.source:"automatic",reason:e||"gesture-flush",queueMetadata:r&&r.metadata?r.metadata:{}})}catch(a){console.warn("Deferred backup download attempt threw an error",a),n=null}if(n&&n.success){if(typeof removeQueuedBackupRecordForEvents=="function")try{await removeQueuedBackupRecordForEvents(r.id)}catch(a){console.warn("Failed to remove queued backup after export",a)}}else{const a=n&&n.queueMessage?n.queueMessage:resolveQueuedBackupMessageForEvents?resolveQueuedBackupMessageForEvents(r.fileName):"Automatic downloads are still blocked. Keep working offline and try again after interacting with the planner.";if(typeof showNotification=="function")try{showNotification("warning",a)}catch(s){}break}}}finally{queuedBackupFlushInProgress=!1,updateQueuedBackupBannerFromVault()}}}function handleQueuedBackupVaultQueuedEvent(){updateQueuedBackupBannerFromVault(),attachQueuedBackupGestureListeners()}function handleQueuedBackupFallbackChangedEvent(){updateQueuedBackupBannerFromVault()}function scheduleAutoBackupTimer(){if(autoBackupSchedulerTimer)try{clearTimeout(autoBackupSchedulerTimer)}catch{}autoBackupSchedulerTimer=setTimeout(()=>{try{autoBackup$1({reason:"interval"})}catch(e){console.warn("Scheduled auto backup run failed",e)}scheduleAutoBackupTimer()},AUTO_BACKUP_INTERVAL_MS),autoBackupSchedulerTimer&&typeof autoBackupSchedulerTimer.unref=="function"&&autoBackupSchedulerTimer.unref()}function scheduleAutoGearBackupTimer(){if(autoGearBackupSchedulerTimer)try{clearTimeout(autoGearBackupSchedulerTimer)}catch{}autoGearBackupSchedulerTimer=setTimeout(()=>{try{globalThis.autoGearRulesDirtySinceBackup&&createAutoGearBackup()}catch(e){console.warn("Scheduled auto gear backup failed",e)}scheduleAutoGearBackupTimer()},AUTO_GEAR_BACKUP_INTERVAL_MS),autoGearBackupSchedulerTimer&&typeof autoGearBackupSchedulerTimer.unref=="function"&&autoGearBackupSchedulerTimer.unref()}async function queueScheduledFullBackup(){if(!(typeof queueBackupPayloadForVaultForEvents!="function"||typeof buildSettingsBackupPackageForEvents!="function"))try{const e=await buildSettingsBackupPackageForEvents(new Date);if(!e||typeof e.payload!="string")return;if(queueBackupPayloadForVaultForEvents(e.fileName,e.payload,{source:"hourly-scheduler",reason:"hourly-auto",createdAt:e.iso}),resolveQueuedBackupMessageForEvents)try{const t=resolveQueuedBackupMessageForEvents(e.fileName);t&&typeof showNotification=="function"&&showNotification("info",t)}catch(t){}updateQueuedBackupBannerFromVault()}catch(e){console.warn("Failed to queue scheduled full backup payload",e)}}function scheduleHourlyBackupTimer(){if(hourlyBackupSchedulerTimer)try{clearTimeout(hourlyBackupSchedulerTimer)}catch{}hourlyBackupSchedulerTimer=setTimeout(()=>{queueScheduledFullBackup(),scheduleHourlyBackupTimer()},3600*1e3),hourlyBackupSchedulerTimer&&typeof hourlyBackupSchedulerTimer.unref=="function"&&hourlyBackupSchedulerTimer.unref()}typeof window<"u"&&typeof window.addEventListener=="function"&&(window.addEventListener("cineBackupVault:queued",handleQueuedBackupVaultQueuedEvent),window.addEventListener("cineBackupVault:fallbackChanged",handleQueuedBackupFallbackChangedEvent));typeof document<"u"&&typeof document.addEventListener=="function"&&(document.addEventListener("cineBackupVault:queued",handleQueuedBackupVaultQueuedEvent),document.addEventListener("cineBackupVault:fallbackChanged",handleQueuedBackupFallbackChangedEvent));typeof setTimeout=="function"&&(scheduleAutoBackupTimer(),scheduleAutoGearBackupTimer(),scheduleHourlyBackupTimer());updateQueuedBackupBannerFromVault();function showDeviceManagerSection$1(){const e=deviceManagerSection||document.getElementById("device-manager"),t=toggleDeviceBtn||document.getElementById("toggleDeviceManager");if(!e||!t||!e.classList.contains("hidden"))return;e.classList.remove("hidden"),document.body.classList.add("device-manager-active");const{langTexts:o,fallbackTexts:r}=getEventsLanguageTexts(),n=o.hideDeviceManager||r.hideDeviceManager||"Close Device Data",a=o.hideDeviceManagerHelp||r.hideDeviceManagerHelp||"Close defaults library editor";setButtonLabelWithIconForEvents(t,n,ICON_GLYPHS.minus),t.setAttribute("title",n),t.setAttribute("data-help",a),t.setAttribute("aria-expanded","true"),refreshDeviceListsSafe(),updateCalculations()}function hideDeviceManagerSection(){const e=deviceManagerSection||document.getElementById("device-manager"),t=toggleDeviceBtn||document.getElementById("toggleDeviceManager");if(!e||!t||e.classList.contains("hidden"))return;e.classList.add("hidden"),document.body.classList.remove("device-manager-active");const{langTexts:o,fallbackTexts:r}=getEventsLanguageTexts(),n=o.toggleDeviceManager||r.toggleDeviceManager||"Edit Device Data…",a=o.toggleDeviceManagerHelp||r.toggleDeviceManagerHelp||"Manage available batteries, cameras, lenses...";setButtonLabelWithIconForEvents(t,n,ICON_GLYPHS.gears),t.setAttribute("title",n),t.setAttribute("data-help",a),t.setAttribute("aria-expanded","false")}function toggleDeviceManagerSection$1(){const e=deviceManagerSection||document.getElementById("device-manager"),t=toggleDeviceBtn||document.getElementById("toggleDeviceManager");!e||!t||(e.classList.contains("hidden")?showDeviceManagerSection$1():hideDeviceManagerSection())}function bindDeviceManagerToggleHandler(){bindDeviceManagerToggleHandler.bound||(bindDeviceManagerToggleHandler.bound=!0,typeof document<"u"&&document&&typeof document.addEventListener=="function"&&document.addEventListener("click",e=>{if(!e)return;const t=e.target;!t||typeof t.closest!="function"||!t.closest("#toggleDeviceManager")||toggleDeviceManagerSection$1()}))}bindDeviceManagerToggleHandler();function getEventsLanguageTexts(){const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,t=typeof texts<"u"&&texts||(e&&typeof e.texts=="object"?e.texts:null),o=typeof currentLang=="string"&&t&&typeof t[currentLang]=="object"?currentLang:"en",r=t&&typeof t[o]=="object"&&t[o]||{},n=t&&typeof t.en=="object"&&t.en||{};return{langTexts:r,fallbackTexts:n}}function resolveAutoBackupIndicatorMessage(){const{langTexts:e,fallbackTexts:t}=getEventsLanguageTexts();return e&&e.autoBackupInProgressNotice||t&&t.autoBackupInProgressNotice||"Auto backup in progress. Performance may pause briefly."}function registerEventsCineUiInternal(e){if(!(!e||eventsCineUiRegistered)){eventsCineUiRegistered=!0;try{e.controllers&&typeof e.controllers.register=="function"&&e.controllers.register("deviceManagerSection",{show:showDeviceManagerSection$1,hide:hideDeviceManagerSection,toggle:toggleDeviceManagerSection$1})}catch(t){console.warn("cineUi controller registration failed",t)}try{e.interactions&&typeof e.interactions.register=="function"&&(e.interactions.register("saveSetup",handleSaveSetupClick),e.interactions.register("deleteSetup",handleDeleteSetupClick))}catch(t){console.warn("cineUi interaction registration failed",t)}try{e.help&&typeof e.help.register=="function"&&(e.help.register("saveSetup",()=>{const{langTexts:t,fallbackTexts:o}=getEventsLanguageTexts();return t.saveSetupHelp||o.saveSetupHelp||"Capture the current project—including devices, requirements and notes—so it can be restored instantly. The autosave status dot beside Project Name glows while changes are secured. Press Enter or Ctrl+S to save quickly; the Save button stays disabled until a name is entered."}),e.help.register("autoBackupBeforeDeletion",()=>{const{langTexts:t,fallbackTexts:o}=getEventsLanguageTexts();return t.preDeleteBackupSuccess||o.preDeleteBackupSuccess||"Automatic safety copy stored before deletion. Find the matching auto-backup entry under Saved Projects and rename it if you plan to keep it permanently."}))}catch(t){console.warn("cineUi help registration failed",t)}}}function registerEventsCineUi(){const e=resolveCineUi();return e?(registerEventsCineUiInternal(e),!0):!1}registerEventsCineUi();function toggleDeviceDetails(e){const t=e.closest("li");if(!t)return;const o=t.querySelector(".device-details");if(!o)return;if(e.getAttribute("aria-expanded")==="true"){o.style.display="none";const{langTexts:n,fallbackTexts:a}=getEventsLanguageTexts(),s=n.showDetails||a.showDetails||"Show Details";e.textContent=s,e.setAttribute("aria-expanded","false"),e.setAttribute("data-help",s)}else{o.style.display="block";const{langTexts:n,fallbackTexts:a}=getEventsLanguageTexts(),s=n.hideDetails||a.hideDetails||"Hide Details";if(e.textContent=s,e.setAttribute("aria-expanded","true"),e.setAttribute("data-help",s),typeof document<"u"&&typeof document.dispatchEvent=="function"){const l=typeof e.dataset.name=="string"?e.dataset.name:"",u=typeof e.dataset.category=="string"?e.dataset.category:"",d=typeof e.dataset.subcategory=="string"?e.dataset.subcategory:"",m={name:l.trim(),category:u.trim(),subcategory:d.trim()||null};try{document.dispatchEvent(new CustomEvent("device-library:show-details",{detail:m}))}catch(y){console.warn("Failed to dispatch device-library:show-details event",y)}}}}function inferDeviceCategory(e,t){return e==="batteries"||e.endsWith(".batteries")||t.capacity!==void 0?"batteries":e==="cameras"||t.recordingMedia||t.lensMount||t.power?.batteryPlateSupport?"cameras":e==="lenses"||t.mountOptions||t.focusScale?"lenses":e==="monitors"||t.screenSizeInches!==void 0&&!e.includes("viewfinder")?"monitors":e==="viewfinders"||e.includes("viewfinder")?"viewfinders":e==="video"||e==="wirelessReceivers"||e==="iosVideo"||t.videoInputs||t.videoOutputs||t.frequency!==void 0?"video":e==="fiz.motors"||t.torqueNm!==void 0||t.gearTypes?"fiz.motors":e==="fiz.controllers"||t.powerSource||t.batteryType||t.connectivity?"fiz.controllers":e==="fiz.distance"||t.measurementMethod||t.connectionCompatibility||t.measurementRange||t.accuracy?"distances":e==="accessories.cables"||typeof e=="string"&&e.startsWith("accessories.cables")?"accessories.cables":"generic"}function resolveDefaultLensMountType(){const e=devices&&devices.cameras?devices.cameras:null;if(!e||typeof e!="object")return"";const t=n=>{if(!n||typeof n!="object"||!Array.isArray(n.lensMount))return"";const a=n.lensMount.find(l=>l&&typeof l.type=="string"&&typeof l.mount=="string"&&l.mount.toLowerCase()==="native");if(a&&a.type)return a.type;const s=n.lensMount.find(l=>l&&typeof l.type=="string"&&l.type.trim());return s?s.type:""},o=typeof cameraSelect?.value=="string"?cameraSelect.value:"";if(o&&e[o]){const n=t(e[o]);if(n)return n}const r=Object.values(e).find(n=>n&&typeof n=="object");if(r){const n=t(r);if(n)return n}return""}function normalizeLensFocusScale(e){if(typeof normalizeFocusScale=="function")try{const o=normalizeFocusScale(e);if(o==="imperial"||o==="metric")return o}catch{}const t=typeof e=="string"?e.trim().toLowerCase():"";return t==="imperial"||t==="metric"?t:""}function applyCameraFizConnectors(e){const t=Array.isArray(e)?e.map(r=>!r||typeof r=="string"?r:typeof r=="object"&&typeof r.type=="string"?{...r}:r):[];let o=!1;if(typeof setFizConnectors=="function")try{setFizConnectors(t),o=!0}catch(r){if(eventsLogger&&typeof eventsLogger.warn=="function")try{eventsLogger.warn("Direct setFizConnectors invocation failed",r,{namespace:"device-editor"})}catch{}typeof console<"u"&&typeof console.warn=="function"&&console.warn("Direct setFizConnectors invocation failed",r)}if(!o)try{callEventsCoreFunction("setFizConnectors",[t],{defer:!0}),o=!0}catch(r){if(eventsLogger&&typeof eventsLogger.error=="function")try{eventsLogger.error("Failed to schedule setFizConnectors",r,{namespace:"device-editor"})}catch{}typeof console<"u"&&typeof console.error=="function"&&console.error("Failed to schedule setFizConnectors",r)}return o}function applyCameraTimecodes(e){const t=Array.isArray(e)?e.map(r=>{if(!r)return r;if(typeof r=="string"){const n=r.trim();return n?{type:n,notes:""}:r}if(typeof r=="object"){const n={...r};if(typeof n.type!="string"||!n.type){const a=typeof n.format=="string"&&n.format||typeof n.name=="string"&&n.name||"";a&&(n.type=a)}return typeof n.notes!="string"&&(typeof n.comment=="string"?n.notes=n.comment:n.notes==null&&(n.notes="")),n}return r}):[];let o=!1;if(typeof setTimecodes=="function")try{setTimecodes(t),o=!0}catch(r){if(eventsLogger&&typeof eventsLogger.warn=="function")try{eventsLogger.warn("Direct setTimecodes invocation failed",r,{namespace:"device-editor"})}catch{}typeof console<"u"&&typeof console.warn=="function"&&console.warn("Direct setTimecodes invocation failed",r)}if(!o)try{callEventsCoreFunction("setTimecodes",[t],{defer:!0}),o=!0}catch(r){if(eventsLogger&&typeof eventsLogger.error=="function")try{eventsLogger.error("Failed to schedule setTimecodes",r,{namespace:"device-editor"})}catch{}typeof console<"u"&&typeof console.error=="function"&&console.error("Failed to schedule setTimecodes",r)}return o}function populateDeviceForm(e,t,o){const r=(A,w)=>A||(typeof document<"u"?document.getElementById(w):null),n=r(typeof wattFieldDiv<"u"?wattFieldDiv:null,"wattField"),a=r(typeof batteryFieldsDiv<"u"?batteryFieldsDiv:null,"batteryFields"),s=r(typeof cameraFieldsDiv<"u"?cameraFieldsDiv:null,"cameraFields"),l=r(typeof monitorFieldsDiv<"u"?monitorFieldsDiv:null,"monitorFields"),u=r(typeof viewfinderFieldsDiv<"u"?viewfinderFieldsDiv:null,"viewfinderFields"),d=r(typeof videoFieldsDiv<"u"?videoFieldsDiv:null,"videoFields"),m=r(typeof motorFieldsDiv<"u"?motorFieldsDiv:null,"motorFields"),y=r(typeof controllerFieldsDiv<"u"?controllerFieldsDiv:null,"controllerFields"),h=r(typeof distanceFieldsDiv<"u"?distanceFieldsDiv:null,"distanceFields"),b=r(typeof lensFieldsDiv<"u"?lensFieldsDiv:null,"lensFields"),v=r(typeof subcategoryFieldDiv<"u"?subcategoryFieldDiv:null,"subcategoryField");r(typeof dynamicFieldsDiv<"u"?dynamicFieldsDiv:null,"dynamicFields"),placeWattField(e,t);const C=inferDeviceCategory(e,t);if(n&&(n.style.display=""),hideFormSection(a),hideFormSection(s),hideFormSection(l),hideFormSection(u),hideFormSection(d),hideFormSection(m),hideFormSection(y),hideFormSection(h),hideFormSection(b),clearDynamicFields(),C==="batteries")n&&(n.style.display="none"),showFormSection(a),newCapacityInput.value=t.capacity??"",newPinAInput.value=t.pinA??"",dtapRow&&(dtapRow.style.display=e==="batteryHotswaps"?"none":""),newDtapAInput.value=e==="batteryHotswaps"?"":t.dtapA??"",buildDynamicFields(e,t,categoryExcludedAttrs[e]||[]);else if(C==="cameras"){n&&(n.style.display="none"),showFormSection(s);const A=resolveFirstPowerInputType(t);cameraWattInput.value=t.powerDrawWatts||"",cameraVoltageInput.value=t.power?.input?.voltageRange||"",cameraPortTypeInput.value=A||"",setBatteryPlates(t.power?.batteryPlateSupport||[]),setRecordingMedia(t.recordingMedia||[]),callEventsCoreFunction("setLensMounts",[Array.isArray(t.lensMount)?t.lensMount:[]]),callEventsCoreFunction("setPowerDistribution",[t.power?.powerDistributionOutputs||[]],{defer:!0}),setVideoOutputs(t.videoOutputs||[]),applyCameraFizConnectors(t.fizConnectors||[]),setViewfinders(t.viewfinder||[]),applyCameraTimecodes(t.timecode||[]),buildDynamicFields(e,t,categoryExcludedAttrs[e]||[])}else if(C==="lenses"){n&&(n.style.display="none"),showFormSection(b);const A=resolveDefaultLensMountType();let w=[];if(Array.isArray(t?.mountOptions)?w=t.mountOptions:Array.isArray(t?.lensMount)?w=t.lensMount:typeof t?.mount=="string"&&t.mount.trim()&&(w=[{type:t.mount.trim(),mount:"native"}]),setLensDeviceMountOptions(w,A),lensFocusScaleSelect){updateLensFocusScaleSelectOptions();const R=normalizeLensFocusScale(t&&t.focusScale);lensFocusScaleSelect.value=R||""}buildDynamicFields(e,t,categoryExcludedAttrs[e]||[])}else if(C==="monitors"){n&&(n.style.display="none"),showFormSection(l),monitorScreenSizeInput.value=t.screenSizeInches||"",monitorBrightnessInput.value=t.brightnessNits||"",monitorWattInput.value=t.powerDrawWatts||"",monitorVoltageInput.value=t.power?.input?.voltageRange||"";const A=resolveFirstPowerInputType(t);monitorPortTypeInput.value=A||"",setMonitorVideoInputs(t.videoInputs||t.video?.inputs||[]),setMonitorVideoOutputs(t.videoOutputs||t.video?.outputs||[]),monitorWirelessTxInput.checked=!!t.wirelessTx,monitorLatencyInput.value=t.latencyMs??"",monitorAudioOutputInput.value=t.audioOutput?.portType||t.audioOutput?.type||t.audioOutput||"",buildDynamicFields(e,t,categoryExcludedAttrs[e]||[])}else if(C==="viewfinders"){n&&(n.style.display="none"),showFormSection(u),viewfinderScreenSizeInput.value=t.screenSizeInches||"",viewfinderBrightnessInput.value=t.brightnessNits||"",viewfinderWattInput.value=t.powerDrawWatts||"",viewfinderVoltageInput.value=t.power?.input?.voltageRange||"";const A=resolveFirstPowerInputType(t);viewfinderPortTypeInput.value=A||"",setViewfinderVideoInputs(t.videoInputs||t.video?.inputs||[]),setViewfinderVideoOutputs(t.videoOutputs||t.video?.outputs||[]),viewfinderWirelessTxInput.checked=!!t.wirelessTx,viewfinderLatencyInput.value=t.latencyMs??"",buildDynamicFields(e,t,categoryExcludedAttrs[e]||[])}else if(C==="video")showFormSection(d),newWattInput.value=t.powerDrawWatts||"",callEventsCoreFunction("setVideoPowerInputs",[t.power?.input||t.powerInput||null]),setVideoInputs(t.videoInputs||t.video?.inputs||[]),setVideoOutputsIO(t.videoOutputs||t.video?.outputs||[]),videoFrequencyInput.value=t.frequency||"",videoLatencyInput.value=t.latencyMs??"",motorConnectorInput.value="",buildDynamicFields(e,t,categoryExcludedAttrs[e]||[]);else if(C==="fiz.motors")showFormSection(m),newWattInput.value=t.powerDrawWatts||"",motorConnectorInput.value=t.fizConnector||"",motorInternalInput.checked=!!t.internalController,motorTorqueInput.value=t.torqueNm||"",motorGearInput.value=Array.isArray(t.gearTypes)?t.gearTypes.join(", "):"",motorNotesInput.value=t.notes||"",buildDynamicFields(e,t,categoryExcludedAttrs[e]||[]);else if(C==="fiz.controllers"){showFormSection(y),newWattInput.value=t.powerDrawWatts||"";const A=Array.isArray(t.fizConnectors)?t.fizConnectors.map(w=>w.type).join(", "):t.fizConnector||"";controllerConnectorInput.value=A,controllerPowerInput.value=t.powerSource||"",controllerBatteryInput.value=t.batteryType||"",controllerConnectivityInput.value=t.connectivity||"",controllerNotesInput.value=t.notes||"",buildDynamicFields(e,t,categoryExcludedAttrs[e]||[])}else if(C==="distances")showFormSection(h),newWattInput.value=t.powerDrawWatts||"",distanceConnectionInput.value=t.connectionCompatibility||"",distanceMethodInput.value=t.measurementMethod||"",distanceRangeInput.value=t.measurementRange||"",distanceAccuracyInput.value=t.accuracy||"",distanceOutputInput.value=t.outputDisplay||"",distanceNotesInput.value=t.notes||"",buildDynamicFields(e,t,categoryExcludedAttrs[e]||[]);else if(C==="accessories.cables"){n&&(n.style.display="none"),v&&(v.hidden=!1);const A=getCableSubcategoryKeysForUi(o?[o]:[]);if(newSubcategorySelect){newSubcategorySelect.innerHTML="";for(let R=0;R<A.length;R+=1){const _=A[R],G=document.createElement("option");G.value=_,G.textContent=_.charAt(0).toUpperCase()+_.slice(1),newSubcategorySelect.appendChild(G)}}const w=o&&A.includes(o)?o:newSubcategorySelect&&newSubcategorySelect.options.length>0?newSubcategorySelect.options[0].value:"";newSubcategorySelect&&(newSubcategorySelect.value=w||"",newSubcategorySelect.disabled=!1),w&&buildDynamicFields(`accessories.cables.${w}`,t,categoryExcludedAttrs[`accessories.cables.${w}`]||[])}else{const A=typeof t=="object"?t.powerDrawWatts:t;newWattInput&&(newWattInput.value=A||"");const w=typeof getSchemaAttributesForCategory=="function"?getSchemaAttributesForCategory(e):[],R=w.includes("powerDrawWatts")||t&&t.powerDrawWatts!==void 0;wattFieldDiv&&(wattFieldDiv.style.display=R?"":"none");const _=w.includes("dtapA")||w.includes("pinA")||t&&(t.dtapA!==void 0||t.pinA!==void 0);dtapRow&&(dtapRow.style.display=_?"":"none"),buildDynamicFields(e,t,categoryExcludedAttrs[e]||[])}}addSafeEventListener("device-manager","click",e=>{if(!e||!e.target)return;let t=null;try{typeof e.target.closest=="function"?t=e.target.closest("button"):e.target.parentElement&&typeof e.target.parentElement.closest=="function"&&(t=e.target.parentElement.closest("button"))}catch{}if(t){try{if(e.currentTarget&&typeof e.currentTarget.contains=="function"&&!e.currentTarget.contains(t))return}catch{}if(t.classList.contains("detail-toggle"))toggleDeviceDetails(t);else if(t.classList.contains("edit-btn")){const o=t.dataset.name,r=t.dataset.category,n=t.dataset.subcategory,a=resolveNewCategorySelect();if(!a){console.warn("Cannot edit device: category select is unavailable");return}if(!Array.from(a.options).some(m=>m.value===r)){const m=document.createElement("option");m.value=r,m.textContent=categoryNames[currentLang]?.[r]||r,a.appendChild(m)}const s=addDeviceBtn;s&&(s.dataset.mode="edit",s.dataset.originalName=o,s.dataset.originalCategory=r,r==="accessories.cables"&&n?s.dataset.originalSubcategory=n:delete s.dataset.originalSubcategory),a.value=r,newNameInput.value=o,a.dispatchEvent(new Event("change"));let l;if(r==="accessories.cables")l=devices.accessories.cables[n][o];else if(r.includes(".")){const[m,y]=r.split(".");l=devices[m][y][o]}else l=devices[r][o];populateDeviceForm(r,l,n);const u=addDeviceBtn;u&&(setButtonLabelWithIconForEvents(u,texts[currentLang].updateDeviceBtn,ICON_GLYPHS.save),u.setAttribute("data-help",texts[currentLang].updateDeviceBtnHelp));const d=cancelEditBtn;d&&(setButtonLabelWithIconForEvents(d,texts[currentLang].cancelEditBtn,ICON_GLYPHS.circleX),d.setAttribute("data-help",texts[currentLang].cancelEditBtnHelp),showFormSection(d)),document.getElementById("addDeviceHeading").scrollIntoView({behavior:"smooth",block:"start"})}else if(t.classList.contains("delete-btn")){const o=t.dataset.name,r=t.dataset.category,n=t.dataset.subcategory,a=()=>{if(r==="accessories.cables")delete devices.accessories.cables[n][o];else if(r.includes(".")){const[b,v]=r.split(".");delete devices[b][v][o]}else delete devices[r][o];typeof updateGlobalDevicesReference=="function"&&updateGlobalDevicesReference(devices),storeDevices(devices),viewfinderTypeOptions=syncCoreOptionsArray("viewfinderTypeOptions","getAllViewfinderTypes",viewfinderTypeOptions),viewfinderConnectorOptions=syncCoreOptionsArray("viewfinderConnectorOptions","getAllViewfinderConnectors",viewfinderConnectorOptions),refreshDeviceListsSafe(),callCoreFunctionIfAvailable("updateMountTypeOptions",[],{defer:!0});const s=typeof cameraSelect<"u"?cameraSelect:typeof document<"u"?document.getElementById("cameraSelect"):null,l=typeof videoSelect<"u"?videoSelect:typeof document<"u"?document.getElementById("videoSelect"):null,u=typeof distanceSelect<"u"?distanceSelect:typeof document<"u"?document.getElementById("distanceSelect"):null,d=typeof batterySelect<"u"?batterySelect:typeof document<"u"?document.getElementById("batterySelect"):null;populateSelect(s,devices.cameras,!0),populateMonitorSelect(),populateSelect(l,devices.video,!0);const m=devices.fiz||{},y=typeof motorSelects<"u"&&Array.isArray(motorSelects)?motorSelects:[document.getElementById("motor1Select"),document.getElementById("motor2Select"),document.getElementById("motor3Select"),document.getElementById("motor4Select")],h=typeof controllerSelects<"u"&&Array.isArray(controllerSelects)?controllerSelects:[document.getElementById("controller1Select"),document.getElementById("controller2Select")];y.forEach(b=>populateSelect(b,m.motors,!0)),h.forEach(b=>populateSelect(b,m.controllers,!0)),populateSelect(u,m.distance,!0),populateSelect(d,devices.batteries,!0),updateFizConnectorOptions(),updateMotorConnectorOptions(),updateControllerConnectorOptions(),updateControllerPowerOptions(),updateControllerBatteryOptions(),updateControllerConnectivityOptions(),updatePowerDistTypeOptions(),updatePowerDistVoltageOptions(),updatePowerDistCurrentOptions(),updateTimecodeTypeOptions(),updateDistanceConnectionOptions(),updateDistanceMethodOptions(),updateDistanceDisplayOptions(),applyFilters(),updateCalculations()};typeof window.cineShowConfirmDialog=="function"?window.cineShowConfirmDialog({title:texts[currentLang]&&texts[currentLang].deleteDeviceTitle||"Delete Device",message:texts[currentLang].confirmDeleteDevice.replace("{name}",o),confirmLabel:"Delete",danger:!0,onConfirm:()=>a()}):confirm(texts[currentLang].confirmDeleteDevice.replace("{name}",o))&&a()}}});function resolveDeviceManagerSectionForEvents(){return deviceManagerSection||document.getElementById("device-manager")}addSafeEventListener("device-manager","keydown",e=>{resolveDeviceManagerSectionForEvents()&&e.target.classList.contains("detail-toggle")&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),toggleDeviceDetails(e.target))});addSafeEventListener("newCategory","change",()=>{console.log("[newCategory change] Category change event fired");const e=addDeviceBtn?.dataset.mode==="edit",t=newNameInput?newNameInput.value:"",o=document.getElementById("newCategory"),r=(o?o.value:"").trim(),n=typeof inferDeviceCategory=="function"?inferDeviceCategory(r,{}):"generic";console.log("[newCategory change] Inferred type:",n,"for value:",`"${r}"`),placeWattField(r),clearDynamicFields(),subcategoryFieldDiv&&(subcategoryFieldDiv.hidden=!0);const a=newSubcategorySelect?newSubcategorySelect.value:"";if(newSubcategorySelect&&(newSubcategorySelect.innerHTML="",newSubcategorySelect.disabled=!1),dtapRow&&(dtapRow.style.display=""),wattFieldDiv&&(wattFieldDiv.style.display=""),hideFormSection(batteryFieldsDiv),hideFormSection(cameraFieldsDiv),hideFormSection(monitorFieldsDiv),hideFormSection(viewfinderFieldsDiv),hideFormSection(videoFieldsDiv),hideFormSection(motorFieldsDiv),hideFormSection(controllerFieldsDiv),hideFormSection(distanceFieldsDiv),hideFormSection(lensFieldsDiv),n==="batteries")wattFieldDiv&&(wattFieldDiv.style.display="none"),showFormSection(batteryFieldsDiv),dtapRow&&(dtapRow.style.display=r==="batteryHotswaps"||r==="accessories.batteryHotswaps"?"none":""),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="cameras")wattFieldDiv&&(wattFieldDiv.style.display="none"),showFormSection(cameraFieldsDiv),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="lenses")wattFieldDiv&&(wattFieldDiv.style.display="none"),showFormSection(lensFieldsDiv),setLensDeviceMountOptions([],resolveDefaultLensMountType()),lensFocusScaleSelect&&(updateLensFocusScaleSelectOptions(),lensFocusScaleSelect.value=""),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="monitors")wattFieldDiv&&(wattFieldDiv.style.display="none"),showFormSection(monitorFieldsDiv),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="viewfinders")wattFieldDiv&&(wattFieldDiv.style.display="none"),showFormSection(viewfinderFieldsDiv),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="video")showFormSection(videoFieldsDiv),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="fiz.motors")showFormSection(motorFieldsDiv),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="fiz.controllers")showFormSection(controllerFieldsDiv),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="distances")showFormSection(distanceFieldsDiv),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]);else if(n==="accessories.cables"){wattFieldDiv&&(wattFieldDiv.style.display="none"),subcategoryFieldDiv&&(subcategoryFieldDiv.hidden=!1);const l=getCableSubcategoryKeysForUi(a?[a]:[]);for(let d=0;d<l.length;d+=1){const m=l[d],y=document.createElement("option");y.value=m,y.textContent=m.charAt(0).toUpperCase()+m.slice(1),newSubcategorySelect.appendChild(y)}const u=a&&l.includes(a)?a:newSubcategorySelect.options.length>0?newSubcategorySelect.options[0].value:"";newSubcategorySelect.value=newSubcategorySelect&&u||"",u&&buildDynamicFields(`accessories.cables.${u}`,{},categoryExcludedAttrs[`accessories.cables.${u}`]||[])}else{const l=typeof getSchemaAttributesForCategory=="function"?getSchemaAttributesForCategory(r):[],u=l.includes("powerDrawWatts");wattFieldDiv&&(wattFieldDiv.style.display=u?"":"none");const d=l.includes("dtapA")||l.includes("pinA");dtapRow&&(dtapRow.style.display=d?"":"none"),buildDynamicFields(r,{},categoryExcludedAttrs[r]||[])}newWattInput&&(newWattInput.value=""),newCapacityInput&&(newCapacityInput.value=""),newPinAInput&&(newPinAInput.value=""),newDtapAInput&&(newDtapAInput.value=""),cameraWattInput&&(cameraWattInput.value=""),cameraVoltageInput&&(cameraVoltageInput.value=""),cameraPortTypeInput&&(cameraPortTypeInput.value=""),monitorScreenSizeInput&&(monitorScreenSizeInput.value=""),monitorBrightnessInput&&(monitorBrightnessInput.value=""),monitorWattInput&&(monitorWattInput.value=""),monitorVoltageInput&&(monitorVoltageInput.value=""),monitorPortTypeInput&&(monitorPortTypeInput.value=""),monitorWirelessTxInput&&(monitorWirelessTxInput.checked=!1),monitorLatencyInput&&(monitorLatencyInput.value=""),monitorAudioOutputInput&&(monitorAudioOutputInput.value=""),typeof clearMonitorVideoInputs=="function"?clearMonitorVideoInputs():typeof window<"u"&&typeof window.clearMonitorVideoInputs=="function"&&window.clearMonitorVideoInputs(),typeof clearMonitorVideoOutputs=="function"?clearMonitorVideoOutputs():typeof window<"u"&&typeof window.clearMonitorVideoOutputs=="function"&&window.clearMonitorVideoOutputs(),viewfinderScreenSizeInput&&(viewfinderScreenSizeInput.value=""),viewfinderBrightnessInput&&(viewfinderBrightnessInput.value=""),viewfinderWattInput&&(viewfinderWattInput.value=""),viewfinderVoltageInput&&(viewfinderVoltageInput.value=""),viewfinderPortTypeInput&&(viewfinderPortTypeInput.value=""),viewfinderWirelessTxInput&&(viewfinderWirelessTxInput.checked=!1),viewfinderLatencyInput&&(viewfinderLatencyInput.value=""),typeof clearViewfinderVideoInputs=="function"&&clearViewfinderVideoInputs(),typeof clearViewfinderVideoOutputs=="function"&&clearViewfinderVideoOutputs(),clearBatteryPlates(),typeof clearRecordingMedia=="function"&&clearRecordingMedia(),clearLensMounts(),clearLensDeviceMountOptions(),lensFocusScaleSelect&&(lensFocusScaleSelect.value=""),callEventsCoreFunction("clearPowerDistribution",[],{defer:!0}),clearVideoOutputs(),clearFizConnectors(),clearViewfinders(),clearTimecodes(),callEventsCoreFunction("clearVideoPowerInputs"),clearVideoInputs(),clearVideoOutputsIO(),videoFrequencyInput&&(videoFrequencyInput.value=""),videoLatencyInput&&(videoLatencyInput.value=""),motorConnectorInput&&(motorConnectorInput.value=""),motorInternalInput&&(motorInternalInput.checked=!1),motorTorqueInput&&(motorTorqueInput.value=""),motorGearInput&&(motorGearInput.value=""),motorNotesInput&&(motorNotesInput.value=""),controllerConnectorInput&&(controllerConnectorInput.value=""),controllerPowerInput&&(controllerPowerInput.value=""),controllerBatteryInput&&(controllerBatteryInput.value=""),controllerConnectivityInput&&(controllerConnectivityInput.value=""),controllerNotesInput&&(controllerNotesInput.value=""),distanceConnectionInput&&(distanceConnectionInput.value=""),distanceMethodInput&&(distanceMethodInput.value=""),distanceRangeInput&&(distanceRangeInput.value=""),distanceAccuracyInput&&(distanceAccuracyInput.value=""),distanceOutputInput&&(distanceOutputInput.value=""),distanceNotesInput&&(distanceNotesInput.value=""),r!=="accessories.cables"&&buildDynamicFields(r,{},categoryExcludedAttrs[r]||[]),newNameInput&&(e?newNameInput.value=t:newNameInput.value="");const s=texts[currentLang].cancelEditBtn;if(e){const l=addDeviceBtn;l&&(setButtonLabelWithIconForEvents(l,texts[currentLang].updateDeviceBtn,ICON_GLYPHS.save),l.setAttribute("data-help",texts[currentLang].updateDeviceBtnHelp));const u=cancelEditBtn;u&&(setButtonLabelWithIconForEvents(u,s,ICON_GLYPHS.circleX),u.setAttribute("data-help",texts[currentLang].cancelEditBtnHelp),showFormSection(u))}else{const l=addDeviceBtn;l&&(setButtonLabelWithIconForEvents(l,texts[currentLang].addDeviceBtn,ICON_GLYPHS.add),l.setAttribute("data-help",texts[currentLang].addDeviceBtnHelp),l.dataset.mode="add",delete l.dataset.originalName,delete l.dataset.originalSubcategory,delete l.dataset.originalCategory);const u=cancelEditBtn;u&&(setButtonLabelWithIconForEvents(u,s,ICON_GLYPHS.circleX),u.setAttribute("data-help",texts[currentLang].cancelEditBtnHelp),hideFormSection(u))}});addSafeEventListener("newSubcategory","change",()=>{const e=document.getElementById("newCategory");e&&e.value==="accessories.cables"&&buildDynamicFields(`accessories.cables.${newSubcategorySelect.value}`,{},categoryExcludedAttrs[`accessories.cables.${newSubcategorySelect.value}`]||[])});function resetDeviceForm$1(){const e=addDeviceBtn;e&&(e.dataset.mode="add",delete e.dataset.originalName,delete e.dataset.originalSubcategory,delete e.dataset.originalCategory);const t=cancelEditBtn;t&&(hideFormSection(t),setButtonLabelWithIconForEvents(t,texts[currentLang].cancelEditBtn,ICON_GLYPHS.circleX),t.setAttribute("data-help",texts[currentLang].cancelEditBtnHelp));const o=resolveNewCategorySelect();if(o&&o.isConnected)try{o.dispatchEvent(new Event("change"))}catch(r){console.warn("resetDeviceForm dispatch failed",r)}}function clearDeviceManagerFilterForCategory(e,t){if(!e||typeof document>"u"||!document)return;const o=String(e),r=document.querySelector(`input.list-filter[data-category-key="${o}"]`)||document.getElementById(`${o.replace(/[^a-z0-9]+/gi,"_")}ListFilter`);if(!r)return;const a=(typeof r.value=="string"?r.value:"").trim();if(!a)return;const s=a.toLowerCase(),l=typeof t=="string"&&t?t.trim().toLowerCase():"";if(!(l&&l.includes(s))){r.value="";try{r.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{r.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}}function applyDynamicFieldsToDevice(e,t,o,r){if(!e||typeof e!="object"||!t){applyDynamicFieldValues(void 0,o,r);return}const n=e[t],a=applyDynamicFieldValues(n,o,r);a&&a!==n&&(e[t]=a)}addSafeEventListener("addDeviceBtn","click",e=>{if(e&&typeof e.preventDefault=="function")try{e.preventDefault()}catch{}const t=newNameInput.value.trim(),o=resolveNewCategorySelect(),r=o?o.value:"",n=addDeviceBtn.dataset.mode==="edit",a=addDeviceBtn.dataset.originalName,s=addDeviceBtn.dataset.originalCategory,l=r==="accessories.cables"?newSubcategorySelect.value:null,u=addDeviceBtn.dataset.originalSubcategory;if(!t){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertDeviceNameTitle||"Name Required",message:texts[currentLang].alertDeviceName}):alert(texts[currentLang].alertDeviceName);return}if(r==="accessories.cables"&&!l){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertDeviceFieldsTitle||"Incomplete Data",message:texts[currentLang].alertDeviceFields}):alert(texts[currentLang].alertDeviceFields);return}const d=getCategoryContainer(r,l,{create:!0});if(!d){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertDeviceFieldsTitle||"Incomplete Data",message:texts[currentLang].alertDeviceFields}):alert(texts[currentLang].alertDeviceFields);return}const m=s||r,y=u||null,h=n?getCategoryContainer(m,m==="accessories.cables"?y:null,{create:!1}):null,b=n&&h?h[a]:void 0,C=n&&m===r&&(r!=="accessories.cables"||y===l),A=n&&m!==r,w=n&&(r==="accessories.cables"&&l!==y||m==="accessories.cables"&&y!==l),R=n&&t!==a;if(!n&&d[t]!==void 0||n&&d[t]!==void 0&&(R||A||w)){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertDeviceExistsTitle||"Device Exists",message:texts[currentLang].alertDeviceExists}):alert(texts[currentLang].alertDeviceExists);return}if(r==="batteries"||r==="accessories.batteries"||r==="batteryHotswaps"){const x=parseFloat(newCapacityInput.value),H=parseFloat(newPinAInput.value),W=r==="batteryHotswaps"?void 0:parseFloat(newDtapAInput.value);if(isNaN(x)||isNaN(H)||x<0||H<0||r!=="batteryHotswaps"&&(isNaN(W)||W<0)){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertDeviceFieldsTitle||"Incomplete Data",message:texts[currentLang].alertDeviceFields}):alert(texts[currentLang].alertDeviceFields);return}const U=C&&b?{...b}:{};r==="batteryHotswaps"?d[t]={...U,capacity:x,pinA:H}:d[t]={...U,capacity:x,pinA:H,dtapA:W},applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}else if(r==="accessories.cables"){const x=n&&b?{...b}:{};d[t]={...x},applyDynamicFieldsToDevice(d,t,`accessories.cables.${l}`,categoryExcludedAttrs[`accessories.cables.${l}`]||[])}else if(r==="cameras"){const x=parseFloat(cameraWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}let H,W,U,j,Y,le;try{H=invokeCoreFunctionStrict("getPowerDistribution"),W=invokeCoreFunctionStrict("getVideoOutputs"),U=invokeCoreFunctionStrict("getFizConnectors"),j=invokeCoreFunctionStrict("getViewfinders"),Y=invokeCoreFunctionStrict("getTimecodes"),le=invokeCoreFunctionStrict("getBatteryPlates")}catch(be){console.error("Invalid camera JSON input:",be),alert(texts[currentLang].alertInvalidCameraJSON);return}d[t]={powerDrawWatts:x,power:{input:{voltageRange:cameraVoltageInput.value,type:cameraPortTypeInput.value},batteryPlateSupport:le,powerDistributionOutputs:H},videoOutputs:W,fizConnectors:U,recordingMedia:getRecordingMedia(),viewfinder:j,lensMount:getLensMounts(),timecode:Y},applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[]),callCoreFunctionIfAvailable("updateMountTypeOptions",[],{defer:!0})}else if(r==="lenses"){const x=C&&b?{...b}:{},H=getLensDeviceMountOptions();if(H.length?(x.mountOptions=H,x.mount=H[0].type||""):(delete x.mountOptions,delete x.mount),lensFocusScaleSelect){const W=normalizeLensFocusScale(lensFocusScaleSelect.value);W?x.focusScale=W:delete x.focusScale}d[t]=x,applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[]),callCoreFunctionIfAvailable("updateMountTypeOptions",[],{defer:!0})}else if(r==="monitors"||r==="directorMonitors"){const x=parseFloat(monitorWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}const H=parseFloat(monitorScreenSizeInput.value),W=parseFloat(monitorBrightnessInput.value),U=typeof monitorLatencyInput.value=="string"?monitorLatencyInput.value.trim():"",j=U!==""?U:void 0,Y={screenSizeInches:isNaN(H)?void 0:H,brightnessNits:isNaN(W)?void 0:W,powerDrawWatts:x,power:{input:{voltageRange:monitorVoltageInput.value,type:monitorPortTypeInput.value},output:null},video:{inputs:getMonitorVideoInputs(),outputs:getMonitorVideoOutputs()},wirelessTx:monitorWirelessTxInput.checked,audioOutput:monitorAudioOutputInput.value?{portType:monitorAudioOutputInput.value}:void 0};typeof j<"u"&&(Y.latencyMs=j),d[t]=Y,applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}else if(r==="viewfinders"){const x=parseFloat(viewfinderWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}const H=parseFloat(viewfinderScreenSizeInput.value),W=parseFloat(viewfinderBrightnessInput.value),U=typeof viewfinderLatencyInput.value=="string"?viewfinderLatencyInput.value.trim():"",j=U!==""?U:void 0,Y={screenSizeInches:isNaN(H)?void 0:H,brightnessNits:isNaN(W)?void 0:W,powerDrawWatts:x,power:{input:{voltageRange:viewfinderVoltageInput.value,type:viewfinderPortTypeInput.value},output:null},video:{inputs:getViewfinderVideoInputs(),outputs:getViewfinderVideoOutputs()},wirelessTx:viewfinderWirelessTxInput.checked};typeof j<"u"&&(Y.latencyMs=j),d[t]=Y,applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}else if(r==="video"||r==="wirelessReceivers"||r==="iosVideo"){const x=parseFloat(newWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}const H=typeof videoLatencyInput.value=="string"?videoLatencyInput.value.trim():"",W=H!==""?H:void 0;let U;try{U=invokeCoreFunctionStrict("getVideoPowerInputs",[])}catch(de){if(eventsLogger&&typeof eventsLogger.error=="function")try{eventsLogger.error("Failed to collect video power inputs",de,{namespace:"device-editor"})}catch{}typeof console<"u"&&typeof console.error=="function"&&console.error("Failed to collect video power inputs",de),U=void 0}const j=n&&b&&typeof b=="object"?(()=>{try{return JSON.parse(JSON.stringify(b))}catch{return{...b}}})():{},Y=j&&typeof j=="object"?j:{};Y.powerDrawWatts=x;const le=getVideoInputs();Array.isArray(le)&&le.length?Y.videoInputs=le:delete Y.videoInputs;const be=getVideoOutputsIO();Array.isArray(be)&&be.length?Y.videoOutputs=be:delete Y.videoOutputs;const re=typeof videoFrequencyInput.value=="string"?videoFrequencyInput.value.trim():"";if(re?Y.frequency=re:delete Y.frequency,typeof U<"u"){const ne=(typeof VIDEO_POWER_INPUT_HELPERS.mergePowerInput=="function"?VIDEO_POWER_INPUT_HELPERS.mergePowerInput:(Ce,Ee)=>{const Pe=Ce&&typeof Ce=="object"?{...Ce}:{};return Pe.input=Ee,Pe})(Y.power,U);ne&&Object.keys(ne).length?Y.power=ne:delete Y.power}else delete Y.power;typeof W<"u"?Y.latencyMs=W:delete Y.latencyMs,d[t]=Y,applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}else if(r==="fiz.motors"){const x=parseFloat(newWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}d[t]={powerDrawWatts:x,fizConnector:motorConnectorInput.value,internalController:motorInternalInput.checked,torqueNm:motorTorqueInput.value?parseFloat(motorTorqueInput.value):null,gearTypes:motorGearInput.value?motorGearInput.value.split(",").map(H=>H.trim()).filter(Boolean):[],notes:motorNotesInput.value},applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}else if(r==="fiz.controllers"){const x=parseFloat(newWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}d[t]={powerDrawWatts:x,fizConnector:controllerConnectorInput.value,powerSource:controllerPowerInput.value,batteryType:controllerBatteryInput.value,connectivity:controllerConnectivityInput.value,notes:controllerNotesInput.value},applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}else if(r==="fiz.distance"){const x=parseFloat(newWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}d[t]={powerDrawWatts:x,connectionCompatibility:distanceConnectionInput.value,measurementMethod:distanceMethodInput.value,measurementRange:distanceRangeInput.value,accuracy:distanceAccuracyInput.value,outputDisplay:distanceOutputInput.value,notes:distanceNotesInput.value},applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}else{const x=parseFloat(newWattInput.value);if(isNaN(x)||x<=0){alert(texts[currentLang].alertDeviceWatt);return}const H=C&&b?{...b}:{};d[t]={...H,powerDrawWatts:x},applyDynamicFieldsToDevice(d,t,r,categoryExcludedAttrs[r]||[])}n&&(removeOriginalDeviceEntry(m,y,a,r,l,t),addDeviceBtn.dataset.originalCategory=r,r==="accessories.cables"&&l?addDeviceBtn.dataset.originalSubcategory=l:delete addDeviceBtn.dataset.originalSubcategory,addDeviceBtn.dataset.originalName=t),clearDeviceManagerFilterForCategory(r,t),resetDeviceForm$1(),typeof updateGlobalDevicesReference=="function"&&updateGlobalDevicesReference(devices),storeDevices(devices),viewfinderTypeOptions=syncCoreOptionsArray("viewfinderTypeOptions","getAllViewfinderTypes",viewfinderTypeOptions),viewfinderConnectorOptions=syncCoreOptionsArray("viewfinderConnectorOptions","getAllViewfinderConnectors",viewfinderConnectorOptions),callEventsCoreFunction("updatePlateTypeOptions"),callEventsCoreFunction("updatePowerPortOptions"),callEventsCoreFunction("updatePowerDistTypeOptions"),callEventsCoreFunction("updatePowerDistVoltageOptions"),callEventsCoreFunction("updatePowerDistCurrentOptions"),callEventsCoreFunction("updateRecordingMediaOptions"),callEventsCoreFunction("updateTimecodeTypeOptions"),refreshDeviceListsSafe();const _=typeof cameraSelect<"u"?cameraSelect:typeof document<"u"?document.getElementById("cameraSelect"):null,G=typeof videoSelect<"u"?videoSelect:typeof document<"u"?document.getElementById("videoSelect"):null,O=typeof distanceSelect<"u"?distanceSelect:typeof document<"u"?document.getElementById("distanceSelect"):null,B=typeof batterySelect<"u"?batterySelect:typeof document<"u"?document.getElementById("batterySelect"):null;populateSelect(_,devices.cameras,!0),populateMonitorSelect(),populateSelect(G,devices.video,!0);const $=devices.fiz||{},V=typeof motorSelects<"u"&&Array.isArray(motorSelects)?motorSelects:[document.getElementById("motor1Select"),document.getElementById("motor2Select"),document.getElementById("motor3Select"),document.getElementById("motor4Select")],M=typeof controllerSelects<"u"&&Array.isArray(controllerSelects)?controllerSelects:[document.getElementById("controller1Select"),document.getElementById("controller2Select")];if(V.forEach(x=>populateSelect(x,$.motors,!0)),M.forEach(x=>populateSelect(x,$.controllers,!0)),populateSelect(O,$.distance,!0),populateSelect(B,devices.batteries,!0),updateFizConnectorOptions(),applyFilters(),updateCalculations(),typeof document<"u"&&typeof document.dispatchEvent=="function"){const x=r==="accessories.cables"&&l&&l.trim()||null,H={name:t,category:r,subcategory:x};n&&(H.original={name:a||"",category:m||"",subcategory:m==="accessories.cables"&&y||null});try{document.dispatchEvent(new CustomEvent(n?"device-library:update":"device-library:add",{detail:H}))}catch(W){console.warn("Failed to dispatch device library mutation event",W)}}let F=r.replace(".","_"),z=texts[currentLang]["category_"+F]||r;if(n){const x=texts[currentLang].alertDeviceUpdated.replace("{name}",t).replace("{category}",z);typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertDeviceUpdatedTitle||"Device Updated",message:x}):alert(x)}else{const x=texts[currentLang].alertDeviceAdded.replace("{name}",t).replace("{category}",z);typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertDeviceAddedTitle||"Device Added",message:x}):alert(x)}});addSafeEventListener("cancelEditBtn","click",()=>{resetDeviceForm$1()});function generateExportFilename(e="cine_power_planner_export"){const t=new Date,o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),l=String(t.getSeconds()).padStart(2,"0");return`${e}_${o}-${r}-${n}_${a}-${s}-${l}.json`}addSafeEventListener("exportDataBtn","click",()=>{if(typeof autoBackup$1=="function")try{autoBackup$1({suppressSuccess:!0,triggerAutoSaveNotification:!0,reason:"export"})}catch(t){console.warn("Failed to auto backup before export",t)}if(!devices||typeof devices!="object"){alert(texts[currentLang].alertExportError||"Export failed: No valid device data found.");return}let e;try{e=JSON.stringify(devices,null,2)}catch(t){console.error("Failed to stringify devices for export",t),typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Export Failed",message:"Unable to serialize device data. Please check for corrupted entries."}):alert("Export failed: Unable to serialize data.");return}if(exportOutput.style.display="block",exportOutput.value=e,typeof downloadBackupPayload=="function")downloadBackupPayload(e,generateExportFilename());else{const t=new Blob([e],{type:"application/json;charset=utf-8"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=generateExportFilename(),document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r),URL.revokeObjectURL(o)},1500)}});const exportAndRevertBtn=document.getElementById("exportAndRevertBtn");exportAndRevertBtn&&addSafeEventListener("exportAndRevertBtn","click",()=>{const e=()=>{if(typeof autoBackup$1=="function")try{autoBackup$1({suppressSuccess:!0,triggerAutoSaveNotification:!0,reason:"export-revert"})}catch(n){console.warn("Failed to auto backup before export and revert",n)}const t=JSON.stringify(devices,null,2),o=generateExportFilename("cine_power_planner_backup_before_revert");if(typeof downloadBackupPayload=="function")downloadBackupPayload(t,o);else{const n=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=o,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(a)},1500)}const r=setTimeout(()=>{if(!clearAllDeviceStorageVariantsForEvents())try{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to confirm device storage reset during export & revert")}catch{}typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertExportAndRevertSuccessTitle||"Database Reset",message:texts[currentLang].alertExportAndRevertSuccess}):alert(texts[currentLang].alertExportAndRevertSuccess),location.reload()},500);typeof r.unref=="function"&&r.unref()};typeof window.cineShowConfirmDialog=="function"?window.cineShowConfirmDialog({title:texts[currentLang]&&texts[currentLang].exportAndRevertTitle||"Export and Revert",message:texts[currentLang].confirmExportAndRevert,confirmLabel:"Export & Revert",danger:!0,onConfirm:()=>e()}):confirm(texts[currentLang].confirmExportAndRevert)&&e()});addSafeEventListener("importDataBtn","click",()=>{importFileInput.click()});addSafeEventListener("importFileInput","change",e=>{const t=e.target.files[0];t&&(typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.showLoading("Importing Data..."),setTimeout(()=>{const o=new FileReader,r=typeof t.name=="string"&&t.name?t.name:null;o.onload=n=>{try{const a=JSON.parse(n.target.result),s=parseDeviceDatabaseImport(a),l=buildDeviceCountsSnapshot(devices,s.devices);if(!s.devices){const R=formatDeviceImportErrors(s.errors);logDeviceImportEvent("warn","Device import validation failed",{fileName:r,deviceCounts:l,validationErrors:sanitizeImportErrors(s.errors),errorCount:Array.isArray(s.errors)?s.errors.length:0},{action:"validate"}),console.error("Device import validation failed:",s.errors);const _=R?`${texts[currentLang].alertImportError}
${R}`:texts[currentLang].alertImportError;typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertImportErrorTitle||"Import Error",message:_}):alert(_);return}if(typeof autoBackup$1=="function")try{autoBackup$1({suppressSuccess:!0,triggerAutoSaveNotification:!0,reason:"import"})}catch(R){logDeviceImportEvent("warn","Auto backup before device import failed",{fileName:r,deviceCounts:l,error:sanitizeErrorForLogging(R)},{action:"auto-backup"}),console.warn("Failed to auto backup before import",R)}devices=s.devices,typeof updateGlobalDevicesReference=="function"&&updateGlobalDevicesReference(devices),unifyDevices(devices,{force:!0}),storeDevices(devices),viewfinderTypeOptions=syncCoreOptionsArray("viewfinderTypeOptions","getAllViewfinderTypes",viewfinderTypeOptions),viewfinderConnectorOptions=syncCoreOptionsArray("viewfinderConnectorOptions","getAllViewfinderConnectors",viewfinderConnectorOptions),refreshDeviceListsSafe();const u=typeof cameraSelect<"u"?cameraSelect:typeof document<"u"?document.getElementById("cameraSelect"):null,d=typeof videoSelect<"u"?videoSelect:typeof document<"u"?document.getElementById("videoSelect"):null,m=typeof distanceSelect<"u"?distanceSelect:typeof document<"u"?document.getElementById("distanceSelect"):null,y=typeof batterySelect<"u"?batterySelect:typeof document<"u"?document.getElementById("batterySelect"):null;populateSelect(u,devices.cameras,!0),populateMonitorSelect(),populateSelect(d,devices.video,!0);const h=devices.fiz||{},b=typeof motorSelects<"u"&&Array.isArray(motorSelects)?motorSelects:[document.getElementById("motor1Select"),document.getElementById("motor2Select"),document.getElementById("motor3Select"),document.getElementById("motor4Select")],v=typeof controllerSelects<"u"&&Array.isArray(controllerSelects)?controllerSelects:[document.getElementById("controller1Select"),document.getElementById("controller2Select")];b.forEach(R=>populateSelect(R,devices.fiz.motors,!0)),v.forEach(R=>populateSelect(R,devices.fiz.controllers,!0)),populateSelect(m,devices.fiz.distance,!0),populateSelect(y,devices.batteries,!0),updateFizConnectorOptions(),updateMotorConnectorOptions(),updateControllerConnectorOptions(),updateControllerPowerOptions(),updateControllerBatteryOptions(),updateControllerConnectivityOptions(),updateDistanceConnectionOptions(),updateDistanceMethodOptions(),updateDistanceDisplayOptions(),applyFilters(),updateCalculations();const C=countDeviceDatabaseEntries(devices),A=texts[currentLang].alertImportSuccess.replace("{num_devices}",C);typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertImportSuccessTitle||"Import Successful",message:A}):alert(A);const w=typeof exportOutput<"u"?exportOutput:typeof document<"u"?document.getElementById("exportOutput"):null;w&&(w.style.display="block",w.value=JSON.stringify(devices,null,2))}catch(a){logDeviceImportEvent("error","Failed to import device data",{fileName:r,deviceCounts:buildDeviceCountsSnapshot(devices,null),error:sanitizeErrorForLogging(a)},{action:"parse"}),console.error("Error parsing or importing data:",a);const s=a&&a.message?a.message:String(a),l=formatDeviceImportErrors([s]),u=l?`${texts[currentLang].alertImportError}
${l}`:texts[currentLang].alertImportError;typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].alertImportErrorTitle||"Import Error",message:u}):alert(u)}finally{typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.hideLoading()}},o.onerror=()=>{typeof window<"u"&&window.cineUiFeedback&&window.cineUiFeedback.hideLoading()},o.readAsText(t)},50),e.target.value="")});function updateRecordingFrameRateHint(){const e=document.getElementById("cameraSelect"),t=document.getElementById("sensorMode");document.getElementById("recordingResolution");const o=document.getElementById("recordingFrameRateHint");if(!o||!e||!t)return;const r=e.value,n=t.value;let a=200;const l=(globalThis.devices&&globalThis.devices.cameras?globalThis.devices.cameras:{})[r];l&&l.sensorModeMaxFps&&l.sensorModeMaxFps[n]&&(a=l.sensorModeMaxFps[n]);let u=o.getAttribute("data-range-template");u||(typeof texts<"u"&&texts[currentLang]&&texts[currentLang].recordingFrameRateRangeHint?u=texts[currentLang].recordingFrameRateRangeHint:u="Enter a recording frame rate from 1 to {max} fps.");const d=u.replace("{max}",a);o.textContent=d}(function e(){const t=document.getElementById("cameraSelect"),o=document.getElementById("sensorMode"),r=document.getElementById("recordingResolution");t&&t.addEventListener("change",()=>{setTimeout(updateRecordingFrameRateHint,100)}),o&&o.addEventListener("change",updateRecordingFrameRateHint),r&&r.addEventListener("change",updateRecordingFrameRateHint),setTimeout(updateRecordingFrameRateHint,500),setTimeout(updateRecordingFrameRateHint,500)})();typeof window<"u"&&(window.populateSetupSelect=populateSetupSelect$1);const scope$1=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,existingDocument=typeof document<"u"&&document||null,autoGearDocument=existingDocument||scope$1&&scope$1.document||null;let AUTO_GEAR_UI_EXPORTS;if(!autoGearDocument)AUTO_GEAR_UI_EXPORTS={autoGearRuleNameInput:null,autoGearRuleNameLabel:null,autoGearScenariosSelect:null,autoGearScenariosLabel:null,autoGearScenarioModeSelectElement:null,autoGearScenarioModeLabel:null,autoGearScenarioMultiplierContainer:null,autoGearScenarioBaseSelect:null,autoGearScenarioBaseLabel:null,autoGearScenarioFactorInput:null,autoGearScenarioFactorLabel:null,autoGearShootingDaysMode:null,autoGearShootingDaysInput:null,autoGearShootingDaysLabel:null,autoGearShootingDaysHelp:null,autoGearShootingDaysValueLabel:null,autoGearMatteboxSelect:null,autoGearMatteboxLabel:null,autoGearMatteboxModeLabel:null,autoGearMatteboxModeSelect:null,autoGearCameraHandleSelect:null,autoGearCameraHandleLabel:null,autoGearCameraHandleModeLabel:null,autoGearCameraHandleModeSelect:null,autoGearViewfinderExtensionSelect:null,autoGearViewfinderExtensionLabel:null,autoGearViewfinderExtensionModeLabel:null,autoGearViewfinderExtensionModeSelect:null,autoGearDeliveryResolutionSelect:null,autoGearDeliveryResolutionLabel:null,autoGearDeliveryResolutionModeLabel:null,autoGearDeliveryResolutionModeSelect:null,autoGearVideoDistributionSelect:null,autoGearVideoDistributionLabel:null,autoGearVideoDistributionModeLabel:null,autoGearVideoDistributionModeSelect:null,autoGearCameraSelect:null,autoGearCameraLabel:null,autoGearCameraModeLabel:null,autoGearCameraModeSelect:null,autoGearOwnGearLabel:null,autoGearOwnGearModeLabel:null,autoGearOwnGearModeSelect:null,autoGearOwnGearSelect:null,autoGearCameraWeightLabel:null,autoGearCameraWeightOperator:null,autoGearCameraWeightOperatorLabel:null,autoGearCameraWeightValueInput:null,autoGearCameraWeightValueLabel:null,autoGearCameraWeightHelp:null,autoGearMonitorSelect:null,autoGearMonitorLabel:null,autoGearMonitorModeLabel:null,autoGearMonitorModeSelect:null,autoGearTripodHeadBrandSelect:null,autoGearTripodHeadBrandLabel:null,autoGearTripodHeadBrandModeLabel:null,autoGearTripodHeadBrandModeSelect:null,autoGearTripodBowlSelect:null,autoGearTripodBowlLabel:null,autoGearTripodBowlModeLabel:null,autoGearTripodBowlModeSelect:null,autoGearTripodTypesSelect:null,autoGearTripodTypesLabel:null,autoGearTripodTypesModeLabel:null,autoGearTripodTypesModeSelect:null,autoGearTripodSpreaderSelect:null,autoGearTripodSpreaderLabel:null,autoGearTripodSpreaderModeLabel:null,autoGearTripodSpreaderModeSelect:null,autoGearCrewPresentSelect:null,autoGearCrewPresentLabel:null,autoGearCrewPresentModeLabel:null,autoGearCrewPresentModeSelect:null,autoGearCrewAbsentSelect:null,autoGearCrewAbsentLabel:null,autoGearCrewAbsentModeLabel:null,autoGearCrewAbsentModeSelect:null,autoGearWirelessSelect:null,autoGearWirelessLabel:null,autoGearWirelessModeLabel:null,autoGearWirelessModeSelect:null,autoGearMotorsSelect:null,autoGearMotorsLabel:null,autoGearMotorsModeLabel:null,autoGearMotorsModeSelect:null,autoGearControllersSelect:null,autoGearControllersLabel:null,autoGearControllersModeLabel:null,autoGearControllersModeSelect:null,autoGearDistanceSelect:null,autoGearDistanceLabel:null,autoGearDistanceModeLabel:null,autoGearDistanceModeSelect:null,autoGearConditionLabels:{},autoGearConditionSelects:{},autoGearConditionLogicLabels:{},autoGearConditionLogicSelects:{},AUTO_GEAR_CONDITION_KEYS:[],AUTO_GEAR_REPEATABLE_CONDITIONS:new Set,AUTO_GEAR_CONDITION_FALLBACK_LABELS:{},getViewfinderFallbackLabel:function(e){return e==="__none__"?"No":typeof e=="string"?e:""},getVideoDistributionFallbackLabel:function(e){return e==="__none__"?"No video distribution selected":typeof e=="string"?e:""},refreshAutoGearShootingDaysValue:function(){},refreshAutoGearScenarioOptions:function(){},refreshAutoGearScenarioBaseSelect:function(){},refreshAutoGearMatteboxOptions:function(){},refreshAutoGearCameraHandleOptions:function(){},refreshAutoGearViewfinderExtensionOptions:function(){},refreshAutoGearDeliveryResolutionOptions:function(){},refreshAutoGearVideoDistributionOptions:function(){},collectAutoGearSelectedValues:function(){return[]},getAutoGearScenarioModeSelectElement:function(){return null},setAutoGearScenarioModeSelectElement:function(){}},typeof module=="object"&&module&&module.exports&&(module.exports=AUTO_GEAR_UI_EXPORTS),scope$1&&typeof scope$1=="object"&&(scope$1.cineCoreAutoGearUi=AUTO_GEAR_UI_EXPORTS,scope$1.getViewfinderFallbackLabel=AUTO_GEAR_UI_EXPORTS.getViewfinderFallbackLabel,scope$1.getVideoDistributionFallbackLabel=AUTO_GEAR_UI_EXPORTS.getVideoDistributionFallbackLabel);else{let n=function(O){if(!autoGearShootingDaysInput)return;const B=O&&typeof O=="object"&&!Array.isArray(O)?normalizeAutoGearShootingDaysCondition(O):Array.isArray(O)&&O.length?normalizeAutoGearShootingDaysCondition({mode:"minimum",value:O[0]}):autoGearEditorDraft?.shootingDays?normalizeAutoGearShootingDaysCondition(autoGearEditorDraft.shootingDays):null,$=B?B.mode:"minimum";autoGearShootingDaysMode&&(autoGearShootingDaysMode.value=AUTO_GEAR_SHOOTING_DAY_MODES.has($)?$:"minimum");const V=B?B.value:"";autoGearShootingDaysInput.value=V?String(V):""},a=function(O){if(!autoGearScenariosSelect$1)return;const B=Array.isArray(O)?O:typeof O=="string"&&O?[O]:Array.isArray(autoGearEditorDraft?.scenarios)?autoGearEditorDraft.scenarios:[],$=Array.from(new Set(B.filter(z=>typeof z=="string").map(z=>z.trim()).filter(Boolean)));autoGearScenariosSelect$1.innerHTML="",autoGearScenariosSelect$1.multiple=!0;const V=autoGearDocument.getElementById("requiredScenarios");let M=!1;if(V&&Array.from(V.options).forEach(z=>{if(!z.value)return;const x=autoGearDocument.createElement("option");x.value=z.value,x.textContent=z.textContent,$.includes(z.value)&&(x.selected=!0),autoGearScenariosSelect$1.appendChild(x),M=!0}),M)$.forEach(z=>{if(!Array.from(autoGearScenariosSelect$1.options||[]).some(H=>H&&H.value===z)){const H=autoGearDocument.createElement("option");H.value=z,H.textContent=z,H.selected=!0,autoGearScenariosSelect$1.appendChild(H)}});else{const z=autoGearDocument.createElement("option");z.value="",z.textContent=texts[currentLang]?.autoGearScenarioPlaceholder||texts.en?.autoGearScenarioPlaceholder||"Select scenarios",z.disabled=!0,z.selected=!0,autoGearScenariosSelect$1.appendChild(z)}const F=Array.from(autoGearScenariosSelect$1.options||[]).filter(z=>!z.disabled);autoGearScenariosSelect$1.size=computeAutoGearMultiSelectSize(F.length,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS}),s($)},s=function(O){const B=Array.isArray(O)?O.filter(M=>typeof M=="string"&&M.trim()):[],$=Array.from(new Set(B)),V=autoGearEditorDraft?normalizeAutoGearScenarioLogic(autoGearEditorDraft.scenarioLogic):normalizeAutoGearScenarioLogic(e?.value);if(e){const M={all:texts[currentLang]?.autoGearScenarioModeAll||texts.en?.autoGearScenarioModeAll||"Require every selected scenario",any:texts[currentLang]?.autoGearScenarioModeAny||texts.en?.autoGearScenarioModeAny||"Match any selected scenario",multiplier:texts[currentLang]?.autoGearScenarioModeMultiplier||texts.en?.autoGearScenarioModeMultiplier||"Multiply when combined"};Array.from(e.options||[]).forEach(z=>{if(!z)return;z.value==="multiplier"?z.disabled=$.length<2:z.disabled=!1;const x=M[z.value]||M.all;z.textContent=x});let F=V;F==="multiplier"&&$.length<2&&(F="all"),e.value=F,autoGearEditorDraft&&autoGearEditorDraft.scenarioLogic!==F&&(autoGearEditorDraft.scenarioLogic=F),l(F,$)}else l(V,$)},l=function(O,B){if(!autoGearScenarioMultiplierContainer)return;const $=normalizeAutoGearScenarioLogic(O),V=Array.isArray(B)?B.filter(F=>typeof F=="string"&&F.trim()):[],M=$==="multiplier"&&V.length>=1;autoGearScenarioMultiplierContainer.hidden=!M,autoGearScenarioMultiplierContainer.setAttribute("aria-hidden",M?"false":"true"),autoGearScenarioFactorInput$1&&(autoGearScenarioFactorInput$1.disabled=!M),u(V,{forceDisable:!M})},u=function(O,B={}){if(!autoGearScenarioBaseSelect$1)return;const{forceDisable:$=!1}=B,V=Array.isArray(O)?O.filter(W=>typeof W=="string"&&W.trim()):[],M=Array.from(new Set(V)),F=autoGearScenarioBaseSelect$1.value||"";if(autoGearScenarioBaseSelect$1.innerHTML="",$||!M.length){const W=autoGearDocument.createElement("option");W.value="",W.textContent=texts[currentLang]?.autoGearScenarioBasePlaceholder||texts.en?.autoGearScenarioBasePlaceholder||"Select a base scenario",W.disabled=!0,W.selected=!0,autoGearScenarioBaseSelect$1.appendChild(W),autoGearScenarioBaseSelect$1.disabled=!0;return}M.forEach(W=>{const U=autoGearDocument.createElement("option");U.value=W,U.textContent=W,autoGearScenarioBaseSelect$1.appendChild(U)});const z=autoGearEditorDraft?normalizeAutoGearScenarioPrimary(autoGearEditorDraft.scenarioPrimary):"",x=normalizeAutoGearTriggerValue(z);let H="";if(x){const W=M.find(U=>normalizeAutoGearTriggerValue(U)===x);W&&(H=W)}if(!H&&F){const W=normalizeAutoGearTriggerValue(F),U=M.find(j=>normalizeAutoGearTriggerValue(j)===W);U&&(H=U)}H||(H=M[0]),autoGearScenarioBaseSelect$1.value=H,autoGearScenarioBaseSelect$1.disabled=!1},d=function(O){if(!autoGearMatteboxSelect$1)return;const B=Array.isArray(O)?O:typeof O=="string"&&O?[O]:Array.isArray(autoGearEditorDraft?.mattebox)?autoGearEditorDraft.mattebox:[],$=Array.from(new Set(B.filter(z=>typeof z=="string").map(z=>z.trim()).filter(Boolean)));autoGearMatteboxSelect$1.innerHTML="",autoGearMatteboxSelect$1.multiple=!0;const V=autoGearDocument.getElementById("mattebox");let M=!1;if(V&&Array.from(V.options).forEach(z=>{if(!z.value)return;const x=autoGearDocument.createElement("option");x.value=z.value,x.textContent=z.textContent,$.includes(z.value)&&(x.selected=!0),autoGearMatteboxSelect$1.appendChild(x),M=!0}),M)$.forEach(z=>{if(!Array.from(autoGearMatteboxSelect$1.options||[]).some(H=>H&&H.value===z)){const H=autoGearDocument.createElement("option");H.value=z,H.textContent=z,H.selected=!0,autoGearMatteboxSelect$1.appendChild(H)}});else{const z=autoGearDocument.createElement("option");z.value="",z.textContent=texts[currentLang]?.autoGearMatteboxPlaceholder||texts.en?.autoGearMatteboxPlaceholder||"Select mattebox options",z.disabled=!0,z.selected=!0,autoGearMatteboxSelect$1.appendChild(z)}const F=Array.from(autoGearMatteboxSelect$1.options||[]).filter(z=>!z.disabled);autoGearMatteboxSelect$1.size=computeAutoGearMultiSelectSize(F.length,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})},m=function(O){if(!autoGearCameraHandleSelect$1)return;const B=Array.isArray(O)?O:typeof O=="string"&&O?[O]:Array.isArray(autoGearEditorDraft?.cameraHandle)?autoGearEditorDraft.cameraHandle:[],$=Array.from(new Set(B.filter(z=>typeof z=="string").map(z=>z.trim()).filter(Boolean)));autoGearCameraHandleSelect$1.innerHTML="",autoGearCameraHandleSelect$1.multiple=!0;const V=autoGearDocument.getElementById("cameraHandle");let M=!1;if(V&&Array.from(V.options).forEach(z=>{if(!z.value)return;const x=autoGearDocument.createElement("option");x.value=z.value,x.textContent=z.textContent,$.includes(z.value)&&(x.selected=!0),autoGearCameraHandleSelect$1.appendChild(x),M=!0}),M)$.forEach(z=>{if(!Array.from(autoGearCameraHandleSelect$1.options||[]).some(H=>H&&H.value===z)){const H=autoGearDocument.createElement("option");H.value=z,H.textContent=z,H.selected=!0,autoGearCameraHandleSelect$1.appendChild(H)}});else{const z=autoGearDocument.createElement("option");z.value="",z.textContent=texts[currentLang]?.autoGearCameraHandlePlaceholder||texts.en?.autoGearCameraHandlePlaceholder||"Select camera handles",z.disabled=!0,z.selected=!0,autoGearCameraHandleSelect$1.appendChild(z)}const F=Array.from(autoGearCameraHandleSelect$1.options||[]).filter(z=>!z.disabled);autoGearCameraHandleSelect$1.size=computeAutoGearMultiSelectSize(F.length,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})},y=function(O){if(!O)return"";const B=typeof O.value=="string"?O.value:"";return B||"__none__"},h=function(O){return O==="__none__"?texts[currentLang]?.viewfinderExtensionNone||texts.en?.viewfinderExtensionNone||"No":O},b=function(O){if(O==="__none__")return texts[currentLang]?.autoGearVideoDistributionNone||texts.en?.autoGearVideoDistributionNone||"No video distribution selected";const B=texts[currentLang]?.videoDistributionOptions?.[O];return B||O},v=function(O){if(typeof O!="string")return"";const B=O.trim();if(!B)return"";const $=B.toLowerCase();return $==="__none__"||$==="none"?"__none__":B},C=function(O){if(!autoGearViewfinderExtensionSelect$1)return;const B=Array.isArray(O)?O:typeof O=="string"&&O?[O]:Array.isArray(autoGearEditorDraft?.viewfinderExtension)?autoGearEditorDraft.viewfinderExtension:[],$=Array.from(new Set(B.filter(z=>typeof z=="string").map(z=>z.trim()).filter(Boolean)));autoGearViewfinderExtensionSelect$1.innerHTML="",autoGearViewfinderExtensionSelect$1.multiple=!0;const V=autoGearDocument.getElementById("viewfinderExtension");let M=!1;if(V&&Array.from(V.options).forEach(z=>{const x=autoGearDocument.createElement("option"),H=y(z);x.value=H,x.textContent=z.textContent,$.includes(H)&&(x.selected=!0),autoGearViewfinderExtensionSelect$1.appendChild(x),M=!0}),M)$.forEach(z=>{if(!Array.from(autoGearViewfinderExtensionSelect$1.options||[]).some(H=>H&&H.value===z)){const H=autoGearDocument.createElement("option");H.value=z,H.textContent=h(z),H.selected=!0,autoGearViewfinderExtensionSelect$1.appendChild(H)}});else{const z=autoGearDocument.createElement("option");z.value="",z.textContent=texts[currentLang]?.autoGearViewfinderExtensionPlaceholder||texts.en?.autoGearViewfinderExtensionPlaceholder||"Select viewfinder extension options",z.disabled=!0,z.selected=!0,autoGearViewfinderExtensionSelect$1.appendChild(z)}const F=Array.from(autoGearViewfinderExtensionSelect$1.options||[]).filter(z=>!z.disabled);autoGearViewfinderExtensionSelect$1.size=computeAutoGearMultiSelectSize(F.length,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})},A=function(O){if(!autoGearDeliveryResolutionSelect$1)return;const B=R(O,"deliveryResolution");autoGearDeliveryResolutionSelect$1.innerHTML="",autoGearDeliveryResolutionSelect$1.multiple=!0;const $=new Set,V=(F,z)=>{const x=typeof F=="string"?F.trim():"";if(!x||$.has(x))return;const H=autoGearDocument.createElement("option");H.value=x,H.textContent=z||x,B.includes(x)&&(H.selected=!0),autoGearDeliveryResolutionSelect$1.appendChild(H),$.add(x)};if(deliveryResolutionSelect&&Array.from(deliveryResolutionSelect.options||[]).forEach(F=>{if(!F||typeof F.value!="string")return;const z=F.value.trim();if(!z)return;const x=(F.textContent||z).trim();V(z,x)}),B.forEach(F=>{$.has(F)||V(F,F)}),!autoGearDeliveryResolutionSelect$1.options.length){const F=autoGearDocument.createElement("option");F.value="",F.textContent=texts[currentLang]?.autoGearDeliveryResolutionPlaceholder||texts.en?.autoGearDeliveryResolutionPlaceholder||"Select delivery resolutions",F.disabled=!0,F.selected=!0,autoGearDeliveryResolutionSelect$1.appendChild(F)}const M=Array.from(autoGearDeliveryResolutionSelect$1.options||[]).filter(F=>!F.disabled).length;autoGearDeliveryResolutionSelect$1.size=computeAutoGearMultiSelectSize(M,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})},w=function(O){if(!autoGearVideoDistributionSelect$1)return;const B=Array.isArray(O)?O:typeof O=="string"&&O?[O]:Array.isArray(autoGearEditorDraft?.videoDistribution)?autoGearEditorDraft.videoDistribution:[],$=Array.from(new Set(B.map(v).filter(Boolean))),V=$.includes("__none__"),M=$.filter(W=>W!=="__none__");autoGearVideoDistributionSelect$1.innerHTML="",autoGearVideoDistributionSelect$1.multiple=!0;const F=autoGearDocument.createElement("option");F.value="__none__",F.textContent=b("__none__"),V&&(F.selected=!0),autoGearVideoDistributionSelect$1.appendChild(F);const z=autoGearDocument.getElementById("videoDistribution");let x=!1;if(z&&Array.from(z.options).forEach(W=>{const U=v(W.value);if(!U)return;if(U==="__none__"){V&&(F.selected=!0);return}const j=autoGearDocument.createElement("option");j.value=U,j.textContent=W.textContent,M.includes(U)&&(j.selected=!0),autoGearVideoDistributionSelect$1.appendChild(j),x=!0}),x)M.forEach(W=>{if(!Array.from(autoGearVideoDistributionSelect$1.options||[]).some(j=>j&&j.value===W)){const j=autoGearDocument.createElement("option");j.value=W,j.textContent=b(W),j.selected=!0,autoGearVideoDistributionSelect$1.appendChild(j)}});else{const W=autoGearDocument.createElement("option");W.value="",W.textContent=texts[currentLang]?.autoGearVideoDistributionPlaceholder||texts.en?.autoGearVideoDistributionPlaceholder||"Select video distribution options",W.disabled=!0,W.selected=!0,autoGearVideoDistributionSelect$1.appendChild(W)}const H=Array.from(autoGearVideoDistributionSelect$1.options||[]).filter(W=>!W.disabled);autoGearVideoDistributionSelect$1.size=computeAutoGearMultiSelectSize(H.length,{minRows:AUTO_GEAR_FLEX_MULTI_SELECT_MIN_ROWS})},R=function(O,B){const $=Array.isArray(O)?O:typeof O=="string"&&O?[O]:Array.isArray(autoGearEditorDraft?.[B])?autoGearEditorDraft[B]:[];return Array.from(new Set($.filter(V=>typeof V=="string").map(V=>V.trim()).filter(Boolean)))},_=function(){return e},G=function(O){e=O||null};var autoGearRuleNameInput=autoGearDocument.getElementById("autoGearRuleName"),autoGearRuleNameLabel=autoGearDocument.getElementById("autoGearRuleNameLabel"),autoGearScenariosSelect$1=autoGearDocument.getElementById("autoGearScenarios"),autoGearScenariosLabel=autoGearDocument.getElementById("autoGearScenariosLabel");let e=autoGearDocument.getElementById("autoGearScenarioMode");var autoGearScenarioModeLabel=autoGearDocument.getElementById("autoGearScenarioModeLabel"),autoGearScenarioMultiplierContainer=autoGearDocument.getElementById("autoGearScenarioMultiplierContainer"),autoGearScenarioBaseSelect$1=autoGearDocument.getElementById("autoGearScenarioBase"),autoGearScenarioBaseLabel=autoGearDocument.getElementById("autoGearScenarioBaseLabel"),autoGearScenarioFactorInput$1=autoGearDocument.getElementById("autoGearScenarioFactor"),autoGearScenarioFactorLabel=autoGearDocument.getElementById("autoGearScenarioFactorLabel"),autoGearShootingDaysMode=autoGearDocument.getElementById("autoGearShootingDaysMode"),autoGearShootingDaysInput=autoGearDocument.getElementById("autoGearShootingDays"),autoGearShootingDaysLabel=autoGearDocument.getElementById("autoGearShootingDaysLabel"),autoGearShootingDaysHelp=autoGearDocument.getElementById("autoGearShootingDaysHelp"),autoGearShootingDaysValueLabel=autoGearDocument.getElementById("autoGearShootingDaysCountLabel"),autoGearMatteboxSelect$1=autoGearDocument.getElementById("autoGearMattebox"),autoGearMatteboxLabel=autoGearDocument.getElementById("autoGearMatteboxLabel"),autoGearMatteboxModeLabel=autoGearDocument.getElementById("autoGearMatteboxModeLabel"),autoGearMatteboxModeSelect$1=autoGearDocument.getElementById("autoGearMatteboxMode"),autoGearCameraHandleSelect$1=autoGearDocument.getElementById("autoGearCameraHandle"),autoGearCameraHandleLabel=autoGearDocument.getElementById("autoGearCameraHandleLabel"),autoGearCameraHandleModeLabel=autoGearDocument.getElementById("autoGearCameraHandleModeLabel"),autoGearCameraHandleModeSelect$1=autoGearDocument.getElementById("autoGearCameraHandleMode"),autoGearViewfinderExtensionSelect$1=autoGearDocument.getElementById("autoGearViewfinderExtension"),autoGearViewfinderExtensionLabel=autoGearDocument.getElementById("autoGearViewfinderExtensionLabel"),autoGearViewfinderExtensionModeLabel=autoGearDocument.getElementById("autoGearViewfinderExtensionModeLabel"),autoGearViewfinderExtensionModeSelect$1=autoGearDocument.getElementById("autoGearViewfinderExtensionMode"),autoGearDeliveryResolutionSelect$1=autoGearDocument.getElementById("autoGearDeliveryResolution"),autoGearDeliveryResolutionLabel=autoGearDocument.getElementById("autoGearDeliveryResolutionLabel"),autoGearDeliveryResolutionModeLabel=autoGearDocument.getElementById("autoGearDeliveryResolutionModeLabel"),autoGearDeliveryResolutionModeSelect$1=autoGearDocument.getElementById("autoGearDeliveryResolutionMode"),autoGearVideoDistributionSelect$1=autoGearDocument.getElementById("autoGearVideoDistribution"),autoGearVideoDistributionLabel=autoGearDocument.getElementById("autoGearVideoDistributionLabel"),autoGearVideoDistributionModeLabel=autoGearDocument.getElementById("autoGearVideoDistributionModeLabel"),autoGearVideoDistributionModeSelect$1=autoGearDocument.getElementById("autoGearVideoDistributionMode"),autoGearCameraSelect$1=autoGearDocument.getElementById("autoGearCamera"),autoGearCameraLabel=autoGearDocument.getElementById("autoGearCameraLabel"),autoGearCameraModeLabel=autoGearDocument.getElementById("autoGearCameraModeLabel"),autoGearCameraModeSelect$1=autoGearDocument.getElementById("autoGearCameraMode"),autoGearOwnGearLabel=autoGearDocument.getElementById("autoGearOwnGearLabel"),autoGearOwnGearModeLabel=autoGearDocument.getElementById("autoGearOwnGearModeLabel"),autoGearOwnGearModeSelect$1=autoGearDocument.getElementById("autoGearOwnGearMode"),autoGearOwnGearSelect$1=autoGearDocument.getElementById("autoGearOwnGear"),autoGearCameraWeightLabel=autoGearDocument.getElementById("autoGearCameraWeightLabel"),autoGearCameraWeightOperator$1=autoGearDocument.getElementById("autoGearCameraWeightOperator"),autoGearCameraWeightOperatorLabel=autoGearDocument.getElementById("autoGearCameraWeightOperatorLabel"),autoGearCameraWeightValueInput=autoGearDocument.getElementById("autoGearCameraWeightValue"),autoGearCameraWeightValueLabel=autoGearDocument.getElementById("autoGearCameraWeightValueLabel"),autoGearCameraWeightHelp=autoGearDocument.getElementById("autoGearCameraWeightHelp"),autoGearMonitorSelect$1=autoGearDocument.getElementById("autoGearMonitor"),autoGearMonitorLabel=autoGearDocument.getElementById("autoGearMonitorLabel"),autoGearMonitorModeLabel=autoGearDocument.getElementById("autoGearMonitorModeLabel"),autoGearMonitorModeSelect$1=autoGearDocument.getElementById("autoGearMonitorMode"),autoGearTripodHeadBrandSelect$1=autoGearDocument.getElementById("autoGearTripodHeadBrand"),autoGearTripodHeadBrandLabel=autoGearDocument.getElementById("autoGearTripodHeadBrandLabel"),autoGearTripodHeadBrandModeLabel=autoGearDocument.getElementById("autoGearTripodHeadBrandModeLabel"),autoGearTripodHeadBrandModeSelect=autoGearDocument.getElementById("autoGearTripodHeadBrandMode"),autoGearTripodBowlSelect$1=autoGearDocument.getElementById("autoGearTripodBowl"),autoGearTripodBowlLabel=autoGearDocument.getElementById("autoGearTripodBowlLabel"),autoGearTripodBowlModeLabel=autoGearDocument.getElementById("autoGearTripodBowlModeLabel"),autoGearTripodBowlModeSelect=autoGearDocument.getElementById("autoGearTripodBowlMode"),autoGearTripodTypesSelect$1=autoGearDocument.getElementById("autoGearTripodTypes"),autoGearTripodTypesLabel=autoGearDocument.getElementById("autoGearTripodTypesLabel"),autoGearTripodTypesModeLabel=autoGearDocument.getElementById("autoGearTripodTypesModeLabel"),autoGearTripodTypesModeSelect=autoGearDocument.getElementById("autoGearTripodTypesMode"),autoGearTripodSpreaderSelect$1=autoGearDocument.getElementById("autoGearTripodSpreader"),autoGearTripodSpreaderLabel=autoGearDocument.getElementById("autoGearTripodSpreaderLabel"),autoGearTripodSpreaderModeLabel=autoGearDocument.getElementById("autoGearTripodSpreaderModeLabel"),autoGearTripodSpreaderModeSelect=autoGearDocument.getElementById("autoGearTripodSpreaderMode"),autoGearCrewPresentSelect$1=autoGearDocument.getElementById("autoGearCrewPresent"),autoGearCrewPresentLabel=autoGearDocument.getElementById("autoGearCrewPresentLabel"),autoGearCrewPresentModeLabel=autoGearDocument.getElementById("autoGearCrewPresentModeLabel"),autoGearCrewPresentModeSelect$1=autoGearDocument.getElementById("autoGearCrewPresentMode"),autoGearCrewAbsentSelect$1=autoGearDocument.getElementById("autoGearCrewAbsent"),autoGearCrewAbsentLabel=autoGearDocument.getElementById("autoGearCrewAbsentLabel"),autoGearCrewAbsentModeLabel=autoGearDocument.getElementById("autoGearCrewAbsentModeLabel"),autoGearCrewAbsentModeSelect$1=autoGearDocument.getElementById("autoGearCrewAbsentMode"),autoGearWirelessSelect$1=autoGearDocument.getElementById("autoGearWireless"),autoGearWirelessLabel=autoGearDocument.getElementById("autoGearWirelessLabel"),autoGearWirelessModeLabel=autoGearDocument.getElementById("autoGearWirelessModeLabel"),autoGearWirelessModeSelect$1=autoGearDocument.getElementById("autoGearWirelessMode"),autoGearMotorsSelect$1=autoGearDocument.getElementById("autoGearMotors"),autoGearMotorsLabel=autoGearDocument.getElementById("autoGearMotorsLabel"),autoGearMotorsModeLabel=autoGearDocument.getElementById("autoGearMotorsModeLabel"),autoGearMotorsModeSelect$1=autoGearDocument.getElementById("autoGearMotorsMode"),autoGearControllersSelect$1=autoGearDocument.getElementById("autoGearControllers"),autoGearControllersLabel=autoGearDocument.getElementById("autoGearControllersLabel"),autoGearControllersModeLabel=autoGearDocument.getElementById("autoGearControllersModeLabel"),autoGearControllersModeSelect$1=autoGearDocument.getElementById("autoGearControllersMode"),autoGearDistanceSelect$1=autoGearDocument.getElementById("autoGearDistance"),autoGearDistanceLabel=autoGearDocument.getElementById("autoGearDistanceLabel"),autoGearDistanceModeLabel=autoGearDocument.getElementById("autoGearDistanceModeLabel"),autoGearDistanceModeSelect$1=autoGearDocument.getElementById("autoGearDistanceMode"),autoGearConditionLabels={always:autoGearAlwaysLabel,scenarios:autoGearScenariosLabel,shootingDays:autoGearShootingDaysLabel,mattebox:autoGearMatteboxLabel,cameraHandle:autoGearCameraHandleLabel,viewfinderExtension:autoGearViewfinderExtensionLabel,deliveryResolution:autoGearDeliveryResolutionLabel,videoDistribution:autoGearVideoDistributionLabel,camera:autoGearCameraLabel,ownGear:autoGearOwnGearLabel,cameraWeight:autoGearCameraWeightLabel,monitor:autoGearMonitorLabel,tripodHeadBrand:autoGearTripodHeadBrandLabel,tripodBowl:autoGearTripodBowlLabel,tripodTypes:autoGearTripodTypesLabel,tripodSpreader:autoGearTripodSpreaderLabel,crewPresent:autoGearCrewPresentLabel,crewAbsent:autoGearCrewAbsentLabel,wireless:autoGearWirelessLabel,motors:autoGearMotorsLabel,controllers:autoGearControllersLabel,distance:autoGearDistanceLabel},autoGearConditionSelects={always:null,scenarios:autoGearScenariosSelect$1,shootingDays:autoGearShootingDaysInput,mattebox:autoGearMatteboxSelect$1,cameraHandle:autoGearCameraHandleSelect$1,viewfinderExtension:autoGearViewfinderExtensionSelect$1,deliveryResolution:autoGearDeliveryResolutionSelect$1,videoDistribution:autoGearVideoDistributionSelect$1,camera:autoGearCameraSelect$1,ownGear:autoGearOwnGearSelect$1,cameraWeight:autoGearCameraWeightValueInput,monitor:autoGearMonitorSelect$1,tripodHeadBrand:autoGearTripodHeadBrandSelect$1,tripodBowl:autoGearTripodBowlSelect$1,tripodTypes:autoGearTripodTypesSelect$1,tripodSpreader:autoGearTripodSpreaderSelect$1,crewPresent:autoGearCrewPresentSelect$1,crewAbsent:autoGearCrewAbsentSelect$1,wireless:autoGearWirelessSelect$1,motors:autoGearMotorsSelect$1,controllers:autoGearControllersSelect$1,distance:autoGearDistanceSelect$1},autoGearConditionLogicLabels={mattebox:autoGearMatteboxModeLabel,cameraHandle:autoGearCameraHandleModeLabel,viewfinderExtension:autoGearViewfinderExtensionModeLabel,deliveryResolution:autoGearDeliveryResolutionModeLabel,videoDistribution:autoGearVideoDistributionModeLabel,camera:autoGearCameraModeLabel,ownGear:autoGearOwnGearModeLabel,monitor:autoGearMonitorModeLabel,tripodHeadBrand:autoGearTripodHeadBrandModeLabel,tripodBowl:autoGearTripodBowlModeLabel,tripodTypes:autoGearTripodTypesModeLabel,tripodSpreader:autoGearTripodSpreaderModeLabel,crewPresent:autoGearCrewPresentModeLabel,crewAbsent:autoGearCrewAbsentModeLabel,wireless:autoGearWirelessModeLabel,motors:autoGearMotorsModeLabel,controllers:autoGearControllersModeLabel,distance:autoGearDistanceModeLabel},autoGearConditionLogicSelects={mattebox:autoGearMatteboxModeSelect$1,cameraHandle:autoGearCameraHandleModeSelect$1,viewfinderExtension:autoGearViewfinderExtensionModeSelect$1,deliveryResolution:autoGearDeliveryResolutionModeSelect$1,videoDistribution:autoGearVideoDistributionModeSelect$1,camera:autoGearCameraModeSelect$1,ownGear:autoGearOwnGearModeSelect$1,monitor:autoGearMonitorModeSelect$1,tripodHeadBrand:autoGearTripodHeadBrandModeSelect,tripodBowl:autoGearTripodBowlModeSelect,tripodTypes:autoGearTripodTypesModeSelect,tripodSpreader:autoGearTripodSpreaderModeSelect,crewPresent:autoGearCrewPresentModeSelect$1,crewAbsent:autoGearCrewAbsentModeSelect$1,wireless:autoGearWirelessModeSelect$1,motors:autoGearMotorsModeSelect$1,controllers:autoGearControllersModeSelect$1,distance:autoGearDistanceModeSelect$1};Object.values(autoGearConditionLogicSelects).forEach(O=>{O&&(O.disabled=!0)}),AUTO_GEAR_UI_EXPORTS={autoGearRuleNameInput,autoGearRuleNameLabel,autoGearScenariosSelect:autoGearScenariosSelect$1,autoGearScenariosLabel,autoGearScenarioModeSelectElement:e,autoGearScenarioModeLabel,autoGearScenarioMultiplierContainer,autoGearScenarioBaseSelect:autoGearScenarioBaseSelect$1,autoGearScenarioBaseLabel,autoGearScenarioFactorInput:autoGearScenarioFactorInput$1,autoGearScenarioFactorLabel,autoGearShootingDaysMode,autoGearShootingDaysInput,autoGearShootingDaysLabel,autoGearShootingDaysHelp,autoGearShootingDaysValueLabel,autoGearMatteboxSelect:autoGearMatteboxSelect$1,autoGearMatteboxLabel,autoGearMatteboxModeLabel,autoGearMatteboxModeSelect:autoGearMatteboxModeSelect$1,autoGearCameraHandleSelect:autoGearCameraHandleSelect$1,autoGearCameraHandleLabel,autoGearCameraHandleModeLabel,autoGearCameraHandleModeSelect:autoGearCameraHandleModeSelect$1,autoGearViewfinderExtensionSelect:autoGearViewfinderExtensionSelect$1,autoGearViewfinderExtensionLabel,autoGearViewfinderExtensionModeLabel,autoGearViewfinderExtensionModeSelect:autoGearViewfinderExtensionModeSelect$1,autoGearDeliveryResolutionSelect:autoGearDeliveryResolutionSelect$1,autoGearDeliveryResolutionLabel,autoGearDeliveryResolutionModeLabel,autoGearDeliveryResolutionModeSelect:autoGearDeliveryResolutionModeSelect$1,autoGearVideoDistributionSelect:autoGearVideoDistributionSelect$1,autoGearVideoDistributionLabel,autoGearVideoDistributionModeLabel,autoGearVideoDistributionModeSelect:autoGearVideoDistributionModeSelect$1,autoGearCameraSelect:autoGearCameraSelect$1,autoGearCameraLabel,autoGearCameraModeLabel,autoGearCameraModeSelect:autoGearCameraModeSelect$1,autoGearOwnGearLabel,autoGearOwnGearModeLabel,autoGearOwnGearModeSelect:autoGearOwnGearModeSelect$1,autoGearOwnGearSelect:autoGearOwnGearSelect$1,autoGearCameraWeightLabel,autoGearCameraWeightOperator:autoGearCameraWeightOperator$1,autoGearCameraWeightOperatorLabel,autoGearCameraWeightValueInput,autoGearCameraWeightValueLabel,autoGearCameraWeightHelp,autoGearMonitorSelect:autoGearMonitorSelect$1,autoGearMonitorLabel,autoGearMonitorModeLabel,autoGearMonitorModeSelect:autoGearMonitorModeSelect$1,autoGearTripodHeadBrandSelect:autoGearTripodHeadBrandSelect$1,autoGearTripodHeadBrandLabel,autoGearTripodHeadBrandModeLabel,autoGearTripodHeadBrandModeSelect,autoGearTripodBowlSelect:autoGearTripodBowlSelect$1,autoGearTripodBowlLabel,autoGearTripodBowlModeLabel,autoGearTripodBowlModeSelect,autoGearTripodTypesSelect:autoGearTripodTypesSelect$1,autoGearTripodTypesLabel,autoGearTripodTypesModeLabel,autoGearTripodTypesModeSelect,autoGearTripodSpreaderSelect:autoGearTripodSpreaderSelect$1,autoGearTripodSpreaderLabel,autoGearTripodSpreaderModeLabel,autoGearTripodSpreaderModeSelect,autoGearCrewPresentSelect:autoGearCrewPresentSelect$1,autoGearCrewPresentLabel,autoGearCrewPresentModeLabel,autoGearCrewPresentModeSelect:autoGearCrewPresentModeSelect$1,autoGearCrewAbsentSelect:autoGearCrewAbsentSelect$1,autoGearCrewAbsentLabel,autoGearCrewAbsentModeLabel,autoGearCrewAbsentModeSelect:autoGearCrewAbsentModeSelect$1,autoGearWirelessSelect:autoGearWirelessSelect$1,autoGearWirelessLabel,autoGearWirelessModeLabel,autoGearWirelessModeSelect:autoGearWirelessModeSelect$1,autoGearMotorsSelect:autoGearMotorsSelect$1,autoGearMotorsLabel,autoGearMotorsModeLabel,autoGearMotorsModeSelect:autoGearMotorsModeSelect$1,autoGearControllersSelect:autoGearControllersSelect$1,autoGearControllersLabel,autoGearControllersModeLabel,autoGearControllersModeSelect:autoGearControllersModeSelect$1,autoGearDistanceSelect:autoGearDistanceSelect$1,autoGearDistanceLabel,autoGearDistanceModeLabel,autoGearDistanceModeSelect:autoGearDistanceModeSelect$1,autoGearConditionLabels,autoGearConditionSelects,autoGearConditionLogicLabels,autoGearConditionLogicSelects,AUTO_GEAR_CONDITION_KEYS:["always","scenarios","shootingDays","mattebox","cameraHandle","viewfinderExtension","deliveryResolution","videoDistribution","camera","ownGear","cameraWeight","monitor","tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader","crewPresent","crewAbsent","wireless","motors","controllers","distance"],AUTO_GEAR_REPEATABLE_CONDITIONS:new Set(["scenarios","mattebox","cameraHandle","viewfinderExtension","deliveryResolution","videoDistribution","camera","ownGear","monitor","tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader","crewPresent","crewAbsent","wireless","motors","controllers","distance"]),AUTO_GEAR_CONDITION_FALLBACK_LABELS:{always:"Always include",scenarios:"Required scenarios",shootingDays:"Shooting days condition",mattebox:"Mattebox options",cameraHandle:"Camera handles",viewfinderExtension:"Viewfinder extension",deliveryResolution:"Delivery resolution",videoDistribution:"Video distribution",camera:"Camera",ownGear:"Own gear items",cameraWeight:"Camera weight",monitor:"Onboard monitor",tripodHeadBrand:"Tripod head brand",tripodBowl:"Tripod bowl size",tripodTypes:"Tripod types",tripodSpreader:"Tripod spreader",crewPresent:"Crew present",crewAbsent:"Crew absent",wireless:"Wireless transmitter",motors:"FIZ motors",controllers:"FIZ controllers",distance:"FIZ distance devices"},getViewfinderFallbackLabel:h,getVideoDistributionFallbackLabel:b,refreshAutoGearShootingDaysValue:n,refreshAutoGearScenarioOptions:a,refreshAutoGearScenarioBaseSelect:u,refreshAutoGearMatteboxOptions:d,refreshAutoGearCameraHandleOptions:m,refreshAutoGearViewfinderExtensionOptions:C,refreshAutoGearDeliveryResolutionOptions:A,refreshAutoGearVideoDistributionOptions:w,collectAutoGearSelectedValues:R,getAutoGearScenarioModeSelectElement:_,setAutoGearScenarioModeSelectElement:G,normalizeVideoDistributionOptionValue:v}}scope$1&&typeof scope$1=="object"&&(scope$1.cineCoreAutoGearUi=AUTO_GEAR_UI_EXPORTS,scope$1.getViewfinderFallbackLabel=AUTO_GEAR_UI_EXPORTS.getViewfinderFallbackLabel,scope$1.getVideoDistributionFallbackLabel=AUTO_GEAR_UI_EXPORTS.getVideoDistributionFallbackLabel,scope$1.normalizeVideoDistributionOptionValue=AUTO_GEAR_UI_EXPORTS.normalizeVideoDistributionOptionValue);const cineCoreAutoGearUi$1=AUTO_GEAR_UI_EXPORTS;function escapeHtmlFallback$1(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var escapeHtml$2=escapeHtmlFallback$1;const deriveProjectInfo$1=(function e(){return typeof globalThis<"u"&&typeof globalThis.deriveProjectInfo=="function"?globalThis.deriveProjectInfo:typeof window<"u"&&typeof window.deriveProjectInfo=="function"?window.deriveProjectInfo:typeof global<"u"&&typeof global.deriveProjectInfo=="function"?global.deriveProjectInfo:function(o){return o||{}}})(),normalizeVideoDistributionOptionValueForSetups=cineCoreAutoGearUi$1&&typeof cineCoreAutoGearUi$1.normalizeVideoDistributionOptionValue=="function"?cineCoreAutoGearUi$1.normalizeVideoDistributionOptionValue:function e(t){if(typeof t!="string")return"";const o=t.trim();if(!o)return"";const r=o.toLowerCase();return r==="__none__"||r==="none"?"__none__":o},SETUPS_UI_HELPERS=cineCoreUiHelpers||{},TRANSLATIONS_RUNTIME_FOR_SETUPS=cineTranslations||{};if(TRANSLATIONS_RUNTIME_FOR_SETUPS&&typeof TRANSLATIONS_RUNTIME_FOR_SETUPS.loadLanguage=="function"){const e=typeof currentLang=="string"&&currentLang||typeof DEFAULT_LANGUAGE_SAFE=="string"&&DEFAULT_LANGUAGE_SAFE||TRANSLATIONS_RUNTIME_FOR_SETUPS.defaultLanguage||"en";try{const t=TRANSLATIONS_RUNTIME_FOR_SETUPS.loadLanguage(e);t&&typeof t.then=="function"&&t.catch(o=>{console.warn("Failed to prepare translations for setups module",o)})}catch(t){console.warn("Could not prepare translations runtime for setups module",t)}}escapeHtml$2=typeof SETUPS_UI_HELPERS.escapeHtml=="function"?SETUPS_UI_HELPERS.escapeHtml:escapeHtmlFallback$1;const setButtonLabelWithIconForSetups=(function e(){if(typeof SETUPS_UI_HELPERS.setButtonLabelWithIcon=="function")return SETUPS_UI_HELPERS.setButtonLabelWithIcon;const t=[];try{typeof CORE_GLOBAL_SCOPE=="object"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE.setButtonLabelWithIcon=="function"&&t.push(CORE_GLOBAL_SCOPE.setButtonLabelWithIcon)}catch{}return typeof globalThis<"u"&&globalThis&&typeof globalThis.setButtonLabelWithIcon=="function"&&t.push(globalThis.setButtonLabelWithIcon),typeof window<"u"&&window&&typeof window.setButtonLabelWithIcon=="function"&&t.push(window.setButtonLabelWithIcon),typeof self<"u"&&self&&typeof self.setButtonLabelWithIcon=="function"&&t.push(self.setButtonLabelWithIcon),typeof global<"u"&&global&&typeof global.setButtonLabelWithIcon=="function"&&t.push(global.setButtonLabelWithIcon),t.length>0?t[0]:function(r,n){if(r)try{r.textContent=typeof n=="string"?n:""}catch{}}})(),AUTO_GEAR_ANY_MOTOR_TOKEN_FALLBACK=typeof globalThis<"u"&&globalThis.AUTO_GEAR_ANY_MOTOR_TOKEN?globalThis.AUTO_GEAR_ANY_MOTOR_TOKEN:"__any__";function resolveSetupRuntimeFunction(e){const t=[],o=r=>{!r||typeof r!="object"&&typeof r!="function"||t.includes(r)||t.push(r)};try{o(typeof CORE_GLOBAL_SCOPE<"u"?CORE_GLOBAL_SCOPE:null)}catch{}try{o(typeof globalThis<"u"?globalThis:null)}catch{}try{o(typeof window<"u"?window:null)}catch{}try{o(typeof self<"u"?self:null)}catch{}try{o(typeof global<"u"?global:null)}catch{}for(let r=0;r<t.length;r+=1){const n=t[r];try{const a=n[e];if(typeof a=="function")return a}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to resolve runtime function from scope",e,a)}}return null}function safeGetCurrentProjectName$1(e=""){const t=resolveSetupRuntimeFunction("getCurrentProjectName");if(typeof t!="function")return e;try{const o=t();return typeof o=="string"&&o.trim()?o:e}catch(o){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("safeGetCurrentProjectName failed, falling back to default",o),e}}const CAMERA_LINK_LETTERS=["A","B","C","D","E"],CAMERA_COLOR_STORAGE_KEY="cameraPowerPlanner_cameraColors",CAMERA_LINKED_SUPPORT_ITEM_BASE_NAMES=["ARRI K2.0019797 HEX-3","ARRI K2.0023751 B-Mount Battery Adapter","ARRI K2.74000.0 VEB-3 Viewfinder Extension Bracket","ARRI KK.0037820 Handle Extension Set",'SHAPE Telescopic Handle ARRI Rosette Kit 12"'];let cameraLinkedSupportItemKeysCache=null;function getCameraLinkedSupportItemKeys(){return cameraLinkedSupportItemKeysCache instanceof Set&&cameraLinkedSupportItemKeysCache.size?cameraLinkedSupportItemKeysCache:typeof normalizeGearNameForComparison!="function"?new Set:(cameraLinkedSupportItemKeysCache=new Set(CAMERA_LINKED_SUPPORT_ITEM_BASE_NAMES.map(e=>normalizeGearNameForComparison(e))),cameraLinkedSupportItemKeysCache)}function resolveCameraLinkedSupportName(e){if(!e||typeof normalizeGearNameForComparison!="function")return"";const t=addArriKNumber$1(e),o=normalizeGearNameForComparison(t);return getCameraLinkedSupportItemKeys().has(o)?t:""}const PRODUCTION_COMPANY_FIELD_ORDER=["productionCompanyAddress","productionCompanyStreet","productionCompanyStreet2","productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"],LEGACY_PROJECT_FIELD_LABELS={productionCompany:["Production Company","Produktionsfirma","Société de production","Productora","Casa di produzione"],productionCompanyAddress:["Production Company Address","Adresse der Produktionsfirma","Adresse de la société de production","Dirección de la productora","Indirizzo della casa di produzione"],productionCompanyStreet:["Street address","Straße und Hausnummer","Adresse","Dirección","Indirizzo"],productionCompanyStreet2:["Address line 2","Adresszusatz","Complément d'adresse","Línea 2 de dirección","Seconda linea indirizzo"],productionCompanyCity:["City","Stadt","Ville","Ciudad","Città"],productionCompanyRegion:["State / Province / Region","Bundesland / Region","État / Région / Département","Estado / Provincia / Región","Regione / Provincia / Stato"],productionCompanyPostalCode:["Postal code","Postleitzahl","Code postal","Código postal","CAP"],productionCompanyCountry:["Country","Land","Pays","País","Paese"]};function normalizeProjectFieldLabel(e){return typeof e!="string"?"":e.trim().replace(/[:：]\s*$/,"").trim()}function getProductionCompanyLabelSets(e){const t=typeof texts<"u"?texts:null,o={},r=t&&t.en&&t.en.projectFields||{};return["productionCompany"].concat(PRODUCTION_COMPANY_FIELD_ORDER).forEach(a=>{const s=new Set,l=d=>{if(typeof d!="string")return;const m=normalizeProjectFieldLabel(d);m&&s.add(m)};e&&e[a]&&l(e[a]),r&&r[a]&&l(r[a]);const u=LEGACY_PROJECT_FIELD_LABELS[a];Array.isArray(u)&&u.forEach(l),o[a]=s}),o}function getProjectInfoFieldLines(e,t){if(!e||typeof e!="object")return[];const o=e[t];if(o==null)return[];if(Array.isArray(o)){const r=[];return o.forEach(n=>{if(n==null)return;(typeof n=="string"?n:String(n)).split(/\r?\n/).forEach(s=>{const l=s.trim();l&&r.push(l)})}),r}return typeof o=="string"?o.split(/\r?\n/).map(r=>r.trim()).filter(r=>r):[String(o)].map(r=>r.trim()).filter(r=>r)}function buildCombinedProductionCompanyDisplay(e,t){const o=[],r=[],n=getProductionCompanyLabelSets(t),a=new Set;Object.values(n).forEach(h=>{h&&h.forEach(b=>{typeof b=="string"&&b&&a.add(b)})});const s=h=>typeof h!="string"||!h.trim()?!1:a.has(normalizeProjectFieldLabel(h)),l=(h,b,v)=>{if(typeof h!="string")return;const C=h.trim();if(!C)return;const A=escapeHtml$2(C),w=Array.isArray(v)?v.filter(_=>typeof _=="string"&&_.trim()):[],R=w.length?` data-fields="${escapeHtml$2(w.join(" "))}"`:"";o.push(b?`<span class="${b}"${R}>${A}</span>`:A),r.push(C)};typeof texts<"u"&&texts;const u={entries:[],indexMap:new Map},d=(h,b)=>{if(typeof h!="string")return;const v=h.trim();if(!v||s(v))return;const C=v.toLowerCase();let A=u.indexMap.get(C);A||(A={value:v,fields:[]},u.entries.push(A),u.indexMap.set(C,A)),typeof b=="string"&&PRODUCTION_COMPANY_FIELD_ORDER.includes(b)&&!A.fields.includes(b)&&A.fields.push(b)};getProjectInfoFieldLines(e,"productionCompany").forEach(h=>l(h,"req-primary-line")),PRODUCTION_COMPANY_FIELD_ORDER.forEach(h=>{const b=getProjectInfoFieldLines(e,h);b.length&&b.forEach(v=>d(v,h))});const{entries:y}=u;if(y.length){const h=new Set(["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode"]),b={productionCompanyCity:[],productionCompanyRegion:[],productionCompanyPostalCode:[]},v=[];let C=null;y.forEach(V=>{const{value:M,fields:F}=V;(Array.isArray(F)?F.some(x=>h.has(x)):!1)?(C===null&&(C=v.length),F.forEach(x=>{h.has(x)&&b[x].push(M)})):v.push(V)});const A=V=>{if(!Array.isArray(V))return"";const M=V.find(F=>typeof F=="string"&&F.trim());return M?M.trim():""},w=A(b.productionCompanyCity),R=A(b.productionCompanyRegion),_=A(b.productionCompanyPostalCode),G=[],O=[];w&&(G.push(w),O.push("productionCompanyCity"));const B=[];if(R&&(B.push(R),O.push("productionCompanyRegion")),_&&(B.push(_),O.push("productionCompanyPostalCode")),B.length){const V=B.join(", ");G.push(V)}const $=G.join(", ").trim();if($){const V=$.toLowerCase();if(!v.some(F=>{const z=typeof F.value=="string"?F.value.trim():"";return z&&z.toLowerCase()===V})){const F=C===null?v.length:C;v.splice(F,0,{value:$,fields:O})}}v.forEach(V=>{const{value:M,fields:F}=V;l(M,"req-sub-line",F)})}return o.length?{__html:o.join("<br>"),text:r.join(`
`)}:null}function applyCombinedProductionCompanyDisplay(e,t,o){if(!e||typeof e!="object")return!1;const n=buildCombinedProductionCompanyDisplay(t&&typeof t=="object"?t:e,o);return n?(e.productionCompany=n,PRODUCTION_COMPANY_FIELD_ORDER.forEach(a=>{Object.prototype.hasOwnProperty.call(e,a)&&delete e[a]}),!0):!1}function expandCombinedProductionCompanyInfo(e,t,o){if(typeof e!="string")return null;const r=e.replace(/\r\n?/g,`
`).split(`
`).map(y=>y.trim()).filter(y=>y);if(!r.length)return null;const n=getProductionCompanyLabelSets(t),a={},[s,...l]=r;s&&(a.productionCompany=s);const u=Array.isArray(o?.lines)?o.lines:null;if(u&&u.length){const y={};if(u.forEach(h=>{if(!h||typeof h.text!="string")return;const b=h.text.trim();if(!b)return;let v=h.fields;typeof v=="string"&&(v=v.split(/\s+/)),!(!Array.isArray(v)||!v.length)&&v.map(C=>typeof C=="string"?C.trim():"").filter(C=>C&&PRODUCTION_COMPANY_FIELD_ORDER.includes(C)).forEach(C=>{y[C]||(y[C]=[]),y[C].push(b)})}),Object.keys(y).length){if(y.productionCompanyAddress&&y.productionCompanyAddress.length&&(a.productionCompanyAddress=y.productionCompanyAddress.join(`
`)),y.productionCompanyStreet&&y.productionCompanyStreet.length){const b=y.productionCompanyStreet;if([a.productionCompanyStreet]=b,b.length>1){const v=b.slice(1).join(`
`);v&&(a.productionCompanyStreet2=v)}}if(y.productionCompanyStreet2&&y.productionCompanyStreet2.length){const b=y.productionCompanyStreet2.join(`
`);b&&(a.productionCompanyStreet2=a.productionCompanyStreet2?`${a.productionCompanyStreet2}
${b}`:b)}const h=b=>{if(!y[b]||!y[b].length)return;const v=y[b].join(" ");v&&(a[b]=v)};return["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"].forEach(h),a}}const d={};let m=null;if(l.forEach(y=>{const h=normalizeProjectFieldLabel(y);let b=null;if(PRODUCTION_COMPANY_FIELD_ORDER.forEach(v=>{b||!n[v]||n[v].has(h)&&(b=v)}),b){m=b,d[m]||(d[m]=[]);return}if(!m){a.productionCompany?a.productionCompany+=`
${y}`:a.productionCompany=y;return}d[m]||(d[m]=[]),d[m].push(y)}),d.productionCompanyAddress&&d.productionCompanyAddress.length&&(a.productionCompanyAddress=d.productionCompanyAddress.join(`
`)),d.productionCompanyStreet&&d.productionCompanyStreet.length){const y=d.productionCompanyStreet;a.productionCompanyStreet=y[0],y.length>1&&(a.productionCompanyStreet2=y.slice(1).join(`
`))}return d.productionCompanyCity&&d.productionCompanyCity.length&&(a.productionCompanyCity=d.productionCompanyCity.join(" ")),d.productionCompanyRegion&&d.productionCompanyRegion.length&&(a.productionCompanyRegion=d.productionCompanyRegion.join(" ")),d.productionCompanyPostalCode&&d.productionCompanyPostalCode.length&&(a.productionCompanyPostalCode=d.productionCompanyPostalCode.join(" ")),d.productionCompanyCountry&&d.productionCompanyCountry.length&&(a.productionCompanyCountry=d.productionCompanyCountry.join(" ")),a}const EXTRA_GEAR_CATEGORY_KEY="temporary-extras",PROJECT_FORM_FREEZE=typeof Object.freeze=="function"?Object.freeze:e=>e;let projectFormDataCache=null,projectFormDataCacheDirty=!0;function lensEscapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function lensStripPrefix(e,t){if(!e||!t)return e;const o=new RegExp(`^${lensEscapeRegExp(t)}\\s+`,"i");return e.replace(o,"").trim()}function lensIsSpecToken(e){if(!e)return!1;const t=e.trim();return t?!!(/^T\d+/i.test(t)||/^f\//i.test(t)||/\d/.test(t)&&(/(?:mm|cm|m|°|ft)$/i.test(t)||/^\d+(?:\.\d+)?x$/i.test(t)||/^\d+-\d+/.test(t))):!1}function resolveLensManufacturer(e,t){return e&&typeof e.brand=="string"&&e.brand.trim()?e.brand.trim():(typeof t=="string"?t.trim().split(/\s+/)[0]:"")||"Other"}function resolveLensSeries(e,t){if(typeof e!="string"||!e.trim())return"General";let o=e.trim();if(t&&o.toLowerCase().startsWith(t.toLowerCase())&&(o=o.slice(t.length).trim()),!o)return"General";const r=o.split(/\s+/),n=[];for(let s=0;s<r.length;s+=1){const l=r[s];if(lensIsSpecToken(l))break;n.push(l)}return n.join(" ").trim()||"General"}function resolveLensFocalLabel(e,t,o){const r=lensStripPrefix(e||"",t||"");return lensStripPrefix(r,o||"").trim()}function computeLensFocalSortKeyFromTexts(...e){for(let t=0;t<e.length;t+=1){const o=e[t];if(typeof o!="string")continue;const n=o.toLowerCase().indexOf("mm"),s=(n===-1?o:o.slice(0,n)).match(/\d+(?:\.\d+)?/g);if(s&&s.length){const l=s.map(u=>Number(u)).filter(Number.isFinite);if(l.length)return Math.min(...l)}}return Number.POSITIVE_INFINITY}function buildLensSortMeta(e,t){const o=resolveLensManufacturer(t,e),r=resolveLensSeries(e,o),n=resolveLensFocalLabel(e,o,r),a=computeLensFocalSortKeyFromTexts(n,e);return{manufacturer:o,series:r,focalLabel:n,focalSortKey:a}}function compareStringsCaseInsensitive(e,t){const o=typeof e=="string"?e:"",r=typeof t=="string"?t:"";return typeof localeSort=="function"?localeSort(o,r):o.localeCompare(r,void 0,{sensitivity:"base"})}const lensSelectionManager$1=(()=>{const e=typeof document<"u"?document:null,t={snapshot(){return{names:[],lensSelections:[],legacyValue:""}},applyInfo(){},refreshCatalog(){},getSelections(){return[]}};if(!e)return t;const o=e.getElementById("lensManufacturer"),r=e.getElementById("lensSeries"),n=e.getElementById("lensManufacturerStep"),a=e.getElementById("lensSeriesStep"),s=e.getElementById("lensOptionsStep"),l=e.getElementById("lensOptions"),u=e.getElementById("lensOptionsEmpty"),d=e.getElementById("lensSeriesEmpty"),m=e.getElementById("lensSelectionChips"),y=e.getElementById("lensSelectionsValue"),h=e.getElementById("lensSelectionsData"),b=e.getElementById("lenses"),v=e.getElementById("lensManufacturerPlaceholder"),C=e.getElementById("lensSeriesPlaceholder");if(!o||!r||!l||!m||!y||!h||!b)return t;const A="data-remove-template",w="data-mount-label",R="lens-step-disabled",_=new Set(["LDS"]),G=new Map([["B4","B4"],["DJI DL","DJI DL"],["DJI DL-S","DJI DL-S"],["DL","DJI DL"],["E","E-mount"],["E-mount","E-mount"],["Sony E","E-mount"],["EF","EF"],["F","F"],["Hasselblad","Hasselblad"],["L","L-Mount"],["L-Mount","L-Mount"],["Leica L","L-Mount"],["Leica M","Leica M"],["Leitz M Mount for ARRI","Leica M"],["M","Leica M"],["MFT","MFT"],["PL","PL"],["PV","PV"],["PV70","PV70"],["RF","RF"],["X","X-mount"],["X-mount","X-mount"],["XPL52","XPL52"],["Z","Z-mount"],["Z-mount","Z-mount"]]),O=typeof localeSort=="function"?localeSort:void 0,B={manufacturer:"",series:"",selections:[]};let $={manufacturers:new Map,lensIndex:new Map};const V=new Map,M=ge=>{const ue=$.lensIndex.get(ge);if(!ue||typeof ue!="object")return[];const We=new Map,Me=[],Te=(je,mt="native")=>{const ct=typeof je=="string"?je.trim():"";if(!ct)return;const $t=typeof mt=="string"&&mt.trim().toLowerCase()==="adapted"?"adapted":"native";if(We.has(ct)){const no=We.get(ct);no&&no.status!=="native"&&$t==="native"&&(no.status="native");return}const fo={type:ct,status:$t};We.set(ct,fo),Me.push(ct)},Be=(je,mt="native")=>{if(!je)return;const ct=x(je);if(Array.isArray(ct)&&ct.length){ct.forEach($t=>Te($t,mt));return}Te(je,mt)},Ve=ue?.data?.mountOptions;return Array.isArray(Ve)&&Ve.length&&Ve.forEach(je=>{if(!je)return;const mt=typeof je.mount=="string"&&je.mount.trim().toLowerCase()==="adapted"?"adapted":"native";Be(je.type,mt)}),!Me.length&&Array.isArray(ue.mountLabels)&&ue.mountLabels.length&&ue.mountLabels.forEach(je=>Te(je,"native")),Me.length||Be(ue?.data?.mount,"native"),Me.map(je=>We.get(je)).filter(je=>je&&je.type)},F=ge=>M(ge).map(ue=>ue.type),z=(ge,ue)=>{ge&&(ue?ge.classList.add("select-placeholder"):ge.classList.remove("select-placeholder"))},x=ge=>{const ue=[],We=new Set,Me=Be=>{!Be||We.has(Be)||(We.add(Be),ue.push(Be))},Te=Be=>{if(!Be||typeof Be!="string")return;Be.replace(/\([^)]*\)/g," ").replace(/ or /gi,"/").replace(/\\/g,"/").split("/").forEach(je=>{je.split(",").forEach(mt=>{const ct=mt.trim();if(!ct||_.has(ct))return;const $t=G.has(ct)?G.get(ct):ct;$t&&Me($t)})})};return Array.isArray(ge)?ge.forEach(Be=>Te(Be)):Te(ge),ue},H=()=>{const ge=typeof devices=="object"&&devices&&devices.lenses&&Object.keys(devices.lenses).length?devices.lenses:null;return ge||(typeof devices=="object"&&devices&&devices.accessories&&devices.accessories.lenses?devices.accessories.lenses:{})},W=()=>{const ge=H(),ue=new Map,We=new Map,Me=Object.keys(ge||{});return Me.length&&O?Me.sort(O):Me.sort(),Me.forEach(Te=>{const Be=ge[Te]||{},Ve=buildLensSortMeta(Te,Be),{manufacturer:je,series:mt,focalLabel:ct,focalSortKey:$t}=Ve,fo=x(Be.mount),no={name:Te,data:Be,manufacturer:je,series:mt,displayName:Te,focalLabel:ct,focalSortKey:$t,mountLabels:fo,optionMeta:fo[0]?`Mount: ${fo[0]}`:""};ue.has(je)||ue.set(je,new Map);const Nt=ue.get(je);Nt.has(mt)||Nt.set(mt,[]),Nt.get(mt).push(no),We.set(Te,no)}),ue.forEach(Te=>{Te.forEach(Be=>{!Array.isArray(Be)||!Be.length||Be.sort((Ve,je)=>{const mt=Number.isFinite(Ve.focalSortKey),ct=Number.isFinite(je.focalSortKey);return mt&&ct&&Ve.focalSortKey!==je.focalSortKey?Ve.focalSortKey-je.focalSortKey:mt!==ct?mt?-1:1:Ve.focalLabel&&je.focalLabel&&Ve.focalLabel!==je.focalLabel?compareStringsCaseInsensitive(Ve.focalLabel,je.focalLabel):compareStringsCaseInsensitive(Ve.displayName,je.displayName)})})}),{manufacturers:ue,lensIndex:We}},U=ge=>!ge||typeof ge.type!="string"?"":x(ge.type)[0]||"",j=()=>{const ge=e.getElementById("cameraSelect"),ue=ge&&typeof ge.value=="string"?ge.value:"";if(!ue||typeof devices!="object"||!devices||!devices.cameras)return[];const We=devices.cameras[ue];if(!We||!Array.isArray(We.lensMount))return[];const Me=new Map,Te=[];return We.lensMount.forEach(Be=>{if(!Be)return;const Ve=U(Be);if(!Ve)return;const je=typeof Be.mount=="string"&&Be.mount.trim().toLowerCase()==="adapted"?"adapted":"native";if(Me.has(Ve)){const ct=Me.get(Ve);ct&&ct.status!=="native"&&je==="native"&&(ct.status="native");return}const mt={type:Ve,status:je};Me.set(Ve,mt),Te.push(Ve)}),Te.map(Be=>Me.get(Be)).filter(Be=>Be&&Be.type)},Y=(ge,ue)=>{const We=[],Me=new Set,Te=mt=>{if(!mt)return;const ct=mt.trim();!ct||Me.has(ct)||(Me.add(ct),We.push(ct))};F(ue).forEach(Te);const Ve=typeof ge=="string"?ge.trim():"",je=Ve&&Me.has(Ve);return{options:We,hiddenValue:je?"":Ve}},le=(ge,ue="")=>{const We=M(ge),Me=We.map(ct=>ct.type),Te=j(),Be=ct=>{if(!ct)return"";const $t=Te.find(no=>no.type===ct&&no.status==="native")||Te.find(no=>no.type===ct);if($t)return $t.status;const fo=We.find(no=>no.type===ct);return fo?fo.status:""},Ve=typeof ue=="string"?ue.trim():"";if(Ve&&Me.includes(Ve))return{mount:Ve,status:Be(Ve)};const je=Te.find(ct=>ct.status==="native"&&Me.includes(ct.type));if(je)return{mount:je.type,status:Be(je.type)};const mt=Te.find(ct=>ct.status==="adapted"&&Me.includes(ct.type));if(mt)return{mount:mt.type,status:Be(mt.type)};if(We.length){const ct=We[0].type,$t=Be(ct),fo=Te.length>0,no=Te.some(xo=>xo.type===ct);let Nt=$t;return(!no&&fo||!Nt&&fo)&&(Nt="adapted"),{mount:ct,status:Nt}}return{mount:"",status:""}},be=ge=>typeof ge!="string"?"":ge.trim(),re=()=>{const ge=!!B.manufacturer,ue=!!B.series;n&&n.classList.toggle(R,!1),a&&(a.classList.toggle(R,!ge),a.setAttribute("aria-disabled",ge?"false":"true")),s&&(s.classList.toggle(R,!ue),s.setAttribute("aria-disabled",ue?"false":"true")),r.disabled=!ge,z(r,!B.series),z(o,!B.manufacturer)},de=()=>{const ge=new Set(B.selections.map(ue=>ue.name));Array.from(b.options||[]).forEach(ue=>{!ue||typeof ue.value!="string"||(ue.selected=ge.has(ue.value))})},ne=({skipEvent:ge=!1,skipDirty:ue=!1}={})=>{const Me=B.selections.map(je=>je.name).join(", "),Te=JSON.stringify(B.selections.map(je=>{const mt={name:je.name,mount:je.mount||""};return je.mountState&&(mt.mountState=je.mountState),mt})),Be=y.value!==Me,Ve=h.value!==Te;if(Be&&(y.value=Me),Ve&&(h.value=Te),!ge&&(Be||Ve))try{y.dispatchEvent(new Event("change",{bubbles:!0})),h.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}if(!ue&&(Be||Ve))try{markProjectFormDataDirty$1()}catch{}de()},Ce=({skipEvent:ge=!1,skipDirty:ue=!1}={})=>{if(m.innerHTML="",!B.selections.length){ne({skipEvent:ge,skipDirty:ue});return}const We=m.getAttribute(A)||"",Me=m.getAttribute(w)||"Mount";B.selections.forEach((Te,Be)=>{const Ve=$.lensIndex.get(Te.name),je=Ve?Ve.displayName:Te.name,mt=Ve&&Ve.focalLabel?Ve.focalLabel:"",ct=e.createElement("div");ct.className="lens-chip",ct.setAttribute("role","listitem");const $t=e.createElement("div");$t.className="lens-chip-label";const fo=e.createElement("span");if(fo.className="lens-chip-name",fo.textContent=je,$t.appendChild(fo),mt){const pt=e.createElement("span");pt.className="lens-chip-focal",pt.textContent=mt,$t.appendChild(pt)}ct.appendChild($t);const no=`lensMount-${Be}`,Nt=e.createElement("div"),xo=e.createElement("label");xo.className="visually-hidden",xo.setAttribute("for",no),xo.textContent=`${Me}: ${je}`,Nt.appendChild(xo);const Io=e.createElement("select");Io.id=no,Io.dataset.lensName=Te.name;const qo=typeof Te.mount=="string"?Te.mount.trim():"",eo=le(Te.name,qo);Te.mount!==eo.mount&&(Te.mount=eo.mount),eo.status?Te.mountState=eo.status:Te.mountState&&delete Te.mountState;const{options:To,hiddenValue:ko}=Y(qo,Te.name);if(To.forEach(pt=>{const mo=e.createElement("option");mo.value=pt;const So=le(Te.name,pt).status;mo.textContent=So==="adapted"?`${pt} (adapted)`:pt,So&&(mo.dataset.mountState=So),Te.mount===pt&&(mo.selected=!0),Io.appendChild(mo)}),ko){const pt=e.createElement("option");pt.value=ko,pt.textContent=ko,pt.hidden=!0,pt.disabled=!0,Io.appendChild(pt)}if(Te.mount&&(Io.value=Te.mount),!Te.mount&&To.length){Io.value=To[0],Te.mount=Io.value;const pt=le(Te.name,Te.mount);pt.status?Te.mountState=pt.status:Te.mountState&&delete Te.mountState}Io.setAttribute("aria-label",`${Me}: ${je}`),Io.addEventListener("change",pt=>{const mo=pt.target.dataset.lensName,go=typeof pt.target.value=="string"?pt.target.value:"",So=B.selections.find(Se=>Se.name===mo);if(!So)return;const k=le(mo,go),Q=k.mount,X=k.status,ae=So.mountState||"",Ae=(X||"")!==ae;So.mount===Q&&!Ae||(So.mount=Q,X?So.mountState=X:So.mountState&&delete So.mountState,pt.target.value!==Q&&(pt.target.value=Q||""),ne())}),Nt.appendChild(Io),ct.appendChild(Nt);const Jt=e.createElement("button");Jt.type="button",Jt.className="lens-chip-remove",Jt.dataset.lensName=Te.name;const lr=We.includes("{lens}")?We.replace("{lens}",je):We||je;Jt.setAttribute("aria-label",lr),Jt.setAttribute("title",lr),typeof iconMarkup=="function"&&typeof ICON_GLYPHS=="object"&&ICON_GLYPHS&&ICON_GLYPHS.circleX?Jt.innerHTML=iconMarkup(ICON_GLYPHS.circleX,"btn-icon"):Jt.textContent="×",Jt.addEventListener("click",()=>{rt(Te.name,{focus:!0})}),ct.appendChild(Jt),m.appendChild(ct)}),ne({skipEvent:ge,skipDirty:ue})},Ee=()=>{if(l.innerHTML="",V.clear(),!B.series){u&&(u.hidden=!0);return}const ge=$.manufacturers.get(B.manufacturer),ue=ge?ge.get(B.series):null;if(!ue||!ue.length){u&&(u.hidden=!1);return}u&&(u.hidden=!0);const We=e.createElement("div");We.className="lens-options-header";const Me=e.createElement("span");Me.textContent=`${ue.length} items`,We.appendChild(Me);const Te=e.createElement("label");Te.className="lens-set-toggle";const Be=e.createElement("input");Be.type="checkbox";const Ve=ue.filter(ct=>B.selections.some($t=>$t.name===ct.name)).length,je=ue.length>0&&Ve===ue.length,mt=Ve>0&&!je;Be.checked=je,Be.indeterminate=mt,Be.addEventListener("change",ct=>{Pe(ue,ct.target.checked)}),Te.appendChild(Be),Te.appendChild(e.createTextNode("Select Full Set")),We.appendChild(Te),l.appendChild(We),ue.forEach((ct,$t)=>{const fo=e.createElement("div");fo.className="lens-option";const no=`lensOption-${$t}`,Nt=e.createElement("input");Nt.type="checkbox",Nt.id=no,Nt.dataset.lensName=ct.name,Nt.checked=B.selections.some(qo=>qo.name===ct.name),Nt.addEventListener("change",qo=>{const eo=!!qo.target.checked;it(ct.name,eo)}),fo.appendChild(Nt);const xo=e.createElement("label");xo.className="lens-option-label",xo.setAttribute("for",no);const Io=e.createElement("span");if(Io.className="lens-option-name",Io.textContent=ct.displayName,xo.appendChild(Io),ct.optionMeta){const qo=e.createElement("span");qo.className="lens-option-meta",qo.textContent=ct.optionMeta,xo.appendChild(qo)}fo.appendChild(xo),l.appendChild(fo),V.set(ct.name,Nt)})},Pe=(ge,ue)=>{if(!Array.isArray(ge)||!ge.length)return;let We=!1;const Me=new Set(ge.map(Te=>Te.name));if(ue)ge.forEach(Te=>{if(!B.selections.some(Be=>Be.name===Te.name)){const Be=le(Te.name),Ve={name:Te.name,mount:Be.mount};Be.status&&(Ve.mountState=Be.status),B.selections.push(Ve),We=!0}});else{const Te=B.selections.length;B.selections=B.selections.filter(Be=>!Me.has(Be.name)),B.selections.length!==Te&&(We=!0)}We&&(Ce(),Ee())},et=()=>{r.innerHTML="",r.appendChild(C);const ge=B.manufacturer?$.manufacturers.get(B.manufacturer):null;if(!ge||ge.size===0){B.series="",d&&(d.hidden=!B.manufacturer),u&&(u.hidden=!0),C.selected=!0,re();return}const ue=Array.from(ge.keys());if(!ue.length){B.series="",d&&(d.hidden=!1),u&&(u.hidden=!0),C.selected=!0,re();return}d&&(d.hidden=!0),O?ue.sort(O):ue.sort(),ue.forEach(We=>{const Me=e.createElement("option");Me.value=We,Me.textContent=We,B.series===We&&(Me.selected=!0),r.appendChild(Me)}),ge.has(B.series)?r.value=B.series:(B.series="",C.selected=!0),re()},Je=()=>{o.innerHTML="",o.appendChild(v);const ge=Array.from($.manufacturers.keys());ge.length&&(O?ge.sort(O):ge.sort(),ge.forEach(ue=>{const We=e.createElement("option");We.value=ue,We.textContent=ue,B.manufacturer===ue&&(We.selected=!0),o.appendChild(We)})),$.manufacturers.has(B.manufacturer)?o.value=B.manufacturer:(B.manufacturer="",v.selected=!0),re()},it=(ge,ue)=>{if(ue){if(B.selections.some(Te=>Te.name===ge))return;const We=le(ge),Me={name:ge,mount:We.mount};We.status&&(Me.mountState=We.status),B.selections.push(Me),Ce()}else rt(ge)},rt=(ge,{focus:ue=!1,skipEvent:We=!1,skipDirty:Me=!1}={})=>{const Te=B.selections.findIndex(Ve=>Ve.name===ge);if(Te===-1)return;B.selections.splice(Te,1);const Be=V.get(ge);Be&&(Be.checked=!1,ue&&Be.focus()),Ce({skipEvent:We,skipDirty:Me})},Pt=()=>{const ge=be(o.value);ge!==B.manufacturer&&(B.manufacturer=ge,B.series="",Je(),et(),Ee())},vt=()=>{const ge=be(r.value);ge!==B.series&&(B.series=ge,et(),Ee())},bo=(ge={})=>{$=W();const ue=new Set($.lensIndex.keys()),We=[],Me=new Set;if(Array.isArray(ge.lensSelections)&&ge.lensSelections.forEach(Te=>{if(!Te||typeof Te!="object")return;const Be=be(Te.name);if(!Be||Me.has(Be)||!ue.has(Be))return;const Ve=typeof Te.mount=="string"?Te.mount.trim():"",je=typeof Te.mountState=="string"?Te.mountState.trim():"";We.push({name:Be,mount:Ve,mountState:je}),Me.add(Be)}),We.length||normalizeLensSelectionNames(ge.lenses).forEach(Te=>{const Be=be(Te);!Be||Me.has(Be)||!ue.has(Be)||(We.push({name:Be,mount:""}),Me.add(Be))}),B.selections=We.map(Te=>{const Be=typeof Te.mount=="string"?Te.mount.trim():"",Ve=le(Te.name,Be),je={name:Te.name,mount:Ve.mount},mt=Ve.status||(typeof Te.mountState=="string"?Te.mountState.trim():"");return mt&&(je.mountState=mt),je}),B.selections.length){const Te=$.lensIndex.get(B.selections[0].name);B.manufacturer=Te?Te.manufacturer:"",B.series=Te?Te.series:""}else B.manufacturer="",B.series="";Je(),et(),Ee(),Ce({skipEvent:!0,skipDirty:!0})},Et=()=>({names:B.selections.map(ge=>ge.name),lensSelections:B.selections.map(ge=>({name:ge.name,mount:ge.mount||"",...ge.mountState?{mountState:ge.mountState}:{}})),legacyValue:B.selections.map(ge=>ge.name).join(", ")}),Ut=({preserveSelections:ge=!0,skipEvent:ue=!1,skipDirty:We=!1}={})=>{const Me=ge?B.selections.map(je=>({...je})):[],Te=ge?B.manufacturer:"",Be=ge?B.series:"";$=W();const Ve=new Set($.lensIndex.keys());if(B.selections=ge?Me.filter(je=>Ve.has(je.name)):[],B.manufacturer=ge&&$.manufacturers.has(Te)?Te:"",B.manufacturer){const je=$.manufacturers.get(B.manufacturer);B.series=je&&je.has(Be)?Be:""}else B.series="";Je(),et(),Ee(),Ce({skipEvent:ue||ge,skipDirty:We||ge})};return o.addEventListener("change",Pt),r.addEventListener("change",vt),$=W(),Je(),et(),Ee(),Ce({skipEvent:!0,skipDirty:!0}),{snapshot:Et,applyInfo:bo,refreshCatalog:Ut,getSelections(){return B.selections.map(ge=>({...ge}))}}})();typeof globalThis<"u"&&globalThis&&(typeof globalThis.updateLensWorkflowCatalog!="function"&&(globalThis.updateLensWorkflowCatalog=function(t){try{lensSelectionManager$1.refreshCatalog(t||{preserveSelections:!0,skipEvent:!0,skipDirty:!0})}catch{}}),globalThis.lensSelectionManager||(globalThis.lensSelectionManager=lensSelectionManager$1));function normalizeLensSelectionNames(e){return Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim()).filter(Boolean):[]}function markProjectFormDataDirty$1(){projectFormDataCacheDirty=!0,projectFormDataCache=null}const localGetLocalizedText=(()=>{function e(o){if(!o)return"";const r=getGlobalScope$1(),n=r&&typeof r.texts=="object"&&r.texts||typeof texts=="object"&&texts||null;if(!n)return"";const a=r&&typeof r.currentLang=="string"&&typeof n[r.currentLang]=="object"?r.currentLang:null,s=typeof currentLang=="string"&&typeof n[currentLang]=="object"?currentLang:null,l=a||s||"en",u=typeof n[l]=="object"&&n[l]||{},d=Object.prototype.hasOwnProperty.call(u,o)?u[o]:void 0;if(typeof d=="string")return d;const m=typeof n.en=="object"&&n.en||{},y=Object.prototype.hasOwnProperty.call(m,o)?m[o]:void 0;return typeof y=="string"?y:""}let t=!1;return function o(r){const n=getGlobalScope$1(),a=n&&typeof n.getLocalizedText=="function"&&n.getLocalizedText!==o?n.getLocalizedText:null;if(a)try{const s=a(r);if(typeof s=="string")return s}catch(s){!t&&typeof console<"u"&&typeof console.warn=="function"&&(console.warn("getLocalizedText fallback used after global failure",s),t=!0)}return e(r)}})(),localizationScope=getGlobalScope$1();localizationScope&&typeof localizationScope.getLocalizedText!="function"&&(localizationScope.getLocalizedText=localGetLocalizedText);const RENTAL_HOUSE_DATALIST_ID="rentalHouseOptions";function resolveRentalHouseCatalog(){const e=[];if(typeof require=="function")try{const o=require("../data/rental-houses.js");Array.isArray(o)&&o.length?e.push(o):o&&Array.isArray(o.rentalHouses)&&o.rentalHouses.length?e.push(o.rentalHouses):o&&Array.isArray(o.default)&&o.default.length&&e.push(o.default)}catch(o){const r=o&&o.message?o.message:"";if(o&&o.code!=="MODULE_NOT_FOUND"&&!/Cannot find module/i.test(r))try{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to load rental house catalog module",o)}catch{}}const t=getGlobalScope$1();if(t){const o=t.devices;o&&Array.isArray(o.rentalHouses)&&o.rentalHouses.length&&e.push(o.rentalHouses),Array.isArray(t.rentalHouses)&&t.rentalHouses.length&&e.push(t.rentalHouses)}typeof devices<"u"&&devices&&Array.isArray(devices.rentalHouses)&&devices.rentalHouses.length&&e.push(devices.rentalHouses);for(let o=0;o<e.length;o+=1){const r=e[o];if(Array.isArray(r)&&r.length)return r.slice()}return[]}const RENTAL_HOUSE_SUGGESTION_LIMIT=50;let rentalHouseRuntime=null;function isValidRentalHouseRuntime(e){return!!e&&Array.isArray(e.catalog)&&Array.isArray(e.searchIndex)&&e.lookup&&typeof e.lookup=="object"&&typeof e.signature=="string"}function publishRentalHouseRuntime(e){if(!e)return;const t=getGlobalScope$1();if(t){try{t.__cineRentalHouseRuntime=e}catch{}if(!Array.isArray(t.__cineRentalHouseCatalog))try{t.__cineRentalHouseCatalog=e.catalog}catch{}try{t.__cineRentalHouseSearchIndex=e.searchIndex}catch{}try{t.__cineRentalHouseLookup=e.lookup}catch{}try{t.__cineRentalHouseSignature=e.signature}catch{}}}function buildRentalHouseRuntime(){const e=getGlobalScope$1();if(e)try{const a=e.__cineRentalHouseRuntime;if(isValidRentalHouseRuntime(a))return a}catch{}let t=[];if(e)try{const a=e.__cineRentalHouseCatalog;Array.isArray(a)&&a.length&&(t=a.slice())}catch{}t.length||(t=resolveRentalHouseCatalog());const o=t.map(a=>{if(!a||typeof a!="object")return null;const s=a.name?String(a.name).trim():"";if(!s)return null;const l=normalizeRentalHouseKey(s);if(!l)return null;const u=formatRentalHouseLocation(a),d=normalizeRentalHouseSearchValue(s),m=normalizeRentalHouseSearchValue(u),y=normalizeRentalHouseSearchValue([a.city,a.country,a.address,a.phone,a.email].map(b=>b?String(b).trim():"").filter(Boolean).join(" ")),h=[d,m,y].filter(Boolean).join(" ");return{entry:a,name:s,key:l,location:u,normalizedName:d,normalizedLocation:m,searchKey:h}}).filter(Boolean),r=o.map(a=>`${a.key}|${a.location}`).join("||"),n=Object.create(null);return t.forEach(a=>{if(!a||typeof a!="object")return;const s=normalizeRentalHouseKey(a.name);s&&!n[s]&&(n[s]=a)}),{catalog:t,searchIndex:o,signature:r,lookup:n}}function getRentalHouseRuntime(){return isValidRentalHouseRuntime(rentalHouseRuntime)||(rentalHouseRuntime=buildRentalHouseRuntime(),publishRentalHouseRuntime(rentalHouseRuntime)),rentalHouseRuntime}function normalizeRentalHouseSearchValue(e){if(!e)return"";let t=String(e);try{typeof t.normalize=="function"&&(t=t.normalize("NFD"))}catch{}return t.replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[\u2012\u2013\u2014\u2015]/g,"-").replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim()}function normalizeRentalHouseKey(e){return e?String(e).trim().replace(/[\u2012\u2013\u2014\u2015]/g,"-").toLowerCase():""}const RENTAL_HOUSE_SUFFIX_TOKENS=new Set(["AG","BV","BVBA","CO","GMBH","INC","KG","LLC","LTD","PLC","PTY","SAS","SARL","SL","SPA","S.P.A","SRL"]);function formatRentalHouseShortName(e){if(!e)return"";const t=typeof e=="object"&&e&&typeof e.shortName=="string"?e.shortName.trim():"";if(t)return t;const o=typeof e=="string"?e:e&&e.name,r=o?String(o).trim():"";if(!r)return"";let n=r.replace(/\s*\([^)]*\)\s*/g," ").replace(/\s+/g," ").trim();const a=n.match(/\s*[\u2012\u2013\u2014\u2015-]\s*/);if(a){const l=n.indexOf(a[0]);l>0&&(n=n.slice(0,l).trim())}n||(n=r.trim());const s=n.match(/\b[A-Z]{2,5}\b/g);if(s&&s.length)for(let l=0;l<s.length;l+=1){const u=s[l];if(!RENTAL_HOUSE_SUFFIX_TOKENS.has(u))return u==="ARRI"?"Arri":u}return/^arri\b/i.test(n)?"Arri":/^ludwig\s+kamera/i.test(n)?"Kamera Ludwig":n.trim()}function resolveCurrentRentalHouseValue(e={}){const t=e.input||resolveRentalHouseInput();if(e.preferInput!==!1&&t&&typeof t.value=="string"){const a=t.value.trim();if(a)return a}if(typeof e.rentalHouse=="string"&&e.rentalHouse.trim())return e.rentalHouse.trim();let o=null;const r=getGlobalScope$1();if(r&&typeof r.getCurrentProjectInfo=="function")try{o=r.getCurrentProjectInfo()}catch{}const n=o&&typeof o=="object"&&typeof o.rentalHouse=="string"?o.rentalHouse.trim():"";return n||(e.preferInput===!1&&t&&typeof t.value=="string"?t.value.trim():"")}function resolveRentalProviderNoteLabel(e={}){const t=typeof e.fallback=="string"?e.fallback:"",o=typeof e.rentalHouse=="string"&&e.rentalHouse.trim()?e.rentalHouse.trim():resolveCurrentRentalHouseValue({input:e.input});if(!o)return t;let r=null;if(o){const a=getRentalHouseRuntime(),s=a&&a.lookup;r=s?s[normalizeRentalHouseKey(o)]:null}const n=formatRentalHouseShortName(r||o);return n||t||o}let appliedRentalNoteLabel=null;function refreshRentalProviderNoteDisplays(e={}){const t=getGearListRentalToggleTexts(e),o=t.noteLabel&&t.noteLabel.trim()?t.noteLabel.trim():"";if(appliedRentalNoteLabel===o)return o;appliedRentalNoteLabel=o;const r=typeof document<"u"?document:null,n=[];if(typeof gearListOutput<"u"&&gearListOutput&&n.push(gearListOutput),typeof projectRequirementsOutput<"u"&&projectRequirementsOutput&&n.push(projectRequirementsOutput),r&&n.push(r),n.length){const s=".gear-item[data-rental-note], .gear-custom-item[data-rental-note]";n.forEach(l=>{!l||typeof l.querySelectorAll!="function"||l.querySelectorAll(s).forEach(u=>{!u||typeof u.setAttribute!="function"||(o?u.getAttribute("data-rental-note")!==o&&u.setAttribute("data-rental-note",o):typeof u.removeAttribute=="function"&&u.removeAttribute("data-rental-note"))})})}let a=null;if(typeof getGearItemEditContext=="function")try{a=getGearItemEditContext()}catch(s){if(!s||s.name!=="ReferenceError")throw s}return a&&a.rentalDescription&&(a.rentalDescription.textContent=o,a.rentalDescription.hidden=!o,a.rentalCheckbox&&(o?a.rentalCheckbox.setAttribute("aria-describedby",a.rentalDescription.id):a.rentalCheckbox.removeAttribute("aria-describedby"))),o}function formatRentalHouseLocation(e){const t=[],o=e&&e.city?String(e.city).trim():"",r=e&&e.country?String(e.country).trim():"";return o&&t.push(o),r&&t.push(r),t.join(", ")}function formatRentalHouseTooltip(e){if(!e||typeof e!="object")return"";const t=[],o=formatRentalHouseLocation(e),r=e.address?String(e.address).trim():"",n=e.phone?String(e.phone).trim():"",a=e.email?String(e.email).trim():"";return o&&t.push(o),r&&t.push(r),n&&t.push(n),a&&t.push(a),t.join(" • ")}function resolveRentalHouseEntry(e){const t=typeof e=="string"?e.trim():"";if(!t)return null;const o=getRentalHouseRuntime(),r=o&&o.lookup,n=normalizeRentalHouseKey(t);if(r&&n&&r[n])return r[n];const a=normalizeRentalHouseSearchValue(t);if(!a||!o||!Array.isArray(o.searchIndex))return null;const s=o.searchIndex.find(l=>l&&l.normalizedName===a);return s?s.entry:null}function resolveRentalHouseInput(){return typeof document>"u"?null:document.getElementById("rentalHouse")}function ensureRentalHouseDatalist(e){if(!e||typeof document>"u")return null;let t=e.getAttribute("list");t||(t=RENTAL_HOUSE_DATALIST_ID,e.setAttribute("list",t));let o=t?document.getElementById(t):null;return o||(o=document.createElement("datalist"),o.id=t,e.insertAdjacentElement("afterend",o)),o}function scoreRentalHouseMatch(e,t){if(!t)return 0;if(!e)return Number.POSITIVE_INFINITY;const{normalizedName:o,normalizedLocation:r,searchKey:n}=e;if(!n||n.indexOf(t)===-1)return Number.POSITIVE_INFINITY;const a=o?o.indexOf(t):-1,s=r?r.indexOf(t):-1;if(a===0)return 0;if(s===0)return 100;if(a>0)return 200+a;if(s>0)return 400+s;const l=n.indexOf(t);return 800+(l>=0?l:0)}function getRentalHouseMatches(e){const t=getRentalHouseRuntime(),o=t&&Array.isArray(t.searchIndex)?t.searchIndex:[],r=normalizeRentalHouseSearchValue(e);if(!o.length)return[];if(!r)return o.slice().sort((a,s)=>a.name.localeCompare(s.name)).slice(0,RENTAL_HOUSE_SUGGESTION_LIMIT);const n=[];return o.forEach(a=>{const s=scoreRentalHouseMatch(a,r);Number.isFinite(s)&&n.push({info:a,score:s})}),n.sort((a,s)=>a.score!==s.score?a.score-s.score:a.info.name.localeCompare(s.info.name)),n.slice(0,RENTAL_HOUSE_SUGGESTION_LIMIT).map(a=>a.info)}function renderRentalHouseSuggestions(e=resolveRentalHouseInput()){const t=getRentalHouseRuntime(),o=t&&Array.isArray(t.searchIndex)?t.searchIndex:[];if(!e||!o.length)return;const r=ensureRentalHouseDatalist(e);if(!r)return;const n=typeof e.value=="string"?e.value:"",a=normalizeRentalHouseSearchValue(n),l=`${t&&typeof t.signature=="string"?t.signature:""}::${a}`;if(r.__rentalHouseSignature===l)return;const u=document.createDocumentFragment(),d=new Set,m=getRentalHouseMatches(n);(m.length?m:getRentalHouseMatches("")).forEach(h=>{if(!h||d.has(h.key))return;const b=document.createElement("option");b.value=h.name,h.location&&(b.label=h.location),b.textContent=h.name,u.appendChild(b),d.add(h.key)}),r.innerHTML="",r.appendChild(u),r.__rentalHouseSignature=l}function updateRentalHouseAssistiveDetails(e=resolveRentalHouseInput()){if(!e)return;const t=typeof e.value=="string"?e.value.trim():"";let o=null;if(t){const r=getRentalHouseRuntime(),n=r&&r.lookup;o=n?n[normalizeRentalHouseKey(t)]:null}if(o){const r=formatRentalHouseTooltip(o);r?(e.title=r,e.setAttribute("data-help",r)):(e.removeAttribute("title"),e.removeAttribute("data-help"))}else e.removeAttribute("title"),e.removeAttribute("data-help");refreshRentalProviderNoteDisplays({input:e,rentalHouse:t})}const initialRentalHouseInput=resolveRentalHouseInput();initialRentalHouseInput&&(updateRentalHouseAssistiveDetails(initialRentalHouseInput),initialRentalHouseInput.addEventListener("input",()=>{renderRentalHouseSuggestions(initialRentalHouseInput),updateRentalHouseAssistiveDetails(initialRentalHouseInput)}),initialRentalHouseInput.addEventListener("change",()=>{renderRentalHouseSuggestions(initialRentalHouseInput),updateRentalHouseAssistiveDetails(initialRentalHouseInput)}),initialRentalHouseInput.addEventListener("blur",()=>updateRentalHouseAssistiveDetails(initialRentalHouseInput)),initialRentalHouseInput.addEventListener("focus",()=>renderRentalHouseSuggestions(initialRentalHouseInput)));function normalizePowerSelectionString(e){return typeof e=="string"?e.trim():e==null?"":String(e)}function getGlobalScope$1(){return typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null}function resolveSetupsStructuredClone(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}if(typeof require=="function"){try{const t=require("node:util");if(t&&typeof t.structuredClone=="function")return t.structuredClone.bind(t)}catch{}try{const t=require("util");if(t&&typeof t.structuredClone=="function")return t.structuredClone.bind(t)}catch{}}return null}function setupsJsonDeepClone(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}function createSetupsDeepClone(e){const t=resolveSetupsStructuredClone(e);return t?function(r){if(r===null||typeof r!="object")return r;try{return t(r)}catch{}return setupsJsonDeepClone(r)}:setupsJsonDeepClone}const SETUPS_DEEP_CLONE=(()=>{const e=getGlobalScope$1();return e&&typeof e.__cineDeepClone=="function"?e.__cineDeepClone:createSetupsDeepClone(e)})();function gearListGetSafeHtmlSectionsImpl(e){const t=typeof e=="string"?e:"",o={projectHtml:"",gearHtml:t},r=getGlobalScope$1(),n=typeof splitGearListHtml=="function"?splitGearListHtml:r&&typeof r.splitGearListHtml=="function"?r.splitGearListHtml:null;if(!n)return o;try{const a=n(t);if(!a||typeof a!="object")return o;const s=typeof a.projectHtml=="string"?a.projectHtml:"",l=typeof a.gearHtml=="string"?a.gearHtml:s?"":t;return{projectHtml:s,gearHtml:l}}catch(a){return console.warn("Failed to split gear list HTML",a),o}}function resolveElementById(e,t){const o=typeof document<"u"?document:null;if(o&&typeof o.getElementById=="function"){const n=o.getElementById(e);if(n)return n}const r=getGlobalScope$1();if(r&&t&&typeof r=="object")try{const n=r[t];if(n)return n}catch{}return null}function resolveGearListModule(){const e=getGlobalScope$1(),t=[];if(typeof cineGearList=="object"&&cineGearList&&t.push(cineGearList),e&&typeof e.cineGearList=="object"&&e.cineGearList&&(t.includes(e.cineGearList)||t.push(e.cineGearList)),typeof require=="function")try{const o=require("./modules/gear-list.js");o&&typeof o=="object"&&!t.includes(o)&&t.push(o)}catch{}for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r.setImplementation!="function"))return r}return null}function registerGearListModuleImplementation(){const e=resolveGearListModule(),t={getSafeGearListHtmlSections:gearListGetSafeHtmlSectionsImpl,generateGearListHtml:gearListGenerateHtmlImpl,getCurrentGearListHtml:gearListGetCurrentHtmlImpl};if(e&&typeof e.setImplementation=="function")try{return e.setImplementation(t,{source:"app-setups"}),!0}catch(r){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Unable to register gear list implementation with cineGearList.",r)}const o=getGlobalScope$1();if(o&&typeof o=="object"){try{o.getSafeGearListHtmlSections=gearListGetSafeHtmlSectionsImpl}catch{}try{o.generateGearListHtml=gearListGenerateHtmlImpl}catch{}try{o.getCurrentGearListHtml=gearListGetCurrentHtmlImpl}catch{}}return!1}registerGearListModuleImplementation();function buildShareUiContext(){return{dialog:resolveElementById("shareDialog","shareDialog"),form:resolveElementById("shareForm","shareForm"),filenameInput:resolveElementById("shareFilename","shareFilenameInput"),filenameMessage:resolveElementById("shareFilenameMessage","shareFilenameMessage"),linkMessage:resolveElementById("shareLinkMessage","shareLinkMessage"),includeAutoGearCheckbox:resolveElementById("shareIncludeAutoGear","shareIncludeAutoGearCheckbox"),includeAutoGearLabel:resolveElementById("shareIncludeAutoGearLabel","shareIncludeAutoGearLabelElem"),includeOwnedGearCheckbox:resolveElementById("shareIncludeOwnedGear","shareIncludeOwnedGearCheckbox"),includeOwnedGearLabel:resolveElementById("shareIncludeOwnedGearLabel","shareIncludeOwnedGearLabelElem"),cancelButton:resolveElementById("shareCancelBtn","shareCancelBtn"),sharedLinkInput:resolveElementById("sharedLinkInput","sharedLinkInput"),applySharedLinkButton:resolveElementById("applySharedLinkBtn","applySharedLinkBtn")}}function buildSharedImportUiContext(){return{dialog:resolveElementById("sharedImportDialog","sharedImportDialog"),form:resolveElementById("sharedImportForm","sharedImportForm"),modeSelect:resolveElementById("sharedImportModeSelect","sharedImportModeSelect"),cancelButton:resolveElementById("sharedImportCancelBtn","sharedImportCancelBtn")}}let cachedShareUiContext=null,cachedSharedImportUiContext=null,projectDialogInitialSnapshot=null;function getShareUiContext(e){return e&&typeof e=="object"&&e.context&&typeof e.context=="object"?e.context:(cachedShareUiContext||(cachedShareUiContext=buildShareUiContext()),cachedShareUiContext)}function getSharedImportUiContext(e){return cachedSharedImportUiContext||(cachedSharedImportUiContext=buildSharedImportUiContext()),cachedSharedImportUiContext}function cloneProjectDialogState(e){if(e==null)return e;if(Array.isArray(e))return e.map(t=>cloneProjectDialogState(t));if(Object.prototype.toString.call(e)==="[object Object]"){const t={};return Object.keys(e).forEach(o=>{t[o]=cloneProjectDialogState(e[o])}),t}return e}function getProjectDialogSeedInfo$1(){if(currentProjectInfo)return cloneProjectDialogState(currentProjectInfo);if(projectForm)try{return cloneProjectDialogState(collectProjectFormData$1())}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to read current project form data before opening dialog",e)}return{}}function captureProjectDialogSnapshot(){if(!projectForm){projectDialogInitialSnapshot=null;return}try{const e=collectProjectFormData$1();projectDialogInitialSnapshot=cloneProjectDialogState(e)}catch(e){projectDialogInitialSnapshot=null,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to capture project dialog snapshot",e)}}function openProjectDialogWithInfo$1(e){projectForm?(populateProjectForm$1(e&&typeof e=="object"?e:{}),captureProjectDialogSnapshot()):projectDialogInitialSnapshot=null,openDialog(projectDialog)}function restoreProjectDialogSnapshot(){projectForm&&(projectDialogInitialSnapshot&&typeof projectDialogInitialSnapshot=="object"?populateProjectForm$1(cloneProjectDialogState(projectDialogInitialSnapshot)):projectForm.reset())}function callSetupsCoreFunction(e,t=[],o={}){if(typeof callCoreFunctionIfAvailable=="function")return callCoreFunctionIfAvailable(e,t,o);const r=(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null)||null,n=typeof e=="string"?r&&r[e]:e;if(typeof n=="function"){try{return n.apply(r,t)}catch(a){typeof console<"u"&&typeof console.error=="function"&&console.error(`Failed to invoke ${e}`,a)}return}if(o&&o.defer===!0){const a=r&&Array.isArray(r.CORE_BOOT_QUEUE)?r.CORE_BOOT_QUEUE:null;a&&a.push(()=>{callSetupsCoreFunction(e,t,{...o,defer:!1})})}return o&&Object.prototype.hasOwnProperty.call(o,"defaultValue")?o.defaultValue:void 0}function getSetupsCoreValue(e,t={}){const o=Object.prototype.hasOwnProperty.call(t,"defaultValue")?t.defaultValue:"",r=callSetupsCoreFunction(e,[],{defaultValue:o});if(typeof r=="string")return r;if(r==null)return o;try{return String(r)}catch{return o}}function getGlobalCineUi$1(){const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!e||typeof e!="object")return null;try{const t=e.cineUi;return t&&typeof t=="object"?t:null}catch{return null}}function isCineUiEntryRegistered$1(e,t){if(!e||typeof e!="object")return!1;if(typeof e.get=="function")try{return!!e.get(t)}catch{}if(typeof e.list=="function")try{const o=e.list();return Array.isArray(o)&&o.indexOf(t)!==-1}catch{}return!1}function registerCineUiEntries$1(e,t,o){if(!(!e||typeof e.register!="function"))for(let r=0;r<t.length;r+=1){const n=t[r];if(!(!n||typeof n.name!="string")&&!isCineUiEntryRegistered$1(e,n.name))try{e.register(n.name,n.value)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn(o,a)}}}function areSetupsEntriesRegistered(e){if(!e||typeof e!="object")return!1;const t=e.controllers,o=e.interactions,r=e.help;return isCineUiEntryRegistered$1(t,"shareDialog")&&isCineUiEntryRegistered$1(t,"sharedImportDialog")&&isCineUiEntryRegistered$1(o,"shareOpen")&&isCineUiEntryRegistered$1(o,"shareSubmit")&&isCineUiEntryRegistered$1(o,"shareCancel")&&isCineUiEntryRegistered$1(o,"shareApplyFile")&&isCineUiEntryRegistered$1(o,"shareInputChange")&&isCineUiEntryRegistered$1(o,"sharedImportSubmit")&&isCineUiEntryRegistered$1(o,"sharedImportCancel")&&isCineUiEntryRegistered$1(r,"shareProject")&&isCineUiEntryRegistered$1(r,"sharedImport")}let setupsCineUiRegistered=areSetupsEntriesRegistered(getGlobalCineUi$1());function enqueueCineUiRegistration$1(e){const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!t||typeof e!="function")return;try{const r=t.cineUi&&typeof t.cineUi=="object"?t.cineUi:null;if(r){e(r);return}}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("cineUi registration callback (setups) failed",r);return}const o="__cineUiReadyQueue";Array.isArray(t[o])||(t[o]=[]),t[o].push(e)}function getPowerSelectionSnapshot$1(){if(!batterySelect&&!batteryPlateSelect&&!hotswapSelect)return null;const e=batterySelect?normalizePowerSelectionString(batterySelect.value):"",t=batteryPlateSelect?normalizePowerSelectionString(batteryPlateSelect.value):"",o=hotswapSelect?normalizePowerSelectionString(hotswapSelect.value):"",n={batteryPlate:(typeof normalizeBatteryPlateValue=="function"?normalizeBatteryPlateValue(t,e):t)||"",battery:e||"",batteryHotswap:o||""};return!n.batteryPlate&&!n.battery&&!n.batteryHotswap?null:n}function parseBatteryCurrentLimit(e){if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="string"){const t=e.trim();if(!t)return null;const o=t.replace(/,/g,"."),r=parseFloat(o);return Number.isFinite(r)?r:null}return null}function ensureDeferredScriptsReady(e,t){if(typeof t!="function")return;const o=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;let r=null;if(o){try{typeof o.cineEnsureDeferredScriptsLoaded=="function"&&(r=o.cineEnsureDeferredScriptsLoaded({reason:e}))}catch{}if(!r)try{r=o.cineDeferredScriptsReady}catch{}}if(!r||typeof r.then!="function"){t();return}r.then(()=>{t()}).catch(n=>{typeof console<"u"&&typeof console.error=="function"&&console.error("Deferred scripts failed to load before generating an overview.",n),t()})}const generateOverviewBtnRef=typeof generateOverviewBtn<"u"?generateOverviewBtn:document.getElementById("generateOverviewBtn");generateOverviewBtnRef&&generateOverviewBtnRef.addEventListener("click",()=>{const e=typeof setupSelect<"u"?setupSelect:document.getElementById("setupSelect");if(!e||!e.value){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang]&&texts[currentLang].alertSelectSetupForOverviewTitle||"No Project Selected",message:texts[currentLang].alertSelectSetupForOverview}):alert(texts[currentLang].alertSelectSetupForOverview);return}ensureDeferredScriptsReady("overview-dialog",()=>{typeof generatePrintableOverview=="function"?generatePrintableOverview():typeof console<"u"&&typeof console.error=="function"&&console.error("generatePrintableOverview is unavailable after deferred loading.")})});function batteryPinsSufficient(){const e=batterySelect&&batterySelect.value;if(!e||e==="None"||!(devices&&devices.batteries&&devices.batteries[e]))return!0;const t=devices&&devices.batteries?devices.batteries[e]:null,o=parseFloat(totalCurrent12Elem.textContent);if(!isFinite(o))return!0;const r=parseBatteryCurrentLimit(t.pinA);return!Number.isFinite(r)||r<=0?!0:o<=r}function alertPinExceeded(){const e=batterySelect&&batterySelect.value;if(!e||e==="None"||!(devices&&devices.batteries&&devices.batteries[e]))return;const t=devices&&devices.batteries?devices.batteries[e]:null,o=parseFloat(totalCurrent12Elem.textContent),r=parseBatteryCurrentLimit(t.pinA);if(!Number.isFinite(r)||r<=0)return;const n=texts[currentLang].warnPinExceeded.replace("{current}",o.toFixed(2)).replace("{max}",String(r));typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang].warnPinExceededTitle||"Current Limit Exceeded",message:n}):alert(n)}const generateGearListBtnRef=typeof generateGearListBtn<"u"?generateGearListBtn:document.getElementById("generateGearListBtn");generateGearListBtnRef&&generateGearListBtnRef.addEventListener("click",()=>{const e=typeof setupSelect<"u"?setupSelect:document.getElementById("setupSelect");if(!e||!e.value){typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:texts[currentLang]&&texts[currentLang].alertSelectSetupForOverviewTitle||"No Project Selected",message:texts[currentLang].alertSelectSetupForOverview}):alert(texts[currentLang].alertSelectSetupForOverview);return}if(!batteryPinsSufficient()){alertPinExceeded();return}const t=getProjectDialogSeedInfo$1();t&&typeof t=="object"&&(populateRecordingResolutionDropdown(t.recordingResolution),populateSensorModeDropdown(t.sensorMode),populateCodecDropdown$1(t.codec)),openProjectDialogWithInfo$1(t)});const deleteGearListProjectBtnRef=typeof deleteGearListProjectBtn<"u"?deleteGearListProjectBtn:document.getElementById("deleteGearListProjectBtn");deleteGearListProjectBtnRef&&deleteGearListProjectBtnRef.addEventListener("click",()=>{deleteCurrentGearList$1()});const projectCancelBtnRef=typeof projectCancelBtn<"u"?projectCancelBtn:null;projectCancelBtnRef&&projectCancelBtnRef.addEventListener("click",()=>{restoreProjectDialogSnapshot(),closeDialog(projectDialog)});function submitProjectFormViaBackdrop(){if(!projectForm||!projectDialog)return;const e=typeof projectDialog.open=="boolean"?projectDialog.open:null,t=typeof projectDialog.hasAttribute=="function"?projectDialog.hasAttribute("open"):!1;if(!(e===null?t:e||t))return;const r=projectDialog.querySelector('[type="submit"]');if(typeof projectForm.requestSubmit=="function")try{r?projectForm.requestSubmit(r):projectForm.requestSubmit();return}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Project dialog backdrop submit failed to use requestSubmit",a)}const n=new Event("submit",{bubbles:!0,cancelable:!0});projectForm.dispatchEvent(n)}const localProjectDialogCloseBtn=typeof projectDialogCloseBtn<"u"?projectDialogCloseBtn:document.getElementById("projectDialogClose");localProjectDialogCloseBtn&&localProjectDialogCloseBtn.addEventListener("click",()=>{projectCancelBtnRef?projectCancelBtnRef.click():closeDialog(projectDialog)});const projectDialogRef$1=typeof projectDialog<"u"?projectDialog:document.getElementById("projectDialog");projectDialogRef$1&&(projectDialogRef$1.addEventListener("cancel",e=>{e&&e.preventDefault(),projectCancelBtnRef?projectCancelBtnRef.click():(restoreProjectDialogSnapshot(),closeDialog(projectDialogRef$1))}),projectDialogRef$1.addEventListener("click",e=>{e.target===projectDialogRef$1&&(e.preventDefault(),e.stopPropagation(),submitProjectFormViaBackdrop())}));const projectFormRef=typeof projectForm<"u"?projectForm:document.getElementById("projectForm");projectFormRef&&(projectFormRef.addEventListener("input",()=>{markProjectFormDataDirty$1()}),projectFormRef.addEventListener("submit",e=>{if(e.preventDefault(),!batteryPinsSufficient()){alertPinExceeded();return}const t=collectCurrentGearModifications(),o=collectProjectFormData$1();currentProjectInfo=o,ensureZoomRemoteSetup$1(o);const r=gearListGenerateHtmlImpl(o);displayGearAndRequirements(r),applyCurrentGearModifications(t),ensureGearListActions$1(),bindGearListCageListener$1(),bindGearListEasyrigListener$1(),bindGearListSliderBowlListener$1(),bindGearListEyeLeatherListener$1(),bindGearListProGaffTapeListener$1(),bindGearListDirectorMonitorListener$1(),saveCurrentSession(),scheduleProjectAutoSave(!0),closeDialog(projectDialog)}));function resolveLocalAppVersionForShare(){if(typeof ACTIVE_APP_VERSION=="string"){const e=ACTIVE_APP_VERSION.trim();if(e)return e}if(typeof APP_VERSION=="string"){const e=APP_VERSION.trim();if(e)return e}return""}function createSharedProjectMetadata({includeAutoGear:e,hasAutoGearRules:t,includeOwnedGearMarks:o,hasOwnedGearMarkers:r}){const n={type:"camera-power-planner/project-bundle",includesAutoGearRules:!!(e&&t)};n.includesOwnedGearMarkers=!!(o&&r);const a=resolveLocalAppVersionForShare();a&&(n.version=a);try{const s=new Date;Number.isNaN(s.valueOf())||(n.exportedAt=s.toISOString())}catch(s){console.warn("Unable to capture export timestamp for shared project metadata.",s)}return n.generator="Camera Power Planner",n}function hasOwnedGearItemsForExport(e){const t=e||gearListOutput;return!t||typeof t.querySelector!="function"?!1:!!t.querySelector("[data-gear-own-gear-id]")}function formatOwnedGearExportLabel(e){const t=typeof getLocalizedText=="function"?getLocalizedText("gearListOwnedExportLabel"):"",o=texts?.en?.gearListOwnedExportLabel||"Owned by %s",r=t&&t.trim()?t:o;return r.includes("%s")?r.replace("%s",e):`${r} ${e}`.trim()}function getGearItemDisplayName(e){if(!e||typeof e.getAttribute!="function")return"";const t=e.getAttribute("data-gear-name")||"",o=e.getAttribute("data-gear-label")||"",r=(t||o||"").trim(),n=(e.getAttribute("data-gear-attributes")||"").trim();if(!n)return r;if(!r)return n;const a=r.toLowerCase(),s=n.toLowerCase();return a.includes(s)?r:`${r} (${n})`}function collectOwnedGearMarkersForExport(e){const t=e||gearListOutput;if(!t||typeof t.querySelectorAll!="function")return[];const o=t.querySelectorAll("[data-gear-own-gear-id]"),r=[];return o.forEach(n=>{if(!n)return;const a=n.getAttribute("data-gear-own-gear-id");if(!a)return;const s=n.getAttribute("data-gear-provider")||"",l=n.getAttribute("data-gear-provider-label")||"",u=getProviderInfo(s,{label:l}),d=(u.type==="user"?u.profileDisplayName||u.label||l||getGearProviderTexts().user:u.type==="contact"?u.label||l:l||u.label||"").trim(),m={ownedId:a,providerValue:u.value||s,providerLabel:u.label||l,ownerDisplayName:d,ownerProfileName:u.profileName||"",ownerType:u.type||"",contactId:u.contactId||"",gearName:getGearItemDisplayName(n)};r.push(m)}),r}function applyOwnedGearMarkersToHtml(e,t,o={}){if(!e||!t||!t.length)return e;let r;try{r=document.implementation.createHTMLDocument("")}catch{}if(!r||!r.body)return e;r.body.innerHTML=e;const n=o.ownerLabelFallback||"Owned";return t.forEach(a=>{if(!a||!a.ownedId)return;const l=`[data-gear-own-gear-id="${typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(a.ownedId):a.ownedId.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"]`,u=r.body.querySelector(l);if(!u)return;a.ownerDisplayName?u.setAttribute("data-gear-owned-export-label",a.ownerDisplayName):u.removeAttribute("data-gear-owned-export-label"),u.querySelectorAll("[data-gear-owned-export]").forEach(A=>{A&&A.parentElement&&A.parentElement.removeChild(A)});const m=a.ownerDisplayName||n,y=formatOwnedGearExportLabel(m),h=r.createElement("span");h.className="gear-item-provider gear-item-owned-export",h.setAttribute("data-gear-owned-export","true"),h.textContent=y;const v=u.classList?.contains("gear-custom-item")&&u.querySelector(".gear-custom-item-summary")||u,C=v.querySelector(".gear-item-note");C&&C.parentElement===v?v.insertBefore(h,C):v.appendChild(h)}),r.body.innerHTML}function downloadSharedProject$1(e,t,o){if(!e)return;const r=getShareUiContext(this),n=r.linkMessage,a=r.includeAutoGearCheckbox;r.includeAutoGearLabel;const s=safeGetCurrentProjectName$1(),l=U=>U&&typeof U.value=="string"?normalizePowerSelectionString(U.value):"",u=l(batterySelect),d=l(batteryPlateSelect),m=l(hotswapSelect),y={setupName:s},h=(U,j)=>{if(j!=null)if(typeof j=="string"){const Y=j.trim();if(!Y||Y==="None")return;y[U]=Y}else if(Array.isArray(j)){const Y=j.filter(le=>typeof le=="string"&&le.trim()&&le!=="None");Y.length&&(y[U]=Y)}else y[U]=j};h("camera",cameraSelect.value),h("monitor",monitorSelect.value),h("video",videoSelect.value),h("cage",cageSelect.value),Array.isArray(motorSelects)&&h("motors",motorSelects.map(U=>U.value)),Array.isArray(controllerSelects)&&h("controllers",controllerSelects.map(U=>U.value)),h("distance",distanceSelect.value),h("batteryPlate",normalizeBatteryPlateValue(d,u)),h("battery",u),h("batteryHotswap",m);const b=getPowerSelectionSnapshot$1();if(b&&(y.powerSelection=b,y.battery=b.battery||"",y.batteryPlate=b.batteryPlate||"",y.batteryHotswap=b.batteryHotswap||""),typeof getDiagramManualPositions=="function"){const U=getDiagramManualPositions();U&&Object.keys(U).length&&(y.diagramPositions=U)}const v=[];if(currentProjectInfo&&v.push(currentProjectInfo),typeof loadProject=="function"){const U=new Set;if(typeof s=="string"&&s&&U.add(s),typeof getCurrentProjectStorageKey=="function"){const j=getCurrentProjectStorageKey({allowTyped:!0});typeof j=="string"&&j&&U.add(j)}if(typeof getSetupNameState=="function"){const j=getSetupNameState();j&&typeof j=="object"&&["storageKey","selectedName","typedName"].forEach(Y=>{const le=typeof j[Y]=="string"?j[Y].trim():"";le&&U.add(le)})}U.forEach(j=>{if(!(typeof cineFeatureBackup<"u"&&typeof cineFeatureBackup.isAutoBackupName=="function"&&cineFeatureBackup.isAutoBackupName(j)))try{const Y=loadProject(j);Y&&Y.projectInfo&&v.push(Y.projectInfo)}catch(Y){console.warn("Unable to read project info for export from storage key",j,Y)}})}let C=null,A=null;if(v.forEach(U=>{U&&(C?C=mergeProjectInfoSnapshots(C,U):C=cloneProjectInfoForStorage(U))}),C){const U=typeof createProjectInfoSnapshotForStorage=="function"?createProjectInfoSnapshotForStorage(C,{projectNameOverride:s}):C,j=cloneProjectInfoForStorage(U);j&&typeof j=="object"&&(A=j)}const w=cloneGearListSelectors(getGearListSelectors());Object.keys(w).length&&(y.gearSelectors=w);const R=o?collectOwnedGearMarkersForExport(gearListOutput):[],_=gearListGetCurrentHtmlImpl();if(y.gearListAndProjectRequirementsGenerated=!!_,y.gearListAndProjectRequirementsGenerated){const{projectHtml:U,gearHtml:j}=gearListGetSafeHtmlSectionsImpl(_);if(U&&(y.projectHtml=U),j){const Y=o&&R.length?applyOwnedGearMarkersToHtml(j,R):j;y.gearList=Y,o&&R.length&&(y.ownedGearMarkers=R.map(le=>({...le})))}}y.gearListAndProjectRequirementsGenerated&&A&&(y.projectInfo=A);const G=getCurrentSetupKey(),O=loadFeedbackSafe()[G]||[];O.length&&(y.feedback=O);const B=getAutoGearRules(),$=Array.isArray(B)&&B.length>0;if(t&&$){y.autoGearRules=B;const U=getAutoGearRuleCoverageSummary({rules:B});U&&(y.autoGearCoverage=U)}const V=(()=>{if(typeof getContactsSnapshot!="function")return[];try{const U=getContactsSnapshot();if(!Array.isArray(U)||!U.length)return[];const j=Y=>typeof Y=="string"?Y.trim():"";return U.map(Y=>{if(!Y||typeof Y!="object")return null;const le=j(Y.id);if(!le)return null;const be=Number.isFinite(Y.createdAt)?Y.createdAt:Date.now(),re=Number.isFinite(Y.updatedAt)?Y.updatedAt:be,de={id:le,name:j(Y.name),role:j(Y.role),phone:j(Y.phone),email:j(Y.email),website:j(Y.website),notes:j(Y.notes),avatar:j(Y.avatar),createdAt:be,updatedAt:re},ne=j(typeof getContactDisplayLabel=="function"?getContactDisplayLabel({...Y,...de}):Y&&typeof Y.label=="string"?Y.label:"");return ne&&(de.label=ne),de}).filter(Boolean)}catch(U){return console.warn("Unable to prepare shared contact snapshot",U),[]}})();V.length&&(y.contacts=V);const M=createSharedProjectMetadata({includeAutoGear:t,hasAutoGearRules:$,includeOwnedGearMarks:o,hasOwnedGearMarkers:R.length>0});M&&typeof M=="object"&&(y.metadata=M);const F=(()=>{const U={};return M&&typeof M=="object"&&Object.keys(M).forEach(j=>{const Y=M[j];Y==null?U[j]=Y:typeof Y=="string"?U[j]=Y.length>120?`${Y.slice(0,117)}…`:Y:typeof Y=="object"?U[j]=Array.isArray(Y)?{type:"array",length:Y.length}:{type:"object",keys:Object.keys(Y).length}:U[j]=Y}),{setupName:typeof s=="string"?s:"",setupKey:typeof G=="string"?G:"",includeAutoGear:!!t,includeOwnedGear:!!o,ownedGearMarkerCount:Array.isArray(R)?R.length:0,metadata:U,contacts:Array.isArray(V)?V.length:0}})(),z=U=>{U?console.warn("Project export failed",F,U):console.warn("Project export failed",F);const j=getLocalizedText("shareExportFailed")||"Project export failed.";n?(n.textContent=j,setStatusLevel(n,"danger"),n.classList.remove("hidden"),typeof setTimeout=="function"&&setTimeout(()=>n.classList.add("hidden"),6e3)):typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Export Failed",message:j}):typeof alert=="function"&&alert(j)};let x;try{x=JSON.stringify(y,null,2)}catch(U){console.error("Failed to serialize shared project",U),z(U);return}const H=downloadBackupPayload(x,e);if(a&&(a.checked=t&&$),r.includeOwnedGearCheckbox&&(r.includeOwnedGearCheckbox.checked=o&&R.length>0),!H||!H.success){z();return}if(H.method==="window-fallback"){const U=typeof getManualDownloadFallbackMessage=="function"?getManualDownloadFallbackMessage():getLocalizedText("manualDownloadFallback")||"The download did not start automatically. A new tab opened so you can copy or save the file manually.";n?(n.textContent=U,setStatusLevel(n,"warning"),n.classList.remove("hidden"),typeof setTimeout=="function"&&setTimeout(()=>n.classList.add("hidden"),8e3)):typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Download Blocked",message:U}):typeof alert=="function"&&alert(U);return}const W=typeof getLocalizedText=="function"&&getLocalizedText("shareLinkCopied")||texts?.en?.shareLinkCopied||"Project file downloaded.";n?(n.textContent=W,setStatusLevel(n,"success"),n.classList.remove("hidden"),typeof setTimeout=="function"&&setTimeout(()=>n.classList.add("hidden"),4e3)):typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Success",message:W}):typeof alert=="function"&&alert(W)}let ownGearNameCache=null;function getGearProviderTexts(){const e=getGearItemEditTexts();return{rental:e.providerRental||"Rental",user:e.providerUser||"User",crewHeading:e.providerCrewHeading||"Crew",unknown:e.providerUnknown||"Custom provider",help:e.providerHelp||""}}function refreshOwnGearNameCache(){if(ownGearNameCache={names:new Set,timestamp:Date.now()},typeof loadOwnGear!="function")return ownGearNameCache.names;try{const e=loadOwnGear();Array.isArray(e)&&e.forEach(t=>{if(t&&typeof t.name=="string"){const o=t.name.trim().toLowerCase();o&&ownGearNameCache.names.add(o)}})}catch(e){console.warn("Unable to refresh own gear cache for provider defaults",e)}return ownGearNameCache.names}function getOwnGearNameSet(){return!ownGearNameCache||!(ownGearNameCache.names instanceof Set)?refreshOwnGearNameCache():ownGearNameCache.names}const OWN_GEAR_SOURCE_CATALOG_VALUE=typeof OWN_GEAR_SOURCE_CATALOG=="string"&&OWN_GEAR_SOURCE_CATALOG?OWN_GEAR_SOURCE_CATALOG:"catalog",OWN_GEAR_SOURCE_CUSTOM_VALUE=typeof OWN_GEAR_SOURCE_CUSTOM=="string"&&OWN_GEAR_SOURCE_CUSTOM?OWN_GEAR_SOURCE_CUSTOM:"custom";function resolveOwnGearFeatureModuleForEditor(){if(typeof resolveOwnGearModule=="function")try{const t=resolveOwnGearModule();if(t&&typeof t=="object")return t}catch{}const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;return e&&typeof e.cineFeaturesOwnGear<"u"?e.cineFeaturesOwnGear:typeof cineFeaturesOwnGear=="object"&&cineFeaturesOwnGear?cineFeaturesOwnGear:null}function generateOwnGearIdForEditor(){const e=resolveOwnGearFeatureModuleForEditor();if(e&&typeof e.generateOwnGearId=="function")try{return e.generateOwnGearId()}catch{}if(typeof generateOwnGearId=="function")try{return generateOwnGearId()}catch{}const t=Date.now().toString(36),o=Math.floor(Math.random()*1e8).toString(36);return`own-${t}-${o}`}function normalizeOwnGearRecordForEditor(e){if(!e||typeof e!="object")return null;const t=resolveOwnGearFeatureModuleForEditor();if(t&&typeof t.normalizeOwnGearRecord=="function")try{return t.normalizeOwnGearRecord(e)}catch{}if(typeof normalizeOwnGearRecord=="function")try{return normalizeOwnGearRecord(e)}catch{}const o=typeof e.name=="string"?e.name.trim():"";if(!o)return null;const r={id:typeof e.id=="string"&&e.id.trim()?e.id.trim():generateOwnGearIdForEditor(),name:o};return typeof e.quantity=="string"&&e.quantity.trim()?r.quantity=e.quantity.trim():typeof e.quantity=="number"&&Number.isFinite(e.quantity)&&(r.quantity=String(e.quantity)),typeof e.notes=="string"&&e.notes.trim()&&(r.notes=e.notes.trim()),typeof e.source=="string"&&e.source.trim()&&(r.source=e.source.trim()),r}function cloneOwnGearRecords(e){return Array.isArray(e)?e.map(t=>normalizeOwnGearRecordForEditor(t)).filter(Boolean).map(t=>({...t})):[]}function loadOwnGearRecordsForEditor(){const e=resolveOwnGearFeatureModuleForEditor();if(e&&typeof e.loadStoredOwnGearItems=="function")try{const t=e.loadStoredOwnGearItems();if(Array.isArray(t))return cloneOwnGearRecords(t)}catch(t){console.warn("Unable to load own gear items for gear editor via module.",t)}if(typeof loadOwnGear=="function")try{const t=loadOwnGear();if(Array.isArray(t))return cloneOwnGearRecords(t)}catch(t){console.warn("Unable to load own gear items for gear editor from storage.",t)}return[]}function persistOwnGearRecordsForEditor(e){const t=Array.isArray(e)?e.map(r=>normalizeOwnGearRecordForEditor(r)).filter(Boolean):[],o=resolveOwnGearFeatureModuleForEditor();if(o&&typeof o.persistOwnGearItems=="function")try{return o.persistOwnGearItems(t),!0}catch(r){console.warn("Unable to persist own gear items via module for gear editor.",r)}if(typeof saveOwnGear=="function")try{return saveOwnGear(t),typeof document<"u"&&typeof document.dispatchEvent=="function"&&typeof CustomEvent=="function"&&document.dispatchEvent(new CustomEvent("own-gear-data-changed")),!0}catch(r){console.warn("Unable to persist own gear items via storage for gear editor.",r)}return!1}function lookupOwnGearRecord(e,t,o){if(!Array.isArray(e))return{index:-1,record:null};const r=typeof t=="string"?t.trim():"",n=typeof o=="string"?o.trim().toLowerCase():"";let a=-1;return r&&(a=e.findIndex(s=>s&&s.id===r)),a===-1&&n&&(a=e.findIndex(s=>!s||typeof s.name!="string"?!1:s.name.trim().toLowerCase()===n)),{index:a,record:a>=0?e[a]:null}}function deriveOwnGearSourceForElement(e){return!e||typeof e!="object"||!e.classList?OWN_GEAR_SOURCE_CATALOG_VALUE:e.classList.contains("gear-custom-item")?OWN_GEAR_SOURCE_CUSTOM_VALUE:OWN_GEAR_SOURCE_CATALOG_VALUE}function syncGearItemOwnedState(e,t,o={}){const r=!!(o&&o.wantsOwned),n=o&&typeof o.existingId=="string"?o.existingId.trim():"",a=loadOwnGearRecordsForEditor(),s=typeof t.name=="string"?t.name.trim():"",l=typeof t.quantity=="string"?t.quantity.trim():"",{index:u,record:d}=lookupOwnGearRecord(a,n,s);if(r&&s){if(d&&u>=0){let C=!1;const A={...d};d.name!==s&&(A.name=s,C=!0),l?d.quantity!==l&&(A.quantity=l,C=!0):d.quantity&&(delete A.quantity,C=!0);const w=deriveOwnGearSourceForElement(e);if(w&&d.source!==w&&(A.source=w,C=!0),!C)return{id:d.id,changed:!1};const R=normalizeOwnGearRecordForEditor(A);if(!R)return{id:d.id,changed:!1};const _=a.slice();return _[u]=R,persistOwnGearRecordsForEditor(_)?{id:R.id,changed:!0}:{id:d.id,changed:!1}}const y={id:generateOwnGearIdForEditor(),name:s};l&&(y.quantity=l);const h=deriveOwnGearSourceForElement(e);h&&(y.source=h);const b=normalizeOwnGearRecordForEditor(y);if(!b)return{id:"",changed:!1};const v=a.slice();return v.push(b),persistOwnGearRecordsForEditor(v)?{id:b.id,changed:!0}:{id:"",changed:!1}}if(!d||u<0)return{id:"",changed:!1};const m=a.filter((y,h)=>h!==u);return persistOwnGearRecordsForEditor(m)?{id:"",changed:!0}:{id:d.id,changed:!1}}function findOwnedRecordForGearItem(e,t={}){const o=typeof t.name=="string"?t.name.trim():"",r=typeof t.existingId=="string"?t.existingId.trim():"",n=loadOwnGearRecordsForEditor();return lookupOwnGearRecord(n,r,o).record}function guessDefaultProvider(e){const t=typeof e=="string"?e.trim():"";return t&&getOwnGearNameSet().has(t.toLowerCase())?"user":"rental-house"}function ensureGearItemProviderElement(e){if(!e)return null;let t=e.querySelector(".gear-item-provider");if(t)return t;const o=e.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;if(t=o.createElement("span"),t.className="gear-item-provider",t.hidden=!0,e.classList?.contains("gear-custom-item")){const a=e.querySelector(".gear-custom-item-summary"),s=e.querySelector(".gear-item-note");if(a)return s?a.insertBefore(t,s):a.appendChild(t),t}const n=e.querySelector(".gear-item-note")||e.querySelector(".gear-item-edit-btn")||e.querySelector(".gear-custom-item-actions")||e.querySelector(".gear-custom-remove-btn");return n&&n.parentElement?n.parentElement.insertBefore(t,n):e.appendChild(t),t}function formatUserProfileProviderName$1(e){const t=typeof e=="string"?e.trim():"";if(!t)return"";const o=t.split(/\s+/).filter(Boolean);if(!o.length)return"";const r=o[0];if(o.length===1)return r;const n=o[o.length-1],a=Array.from(n)[0]||"";if(!a)return r;const s=typeof a.toLocaleUpperCase=="function"?a.toLocaleUpperCase():a.toUpperCase();return`${r} ${s}`}function getProviderInfo(e,t={}){const o=typeof e=="string"?e.trim():"",r=getGearProviderTexts();if(!o)return{value:"",label:"",type:""};if(o==="rental-house")return{value:"rental-house",label:r.rental,type:"rental"};if(o==="user"){const n=typeof getUserProfileSnapshot=="function"?getUserProfileSnapshot():null,a=n&&n.name?n.name:"",s=formatUserProfileProviderName$1(a);return{value:"user",label:s?`${s} — ${r.user}`:t.label||r.user,type:"user",profileName:a,profileDisplayName:s}}if(o.startsWith("contact:")){const n=o.slice(8),a=typeof getContactById=="function"?getContactById(n):null;if(a){const l=typeof getContactDisplayLabel=="function"?getContactDisplayLabel(a):a.name||a.email||a.phone||a.id||r.crewHeading;return{value:o,label:l,type:"contact",contactId:n}}const s=t&&t.label||(typeof getContactsText=="function"?getContactsText("missingContactFallback","Saved contact"):"Saved contact");return{value:o,label:s,type:"contact",contactId:n,missing:!0}}return{value:o,label:t&&t.label?t.label:r.unknown,type:"custom"}}function setGearItemProvider$1(e,t,o={}){if(!e)return;const r=getProviderInfo(t||e.getAttribute("data-gear-provider")||"",{label:o.label});r.value?e.setAttribute("data-gear-provider",r.value):e.removeAttribute("data-gear-provider"),r.label?e.setAttribute("data-gear-provider-label",r.label):e.removeAttribute("data-gear-provider-label");const n=ensureGearItemProviderElement(e);n&&(r.label?(n.textContent=r.label,n.hidden=!1,n.setAttribute("data-provider-type",r.type||""),n.setAttribute("title",r.label),n.setAttribute("data-help",r.label)):(n.textContent="",n.hidden=!0,n.removeAttribute("data-provider-type"),n.removeAttribute("title"),n.removeAttribute("data-help")))}function getProviderOptionLabel(e){return e?e.textContent?e.textContent.trim():e.value:""}function updateGearItemEditProviderOptions(e,t={}){if(!e||!e.providerSelect)return;const o=e.providerSelect;for(;o.firstChild;)o.removeChild(o.firstChild);const r=getGearProviderTexts(),n=typeof getUserProfileSnapshot=="function"?getUserProfileSnapshot():null,a=typeof getContactsSnapshot=="function"?getContactsSnapshot():[],s=o.ownerDocument||(typeof document<"u"?document:null);if(!s)return;const l=s.createElement("option");l.value="rental-house",l.textContent=r.rental,o.appendChild(l);const u=s.createElement("option");u.value="user";const d=n&&n.name?n.name:"",m=formatUserProfileProviderName$1(d);if(u.textContent=m?`${m} — ${r.user}`:r.user,o.appendChild(u),a.length){const h=s.createElement("optgroup");h.label=r.crewHeading,a.forEach(b=>{const v=s.createElement("option");v.value=`contact:${b.id}`,v.textContent=b.label||b.name||b.email||b.phone||b.id,h.appendChild(v)}),o.appendChild(h)}const y=typeof t.providedBy=="string"&&t.providedBy.trim()?t.providedBy.trim():guessDefaultProvider(t.name||"");if(y&&!Array.from(o.options).some(h=>h.value===y)){const h=s.createElement("option");h.value=y,h.textContent=t.providerLabel||(typeof getContactsText=="function"?getContactsText("missingContactFallback","Saved contact"):r.unknown),h.setAttribute("data-provider-fallback","true"),o.appendChild(h)}o.value=y||"rental-house"}function updateGearItemEditCameraLinkOptions(e,t={}){if(!e||!e.cameraLinkSelect)return;const o=e.cameraLinkSelect;for(;o.firstChild;)o.removeChild(o.firstChild);const r=o.ownerDocument||(typeof document<"u"?document:null);if(!r)return;const n=getGearItemEditTexts();if(!!e.isCameraItem){CAMERA_LINK_LETTERS.forEach(y=>{const h=r.createElement("option");h.value=y;const b=n.cameraLinkDefaultLabel;h.textContent=b.replace("%s",y),h.dataset.cameraLabel=b.replace("%s",y),o.appendChild(h)});const m=normalizeCameraLetter(typeof t.cameraLink=="string"&&t.cameraLink?t.cameraLink:e.currentCameraLinkValue||"")||"A";o.value=m,o.disabled=!1,o.removeAttribute("aria-disabled");return}const s=r.createElement("option");s.value="",s.textContent=n.cameraLinkNoneOption,o.appendChild(s);const l=collectCameraSourceEntries(),u=new Map;l.forEach(m=>{!m||!m.letter||u.set(m.letter,m)}),CAMERA_LINK_LETTERS.forEach(m=>{const y=r.createElement("option");y.value=m;const h=u.get(m),b=n.cameraLinkCameraOption,v=n.cameraLinkUnavailableOption,C=h&&h.label?b.replace("%s",m).replace("%s",h.label):v.replace("%s",m);y.textContent=C;const A=typeof t.cameraLinkLabel=="string"?t.cameraLinkLabel.trim():"";if(h&&h.label)y.dataset.cameraLabel=h.label;else if(A&&normalizeCameraLetter(t.cameraLink)===m)y.dataset.cameraLabel=A;else{const w=n.cameraLinkDefaultLabel;y.dataset.cameraLabel=w.replace("%s",m)}y.dataset.cameraColor=getCameraLetterColor(m),o.appendChild(y)});const d=normalizeCameraLetter(typeof t.cameraLink=="string"&&t.cameraLink?t.cameraLink:e.currentCameraLinkValue||"");o.value=d||""}function refreshGearItemProviderDisplays(e){const t=gearListOutput;if(!t)return;t.querySelectorAll(".gear-item, .gear-custom-item").forEach(r=>{const n=getGearItemData(r);setGearItemProvider$1(r,n.providedBy,{label:n.providerLabel})}),refreshRentalProviderNoteDisplays()}async function handleShareSetupClick(){const e=getShareUiContext(this),t=e.dialog,o=e.form,r=e.filenameInput,n=e.filenameMessage,a=e.includeAutoGearCheckbox,s=e.includeAutoGearLabel;saveCurrentGearList$1();const l=safeGetCurrentProjectName$1(),u=getDefaultShareFilename(l),d=ensureJsonExtension(u);if(!t||!o||!r){const C=promptForSharedFilename(l);if(!C)return;const A=getAutoGearRules(),w=Array.isArray(A)&&A.length>0;let R=!1;w&&(R=await confirmAutoGearSelection(a?a.checked:!1)),a&&(a.checked=R&&w);const _=hasOwnedGearItemsForExport(gearListOutput),G=_;e.includeOwnedGearCheckbox&&(e.includeOwnedGearCheckbox.checked=G&&_),downloadSharedProject$1(C,R,G);return}if(r.value=d,r.setCustomValidity(""),n){const C=getLocalizedText("shareFilenamePrompt")||"";n.textContent=C.includes("{defaultName}")?C.replace("{defaultName}",u):C}const m=getAutoGearRules(),y=Array.isArray(m)&&m.length>0,h=hasOwnedGearItemsForExport(gearListOutput);a&&(a.disabled=!y,a.setAttribute("aria-disabled",y?"false":"true"),y||(a.checked=!1)),s&&(s.classList.toggle("disabled",!y),s.setAttribute("aria-disabled",y?"false":"true"));const b=e.includeOwnedGearCheckbox,v=e.includeOwnedGearLabel;b&&(b.disabled=!h,b.setAttribute("aria-disabled",h?"false":"true"),b.checked=h),v&&(v.classList.toggle("disabled",!h),v.setAttribute("aria-disabled",h?"false":"true")),openDialog(t),typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{r&&(r.focus(),r.select())}):r&&setTimeout(()=>{r.focus(),r.select()},0)}const shareSetupButton=resolveElementById("shareSetupBtn","shareSetupBtn");shareSetupButton&&shareSetupButton.addEventListener("click",handleShareSetupClick);function handleShareFormSubmit(e){e.preventDefault();const t=getShareUiContext(this),o=t.filenameInput,r=t.dialog,n=t.includeAutoGearCheckbox,a=t.includeOwnedGearCheckbox;if(!o)return;const s=sanitizeShareFilename(o.value);if(!s){const m=getLocalizedText("shareFilenameInvalid")||"Please enter a valid file name to continue.";o.setCustomValidity(m),o.reportValidity();return}o.setCustomValidity("");const l=ensureJsonExtension(s),u=!!(n&&!n.disabled&&n.checked),d=!!(a&&!a.disabled&&a.checked);closeDialog(r),downloadSharedProject$1(l,u,d)}function handleShareCancelClick(){const e=getShareUiContext(this),t=e.filenameInput,o=e.dialog;t&&t.setCustomValidity(""),closeDialog(o)}function handleShareDialogCancel(e){e.preventDefault();const t=getShareUiContext(this),o=t.filenameInput,r=t.dialog;o&&o.setCustomValidity(""),closeDialog(r)}const initialShareUiContext=getShareUiContext();initialShareUiContext.form&&initialShareUiContext.form.addEventListener("submit",handleShareFormSubmit);initialShareUiContext.cancelButton&&initialShareUiContext.cancelButton.addEventListener("click",handleShareCancelClick);initialShareUiContext.dialog&&initialShareUiContext.dialog.addEventListener("cancel",handleShareDialogCancel);function handleSharedLinkInputChange(){const t=getShareUiContext(this).sharedLinkInput;if(!t||pendingSharedLinkListener)return;const o=t.files&&t.files[0];o&&readSharedProjectFile(o)}function handleApplySharedLinkClick(){const t=getShareUiContext(this).sharedLinkInput;if(!t)return;pendingSharedLinkListener&&(t.removeEventListener("change",pendingSharedLinkListener),pendingSharedLinkListener=null);const o=()=>{t.removeEventListener("change",o),pendingSharedLinkListener=null;const r=t.files&&t.files[0];r&&readSharedProjectFile(r)};pendingSharedLinkListener=o,t.addEventListener("change",o),t.value="",t.click(),t.files&&t.files.length&&o()}initialShareUiContext.sharedLinkInput&&initialShareUiContext.sharedLinkInput.addEventListener("change",handleSharedLinkInputChange);initialShareUiContext.applySharedLinkButton&&initialShareUiContext.sharedLinkInput&&initialShareUiContext.applySharedLinkButton.addEventListener("click",handleApplySharedLinkClick);function handleSharedImportModeChange(){sharedImportPromptActive||lastSharedSetupData!==null&&reapplySharedImportSelection()}function handleSharedImportSubmit(e){e.preventDefault(),finalizeSharedImportPrompt(),applyStoredSharedImport()}function handleSharedImportCancel(){finalizeSharedImportPrompt(),clearStoredSharedImportData()}function handleSharedImportDialogCancel(e){e.preventDefault(),finalizeSharedImportPrompt(),clearStoredSharedImportData()}const initialSharedImportUiContext=getSharedImportUiContext();initialSharedImportUiContext.modeSelect&&initialSharedImportUiContext.modeSelect.addEventListener("change",handleSharedImportModeChange);initialSharedImportUiContext.form&&initialSharedImportUiContext.form.addEventListener("submit",handleSharedImportSubmit);initialSharedImportUiContext.cancelButton&&initialSharedImportUiContext.cancelButton.addEventListener("click",handleSharedImportCancel);initialSharedImportUiContext.dialog&&initialSharedImportUiContext.dialog.addEventListener("cancel",handleSharedImportDialogCancel);enqueueCineUiRegistration$1(registerSetupsCineUiInternal);function getSafeLanguageTexts(){const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,t=typeof texts<"u"&&texts||(e&&typeof e.texts=="object"?e.texts:null),o=typeof currentLang=="string"&&t&&typeof t[currentLang]=="object"?currentLang:"en",r=t&&typeof t[o]=="object"&&t[o]||{},n=t&&typeof t.en=="object"&&t.en||{};return{langTexts:r,fallbackTexts:n}}function registerSetupsCineUiInternal(e){if(!e||setupsCineUiRegistered)return;const t=getShareUiContext(),o=getSharedImportUiContext();registerCineUiEntries$1(e.controllers,[{name:"shareDialog",value:{context:t,open:handleShareSetupClick,submit:handleShareFormSubmit,cancel:handleShareCancelClick,dismiss:handleShareDialogCancel}},{name:"sharedImportDialog",value:{context:o,submit:handleSharedImportSubmit,cancel:handleSharedImportCancel,dismiss:handleSharedImportDialogCancel,changeMode:handleSharedImportModeChange}}],"cineUi controller registration (setups) failed"),registerCineUiEntries$1(e.interactions,[{name:"shareOpen",value:handleShareSetupClick},{name:"shareSubmit",value:handleShareFormSubmit},{name:"shareCancel",value:handleShareCancelClick},{name:"shareApplyFile",value:handleApplySharedLinkClick},{name:"shareInputChange",value:handleSharedLinkInputChange},{name:"sharedImportSubmit",value:handleSharedImportSubmit},{name:"sharedImportCancel",value:handleSharedImportCancel}],"cineUi interaction registration (setups) failed"),registerCineUiEntries$1(e.help,[{name:"shareProject",value:()=>{const{langTexts:r,fallbackTexts:n}=getSafeLanguageTexts();return r.shareSetupHelp||n.shareSetupHelp||"Download a JSON safety bundle of the current project so you can archive or share it offline. Store the file with your crew backups before closing the planner."}},{name:"sharedImport",value:()=>{const{langTexts:r,fallbackTexts:n}=getSafeLanguageTexts();return r.applySharedLinkHelp||n.applySharedLinkHelp||"Load the configuration from a JSON backup exported via Save & Share or Backup & Restore. Review the preview before applying—nothing overwrites your current project until you confirm Save."}}],"cineUi help registration (setups) failed"),setupsCineUiRegistered=areSetupsEntriesRegistered(e)}function registerSetupsCineUi(){const e=typeof globalThis<"u"&&globalThis.cineUi||typeof window<"u"&&window.cineUi||typeof self<"u"&&self.cineUi||null;return e?(registerSetupsCineUiInternal(e),!0):!1}console.log("Registering setups with cineUi...");const result=registerSetupsCineUi();console.log("Setups registration status:",result);const cineResultsModule=typeof cineResults=="object"?cineResults:null;cineResultsModule&&typeof cineResultsModule.setupRuntimeFeedback=="function"&&cineResultsModule.setupRuntimeFeedback({openDialog:typeof openDialog=="function"?openDialog:null,closeDialog:typeof closeDialog=="function"?closeDialog:null,getCurrentSetupKey:typeof getCurrentSetupKey=="function"?getCurrentSetupKey:null,loadFeedback:typeof loadFeedbackSafe=="function"?loadFeedbackSafe:typeof loadFeedback=="function"?loadFeedback:null,saveFeedback:typeof saveFeedbackSafe=="function"?saveFeedbackSafe:typeof saveFeedback=="function"?saveFeedback:null,updateCalculations:typeof updateCalculations=="function"?updateCalculations:null,setButtonLabelWithIcon:typeof setButtonLabelWithIconForSetups=="function"?setButtonLabelWithIconForSetups:null,iconGlyphs:typeof ICON_GLYPHS<"u"?ICON_GLYPHS:null});function summarizeByType(e){return Array.isArray(e)?e.reduce((t,o)=>(o?.type&&(t[o.type]=(t[o.type]||0)+1),t),{}):{}}function renderInfoLabel(e){const t=e!=null?String(e).trim():"";return t?`<span class="info-box-label">${escapeHtml$2(t)}:</span> `:""}function connectorBlocks(e,t,o="neutral-conn",r="",n=""){if(!Array.isArray(e)||e.length===0)return"";const a=summarizeByType(e),s=Object.entries(a).map(([m,y])=>`${escapeHtml$2(m)}${y>1?` ×${y}`:""}`);if(!s.length)return"";const l=r?`${r}${n?` ${n}`:""}`:"",u=renderInfoLabel(l),d=iconMarkup(t,"connector-icon");return`<span class="connector-block ${o}">${d}${u}${s.join(", ")}</span>`}function generateConnectorSummary$1(e){if(!e||typeof e!="object")return"";const t=O=>{if(typeof O!="string")return"";const B=O.trim().toLowerCase();return B==="imperial"||B==="metric"?B:""},r=(()=>{const O=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,$=(O&&typeof O.focusScalePreference=="string"?O.focusScalePreference:null)||(typeof focusScalePreference=="string"?focusScalePreference:null)||"metric";if(typeof normalizeFocusScale=="function")try{const M=normalizeFocusScale($);if(M==="imperial"||M==="metric")return M}catch{}return t($)||"metric"})(),n=typeof currentLang=="string"&&currentLang.trim()?currentLang:"en",a=(O,B={})=>{const $=typeof O=="string"?Number(O):O;if(!Number.isFinite($))return"";const V=typeof B.maximumFractionDigits=="number"?B.maximumFractionDigits:0,M=typeof B.minimumFractionDigits=="number"?B.minimumFractionDigits:Math.min(0,V);if(typeof Intl<"u"&&typeof Intl.NumberFormat=="function")try{return new Intl.NumberFormat(n,{maximumFractionDigits:V,minimumFractionDigits:M}).format($)}catch{}const F=Math.max(M,Math.min(20,V));try{return $.toFixed(F)}catch{}return String($)},s=(O,B=r)=>{const $=typeof O=="string"?Number(O):O;if(!Number.isFinite($))return"";if(B==="imperial"){const F=$/453.59237,z=F>=10?1:2,x=a(F,{maximumFractionDigits:z,minimumFractionDigits:0});return x?`${x} lb`:""}const M=a($,{maximumFractionDigits:0,minimumFractionDigits:0});return M?`${M} g`:""};let l="";const u=[{items:e.power?.powerDistributionOutputs,icon:diagramConnectorIcons.powerOut,cls:"power-conn",label:"Power",dir:"Out"},{items:powerInputTypes(e).map(O=>({type:O})),icon:diagramConnectorIcons.powerIn,cls:"power-conn",label:"Power",dir:"In"},{items:e.fizConnectors,icon:diagramConnectorIcons.fiz,cls:"fiz-conn",label:"FIZ Port"},{items:e.video?.inputs||e.videoInputs,icon:diagramConnectorIcons.video,cls:"video-conn",label:"Video",dir:"In"},{items:e.video?.outputs||e.videoOutputs,icon:diagramConnectorIcons.video,cls:"video-conn",label:"Video",dir:"Out"},{items:e.timecode,icon:diagramConnectorIcons.timecode,cls:"neutral-conn",label:"Timecode"},{items:e.audioInput?.portType?[{type:e.audioInput.portType}]:void 0,icon:diagramConnectorIcons.audioIn,cls:"neutral-conn",label:"Audio",dir:"In"},{items:e.audioOutput?.portType?[{type:e.audioOutput.portType}]:void 0,icon:diagramConnectorIcons.audioOut,cls:"neutral-conn",label:"Audio",dir:"Out"},{items:e.audioIo?.portType?[{type:e.audioIo.portType}]:void 0,icon:diagramConnectorIcons.audioIo,cls:"neutral-conn",label:"Audio",dir:"I/O"}];for(const{items:O,icon:B,cls:$,label:V,dir:M}of u)l+=connectorBlocks(O,B,$,V,M);let d="";if(typeof e.powerDrawWatts=="number"&&(d+=`<span class="info-box power-conn">${iconMarkup(diagramConnectorIcons.powerSpec)}${renderInfoLabel("Power")}${e.powerDrawWatts} W</span>`),e.power?.input?.voltageRange&&(d+=`<span class="info-box power-conn">${iconMarkup(ICON_GLYPHS.batteryBolt)}${renderInfoLabel("Voltage")}${escapeHtml$2(String(e.power.input.voltageRange))}V</span>`),typeof e.weight_g=="number"){const O=s(e.weight_g);O&&(d+=`<span class="info-box neutral-conn">${iconMarkup(ICON_GLYPHS.gears)}${renderInfoLabel("Weight")}${escapeHtml$2(O)}</span>`)}typeof e.capacity=="number"&&(d+=`<span class="info-box power-conn">${iconMarkup(ICON_GLYPHS.batteryFull)}${renderInfoLabel("Capacity")}${e.capacity} Wh</span>`);const m=parseBatteryCurrentLimit(e.pinA);Number.isFinite(m)&&m>0&&(d+=`<span class="info-box power-conn">${renderInfoLabel("Pins")}${m}A</span>`),typeof e.dtapA=="number"&&(d+=`<span class="info-box power-conn">${renderInfoLabel("D-Tap")}${e.dtapA}A</span>`),e.mount_type&&(d+=`<span class="info-box power-conn">${renderInfoLabel("Mount")}${escapeHtml$2(String(e.mount_type))}</span>`),typeof e.screenSizeInches=="number"&&(d+=`<span class="info-box video-conn">${iconMarkup(DIAGRAM_MONITOR_ICON)}${renderInfoLabel("Screen")}${e.screenSizeInches}"</span>`),typeof e.brightnessNits=="number"&&(d+=`<span class="info-box video-conn">${iconMarkup(ICON_GLYPHS.brightness)}${renderInfoLabel("Brightness")}${e.brightnessNits} nits</span>`),typeof e.wirelessTx=="boolean"&&(d+=`<span class="info-box video-conn">${iconMarkup(ICON_GLYPHS.wifi)}${renderInfoLabel("Wireless")}${e.wirelessTx}</span>`),e.internalController&&(d+=`<span class="info-box fiz-conn">${iconMarkup(diagramConnectorIcons.controller)}${renderInfoLabel("Controller")}Internal</span>`),typeof e.torqueNm=="number"&&(d+=`<span class="info-box fiz-conn">${iconMarkup(diagramConnectorIcons.torque)}${renderInfoLabel("Torque")}${e.torqueNm} Nm</span>`),e.powerSource&&(d+=`<span class="info-box power-conn">${iconMarkup(diagramConnectorIcons.powerSource)}${renderInfoLabel("Power Source")}${escapeHtml$2(String(e.powerSource))}</span>`);const y=O=>{if(!Array.isArray(O))return[];const B=new Set,$=[];return O.forEach(V=>{const M=V!=null?String(V).trim():"";!M||B.has(M)||(B.add(M),$.push(escapeHtml$2(M)))}),$},h=(O,B,$,V,M)=>{const F=y(B);if(!F.length)return O;const z=iconMarkup(M),x=renderInfoLabel($),H=`<span class="info-box-values">${F.join(", ")}</span>`;return`${O}<span class="info-box ${V} info-box-list">${z}${x}${H}</span>`};let b="";if(Array.isArray(e.sensorModes)&&(b=h(b,e.sensorModes,"Sensor Modes","video-conn",ICON_GLYPHS.sensor)),Array.isArray(e.resolutions)&&(b=h(b,e.resolutions,"Resolutions","video-conn",ICON_GLYPHS.screen)),Array.isArray(e.frameRates)){const O=diagramConnectorIcons?.timecode||ICON_GLYPHS.camera;b=h(b,e.frameRates,"Frame Rates","video-conn",O)}if(Array.isArray(e.recordingCodecs)&&(b=h(b,e.recordingCodecs,"Codecs","video-conn",ICON_GLYPHS.camera)),Array.isArray(e.recordingMedia)){const O=e.recordingMedia.map(B=>B&&B.type?B.type:"");b=h(b,O,"Media","video-conn",ICON_GLYPHS.save)}let v="";if(Array.isArray(e.power?.batteryPlateSupport)&&e.power.batteryPlateSupport.length){const O=e.power.batteryPlateSupport.map(B=>{const $=B.mount?` (${escapeHtml$2(B.mount)})`:"";return`${escapeHtml$2(B.type)}${$}`});v+=`<span class="info-box power-conn">${renderInfoLabel("Battery Plate")}${O.join(", ")}</span>`}if(Array.isArray(e.viewfinder)&&e.viewfinder.length){const O=e.viewfinder.map(B=>escapeHtml$2(B.type));v+=`<span class="info-box video-conn">${renderInfoLabel("Viewfinder")}${O.join(", ")}</span>`}if(Array.isArray(e.gearTypes)&&e.gearTypes.length){const O=e.gearTypes.map(B=>escapeHtml$2(B));v+=`<span class="info-box fiz-conn">${renderInfoLabel("Gear")}${O.join(", ")}</span>`}e.connectivity&&(v+=`<span class="info-box video-conn">${renderInfoLabel("Connectivity")}${escapeHtml$2(String(e.connectivity))}</span>`),e.notes&&(v+=`<span class="info-box neutral-conn">${renderInfoLabel("Notes")}${escapeHtml$2(String(e.notes))}</span>`);let C="";if(Array.isArray(e.lensMount)){const O=e.lensMount.map(B=>{const $=B.mount?` (${escapeHtml$2(B.mount)})`:"";return`<span class="info-box neutral-conn">${escapeHtml$2(B.type)}${$}</span>`}).join("");O&&(C=`<div class="lens-mount-box">${O}</div>`)}let A="";const w=(O,B)=>B?`<div class="info-label">${O}</div>${B}`:"";A+=w("Ports",l),A+=w("Specs",d),A+=w("Recording",b),A+=w("Extras",v),C&&(A+=`<div class="info-label">Lens Mount</div>${C}`);const R=new Set(["power","powerDrawWatts","weight_g","capacity","pinA","dtapA","mount_type","screenSizeInches","brightnessNits","wirelessTx","internalController","torqueNm","powerSource","sensorModes","resolutions","frameRates","recordingCodecs","recordingMedia","viewfinder","gearTypes","connectivity","notes","lensMount","video","videoInputs","videoOutputs","fizConnectors","timecode","audioInput","audioOutput","audioIo"]);let _="";const G=O=>O.replace(/([A-Z])/g," $1").replace(/^./,B=>B.toUpperCase()).replace(/_/g," ").trim();return Object.entries(e).forEach(([O,B])=>{if(R.has(O)||B==null||B==="")return;if(O==="verified_source"){const V=String(B);_+=`<span class="info-box neutral-conn"><a href="${escapeHtml$2(V)}" target="_blank" rel="noopener noreferrer" style="color:inherit;text-decoration:underline;">Source</a></span>`;return}const $=G(O);if(Array.isArray(B)){const V=B.map(M=>typeof M=="string"?M:JSON.stringify(M));if(V.length){const M=`<span class="info-box-values">${V.map(escapeHtml$2).join(", ")}</span>`,F=typeof ICON_GLYPHS<"u"&&ICON_GLYPHS.fileText?iconMarkup(ICON_GLYPHS.fileText):"";_+=`<span class="info-box neutral-conn info-box-list">${F}${renderInfoLabel($)}${M}</span>`}}else if(typeof B!="object"){let V=String(B);typeof B=="boolean"&&(V=B?"Yes":"No"),_+=`<span class="info-box neutral-conn">${renderInfoLabel($)}${escapeHtml$2(V)}</span>`}}),_&&(A+=w("Other Attributes",_)),A?`<div class="connector-summary">${A}</div>`:""}function suggestChargerCounts(e){let t=Math.floor(e/4);const o=e%4;let r=0,n=0;return o===0||(o===3?t+=1:o>0&&(r+=1)),{quad:t,dual:r,single:n}}function addArriKNumber$1(e){if(!e)return e;const t=typeof devices<"u"?devices:{},o=[t.viewfinders,t.directorMonitors,t.iosVideo,t.videoAssist,t.media,t.lenses];for(const r of o)if(r&&r[e]){const n=r[e];return n.brand&&n.brand.toUpperCase().includes("ARRI")&&n.kNumber&&!e.includes(n.kNumber)?e.replace(/^ARRI\s*/i,`ARRI ${n.kNumber} `):e}if(t.accessories){const r=n=>{if(!n)return null;if(n[e])return n[e];for(const a of Object.values(n))if(a&&typeof a=="object"){const s=r(a);if(s)return s}return null};for(const n of Object.values(t.accessories)){const a=r(n);if(a)return a.brand&&a.brand.toUpperCase().includes("ARRI")&&a.kNumber&&!e.includes(a.kNumber)?/^ARRI\s*/i.test(e)?e.replace(/^ARRI\s*/i,`ARRI ${a.kNumber} `):`ARRI ${a.kNumber} ${e}`:e}}return e}const sanitizeFizContext=e=>(e||"").replace(/[()]/g,"").replace(/\s{2,}/g," ").trim(),formatFizCable=(e,t)=>{const o=sanitizeFizContext(t);return o?`${e} (${o})`:e};function suggestArriFizCables(){const e="LBUS to LBUS 0,5m",t="Cable UDM – SERIAL (4p) 0,5m",o="Cable UDM – SERIAL (7p) 1,5m",r=[],n=[],a=[],s=cameraSelect?.value||"",l=motorSelects.map($=>$.value).filter($=>$&&$!=="None"),u=controllerSelects.map($=>$.value).filter($=>$&&$!=="None"),d=distanceSelect?.value||"",m=l[0]||"",y=u.includes("Arri Master Grip (single unit)"),h=u.includes("Arri RIA-1");let b=d.includes("UDM"),v=d.includes("LCube");v&&(h||s==="Arri Alexa 35")&&(v=!1);const C=/cforce mini rf/i.test(m),A=/cforce mini/i.test(m)&&!C,w=m?`for ${m}`:"for FIZ motor",R="for Arri Master Grip (single unit)",_=d?`for ${d}`:"for distance sensor",G=[];h&&G.push("Arri RIA-1"),C&&G.push("Arri cforce mini RF");const O=G[0]||u[0]||"",B=($,V)=>{const M=String($).replace(".",","),F=V||w;r.push(formatFizCable(`LBUS to LBUS ${M}m`,F)),n.push(Number($))};if((s==="Arri Alexa Mini"||s==="Arri Alexa Mini LF")&&A?(B(.3),v&&B(.4,_),y&&B(.5,R)):s==="Arri Alexa 35"&&A?(B(.3),y&&B(.5,R)):C?(v&&B(.4,_),y&&B(.5,R)):h&&A&&(B(.4),y&&B(.5,R)),G.length){const $=devices.accessories?.cables||{};let V=null;for(const[M,F]of Object.entries($)){const z=[];Array.isArray(F.connectors)&&z.push(...F.connectors),F.from&&z.push(F.from),F.to&&z.push(F.to),!(!z.some(W=>/CAM \(7-pin/i.test(W))||!(F.compatibleControllers||[]).some(W=>G.some(U=>W.toLowerCase().includes(U.toLowerCase())))||!(!F.compatibleCameras||F.compatibleCameras.some(W=>W.toLowerCase()===s.toLowerCase())))&&(!V||(F.lengthM??1/0)<($[V].lengthM??1/0))&&(V=M)}if(V){const M=s?`for ${s}`:"for camera control";r.push(formatFizCable(V,M)),a.push(V)}else if(h&&$["Cable CAM (7-pin) – D-Tap 0,5m"]){const M="Cable CAM (7-pin) – D-Tap 0,5m",F=O?`for ${O} power`:"for controller power";r.push(formatFizCable(M,F)),a.push(M)}}if(b&&(v?r.push(formatFizCable(o,_)):(r.push(formatFizCable(t,_)),r.push(formatFizCable(t,"spare")))),n.length){const $=Math.min(...n),V=String($).replace(".",",");r.push(formatFizCable(`LBUS to LBUS ${V}m`,"spare")),r.push(formatFizCable(e,"spare"))}return a.forEach($=>r.push(formatFizCable($,"spare"))),r}function collectAccessories({hasMotor:e=!1,videoDistPrefs:t=[]}={}){const o=(ne,Ce)=>Ce||(typeof document<"u"?document.getElementById(ne):null),r=o("cameraSelect",typeof cameraSelect<"u"?cameraSelect:null),n=o("monitorSelect",typeof monitorSelect<"u"?monitorSelect:null),a=o("videoSelect",typeof videoSelect<"u"?videoSelect:null),s=o("batterySelect",typeof batterySelect<"u"?batterySelect:null),l=o("cageSelect",typeof cageSelect<"u"?cageSelect:null),u=o("distanceSelect",typeof distanceSelect<"u"?distanceSelect:null),d=ne=>ne&&typeof ne.value<"u"?ne.value:"",m=d(r),y=d(n),h=d(a),b=d(s),v=d(l),C=d(u),A=[],w=[],R=[],_=[],G=[],O=[],B=devices.accessories||{},$=new Set(["D-Tap to LEMO 2-pin","HDMI Cable"]);if(b){const ne=(devices&&devices.batteries&&devices.batteries[b])?.mount_type;if(B.powerPlates)for(const[Ce,Ee]of Object.entries(B.powerPlates))(!Ee.mount||Ee.mount===ne)&&(!Ee.compatible||Ee.compatible.includes(m))&&A.push(Ce);if(B.chargers){let Ce=parseInt(batteryCountElem?.textContent||"",10);Number.isFinite(Ce)||(Ce=b?1:0);let Ee=0;if(Array.isArray(t)){const et=t.filter(it=>/Monitor(?: \d+")? handheld$/.test(it)).length;Ee+=et*3;const Je=t.filter(it=>{const rt=it.match(/Monitor (\d+(?:\.\d+)?)/);return rt&&parseFloat(rt[1])>10&&!/handheld$/.test(it)}).length;Ee+=Je*2}e&&(Ee+=3);const Pe=(et,Je)=>{if(!et||Je<=0)return;const it=suggestChargerCounts(Je),rt=vt=>{for(const[bo,Et]of Object.entries(B.chargers))if(Et.mount===et&&Et.slots===vt)return bo;return null},Pt=(vt,bo)=>{const Et=rt(vt);if(Et)for(let Ut=0;Ut<bo;Ut++)G.push(Et)};Pt(4,it.quad),Pt(2,it.dual),Pt(1,it.single)};ne==="B-Mount"?(Pe("B-Mount",Ce),Pe("V-Mount",Ee)):Pe(ne,Ce+Ee)}}if(m&&B.cages&&(!v||v==="None"))for(const[ne,Ce]of Object.entries(B.cages))(!Ce.compatible||Ce.compatible.includes(m))&&A.push(ne);const V=B.cables?.power||{},M=(ne,Ce=w,Ee=!1)=>{const Pe=ne?.power?.input?.type;(Array.isArray(Pe)?Pe:Pe?[Pe]:[]).forEach(Je=>{for(const[it,rt]of Object.entries(V)){const Pt=$.has(it);rt.to===Je&&(!Pt||Ee)&&Ce.push(it)}})};m&&devices.cameras&&M(devices.cameras[m]),h&&devices.video&&M(devices.video[h]);const F=y&&devices.monitors?devices.monitors[y]:null;if(F){const ne="Onboard monitor",Ce=F?.power?.input?.type;(Array.isArray(Ce)?Ce.includes("LEMO 2-pin"):Ce==="LEMO 2-pin")&&R.push(`D-Tap to Lemo-2-pin Cable 0,5m (${ne})`,`D-Tap to Lemo-2-pin Cable 0,5m (${ne})`);const et=((m&&devices.cameras?devices.cameras[m]:null)?.videoOutputs||[]).map(Pt=>Pt?.type?.toUpperCase()),Je=(F.videoInputs||[]).map(Pt=>Pt?.type?.toUpperCase()),it=et.some(Pt=>Pt&&Pt.includes("SDI"))&&Je.some(Pt=>Pt&&Pt.includes("SDI")),rt=et.includes("HDMI")&&Je.includes("HDMI");it?R.push(`Ultraslim BNC Cable 0.5 m (${ne})`,`Ultraslim BNC Cable 0.5 m (${ne})`):rt&&R.push(`Ultraslim HDMI 0.5 m (${ne})`,`Ultraslim HDMI 0.5 m (${ne})`),_.push(`ULCS Arm mit 3/8" und 1/4" double (${ne})`)}if(h){const ne=h.replace(/ TX\b/," RX");devices.wirelessReceivers&&devices.wirelessReceivers[ne]&&M(devices.wirelessReceivers[ne])}devices.fiz&&devices.fiz.motors&&Array.isArray(motorSelects)&&motorSelects.forEach(ne=>{const Ce=d(ne);Ce&&M(devices.fiz.motors[Ce])}),devices.fiz&&devices.fiz.controllers&&Array.isArray(controllerSelects)&&controllerSelects.forEach(ne=>{const Ce=d(ne);Ce&&M(devices.fiz.controllers[Ce])}),devices.fiz&&devices.fiz.distance&&C&&M(devices.fiz.distance[C]);const z=B.cables?.fiz||{},x=ne=>{const Ce=[];return ne?(Array.isArray(ne.fizConnectors)&&ne.fizConnectors.forEach(Ee=>{const Pe=Ee&&typeof Ee=="object"?Ee.type:Ee;Pe&&Ce.push(Pe)}),ne.fizConnector&&Ce.push(ne.fizConnector),[...new Set(Ce.filter(Boolean))]):Ce},H=(ne,Ce)=>{O.push(formatFizCable(ne,Ce))},W={},U=(ne,Ce)=>{const Ee=[sanitizeFizContext(ne),sanitizeFizContext(Ce)].filter(Boolean);if(!Ee.length)return"";const Pe=Ee.join(" ↔ "),et=Pe.toLowerCase(),Je=(W[et]||0)+1;return W[et]=Je,Je>1?`${Pe} #${Je}`:Pe},j=(ne,Ce,Ee)=>{if(!ne)return!1;const Pe=(et,Je)=>ne.from===et&&ne.to===Je||ne.from===Je&&ne.to===et;if(ne.from&&ne.to&&Pe(Ce,Ee))return!0;if(Array.isArray(ne.connectors)){const et=ne.connectors;if(et.includes(Ce)&&et.includes(Ee))return!0}return!1},Y=motorSelects.map(ne=>d(ne)).filter(ne=>ne&&ne!=="None").map(ne=>({name:ne,data:devices.fiz?.motors?.[ne]})).filter(ne=>ne.data),le=controllerSelects.map(ne=>d(ne)).filter(ne=>ne&&ne!=="None").map(ne=>({name:ne,data:devices.fiz?.controllers?.[ne]})).filter(ne=>ne.data);Y.forEach(ne=>{const Ce=x(ne.data);le.forEach(Ee=>{const Pe=x(Ee.data);Ce.forEach(et=>{Pe.forEach(Je=>{if(et===Je){for(const[it,rt]of Object.entries(z))if(j(rt,et,Je)){const Pt=U(ne.name,Ee.name);H(it,Pt)}}})})})}),suggestArriFizCables().forEach(ne=>O.push(ne));const be=[...new Set(w)],re=R.slice(),de=[...new Set(_)];return{cameraSupport:[...new Set(A)],chargers:G,fizCables:O,misc:be,monitoringSupport:re,rigging:de}}function cloneProjectFormDataSnapshot(e){if(!e||typeof e!="object")return{};const t={...e};return Array.isArray(e.people)&&(t.people=e.people.map(o=>({...o}))),Array.isArray(e.prepDays)&&(t.prepDays=[...e.prepDays]),Array.isArray(e.shootingDays)&&(t.shootingDays=[...e.shootingDays]),Array.isArray(e.returnDays)&&(t.returnDays=[...e.returnDays]),Array.isArray(e.storageRequirements)&&(t.storageRequirements=e.storageRequirements.map(o=>({...o}))),e.monitorBatteries&&typeof e.monitorBatteries=="object"&&(t.monitorBatteries={...e.monitorBatteries}),Array.isArray(e.lensSelections)&&(t.lensSelections=e.lensSelections.map(o=>({...o}))),t}function freezeProjectFormDataSnapshot(e){const t={...e};return Array.isArray(e.people)&&(t.people=PROJECT_FORM_FREEZE(e.people.map(o=>PROJECT_FORM_FREEZE({...o})))),Array.isArray(e.prepDays)&&(t.prepDays=PROJECT_FORM_FREEZE([...e.prepDays])),Array.isArray(e.shootingDays)&&(t.shootingDays=PROJECT_FORM_FREEZE([...e.shootingDays])),Array.isArray(e.returnDays)&&(t.returnDays=PROJECT_FORM_FREEZE([...e.returnDays])),Array.isArray(e.storageRequirements)&&(t.storageRequirements=PROJECT_FORM_FREEZE(e.storageRequirements.map(o=>PROJECT_FORM_FREEZE({...o})))),e.monitorBatteries&&typeof e.monitorBatteries=="object"&&(t.monitorBatteries=PROJECT_FORM_FREEZE({...e.monitorBatteries})),Array.isArray(e.lensSelections)&&(t.lensSelections=PROJECT_FORM_FREEZE(e.lensSelections.map(o=>PROJECT_FORM_FREEZE({...o})))),PROJECT_FORM_FREEZE(t)}function sanitizeCrewAvatarValue(e){if(typeof e!="string")return"";const t=e.trim();return t&&(t.match(/^data:image\/(png|jpeg|jpg|gif|webp);base64,/i)||/^[a-zA-Z0-9._-]+$/.test(t))?t:""}function collectProjectFormData$1(){if(!projectForm)return{};if(!projectFormDataCacheDirty&&projectFormDataCache)return cloneProjectFormDataSnapshot(projectFormDataCache);const e=new FormData(projectForm),t=Y=>{const le=e.get(Y);return typeof le=="string"?le.trim():""},o=Y=>{const le=e.getAll(Y);return!le||le.length===0?"":le.map(be=>typeof be=="string"?be:String(be)).join(", ")},r=o("viewfinderSettings"),n=o("frameGuides"),a=o("aspectMaskOpacity"),s=typeof collectFilterSelections=="function"?collectFilterSelections():"",u=(s?s.split(",").map(Y=>Y.split(":")[0]):[]).some(Y=>Y==="ND Grad HE"||Y==="ND Grad SE")?"Swing Away":t("mattebox"),d=Array.from(crewContainer?.querySelectorAll(".person-row")||[]).map(Y=>{const le=Y.querySelector(".person-role-select")?.value,be=Y.querySelector(".person-name"),re=Y.querySelector(".person-phone"),de=Y.querySelector(".person-email"),ne=Y.querySelector(".person-website"),Ce=Y.querySelector(".person-avatar-data"),Ee=typeof le=="string"?le.trim():le==null?"":String(le),Pe=typeof be?.value=="string"?be.value.trim():"",et=typeof re?.value=="string"?re.value.trim():"",Je=typeof de?.value=="string"?de.value.trim():"",it=typeof ne?.value=="string"?ne.value.trim():"",rt=typeof Ce?.value=="string"?Ce.value.trim():"",Pt=sanitizeCrewAvatarValue(rt);return{role:Ee,name:Pe,phone:et,email:Je,website:it,avatar:Pt}}).filter(Y=>Y.role||Y.name||Y.phone||Y.email||Y.website||Y.avatar),m=(Y,le,be)=>Array.from(Y?.querySelectorAll(".period-row")||[]).map(re=>{const de=re.querySelector(le)?.value,ne=re.querySelector(be)?.value;return[de,ne].filter(Boolean).join(" to ")}).filter(Boolean),y=m(prepContainer,".prep-start",".prep-end"),h=m(shootContainer,".shoot-start",".shoot-end"),b=m(returnContainer,".return-start",".return-end"),v=gearListOutput?(()=>{const Y=["gearListDirectorMonitor","gearListDopMonitor","gearListGafferMonitor","gearListDirectorMonitor15","gearListComboMonitor15","gearListDopMonitor15","gearListFocusMonitor","gearListProGaffColor1","gearListProGaffWidth1","gearListProGaffColor2","gearListProGaffWidth2","gearListEyeLeatherColor"],le=new Map;return Y.forEach(be=>{const re=gearListOutput.querySelector(`#${be}`);if(!re)return;const de=re.value;le.set(be,typeof de=="string"?de:de==null?"":String(de))}),le})():null,C=Y=>v&&v.has(Y)?v.get(Y):"",A=gearListOutput?(()=>{const Y={};return gearListOutput.querySelectorAll("select[data-monitor-battery-key]").forEach(le=>{const be=le.getAttribute("data-monitor-battery-key");if(!be)return;const re=le.value,de=typeof re=="string"?re.trim():re==null?"":String(re);de&&(Y[be]=de)}),Y})():{},w=C("gearListProGaffColor1"),R=C("gearListProGaffWidth1"),_=C("gearListProGaffColor2"),G=C("gearListProGaffWidth2"),O={street:t("productionCompanyStreet"),street2:t("productionCompanyStreet2"),city:t("productionCompanyCity"),region:t("productionCompanyRegion"),postalCode:t("productionCompanyPostalCode"),country:t("productionCompanyCountry")},B=[];O.street&&B.push(O.street),O.street2&&B.push(O.street2);const $=[O.city,O.region,O.postalCode].map(Y=>Y||"").filter(Y=>Y);$.length&&B.push($.join(", ")),O.country&&B.push(O.country);const V=lensSelectionManager$1&&typeof lensSelectionManager$1.snapshot=="function"?lensSelectionManager$1.snapshot():{names:normalizeLensSelectionNames(o("lenses")),lensSelections:[]},M=Array.isArray(V.names)?V.names.map(Y=>typeof Y=="string"?Y.trim():"").filter(Boolean):normalizeLensSelectionNames(V.names),F=Array.isArray(V.lensSelections)?V.lensSelections.map(Y=>({name:typeof Y?.name=="string"?Y.name.trim():"",mount:typeof Y?.mount=="string"?Y.mount.trim():"",mountState:typeof Y?.mountState=="string"?Y.mountState.trim():""})).filter(Y=>Y.name):[],z={productionCompany:t("productionCompany"),productionCompanyAddress:B.join(`
`),productionCompanyStreet:O.street,productionCompanyStreet2:O.street2,productionCompanyCity:O.city,productionCompanyRegion:O.region,productionCompanyPostalCode:O.postalCode,productionCompanyCountry:O.country,rentalHouse:t("rentalHouse"),...d.length?{people:d}:{},prepDays:y,shootingDays:h,returnDays:b,deliveryResolution:t("deliveryResolution"),recordingResolution:t("recordingResolution"),slowMotionRecordingResolution:t("slowMotionRecordingResolution"),aspectRatio:o("aspectRatio"),codec:t("codec"),baseFrameRate:t("baseFrameRate"),recordingFrameRate:t("recordingFrameRate"),slowMotionBaseFrameRate:t("slowMotionBaseFrameRate"),slowMotionRecordingFrameRate:t("slowMotionRecordingFrameRate"),sensorMode:t("sensorMode"),slowMotionSensorMode:t("slowMotionSensorMode"),slowMotionAspectRatio:t("slowMotionAspectRatio"),lenses:M,requiredScenarios:o("requiredScenarios"),cameraHandle:o("cameraHandle"),viewfinderExtension:t("viewfinderExtension"),viewfinderEyeLeatherColor:C("gearListEyeLeatherColor")||t("viewfinderEyeLeatherColor"),mattebox:u,gimbal:o("gimbal"),viewfinderSettings:r,frameGuides:n,aspectMaskOpacity:a,videoDistribution:o("videoDistribution"),monitoringConfiguration:t("monitoringConfiguration"),monitorUserButtons:o("monitorUserButtons"),cameraUserButtons:o("cameraUserButtons"),viewfinderUserButtons:o("viewfinderUserButtons"),tripodHeadBrand:t("tripodHeadBrand"),tripodBowl:t("tripodBowl"),tripodTypes:o("tripodTypes"),tripodSpreader:t("tripodSpreader"),sliderBowl:getSetupsCoreValue("getSliderBowlValue"),easyrig:getSetupsCoreValue("getEasyrigValue"),filter:s};z.lensSelections=F,A&&Object.keys(A).length&&(z.monitorBatteries=A);const x=(Y,le)=>{const be=C(le);be&&(z[Y]=be)},H=(Y,le)=>{if(!gearListOutput)return;const be=gearListOutput.querySelector(`#${le}`);be&&be.dataset&&be.dataset.autoGearManual==="true"&&(z[`${Y}Manual`]=!0)};x("directorMonitor","gearListDirectorMonitor"),x("dopMonitor","gearListDopMonitor"),x("gafferMonitor","gearListGafferMonitor"),x("directorMonitor15","gearListDirectorMonitor15"),x("comboMonitor15","gearListComboMonitor15"),x("dopMonitor15","gearListDopMonitor15"),z.focusMonitor=C("gearListFocusMonitor")||"",H("directorMonitor","gearListDirectorMonitor"),H("dopMonitor","gearListDopMonitor"),H("gafferMonitor","gearListGafferMonitor"),H("directorMonitor15","gearListDirectorMonitor15"),H("comboMonitor15","gearListComboMonitor15"),H("dopMonitor15","gearListDopMonitor15"),H("focusMonitor","gearListFocusMonitor"),(w||R)&&(z.proGaffColor1=w||"",z.proGaffWidth1=R||""),(_||G)&&(z.proGaffColor2=_||"",z.proGaffWidth2=G||"");const W=Array.from(storageNeedsContainer?.querySelectorAll(".storage-row")||[]).map(Y=>{const le=Y.querySelector(".storage-quantity"),be=Y.querySelector(".storage-type"),re=Y.querySelector(".storage-variant"),de=Y.querySelector(".storage-notes"),ne=le?parseInt(le.value,10):NaN,Ce=Number.isFinite(ne)&&ne>0?ne:null,Ee=typeof be?.value=="string"?be.value.trim():"",Pe=typeof re?.value=="string"?re.value.trim():"",et=typeof de?.value=="string"?de.value.trim():"";if(!Ce&&!Ee&&!Pe&&!et)return null;const Je={};return Ce&&(Je.quantity=Ce),Ee&&(Je.type=Ee),Pe&&(Je.variant=Pe),et&&(Je.notes=et),Je}).filter(Boolean);W.length&&(z.storageRequirements=W);const U=safeGetCurrentProjectName$1();U&&(z.projectName=U);const j=freezeProjectFormDataSnapshot(z);return projectFormDataCache=j,projectFormDataCacheDirty=!1,cloneProjectFormDataSnapshot(j)}const PROJECT_FILTER_TYPES=["ND","ND Grad HE","ND Grad SE","ND Grad Reverse","Polarizer","Variable ND","Diopter","Optical Flat","Rota-Pola","Mist","Glimmerglass","Diffusion","Streak","Star","UV","IR","Color","Effect"];function populateFilterDropdown$1(e=[]){const t=document.getElementById("filter");if(!t)return;const o=new Set(PROJECT_FILTER_TYPES);Array.isArray(e)&&e.forEach(l=>{l&&o.add(l)});const r=Array.from(o).sort();if(!t.options)return;const n=new Set(Array.from(t.options).map(l=>l.value));if(r.filter(l=>!n.has(l)).length===0&&t.options.length===r.length)return;t.innerHTML="";const s=document.createDocumentFragment();r.forEach(l=>{const u=document.createElement("option");u.value=l,u.textContent=l,s.appendChild(u)}),t.appendChild(s)}function populateCodecDropdown$1(e){const t=document.getElementById("codec");if(t){if(t.options.length<=1){const o=["X-OCN XT","X-OCN ST","X-OCN LT","RAW HQ","RAW SQ","RAW MQ","ProRes 4444 XQ","ProRes 4444","ProRes 422 HQ","ProRes 422","ProRes 422 LT","ProRes 422 Proxy","DNxHR 444","DNxHR HQX","DNxHR HQ","DNxHR SQ","DNxHR LB","H.264","H.265"];t.innerHTML='<option value="">--</option>',o.forEach(r=>{const n=document.createElement("option");n.value=r,n.textContent=r,t.appendChild(n)})}e&&(t.value=e)}}function populateProjectForm$1(e={}){typeof window<"u"&&(window.cineSuppressAutosave=!0);try{const t=typeof projectForm<"u"?projectForm:typeof document<"u"?document.getElementById("projectForm"):null;if(!t)return;t.reset();const o=(h,b)=>{if(b===void 0)return;const v=t.querySelector(`[name="${h}"]`);if(!v)return;let C=b;if(h==="recordingFrameRate"||h==="slowMotionRecordingFrameRate"){if(typeof b=="number"&&Number.isFinite(b))C=b%1?b.toFixed(3).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):String(b);else if(typeof b=="string"){const A=b.trim(),w=A.match(/-?\d+(?:\.\d+)?/);if(w){const R=Number.parseFloat(w[0]);Number.isFinite(R)?C=R%1?R.toFixed(3).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):String(R):C=A}else C=A}}v.value=C},r=(h,b)=>{const v=projectForm.querySelector(`[name="${h}"]`);if(!v||b===void 0)return;const C=Array.isArray(b)?b:b?b.split(",").map(A=>A.trim()):[];v.options&&Array.from(v.options).forEach(A=>{A.selected=C.includes(A.value)})},n=(h,b)=>h||(typeof document<"u"?document.getElementById(b):null),a=n(typeof crewContainer<"u"?crewContainer:null,"crewContainer"),s=n(typeof prepContainer<"u"?prepContainer:null,"prepContainer"),l=n(typeof shootContainer<"u"?shootContainer:null,"shootContainer"),u=n(typeof returnContainer<"u"?returnContainer:null,"returnContainer"),d=n(typeof storageNeedsContainer<"u"?storageNeedsContainer:null,"storageNeedsContainer");populateRecordingResolutionDropdown(e.recordingResolution),populateSensorModeDropdown(e.sensorMode),populateCodecDropdown$1(e.codec),typeof populateFrameRateDropdown=="function"&&populateFrameRateDropdown(e.recordingFrameRate),populateSlowMotionRecordingResolutionDropdown(e.slowMotionRecordingResolution),populateSlowMotionSensorModeDropdown(e.slowMotionSensorMode),typeof populateSlowMotionFrameRateDropdown=="function"&&populateSlowMotionFrameRateDropdown(e.slowMotionRecordingFrameRate),o("productionCompany",e.productionCompany);const m=(()=>{const h={street:e.productionCompanyStreet||"",street2:e.productionCompanyStreet2||"",city:e.productionCompanyCity||"",region:e.productionCompanyRegion||"",postalCode:e.productionCompanyPostalCode||"",country:e.productionCompanyCountry||""};if(Object.values(h).some(A=>A))return h;const v=typeof e.productionCompanyAddress=="string"?e.productionCompanyAddress.trim():"";if(!v)return h;const C=v.split(/\r?\n/).map(A=>A.trim()).filter(Boolean);return C.length&&(h.street=C[0]||"",h.street2=C[1]||"",C.length>=3&&(h.city=C.slice(2).join(", "))),h})();if(o("productionCompanyStreet",m.street),o("productionCompanyStreet2",m.street2),o("productionCompanyCity",m.city),o("productionCompanyRegion",m.region),o("productionCompanyPostalCode",m.postalCode),o("productionCompanyCountry",m.country),o("rentalHouse",e.rentalHouse),a){a.innerHTML="";const h=Array.isArray(e.people)?e.people.map(b=>b&&typeof b=="object"?{...b}:{}):[];if(typeof profile<"u"&&profile&&typeof profile=="object"){const b=typeof profile.name=="string"?profile.name.trim():""}h.forEach(b=>{createCrewRow(b)})}if(s){s.innerHTML="";const h=Array.isArray(e.prepDays)?e.prepDays:e.prepDays?String(e.prepDays).split(`
`):[""];h.length||h.push(""),h.forEach(b=>{const[v,C]=b.split(" to ");createPrepRow({start:v,end:C})})}if(l){l.innerHTML="";const h=Array.isArray(e.shootingDays)?e.shootingDays:e.shootingDays?String(e.shootingDays).split(`
`):[""];h.length||h.push(""),h.forEach(b=>{const[v,C]=b.split(" to ");createShootRow({start:v,end:C})})}if(u){u.innerHTML="";const h=Array.isArray(e.returnDays)?e.returnDays:e.returnDays?String(e.returnDays).split(`
`):[""];h.length||h.push(""),h.forEach(b=>{const[v,C]=b.split(" to ");createReturnRow({start:v,end:C})})}if(d){d.innerHTML="";const h=Array.isArray(e.storageRequirements)?e.storageRequirements:[];h.length?h.forEach(b=>createStorageRequirementRow(b)):createStorageRequirementRow()}o("deliveryResolution",e.deliveryResolution),r("aspectRatio",e.aspectRatio),o("baseFrameRate",e.baseFrameRate),o("recordingFrameRate",e.recordingFrameRate),o("sensorMode",e.sensorMode),o("slowMotionRecordingResolution",e.slowMotionRecordingResolution),o("slowMotionSensorMode",e.slowMotionSensorMode),o("slowMotionAspectRatio",e.slowMotionAspectRatio),o("slowMotionBaseFrameRate",e.slowMotionBaseFrameRate),o("slowMotionRecordingFrameRate",e.slowMotionRecordingFrameRate),lensSelectionManager$1&&typeof lensSelectionManager$1.applyInfo=="function"&&lensSelectionManager$1.applyInfo(e||{}),r("requiredScenarios",e.requiredScenarios),r("cameraHandle",e.cameraHandle),o("viewfinderExtension",e.viewfinderExtension),o("viewfinderEyeLeatherColor",e.viewfinderEyeLeatherColor),o("mattebox",e.mattebox),r("gimbal",e.gimbal),r("viewfinderSettings",e.viewfinderSettings),r("frameGuides",e.frameGuides),r("aspectMaskOpacity",e.aspectMaskOpacity),r("videoDistribution",e.videoDistribution),o("monitoringConfiguration",e.monitoringConfiguration),r("monitorUserButtons",e.monitorUserButtons),r("cameraUserButtons",e.cameraUserButtons),r("viewfinderUserButtons",e.viewfinderUserButtons),o("tripodHeadBrand",e.tripodHeadBrand),o("tripodBowl",e.tripodBowl),r("tripodTypes",e.tripodTypes),o("tripodSpreader",e.tripodSpreader),typeof setSliderBowlValue=="function"&&setSliderBowlValue(e.sliderBowl||""),typeof setEasyrigValue=="function"&&setEasyrigValue(e.easyrig||"");const y=typeof parseFilterTokens=="function"?parseFilterTokens(e.filter):[];if(typeof populateFilterDropdown$1=="function"&&populateFilterDropdown$1(y.map(h=>h.type)),r("filter",y.map(h=>h.type)),typeof renderFilterDetails=="function"&&renderFilterDetails(y),y.forEach(({type:h,size:b,values:v})=>{const C=document.getElementById(`filter-size-${filterId(h)}`);C&&(C.value=b);const A=document.getElementById(`filter-values-${filterId(h)}`);if(A){const w=Array.isArray(v)?v:[];A.options&&Array.from(A.options).forEach(R=>{R.selected=w.includes(R.value)})}}),projectForm){const h=projectForm.querySelector("#rentalHouse");renderRentalHouseSuggestions(h),updateRentalHouseAssistiveDetails(h)}markProjectFormDataDirty$1()}finally{typeof window<"u"&&setTimeout(()=>{window.cineSuppressAutosave=!1},500)}}function ensureZoomRemoteSetup$1(e){if(!e||!e.tripodPreferences||!e.tripodPreferences.includes("Zoom Remote handle"))return;let t=motorSelects.map(n=>n.value).filter(n=>n&&n!=="None");if(!t.length)return;if(t.length<2&&motorSelects[1]){let n=t[0];/cforce.*rf/i.test(n)&&devices.fiz.motors["Arri Cforce Mini"]&&(n="Arri Cforce Mini"),motorSelects[1].value=n,t=motorSelects.map(a=>a.value).filter(a=>a&&a!=="None")}const o=new Set(["Arri Master Grip (single unit)","Arri ZMU-4 (body only, wired)","Tilta Nucleus-M Hand Grip (single)","Tilta Nucleus-M II Handle (single)"]);if(!controllerSelects.map(n=>n.value).filter(n=>n&&n!=="None").some(n=>o.has(n))){const n=detectBrand(t[0]);let a=null;n==="arri"?a="Arri Master Grip (single unit)":n==="tilta"&&(a="Tilta Nucleus-M Hand Grip (single)"),a&&controllerSelects[0]&&(controllerSelects[0].value=a)}typeof updateCalculations=="function"&&updateCalculations(),typeof saveCurrentSession=="function"&&saveCurrentSession()}function stripAutoGearContext(e){return(e||"").replace(/\s*\([^)]*\)\s*$/,"").trim()}function normalizeAutoGearName(e){return stripAutoGearContext(e).toLowerCase()}function normalizeAutoGearNotesKey(e){const t=typeof normalizeAutoGearText=="function"?normalizeAutoGearText(e,{collapseWhitespace:!0}):(e==null?"":String(e)).trim().replace(/\s+/g," ");return t?t.replace(/^[\s\-–—]+/u,"").trim().toLowerCase():""}function getAutoGearSpanNotesKey(e){if(!e||!e.dataset)return"";const t=typeof e.dataset.autoGearNotes=="string"?e.dataset.autoGearNotes:"";if(t)return normalizeAutoGearNotesKey(t);const o=e.querySelector(".auto-gear-notes");return!o||typeof o.textContent!="string"?"":normalizeAutoGearNotesKey(o.textContent)}function matchesAutoGearItem(e,t){if(!e||!t)return!1;const o=normalizeAutoGearName(e),r=normalizeAutoGearName(t);return o===r?!0:o===normalizeAutoGearName(t.replace(/^\d+x\s+/,""))}function isOnboardMonitorRiggingItemName(e){if(typeof e!="string")return!1;const t=normalizeAutoGearName(ONBOARD_MONITOR_RIGGING_ITEM_NAME);return t?normalizeAutoGearName(e)===t:!1}function isOnboardMonitorRiggingItemEntry(e){return!e||typeof e!="object"?!1:isOnboardMonitorRiggingItemName(e.name)}function getOnboardMonitorRiggingRuleLabel(){if(typeof texts=="object"&&texts){const e=texts[currentLang]?.autoGearMonitorLabel;if(typeof e=="string"&&e.trim())return e.trim();const t=texts.en?.autoGearMonitorLabel;if(typeof t=="string"&&t.trim())return t.trim()}return"Onboard monitors"}function ensureOnboardMonitorRiggingAutoGearHighlight(e){if(!e||typeof e.querySelectorAll!="function")return;const t=normalizeAutoGearName(ONBOARD_MONITOR_RIGGING_ITEM_NAME);if(!t)return;const o=getOnboardMonitorRiggingRuleLabel(),r={id:ONBOARD_MONITOR_RIGGING_RULE_ID,label:o},n=Array.from(e.querySelectorAll(".gear-item")).filter(a=>{if(!a)return!1;const s=getGearItemDisplayName(a)||a.textContent||"";return normalizeAutoGearName(s)===t});n.length&&n.forEach(a=>{const s=Math.max(1,getSpanCount(a));if(!a.classList.contains("auto-gear-item")){const u=normalizeAutoGearItem({id:ONBOARD_MONITOR_RIGGING_ITEM_ID,name:ONBOARD_MONITOR_RIGGING_ITEM_NAME,category:"Rigging",quantity:s,contextNotes:[o]});configureAutoGearSpan(a,u,s,r);return}appendAutoGearRuleSource(a,r),applyAutoGearRuleColors(a,r),getAutoGearSpanContextMap(a).has(o)?renderAutoGearSpanContextNotes(a):mergeAutoGearSpanContextNotes(a,[o],s),refreshAutoGearRuleBadge(a)})}function getSpanCount(e){if(!e)return 1;const o=(e.textContent||"").trim().match(/^(\d+)x\s+/);return o?parseInt(o[1],10):1}function updateSpanCountInPlace(e,t){if(!e)return;const o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let r=null;for(;o.nextNode();){const s=o.currentNode;if(/\d+x\s+/i.test(s.textContent)){r=s;break}}if(!r){e.insertBefore(document.createTextNode(`${t}x `),e.firstChild);return}const n=r.textContent||"",a=n.match(/^(\s*)(\d+)x\s+(.*)$/);a?r.textContent=`${a[1]}${t}x ${a[3]}`:r.textContent=n.replace(/^(\d+)x\s+/,`${t}x `)}function cleanupAutoGearCell(e){if(!e)return;const t=Array.from(e.childNodes);let o=!0;for(t.forEach(n=>{if(n.nodeType===Node.TEXT_NODE&&!n.textContent.trim()){e.removeChild(n);return}if(n.nodeName==="BR"){if(o||!n.nextSibling){e.removeChild(n);return}o=!0}else o=!1});e.firstChild&&e.firstChild.nodeName==="BR";)e.removeChild(e.firstChild);for(;e.lastChild&&e.lastChild.nodeName==="BR";)e.removeChild(e.lastChild);if(!(e.textContent?e.textContent.trim():"")&&!e.querySelector(".gear-item")){const n=e.closest("tr"),a=n?n.closest("tbody"):null;a&&a.classList.contains("auto-gear-category")&&a.remove()}}function analyzeAutoGearSegment(e){if(!e||!e.length)return null;const t=e.find(u=>u.nodeType===1&&u.classList&&u.classList.contains("gear-item"));if(t){const u=getGearItemDisplayName(t)||(t.textContent||"").replace(/^(\d+)x\s+/,"").trim(),d=getSpanCount(t);return{span:t,name:u,count:d}}const o=document.createElement("div");e.forEach(u=>o.appendChild(u.cloneNode(!0)));let r=o.innerHTML.replace(/<select[\s\S]*?<\/select>/gi,""),n;do n=r,r=r.replace(/<[^>]+>/g,"");while(r!==n);let a=r.trim();if(!a)return null;const s=a.match(/^(\d+)x\s+/);let l=1;return s&&(l=parseInt(s[1],10),a=a.slice(s[0].length).trim()),{span:null,name:a,count:l,wrapper:o}}function updateRawSegmentCount(e,t,o){if(!e.length)return;let r=!1;for(const n of e)if(n.nodeType===Node.TEXT_NODE){const a=n.textContent||"";if(/\d+x\s+/i.test(a)){n.textContent=a.replace(/^(\s*)(\d+)x\s+/,(s,l)=>`${l}${o}x `),r=!0;break}if(a.trim()){n.textContent=`${o}x ${a.trim().replace(/^(\d+)x\s+/,"")}`,r=!0;break}}else if(n.nodeType===1){const a=n.firstChild;if(a&&a.nodeType===Node.TEXT_NODE&&/\d+x\s+/i.test(a.textContent||"")){a.textContent=(a.textContent||"").replace(/^(\s*)(\d+)x\s+/,(s,l)=>`${l}${o}x `),r=!0;break}}if(!r){const n=e[0],a=n.parentNode;a&&a.insertBefore(document.createTextNode(`${o}x ${t.name}`),n)}}function removeAutoGearItem(e,t,o){if(!e)return normalizeAutoGearQuantity(t.quantity);let r=typeof o=="number"?o:normalizeAutoGearQuantity(t.quantity);if(r<=0)return r;const n=Array.from(e.childNodes);if(!n.length)return r;const a=[];let s=[];n.forEach(u=>{u.nodeName==="BR"?(a.push({nodes:s,separator:u}),s=[]):s.push(u)}),a.push({nodes:s,separator:null});let l=!1;return a.forEach(u=>{if(!u.nodes.length||r<=0)return;const d=analyzeAutoGearSegment(u.nodes);if(!(!d||!d.name||!matchesAutoGearItem(t.name,d.name)))if(d.span){const m=d.count;m>r?(updateSpanCountInPlace(d.span,m-r),r=0):(r-=m,u.nodes.forEach(y=>y.remove())),l=!0}else d.count>r&&d.count>1?(updateRawSegmentCount(u.nodes,d,d.count-r),r=0,l=!0):(r-=d.count,u.nodes.forEach(m=>m.remove()),l=!0)}),l&&cleanupAutoGearCell(e),r}function getCrewRoleLabelForDisplay(e){if(typeof e!="string")return"";const t=e.trim();return t?((texts[currentLang]||texts.en||{}).crewRoles||texts.en?.crewRoles||{})?.[t]||t:""}function getAutoGearRuleDisplayLabel(e){if(!e||typeof e!="object")return"";const t=typeof e.label=="string"?e.label.trim():"";if(t)return t;const o=Array.isArray(e.scenarios)?e.scenarios.filter(Boolean):[];if(o.length)return o.join(" + ");const r=Array.isArray(e.camera)?e.camera.filter(Boolean):[];if(r.length)return r.join(" + ");const n=Array.isArray(e.monitor)?e.monitor.filter(Boolean):[];if(n.length)return n.join(" + ");const a=Array.isArray(e.crewPresent)?e.crewPresent.filter(Boolean):[];if(a.length)return a.map(getCrewRoleLabelForDisplay).join(" + ");const s=Array.isArray(e.crewAbsent)?e.crewAbsent.filter(Boolean):[];if(s.length)return s.map(getCrewRoleLabelForDisplay).join(" + ");const l=Array.isArray(e.wireless)?e.wireless.filter(Boolean):[];if(l.length)return l.join(" + ");const u=Array.isArray(e.motors)?e.motors.filter(Boolean):[];if(u.length)return u.join(" + ");const d=Array.isArray(e.controllers)?e.controllers.filter(Boolean):[];if(d.length)return d.join(" + ");const m=Array.isArray(e.distance)?e.distance.filter(Boolean):[];if(m.length)return m.join(" + ");const y=Array.isArray(e.mattebox)?e.mattebox.filter(Boolean):[];if(y.length)return y.join(" + ");const h=Array.isArray(e.cameraHandle)?e.cameraHandle.filter(Boolean):[];if(h.length)return h.join(" + ");const b=Array.isArray(e.viewfinderExtension)?e.viewfinderExtension.filter(Boolean).map(getViewfinderFallbackLabel):[];if(b.length)return b.join(" + ");const v=Array.isArray(e.videoDistribution)?e.videoDistribution.filter(Boolean).map(getVideoDistributionFallbackLabel):[];return v.length?v.join(" + "):""}function formatAutoGearRuleTooltip(e){const t=texts[currentLang]||texts.en||{},o=t.autoGearRuleTooltipUnnamed||texts.en?.autoGearRuleTooltipUnnamed||"Added by automatic gear rule";if(!e||typeof e!="object")return o;const r=getAutoGearRuleDisplayLabel(e);return r?(t.autoGearRuleTooltipNamed||texts.en?.autoGearRuleTooltipNamed||`${o}: %s`).replace("%s",r):o}function extractAutoGearRuleSource(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"",o=getAutoGearRuleDisplayLabel(e);return!t&&!o?null:{id:t,label:o}}function normalizeAutoGearRuleSourceEntry(e){if(!e)return null;if(typeof e=="string"){const r=e.trim();return r?{id:"",label:r}:null}if(typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"",o=typeof e.label=="string"?e.label.trim():"";return!t&&!o?null:{id:t,label:o}}function dedupeAutoGearRuleSources(e){if(!Array.isArray(e)||!e.length)return[];const t=new Set,o=[];return e.forEach(r=>{const n=normalizeAutoGearRuleSourceEntry(r);if(!n)return;const a=n.id?n.id.toLowerCase():"",s=n.label?n.label.toLowerCase():"",l=a?`id:${a}`:s?`label:${s}`:"";!l||t.has(l)||(t.add(l),o.push({id:n.id,label:n.label}))}),o}function formatAutoGearSelectorDisplayValue(e,t){const o=typeof t=="string"?t:t==null?"":String(t),r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{};return typeof r.formatAutoGearSelectorValue=="function"?r.formatAutoGearSelectorValue(e,o):typeof addArriKNumber$1=="function"&&(e==="monitor"||e==="directorMonitor")?addArriKNumber$1(o):o}function getAutoGearRuleSources(e){if(!e||!e.dataset)return[];const t=e.dataset,o=typeof t.autoGearRuleSources=="string"?t.autoGearRuleSources:"";let r=[];if(o)try{const n=JSON.parse(o);Array.isArray(n)&&(r=dedupeAutoGearRuleSources(n))}catch(n){console.warn("Failed to parse automatic gear rule metadata",n),r=[]}return r.length||(r=dedupeAutoGearRuleSources([{id:t.autoGearRuleId,label:t.autoGearRuleLabel}])),r}function setAutoGearRuleSources(e,t){if(!e||!e.dataset)return;const o=dedupeAutoGearRuleSources(t),r=e.dataset;if(!o.length){delete r.autoGearRuleSources,delete r.autoGearRuleId,delete r.autoGearRuleLabel;return}try{r.autoGearRuleSources=JSON.stringify(o)}catch(a){console.warn("Failed to serialize automatic gear rule metadata",a)}const n=o[0];n.id?r.autoGearRuleId=n.id:delete r.autoGearRuleId,n.label?r.autoGearRuleLabel=n.label:delete r.autoGearRuleLabel}function appendAutoGearRuleSource(e,t){if(!e||!e.dataset)return;const o=extractAutoGearRuleSource(t),r=getAutoGearRuleSources(e);o&&r.push(o),setAutoGearRuleSources(e,r)}function buildAutoGearRuleTooltipFromSources(e){if(!Array.isArray(e)||!e.length)return"";const t=e.map(o=>{if(!o)return"";const r=typeof o.label=="string"?o.label.trim():"";return r||(typeof o.id=="string"?o.id.trim():"")}).filter(Boolean);return t.length?formatAutoGearRuleTooltip({label:t.join(", ")}):""}function getAutoGearSpanContextMap(e){if(!e||!e.dataset||!e.dataset.autoGearContextCounts)return new Map;try{const t=JSON.parse(e.dataset.autoGearContextCounts);if(!t||typeof t!="object")return new Map;const o=new Map;return Object.keys(t).forEach(r=>{const n=r&&r.trim();if(!n)return;const a=Number(t[r]);!Number.isFinite(a)||a<=0||o.set(n,a)}),o}catch{return new Map}}function saveAutoGearSpanContextMap(e,t){if(!e||!e.dataset)return;if(!t||!(t instanceof Map)||t.size===0){delete e.dataset.autoGearContextCounts;return}const o={};t.forEach((n,a)=>{a&&(!Number.isFinite(n)||n<=0||(o[a]=n))}),Object.keys(o).length?e.dataset.autoGearContextCounts=JSON.stringify(o):delete e.dataset.autoGearContextCounts}const AUTO_GEAR_CONTEXT_SORT_PRIORITY=new Map([["director handheld",1],["gaffer handheld",2],["dop handheld",3]]);function setAutoGearSpanContextNotes(e,t,o){if(!e||!e.dataset)return;const r=new Map,n=Math.max(0,Number(o)||0);Array.isArray(t)&&t.forEach(a=>{const s=a&&a.trim();s&&r.set(s,(r.get(s)||0)+n)}),saveAutoGearSpanContextMap(e,r),renderAutoGearSpanContextNotes(e)}function mergeAutoGearSpanContextNotes(e,t,o){if(!e||!e.dataset){renderAutoGearSpanContextNotes(e);return}if(!Array.isArray(t)||!t.length){renderAutoGearSpanContextNotes(e);return}const r=getAutoGearSpanContextMap(e),n=Math.max(0,Number(o)||0);if(n<=0){renderAutoGearSpanContextNotes(e);return}t.forEach(a=>{const s=a&&a.trim();s&&r.set(s,(r.get(s)||0)+n)}),saveAutoGearSpanContextMap(e,r),renderAutoGearSpanContextNotes(e)}function renderAutoGearSpanContextNotes(e){if(!e)return;const t=getAutoGearSpanContextMap(e),o=Array.from(t.entries()).filter(([,s])=>Number.isFinite(s)&&s>0);let r=e.querySelector(".auto-gear-context-notes");if(o.length<=1){r&&r.remove();return}const a=` (${o.sort(([s],[l])=>{const u=AUTO_GEAR_CONTEXT_SORT_PRIORITY.get(s.trim().toLowerCase())??Number.POSITIVE_INFINITY,d=AUTO_GEAR_CONTEXT_SORT_PRIORITY.get(l.trim().toLowerCase())??Number.POSITIVE_INFINITY;return u!==d?u-d:s.localeCompare(l,void 0,{sensitivity:"base"})}).map(([s,l])=>`${l}x ${s}`).join(", ")})`;if(!r){r=document.createElement("span"),r.className="auto-gear-context-notes";const s=e.querySelector(".auto-gear-selector-container"),l=e.querySelector(".auto-gear-notes"),u=s||l;u&&u.parentNode===e?e.insertBefore(r,u):e.appendChild(r)}r.textContent=a}function adjustSelectWidth(e){if(!e)return;const t=e.options[e.selectedIndex],o=t?t.text:"",r=document.createElement("span"),n=window.getComputedStyle(e);r.style.fontFamily=n.fontFamily,r.style.fontSize=n.fontSize,r.style.fontWeight=n.fontWeight,r.style.letterSpacing=n.letterSpacing,r.style.textTransform=n.textTransform,r.style.visibility="hidden",r.style.position="absolute",r.style.whiteSpace="pre",r.textContent=o,document.body.appendChild(r);const a=r.getBoundingClientRect().width;document.body.removeChild(r),e.style.width=`calc(${a}px + 2.5em)`}function configureAutoGearSpan(e,t,o,r){if(!e||!t)return;const n=t.name?t.name.trim():"";if(!n)return;const a=getGearListRentalToggleTexts(),s=a&&typeof a.noteLabel=="string"?a.noteLabel.trim():"",l=e.classList&&e.classList.contains("gear-item-rental-excluded")||e.getAttribute?.("data-rental-excluded")==="true",u=!!e.querySelector("select, input");if(!u)for(;e.firstChild;)e.removeChild(e.firstChild);if(e.classList.add("gear-item"),e.classList.add("auto-gear-item"),e.setAttribute("data-gear-name",n),s?e.setAttribute("data-rental-note",s):e.removeAttribute&&e.removeAttribute("data-rental-note"),e.dataset&&delete e.dataset.autoGearContextCounts,e.dataset){const v=extractAutoGearRuleSource(r);setAutoGearRuleSources(e,v?[v]:[])}const d=getAutoGearRuleSources(e),m=d.length?buildAutoGearRuleTooltipFromSources(d):formatAutoGearRuleTooltip(r);if(m?e.title=m:e.removeAttribute("title"),u)updateSpanCountInPlace(e,o);else{const v=typeof addArriKNumber$1=="function"?addArriKNumber$1(n):n;e.appendChild(document.createTextNode(`${o}x ${v}`)),t.screenSize&&e.appendChild(document.createTextNode(` - ${t.screenSize}`))}e.dataset&&(t.ownGearId?e.dataset.autoGearOwnGearId=t.ownGearId:Object.prototype.hasOwnProperty.call(e.dataset,"autoGearOwnGearId")&&delete e.dataset.autoGearOwnGearId),t.ownGearId&&setGearItemProvider$1(e,"user"),Array.isArray(t.contextNotes)&&t.contextNotes.length?setAutoGearSpanContextNotes(e,t.contextNotes,o):renderAutoGearSpanContextNotes(e);const y=t.selectorType||"none",h=t.selectorDefault||"",b=getAutoGearSelectorLabel(y);if(!u&&y&&y!=="none")if(t.selectorEnabled){const v=getAutoGearSelectorOptions(y,t),A=`autoGearSelector_${r&&r.id?r.id.replace(/[^a-zA-Z0-9_-]/g,""):"rule"}_${t.id}`,w=document.createElement("select");w.id=A,w.className="auto-gear-selector",w.dataset.autoGearSelectorType=y,t.selectorContext&&(w.dataset.autoGearSelectorContext=t.selectorContext),b&&w.setAttribute("aria-label",b);let R="";if(v.forEach(G=>{const O=document.createElement("option");O.value=G,O.textContent=formatAutoGearSelectorDisplayValue(y,G),!R&&h&&G.toLowerCase()===h.toLowerCase()&&(R=O.value),w.appendChild(O)}),h&&!R){const G=document.createElement("option");G.value=h,G.textContent=formatAutoGearSelectorDisplayValue(y,h),w.insertBefore(G,w.firstChild),R=h}if(R?w.value=R:w.options.length&&(w.selectedIndex=0),!w.options.length){const G=document.createElement("option");G.value="",G.textContent=b||"",G.disabled=!0,G.selected=!0,w.appendChild(G),w.disabled=!0}const _=document.createElement("span");_.className="auto-gear-selector-container",_.appendChild(w),e.appendChild(document.createTextNode(" - ")),e.appendChild(_),requestAnimationFrame(()=>{adjustSelectWidth(w)}),w.addEventListener("change",()=>{adjustSelectWidth(w)})}else if(h){const v=formatAutoGearSelectorDisplayValue(y,h);e.appendChild(document.createTextNode(` - ${b}: ${v}`))}else b&&e.appendChild(document.createTextNode(` - ${b}`));if(e.dataset&&(t.notes?e.dataset.autoGearNotes=t.notes:Object.prototype.hasOwnProperty.call(e.dataset,"autoGearNotes")&&delete e.dataset.autoGearNotes),t.notes){const v=t.notes.trim().toLowerCase().startsWith("incl")?" ":" – ",C=document.createElement("span");C.className="auto-gear-notes",C.textContent=`${v}${t.notes}`,e.appendChild(C)}setRentalExclusionState(e,l),applyAutoGearRuleColors(e,r),refreshAutoGearRuleBadge(e)}function addAutoGearItem(e,t,o){if(!e)return;const r=normalizeAutoGearItem(t);if(!r)return;const n=normalizeAutoGearQuantity(r.quantity);if(n<=0)return;const a=r.name?r.name.trim():"";if(!a)return;const s=Array.from(e.querySelectorAll(".gear-item")),l=normalizeAutoGearNotesKey(r.notes);for(const d of s){const m=getGearItemDisplayName(d)||(d.textContent||"").replace(/^(\d+)x\s+/,"").trim();if(matchesAutoGearItem(a,m)){const y=getAutoGearSpanNotesKey(d);if(l){if(d.classList.contains("auto-gear-item")){if(!y||y!==l)continue}else if(y&&y!==l)continue}else if(d.classList.contains("auto-gear-item")&&y)continue;if(d.classList.contains("auto-gear-item")){const h=getSpanCount(d)+n;updateSpanCountInPlace(d,h),Array.isArray(r.contextNotes)&&r.contextNotes.length?mergeAutoGearSpanContextNotes(d,r.contextNotes,n):renderAutoGearSpanContextNotes(d),d.dataset&&(r.notes?d.dataset.autoGearNotes=r.notes:Object.prototype.hasOwnProperty.call(d.dataset,"autoGearNotes")&&delete d.dataset.autoGearNotes),o&&typeof o=="object"?appendAutoGearRuleSource(d,o):d.dataset&&setAutoGearRuleSources(d,getAutoGearRuleSources(d));const b=buildAutoGearRuleTooltipFromSources(getAutoGearRuleSources(d));b?d.title=b:d.removeAttribute("title"),applyAutoGearRuleColors(d,o),refreshAutoGearRuleBadge(d)}else{const b=getSpanCount(d)+n;configureAutoGearSpan(d,r,b,o)}return}}e.childNodes.length&&e.appendChild(document.createElement("br"));const u=document.createElement("span");configureAutoGearSpan(u,r,n,o),e.appendChild(u)}function ensureAutoGearCategory(e,t){const o=t&&typeof t=="string"?t.trim():String(t??"").trim(),r=o.toLowerCase(),n=o||AUTO_GEAR_CUSTOM_CATEGORY,a=Array.from(e.querySelectorAll("tbody.category-group")).find(h=>{if(h.dataset){const _=(h.dataset.autoCategory||"").trim().toLowerCase();if(r&&_===r)return!0;const G=(h.dataset.gearTableCategory||"").trim().toLowerCase();if(r&&G===r)return!0}const b=(h.getAttribute("data-auto-category")||"").trim().toLowerCase();if(r&&b===r)return!0;const v=(h.getAttribute("data-gear-table-category")||"").trim().toLowerCase();if(r&&v===r)return!0;const C=h.querySelector(".category-row td");if(!C)return!1;const A=(C.getAttribute("data-gear-category-label")||"").trim().toLowerCase();if(r&&A===r)return!0;let w=C.textContent.trim();w.endsWith("+")&&(w=w.substring(0,w.length-1).trim());const R=w.toLowerCase();return r?R===r:h.classList.contains("auto-gear-category")||R===n.toLowerCase()});if(a)return a.querySelector("tr:not(.category-row) td")||null;const s=document.createElement("tbody");s.className="category-group auto-gear-category",s.dataset.autoCategory=o,s.dataset.gearTableCategory=o||n;const l=document.createElement("tr");l.className="category-row";const u=document.createElement("td"),d=o||texts[currentLang]?.autoGearCustomCategory||texts.en?.autoGearCustomCategory||"Custom Additions";u.setAttribute("data-gear-category-label",d),u.textContent=d,l.appendChild(u),s.appendChild(l);const m=document.createElement("tr"),y=document.createElement("td");return m.appendChild(y),s.appendChild(m),e.appendChild(s),y}function findAutoGearCategoryCell(e,t){if(!e)return null;const o=t&&typeof t=="string"?t.trim():String(t??"").trim(),r=o.toLowerCase(),n=o||AUTO_GEAR_CUSTOM_CATEGORY,a=Array.from(e.querySelectorAll("tbody.category-group"));for(const s of a){if(s.dataset){const b=(s.dataset.autoCategory||"").trim().toLowerCase();if(r&&b===r){const C=s.querySelector("tr:not(.category-row) td");if(C)return C}const v=(s.dataset.gearTableCategory||"").trim().toLowerCase();if(r&&v===r){const C=s.querySelector("tr:not(.category-row) td");if(C)return C}}const l=(s.getAttribute("data-auto-category")||"").trim().toLowerCase();if(r&&l===r){const b=s.querySelector("tr:not(.category-row) td");if(b)return b}const u=(s.getAttribute("data-gear-table-category")||"").trim().toLowerCase();if(r&&u===r){const b=s.querySelector("tr:not(.category-row) td");if(b)return b}const d=s.querySelector(".category-row td");if(!d)continue;const m=(d.getAttribute("data-gear-category-label")||"").trim().toLowerCase();if(r&&m===r){const b=s.querySelector("tr:not(.category-row) td");if(b)return b}let y=d.textContent.trim();y.endsWith("+")&&(y=y.substring(0,y.length-1).trim());const h=y.toLowerCase();if(r){if(h===r){const b=s.querySelector("tr:not(.category-row) td");if(b)return b}}else if(s.classList.contains("auto-gear-category")||h===n.toLowerCase()){const b=s.querySelector("tr:not(.category-row) td");if(b)return b}}return null}function normalizeAutoGearScenarioLogicValue(e){if(typeof e!="string")return"all";const t=e.trim().toLowerCase();return t?t==="or"?"any":t==="and"?"all":t==="any"?"any":t==="multiplier"||t==="multiply"||t==="multiplied"?"multiplier":"all":"all"}function normalizeAutoGearScenarioMultiplierValue(e){const t=parseInt(e,10);return Number.isFinite(t)&&t>1?t:1}function computeAutoGearScenarioOutcome(e,t){if(!e||typeof e!="object")return{active:!0,multiplier:1};const o=Array.isArray(e.scenarios)?e.scenarios.filter(Boolean):[];if(!o.length)return{active:!0,multiplier:1};const r=o.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!r.length)return{active:!1,multiplier:0};const n=normalizeAutoGearScenarioLogicValue(e.scenarioLogic);if(n==="any"){const s=r.some(l=>t.has(l));return{active:s,multiplier:s?1:0}}if(n==="multiplier"){const s=typeof e.scenarioPrimary=="string"?e.scenarioPrimary:"",l=normalizeAutoGearTriggerValue(s);let u="";if(l&&r.includes(l)?u=l:u=r[0]||"",!u||!t.has(u))return{active:!1,multiplier:0};const d=r.filter(h=>h!==u);if(!d.length)return{active:!0,multiplier:1};const m=d.every(h=>t.has(h)),y=normalizeAutoGearScenarioMultiplierValue(e.scenarioMultiplier);return{active:!0,multiplier:m?y:1}}const a=r.every(s=>t.has(s));return{active:a,multiplier:a?1:0}}function normalizeClampOnDiameterKey(e){return Number.isFinite(e)?Number(e).toFixed(3):""}function formatClampOnDiameterLabel(e){if(!Number.isFinite(e))return"";const t=Number(Number(e).toFixed(2));return Number.isFinite(t)?String(t):""}function shouldAugmentClampOnRule(e){if(!e||typeof e!="object")return!1;const t=Array.isArray(e.mattebox)?e.mattebox.filter(Boolean):[];if(!t.length)return!1;const o=t.map(r=>normalizeAutoGearTriggerValue(r).replace(/-/g," ")).filter(Boolean);return o.length?o.includes("clamp on"):!1}function buildClampOnBackingAdditionsFromInfo(e){const t=normalizeLensSelectionNames(e?e.lenses:null);if(!t.length)return[];const o=devices&&devices.lenses?devices.lenses:null;if(!o||typeof o!="object")return[];const r=new Map;Object.keys(o).forEach(s=>{if(typeof s!="string"||!s)return;const l=s.trim().toLowerCase();l&&!r.has(l)&&r.set(l,o[s])});const n=new Map;return t.forEach(s=>{if(typeof s!="string")return;const l=s.trim();if(!l)return;const u=l.toLowerCase();let d=Object.prototype.hasOwnProperty.call(o,l)?o[l]:null;if(!d&&r.has(u)&&(d=r.get(u)),!d||typeof d!="object")return;const m=Number(d.frontDiameterMm);if(!Number.isFinite(m)||m<=0)return;const y=normalizeClampOnDiameterKey(m);if(!y)return;n.has(y)||n.set(y,{diameter:m,lenses:[]});const h=n.get(y);h.lenses.indexOf(l)===-1&&h.lenses.push(l)}),n.size?Array.from(n.values()).sort((s,l)=>s.diameter===l.diameter?0:s.diameter<l.diameter?-1:1).map(({diameter:s,lenses:l})=>{const d={name:`Mattebox Clamp-On Backing ${formatClampOnDiameterLabel(s)||String(Number(s))}mm`,category:"Matte box + filter",quantity:1};return Array.isArray(l)&&l.length&&(d.contextNotes=[`Lenses: ${l.join(", ")}`]),d}):[]}function mergeAutoGearAdditions(e,t){const o=[],r=new Set,n=a=>{if(!a||typeof a!="object")return;const s=typeof a.name=="string"?a.name.trim():"";if(!s)return;const l=typeof a.category=="string"?a.category.trim():"",u=`${s.toLowerCase()}|${l.toLowerCase()}`;r.has(u)||(r.add(u),o.push(a))};return e.forEach(n),t.forEach(n),o}function applyAutoGearRulesToTableHtml$1(e,t){const o=typeof getEnabledAutoGearRules=="function"?getEnabledAutoGearRules():autoGearRules.filter(ge=>!ge||ge.enabled!==!1);if(!e||!o.length||typeof document>"u")return e;const r=t&&t.requiredScenarios?t.requiredScenarios.split(",").map(ge=>ge.trim()).filter(Boolean):[],n=new Set(r.map(normalizeAutoGearTriggerValue).filter(Boolean)),a=t&&typeof t.mattebox=="string"?t.mattebox.trim():"",s=normalizeAutoGearTriggerValue(a),u=(t&&typeof t.cameraHandle=="string"?t.cameraHandle.split(",").map(ge=>ge.trim()).filter(Boolean):[]).map(normalizeAutoGearTriggerValue).filter(Boolean),d=new Set(u),m=t&&typeof t.viewfinderExtension=="string"?t.viewfinderExtension.trim():"",h=!!m?normalizeAutoGearTriggerValue(m):"",b=t&&typeof t.deliveryResolution=="string"?t.deliveryResolution.trim():"",v=normalizeAutoGearTriggerValue(b);let C=[];t&&Array.isArray(t.videoDistribution)?C=t.videoDistribution:t&&typeof t.videoDistribution=="string"&&(C=t.videoDistribution.split(",").map(ge=>ge.trim()).filter(Boolean));const A=C.map(normalizeVideoDistributionOptionValueForSetups).map(ge=>ge==="__none__"?"":normalizeAutoGearTriggerValue(ge)).filter(Boolean),w=new Set(A),R=t&&typeof t.cameraSelection=="string"?t.cameraSelection.trim():"",_=normalizeAutoGearTriggerValue(R),G=devices&&devices.cameras?devices.cameras:null,O=(()=>{if(!G)return null;const ge={};return Object.keys(G).forEach(ue=>{const We=G[ue];if(!We||!Number.isFinite(We.weight_g))return;const Me=normalizeAutoGearTriggerValue(ue);Me&&!Object.prototype.hasOwnProperty.call(ge,Me)&&(ge[Me]=Number(We.weight_g))}),ge})(),B=(()=>{if(!G)return null;const ge=R&&Object.prototype.hasOwnProperty.call(G,R)?G[R]:null;return ge&&Number.isFinite(ge.weight_g)?Number(ge.weight_g):!_||!O?null:Object.prototype.hasOwnProperty.call(O,_)?O[_]:null})(),$=t&&typeof t.monitorSelection=="string"?t.monitorSelection.trim():"",V=normalizeAutoGearTriggerValue($),M=(()=>{if(typeof getAutoGearOwnGearItems!="function")return new Set;try{const ge=getAutoGearOwnGearItems();return new Set((Array.isArray(ge)?ge:[]).map(ue=>ue&&typeof ue.id=="string"?ue.id.trim():"").filter(Boolean))}catch{return new Set}})(),F=t&&typeof t.wirelessSelection=="string"?t.wirelessSelection.trim():"",z=normalizeAutoGearTriggerValue(F),x=t&&typeof t.tripodHeadBrand=="string"?t.tripodHeadBrand.trim():"",H=normalizeAutoGearTriggerValue(x),W=t&&typeof t.tripodBowl=="string"?t.tripodBowl.trim():"",U=normalizeAutoGearTriggerValue(W),j=Array.isArray(t?.tripodTypes)?t.tripodTypes:typeof t?.tripodTypes=="string"?t.tripodTypes.split(",").map(ge=>ge.trim()).filter(Boolean):[],Y=new Set(j.map(ge=>normalizeAutoGearTriggerValue(ge)).filter(Boolean)),le=t&&typeof t.tripodSpreader=="string"?t.tripodSpreader.trim():"",be=normalizeAutoGearTriggerValue(le),re=new Set(Array.isArray(t?.people)?t.people.map(ge=>ge&&typeof ge.role=="string"?ge.role.trim():"").filter(Boolean).map(ge=>normalizeAutoGearTriggerValue(ge)).filter(Boolean):[]),de=[];t&&(Array.isArray(t.motorSelections)&&de.push(...t.motorSelections),Array.isArray(t.motors)&&de.push(...t.motors));const ne=new Set(de.filter(ge=>typeof ge=="string").map(ge=>normalizeAutoGearTriggerValue(ge)).filter(Boolean)),Ce=[];t&&(Array.isArray(t.controllerSelections)&&Ce.push(...t.controllerSelections),Array.isArray(t.controllers)&&Ce.push(...t.controllers));const Ee=new Set(Ce.filter(ge=>typeof ge=="string").map(ge=>normalizeAutoGearTriggerValue(ge)).filter(Boolean)),Pe=ge=>{if(typeof ge!="string")return 0;const ue=ge.trim();if(!ue)return 0;const We=ue.split(" to ");let Me=We[0]?We[0].trim():"",Te=We[1]?We[1].trim():"";if(!Me&&Te&&(Me=Te),!Te&&Me&&(Te=Me),!Me)return 0;const Be=ct=>ct?Date.parse(`${ct}T00:00:00Z`):NaN,Ve=Be(Me);let je=Be(Te);return Number.isFinite(Ve)?(Number.isFinite(je)||(je=Ve),je<Ve?1:Math.floor((je-Ve)/(1440*60*1e3))+1):0},Je=(t?Array.isArray(t.shootingDays)?t.shootingDays:typeof t.shootingDays=="string"?t.shootingDays.split(`
`).map(ge=>ge.trim()).filter(Boolean):[]:[]).reduce((ge,ue)=>ge+Pe(ue),0),it=t&&typeof t.distanceSelection=="string"?t.distanceSelection.trim():"",rt=normalizeAutoGearTriggerValue(it);if(!r.length&&!o.some(ue=>(Array.isArray(ue.scenarios)?ue.scenarios.filter(Boolean):[]).length===0))return e;const Pt=ge=>{if(!ge||typeof ge!="object")return!1;const ue=[];return Array.isArray(ge.add)&&ue.push(ge.add),Array.isArray(ge.remove)&&ue.push(ge.remove),ue.some(We=>We.some(Me=>!Me||typeof Me!="object"?!1:(typeof Me.category=="string"?Me.category.trim().toLowerCase():"")==="matte box + filter"))},vt=[];if(o.forEach(ge=>{if(!ge)return;let ue=1;if(ge.always)ue=1;else{const pt=computeAutoGearScenarioOutcome(ge,n);if(!pt.active)return;ue=pt.multiplier||1}const We=Array.isArray(ge.mattebox)?ge.mattebox.filter(Boolean):[];if(We.length){const pt=We.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!s||!pt.includes(s))return!1}const Me=Array.isArray(ge.camera)?ge.camera.filter(Boolean):[],Te=normalizeAutoGearCameraWeightCondition(ge.cameraWeight);if(Me.length){const pt=Me.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!_||!pt.includes(_))return!1}const Be=Array.isArray(ge.ownGear)?ge.ownGear.filter(Boolean):[];if(Be.length){const pt=Be.map(go=>typeof go=="string"?go.trim():"").filter(Boolean);if(!pt.length)return!1;const mo=normalizeAutoGearConditionLogic(ge.ownGearLogic);if(mo==="none"){if(pt.some(go=>M.has(go)))return!1}else if(mo==="any"||mo==="or"){if(!pt.some(go=>M.has(go)))return!1}else if(!pt.every(go=>M.has(go)))return!1}if(Te&&(!Number.isFinite(B)||!evaluateAutoGearCameraWeightCondition(Te,B)))return!1;const Ve=Array.isArray(ge.monitor)?ge.monitor.filter(Boolean):[];if(Ve.length){const pt=Ve.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!V||!pt.includes(V))return!1}const je=Array.isArray(ge.tripodHeadBrand)?ge.tripodHeadBrand.filter(Boolean):[];if(je.length){const pt=je.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!H||!pt.includes(H))return!1}const mt=Array.isArray(ge.tripodBowl)?ge.tripodBowl.filter(Boolean):[];if(mt.length){const pt=mt.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!U||!pt.includes(U))return!1}const ct=Array.isArray(ge.tripodTypes)?ge.tripodTypes.filter(Boolean):[];if(ct.length){const pt=ct.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!pt.every(mo=>Y.has(mo)))return!1}const $t=Array.isArray(ge.tripodSpreader)?ge.tripodSpreader.filter(Boolean):[];if($t.length){const pt=$t.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!be||!pt.includes(be))return!1}const fo=Array.isArray(ge.crewPresent)?ge.crewPresent.filter(Boolean):[];if(fo.length){const pt=fo.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!pt.every(mo=>re.has(mo)))return!1}const no=Array.isArray(ge.crewAbsent)?ge.crewAbsent.filter(Boolean):[];if(no.length){const pt=no.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||pt.some(mo=>re.has(mo)))return!1}const Nt=Array.isArray(ge.wireless)?ge.wireless.filter(Boolean):[];if(Nt.length){const pt=Nt.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!z||!pt.includes(z))return!1}const xo=Array.isArray(ge.motors)?ge.motors.filter(Boolean):[];if(xo.length){const pt=xo.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length)return!1;const mo=pt.includes(AUTO_GEAR_ANY_MOTOR_TOKEN_FALLBACK),go=pt.filter(So=>So!==AUTO_GEAR_ANY_MOTOR_TOKEN_FALLBACK);if(mo&&ne.size===0||go.length&&!go.every(So=>ne.has(So)))return!1}const Io=Array.isArray(ge.controllers)?ge.controllers.filter(Boolean):[];if(Io.length){const pt=Io.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!pt.every(mo=>Ee.has(mo)))return!1}const qo=Array.isArray(ge.distance)?ge.distance.filter(Boolean):[];if(qo.length){const pt=qo.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!rt||!pt.includes(rt))return!1}const eo=normalizeAutoGearShootingDaysCondition(ge.shootingDays);if(eo&&Number.isFinite(eo.value)&&eo.value>0){if(eo.mode==="minimum"){if(Je<eo.value)return!1}else if(eo.mode==="maximum"){if(Je>eo.value)return!1}else if(eo.mode==="every"){const pt=eo.value,mo=pt>0?Math.floor(Je/pt):0;if(mo<1)return!1;ue*=mo}}const To=Array.isArray(ge.cameraHandle)?ge.cameraHandle.filter(Boolean):[];if(To.length){const pt=To.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!pt.every(mo=>d.has(mo)))return!1}const ko=Array.isArray(ge.viewfinderExtension)?ge.viewfinderExtension.filter(Boolean):[];if(ko.length){const pt=ko.map(mo=>normalizeAutoGearTriggerValue(mo)).filter(Boolean);if(!pt.length||!h||!pt.includes(h))return!1}const Jt=Array.isArray(ge.deliveryResolution)?ge.deliveryResolution.filter(Boolean):[];if(Jt.length){const pt=Jt.map(normalizeAutoGearTriggerValue).filter(Boolean);if(!pt.length||!v||!pt.includes(v))return!1}const lr=Array.isArray(ge.videoDistribution)?ge.videoDistribution.filter(Boolean):[];if(lr.length){const pt=lr.map(mo=>normalizeVideoDistributionOptionValueForSetups(mo)).map(mo=>mo==="__none__"?"":normalizeAutoGearTriggerValue(mo)).filter(Boolean);if(!pt.length||!pt.every(mo=>w.has(mo)))return!1}vt.push({rule:ge,multiplier:ue})}),!vt.length)return e;if(s){const ge=vt.filter(({rule:ue})=>{if(!Pt(ue))return!0;const We=Array.isArray(ue.mattebox)?ue.mattebox.filter(Boolean):[];if(!We.length)return!0;const Me=We.map(normalizeAutoGearTriggerValue).filter(Boolean);return Me.length?Me.includes(s):!1});if(!ge.length)return e;vt.length=0,ge.forEach(ue=>vt.push(ue))}const bo=document.createElement("div");bo.innerHTML=e;const Et=bo.querySelector(".gear-table");if(!Et)return e;let Ut=!1;return vt.forEach(({rule:ge,multiplier:ue})=>{const We=Math.max(1,Math.round(Number.isFinite(ue)?ue:1));ge.remove.forEach(Be=>{let Ve=normalizeAutoGearQuantity(Be.quantity)*We;if(Ve<=0)return;const je=findAutoGearCategoryCell(Et,Be.category);if(je&&(Ve=removeAutoGearItem(je,Be,Ve)),Ve>0){const mt=Array.from(Et.querySelectorAll("tbody.category-group tr:not(.category-row) td"));for(const ct of mt)if(ct!==je&&(Ve=removeAutoGearItem(ct,Be,Ve),Ve<=0))break}});const Me=Array.isArray(ge.add)?ge.add.slice():[];let Te=Me;if(shouldAugmentClampOnRule(ge)){const Be=buildClampOnBackingAdditionsFromInfo(t);Be.length&&(Te=mergeAutoGearAdditions(Me,Be))}Te.forEach(Be=>{const Ve=normalizeAutoGearQuantity(Be.quantity)*We,je=Ve===normalizeAutoGearQuantity(Be.quantity)?Be:{...Be,quantity:Ve},mt=ensureAutoGearCategory(Et,Be.category);mt&&addAutoGearItem(mt,je,ge),!Ut&&isOnboardMonitorRiggingItemEntry(Be)&&(Ut=!0)})}),Ut&&ensureOnboardMonitorRiggingAutoGearHighlight(Et),bo.innerHTML}function formatPhoneHref(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const o=t.replace(/[^0-9+*#;,]/g,"");return o||""}function formatEmailHref(e){if(typeof e!="string")return"";const t=e.trim();if(!t||!t.includes("@"))return"";const o=t.replace(/\s+/g,"");if(!o||!o.includes("@"))return"";const r=encodeURIComponent(o);return r?r.replace(/%40/g,"@"):""}function formatRequirementValue(e){if(e&&typeof e=="object"){if(typeof e.__html=="string"&&e.__html)return e.__html;if(Array.isArray(e)&&e.length){const o=e.map(r=>escapeHtml$2(typeof r=="string"?r:String(r||""))).join("<br>");if(o)return o}if(typeof e.text=="string"&&e.text)return escapeHtml$2(e.text).replace(/\n/g,"<br>")}const t=typeof e=="string"?e:e==null?"":String(e);return escapeHtml$2(t).replace(/\n/g,"<br>")}function resolveGearListCustomText(e,t,o){const r=texts?.[currentLang]?.[e],n=texts?.en?.[e],a=typeof r=="string"&&r.trim()?r:typeof n=="string"&&n.trim()?n:t;return!o||typeof o!="object"?a:Object.keys(o).reduce((s,l)=>{const u=o[l],d=typeof u=="string"?u:String(u??"");return s.replace(new RegExp(`\\{${l}\\}`,"g"),d)},a)}function getGearListRentalToggleTexts(e={}){const t=resolveGearListCustomText("gearListExcludeRentalToggle","Exclude for rental"),o=resolveGearListCustomText("gearListIncludeRentalToggle","Include for rental"),r=resolveGearListCustomText("gearListRentalNote","Rental handles this item"),n=resolveRentalProviderNoteLabel({fallback:r,rentalHouse:e&&e.rentalHouse?e.rentalHouse:void 0,input:e&&e.input?e.input:void 0});return{excludeLabel:t,includeLabel:o,noteLabel:n}}function setRentalExclusionState(e,t){if(!e||typeof e!="object")return!1;const o=!!t,r=e.classList?.contains("gear-item-rental-excluded")||e.getAttribute?.("data-rental-excluded")==="true",n=e.querySelector?.(".gear-rental-toggle");if(o?(e.classList?.add("gear-item-rental-excluded"),e.setAttribute?.("data-rental-excluded","true")):(e.classList?.remove("gear-item-rental-excluded"),e.removeAttribute?.("data-rental-excluded")),n){const s=n.getAttribute("data-label-off")||"",l=n.getAttribute("data-label-on")||s;n.setAttribute("aria-pressed",o?"true":"false"),n.textContent=o&&l||s}const{noteLabel:a}=getGearListRentalToggleTexts();return a&&e.getAttribute?e.getAttribute("data-rental-note")!==a&&e.setAttribute("data-rental-note",a):e.removeAttribute&&e.removeAttribute("data-rental-note"),r!==o}function createCustomCategoryKey(e){return typeof e!="string"||!e.trim()?"category":e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+/,"").replace(/-+$/,"")||"category"}function getCustomItemsContainer(e){return!gearListOutput||typeof e!="string"?null:gearListOutput.querySelector(`.gear-custom-items[data-gear-custom-list="${e}"]`)}const CUSTOM_CATEGORY_SUGGESTION_SOURCES={camera:["cameras"],"camera-support":["accessories.cameraSupport"],media:["media","accessories.media","accessories.cardReaders"],lens:["lenses"],"lens-support":["accessories.cameraSupport","accessories.rigging"],"matte-box-filter":["accessories.matteboxes","accessories.filters"],"lds-fiz":["fiz","accessories.cables.fiz"],"camera-batteries":["batteries","accessories.batteries"],"monitoring-batteries":["batteries","accessories.batteries"],chargers:["accessories.chargers"],monitoring:["monitors","directorMonitors","video","videoAssist","iosVideo"],"monitoring-support":["accessories.rigging","accessories.grip","accessories.carts"],rigging:["accessories.rigging","accessories.grip"],power:["accessories.power","accessories.powerPlates"],grip:["accessories.grip"],"carts-and-transportation":["accessories.carts"],miscellaneous:["accessories.matteboxes","accessories.filters","accessories.cables"],consumables:[]};function isSuggestionDeviceEntry(e){return!e||typeof e!="object"||Array.isArray(e)?!1:Object.values(e).some(t=>{if(t===null)return!0;const o=typeof t;return!!(o==="string"||o==="number"||o==="boolean"||Array.isArray(t))})}function collectDeviceSuggestionNames(e){if(!e||typeof e!="object")return[];const t=[];return Object.entries(e).forEach(([o,r])=>{if(!(!r||typeof r!="object")){if(isSuggestionDeviceEntry(r)){t.push(o);return}t.push(...collectDeviceSuggestionNames(r))}}),t}function getDeviceSuggestionNamesForPath(e){if(!e||typeof e!="string")return[];const t=e.split(".");let o=devices;for(let r=0;r<t.length;r+=1){const n=t[r];if(!o||typeof o!="object")return[];o=o[n]}return!o||typeof o!="object"?[]:collectDeviceSuggestionNames(o)}function collectStandardItemSuggestions(e){if(!gearListOutput||typeof e!="string")return[];const t=gearListOutput.querySelector(`.category-group[data-gear-custom-key="${e}"]`);if(!t)return[];const o=new Set,r=n=>{if(typeof n!="string")return;const a=n.trim();if(!a)return;const s=a.match(/^(?:\d+\s*x\s+)?(.+)$/i),l=s?s[1].trim():a;!l||/^none$/i.test(l)||o.add(l)};return t.querySelectorAll(".gear-standard-items .gear-item").forEach(n=>{const a=getGearItemDisplayName(n)||n.getAttribute("data-gear-name");r(a||n.textContent||"")}),t.querySelectorAll("select option").forEach(n=>{if(!n||typeof n.value!="string")return;const a=n.value.trim();a&&r(a)}),Array.from(o)}function getCustomCategorySuggestions(e,t){const o=e||createCustomCategoryKey(t||""),r=new Set,n=[];(CUSTOM_CATEGORY_SUGGESTION_SOURCES[o]||[]).forEach(l=>{getDeviceSuggestionNamesForPath(l).forEach(u=>{if(typeof u!="string")return;const d=u.trim();if(!d||/^none$/i.test(d))return;const m=d.toLowerCase();r.has(m)||(r.add(m),n.push(d))})}),collectStandardItemSuggestions(o).forEach(l=>{const u=l.trim();if(!u||/^none$/i.test(u))return;const d=u.toLowerCase();r.has(d)||(r.add(d),n.push(u))});const s=typeof localeSort=="function"?localeSort:(l,u)=>l.localeCompare(u,void 0,{sensitivity:"base"});return n.sort(s)}function ensureCustomCategorySuggestionList(e,t){const o=getCustomItemsContainer(e);if(!o)return null;const r=o.ownerDocument||(typeof document<"u"?document:null);if(!r)return null;const n=getCustomCategorySuggestions(e,t),a=o.querySelector(`datalist[data-gear-custom-suggestions="${e}"]`);if(!n.length)return a&&a.remove(),null;const s=`gear-custom-suggestions-${e}`,l=n.map(d=>`<option value="${escapeHtml$2(d)}"></option>`).join("");let u=a;return u?u.id!==s&&(u.id=s):(u=r.createElement("datalist"),u.id=s,u.setAttribute("data-gear-custom-suggestions",e),o.appendChild(u)),u._lastRenderedOptions!==l&&(u.innerHTML=l,u._lastRenderedOptions=l),s}function attachCustomItemSuggestions(e,t,o){if(!e)return;const r=ensureCustomCategorySuggestionList(t,o);r?e.setAttribute("data-gear-suggestions",r):e.removeAttribute("data-gear-suggestions")}function updateCustomItemPreview(e){if(!e)return;const t=e.querySelector(".gear-custom-item-preview");if(!t)return;const o=(e.getAttribute("data-gear-quantity")||"").trim(),r=e.getAttribute("data-gear-label")||e.getAttribute("data-gear-name")||"",n=String(r||"").trim(),a=(e.getAttribute("data-gear-attributes")||"").trim(),s=resolveGearListCustomText("gearListCustomItemPreviewFallback","Custom item");let l="";o&&n?l=`${o}x ${n}`:n?l=n:o?l=`${o}x ${s}`:l=s,a&&(l+=` (${a})`),t.textContent=l}function updateGearItemNoteElement(e,t){if(!e)return;const o=e.querySelector(".gear-item-note");if(!o)return;const r=o.ownerDocument||(typeof document<"u"?document:null),n=typeof localGetLocalizedText=="function"?localGetLocalizedText("gearListNoteLabel"):"",a=typeof n=="string"&&n.trim()?n.trim():"Note:",l=(typeof t=="string"?t:String(t??"")).trim();if(l){let u=o.querySelector(".gear-item-note__label"),d=o.querySelector(".gear-item-note__text");!u&&r&&(u=r.createElement("span"),u.className="gear-item-note__label",o.firstChild?o.insertBefore(u,o.firstChild):o.appendChild(u)),!d&&r&&(d=r.createElement("span"),d.className="gear-item-note__text",o.appendChild(d)),u&&d?(u.textContent=a,d.textContent=l):o.textContent=`${a} ${l}`,o.hidden=!1,o.removeAttribute("hidden"),o.setAttribute("aria-label",`${a} ${l}`.trim())}else{const u=o.querySelector(".gear-item-note__label"),d=o.querySelector(".gear-item-note__text");u&&(u.textContent=""),d&&(d.textContent=""),o.textContent="",o.hidden=!0,o.setAttribute("hidden",""),o.removeAttribute("aria-label")}}function ensureGearItemNoteSpan(e){if(!e)return null;let t=e.querySelector(".gear-item-note");if(t)return t;const o=e.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;t=o.createElement("span"),t.className="gear-item-note",t.hidden=!0;const r=e.classList&&e.classList.contains("gear-custom-item")?e.querySelector(".gear-custom-item-summary"):null;if(r)r.appendChild(t);else{const n=e.querySelector(".gear-custom-item-actions")||e.querySelector(".gear-custom-remove-btn")||e.querySelector(".gear-item-edit-btn");n?e.insertBefore(t,n):e.appendChild(t)}return t}function ensureGearItemExtraIndicator(e){if(!e)return null;let t=e.querySelector(".gear-item-extra-indicator");if(t)return t;const o=e.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;t=o.createElement("span"),t.className="gear-item-extra-indicator",t.hidden=!0;const r=e.classList&&e.classList.contains("gear-custom-item")?e.querySelector(".gear-custom-item-summary"):null;if(r){const n=r.querySelector(".gear-item-note");n?r.insertBefore(t,n):r.appendChild(t)}else{const n=e.querySelector(".gear-item-note")||e.querySelector(".gear-custom-item-actions")||e.querySelector(".gear-custom-remove-btn")||e.querySelector(".gear-item-edit-btn");n?e.insertBefore(t,n):e.appendChild(t)}return t}let cachedCameraCategoryLabelSet=null;function getCameraCategoryLabelSet(){if(cachedCameraCategoryLabelSet&&cachedCameraCategoryLabelSet.size)return cachedCameraCategoryLabelSet;const e=new Set;if(["camera","cameras"].forEach(o=>e.add(o)),typeof localGetLocalizedText=="function"){const o=localGetLocalizedText("category_cameras");typeof o=="string"&&o.trim()&&(e.add(o.trim().toLowerCase()),e.add(createCustomCategoryKey(o)))}const t=typeof texts=="object"&&texts?texts:null;return t&&typeof Object.keys=="function"&&Object.keys(t).forEach(o=>{const r=t[o];if(!r||typeof r!="object")return;const n=r.category_cameras;if(typeof n=="string"&&n.trim()){const a=n.trim().toLowerCase();e.add(a),e.add(createCustomCategoryKey(n))}}),cachedCameraCategoryLabelSet=e,e}function isPrimaryCameraItem(e){if(!e||typeof e.closest!="function")return!1;const t=e.closest("tbody.category-group");if(!t)return!1;const o=(t.getAttribute("data-gear-category-label")||"").trim().toLowerCase(),r=(t.getAttribute("data-gear-custom-key")||"").trim().toLowerCase(),n=(t.getAttribute("data-gear-table-category")||"").trim().toLowerCase(),a=getCameraCategoryLabelSet();return o&&a.has(o)||r&&a.has(r)||n&&a.has(n)}function getActiveCameraDisplayName(){if(typeof cameraSelect>"u"||!cameraSelect)return"";const e=cameraSelect.options&&cameraSelect.options[cameraSelect.selectedIndex];if(!e||e.value&&e.value==="None")return"";const t=typeof e.text=="string"?e.text:e.textContent||"";return typeof t=="string"?t.trim():""}function normalizeCameraLinkColorValue(e){if(typeof e!="string")return"";const t=e.trim();return t?/^#[0-9a-f]{6}$/i.test(t)?t.toLowerCase():/^[0-9a-f]{6}$/i.test(t)?`#${t.toLowerCase()}`:"":""}function generateDefaultCameraColor$1(e){const t=()=>{let r=0;if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(1);crypto.getRandomValues(a),r=a[0]/255}else r=Math.random();const n=Math.floor(r*200)+28;return Math.max(24,Math.min(232,n))};return`#${[t(),t(),t()].map(r=>r.toString(16).padStart(2,"0")).join("")}`}let cachedCameraColorDefaults=null;function getCameraLetterColorDefaults(){if(cachedCameraColorDefaults)return cachedCameraColorDefaults;const e={A:"#d32f2f",B:"#1e88e5",C:"#fdd835",D:"#43a047",E:"#7b1fa2"};let t=null;try{if(typeof localStorage<"u"){const o=localStorage.getItem(CAMERA_COLOR_STORAGE_KEY);o&&(t=JSON.parse(o))}}catch(o){console.warn("Failed to read stored camera colors",o),t=null}if(t&&typeof t=="object")CAMERA_LINK_LETTERS.forEach(o=>{const r=t[o]||t[o.toLowerCase()],n=normalizeCameraLinkColorValue(r);n&&(e[o]=n)});else{const o=generateDefaultCameraColor$1();o&&(e.E=o);try{typeof localStorage<"u"&&localStorage.setItem(CAMERA_COLOR_STORAGE_KEY,JSON.stringify(e))}catch(r){console.warn("Unable to persist default camera colors",r)}}return cachedCameraColorDefaults=e,e}function normalizeCameraLetter(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";if(t.toLowerCase()==="camera")return"A";const o=t[0].toUpperCase();return CAMERA_LINK_LETTERS.includes(o)?o:""}function getCameraLetterColorsSafe(){const e=getCameraLetterColorDefaults();if(typeof getCameraLetterColors=="function")try{const t=getCameraLetterColors();if(t&&typeof t=="object"){const o={...e};return CAMERA_LINK_LETTERS.forEach(r=>{const n=t[r]||t[r.toLowerCase()],a=normalizeCameraLinkColorValue(n);a&&(o[r]=a)}),o}}catch(t){console.warn("Failed to load camera letter colors",t)}return e}function getCameraLetterColor(e){const t=getCameraLetterColorsSafe(),o=normalizeCameraLetter(e);return o&&t[o]?t[o]:t.A}function computeCameraLetterTextColor(e){if(typeof e!="string"||!e)return"";const t=e.trim().match(/^#?([0-9a-f]{3}|[0-9a-f]{6})$/i);if(!t)return"";let o=t[1];o.length===3&&(o=o.split("").map(l=>l+l).join(""));const r=parseInt(o.slice(0,2),16)/255,n=parseInt(o.slice(2,4),16)/255,a=parseInt(o.slice(4,6),16)/255;return .2126*r+.7152*n+.0722*a>.55?"#111111":"#ffffff"}function collectCameraSourceEntries(e){const t=gearListOutput||(typeof document<"u"?document:null);if(!t||typeof t.querySelectorAll!="function")return[];const o=t.querySelectorAll('[data-gear-camera-role="source"], [data-gear-camera-letter]'),r=new Map;return o.forEach(n=>{if(!n||typeof n.getAttribute!="function"||!isPrimaryCameraItem(n))return;const a=n.getAttribute("data-gear-camera-letter")||n.getAttribute("data-gear-camera-link")||"",s=normalizeCameraLetter(a);if(!s||r.has(s))return;const l=(n.getAttribute("data-gear-camera-link-label")||n.getAttribute("data-gear-label")||n.textContent||"").trim();r.set(s,{letter:s,label:l})}),Array.from(r.values())}function refreshAllCameraLinkIndicators(e){const t=gearListOutput||(typeof document<"u"?document:null);if(!t||typeof t.querySelectorAll!="function")return;const o=t.querySelectorAll(".gear-item, .gear-custom-item"),n=getGearItemEditTexts().cameraLinkBadgeLabel;o.forEach(a=>{if(!a||typeof a.getAttribute!="function")return;const s=a.getAttribute("data-gear-camera-link")||a.getAttribute("data-gear-camera-letter")||"",l=normalizeCameraLetter(s),u=isPrimaryCameraItem(a),d=a.getAttribute("data-gear-camera-link-label")||(u?getActiveCameraDisplayName():"")||"",m=d?`${n} — ${d}`:n,y=l?getCameraLetterColor(l):"";updateGearItemCameraLinkIndicator(a,!!l,{isPrimary:u,badgeLabel:m,letter:l,color:y})})}function ensureGearItemCameraLinkIndicator(e){if(!e)return null;let t=e.querySelector(".gear-item-camera-link");if(t)return t;const o=e.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;const r=getGearItemEditTexts();t=o.createElement("span"),t.className="gear-item-camera-link",t.hidden=!0,t.setAttribute("data-camera-letter","");const n=o.createElement("span");n.className="gear-item-camera-link__icon",n.setAttribute("aria-hidden","true"),n.textContent="A",t.appendChild(n);const a=o.createElement("span");a.className="visually-hidden",a.setAttribute("data-camera-link-assist","true"),a.textContent=r.cameraLinkBadgeLabel,t.appendChild(a);const s=e.classList&&e.classList.contains("gear-custom-item")?e.querySelector(".gear-custom-item-summary"):null;if(s){const l=s.querySelector(".gear-item-note");l?s.insertBefore(t,l):s.appendChild(t)}else{const l=e.querySelector(".gear-item-note")||e.querySelector(".gear-item-provider")||e.querySelector(".gear-item-extra-indicator")||e.querySelector(".gear-item-edit-btn")||e.querySelector(".gear-custom-item-actions")||e.querySelector(".gear-custom-remove-btn");l?e.insertBefore(t,l):e.appendChild(t)}return t}function updateGearItemCameraLinkIndicator(e,t,o={}){const r=ensureGearItemCameraLinkIndicator(e);if(!r)return;if(!t){r.hidden=!0,r.setAttribute("hidden",""),r.classList.remove("gear-item-camera-link--primary"),r.removeAttribute("data-camera-letter"),r.style.removeProperty("--camera-link-color"),r.style.removeProperty("--camera-link-text-color");return}const n=getGearItemEditTexts();r.hidden=!1,r.removeAttribute("hidden"),r.classList.toggle("gear-item-camera-link--primary",!!o.isPrimary);const a=r.querySelector(".gear-item-camera-link__icon");if(a){const l=normalizeCameraLetter(o.letter||o.iconText||"")||"A";a.textContent=l,r.setAttribute("data-camera-letter",l);const u=o.color||getCameraLetterColor(l);if(u){r.style.setProperty("--camera-link-color",u);const d=computeCameraLetterTextColor(u);d?r.style.setProperty("--camera-link-text-color",d):r.style.removeProperty("--camera-link-text-color")}else r.style.removeProperty("--camera-link-color"),r.style.removeProperty("--camera-link-text-color")}const s=r.querySelector("[data-camera-link-assist]");if(s){const l=o.badgeLabel||n.cameraLinkBadgeLabel;s.textContent=l}}function ensureGearItemTextContainer(e){if(!e)return null;let t=e.querySelector(".gear-item-text");if(t)return t;const o=e.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;t=o.createElement("span"),t.className="gear-item-text";const r=[];e.childNodes.forEach(a=>{if(a){if(a.nodeType===1){const s=a.classList;if(s&&(s.contains("gear-item-note")||s.contains("gear-item-extra-indicator")||s.contains("gear-item-edit-btn")||s.contains("gear-custom-item-actions")||s.contains("gear-custom-remove-btn")))return}r.push(a)}});const n=e.querySelector(".gear-item-extra-indicator")||e.querySelector(".gear-item-note")||e.querySelector(".gear-custom-item-actions")||e.querySelector(".gear-custom-remove-btn")||e.querySelector(".gear-item-edit-btn");return r.forEach(a=>{t.appendChild(a)}),n?e.insertBefore(t,n):e.appendChild(t),t}function parseGearItemDisplayParts(e){const t=typeof e=="string"?e.trim():"";if(!t)return{quantity:"",name:"",attributes:""};let o=t,r="";const n=o.match(/^(\d+)\s*x\s*(.*)$/i);n&&(r=n[1]||"",o=n[2]||"");const a=o.match(/^(.*?)(?:\s*\(([^()]+)\))?$/),s=a?(a[1]||"").trim():o.trim(),l=a&&a[2]?a[2].trim():"";return{quantity:r,name:s,attributes:l}}function getGearItemData(e){if(!e)return{quantity:"",name:"",attributes:"",note:"",rentalExcluded:!1};const t=e.getAttribute("data-gear-quantity")||"",o=e.getAttribute("data-gear-label")||e.getAttribute("data-gear-name")||"",r=e.getAttribute("data-gear-attributes")||"",n=e.getAttribute("data-gear-note")||"",a=e.getAttribute("data-gear-provider")||"",s=e.getAttribute("data-gear-provider-label")||"",l=e.getAttribute("data-gear-extra")==="true",u=e.getAttribute("data-gear-extra-start")||"",d=e.getAttribute("data-gear-extra-end")||"",m=e.getAttribute("data-gear-extra-label")||"",y=e.querySelector(".gear-item-text"),h=y?y.textContent:e.textContent||"",b=parseGearItemDisplayParts(h),v=t.trim()||b.quantity||"",C=o.trim()||b.name||"",A=r.trim()||b.attributes||"",w=n.trim(),R=e.getAttribute("data-rental-excluded")==="true"||e.classList.contains("gear-item-rental-excluded");let _=a.trim();_||(_=guessDefaultProvider(C));const G=s.trim(),O=e.getAttribute("data-gear-camera-link")||"",B=e.getAttribute("data-gear-camera-letter")||"",$=e.getAttribute("data-gear-camera-link-label")||"",V=isPrimaryCameraItem(e);let M=normalizeCameraLetter(O||B);V&&!M&&(M="A");const F=$.trim()||(V?getActiveCameraDisplayName():"");return{quantity:v,name:C,attributes:A,note:w,rentalExcluded:R,providedBy:_,providerLabel:G,extra:l,extraStart:u.trim(),extraEnd:d.trim(),extraLabel:m.trim(),cameraLink:M,cameraLinkLabel:F}}function getGearItemResetDefaults(e){if(!e)return{name:"",attributes:""};const t=e.getAttribute("data-gear-original-name")||e.getAttribute("data-gear-name")||"",o=parseGearItemDisplayParts(t);let r=e.getAttribute("data-gear-original-label")||"",n=e.getAttribute("data-gear-original-attributes")||"";return!r&&o.name&&(r=o.name),!n&&o.attributes&&(n=o.attributes),{name:typeof r=="string"?r.trim():"",attributes:typeof n=="string"?n.trim():""}}function getGearItemExtraTexts(){const e=typeof texts=="object"&&texts?texts:{},t=typeof currentLang=="string"&&e[currentLang]?currentLang:"en",o=e[t]||{},r=e.en||{};return{indicatorBase:o.gearListExtraIndicatorNoPeriod||r.gearListExtraIndicatorNoPeriod||"Temporary extra",indicatorRange:o.gearListExtraIndicatorRange||r.gearListExtraIndicatorRange||"Temporary extra: %s – %s",indicatorStart:o.gearListExtraIndicatorOpen||r.gearListExtraIndicatorOpen||"Temporary extra from %s",indicatorEnd:o.gearListExtraIndicatorEnd||r.gearListExtraIndicatorEnd||"Temporary extra until %s"}}function getExtraGearUiTexts(){const e=typeof texts=="object"&&texts?texts:{},t=typeof currentLang=="string"&&e[currentLang]?currentLang:"en",o=e[t]||{},r=e.en||{};return{categoryLabel:o.gearListExtraCategoryLabel||r.gearListExtraCategoryLabel||"Temporary Extras",addButton:o.addExtraGearBtn||r.addExtraGearBtn||"Add temporary extra gear",checkboxLabel:o.gearListEditExtraLabel||r.gearListEditExtraLabel||"Temporary extra gear",checkboxHelp:o.gearListEditExtraHelp||r.gearListEditExtraHelp||"",periodHelp:o.gearListEditExtraPeriodHelp||r.gearListEditExtraPeriodHelp||"",startLabel:o.gearListEditExtraStartLabel||r.gearListEditExtraStartLabel||"Needed from",endLabel:o.gearListEditExtraEndLabel||r.gearListEditExtraEndLabel||"Needed until"}}function formatExtraDate(e){const t=typeof e=="string"?e.trim():"";if(!t)return"";const o=new Date(t);if(Number.isNaN(o.getTime()))return t;try{return new Intl.DateTimeFormat(void 0,{dateStyle:"medium"}).format(o)}catch{}return t}function sanitizeExtraPeriod(e,t){const o=typeof e=="string"?e.trim():"",r=typeof t=="string"?t.trim():"";let n=o,a=r;if(o&&r){const s=new Date(o),l=new Date(r);!Number.isNaN(s.getTime())&&!Number.isNaN(l.getTime())&&s.getTime()>l.getTime()&&(n=r,a=o)}return{start:n,end:a}}function formatExtraPeriodLabel(e,t){const o=getGearItemExtraTexts(),r=formatExtraDate(e),n=formatExtraDate(t);return r&&n?o.indicatorRange.replace("%s",r).replace("%s",n):r?o.indicatorStart.replace("%s",r):n?o.indicatorEnd.replace("%s",n):o.indicatorBase}function applyGearItemData(e,t={},o={}){if(!e)return;const r=e.ownerDocument||(typeof document<"u"?document:null);if(!r)return;const n=e.classList&&e.classList.contains("gear-custom-item"),a=n?e.querySelector(".gear-item-text"):ensureGearItemTextContainer(e);if(ensureGearItemNoteSpan(e),!a&&!n)return;let s=typeof t.quantity=="string"?t.quantity.trim():String(t.quantity??"").trim();const l=typeof t.name=="string"?t.name.trim():String(t.name??"").trim(),u=typeof t.attributes=="string"?t.attributes.trim():String(t.attributes??"").trim(),d=typeof t.note=="string"?t.note.trim():String(t.note??"").trim();if(!n&&!s){const H=e.querySelector("select[data-monitor-battery-key]");if(H){const W=H.getAttribute("data-monitor-battery-type")||(H.dataset?H.dataset.monitorBatteryType:"");W==="large"?s="2":W&&(s="3")}}if(!n&&a){const H=Array.from(a.querySelectorAll("select, input, textarea"));for(H.forEach(U=>{U&&U.parentElement===a&&a.removeChild(U)});a.firstChild;)a.removeChild(a.firstChild);const W=!!s&&(l||H.length||u);s&&a.appendChild(r.createTextNode(`${s}x${W?" ":""}`)),l&&(a.appendChild(r.createTextNode(l)),(H.length||u)&&a.appendChild(r.createTextNode(" "))),!l&&H.length&&s&&a.appendChild(r.createTextNode("")),H.forEach((U,j)=>{a.appendChild(U),(j<H.length-1||u)&&a.appendChild(r.createTextNode(" "))}),u&&a.appendChild(r.createTextNode(`(${u})`))}s?e.setAttribute("data-gear-quantity",s):e.removeAttribute("data-gear-quantity"),l?e.setAttribute("data-gear-label",l):e.removeAttribute("data-gear-label"),u?e.setAttribute("data-gear-attributes",u):e.removeAttribute("data-gear-attributes"),d?e.setAttribute("data-gear-note",d):e.removeAttribute("data-gear-note");const m=typeof t.providedBy=="string"?t.providedBy.trim():e.getAttribute("data-gear-provider")||"",y=typeof t.providerLabel=="string"?t.providerLabel.trim():e.getAttribute("data-gear-provider-label")||"";setGearItemProvider$1(e,m,{label:y});const h=normalizeCameraLetter(typeof t.cameraLink=="string"?t.cameraLink.trim():""),b=typeof t.cameraLinkLabel=="string"?t.cameraLinkLabel.trim():"",v=isPrimaryCameraItem(e),C=v&&!h?"A":h,A=!!C,w=b||(v?getActiveCameraDisplayName():"");A?(e.setAttribute("data-gear-camera-link",C),v?(e.setAttribute("data-gear-camera-role","source"),e.setAttribute("data-gear-camera-letter",C)):(e.removeAttribute("data-gear-camera-role"),e.removeAttribute("data-gear-camera-letter")),w?e.setAttribute("data-gear-camera-link-label",w):e.removeAttribute("data-gear-camera-link-label")):(e.removeAttribute("data-gear-camera-link"),e.removeAttribute("data-gear-camera-link-label"),e.removeAttribute("data-gear-camera-role"),e.removeAttribute("data-gear-camera-letter")),e.classList&&e.classList.toggle("gear-item-camera-linked",A);const _=getGearItemEditTexts().cameraLinkBadgeLabel,G=w?`${_} — ${w}`:_,O=A?C:"",B=O?getCameraLetterColor(O):"";if(updateGearItemCameraLinkIndicator(e,A,{isPrimary:v,badgeLabel:G,letter:O,color:B}),!e.getAttribute("data-gear-original-name")){const H=e.getAttribute("data-gear-name");if(H){e.setAttribute("data-gear-original-name",H);const W=parseGearItemDisplayParts(H);!e.getAttribute("data-gear-original-label")&&W.name&&e.setAttribute("data-gear-original-label",W.name),!e.getAttribute("data-gear-original-attributes")&&W.attributes&&e.setAttribute("data-gear-original-attributes",W.attributes)}}const $=u?`${l||""} (${u})`.trim():l;$?e.setAttribute("data-gear-name",$):s&&e.setAttribute("data-gear-name",`${s}x`);const V=!!(t&&(t.extra===!0||t.extra==="true"||t.extra===1||t.extra==="1")),M=V?sanitizeExtraPeriod(Object.prototype.hasOwnProperty.call(t,"extraStart")?t.extraStart:"",Object.prototype.hasOwnProperty.call(t,"extraEnd")?t.extraEnd:""):{start:"",end:""},F=getGearItemExtraTexts(),z=V?formatExtraPeriodLabel(M.start,M.end):"",x=ensureGearItemExtraIndicator(e);if(V){e.setAttribute("data-gear-extra","true"),M.start?e.setAttribute("data-gear-extra-start",M.start):e.removeAttribute("data-gear-extra-start"),M.end?e.setAttribute("data-gear-extra-end",M.end):e.removeAttribute("data-gear-extra-end");const H=z||F.indicatorBase;if(e.setAttribute("data-gear-extra-label",H),x){const W=z||F.indicatorBase;x.textContent=W,x.hidden=!1,x.removeAttribute("hidden"),x.setAttribute("aria-label",W)}}else e.removeAttribute("data-gear-extra"),e.removeAttribute("data-gear-extra-start"),e.removeAttribute("data-gear-extra-end"),e.removeAttribute("data-gear-extra-label"),x&&(x.textContent="",x.hidden=!0,x.setAttribute("hidden",""),x.removeAttribute("aria-label"));updateGearItemNoteElement(e,d),n&&!o.skipPreview&&updateCustomItemPreview(e),typeof t.rentalExcluded=="boolean"&&setRentalExclusionState(e,t.rentalExcluded)}function migrateLegacyCustomItemEntry(e){if(!e||!e.classList||!e.classList.contains("gear-custom-item")||!e.querySelector("[data-gear-custom-input]"))return e;const o=e.parentElement;if(!o)return e;const r=e.getAttribute("data-gear-custom-entry")||"",n=o.getAttribute("data-gear-custom-category")||"",a=e.querySelector('[data-gear-custom-input="quantity"]'),s=e.querySelector('[data-gear-custom-input="name"]'),l=a?String(a.value??""):"",u=s?String(s.value??""):"",d=e.getAttribute("data-gear-attributes")||"",m=e.getAttribute("data-gear-note")||"",y=e.getAttribute("data-rental-excluded")==="true",h=buildCustomItemEntryElement(r,n,{quantity:l,name:u,attributes:d,note:m});return h?(o.insertBefore(h,e.nextSibling),e.remove(),setRentalExclusionState(h,y),attachCustomItemSuggestions(h,r,n),h):e}function ensureGearItemEditButton(e){if(!e)return null;if(e.querySelector(".gear-item-edit-btn"))return e.querySelector(".gear-item-edit-btn");const t=e.ownerDocument||(typeof document<"u"?document:null);if(!t)return null;const o=t.createElement("button");o.type="button",o.className="gear-item-edit-btn",o.setAttribute("data-gear-edit","");const n=getGearItemEditTexts().editButtonLabel;o.setAttribute("aria-label",n),o.setAttribute("title",n);const s=typeof ICON_GLYPHS=="object"&&ICON_GLYPHS?ICON_GLYPHS.sliders:null;typeof setButtonLabelWithIconForSetups=="function"&&s?setButtonLabelWithIconForSetups(o,"",s):typeof iconMarkup=="function"&&s?o.innerHTML=iconMarkup(s,{className:"btn-icon"}):o.textContent=n;const l=e.querySelector(".gear-item-note");return l?e.insertBefore(o,l.nextSibling):e.appendChild(o),o}function enhanceGearItemElement$1(e){if(!e)return;e.classList&&e.classList.contains("gear-custom-item")&&(e=migrateLegacyCustomItemEntry(e));const t=e.classList&&e.classList.contains("gear-custom-item");ensureGearItemNoteSpan(e),ensureGearItemExtraIndicator(e),t||(ensureGearItemTextContainer(e),ensureGearItemEditButton(e));const o=getGearItemData(e);if(!o.quantity){const r=e.querySelector("select[data-monitor-battery-type]");if(r){const n=r.getAttribute("data-monitor-battery-type")==="handheld"?"3":"2";o.quantity=n}}applyGearItemData(e,o,{skipPreview:!t})}function ensureExtraGearCategory(){if(!gearListOutput)return null;const e=getCustomItemsContainer(EXTRA_GEAR_CATEGORY_KEY);if(e)return e;const t=gearListOutput.querySelector(".gear-table");if(!t)return null;const o=t.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;const r=getExtraGearUiTexts(),n=r.categoryLabel,a=o.createElement("tbody");a.className="category-group",a.setAttribute("data-gear-custom-key",EXTRA_GEAR_CATEGORY_KEY),a.setAttribute("data-gear-table-category",n);const s=o.createElement("tr");s.className="category-row";const l=o.createElement("td");l.setAttribute("data-gear-category-label",n);const u=o.createElement("div");u.className="gear-category-header";const d=o.createElement("span");d.className="gear-category-label",d.textContent=n,u.appendChild(d);const m=o.createElement("button");m.type="button",m.className="gear-custom-add-btn",m.setAttribute("data-gear-custom-add",EXTRA_GEAR_CATEGORY_KEY),m.setAttribute("data-gear-custom-category",n),m.setAttribute("data-extra-gear","true"),m.setAttribute("aria-label",r.addButton),m.setAttribute("title",r.addButton);const y=typeof ICON_GLYPHS=="object"&&ICON_GLYPHS,h=y&&(ICON_GLYPHS.add||ICON_GLYPHS.plus);typeof setButtonLabelWithIconForSetups=="function"&&y&&h?setButtonLabelWithIconForSetups(m,"",h):typeof iconMarkup=="function"&&h?m.innerHTML=iconMarkup(h,{className:"btn-icon"}):m.textContent="+",u.appendChild(m),l.appendChild(u),s.appendChild(l),a.appendChild(s);const b=o.createElement("tr"),v=o.createElement("td"),C=o.createElement("div");C.className="gear-custom-section",C.setAttribute("data-gear-custom-key",EXTRA_GEAR_CATEGORY_KEY),C.setAttribute("data-gear-custom-category",n);const A=o.createElement("div");return A.className="gear-custom-items",A.setAttribute("data-gear-custom-list",EXTRA_GEAR_CATEGORY_KEY),A.setAttribute("data-gear-custom-category",n),A.setAttribute("aria-live","polite"),C.appendChild(A),v.appendChild(C),b.appendChild(v),a.appendChild(b),t.appendChild(a),A}function buildGearItemEditContext(){return{dialog:resolveElementById("gearItemEditDialog","gearItemEditDialog"),form:resolveElementById("gearItemEditForm","gearItemEditForm"),title:resolveElementById("gearItemEditTitle","gearItemEditTitle"),preview:resolveElementById("gearItemEditPreview","gearItemEditPreview"),quantityInput:resolveElementById("gearItemEditQuantity","gearItemEditQuantity"),quantityLabel:resolveElementById("gearItemEditQuantityLabel","gearItemEditQuantityLabel"),nameInput:resolveElementById("gearItemEditName","gearItemEditName"),nameLabel:resolveElementById("gearItemEditNameLabel","gearItemEditNameLabel"),attributesInput:resolveElementById("gearItemEditAttributes","gearItemEditAttributes"),attributesLabel:resolveElementById("gearItemEditAttributesLabel","gearItemEditAttributesLabel"),noteInput:resolveElementById("gearItemEditNote","gearItemEditNote"),noteLabel:resolveElementById("gearItemEditNoteLabel","gearItemEditNoteLabel"),deviceSection:resolveElementById("gearItemEditDeviceSection","gearItemEditDeviceSection"),deviceHeading:resolveElementById("gearItemEditDeviceHeading","gearItemEditDeviceHeading"),deviceCategory:resolveElementById("gearItemEditDeviceCategory","gearItemEditDeviceCategory"),deviceSummary:resolveElementById("gearItemEditDeviceSummary","gearItemEditDeviceSummary"),deviceEmpty:resolveElementById("gearItemEditDeviceEmpty","gearItemEditDeviceEmpty"),deviceButton:resolveElementById("gearItemEditDeviceButton","gearItemEditDeviceButton"),extraContainer:resolveElementById("gearItemEditExtraContainer","gearItemEditExtraContainer"),extraCheckbox:resolveElementById("gearItemEditExtra","gearItemEditExtra"),extraLabel:resolveElementById("gearItemEditExtraLabel","gearItemEditExtraLabel"),extraHelp:resolveElementById("gearItemEditExtraHelp","gearItemEditExtraHelp"),extraPeriodContainer:resolveElementById("gearItemEditExtraPeriod","gearItemEditExtraPeriod"),extraStartInput:resolveElementById("gearItemEditExtraStart","gearItemEditExtraStart"),extraStartLabel:resolveElementById("gearItemEditExtraStartLabel","gearItemEditExtraStartLabel"),extraEndInput:resolveElementById("gearItemEditExtraEnd","gearItemEditExtraEnd"),extraEndLabel:resolveElementById("gearItemEditExtraEndLabel","gearItemEditExtraEndLabel"),extraPeriodHelp:resolveElementById("gearItemEditExtraPeriodHelp","gearItemEditExtraPeriodHelp"),providerSelect:resolveElementById("gearItemEditProvider","gearItemEditProvider"),providerLabel:resolveElementById("gearItemEditProviderLabel","gearItemEditProviderLabel"),providerHelp:resolveElementById("gearItemEditProviderHelp","gearItemEditProviderHelp"),ownedContainer:resolveElementById("gearItemEditOwnedContainer","gearItemEditOwnedContainer"),ownedCheckbox:resolveElementById("gearItemEditOwned","gearItemEditOwned"),ownedLabel:resolveElementById("gearItemEditOwnedLabel","gearItemEditOwnedLabel"),ownedHelp:resolveElementById("gearItemEditOwnedHelp","gearItemEditOwnedHelp"),cameraLinkContainer:resolveElementById("gearItemEditCameraLinkContainer","gearItemEditCameraLinkContainer"),cameraLinkSelect:resolveElementById("gearItemEditCameraLink","gearItemEditCameraLink"),cameraLinkLabel:resolveElementById("gearItemEditCameraLinkLabel","gearItemEditCameraLinkLabel"),cameraLinkHelp:resolveElementById("gearItemEditCameraLinkHelp","gearItemEditCameraLinkHelp"),rentalCheckbox:resolveElementById("gearItemEditRental","gearItemEditRental"),rentalSection:resolveElementById("gearItemEditRentalSection","gearItemEditRentalSection"),rentalLabel:resolveElementById("gearItemEditRentalLabel","gearItemEditRentalLabel"),rentalDescription:resolveElementById("gearItemEditRentalDescription","gearItemEditRentalDescription"),cancelButton:resolveElementById("gearItemEditCancel","gearItemEditCancel"),saveButton:resolveElementById("gearItemEditSave","gearItemEditSave"),resetButton:resolveElementById("gearItemEditReset","gearItemEditReset"),resetDefaults:null,currentAttributes:"",currentOwnedEntryId:"",currentCameraLinkValue:"",isCameraItem:!1,deviceEditData:null}}let cachedGearItemEditContext=null;function getGearItemEditContext(e){return e&&typeof e=="object"&&e.context&&typeof e.context=="object"?e.context:(cachedGearItemEditContext||(cachedGearItemEditContext=buildGearItemEditContext()),cachedGearItemEditContext)}function getGearItemEditTexts(){const e=typeof texts=="object"&&texts?texts[currentLang]||texts.en||{}:{},t=texts&&texts.en?texts.en:{};return{dialogTitle:e.gearListEditDialogTitle||t.gearListEditDialogTitle||"Edit gear item",quantityLabel:e.gearListEditQuantityLabel||t.gearListEditQuantityLabel||"Quantity",nameLabel:e.gearListEditNameLabel||t.gearListEditNameLabel||"Item name",attributesLabel:e.gearListEditAttributesLabel||t.gearListEditAttributesLabel||"Attributes",noteLabel:e.gearListEditNoteLabel||t.gearListEditNoteLabel||"Note",extraLabel:e.gearListEditExtraLabel||t.gearListEditExtraLabel||"Temporary extra gear",extraHelp:e.gearListEditExtraHelp||t.gearListEditExtraHelp||"",extraStartLabel:e.gearListEditExtraStartLabel||t.gearListEditExtraStartLabel||"Needed from",extraEndLabel:e.gearListEditExtraEndLabel||t.gearListEditExtraEndLabel||"Needed until",extraPeriodHelp:e.gearListEditExtraPeriodHelp||t.gearListEditExtraPeriodHelp||"",providerLabel:e.gearListEditProviderLabel||t.gearListEditProviderLabel||"Provided by",providerHelp:e.gearListEditProviderHelp||t.gearListEditProviderHelp||"",providerRental:e.gearListProviderRental||t.gearListProviderRental||"Rental",providerUser:e.gearListProviderUser||t.gearListProviderUser||"User",providerCrewHeading:e.gearListProviderCrewHeading||t.gearListProviderCrewHeading||"Crew",providerUnknown:e.gearListProviderUnknown||t.gearListProviderUnknown||"Custom provider",ownedLabel:e.gearListEditOwnedLabel||t.gearListEditOwnedLabel||"Owned",ownedHelp:e.gearListEditOwnedHelp||t.gearListEditOwnedHelp||"",cameraLinkLabel:e.gearListEditCameraLinkLabel||t.gearListEditCameraLinkLabel||"Camera link",cameraLinkHelp:e.gearListEditCameraLinkHelp||t.gearListEditCameraLinkHelp||"",cameraAssignmentLabel:e.gearListEditCameraAssignmentLabel||t.gearListEditCameraAssignmentLabel||"Camera designation",cameraAssignmentHelp:e.gearListEditCameraAssignmentHelp||t.gearListEditCameraAssignmentHelp||"",cameraLinkNoneOption:e.gearListEditCameraLinkNoneOption||t.gearListEditCameraLinkNoneOption||"No camera link",cameraLinkCameraOption:e.gearListEditCameraLinkCameraOption||t.gearListEditCameraLinkCameraOption||"Camera %s — %s",cameraLinkUnavailableOption:e.gearListEditCameraLinkUnavailableOption||t.gearListEditCameraLinkUnavailableOption||"Camera %s (unassigned)",cameraLinkDefaultLabel:e.gearListEditCameraLinkDefaultLabel||t.gearListEditCameraLinkDefaultLabel||"Camera %s",cameraLinkBadgeLabel:e.gearListCameraLinkBadgeLabel||t.gearListCameraLinkBadgeLabel||"Linked to camera",rentalLabel:e.gearListEditRentalLabel||t.gearListEditRentalLabel||"Exclude from rental",rentalNote:resolveRentalProviderNoteLabel({fallback:e.gearListRentalNote||t.gearListRentalNote||"Rental handles this item"}),saveLabel:e.gearListEditSave||t.gearListEditSave||"Save",cancelLabel:e.gearListEditCancel||t.gearListEditCancel||"Cancel",editButtonLabel:e.gearListEditButton||t.gearListEditButton||"Edit gear item",resetLabel:e.gearListEditReset||t.gearListEditReset||"Reset name",deviceHeading:e.gearListEditDeviceHeading||t.gearListEditDeviceHeading||"Device attributes",deviceEditButton:e.gearListEditDeviceEdit||t.gearListEditDeviceEdit||"Edit device attributes",deviceEmpty:e.gearListEditDeviceEmpty||t.gearListEditDeviceEmpty||"No device attributes recorded yet. Update the device to add details.",deviceCategoryLabel:e.gearListEditDeviceCategory||t.gearListEditDeviceCategory||"Device library: %s"}}function applyGearItemEditDialogTexts(e){if(!e)return;const t=getGearItemEditTexts();if(e.title&&(e.title.textContent=t.dialogTitle),e.preview&&(e.preview.textContent="",e.preview.hidden=!0),hideGearItemEditDeviceInfo(e),e.quantityLabel&&(e.quantityLabel.textContent=t.quantityLabel),e.nameLabel&&(e.nameLabel.textContent=t.nameLabel),e.noteLabel&&(e.noteLabel.textContent=t.noteLabel),e.attributesLabel&&(e.attributesLabel.textContent=t.attributesLabel),e.extraLabel){const a=e.extraLabel.querySelector("span");a?a.textContent=t.extraLabel:e.extraLabel.textContent=t.extraLabel}if(e.extraCheckbox&&e.extraCheckbox.setAttribute("aria-label",t.extraLabel),e.extraHelp&&(t.extraHelp?(e.extraHelp.textContent=t.extraHelp,e.extraHelp.hidden=!1,e.extraHelp.removeAttribute("hidden")):(e.extraHelp.textContent="",e.extraHelp.hidden=!0,e.extraHelp.setAttribute("hidden",""))),e.extraStartLabel&&(e.extraStartLabel.textContent=t.extraStartLabel),e.extraEndLabel&&(e.extraEndLabel.textContent=t.extraEndLabel),e.extraPeriodHelp&&(t.extraPeriodHelp?(e.extraPeriodHelp.textContent=t.extraPeriodHelp,e.extraPeriodHelp.hidden=!1,e.extraPeriodHelp.removeAttribute("hidden")):(e.extraPeriodHelp.textContent="",e.extraPeriodHelp.hidden=!0,e.extraPeriodHelp.setAttribute("hidden",""))),e.providerLabel&&(e.providerLabel.textContent=t.providerLabel),e.providerHelp&&(e.providerHelp.textContent=t.providerHelp||"",e.providerHelp.hidden=!e.providerHelp.textContent),e.providerSelect&&(e.providerHelp&&e.providerHelp.textContent?e.providerSelect.setAttribute("aria-describedby",e.providerHelp.id):e.providerSelect.removeAttribute("aria-describedby"),e.providerSelect.setAttribute("aria-label",t.providerLabel)),e.cameraLinkLabel&&(e.cameraLinkLabel.textContent=t.cameraLinkLabel),e.cameraLinkHelp){const a=t.cameraLinkHelp||"";e.cameraLinkHelp.textContent=a,a?(e.cameraLinkHelp.hidden=!1,e.cameraLinkHelp.removeAttribute("hidden")):(e.cameraLinkHelp.hidden=!0,e.cameraLinkHelp.setAttribute("hidden",""))}if(e.cameraLinkSelect&&(e.cameraLinkHelp&&e.cameraLinkHelp.textContent?e.cameraLinkSelect.setAttribute("aria-describedby",e.cameraLinkHelp.id):e.cameraLinkSelect.removeAttribute("aria-describedby"),e.cameraLinkSelect.setAttribute("aria-label",t.cameraLinkLabel)),e.deviceHeading&&(e.deviceHeading.textContent=t.deviceHeading),e.deviceButton&&(e.deviceButton.textContent=t.deviceEditButton,e.deviceButton.setAttribute("aria-label",t.deviceEditButton),e.deviceButton.disabled=!0,e.deviceButton.setAttribute("aria-disabled","true")),e.deviceEmpty&&(e.deviceEmpty.textContent=t.deviceEmpty),e.ownedLabel){const a=e.ownedLabel.querySelector("span");a&&(a.textContent=t.ownedLabel)}if(e.ownedHelp){const a=t.ownedHelp||"";e.ownedHelp.textContent=a,e.ownedHelp.hidden=!a}e.ownedCheckbox&&(e.ownedCheckbox.setAttribute("aria-label",t.ownedLabel),e.ownedHelp&&e.ownedHelp.textContent&&!e.ownedHelp.hidden?e.ownedCheckbox.setAttribute("aria-describedby",e.ownedHelp.id):e.ownedCheckbox.removeAttribute("aria-describedby"));const o=getGearListRentalToggleTexts(),r=o.excludeLabel||t.rentalLabel,n=t.rentalNote||o.noteLabel||"";if(e.rentalLabel&&(e.rentalLabel.textContent=r),e.rentalCheckbox&&e.rentalCheckbox.setAttribute("aria-label",t.rentalLabel),e.resetButton){const a=t.resetLabel;if(e.resetButton.setAttribute("aria-label",a),e.resetButton.title=a,typeof setButtonLabelWithIconForSetups=="function"&&typeof ICON_GLYPHS=="object"&&ICON_GLYPHS){const s=ICON_GLYPHS.reload||ICON_GLYPHS.save;setButtonLabelWithIconForSetups(e.resetButton,a,s)}else e.resetButton.textContent=a}if(e.rentalDescription&&(e.rentalDescription.textContent=n,e.rentalDescription.hidden=!n),e.rentalCheckbox&&(e.rentalDescription&&e.rentalDescription.textContent?e.rentalCheckbox.setAttribute("aria-describedby",e.rentalDescription.id):e.rentalCheckbox.removeAttribute("aria-describedby")),e.cancelButton){const a=t.cancelLabel;e.cancelButton.setAttribute("aria-label",a),typeof setButtonLabelWithIconForSetups=="function"&&typeof ICON_GLYPHS=="object"&&ICON_GLYPHS?setButtonLabelWithIconForSetups(e.cancelButton,a,ICON_GLYPHS.circleX||ICON_GLYPHS.minus):e.cancelButton.textContent=a}if(e.saveButton){const a=t.saveLabel;typeof setButtonLabelWithIconForSetups=="function"&&typeof ICON_GLYPHS=="object"&&ICON_GLYPHS?setButtonLabelWithIconForSetups(e.saveButton,a,ICON_GLYPHS.save):e.saveButton.textContent=a}}function computeGearItemEditPreviewText(e){if(!e)return"";const t=e.quantityInput?e.quantityInput.value.trim():"",o=e.nameInput?e.nameInput.value.trim():"",r=e.attributesInput?e.attributesInput.value.trim():typeof e.currentAttributes=="string"?e.currentAttributes.trim():"",n=[];t&&n.push(`${t}x`),o&&n.push(o);let a=n.join(" ").trim();return r&&(a=a?`${a} (${r})`:`(${r})`),a.trim()}function updateGearItemEditPreview(e){if(!e)return"";const t=computeGearItemEditPreviewText(e);return e.preview&&(e.preview.textContent=t,e.preview.hidden=!t),t}function isPlainObjectValue(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function cssEscapeValue(e){return typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(e):String(e??"").replace(/\r?\n/g,"").replace(/[^a-zA-Z0-9_-]/g,t=>`\\${t}`)}function formatDeviceCategoryLabel(e){return typeof e!="string"||!e.trim()?"":e.replace(/[_-]+/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").split(/\s+/).filter(Boolean).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function formatDeviceCategoryPathForEdit(e){return!Array.isArray(e)||!e.length?"":e.map(formatDeviceCategoryLabel).filter(Boolean).join(" › ")}function findDeviceRecordByName(e){const t=typeof e=="string"?e.trim():"";if(!t||!devices||typeof devices!="object")return null;const o=new Set,r=(u,d)=>{if(!isPlainObjectValue(u)||o.has(u))return null;if(o.add(u),Object.prototype.hasOwnProperty.call(u,t)&&isPlainObjectValue(u[t]))return{info:u[t],categoryPath:d.slice()};for(const[m,y]of Object.entries(u)){if(!isPlainObjectValue(y))continue;const h=r(y,d.concat(m));if(h)return h}return null},n=r(devices,[]);if(!n)return null;const a=Array.isArray(n.categoryPath)?n.categoryPath.slice():[];let s="",l="";return a.length>=2&&a[0]==="accessories"?(s=`accessories.${a[1]}`,a[1]==="cables"&&a.length>=3&&(l=a[2])):a.length>=2&&a[0]==="fiz"?s=`fiz.${a[1]}`:a.length>=2?s=`${a[0]}.${a[1]}`:a.length===1&&(s=a[0]),{info:n.info,categoryPath:a,categoryKey:s,subcategory:l}}function generateGearItemDeviceSummary(e){if(!e||typeof e!="object")return"";const t=typeof generateSafeConnectorSummary=="function"?generateSafeConnectorSummary:typeof generateConnectorSummary$1=="function"?generateConnectorSummary$1:null;if(!t)return"";try{const o=t(e);return typeof o=="string"?o:""}catch{return""}}function hideGearItemEditDeviceInfo(e){e&&(e.deviceSummary&&(e.deviceSummary.innerHTML="",e.deviceSummary.hidden=!0,e.deviceSummary.setAttribute("hidden","")),e.deviceCategory&&(e.deviceCategory.textContent="",e.deviceCategory.hidden=!0,e.deviceCategory.setAttribute("hidden","")),e.deviceEmpty&&(e.deviceEmpty.hidden=!0,e.deviceEmpty.setAttribute("hidden","")),e.deviceButton&&(e.deviceButton.disabled=!0,e.deviceButton.setAttribute("aria-disabled","true")),e.deviceSection&&(e.deviceSection.hidden=!0,e.deviceSection.setAttribute("hidden","")),e.deviceEditData=null)}function updateGearItemEditDeviceInfo(e,t={}){if(!e||!e.deviceSection)return;const o=getGearItemEditTexts(),r=typeof t.name=="string"?t.name:null,n=typeof t.fallbackName=="string"?t.fallbackName:"",a=r&&r.trim()?r.trim():n.trim();if(!a){hideGearItemEditDeviceInfo(e);return}const s=findDeviceRecordByName(a);if(!s||!s.info){hideGearItemEditDeviceInfo(e);return}const l=generateGearItemDeviceSummary(s.info);if(e.deviceSummary&&(e.deviceSummary.innerHTML=l||"",l?(e.deviceSummary.hidden=!1,e.deviceSummary.removeAttribute("hidden")):(e.deviceSummary.hidden=!0,e.deviceSummary.setAttribute("hidden",""))),e.deviceCategory){const u=formatDeviceCategoryPathForEdit(s.categoryPath||[]);if(u){const d=o.deviceCategoryLabel,m=d.includes("%s")?d.replace("%s",u):`${d} ${u}`.trim();e.deviceCategory.textContent=m,e.deviceCategory.hidden=!1,e.deviceCategory.removeAttribute("hidden")}else e.deviceCategory.textContent="",e.deviceCategory.hidden=!0,e.deviceCategory.setAttribute("hidden","")}if(e.deviceEmpty){const u=o.deviceEmpty;l?(e.deviceEmpty.textContent=u,e.deviceEmpty.hidden=!0,e.deviceEmpty.setAttribute("hidden","")):(e.deviceEmpty.textContent=u,e.deviceEmpty.hidden=!1,e.deviceEmpty.removeAttribute("hidden"))}e.deviceButton&&(e.deviceButton.disabled=!1,e.deviceButton.setAttribute("aria-disabled","false")),e.deviceSection&&(e.deviceSection.hidden=!1,e.deviceSection.removeAttribute("hidden")),e.deviceEditData={name:a,categoryKey:s.categoryKey,subcategory:s.subcategory||""}}function openDeviceManagerForDevice(e){if(!e||!e.name||!e.categoryKey)return;try{typeof showDeviceManagerSection=="function"?showDeviceManagerSection():typeof toggleDeviceManagerSection=="function"&&toggleDeviceManagerSection()}catch{}try{typeof refreshDeviceLists=="function"&&refreshDeviceLists()}catch{}const t=4;let o=0;const r=()=>{o+=1;let n=`#device-manager .edit-btn[data-category="${cssEscapeValue(e.categoryKey)}"][data-name="${cssEscapeValue(e.name)}"]`;e.subcategory?n+=`[data-subcategory="${cssEscapeValue(e.subcategory)}"]`:n+=":not([data-subcategory])";let a=null;try{a=document.querySelector(n)}catch{a=null}if(a){try{a.scrollIntoView&&a.scrollIntoView({block:"center",behavior:"smooth"}),a.focus({preventScroll:!0})}catch{}try{a.click()}catch{}return}o<t?setTimeout(r,120*o):typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Could not locate device edit button for gear item",e)};setTimeout(r,60)}function handleGearItemEditDeviceButtonClick(e){e&&e.preventDefault();const t=getGearItemEditContext();if(!(!t||!t.deviceEditData)){if(t.dialog)try{typeof t.dialog.close=="function"?t.dialog.close("device-edit"):t.dialog.removeAttribute("open")}catch{}openDeviceManagerForDevice(t.deviceEditData)}}function updateGearItemEditExtraControls(e,t){if(!e)return;const o=!!t;e.extraPeriodContainer&&(o?(e.extraPeriodContainer.hidden=!1,e.extraPeriodContainer.removeAttribute("hidden")):(e.extraPeriodContainer.hidden=!0,e.extraPeriodContainer.setAttribute("hidden",""))),e.extraStartInput&&(e.extraStartInput.disabled=!o,o?e.extraStartInput.removeAttribute("aria-disabled"):e.extraStartInput.setAttribute("aria-disabled","true")),e.extraEndInput&&(e.extraEndInput.disabled=!o,o?e.extraEndInput.removeAttribute("aria-disabled"):e.extraEndInput.setAttribute("aria-disabled","true"))}function updateGearItemEditResetState(e){if(!e||!e.resetButton)return;const t=e.resetDefaults||{name:"",attributes:""},o=activeGearItemEditTarget&&activeGearItemEditTarget.element,r=!!(o&&o.hasAttribute("data-gear-original-name")),n=typeof t.name=="string"?t.name.trim():"",a=typeof t.attributes=="string"?t.attributes.trim():"",s=e.nameInput?e.nameInput.value.trim():"",l=e.attributesInput?e.attributesInput.value.trim():typeof e.currentAttributes=="string"?e.currentAttributes.trim():"",m=!(r||!!(n||a||l))||s===n&&l===a;e.resetButton.disabled=m,e.resetButton.setAttribute("aria-disabled",m?"true":"false")}function updateGearItemEditRentalControls(e,t,o){if(!e)return;const r=!!t,n=!!o;e.rentalCheckbox&&(e.rentalCheckbox.checked=r,e.rentalCheckbox.disabled=!n,n?e.rentalCheckbox.removeAttribute("aria-disabled"):e.rentalCheckbox.setAttribute("aria-disabled","true")),e.rentalSection&&(e.rentalSection.hidden=!n),e.rentalDescription&&(e.rentalDescription.hidden=!e.rentalDescription.textContent)}function handleGearItemEditFieldInput(){const e=getGearItemEditContext();if(!e)return;e.extraCheckbox&&updateGearItemEditExtraControls(e,e.extraCheckbox.checked);const t=updateGearItemEditPreview(e),o=getGearItemEditTexts();if(e.title&&(e.title.textContent=t?`${o.dialogTitle} — ${t}`:o.dialogTitle),e.ownedCheckbox){const a=!!(e.nameInput&&e.nameInput.value.trim());e.ownedCheckbox.disabled=!a,e.ownedCheckbox.disabled?(e.ownedCheckbox.setAttribute("aria-disabled","true"),e.ownedCheckbox.checked=!1):e.ownedCheckbox.removeAttribute("aria-disabled")}updateGearItemEditResetState(e);const r=e.resetDefaults&&typeof e.resetDefaults.name=="string"?e.resetDefaults.name:"",n=e.nameInput?e.nameInput.value:"";updateGearItemEditDeviceInfo(e,{name:n,fallbackName:r})}function handleGearItemEditRentalCheckboxChange(){const e=getGearItemEditContext();if(!e)return;const t=e.rentalCheckbox?!e.rentalCheckbox.disabled:!0,o=e.rentalCheckbox?e.rentalCheckbox.checked:!1;updateGearItemEditRentalControls(e,o,t)}function handleGearItemEditOwnedChange(){const e=getGearItemEditContext();if(!e||!e.ownedCheckbox)return;if(!!!(e.nameInput&&e.nameInput.value.trim())){e.ownedCheckbox.checked=!1,e.ownedCheckbox.disabled=!0,e.ownedCheckbox.setAttribute("aria-disabled","true");return}e.ownedCheckbox.disabled=!1,e.ownedCheckbox.removeAttribute("aria-disabled"),e.providerSelect&&(e.ownedCheckbox.checked?(!e.providerSelect.value||e.providerSelect.value==="rental-house")&&(e.providerSelect.value="user"):e.providerSelect.value==="user"&&(e.providerSelect.value="rental-house"))}function handleGearItemEditExtraChange(){const e=getGearItemEditContext();!e||!e.extraCheckbox||(updateGearItemEditExtraControls(e,e.extraCheckbox.checked),handleGearItemEditFieldInput())}function handleGearItemEditResetClick(e){e&&e.preventDefault();const t=getGearItemEditContext();if(!t||!t.resetButton||t.resetButton.disabled)return;const o=t.resetDefaults||{name:"",attributes:""};if(t.nameInput&&(t.nameInput.value=o.name||""),t.attributesInput?t.attributesInput.value=o.attributes||"":t.currentAttributes=typeof o.attributes=="string"?o.attributes:"",handleGearItemEditFieldInput(),t.nameInput&&typeof t.nameInput.focus=="function")try{t.nameInput.focus({preventScroll:!0})}catch{}}function handleGearItemEditDialogBackdropPointerDown(e){if(!e)return;const t=getGearItemEditContext();!t||!t.dialog||e.target===t.dialog&&(e.preventDefault(),e.stopPropagation(),handleGearItemEditFormSubmit(e))}let gearItemEditDialogBound=!1,activeGearItemEditTarget=null;function handleGearItemEditFormSubmit(e){e.preventDefault();const t=getGearItemEditContext();if(!t||!t.dialog)return;const o=activeGearItemEditTarget&&activeGearItemEditTarget.element,r=activeGearItemEditTarget&&activeGearItemEditTarget.options,n=!r||r.allowRentalToggle!==!1;if(!o||!o.isConnected){t.dialog.close("cancel"),activeGearItemEditTarget=null;return}const a={quantity:t.quantityInput?t.quantityInput.value:"",name:t.nameInput?t.nameInput.value:"",attributes:t.attributesInput?t.attributesInput.value:typeof t.currentAttributes=="string"?t.currentAttributes:"",note:t.noteInput?t.noteInput.value:"",rentalExcluded:n&&t.rentalCheckbox?t.rentalCheckbox.checked:o.getAttribute("data-rental-excluded")==="true",providedBy:t.providerSelect?t.providerSelect.value:"",providerLabel:t.providerSelect&&t.providerSelect.selectedOptions&&t.providerSelect.selectedOptions.length?getProviderOptionLabel(t.providerSelect.selectedOptions[0]):"",extra:t.extraCheckbox?t.extraCheckbox.checked:o.getAttribute("data-gear-extra")==="true",extraStart:t.extraStartInput?t.extraStartInput.value:o.getAttribute("data-gear-extra-start")||"",extraEnd:t.extraEndInput?t.extraEndInput.value:o.getAttribute("data-gear-extra-end")||"",cameraLink:"",cameraLinkLabel:""};if(a.extra){const v=sanitizeExtraPeriod(a.extraStart,a.extraEnd);a.extraStart=v.start,a.extraEnd=v.end}else a.extraStart="",a.extraEnd="";const s=!!(a.name&&a.name.trim()),l=!!(t.ownedCheckbox&&t.ownedCheckbox.checked&&s);if(l&&(!a.providedBy||a.providedBy==="rental-house"))if(t.providerSelect){t.providerSelect.value="user";const v=t.providerSelect.selectedOptions&&t.providerSelect.selectedOptions[0];a.providedBy=t.providerSelect.value,a.providerLabel=v?getProviderOptionLabel(v):a.providerLabel}else a.providedBy="user";const u=!!t.isCameraItem;let d="",m="";if(t.cameraLinkSelect){d=t.cameraLinkSelect.value||"";const v=t.cameraLinkSelect.selectedOptions&&t.cameraLinkSelect.selectedOptions[0];if(v&&(m=v.getAttribute("data-camera-label")||(v.dataset?v.dataset.cameraLabel:"")||"",!m)){const C=v.textContent||"";C&&(m=C.replace(/\s*\([^)]*\)\s*$/,"").trim())}}const y=normalizeCameraLetter(u&&!d?"A":d);!!y?(a.cameraLink=y,a.cameraLinkLabel=m||a.name&&a.name.trim()||getActiveCameraDisplayName()||""):(a.cameraLink="",a.cameraLinkLabel=""),t.currentCameraLinkValue=a.cameraLink,applyGearItemData(o,a),markProjectFormDataDirty$1();const b=l||t.currentOwnedEntryId?syncGearItemOwnedState(o,a,{wantsOwned:l,existingId:t.currentOwnedEntryId||o.getAttribute("data-gear-own-gear-id")||""}):{id:"",changed:!1};b&&Object.prototype.hasOwnProperty.call(b,"id")&&(b.id?o.setAttribute("data-gear-own-gear-id",b.id):o.removeAttribute("data-gear-own-gear-id"),t.currentOwnedEntryId=b.id||"",b.changed&&(ownGearNameCache=null)),t.currentAttributes=typeof a.attributes=="string"?a.attributes:"",o.classList&&o.classList.contains("gear-custom-item")?persistCustomItemsChange():(typeof saveCurrentGearList$1=="function"&&saveCurrentGearList$1(),typeof saveCurrentSession=="function"&&saveCurrentSession(),typeof checkSetupChanged=="function"&&checkSetupChanged()),t.dialog.close("save")}function handleGearItemEditDialogCancel(e){e&&e.preventDefault();const t=getGearItemEditContext();t&&t.dialog&&t.dialog.close("cancel")}function handleGearItemEditDialogClose(){const e=getGearItemEditContext(),t=activeGearItemEditTarget&&activeGearItemEditTarget.element;if(e&&e.dialog&&e.dialog.returnValue,e&&hideGearItemEditDeviceInfo(e),e&&e.form)try{e.form.reset()}catch{}if(e&&e.nameInput&&e.nameInput.removeAttribute("list"),e&&e.preview&&(e.preview.textContent="",e.preview.hidden=!0),e&&(e.resetDefaults=null,e.currentAttributes="",e.currentOwnedEntryId="",e.currentCameraLinkValue="",e.isCameraItem=!1,e.resetButton&&(e.resetButton.disabled=!1,e.resetButton.setAttribute("aria-disabled","false")),e.ownedCheckbox&&(e.ownedCheckbox.checked=!1,e.ownedCheckbox.disabled=!1,e.ownedCheckbox.removeAttribute("aria-disabled"),e.ownedCheckbox.removeAttribute("aria-describedby")),e.cameraLinkSelect&&(e.cameraLinkSelect.disabled=!1,e.cameraLinkSelect.value="",e.cameraLinkSelect.removeAttribute("aria-disabled"))),activeGearItemEditTarget=null,t&&t.isConnected){const o=t.querySelector("[data-gear-edit]");if(o&&typeof o.focus=="function")try{o.focus({preventScroll:!0})}catch{}}}function refreshGearItemEditProviderOptionsIfOpen(){const e=getGearItemEditContext();if(!e||!e.dialog||!e.providerSelect||!(typeof e.dialog.open=="boolean"?e.dialog.open:!e.dialog.hasAttribute("hidden")))return;const o=activeGearItemEditTarget&&activeGearItemEditTarget.element,r=o?getGearItemData(o):{};updateGearItemEditProviderOptions(e,r)}function refreshGearItemEditCameraLinkOptionsIfOpen(){const e=getGearItemEditContext();if(!e||!e.dialog||!e.cameraLinkSelect||!(typeof e.dialog.open=="boolean"?e.dialog.open:!e.dialog.hasAttribute("hidden")))return;const o=activeGearItemEditTarget&&activeGearItemEditTarget.element,r=o?getGearItemData(o):{};updateGearItemEditCameraLinkOptions(e,r);const n=!!(e.isCameraItem||o&&isPrimaryCameraItem(o));if(e.cameraLinkLabel||e.cameraLinkHelp){const s=getGearItemEditTexts();if(e.cameraLinkLabel){const l=n?s.cameraAssignmentLabel:s.cameraLinkLabel;e.cameraLinkLabel.textContent=l;const u=n?s.cameraAssignmentHelp:s.cameraLinkHelp;u?e.cameraLinkLabel.setAttribute("data-help",u):e.cameraLinkLabel.removeAttribute("data-help")}if(e.cameraLinkHelp){const l=n?s.cameraAssignmentHelp:s.cameraLinkHelp;e.cameraLinkHelp.textContent=l||"",l?(e.cameraLinkHelp.hidden=!1,e.cameraLinkHelp.removeAttribute("hidden")):(e.cameraLinkHelp.hidden=!0,e.cameraLinkHelp.setAttribute("hidden",""))}}const a=n?normalizeCameraLetter(r.cameraLink)||"A":normalizeCameraLetter(r.cameraLink);e.cameraLinkSelect.value=a||"",e.cameraLinkSelect.disabled=!1,e.cameraLinkSelect.removeAttribute("aria-disabled")}function refreshGearItemOwnedStateIfOpen(){const e=getGearItemEditContext();if(!e||!e.dialog||!e.ownedCheckbox||!(typeof e.dialog.open=="boolean"?e.dialog.open:!e.dialog.hasAttribute("hidden")))return;const o=activeGearItemEditTarget&&activeGearItemEditTarget.element;if(!o||!o.isConnected)return;const r=e.nameInput?e.nameInput.value.trim():"",n=getGearItemData(o),a=r||n.name||"",s=e.currentOwnedEntryId||o.getAttribute("data-gear-own-gear-id")||"",l=loadOwnGearRecordsForEditor(),{record:u}=lookupOwnGearRecord(l,s,a),d=!!a;e.ownedCheckbox.disabled=!d,e.ownedCheckbox.disabled?(e.ownedCheckbox.setAttribute("aria-disabled","true"),e.ownedCheckbox.checked=!1):(e.ownedCheckbox.removeAttribute("aria-disabled"),e.ownedCheckbox.checked=!!u),u?(e.currentOwnedEntryId=u.id,o.setAttribute("data-gear-own-gear-id",u.id)):(e.currentOwnedEntryId="",o.removeAttribute("data-gear-own-gear-id"))}function bindGearItemEditDialog(e){if(gearItemEditDialogBound||!e||!e.dialog)return;applyGearItemEditDialogTexts(e),e.form&&e.form.addEventListener("submit",handleGearItemEditFormSubmit),e.cancelButton&&e.cancelButton.addEventListener("click",handleGearItemEditDialogCancel),e.resetButton&&e.resetButton.addEventListener("click",handleGearItemEditResetClick),e.dialog.addEventListener("cancel",handleGearItemEditDialogCancel),e.dialog.addEventListener("close",handleGearItemEditDialogClose),"onpointerdown"in e.dialog?e.dialog.addEventListener("pointerdown",handleGearItemEditDialogBackdropPointerDown):(e.dialog.addEventListener("mousedown",handleGearItemEditDialogBackdropPointerDown),e.dialog.addEventListener("touchstart",handleGearItemEditDialogBackdropPointerDown)),[e.quantityInput,e.nameInput,e.attributesInput].forEach(o=>{o&&(o.addEventListener("input",handleGearItemEditFieldInput),o.addEventListener("change",handleGearItemEditFieldInput))}),e.rentalCheckbox&&e.rentalCheckbox.addEventListener("change",handleGearItemEditRentalCheckboxChange),e.ownedCheckbox&&e.ownedCheckbox.addEventListener("change",handleGearItemEditOwnedChange),e.extraCheckbox&&e.extraCheckbox.addEventListener("change",handleGearItemEditExtraChange),[e.extraStartInput,e.extraEndInput].forEach(o=>{o&&(o.addEventListener("input",handleGearItemEditFieldInput),o.addEventListener("change",handleGearItemEditFieldInput))}),e.cameraLinkSelect&&e.cameraLinkSelect.addEventListener("change",handleGearItemEditFieldInput),e.deviceButton&&e.deviceButton.addEventListener("click",handleGearItemEditDeviceButtonClick),gearItemEditDialogBound=!0}function openGearItemEditor(e,t={}){if(!e)return!1;const o=getGearItemEditContext();if(!o||!o.dialog)return!1;if(bindGearItemEditDialog(o),enhanceGearItemElement$1(e),e.classList&&e.classList.contains("gear-custom-item")){const w=e.closest(".gear-custom-items[data-gear-custom-list]");if(w){const R=w.getAttribute("data-gear-custom-list")||"",_=w.getAttribute("data-gear-custom-category")||"";attachCustomItemSuggestions(e,R,_)}}const r=getGearItemData(e),n=(()=>{const w=r&&Object.prototype.hasOwnProperty.call(r,"id")?r.id:"",R=typeof w=="string"?w:w==null?"":String(w),_=r&&Object.prototype.hasOwnProperty.call(r,"name")?r.name:"",G=typeof _=="string"?_.slice(0,120):"",O=e&&e.dataset?e.dataset:{},B=typeof O.category=="string"?O.category:"",$=!!(e&&e.classList&&e.classList.contains("gear-custom-item")),V={allowRentalToggle:t&&Object.prototype.hasOwnProperty.call(t,"allowRentalToggle")?!!t.allowRentalToggle:void 0,focusField:t&&typeof t.focusField=="string"?t.focusField.slice(0,60):void 0};return{id:R,name:G,category:B,custom:$,options:V}})();activeGearItemEditTarget={element:e,options:t||{}},o.resetDefaults=getGearItemResetDefaults(e),o.currentAttributes=typeof r.attributes=="string"?r.attributes:String(r.attributes??""),o.resetButton&&(o.resetButton.disabled=!1,o.resetButton.setAttribute("aria-disabled","false")),applyGearItemEditDialogTexts(o);const a=e.getAttribute("data-gear-own-gear-id")||"",s=findOwnedRecordForGearItem(e,{name:r.name||"",existingId:a||o.currentOwnedEntryId||""});o.currentOwnedEntryId=s?s.id:"";const l=!!(r.name&&r.name.trim());o.ownedCheckbox&&(o.ownedCheckbox.checked=!!s&&l,o.ownedCheckbox.disabled=!l,o.ownedCheckbox.disabled?o.ownedCheckbox.setAttribute("aria-disabled","true"):o.ownedCheckbox.removeAttribute("aria-disabled")),o.ownedContainer&&(o.ownedContainer.hidden=!1),s&&e?e.setAttribute("data-gear-own-gear-id",s.id):a&&e.removeAttribute("data-gear-own-gear-id");const u=!(t&&t.allowRentalToggle===!1);if(o.quantityInput&&(o.quantityInput.value=r.quantity||""),o.nameInput){o.nameInput.value=r.name||"";const w=e.getAttribute("data-gear-suggestions")||"";w?o.nameInput.setAttribute("list",w):o.nameInput.removeAttribute("list")}if(o.attributesInput&&(o.attributesInput.value=r.attributes||""),o.noteInput&&(o.noteInput.value=r.note||""),o.extraCheckbox){const w=!!r.extra;o.extraCheckbox.checked=w,updateGearItemEditExtraControls(o,w)}o.extraStartInput&&(o.extraStartInput.value=r.extraStart||""),o.extraEndInput&&(o.extraEndInput.value=r.extraEnd||""),o.extraPeriodContainer&&!o.extraCheckbox&&(o.extraPeriodContainer.hidden=!0,o.extraPeriodContainer.setAttribute("hidden","")),o.providerSelect&&updateGearItemEditProviderOptions(o,r);const d=normalizeCameraLetter(r.cameraLink),m=isPrimaryCameraItem(e);o.isCameraItem=m,o.cameraLinkContainer&&(o.cameraLinkContainer.hidden=!1,o.cameraLinkContainer.removeAttribute("hidden"));const y=getGearItemEditTexts();if(o.cameraLinkLabel){const w=m?y.cameraAssignmentLabel:y.cameraLinkLabel;o.cameraLinkLabel.textContent=w;const R=m?y.cameraAssignmentHelp:y.cameraLinkHelp;R?o.cameraLinkLabel.setAttribute("data-help",R):o.cameraLinkLabel.removeAttribute("data-help")}if(o.cameraLinkHelp){const w=m?y.cameraAssignmentHelp:y.cameraLinkHelp;o.cameraLinkHelp.textContent=w||"",w?(o.cameraLinkHelp.hidden=!1,o.cameraLinkHelp.removeAttribute("hidden")):(o.cameraLinkHelp.hidden=!0,o.cameraLinkHelp.setAttribute("hidden",""))}if(o.cameraLinkSelect){updateGearItemEditCameraLinkOptions(o,r);const w=m?d||"A":d||"";o.cameraLinkSelect.value=w,o.cameraLinkSelect.disabled=!1,o.cameraLinkSelect.removeAttribute("aria-disabled")}o.currentCameraLinkValue=d||(m?"A":""),updateGearItemEditRentalControls(o,!!r.rentalExcluded,u);const h=(()=>{const w=e.querySelector(".gear-item-text");return w&&w.textContent?w.textContent.trim():r.name||""})(),v=updateGearItemEditPreview(o)||h;o.preview&&v&&(o.preview.textContent=v,o.preview.hidden=!1),o.title&&(o.title.textContent=v?`${y.dialogTitle} — ${v}`:y.dialogTitle),updateGearItemEditResetState(o);const C=typeof r.name=="string"?r.name:"",A=o.nameInput?o.nameInput.value:C;updateGearItemEditDeviceInfo(o,{name:A,fallbackName:C});try{typeof o.dialog.showModal=="function"?o.dialog.showModal():o.dialog.hidden=!1}catch(w){return console.warn("Failed to open gear item edit dialog",w,n),activeGearItemEditTarget=null,!1}if(t.focusField==="name"&&o.nameInput)try{o.nameInput.focus({preventScroll:!0})}catch{}else if(o.quantityInput)try{o.quantityInput.focus({preventScroll:!0})}catch{}return!0}function buildCustomItemEntryElement(e,t,o){const r=gearListOutput&&gearListOutput.ownerDocument||(typeof document<"u"?document:null);if(!r)return null;const n=r.createElement("template"),a=o&&Object.prototype.hasOwnProperty.call(o,"quantity")?o.quantity:"1",s=o&&Object.prototype.hasOwnProperty.call(o,"name")?o.name:"",l=o&&Object.prototype.hasOwnProperty.call(o,"attributes")?o.attributes:"",u=o&&Object.prototype.hasOwnProperty.call(o,"note")?o.note:"",d=o&&Object.prototype.hasOwnProperty.call(o,"extra")?o.extra:!1,m=o&&Object.prototype.hasOwnProperty.call(o,"extraStart")?o.extraStart:"",y=o&&Object.prototype.hasOwnProperty.call(o,"extraEnd")?o.extraEnd:"",h=typeof a=="string"?a:String(a??""),b=typeof s=="string"?s:String(s??""),v=typeof l=="string"?l:String(l??""),C=typeof u=="string"?u:String(u??""),A=d===!0||d==="true"||d===1||d==="1",w=typeof m=="string"?m:String(m??""),R=typeof y=="string"?y:String(y??""),_=resolveGearListCustomText("gearListRemoveCustomItem","Remove"),G=resolveGearListCustomText("gearListRemoveCustomItemFromCategory","Remove custom item from {category}",{category:t}),O=resolveGearListCustomText("gearListEditCustomItem","Edit custom item"),B=typeof ICON_GLYPHS=="object"&&ICON_GLYPHS,$=B&&(ICON_GLYPHS.sliders||ICON_GLYPHS.gears||ICON_GLYPHS.gearList||ICON_GLYPHS.settingsGeneral||ICON_GLYPHS.note)||null,V=typeof iconMarkup=="function"&&B?iconMarkup(ICON_GLYPHS.minus,{className:"btn-icon"}):"",M=typeof iconMarkup=="function"&&$?iconMarkup($,{className:"btn-icon"}):"",F=getGearListRentalToggleTexts(),z=F.noteLabel&&F.noteLabel.trim()?F.noteLabel:"";n.innerHTML=`
    <div class="gear-custom-item" data-gear-custom-entry="${escapeHtml$2(e)}">
      <div class="gear-custom-item-summary">
        <span class="gear-custom-item-preview" aria-hidden="true"></span>
        <span class="gear-item-note" hidden></span>
      </div>
      <div class="gear-custom-item-actions">
        <button
          type="button"
          class="gear-item-edit-btn"
          data-gear-edit
          aria-label="${escapeHtml$2(O)}"
        >
          ${M||`<span class="gear-item-edit-fallback">${escapeHtml$2(O)}</span>`}
        </button>
        <button
          type="button"
          class="gear-custom-remove-btn"
          data-gear-custom-remove="${escapeHtml$2(e)}"
          data-gear-custom-category="${escapeHtml$2(t)}"
          aria-label="${escapeHtml$2(G)}"
        >
          ${V}<span>${escapeHtml$2(_)}</span>
        </button>
      </div>
    </div>
  `.trim();const x=n.content.firstElementChild;return x?(z&&x.setAttribute("data-rental-note",z),x.setAttribute("data-gear-quantity",h),x.setAttribute("data-gear-label",b),v?x.setAttribute("data-gear-attributes",v):x.removeAttribute("data-gear-attributes"),C?x.setAttribute("data-gear-note",C):x.removeAttribute("data-gear-note"),applyGearItemData(x,{quantity:h,name:b,attributes:v,note:C,rentalExcluded:o&&(o.rentalExcluded===!0||o.rentalExcluded==="true"),providedBy:o&&(o.providedBy||o.provider)?o.providedBy||o.provider:"",providerLabel:o&&o.providerLabel?o.providerLabel:"",extra:A,extraStart:w,extraEnd:R}),x):null}function persistCustomItemsChange(){markProjectFormDataDirty$1(),typeof saveCurrentGearList$1=="function"&&saveCurrentGearList$1(),typeof saveCurrentSession=="function"&&saveCurrentSession(),typeof checkSetupChanged=="function"&&checkSetupChanged()}function addCustomItemEntry(e,t,o={},r={}){const n=getCustomItemsContainer(e);if(!n)return null;const a=buildCustomItemEntryElement(e,t,o);if(!a)return null;n.appendChild(a),attachCustomItemSuggestions(a,e,t);const s=o&&(o.extra===!0||o.extra==="true"||o.extra===1||o.extra==="1"),l=o&&Object.prototype.hasOwnProperty.call(o,"extraStart")?o.extraStart:"",u=o&&Object.prototype.hasOwnProperty.call(o,"extraEnd")?o.extraEnd:"";applyGearItemData(a,{quantity:o&&Object.prototype.hasOwnProperty.call(o,"quantity")?o.quantity:"",name:o&&Object.prototype.hasOwnProperty.call(o,"name")?o.name:"",attributes:o&&Object.prototype.hasOwnProperty.call(o,"attributes")?o.attributes:"",note:o&&Object.prototype.hasOwnProperty.call(o,"note")?o.note:"",rentalExcluded:o&&(o.rentalExcluded===!0||o.rentalExcluded==="true"),providedBy:o&&(o.providedBy||o.provider)?o.providedBy||o.provider:"",providerLabel:o&&o.providerLabel?o.providerLabel:"",extra:s,extraStart:l,extraEnd:u,cameraLink:o&&Object.prototype.hasOwnProperty.call(o,"cameraLink")?o.cameraLink:"",cameraLinkLabel:o&&Object.prototype.hasOwnProperty.call(o,"cameraLinkLabel")?o.cameraLinkLabel:""},{skipPreview:!1});const d=!!(o&&(o.rentalExcluded===!0||o.rentalExcluded==="true"));if(setRentalExclusionState(a,d),!r.skipFocus){const m=a.querySelector("[data-gear-edit]");m&&m.focus()}return!r.skipEditDialog&&typeof requestAnimationFrame=="function"&&requestAnimationFrame(()=>{try{openGearItemEditor(a,{focusField:"name",allowRentalToggle:!0})}catch(m){console.warn("Failed to open gear item editor for new custom item",m)}}),r.skipPersist||persistCustomItemsChange(),a}function addExtraGearItem(e={}){const t=ensureExtraGearCategory();if(!t)return null;const o=getExtraGearUiTexts(),r=t.getAttribute("data-gear-custom-category")||o.categoryLabel;return addCustomItemEntry(EXTRA_GEAR_CATEGORY_KEY,r,{quantity:e&&Object.prototype.hasOwnProperty.call(e,"quantity")?e.quantity:"1",name:e&&Object.prototype.hasOwnProperty.call(e,"name")?e.name:"",attributes:e&&Object.prototype.hasOwnProperty.call(e,"attributes")?e.attributes:"",note:e&&Object.prototype.hasOwnProperty.call(e,"note")?e.note:"",extra:!0,extraStart:e&&Object.prototype.hasOwnProperty.call(e,"extraStart")?e.extraStart:"",extraEnd:e&&Object.prototype.hasOwnProperty.call(e,"extraEnd")?e.extraEnd:""},{skipFocus:!!(e&&e.skipFocus),skipPersist:!!(e&&e.skipPersist),skipEditDialog:!!(e&&e.skipEditDialog)})}function handleAddCustomItemRequest(e){if(!e)return;const t=e.getAttribute("data-gear-custom-add")||"";if(!t)return;const o=e.getAttribute("data-gear-custom-category")||"";if(e.hasAttribute("data-extra-gear")||t===EXTRA_GEAR_CATEGORY_KEY){addExtraGearItem({skipFocus:!1,skipPersist:!1,skipEditDialog:!1});return}addCustomItemEntry(t,o,{quantity:"1",name:""})}function handleRemoveCustomItemRequest(e){if(!e)return;const t=e.closest(".gear-custom-item");if(!t)return;const o=e.getAttribute("data-gear-custom-remove")||t.getAttribute("data-gear-custom-entry")||"";if(t.remove(),persistCustomItemsChange(),o){const r=gearListOutput?.querySelector(`[data-gear-custom-add="${o}"]`);r&&r.focus()}}function readCustomItemsState(){if(!gearListOutput)return{};const e={};return gearListOutput.querySelectorAll(".gear-custom-items[data-gear-custom-list]").forEach(o=>{const r=o.getAttribute("data-gear-custom-list");if(!r)return;const n=[];o.querySelectorAll(".gear-custom-item").forEach(a=>{const s=String(a.getAttribute("data-gear-quantity")||""),l=String(a.getAttribute("data-gear-label")||a.getAttribute("data-gear-name")||""),u=String(a.getAttribute("data-gear-attributes")||""),d=String(a.getAttribute("data-gear-note")||""),m=a.getAttribute("data-rental-excluded")==="true",y=String(a.getAttribute("data-gear-provider")||""),h=String(a.getAttribute("data-gear-provider-label")||""),b=a.getAttribute("data-gear-extra")==="true",v=String(a.getAttribute("data-gear-extra-start")||""),C=String(a.getAttribute("data-gear-extra-end")||""),A=String(a.getAttribute("data-gear-camera-link")||""),w=String(a.getAttribute("data-gear-camera-link-label")||"");n.push({quantity:s,name:l,attributes:u,note:d,rentalExcluded:m,providedBy:y,providerLabel:h,extra:b,extraStart:v,extraEnd:C,cameraLink:A,cameraLinkLabel:w})}),n.length&&(e[r]=n)}),e}function gearListGenerateHtmlImpl(e={}){const t=(Z,he)=>he||(typeof document<"u"?document.getElementById(Z):null),o=t("cameraSelect",typeof cameraSelect<"u"?cameraSelect:null),r=t("monitorSelect",typeof monitorSelect<"u"?monitorSelect:null),n=t("videoSelect",typeof videoSelect<"u"?videoSelect:null),a=t("distanceSelect",typeof distanceSelect<"u"?distanceSelect:null),s=t("cageSelect",typeof cageSelect<"u"?cageSelect:null),l=t("batterySelect",typeof batterySelect<"u"?batterySelect:null),u=Z=>{if(!Z||!Z.options||typeof Z.selectedIndex!="number"||Z.selectedIndex<0)return"";const he=Z.options[Z.selectedIndex];return he?(typeof he.text=="string"?he.text:typeof he.textContent=="string"?he.textContent:"").trim():""},d={camera:o&&typeof o.value<"u"&&o.value&&o.value!=="None"?u(o):"",monitor:r&&typeof r.value<"u"&&r.value&&r.value!=="None"?u(r):"",video:n&&typeof n.value<"u"&&n.value&&n.value!=="None"?u(n):"",motors:(typeof motorSelects<"u"&&Array.isArray(motorSelects)?motorSelects:[]).map(Z=>Z&&typeof Z.value<"u"&&Z.value&&Z.value!=="None"?u(Z):"").filter(Boolean),controllers:(typeof controllerSelects<"u"&&Array.isArray(controllerSelects)?controllerSelects:[]).map(Z=>Z&&typeof Z.value<"u"&&Z.value&&Z.value!=="None"?u(Z):"").filter(Boolean),distance:a&&typeof a.value<"u"&&a.value&&a.value!=="None"?u(a):"",cage:s&&typeof s.value<"u"&&s.value&&s.value!=="None"?u(s):"",battery:l&&typeof l.value<"u"&&l.value&&l.value!=="None"?u(l):""},h=getGearItemEditTexts().cameraLinkDefaultLabel.replace("%s","A"),b=typeof d.camera=="string"&&d.camera.trim()||h,v=!!b,C=new Set,A=Z=>{if(!v||typeof Z!="string")return;const he=normalizeGearNameForComparison(Z);he&&C.add(he)},w=Z=>{if(!Z||typeof Z!="string")return;const he=Z.trim();if(!he)return;A(he);const fe=addArriKNumber$1(he);fe&&fe!==he&&A(fe)},R=Z=>{!Z||!v||(Z.cameraLink=!0,b&&!Z.cameraLinkLabel&&(Z.cameraLinkLabel=b))},_=({base:Z,entry:he})=>{if(v)try{const fe=normalizeGearNameForComparison(Z);fe&&C.has(fe)&&R(he)}catch{}},G=Z=>{if(!v)return"";const he=typeof Z=="string"&&Z.trim()?Z.trim():b,fe=['data-gear-camera-link="camera"'];return he&&fe.push(`data-gear-camera-link-label="${escapeHtml$2(he)}"`),fe.join(" ")},O=d.motors.length>0,B=e.videoDistribution?e.videoDistribution.split(",").map(Z=>Z.trim()).filter(Boolean):[],$=B.map(Z=>{const he=Z.match(/^(Director|Gaffer|DoP) Monitor (?:(\d+)" )?handheld$/);return he?{role:he[1],size:he[2]?parseFloat(he[2]):void 0}:null}).filter(Boolean),V=B.map(Z=>{const he=Z.match(/^(Director|Combo|DoP) Monitor 15-21"$/);return he?{role:he[1]}:null}).filter(Boolean);["Arri Alexa Mini","Arri Amira"].includes(d.camera)?d.viewfinder="ARRI K2.75004.0 MVF-1 Viewfinder":d.viewfinder="";const{cameraSupport:M,chargers:F,fizCables:z,misc:x,monitoringSupport:H,rigging:W}=collectAccessories({hasMotor:O,videoDistPrefs:B}),U=devices.accessories?.cages||{},j=[];if(cameraSelect&&cameraSelect.value&&cameraSelect.value!=="None")for(const[Z,he]of Object.entries(U))(!he.compatible||he.compatible.includes(cameraSelect.value))&&j.push(Z);const Y=M.filter(Z=>!j.includes(Z));if(d.viewfinder){const Z=new Set(Y.map(fe=>normalizeGearNameForComparison(fe))),he=normalizeGearNameForComparison(d.viewfinder);Z.has(he)||Y.push(d.viewfinder)}const le=e.requiredScenarios?e.requiredScenarios.split(",").map(Z=>Z.trim()).filter(Boolean):[],be=hasSeededAutoGearDefaults(),re=autoGearRules.length===0&&!be,de=Z=>re&&le.includes(Z),ne=Z=>re&&Z.some(he=>le.includes(he)),Ce=de("Gimbal");if(ne(["Trinity","Steadicam"])){for(let Z=0;Z<2;Z++)W.push("D-Tap Splitter");W.push("D-Tap Extension 50 cm (Steadicam/Trinity)"),W.push("D-Tap Extension 50 cm (Spare)")}const Ee=e.cameraHandle?e.cameraHandle.split(",").map(Z=>Z.trim()).filter(Boolean):[],Pe=e.viewfinderExtension?e.viewfinderExtension.split(",").map(Z=>Z.trim()).filter(Boolean):[],et=[...e.viewfinderSettings?e.viewfinderSettings.split(",").map(Z=>Z.trim()):[],...e.frameGuides?e.frameGuides.split(",").map(Z=>Z.trim()):[],...e.aspectMaskOpacity?e.aspectMaskOpacity.split(",").map(Z=>Z.trim()):[],...e.monitoringSettings?e.monitoringSettings.split(",").map(Z=>Z.trim()):[]].filter(Boolean),Je=normalizeLensSelectionNames(e.lenses),it=Je.reduce((Z,he)=>{const fe=devices.lenses&&devices.lenses[he];return Math.max(Z,fe&&fe.frontDiameterMm||0)},0),rt=parseFilterTokens(e.filter),vt=rt.map(Z=>Z.type).some(Z=>Z==="ND Grad HE"||Z==="ND Grad SE"),bo=buildFilterGearEntries(rt);let Et=collectFilterAccessories(rt);if(bo.length&&Et.length){const Z=new Set(bo.map(he=>normalizeGearNameForComparison(he.gearName)));Et=Et.filter(he=>!Z.has(normalizeGearNameForComparison(he)))}const Ut=buildFilterSelectHtml(rt,bo);if(e.mattebox){const Z=e.mattebox.trim();Z==="Swing Away"?(Et.push("ARRI LMB 4x5 Pro Set"),Et.push("ARRI LMB 19mm Studio Rod Adapter"),Et.push("ARRI LMB 4x5 / LMB-6 Tray Catcher")):Z==="Rod based"?(Et.push("ARRI LMB 4x5 15mm LWS Set 3-Stage"),Et.push("ARRI LMB 19mm Studio Rod Adapter"),Et.push("ARRI LMB 4x5 / LMB-6 Tray Catcher"),Et.push("ARRI LMB 4x5 Side Flags"),Et.push("ARRI LMB Flag Holders"),Et.push("ARRI LMB 4x5 Set of Mattes spherical"),Et.push("ARRI LMB Accessory Adapter"),Et.push("ARRI Anti-Reflection Frame 4x5.65")):Z==="Clamp On"&&(Et.push("ARRI LMB 4x5 Clamp-On (3-Stage)"),Et.push("ARRI LMB 4x5 / LMB-6 Tray Catcher"),Et.push("ARRI LMB 4x5 Side Flags"),Et.push("ARRI LMB Flag Holders"),Et.push("ARRI LMB 4x5 Set of Mattes spherical"),Et.push("ARRI LMB Accessory Adapter"),Et.push("ARRI Anti-Reflection Frame 4x5.65"),Et.push("ARRI LMB 4x5 Clamp Adapter Set Pro"))}e.mattebox&&!vt&&e.mattebox.toLowerCase().includes("clamp")&&[...new Set(Je.map(fe=>devices.lenses&&devices.lenses[fe]&&devices.lenses[fe].frontDiameterMm).filter(Boolean))].forEach(fe=>Et.push(`ARRI LMB 4x5 Clamp Adapter ${fe}mm`)),Pe.forEach(Z=>Y.push(Z)),ne(["Rain Machine","Extreme rain"])&&(Et.push("Schulz Sprayoff Micro"),Et.push("Spare Disc (Schulz Sprayoff Micro)"),W.push("Fischer RS to D-Tap cable 0,5m"),W.push("Fischer RS to D-Tap cable 0,5m"));let ge=[],ue="";if(Ce){const Z=e.gimbal?e.gimbal.split(",").map(fe=>fe.trim()).filter(Boolean):[],he=it>95;if(Z.length)ge=Z.map(fe=>/Ronin RS4 Pro/i.test(fe)&&he?"DJI Ronin 2":fe),ge.length===1&&(ue=ge[0]);else{const fe=devices&&devices.cameras&&devices.cameras[d.camera],xe=fe&&fe.weight_g,$e=xe!=null?xe<2e3:/(FX3|FX6|R5)/i.test(d.camera);ue=he?"DJI Ronin 2":$e?"DJI Ronin RS4 Pro Combo":"DJI Ronin 2",ge=[ue]}/Ronin RS4 Pro/i.test(ue)&&it<=95?(Et.push("Tilta Mirage VND Kit"),Et.push("Tilta 95 mm Polarizer Filter für Tilta Mirage"),Et.push("Vaxis 95 mm IRND Filter 0.3 + 0.6 + 0.9 + 1.2 Filter"),Et.push("Vaxis 95mm Black Mist 1/4 + 1/8 Filter")):Et.push("Arri KK.0038066 Flexible Sunshade Side Flag Holders Set")}const We=[];$.forEach(Z=>We.push(`${Z.role} handheld`)),V.forEach(Z=>We.push(`${Z.role} 15-21"`)),O&&We.push("Focus");const Me=We.length;if(d.video){H.push("Antenna 5,8GHz 5dBi Long (spare)");const Z=d.video.replace(/ TX\b/," RX");if(devices&&devices.wirelessReceivers&&devices.wirelessReceivers[Z]){const he=Me||1;for(let fe=0;fe<he;fe++)H.push("Antenna 5,8GHz 5dBi Long (spare)")}}const Te=Z=>{H.push(`D-Tap to Lemo-2-pin Cable 0,3m (${Z})`,`D-Tap to Lemo-2-pin Cable 0,3m (${Z})`,`Ultraslim BNC Cable 0.3 m (${Z})`,`Ultraslim BNC Cable 0.3 m (${Z})`)};$.forEach(Z=>Te(`${Z.role} handheld`));const Be=Z=>{H.push(`D-Tap to Lemo-2-pin Cable 0,5m (${Z})`,`D-Tap to Lemo-2-pin Cable 0,5m (${Z})`,`Ultraslim BNC Cable 0.5 m (${Z})`,`Ultraslim BNC Cable 0.5 m (${Z})`)};V.forEach(Z=>Be(`${Z.role} 15-21"`));const Ve='SHAPE Telescopic Handle ARRI Rosette Kit 12"',je=()=>{Y.includes(Ve)||Y.push(Ve)};de("Handheld")&&de("Easyrig")&&je(),Ee.includes("Hand Grips")&&je(),Ee.includes("Handle Extension")&&Y.push("ARRI K2.0019797 HEX-3"),Ee.includes("L-Handle")&&Y.push("ARRI KK.0037820 Handle Extension Set");const mt={...e},ct=texts[currentLang]?.projectForm||texts.en?.projectForm||{},$t=texts[currentLang]?.projectFields||texts.en?.projectFields||{},fo=resolveRentalHouseEntry(e&&e.rentalHouse?e.rentalHouse:"");if(fo){const Z=[],he=[],fe=fo.phone?String(fo.phone).trim():"";if(fe){const ze=formatPhoneHref(fe),yt=escapeHtml$2(fe);he.push(fe),ze?Z.push(`<a href="tel:${ze}" class="req-contact-link">${yt}</a>`):Z.push(yt)}const xe=fo.email?String(fo.email).trim():"";if(xe){const ze=formatEmailHref(xe),yt=escapeHtml$2(xe);he.push(xe),ze?Z.push(`<a href="mailto:${ze}" class="req-contact-link">${yt}</a>`):Z.push(yt)}Z.length&&(mt.rentalHouseContact={__html:Z.join("<br>"),text:he.join(`
`)});const $e=fo.address?String(fo.address).trim():"";$e&&(mt.rentalHouseAddress=$e)}let no=applyCombinedProductionCompanyDisplay(mt,e,$t);no||PRODUCTION_COMPANY_FIELD_ORDER.some(he=>{const fe=mt[he];return typeof fe=="string"?fe.trim().length>0:fe!=null})&&(no=applyCombinedProductionCompanyDisplay(mt,mt,$t));const Nt=ct.storageSummaryFallback||ct.storageTypeLabel||"Media",xo=texts[currentLang]?.crewRoles||texts.en?.crewRoles||{};if(Array.isArray(e.people)){const Z=[],he=[];e.people.filter(fe=>fe&&typeof fe.name=="string"&&fe.name.trim()).forEach(fe=>{const xe=xo[fe.role]||fe.role||"",$e=escapeHtml$2(xe),ze=typeof fe.name=="string"?fe.name.trim():fe.name?String(fe.name).trim():"";if(!ze)return;const yt=escapeHtml$2(ze),dt=[],ht=[],uo=typeof fe.phone=="string"?fe.phone.trim():fe.phone?String(fe.phone).trim():"";if(uo){const ar=formatPhoneHref(uo),Jo=escapeHtml$2(uo);ht.push(uo),ar?dt.push(`<a href="tel:${ar}" class="req-contact-link">${Jo}</a>`):dt.push(Jo)}const wt=typeof fe.email=="string"?fe.email.trim():fe.email?String(fe.email).trim():"";if(wt){const ar=formatEmailHref(wt),Jo=escapeHtml$2(wt);ht.push(wt),ar?dt.push(`<a href="mailto:${ar}" class="req-contact-link">${Jo}</a>`):dt.push(Jo)}const Ao=dt.length?` (${dt.join(", ")})`:"",nr=ht.length?` (${ht.join(", ")})`:"",dr=xe?`${$e}: `:"",fr=xe?`${xe}: `:"";Z.push(`<span class="crew-entry">${dr}${yt}${Ao}</span>`),he.push(`${fr}${ze}${nr}`)}),Z.length&&(mt.crew={__html:Z.join("<br>"),text:he.join(`
`)})}if(delete mt.people,Array.isArray(e.storageRequirements)){const Z=[],he=[];e.storageRequirements.forEach(fe=>{if(!fe||typeof fe!="object")return;const xe=Number.isFinite(fe.quantity)&&fe.quantity>0?fe.quantity:null,$e=typeof fe.type=="string"?fe.type.trim():"",ze=typeof fe.variant=="string"?fe.variant.trim():"",yt=typeof fe.notes=="string"?fe.notes.trim():"";if(!xe&&!$e&&!ze&&!yt)return;let dt=ze||$e||"";ze&&$e&&!ze.toLowerCase().includes($e.toLowerCase())?dt=`${ze} (${$e})`:!dt&&$e&&(dt=$e),yt&&(dt=dt?`${dt} – ${yt}`:yt);const ht=dt||Nt,wt=`${xe?`${xe}x `:""}${ht}`.trim();he.push(wt),Z.push(`<span class="storage-entry">${escapeHtml$2(wt)}</span>`)}),Z.length&&(mt.storageRequirements={__html:Z.join("<br>"),text:he.join(`
`)})}if(Array.isArray(e.prepDays)&&(mt.prepDays=e.prepDays.join(`
`)),Array.isArray(e.shootingDays)&&(mt.shootingDays=e.shootingDays.join(`
`)),Array.isArray(e.returnDays)&&(mt.returnDays=e.returnDays.join(`
`)),et.length&&(mt.monitoringSupport=et.join(", ")),delete mt.monitoringSettings,delete mt.viewfinderSettings,delete mt.frameGuides,delete mt.aspectMaskOpacity,e.filter){const Z=parseFilterTokens(e.filter);if(Z.length){const he=Z.map(fe=>{const xe=fe.size&&fe.size!=="4x5.65"?` (${escapeHtml$2(fe.size)})`:"",$e=fe.values&&fe.values.length?`: ${escapeHtml$2(fe.values.join(", "))}`:"";return`<span class="filter-req-token">${escapeHtml$2(fe.type)}${xe}${$e}</span>`});mt.filter={__html:he.join("<br>"),text:Z.map(fe=>{const xe=fe.size&&fe.size!=="4x5.65"?` (${fe.size})`:"",$e=fe.values&&fe.values.length?`: ${fe.values.join(", ")}`:"";return`${fe.type}${xe}${$e}`}).join(`
`)}}}const Io=safeGetCurrentProjectName$1(e.projectName||"")||e.projectName||"",qo=escapeHtml$2(Io),eo=new Set(["filter","cameraHandle","viewfinderExtension","mattebox","videoDistribution","monitoringConfiguration","focusMonitor","tripodHeadBrand","tripodBowl","tripodTypes","tripodSpreader","sliderBowl","easyrig","lenses","viewfinderSettings","frameGuides","aspectMaskOpacity","viewfinderEyeLeatherColor","directorMonitor","dopMonitor","gafferMonitor","directorMonitor15","comboMonitor15","dopMonitor15","proGaffColor1","proGaffWidth1","proGaffColor2","proGaffWidth2","storageRequirements","monitorBatteries","lensSelections"]),To=Object.entries(mt).filter(([Z,he])=>he&&Z!=="projectName"&&!eo.has(Z)&&!Z.endsWith("Manual")&&!(no&&PRODUCTION_COMPANY_FIELD_ORDER.includes(Z))),ko=To.length?'<div class="requirements-grid">'+To.map(([Z,he])=>{const fe=formatRequirementValue(he),xe=$t[Z]||Z,$e=iconMarkup(projectFieldIcons[Z],{className:"req-icon",size:"var(--req-icon-size)"}),ze=[];Z==="productionCompany"&&no&&ze.push('data-has-address="true"');const yt=ze.length?` ${ze.join(" ")}`:"";return`<div class="requirement-box" data-field="${Z}"${yt}>${$e}<span class="req-label">${escapeHtml$2(xe)}</span><span class="req-value">${fe}</span></div>`}).join("")+"</div>":"",Jt=ct.heading||"Project Requirements",lr=To.length?`<h3>${escapeHtml$2(Jt)}</h3>${ko}`:"",pt=getGearListRentalToggleTexts({rentalHouse:e&&e.rentalHouse}),mo=pt.noteLabel&&pt.noteLabel.trim()?` data-rental-note="${escapeHtml$2(pt.noteLabel)}"`:"",go=(Z,he={})=>{const fe={},xe=ht=>{const uo=ht.trim();if(!uo)return{base:"",ctx:""};if(uo.charAt(uo.length-1)!==")")return{base:uo,ctx:""};const wt=uo.lastIndexOf(" (");if(wt===-1)return{base:uo,ctx:""};const Ao=uo.slice(0,wt).trim(),nr=uo.slice(wt+2,-1).trim();return!Ao||!nr||nr.indexOf("(")!==-1||nr.indexOf(")")!==-1?{base:uo,ctx:""}:{base:Ao,ctx:nr}};Z.filter(Boolean).forEach(ht=>{let uo=ht;try{if(typeof addArriKNumber$1=="function"){const Or=addArriKNumber$1(ht);typeof Or=="string"&&Or.trim()&&(uo=Or)}}catch{}const wt=uo.trim();if(!wt)return;const Ao=wt.match(/^(\d+)x\s+(.*)$/),nr=Ao?parseInt(Ao[1],10):NaN,dr=Number.isFinite(nr)&&nr>0?nr:1,fr=Ao?Ao[2]:wt,{base:ar,ctx:Jo}=xe(fr);if(!ar)return;fe[ar]||(fe[ar]={total:0,ctxCounts:{},cameraLink:!1,cameraLinkLabel:""});const Mr=fe[ar];if(Mr.total+=dr,Mr.ctxCounts[Jo]=(Mr.ctxCounts[Jo]||0)+dr,typeof he.onItem=="function")try{he.onItem({rawItem:wt,base:ar,context:Jo,quantity:dr,entry:Mr})}catch(Or){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("formatItems onItem callback failed",Or)}});const $e=pt,ze=$e.noteLabel&&$e.noteLabel.trim()?` data-rental-note="${escapeHtml$2($e.noteLabel)}"`:"",yt=Object.entries(fe),dt=typeof he.sorter=="function"?he.sorter:(ht,uo)=>compareStringsCaseInsensitive(ht[0],uo[0]);return yt.sort((ht,uo)=>{try{return dt(ht,uo)}catch(wt){return typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("formatItems sorter failed, falling back to default",wt),compareStringsCaseInsensitive(ht[0],uo[0])}}),yt.map(([ht,uo])=>{const wt=uo.total,Ao=uo.ctxCounts,dr=Object.keys(Ao).some(ro=>ro);let fr=[];if(dr)if(ht==="sand bag"){const ro=Object.entries(Ao).filter(([Bo])=>Bo&&Bo.toLowerCase()!=="spare").sort(([Bo],[we])=>compareStringsCaseInsensitive(Bo,we)),Br=ro.reduce((Bo,[,we])=>Bo+we,0),Xr=wt-Br;fr=ro.map(([Bo,we])=>`${we}x ${Bo}`),Xr>0&&fr.push(`${Xr}x Spare`)}else if(ht.startsWith("Bebob ")){const ro=Object.entries(Ao).filter(([Bo])=>Bo&&Bo.toLowerCase()!=="spare").map(([Bo,we])=>{const jt=Bo.match(/^(\d+)x\s+(.*)$/i);if(jt){const[,_o,Yr]=jt,Ar=parseInt(_o,10);if(Number.isFinite(Ar)&&Ar>0)return[Yr.trim(),we*Ar]}return[Bo,we]}).sort(([Bo],[we])=>compareStringsCaseInsensitive(Bo,we)),Br=ro.reduce((Bo,[,we])=>Bo+we,0),Xr=wt-Br;fr=ro.map(([Bo,we])=>`${we}x ${Bo}`),Xr>0&&fr.push(`${Xr}x Spare`)}else{const ro=Object.entries(Ao).filter(([we])=>we&&we.toLowerCase()!=="spare").sort(([we],[jt])=>compareStringsCaseInsensitive(we,jt)),Br=ro.reduce((we,[,jt])=>we+jt,0),Xr=Object.entries(Ao).filter(([we])=>we&&we.toLowerCase()==="spare").reduce((we,[,jt])=>we+jt,0);if(ro.length>0&&ro.every(([,we])=>we===ro[0][1])&&Xr===0?fr=ro.map(([we])=>we):fr=ro.map(([we,jt])=>`${jt}x ${we}`),Xr>0)fr.push(`${Xr}x Spare`);else if(ht==="D-Tap Extension 50 cm"){const we=wt-Br;we>0&&fr.push(`${we}x Spare`)}}const ar=fr.length?` (${fr.join(", ")})`:"",Jo=gearItemTranslations[currentLang]?.[ht]||ht,Mr=`${Jo}${ar}`,Or=`${ht}${ar}`,Uo=` data-gear-quantity="${escapeHtml$2(String(wt))}"`,Ko=` data-gear-label="${escapeHtml$2(Jo)}"`,yo=fr.length?` data-gear-attributes="${escapeHtml$2(fr.join(", "))}"`:"",En=escapeHtml$2(Or),Fr=`${wt}x ${Mr}`,wr=[];if(uo.cameraLink){const ro=G(uo.cameraLinkLabel);ro&&wr.push(ro)}const er=wr.length?` ${wr.join(" ")}`:"";return`<span class="gear-item" data-gear-name="${En}"${Uo}${Ko}${yo}${ze}${er}><span class="gear-item-text">${escapeHtml$2(Fr)}</span><span class="gear-item-note" hidden></span></span>`}).join("")},So=(Z,he={})=>{if(!Z)return"";const{name:fe="",quantity:xe="",label:$e="",attributes:ze="",rentalNote:yt=mo,extraAttributes:dt=""}=he,ht=fe?` data-gear-name="${escapeHtml$2(String(fe))}"`:"",uo=xe?` data-gear-quantity="${escapeHtml$2(String(xe))}"`:"",wt=$e?` data-gear-label="${escapeHtml$2(String($e))}"`:"",Ao=ze?` data-gear-attributes="${escapeHtml$2(String(ze))}"`:"",nr=typeof yt=="string"?yt:"",dr=dt?` ${dt.trim()}`:"";return`<span class="gear-item"${ht}${uo}${wt}${Ao}${nr}${dr}><span class="gear-item-text">${Z}</span><span class="gear-item-note" hidden></span></span>`},k=(Z,he)=>{if(typeof registerDevice!="function")return;const fe={};Z.filter(Boolean).forEach(xe=>{const $e=xe.trim().match(/^(.*?)(?: \(([^()]+)\))?$/),ze=$e?$e[1].trim():xe.trim();fe[ze]=fe[ze]||{}}),Object.keys(fe).length&&registerDevice(he,fe)},Q=[],X=(Z,he)=>{if(!he||!String(he).trim())return;const xe=(typeof Z=="string"?Z:String(Z??"")).trim()||String(Z??""),$e=createCustomCategoryKey(xe),ze=escapeHtml$2(xe),yt=resolveGearListCustomText("gearListAddCustomItem","Add custom item"),dt=resolveGearListCustomText("gearListAddCustomItemToCategory","Add custom item to {category}",{category:xe}),ht=typeof ICON_GLYPHS=="object"&&ICON_GLYPHS?ICON_GLYPHS.add||ICON_GLYPHS.plus:null,wt=(typeof iconMarkup=="function"&&ht?iconMarkup(ht,{className:"btn-icon"}):"")||escapeHtml$2("+"),Ao=`<button type="button" class="gear-custom-add-btn" data-gear-custom-add="${escapeHtml$2($e)}" data-gear-custom-category="${ze}" aria-label="${escapeHtml$2(dt)}" title="${escapeHtml$2(yt)}">${wt}</button>`,nr=`<div class="gear-standard-items">${he}</div>`,dr=`<div class="gear-custom-section" data-gear-custom-key="${escapeHtml$2($e)}" data-gear-custom-category="${ze}"><div class="gear-custom-items" data-gear-custom-list="${escapeHtml$2($e)}" data-gear-custom-category="${ze}" aria-live="polite"></div></div>`,fr=`${nr}${dr}`;Q.push(`<tbody class="category-group" data-gear-table-category="${ze}" data-gear-custom-key="${escapeHtml$2($e)}"><tr class="category-row"><td data-gear-category-label="${ze}"><div class="gear-category-header"><span class="gear-category-label">${ze}</span>${Ao}</div></td></tr><tr><td>${fr}</td></tr></tbody>`)};X("Camera",go([d.camera])),Y.forEach(Z=>{const he=resolveCameraLinkedSupportName(Z);he&&w(he)});const ae=go(Y,{onItem:_});let Ae="";if(j.length){const Z=j.map(dt=>`<option value="${escapeHtml$2(dt)}"${dt===d.cage?" selected":""}>${escapeHtml$2(addArriKNumber$1(dt))}</option>`).join(""),he=typeof localGetLocalizedText=="function"?localGetLocalizedText("category_cages"):"",fe=he&&he.trim()?he.trim():"Camera Cage",xe=fe?` aria-label="${escapeHtml$2(fe)}"`:"";fe&&`${escapeHtml$2(fe)}`;const $e=`<span class="cage-select-wrapper"><span>1x</span><select id="gearListCage"${xe}>${Z}</select></span>`;d.cage&&d.cage.trim();const ze=fe,yt=d.cage&&v?G(d.cage):"";Ae=So($e,{name:ze,quantity:1,label:fe,attributes:"",extraAttributes:yt})}X("Camera Support",[ae,Ae].filter(Boolean).join(""));const Se=Array.isArray(e.storageRequirements)?e.storageRequirements.map(Z=>{if(!Z||typeof Z!="object")return"";const he=Number.isFinite(Z.quantity)&&Z.quantity>0?Z.quantity:null,fe=typeof Z.type=="string"?Z.type.trim():"",xe=typeof Z.variant=="string"?Z.variant.trim():"",$e=typeof Z.notes=="string"?Z.notes.trim():"";if(!he&&!fe&&!xe&&!$e)return"";const ze=[],yt=fe.toLowerCase();let dt=xe||"";if(dt){const wt=dt.toLowerCase();yt&&!wt.includes(yt)&&fe&&ze.push(fe)}else fe&&(dt=fe);dt||(dt=Nt),$e&&ze.push($e);const ht=ze.length?` (${ze.join(", ")})`:"";return`${he?`${he}x `:""}${dt}${ht}`.trim()}).filter(Boolean):[],Oe=devices&&devices.cameras&&d.camera?devices.cameras[d.camera]:null;let Ne="";if(Se.length)Ne=go(Se);else if(Oe&&Array.isArray(Oe.recordingMedia)&&Oe.recordingMedia.length){const Z={"CFexpress Type A":"320GB","CFast 2.0":"512GB","CFexpress Type B":"512GB","Codex Compact Drive":"1TB","AXS Memory A-Series slot":"1TB",SD:"128GB","SD Card":"128GB",SDXC:"128GB","XQD Card":"120GB","RED MINI-MAG":"512GB",'REDMAG 1.8" SSD':"512GB","Blackmagic Media Module":"8TB","DJI PROSSD":"1TB","USB-C 3.1 Gen 1 expansion port for external media":"1TB","USB-C 3.1 Gen 2 expansion port for external media":"1TB","USB-C to external SSD/HDD":"1TB"};Ne=Oe.recordingMedia.slice(0,1).map(he=>{const fe=he&&he.type?he.type:"";if(!fe)return"";const xe=he&&he.brand?he.brand.trim():"";let $e="";if(he.notes){const dt=he.notes.match(/(\d+(?:\.\d+)?\s*(?:TB|GB))/i);dt&&($e=dt[1].toUpperCase())}return $e||($e=Z[fe]||"512GB"),`4x ${`${xe?`${escapeHtml$2(xe)} `:""}${escapeHtml$2($e)} ${escapeHtml$2(fe)}`}<br>2x ${escapeHtml$2(fe)} reader with USB-C`}).filter(Boolean).join("<br>")}X("Media",Ne);const Qe=(()=>{if(!Oe)return null;const Z=Oe.requiredImageCircleMm??Oe.requiredImageCircle,he=Number(Z);return Number.isFinite(he)?he:null})(),Fe=resolveGearListCustomText("gearListLensCoverageWarning","This lens may not cover the full sensor of this camera!"),_e=Z=>{if(typeof Z!="string")return"";const he=Z.trim().toLowerCase();return he==="imperial"||he==="metric"?he:""},st=(()=>{const Z=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,fe=(Z&&typeof Z.focusScalePreference=="string"?Z.focusScalePreference:null)||(typeof focusScalePreference=="string"?focusScalePreference:null)||"metric";return _e(fe)||"metric"})(),at=Z=>!Z||typeof Z!="object"?st:_e(Z.focusScale)||st,St=typeof currentLang=="string"&&currentLang.trim()?currentLang:"en",kt=(Z,he={})=>{const fe=typeof Z=="string"?Number(Z):Z;if(!Number.isFinite(fe))return"";const xe=typeof he.maximumFractionDigits=="number"?he.maximumFractionDigits:0,$e=typeof he.minimumFractionDigits=="number"?he.minimumFractionDigits:Math.min(0,xe);if(typeof Intl<"u"&&typeof Intl.NumberFormat=="function")try{return new Intl.NumberFormat(St,{maximumFractionDigits:xe,minimumFractionDigits:$e}).format(fe)}catch{}const ze=Math.max($e,Math.min(20,xe));try{return fe.toFixed(ze)}catch{}return String(fe)},Zt=(Z,he=st)=>{const fe=typeof Z=="string"?Number(Z):Z;if(!Number.isFinite(fe))return"";if(he==="imperial"){const ze=fe/453.59237,yt=ze>=10?1:2,dt=kt(ze,{maximumFractionDigits:yt,minimumFractionDigits:0});return dt?`${dt} lb`:""}const $e=kt(fe,{maximumFractionDigits:0,minimumFractionDigits:0});return $e?`${$e} g`:""},Ht=(Z,he=st)=>{const fe=typeof Z=="string"?Number(Z):Z;if(!Number.isFinite(fe))return"";if(he==="imperial"){const ze=fe/25.4,yt=ze>=10?1:2,dt=kt(ze,{maximumFractionDigits:yt,minimumFractionDigits:0});return dt?`${dt} in`:""}const $e=kt(fe,{maximumFractionDigits:1,minimumFractionDigits:0});return $e?`${$e} mm`:""},jo=(Z,he=st)=>{const fe=typeof Z=="string"?Number(Z):Z;if(!Number.isFinite(fe))return"";if(he==="imperial"){const yt=fe*3.280839895,dt=yt<10?2:1,ht=kt(yt,{maximumFractionDigits:dt,minimumFractionDigits:dt});return ht?`${ht} ft`:""}const $e=fe<1?2:1,ze=kt(fe,{maximumFractionDigits:$e,minimumFractionDigits:$e});return ze?`${ze} m`:""},ir=(Z,he=st)=>{const fe=typeof Z=="string"?Number(Z):Z;if(!Number.isFinite(fe))return"";if(he==="imperial"){const ze=fe/2.54,yt=ze>=10?1:2,dt=kt(ze,{maximumFractionDigits:yt,minimumFractionDigits:0});return dt?`${dt} in`:""}const $e=kt(fe,{maximumFractionDigits:1,minimumFractionDigits:0});return $e?`${$e} cm`:""},sr=new Map,Ro=Je.map(Z=>{const he=devices.lenses&&devices.lenses[Z],fe=addArriKNumber$1(Z),xe=buildLensSortMeta(Z,he);if(sr.set(fe,{manufacturer:xe.manufacturer,series:xe.series,focalLabel:xe.focalLabel,focalSortKey:xe.focalSortKey}),!he)return fe;const $e=at(he),ze=[],yt=Zt(he.weight_g,$e);if(yt&&ze.push(yt),he.clampOn)if(he.frontDiameterMm){const wt=Ht(he.frontDiameterMm,$e);ze.push(wt?`${wt} clamp-on`:"clamp-on")}else ze.push("clamp-on");else he.clampOn===!1&&ze.push("no clamp-on");const dt=he.minFocusMeters??he.minFocus??(he.minFocusCm?he.minFocusCm/100:null);if(Number.isFinite(dt)&&dt>0){const wt=jo(dt,$e);wt&&ze.push(`${wt} min focus`)}const ht=Number(he.imageCircleMm??he.imageCircle);return Number.isFinite(Qe)&&Number.isFinite(ht)&&ht+.5<Qe&&Fe&&ze.push(Fe),ze.length?`${fe} (${ze.join(", ")})`:fe});X("Lens",go(Ro,{sorter:([Z],[he])=>{const fe=sr.get(Z),xe=sr.get(he);if(fe&&xe){const $e=compareStringsCaseInsensitive(fe.manufacturer,xe.manufacturer);if($e!==0)return $e;const ze=compareStringsCaseInsensitive(fe.series,xe.series);if(ze!==0)return ze;const yt=Number.isFinite(fe.focalSortKey),dt=Number.isFinite(xe.focalSortKey);if(yt&&dt&&fe.focalSortKey!==xe.focalSortKey)return fe.focalSortKey-xe.focalSortKey;if(yt!==dt)return yt?-1:1;const ht=compareStringsCaseInsensitive(fe.focalLabel,xe.focalLabel);if(ht!==0)return ht}else{if(fe&&!xe)return-1;if(!fe&&xe)return 1}return compareStringsCaseInsensitive(Z,he)}}));const Lr=Z=>{if(!Z&&Z!==0)return[];const he=Array.isArray(Z)?Z:[Z],fe=new Set;return he.forEach($e=>{const ze=($e??"").toString().toLowerCase();ze&&(/\b15\s*mm\b/.test(ze)&&fe.add("15mm"),/\b19\s*mm\b/.test(ze)&&fe.add("19mm"))}),["15mm","19mm"].filter($e=>fe.has($e))},Co=[],hr=new Set;Je.forEach(Z=>{const he=devices.lenses&&devices.lenses[Z];if(!he)return;const fe=Lr(he.rodStandard),xe=fe[0]||(he.rodStandard?he.rodStandard:"15mm"),$e=fe[0]||(xe==="19mm"?"19mm":"15mm"),ze=he.rodLengthCm||($e==="19mm"?45:30),yt=`${$e}-${ze}`;if(!hr.has(yt)){const ht=ir(ze,at(he))||`${ze}cm`;Co.push(`${$e} rods ${ht}`),hr.add(yt)}he.needsLensSupport&&Co.push(`${$e} lens support`)}),X("Lens Support",go(Co)),X("Matte box + filter",[Ut,go(Et)].filter(Boolean).join(""));const Wo=[],Yo={clm3:!1,clm4:!1,clm5:!1};d.motors.forEach(Z=>{const he=(Z||"").toLowerCase();let fe="";/cforce\s*mini\s*rf|cforce\s*rf/.test(he)?(fe="ARRI KK.0040345 CFORCE MINI RF Basic Set 2",Wo.push(fe)):/cforce\s*mini/.test(he)&&!/rf/.test(he)?(fe="ARRI KK.0040344 Cforce Mini Basic Set 2",Wo.push(fe)):/cforce\s*plus/.test(he)?(fe="Arri KK.0008824 cforce plus Basic Set",Wo.push(fe),Wo.push("ARRI K2.0009335 Cforce Plus Gear M0.8/32p, 60t")):/clm-3/.test(he)?(fe="Arri KK.0005854 Controlled Lens Motor CLM-3 Basic Set",Wo.push(fe),Yo.clm3||(Wo.push("Arri K2.65145.0, Cable CLM-3 (7p) - CLM/FIZ (12p) (0,8m/2.6ft) (spare)"),Yo.clm3=!0)):/clm-4/.test(he)?(fe="ARRI Controlled Lens Motor CLM-4, Basic Kit (KK.0005855)",Wo.push(fe),Yo.clm4||(Wo.push("Arri K2.72099.0 CLM-4 Motor Cable (spare)"),Yo.clm4=!0)):/clm-5/.test(he)&&(fe="Arri K2.0006361 Controlled Lens Motor CLM-5 Basic Set",Wo.push(fe),Yo.clm5||(Wo.push("Arri K2.0006361 Controlled Lens Motor CLM-5 Basic Set (spare)"),Yo.clm5=!0)),!fe&&Z&&(fe=Z,Wo.push(Z)),fe&&w(fe)}),d.controllers.forEach(w);const Tt=[],$o=d.distance;if($o)if($o.toLowerCase()==="udm-1 + lcube"){const he="Arri KK.0005853 Ultrasonic Distance Measure UDM-1 Basic Set";Tt.push(he),w(he);const fe=d.controllers.some($e=>/ria-1/i.test($e)),xe=/alexa 35/i.test(d.camera||"");if(!fe&&!xe){const $e="Arri KK.0009001 LCUBE CUB-1 Basic Set";Tt.push($e),w($e)}}else Tt.push($o),w($o);X("LDS (FIZ)",go([...Wo,...d.controllers,...Tt,...z],{onItem:_}));let br="";if(d.battery){w(d.battery);let Z=batteryCountElem?parseInt(batteryCountElem.textContent,10):NaN;(!Z||isNaN(Z))&&(Z=1);const he=[`${Z}x ${d.battery}`],fe=hotswapSelect&&hotswapSelect.value&&hotswapSelect.value!=="None"?u(hotswapSelect):"";fe&&(he.push(`1x ${fe}`),w(fe)),br=go(he,{onItem:_})}X("Camera Batteries",br);let Do="";const ur=[];if(d.monitor){const Z="Onboard Monitor",he=devices?.monitors||{},fe=er=>{if(typeof er!="string")return"";const ro=er.trim();if(!ro)return"";const Br=ro.toLowerCase(),Xr=["linked","to","camera"],Bo=" ",we=sn=>sn===" "||sn==="	"||sn===`
`||sn==="\r"||sn==="\f"||sn==="\v"||sn===Bo,jt=sn=>{let pr=sn;for(;pr<Br.length&&we(Br[pr]);)pr+=1;return pr};let _o=0;for(let sn=0;sn<Xr.length;sn+=1){_o=jt(_o);const pr=Xr[sn];if(Br.slice(_o,_o+pr.length)!==pr)return ro;_o+=pr.length}const Yr=_o;_o=jt(_o);const Ar=_o>Yr;if(_o>=ro.length)return ro;const tn=new Set(["—","–","-",":"]);let Cn=!1;return tn.has(ro[_o])&&(_o+=1,Cn=!0),_o=jt(_o),!Ar&&!Cn||_o>=ro.length?ro:ro.slice(_o).trim()},xe=er=>{if(typeof er!="string")return"";const ro=er.trim();if(!ro)return"";const Br=we=>we==='"'||we==="'"||we==="“"||we==="”"||we==="‚"||we==="‘"||we==="’";let Xr=0,Bo=ro.length;for(;Xr<Bo&&Br(ro[Xr]);)Xr+=1;for(;Bo>Xr&&Br(ro[Bo-1]);)Bo-=1;return ro.slice(Xr,Bo).trim()},$e=er=>xe(fe(er)),ze=typeof monitorSelect<"u"&&monitorSelect&&monitorSelect.value&&monitorSelect.value!=="None"?monitorSelect.value:"",yt=typeof e.monitorSelection=="string"?e.monitorSelection.trim():"",dt=[],ht=er=>{const ro=typeof er=="string"?er.trim():"";if(!ro)return;dt.includes(ro)||dt.push(ro);const Br=$e(ro);Br&&!dt.includes(Br)&&dt.push(Br)};ht(ze),ht(yt),ht(d.monitor);let uo="",wt=null;dt.some(er=>Object.prototype.hasOwnProperty.call(he,er)?(uo=er,wt=he[er],!0):!1);let Ao=wt&&typeof wt.screenSizeInches<"u"?Number(wt.screenSizeInches):NaN;if(!Number.isFinite(Ao)){const er=parseFloat(String(wt?.screenSizeInches??""));Ao=Number.isFinite(er)?er:NaN}Number.isFinite(Ao)||(Ao=NaN),Number.isFinite(Ao)&&ur.push(Ao);const dr=(er=>{if(!Number.isFinite(er))return"";const ro=Number(er.toFixed(2));return Number.isInteger(ro)?String(ro):String(ro).replace(/\.0+$/,"")})(Ao),fr=dr?`${escapeHtml$2(dr)}&quot;`:"",ar=$e(d.monitor)||uo||$e(yt)||$e(ze),Jo=ar?addArriKNumber$1(ar):"",Mr=Jo?`&quot;${escapeHtml$2(Jo)}&quot;`:"",Or=[`1x <strong>${Z}</strong>`];fr&&Or.push(fr),Mr&&Or.push(Mr),Or.push("incl. Sunhood");const Uo=Or.join(" - "),Ko=[];dr&&Ko.push(`${dr}"`),Jo&&Ko.push(Jo),Ko.push("incl. Sunhood");const yo=Ko.filter(Boolean).join(" - "),En=yo?`${Z} (${yo})`:Z,Fr=Jo||$e(d.monitor)||$e(yt)||$e(ze)||"",wr=v?G(Fr||void 0):"";Do+=(Do?"<br>":"")+So(Uo,{name:En,quantity:1,label:Z,attributes:yo,extraAttributes:wr})}if($.forEach(({role:Z,size:he})=>{const fe=devices&&devices.monitors?devices.monitors:{},xe=Object.keys(fe).filter(ro=>!fe[ro].wirelessTx||fe[ro].wirelessRX).sort(localeSort),$e=Z==="DoP"?"dopMonitor":`${Z.toLowerCase()}Monitor`,ze=!!e[`${$e}Manual`],yt=typeof e[$e]=="string"?e[$e].trim():"",dt=getAutoGearMonitorDefault("handheld7");let ht="";ze&&yt?ht=yt:dt?ht=dt:yt&&(ht=yt);const uo=xe.map(ro=>ro.toLowerCase());let wt="";if(ht){const ro=uo.indexOf(ht.toLowerCase());ro>=0&&(wt=xe[ro])}if(!wt){if(!ze&&he){const ro=xe.find(Br=>fe[Br].screenSizeInches===he);he===7&&xe.includes("SmallHD Ultra 7")?wt="SmallHD Ultra 7":ro&&(wt=ro)}wt||(!ze&&!ht&&xe.includes("SmallHD Ultra 7")?wt="SmallHD Ultra 7":xe.length?wt=xe[0]:ht&&(wt=ht))}const Ao=xe.slice();ht&&!uo.includes(ht.toLowerCase())&&Ao.unshift(ht),wt&&!Ao.some(ro=>ro.toLowerCase()===wt.toLowerCase())&&Ao.unshift(wt);const nr=new Set,dr=Ao.filter(Boolean).filter(ro=>{const Br=ro.toLowerCase();return nr.has(Br)?!1:(nr.add(Br),!0)}).map(ro=>{const Br=ro.toLowerCase()===(wt||"").toLowerCase();return`<option value="${escapeHtml$2(ro)}"${Br?" selected":""}>${escapeHtml$2(addArriKNumber$1(ro))}</option>`}).join(""),fr=Z==="DoP"?"Dop":Z,ar=Z.replace(/s$/,""),Jo=Array.from(nr.values()).find(ro=>ro===(wt||"").toLowerCase())?Ao.find(ro=>ro&&ro.toLowerCase()===(wt||"").toLowerCase()):wt,Or=(Jo&&fe[Jo]?fe[Jo]:fe[wt]||fe[ht]||null)?.screenSizeInches||"",Uo=`${ar} Handheld Monitor`,Ko=`<span id="monitorSize${fr}">(${escapeHtml$2(Or?String(Or):"")}&quot;)</span>`,yo=`<select id="gearList${fr}Monitor" data-auto-gear-manual="${ze?"true":"false"}">${dr}</select>`,En=`1x <strong>${escapeHtml$2(Uo)}</strong> - ${Ko} - ${yo} incl. Directors cage, shoulder strap, sunhood, rigging for teradeks`,Fr=[];Or&&Fr.push(`${Or}"`),Jo&&Fr.push(addArriKNumber$1(Jo)),Fr.push("incl. Directors cage, shoulder strap, sunhood, rigging for teradeks");const wr=Fr.filter(Boolean).join(" - "),er=wr?`${Uo} (${wr})`:Uo;Do+=(Do?"<br>":"")+So(En,{name:er,quantity:1,label:Uo,attributes:wr}),Or&&ur.push(Or)}),V.forEach(({role:Z})=>{const he=devices&&devices.directorMonitors?devices.directorMonitors:{},fe=Object.keys(he).filter(wr=>wr!=="None").sort(localeSort),xe=Z==="DoP"?"dopMonitor15":Z==="Combo"?"comboMonitor15":"directorMonitor15",$e=!!e[`${xe}Manual`],ze=typeof e[xe]=="string"?e[xe].trim():"",yt=Z==="Combo"?"combo15":"director15",dt=getAutoGearMonitorDefault(yt);let ht="";$e&&ze?ht=ze:dt?ht=dt:ze&&(ht=ze);const uo=fe.map(wr=>wr.toLowerCase());let wt="";if(ht){const wr=uo.indexOf(ht.toLowerCase());wr>=0&&(wt=fe[wr])}wt||(fe.includes('SmallHD Cine 24" 4K High-Bright Monitor')?wt='SmallHD Cine 24" 4K High-Bright Monitor':fe.length?wt=fe[0]:ht&&(wt=ht));const Ao=fe.slice();ht&&!uo.includes(ht.toLowerCase())&&Ao.unshift(ht),wt&&!Ao.some(wr=>wr.toLowerCase()===wt.toLowerCase())&&Ao.unshift(wt);const nr=new Set,dr=Ao.filter(Boolean).filter(wr=>{const er=wr.toLowerCase();return nr.has(er)?!1:(nr.add(er),!0)}).map(wr=>{const er=wr.toLowerCase()===(wt||"").toLowerCase();return`<option value="${escapeHtml$2(wr)}"${er?" selected":""}>${escapeHtml$2(addArriKNumber$1(wr))}</option>`}).join(""),fr=Z==="DoP"?"Dop":Z,ar=Array.from(nr.values()).find(wr=>wr===(wt||"").toLowerCase())?Ao.find(wr=>wr&&wr.toLowerCase()===(wt||"").toLowerCase()):wt,Jo=ar&&he[ar]?.screenSizeInches?he[ar].screenSizeInches:he[wt]?.screenSizeInches||he[ht]?.screenSizeInches||"",Mr=`${Z} Monitor`,Or=`<span id="monitorSize${fr}15">(${escapeHtml$2(Jo?String(Jo):"")}&quot;)</span>`,Uo=`<select id="gearList${fr}Monitor15" data-auto-gear-manual="${$e?"true":"false"}">${dr}</select>`,Ko=`1x <strong>${escapeHtml$2(Mr)}</strong> - ${Or} - ${Uo} incl. sunhood, V-Mount, AC Adapter and Wooden Camera Ultra QR Monitor Mount (Baby Pin, C-Stand)`,yo=[];Jo&&yo.push(`${Jo}"`),ar&&yo.push(addArriKNumber$1(ar)),yo.push("incl. sunhood, V-Mount, AC Adapter and Wooden Camera Ultra QR Monitor Mount (Baby Pin, C-Stand)");const En=yo.filter(Boolean).join(" - "),Fr=En?`${Mr} (${En})`:Mr;Do+=(Do?"<br>":"")+So(Ko,{name:Fr,quantity:1,label:Mr,attributes:En}),Jo&&ur.push(Jo)}),O){const Z=devices&&devices.monitors?devices.monitors:{},he=Object.keys(Z).filter(Ko=>!Z[Ko].wirelessTx||Z[Ko].wirelessRX).sort(localeSort),fe=!!e.focusMonitorManual,xe=typeof e.focusMonitor=="string"?e.focusMonitor.trim():"",$e=getAutoGearMonitorDefault("focus");let ze="";fe&&xe?ze=xe:$e?ze=$e:xe&&(ze=xe);const yt=he.map(Ko=>Ko.toLowerCase());let dt="";if(ze){const Ko=yt.indexOf(ze.toLowerCase());Ko>=0&&(dt=he[Ko])}dt||(he.includes("TV Logic F7HS")?dt="TV Logic F7HS":he.length?dt=he[0]:ze&&(dt=ze));const ht=he.slice();ze&&!yt.includes(ze.toLowerCase())&&ht.unshift(ze),dt&&!ht.some(Ko=>Ko.toLowerCase()===dt.toLowerCase())&&ht.unshift(dt);const uo=new Set,wt=ht.filter(Boolean).filter(Ko=>{const yo=Ko.toLowerCase();return uo.has(yo)?!1:(uo.add(yo),!0)}).map(Ko=>{const yo=Ko.toLowerCase()===(dt||"").toLowerCase();return`<option value="${escapeHtml$2(Ko)}"${yo?" selected":""}>${escapeHtml$2(addArriKNumber$1(Ko))}</option>`}).join(""),Ao=Array.from(uo.values()).find(Ko=>Ko===(dt||"").toLowerCase())?ht.find(Ko=>Ko&&Ko.toLowerCase()===(dt||"").toLowerCase()):dt,nr=Ao&&Z[Ao]?Z[Ao].screenSizeInches:Z[dt]?.screenSizeInches||Z[ze]?.screenSizeInches||"",dr="Focus Monitor",fr=`<span id="monitorSizeFocus">(${escapeHtml$2(nr?String(nr):"")}&quot;)</span>`,ar=`<select id="gearListFocusMonitor" data-auto-gear-manual="${fe?"true":"false"}">${wt}</select>`,Jo=`1x <strong>${escapeHtml$2(dr)}</strong> - ${fr} - ${ar} incl Directors cage, shoulder strap, sunhood, rigging for teradeks`,Mr=[];nr&&Mr.push(`${nr}"`),Ao&&Mr.push(addArriKNumber$1(Ao)),Mr.push("incl Directors cage, shoulder strap, sunhood, rigging for teradeks");const Or=Mr.filter(Boolean).join(" - "),Uo=Or?`${dr} (${Or})`:dr;Do+=(Do?"<br>":"")+So(Jo,{name:Uo,quantity:1,label:dr,attributes:Or}),nr&&ur.push(nr)}const or=[],Vo=ur.includes(5)?5:null;if(d.video){const Z=Vo?`${Vo}&quot; - `:"",he=`Wireless Transmitter - ${Z}${addArriKNumber$1(d.video)}`;or.push(he),w(he);const fe=d.video.replace(/ TX\b/," RX");devices&&devices.wirelessReceivers&&devices.wirelessReceivers[fe]&&We.forEach(xe=>{const $e=`Wireless Receiver - ${Z}${addArriKNumber$1(fe)} (${xe})`;or.push($e),w($e)})}if(or.length){const Z=go(or,{onItem:_}).replace(/>(\d+x )Wireless Transmitter/g,">$1<strong>Wireless Transmitter</strong>").replace(/>(\d+x )Wireless Receiver/g,">$1<strong>Wireless Receiver</strong>").replace(/&amp;quot;/g,"&quot;");Do+=(Do?"<br>":"")+Z}const Po=(()=>{const Z=e.monitorBatteries;if(!Z||typeof Z!="object"||Array.isArray(Z))return{};const he={};return Object.entries(Z).forEach(([fe,xe])=>{if(typeof fe!="string"||typeof xe!="string")return;const $e=xe.trim();$e&&(he[fe]=$e)}),he})(),co=devices&&devices.batteries?devices.batteries:{},mr=Object.keys(co).filter(Z=>Z&&Z!=="None").sort(localeSort),Sr=Z=>{const he=typeof Z=="string"?Z.trim():"",fe=mr.slice();he&&!fe.some($e=>$e.toLowerCase()===he.toLowerCase())&&fe.unshift(he);const xe=new Set;return fe.filter(Boolean).filter($e=>{const ze=$e.toLowerCase();return xe.has(ze)?!1:(xe.add(ze),!0)}).map($e=>{const ze=he&&$e.toLowerCase()===he.toLowerCase();return`<option value="${escapeHtml$2($e)}"${ze?" selected":""}>${escapeHtml$2(addArriKNumber$1($e))}</option>`}).join("")},jr=[],Qr=Object.keys(co).find(Z=>/V98micro/i.test(Z))||"Bebob V98micro";$.forEach((Z,he)=>{const xe=(typeof Z.role=="string"?Z.role:"").trim(),$e=`${xe||"Monitor"} handheld`,ze=`handheld:${xe}:${he}`,yt=Po[ze],dt=typeof yt=="string"&&yt.trim()||Qr,ht=(xe||"Monitor").replace(/[^A-Za-z0-9]/g,"")||"Monitor",uo=`gearListMonitorBatteryHandheld${he}${ht}`,wt=Sr(dt),Ao=`<select id="${uo}" data-monitor-battery-key="${escapeHtml$2(ze)}" data-monitor-battery-type="handheld" data-monitor-battery-role="${escapeHtml$2(xe)}">${wt}</select>`,nr=`Monitoring Battery ${$e}`,dr=' data-gear-quantity="3"',fr=' data-gear-label="Monitoring Battery"',ar=$e?` data-gear-attributes="${escapeHtml$2($e)}"`:"",Jo=`3x ${Ao} (${escapeHtml$2($e)})`;jr.push(`<span class="gear-item" data-gear-name="${escapeHtml$2(nr)}"${dr}${fr}${ar}${mo}><span class="gear-item-text">${Jo}</span><span class="gear-item-note" hidden></span></span>`)});const an=Object.keys(co).find(Z=>/V290RM-Cine/i.test(Z))||"Bebob V290RM-Cine";V.forEach((Z,he)=>{const xe=(typeof Z.role=="string"?Z.role:"").trim(),$e=`${xe||"Monitor"} 15-21"`,ze=`large:${xe}:${he}`,yt=Po[ze],dt=typeof yt=="string"&&yt.trim()||an,ht=(xe||"Monitor").replace(/[^A-Za-z0-9]/g,"")||"Monitor",uo=`gearListMonitorBatteryLarge${he}${ht}`,wt=Sr(dt),Ao=`<select id="${uo}" data-monitor-battery-key="${escapeHtml$2(ze)}" data-monitor-battery-type="large" data-monitor-battery-role="${escapeHtml$2(xe)}">${wt}</select>`,nr=`Monitoring Battery ${$e}`,dr=' data-gear-quantity="2"',fr=' data-gear-label="Monitoring Battery"',ar=$e?` data-gear-attributes="${escapeHtml$2($e)}"`:"",Jo=`2x ${Ao} (${escapeHtml$2($e)})`;jr.push(`<span class="gear-item" data-gear-name="${escapeHtml$2(nr)}"${dr}${fr}${ar}${mo}><span class="gear-item-text">${Jo}</span><span class="gear-item-note" hidden></span></span>`)}),X("Monitoring Batteries",jr.length?jr.join(""):""),X("Chargers",go(F)),X("Monitoring",Do),k(H,"accessories.monitoringSupport");const Re=go(H.filter(Z=>typeof Z!="string"?!0:!(Z.startsWith("Monitoring Battery ")||Z.endsWith("Monitor"))));X("Monitoring support",Re);const Ye=devices&&typeof devices=="object"&&devices.carts&&typeof devices.carts=="object"?devices.carts:{},ke=Object.keys(Ye).filter(Z=>Z&&Z!=="None").sort(localeSort),ee=ke.includes('Backstage Magliner Senior 24" Film Cart (8" Conversion Kit)')?'Backstage Magliner Senior 24" Film Cart (8" Conversion Kit)':ke[0]||"",I=[{pattern:/magliner\s+senior/,value:'Backstage Magliner Senior 24" Film Cart (8" Conversion Kit)'},{pattern:/magliner\s+junior/,value:'Backstage Magliner Junior 24" Film Cart (8" Conversion Kit)'},{pattern:/voyager\s*30/,value:"Inovativ Voyager 30 EVO X"},{pattern:/voyager\s*36/,value:"Inovativ Voyager 36 EVO X"},{pattern:/voyager\s*42/,value:"Inovativ Voyager 42 EVO X"},{pattern:/apollo\s*40/,value:"Inovativ Apollo 40 EVO"},{pattern:/apollo\s*52/,value:"Inovativ Apollo 52 EVO"},{pattern:/echo\s*36/,value:"Inovativ Echo 36 Workstation Cart"},{pattern:/echo\s*48/,value:"Inovativ Echo 48 Workstation Cart"},{pattern:/adicam\s+mini/,value:"Adicam MINI Camera Cart"},{pattern:/adicam\s+standard\+/,value:"Adicam STANDARD+ Camera Cart"},{pattern:/adicam\s+standard/,value:"Adicam STANDARD Camera Cart"},{pattern:/adicam\s+max/,value:"Adicam MAX Camera Cart"},{pattern:/tilta\s+boulder/,value:'Tilta Boulder 36" Camera Cart'},{pattern:/smallrig/,value:'SmallRig MD4573 36" Lightweight Video Production Camera Cart'}];function N(Z){return Z?Z.replace(/["'”“]/g,"").replace(/\(.*?\)/g,"").replace(/[^a-z0-9]+/gi," ").trim().toLowerCase():""}function K(Z){if(!ke.length)return"";const he=typeof Z=="string"?Z.trim():"";if(he&&Object.prototype.hasOwnProperty.call(Ye,he))return he;const fe=N(he);if(fe){const xe=ke.find(ze=>N(ze)===fe);if(xe)return xe;const $e=I.find(ze=>ze.pattern.test(fe)&&ke.includes(ze.value));if($e)return $e.value}return""}function oe(Z){return Z?Z.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/\b\w/g,he=>he.toUpperCase()):""}function ce(Z,he){if(!Z||typeof Z!="object")return"";const fe=[];he&&fe.push(he),typeof Z.diameterIn<"u"?fe.push(`${Z.diameterIn}"`):typeof Z.diameterMainMm<"u"&&fe.push(`${Z.diameterMainMm} mm`),Z.tireType&&fe.push(Z.tireType);const xe=fe.filter(Boolean).join(" ");return Z.notes?xe?`${xe} (${Z.notes})`:Z.notes:Z.name&&xe?`${Z.name} - ${xe}`:Z.name||xe}function me(Z){if(!Z||typeof Z!="object")return[];const he=[],fe=new Set,xe=(ze,yt,dt,ht)=>{if(!ze||!yt||fe.has(ze))return;const uo=addArriKNumber$1(yt)||yt;he.push({value:ze,label:uo,selected:!!dt,title:ht}),fe.add(ze)};Z.config&&typeof Z.config=="object"&&Object.entries(Z.config).forEach(([ze,yt])=>{if(!yt)return;const dt=oe(ze);dt&&xe(`feature:${ze}`,dt,!0)});const $e=Z.wheelConfig&&typeof Z.wheelConfig=="object"?Z.wheelConfig:null;if($e&&$e.standard){const ze=ce($e.standard,"Standard wheel")||"Standard wheel";xe("wheel:standard",ze,!0,$e.standard.notes)}return $e&&Array.isArray($e.options)&&$e.options.forEach((ze,yt)=>{const dt=ce(ze,ze&&ze.name?ze.name:"Wheel option")||`Wheel option ${yt+1}`;xe(`wheel:option:${yt}`,dt,!1,ze&&ze.notes)}),Array.isArray(Z.kits)&&Z.kits.forEach((ze,yt)=>{const dt=ze&&ze.name?ze.name:`Kit ${yt+1}`;xe(`kit:${yt}`,dt,!1,ze&&ze.notes)}),he}function De(Z){if(!Z||typeof Z!="object")return[];const he=[],fe=new Set,xe=($e,ze,yt,dt)=>{if(!$e||!ze||fe.has($e))return;const ht=addArriKNumber$1(ze)||ze;he.push({value:$e,label:ht,selected:!!yt,title:dt}),fe.add($e)};return Array.isArray(Z.accessories)&&Z.accessories.forEach(($e,ze)=>{$e&&xe(`accessory:${ze}`,$e,!0)}),Array.isArray(Z.brandAccessories)&&Z.brandAccessories.forEach(($e,ze)=>{if(!$e||!$e.name)return;const yt=$e.accessoryKind?oe($e.accessoryKind):"",dt=yt?`[${yt}] ${$e.name}`:$e.name;xe(`brand:${ze}`,dt,!0,$e.notes)}),he}function Ge(Z,he,fe){if(!fe.length)return"";const xe=he||"Options",$e=Math.min(6,Math.max(2,fe.length)),ze=fe.map(yt=>{const dt=[`value="${escapeHtml$2(yt.value)}"`];return yt.selected&&dt.push("selected"),yt.title&&dt.push(`title="${escapeHtml$2(yt.title)}"`),`<option ${dt.join(" ")}>${escapeHtml$2(yt.label)}</option>`}).join("");return`
        <span class="gear-cart-option">
          <span class="gear-cart-option-label">${escapeHtml$2(xe)}</span>
          <select id="${escapeHtml$2(Z)}" multiple size="${$e}" aria-label="${escapeHtml$2(xe)}">
            ${ze}
          </select>
        </span>
      `.replace(/\s+/g," ").trim()}function Ue(Z,he){if(!ke.length)return"";const fe=K(Z)||ee||"";if(!fe&&!Z)return"";const xe=fe||Z,$e=ke.length?ke.map(Or=>`<option value="${escapeHtml$2(Or)}"${Or===fe?" selected":""}>${escapeHtml$2(addArriKNumber$1(Or)||Or)}</option>`).join(""):`<option value="${escapeHtml$2(xe)}" selected>${escapeHtml$2(addArriKNumber$1(xe)||xe)}</option>`,ze=`gearListCartSelect${he}`,yt=resolveGearListCustomText("gearListCartSelectorLabel","Camera cart"),dt=`<select id="${ze}" aria-label="${escapeHtml$2(yt)}">${$e}</select>`,ht=Ye[fe]||Ye[xe]||null,uo=me(ht),wt=De(ht),Ao=uo.length?Ge(`gearListCartConfig${he}`,resolveGearListCustomText("gearListCartConfigurationLabel","Cart configuration"),uo):"",nr=wt.length?Ge(`gearListCartAccessories${he}`,resolveGearListCustomText("gearListCartAccessoriesLabel","Cart accessories"),wt):"",dr=[Ao,nr].filter(Boolean).join(""),fr=dr?`<div class="gear-cart-detail">${dr}</div>`:"",ar=yt||"Camera cart",Jo=`1x <strong>${escapeHtml$2(ar)}</strong> - ${dt}${fr}`,Mr=xe?addArriKNumber$1(xe)||xe:"";return So(Jo,{name:Mr?`${ar} (${Mr})`:ar,label:ar,attributes:Mr,extraAttributes:' data-gear-cart-entry="true"'})}function Xe(Z){return!Array.isArray(Z)||!Z.length?"":Z.map((fe,xe)=>Ue(fe,xe)).filter(Boolean).join("")}const ft=[];k(ft,"accessories.carts");const Le=[];let ot=!1,_t="",Lt="";if($.forEach(Z=>{Le.push(`Avenger C-Stand Sliding Leg 20" (${Z.role} handheld)`),Le.push(`Steelfingers Wheel C-Stand 3er Set (${Z.role} handheld)`),Le.push(`Lite-Tite Swivel Aluminium Umbrella Adapter (${Z.role} handheld)`),W.push(`Spigot with male 3/8" and 1/4" (${Z.role} handheld)`)}),V.forEach(Z=>{Le.push(`Matthews Monitor Stand II (249562) (${Z.role} 15-21")`),Le.push(`Avenger C590 Conka Bonka Stativ-Verlängerungen Set (${Z.role} 15-21")`),Le.push(`Impact Baby to Junior Receiver Adapter (${Z.role} 15-21")`),Le.push(`Matthews BIG F'ING Monitor Wheel Set (3 pieces) (${Z.role} 15-21")`),W.push(`ULCS Bracket with 1/4" to 1/4" (${Z.role} 15-21")`),Le.push(`Manfrotto 635 Quick-Action Super Clamp (${Z.role} 15-21")`),W.push(`Spigot with male 3/8" and 1/4" (${Z.role} 15-21")`),W.push(`Cine Quick Release (${Z.role} 15-21")`),W.push(`D-Tap Splitter (${Z.role} 15-21")`),W.push(`D-Tap Splitter (${Z.role} 15-21")`)}),de("Easyrig")){const Z=devices&&devices.accessories&&devices.accessories.cameraStabiliser&&devices.accessories.cameraStabiliser["Easyrig 5 Vario"];Lt=`1x Easyrig 5 Vario <select id="gearListEasyrig">${["no further stabilisation",...Z&&Array.isArray(Z.options)?Z.options:[]].map($e=>`<option value="${escapeHtml$2($e)}">${escapeHtml$2(addArriKNumber$1($e))}</option>`).join("")}</select>`}Ce&&Le.push(...ge);const Qt=Ce?2:1;Le.push(...Array(Qt).fill("Manfrotto 244N Friktion Arm")),Ce&&(Le.push("Avenger D200B Grip Head"),Le.push('Spigot with male 3/8" and 1/4"')),de("Cine Saddle")&&Le.push("Cinekinetic Cinesaddle"),de("Steadybag")&&Le.push("Steadybag"),de("Jib")&&(Le.push("Pro Sup EJIb-Arm"),Le.push("Jib counter weights"),ot=!0),de("Slider")&&(_t=`1x Prosup Tango Roller <select id="gearListSliderBowl">${["","75er bowl","100er bowl","150er bowl","Mitchell Mount"].map(he=>`<option value="${escapeHtml$2(he)}"${he===e.sliderBowl?" selected":""}>${escapeHtml$2(addArriKNumber$1(he))}</option>`).join("")}</select>`,Le.push("Avenger Combo Stand 10 A1010CS 64-100 cm black"),Le.push("Avenger Combo Stand 10 A1010CS 64-100 cm black"),Le.push("Avenger Combo Stand 20 A1020B 110-198 cm black"),Le.push("Avenger Combo Stand 20 A1020B 110-198 cm black"),Le.push("Apple Box Set / Bühnenkisten Set"),Le.push("Apple Box Set / Bühnenkisten Set"),Le.push("Paganini set"),Le.push("Sand bag (Slider)"),Le.push("Sand bag (Slider)"),Le.push("Cable mat"),Le.push("Cable mat"),Le.push("Cable mat")),de("Slider")&&de("Undersling mode")&&Le.push("Tango Beam"),de("Outdoor")&&W.push('Spigot with male 3/8" and 1/4" (Focus Umbrella)'),ne(["Extreme heat","Extreme rain","Rain Machine"])&&(Le.push("Large Umbrella"),Le.push("Avenger A5036CS Roller 36 Low Base with Umbrella Mounting"));const Gt=e.tripodTypes?e.tripodTypes.split(",").map(Z=>Z.trim()).filter(Boolean):[],ho=e.tripodBowl,Qo=e.tripodSpreader,Xo=e.tripodHeadBrand,No={OConnor:{"100mm bowl":"O'Connor Ultimate 1040 Fluid-Head","150mm bowl":"O'Connor Ultimate 2560 Fluid-Head","Mitchell Mount":"O'Connor Ultimate 2560 Fluid-Head"},Sachtler:{"75mm bowl":"Sachtler aktiv8T S2068T","100mm bowl":"Sachtler aktiv18T S2088T","150mm bowl":"Sachtler Cine 30 3007"}},ao=No[Xo]&&No[Xo][ho];if(ao){const Z=`${ao} ${ho}`;Le.push(Z),w(Z)}Gt.forEach(Z=>{const he=Z==="Hi-Head"?"Hi-Head":`${Z} Tripod`,fe=ho?`${ho} ${he}`:he,xe=[];Z==="Hi-Head"?xe.push(fe):Qo?xe.push(`${fe} + ${Qo}`):xe.push(fe),Z==="Short"&&xe.push("Sand bag (Short Tripod)"),Z==="Hi-Head"&&xe.push("Sand bag (Hi-Head)"),xe.forEach($e=>{Le.push($e),w($e)})}),ot&&!Le.some(Z=>/Long Tripod/.test(Z))&&Le.push("Long Tripod");const Ir=Le.filter(Z=>/\bstand\b/i.test(Z)&&!/wheel/i.test(Z)).length;Ir&&Le.push(...Array(Ir*3).fill("Tennis ball"));const cr=ft.filter(Z=>/Magliner/i.test(Z)).length;cr&&Le.push(...Array(cr*2).fill("Wooden wedge")),k(W,"accessories.rigging"),k(Le,"accessories.grip");const Rr=go(W);X("Rigging",Rr);const Er=[];de("Studio")&&Er.push("Camera Power Supply"),k(Er,"accessories.power"),X("Power",go(Er));const rr=go(Le,{onItem:_});X("Grip",[_t,rr,Lt].filter(Boolean).join(""));const $r=Xe(ft);X("Carts and Transportation",$r||go(ft));const Pr=new Set(["D-Tap to LEMO 2-pin","HDMI Cable","BNC SDI Cable","Ultraslim BNC Cable 0.5 m"]),Kt=[...x].filter(Z=>!Pr.has(Z)),Oo=[],Dt=Array.isArray(Oe?.viewfinder)&&Oe.viewfinder.length>0;let Fo=e.viewfinderEyeLeatherColor||"red";const qr=[{id:1,color:e.proGaffColor1||"red",width:e.proGaffWidth1||"24mm"},{id:2,color:e.proGaffColor2||"blue",width:e.proGaffWidth2||"24mm"}],en=[{name:"Kimtech Wipes",count:1},{name:'Sprigs Red 1/4"',count:1,noScale:!0},{name:"Clapper Stick",count:2,klappen:!0}];let yr=Dt?2:0,Kr=0,Zo=!1;const Cr=Array.isArray(e.shootingDays)?e.shootingDays:e.shootingDays?[e.shootingDays]:[],T=new Set([9,10,11,0,1,2,3,4]);Cr.forEach(Z=>{const he=Z.split(" to ");if(he.length===2){const fe=new Date(he[0]),xe=new Date(he[1]);if(!isNaN(fe)&&!isNaN(xe)&&(Kr+=Math.floor((xe-fe)/(1e3*60*60*24))+1,!Zo)){const $e=new Date(fe);for($e.setHours(0,0,0,0);$e<=xe;){if(T.has($e.getMonth())){Zo=!0;break}$e.setMonth($e.getMonth()+1)}}}});let J=1;Kr>21?J=4:Kr>14?J=3:Kr>7&&(J=2);const qe=J%2===0?J:Math.max(1,J-1);for(const Z of en){let he=Z.count;Z.noScale||(Z.klappen?he*=qe:he*=J);for(let fe=0;fe<he;fe++)Oo.push(Z.name)}yr&&(yr*=J);const Rt=ne(["Outdoor","Extreme rain","Rain Machine"]);if(Rt&&d.camera&&Kt.push(`Rain Cover ${addArriKNumber$1(d.camera)}`),(Rt||de("Extreme heat"))&&(Kt.includes("Umbrella for Focus Monitor")||Kt.push("Umbrella for Focus Monitor"),Kt.includes("Umbrella Magliner incl Mounting to Magliner")||Kt.push("Umbrella Magliner incl Mounting to Magliner")),Rt){const Z=[];if(monitorSelect&&monitorSelect.value){const xe=devices.monitors[monitorSelect.value];xe&&xe.screenSizeInches&&Z.push(xe.screenSizeInches)}const he=Z.filter(xe=>xe>10).length,fe=Z.filter(xe=>xe<=10).length;for(let xe=0;xe<he+2;xe++)Oo.push("CapIt Large");for(let xe=0;xe<fe+3;xe++)Oo.push("CapIt Medium");for(let xe=0;xe<3;xe++)Oo.push("CapIt Small");for(let xe=0;xe<10;xe++)Oo.push("Shower Cap");Oo.push("Magliner Rain Cover Transparent")}const Go=Zo&&de("Outdoor")||de("Extreme cold (snow)"),zo=de("Extreme cold (snow)");if(Go&&(Kt.push("Hair Dryer"),["Sony Venice 2","Sony Venice"].includes(d.camera)?Kt.push("Denz C0100072 Shut-Eye Heater für Sony"):["Arri Alexa Mini","Arri Amira"].includes(d.camera)&&Kt.push("Arri K2.0003898 Heated Eyecup HE-7 for the MVF-1")),zo){const Z=Math.max(Kr,1)*2;for(let he=0;he<Z;he++)Kt.push("Hand Warmers");for(let he=0;he<Z;he++)Kt.push("Feet Warmers")}const gr=[["red","Red"],["blue","Blue"],["green","Green"],["yellow","Yellow"],["black","Black"],["pink","Pink"],["orange","Orange"],["violette","Violette"],["white","White"]],It=["6mm","12mm","19mm","24mm","48mm"],Vr=J,Nr=qr.map(({id:Z,color:he,width:fe})=>{const xe=gr.map(([ht,uo])=>`<option value="${ht}"${ht===he?" selected":""}>${uo}</option>`).join(""),$e=It.map(ht=>`<option value="${ht}"${ht===fe?" selected":""}>${ht}</option>`).join(""),ze=` data-gear-quantity="${escapeHtml$2(String(Vr))}"`,yt=' data-gear-label="Pro Gaff Tape"',dt=`${escapeHtml$2(String(Vr))}x Pro Gaff Tape <select id="gearListProGaffColor${Z}">${xe}</select> <select id="gearListProGaffWidth${Z}">${$e}</select>`;return`<span class="gear-item" data-gear-name="Pro Gaff Tape"${ze}${yt}${mo}><span class="gear-item-text">${dt}</span><span class="gear-item-note" hidden></span></span>`}).join("");let Xt="";if(yr){const he=[["red","Red"],["blue","Blue"],["natural","Natural"],["green","Green"],["purple","Purple"],["orange","Orange"],["gray","Gray"],["yellow","Yellow"],["jaguar","Jaguar"],["killer bee","Killer Bee"],["green rabbit","Green Rabbit"],["black","Black"]].map(([ze,yt])=>`<option value="${ze}"${ze===Fo?" selected":""}>${yt}</option>`).join(""),fe=` data-gear-quantity="${escapeHtml$2(String(yr))}"`,xe=' data-gear-label="Bluestar eye leather made of microfiber oval, large"',$e=`${escapeHtml$2(String(yr))}x Bluestar eye leather made of microfiber oval, large <select id="gearListEyeLeatherColor">${he}</select>`;Xt=`<span class="gear-item" data-gear-name="Bluestar eye leather made of microfiber oval, large"${fe}${xe}${mo}><span class="gear-item-text">${$e}</span><span class="gear-item-note" hidden></span></span>`}X("Miscellaneous",go(Kt)),X("Consumables",[Xt,Nr,go(Oo)].filter(Boolean).join(""));let po=`<h2>${qo}</h2>`;lr&&(po+=lr);const Wr='<table class="gear-table">'+Q.join("")+"</table>",Pn={...e,cameraSelection:d.camera,monitorSelection:d.monitor,wirelessSelection:d.video,motorSelections:d.motors.slice(),controllerSelections:d.controllers.slice(),distanceSelection:d.distance},Kn=applyAutoGearRulesToTableHtml$1(Wr,Pn);return po+="<h3>Gear List</h3>"+Kn,po}function gearListGetCurrentHtmlImpl(e={}){const t=e.forPersistence===!0||e.isForPersistence===!0,o=getGlobalScope$1(),r=o&&typeof o.__cineLastGearListHtml=="string"?o.__cineLastGearListHtml:"";if(!gearListOutput&&!projectRequirementsOutput)return r;const n=projectRequirementsOutput&&typeof projectRequirementsOutput.cloneNode!="function",a=gearListOutput&&typeof gearListOutput.cloneNode!="function";if(n||a)return r;let s="";if(projectRequirementsOutput){const y=projectRequirementsOutput.cloneNode(!0),h=y.querySelector("#editProjectBtn");h&&h.remove();const b=y.querySelector("h2");b&&b.remove(),s=y.innerHTML.trim()}let l="";if(gearListOutput){const y=gearListOutput.cloneNode(!0),h=typeof gearListOutput.querySelector=="function"?gearListOutput:null,b=y.querySelector("#gearListActions");b&&b.remove();const v=y.querySelector("#editProjectBtn");v&&v.remove(),["Director","Dop","Gaffer","Focus"].forEach(O=>{const B=y.querySelector(`#gearList${O}Monitor`);if(B&&B.options){const $=h?h.querySelector(`#gearList${O}Monitor`):null,V=$?$.value:B.value;Array.from(B.options).forEach(M=>{M.value===V?M.setAttribute("selected",""):M.removeAttribute("selected")})}}),["Director","Combo","Dop"].forEach(O=>{const B=y.querySelector(`#gearList${O}Monitor15`);if(B&&B.options){const $=h?h.querySelector(`#gearList${O}Monitor15`):null,V=$?$.value:B.value;Array.from(B.options).forEach(M=>{M.value===V?M.setAttribute("selected",""):M.removeAttribute("selected")})}});const C=y.querySelector("#gearListCage");if(C&&C.options){const O=h?h.querySelector("#gearListCage"):null,B=O?O.value:C.value;Array.from(C.options).forEach($=>{$.value===B?$.setAttribute("selected",""):$.removeAttribute("selected")})}const A=y.querySelector("#gearListEasyrig");if(A&&A.options){const O=h?h.querySelector("#gearListEasyrig"):null,B=O?O.value:A.value;Array.from(A.options).forEach($=>{$.value===B?$.setAttribute("selected",""):$.removeAttribute("selected")})}const w=y.querySelector("#gearListSliderBowl");if(w&&w.options){const O=h?h.querySelector("#gearListSliderBowl"):null,B=O?O.value:w.value;Array.from(w.options).forEach($=>{$.value===B?$.setAttribute("selected",""):$.removeAttribute("selected")})}y.querySelectorAll("select[data-monitor-battery-key]").forEach(O=>{if(!O.id||!O.options)return;const B=h?h.querySelector(`#${O.id}`):null,$=B?B.value:O.value;Array.from(O.options).forEach(V=>{V.value===$?V.setAttribute("selected",""):V.removeAttribute("selected")})});const _=y.querySelector("#gearListEyeLeatherColor");if(_&&_.options){const O=h?h.querySelector("#gearListEyeLeatherColor"):null,B=O?O.value:_.value;Array.from(_.options).forEach($=>{$.value===B?$.setAttribute("selected",""):$.removeAttribute("selected")})}[1,2].forEach(O=>{const B=y.querySelector(`#gearListProGaffColor${O}`);if(B&&B.options){const V=h?h.querySelector(`#gearListProGaffColor${O}`):null,M=V?V.value:B.value;Array.from(B.options).forEach(F=>{F.value===M?F.setAttribute("selected",""):F.removeAttribute("selected")})}const $=y.querySelector(`#gearListProGaffWidth${O}`);if($&&$.options){const V=h?h.querySelector(`#gearListProGaffWidth${O}`):null,M=V?V.value:$.value;Array.from($.options).forEach(F=>{F.value===M?F.setAttribute("selected",""):F.removeAttribute("selected")})}}),y.querySelectorAll('input[type="checkbox"]').forEach(O=>{O.checked?O.setAttribute("checked",""):O.removeAttribute("checked")}),y.querySelectorAll("[data-gear-custom-input]").forEach(O=>{O&&typeof O.getAttribute=="function"&&O.setAttribute("value",O.value)}),t||convertCustomItemsForStaticOutput(y);const G=y.querySelector(".gear-table");l=G?"<h3>Gear List</h3>"+G.outerHTML:""}if(!s&&!l)return r;const u=safeGetCurrentProjectName$1(),m=`${u?`<h2>${u}</h2>`:""}${s}${l}`.trim();return m&&o&&(o.__cineLastGearListHtml=m),m||r}function getGearListSelectors(){const e={},t=a=>{if(!(!a||!a.id))if(a.multiple){const s=a.selectedOptions&&typeof a.selectedOptions.length=="number"?Array.from(a.selectedOptions):Array.from(a.options||[]).filter(l=>l.selected);e[a.id]=s.map(l=>l.value)}else e[a.id]=a.value},o=(function(){if(gearListOutput&&typeof gearListOutput.querySelectorAll=="function")return gearListOutput;if(typeof document<"u"&&document){const s=document.getElementById("gearListOutput");if(s&&typeof s.querySelectorAll=="function")return s}return null})();o&&o.querySelectorAll("select[id]").forEach(a=>{t(a)});const r=typeof filterDetailsStorage<"u"?filterDetailsStorage:null;r&&typeof r.querySelectorAll=="function"&&r.querySelectorAll("select[id]").forEach(a=>{!a||!a.id||Object.prototype.hasOwnProperty.call(e,a.id)||t(a)});const n=readCustomItemsState();if(n&&Object.keys(n).length&&(e.__customItems=n),o){const a={};o.querySelectorAll(".gear-item[data-gear-name]").forEach(s=>{const l=getGearItemDisplayName(s)||s.getAttribute("data-gear-name");if(!l)return;const u={};let d=!1;const m=(y,h,b=!1)=>{const v=s.getAttribute(y);v!=null&&v!==""&&(u[h]=b?v==="true":v,d=!0)};m("data-gear-quantity","quantity"),m("data-gear-label","name"),m("data-gear-attributes","attributes"),m("data-gear-note","note"),m("data-rental-excluded","rentalExcluded",!0),m("data-gear-provider","providedBy"),m("data-gear-provider-label","providerLabel"),m("data-gear-extra","extra",!0),m("data-gear-extra-start","extraStart"),m("data-gear-extra-end","extraEnd"),m("data-gear-camera-link","cameraLink"),m("data-gear-camera-link-label","cameraLinkLabel"),d&&(a[l]=u)}),Object.keys(a).length>0&&(e.__gearItemOverrides=a)}return e}function cloneGearListSelectors(e){if(!e||typeof e!="object")return{};const t=r=>{if(Array.isArray(r))return r.map(n=>t(n));if(r&&typeof r=="object"){const n={};return Object.entries(r).forEach(([a,s])=>{n[a]=t(s)}),n}return r==null?"":typeof r=="string"?r:String(r)},o={};return Object.entries(e).forEach(([r,n])=>{!r||typeof r!="string"||(o[r]=t(n))}),o}function convertCustomItemsForStaticOutput(e){if(!e)return;const t=e.ownerDocument||(typeof document<"u"?document:null);if(!t||(typeof e.isConnected=="boolean"?e.isConnected:typeof t.contains=="function"&&t.contains(e)))return;e.querySelectorAll(".gear-custom-section").forEach(n=>{const a=n.querySelector(".gear-custom-items"),s=n.parentElement;if(!a||!s){n.remove();return}n.querySelectorAll(".gear-rental-toggle").forEach(m=>m.remove());const u=Array.from(a.querySelectorAll(".gear-custom-item-preview")).map(m=>({preview:m,value:(m.textContent||"").replace(/\s+/g," ").trim()})).filter(m=>m.value);let d=n.previousElementSibling;(!d||!d.classList.contains("gear-standard-items"))&&(d=t.createElement("div"),d.className="gear-standard-items",s.insertBefore(d,n)),u.length&&u.forEach(({value:m,preview:y})=>{if(d.childNodes.length){const v=d.lastChild;v&&v.nodeType===1&&v.tagName==="BR"||d.appendChild(t.createElement("br"))}const h=t.createElement("span");h.className="gear-item",h.textContent=m,h.setAttribute("data-gear-name",m),h.setAttribute("data-gear-custom-output","true");const b=y.closest(".gear-custom-item");if(b){const v=b.getAttribute("data-rental-note");v&&h.setAttribute("data-rental-note",v),b.getAttribute("data-rental-excluded")==="true"&&(h.setAttribute("data-rental-excluded","true"),h.classList.add("gear-item-rental-excluded"))}d.appendChild(h)}),n.remove()}),e.querySelectorAll(".gear-custom-add-btn").forEach(n=>n.remove()),e.querySelectorAll(".gear-rental-toggle").forEach(n=>n.remove()),e.querySelectorAll(".gear-item-edit-btn").forEach(n=>n.remove()),e.querySelectorAll(".gear-custom-item-actions").forEach(n=>n.remove())}function cloneProjectInfoForStorage(e){if(e==null)return null;if(typeof e!="object")return e;if(typeof SETUPS_DEEP_CLONE=="function")try{return SETUPS_DEEP_CLONE(e)}catch(o){console.warn("Failed to clone project info for storage",o)}if(Array.isArray(e))return e.map(o=>cloneProjectInfoForStorage(o));const t={};return Object.keys(e).forEach(o=>{t[o]=cloneProjectInfoForStorage(e[o])}),t}function hasMeaningfulProjectInfoValue(e){return e==null?!1:typeof e=="string"?e.trim().length>0:typeof e=="number"?!Number.isNaN(e):typeof e=="boolean"?e:Array.isArray(e)?e.some(t=>hasMeaningfulProjectInfoValue(t)):typeof e=="object"?Object.values(e).some(t=>hasMeaningfulProjectInfoValue(t)):!1}function mergeProjectInfoSnapshots(e,t){const o=hasMeaningfulProjectInfoValue(e);if(!hasMeaningfulProjectInfoValue(t))return cloneProjectInfoForStorage(o?e:t);if(!o)return cloneProjectInfoForStorage(t);if(Array.isArray(e)&&Array.isArray(t))return cloneProjectInfoForStorage(t.length?t:e);if(typeof e=="object"&&typeof t=="object"){const n=cloneProjectInfoForStorage(e);return Object.keys(t).forEach(a=>{n[a]=mergeProjectInfoSnapshots(n[a],t[a])}),n}return cloneProjectInfoForStorage(t)}function normalizeRequirementNodeValue(e){if(!e)return"";const t=typeof Node>"u"?3:Node.TEXT_NODE,o=typeof Node>"u"?1:Node.ELEMENT_NODE;return e.nodeType===t?e.textContent||"":e.nodeType===o?(e.tagName?e.tagName.toLowerCase():"")==="br"?`
`:Array.from(e.childNodes||[]).map(normalizeRequirementNodeValue).join(""):""}function collectProjectInfoFromRequirementsGrid(){if(!projectRequirementsOutput)return null;const e=projectRequirementsOutput&&typeof projectRequirementsOutput.querySelectorAll=="function"?Array.from(projectRequirementsOutput.querySelectorAll(".requirement-box")):[];if(!e.length)return null;const t={},o=texts[currentLang]?.projectFields||texts.en?.projectFields||{};return e.forEach(r=>{if(!r||typeof r.getAttribute!="function")return;const n=r.getAttribute("data-field");if(!n)return;const a=r.querySelector(".req-value");if(!a)return;const l=Array.from(a.childNodes||[]).map(normalizeRequirementNodeValue).join("").replace(/\r\n?/g,`
`).split(`
`).map(d=>d.replace(/\s+/g," ").trim()).filter(d=>d);if(!l.length)return;const u=l.join(`
`);if(Object.prototype.hasOwnProperty.call(t,n)||(t[n]=u),n==="productionCompany"){let d=null;const m=Array.from(a.querySelectorAll(".req-sub-line"));if(m.length){const h=m.map(b=>{if(!b||typeof b.textContent!="string")return null;const v=b.textContent.replace(/\s+/g," ").trim();if(!v)return null;const A=(typeof b.getAttribute=="function"&&(b.getAttribute("data-fields")||b.getAttribute("data-field"))||"").split(/\s+/).map(w=>w.trim()).filter(w=>w);return{text:v,fields:A}}).filter(b=>b);h.length&&(d={lines:h})}const y=expandCombinedProductionCompanyInfo(u,o,d);y&&typeof y=="object"&&Object.entries(y).forEach(([h,b])=>{if(h==="productionCompany"){t.productionCompany=b;return}Object.prototype.hasOwnProperty.call(t,h)||(t[h]=b)})}}),Object.keys(t).length?t:null}function normalizeProjectStorageNameForCollision(e){return typeof e!="string"?"":e.trim().toLowerCase()}let pendingProjectNameCollisionResolution=null;function clearPendingProjectNameCollisionResolution(e){if(!pendingProjectNameCollisionResolution)return;if(!e){pendingProjectNameCollisionResolution=null;return}const t=normalizeProjectStorageNameForCollision(e);(!t||pendingProjectNameCollisionResolution.base===t)&&(pendingProjectNameCollisionResolution=null)}function getPendingProjectNameCollisionResolution(e){if(!pendingProjectNameCollisionResolution)return null;const t=normalizeProjectStorageNameForCollision(e);return t&&pendingProjectNameCollisionResolution.base===t?pendingProjectNameCollisionResolution.resolved:null}function rememberPendingProjectNameCollisionResolution(e,t){const o=normalizeProjectStorageNameForCollision(e),r=normalizeProjectStorageNameForCollision(t);if(!o||!r){pendingProjectNameCollisionResolution=null;return}pendingProjectNameCollisionResolution={base:o,resolved:t,resolvedNormalized:r}}function resolveProjectStorageNameCollision(e){const t=typeof e=="string"?e.trim():"";if(console.log("DEBUG: resolveProjectStorageNameCollision ENTERED with:",t),!t)return{name:t,changed:!1};if(typeof loadProject!="function")return{name:t,changed:!1};let o;try{o=loadProject()}catch(h){console.warn("Unable to inspect existing projects while resolving name collision",h),o=null}if(!o||typeof o!="object")return{name:t,changed:!1};const r=new Set(Object.keys(o).map(h=>typeof h=="string"?h.trim().toLowerCase():"").filter(h=>h)),n=t.toLowerCase();if(!r.has(n))return{name:t,changed:!1};let a=t,s=1;const l=t.match(/^(.*)\s+\((\d+)\)$/);if(l){a=l[1];const h=parseInt(l[2],10);isNaN(h)||(s=h)}let u=s+1,d=`${a} (${u})`,m=d.trim().toLowerCase();console.log("DEBUG: resolveProjectStorageNameCollision starting loop for:",d);let y=0;for(;r.has(m);){if(y++,console.log("DEBUG: resolveProjectStorageNameCollision iteration:",y,"Candidate:",m),y>100){console.error("DEBUG: resolveProjectStorageNameCollision INFINITE LOOP DETECTED for:",a);const h=()=>globalThis.crypto&&typeof globalThis.crypto.randomUUID=="function"?globalThis.crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,8)}`;do{const b=h();d=`${a} (${b})`,m=d.trim().toLowerCase(),y++}while(r.has(m));break}u+=1,d=`${a} (${u})`,m=d.trim().toLowerCase()}for(;r.has(m);){const h=globalThis.crypto&&typeof globalThis.crypto.randomUUID=="function"?globalThis.crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,8)}`;d=`${a} (${h})`,m=d.trim().toLowerCase()}return console.log("DEBUG: resolveProjectStorageNameCollision returning:",d),{name:d,changed:!0}}function doesProjectNameExist(e){if(typeof loadProject!="function")return!1;const t=normalizeProjectStorageNameForCollision(e);if(!t)return!1;let o=null;try{o=loadProject()}catch(r){return console.warn("Unable to inspect project names while deferring collision resolution",r),!1}return!o||typeof o!="object"?!1:Object.keys(o).some(r=>normalizeProjectStorageNameForCollision(r)===t)}const sessionCreatedProjects=new Set;let saveGearListDebounceTimer=null;function saveCurrentGearList$1(){saveGearListDebounceTimer&&clearTimeout(saveGearListDebounceTimer),saveGearListDebounceTimer=setTimeout(()=>{saveCurrentGearListImplementation()},300)}let isSavingGearList=!1;function saveCurrentGearListImplementation(){if(!isSavingGearList&&!factoryResetInProgress&&!(typeof restoringSession<"u"&&restoringSession)){isSavingGearList=!0;try{const e=gearListGetCurrentHtmlImpl({forPersistence:!0}),t=typeof e=="string"?e.trim():"",o=!!t,r=projectForm?collectProjectFormData$1():{};r.sliderBowl=getSetupsCoreValue("getSliderBowlValue"),r.easyrig=getSetupsCoreValue("getEasyrigValue");const n=currentProjectInfo&&typeof currentProjectInfo=="object"?currentProjectInfo:null,a=!!(projectRequirementsOutput&&typeof projectRequirementsOutput.querySelector=="function"&&projectRequirementsOutput.querySelector(".requirement-box"));let s=deriveProjectInfo$1(r);const l=getPowerSelectionSnapshot$1(),u=getGearListSelectors(),d=cloneGearListSelectors(u),m=Object.keys(d).length>0;let y=typeof getSetupNameState=="function"?getSetupNameState():null;if(typeof getProjectAutoSaveOverrides=="function"){const rt=getProjectAutoSaveOverrides();if(rt&&typeof rt=="object"&&rt.setupNameState&&typeof rt.setupNameState=="object"){const Pt=ue=>typeof ue=="string"?ue.trim():"",vt=rt.setupNameState,bo=Pt(vt.typedName),Et=Pt(vt.selectedName),Ut=Pt(typeof vt.storageKey=="string"?vt.storageKey:Et||bo),ge=typeof vt.renameInProgress=="boolean"?vt.renameInProgress:!!(Et&&bo&&bo!==Et);y={typedName:bo,selectedName:Et,storageKey:Ut,renameInProgress:ge,typedNameHasTrailingWhitespace:!!(bo&&vt&&typeof vt.typedNameHasTrailingWhitespace=="boolean"&&vt.typedNameHasTrailingWhitespace)}}}const h=rt=>typeof rt!="string"?"":rt.trim(),b=setupNameInput&&typeof setupNameInput.value=="string"?setupNameInput.value:"",v=!!(b&&b.trim()&&/\s$/.test(b));let C=y?y.selectedName:h(setupSelect&&typeof setupSelect.value=="string"?setupSelect.value:""),A=y?y.typedName:h(setupNameInput&&typeof setupNameInput.value=="string"?setupNameInput.value:""),w=y?y.storageKey:C||A;const R=y?y.renameInProgress:!!(C&&A&&C!==A),_=y&&typeof y=="object"?!!(y.typedNameHasTrailingWhitespace&&y.typedName):v;let G=R&&C||w;if(!!(_&&!R&&!C&&typeof G=="string"&&G&&doesProjectNameExist(G))){clearPendingProjectNameCollisionResolution(G);return}if(!R&&!C&&typeof G=="string"&&G){const rt=getPendingProjectNameCollisionResolution(G);if(rt&&rt!==G)G=rt;else if(!rt){let Pt=!1;sessionCreatedProjects.has(G)&&(Pt=!0);const vt=Pt?{changed:!1,name:G}:resolveProjectStorageNameCollision(G);vt.changed&&vt.name&&vt.name!==G?(rememberPendingProjectNameCollisionResolution(G,vt.name),G=vt.name):vt.changed||clearPendingProjectNameCollisionResolution(G)}}else clearPendingProjectNameCollisionResolution();if(!s&&a){if(n&&Object.keys(n).length)s=n;else if(typeof loadProject=="function"){const rt=typeof G=="string"?G:typeof w=="string"&&w?w:typeof C=="string"?C:"";if(typeof rt=="string"){const Pt=loadProject(rt);Pt&&Pt.projectInfo&&Object.keys(Pt.projectInfo).length&&(s=cloneProjectInfoForStorage(Pt.projectInfo))}}if(!s){const rt=collectProjectInfoFromRequirementsGrid();rt&&(s=deriveProjectInfo$1(rt)||rt)}}currentProjectInfo=s;const B=typeof createProjectInfoSnapshotForStorage=="function"?createProjectInfoSnapshotForStorage(currentProjectInfo,{projectNameOverride:R?C||w:void 0}):currentProjectInfo,$=cloneProjectInfoForStorage(B),V=$?stableStringify($):"",M=$?cloneProjectInfoForStorage($):null,F=getProjectScopedAutoGearRules(),z=F&&F.length?cloneProjectInfoForStorage(F):null,x=z?cloneProjectInfoForStorage(z):null;let H=null,W=null;if(typeof getDiagramManualPositions=="function"){const rt=getDiagramManualPositions();rt&&Object.keys(rt).length&&(H=cloneProjectInfoForStorage(rt),W=cloneProjectInfoForStorage(H))}if(typeof saveProject=="function"&&typeof G=="string"){typeof setActiveProjectCompressionHold=="function"&&setActiveProjectCompressionHold(G);const rt={projectInfo:$,gearListAndProjectRequirementsGenerated:o};l&&(rt.powerSelection=l),m&&(rt.gearSelectors=d),H&&(rt.diagramPositions=H),z&&z.length&&(rt.autoGearRules=z),saveProject(G,rt,{skipOverwriteBackup:!0}),sessionCreatedProjects.add(G)}const U=C||G;if(!U)return;const j=getSetups$1(),Y=j[U];if(!Y&&!e&&!currentProjectInfo&&!(z&&z.length)&&!H)return;const le=Y||{};let be=!1;if(le.gearListAndProjectRequirementsGenerated!==o&&(le.gearListAndProjectRequirementsGenerated=o,be=!0),le.gearList!==t&&(le.gearList=t,be=!0),V){const rt=le.projectInfo;(rt?stableStringify(rt):"")!==V&&(le.projectInfo=M,be=!0)}else $===null?le.projectInfo!==null&&(le.projectInfo=null,be=!0):Object.prototype.hasOwnProperty.call(le,"projectInfo")&&(delete le.projectInfo,be=!0);if(W){const rt=le.diagramPositions?stableStringify(le.diagramPositions):"",Pt=stableStringify(W);rt!==Pt&&(le.diagramPositions=W,be=!0)}else Object.prototype.hasOwnProperty.call(le,"diagramPositions")&&(delete le.diagramPositions,be=!0);const re=le.autoGearRules,de=re&&re.length?stableStringify(re):"",ne=z&&z.length?stableStringify(z):"";ne?de!==ne&&(le.autoGearRules=x,be=!0):Object.prototype.hasOwnProperty.call(le,"autoGearRules")&&(delete le.autoGearRules,be=!0);const Ce=le.gearSelectors,Ee=Ce?stableStringify(Ce):"",Pe=m?stableStringify(d):"";Pe?Ee!==Pe&&(le.gearSelectors=d,be=!0):Object.prototype.hasOwnProperty.call(le,"gearSelectors")&&(delete le.gearSelectors,be=!0);const et=le.powerSelection?stableStringify(le.powerSelection):"",Je=l?stableStringify(l):"";Je?et!==Je&&(le.powerSelection=l,be=!0):Object.prototype.hasOwnProperty.call(le,"powerSelection")&&(delete le.powerSelection,be=!0);const it=C||G;return it&&(Y?be&&(j[it]=le,storeSetups(j)):(j[it]=le,storeSetups(j))),be}finally{isSavingGearList=!1}}}function deleteCurrentGearList$1(){const e=()=>{const t=ensureAutoBackupBeforeDeletion("delete gear list");if(!t)return!1;const o=getCurrentProjectStorageKey();typeof deleteProject=="function"?deleteProject(o):typeof saveProject=="function"&&saveProject(o,{projectInfo:null,gearListAndProjectRequirementsGenerated:!1},{skipOverwriteBackup:!0});const r=getSetups$1();if(r&&typeof r=="object"){const n=r[o];if(n&&typeof n=="object"){let a=!1;Object.prototype.hasOwnProperty.call(n,"gearList")&&(delete n.gearList,a=!0),["projectInfo","autoGearRules","diagramPositions","powerSelection","gearSelectors","gearListAndProjectRequirementsGenerated"].forEach(s=>{Object.prototype.hasOwnProperty.call(n,s)&&(delete n[s],a=!0)}),a&&storeSetups(r)}}if(gearListOutput&&(gearListOutput.innerHTML="",gearListOutput.classList.add("hidden"),updateAutoGearHighlightToggleButton()),projectRequirementsOutput&&(projectRequirementsOutput.innerHTML="",projectRequirementsOutput.classList.add("hidden")),typeof globalThis<"u"&&(globalThis.__cineLastGearListHtml=""),currentProjectInfo=null,projectForm&&populateProjectForm$1({}),storeSession({setupName:setupNameInput?setupNameInput.value:"",setupSelect:setupSelect?setupSelect.value:"",camera:cameraSelect?cameraSelect.value:"",monitor:monitorSelect?monitorSelect.value:"",video:videoSelect?videoSelect.value:"",cage:cageSelect?cageSelect.value:"",motors:motorSelects.map(n=>n?n.value:""),controllers:controllerSelects.map(n=>n?n.value:""),distance:distanceSelect?distanceSelect.value:"",batteryPlate:normalizeBatteryPlateValue(batteryPlateSelect?batteryPlateSelect.value:"",batterySelect?batterySelect.value:""),battery:batterySelect?batterySelect.value:"",batteryHotswap:hotswapSelect?hotswapSelect.value:"",sliderBowl:getSetupsCoreValue("getSliderBowlValue"),easyrig:getSetupsCoreValue("getEasyrigValue"),projectInfo:null}),typeof autoSaveCurrentSetup=="function"&&(autoSaveCurrentSetup(),o)){const n=getSetups$1(),a=n&&n[o];if(a&&typeof a=="object"){let s=!1;Object.prototype.hasOwnProperty.call(a,"gearList")&&(delete a.gearList,s=!0),["projectInfo","gearListAndProjectRequirementsGenerated","gearSelectors"].forEach(l=>{Object.prototype.hasOwnProperty.call(a,l)&&(delete a[l],s=!0)}),s&&storeSetups(n)}}if(currentProjectInfo=null,updateGearListButtonVisibility(),typeof document<"u"&&typeof document.dispatchEvent=="function"){const n={projectName:o,backupName:t,source:"deleteCurrentGearList"};try{document.dispatchEvent(new CustomEvent("gearlist:deleted",{detail:n}))}catch(a){if(typeof document.createEvent=="function"){const s=document.createEvent("CustomEvent");s.initCustomEvent("gearlist:deleted",!1,!1,n),document.dispatchEvent(s)}else console.warn("Unable to dispatch gearlist:deleted event",a)}}return!0};if(typeof window.cineShowConfirmDialog=="function")window.cineShowConfirmDialog({title:typeof texts<"u"&&texts[currentLang]&&texts[currentLang].deleteGearListTitle||"Delete Gear List",message:texts[currentLang].confirmDeleteGearList,confirmLabel:"Delete",danger:!0,onConfirm:()=>{setTimeout(()=>{window.cineShowConfirmDialog({title:typeof texts<"u"&&texts[currentLang]&&texts[currentLang].areYouSure||"Are you sure?",message:texts[currentLang].confirmDeleteGearListAgain,confirmLabel:"Confirm Delete",danger:!0,onConfirm:()=>e()})},150)}});else return!confirm(texts[currentLang].confirmDeleteGearList)||!confirm(texts[currentLang].confirmDeleteGearListAgain)?!1:e()}const AUTO_GEAR_HIGHLIGHT_CLASS="show-auto-gear-highlight",AUTO_GEAR_HIGHLIGHT_CONTEXT_CLASS="auto-gear-highlight-context",ONBOARD_MONITOR_RIGGING_ITEM_NAME='ULCS Arm mit 3/8" und 1/4" double',ONBOARD_MONITOR_RIGGING_ITEM_ID="autoGearMonitorRiggingItem",ONBOARD_MONITOR_RIGGING_RULE_ID="autoGearMonitorRiggingHighlight",AUTO_GEAR_HIGHLIGHT_ICON="",AUTO_GEAR_HIGHLIGHT_LABEL_FALLBACK="Highlight automatic gear",AUTO_GEAR_HIGHLIGHT_HELP_FALLBACK="Toggle a temporary color overlay for gear added by automatic rules. Useful while debugging gear rule behavior.",AUTO_GEAR_HIGHLIGHT_STATE_ON_FALLBACK="On",AUTO_GEAR_HIGHLIGHT_STATE_OFF_FALLBACK="Off",AUTO_GEAR_RULE_BADGE_NAMED_FALLBACK="Rule: %s",AUTO_GEAR_RULE_BADGE_UNNAMED_FALLBACK="Automatic rule",AUTO_GEAR_RULE_COLOR_PALETTE=Object.freeze([{bg:"rgba(255, 210, 64, 0.35)",border:"rgba(255, 181, 0, 0.7)"},{bg:"rgba(88, 200, 255, 0.32)",border:"rgba(0, 146, 214, 0.65)"},{bg:"rgba(146, 232, 129, 0.32)",border:"rgba(70, 180, 80, 0.65)"},{bg:"rgba(255, 186, 222, 0.32)",border:"rgba(230, 112, 190, 0.65)"},{bg:"rgba(255, 214, 153, 0.32)",border:"rgba(230, 156, 64, 0.65)"},{bg:"rgba(201, 186, 255, 0.32)",border:"rgba(146, 118, 230, 0.65)"},{bg:"rgba(152, 219, 217, 0.32)",border:"rgba(72, 182, 178, 0.65)"}]);function getAutoGearRuleColorKey(e,t){if(e&&typeof e=="object"){const o=typeof e.id=="string"?e.id.trim():"";if(o)return`id:${o.toLowerCase()}`;const r=getAutoGearRuleDisplayLabel(e);if(r)return`label:${r.toLowerCase()}`}if(t&&typeof t=="object"){const o=typeof t.autoGearRuleId=="string"?t.autoGearRuleId.trim():"";if(o)return`id:${o.toLowerCase()}`;const r=typeof t.autoGearRuleLabel=="string"?t.autoGearRuleLabel.trim():"";if(r)return`label:${r.toLowerCase()}`}return""}function getAutoGearRuleColorEntry(e,t){if(!AUTO_GEAR_RULE_COLOR_PALETTE.length)return null;const o=getAutoGearRuleColorKey(e,t);if(!o)return{...AUTO_GEAR_RULE_COLOR_PALETTE[0],index:0};let r=0;for(let s=0;s<o.length;s+=1)r=r*31+o.charCodeAt(s)&2147483647;const n=Math.abs(r)%AUTO_GEAR_RULE_COLOR_PALETTE.length;return{...AUTO_GEAR_RULE_COLOR_PALETTE[n]||AUTO_GEAR_RULE_COLOR_PALETTE[0],index:n}}function applyAutoGearRuleColors(e,t){if(!e||!e.style)return;const o=e.dataset||{},r=getAutoGearRuleColorEntry(t,o);if(!r){e.style.removeProperty("--auto-gear-rule-bg"),e.style.removeProperty("--auto-gear-rule-border"),e.style.removeProperty("--auto-gear-rule-text"),o&&Object.prototype.hasOwnProperty.call(o,"autoGearRuleColor")&&delete o.autoGearRuleColor;return}const{bg:n,border:a,text:s,index:l}=r;if(n?e.style.setProperty("--auto-gear-rule-bg",n):e.style.removeProperty("--auto-gear-rule-bg"),a?e.style.setProperty("--auto-gear-rule-border",a):e.style.removeProperty("--auto-gear-rule-border"),s?e.style.setProperty("--auto-gear-rule-text",s):e.style.removeProperty("--auto-gear-rule-text"),o)try{e.dataset.autoGearRuleColor=String(l)}catch(u){console.warn("Failed to annotate automatic gear color index",u)}}function getAutoGearRuleBadgeTemplates(){const e=texts[currentLang]||texts.en||{},t=e.autoGearRuleBadgeNamed||texts.en?.autoGearRuleBadgeNamed||AUTO_GEAR_RULE_BADGE_NAMED_FALLBACK,o=e.autoGearRuleBadgeUnnamed||texts.en?.autoGearRuleBadgeUnnamed||AUTO_GEAR_RULE_BADGE_UNNAMED_FALLBACK;return{named:t,unnamed:o}}function formatAutoGearRuleBadgeText(e,t){const{named:o,unnamed:r}=getAutoGearRuleBadgeTemplates(),n=typeof e=="string"?e.trim():"";if(n)return o.replace("%s",n);const a=typeof t=="string"?t.trim():"";return a?o.replace("%s",a):r}function refreshAutoGearRuleBadge(e){if(!e||!e.classList||!e.classList.contains("auto-gear-item"))return;const t=getAutoGearRuleSources(e);setAutoGearRuleSources(e,t),applyAutoGearRuleColors(e);const o=t.map(a=>formatAutoGearRuleBadgeText(a.label,a.id)).filter(Boolean),r=Array.from(e.querySelectorAll(".auto-gear-rule-badge"));if(!o.length){r.forEach(s=>s.remove()),e.dataset&&Object.prototype.hasOwnProperty.call(e.dataset,"autoGearRuleBadge")&&delete e.dataset.autoGearRuleBadge;const a=buildAutoGearRuleTooltipFromSources(t);a?e.title=a:e.removeAttribute("title");return}if(o.forEach((a,s)=>{let l=r[s];l||(l=document.createElement("span"),l.className="auto-gear-rule-badge",e.appendChild(l)),l.textContent=a}),r.length>o.length&&r.slice(o.length).forEach(a=>a.remove()),e.dataset)try{e.dataset.autoGearRuleBadge=JSON.stringify(o)}catch(a){console.warn("Failed to serialize automatic gear rule badge labels",a)}const n=buildAutoGearRuleTooltipFromSources(t);n?e.title=n:e.removeAttribute("title")}function updateAutoGearRuleBadges(e){const t=e||gearListOutput;if(!t||typeof t.querySelectorAll!="function")return;t.querySelectorAll(".auto-gear-item").forEach(r=>refreshAutoGearRuleBadge(r))}function getAutoGearHighlightLabel(){const e=typeof getLocalizedText=="function"?getLocalizedText("autoGearHighlightToggle"):"";return typeof e=="string"&&e.trim()?e.trim():AUTO_GEAR_HIGHLIGHT_LABEL_FALLBACK}function getAutoGearHighlightHelp(){const e=typeof getLocalizedText=="function"?getLocalizedText("autoGearHighlightToggleHelp"):"";return typeof e=="string"&&e.trim()?e.trim():AUTO_GEAR_HIGHLIGHT_HELP_FALLBACK}function isAutoGearHighlightEnabled$1(){return!!(gearListOutput&&gearListOutput.classList&&gearListOutput.classList.contains(AUTO_GEAR_HIGHLIGHT_CLASS))}function canHighlightAutoGear(){return!gearListOutput||!gearListOutput.classList?!1:!gearListOutput.classList.contains("hidden")}function ensureAutoGearHighlightToggleStructure(e){if(!e)return null;e.classList.add("auto-gear-highlight-toggle","gear-list-action-btn");const t="auto-gear-highlight-icon";let o=e.querySelector(`.${t}`);o?(o.classList.contains("btn-icon")||o.classList.add("btn-icon"),o.classList.contains("icon-glyph")||o.classList.add("icon-glyph"),o.classList.contains(t)||o.classList.add(t),o.setAttribute("aria-hidden","true"),o.setAttribute("data-icon-font","uicons"),o.textContent!==AUTO_GEAR_HIGHLIGHT_ICON&&(o.textContent=AUTO_GEAR_HIGHLIGHT_ICON)):(o=document.createElement("span"),o.className=`btn-icon icon-glyph ${t}`,o.setAttribute("aria-hidden","true"),o.setAttribute("data-icon-font","uicons"),o.textContent=AUTO_GEAR_HIGHLIGHT_ICON,e.firstChild?e.insertBefore(o,e.firstChild):e.appendChild(o));let r=e.querySelector(".auto-gear-highlight-label");r||(r=document.createElement("span"),r.className="auto-gear-highlight-label",e.appendChild(r));let n=e.querySelector(".auto-gear-highlight-state");return n||(n=document.createElement("span"),n.className="auto-gear-highlight-state",typeof r.after=="function"?r.after(n):e.appendChild(n)),n&&(n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true")),Array.from(e.childNodes||[]).filter(s=>s&&s.nodeType===3&&s.textContent&&s.textContent.trim().length).forEach(s=>{e.removeChild(s)}),n&&typeof r<"u"&&r&&n.previousElementSibling!==r&&typeof r.after=="function"&&r.after(n),{label:r,state:n}}function getAutoGearHighlightStateText(e){const t=e?"autoGearHighlightToggleStateOn":"autoGearHighlightToggleStateOff",o=e?AUTO_GEAR_HIGHLIGHT_STATE_ON_FALLBACK:AUTO_GEAR_HIGHLIGHT_STATE_OFF_FALLBACK,r=typeof getLocalizedText=="function"?getLocalizedText(t):"";return typeof r=="string"&&r.trim()?r.trim():o}function applyAutoGearHighlightContext(e){if(typeof document>"u")return;const t=!!e;[document.documentElement,document.body,document.getElementById("autoGearDraftImpact")].forEach(r=>{r&&r.classList&&r.classList.toggle(AUTO_GEAR_HIGHLIGHT_CONTEXT_CLASS,t)})}function setAutoGearHighlightEnabled$1(e){const t=!!e;gearListOutput&&gearListOutput.classList&&gearListOutput.classList.toggle(AUTO_GEAR_HIGHLIGHT_CLASS,t),updateAutoGearHighlightToggleButton()}function updateAutoGearHighlightToggleButton(){const e=document.getElementById("autoGearHighlightToggle");if(!e)return;const t=getAutoGearHighlightLabel(),o=getAutoGearHighlightHelp(),r=ensureAutoGearHighlightToggleStructure(e),n=r&&r.label,a=r&&r.state;n?n.textContent=t:typeof e.textContent=="string"?e.textContent=t:e.innerHTML=escapeHtml$2(t),e.setAttribute("title",o),e.setAttribute("data-help",o),e.setAttribute("aria-label",o);const s=isAutoGearHighlightEnabled$1();applyAutoGearHighlightContext(s);const l=getAutoGearHighlightStateText(s);a&&(a.textContent=l,a.setAttribute("data-state",s?"on":"off")),e.setAttribute("data-state",s?"on":"off"),e.setAttribute("data-state-label",l),e.setAttribute("aria-pressed",s?"true":"false"),e.classList.toggle("is-active",s);const u=canHighlightAutoGear();e.disabled=!u,u?e.removeAttribute("aria-disabled"):e.setAttribute("aria-disabled","true"),updateAutoGearRuleBadges(gearListOutput)}function collectCurrentGearModifications(){if(!gearListOutput)return{items:{},customItems:[]};const e={items:{},customItems:[]};try{gearListOutput.querySelectorAll(".gear-custom-item").forEach(r=>{const n=r.getAttribute("data-gear-custom-entry"),a=r.closest(".gear-custom-section"),s=a?a.getAttribute("data-gear-custom-category"):"";if(typeof getGearItemData=="function"){const l=getGearItemData(r);e.customItems.push({categoryKey:n,categoryLabel:s,data:l})}}),gearListOutput.querySelectorAll(".gear-item:not(.gear-custom-item)").forEach(r=>{if(typeof getGearItemData=="function"&&typeof getGearItemResetDefaults=="function"){const n=getGearItemData(r),a=getGearItemResetDefaults(r),s=a.name;if(!s)return;(n.quantity!==a.quantity||n.name!==a.name||n.attributes!==a.attributes||n.note||n.rentalExcluded||n.providedBy&&n.providedBy!==(typeof guessDefaultProvider=="function"?guessDefaultProvider(n.name):"")||n.cameraLink&&n.cameraLink!=="A"&&!isPrimaryCameraItem(r))&&(e.items[s]=n)}})}catch(t){typeof console<"u"&&console.warn&&console.warn("Failed to collect current gear list modifications",t)}return e}function applyCurrentGearModifications(e){if(!(!gearListOutput||!e))try{Array.isArray(e.customItems)&&e.customItems.forEach(t=>{typeof addCustomItemEntry=="function"&&addCustomItemEntry(t.categoryKey,t.categoryLabel,t.data,{skipPersist:!0,skipEditDialog:!0,skipFocus:!0})}),e.items&&Object.keys(e.items).length&&gearListOutput.querySelectorAll(".gear-item:not(.gear-custom-item)").forEach(o=>{const r=typeof getGearItemData=="function"?getGearItemData(o):null,n=r?r.name:null;if(n&&e.items[n]){const a=e.items[n];typeof applyGearItemData=="function"&&applyGearItemData(o,a,{skipPreview:!1})}})}catch(t){typeof console<"u"&&console.warn&&console.warn("Failed to apply gear list modifications",t)}}function ensureGearListActions$1(){if(!gearListOutput)return;let e=document.getElementById("gearListActions");e||(e=document.createElement("div"),e.id="gearListActions",gearListOutput.appendChild(e));const t=e.querySelector("#deleteGearListBtn");t&&(t.removeEventListener("click",deleteCurrentGearList$1),t.remove());let o=document.getElementById("gearListAutosaveNote");o?e.contains(o)||e.appendChild(o):(o=document.createElement("p"),o.id="gearListAutosaveNote",o.className="gear-list-autosave-note",e.appendChild(o));const r=texts[currentLang]&&texts[currentLang].gearListAutosaveNote||"",n=typeof r=="string"?r.trim():"";n.length>0?(o.hidden=!1,o.removeAttribute("hidden"),o.textContent=n,o.setAttribute("title",n),o.setAttribute("data-help",n)):(o.textContent="",o.setAttribute("title",""),o.setAttribute("data-help",""),o.hidden=!0);const s=texts[currentLang]&&texts[currentLang].deleteGearListBtn||texts.en&&texts.en.deleteGearListBtn||"Delete Gear List",l=texts[currentLang]&&(texts[currentLang].deleteGearListBtnHelp||texts[currentLang].deleteGearListBtn)||texts.en&&(texts.en.deleteGearListBtnHelp||texts.en.deleteGearListBtn)||s,u=document.createElement("button");if(u.id="deleteGearListBtn",u.type="button",u.className="gear-list-action-btn danger",typeof setButtonLabelWithIconForSetups=="function"&&typeof ICON_GLYPHS=="object")setButtonLabelWithIconForSetups(u,s,ICON_GLYPHS.trash);else{const y=typeof iconMarkup=="function"&&typeof ICON_GLYPHS=="object"?iconMarkup(ICON_GLYPHS.trash,"btn-icon"):"";u.innerHTML=`${y}${escapeHtml$2(s)}`}u.setAttribute("title",l),u.setAttribute("data-help",l),u.setAttribute("aria-label",l),u.setAttribute("data-feature-search","true"),u.setAttribute("data-feature-search-keywords","delete remove clear gear list project"),u.addEventListener("click",deleteCurrentGearList$1),!gearListOutput||gearListOutput.classList.contains("hidden")||gearListOutput.innerHTML.trim()===""?(u.hidden=!0,u.setAttribute("hidden","")):(u.hidden=!1,u.removeAttribute("hidden")),o&&o.parentElement===e?e.insertBefore(u,o):e.appendChild(u);const m=document.getElementById("autoGearHighlightToggle");m&&!m.dataset.gearListHighlightBound&&(m.addEventListener("click",()=>{const y=!isAutoGearHighlightEnabled$1();setAutoGearHighlightEnabled$1(y),typeof saveCurrentSession=="function"&&saveCurrentSession({skipGearList:!0})}),m.dataset.gearListHighlightBound="true"),updateAutoGearHighlightToggleButton(),updateAutoGearRuleBadges(e.closest("#gearListOutput")||gearListOutput),gearListOutput._filterListenerBound||(gearListOutput.addEventListener("change",y=>{const h=y.target;h&&h.matches("select")&&adjustGearListSelectWidth(h);let b=!1;if(h.matches('.filter-values-container input[type="checkbox"]')){const v=h.closest(".filter-values-container"),C=v&&v.getAttribute("data-storage-values"),A=v&&v.querySelector("select");if(h.checked?h.setAttribute("checked",""):h.removeAttribute("checked"),C)syncGearListFilterValue(C,h.value,h.checked);else if(A&&A.options){const w=Array.from(A.options).find(R=>R.value===h.value);w&&(w.selected=h.checked),A.dispatchEvent(new Event("change"))}b=!0}else if(h.matches("select[data-storage-id]")){const v=h.getAttribute("data-storage-id");v&&syncGearListFilterSize(v,h.value),b=!0}else(h.id&&h.id.startsWith("filter-size-")||h.id&&h.id.startsWith("filter-values-")||h.matches("input, select, textarea")&&!h.closest("#gearListActions"))&&(b=!0);b&&(saveCurrentGearList$1(),saveCurrentSession(),checkSetupChanged())}),gearListOutput._filterListenerBound=!0),gearListOutput._inputListenerBound||(gearListOutput.addEventListener("input",y=>{const h=y.target;h&&(h.closest("#gearListActions")||(h.closest(".gear-custom-item")&&updateCustomItemPreview(h.closest(".gear-custom-item")),h.matches("input, textarea")&&(saveCurrentGearList$1(),saveCurrentSession(),checkSetupChanged())))}),gearListOutput._inputListenerBound=!0),gearListOutput._customClickListenerBound||(gearListOutput.addEventListener("click",y=>{const h=y.target&&y.target.closest("[data-gear-edit]");if(h){y.preventDefault();const A=h.closest(".gear-item, .gear-custom-item");A&&openGearItemEditor(A,{allowRentalToggle:!0});return}const b=y.target&&y.target.closest(".gear-rental-toggle");if(b){y.preventDefault();const A=b.closest(".gear-item, .gear-custom-item");if(!A)return;const w=b.getAttribute("aria-pressed")!=="true";setRentalExclusionState(A,w),A.classList&&A.classList.contains("gear-custom-item")?persistCustomItemsChange():(typeof saveCurrentGearList$1=="function"&&saveCurrentGearList$1(),typeof saveCurrentSession=="function"&&saveCurrentSession(),typeof checkSetupChanged=="function"&&checkSetupChanged());return}const v=y.target&&y.target.closest("[data-gear-custom-add]");if(v){y.preventDefault(),handleAddCustomItemRequest(v);return}const C=y.target&&y.target.closest("[data-gear-custom-remove]");C&&(y.preventDefault(),handleRemoveCustomItemRequest(C))}),gearListOutput._customClickListenerBound=!0)}let gearDeleteRequestListenerBound=!1;if(typeof document<"u"&&typeof document.addEventListener=="function"&&!gearDeleteRequestListenerBound){const e=()=>{try{deleteCurrentGearList$1()}catch(t){console.warn("Failed to handle gear list deletion request",t)}};document.addEventListener("gearlist:delete-requested",e),gearDeleteRequestListenerBound=!0}function resolveGearListCageLabel(){const e=typeof localGetLocalizedText=="function"?localGetLocalizedText("category_cages"):"";return(typeof e=="string"?e.trim():"")||"Camera Cage"}function syncGearListCageItem(e){if(!e)return;const t=e.closest(".gear-item");if(!t)return;const o=e.options&&e.selectedIndex>=0?e.options[e.selectedIndex]:null,r=o&&typeof o.text=="string"?o.text.trim():o&&o.textContent?o.textContent.trim():"",n=resolveGearListCageLabel();t.setAttribute("data-gear-quantity","1"),t.setAttribute("data-gear-label",n),t.setAttribute("data-gear-name",n),r?t.setAttribute("data-gear-attributes",r):t.removeAttribute("data-gear-attributes")}function bindGearListCageListener$1(){if(!gearListOutput)return;const e=gearListOutput.querySelector("#gearListCage");e&&(e.addEventListener("change",t=>{typeof restoringSession<"u"&&restoringSession||(cageSelect&&(cageSelect.value=t.target.value,cageSelect.dispatchEvent(new Event("change"))),syncGearListCageItem(e),markProjectFormDataDirty$1(),saveCurrentGearList$1())}),syncGearListCageItem(e))}function bindGearListEasyrigListener$1(){if(!gearListOutput)return;const e=gearListOutput.querySelector("#gearListEasyrig");e&&e.addEventListener("change",()=>{typeof restoringSession<"u"&&restoringSession||(markProjectFormDataDirty$1(),saveCurrentGearList$1(),saveCurrentSession(),checkSetupChanged())})}function bindGearListSliderBowlListener$1(){if(!gearListOutput)return;const e=gearListOutput.querySelector("#gearListSliderBowl");e&&e.addEventListener("change",()=>{typeof restoringSession<"u"&&restoringSession||(markProjectFormDataDirty$1(),saveCurrentGearList$1(),saveCurrentSession(),checkSetupChanged())})}function bindGearListEyeLeatherListener$1(){if(!gearListOutput)return;const e=gearListOutput.querySelector("#gearListEyeLeatherColor");e&&e.addEventListener("change",()=>{typeof restoringSession<"u"&&restoringSession||(markProjectFormDataDirty$1(),saveCurrentGearList$1())})}function bindGearListProGaffTapeListener$1(){gearListOutput&&[1,2].forEach(e=>{const t=gearListOutput.querySelector(`#gearListProGaffColor${e}`),o=gearListOutput.querySelector(`#gearListProGaffWidth${e}`);[t,o].forEach(r=>{r&&r.addEventListener("change",()=>{typeof restoringSession<"u"&&restoringSession||(markProjectFormDataDirty$1(),saveCurrentGearList$1())})})})}function formatMonitorSizeValue(e){if(e==null||e==="")return"";if(typeof e=="number"&&Number.isFinite(e))return String(e);const t=parseFloat(String(e));return Number.isFinite(t)?String(t):""}function updateGearListMonitorItem(e,t={}){if(!e)return;const o=e.closest(".gear-item");if(!o)return;const r=t.label||o.getAttribute("data-gear-label")||"";r&&o.setAttribute("data-gear-label",r);const n=[];t.size&&n.push(`${t.size}"`),t.name&&n.push(addArriKNumber$1(t.name)),t.suffix&&n.push(t.suffix);const a=n.filter(Boolean).join(" - ");if(a?o.setAttribute("data-gear-attributes",a):o.removeAttribute("data-gear-attributes"),r){const s=a?`${r} (${a})`:r;o.setAttribute("data-gear-name",s)}}function bindGearListDirectorMonitorListener$1(){if(!gearListOutput)return;const e="incl. Directors cage, shoulder strap, sunhood, rigging for teradeks",t="incl. sunhood, V-Mount, AC Adapter and Wooden Camera Ultra QR Monitor Mount (Baby Pin, C-Stand)";["Director","Dop","Gaffer","Focus"].forEach(o=>{const r=gearListOutput.querySelector(`#gearList${o}Monitor`);r&&r.addEventListener("change",()=>{if(typeof restoringSession<"u"&&restoringSession)return;const n=devices&&devices.monitors&&devices.monitors[r.value],a=gearListOutput.querySelector(`#monitorSize${o}`),s=formatMonitorSizeValue(n?.screenSizeInches);a&&(a.textContent=`(${s}")`);const u=o==="Focus"?"Focus Monitor":`${o==="Dop"?"DoP":o} Handheld Monitor`;updateGearListMonitorItem(r,{label:u,name:r.value||"",size:s,suffix:e}),r.dataset.autoGearManual="true",markProjectFormDataDirty$1(),saveCurrentGearList$1(),saveCurrentSession(),checkSetupChanged()})}),["Director","Combo","Dop"].forEach(o=>{const r=gearListOutput.querySelector(`#gearList${o}Monitor15`);r&&r.addEventListener("change",()=>{if(typeof restoringSession<"u"&&restoringSession)return;const n=devices&&devices.directorMonitors&&devices.directorMonitors[r.value],a=gearListOutput.querySelector(`#monitorSize${o}15`),s=formatMonitorSizeValue(n?.screenSizeInches);a&&(a.textContent=`(${s}")`),updateGearListMonitorItem(r,{label:`${o==="Dop"?"DoP":o} Monitor`,name:r.value||"",size:s,suffix:t}),r.dataset.autoGearManual="true",markProjectFormDataDirty$1(),saveCurrentGearList$1(),saveCurrentSession(),checkSetupChanged()})})}typeof document<"u"&&(document.addEventListener("gearlist:add-extra-gear",()=>{try{addExtraGearItem()}catch(e){console.warn("Failed to add extra gear item from request",e)}}),document.addEventListener("gear-provider-data-changed",()=>{refreshGearItemProviderDisplays(),refreshGearItemEditProviderOptionsIfOpen()}),document.addEventListener("own-gear-data-changed",()=>{ownGearNameCache=null,refreshGearItemProviderDisplays(),refreshGearItemEditProviderOptionsIfOpen(),refreshGearItemOwnedStateIfOpen()}),document.addEventListener("camera-selection-changed",()=>{refreshGearItemEditCameraLinkOptionsIfOpen(),refreshAllCameraLinkIndicators()}),document.addEventListener("camera-colors-changed",()=>{cachedCameraColorDefaults=null,refreshAllCameraLinkIndicators(),refreshGearItemEditCameraLinkOptionsIfOpen()}));typeof globalThis<"u"&&(globalThis.saveCurrentGearList=saveCurrentGearList$1,globalThis.doesProjectNameExist=doesProjectNameExist,globalThis.resolveProjectStorageNameCollision=resolveProjectStorageNameCollision,globalThis.collectProjectFormData=collectProjectFormData$1,globalThis.populateProjectForm=populateProjectForm$1);console.log("app-setups.js: Execution complete");function getSetups$1(){return{}}typeof globalThis<"u"&&(globalThis.getSetups=getSetups$1,globalThis.bindGearListCageListener=bindGearListCageListener$1,globalThis.bindGearListEasyrigListener=bindGearListEasyrigListener$1,globalThis.bindGearListSliderBowlListener=bindGearListSliderBowlListener$1,globalThis.bindGearListEyeLeatherListener=bindGearListEyeLeatherListener$1,globalThis.bindGearListProGaffTapeListener=bindGearListProGaffTapeListener$1,globalThis.bindGearListDirectorMonitorListener=bindGearListDirectorMonitorListener$1);window.getSetups=getSetups$1;window.normalizeBatteryPlateValue=normalizeBatteryPlateValue;window.bindGearListCageListener=bindGearListCageListener$1;window.bindGearListEasyrigListener=bindGearListEasyrigListener$1;window.bindGearListSliderBowlListener=bindGearListSliderBowlListener$1;window.bindGearListEyeLeatherListener=bindGearListEyeLeatherListener$1;window.bindGearListProGaffTapeListener=bindGearListProGaffTapeListener$1;window.bindGearListDirectorMonitorListener=bindGearListDirectorMonitorListener$1;function detectGlobalScope$5(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$8=detectGlobalScope$5();function resolveModuleBase$4(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const MODULE_BASE$4=resolveModuleBase$4(GLOBAL_SCOPE$8),safeWarn$4=MODULE_BASE$4&&typeof MODULE_BASE$4.safeWarn=="function"?MODULE_BASE$4.safeWarn.bind(MODULE_BASE$4):(e,t)=>{if(GLOBAL_SCOPE$8&&GLOBAL_SCOPE$8.console&&typeof GLOBAL_SCOPE$8.console.warn=="function")try{typeof t>"u"?GLOBAL_SCOPE$8.console.warn(e):GLOBAL_SCOPE$8.console.warn(e,t)}catch{}};function fallbackGetter(e,t){return typeof e=="function"?e:typeof t=="function"?t:()=>{}}function fallbackValue(e,t){return typeof e>"u"?t:e}function optionalFunction(e){return typeof e=="function"?e:null}function createConnectionDiagram(e={}){const t=fallbackValue(e.document,GLOBAL_SCOPE$8.document||null),o=fallbackValue(e.window,typeof GLOBAL_SCOPE$8.addEventListener=="function"?GLOBAL_SCOPE$8:null),r=fallbackValue(e.navigator,GLOBAL_SCOPE$8.navigator||null),n=fallbackGetter(e.getTexts,()=>fallbackValue(e.texts,GLOBAL_SCOPE$8.texts||{})),a=fallbackGetter(e.getCurrentLang,()=>fallbackValue(e.currentLang,GLOBAL_SCOPE$8.currentLang||"en")),s=fallbackGetter(e.getDevices,()=>fallbackValue(e.devices,GLOBAL_SCOPE$8.devices||{})),l=fallbackGetter(e.getCameraSelect,()=>fallbackValue(e.cameraSelect,GLOBAL_SCOPE$8.cameraSelect||null)),u=fallbackGetter(e.getMonitorSelect,()=>fallbackValue(e.monitorSelect,GLOBAL_SCOPE$8.monitorSelect||null)),d=fallbackGetter(e.getVideoSelect,()=>fallbackValue(e.videoSelect,GLOBAL_SCOPE$8.videoSelect||null)),m=fallbackGetter(e.getDistanceSelect,()=>fallbackValue(e.distanceSelect,GLOBAL_SCOPE$8.distanceSelect||null)),y=fallbackGetter(e.getBatterySelect,()=>fallbackValue(e.batterySelect,GLOBAL_SCOPE$8.batterySelect||null)),h=fallbackGetter(e.getMotorSelects,()=>fallbackValue(e.motorSelects,GLOBAL_SCOPE$8.motorSelects||[])),b=fallbackGetter(e.getControllerSelects,()=>fallbackValue(e.controllerSelects,GLOBAL_SCOPE$8.controllerSelects||[])),v=fallbackGetter(e.getSetupDiagramContainer,()=>fallbackValue(e.setupDiagramContainer,t?t.getElementById("diagramArea"):null)),C=fallbackGetter(e.getDiagramLegend,()=>fallbackValue(e.diagramLegend,t?t.getElementById("diagramLegend"):null)),A=fallbackGetter(e.getDiagramHint,()=>fallbackValue(e.diagramHint,t?t.getElementById("diagramHint"):null));fallbackGetter(e.getDownloadDiagramBtn,()=>fallbackValue(e.downloadDiagramBtn,t?t.getElementById("downloadDiagram"):null));const w=fallbackGetter(e.getZoomInBtn,()=>fallbackValue(e.zoomInBtn,t?t.getElementById("zoomIn"):null)),R=fallbackGetter(e.getZoomOutBtn,()=>fallbackValue(e.zoomOutBtn,t?t.getElementById("zoomOut"):null)),_=fallbackGetter(e.getResetViewBtn,()=>fallbackValue(e.resetViewBtn,t?t.getElementById("resetView"):null));fallbackGetter(e.getGridSnapToggleBtn,()=>fallbackValue(e.gridSnapToggleBtn,t?t.getElementById("gridSnapToggle"):null));const G=fallbackGetter(e.getDiagramDetailDialog,()=>fallbackValue(e.diagramDetailDialog,t?t.getElementById("diagramDetailDialog"):null)),O=fallbackGetter(e.getDiagramDetailContent,()=>fallbackValue(e.diagramDetailContent,t?t.getElementById("diagramDetailDialogContent"):null)),B=fallbackGetter(e.getCurrentGridSnap,()=>!1),$=optionalFunction(e.scheduleProjectAutoSave),V=optionalFunction(e.saveCurrentSession),M=optionalFunction(e.checkSetupChanged),F=fallbackGetter(e.motorPriority,()=>0),z=fallbackGetter(e.controllerPriority,()=>0),x=fallbackGetter(e.isArri,()=>!1),H=fallbackGetter(e.isArriOrCmotion,()=>!1),W=fallbackGetter(e.fizNeedsPower,()=>!1),U=fallbackGetter(e.fizPowerPort,()=>""),j=fallbackGetter(e.controllerDistancePort,()=>""),Y=fallbackGetter(e.controllerCamPort,()=>""),le=fallbackGetter(e.cameraFizPort,()=>""),be=fallbackGetter(e.motorFizPort,()=>""),re=fallbackGetter(e.getSelectedPlate,()=>""),de=fallbackGetter(e.isSelectedPlateNative,()=>!1),ne=fallbackGetter(e.firstPowerInputType,()=>""),Ce=fallbackGetter(e.formatConnLabel,(pe,Ie)=>[pe,Ie].filter(Boolean).join(" → ")),Ee=fallbackGetter(e.connectionLabel,(pe,Ie)=>Ce(pe,Ie)),Pe=fallbackGetter(e.fizPort,()=>""),et=fallbackGetter(e.iconGlyph,(pe,Ie)=>typeof GLOBAL_SCOPE$8.iconGlyph=="function"?GLOBAL_SCOPE$8.iconGlyph(pe,Ie):null),Je=fallbackValue(e.ICON_FONT_KEYS,GLOBAL_SCOPE$8.ICON_FONT_KEYS||{});fallbackGetter(e.applyIconGlyph,(pe,Ie)=>typeof GLOBAL_SCOPE$8.applyIconGlyph=="function"?GLOBAL_SCOPE$8.applyIconGlyph(pe,Ie):null);const it=fallbackGetter(e.resolveIconGlyph,pe=>typeof GLOBAL_SCOPE$8.resolveIconGlyph=="function"?GLOBAL_SCOPE$8.resolveIconGlyph(pe):pe),rt=fallbackGetter(e.positionSvgMarkup,(pe,Ie,bt,zt)=>typeof GLOBAL_SCOPE$8.positionSvgMarkup=="function"?GLOBAL_SCOPE$8.positionSvgMarkup(pe,Ie,bt,zt):null),Pt=fallbackGetter(e.ensureSvgHasAriaHidden,pe=>typeof GLOBAL_SCOPE$8.ensureSvgHasAriaHidden=="function"?GLOBAL_SCOPE$8.ensureSvgHasAriaHidden(pe):pe),vt=fallbackGetter(e.formatSvgCoordinate,pe=>typeof GLOBAL_SCOPE$8.formatSvgCoordinate=="function"?GLOBAL_SCOPE$8.formatSvgCoordinate(pe):Number.isFinite(pe)?String(pe):"0"),bo=fallbackGetter(e.getSafeGenerateConnectorSummary,()=>MODULE_BASE$4&&typeof MODULE_BASE$4.safeGenerateConnectorSummary=="function"?MODULE_BASE$4.safeGenerateConnectorSummary.bind(MODULE_BASE$4):GLOBAL_SCOPE$8&&typeof GLOBAL_SCOPE$8.safeGenerateConnectorSummary=="function"?GLOBAL_SCOPE$8.safeGenerateConnectorSummary:null),Et=pe=>pe?Array.isArray(pe)?pe:typeof pe.length=="number"?Array.from(pe):[]:[];let Ut={},ge={},ue=null,We={},Me=null,Te=null,Be=null,Ve=!1,je="Diagram details",mt="Back";const ct=()=>v(),$t=()=>C(),fo=()=>A(),no=()=>w(),Nt=()=>R(),xo=()=>_(),Io=()=>{try{return n()||{}}catch{return{}}},qo=()=>{try{return a()||"en"}catch{return"en"}},eo=()=>{try{return s()||{}}catch{return{}}},To=()=>l(),ko=()=>u(),Jt=()=>d(),lr=()=>m(),pt=()=>y(),mo=()=>Et(h()),go=()=>Et(b()),So=pe=>pe==null?"":String(pe).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),k=pe=>{if(typeof pe!="string")return"";const Ie=pe.trim();return Ie&&Ie.replace(/[^a-zA-Z0-9_-]+/g,"-").replace(/^-+|-+$/g,"")||""},Q=pe=>{const Ie=k(pe);return Ie?`diagramPopupTitle-${Ie}`:"diagramPopupTitle"},X=(pe,Ie,bt)=>{if(!pe||!Ie||!bt)return null;const zt=String(Ie).split(".").filter(Boolean);let io=pe;for(let lt=0;lt<zt.length;lt+=1){const Eo=zt[lt];if(!io||typeof io!="object"){io=null;break}io=io[Eo]}if(!io||typeof io!="object")return null;try{return io[bt]||null}catch{return null}},ae=pe=>pe?pe==="cameras"?"diagram-popup--camera":pe==="batteries"?"diagram-popup--battery":pe==="monitors"?"diagram-popup--monitor":pe==="video"?"diagram-popup--video":pe==="fiz.motors"?"diagram-popup--motor":pe==="fiz.controllers"?"diagram-popup--controller":pe==="fiz.distance"?"diagram-popup--distance":"":"",Ae=()=>!!(Te&&(Te.open||Te.hasAttribute("open"))),Se=()=>{const pe=ct();if(!pe||typeof pe.getBoundingClientRect!="function")return!1;const Ie=pe.getBoundingClientRect(),bt=o?o.innerWidth:t?.documentElement?.clientWidth||0,zt=o?o.innerHeight:t?.documentElement?.clientHeight||0;return!bt||!zt?!1:Ie.bottom>0&&Ie.right>0&&Ie.top<zt&&Ie.left<bt};function Oe(){const pe=G(),Ie=O(),bt=pe!==Te;if(Te=pe||null,Be=Ie||null,Te&&(bt||!Ve)){const zt=io=>{if(!io)return;const lt=io.target===Te,Eo=Te.querySelector(".modal-surface");if(lt&&(!Eo||!Eo.contains(io.target))){Ne();return}!lt&&Eo&&!Eo.contains(io.target)&&Ne()};Te.addEventListener("click",zt),Te.addEventListener("cancel",io=>{io.preventDefault(),Ne()}),Te.addEventListener("close",()=>{Be&&(Be.innerHTML=""),Te.removeAttribute("open"),Te.removeAttribute("aria-labelledby"),Te.setAttribute("aria-label",je),Te.classList.remove("diagram-detail-dialog--camera")}),Te.setAttribute("aria-label",je),Ve=!0}}function Ne(){if(Oe(),!Te)return;typeof Te.close=="function"&&Te.open?Te.close():(Te.removeAttribute("open"),Be&&(Be.innerHTML=""),Te.removeAttribute("aria-labelledby"),Te.setAttribute("aria-label",je),Te.classList.remove("diagram-detail-dialog--camera"));const pe=Te.querySelector(".modal-surface");pe&&(pe.style.position="",pe.style.margin="",pe.style.left="",pe.style.top="",pe.style.visibility="")}function Qe(pe,Ie=null){if(Oe(),!Te||!Be||!pe)return;const bt=typeof pe.content=="string"?pe.content.trim():pe.content;if(!bt){Ne();return}if(!Se()){Ne();return}const zt=Te.ownerDocument||t;if(!zt)return;const io=Te.querySelector(".modal-surface");io&&(Ie&&typeof Ie.x=="number"&&typeof Ie.y=="number"?(io.style.visibility="hidden",io.style.position="absolute",io.style.margin="0",io.style.left="0",io.style.top="0"):(io.style.position="",io.style.margin="",io.style.left="",io.style.top="",io.style.visibility="")),Be.innerHTML="";const lt=zt.createElement("div");lt.className=pe.className?`diagram-popup ${pe.className}`:"diagram-popup",lt.innerHTML=bt,Be.appendChild(lt);const Eo=lt.querySelector("[data-diagram-popup-close]");if(Eo&&Eo.addEventListener("click",Ho=>{Ho&&(Ho.preventDefault(),Ho.stopPropagation()),Ne()}),lt.hasAttribute("tabindex")||(lt.tabIndex=-1),typeof lt.addEventListener=="function"&&lt.addEventListener("keydown",Ho=>{if(!Ho)return;const on=Ho.key||Ho.code;(on==="Escape"||on==="Esc")&&(Ho.preventDefault(),Ne())}),typeof lt.focus=="function")try{lt.focus({preventScroll:!0})}catch{lt.focus()}const Tr=!!(pe.className&&pe.className.includes("diagram-popup--camera"));Te.classList.toggle("diagram-detail-dialog--camera",Tr);const Ur=pe.label||je;if(pe.headingId?(Te.setAttribute("aria-labelledby",pe.headingId),Te.removeAttribute("aria-label")):(Te.removeAttribute("aria-labelledby"),Te.setAttribute("aria-label",Ur)),typeof Te.showModal=="function"?Te.open||Te.showModal():Te.setAttribute("open",""),io&&Ie&&typeof Ie.x=="number"&&typeof Ie.y=="number"){const Ho=o?o.innerWidth:t.documentElement.clientWidth||0,on=o?o.innerHeight:t.documentElement.clientHeight||0,zr=io.getBoundingClientRect(),kr=5,ln=20;let Rn=Ie.x+kr,gn=Ie.y+kr;Rn+zr.width>Ho-ln&&(Rn=Ie.x-zr.width-kr),Rn<ln&&(Rn=ln),Rn+zr.width>Ho-ln&&(Rn=Ho-zr.width-ln),gn+zr.height>on-ln&&(gn=Ie.y-zr.height-kr),gn<ln&&(gn=ln),gn+zr.height>on-ln&&(gn=on-zr.height-ln),io.style.left=`${Math.round(Rn)}px`,io.style.top=`${Math.round(gn)}px`,io.style.visibility=""}}const Fe=`
    .node-box{fill:var(--diagram-node-fill, #f0f0f0);stroke:none;}
    .node-box.first-fiz{stroke:none;}
    .first-fiz-highlight{stroke:url(#firstFizGrad);stroke-width:1px;fill:none;}
    .node-icon{font-size:var(--font-size-diagram-icon, 24px);font-family:'UiconsThinStraightV2',system-ui,sans-serif;font-style:normal;}
    .node-icon[data-icon-font='essential']{font-family:'EssentialIconsV2',system-ui,sans-serif;}
    .conn{stroke:none;}
    .conn.red{fill:var(--diagram-power-stroke, #d33);}
    .conn.blue{fill:var(--diagram-video-stroke, #369);}
    .conn.green{fill:var(--diagram-fiz-stroke, #090);}
    text{font-family:system-ui,sans-serif;fill:var(--diagram-text-fill, #000);}
    .edge-label{font-size:var(--font-size-diagram-label, 11px);fill:var(--diagram-text-fill, #000);}
    line{stroke:var(--diagram-stroke, #333);stroke-width:2px;}
    path.edge-path{stroke:var(--diagram-stroke, #333);stroke-width:2px;fill:none;}
    path.power{stroke:var(--diagram-power-stroke, #d33);}
    path.video{stroke:var(--diagram-video-stroke, #369);}
    path.fiz{stroke:var(--diagram-fiz-stroke, #090);}
    .diagram-placeholder{font-style:italic;color:#666;margin:0;}
    `;function _e(){return Fe}const He=(pe,Ie)=>{try{return et(pe,Ie)}catch{}return null},st=He(""),at=He(""),St=He(""),kt=He(""),Zt=He(""),Ht=He(""),jo=He("",Je.UICONS),ir=He(""),sr=He(""),Ro=He("",Je.UICONS),Ot=He(""),Lr=He(""),Co=He(""),hr=He(""),Wo=He(""),Yo=He(""),Tt=Object.freeze({powerOut:Ot,powerIn:Lr,fiz:jo,video:Zt,timecode:Co,audioIn:hr,audioOut:Wo,audioIo:Yo,torque:jo,controller:ir,powerSpec:Ot,powerSource:Lr}),$o={battery:st,camera:at,monitor:St,viewfinder:kt,video:Ht,motors:jo,controllers:ir,handle:ir,distance:sr,lenses:Ro},br={category_batteries:st,category_batteryHotswaps:st,category_cameras:at,category_lenses:Ro,category_viewfinders:kt,category_monitors:St,category_video:Ht,category_fiz_motors:jo,category_fiz_controllers:ir,category_fiz_distance:sr},Do=ct();if(!Do)return;const ur=Io(),or=qo(),Vo=eo(),Po=To(),co=ko(),mr=Jt(),Sr=lr(),jr=pt(),Qr=mo(),an=go(),Sn=ur[or]?.diagramDetailDefaultHeading||ur.en?.diagramDetailDefaultHeading||"Diagram details",Re=ur[or]?.diagramDetailBackLabel||ur.en?.diagramDetailBackLabel||"Back";je=Sn,mt=Re,Oe(),(r&&Number.isFinite(r.maxTouchPoints)?r.maxTouchPoints:0)>0;const Ye=Po?Po.value:"",ke=Vo.cameras?Vo.cameras[Ye]:void 0,ee=co?co.value:"",I=Vo.monitors?Vo.monitors[ee]:void 0,N=mr?mr.value:"",K=Vo.video?Vo.video[N]:void 0,oe=jr?jr.value:"",ce=Sr?Sr.value:"";let me=Qr.map(pe=>pe?pe.value:"").filter(pe=>pe&&pe!=="None");me.sort((pe,Ie)=>F(pe)-F(Ie));const De=me.findIndex(pe=>Vo.fiz?.motors?.[pe]?.internalController),Ge=De!==-1;if(Ge&&De>0){const[pe]=me.splice(De,1);me.unshift(pe)}let Ue=an.map(pe=>pe?pe.value:"").filter(pe=>pe&&pe!=="None");Ue.sort((pe,Ie)=>z(pe)-z(Ie));const Xe=Ue,ft=[],Le={},ot={},_t=300,Lt=10,Qt=12,Gt=8,ho=10,Qo=220;let Xo=80;if(oe&&oe!=="None"){let pe=oe;const Ie=Vo.batteries?.[oe]?.mount_type;ke&&Ie&&ke.power?.batteryPlateSupport?.some(bt=>bt.type===Ie&&bt.mount==="native")&&(pe+=` on native ${Ie} plate via Pins`),Le.battery={x:Xo,y:Qo,label:pe},ft.push("battery"),ot.battery={category:"batteries",name:oe},Xo+=_t}Ye&&Ye!=="None"&&(Le.camera={x:Xo,y:Qo,label:Ye},ft.push("camera"),ot.camera={category:"cameras",name:Ye},Xo+=_t);const No=Ue.map((pe,Ie)=>`controller${Ie}`),ao=me.map((pe,Ie)=>`motor${Ie}`),Ir=new Map;No.forEach((pe,Ie)=>{Ir.set(pe,Xe[Ie]||Ue[Ie])});const cr=new Map;ao.forEach((pe,Ie)=>{cr.set(pe,me[Ie])});const Rr=Ue.some(pe=>z(pe)===0);let Er=!Rr&&Ge||!No.length&&ao.length&&F(me[0])===0;const rr=(pe,Ie,bt)=>{Le[pe]={x:Xo,y:Qo,label:bt},ft.push(pe),ot[pe]={category:Ie,name:bt},Xo+=_t};Er&&ao.length?(rr(ao[0],"fiz.motors",me[0]),No.forEach((pe,Ie)=>{rr(pe,"fiz.controllers",Xe[Ie])}),ao.slice(1).forEach((pe,Ie)=>{rr(pe,"fiz.motors",me[Ie+1])})):(No.forEach((pe,Ie)=>{rr(pe,"fiz.controllers",Xe[Ie])}),ao.forEach((pe,Ie)=>{rr(pe,"fiz.motors",me[Ie])})),ee&&ee!=="None"&&(Le.monitor={x:Le.camera?Le.camera.x:60,y:Qo-_t,label:ee},ft.push("monitor"),ot.monitor={category:"monitors",name:ee}),N&&N!=="None"&&(Le.video={x:Le.camera?Le.camera.x:60,y:Qo+_t,label:N},ft.push("video"),ot.video={category:"video",name:N});let $r=!1,Pr=!1;if(ce&&ce!=="None"){const pe=Xe.length?No[0]:ao[0];if(pe){const Ie=[...Xe,...me].some(zt=>x(zt)),bt=Xe.some(zt=>/RIA-1/i.test(zt)||/UMC-4/i.test(zt));if(Pr=bt&&Ie,$r=Ie&&!bt&&Xe.length,$r&&ao.length){const zt=ao[0];Le.distance={x:(Le[pe].x+Le[zt].x)/2,y:Qo-_t,label:ce}}else Le.distance={x:Le[pe].x,y:Qo-_t,label:ce};ft.push("distance"),ot.distance={category:"fiz.distance",name:ce}}}Object.keys(Ut).forEach(pe=>{Le[pe]||delete Ut[pe]}),Object.entries(Le).forEach(([pe,Ie])=>{Ut[pe]&&(Ie.x=Ut[pe].x,Ie.y=Ut[pe].y)});const Kt=120,Oo=120,Dt={},Fo={},qr="var(--font-size-diagram-label, 11px)",en="var(--font-size-diagram-text, 13px)",yr=13,Kr=8,Zo=24;function Cr(pe,Ie=16){if(!pe)return[];const bt=String(pe);if(bt.length<=Ie)return[bt];const zt=bt.split(/\s+/),io=[];let lt="";return zt.forEach(Eo=>{const Tr=lt?`${lt} ${Eo}`:Eo;Tr.length>Ie&&lt?(io.push(lt),lt=Eo):lt=Tr}),lt&&io.push(lt),io}ft.forEach(pe=>{const Ie=Le[pe].label||pe,bt=Cr(Ie),zt=$o[pe]||pe.startsWith("controller")||pe.startsWith("motor");Dt[pe]=Math.max(Kt,bt.length*yr+(zt?30:20));const io=bt.reduce((lt,Eo)=>Math.max(lt,Eo.length),0);Fo[pe]=Math.max(Oo,io*9+20)});const T=Math.max(...Object.values(Fo),Oo),J=Math.max(...Object.values(Dt),Kt),qe=pe=>Dt[pe]||J;let Rt,Vt=[];const Go=[],zo={},gr=(pe,Ie)=>{zo[`${pe}|${Ie}`]=!0},It=(pe,Ie)=>zo[`${pe}|${Ie}`],Vr=(pe,Ie)=>{const bt=Le[pe];if(!bt)return{x:0,y:0};const zt=qe(pe);return Ie==="top"?{x:bt.x,y:bt.y-zt/2}:Ie==="bottom"?{x:bt.x,y:bt.y+zt/2}:Ie==="bottom-left"?{x:bt.x-T/2+T/3,y:bt.y+zt/2}:Ie==="bottom-right"?{x:bt.x+T/2-T/3,y:bt.y+zt/2}:Ie==="left"?{x:bt.x-T/2,y:bt.y}:Ie==="right"?{x:bt.x+T/2,y:bt.y}:{x:bt.x,y:bt.y}},Nr=pe=>{const Ie=qe(pe),bt=[{side:"left",color:"red"},{side:"right",color:"red"},{side:"top",color:"blue"},{side:"bottom",color:"green"}];return Ie>J&&(bt.push({side:"bottom-left",color:"green"}),bt.push({side:"bottom-right",color:"green"})),bt},Xt=(pe,Ie,bt)=>{const zt=Nr(pe),io=Nr(Ie);let lt=null,Eo=1/0;return zt.forEach(Tr=>{if(bt[`${pe}|${Tr.side}`])return;const Ur=Vr(pe,Tr.side);io.forEach(Ho=>{if(Tr.color!==Ho.color||bt[`${Ie}|${Ho.side}`])return;const on=Vr(Ie,Ho.side),zr=Math.hypot(Ur.x-on.x,Ur.y-on.y);zr<Eo&&(Eo=zr,lt={fromSide:Tr.side,toSide:Ho.side})})}),lt},po=(pe,Ie)=>{if(!pe.fromSide||!pe.toSide){const bt=Xt(pe.from,pe.to,zo);bt&&(pe.fromSide||(pe.fromSide=bt.fromSide),pe.toSide||(pe.toSide=bt.toSide))}else if(It(pe.from,pe.fromSide)||It(pe.to,pe.toSide))return;gr(pe.from,pe.fromSide),gr(pe.to,pe.toSide),Go.push({...pe,type:Ie})},Wr=Vo.batteries?.[oe]?.mount_type;if(ke&&oe&&oe!=="None"){const pe=re(),Ie=pe&&de(Ye),zt=ne(ke)||pe,io=Ie?"":Ce(Wr,zt);po({from:"battery",to:"camera",label:io,fromSide:"right",toSide:"left"},"power")}if(I&&ne(I)){const pe=ne(I);oe&&oe!=="None"&&po({from:"battery",to:"monitor",label:Ce(Wr,pe),fromSide:"top",toSide:"left"},"power")}if(K&&ne(K)){const pe=ne(K);oe&&oe!=="None"&&po({from:"battery",to:"video",label:Ce(Wr,pe),fromSide:"bottom",toSide:"left"},"power")}if(ke&&ke.videoOutputs?.length){const pe=ke.videoOutputs[0].type,Ie=I&&(I.video?.inputs?.[0]||I.videoInputs?.[0]),bt=K&&(K.videoInputs?.[0]||(K.video?K.video.inputs[0]:null));if(I&&Ie){const zt=Ie.portType||Ie.type||Ie;po({from:"camera",to:"monitor",label:Ee(pe,zt),fromSide:"top",toSide:"bottom",labelSpacing:Lt},"video")}if(K&&bt){const zt=bt.portType||bt.type||bt;po({from:"camera",to:"video",label:Ee(pe,zt),fromSide:"bottom",toSide:"top",labelSpacing:Lt},"video")}}Er=!Rr&&Ge||!No.length&&ao.length&&F(me[0])===0;const Pn=ce&&ce!=="None",Kn=Pn&&!Pr;let Z=!1,he=!1;if(Er&&ao.length?(Vt.push(ao[0]),he=!0):No.length?(Vt.push(No[0]),Z=!0):ao.length&&(Vt.push(ao[0]),he=!0),Kn&&Vt.push("distance"),No.length&&(Vt=Vt.concat(No.slice(Z?1:0))),ao.length&&(Vt=Vt.concat(ao.slice(he?1:0))),Le.distance&&!Ut.distance){const pe=[],Ie=Vt.indexOf("distance");if(Ie!==-1){const bt=Ie>0?Vt[Ie-1]:null,zt=Ie<Vt.length-1?Vt[Ie+1]:null;bt&&Le[bt]&&pe.push(Le[bt]),zt&&Le[zt]&&pe.push(Le[zt])}pe.length<2&&Vt.filter(zt=>zt!=="distance").slice(0,2).forEach(zt=>{Le[zt]&&!pe.includes(Le[zt])&&pe.push(Le[zt])}),pe.length>=2?Le.distance.x=(pe[0].x+pe[1].x)/2:pe.length===1&&(Le.distance.x=pe[0].x)}if(ke&&Vt.length){let pe=Vt[0];pe==="distance"&&Vt.length>1&&(No.length||Ge)&&(pe=Vt[1]);let Ie=null;pe.startsWith("controller")?Ie=Ir.get(pe):pe.startsWith("motor")&&(Ie=cr.get(pe));const bt=pe==="distance"?"LBUS":Y(Ie),zt=le(Ye,bt,Ie);po({from:"camera",to:pe,label:Ce(zt,bt),noArrow:!0},"fiz")}else if(ao.length&&ke){const pe=le(Ye,be(me[0]),me[0]);po({from:"camera",to:ao[0],label:Ce(pe,be(me[0])),noArrow:!0},"fiz")}for(let pe=0;pe<Vt.length-1;pe++){const Ie=Vt[pe],bt=Vt[pe+1];let zt=null,io=null;Ie.startsWith("controller")?zt=Ir.get(Ie):Ie.startsWith("motor")&&(zt=cr.get(Ie)),bt.startsWith("controller")?io=Ir.get(bt):bt.startsWith("motor")&&(io=cr.get(bt)),po({from:Ie,to:bt,label:Ce(Pe(zt),Pe(io)),noArrow:!0},"fiz")}if(Pr&&No.length&&Pn){const pe=Xe[0]||Ue[0],Ie=j(pe),bt=Ce(Pe(pe),Ie);po({from:No[0],to:"distance",label:bt,noArrow:!0,toSide:"bottom-right"},"fiz")}const fe=[];No.forEach((pe,Ie)=>{fe.push({id:pe,name:Xe[Ie]||Ue[Ie]})}),ao.forEach((pe,Ie)=>{fe.push({id:pe,name:me[Ie]})});const xe=pe=>/RIA-1/i.test(pe)||/UMC-4/i.test(pe)||/cforce.*rf/i.test(pe);let $e=null;const ze=fe.find(pe=>xe(pe.name));if(ze?$e=ze:$e=fe.find(pe=>W(pe.name)),$e&&W($e.name)){const{id:pe,name:Ie}=$e,bt=oe&&oe!=="None"?"battery":null,zt=Ce("D-Tap",U(Ie)),io=x(Ye)&&H(Ie);bt&&!io&&po({from:bt,to:pe,label:zt,fromSide:"bottom-left",toSide:"bottom",route:"down-right-up"},"power")}if(ft.length===0){Do.innerHTML=`<p class="diagram-placeholder">${ur[or]?.setupDiagramPlaceholder||ur.en?.setupDiagramPlaceholder||""}</p>`;return}let yt=Object.values(Le).map(pe=>pe.x),dt=Math.min(...yt),ht=Math.max(...yt);const uo=ht-dt,wt=Math.max(500,uo+T);if(Object.keys(Ut).length===0){const pe=wt/2-(dt+ht)/2;Object.values(Le).forEach(Ie=>{Ie.x+=pe}),yt=Object.values(Le).map(Ie=>Ie.x),dt=Math.min(...yt),ht=Math.max(...yt)}const Ao=Object.values(Le).map(pe=>pe.y),nr=Math.min(...Ao),dr=Math.max(...Ao),fr=Math.max(40,T*.25),ar=Math.max(40,J*.25),Jo=Math.max(120,J*.4),Mr=dt-T/2-fr,Or=ht+T/2+fr,Uo=nr-J/2-ar,Ko=dr+J/2+Jo,yo=Math.floor(Math.min(0,Mr)),En=Math.floor(Uo);Rt=Math.max(wt,Math.ceil(Or-yo));const Fr=dr-nr+J+ar+Jo,wr=Math.max(Math.ceil(Fr),Math.ceil(Ko-En));function er(pe,Ie,bt=0,zt={}){const io=Math.max(0,zt.labelLineCount||0),lt=io>1?(io-1)*yr:0,Eo=Vr(pe,zt.fromSide),Tr=Vr(Ie,zt.toSide);let Ur,Ho,on,zr=0;if(zt.route==="down-right-up"){const kr=dr+J;Ur=`M ${Eo.x} ${Eo.y} V ${kr} H ${Tr.x} V ${Tr.y}`,Ho=(Eo.x+Tr.x)/2,on=kr-ho-bt-lt}else{Ur=`M ${Eo.x} ${Eo.y} L ${Tr.x} ${Tr.y}`;const kr=Tr.x-Eo.x,ln=Tr.y-Eo.y;zr=Math.atan2(ln,kr)*180/Math.PI;const Rn=(Eo.x+Tr.x)/2,gn=(Eo.y+Tr.y)/2,oa=Math.hypot(kr,ln)||1,fn=(Math.abs(kr)<Math.abs(ln)?Gt:Qt)+bt+lt,un=ln/oa*fn,Bn=-kr/oa*fn;Ho=Rn+un,on=gn+Bn}return{path:Ur,labelX:Ho,labelY:on,angle:zr}}const ro=18,Xr=`
        <defs>
          <style>${_e()}</style>
          <linearGradient id="firstFizGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#fff" stop-opacity="0.9"></stop>
            <stop offset="100%" stop-color="#fff" stop-opacity="0"></stop>
          </linearGradient>
        </defs>
      `;let Bo=`<svg viewBox="${yo} ${En} ${Rt} ${wr}" role="group" aria-labelledby="diagramDesc">${Xr}`;Bo+='<g id="diagramRoot">',ft.forEach(pe=>{const Ie=Le[pe];if(!Ie)return;const bt=qe(pe),zt="diagram-node",io="node-box";Bo+=`<g class="${zt}" data-node="${pe}">`,Bo+=`<rect class="${io}" x="${Ie.x-T/2}" y="${Ie.y-bt/2}" width="${T}" height="${bt}" rx="4" ry="4" />`,Nr(pe).forEach(fn=>{const{x:un,y:Bn}=Vr(pe,fn.side);Bo+=`<circle class="conn ${fn.color}" cx="${un}" cy="${Bn}" r="4" />`});let Eo=$o[pe];if(!Eo)if(pe.startsWith("motor"))Eo=$o.motors;else if(pe.startsWith("controller")){const fn=(ot[pe]?.name||"").toLowerCase();/handle|grip/.test(fn)?Eo=$o.handle:Eo=$o.controllers}else pe==="distance"&&(Eo=$o.distance);const Tr=Cr(Ie.label||pe),Ur=Eo?it(Eo):null,Ho=!!(Ur&&(Ur.markup||Ur.char)),on=Ho&&Number.isFinite(Ur.size)?Ur.size:Zo,zr=Ho?on:0,kr=Tr.length,ln=kr?kr*yr:0,Rn=Ho&&kr?Kr:0,gn=zr+Rn+ln,oa=Ie.y-gn/2,sa=vt(Ie.x);if(Ho){const fn=oa+zr/2;if(Ur.markup&&rt){const un=rt(Pt(Ur.markup),Ie.x,fn,on);if(un&&un.markup){const Bn=["node-icon-svg"];Ur.className&&Bn.push(Ur.className),Bo+=`<g class="${Bn.join(" ")}" transform="translate(${un.x}, ${un.y})">${un.markup}</g>`}}else if(Ur.char){const un=Ur.font?` data-icon-font="${Ur.font}"`:"";Bo+=`<text class="node-icon"${un} x="${sa}" y="${vt(fn)}" text-anchor="middle" dominant-baseline="middle">${Ur.char}</text>`}}if(kr){const fn=oa+zr+Rn,un=vt(fn);Bo+=`<text x="${sa}" y="${un}" text-anchor="middle" dominant-baseline="hanging" style="font-size: ${Ho?qr:en};">`,Tr.forEach((to,An)=>{const Hn=An===0?"":` dy="${yr}"`;Bo+=`<tspan x="${sa}"${Hn}>${to}</tspan>`}),Bo+="</text>"}Bo+="</g>"}),Go.forEach(pe=>{const Ie=pe.label?Cr(pe.label,ro):[],{path:bt,labelX:zt,labelY:io,angle:lt}=er(pe.from,pe.to,pe.labelSpacing,{...pe,labelLineCount:Ie.length});if(Bo+=`<path class="edge-path ${pe.type}" d="${bt}" />`,Ie.length){const Eo=Math.abs(lt)>90?`rotate(${lt+180} ${zt} ${io})`:`rotate(${lt} ${zt} ${io})`,Tr=vt(zt),Ur=vt(io);Bo+=`<text class="edge-label" x="${Tr}" y="${Ur}" transform="${Eo}" text-anchor="middle">`,Ie.forEach((Ho,on)=>{const zr=on===0?"":` dy="${yr}"`;Bo+=`<tspan x="${Tr}"${zr}>${Ho}</tspan>`}),Bo+="</text>"}}),Bo+="</g></svg>";let we=t?t.getElementById("diagramPopup"):null;!we&&t&&(we=t.createElement("div"),we.id="diagramPopup"),we&&(we.className="diagram-popup",we.setAttribute("role","dialog"),we.setAttribute("aria-modal","false"),we.hasAttribute("tabindex")||(we.tabIndex=-1)),Do.innerHTML="",Do.insertAdjacentHTML("beforeend",Bo),we&&Do.appendChild(we);const jt={},_o=bo();if(Object.entries(ot).forEach(([pe,Ie])=>{const bt=Le[pe]?.label||Ie?.name||pe,zt=So(bt),io=ae(Ie?.category);let lt="";if(typeof _o=="function"){const zr=X(Vo,Ie?.category,Ie?.name);if(zr)try{lt=_o(zr)||""}catch{}}const Eo=So(mt||"Back"),Tr=Q(pe),Ur=So(Tr),Ho=lt||`<p class="diagram-popup__fallback">${zt}</p>`,on=`
          <div class="diagram-popup__layout">
            <header class="diagram-popup__header">
              <button
                type="button"
                class="diagram-popup__back"
                data-diagram-popup-close
                aria-label="${Eo}"
              >
                <span class="btn-icon icon-glyph icon-text" aria-hidden="true" data-icon-font="text">&larr;</span>
                <span class="diagram-popup__back-label">${Eo}</span>
              </button>
              <h3 class="diagram-popup__title" id="${Ur}">${zt}</h3>
            </header>
            <div class="diagram-popup__body">
              ${Ho}
            </div>
          </div>
        `;jt[pe]={className:io,content:on,label:zt,headingId:Tr}}),We=jt,!Do.querySelector("svg"))return;if(fo()){const pe=Do.getBoundingClientRect(),Ie=Do.parentElement?.getBoundingClientRect(),bt=pe?.width||Do.clientWidth||0;Ie&&bt&&bt>Ie.width*.95?Do.dataset.initialScale=String(Math.max(.5,Ie.width/bt*.95)):delete Do.dataset.initialScale}ge=Object.fromEntries(Object.entries(Le)),pr(),ki();function tn(pe){if(!pe||typeof pe!="object")return{};const Ie={};return Object.entries(pe).forEach(([bt,zt])=>{if(!zt||typeof zt!="object")return;const io=Number(zt.x),lt=Number(zt.y);!Number.isFinite(io)||!Number.isFinite(lt)||(Ie[bt]={x:io,y:lt})}),Ie}function Cn(){return tn(Ut)}function sn(pe,Ie={}){Ut=tn(pe),Ie&&Ie.render}function pr(){const pe=ct();if(!pe)return;const Ie=pe.querySelector("svg");if(!Ie)return;const bt=Io(),zt=qo(),io=bt[zt]?.diagramHoverNotice||bt.en?.diagramHoverNotice||"Double click for more information";je=bt[zt]?.diagramDetailDefaultHeading||bt.en?.diagramDetailDefaultHeading||je,mt=bt[zt]?.diagramDetailBackLabel||bt.en?.diagramDetailBackLabel||mt,Oe();const lt=pe.querySelector("#diagramPopup");let Eo=null,Tr=null;const Ur=tt=>!tt||typeof tt!="object"?null:typeof tt.closest=="function"?tt:"parentElement"in tt&&tt.parentElement?tt.parentElement:"parentNode"in tt&&tt.parentNode&&tt.parentNode!==tt?Ur(tt.parentNode):null,Ho=()=>{lt&&(lt.style.display="none",lt.setAttribute("hidden",""),lt.innerHTML="",lt.dataset.columns="1",lt.style.removeProperty("--diagram-popup-dynamic-width"),lt.className="diagram-popup",lt.removeAttribute("aria-label"),lt.removeAttribute("aria-labelledby"),lt.onkeydown=null,Eo=null,Tr=null)};Ho(),ue&&ue();const on=Ie.querySelector("#diagramRoot")||Ie,zr=(r&&Number.isFinite(r.maxTouchPoints)?r.maxTouchPoints:0)>0,kr=zr?1/0:3,ln=zr?.55:.6,Rn=zr?.4:.35,gn=parseFloat(pe.dataset.initialScale||""),oa=zr?.95:.85,sa=Number.isFinite(gn)&&gn>0?gn:oa,fn=Math.max(Rn,Math.min(ln,sa)),un=tt=>!Number.isFinite(tt)||tt<=0?fn:tt>kr?kr:tt<fn?fn:tt,Bn=un(sa);let to={x:0,y:0};if(pe.dataset.initialPan)try{const tt=JSON.parse(pe.dataset.initialPan);tt&&Number.isFinite(tt.x)&&Number.isFinite(tt.y)&&(to={x:tt.x,y:tt.y})}catch{}let An={...to},Hn=Bn,Di=!1,ci={...An},ra=null;const la=tt=>tt.touches&&tt.touches[0]?{x:tt.touches[0].clientX,y:tt.touches[0].clientY}:tt.changedTouches&&tt.changedTouches[0]?{x:tt.changedTouches[0].clientX,y:tt.changedTouches[0].clientY}:{x:tt.clientX,y:tt.clientY},xi=()=>{const tt=typeof Ie.getBoundingClientRect=="function"?Ie.getBoundingClientRect():null,Ct=Ie.viewBox?.baseVal,vo=Ct&&Number.isFinite(Ct.width)&&Ct.width>0?Ct.width:Ie.width?.baseVal?.value||tt?.width||1,Lo=Ct&&Number.isFinite(Ct.height)&&Ct.height>0?Ct.height:Ie.height?.baseVal?.value||tt?.height||1,vr=tt&&Number.isFinite(tt.width)&&tt.width>0?tt.width:vo,rn=tt&&Number.isFinite(tt.height)&&tt.height>0?tt.height:Lo,pn=vr>0?vo/vr:1,Ln=rn>0?Lo/rn:1;return{rect:tt,viewPerPxX:pn,viewPerPxY:Ln}},ui=(tt,Ct)=>{const{viewPerPxX:vo,viewPerPxY:Lo}=xi();return{x:(Number.isFinite(tt)?tt:0)*vo/(Hn||1),y:(Number.isFinite(Ct)?Ct:0)*Lo/(Hn||1)}},ca=()=>{Hn=un(Hn),on.setAttribute("transform",`translate(${An.x},${An.y}) scale(${Hn})`)},ha=tt=>{const Ct=Hn;if(!Number.isFinite(Ct)||Ct<=0)return;const vo=un(Ct*tt);if(!Number.isFinite(vo)||vo<=0||vo===Ct){Hn=vo,ca();return}const{rect:Lo,viewPerPxX:vr,viewPerPxY:rn}=xi();if(Lo&&Number.isFinite(Lo.width)&&Number.isFinite(Lo.height)&&Lo.width>0&&Lo.height>0){const pn=Lo.width/2,Ln=Lo.height/2,yn=1/Ct,hn=1/vo;An.x+=pn*vr*(hn-yn),An.y+=Ln*rn*(hn-yn)}Hn=vo,ca()},na=(tt,Ct)=>{const vo=tt();vo&&(vo.onclick=Ct)};na(no,()=>{ha(1.1)}),na(Nt,()=>{ha(.9)}),na(xo,()=>{An={...to},Hn=Bn,ca(),Ut={},$?$():V&&V(),M&&M()});const Va=tt=>{if(tt.target.closest(".diagram-node"))return;const Ct=la(tt);Di=!0,ra=Ct,ci={...An},tt.touches&&tt.preventDefault(),Ho()},za=tt=>{if(!Di||!ra)return;const Ct=la(tt),vo=ui(Ct.x-ra.x,Ct.y-ra.y);An.x=ci.x+vo.x,An.y=ci.y+vo.y,ca(),tt.touches&&tt.preventDefault()},ba=()=>{Di=!1,ra=null},Rl=140,$i=4,Ni=350,di=30;let Sa=null,jn=null,Ga=null,$n=null,vn=null,Zr=null,Wn=!1,Yn=null;const Ea=()=>{vn&&(clearTimeout(vn),vn=null),Zr=null},Fi=()=>{if(!Zr)return!1;const{node:tt,pointer:Ct}=Zr;if(!tt)return Ea(),!1;const vo=tt.getAttribute("data-node");if(!vo)return Ea(),!1;const Lo=ge[vo];return Lo?(Sa=vo,Ga=tt,jn=Ct,$n={x:Lo.x,y:Lo.y},Wn=!0,Ea(),!0):(Ea(),!1)},qa=tt=>{const Ct=tt.target.closest(".diagram-node");if(!Ct)return;const vo=la(tt);Zr={node:Ct,pointer:vo,time:Date.now()},Ho(),Wn=!1,vn&&clearTimeout(vn),vn=setTimeout(()=>{Fi()},Rl)},vs=()=>Wn?!0:Fi(),_a=tt=>{if(Zr&&!Wn){const hn=la(tt),Xn=Math.abs(hn.x-Zr.pointer.x),Qa=Math.abs(hn.y-Zr.pointer.y);(Xn>$i||Qa>$i)&&Fi()}if(!vs()||!jn||!$n)return;const Ct=la(tt),vo=ui(Ct.x-jn.x,Ct.y-jn.y),Lo=vo.x,vr=vo.y;let rn=$n.x+Lo,pn=$n.y+vr;B()&&(rn=Math.round(rn/20)*20,pn=Math.round(pn/20)*20);const Ln=rn-$n.x,yn=pn-$n.y;Ga&&Ga.setAttribute("transform",`translate(${Ln},${yn})`),Wn&&tt.touches&&tt.preventDefault()},Ka=tt=>{if(!Wn||!Sa||!jn||!$n){Ea(),Wn=!1,Sa=null,Ga=null,jn=null,$n=null;return}const Ct=la(tt),vo=ui(Ct.x-jn.x,Ct.y-jn.y);let Lo=$n.x+vo.x,vr=$n.y+vo.y;B()&&(Lo=Math.round(Lo/20)*20,vr=Math.round(vr/20)*20),Ut[Sa]={x:Lo,y:vr},Ea(),Sa=null,Ga=null,jn=null,$n=null,Wn=!1,$?$():V&&V(),M&&M(),tt.touches&&tt.preventDefault()},Ui=tt=>{const Ct=tt.target.closest(".diagram-node");if(!Ct){Yn=null;return}const vo=Ct.getAttribute("data-node");if(!vo){Yn=null;return}const Lo=Date.now(),vr=la(tt);if(Yn&&Yn.id===vo&&Lo-Yn.time<=Ni&&Math.abs(vr.x-Yn.pos.x)<=di&&Math.abs(vr.y-Yn.pos.y)<=di){const rn=We[vo];rn&&(Ol(Ct,rn),typeof tt.preventDefault=="function"&&tt.preventDefault()),Yn=null;return}Yn={id:vo,pos:vr,time:Lo},Rs(Ct)},Ls=(tt,Ct,vo,Lo)=>{if(!lt||(lt.dataset.columns="1",lt.style.removeProperty("--diagram-popup-dynamic-width"),!(tt&&typeof tt.className=="string"&&tt.className.includes("diagram-popup--camera")||lt.classList.contains("diagram-popup--camera")))||!Number.isFinite(vo)||vo<=Lo*2)return;const rn=vo-Lo*2;if(rn<=0||!lt)return;const pn=lt.scrollHeight;if(!Number.isFinite(pn)||pn<=rn)return;const Ln=Number.isFinite(Ct)&&Ct>Lo*2?Math.max(260,Ct-Lo*2):1/0,yn=520,hn=220,Xn=220;let Qa=1,Ia=yn;for(let Pa=2;Pa<=4;Pa+=1){const Ba=Math.min(Ln,yn+(Pa-1)*hn);if(Ba<Pa*Xn)continue;lt.style.setProperty("--diagram-popup-dynamic-width",`${Ba}px`),lt.dataset.columns=String(Pa),lt.offsetHeight;const fi=lt.scrollHeight;if(Qa=Pa,Ia=Ba,Number.isFinite(fi)&&fi<=rn)break}Qa>1?(lt.dataset.columns=String(Qa),lt.style.setProperty("--diagram-popup-dynamic-width",`${Ia}px`),lt.offsetHeight):(lt.dataset.columns="1",lt.style.removeProperty("--diagram-popup-dynamic-width"),lt.offsetHeight)},Gr=(tt,Ct,vo=!1)=>{if(!lt||!tt)return;const Lo=typeof tt.getBoundingClientRect=="function"?tt.getBoundingClientRect():null;if(!Lo)return;const vr=8;vo||(lt.style.visibility="hidden",lt.style.display=lt.classList.contains("diagram-popup--notice")?"flex":"block",lt.removeAttribute("hidden"));const rn=o&&Number.isFinite(o.innerWidth)?o.innerWidth:t?.documentElement?.clientWidth||0,pn=o&&Number.isFinite(o.innerHeight)?o.innerHeight:t?.documentElement?.clientHeight||0;vo||Ls(Ct,rn,pn,vr);const Ln=typeof lt.getBoundingClientRect=="function"?lt.getBoundingClientRect():null;if(!Ln)return;let yn=0,hn=0;const Xn=Me;Xn&&Number.isFinite(Xn.x)&&Number.isFinite(Xn.y)?(yn=Xn.x+5,hn=Xn.y+5,rn&&(yn+Ln.width>rn-vr&&(yn=rn-Ln.width-vr),yn<vr&&(yn=vr)),pn&&(hn<vr&&(hn=Xn.y+vr*2),hn+Ln.height>pn-vr&&(hn=pn-Ln.height-vr))):(yn=Lo.left+Lo.width/2-Ln.width/2,hn=Lo.top-Ln.height-vr),lt.style.left=`${Math.round(yn)}px`,lt.style.top=`${Math.round(hn)}px`,vo||(lt.style.visibility="visible")},Ca=()=>{if(!(!lt||typeof lt.focus!="function"))try{lt.focus({preventScroll:!0})}catch{lt.focus()}},Wa=(tt,Ct)=>{if(!lt)return;const vo=lt.querySelector("[data-diagram-popup-close]");if(vo&&(vo.onclick=Lo=>{Lo&&(Lo.preventDefault(),Lo.stopPropagation()),Ho()}),lt.onkeydown=Lo=>{if(!Lo)return;const vr=Lo.key||Lo.code;(vr==="Escape"||vr==="Esc")&&(Lo.preventDefault(),Ho())},Ct){const Lo=lt.querySelector("[data-diagram-popup-expand]");Lo&&(Lo.onclick=vr=>{vr&&(vr.preventDefault(),vr.stopPropagation()),Ho(),Qe(Ct)})}lt.classList.contains("diagram-popup--notice")||Ca()},Qn=tt=>{if(!tt)return;let Ct,vo;if(tt.touches&&tt.touches.length){const Lo=tt.touches[0];Ct=Lo?.clientX,vo=Lo?.clientY}else typeof tt.clientX=="number"&&typeof tt.clientY=="number"&&(Ct=tt.clientX,vo=tt.clientY);Number.isFinite(Ct)&&Number.isFinite(vo)&&(Me={x:Ct,y:vo})},Rs=tt=>{if(!lt||!tt)return;const Ct=tt.getAttribute("data-node");if(!Ct||!We[Ct]){Ho();return}const vo=We[Ct],Lo=So(io);lt.className=`diagram-popup diagram-popup--notice ${vo.className||""}`,lt.innerHTML=`<p class="diagram-popup-notice">${Lo}</p>`,lt.setAttribute("aria-label",io),lt.removeAttribute("aria-labelledby"),Eo=tt,Tr=null,Gr(tt,null)},Hi=tt=>{Qn(tt);const Ct=tt.target.closest(".diagram-node");!Ct||Ct===Eo||Rs(Ct)},Os=tt=>{if(!Eo)return;const Ct=tt.relatedTarget;Ct&&Eo.contains(Ct)||Ct&&Ct.closest&&Ct.closest(".diagram-node")===Eo||lt&&(Ct===lt||Ct&&lt.contains(Ct))||Ho()},ws=tt=>{Qn(tt),Eo&&lt&&lt.classList.contains("diagram-popup--notice")&&Gr(Eo,null,!0)},Nn=tt=>{Ie.contains(tt.relatedTarget)||lt&&(tt.relatedTarget===lt||lt.contains(tt.relatedTarget))||Ho()},Ya=tt=>{if(!lt||lt.hasAttribute("hidden"))return;const Ct=Ur(tt?.target||null);Ct&&(Ct===lt||typeof lt.contains=="function"&&lt.contains(Ct)||typeof Ct.closest=="function"&&Ct.closest(".diagram-node")||Ho())};Ie.addEventListener("mousedown",Va),Ie.addEventListener("touchstart",Va,{passive:!1}),o&&(o.addEventListener("mousemove",za),o.addEventListener("touchmove",za,{passive:!1}),o.addEventListener("mouseup",ba),o.addEventListener("touchend",ba),o.addEventListener("mousemove",_a),o.addEventListener("touchmove",_a,{passive:!1}),o.addEventListener("mouseup",Ka),o.addEventListener("touchend",Ka),o.addEventListener("mousemove",Qn),o.addEventListener("touchmove",Qn,{passive:!0}));const Ol=(tt,Ct)=>{if(Ct){if(!lt||!tt){Qe(Ct);return}lt.className=Ct.className?`diagram-popup ${Ct.className}`:"diagram-popup",lt.innerHTML=Ct.content||"",Ct.headingId?(lt.setAttribute("aria-labelledby",Ct.headingId),lt.removeAttribute("aria-label")):Ct.label?(lt.setAttribute("aria-label",Ct.label),lt.removeAttribute("aria-labelledby")):(lt.removeAttribute("aria-label"),lt.removeAttribute("aria-labelledby")),Eo=tt,Tr=Ct,Gr(tt,Ct),Wa(tt,Ct)}},Ts=tt=>{const Ct=tt.target.closest(".diagram-node");if(!Ct)return;const vo=Ct.getAttribute("data-node");if(!vo)return;const Lo=We[vo];if(!Lo)return;Ho(),Eo=null,Tr=null;let vr=null;tt.clientX!==void 0&&tt.clientY!==void 0?vr={x:tt.clientX,y:tt.clientY}:Me&&(vr={...Me}),Qe(Lo,vr),tt.stopPropagation(),tt.preventDefault()};Ie.addEventListener("mousedown",qa),Ie.addEventListener("touchstart",qa,{passive:!1}),Ie.addEventListener("touchend",Ui,{passive:!1}),Ie.addEventListener("mouseover",Hi),Ie.addEventListener("mouseout",Os),Ie.addEventListener("mousemove",ws),Ie.addEventListener("mouseleave",Nn),Ie.addEventListener("dblclick",Ts);const Gs=()=>{if(!Eo)return;const tt=Eo.getAttribute("data-node");if(!tt||!We[tt]){Ho();return}const Ct=Tr||We[tt];Gr(Eo,Ct||null)};Ie.addEventListener("mousemove",Qn),Ie.addEventListener("touchstart",Qn,{passive:!0}),t&&(t.addEventListener("mousedown",Ya),t.addEventListener("touchstart",Ya,{passive:!0})),o&&o.addEventListener("resize",Gs);const _s=()=>{Ae()&&(Se()||Ne())};o&&o.addEventListener("scroll",_s,{passive:!0}),ue=()=>{Ie.removeEventListener("mousedown",Va),Ie.removeEventListener("touchstart",Va),o&&(o.removeEventListener("mousemove",za),o.removeEventListener("touchmove",za),o.removeEventListener("mouseup",ba),o.removeEventListener("touchend",ba),o.removeEventListener("mousemove",_a),o.removeEventListener("touchmove",_a),o.removeEventListener("mouseup",Ka),o.removeEventListener("touchend",Ka),o.removeEventListener("mousemove",Qn),o.removeEventListener("touchmove",Qn)),Ie.removeEventListener("mousedown",qa),Ie.removeEventListener("touchstart",qa),Ie.removeEventListener("touchend",Ui),Ie.removeEventListener("mouseover",Hi),Ie.removeEventListener("mouseout",Os),Ie.removeEventListener("mousemove",ws),Ie.removeEventListener("mouseleave",Nn),Ie.removeEventListener("mousemove",Qn),Ie.removeEventListener("touchstart",Qn),Ie.removeEventListener("dblclick",Ts),t&&(t.removeEventListener("mousedown",Ya),t.removeEventListener("touchstart",Ya,{passive:!0})),o&&o.removeEventListener("resize",Gs),o&&o.removeEventListener("scroll",_s),Ea(),Sa=null,Ga=null,jn=null,$n=null,Wn=!1,Yn=null,Ho()},ca()}function ki(){const pe=$t();if(!pe)return;const Ie=Io(),bt=qo(),zt=[{cls:"power",text:Ie[bt]?.diagramLegendPower||Ie.en?.diagramLegendPower||"Power"},{cls:"video",text:Ie[bt]?.diagramLegendVideo||Ie.en?.diagramLegendVideo||"Video"},{cls:"fiz",text:Ie[bt]?.diagramLegendFIZ||Ie.en?.diagramLegendFIZ||"FIZ"}];pe.innerHTML=zt.map(({cls:io,text:lt})=>`<span><span class="swatch ${io}"></span>${lt}</span>`).join("")}return{enableDiagramInteractions:pr,updateDiagramLegend:ki,getDiagramManualPositions:Cn,setManualDiagramPositions:sn,getDiagramCss:_e,diagramConnectorIcons:Tt,diagramIcons:$o,overviewSectionIcons:br,DIAGRAM_MONITOR_ICON:St}}const moduleApi$2=Object.freeze({createConnectionDiagram});MODULE_BASE$4&&MODULE_BASE$4.registerOrQueueModule("cine.features.connectionDiagram",moduleApi$2,{category:"features",description:"Connection diagram rendering and interactions.",replace:!0,connections:["cineModuleBase","cineModuleContext","cineUi"]},e=>safeWarn$4("Unable to register cine.features.connectionDiagram module.",e),GLOBAL_SCOPE$8,MODULE_BASE$4.getModuleRegistry&&MODULE_BASE$4.getModuleRegistry(GLOBAL_SCOPE$8));if(MODULE_BASE$4&&typeof MODULE_BASE$4.exposeGlobal=="function")MODULE_BASE$4.exposeGlobal("cineFeaturesConnectionDiagram",moduleApi$2,GLOBAL_SCOPE$8,{configurable:!0,enumerable:!1,writable:!1}),MODULE_BASE$4.exposeGlobal("renderSetupDiagram",moduleApi$2.createConnectionDiagram,GLOBAL_SCOPE$8,{configurable:!0,enumerable:!1,writable:!0});else try{GLOBAL_SCOPE$8.cineFeaturesConnectionDiagram=moduleApi$2,GLOBAL_SCOPE$8.renderSetupDiagram=moduleApi$2.createConnectionDiagram}catch{}function detectGlobalScope$4(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}var GLOBAL_SCOPE$7=detectGlobalScope$4();function resolveUiHelpers(e){var t=[],o=[];e&&(typeof e=="object"||typeof e=="function")&&o.push(e);try{typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&o.push(CORE_GLOBAL_SCOPE)}catch{}typeof globalThis<"u"&&globalThis&&o.push(globalThis),typeof window<"u"&&window&&o.push(window),typeof self<"u"&&self&&o.push(self),typeof global<"u"&&global&&o.push(global);for(var r=0;r<o.length;r+=1){var n=o[r];if(!(!n||typeof n!="object"&&typeof n!="function"))try{var a=n.cineCoreUiHelpers;a&&typeof a=="object"&&t.push(a)}catch{}}for(var s=0;s<t.length;s+=1){var l=t[s];if(l&&typeof l=="object")return l}return{}}var UI_HELPERS=resolveUiHelpers(GLOBAL_SCOPE$7),escapeHtmlHelper=typeof UI_HELPERS.escapeHtml=="function"?UI_HELPERS.escapeHtml:function e(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},setButtonLabelWithIconHelper=typeof UI_HELPERS.setButtonLabelWithIcon=="function"?UI_HELPERS.setButtonLabelWithIcon:null;function resolveModuleBase$3(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}var MODULE_BASE$3=resolveModuleBase$3(GLOBAL_SCOPE$7);if(!MODULE_BASE$3)throw new Error("cineResults: MODULE_BASE not found");var moduleRegistry$2=typeof MODULE_BASE$3.getModuleRegistry=="function"?MODULE_BASE$3.getModuleRegistry(GLOBAL_SCOPE$7):null,freezeDeep$3=typeof MODULE_BASE$3.freezeDeep=="function"?function e(t){try{return MODULE_BASE$3.freezeDeep(t)}catch{}return t}:function e(t){return t},exposeGlobal$3=typeof MODULE_BASE$3.exposeGlobal=="function"?function e(t,o,r){return MODULE_BASE$3.exposeGlobal(t,o,GLOBAL_SCOPE$7,r||{})}:function e(t,o){try{return GLOBAL_SCOPE$7[t]=o,!0}catch{}return!1},registerOrQueueModule$3=typeof MODULE_BASE$3.registerOrQueueModule=="function"?function e(t,o,r,n){return MODULE_BASE$3.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$7,moduleRegistry$2)}:function e(){return!1},safeWarn$3=typeof MODULE_BASE$3.safeWarn=="function"?function e(t,o){try{MODULE_BASE$3.safeWarn(t,o)}catch{}}:function e(t,o){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof o>"u"?console.warn(t):console.warn(t,o)}catch{}},runtimeFeedbackState={elements:{},handlers:{},feedbackFieldCache:[],feedbackFieldCacheDoc:null,feedbackOptionFallbacks:Object.create(null),collatorCache:Object.create(null),fallbackCollator:null,sensorModeFrameRateMap:Object.create(null),allFrameRateOptions:[],selectedSensorMode:"",selectedFramerate:"",dependencies:{mailTarget:"info@lucazanner.de",document:null,window:null,navigator:null,alert:null,openDialog:null,closeDialog:null,getCurrentSetupKey:null,loadFeedback:null,saveFeedback:null,updateCalculations:null,renderFeedbackTable:null,dispatchTemperatureNoteRender:null,refreshFeedbackTemperatureLabel:null,updateFeedbackTemperatureOptions:null,refreshTotalCurrentLabels:null,updateMountVoltageSettingLabels:null,setButtonLabelWithIcon:setButtonLabelWithIconHelper,iconGlyphs:null,getSelectedPlate:null,getMountVoltageConfig:null,updateBatteryOptions:null,setStatusMessage:null,setStatusLevel:null,closePowerWarningDialog:null,showPowerWarningDialog:null,drawPowerDiagram:null,renderTemperatureNote:null,checkFizCompatibility:null,checkFizController:null,checkArriCompatibility:null,renderSetupDiagram:null,refreshGearListIfVisible:null,supportsBMountCamera:null,supportsGoldMountCamera:null,getCssVariableValue:null,escapeHtml:escapeHtmlHelper,getLastRuntimeHours:null,setLastRuntimeHours:null,getDevices:null,getTexts:null,getCurrentLang:null,getCollator:null}};function refreshFeedbackFieldCache(e){if(!e)return runtimeFeedbackState.feedbackFieldCache=[],runtimeFeedbackState.feedbackFieldCacheDoc=null,runtimeFeedbackState.feedbackFieldCache;for(var t=[],o=0;o<FEEDBACK_FIELD_MAP.length;o+=1){var r=FEEDBACK_FIELD_MAP[o],n=null;try{n=e.getElementById(r.id)}catch{n=null}t.push({map:r,element:n})}return runtimeFeedbackState.feedbackFieldCache=t,runtimeFeedbackState.feedbackFieldCacheDoc=e,t}function getFeedbackFieldEntries(e){if(!e)return[];if(runtimeFeedbackState.feedbackFieldCacheDoc!==e||!runtimeFeedbackState.feedbackFieldCache||runtimeFeedbackState.feedbackFieldCache.length!==FEEDBACK_FIELD_MAP.length)return refreshFeedbackFieldCache(e);for(var t=runtimeFeedbackState.feedbackFieldCache,o=0;o<t.length;o+=1){var r=t[o];if(!r||!r.map)return refreshFeedbackFieldCache(e);var n=r.element;if(!n||typeof n.isConnected=="boolean"&&!n.isConnected){var a=null;try{a=e.getElementById(r.map.id)}catch{a=null}r.element=a}}return t}var FEEDBACK_FIELD_MAP=[{id:"fbUsername",key:"username",trim:!0},{id:"fbDate",key:"date",trim:!1},{id:"fbLocation",key:"location",trim:!0},{id:"fbCamera",key:"camera",trim:!0},{id:"fbBatteryPlate",key:"batteryPlate",trim:!0},{id:"fbLensMount",key:"lensMount",trim:!0},{id:"fbResolution",key:"resolution",trim:!0},{id:"fbCodec",key:"codec",trim:!0},{id:"fbSensorMode",key:"sensorMode",trim:!0},{id:"fbFramerate",key:"framerate",trim:!0},{id:"fbWifi",key:"cameraWifi",trim:!1},{id:"fbFirmware",key:"firmware",trim:!0},{id:"fbBattery",key:"battery",trim:!0},{id:"fbBatteryAge",key:"batteryAge",trim:!0},{id:"fbWirelessVideo",key:"wirelessVideo",trim:!0},{id:"fbMonitor",key:"monitor",trim:!0},{id:"fbMonitorBrightness",key:"monitorBrightness",trim:!0},{id:"fbLens",key:"lens",trim:!0},{id:"fbLensData",key:"lensData",trim:!0},{id:"fbControllers",key:"controllers",trim:!0},{id:"fbMotors",key:"motors",trim:!0},{id:"fbDistance",key:"distance",trim:!0},{id:"fbTemperature",key:"temperature",trim:!0},{id:"fbCharging",key:"charging",trim:!0},{id:"fbRuntime",key:"runtime",trim:!0},{id:"fbBatteriesPerDay",key:"batteriesPerDay",trim:!0}],FEEDBACK_OPTION_TARGETS={lensMount:{elementName:"feedbackMountOptions",elementId:"mountOptions"},resolution:{elementName:"feedbackResolutionOptions",elementId:"resolutionOptions"},codec:{elementName:"feedbackCodecOptions",elementId:"codecOptions"}};function getFeedbackOptionFallbacks(){var e=runtimeFeedbackState.feedbackOptionFallbacks;return(!e||typeof e!="object")&&(e=Object.create(null),runtimeFeedbackState.feedbackOptionFallbacks=e),e}function extractDatalistValues(e){var t=[];if(!e)return t;var o=null;try{o=e.options}catch{o=null}if(o&&typeof o.length=="number"){for(var r=0;r<o.length;r+=1){var n=o[r];if(n){var a="";typeof n.value=="string"&&n.value?a=n.value:typeof n.getAttribute=="function"?a=n.getAttribute("value")||"":typeof n.textContent=="string"&&n.textContent&&(a=n.textContent),a&&t.push(a)}}return t}if(e.childNodes&&typeof e.childNodes.length=="number")for(var s=0;s<e.childNodes.length;s+=1){var l=e.childNodes[s];if(l){var u="";typeof l.value=="string"&&l.value?u=l.value:typeof l.getAttribute=="function"?u=l.getAttribute("value")||"":typeof l.textContent=="string"&&l.textContent&&(u=l.textContent),u&&t.push(u)}}return t}function storeFeedbackOptionFallback(e,t){if(!(!e||!t)){var o=getFeedbackOptionFallbacks();o[e]||(o[e]=extractDatalistValues(t))}}function escapeAttributeValue(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function replaceDatalistOptions(e,t){if(e){for(var o=Array.isArray(t)?t:[],r="",n=0;n<o.length;n+=1)r+='<option value="'+escapeAttributeValue(o[n])+'"></option>';if(typeof e.innerHTML=="string")try{e.innerHTML=r;return}catch{}var a=null;try{a=e.ownerDocument||null}catch{a=null}if(a||(a=resolveDocument$1()),!(!a||typeof a.createElement!="function"||typeof e.appendChild!="function")){try{for(;e.firstChild;)e.removeChild(e.firstChild)}catch{}for(var s=0;s<o.length;s+=1){var l=null;try{l=a.createElement("option")}catch{l=null}if(l){var u=o[s];try{l.value=u}catch{typeof l.setAttribute=="function"&&l.setAttribute("value",u)}if(typeof l.textContent=="string")try{l.textContent=u}catch{}try{e.appendChild(l)}catch{}}}}}}function getFeedbackSelectElement(e,t){if(runtimeFeedbackState.elements[e])return runtimeFeedbackState.elements[e];var o=resolveDocument$1();if(!o||!t)return null;var r=null;try{r=o.getElementById(t)}catch{r=null}return r&&(runtimeFeedbackState.elements[e]=r),r}function escapeOptionText(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function replaceSelectOptions(e,t,o,r){if(!e)return"";for(var n=Object.create(null),a=[],s=Array.isArray(t)?t:[],l=0;l<s.length;l+=1){var u=s[l];if(u!=null){var d=String(u);if(d){var m=d.trim();m&&(Object.prototype.hasOwnProperty.call(n,m)||(n[m]=!0,a.push(m)))}}}for(var y=['<option value="">--</option>'],h=0;h<a.length;h+=1){var b=escapeOptionText(a[h]);y.push('<option value="'+b+'">'+b+"</option>")}var v=y.join(""),C=!1;if(typeof e.innerHTML=="string")try{e.innerHTML=v,C=!0}catch{C=!1}if(!C){var A=null;try{A=e.ownerDocument||null}catch{A=null}if(A||(A=resolveDocument$1()),A&&typeof A.createElement=="function"&&typeof e.appendChild=="function"){try{for(;e.firstChild;)e.removeChild(e.firstChild)}catch{}var w=null;try{w=A.createElement("option")}catch{w=null}if(w){try{w.value=""}catch{typeof w.setAttribute=="function"&&w.setAttribute("value","")}if(typeof w.textContent=="string")try{w.textContent="--"}catch{}try{e.appendChild(w)}catch{}}for(var R=0;R<a.length;R+=1){var _=null;try{_=A.createElement("option")}catch{_=null}if(_){var G=a[R];try{_.value=G}catch{typeof _.setAttribute=="function"&&_.setAttribute("value",G)}if(typeof _.textContent=="string")try{_.textContent=G}catch{}try{e.appendChild(_)}catch{}}}}}var O=typeof o=="string"?o:"",B="";O&&a.indexOf(O)!==-1?B=O:r&&a.length&&(B=a[0]);try{e.value=B}catch{typeof e.setAttribute=="function"&&e.setAttribute("value",B)}var $=null;try{$=e.options||null}catch{$=null}if($&&typeof $.length=="number")for(var V=0;V<$.length;V+=1){var M=$[V];if(M){var F="";try{F=typeof M.value=="string"?M.value:""}catch{F=""}var z=F===B;if(typeof M.selected=="boolean")try{M.selected=z}catch{}else if(z&&typeof M.setAttribute=="function")try{M.setAttribute("selected","selected")}catch{}else if(!z&&typeof M.removeAttribute=="function")try{M.removeAttribute("selected")}catch{}}}if(typeof e.selectedIndex=="number"&&$&&typeof $.length=="number"){for(var x=-1,H=0;H<$.length;H+=1){var W=$[H];if(W){var U="";try{U=typeof W.value=="string"?W.value:""}catch{U=""}if(U===B){x=H;break}}}try{e.selectedIndex=x}catch{}}return B}function normalizeSensorModeKey(e){if(typeof e!="string")return"";var t=e.trim();return t?t.toLowerCase().replace(/\s+/g," "):""}var CANONICAL_FRAME_RATE_VALUES=Object.freeze([.75,1,8,12,12.5,15,23.976,24,25,29.97,30,36,40,47.952,48,50,59.94,60,72,75,80,90,96,100,110,112,120,144,150,160,168,170,180,200,240,290,300]);function resolveCanonicalFrameRateValue(e){if(typeof e!="number"||!Number.isFinite(e))return e;for(var t=.05,o=e,r=t+1,n=0;n<CANONICAL_FRAME_RATE_VALUES.length;n+=1){var a=CANONICAL_FRAME_RATE_VALUES[n],s=Math.abs(a-e);s<=t&&s<r&&(o=a,r=s)}return o}function formatFrameRateLabel(e){if(typeof e!="number"||!Number.isFinite(e))return"";var t=Math.round(e);if(Math.abs(t-e)<5e-4)return String(t);var o=e.toFixed(3).replace(/0+$/,"").replace(/\.$/,"");return o}function appendFrameRateOption(e,t,o){if(!(typeof o!="number"||!Number.isFinite(o))){var r=resolveCanonicalFrameRateValue(o),n=formatFrameRateLabel(r);if(n){var a=n+" fps";Object.prototype.hasOwnProperty.call(t,a)||(t[a]=r,e.push({numeric:r,label:a}))}}}function appendFrameRateRange(e,t,o,r){if(!(typeof o!="number"||!Number.isFinite(o)||typeof r!="number"||!Number.isFinite(r))){var n=o,a=r;if(n>a){var s=n;n=a,a=s}for(var l=.05,u=0;u<CANONICAL_FRAME_RATE_VALUES.length;u+=1){var d=CANONICAL_FRAME_RATE_VALUES[u];if(!(d+l<n)){if(d-l>a)break;appendFrameRateOption(e,t,d)}}appendFrameRateOption(e,t,n),appendFrameRateOption(e,t,a)}}function sortFrameRateOptionsInPlace(e){Array.isArray(e)&&e.sort(function(o,r){var n=parseFloat(o),a=parseFloat(r);if(Number.isFinite(n)&&Number.isFinite(a)){if(n<a)return-1;if(n>a)return 1}return o<r?-1:o>r?1:0})}function parseFrameRateOptions(e){if(typeof e!="string")return[];var t=e.trim();if(!t)return[];var o=t.lastIndexOf(":"),r=o!==-1?t.slice(o+1):t,n=r.replace(/\([^)]*\)/g," "),a=[];if(n.replace(/([0-9]+(?:\.[0-9]+)?)/g,function(V,M){var F=parseFloat(M);return Number.isFinite(F)&&a.push(F),M}),!a.length)return[];var s=[],l=Object.create(null),u=/[0-9]\s*\//.test(n),d=/[0-9]\s*,\s*[0-9]/.test(n),m=/\b(?:or|and)\b/i.test(n),y=/up to/i.test(n)||/\bmax(?:imum)?\b/i.test(n),h=/\bbetween\b/i.test(n),b=/(?:–|-|\bto\b)/i.test(n);if(y){var v=Math.max.apply(Math,a),C=a.length>1?Math.min.apply(Math,a):1;appendFrameRateRange(s,l,C,v)}else if((b||h)&&a.length>=2){var A=Math.min.apply(Math,a),w=Math.max.apply(Math,a);appendFrameRateRange(s,l,A,w)}else if(u||d||m&&a.length>1)for(var R=0;R<a.length;R+=1)appendFrameRateOption(s,l,a[R]);else if(a.length===1)appendFrameRateOption(s,l,a[0]);else{var _=Math.min.apply(Math,a),G=Math.max.apply(Math,a);appendFrameRateRange(s,l,_,G)}s.sort(function(V,M){return V.numeric<M.numeric?-1:V.numeric>M.numeric?1:V.label<M.label?-1:V.label>M.label?1:0});for(var O=[],B=0;B<s.length;B+=1)O.push(s[B].label);return O}function collectAllFrameRateOptions(e){for(var t=[],o=Object.create(null),r=Array.isArray(e)?e:[],n=0;n<r.length;n+=1)for(var a=parseFrameRateOptions(r[n]),s=0;s<a.length;s+=1){var l=a[s];Object.prototype.hasOwnProperty.call(o,l)||(o[l]=!0,t.push(l))}return sortFrameRateOptionsInPlace(t),t}function tokenizeComparisonValue(e){if(typeof e!="string")return[];var t=e.replace(/\([^)]*\)/g," "),o=t.replace(/[^0-9a-zA-Z]+/g," ").toLowerCase().trim();if(!o)return[];for(var r=o.split(/\s+/),n=[],a=0;a<r.length;a+=1){var s=r[a];s&&(/^\d$/.test(s)||n.push(s))}return n}function doesFrameRateMatchSensorMode(e,t){var o=tokenizeComparisonValue(t);if(!o.length)return!1;var r=tokenizeComparisonValue(e);if(!r.length)return!1;for(var n=Object.create(null),a=0;a<r.length;a+=1)n[r[a]]=!0;for(var s=0,l=0;l<o.length;l+=1)n[o[l]]&&(s+=1);if(!s)return!1;var u=o.length;return o.length>=3&&(u=o.length-1),s>=Math.max(1,u)}function buildSensorModeFrameRateMap(e,t){for(var o=Object.create(null),r=Array.isArray(e)?e:[],n=Array.isArray(t)?t:[],a=0;a<r.length;a+=1){var s=r[a];if(typeof s=="string"){var l=s.trim();if(l){var u=normalizeSensorModeKey(l);u&&(o[u]||(o[u]=[]))}}}for(var d=0;d<n.length;d+=1){var m=n[d];if(typeof m=="string"){var y=m.trim();if(y){var h=parseFrameRateOptions(y);if(h.length)for(var b=0;b<r.length;b+=1){var v=r[b];if(typeof v=="string"){var C=v.trim();if(C){var A=normalizeSensorModeKey(C);if(A&&doesFrameRateMatchSensorMode(y,C)){o[A]||(o[A]=[]);for(var w=0;w<h.length;w+=1){var R=h[w];o[A].indexOf(R)===-1&&o[A].push(R)}}}}}}}}for(var _ in o)Object.prototype.hasOwnProperty.call(o,_)&&sortFrameRateOptionsInPlace(o[_]);return o}function updateSensorModeSelectOptions(e,t){var o=getFeedbackSelectElement("sensorModeSelect","fbSensorMode");if(!o)return"";var r=typeof t=="string"?t:"",n=replaceSelectOptions(o,e,r,!0);return runtimeFeedbackState.selectedSensorMode=n,n}function updateFramerateSelectOptionsForSensorMode(e,t){var o=getFeedbackSelectElement("framerateSelect","fbFramerate");if(!o)return"";var r=runtimeFeedbackState.sensorModeFrameRateMap||{},n=Array.isArray(runtimeFeedbackState.allFrameRateOptions)?runtimeFeedbackState.allFrameRateOptions:[],a=normalizeSensorModeKey(e),s=a&&r[a]&&r[a].length?r[a]:[],l=typeof t=="string"?t:"",u=!!a&&s.length>0,d=replaceSelectOptions(o,a?s:n,l,u);return runtimeFeedbackState.selectedFramerate=d,d}function resolveFeedbackOptionElement(e){if(!e)return null;var t=runtimeFeedbackState.elements[e.elementName];if(t)return storeFeedbackOptionFallback(e.elementName,t),t;var o=resolveDocument$1();if(!o)return null;var r=null;try{r=o.getElementById(e.elementId)}catch{r=null}return r&&(runtimeFeedbackState.elements[e.elementName]=r,storeFeedbackOptionFallback(e.elementName,r)),r}function updateFeedbackOptionList(e,t){var o=FEEDBACK_OPTION_TARGETS[e];if(o){var r=resolveFeedbackOptionElement(o);if(r){var n=getFeedbackOptionFallbacks(),a=n[o.elementName]||[],s=[],l=Object.create(null);if(Array.isArray(t))for(var u=0;u<t.length;u+=1){var d=t[u];if(d!=null){var m=String(d).trim();m&&(Object.prototype.hasOwnProperty.call(l,m)||(l[m]=!0,s.push(m)))}}s.length||(s=a.slice()),replaceDatalistOptions(r,s)}}}function captureFeedbackOptionElements(e){if(e){for(var t in FEEDBACK_OPTION_TARGETS)if(Object.prototype.hasOwnProperty.call(FEEDBACK_OPTION_TARGETS,t)){var o=FEEDBACK_OPTION_TARGETS[t];if(o){if(runtimeFeedbackState.elements[o.elementName]){storeFeedbackOptionFallback(o.elementName,runtimeFeedbackState.elements[o.elementName]);continue}var r=null;try{r=e.getElementById(o.elementId)}catch{r=null}r&&(runtimeFeedbackState.elements[o.elementName]=r,storeFeedbackOptionFallback(o.elementName,r))}}}}function normalizeCameraListValue(e,t){if(e==null)return"";if(typeof e=="string")return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);if(e&&typeof e=="object")for(var o=Array.isArray(t)?t:[],r=0;r<o.length;r+=1){var n=o[r];if(n){var a=e[n];if(typeof a=="string"&&a.trim())return a.trim()}}return""}function collectLensMountValues(e){if(!e||typeof e!="object")return[];var t=[],o=e.lensMount;if(Array.isArray(o))for(var r=0;r<o.length;r+=1){var n=o[r];if(n){var a=normalizeCameraListValue(n.type||n,[]);if(a){var s="";typeof n.mount=="string"&&n.mount.trim()&&(s=n.mount.trim());var l=a;s&&(l+=" ("+s+")"),t.push(l)}}}if(!t.length&&Array.isArray(e.mountOptions))for(var u=e.mountOptions,d=0;d<u.length;d+=1){var m=u[d],y=normalizeCameraListValue(m,["type","name"]);y&&t.push(y)}return t}function collectCameraValues(e,t,o){if(!e||typeof e!="object")return[];var r=e[t];if(!Array.isArray(r))return[];for(var n=[],a=0;a<r.length;a+=1){var s=normalizeCameraListValue(r[a],o);s&&n.push(s)}return n}function updateRuntimeFeedbackCameraOptionLists(e,t){var o=null;e&&t&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,t)&&(o=e[t]);var r=collectLensMountValues(o),n=collectCameraValues(o,"resolutions",["label","name","value"]),a=collectCameraValues(o,"recordingCodecs",["label","name","codec","type"]),s=collectCameraValues(o,"sensorModes",["label","name","mode"]),l=collectCameraValues(o,"frameRates",["label","name","rate","value"]);updateFeedbackOptionList("lensMount",r),updateFeedbackOptionList("resolution",n),updateFeedbackOptionList("codec",a),runtimeFeedbackState.allFrameRateOptions=collectAllFrameRateOptions(l),runtimeFeedbackState.sensorModeFrameRateMap=buildSensorModeFrameRateMap(s,l);var u=getFeedbackSelectElement("sensorModeSelect","fbSensorMode"),d=getFeedbackSelectElement("framerateSelect","fbFramerate"),m=u&&typeof u.value=="string"?u.value:runtimeFeedbackState.selectedSensorMode,y=updateSensorModeSelectOptions(s,m),h=d&&typeof d.value=="string"?d.value:runtimeFeedbackState.selectedFramerate;updateFramerateSelectOptionsForSensorMode(y,h)}function resolveDocument$1(e){return e&&e.document&&typeof e.document=="object"?e.document:runtimeFeedbackState.dependencies.document?runtimeFeedbackState.dependencies.document:typeof document<"u"&&document?document:GLOBAL_SCOPE$7&&GLOBAL_SCOPE$7.document?GLOBAL_SCOPE$7.document:null}function assignFunctionDependency(e,t,o){if(t&&typeof t[o]=="function"){e[o]=t[o];return}!e[o]&&GLOBAL_SCOPE$7&&typeof GLOBAL_SCOPE$7[o]=="function"&&(e[o]=GLOBAL_SCOPE$7[o])}function updateRuntimeDependencies(e){var t=runtimeFeedbackState.dependencies,o=e||{},r=resolveDocument$1(o);r&&(t.document=r);var n=null;o.window&&typeof o.window=="object"?n=o.window:t.window?n=t.window:typeof window<"u"&&window?n=window:GLOBAL_SCOPE$7&&GLOBAL_SCOPE$7.window&&(n=GLOBAL_SCOPE$7.window),n&&(t.window=n);var a=null;o.navigator&&typeof o.navigator=="object"?a=o.navigator:t.navigator?a=t.navigator:n&&n.navigator?a=n.navigator:typeof navigator<"u"&&navigator&&(a=navigator),a&&(t.navigator=a);var s=null;return typeof o.alert=="function"?s=o.alert:t.alert?s=t.alert:n&&typeof n.alert=="function"?s=n.alert:GLOBAL_SCOPE$7&&typeof GLOBAL_SCOPE$7.alert=="function"&&(s=GLOBAL_SCOPE$7.alert),s&&(t.alert=s),assignFunctionDependency(t,o,"openDialog"),assignFunctionDependency(t,o,"closeDialog"),assignFunctionDependency(t,o,"getCurrentSetupKey"),assignFunctionDependency(t,o,"loadFeedback"),assignFunctionDependency(t,o,"saveFeedback"),assignFunctionDependency(t,o,"updateCalculations"),assignFunctionDependency(t,o,"renderFeedbackTable"),assignFunctionDependency(t,o,"dispatchTemperatureNoteRender"),assignFunctionDependency(t,o,"refreshFeedbackTemperatureLabel"),assignFunctionDependency(t,o,"updateFeedbackTemperatureOptions"),assignFunctionDependency(t,o,"refreshTotalCurrentLabels"),assignFunctionDependency(t,o,"updateMountVoltageSettingLabels"),assignFunctionDependency(t,o,"setButtonLabelWithIcon"),assignFunctionDependency(t,o,"getSelectedPlate"),assignFunctionDependency(t,o,"getMountVoltageConfig"),assignFunctionDependency(t,o,"updateBatteryOptions"),assignFunctionDependency(t,o,"setStatusMessage"),assignFunctionDependency(t,o,"setStatusLevel"),assignFunctionDependency(t,o,"closePowerWarningDialog"),assignFunctionDependency(t,o,"showPowerWarningDialog"),assignFunctionDependency(t,o,"drawPowerDiagram"),assignFunctionDependency(t,o,"renderTemperatureNote"),assignFunctionDependency(t,o,"checkFizCompatibility"),assignFunctionDependency(t,o,"checkFizController"),assignFunctionDependency(t,o,"checkArriCompatibility"),assignFunctionDependency(t,o,"renderSetupDiagram"),assignFunctionDependency(t,o,"refreshGearListIfVisible"),assignFunctionDependency(t,o,"supportsBMountCamera"),assignFunctionDependency(t,o,"supportsGoldMountCamera"),assignFunctionDependency(t,o,"getCssVariableValue"),assignFunctionDependency(t,o,"escapeHtml"),assignFunctionDependency(t,o,"getLastRuntimeHours"),assignFunctionDependency(t,o,"setLastRuntimeHours"),assignFunctionDependency(t,o,"getDevices"),assignFunctionDependency(t,o,"getTexts"),assignFunctionDependency(t,o,"getCurrentLang"),assignFunctionDependency(t,o,"getCollator"),o.iconGlyphs&&typeof o.iconGlyphs=="object"?t.iconGlyphs=o.iconGlyphs:!t.iconGlyphs&&GLOBAL_SCOPE$7&&GLOBAL_SCOPE$7.ICON_GLYPHS&&(t.iconGlyphs=GLOBAL_SCOPE$7.ICON_GLYPHS),typeof o.mailTarget=="string"&&o.mailTarget.trim()?t.mailTarget=o.mailTarget.trim():t.mailTarget||(t.mailTarget="info@lucazanner.de"),t.loadFeedback||(t.loadFeedback=function(){return{}}),t.saveFeedback||(t.saveFeedback=function(){}),t.updateCalculations||(t.updateCalculations=function(){}),t.getCurrentSetupKey||(t.getCurrentSetupKey=function(){return""}),t}function resolveElementFromOptions(e,t,o,r){var n=e||{},a=n.elements&&typeof n.elements=="object"?n.elements:null;if(a&&a[t])return a[t];if(n[t])return n[t];if(runtimeFeedbackState.elements[t])return runtimeFeedbackState.elements[t];var s=resolveDocument$1(n);if(s&&o){var l=null;try{l=s.getElementById(o)}catch{l=null}if(l)return l}var u=r||t;return GLOBAL_SCOPE$7&&GLOBAL_SCOPE$7[u]?GLOBAL_SCOPE$7[u]:null}function getLocaleAwareCollator(e,t){if(e&&typeof e.compare=="function")return e;var o=runtimeFeedbackState.collatorCache;(!o||typeof o!="object")&&(o=Object.create(null),runtimeFeedbackState.collatorCache=o);var r=typeof t=="string"?t.trim():"",n=r||"default",a=o[n];if(a&&typeof a.compare=="function")return a;var s=null;if(typeof Intl<"u"&&typeof Intl.Collator=="function")for(var l=n==="default"?[void 0]:[r,void 0],u=0;u<l.length;u+=1){var d=l[u];if(!(typeof d=="string"&&!d))try{s=new Intl.Collator(d,{numeric:!0,sensitivity:"base"});break}catch{s=null}}if(!s){var m=runtimeFeedbackState.fallbackCollator;(!m||typeof m.compare!="function")&&(m={compare:function(h,b){return String(h).localeCompare(String(b))}},runtimeFeedbackState.fallbackCollator=m),s=m}return o[n]=s,s}function toArray(e){return e?Array.isArray(e)?e.filter(Boolean):typeof e.length=="number"?Array.prototype.slice.call(e).filter(Boolean):[e].filter(Boolean):[]}function resolveSelectCollection(e,t,o,r){var n=e||{},a=n.elements&&typeof n.elements=="object"?n.elements:null,s=null;a&&a[t]?s=a[t]:n[t]?s=n[t]:runtimeFeedbackState.elements[t]?s=runtimeFeedbackState.elements[t]:GLOBAL_SCOPE$7&&r&&GLOBAL_SCOPE$7[r]&&(s=GLOBAL_SCOPE$7[r]);var l=toArray(s);if(l.length)return runtimeFeedbackState.elements[t]=l,l;var u=[],d=resolveDocument$1(n);if(d&&Array.isArray(o))for(var m=0;m<o.length;m+=1){var y=o[m];if(y){var h=null;try{h=d.getElementById(y)}catch{h=null}h&&u.push(h)}}return runtimeFeedbackState.elements[t]=u,u}function setHelpAttribute(e,t){if(e)if(t&&typeof t=="string"&&t.trim())try{e.setAttribute("data-help",t)}catch{}else try{e.removeAttribute("data-help")}catch{}}function getNonEmptyString(e){if(typeof e!="string")return"";var t=e.trim();return t||""}function replaceSummaryTokens(e,t){if(typeof e!="string"||!e)return"";var o=e;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r],a="{"+r+"}";if(o.indexOf(a)!==-1){var s=typeof n>"u"?"":String(n);o=o.split(a).join(s)}}return o}function selectSummaryBatteryName(e,t,o){var r=getNonEmptyString(e);if(r)return r;var n=getNonEmptyString(t);return n||getNonEmptyString(o)}function formatRuntimeHoursForSummary(e){return Number.isFinite(e)?e>=10?e.toFixed(1):e.toFixed(2):""}function formatCurrentForSummary(e){return Number.isFinite(e)?e.toFixed(2):"0.00"}function coerceCurrentLimit(e){if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="string"){var t=e.trim();if(!t)return null;var o=t.replace(/,/g,"."),r=parseFloat(o);return Number.isFinite(r)?r:null}return null}function resolvePinsStatusText(e,t){var o=Number.isFinite(t.current)?t.current:0,r=Number.isFinite(t.limit)?t.limit:null;if(o<=0)return e("resultsPlainSummaryPinsZero");if(!Number.isFinite(r)||r<=0){var n=e("resultsPlainSummaryPinsUnknown");return replaceSummaryTokens(n,{current:formatCurrentForSummary(o)})}var a={current:formatCurrentForSummary(o),max:String(r)};return o>r?replaceSummaryTokens(e("resultsPlainSummaryPinsExceeded"),a):o>=r*.8?replaceSummaryTokens(e("resultsPlainSummaryPinsNear"),a):replaceSummaryTokens(e("resultsPlainSummaryPinsOk"),a)}function resolveDtapStatusText(e,t){var o=Number.isFinite(t.current)?t.current:0,r=Number.isFinite(t.limit)?t.limit:null,n=t.hasRating,a=t.allowed,s=t.bMountCam;if(!a){if(s)return e("resultsPlainSummaryDtapUnavailableBMount");if(!n){var l=e("resultsPlainSummaryDtapUnknown");return replaceSummaryTokens(l,{current:formatCurrentForSummary(o)})}return e("resultsPlainSummaryDtapUnavailable")}if(o<=0)return e("resultsPlainSummaryDtapZero");if(!Number.isFinite(r)||r<=0){var u=e("resultsPlainSummaryDtapUnknown");return replaceSummaryTokens(u,{current:formatCurrentForSummary(o)})}var d={current:formatCurrentForSummary(o),max:String(r)};return o>r?replaceSummaryTokens(e("resultsPlainSummaryDtapExceeded"),d):o>=r*.8?replaceSummaryTokens(e("resultsPlainSummaryDtapNear"),d):replaceSummaryTokens(e("resultsPlainSummaryDtapOk"),d)}function buildPowerOutputSummaryText(e,t){if(typeof e!="function")return"";var o=t||{},r=[],n=resolvePinsStatusText(e,{current:o.current,limit:o.pinLimit});n&&r.push(n);var a=resolveDtapStatusText(e,{current:o.current,limit:o.dtapLimit,hasRating:o.hasDtapRating,allowed:o.dtapAllowed,bMountCam:o.bMountCam});return a&&r.push(a),r.join(" ")}function buildPlainSummaryText(e){var t=e||{},o=getNonEmptyString(t.summaryPrompt),r=getNonEmptyString(t.needBatterySummary)||o,n=getNonEmptyString(t.unnamedBatteryLabel),a=selectSummaryBatteryName(t.batteryLabelText,t.battery,n),s=Number.isFinite(t.totalWatt)?t.totalWatt.toFixed(1):"0.0";if(!t.battery){var l=t.totalWatt>0?r:o;return l||r||o||a||""}if(!Number.isFinite(t.runtimeHoursValue)){if(t.unlimitedSummaryTemplate&&Number.isFinite(t.totalWatt)&&t.totalWatt===0){var u=replaceSummaryTokens(t.unlimitedSummaryTemplate,{batteryName:a||n||"",totalPower:s});if(u)return u}return r||o||a||""}if(t.runtimeSummaryTemplate&&t.batteriesNeededValue!==null&&Number.isFinite(t.batteriesNeededValue)&&t.batteriesNeededValue>0){var d=formatRuntimeHoursForSummary(t.runtimeHoursValue),m=replaceSummaryTokens(t.runtimeSummaryTemplate,{batteryName:a||n||"",hours:d,batteryCount:String(t.batteriesNeededValue),totalPower:s});if(m)return m}return o||r||a||""}function createTextResolver(e,t){var o=e&&typeof e=="object"?e:{},r=t&&typeof t=="object"?t:{};return function(a){if(!a)return"";var s=o[a];if(typeof s=="string"){var l=s.trim();if(l)return l}if(s=r[a],typeof s=="string"){var u=s.trim();if(u)return u}return""}}var TEMPERATURE_NOTE_PROFILES=freezeDeep$3([{celsius:25,multiplier:1},{celsius:0,multiplier:1.25},{celsius:-10,multiplier:1.6},{celsius:-20,multiplier:2}]);function resolveEscapeHtml(){var e=runtimeFeedbackState&&runtimeFeedbackState.dependencies?runtimeFeedbackState.dependencies.escapeHtml:null;return!e&&GLOBAL_SCOPE$7&&typeof GLOBAL_SCOPE$7.escapeHtml=="function"&&(e=GLOBAL_SCOPE$7.escapeHtml),typeof e=="function"?e:function(o){var r=o==null?"":String(o);return r.replace(/[&<>"']/g,function(a){switch(a){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return a}})}}function normaliseTemperatureUnitPreference(e){if(typeof e!="string")return"celsius";var t=e.trim().toLowerCase();return t==="fahrenheit"||t==="f"||t==="°f"?"fahrenheit":t==="kelvin"||t==="k"?"kelvin":"celsius"}function resolveTemperatureUnitPreference(){var e=[];runtimeFeedbackState&&runtimeFeedbackState.dependencies&&(typeof runtimeFeedbackState.dependencies.temperatureUnit=="string"&&e.push(runtimeFeedbackState.dependencies.temperatureUnit),runtimeFeedbackState.dependencies.sessionGlobalScope&&typeof runtimeFeedbackState.dependencies.sessionGlobalScope.temperatureUnit=="string"&&e.push(runtimeFeedbackState.dependencies.sessionGlobalScope.temperatureUnit)),GLOBAL_SCOPE$7&&(typeof GLOBAL_SCOPE$7.temperatureUnit=="string"&&e.push(GLOBAL_SCOPE$7.temperatureUnit),GLOBAL_SCOPE$7.sessionGlobalScope&&typeof GLOBAL_SCOPE$7.sessionGlobalScope.temperatureUnit=="string"&&e.push(GLOBAL_SCOPE$7.sessionGlobalScope.temperatureUnit),typeof GLOBAL_SCOPE$7.localTemperatureUnit=="string"&&e.push(GLOBAL_SCOPE$7.localTemperatureUnit));for(var t=0;t<e.length;t+=1){var o=e[t],r=normaliseTemperatureUnitPreference(o);if(r)return r==="kelvin"?"celsius":r}return"celsius"}function createNumberFormatter(e,t,o){try{var r=new Intl.NumberFormat(e||"en",t||{});return function(s){return r.format(s)}}catch{}var n=typeof o=="number"?o:0;return function(s){if(typeof s!="number"||!Number.isFinite(s))return String(s);try{return s.toFixed(n)}catch{}return String(s)}}function resolveLanguageFromContext(e){var t=null;if(runtimeFeedbackState&&runtimeFeedbackState.dependencies){var o=runtimeFeedbackState.dependencies.getCurrentLang;if(typeof o=="function")try{t=o()}catch{}}return!t&&GLOBAL_SCOPE$7&&typeof GLOBAL_SCOPE$7.currentLang=="string"&&(t=GLOBAL_SCOPE$7.currentLang),!t&&e&&e.documentElement&&typeof e.documentElement.lang=="string"&&(t=e.documentElement.lang),typeof t!="string"||!t?"en":t}function resolveLanguageTexts(e){var t=null;if(runtimeFeedbackState&&runtimeFeedbackState.dependencies){var o=runtimeFeedbackState.dependencies.getTexts;if(typeof o=="function")try{t=o()}catch{}}!t&&GLOBAL_SCOPE$7&&GLOBAL_SCOPE$7.texts&&typeof GLOBAL_SCOPE$7.texts=="object"&&(t=GLOBAL_SCOPE$7.texts);var r=t&&t.en||{};if(!e||!t)return{langTexts:r,fallbackTexts:r};if(t[e])return{langTexts:t[e],fallbackTexts:r};var n=e.indexOf("-");if(n!==-1){var a=e.slice(0,n);if(t[a])return{langTexts:t[a],fallbackTexts:r}}return{langTexts:r,fallbackTexts:r}}function convertCelsiusToUnit(e,t){return t==="fahrenheit"?e*9/5+32:e}function renderTemperatureNote$1(e){var t=resolveDocument$1({}),o=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.tempNote:null;if(!o&&t){try{o=t.getElementById("temperatureNote")}catch{}o&&runtimeFeedbackState&&runtimeFeedbackState.elements&&(runtimeFeedbackState.elements.tempNote=o)}if(!o||typeof o!="object")return!1;var r=resolveLanguageFromContext(t),n=resolveLanguageTexts(r),a=createTextResolver(n.langTexts,n.fallbackTexts),s=resolveEscapeHtml(),l=a("temperatureNoteHeading")||"Temperature impact on runtime:",u=a("temperatureLabel")||"Temperature",d=a("runtimeLabel")||"Estimated Runtime (h)",m=a("batteryCountTempLabel")||"Batteries needed",y=a("batteryLifeUnit"),h=resolveTemperatureUnitPreference(),b=h==="fahrenheit"?"temperatureUnitSymbolFahrenheit":"temperatureUnitSymbolCelsius",v=a(b)||(h==="fahrenheit"?"°F":"°C"),C=createNumberFormatter(r,{minimumFractionDigits:2,maximumFractionDigits:2},2),A=createNumberFormatter(r,{maximumFractionDigits:0},0),w=createNumberFormatter(r,{maximumFractionDigits:0,signDisplay:"exceptZero"},0),R="",_=Number.isFinite(e)?e:Number(e);!Number.isFinite(_)&&e!==1/0&&(_=null);for(var G=e===1/0,O=0;O<TEMPERATURE_NOTE_PROFILES.length;O+=1){var B=TEMPERATURE_NOTE_PROFILES[O],$=convertCelsiusToUnit(B.celsius,h),V=w($),M=null,F=null;if(G)M=1/0,F=1;else if(Number.isFinite(_)&&_>0){var z=_/B.multiplier;if(Number.isFinite(z)&&z>0){M=z;var x=10/z;Number.isFinite(x)&&x>0&&(F=Math.max(1,Math.ceil(x)))}}var H="–";M===1/0?H="∞":Number.isFinite(M)&&M>0&&(H=C(M),y&&(H+=" "+y));var W="–";Number.isFinite(F)&&F>0&&(W=A(F)),R+="<tr><td>"+s(V+" "+v)+"</td><td>"+s(H)+"</td><td>"+s(W)+"</td></tr>"}var U="<table><thead><tr><th>"+s(u+" ("+v+")")+"</th><th>"+s(d)+"</th><th>"+s(m)+"</th></tr></thead><tbody>"+R+"</tbody></table>",j="<h3>"+s(l)+"</h3>";try{o.innerHTML=j+U}catch{o.innerHTML=j+U}return!0}function localizeResultsSection(e){var t=e||{},o=updateRuntimeDependencies(t),r=resolveDocument$1(t);if(!r)return!1;var n=typeof t.lang=="string"?t.lang:"",a=t.langTexts&&typeof t.langTexts=="object"?t.langTexts:{},s=t.fallbackTexts&&typeof t.fallbackTexts=="object"?t.fallbackTexts:{},l=createTextResolver(a,s),u=resolveElementFromOptions(t,"breakdownListElem","breakdownList","breakdownListElem");if(u){var d=l("breakdownListHelp");setHelpAttribute(u,d)}var m=resolveElementFromOptions(t,"resultsPlainSummaryElem","resultsPlainSummary","resultsPlainSummaryElem");m&&setHelpAttribute(m,l("resultsPlainSummaryHelp"));var y=resolveElementFromOptions(t,"resultsPlainSummaryTitleElem","resultsPlainSummaryTitle","resultsPlainSummaryTitleElem");if(y)try{y.textContent=l("resultsPlainSummaryTitle")||y.textContent||""}catch{}var h=resolveElementFromOptions(t,"resultsPlainSummaryTextElem","resultsPlainSummaryText","resultsPlainSummaryTextElem");if(h){var b=l("resultsPlainSummaryPrompt");!b&&typeof h.textContent=="string"&&(b=h.textContent);try{h.textContent=b}catch{}}var v=resolveElementFromOptions(t,"resultsPlainSummaryNoteElem","resultsPlainSummaryNote","resultsPlainSummaryNoteElem");if(v)try{v.textContent=l("resultsPlainSummaryNote")||v.textContent||""}catch{}function C(Pe,et,Je){if(Pe){var it=l(et);it||typeof Pe.textContent=="string"&&(it=Pe.textContent);try{typeof Pe.textContent=="string"&&(Pe.textContent=it)}catch{}var rt=l(Je);setHelpAttribute(Pe,rt)}}var A=resolveElementFromOptions(t,"totalPowerLabel","totalPowerLabel");if(C(A,"totalPowerLabel","totalPowerHelp"),typeof o.refreshTotalCurrentLabels=="function")try{o.refreshTotalCurrentLabels(n)}catch(Pe){safeWarn$3("Unable to refresh total current labels via cineResults.",Pe)}if(typeof o.updateMountVoltageSettingLabels=="function")try{o.updateMountVoltageSettingLabels(n)}catch(Pe){safeWarn$3("Unable to refresh mount voltage labels via cineResults.",Pe)}var w=resolveElementFromOptions(t,"batteryCountLabel","batteryCountLabel");C(w,"batteryCountLabel","batteryCountHelp");var R=resolveElementFromOptions(t,"pinWarning",null,"pinWarnElem");setHelpAttribute(R,l("pinWarningHelp"));var _=resolveElementFromOptions(t,"dtapWarning",null,"dtapWarnElem");setHelpAttribute(_,l("dtapWarningHelp"));var G=resolveElementFromOptions(t,"hotswapWarning",null,"hotswapWarnElem");setHelpAttribute(G,l("hotswapWarningHelp"));var O=resolveElementFromOptions(t,"powerWarningTitle",null,"powerWarningTitleElem");if(O)try{O.textContent=l("powerWarningTitle")||O.textContent||""}catch{}var B=resolveElementFromOptions(t,"powerWarningLimitsHeading",null,"powerWarningLimitsHeadingElem");if(B)try{B.textContent=l("powerWarningLimitsHeading")||B.textContent||""}catch{}var $=resolveElementFromOptions(t,"powerWarningAdvice",null,"powerWarningAdviceElem");if($)try{$.textContent=l("powerWarningAdvice")||$.textContent||""}catch{}var V=o.setButtonLabelWithIcon,M=o.iconGlyphs||{},F=resolveElementFromOptions(t,"powerWarningCloseBtn",null,"powerWarningCloseBtn");if(F&&typeof V=="function"&&M&&M.check)try{V(F,l("powerWarningClose")||F.textContent||"",M.check)}catch(Pe){safeWarn$3("Unable to localize power warning close button via cineResults.",Pe)}var z=resolveElementFromOptions(t,"batteryLifeUnit","batteryLifeUnit");if(z)try{z.textContent=l("batteryLifeUnit")||z.textContent||""}catch{}var x=o.getCurrentSetupKey,H=o.renderFeedbackTable,W=null;if(typeof H=="function"&&typeof x=="function")try{W=H(x())}catch(Pe){safeWarn$3("cineResults failed to render runtime feedback summary.",Pe),W=null}var U=resolveElementFromOptions(t,"batteryLifeLabel","batteryLifeLabel");if(U){var j=l("batteryLifeLabel");if(!j&&typeof U.textContent=="string"&&(j=U.textContent),W&&W.count){var Y=l("runtimeUserCountNote");if(Y&&Y.indexOf("{count}")!==-1){var le=Y.replace("{count}",W.count),be=j.indexOf(")");be!==-1?j=j.slice(0,be)+", "+le+j.slice(be):j?j=j+" ("+le+")":j=le}}try{U.textContent=j}catch{}setHelpAttribute(U,l("batteryLifeHelp"))}var re=resolveElementFromOptions(t,"runtimeAverageNote","runtimeAverageNote");if(re){var de="";W&&W.count>4&&(de=l("runtimeAverageNote"));try{re.textContent=de}catch{}}var ne=typeof t.lastRuntimeHours<"u"?t.lastRuntimeHours:typeof GLOBAL_SCOPE$7.lastRuntimeHours<"u"?GLOBAL_SCOPE$7.lastRuntimeHours:null;if(typeof o.dispatchTemperatureNoteRender=="function")try{o.dispatchTemperatureNoteRender(ne)}catch(Pe){safeWarn$3("Unable to dispatch temperature note render via cineResults.",Pe)}var Ce=typeof t.temperatureUnit<"u"?t.temperatureUnit:typeof GLOBAL_SCOPE$7.temperatureUnit<"u"?GLOBAL_SCOPE$7.temperatureUnit:null;if(typeof o.refreshFeedbackTemperatureLabel=="function")try{o.refreshFeedbackTemperatureLabel(n,Ce)}catch(Pe){safeWarn$3("Unable to refresh feedback temperature label via cineResults.",Pe)}if(typeof o.updateFeedbackTemperatureOptions=="function")try{o.updateFeedbackTemperatureOptions(n,Ce)}catch(Pe){safeWarn$3("Unable to update feedback temperature options via cineResults.",Pe)}var Ee=resolveElementFromOptions(t,"tempNote","temperatureNote");return setHelpAttribute(Ee,l("temperatureNoteHelp")),runtimeFeedbackState.elements.breakdownListElem=u,runtimeFeedbackState.elements.totalPowerLabel=A,runtimeFeedbackState.elements.batteryCountLabel=w,runtimeFeedbackState.elements.batteryLifeLabel=U,runtimeFeedbackState.elements.runtimeAverageNote=re,runtimeFeedbackState.elements.tempNote=Ee,!0}function localizeBatteryComparisonSection(e){var t=e||{},o=resolveDocument$1(t);if(!o)return!1;var r=t.langTexts&&typeof t.langTexts=="object"?t.langTexts:{},n=t.fallbackTexts&&typeof t.fallbackTexts=="object"?t.fallbackTexts:{},a=createTextResolver(r,n),s=resolveElementFromOptions(t,"batteryComparisonHeading","batteryComparisonHeading","batteryComparisonHeading"),l=resolveElementFromOptions(t,"batteryComparisonDescription","batteryComparisonDescription"),u=resolveElementFromOptions(t,"batteryComparisonTable","batteryTable","batteryTable"),d=!1;if(s){var m=a("batteryComparisonHeading");!m&&typeof s.textContent=="string"&&(m=s.textContent);try{typeof s.textContent=="string"&&(s.textContent=m)}catch{}setHelpAttribute(s,a("batteryComparisonHeadingHelp")),d=!0}if(l){var y=a("batteryComparisonDescription");!y&&typeof l.textContent=="string"&&(y=l.textContent);try{typeof l.textContent=="string"&&(l.textContent=y)}catch{}setHelpAttribute(l,a("batteryComparisonDescriptionHelp")),d=!0}return u&&(setHelpAttribute(u,a("batteryComparisonTableHelp")),d=!0),runtimeFeedbackState.elements.batteryComparisonHeading=s,runtimeFeedbackState.elements.batteryComparisonDescription=l,runtimeFeedbackState.elements.batteryComparisonTable=u,d}function attachHandlerOnce(e,t,o,r){if(!(!e||!t||!o||typeof r!="function")&&!runtimeFeedbackState.handlers[o]){var n=r();if(typeof n=="function")try{e.addEventListener(t,n),runtimeFeedbackState.handlers[o]=n}catch(a){safeWarn$3("cineResults could not attach runtime feedback handler.",a)}}}function updateCalculations$2(e){try{let Uo=function(we){return t&&typeof t[we]=="function"?t[we]:o&&typeof o[we]=="function"?o[we]:GLOBAL_SCOPE$7&&typeof GLOBAL_SCOPE$7[we]=="function"?GLOBAL_SCOPE$7[we]:null},Ko=function(we){if(typeof we=="function")try{return we()}catch(jt){safeWarn$3("cineResults.updateCalculations dependency call failed.",jt);return}},yo=function(we){if(!we)return"";var jt=u&&Object.prototype.hasOwnProperty.call(u,we)?u[we]:void 0;return typeof jt>"u"&&(jt=d&&Object.prototype.hasOwnProperty.call(d,we)?d[we]:void 0),typeof jt=="string"?jt:""},En=function(we){if(typeof we=="string"){var jt=we.trim();return jt&&jt!=="None"?jt:""}if(we==null)return"";var _o=String(we).trim();return _o&&_o!=="None"?_o:""},Fr=function(we){return!Ee||!we?"":En(Ee[we])},wr=function(we){if(!Ee||!we)return[];var jt=Ee[we];if(!Array.isArray(jt))return[];for(var _o=[],Yr=0;Yr<jt.length;Yr+=1){var Ar=En(jt[Yr]);Ar&&_o.push(Ar)}return _o},er=function(we,jt){var _o=we&&typeof we.value=="string"?we.value:"";if(_o&&_o!=="None")return _o;var Yr=Fr(jt);return Yr||_o},ro=function(we){if(!we||typeof we.selectedIndex!="number")return"";var jt=we.options;if(!jt||we.selectedIndex<0||we.selectedIndex>=jt.length)return"";var _o=jt[we.selectedIndex];return!_o||typeof _o.textContent!="string"?"":_o.textContent.trim()},Br=function(we){if(typeof we=="number"&&Number.isFinite(we))return we;if(we&&typeof we=="object"&&typeof we.powerDrawWatts=="number")return we.powerDrawWatts||0;if(typeof we=="string"){var jt=Number(we);return Number.isFinite(jt)?jt:0}return 0},Xr=function(we){if(we){if(typeof we.innerHTML=="string")try{we.innerHTML="";return}catch(jt){}if(typeof we.replaceChildren=="function")try{we.replaceChildren();return}catch(jt){}if(we.childNodes&&we.childNodes.length)try{for(;we.firstChild;)we.removeChild(we.firstChild)}catch(jt){}}},Bo=function(we,jt,_o){if(!(!we||!jt||!(_o>0))){var Yr="<strong>"+Jt(jt)+"</strong> "+_o.toFixed(1)+" W";if(typeof we.insertAdjacentHTML=="function")try{we.insertAdjacentHTML("beforeend","<li>"+Yr+"</li>");return}catch(tn){}if(r&&typeof r.createElement=="function"&&typeof we.appendChild=="function")try{var Ar=r.createElement("li");Ar.innerHTML=Yr,we.appendChild(Ar);return}catch(tn){}if(typeof we.innerHTML=="string")try{we.innerHTML+="<li>"+Yr+"</li>"}catch(tn){}}};var t=e||{},o=updateRuntimeDependencies(t),r=resolveDocument$1(t),n=null;typeof t.getDevices=="function"&&(n=Ko(function(){return t.getDevices()})),n||(n=Ko(Uo("getDevices"))),!n&&t&&typeof t.devices=="object"&&(n=t.devices),!n&&GLOBAL_SCOPE$7&&typeof GLOBAL_SCOPE$7.devices=="object"&&(n=GLOBAL_SCOPE$7.devices),(!n||typeof n!="object")&&(n={});var a=null;typeof t.getTexts=="function"&&(a=Ko(function(){return t.getTexts()})),a||(a=Ko(Uo("getTexts"))),!a&&t&&typeof t.texts=="object"&&(a=t.texts),!a&&GLOBAL_SCOPE$7&&typeof GLOBAL_SCOPE$7.texts=="object"&&(a=GLOBAL_SCOPE$7.texts),(!a||typeof a!="object")&&(a={});var s=null;typeof t.getCurrentLang=="function"&&(s=Ko(function(){return t.getCurrentLang()})),s||(s=Ko(Uo("getCurrentLang"))),!s&&typeof t.currentLang=="string"&&(s=t.currentLang),!s&&typeof o.currentLang=="string"&&(s=o.currentLang),!s&&typeof GLOBAL_SCOPE$7.currentLang=="string"&&(s=GLOBAL_SCOPE$7.currentLang),(typeof s!="string"||!s)&&(s="en");var l=null;typeof t.getCollator=="function"&&(l=Ko(function(){return t.getCollator()})),l||(l=Ko(Uo("getCollator"))),!l&&t&&t.collator&&(l=t.collator),!l&&o&&o.collator&&(l=o.collator),!l&&GLOBAL_SCOPE$7&&GLOBAL_SCOPE$7.collator&&(l=GLOBAL_SCOPE$7.collator),l&&o&&typeof o=="object"&&(o.collator=l);var u=a&&typeof a=="object"&&a[s]&&typeof a[s]=="object"?a[s]:null,d=a&&typeof a=="object"&&a.en&&typeof a.en=="object"?a.en:null;u||(u=d||{}),d||(d={});var m=resolveElementFromOptions(t,"cameraSelect","cameraSelect","cameraSelect"),y=resolveElementFromOptions(t,"monitorSelect","monitorSelect","monitorSelect"),h=resolveElementFromOptions(t,"videoSelect","videoSelect","videoSelect"),b=resolveElementFromOptions(t,"distanceSelect","distanceSelect","distanceSelect"),v=resolveElementFromOptions(t,"batterySelect","batterySelect","batterySelect"),C=resolveElementFromOptions(t,"batteryPlateSelect","batteryPlateSelect","batteryPlateSelect"),A=resolveElementFromOptions(t,"hotswapSelect","batteryHotswapSelect","hotswapSelect"),w=resolveSelectCollection(t,"motorSelects",["motor1Select","motor2Select","motor3Select","motor4Select"],"motorSelects"),R=resolveSelectCollection(t,"controllerSelects",["controller1Select","controller2Select","controller3Select","controller4Select"],"controllerSelects"),_=resolveElementFromOptions(t,"resultsPlainSummaryElem","resultsPlainSummary","resultsPlainSummaryElem"),G=resolveElementFromOptions(t,"resultsPlainSummaryTextElem","resultsPlainSummaryText","resultsPlainSummaryTextElem"),O=resolveElementFromOptions(t,"resultsPlainSummaryNoteElem","resultsPlainSummaryNote","resultsPlainSummaryNoteElem"),B=resolveElementFromOptions(t,"totalPowerElem","totalPower","totalPowerElem"),$=resolveElementFromOptions(t,"breakdownListElem","breakdownList","breakdownListElem"),V=resolveElementFromOptions(t,"totalCurrent144Elem","totalCurrent144","totalCurrent144Elem"),M=resolveElementFromOptions(t,"totalCurrent12Elem","totalCurrent12","totalCurrent12Elem"),F=resolveElementFromOptions(t,"batteryLifeElem","batteryLife","batteryLifeElem"),z=resolveElementFromOptions(t,"batteryCountElem","batteryCount","batteryCountElem"),x=resolveElementFromOptions(t,"batteryLifeLabelElem","batteryLifeLabel","batteryLifeLabelElem"),H=resolveElementFromOptions(t,"runtimeAverageNoteElem","runtimeAverageNote","runtimeAverageNoteElem"),W=resolveElementFromOptions(t,"pinWarnElem","pinWarning","pinWarnElem"),U=resolveElementFromOptions(t,"dtapWarnElem","dtapWarning","dtapWarnElem"),j=resolveElementFromOptions(t,"hotswapWarnElem","hotswapWarning","hotswapWarnElem"),Y=resolveElementFromOptions(t,"batteryComparisonSection","batteryComparison","batteryComparisonSection"),le=resolveElementFromOptions(t,"batteryTableElem","batteryTable","batteryTableElem"),be=resolveElementFromOptions(t,"setupDiagramContainer","diagramArea","setupDiagramContainer"),re=r&&typeof r.getElementById=="function"?r.getElementById("heroRuntime"):null,de=r&&typeof r.getElementById=="function"?r.getElementById("heroCurrent144"):null,ne=r&&typeof r.getElementById=="function"?r.getElementById("heroCurrent12"):null,Ce=r&&typeof r.getElementById=="function"?r.getElementById("heroBatteryCount"):null;runtimeFeedbackState.elements.cameraSelect=m,runtimeFeedbackState.elements.monitorSelect=y,runtimeFeedbackState.elements.videoSelect=h,runtimeFeedbackState.elements.distanceSelect=b,runtimeFeedbackState.elements.batterySelect=v,runtimeFeedbackState.elements.hotswapSelect=A,runtimeFeedbackState.elements.batteryPlateSelect=C,runtimeFeedbackState.elements.motorSelects=w,runtimeFeedbackState.elements.controllerSelects=R,runtimeFeedbackState.elements.resultsPlainSummaryElem=_,runtimeFeedbackState.elements.resultsPlainSummaryTextElem=G,runtimeFeedbackState.elements.resultsPlainSummaryNoteElem=O,runtimeFeedbackState.elements.totalPowerElem=B,runtimeFeedbackState.elements.breakdownListElem=$,runtimeFeedbackState.elements.totalCurrent144Elem=V,runtimeFeedbackState.elements.totalCurrent12Elem=M,runtimeFeedbackState.elements.batteryLifeElem=F,runtimeFeedbackState.elements.batteryCountElem=z,runtimeFeedbackState.elements.batteryLifeLabelElem=x,runtimeFeedbackState.elements.runtimeAverageNoteElem=H,runtimeFeedbackState.elements.pinWarnElem=W,runtimeFeedbackState.elements.dtapWarnElem=U,runtimeFeedbackState.elements.hotswapWarnElem=j,runtimeFeedbackState.elements.batteryComparisonSection=Y,runtimeFeedbackState.elements.batteryTableElem=le,runtimeFeedbackState.elements.setupDiagramContainer=be;var Ee=t&&typeof t.previewSelections=="object"&&t.previewSelections?t.previewSelections:null,Pe=er(m,"camera"),et=er(y,"monitor"),Je=er(h,"video"),it=er(b,"distance"),rt=er(v,"battery"),Pt=ro(v),vt=w.map(function(jt){return er(jt)}),bo=R.map(function(jt){return er(jt)}),Et=wr("motors");if(Et.length){var Ut=vt.some(function(jt){return jt&&jt!=="None"});Ut||(vt=Et.slice())}var ge=wr("controllers");if(ge.length){var ue=bo.some(function(jt){return jt&&jt!=="None"});ue||(bo=ge.slice())}if(!Pt||!Pt.trim()){var We=Fr("batteryLabel")||Fr("battery");We&&(Pt=We)}var Me=n&&typeof n.cameras=="object"&&n.cameras?n.cameras:{};updateRuntimeFeedbackCameraOptionLists(Me,Pe);for(var Te=n&&typeof n.monitors=="object"&&n.monitors?n.monitors:{},Be=n&&typeof n.video=="object"&&n.video?n.video:{},Ve=n&&typeof n.fiz=="object"&&n.fiz?n.fiz:{},je=Ve&&typeof Ve.motors=="object"?Ve.motors:{},mt=Ve&&typeof Ve.controllers=="object"?Ve.controllers:{},ct=Ve&&typeof Ve.distance=="object"?Ve.distance:{},$t=Br(Me[Pe]),fo=Br(Te[et]),no=Br(Be[Je]),Nt=0,xo=0;xo<vt.length;xo+=1)Nt+=Br(je[vt[xo]]);for(var Io=0,qo=0;qo<bo.length;qo+=1)Io+=Br(mt[bo[qo]]);var eo=Br(ct[it]),To=$t+fo+no+Nt+Io+eo;if(B&&typeof B.textContent<"u")try{B.textContent=To.toFixed(1)}catch(we){}var ko=[{power:$t,className:"camera",label:yo("cameraLabel")},{power:fo,className:"monitor",label:yo("monitorLabel")},{power:no,className:"video",label:yo("videoLabel")},{power:Nt,className:"motors",label:yo("fizMotorsLabel")},{power:Io,className:"controllers",label:yo("fizControllersLabel")},{power:eo,className:"distance",label:yo("distanceLabel")}].filter(function(jt){return jt.power>0}),Jt=Uo("escapeHtml");Jt||(Jt=function(jt){var _o=jt==null?"":String(jt);return _o.replace(/[&<>"']/g,function(Ar){switch(Ar){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return Ar}})}),$&&(Xr($),Bo($,yo("cameraLabel"),$t),Bo($,yo("monitorLabel"),fo),Bo($,yo("videoLabel"),no),Bo($,yo("fizMotorsLabel"),Nt),Bo($,yo("fizControllersLabel"),Io),Bo($,yo("distanceLabel"),eo));var lr=Uo("getSelectedPlate"),pt="";if(typeof lr=="function"){var mo=Ko(lr);typeof mo=="string"&&(pt=mo)}pt||(pt=Fr("plate")||Fr("batteryPlate")||"");var go=Uo("getMountVoltageConfig"),So={};if(typeof go=="function"){var k;try{k=go(pt)}catch(we){safeWarn$3("cineResults.updateCalculations could not determine mount voltage configuration.",we),k=null}k&&typeof k=="object"&&(So=k)}var Q=pt==="B-Mount",X=Number.isFinite(So.high)?So.high:Q?33.6:14.4,ae=Number.isFinite(So.low)?So.low:Q?21.6:12,Ae=To>0?To/X:0,Se=To>0?To/ae:0,Oe=Uo("refreshTotalCurrentLabels");if(Oe)try{Oe(s,pt,So)}catch(we){safeWarn$3("cineResults.updateCalculations could not refresh total current labels.",we)}if(V&&typeof V.textContent<"u")try{V.textContent=Ae.toFixed(2)}catch(we){}if(M&&typeof M.textContent<"u")try{M.textContent=Se.toFixed(2)}catch(we){}var Ne=Uo("updateBatteryOptions");if(Ne)try{Ne()}catch(we){safeWarn$3("cineResults.updateCalculations could not refresh battery options.",we)}rt=er(v,"battery");var Qe=Uo("setStatusMessage");Qe||(Qe=function(jt,_o){if(jt)try{jt.textContent=_o||""}catch(Yr){}});var Fe=Uo("setStatusLevel");Fe||(Fe=function(jt,_o){if(jt){var Yr=_o||"";if(typeof jt.setAttribute=="function")try{jt.setAttribute("data-status",Yr);return}catch(Ar){}jt.dataStatus=Yr}});var _e=Uo("closePowerWarningDialog"),He=Uo("showPowerWarningDialog"),st=Uo("drawPowerDiagram"),at=Uo("renderFeedbackTable"),St=Uo("getCurrentSetupKey"),kt=Uo("renderTemperatureNote"),Zt=Uo("checkFizCompatibility"),Ht=Uo("checkFizController"),jo=Uo("checkArriCompatibility"),ir=Uo("renderSetupDiagram"),sr=Uo("supportsBMountCamera"),Ro=Uo("supportsGoldMountCamera"),Ot=Uo("getCssVariableValue");Ot||(Ot=function(jt,_o){return typeof _o=="string"?_o:""});var Lr=Uo("getLastRuntimeHours");Lr||(Lr=function(){return typeof GLOBAL_SCOPE$7.lastRuntimeHours<"u"?GLOBAL_SCOPE$7.lastRuntimeHours:null});var Co=Uo("setLastRuntimeHours");Co||(Co=function(jt){try{GLOBAL_SCOPE$7.lastRuntimeHours=jt}catch(_o){}});var hr=null,Wo=null,Yo=null,Tt=null;if(!rt||!n.batteries||!n.batteries[rt]){if(F&&typeof F.textContent<"u")try{F.textContent="–"}catch(we){}if(re&&(re.textContent="–"),z&&typeof z.textContent<"u")try{z.textContent="–"}catch(we){}if(Qe(W,""),Fe(W,null),Qe(U,""),Fe(U,null),j&&(Qe(j,""),Fe(j,null)),_e)try{_e()}catch(we){safeWarn$3("cineResults.updateCalculations could not close power warning dialog.",we)}if(Co(null),Wo=null,Yo=null,Tt=null,st)try{st(0,ko,0)}catch(we){safeWarn$3("cineResults.updateCalculations could not draw power diagram.",we)}}else{var $o=n.batteries[rt],br=er(A,"hotswap"),Do=n.batteryHotswaps&&n.batteryHotswaps[br]?n.batteryHotswaps[br]:null,ur=($o&&typeof $o.capacity=="number"?$o.capacity:0)+(Do&&typeof Do.capacity=="number"?Do.capacity:0),or=coerceCurrentLimit($o&&$o.pinA),Vo=coerceCurrentLimit($o&&$o.dtapA),Po=Number.isFinite(or)&&or>0,co=Number.isFinite(Vo)&&Vo>0,mr=coerceCurrentLimit(Do&&Do.pinA);if(Number.isFinite(mr)){if(!Po||mr<or){var Sr=yo("warnHotswapLower").replace("{max}",String(mr)).replace("{batt}",Po?String(or):"?");Qe(j,Sr),Fe(j,"warning")}else Qe(j,""),Fe(j,null);or=mr,Po=Number.isFinite(or)&&or>0}else j&&(Qe(j,""),Fe(j,null));var jr=Po?or*ae:0;if(st)try{st(jr,ko,Po?or:null)}catch(we){safeWarn$3("cineResults.updateCalculations could not draw power diagram.",we)}if(V&&typeof V.textContent<"u")try{V.textContent=Ae.toFixed(2)}catch(we){}if(de&&(de.textContent=`${Ae.toFixed(2)} A`),M&&typeof M.textContent<"u")try{M.textContent=Se.toFixed(2)}catch(we){}if(ne&&(ne.textContent=`${Se.toFixed(2)} A`),To===0){if(hr=1/0,F&&typeof F.textContent<"u")try{F.textContent="∞"}catch(we){}re&&(re.textContent="∞")}else{if(hr=ur/To,F&&typeof F.textContent<"u")try{F.textContent=hr.toFixed(2)}catch(we){}if(re){var Qr=Math.floor(hr),an=Math.round((hr-Qr)*60);re.textContent=`${Qr}h ${an} m`}}if(Co(hr),Wo=hr,Yo=1,Number.isFinite(hr)&&hr>0&&(Yo=Math.max(1,Math.ceil(10/hr))),Tt=Yo,z&&typeof z.textContent<"u")try{z.textContent=String(Yo)}catch(we){}Ce&&(Ce.textContent=String(Yo))}Qe(W,""),Qe(U,"");var Sn="",Re="";if(Po&&Se>or){var Ye=yo("warnPinExceeded").replace("{current}",Se.toFixed(2)).replace("{max}",String(or));Qe(W,Ye),Sn="danger"}else if(Po&&Se>or*.8){var ke=yo("warnPinNear").replace("{current}",Se.toFixed(2)).replace("{max}",String(or));Qe(W,ke),Sn="note"}if(!Q){if(co&&Se>Vo){var ee=yo("warnDTapExceeded").replace("{current}",Se.toFixed(2)).replace("{max}",String(Vo));Qe(U,ee),Re="danger"}else if(co&&Se>Vo*.8){var I=yo("warnDTapNear").replace("{current}",Se.toFixed(2)).replace("{max}",String(Vo));Qe(U,I),Re="note"}}var N=Po&&Se>or,K=!Q&&co,oe=!K||co&&Se>Vo,ce=typeof rt=="string"?rt.trim():"",me=ce!==""&&ce.toLowerCase()!=="none";if(Se>0&&N&&oe&&me){var De=v&&v.options?v.options[v.selectedIndex]:null,Ge=De&&typeof De.textContent=="string"?De.textContent.trim():rt||"";if(He)try{He({batteryName:Ge,current:Se,hasPinLimit:Po,pinLimit:Po?or:null,hasDtapRating:co,dtapLimit:co?Vo:null,dtapAllowed:K})}catch(we){safeWarn$3("cineResults.updateCalculations could not show power warning dialog.",we)}}else if(_e)try{_e()}catch(we){safeWarn$3("cineResults.updateCalculations could not close power warning dialog.",we)}if(Po&&W&&W.textContent===""){var Ue=yo("pinOk").replace("{max}",String(or));Qe(W,Ue),Fe(W,"success")}else Po?Fe(W,Sn||"warning"):Fe(W,null);if(Q)Qe(U,""),Fe(U,null);else if(co&&U&&U.textContent===""){var Xe=yo("dtapOk").replace("{max}",String(Vo));Qe(U,Xe),Fe(U,"success")}else Fe(U,Re||"warning");var ft=buildPowerOutputSummaryText(yo,{current:Se,pinLimit:or,dtapLimit:Vo,hasDtapRating:co,dtapAllowed:K,bMountCam:Q});if(O)try{O.textContent=ft}catch(we){}if(typeof Y<"u"&&Y&&Y.style&&(Y.style.display=To>0?"block":"none"),le&&To>0&&n.batteries){let we=function(Ar,tn){var Cn=tn.hours-Ar.hours;return Cn!==0?Cn:Oo.compare(Ar.name,tn.name)},jt=function(Ar){return Ar==="pins"?"bar bar-pins-only":"bar"},_o=function(Ar){var tn={pins:{var:"--warning-color",fallback:"#FF9800",text:yo("methodPinsOnly")},"both pins and D-Tap":{var:"--success-color",fallback:"#4CAF50",text:yo("methodPinsAndDTap")},infinite:{var:"--info-color",fallback:"#007bff",text:yo("methodInfinite")}},Cn=tn[Ar];if(Cn){var sn=Ot(Cn.var,Cn.fallback);return'<span style="color:'+Jt(sn)+';">'+Jt(Cn.text)+"</span>"}return Jt(Ar)},Yr=function(Ar,tn){var Cn=_o(Ar.method),sn=Kn>0?Ar.hours/Kn*100:0;Wr+="<tr"+(tn?' class="'+tn+'"':"")+"><td>"+Jt(Ar.name)+"</td><td>"+Ar.hours.toFixed(2)+"h ("+Cn+')</td><td><div class="barContainer"><div class="'+jt(Ar.method)+'" style="width: '+sn+'%;"></div></div></td></tr>'};var Le=n.batteries,ot=er(v,"battery"),_t=er(m,"camera"),Lt=pt,Qt=sr?!!sr(_t):!1,Gt=Ro?!!Ro(_t):!1,ho=null;if(ot&&ot!=="None"&&Le[ot]){var Qo=Le[ot],Xo=!Lt||Qo.mount_type===Lt,No=Qt||Qo.mount_type!=="B-Mount",ao=Gt||Qo.mount_type!=="Gold-Mount";if(Xo&&No&&ao){var Ir=coerceCurrentLimit(Qo.pinA),cr=coerceCurrentLimit(Qo.dtapA),Rr=Number.isFinite(Ir)&&Ir>0?Se<=Ir:!1,Er=!Q&&Number.isFinite(cr)&&cr>0?Se<=cr:!1;if(Rr||Er){var rr=To===0?1/0:Qo.capacity/To,$r;Rr&&Er?$r="both pins and D-Tap":Rr?$r="pins":$r="dtap",ho={name:ot,hours:rr,method:$r}}}}var Pr=[],Kt=[],Oo=getLocaleAwareCollator(l,s);for(var Dt in Le)if(Object.prototype.hasOwnProperty.call(Le,Dt)&&Dt!=="None"&&!(ho&&Dt===ho.name)){var Fo=Le[Dt];if(!(Lt&&Fo.mount_type!==Lt)&&!(!Lt&&!Qt&&Fo.mount_type==="B-Mount")&&!(!Lt&&!Gt&&Fo.mount_type==="Gold-Mount")){var qr=coerceCurrentLimit(Fo.pinA),en=coerceCurrentLimit(Fo.dtapA),yr=Number.isFinite(qr)&&qr>0?Se<=qr:!1,Kr=!Q&&Number.isFinite(en)&&en>0?Se<=en:!1;if(yr){var Zo=Fo.capacity/To,Cr=Kr?"both pins and D-Tap":"pins";Pr.push({name:Dt,hours:Zo,method:Cr})}else if(Kr){var T=Fo.capacity/To;Kt.push({name:Dt,hours:T,method:"dtap"})}}}Pr.sort(we),Kt.sort(we);var J=yo("batteryTableBatteryHelp"),qe=yo("batteryTableRuntimeHelp"),Rt=yo("batteryTableGraphHelp"),Vt=yo("batteryTableGraphLabel"),Go=yo("batteryTableLabel"),zo=yo("runtimeLabel"),gr=yo("noBatterySupports"),It=J?' data-help="'+Jt(J)+'"':"",Vr=qe?' data-help="'+Jt(qe)+'"':"",Nr=Rt?' data-help="'+Jt(Rt)+'"':"",Xt=Vt?' aria-label="'+Jt(Vt)+'"':"",po=Vt?'<span class="visually-hidden">'+Jt(Vt)+"</span>":"",Wr="<tr><th"+It+">"+Jt(Go)+"</th><th"+Vr+">"+Jt(zo)+"</th><th"+Nr+Xt+">"+po+"</th></tr>",Pn=[];ho&&Pn.push(ho),Array.prototype.push.apply(Pn,Pr),Array.prototype.push.apply(Pn,Kt);var Kn=1;if(Pn.length){var Z=Pn.map(function(tn){return tn.hours}),he=Math.max.apply(Math,Z);Kn=Number.isFinite(he)&&he>0?he:1}if((ho?1:0)+Pr.length+Kt.length===0)Wr+='<tr><td colspan="3">'+Jt(gr)+"</td></tr>";else{ho&&Yr(ho,"selectedBatteryRow");for(var fe=0;fe<Pr.length;fe+=1){var xe=Pr[fe];ho&&xe.name===ho.name||Yr(xe)}for(var $e=0;$e<Kt.length;$e+=1){var ze=Kt[$e];if(!(ho&&ze.name===ho.name)){var yt=Pr.some(function(tn){return tn.name===ze.name});yt||Yr(ze)}}}try{le.innerHTML=Wr}catch(Ar){safeWarn$3("cineResults.updateCalculations could not render battery comparison table.",Ar)}var dt=yo("batteryComparisonTableHelp");if(dt)try{le.setAttribute("data-help",dt)}catch(Ar){}}else Y&&Y.style&&(Y.style.display="none");var ht=null;if(at&&St)try{ht=at(St())}catch(we){safeWarn$3("cineResults.updateCalculations could not render runtime feedback table.",we),ht=null}if(ht!==null){var uo=ht.runtime;if(Number.isFinite(hr)&&(uo=(ht.runtime*ht.weight+hr)/(ht.weight+1)),F&&typeof F.textContent<"u")try{F.textContent=uo.toFixed(2)}catch(we){}if(Co(uo),Wo=uo,x){var wt=yo("batteryLifeLabel"),Ao=yo("runtimeUserCountNote");if(Ao.indexOf("{count}")!==-1){var nr=Ao.replace("{count}",ht.count),dr=wt.indexOf(")");dr!==-1?wt=wt.slice(0,dr)+", "+nr+wt.slice(dr):wt?wt=wt+" ("+nr+")":wt=nr}try{x.textContent=wt,x.setAttribute("data-help",yo("batteryLifeHelp"))}catch(we){}}if(H){var fr=ht.count>4?yo("runtimeAverageNote"):"";try{H.textContent=fr}catch(we){}}var ar=1;if(Number.isFinite(uo)&&uo>0&&(ar=Math.max(1,Math.ceil(10/uo))),Yo=ar,Tt=ar,z&&typeof z.textContent<"u")try{z.textContent=String(ar)}catch(we){}}else{if(x)try{x.textContent=yo("batteryLifeLabel"),x.setAttribute("data-help",yo("batteryLifeHelp"))}catch(we){}if(H)try{H.textContent=""}catch(we){}}if(G){var Jo=yo("resultsPlainSummaryPrompt")||"",Mr=buildPlainSummaryText({summaryPrompt:Jo,needBatterySummary:yo("resultsPlainSummaryNeedBattery"),runtimeSummaryTemplate:yo("resultsPlainSummaryRuntime"),unlimitedSummaryTemplate:yo("resultsPlainSummaryUnlimited"),unnamedBatteryLabel:yo("resultsPlainSummaryUnnamedBattery"),batteryLabelText:Pt,battery:rt,totalWatt:To,runtimeHoursValue:Wo,batteriesNeededValue:Tt});Mr||(Mr=Jo);try{G.textContent=Mr}catch(we){}}if(kt)try{kt(Lr())}catch(we){safeWarn$3("cineResults.updateCalculations could not render temperature note.",we)}if(Zt)try{Zt()}catch(we){safeWarn$3("cineResults.updateCalculations could not verify FIZ compatibility.",we)}if(Ht)try{Ht()}catch(we){safeWarn$3("cineResults.updateCalculations could not verify controller compatibility.",we)}if(jo)try{jo()}catch(we){safeWarn$3("cineResults.updateCalculations could not verify ARRI compatibility.",we)}if(be&&ir)try{ir({document:resolveDocument$1(t),window:runtimeFeedbackState.dependencies.window,getDevices:Uo("getDevices"),getTexts:Uo("getTexts"),getCurrentLang:Uo("getCurrentLang"),cameraSelect:resolveElementFromOptions(t,"cameraSelect"),monitorSelect:resolveElementFromOptions(t,"monitorSelect"),videoSelect:resolveElementFromOptions(t,"videoSelect"),distanceSelect:resolveElementFromOptions(t,"distanceSelect"),batterySelect:resolveElementFromOptions(t,"batterySelect"),motorSelects:resolveElementFromOptions(t,"motorSelects"),controllerSelects:resolveElementFromOptions(t,"controllerSelects"),setupDiagramContainer:be})}catch(we){safeWarn$3("cineResults.updateCalculations could not render setup diagram.",we)}var Or=Uo("refreshGearListIfVisible");if(Or)try{Or()}catch(we){safeWarn$3("cineResults.updateCalculations could not refresh gear list.",we)}}catch(Uo){throw safeWarn$3("cineResults.updateCalculations total failure",Uo),Uo}}function setupRuntimeFeedback(e){var t=e||{},o=updateRuntimeDependencies(t),r=resolveDocument$1(t);captureFeedbackOptionElements(r);var n=resolveElementFromOptions(t,"runtimeFeedbackButton","runtimeFeedbackBtn","runtimeFeedbackBtn"),a=resolveElementFromOptions(t,"feedbackDialog","feedbackDialog","feedbackDialog"),s=resolveElementFromOptions(t,"feedbackForm","feedbackForm","feedbackForm"),l=resolveElementFromOptions(t,"feedbackCancelBtn","fbCancel","feedbackCancelBtn"),u=resolveElementFromOptions(t,"feedbackUseLocationBtn","fbUseLocationBtn","feedbackUseLocationBtn"),d=resolveElementFromOptions(t,"sensorModeSelect","fbSensorMode","sensorModeSelect"),m=resolveElementFromOptions(t,"framerateSelect","fbFramerate","framerateSelect");runtimeFeedbackState.elements.runtimeFeedbackButton=n,runtimeFeedbackState.elements.feedbackDialog=a,runtimeFeedbackState.elements.feedbackForm=s,runtimeFeedbackState.elements.feedbackCancelBtn=l,runtimeFeedbackState.elements.feedbackUseLocationBtn=u,d&&(runtimeFeedbackState.elements.sensorModeSelect=d),m&&(runtimeFeedbackState.elements.framerateSelect=m);function y(M){if(!a)return!1;var F=o.closeDialog;if(typeof F=="function")try{return F(a),!0}catch(z){M&&safeWarn$3(M,z)}if(typeof a.close=="function")try{return a.close(),!0}catch{}return!1}function h(M){if(typeof M=="number"&&Number.isFinite(M))return String(M);if(typeof M!="string"){if(M==null)return"";M=String(M)}var F=M.trim();return!F||F.toLowerCase()==="none"?"":F}function b(M,F,z){var x=M;if(!x&&r&&typeof r.getElementById=="function"&&F)try{x=r.getElementById(F)}catch{x=null}if(!x)return"";var H="";try{var W=x.options,U=typeof x.selectedIndex=="number"?x.selectedIndex:-1;if(W&&U>=0&&U<W.length){var j=W[U];j&&(typeof j.text=="string"&&j.text?H=j.text:typeof j.textContent=="string"&&j.textContent?H=j.textContent:typeof j.label=="string"&&j.label?H=j.label:typeof j.value=="string"&&j.value&&(H=j.value))}!H&&typeof x.value=="string"&&(H=x.value)}catch(Y){z&&safeWarn$3(z,Y),H=""}return h(H)}function v(){var M=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.cameraSelect:null;return b(M,"cameraSelect","cineResults could not inspect camera selection for runtime feedback prefill.")}function C(){var M="",F=o&&typeof o.getSelectedPlate=="function"?o.getSelectedPlate:null;if(F)try{M=h(F())}catch(x){safeWarn$3("cineResults could not resolve battery plate selection via helper for runtime feedback.",x),M=""}if(M)return M;var z=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.batteryPlateSelect:null;return b(z,"batteryPlateSelect","cineResults could not inspect battery plate selection for runtime feedback prefill.")}function A(){var M=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.batterySelect:null;return b(M,"batterySelect","cineResults could not inspect battery selection for runtime feedback prefill.")}function w(){var M=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.monitorSelect:null;return b(M,"monitorSelect","cineResults could not inspect monitor selection for runtime feedback prefill.")}function R(){var M=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.videoSelect:null;return b(M,"videoSelect","cineResults could not inspect wireless video selection for runtime feedback prefill.")}function _(){var M=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.distanceSelect:null;return b(M,"distanceSelect","cineResults could not inspect FIZ distance selection for runtime feedback prefill.")}function G(M,F,z){var x=[],H=Array.isArray(M)?M:[];if((!H||!H.length)&&r&&typeof r.getElementById=="function"&&Array.isArray(F)){for(var W=[],U=0;U<F.length;U+=1){var j=F[U];if(j){var Y=null;try{Y=r.getElementById(j)}catch{Y=null}Y&&W.push(Y)}}H=W}for(var le=0;le<H.length;le+=1){var be=H[le],re=Array.isArray(F)&&le<F.length?F[le]:null,de=b(be,re,z);de&&x.indexOf(de)===-1&&x.push(de)}return x}function O(){var M=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.motorSelects:null;return G(M,["motor1Select","motor2Select","motor3Select","motor4Select"],"cineResults could not inspect FIZ motor selection for runtime feedback prefill.")}function B(){var M=runtimeFeedbackState&&runtimeFeedbackState.elements?runtimeFeedbackState.elements.controllerSelects:null;return G(M,["controller1Select","controller2Select","controller3Select","controller4Select"],"cineResults could not inspect FIZ controller selection for runtime feedback prefill.")}function $(M,F){if(!(!M||typeof M!="object"||typeof M.value>"u")){var z=typeof F=="string"?F:h(F);typeof z!="string"&&(z="");var x=typeof M.tagName=="string"?M.tagName.toUpperCase():"";if(x==="SELECT")try{var H=M.options,W=!1;if(H&&typeof H.length=="number")for(var U=0;U<H.length;U+=1){var j=H[U];if(j){var Y=typeof j.value=="string"?j.value:"",le=typeof j.text=="string"?j.text:j.textContent;if(Y===z||le===z){j.selected=!0,W=!0;break}}}if(!W)if(z){var be=M.ownerDocument&&typeof M.ownerDocument.createElement=="function"?M.ownerDocument:null,re=be?be.createElement("option"):null;re&&(re.value=z,re.textContent=z,M.appendChild(re),re.selected=!0,W=!0)}else typeof M.selectedIndex=="number"&&(M.selectedIndex=-1);if(W){M.value=z;return}}catch(de){safeWarn$3("cineResults could not update runtime feedback select prefill.",de)}try{M.value=z}catch(de){safeWarn$3("cineResults could not update runtime feedback field prefill.",de)}}}function V(){if(r){for(var M=getFeedbackFieldEntries(r),F=null,z=null,x=null,H=null,W=null,U=null,j=null,Y=null,le=0;le<M.length;le+=1){var be=M[le];!be||!be.map||(be.map.key==="camera"&&!F?F=be:be.map.key==="batteryPlate"&&!z?z=be:be.map.key==="battery"&&!x?x=be:be.map.key==="wirelessVideo"&&!H?H=be:be.map.key==="monitor"&&!W?W=be:be.map.key==="distance"&&!U?U=be:be.map.key==="controllers"&&!j?j=be:be.map.key==="motors"&&!Y&&(Y=be))}if(F&&F.element&&$(F.element,v()),z&&z.element&&$(z.element,C()),x&&x.element&&$(x.element,A()),H&&H.element&&$(H.element,R()),W&&W.element&&$(W.element,w()),U&&U.element&&$(U.element,_()),j&&j.element){var re=B();$(j.element,re.join(", "))}if(Y&&Y.element){var de=O();$(Y.element,de.join(", "))}}}return attachHandlerOnce(n,"click","openDialog",function(){return function(){if(V(),!!a){var F=o.openDialog;if(typeof F=="function")try{F(a);return}catch(z){safeWarn$3("cineResults could not open runtime feedback dialog.",z)}if(typeof a.showModal=="function")try{a.showModal()}catch{}}}}),attachHandlerOnce(d,"change","sensorModeChange",function(){return function(){var F="";d&&typeof d.value=="string"&&(F=d.value),runtimeFeedbackState.selectedSensorMode=F,updateFramerateSelectOptionsForSensorMode(F,"")}}),attachHandlerOnce(a,"click","dialogBackdrop",function(){return function(F){if(a){var z=F?F.target:null;z===a&&y("cineResults could not close runtime feedback dialog from backdrop interaction.")}}}),attachHandlerOnce(l,"click","cancelDialog",function(){return function(){y("cineResults could not close runtime feedback dialog via helper.")}}),attachHandlerOnce(u,"click","useLocation",function(){return function(){if(u){var F=o.navigator,z=o.alert;if(!F||!F.geolocation||typeof F.geolocation.getCurrentPosition!="function"){typeof z=="function"&&z("Geolocation is not supported by your browser");return}u.disabled=!0;var x=function(W){try{if(!r)return;var U=null;try{U=r.getElementById("fbLocation")}catch(re){U=null}if(!U)return;var j=W&&W.coords&&typeof W.coords.latitude=="number"?W.coords.latitude:null,Y=W&&W.coords&&typeof W.coords.longitude=="number"?W.coords.longitude:null;if(j===null||Y===null)return;var le=j.toFixed?j.toFixed(5):String(j),be=Y.toFixed?Y.toFixed(5):String(Y);U.value=le+", "+be}finally{u.disabled=!1}},H=function(W){if(u.disabled=!1,typeof console<"u"&&typeof console.error=="function"&&console.error("Geolocation failed:",W),typeof z=="function"){var U="Unable to retrieve your location";W&&W.message&&(U+=": "+W.message),z(U)}};F.geolocation.getCurrentPosition(x,function(W){typeof console<"u"&&typeof console.warn=="function"&&console.warn("High accuracy geolocation failed, retrying with low accuracy",W),F.geolocation.getCurrentPosition(x,H,{enableHighAccuracy:!1,timeout:1e4,maximumAge:0})},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}}}),attachHandlerOnce(s,"submit","submitFeedback",function(){return function(F){if(F&&typeof F.preventDefault=="function")try{F.preventDefault()}catch{}if(r){for(var z={},x=getFeedbackFieldEntries(r),H=0;H<x.length;H+=1){var W=x[H],U=W.map,j=W.element;if(!(!U||!U.key)){var Y="";j&&typeof j.value<"u"&&(Y=String(j.value),U.trim&&Y&&(Y=Y.trim())),z[U.key]=Y}}var le="";try{le=o.getCurrentSetupKey?o.getCurrentSetupKey():""}catch(it){safeWarn$3("cineResults could not resolve the current setup key for runtime feedback.",it),le=""}var be=null;try{be=o.loadFeedback?o.loadFeedback():{}}catch(it){safeWarn$3("cineResults could not load runtime feedback from storage.",it),be={}}(!be||typeof be!="object")&&(be={}),be[le]||(be[le]=[]),be[le].push(z);try{typeof o.saveFeedback=="function"&&o.saveFeedback(be)}catch(it){safeWarn$3("cineResults could not save runtime feedback entry.",it)}for(var re=[],de=0;de<x.length;de+=1){var ne=x[de].map;!ne||!ne.key||re.push(ne.key+": "+(z[ne.key]||""))}var Ce=encodeURIComponent("Cine Power Planner Runtime Feedback"),Ee=encodeURIComponent(re.join(`
`)),Pe=o.mailTarget||"info@lucazanner.de",et="mailto:"+Pe+"?subject="+Ce+"&body="+Ee,Je=o.window||GLOBAL_SCOPE$7;if(Je&&Je.location)try{Je.location.href=et}catch(it){safeWarn$3("cineResults could not trigger runtime feedback email composition.",it)}if(a&&y("cineResults could not close runtime feedback dialog after submit."),typeof o.updateCalculations=="function")try{o.updateCalculations()}catch(it){safeWarn$3("cineResults could not refresh calculations after runtime feedback submit.",it)}}}}),!!(n&&a&&s)}var resultsAPI={localizeResultsSection,localizeBatteryComparisonSection,updateCalculations:updateCalculations$2,setupRuntimeFeedback,renderTemperatureNote:renderTemperatureNote$1};typeof runtimeFeedbackState<"u"&&runtimeFeedbackState&&runtimeFeedbackState.dependencies&&(runtimeFeedbackState.dependencies.updateCalculations=updateCalculations$2);freezeDeep$3(resultsAPI);runtimeFeedbackState&&runtimeFeedbackState.dependencies&&(runtimeFeedbackState.dependencies.renderTemperatureNote=renderTemperatureNote$1);exposeGlobal$3("renderTemperatureNote",renderTemperatureNote$1,{configurable:!0,enumerable:!1,writable:!0});exposeGlobal$3("updateCalculations",updateCalculations$2,{configurable:!0,enumerable:!1,writable:!0});registerOrQueueModule$3("cineResults",resultsAPI,{category:"ui",description:"Power summary localisation and runtime feedback coordination.",replace:!0},function(e){safeWarn$3("Unable to register cineResults module.",e)});exposeGlobal$3("cineResults",resultsAPI,{configurable:!0,enumerable:!1,writable:!1});function detectGlobalScope$3(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$6=detectGlobalScope$3();function resolveModuleBase$2(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const FALLBACK_BASE={freezeDeep(e){if(e&&(typeof e=="object"||typeof e=="function"))try{Object.freeze(e)}catch{}return e},exposeGlobal(e,t,o){try{const r=o||GLOBAL_SCOPE$6;if(r)return r[e]=t,!0}catch{}return!1},getModuleRegistry(){return null},registerOrQueueModule(){return!1}},MODULE_BASE$2=resolveModuleBase$2(GLOBAL_SCOPE$6)||FALLBACK_BASE,freezeDeep$2=typeof MODULE_BASE$2.freezeDeep=="function"?MODULE_BASE$2.freezeDeep:function e(t){return t},exposeGlobal$2=typeof MODULE_BASE$2.exposeGlobal=="function"?function e(t,o,r){return MODULE_BASE$2.exposeGlobal(t,o,GLOBAL_SCOPE$6,r||{})}:function e(t,o){try{return GLOBAL_SCOPE$6[t]=o,!0}catch{return!1}},moduleRegistry$1=typeof MODULE_BASE$2.getModuleRegistry=="function"?MODULE_BASE$2.getModuleRegistry(GLOBAL_SCOPE$6):null,registerOrQueueModule$2=typeof MODULE_BASE$2.registerOrQueueModule=="function"?function e(t,o,r,n){return MODULE_BASE$2.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$6,moduleRegistry$1)}:function e(){return!1};function sanitizeLogger(e){return!e||typeof e!="object"?typeof console=="object"&&console?console:null:e}function sanitizeContext(e){const t=e&&typeof e=="object"?e:{},o=t.windowRef||t.window||(typeof window<"u"?window:null)||(typeof GLOBAL_SCOPE$6.window<"u"?GLOBAL_SCOPE$6.window:null),r=t.documentRef||t.document||o&&o.document||(typeof document<"u"?document:null)||GLOBAL_SCOPE$6&&GLOBAL_SCOPE$6.document||null,n=typeof t.openFallbackPrintView=="function"?t.openFallbackPrintView:function(){return!1},a=typeof t.closeAfterPrint=="function"?t.closeAfterPrint:function(){},s=typeof t.printDocumentTitle=="string"?t.printDocumentTitle:"",l=typeof t.originalDocumentTitle=="string"?t.originalDocumentTitle:r&&typeof r.title=="string"?r.title:"",u=sanitizeLogger(t.logger||GLOBAL_SCOPE$6&&GLOBAL_SCOPE$6.console);return{windowRef:o,documentRef:r,openFallbackPrintView:n,closeAfterPrint:a,printDocumentTitle:s,originalDocumentTitle:l,logger:u,logPrefix:typeof t.logPrefix=="string"&&t.logPrefix?t.logPrefix:"Overview print",exportLogPrefix:typeof t.exportLogPrefix=="string"&&t.exportLogPrefix?t.exportLogPrefix:"Overview PDF export"}}function log(e,t,o,r){if(!(!e||typeof e[t]!="function"))try{typeof r<"u"?e[t](o,r):e[t](o)}catch{}}function triggerOverviewPrintWorkflow(e,t){const o=sanitizeContext(e),{windowRef:r,documentRef:n,openFallbackPrintView:a,closeAfterPrint:s}=o,l=t&&typeof t=="object"&&t.preferFallback===!0,u=t&&typeof t=="object"&&typeof t.reason=="string"?t.reason:"print",d=u==="export"||u==="rental-export",m=d?o.exportLogPrefix:o.logPrefix,y=o.logger;let h=0;function b(A){h+=1,A&&A.name!=="AbortError"&&log(y,"warn",`${m}: falling back to print window.`,A);let w=!1;try{w=a()}catch(R){log(y,"error",`${m}: fallback print window failed to open.`,R),w=!1}if(w){try{s()}catch(R){log(y,"warn",`${m}: unable to run post-print cleanup after fallback window.`,R)}return!0}return A&&A.name!=="AbortError"&&log(y,"error",`${m}: unable to open fallback print window.`,A),!1}function v(){if(!r||typeof r.print!="function")return!1;try{n&&o.printDocumentTitle&&(n.title=o.printDocumentTitle);const A=r.print();return A&&typeof A.then=="function"&&A.catch(w=>{h||b(w)}),!0}catch(A){return b(A)}}let C=!1;if(!C&&GLOBAL_SCOPE$6.cineFeaturePrintPreview&&typeof GLOBAL_SCOPE$6.cineFeaturePrintPreview.open=="function")try{GLOBAL_SCOPE$6.cineFeaturePrintPreview.open(),C=!0}catch(A){log(y,"warn",`${m}: preview failed to open.`,A)}if(C||(l&&!d?(C=b(),C||(C=v())):C=v()),!C&&h===0&&(C=b()),!C&&n&&typeof n.title=="string"&&n.title===o.printDocumentTitle)try{n.title=o.originalDocumentTitle}catch(A){log(y,"warn",`${m}: unable to restore original document title after failed print.`,A)}return C}function createOverviewPrintWorkflow(e){const t=sanitizeContext(e);return freezeDeep$2({trigger(r){return triggerOverviewPrintWorkflow(t,r)}})}const printAPI=freezeDeep$2({createOverviewPrintWorkflow,triggerOverviewPrintWorkflow});try{registerOrQueueModule$2("cineFeaturePrint",printAPI,{category:"feature",description:"Print orchestration for overview exports and PDF generation.",freeze:!1,replace:!0,connections:["cineModuleBase","cineModuleContext","cineUi"]},e=>{log(sanitizeLogger(GLOBAL_SCOPE$6&&GLOBAL_SCOPE$6.console),"warn","Unable to register cineFeaturePrint module.",e)})}catch(e){log(sanitizeLogger(GLOBAL_SCOPE$6&&GLOBAL_SCOPE$6.console),"warn","cineFeaturePrint registration failed.",e)}const globalExports$1=[["cineFeaturePrint",printAPI],["createOverviewPrintWorkflow",createOverviewPrintWorkflow],["triggerOverviewPrintWorkflow",triggerOverviewPrintWorkflow]];globalExports$1.forEach(([e,t])=>{exposeGlobal$2(e,t,{configurable:!0,writable:!0})});const createOverviewPrintWorkflowModule=createOverviewPrintWorkflow,triggerOverviewPrintWorkflowModule=triggerOverviewPrintWorkflow;function collectOverviewLoggingScopes(){const e=[];return typeof globalThis<"u"&&globalThis&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&window&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&self&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&global&&e.indexOf(global)===-1&&e.push(global),e}function resolveOverviewLoggingResolver(){return resolverApi}function resolveLegacyOverviewLogger(){const e=collectOverviewLoggingScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!o||typeof o!="object"&&typeof o!="function")continue;let r=null;try{r=o.cineLogging||null}catch{r=null}if(r&&typeof r.createLogger=="function")try{return r.createLogger("overview",{meta:{source:"overview-dialog"}})}catch(n){try{typeof r.error=="function"&&r.error("Failed to create overview logger",n,{namespace:"overview-bootstrap"})}catch{}}}return null}const overviewLogger=(()=>{const e=resolveOverviewLoggingResolver();if(e&&typeof e.resolveLogger=="function")try{const t=e.resolveLogger("overview",{meta:{source:"overview-dialog"}});if(t)return t}catch{}return resolveLegacyOverviewLogger()})(),overviewConsoleFallback=typeof console=="object"&&console?console:null,OVERVIEW_LOG_META_DEFAULTS=Object.freeze({namespace:"overview",source:"overview-dialog"});function resolveOverviewCloneScope(){return typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null}function overviewJsonDeepClone(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}function overviewResolveStructuredClone(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}if(typeof require=="function"){try{const t=require("node:util");if(t&&typeof t.structuredClone=="function")return t.structuredClone.bind(t)}catch{}try{const t=require("util");if(t&&typeof t.structuredClone=="function")return t.structuredClone.bind(t)}catch{}}return null}function convertGearListSelectorsToPlainText(e){if(!e||typeof e.querySelectorAll!="function")return;const t=e.querySelector("#gearListOutput");if(!t||typeof t.querySelectorAll!="function")return;const o=t.ownerDocument||(typeof document<"u"?document:null);if(!o)return;const r=t.querySelectorAll("select");if(!r.length)return;const n=a=>!a||typeof a.getAttributeNames!="function"?[]:a.getAttributeNames().filter(s=>s&&s.toLowerCase().indexOf("data-")===0).map(s=>({name:s,value:a.getAttribute(s)}));r.forEach(a=>{if(!a)return;const s=a.options?Array.from(a.options):[],l=[];if(a.multiple)s.forEach(y=>{if(!y||!y.selected)return;const h=typeof y.textContent=="string"?y.textContent.trim():"";h&&l.push(h)});else{const y=s.find(h=>h&&h.selected)||s.find(h=>h&&h.defaultSelected)||null;if(y){const h=typeof y.textContent=="string"?y.textContent.trim():"";h&&l.push(h)}}let u=l.join(", "),d=!1;if(!u){const y=["data-empty-label","data-placeholder","placeholder","data-label-off","data-default-label"];for(let h=0;h<y.length;h+=1){const b=y[h],v=a.getAttribute?a.getAttribute(b):null;if(v&&v.trim()){u=v.trim();break}}}!u&&typeof a.value=="string"&&a.value.trim()&&(u=a.value.trim()),u||(u="—",d=!0);const m=o.createElement("span");m.className="gear-select-value",a.className&&m.setAttribute("data-gear-select-class",a.className),a.id&&m.setAttribute("data-gear-select-id",a.id),a.name&&m.setAttribute("data-gear-select-name",a.name),m.setAttribute("data-gear-select-value",u),d&&m.setAttribute("data-gear-select-empty","true"),n(a).forEach(({name:y,value:h})=>{!m.hasAttribute(y)&&h!==null&&m.setAttribute(y,h)}),m.textContent=u,typeof a.replaceWith=="function"?a.replaceWith(m):a.parentNode&&a.parentNode.replaceChild(m,a)})}function createOverviewDeepClone(e){const t=overviewResolveStructuredClone(e);return t?function(r){if(r===null||typeof r!="object")return r;try{return t(r)}catch{}return overviewJsonDeepClone(r)}:overviewJsonDeepClone}const OVERVIEW_DEEP_CLONE=(()=>{const e=resolveOverviewCloneScope();return e&&typeof e.__cineDeepClone=="function"?e.__cineDeepClone:createOverviewDeepClone(e)})();function cloneOverviewLogMeta(e){if(!e||typeof e!="object")return{};const t={},o=Object.keys(e);for(let r=0;r<o.length;r+=1){const n=o[r],a=e[n];if(typeof a>"u")continue;if(a===null){t[n]=null;continue}const s=typeof a;if(s==="string"||s==="number"||s==="boolean"){t[n]=a;continue}if(a instanceof Date&&typeof a.toISOString=="function"){t[n]=a.toISOString();continue}if(Array.isArray(a)){const u=OVERVIEW_DEEP_CLONE(a);if(u!==a){t[n]=u;continue}t[n]=a.map(d=>{if(d===null||typeof d>"u")return null;const m=typeof d;if(m==="string"||m==="number"||m==="boolean")return d;if(d instanceof Date&&typeof d.toISOString=="function")return d.toISOString();const y=OVERVIEW_DEEP_CLONE(d);return y!==d||d===null||typeof d!="object"?y:String(d)});continue}if(s==="object"){const u=OVERVIEW_DEEP_CLONE(a);u!==a||a===null?t[n]=u:t[n]=String(a);continue}const l=OVERVIEW_DEEP_CLONE(a);l!==a||a===null||typeof a!="object"?t[n]=l:t[n]=String(a)}return t}function createOverviewLogMetaSnapshot(e,t){const o=typeof e=="string"&&e?e.toLowerCase():"info",r=Date.now();let n=null;try{n=new Date(r).toISOString()}catch{try{n=new Date().toISOString()}catch{n=String(r)}}const a={...OVERVIEW_LOG_META_DEFAULTS,...cloneOverviewLogMeta(t)};return a.namespace||(a.namespace=OVERVIEW_LOG_META_DEFAULTS.namespace),a.source||(a.source=OVERVIEW_LOG_META_DEFAULTS.source),a.level=o,a.timestamp=n,a.timestampMs=r,(typeof a.eventId!="string"||!a.eventId)&&(a.eventId=`overview-${r.toString(36)}-${Math.random().toString(36).slice(2,10)}`),(typeof a.correlationId!="string"||!a.correlationId)&&(a.correlationId=a.eventId),a}function logOverview(e,t,o,r){const n=typeof e=="string"&&e?e.toLowerCase():"info",a=typeof o>"u"?void 0:o,s=createOverviewLogMetaSnapshot(n,r),l={...s,channel:"cineLogging"},u={...s,channel:"console"};let d=!1;if(overviewLogger&&typeof overviewLogger[n]=="function")try{overviewLogger[n](t,a,l)}catch(v){if(d=!0,u.consoleFallbackUsed=!0,u.consoleFallbackReason="logger-invocation-failed",u.loggerErrorMessage=v&&v.message?v.message:void 0,overviewConsoleFallback&&typeof overviewConsoleFallback.warn=="function")try{overviewConsoleFallback.warn("Overview logger invocation failed",v,{meta:u})}catch{}var m=function(A){const w=typeof A=="string"?A:"";if(!w)return{projectHtml:"",gearHtml:""};const R={projectHtml:"",gearHtml:w},_=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,G=(B,$)=>{if(typeof B!="function")return null;try{const V=B.call(_,w);if(!V||typeof V!="object")return null;const M=typeof V.projectHtml=="string"?V.projectHtml:"",F=typeof V.gearHtml=="string"?V.gearHtml:M?"":w;return{projectHtml:M,gearHtml:F}}catch(V){return logOverview("warn","Unable to split gear list HTML for overview rendering.",V,{action:"split-gear-html",source:$}),null}},O=[];typeof getSafeGearListHtmlSections=="function"&&O.push({fn:getSafeGearListHtmlSections,source:"global-getSafeGearListHtmlSections"}),_&&_.cineGearList&&typeof _.cineGearList.getSafeGearListHtmlSections=="function"&&O.push({fn:_.cineGearList.getSafeGearListHtmlSections,source:"cineGearList.getSafeGearListHtmlSections"}),typeof splitGearListHtml=="function"&&O.push({fn:splitGearListHtml,source:"global-splitGearListHtml"}),_&&_.cineGearList&&typeof _.cineGearList.splitGearListHtml=="function"&&O.push({fn:_.cineGearList.splitGearListHtml,source:"cineGearList.splitGearListHtml"});for(let B=0;B<O.length;B+=1){const $=O[B],V=G($.fn,$.source);if(V)return V}return R};(function(){const A=[];typeof globalThis<"u"&&globalThis&&A.push(globalThis),typeof window<"u"&&window&&A.indexOf(window)===-1&&A.push(window),typeof self<"u"&&self&&A.indexOf(self)===-1&&A.push(self),typeof global<"u"&&global&&A.indexOf(global)===-1&&A.push(global);for(let w=0;w<A.length;w+=1){const R=A[w];if(!(!R||typeof R!="object"&&typeof R!="function"))try{R.resolveOverviewGearListSections||(R.resolveOverviewGearListSections=m)}catch{}}})()}else d=!0,u.consoleFallbackUsed=!0,u.consoleFallbackReason=overviewLogger?"logger-level-missing":"logger-unavailable";if(!overviewConsoleFallback)return s.eventId;const y=n==="warn"?"warn":n==="error"?"error":n==="debug"?"debug":"info",h=typeof overviewConsoleFallback[y]=="function"?overviewConsoleFallback[y]:typeof overviewConsoleFallback.log=="function"?overviewConsoleFallback.log:null;if(!h)return s.eventId;d||(u.consoleFallbackUsed=u.consoleFallbackUsed||!1);const b=[`[overview:${u.eventId}] ${t}`];typeof a<"u"&&b.push(a),b.push({meta:u});try{h.apply(overviewConsoleFallback,b)}catch{}return s.eventId}let pendingPrintCleanup=null;const PRINT_PREFERENCES_STORAGE_KEY="cineRentalPrintSections";function getPrintSectionConfig(){return[{id:"project",selector:"#projectRequirementsOutput",defaultVisible:!0,labelKey:"rentalPrintSectionProject",fallbackLabel:"Project Requirements"},{id:"devices",selector:"#overviewDeviceSection",defaultVisible:!0,labelKey:"rentalPrintSectionDevices",fallbackLabel:"Camera Setup Devices"},{id:"power",selector:"#resultsSection",defaultVisible:!0,labelKey:"rentalPrintSectionPower",fallbackLabel:"Power Summary"},{id:"battery",selector:".battery-comparison-section",defaultVisible:!0,labelKey:"rentalPrintSectionBattery",fallbackLabel:"Battery Comparison"},{id:"diagram",selector:"#setupDiagram",defaultVisible:!0,labelKey:"rentalPrintSectionDiagram",fallbackLabel:"Camera Diagram"},{id:"gear",selector:"#gearListOutput",defaultVisible:typeof window.hasProjectInfoData=="function"&&typeof window.getCurrentProjectInfo=="function"?window.hasProjectInfoData(window.getCurrentProjectInfo()):!0,labelKey:"rentalPrintSectionGearList",fallbackLabel:"Gear List"}]}function loadPrintPreferences(){if(typeof localStorage>"u")return null;try{const e=localStorage.getItem(PRINT_PREFERENCES_STORAGE_KEY);if(!e)return null;const t=JSON.parse(e);return!t||typeof t!="object"?null:t.sections||t.layout?{sections:typeof t.sections=="object"&&t.sections!==null?{...t.sections}:{},layout:typeof t.layout=="string"?t.layout:"standard"}:{sections:{...t},layout:"rental"}}catch(e){logOverview("warn","Unable to read rental print section preferences.",e,{action:"rental-print-load-preferences"})}return null}function savePrintPreferences(e){if(typeof localStorage>"u")return!1;try{const t=JSON.stringify(e||{});return localStorage.setItem(PRINT_PREFERENCES_STORAGE_KEY,t),!0}catch(t){logOverview("warn","Unable to persist rental print section preferences.",t,{action:"rental-print-save-preferences"})}return!1}function runPendingPrintCleanup(e){if(typeof pendingPrintCleanup!="function")return;const t=pendingPrintCleanup;pendingPrintCleanup=null;try{t()}catch(o){logOverview("warn","Failed to restore print state after workflow finished.",o,{action:"print-cleanup",reason:e})}}let printOptionsDialogContext=null;function getPrintOptionsDialogContext(){if(printOptionsDialogContext)return printOptionsDialogContext;if(typeof document>"u")return null;const e=document.getElementById("printOptionsDialog");if(!e)return null;e.hasAttribute("data-print-backdrop-close")||(e.addEventListener("click",h=>{h&&h.target===e&&closeDialog(e)}),e.addEventListener("cancel",h=>{h&&h.preventDefault(),closeDialog(e)}),e.setAttribute("data-print-backdrop-close","true"));const t=e.querySelector("#printOptionsForm"),o=e.querySelector("#printOptionsSections"),r=e.querySelector("#printOptionsSelectAllBtn"),n=e.querySelector("#printOptionsCancelBtn"),a=e.querySelector("#printOptionsExportBtn"),s=e.querySelector("#printOptionsPrintBtn"),l=e.querySelector("#printOptionsDialogTitle"),u=e.querySelector("#printOptionsDialogDescription"),d=e.querySelector("#printOptionsLayout"),m=e.querySelector("#printOptionsLayoutLabel"),y=e.querySelector("#printOptionsLayoutChoices");return!t||!o||!l||!u||!r||!n||!a||!s?null:(printOptionsDialogContext={dialog:e,form:t,sections:o,selectAllBtn:r,cancelBtn:n,exportBtn:a,printBtn:s,layoutFieldset:d,layoutLabel:m,layoutChoices:y,title:l,description:u},printOptionsDialogContext)}function populatePrintOptionsDialog(e,t,o){if(!e)return;const r=texts&&texts[currentLang]||texts?.en||{},n=texts?.en||{},a=r.rentalPrintDialogTitle||n.rentalPrintDialogTitle||"Export PDF / Print",s=r.rentalPrintDialogDescription||n.rentalPrintDialogDescription||"Choose what to include before exporting or printing.",l=r.rentalPrintDialogSectionsLabel||n.rentalPrintDialogSectionsLabel||"Sections to include",u=r.rentalPrintDialogConfirm||n.rentalPrintDialogConfirm||"Export PDF",d=r.rentalPrintDialogCancel||n.rentalPrintDialogCancel||"Cancel",m=r.rentalPrintDialogSelectAll||n.rentalPrintDialogSelectAll||"Select all",y=r.printBtn||n.printBtn||"Print",h=r.printOptionsLayoutLabel||n.printOptionsLayoutLabel||"Layout",b=r.printOptionsLayoutStandard||n.printOptionsLayoutStandard||"Standard layout",v=r.printOptionsLayoutRental||n.printOptionsLayoutRental||"Rental-friendly layout";e.title.textContent=a,e.description.textContent=s,e.selectAllBtn.textContent=m,e.cancelBtn.textContent=d,e.exportBtn.textContent=u,e.printBtn.textContent=y,e.sections.innerHTML="";const C=document.createElement("legend");C.textContent=l,e.sections.appendChild(C);const A=getPrintSectionConfig(),w=t&&typeof t.sections=="object"?t.sections:t;if(A.forEach(M=>{const F=r[M.labelKey]||n[M.labelKey]||M.fallbackLabel,z=document.createElement("label");z.className="print-options-section";const x=document.createElement("input");x.type="checkbox",x.name="print-section",x.value=M.id,x.id=`printSection_${M.id}`;const H=w&&Object.prototype.hasOwnProperty.call(w,M.id)?w[M.id]:M.defaultVisible;x.checked=H!==!1;const W=document.createElement("span");W.textContent=F,z.appendChild(x),z.appendChild(W),e.sections.appendChild(z)}),e.layoutFieldset&&e.layoutLabel&&e.layoutChoices){e.layoutLabel.textContent=h,e.layoutChoices.innerHTML="";const M=t&&typeof t.layout=="string"?t.layout:"standard";[{value:"standard",label:b},{value:"rental",label:v}].forEach(z=>{const x=document.createElement("label");x.className="print-options-section";const H=document.createElement("input");H.type="radio",H.name="print-layout",H.value=z.value,z.value===M&&(H.checked=!0);const W=document.createElement("span");W.textContent=z.label,x.appendChild(H),x.appendChild(W),e.layoutChoices.appendChild(x)}),e.layoutFieldset.hidden=!1}else e.layoutFieldset&&(e.layoutFieldset.hidden=!0);const R=t&&typeof t=="object"?t:{};e.form._printConfirmHandler=typeof o=="function"?o:null,typeof e.form._removeDialogListeners=="function"&&(e.form._removeDialogListeners(),e.form._removeDialogListeners=null);const _=()=>{const M={};e.form.querySelectorAll('input[name="print-section"]').forEach(x=>{M[x.value]=x.checked});const F=e.form.querySelector('input[name="print-layout"]:checked'),z=F?F.value:R.layout||"standard";return{sections:M,layout:z}},G=(M,F)=>{M.preventDefault();const z=_();savePrintPreferences(z),closeDialog(e.dialog),typeof e.form._printConfirmHandler=="function"&&e.form._printConfirmHandler({mode:F,preferences:z})},O=M=>G(M,"export"),B=M=>G(M,"print"),$=M=>{M.preventDefault(),closeDialog(e.dialog)},V=M=>{M.preventDefault(),e.form.querySelectorAll('input[name="print-section"]').forEach(F=>{F.checked=!0})};e.form.addEventListener("submit",O),e.exportBtn.addEventListener("click",O),e.printBtn.addEventListener("click",B),e.cancelBtn.addEventListener("click",$),e.selectAllBtn.addEventListener("click",V),e.form._removeDialogListeners=()=>{e.form.removeEventListener("submit",O),e.exportBtn.removeEventListener("click",O),e.printBtn.removeEventListener("click",B),e.cancelBtn.removeEventListener("click",$),e.selectAllBtn.removeEventListener("click",V)}}function createOverviewLoggerProxy(e){const t=e&&typeof e=="object"?Object.freeze({...e}):null;return Object.freeze({log(r,n){logOverview("info",r,n,t)},info(r,n){logOverview("info",r,n,t)},debug(r,n){logOverview("debug",r,n,t)},warn(r,n){logOverview("warn",r,n,t)},error(r,n){logOverview("error",r,n,t)}})}function generatePrintableOverview$1(e={}){const t=e&&typeof e=="object"?e:{},{autoPrint:o=!1}=t;runPendingPrintCleanup("overview-init");const r=ee=>typeof escapeHtml=="function"?escapeHtml(ee):String(ee??""),n=ee=>typeof generateConnectorSummary=="function"?generateConnectorSummary(ee):"",a=typeof document<"u"?document.getElementById("setupName"):null,s=a?a.value:"",l=new Date,u={de:"de-DE",es:"es-ES",fr:"fr-FR",en:"en-US",it:"it-IT"},d=typeof currentLang=="string"?currentLang:"en",m=typeof texts=="object"&&texts?texts[d]||texts.en||{}:{},y=u[d]||"en-US",h=l.toLocaleDateString(y)+" "+l.toLocaleTimeString(),b=currentProjectInfo&&typeof currentProjectInfo.projectName=="string"?currentProjectInfo.projectName.trim():"",v=s||b,C=ee=>ee?String(ee).trim().replace(/[\\/:*?"<>|]+/g,"").replace(/\s+/g," ").replace(/^\.+/,"").replace(/\.+$/,"").trim():"",A=ee=>String(ee).padStart(2,"0"),w=`${l.getFullYear()}-${A(l.getMonth()+1)}-${A(l.getDate())}`,R=`${A(l.getHours())}-${A(l.getMinutes())}-${A(l.getSeconds())}`,_=`${w} ${R}`.trim(),G=C(_)||_,O=C(v)||"Project",B=C((m.overviewTitle||"").trim()),$=C((m.gearListNav||"").trim()),V=C((m.projectRequirementsNav||"").trim());let F=C((m.overviewExportTitleSuffix||"").trim());if(!F){const ee=[];$&&ee.push($),V&&ee.push(V),ee.length===2&&(F=C(ee.join(" and ")))}if(!F){const ee=[B,$].filter(Boolean);F=ee.length?C(ee.join(" – ")):""}F||(F="Gear List and Project Requirements"),F=C(F)||"Gear List and Project Requirements";const z=[G,O,F].filter(Boolean).join(" - ").replace(/\s+/g," ").trim(),x=typeof document<"u"?document.title:"",H=typeof localStorage<"u"?localStorage.getItem("customLogo"):null,W=m.generatedOnLabel||"Generated on",j=(ee=>{const I=typeof ee=="string"?ee.trim():"";return I?/[:：]$/.test(I)?I:`${I}:`:""})(W);let Y='<div class="device-category-container">';const le={},be=[],re=(ee,I)=>{le[ee]||(le[ee]=[],be.push(ee)),le[ee].push(I)},de=(ee,I,N,K=null)=>{if(ee.value&&ee.value!=="None"){const oe=ee.value,ce=ee.options[ee.selectedIndex].text;let me;K?me=devices[N]&&devices[N][K]&&devices[N][K][oe]:me=devices[N]&&devices[N][oe];const De=r(ce);let Ge="";if(me!=null){const Ue=n(me),Xe=m.videoLatencyLabel||m.monitorLatencyLabel||"Latency:",ft=m.videoFrequencyLabel||"Frequency:",Le=(me.latencyMs!==void 0?`<div class="info-box video-conn"><strong>${r(Xe)}</strong> ${r(String(me.latencyMs))}</div>`:"")+(me.frequency?`<div class="info-box video-conn"><strong>${r(ft)}</strong> ${r(String(me.frequency))}</div>`:"");Ge=Ue+Le}re(I,`<div class="device-block"><strong>${De}</strong>${Ge}</div>`)}},ne=typeof lensSelect<"u"&&lensSelect&&typeof lensSelect=="object"?lensSelect:null,Ee=!devices||typeof devices!="object"?null:devices.lenses&&Object.keys(devices.lenses).length?devices.lenses:devices.accessories&&devices.accessories.lenses?devices.accessories.lenses:null,Pe=texts&&typeof texts=="object"&&texts.en||{},et=new Map,Je=ee=>{const I=JSON.stringify(ee||{});if(et.has(I))return et.get(I);let N=null;try{N=typeof Intl=="object"&&Intl&&typeof Intl.NumberFormat=="function"?new Intl.NumberFormat(y,ee):null}catch{N=null}return et.set(I,N),N},it=(ee,I={})=>{const N=typeof ee=="string"?Number(ee):ee;if(!Number.isFinite(N))return"";const K=Je(I);if(K)return K.format(N);const oe=typeof I.maximumFractionDigits=="number"?I.maximumFractionDigits:0;return N.toFixed(oe)},rt=ee=>{if(typeof ee!="string")return"";const I=ee.trim().toLowerCase();return I==="imperial"||I==="metric"?I:""},Pt=()=>{const ee=resolveOverviewCloneScope(),N=(ee&&typeof ee.focusScalePreference=="string"?ee.focusScalePreference:null)||(typeof focusScalePreference=="string"?focusScalePreference:null)||"metric";return rt(N)||"metric"},vt=ee=>{if(ee&&typeof ee=="object"){const I=rt(ee.focusScale);if(I)return I}return Pt()},bo=ee=>{const I=vt(ee),N=I==="imperial"?"focusScaleImperial":"focusScaleMetric",K=m&&typeof m[N]=="string"?m[N].trim():"";if(K)return K;const oe=typeof Pe[N]=="string"?Pe[N].trim():"";return oe||(I==="imperial"?"Imperial":"Metric")},Et=(ee=null)=>vt(ee)==="imperial",Ut=(ee,I=null)=>{const N=typeof ee=="string"?Number(ee):ee;if(!Number.isFinite(N))return"";if(Et(I)){const oe=N/25.4,ce=oe>=10?1:2,me=it(oe,{maximumFractionDigits:ce,minimumFractionDigits:0});return me?`${me} in`:""}const K=it(N,{maximumFractionDigits:1,minimumFractionDigits:0});return K?`${K} mm`:""},ge=(ee,I=null)=>{const N=typeof ee=="string"?Number(ee):ee;if(!Number.isFinite(N))return"";if(Et(I)){const oe=N/2.54,ce=oe>=10?1:2,me=it(oe,{maximumFractionDigits:ce,minimumFractionDigits:0});return me?`${me} in`:""}const K=it(N,{maximumFractionDigits:1,minimumFractionDigits:0});return K?`${K} cm`:""},ue=(ee,I=null)=>{const N=typeof ee=="string"?Number(ee):ee;if(!Number.isFinite(N))return"";if(Et(I)){const oe=N/453.59237,ce=oe>=10?1:2,me=it(oe,{maximumFractionDigits:ce,minimumFractionDigits:0});return me?`${me} lb`:""}const K=it(N,{maximumFractionDigits:0,minimumFractionDigits:0});return K?`${K} g`:""},We=ee=>{if(!ee||typeof ee!="object")return null;if(typeof ee.minFocusMeters<"u")return ee.minFocusMeters;if(typeof ee.minFocus<"u")return ee.minFocus;if(typeof ee.minFocusCm<"u"){const I=Number(ee.minFocusCm);if(Number.isFinite(I))return I/100}return null},Me=(ee,I=null)=>{const N=typeof ee=="string"?Number(ee):ee;if(!Number.isFinite(N))return"";if(Et(I)){const ce=N*3.280839895,me=ce<10?2:1,De=it(ce,{maximumFractionDigits:me,minimumFractionDigits:me});return De?`${De} ft`:""}const K=N<1?2:1,oe=it(N,{maximumFractionDigits:K,minimumFractionDigits:K});return oe?`${oe} m`:""},Te=ee=>{const I=typeof ee=="string"?Number(ee):ee;if(!Number.isFinite(I))return"";const N=it(I,{maximumFractionDigits:1,minimumFractionDigits:0});return N?`T${N}`:""},Be=ee=>Array.isArray(ee)?ee.map(N=>Be(N)).filter(Boolean).join(", "):ee===null||typeof ee>"u"?"":String(ee).trim(),Ve=ee=>{const I=Be(ee);return I?I.charAt(0).toUpperCase()+I.slice(1):""},je=ee=>{if(ee===null||typeof ee>"u")return"";const I=m.lensSpecYes||"Yes",N=m.lensSpecNo||"No";return ee===!0||typeof ee=="string"&&ee.toLowerCase()==="true"?I:ee===!1||typeof ee=="string"&&ee.toLowerCase()==="false"?N:m.lensSpecUnknownValue||"Unknown"},mt=ee=>ee===null||typeof ee>"u"?"":ee===!0||typeof ee=="string"&&ee.toLowerCase()==="true"?m.lensSpecSupportRequired||"Required":ee===!1||typeof ee=="string"&&ee.toLowerCase()==="false"?m.lensSpecSupportNotRequired||"Not required":m.lensSpecUnknownValue||"Unknown",ct=ee=>Be(ee),$t=ee=>Be(ee),fo=ee=>Be(ee),no=ee=>{if(!ee||typeof ee!="object")return"";const I=[{key:"general",labelKey:"lensSpecCategoryGeneralLabel",boxes:[]},{key:"optics",labelKey:"lensSpecCategoryOpticsLabel",boxes:[]},{key:"physical",labelKey:"lensSpecCategoryPhysicalLabel",boxes:[]},{key:"support",labelKey:"lensSpecCategorySupportLabel",boxes:[]},{key:"notes",labelKey:"lensSpecCategoryNotesLabel",boxes:[]}],N=I.reduce((De,Ge)=>(De[Ge.key]=Ge,De),{}),K={lensSpecCategoryGeneralLabel:"General",lensSpecCategoryOpticsLabel:"Optics",lensSpecCategoryPhysicalLabel:"Physical",lensSpecCategorySupportLabel:"Support",lensSpecCategoryNotesLabel:"Notes"},oe=(De,Ge,Ue=null,Xe="general")=>{const ft=N[Xe]||I[0];let Le=Ge;if(Ue&&(Le=Ue(Ge,ee)),Le===null||typeof Le>"u"||typeof Le=="string"&&!Le.trim())return;const ot=typeof Le=="string"?Le:String(Le);if(!ot.trim())return;const _t=m[De]||De;ft.boxes.push(`<span class="info-box neutral-conn"><span class="info-box-label">${r(_t)}</span><span class="info-box-values">${r(ot)}</span></span>`)};oe("lensSpecBrandLabel",ee.brand,Be,"general"),oe("lensSpecTypeLabel",ee.lensType,Ve,"general"),oe("lensSpecMountLabel",ee.mount,$t,"general"),oe("lensSpecFocusScaleLabel",ee,bo,"general"),oe("lensSpecTStopLabel",ee.tStop,Te,"optics"),oe("lensSpecImageCircleLabel",ee.imageCircleMm,Ut,"optics"),oe("lensSpecMinFocusLabel",We(ee),Me,"optics"),oe("lensSpecFrontDiameterLabel",ee.frontDiameterMm,Ut,"physical"),oe("lensSpecLengthLabel",ee.lengthMm,Ut,"physical"),oe("lensSpecWeightLabel",ee.weight_g,ue,"physical"),oe("lensSpecRodStandardLabel",ee.rodStandard,ct,"support"),oe("lensSpecRodLengthLabel",ee.rodLengthCm,ge,"support"),Object.prototype.hasOwnProperty.call(ee,"clampOn")&&oe("lensSpecClampOnLabel",ee.clampOn,je,"support"),Object.prototype.hasOwnProperty.call(ee,"needsLensSupport")&&oe("lensSpecSupportLabel",ee.needsLensSupport,mt,"support"),oe("lensSpecNotesLabel",ee.notes,fo,"notes");const ce=I.filter(De=>De.boxes.length>0);return ce.length?`<div class="lens-info-categories">${ce.map(De=>{const Ge=De.labelKey,Ue=m[Ge]||K[Ge]||Ge;return`<div class="lens-info-category">${Ue?`<span class="lens-info-category__title">${r(Ue)}</span>`:""}<div class="info-box-list lens-info-grid">${De.boxes.join("")}</div></div>`}).join("")}</div>`:""},Nt=(ee,I)=>{if(!ee)return;const N=Array.from(ee.selectedOptions||[]).filter(K=>K&&typeof K.value=="string"&&K.value.trim()!==""&&K.value!=="None");N.length&&N.forEach(K=>{const oe=K.value,ce=Ee&&Ee[oe]?Ee[oe]:null,me=oe||K.text||"",De=r(me),Ge=ce?no(ce):"";re(I,`<div class="device-block lens-device-block"><strong>${De}</strong>${Ge}</div>`)})};de(cameraSelect,"category_cameras","cameras"),de(monitorSelect,"category_monitors","monitors"),de(videoSelect,"category_video","video"),de(distanceSelect,"category_fiz_distance","fiz","distance"),motorSelects.forEach(ee=>de(ee,"category_fiz_motors","fiz","motors")),controllerSelects.forEach(ee=>de(ee,"category_fiz_controllers","fiz","controllers")),de(batterySelect,"category_batteries","batteries"),de(hotswapSelect,"category_batteryHotswaps","batteryHotswaps"),Nt(ne,"category_lenses"),be.forEach(ee=>{const I=m[ee]||ee,N=overviewSectionIcons[ee]||"",K=N&&typeof iconMarkup=="function"?iconMarkup(N,"category-icon"):N?`<span class="category-icon icon-glyph" data-icon-font="uicons" aria-hidden="true">${N}</span>`:"",oe=ee==="category_fiz_motors"||ee==="category_fiz_controllers",ce=ee==="category_lenses";Y+=`<div class="${ce?"device-category device-category--full":"device-category"}"><h3>${K}${I}</h3><div class="${oe?"device-block-grid two-column fiz-single-column":ce?"device-block-grid two-column lens-device-grid":"device-block-grid single-column"}">${le[ee].join("")}</div></div>`}),Y+="</div>";const xo=Y?m.overviewDeviceSelectionHeading||m.deviceSelectionHeading||"Device Selection":"",Io=Y?`<section id="overviewDeviceSection" class="device-overview-section print-section"><h2>${r(xo)}</h2>${Y}</section>`:"",qo=breakdownListElem.innerHTML,eo=typeof document<"u"?document.getElementById("powerDiagram"):null;let To="";if(eo&&!eo.classList.contains("hidden")&&eo.innerHTML.trim().length>0){const ee=eo.cloneNode(!0);ee.id="powerDiagramOverview",ee.classList.remove("hidden"),ee.classList.add("power-diagram");const I=ee.querySelector("#powerDiagramBar");I&&(I.id="powerDiagramBarOverview");const N=ee.querySelector("#powerDiagramLegend");N&&(N.id="powerDiagramLegendOverview",N.classList.add("power-diagram-legend"));const K=ee.querySelector("#maxPowerText");K&&(K.id="maxPowerTextOverview",K.classList.add("power-diagram-note")),To=ee.outerHTML}const ko=ee=>{const I=document.getElementById(ee);return I?I.textContent:""},Jt=`
        <ul id="breakdownList">${qo}</ul>
        ${To}
        <p><strong>${m.totalPowerLabel}</strong> ${r(ko("heroTotalDraw"))}</p>
        <p><strong>${m.totalCurrent144Label}</strong> ${r(ko("heroCurrent144"))}</p>
        <p><strong>${m.totalCurrent12Label}</strong> ${r(ko("heroCurrent12"))}</p>
        <p><strong>${m.batteryLifeLabel}</strong> ${r(ko("heroRuntime"))}</p>
        <p><strong>${m.batteryCountLabel}</strong> ${r(ko("heroBatteryCount"))}</p>
    `,lr={danger:"status-message--danger",warning:"status-message--warning",note:"status-message--note",success:"status-message--success",info:"status-message--info"},pt=ee=>{if(!ee)return"";const I=ee.dataset?ee.dataset.statusLevel:ee.getAttribute&&ee.getAttribute("data-status-level");if(I&&lr[I])return lr[I];if(ee.classList)return Object.values(lr).find(K=>ee.classList.contains(K))||"";const N=typeof ee.getAttribute=="function"?ee.getAttribute("class"):"";if(N){const K=N.split(/\s+/);return Object.values(lr).find(oe=>K.includes(oe))||""}return""},mo=ee=>{if(!ee||ee.textContent.trim()==="")return"";const I=["status-message"],N=pt(ee);return N&&I.push(N),`<p class="${I.join(" ")}">${r(ee.textContent)}</p>`},go=mo(pinWarnElem)+mo(dtapWarnElem),So=`
        <section id="resultsSection" class="results-section print-section">
            <h2>${m.resultsHeading}</h2>
            <div class="results-body">
                ${Jt}
                ${go?`<div class="results-warnings">${go}</div>`:""}
            </div>
        </section>
    `,k=typeof document<"u"?document.getElementById("batteryComparison"):null,Q=ee=>{if(!ee||ee.hasAttribute("hidden")||ee.classList&&ee.classList.contains("hidden")||ee.style&&ee.style.display==="none")return!1;if(typeof window<"u"&&typeof window.getComputedStyle=="function"){const N=window.getComputedStyle(ee);if(N.display==="none"||N.visibility==="hidden")return!1}const I=ee.querySelector("table");return I?I.innerHTML.trim().length>0:!1};let X="";if(Q(k)){const ee=k.cloneNode(!0);ee.id="batteryComparisonOverview",ee.classList.add("print-section","battery-comparison-section"),ee.removeAttribute("style");const I=ee.querySelector("#batteryComparisonHeading");I&&(I.id="batteryComparisonOverviewHeading");const N=ee.querySelector("#batteryTableContainer");N&&(N.id="batteryTableOverviewContainer");const K=ee.querySelector("#batteryTable");K&&K.removeAttribute("id"),X=`<div class="page-break"></div>${ee.outerHTML}`}const ae=r(s);let Ae=typeof getDiagramCss=="function"?getDiagramCss:null;!Ae&&typeof cineFeaturesConnectionDiagram=="object"&&typeof cineFeaturesConnectionDiagram.getDiagramCss=="function"&&(Ae=cineFeaturesConnectionDiagram.getDiagramCss);const Se=Ae?Ae(!1):"",Oe=(ee,I)=>{if(I)try{if(typeof globalThis<"u"&&I in globalThis){const N=globalThis[I];if(N)return N}}catch{}if(typeof document<"u"&&typeof document.getElementById=="function")try{return document.getElementById(ee)}catch{}return null},Ne=Oe("diagramArea","setupDiagramContainer");let Qe="",Fe="",_e="",He="";if(Ne){const ee=Ne.cloneNode(!0);ee.id="diagramAreaOverview",ee.setAttribute("data-diagram-area","overview");const I=ee.getAttribute("aria-describedby");if(I){const ce=I.split(/\s+/).filter(Boolean).map(me=>me==="diagramDesc"?"diagramDescOverview":me);ee.setAttribute("aria-describedby",ce.join(" "))}else ee.setAttribute("aria-describedby","diagramDescOverview");const N=ee.querySelector("#diagramPopup");N&&(N.id="diagramPopupOverview",N.setAttribute("data-diagram-popup","overview"),N.style.position="static",N.style.display="none");const K=ee.querySelector("svg");if(K){const oe=document.createElement("style");oe.textContent=Se,K.insertBefore(oe,K.firstChild)}Qe=ee.outerHTML}const st=Oe("diagramLegend","diagramLegend");if(st){const ee=st.cloneNode(!0);ee.id="diagramLegendOverview",ee.setAttribute("data-diagram-legend","overview"),Fe=ee.outerHTML}const at=typeof document<"u"?document.getElementById("diagramDesc"):null;if(at){const ee=at.cloneNode(!0);ee.id="diagramDescOverview",ee.setAttribute("data-diagram-description","overview"),He=ee.outerHTML}const St=Qe?`<section id="setupDiagram" class="diagram-section print-section"><h2>${m.setupDiagramHeading}</h2>${He}${Qe}${Fe}${_e}</section>`:"",kt=(()=>{if(typeof document>"u")return!1;const ee=document.getElementById("gearListOutput");return!ee||ee.classList&&ee.classList.contains("hidden")||!(typeof ee.innerHTML=="string"?ee.innerHTML.trim():"")?!1:(typeof ee.querySelector=="function"&&ee.querySelector(".gear-table"),!0)})();let Zt=getCurrentGearListHtml();!Zt&&currentProjectInfo&&(Zt=generateGearListHtml(currentProjectInfo));let Ht="",jo="";if(Zt){const I=(()=>{const N=typeof resolveOverviewGearListSections=="function"?resolveOverviewGearListSections:null;if(N)return N;const K=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;return K&&typeof K.resolveOverviewGearListSections=="function"?K.resolveOverviewGearListSections:oe=>({projectHtml:"",gearHtml:typeof oe=="string"?oe:""})})()(Zt);I.projectHtml&&(Ht=`<section id="projectRequirementsOutput" class="print-section project-requirements-section">${I.projectHtml}</section>`),I.gearHtml&&(kt||(()=>{const K=I.gearHtml.trim();if(!K)return!1;if(typeof document>"u"||typeof document.createElement!="function")return!0;const oe=document.createElement("template");oe.innerHTML=K;const ce=oe.content.querySelector(".gear-table");if(!ce)return K.length>0;const me=ce.querySelectorAll("tbody tr");return me.length?Array.from(me).some(De=>De.textContent&&De.textContent.trim().length>0):!1})())&&(jo=`<section id="gearListOutput" class="gear-list-section print-section">${I.gearHtml}</section>`)}const ir=Ht||"",sr=jo||"",Ro="",Ot=H?`<img id="printLogo" src="${H}" alt="Logo" />`:"",Lr=H?"logo-present":"",Co=`${r(j)} ${r(h)}`,hr=m.exportPdfBtn||"Export PDF / Print",Wo=(()=>{if(typeof iconMarkup=="function"&&ICON_GLYPHS&&ICON_GLYPHS.fileExport)try{return iconMarkup(ICON_GLYPHS.fileExport,"btn-icon")}catch(ee){logOverview("warn","Unable to render export icon for overview dialog.",ee,{action:"render-icon",icon:"fileExport"})}return'<span class="btn-icon icon-glyph" aria-hidden="true" data-icon-font="uicons">&#xE7AB;</span>'})(),Yo=`
        <div id="overviewDialogContent" class="${Lr}">
            <div class="overview-actions">
                <button id="closeOverviewBtn" class="back-btn"><span class="btn-icon icon-glyph" aria-hidden="true" data-icon-font="essential">&#xF131;</span>${r(m.backToAppBtn)}</button>
                <button id="openPrintOptionsBtn" class="print-btn export-pdf-btn" data-feature-search="true" data-feature-search-keywords="export pdf print rental" title="${r(hr)}">${Wo}${r(hr)}</button>
            </div>
            ${Ot}
            <h1>${m.overviewTitle}</h1>
            <p><strong>${m.setupNameLabel}</strong> ${ae}</p>
            <p><em>${Co}</em></p>

            ${ir}

            ${Io}

            ${So}

            ${St}

            ${sr}
            ${Ro}
            ${X}
        </div>
    `,Tt=document.getElementById("overviewDialog");Tt.innerHTML=Yo,Tt&&!Tt.hasAttribute("data-overview-outside-close")&&(Tt.addEventListener("click",ee=>{ee.target===Tt&&closeDialog(Tt)}),Tt.addEventListener("cancel",ee=>{ee.preventDefault(),closeDialog(Tt)}),Tt.setAttribute("data-overview-outside-close",""));const $o=Tt.querySelector("#overviewDialogContent");if($o){const ee=$o.querySelector(".overview-gear-actions");ee&&ee.remove(),$o.querySelectorAll(".gear-custom-add-btn, [data-gear-custom-add]").forEach(N=>{N&&typeof N.remove=="function"&&N.remove()}),convertGearListSelectorsToPlainText($o)}const br=(ee={})=>{if(!Tt||!$o)return logOverview("warn","Overview dialog is unavailable for exporting or printing.",void 0,{action:"print-workflow",stage:"dialog-missing"}),!1;runPendingPrintCleanup("pre-configured-print");const I=ee&&typeof ee=="object"?ee:{},N=I.preferences&&typeof I.preferences=="object"?I.preferences:I,K=N.sections&&typeof N.sections=="object"?N.sections:{},oe=typeof N.layout=="string"?N.layout:"standard",ce=I.mode==="print"?"print":"export",me=[];getPrintSectionConfig().forEach(ot=>{const _t=$o.querySelector(ot.selector);if(!_t)return;const Lt=Object.prototype.hasOwnProperty.call(K,ot.id)?K[ot.id]!==!1:ot.defaultVisible,Qt="print-section-hidden",Gt=_t.classList.contains(Qt);!Lt&&!Gt?(_t.classList.add(Qt),me.push(()=>_t.classList.remove(Qt))):Lt&&Gt&&(_t.classList.remove(Qt),me.push(()=>_t.classList.add(Qt)))});const Ge=$o.classList.contains("rental-print-mode");oe==="rental"&&!Ge?($o.classList.add("rental-print-mode"),me.push(()=>$o.classList.remove("rental-print-mode"))):oe!=="rental"&&Ge&&($o.classList.remove("rental-print-mode"),me.push(()=>$o.classList.add("rental-print-mode"))),pendingPrintCleanup=()=>{for(;me.length;){const ot=me.pop();try{ot()}catch(_t){logOverview("warn","Failed to restore print state.",_t,{action:"print-cleanup"})}}pendingPrintCleanup=null};const Xe={reason:oe==="rental"&&ce!=="print"?"rental-export":ce};if(ce!=="print"&&(Xe.preferFallback=!0),!ke(Xe))return logOverview("error",ce==="print"?"Unable to open the print dialog. Please check your browser settings and try again.":"Unable to start the PDF export workflow. Please enable pop-ups and try again.",void 0,{action:"print-workflow",stage:"trigger",result:"not-started",mode:ce,layout:oe}),runPendingPrintCleanup("configured-print-failed"),!1;const Le=()=>runPendingPrintCleanup("overview-closed");return Tt.addEventListener("close",Le,{once:!0}),!0},Do=()=>{const ee=loadPrintPreferences()||{sections:{},layout:"standard"},I=getPrintOptionsDialogContext(),N=K=>{const oe=K&&K.mode==="print"?"print":"export",ce=K&&K.preferences?K.preferences:ee;br({mode:oe,preferences:ce})};I&&I.dialog?(populatePrintOptionsDialog(I,ee,N),openDialog(I.dialog)):(console.warn("Legacy print dialog not found in DOM"),N({mode:"export",preferences:ee}))};typeof window<"u"&&(window.openLegacyPrintDialog=Do);const ur=Tt.querySelector("#openPrintOptionsBtn");ur&&ur.addEventListener("click",()=>{Do()}),(ee=>{if(!ee||typeof document>"u")return;const I=["dark-mode","light-mode","pink-mode","dark-accent-boost","high-contrast","reduce-motion","relaxed-spacing"],N=new Set([...document.documentElement?Array.from(document.documentElement.classList):[],...document.body?Array.from(document.body.classList):[]]);I.forEach(K=>{ee.classList.toggle(K,N.has(K))})})($o);const Vo=Tt.querySelector("#closeOverviewBtn");Vo&&Vo.addEventListener("click",()=>{closeDialog(Tt)});const Po=Tt.querySelector("#overviewDeleteGearListBtn");if(Po){const ee=typeof document<"u"&&typeof document.addEventListener=="function";if(ee){let I=function(){document.removeEventListener("gearlist:deleted",N),Tt.removeEventListener("close",I)},N=function(){I(),Tt&&Tt.open&&generatePrintableOverview$1()};document.addEventListener("gearlist:deleted",N),Tt.addEventListener("close",I,{once:!0})}Po.addEventListener("click",I=>{I.preventDefault();let N=!1;if(typeof deleteCurrentGearList=="function")try{const K=deleteCurrentGearList();!ee&&K&&generatePrintableOverview$1();return}catch(K){logOverview("warn","Failed to delete gear list from overview button",K,{action:"delete-gear-list",method:"direct-call"}),N=!0}else N=!0;if((N||typeof deleteCurrentGearList!="function")&&ee)try{document.dispatchEvent(new CustomEvent("gearlist:delete-requested",{detail:{source:"overview"}}))}catch(K){if(typeof document.createEvent=="function"){const oe=document.createEvent("CustomEvent");oe.initCustomEvent("gearlist:delete-requested",!1,!1,{source:"overview"}),document.dispatchEvent(oe)}else logOverview("warn","Unable to request gear list deletion from overview",K,{action:"delete-gear-list",method:"event-dispatch"})}})}let co=null,mr=!1;const Sr=()=>{runPendingPrintCleanup("close-after-print"),co&&(co(),co=null),mr&&(window.removeEventListener("afterprint",Sr),mr=!1),typeof document<"u"&&document.title!==x&&(document.title=x),closeDialog(Tt)},jr={action:"print-workflow",source:"overview-dialog"};s?jr.setupName=s:b&&(jr.projectName=b);const Qr=createOverviewLoggerProxy(jr),an=()=>{if(!$o||typeof document>"u")return!1;const ee=typeof window<"u"?window:null,I=document,N=I.body;if(!N)return logOverview("error","Unable to prepare the fallback print view because the document body is unavailable.",void 0,{action:"print-workflow",stage:"fallback-view-host",result:"unavailable"}),!1;const K=$o.cloneNode(!0);K.querySelectorAll(".print-btn, .back-btn").forEach(Dt=>{Dt&&typeof Dt.remove=="function"?Dt.remove():Dt&&Dt.parentNode&&Dt.parentNode.removeChild(Dt)});const oe=I.documentElement,ce=oe?oe.className:"",me=oe&&oe.getAttribute("dir")||"",De=oe&&oe.getAttribute("lang")||"en",Ge=oe&&oe.getAttribute("style")||"",Ue=N,Xe=Ue?Ue.className:"",ft=Ue&&Ue.getAttribute("style")||"",Le=r(z),ot=[`lang="${r(De)}"`];me&&ot.push(`dir="${r(me)}"`),ce&&ot.push(`class="${r(ce)}"`),Ge&&ot.push(`style="${r(Ge)}"`);const _t=[];Xe&&_t.push(`class="${r(Xe)}"`),ft&&_t.push(`style="${r(ft)}"`);const Lt=`<!DOCTYPE html>
<html ${ot.join(" ")}>
<head>
<meta charset="utf-8">
<meta name="color-scheme" content="light dark">
<title>${Le}</title>
<link rel="stylesheet" href="src/styles/style.css">
<link rel="stylesheet" href="src/styles/overview.css">
<link rel="stylesheet" href="src/styles/overview-print.css" media="print">
<link rel="stylesheet" href="overview-print.css" media="screen">
</head>
<body${_t.length?` ${_t.join(" ")}`:""}>
${K.outerHTML}
</body>
</html>`,Qt=I.querySelector('iframe[data-print-fallback="true"]');Qt&&(typeof Qt.remove=="function"?Qt.remove():Qt.parentNode&&Qt.parentNode.removeChild(Qt));const Gt=I.createElement("iframe");Gt.setAttribute("data-print-fallback","true"),Gt.setAttribute("aria-hidden","true"),Gt.setAttribute("tabindex","-1"),Gt.style.position="fixed",Gt.style.width="0",Gt.style.height="0",Gt.style.border="0",Gt.style.margin="0",Gt.style.padding="0",Gt.style.opacity="0",Gt.style.pointerEvents="none",Gt.style.clipPath="inset(50%)",Gt.style.clip="rect(0 0 0 0)",Gt.style.overflow="hidden";let ho=null,Qo=null,Xo=!1,No=!1,ao=null;const Ir=()=>{Qo!==null&&ee&&typeof ee.clearTimeout=="function"&&(ee.clearTimeout(Qo),Qo=null)},cr=()=>{Xo||(Xo=!0,Ir(),Gt.removeEventListener("load",$r),Gt.removeEventListener("error",Pr),Gt.parentNode&&Gt.parentNode.removeChild(Gt),ho&&(ho.removeEventListener("afterprint",Rr,!0),ho.removeEventListener("pagehide",Rr,!0),ao&&ao()),ao=null,ho=null)},Rr=()=>{cr()},Er=()=>{if(ho){try{typeof ho.focus=="function"&&ho.focus()}catch(Dt){logOverview("warn","Unable to focus the fallback print view before printing.",Dt,{action:"print-workflow",stage:"fallback-view-focus"})}if(typeof ho.print!="function"){logOverview("error","Fallback print view is missing a print method.",void 0,{action:"print-workflow",stage:"fallback-view-print",result:"unavailable"}),cr();return}try{ho.print()}catch(Dt){logOverview("error","Failed to trigger print in fallback view.",Dt,{action:"print-workflow",stage:"fallback-view-print"})}}},rr=()=>{No||(No=!0,ee&&typeof ee.setTimeout=="function"?ee.setTimeout(Er,0):Er())},$r=()=>{if(ho=Gt.contentWindow,!ho||!ho.document){cr(),logOverview("error","Unable to prepare the fallback print view.",void 0,{action:"print-workflow",stage:"fallback-view-window",result:"unavailable"});return}const Dt=ho.document;try{Dt.title=z}catch{}const Fo=()=>{Dt.readyState==="complete"&&(Dt.removeEventListener("readystatechange",Fo,!0),rr())};Dt.addEventListener("readystatechange",Fo,!0);const qr=()=>{rr()};ho.addEventListener("load",qr,{once:!0}),ho.addEventListener("afterprint",Rr,!0),ho.addEventListener("pagehide",Rr,!0),Dt.readyState==="complete"&&rr(),ao=()=>{Dt.removeEventListener("readystatechange",Fo,!0),ho.removeEventListener("load",qr)}},Pr=Dt=>{cr(),logOverview("error","Unable to load the fallback print view.",Dt,{action:"print-workflow",stage:"fallback-view-load",result:"failed"})};return Gt.addEventListener("load",$r,{once:!0}),Gt.addEventListener("error",Pr,{once:!0}),N.appendChild(Gt),(()=>{if("srcdoc"in Gt)return Gt.srcdoc=Lt,!0;const Dt=Gt.contentWindow;if(!Dt||!Dt.document)return!1;const Fo=Dt.document;return Fo.open(),Fo.write(Lt),Fo.close(),!0})()?(ee&&typeof ee.setTimeout=="function"&&(Qo=ee.setTimeout(()=>{cr()},120*1e3)),!0):(cr(),logOverview("error","Unable to prepare the fallback print view.",void 0,{action:"print-workflow",stage:"fallback-view-content",result:"unavailable"}),!1)},Sn=(ee,I={})=>{const N=I&&typeof I=="object"?I:{},K=N.preferFallback===!0,oe=typeof N.reason=="string"?N.reason:"",me=K&&!(oe==="export"||oe==="rental-export"),De=ee&&ee.windowRef?ee.windowRef:typeof window<"u"?window:null,Ge=ee&&ee.documentRef?ee.documentRef:typeof document<"u"?document:null,Ue=ee&&typeof ee.openFallbackPrintView=="function"?ee.openFallbackPrintView:()=>!1,Xe=ee&&typeof ee.closeAfterPrint=="function"?ee.closeAfterPrint:()=>{},ft=ee&&typeof ee.printDocumentTitle=="string"?ee.printDocumentTitle:"",Le=ee&&typeof ee.originalDocumentTitle=="string"?ee.originalDocumentTitle:Ge&&typeof Ge.title=="string"?Ge.title:"",ot=()=>{if(!De||typeof De.print!="function")return!1;try{return Ge&&ft&&(Ge.title=ft),De.print(),!0}catch{return!1}},_t=()=>{const Qt=Ue();return Qt&&Xe(),Qt};let Lt=!1;if(me?Lt=_t():Lt=ot(),Lt||(Lt=me?ot():_t()),!Lt&&Ge&&ft&&Ge.title===ft)try{Ge.title=Le}catch{}return Lt},Re={windowRef:typeof window<"u"?window:null,documentRef:typeof document<"u"?document:null,printDocumentTitle:z,originalDocumentTitle:x,openFallbackPrintView:an,closeAfterPrint:Sr,logger:Qr},Ye=typeof createOverviewPrintWorkflowModule=="function"?createOverviewPrintWorkflowModule(Re):null,ke=(ee={})=>Ye&&typeof Ye.trigger=="function"?Ye.trigger(ee):typeof triggerOverviewPrintWorkflowModule=="function"?triggerOverviewPrintWorkflowModule(Re,ee):Sn(Re,ee);if(openDialog(Tt),o&&(ke({reason:"generate"})||logOverview("error","Unable to open the print dialog. Please check your browser settings and try again.",void 0,{action:"print-workflow",stage:"trigger",reason:"generate",result:"not-started"})),typeof window.matchMedia=="function"){const ee=window.matchMedia("print"),I=N=>{N.matches||(co&&(co(),co=null),Sr())};ee.addEventListener?(ee.addEventListener("change",I),co=()=>ee.removeEventListener("change",I)):ee.addListener&&(ee.addListener(I),co=()=>ee.removeListener(I))}window.addEventListener("afterprint",Sr,{once:!0}),mr=!0}console.log("✅ Overview module loaded (ESM)");(function(){function e(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}var t=e();function o(_){if(typeof cineModuleBase=="object"&&cineModuleBase)return cineModuleBase;if(typeof require=="function")try{var G=require("./base.js");if(G&&typeof G=="object")return G}catch{}return _&&typeof _.cineModuleBase=="object"?_.cineModuleBase:null}var r=o(t);if(!r)return;var n=typeof r.getModuleRegistry=="function"?r.getModuleRegistry(t):null,a=typeof r.freezeDeep=="function"?function(G){try{return r.freezeDeep(G)}catch{}return G}:function(G){return G},s=typeof r.exposeGlobal=="function"?function(G,O,B){return r.exposeGlobal(G,O,t,B||{})}:function(G,O){try{return t[G]=O,!0}catch{}return!1},l=typeof r.registerOrQueueModule=="function"?function(G,O,B,$){return r.registerOrQueueModule(G,O,B,$,t,n)}:function(){return!1},u=typeof r.safeWarn=="function"?function(G,O){try{r.safeWarn(G,O)}catch{}}:function(G,O){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof O>"u"?console.warn(G):console.warn(G,O)}catch{}},d={generateGearListHtml:null,getCurrentGearListHtml:null,getSafeGearListHtmlSections:null,splitGearListHtml:null,metadata:{updatedAt:null,source:null}},m={generateGearListHtml:typeof t.generateGearListHtml=="function"?t.generateGearListHtml:null,getCurrentGearListHtml:typeof t.getCurrentGearListHtml=="function"?t.getCurrentGearListHtml:null,getSafeGearListHtmlSections:typeof t.getSafeGearListHtmlSections=="function"?t.getSafeGearListHtmlSections:null,splitGearListHtml:typeof t.splitGearListHtml=="function"?t.splitGearListHtml:null},y=["generateGearListHtml","getCurrentGearListHtml","getSafeGearListHtmlSections","splitGearListHtml"];function h(_){if(!_||typeof _!="object")return{source:null};var G=null;return typeof _.source=="string"&&_.source.trim()&&(G=_.source.trim()),{source:G}}function b(_,G){if(!_||typeof _!="object")return!1;for(var O=!1,B=0;B<y.length;B+=1){var $=y[B],V=_[$];typeof V=="function"&&(d[$]=V,O=!0)}return O&&(d.metadata={updatedAt:new Date().toISOString(),source:G&&G.source||null}),O}function v(_,G,O){var B=d[_];if(typeof B=="function")try{return B.apply(t,G||[])}catch(V){u('cineGearList encountered an error while executing "'+_+'".',V)}var $=m[_];if(typeof $=="function")try{return $.apply(t,G||[])}catch(V){u('cineGearList legacy fallback for "'+_+'" failed.',V)}return O}function C(_){var G=typeof _=="string"?_:"";return{projectHtml:"",gearHtml:G}}function A(){return typeof t!="object"||!t?"":typeof t.__cineLastGearListHtml=="string"?t.__cineLastGearListHtml:""}var w={setImplementation:function(G,O){var B=h(O),$=b(G,B);return!$&&B&&B.source&&u('cineGearList.setImplementation("'+B.source+'") did not update any functions.'),w},clearImplementation:function(){for(var G=0;G<y.length;G+=1){var O=y[G];d[O]=null}return d.metadata={updatedAt:null,source:null},w},hasImplementation:function(G){return typeof G!="string"||!G?y.every(function(B){return typeof d[B]=="function"}):typeof d[G]=="function"},getImplementationSnapshot:function(){for(var G={},O=0;O<y.length;O+=1){var B=y[O];G[B]=d[B]}return G.metadata=d.metadata,a(G)},generateGearListHtml:function(G){var O=G&&typeof G=="object"?G:{},B=v("generateGearListHtml",[O],"");return typeof B!="string"?"":B},getCurrentGearListHtml:function(){var G=Array.prototype.slice.call(arguments),O=v("getCurrentGearListHtml",G,A());return typeof O!="string"?"":O},getSafeGearListHtmlSections:function(G){var O=v("getSafeGearListHtmlSections",[G],null);if(!O||typeof O!="object")return C(G);var B=typeof O.projectHtml=="string"?O.projectHtml:"",$=typeof O.gearHtml=="string"?O.gearHtml:"";return!$&&!B&&typeof G=="string"&&($=G),{projectHtml:B,gearHtml:$}},splitGearListHtml:function(G){var O=v("splitGearListHtml",[G],null);if(!O||typeof O!="object")return C(G);var B=typeof O.projectHtml=="string"?O.projectHtml:"",$=typeof O.gearHtml=="string"?O.gearHtml:"";return!$&&typeof G=="string"&&!B&&($=G),{projectHtml:B,gearHtml:$}}};a(w),l("cineGearList",w,{category:"gear",description:"Gear list generation, serialization, and DOM extraction helpers.",replace:!0},function(_){u("Unable to register cineGearList module.",_)}),s("cineGearList",w,{configurable:!0,enumerable:!1,writable:!1});function R(_,G){s(_,G,{configurable:!0,enumerable:!1,writable:!0})}R("generateGearListHtml",function(G){return w.generateGearListHtml(G)}),R("getCurrentGearListHtml",function(){return w.getCurrentGearListHtml.apply(w,arguments)}),R("getSafeGearListHtmlSections",function(G){return w.getSafeGearListHtmlSections(G)}),R("splitGearListHtml",function(G){return w.splitGearListHtml(G)}),typeof module<"u"&&module&&module.exports&&(module.exports=w)})();const generateGearListHtml$1=(typeof window<"u"?window:globalThis).generateGearListHtml,adjustGearListSelectWidths=(typeof window<"u"?window.adjustGearListSelectWidths:null)||(()=>{}),cameraFizPort=(typeof window<"u"?window.cameraFizPort:null)||"",controllerCamPort=(typeof window<"u"?window.controllerCamPort:null)||"",controllerDistancePort=(typeof window<"u"?window.controllerDistancePort:null)||"",setBatteryPlates$1=(typeof window<"u"?window.setBatteryPlates:null)||(()=>{}),getBatteryPlates=(typeof window<"u"?window.getBatteryPlates:null)||(()=>[]),setRecordingMedia$1=(typeof window<"u"?window.setRecordingMedia:null)||(()=>{}),getRecordingMedia$1=(typeof window<"u"?window.getRecordingMedia:null)||(()=>[]),runFeatureSearch=(typeof window<"u"?window.runFeatureSearch:null)||(()=>{}),featureMap=(typeof window<"u"?window.featureMap:null)||{},actionMap=(typeof window<"u"?window.actionMap:null)||{},deviceMap=(typeof window<"u"?window.deviceMap:null)||{},helpMap=(typeof window<"u"?window.helpMap:null)||{},featureSearchEntries=(typeof window<"u"?window.featureSearchEntries:null)||[],featureSearchDefaultOptions=(typeof window<"u"?window.featureSearchDefaultOptions:null)||[],featureSearch$1=(typeof window<"u"?window.featureSearch:null)||null,applySessionMountVoltagePreferences=cineCoreMountVoltage.applyMountVoltagePreferences;typeof window<"u"&&(window.applySessionMountVoltagePreferences=applySessionMountVoltagePreferences);console.log("app-session.js: Starting execution (ESM)");typeof window<"u"&&typeof window.batteryPlateSelect>"u"&&(window.batteryPlateSelect=document.getElementById("batteryPlateSelect"));const{saveSessionState:saveSessionState$1,loadSessionState:loadSessionState$1,getSafeLocalStorage:getSafeLocalStorage$2,getProjectStorageRevisionKeyName,loadProject:loadProject$1,clearUiCacheStorageEntries,loadAutoGearMonitorDefaults:loadAutoGearMonitorDefaults$1,loadDocumentationTracker,saveContacts:saveContactsToStorage}=cineStorage,CORE_SHARED$1=typeof window<"u"&&window.cineCoreShared||typeof globalThis<"u"&&globalThis.cineCoreShared||{},resolveTemperatureStorageKey=typeof window<"u"&&window.resolveTemperatureStorageKey||(()=>"cameraPowerPlanner_temperatureUnit"),TEMPERATURE_STORAGE_KEY$1=typeof window<"u"&&window.TEMPERATURE_STORAGE_KEY||"cameraPowerPlanner_temperatureUnit",getCurrentProjectStorageKey$1=typeof window<"u"&&window.getCurrentProjectStorageKey||(()=>"cameraPowerPlanner_project"),getUserProfileSnapshot$1=typeof window<"u"&&window.getUserProfileSnapshot||(()=>null),formatUserProfileProviderName=typeof window<"u"&&window.formatUserProfileProviderName||(e=>e),ensureContactForImportedOwner=typeof window<"u"&&window.ensureContactForImportedOwner||(()=>{}),setGearItemProvider=typeof window<"u"&&window.setGearItemProvider||(()=>{}),dispatchGearProviderDataChanged=typeof window<"u"&&window.dispatchGearProviderDataChanged||(()=>{}),enqueueCoreBootTask$1=typeof window<"u"&&window.enqueueCoreBootTask||(e=>e()),CORE_GLOBAL_SCOPE$1=typeof window<"u"&&window.CORE_GLOBAL_SCOPE||(typeof globalThis<"u"?globalThis:{});let isProjectAutoSaving=!1,projectStorageSyncTimer=null,projectStorageSyncInProgress=!1,lastKnownProjectStorageRevision=null,missingMountVoltageWarnings=null,currentLockController=null,currentProjectInfo$1=null,showAutoBackups$1=!0;const projectForm$1=typeof document<"u"?document.getElementById("projectForm"):null,gearListOutput$1=typeof document<"u"?document.getElementById("gearListOutput"):null,projectRequirementsOutput$1=typeof document<"u"?document.getElementById("projectRequirementsOutput"):null,helpDialog$1=typeof document<"u"?document.getElementById("helpDialog"):null,helpSearch=typeof document<"u"?document.getElementById("helpSearch"):null,helpSearchClear=typeof document<"u"?document.getElementById("helpSearchClear"):null,cameraSelect$1=typeof document<"u"?document.getElementById("cameraSelect"):null,monitorSelect$1=typeof document<"u"?document.getElementById("monitorSelect"):null,batteryPlateSelect$1=typeof document<"u"?document.getElementById("batteryPlateSelect"):null;typeof document<"u"&&document.getElementById("batteryHotswapSelect");const setupSelect$1=typeof document<"u"?document.getElementById("setupSelect"):null,setupNameInput$1=typeof document<"u"?document.getElementById("setupName"):null;typeof document<"u"&&document.getElementById("offlineIndicator");const settingsDialog=typeof document<"u"?document.getElementById("settingsDialog"):null;typeof document<"u"&&document.getElementById("featureSearchInput");const settingsDarkMode=typeof document<"u"?document.getElementById("settingsDarkMode"):null,settingsPinkMode=typeof document<"u"?document.getElementById("settingsPinkMode"):null;typeof document<"u"&&document.getElementById("gridSnapToggle");typeof document<"u"&&document.getElementById("diagramArea");typeof document<"u"&&document.getElementById("autoGearShowBackups");typeof document<"u"&&document.getElementById("autoGearScenarioMode");const videoDistributionSelect=typeof document<"u"?document.getElementById("videoDistributionSelect"):null,checkSetupChanged$1=typeof window<"u"&&typeof window.checkSetupChanged=="function"?window.checkSetupChanged:(()=>{console.warn("checkSetupChanged not available")}),updateCalculations$1=typeof window<"u"&&typeof window.updateCalculations=="function"?window.updateCalculations:(()=>{console.warn("updateCalculations not available")}),_safeUpdateCalculations=function(...e){const t=typeof updateCalculations$1=="function"?updateCalculations$1:typeof globalThis<"u"&&typeof globalThis.updateCalculations=="function"?globalThis.updateCalculations:typeof window<"u"&&typeof window.updateCalculations=="function"?window.updateCalculations:null;if(t)return t(...e)},_safeCheckSetupChanged=function(...e){const t=typeof checkSetupChanged$1=="function"?checkSetupChanged$1:typeof globalThis<"u"&&typeof globalThis.checkSetupChanged=="function"?globalThis.checkSetupChanged:typeof window<"u"&&typeof window.checkSetupChanged=="function"?window.checkSetupChanged:null;if(t)return t(...e)},_safeSaveCurrentSession=function(...e){const t=typeof saveCurrentSession$1=="function"?saveCurrentSession$1:typeof globalThis<"u"&&typeof globalThis.saveCurrentSession=="function"?globalThis.saveCurrentSession:typeof window<"u"&&typeof window.saveCurrentSession=="function"?window.saveCurrentSession:null;if(t)return t(...e)},_safeSaveCurrentGearList=function(...e){const t=typeof saveCurrentGearList$1=="function"?saveCurrentGearList$1:typeof globalThis<"u"&&typeof globalThis.saveCurrentGearList=="function"?globalThis.saveCurrentGearList:typeof window<"u"&&typeof window.saveCurrentGearList=="function"?window.saveCurrentGearList:null;if(t)return t(...e)},_safeAutoSaveCurrentSetup=function(...e){const t=typeof autoSaveCurrentSetup$1=="function"?autoSaveCurrentSetup$1:typeof globalThis<"u"&&typeof globalThis.autoSaveCurrentSetup=="function"?globalThis.autoSaveCurrentSetup:typeof window<"u"&&typeof window.autoSaveCurrentSetup=="function"?window.autoSaveCurrentSetup:null;if(t)return t(...e)},_safeUpdateBatteryPlateVisibility=function(...e){const t=typeof updateBatteryPlateVisibility=="function"?updateBatteryPlateVisibility:typeof globalThis<"u"&&typeof globalThis.updateBatteryPlateVisibility=="function"?globalThis.updateBatteryPlateVisibility:typeof window<"u"&&typeof window.updateBatteryPlateVisibility=="function"?window.updateBatteryPlateVisibility:null;if(t)return t(...e)},_safeUpdateBatteryOptions=function(...e){const t=typeof updateBatteryOptions=="function"?updateBatteryOptions:typeof globalThis<"u"&&typeof globalThis.updateBatteryOptions=="function"?globalThis.updateBatteryOptions:typeof window<"u"&&typeof window.updateBatteryOptions=="function"?window.updateBatteryOptions:null;if(t)return t(...e)},_safeUpdateMonitoringConfigurationOptions=function(...e){const t=typeof updateMonitoringConfigurationOptions=="function"?updateMonitoringConfigurationOptions:typeof globalThis<"u"&&typeof globalThis.updateMonitoringConfigurationOptions=="function"?globalThis.updateMonitoringConfigurationOptions:typeof window<"u"&&typeof window.updateMonitoringConfigurationOptions=="function"?window.updateMonitoringConfigurationOptions:null;if(t)return t(...e)},_safeUpdateViewfinderSettingsVisibility=function(...e){const t=typeof updateViewfinderSettingsVisibility=="function"?updateViewfinderSettingsVisibility:typeof globalThis<"u"&&typeof globalThis.updateViewfinderSettingsVisibility=="function"?globalThis.updateViewfinderSettingsVisibility:typeof window<"u"&&typeof window.updateViewfinderSettingsVisibility=="function"?window.updateViewfinderSettingsVisibility:null;if(t)return t(...e)},_safePopulateRecordingResolutionDropdown=function(...e){const t=typeof populateRecordingResolutionDropdown$1=="function"?populateRecordingResolutionDropdown$1:typeof globalThis<"u"&&typeof globalThis.populateRecordingResolutionDropdown=="function"?globalThis.populateRecordingResolutionDropdown:typeof window<"u"&&typeof window.populateRecordingResolutionDropdown=="function"?window.populateRecordingResolutionDropdown:null;if(t)return t(...e)},_safePopulateSensorModeDropdown=function(...e){const t=typeof populateSensorModeDropdown$1=="function"?populateSensorModeDropdown$1:typeof globalThis<"u"&&typeof globalThis.populateSensorModeDropdown=="function"?globalThis.populateSensorModeDropdown:typeof window<"u"&&typeof window.populateSensorModeDropdown=="function"?window.populateSensorModeDropdown:null;if(t)return t(...e)},_safePopulateSlowMotionRecordingResolutionDropdown=function(...e){const t=typeof populateSlowMotionRecordingResolutionDropdown$1=="function"?populateSlowMotionRecordingResolutionDropdown$1:typeof globalThis<"u"&&typeof globalThis.populateSlowMotionRecordingResolutionDropdown=="function"?globalThis.populateSlowMotionRecordingResolutionDropdown:typeof window<"u"&&typeof window.populateSlowMotionRecordingResolutionDropdown=="function"?window.populateSlowMotionRecordingResolutionDropdown:null;if(t)return t(...e)},_safePopulateSlowMotionSensorModeDropdown=function(...e){const t=typeof populateSlowMotionSensorModeDropdown$1=="function"?populateSlowMotionSensorModeDropdown$1:typeof globalThis<"u"&&typeof globalThis.populateSlowMotionSensorModeDropdown=="function"?globalThis.populateSlowMotionSensorModeDropdown:typeof window<"u"&&typeof window.populateSlowMotionSensorModeDropdown=="function"?window.populateSlowMotionSensorModeDropdown:null;if(t)return t(...e)},_safePopulateFrameRateDropdown=function(...e){const t=typeof populateFrameRateDropdown$1=="function"?populateFrameRateDropdown$1:typeof globalThis<"u"&&typeof globalThis.populateFrameRateDropdown=="function"?globalThis.populateFrameRateDropdown:typeof window<"u"&&typeof window.populateFrameRateDropdown=="function"?window.populateFrameRateDropdown:null;if(t)return t(...e)},_safePopulateSlowMotionFrameRateDropdown=function(...e){const t=typeof populateSlowMotionFrameRateDropdown$1=="function"?populateSlowMotionFrameRateDropdown$1:typeof globalThis<"u"&&typeof globalThis.populateSlowMotionFrameRateDropdown=="function"?globalThis.populateSlowMotionFrameRateDropdown:typeof window<"u"&&typeof window.populateSlowMotionFrameRateDropdown=="function"?window.populateSlowMotionFrameRateDropdown:null;if(t)return t(...e)},_safeHandleMountVoltageInputChange=function(...e){const t=typeof handleMountVoltageInputChange=="function"?handleMountVoltageInputChange:typeof globalThis<"u"&&typeof globalThis.handleMountVoltageInputChange=="function"?globalThis.handleMountVoltageInputChange:typeof window<"u"&&typeof window.handleMountVoltageInputChange=="function"?window.handleMountVoltageInputChange:null;if(t)return t(...e)},_safeNormalizeAutoGearScenarioPrimary=function(...e){const t=typeof normalizeAutoGearScenarioPrimary=="function"?normalizeAutoGearScenarioPrimary:typeof globalThis<"u"&&typeof globalThis.normalizeAutoGearScenarioPrimary=="function"?globalThis.normalizeAutoGearScenarioPrimary:typeof window<"u"&&typeof window.normalizeAutoGearScenarioPrimary=="function"?window.normalizeAutoGearScenarioPrimary:null;if(t)return t(...e)},_safeNormalizeAutoGearScenarioMultiplier=function(...e){const t=typeof normalizeAutoGearScenarioMultiplier=="function"?normalizeAutoGearScenarioMultiplier:typeof globalThis<"u"&&typeof globalThis.normalizeAutoGearScenarioMultiplier=="function"?globalThis.normalizeAutoGearScenarioMultiplier:typeof window<"u"&&typeof window.normalizeAutoGearScenarioMultiplier=="function"?window.normalizeAutoGearScenarioMultiplier:null;if(t)return t(...e)},_safeRemoveAutoGearCondition=function(...e){const t=typeof removeAutoGearCondition=="function"?removeAutoGearCondition:typeof globalThis<"u"&&typeof globalThis.removeAutoGearCondition=="function"?globalThis.removeAutoGearCondition:typeof window<"u"&&typeof window.removeAutoGearCondition=="function"?window.removeAutoGearCondition:null;if(t)return t(...e)},_safeHandleAutoGearConditionShortcut=function(...e){const t=typeof handleAutoGearConditionShortcut=="function"?handleAutoGearConditionShortcut:typeof globalThis<"u"&&typeof globalThis.handleAutoGearConditionShortcut=="function"?globalThis.handleAutoGearConditionShortcut:typeof window<"u"&&typeof window.handleAutoGearConditionShortcut=="function"?window.handleAutoGearConditionShortcut:null;if(t)return t(...e)},_safeHandleAutoGearImportSelection=function(...e){const t=typeof handleAutoGearImportSelection=="function"?handleAutoGearImportSelection:typeof globalThis<"u"&&typeof globalThis.handleAutoGearImportSelection=="function"?globalThis.handleAutoGearImportSelection:typeof window<"u"&&typeof window.handleAutoGearImportSelection=="function"?window.handleAutoGearImportSelection:null;if(t)return t(...e)},_safeSetAutoGearSearchQuery=function(...e){const t=typeof setAutoGearSearchQuery=="function"?setAutoGearSearchQuery:typeof globalThis<"u"&&typeof globalThis.setAutoGearSearchQuery=="function"?globalThis.setAutoGearSearchQuery:typeof window<"u"&&typeof window.setAutoGearSearchQuery=="function"?window.setAutoGearSearchQuery:null;if(t)return t(...e)},_safeSetAutoGearScenarioFilter=function(...e){const t=typeof setAutoGearScenarioFilter=="function"?setAutoGearScenarioFilter:typeof globalThis<"u"&&typeof globalThis.setAutoGearScenarioFilter=="function"?globalThis.setAutoGearScenarioFilter:typeof window<"u"&&typeof window.setAutoGearScenarioFilter=="function"?window.setAutoGearScenarioFilter:null;if(t)return t(...e)},_safeClearAutoGearFilters=function(...e){const t=typeof clearAutoGearFilters=="function"?clearAutoGearFilters:typeof globalThis<"u"&&typeof globalThis.clearAutoGearFilters=="function"?globalThis.clearAutoGearFilters:typeof window<"u"&&typeof window.clearAutoGearFilters=="function"?window.clearAutoGearFilters:null;if(t)return t(...e)},_safeSetAutoGearSummaryFocus=function(...e){const t=typeof setAutoGearSummaryFocus=="function"?setAutoGearSummaryFocus:typeof globalThis<"u"&&typeof globalThis.setAutoGearSummaryFocus=="function"?globalThis.setAutoGearSummaryFocus:typeof window<"u"&&typeof window.setAutoGearSummaryFocus=="function"?window.setAutoGearSummaryFocus:null;if(t)return t(...e)},_safeHandleAutoGearPresetSelection=function(...e){const t=typeof handleAutoGearPresetSelection=="function"?handleAutoGearPresetSelection:typeof globalThis<"u"&&typeof globalThis.handleAutoGearPresetSelection=="function"?globalThis.handleAutoGearPresetSelection:typeof window<"u"&&typeof window.handleAutoGearPresetSelection=="function"?window.handleAutoGearPresetSelection:null;if(t)return t(...e)},_safeHandleAutoGearSavePreset=function(...e){const t=typeof handleAutoGearSavePreset=="function"?handleAutoGearSavePreset:typeof globalThis<"u"&&typeof globalThis.handleAutoGearSavePreset=="function"?globalThis.handleAutoGearSavePreset:typeof window<"u"&&typeof window.handleAutoGearSavePreset=="function"?window.handleAutoGearSavePreset:null;if(t)return t(...e)},_safeHandleAutoGearDeletePreset=function(...e){const t=typeof handleAutoGearDeletePreset=="function"?handleAutoGearDeletePreset:typeof globalThis<"u"&&typeof globalThis.handleAutoGearDeletePreset=="function"?globalThis.handleAutoGearDeletePreset:typeof window<"u"&&typeof window.handleAutoGearDeletePreset=="function"?window.handleAutoGearDeletePreset:null;if(t)return t(...e)},_safeAddAutoGearDraftItem=function(...e){const t=typeof addAutoGearDraftItem=="function"?addAutoGearDraftItem:typeof globalThis<"u"&&typeof globalThis.addAutoGearDraftItem=="function"?globalThis.addAutoGearDraftItem:typeof window<"u"&&typeof window.addAutoGearDraftItem=="function"?window.addAutoGearDraftItem:null;if(t)return t(...e)},_safeSaveAutoGearRuleFromEditor=function(...e){const t=typeof saveAutoGearRuleFromEditor=="function"?saveAutoGearRuleFromEditor:typeof globalThis<"u"&&typeof globalThis.saveAutoGearRuleFromEditor=="function"?globalThis.saveAutoGearRuleFromEditor:typeof window<"u"&&typeof window.saveAutoGearRuleFromEditor=="function"?window.saveAutoGearRuleFromEditor:null;if(t)return t(...e)},_safeCloseAutoGearEditor=function(...e){const t=typeof closeAutoGearEditor=="function"?closeAutoGearEditor:typeof globalThis<"u"&&typeof globalThis.closeAutoGearEditor=="function"?globalThis.closeAutoGearEditor:typeof window<"u"&&typeof window.closeAutoGearEditor=="function"?window.closeAutoGearEditor:null;if(t)return t(...e)},_safeRenderAutoGearDraftLists=function(...e){const t=typeof renderAutoGearDraftLists=="function"?renderAutoGearDraftLists:typeof globalThis<"u"&&typeof globalThis.renderAutoGearDraftLists=="function"?globalThis.renderAutoGearDraftLists:typeof window<"u"&&typeof window.renderAutoGearDraftLists=="function"?window.renderAutoGearDraftLists:null;if(t)return t(...e)},_safeDuplicateAutoGearRule=function(...e){const t=typeof duplicateAutoGearRule=="function"?duplicateAutoGearRule:typeof globalThis<"u"&&typeof globalThis.duplicateAutoGearRule=="function"?globalThis.duplicateAutoGearRule:typeof window<"u"&&typeof window.duplicateAutoGearRule=="function"?window.duplicateAutoGearRule:null;if(t)return t(...e)},_safeInvokeSessionOpenAutoGearEditor=function(...e){const t=typeof invokeSessionOpenAutoGearEditor=="function"?invokeSessionOpenAutoGearEditor:typeof globalThis<"u"&&typeof globalThis.invokeSessionOpenAutoGearEditor=="function"?globalThis.invokeSessionOpenAutoGearEditor:typeof window<"u"&&typeof window.invokeSessionOpenAutoGearEditor=="function"?window.invokeSessionOpenAutoGearEditor:null;if(t)return t(...e)},_safeUpdateAutoGearBackupRestoreButtonState=function(...e){const t=typeof updateAutoGearBackupRestoreButtonState=="function"?updateAutoGearBackupRestoreButtonState:typeof globalThis<"u"&&typeof globalThis.updateAutoGearBackupRestoreButtonState=="function"?globalThis.updateAutoGearBackupRestoreButtonState:typeof window<"u"&&typeof window.updateAutoGearBackupRestoreButtonState=="function"?window.updateAutoGearBackupRestoreButtonState:null;if(t)return t(...e)},_safeHandleAutoGearShowBackupsToggle=function(...e){const t=typeof handleAutoGearShowBackupsToggle=="function"?handleAutoGearShowBackupsToggle:typeof globalThis<"u"&&typeof globalThis.handleAutoGearShowBackupsToggle=="function"?globalThis.handleAutoGearShowBackupsToggle:typeof window<"u"&&typeof window.handleAutoGearShowBackupsToggle=="function"?window.handleAutoGearShowBackupsToggle:null;if(t)return t(...e)},_safeRestoreAutoGearBackup=function(...e){const t=typeof restoreAutoGearBackup=="function"?restoreAutoGearBackup:typeof globalThis<"u"&&typeof globalThis.restoreAutoGearBackup=="function"?globalThis.restoreAutoGearBackup:typeof window<"u"&&typeof window.restoreAutoGearBackup=="function"?window.restoreAutoGearBackup:null;if(t)return t(...e)},_safeSyncAutoGearMonitorFieldVisibility=function(...e){const t=typeof syncAutoGearMonitorFieldVisibility=="function"?syncAutoGearMonitorFieldVisibility:typeof globalThis<"u"&&typeof globalThis.syncAutoGearMonitorFieldVisibility=="function"?globalThis.syncAutoGearMonitorFieldVisibility:typeof window<"u"&&typeof window.syncAutoGearMonitorFieldVisibility=="function"?window.syncAutoGearMonitorFieldVisibility:null;if(t)return t(...e)},_safeUpdateAutoGearMonitorCatalogOptions=function(...e){const t=typeof updateAutoGearMonitorCatalogOptions=="function"?updateAutoGearMonitorCatalogOptions:typeof globalThis<"u"&&typeof globalThis.updateAutoGearMonitorCatalogOptions=="function"?globalThis.updateAutoGearMonitorCatalogOptions:typeof window<"u"&&typeof window.updateAutoGearMonitorCatalogOptions=="function"?window.updateAutoGearMonitorCatalogOptions:null;if(t)return t(...e)},_safeClearAutoGearDraftItemEdit=function(...e){const t=typeof clearAutoGearDraftItemEdit=="function"?clearAutoGearDraftItemEdit:typeof globalThis<"u"&&typeof globalThis.clearAutoGearDraftItemEdit=="function"?globalThis.clearAutoGearDraftItemEdit:typeof window<"u"&&typeof window.clearAutoGearDraftItemEdit=="function"?window.clearAutoGearDraftItemEdit:null;if(t)return t(...e)},_safeUpdateAutoGearCatalogOptions=function(...e){const t=typeof updateAutoGearCatalogOptions=="function"?updateAutoGearCatalogOptions:typeof globalThis<"u"&&typeof globalThis.updateAutoGearCatalogOptions=="function"?globalThis.updateAutoGearCatalogOptions:typeof window<"u"&&typeof window.updateAutoGearCatalogOptions=="function"?window.updateAutoGearCatalogOptions:null;if(t)return t(...e)},_safeBeginAutoGearDraftItemEdit=function(...e){const t=typeof beginAutoGearDraftItemEdit=="function"?beginAutoGearDraftItemEdit:typeof globalThis<"u"&&typeof globalThis.beginAutoGearDraftItemEdit=="function"?globalThis.beginAutoGearDraftItemEdit:typeof window<"u"&&typeof window.beginAutoGearDraftItemEdit=="function"?window.beginAutoGearDraftItemEdit:null;if(t)return t(...e)},FALLBACK_STRONG_SEARCH_MATCH_TYPES=new Set(["exactKey","keyPrefix","keySubset"]);typeof globalThis<"u"&&typeof globalThis.STRONG_SEARCH_MATCH_TYPES>"u"&&(globalThis.STRONG_SEARCH_MATCH_TYPES=FALLBACK_STRONG_SEARCH_MATCH_TYPES);const FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK="Force reload requires an internet connection. Try again once you are back online.";var pinkModeToggle=typeof pinkModeToggle<"u"?pinkModeToggle:typeof document<"u"&&typeof document.getElementById=="function"?document.getElementById("pinkModeToggle"):null,darkModeToggle=typeof darkModeToggle<"u"?darkModeToggle:typeof document<"u"&&typeof document.getElementById=="function"?document.getElementById("darkModeToggle"):null,hotswapSelect$1=typeof hotswapSelect$1<"u"?hotswapSelect$1:typeof document<"u"&&typeof document.getElementById=="function"?document.getElementById("batteryHotswapSelect"):null;typeof globalThis<"u"&&hotswapSelect$1&&typeof globalThis.hotswapSelect>"u"&&(globalThis.hotswapSelect=hotswapSelect$1);function getSessionCloneScope(){return typeof CORE_GLOBAL_SCOPE$1<"u"&&CORE_GLOBAL_SCOPE$1?CORE_GLOBAL_SCOPE$1:typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null}function resolveSessionRuntimeFunction(e){if(typeof e!="string"||!e)return null;const t=[],o=new Set,r=a=>{!a||typeof a!="object"&&typeof a!="function"||o.has(a)||(o.add(a),t.push(a))};try{r(typeof CORE_GLOBAL_SCOPE$1<"u"?CORE_GLOBAL_SCOPE$1:null)}catch{}try{r(typeof globalThis<"u"?globalThis:null)}catch{}try{r(typeof window<"u"?window:null)}catch{}try{r(typeof self<"u"?self:null)}catch{}try{r(typeof global<"u"?global:null)}catch{}let n=0;for(let a=0;a<t.length;a+=1){if(n++,n>1e3){typeof console<"u"&&typeof console.warn=="function"&&console.warn("resolveSessionRuntimeFunction: exceeded max iterations",e);break}const s=t[a];if(s){try{const l=s[e];if(typeof l=="function")return l}catch(l){typeof console<"u"&&typeof console.warn=="function"&&console.warn("resolveSessionRuntimeFunction: failed to read candidate from scope",e,l)}try{const l=s.CORE_GLOBAL_SCOPE||s.core||s.__cineRuntimeState;if(l&&!o.has(l)){r(l);const u=l[e];if(typeof u=="function")return u}}catch(l){typeof console<"u"&&typeof console.debug=="function"&&console.debug("resolveSessionRuntimeFunction: nested scope probe failed",e,l)}}}return null}function isNavigatorExplicitlyOffline(e){return!e||typeof e!="object"||typeof e.onLine!="boolean"?!1:e.onLine===!1}function resolveForceReloadOfflineNotice(){let e="";if(typeof document<"u"&&document&&typeof document.getElementById=="function"){const o=document.getElementById("offlineIndicator");if(o){const r=o.dataset||{},n=typeof r.forceReloadNotice=="string"&&r.forceReloadNotice.trim()?r.forceReloadNotice.trim():null,a=typeof r.reloadNotice=="string"&&r.reloadNotice.trim()?r.reloadNotice.trim():null,s=typeof o.getAttribute=="function"?o.getAttribute("data-help"):null,l=typeof s=="string"&&s.trim()?s.trim():null,u=typeof o.textContent=="string"&&o.textContent.trim()?o.textContent.trim():null;if(e=n||a||l||u||"",!e){const d=typeof r.baseLabel=="string"&&r.baseLabel.trim()?r.baseLabel.trim():null;d&&(e=d)}if(e)return e}}const t=resolveSessionRuntimeFunction("resolveLocaleString");if(typeof t=="function")try{const o=t("reloadAppOfflineNotice");if(typeof o=="string"&&o.trim())return o.trim()}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("resolveForceReloadOfflineNotice: failed to resolve locale string",o)}return FORCE_RELOAD_OFFLINE_NOTICE_FALLBACK}function announceForceReloadOfflineNotice(){const e=resolveForceReloadOfflineNotice();let t=!1;if(typeof document<"u"&&document&&typeof document.getElementById=="function"){const o=document.getElementById("offlineIndicator");o&&(t=!0,o.dataset&&(o.dataset.forceReloadNotice=e,o.dataset.reloadNotice=e),typeof o.setAttribute=="function"&&(o.setAttribute("data-help",e),o.setAttribute("role","status"),o.setAttribute("aria-live","polite")),typeof o.removeAttribute=="function"&&o.removeAttribute("hidden"),(typeof o.textContent=="string"||typeof o.textContent=="object")&&(o.textContent=e))}if(!t&&typeof window<"u"&&typeof window.alert=="function")try{window.alert(e)}catch{}}try{typeof globalThis<"u"&&globalThis&&typeof globalThis.announceForceReloadOfflineNotice!="function"&&(globalThis.announceForceReloadOfflineNotice=announceForceReloadOfflineNotice)}catch(e){}(function(e){e.cineProjectLockManager||(e.cineProjectLockManager={requestLock:async t=>{if(currentLockController&&currentLockController.name===t||(currentLockController&&(currentLockController.unlock&&currentLockController.unlock(),currentLockController=null),!t)||typeof navigator>"u"||!navigator.locks)return!0;const o=`cine_project_lock_${t}`;return new Promise(r=>{navigator.locks.request(o,{ifAvailable:!0},async n=>{if(!n){r(!1);return}let a;const s=new Promise(l=>{a=l});currentLockController={name:t,unlock:a},r(!0),await s})})},releaseLock:()=>{currentLockController&&(currentLockController.unlock&&currentLockController.unlock(),currentLockController=null)},isLocked:t=>currentLockController&&currentLockController.name===t})})(typeof globalThis<"u"?globalThis:typeof window<"u"?window:{});function safeGetCurrentProjectName(e=""){const t=resolveSessionRuntimeFunction("getCurrentProjectName");if(typeof t!="function")return e;try{const o=t();if(typeof o=="string"&&o.trim())return o}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("safeGetCurrentProjectName: runtime call failed, using fallback",o)}return e}const PROJECT_STORAGE_REV_KEY_FALLBACK="cameraPowerPlanner_project_rev";function normalizeProjectStorageRevisionValue(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="string"){const t=e.trim();if(!t)return null;const o=Number(t);if(Number.isFinite(o))return Math.max(0,Math.floor(o))}return null}function resolveProjectStorageRevisionKeyName(){const e=resolveSessionRuntimeFunction("getProjectStorageRevisionKeyName");if(typeof e=="function")try{const t=e();if(typeof t=="string"&&t.trim())return t.trim()}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve project storage revision key name",t)}return PROJECT_STORAGE_REV_KEY_FALLBACK}function readProjectStorageRevisionValue(){const e=typeof getSafeLocalStorage$2=="function"?getSafeLocalStorage$2():typeof localStorage<"u"?localStorage:null;if(!e||typeof e.getItem!="function")return null;try{const t=e.getItem(resolveProjectStorageRevisionKeyName());return normalizeProjectStorageRevisionValue(t)}catch(t){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to read project storage revision from localStorage",t),null}}function resolveActiveProjectStorageKey(){if(typeof getCurrentProjectStorageKey$1=="function")try{const t=getCurrentProjectStorageKey$1({allowTyped:!0});if(typeof t=="string"&&t.trim())return t}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve active project storage key",t)}const e=safeGetCurrentProjectName("");return e||(setupSelect$1&&typeof setupSelect$1.value=="string"&&setupSelect$1.value.trim()?setupSelect$1.value.trim():"")}function reloadActiveProjectFromStorage(e={}){if(factoryResetInProgress$1||restoringSession)return!1;const t=isProjectAutoSaving;isProjectAutoSaving=!0;try{if(typeof isProjectPersistenceSuspended=="function"&&isProjectPersistenceSuspended()||typeof loadProject$1!="function")return!1;const o=resolveActiveProjectStorageKey();if(!o)return!1;let r=null;try{r=loadProject$1(o)}catch(l){return!e.silent&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to reload project from storage after external update",l),!1}if(!r||typeof r!="object"){const l=setupSelect$1?setupSelect$1.value:"";if(typeof populateSetupSelect=="function")try{populateSetupSelect()}catch(u){}if(setupSelect$1&&typeof setupSelect$1.value<"u"&&(setupSelect$1.value="",l!==""))try{setupSelect$1.dispatchEvent(new Event("change",{bubbles:!0}))}catch(u){}if(currentProjectInfo$1=null,projectForm$1&&typeof populateProjectForm=="function")try{populateProjectForm({})}catch(u){}return!e.silent&&typeof console<"u"&&typeof console.info=="function"&&console.info("[app-session] Project no longer exists, reset to New Project state"),!1}if(typeof getCurrentSetupState=="function"&&typeof stableStringify=="function")try{const l={...getCurrentSetupState()},u=typeof getCurrentGearListHtml=="function"?getCurrentGearListHtml():"";if(u&&(l.gearList=u),typeof getDiagramManualPositions=="function"){const y=getDiagramManualPositions();y&&Object.keys(y).length?l.diagramPositions=y:Object.prototype.hasOwnProperty.call(l,"diagramPositions")&&delete l.diagramPositions}const d=stableStringify(l),m=stableStringify(r);if(d===m)return!0}catch(l){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Project reload optimization check failed",l)}if(r.powerSelection&&typeof applyStoredPowerSelection=="function"&&applyStoredPowerSelection(r.powerSelection,{preferExisting:!1}),updateBatteryOptions(),currentProjectInfo$1=r.projectInfo||null,projectForm$1&&typeof populateProjectForm=="function"&&populateProjectForm(currentProjectInfo$1||{}),typeof setManualDiagramPositions=="function"){const l=r.diagramPositions&&typeof normalizeDiagramPositionsInput=="function"?normalizeDiagramPositionsInput(r.diagramPositions):{};setManualDiagramPositions(l||{},{render:!1})}r.autoGearRules&&r.autoGearRules.length?typeof useProjectAutoGearRules=="function"&&useProjectAutoGearRules(r.autoGearRules):typeof clearProjectAutoGearRules=="function"&&clearProjectAutoGearRules();const n=l=>callSessionCoreFunction("generateGearListHtml",[l||{}],{defaultValue:""})||"",s=(typeof r.gearList=="string"?r.gearList:"")||n(currentProjectInfo$1||{});if(typeof displayGearAndRequirements=="function"&&displayGearAndRequirements(s),gearListOutput$1&&(s&&(ensureGearListActions(),bindGearListCageListener(),bindGearListEasyrigListener(),bindGearListSliderBowlListener(),bindGearListEyeLeatherListener(),bindGearListProGaffTapeListener(),bindGearListDirectorMonitorListener()),typeof applyGearListSelectors=="function"&&r.gearSelectors&&Object.keys(r.gearSelectors).length&&applyGearListSelectors(r.gearSelectors),typeof updateGearListButtonVisibility=="function"&&updateGearListButtonVisibility()),typeof populateSetupSelect=="function")try{if(populateSetupSelect(),o){const l=document.getElementById("setupSelect");l&&(l.value=o)}}catch(l){!e.silent&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to refresh setup selector after external project update",l)}return typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),typeof storeLoadedSetupStateSafe=="function"&&typeof getCurrentSetupState=="function"&&storeLoadedSetupStateSafe(getCurrentSetupState()),typeof checkSetupChanged$1=="function"&&checkSetupChanged$1(),!0}finally{isProjectAutoSaving=t}}function scheduleProjectStorageSync(e={}){projectStorageSyncInProgress||(projectStorageSyncTimer&&clearTimeout(projectStorageSyncTimer),projectStorageSyncTimer=setTimeout(()=>{projectStorageSyncTimer=null,projectStorageSyncInProgress=!0;try{reloadActiveProjectFromStorage({silent:e.silent})}finally{projectStorageSyncInProgress=!1}},120))}if(typeof window<"u"&&window&&typeof window.addEventListener=="function"){try{lastKnownProjectStorageRevision=readProjectStorageRevisionValue()}catch{lastKnownProjectStorageRevision=null}window.addEventListener("storage",e=>{if(!e||typeof e!="object")return;const t=resolveProjectStorageRevisionKeyName();if(e.key!==t)return;const o=normalizeProjectStorageRevisionValue(e.newValue);if(isProjectAutoSaving){o!==null&&(lastKnownProjectStorageRevision=o);return}o!==null&&o===lastKnownProjectStorageRevision||(lastKnownProjectStorageRevision=o,scheduleProjectStorageSync({silent:!0}))})}function resolveSetLanguageFn(){return resolveSessionRuntimeFunction("setLanguage")}function applySetLanguage(e,t={}){const o=resolveSetLanguageFn();if(typeof o!="function")return!t?.silent&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("applySetLanguage: setLanguage runtime function not available"),!1;try{return o(e,t)}catch(r){return!t?.silent&&typeof console<"u"&&typeof console.error=="function"&&console.error("applySetLanguage: setLanguage execution failed",r),!1}}function sessionJsonDeepClone(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}function sessionResolveStructuredClone(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}if(typeof require=="function"){try{const t=require("node:util");if(t&&typeof t.structuredClone=="function")return t.structuredClone.bind(t)}catch{}try{const t=require("util");if(t&&typeof t.structuredClone=="function")return t.structuredClone.bind(t)}catch{}}return null}function sessionCreateResilientDeepClone(e){const t=sessionResolveStructuredClone(e);return t?function(r){if(r===null||typeof r!="object")return r;try{return t(r)}catch{}return sessionJsonDeepClone(r)}:sessionJsonDeepClone}let sensorModeDropdown,recordingResolutionDropdown,slowMotionSensorModeDropdown,slowMotionRecordingResolutionDropdown,slowMotionAspectRatioSelect,slowMotionRecordingFrameRateInput,slowMotionRecordingFrameRateHint,slowMotionRecordingFrameRateOptionsList;const SESSION_DEEP_CLONE=typeof CORE_GLOBAL_SCOPE$1<"u"&&CORE_GLOBAL_SCOPE$1&&typeof CORE_GLOBAL_SCOPE$1.__cineDeepClone=="function"?CORE_GLOBAL_SCOPE$1.__cineDeepClone:sessionCreateResilientDeepClone(getSessionCloneScope());if(typeof CORE_GLOBAL_SCOPE$1<"u"&&CORE_GLOBAL_SCOPE$1&&typeof CORE_GLOBAL_SCOPE$1.__cineDeepClone!="function")try{CORE_GLOBAL_SCOPE$1.__cineDeepClone=SESSION_DEEP_CLONE}catch{}function resolveMissingMountVoltageWarnings(){if(missingMountVoltageWarnings instanceof Set)return missingMountVoltageWarnings;const e=[typeof CORE_GLOBAL_SCOPE$1<"u"&&CORE_GLOBAL_SCOPE$1&&typeof CORE_GLOBAL_SCOPE$1=="object"?CORE_GLOBAL_SCOPE$1:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null].filter(Boolean);for(let o=0;o<e.length;o+=1){const r=e[o];try{const n=r.__cineMissingMountVoltageWarnings;if(n instanceof Set)return missingMountVoltageWarnings=n,n}catch{}}const t=new Set;for(let o=0;o<e.length;o+=1){const r=e[o];try{r.__cineMissingMountVoltageWarnings=t;break}catch{}}return missingMountVoltageWarnings=t,t}function warnMissingMountVoltageHelper(e,t){const o=resolveMissingMountVoltageWarnings(),r=typeof e=="string"&&e?e:"unknown";if(!o.has(r)&&(o.add(r),typeof console<"u"&&typeof console.warn=="function")){const n=`Mount voltage helper "${r}" is unavailable; using defaults to protect user data.`;t?console.warn(n,t):console.warn(n)}}function ensureSessionRuntimePlaceholder(e,t){const o=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,r=typeof t=="function"?t:()=>t;if(!o||typeof o!="object")return r();try{const n=o[e];if(typeof n>"u"||n===null){const a=r();return typeof a<"u"&&a!==null&&(o[e]=a),a}return n}catch{return r()}}function detectPrimaryGlobalScope(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null}function whenGlobalValueAvailable(e,t,o,r={}){if(typeof e!="string"||!e||typeof t!="function"||typeof o!="function")return!1;const n=detectPrimaryGlobalScope();if(!n||typeof n!="object"&&typeof n!="function")return!1;const a=typeof r.maxAttempts=="number"?r.maxAttempts:150,s=a<0,l=typeof r.interval=="number"&&r.interval>0?r.interval:200,u=R=>{try{o(R)}catch(_){typeof console<"u"&&console&&typeof console.error=="function"&&console.error(`whenGlobalValueAvailable: handler for ${e} threw.`,_)}},d=R=>t(R)?(u(R),!0):!1,m=(()=>{try{return n[e]}catch(R){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn(`whenGlobalValueAvailable: unable to read ${e} during initial attempt.`,R);return}})();if(d(m))return!0;let y=0,h=!1;const b=[],v=()=>{h=!0;for(let R=0;R<b.length;R+=1)try{clearTimeout(b[R])}catch{}b.length=0},C=()=>{if(typeof r.onTimeout=="function")try{r.onTimeout()}catch(R){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn(`whenGlobalValueAvailable: timeout handler for ${e} failed.`,R)}},A=()=>{if(h)return;y+=1;let R;try{R=n[e]}catch(G){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn(`whenGlobalValueAvailable: unable to read ${e} during polling.`,G),R=void 0}if(d(R)){v();return}if(!s&&y>=a){v(),C();return}const _=setTimeout(A,l);b.push(_)},w=setTimeout(A,l);return b.push(w),!0}function getSessionRuntimeScopes(){const e=[],t=o=>{!o||typeof o!="object"||e.indexOf(o)===-1&&e.push(o)};try{typeof CORE_GLOBAL_SCOPE$1<"u"&&CORE_GLOBAL_SCOPE$1&&t(CORE_GLOBAL_SCOPE$1)}catch{}return t(typeof globalThis<"u"?globalThis:null),t(typeof window<"u"?window:null),t(typeof self<"u"?self:null),t(typeof global<"u"?global:null),e}function resolveModuleApi(e,t){if(typeof e!="string"||!e)return null;const o=typeof t=="function"?t:m=>!!m,r=new Set,n=[],a=m=>{!m||typeof m!="object"&&typeof m!="function"||r.has(m)||(r.add(m),n.push(m))},s=["CORE_SHARED","CORE_GLOBAL_SCOPE","CORE_AGGREGATED_EXPORTS","CORE_RUNTIME_SCOPE","CORE_PART2_RUNTIME_SCOPE","CORE_SCOPE","CORE_SHARED_SCOPE_PART2","cine","cineGlobals","cineModuleGlobals","cineModuleBase","cineModuleContext","cineRuntime","cinePersistence","cineOffline","cineUi","APP","app","__cineGlobal","__cineScope","__cineModules","__cineExports","__cineRuntime"],l=m=>{if(!m)return null;try{if(o(m))return m}catch{}return null},u=m=>{let y;try{y=m[e]}catch{y=void 0}const h=l(y);if(h)return h;let b;try{b=m.cineModuleGlobals}catch{b=null}if(b&&typeof b.getModule=="function")try{const C=b.getModule(e),A=l(C);if(A)return A}catch{}let v;try{v=m.cineModules}catch{v=null}if(v&&typeof v.get=="function")try{const C=v.get(e),A=l(C);if(A)return A}catch{}return null};a(detectPrimaryGlobalScope());const d=getSessionRuntimeScopes();for(let m=0;m<d.length;m+=1)a(d[m]);for(;n.length;){const m=n.shift();if(!m)continue;const y=u(m);if(y)return y;for(let h=0;h<s.length;h+=1){const b=s[h];let v;try{v=m[b]}catch{v=void 0}v&&a(v)}}return null}function normalizeVersionValue(e){if(typeof e!="string")return null;const t=e.trim();return t||null}function resolveKnownAppVersion(e){const t=normalizeVersionValue(e);if(t)return t;try{if(typeof APP_VERSION=="string"){const d=normalizeVersionValue(APP_VERSION);if(d)return d}}catch{}const o=new Set,r=[],n=d=>{if(!d)return;const m=typeof d;m!=="object"&&m!=="function"||o.has(d)||(o.add(d),r.push(d))},a=getSessionRuntimeScopes();for(let d=0;d<a.length;d+=1)n(a[d]);try{typeof CORE_SHARED$1<"u"&&CORE_SHARED$1&&n(CORE_SHARED$1)}catch{}try{typeof CORE_GLOBAL_SCOPE$1<"u"&&CORE_GLOBAL_SCOPE$1&&n(CORE_GLOBAL_SCOPE$1)}catch{}const s=["APP_VERSION","appVersion","applicationVersion","version"],l=["CORE_SHARED","CORE_GLOBAL_SCOPE","CORE_AGGREGATED_EXPORTS","CORE_RUNTIME_SCOPE","CORE_PART2_RUNTIME_SCOPE","CORE_SCOPE","CORE_SHARED_SCOPE_PART2","cineCoreShared","cineModules","cineModuleGlobals","cineModuleBase","cineModuleContext","cineRuntime","cinePersistence","cineOffline","cineUi","cineGlobals","cine","APP","app","globalScope","scope","exports","module","modules","environment","context","runtime","shared","globals","__cineGlobal","__cineScope","__cineModules","__cineExports","__cineRuntime","details","meta","metadata","build","buildInfo"];let u=0;for(;r.length;){if(u++,u>1e3){typeof console<"u"&&typeof console.warn=="function"&&console.warn("resolveKnownAppVersion: exceeded max iterations");break}const d=r.shift();if(!d)continue;for(let h=0;h<s.length;h+=1){const b=s[h];let v;try{v=d[b]}catch{v=void 0}const C=normalizeVersionValue(v);if(C)return C}for(let h=0;h<l.length;h+=1){const b=l[h];let v;try{v=d[b]}catch{v=null}n(v)}let m=[];try{m=Object.keys(d)}catch{m=[]}const y=m.length>50?m.slice(0,50):m;for(let h=0;h<y.length;h+=1){const b=y[h];if(!/(version|core|cine|shared|global|app)/i.test(b))continue;let v;try{v=d[b]}catch{v=null}n(v)}}return null}const ACTIVE_APP_VERSION$1=resolveKnownAppVersion(typeof APP_VERSION=="string"?APP_VERSION:null);function resolveMountVoltageNamespace(){const e=getSessionRuntimeScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const r=o.cineCoreMountVoltage;if(r&&typeof r=="object")return r}catch{}}return null}function resolveMountVoltageRuntimeExports(){const e=getSessionRuntimeScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const r=o.MOUNT_VOLTAGE_RUNTIME_EXPORTS;if(r&&typeof r=="object")return r}catch{}}return null}function getSessionRuntimeFunction(e){if(typeof e!="string"||!e)return null;const t=resolveMountVoltageNamespace();if(t&&typeof t[e]=="function")return t[e];const o=resolveMountVoltageRuntimeExports();if(o&&typeof o[e]=="function")return o[e];const r=getSessionRuntimeScopes();for(let n=0;n<r.length;n+=1){const a=r[n];let s=null;try{s=a[e]}catch{s=null}if(typeof s=="function")return s}return null}function resolveSettingsLoggingResolver(){if(typeof require=="function")try{const t=require("./modules/logging-resolver.js");if(t&&typeof t.resolveLogger=="function")return t}catch{}const e=getSessionRuntimeScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const r=o.cineLoggingResolver;if(r&&typeof r.resolveLogger=="function")return r}catch{}}return null}function resolveLegacySettingsLogger(){const e=getSessionRuntimeScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const r=o.cineLogging;if(r&&typeof r.createLogger=="function")try{return r.createLogger("settings",{meta:{source:"app-session"}})}catch(n){try{typeof r.error=="function"&&r.error("Failed to create settings logger",n,{namespace:"settings-bootstrap"})}catch(a){}}}catch{}}return null}const settingsLogger=(()=>{const e=resolveSettingsLoggingResolver();if(e&&typeof e.resolveLogger=="function")try{const t=e.resolveLogger("settings",{meta:{source:"app-session"}});if(t)return t}catch{}return resolveLegacySettingsLogger()})();function logSettingsEvent(e,t,o,r){const n=typeof e=="string"&&e?e.toLowerCase():"info";let a=!1;if(settingsLogger&&typeof settingsLogger[n]=="function")try{settingsLogger[n](t,o,r),a=!0}catch(l){a=!1,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Settings logger invocation failed",l)}if(a||typeof console>"u"||!console)return;let s=null;if(n==="error"&&typeof console.error=="function"?s=console.error:n==="warn"&&typeof console.warn=="function"?s=console.warn:typeof console.info=="function"?s=console.info:typeof console.log=="function"&&(s=console.log),typeof s=="function")try{s.call(console,`[settings] ${t}`,o||null,r||null)}catch{}}let pendingSettingsOpenContext=null;function prepareSettingsOpenContext(e){e&&typeof e=="object"?pendingSettingsOpenContext={...e}:pendingSettingsOpenContext=null}function consumeSettingsOpenContext(e){const t=pendingSettingsOpenContext;return pendingSettingsOpenContext=null,t&&typeof t=="object"?{...t}:e&&typeof e=="object"?{...e}:{reason:"settings-button"}}function resolveSettingsDialog(){if(typeof settingsDialog<"u"&&settingsDialog)return settingsDialog;if(typeof document<"u"&&document)try{return document.getElementById("settingsDialog")}catch{}return null}function resolveSettingsButton(){if(typeof settingsButton<"u"&&settingsButton)return settingsButton;if(typeof document<"u"&&document)try{return document.getElementById("settingsButton")}catch{}return null}function ensureDeferredScriptsLoaded(e){const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!t)return null;let o=null;try{typeof t.cineEnsureDeferredScriptsLoaded=="function"&&(o=t.cineEnsureDeferredScriptsLoaded({reason:e}))}catch{o=null}if(!o)try{o=t.cineDeferredScriptsReady}catch{o=null}return o}function ensureOnboardingTourReady(e){const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!t)return null;let o=null;try{typeof t.cineEnsureOnboardingTourLoaded=="function"&&(o=t.cineEnsureOnboardingTourLoaded(e))}catch{o=null}return o&&typeof o.then=="function"&&o.catch(r=>{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Onboarding tour module failed to pre-load for help interactions.",r)}),o}function requestSettingsOpen(e){const t=resolveSettingsDialog(),o=resolveSettingsButton(),r=t?typeof isDialogOpen=="function"?isDialogOpen(t):!!(t&&t.open):!1,n=e&&typeof e=="object"?{...e}:{};if(typeof n.openBefore!="boolean"&&(n.openBefore=r),ensureDeferredScriptsLoaded("settings-open"),o&&typeof o.click=="function"){prepareSettingsOpenContext(n);try{o.click()}catch(a){throw prepareSettingsOpenContext(null),logSettingsEvent("error","Settings dialog open request failed during click",{...n,buttonAvailable:!0},{action:"open-request"}),a}return!0}return logSettingsEvent("warn","Settings dialog open request unavailable",{...n,buttonAvailable:!1},{action:"open-request"}),!1}function resolveCompatibilityTexts(e,t){const o=typeof texts=="object"&&texts?texts:{},r=t||o.en||{},n=typeof currentLang=="string"&&o[currentLang]?currentLang:"en",a=e||o[n]||r;return{lang:n,langTexts:a,fallbackTexts:r}}function ensureMeaningfulValue(e){return e==null?!1:typeof e=="string"?e.trim().length>0:typeof e=="number"||typeof e=="boolean"?!0:Array.isArray(e)?e.length>0:typeof e=="object"?Object.keys(e).length>0:!1}const formatNumberForComparison=ensureSessionRuntimePlaceholder("formatNumberForComparison",()=>{const e=new Map,t=(o,r)=>{const n=`${o}|${r?"fraction":"integer"}`;if(e.has(n))return e.get(n);if(typeof Intl<"u"&&typeof Intl.NumberFormat=="function")try{const a=new Intl.NumberFormat(o,{maximumFractionDigits:r?2:0});return e.set(n,a),a}catch(a){console.warn("Unable to create comparison number formatter",a)}return e.set(n,null),null};return o=>{if(o==null)return"";const r=typeof o=="number"?o:Number(typeof o=="string"?o.trim():o);if(!Number.isFinite(r))return typeof o=="string"?o:String(o);const{lang:n}=resolveCompatibilityTexts(),a=Math.abs(r%1)>Number.EPSILON,s=t(n,a);if(s)try{return s.format(r)}catch(l){console.warn("Comparison number formatting failed",l)}try{return r.toLocaleString(n)}catch{}return String(r)}}),getManualDownloadFallbackMessage$1=ensureSessionRuntimePlaceholder("getManualDownloadFallbackMessage",()=>()=>{const{langTexts:e,fallbackTexts:t}=resolveCompatibilityTexts();return e.manualDownloadFallback||t.manualDownloadFallback||"The download did not start automatically. A new tab opened with the file contents so you can copy or save them manually."});ensureSessionRuntimePlaceholder("getManualDownloadCopyHint",()=>()=>{const{langTexts:e,fallbackTexts:t}=resolveCompatibilityTexts();return e.manualDownloadCopyHint||t.manualDownloadCopyHint||"Select all the text below and copy it to keep the file safe."});let backupDiffOptionsCache=ensureSessionRuntimePlaceholder("backupDiffOptionsCache",()=>[]),backupDiffState=ensureSessionRuntimePlaceholder("backupDiffState",()=>({baseline:"",comparison:""}));const RESTORE_COMPATIBILITY_CORE_KEYS=["devices","setups","project","projects","gearList","favorites"],RESTORE_COMPATIBILITY_OPTIONAL_KEYS=["autoGearRules","autoGearPresets","autoGearBackups","autoGearMonitorDefaults","autoGearActivePresetId","autoGearAutoPresetId","autoGearShowBackups","autoGearBackupRetention","fullBackups","fullBackupHistory","session"],RESTORE_COMPATIBILITY_STORAGE_KEYS=["accentColor","fontSize","fontFamily","language","showAutoBackups","customLogo","customFonts"],RESTORE_SECTION_LABEL_OVERRIDES={autoGearRules:"Automatic gear rules",autoGearPresets:"Automatic gear presets",autoGearBackups:"Automatic gear backups",autoGearMonitorDefaults:"Monitor defaults",autoGearActivePresetId:"Active auto gear preset",autoGearAutoPresetId:"Auto gear auto preset",autoGearShowBackups:"Auto gear backup visibility",autoGearBackupRetention:"Auto gear backup retention",fullBackups:"Full backups",fullBackupHistory:"Full backup history",showAutoBackups:"Automatic backup visibility"};function humanizeRestoreSectionKey(e){if(RESTORE_SECTION_LABEL_OVERRIDES[e])return RESTORE_SECTION_LABEL_OVERRIDES[e];if(typeof e!="string")return String(e);const t=e.replace(/[_\s-]+/g," ").replace(/([a-z\d])([A-Z])/g,"$1 $2").trim();return t?t.charAt(0).toUpperCase()+t.slice(1):e}function evaluateRestoreCompatibilitySections({data:e,settingsSnapshot:t,sessionSnapshot:o}){const r=e&&typeof e=="object"?e:null,n=t&&typeof t=="object"?t:null,a=o&&typeof o=="object"?o:null,s=[],l=[],u=[],d=(m,y)=>{if(!r||!Object.prototype.hasOwnProperty.call(r,m)){y.push(m);return}ensureMeaningfulValue(r[m])||y.push(m)};return RESTORE_COMPATIBILITY_CORE_KEYS.forEach(m=>d(m,s)),RESTORE_COMPATIBILITY_OPTIONAL_KEYS.forEach(m=>d(m,l)),(!a||!ensureMeaningfulValue(a))&&(l.includes("session")||l.push("session")),RESTORE_COMPATIBILITY_STORAGE_KEYS.forEach(m=>{if(!n||!Object.prototype.hasOwnProperty.call(n,m)){u.push(m);return}ensureMeaningfulValue(n[m])||u.push(m)}),{missingCore:s,missingOptional:l,missingStorage:u}}function describeMissingSections(e,t){if(!e||!Array.isArray(t)||!t.length)return"";const o=t.map(r=>`• ${humanizeRestoreSectionKey(r)}`).join(`
`);return`${e}
${o}`}function buildRestoreCompatibilityReport(e={}){const{langTexts:t,fallbackTexts:o,fileVersion:r,targetVersion:n,data:a,settingsSnapshot:s,sessionSnapshot:l,backupFileName:u}=e,{langTexts:d,fallbackTexts:m}=resolveCompatibilityTexts(t,o),y=evaluateRestoreCompatibilitySections({data:a,settingsSnapshot:s,sessionSnapshot:l}),h=(F,z)=>d&&typeof d[F]=="string"?d[F]:m&&typeof m[F]=="string"?m[F]:z||"",b=[],v=h("restoreVersionSummaryTitle");v&&b.push(v);const C=h("restoreVersionUnknownVersion","unknown version"),A=h("restoreVersionSummaryHeading","This backup was created with {oldVersion} and you are running {newVersion}."),w=normalizeVersionValue(r),R=resolveKnownAppVersion(n)||ACTIVE_APP_VERSION$1||normalizeVersionValue(n),_=A.replace("{oldVersion}",w||C).replace("{newVersion}",R||C);b.push(_);const G=h("restoreVersionWarning");G&&b.push(G);const O=describeMissingSections(h("restoreVersionCoreMissing","Not included in this backup:"),y.missingCore);O&&b.push(O);const B=describeMissingSections(h("restoreVersionStorageMissing","Stored preferences not included:"),y.missingStorage);B&&b.push(B);const $=describeMissingSections(h("restoreVersionOptionalMissing","Optional items you may need to recreate:"),y.missingOptional);if($&&b.push($),!y.missingCore.length&&!y.missingStorage.length&&!y.missingOptional.length){const F=h("restoreVersionNoIssues");F&&b.push(F)}if(u){const F=h("restoreVersionBackupLabel");F&&b.push(F.replace("{fileName}",u))}const V=h("restoreVersionTip");V&&b.push(V);const M=h("restoreVersionFooter");return M&&b.push(M),{evaluation:y,message:b.filter(Boolean).join(`

`),langTexts:d,fallbackTexts:m}}const buildRestoreVersionCompatibilityMessage=ensureSessionRuntimePlaceholder("buildRestoreVersionCompatibilityMessage",()=>(e={})=>buildRestoreCompatibilityReport(e).message),verifyRestoredBackupIntegrity=ensureSessionRuntimePlaceholder("verifyRestoredBackupIntegrity",()=>e=>{const t=e&&typeof e=="object"&&!Array.isArray(e)&&(e.data||e.settingsSnapshot||e.sessionSnapshot)?e:{data:e},o=buildRestoreCompatibilityReport(t),{evaluation:r,message:n,langTexts:a,fallbackTexts:s}=o,l=r.missingCore.length+r.missingStorage.length+r.missingOptional.length,u=a&&a.restoreVersionWarning||s&&s.restoreVersionWarning||"Backup created with a different version. Some features might not transfer.",d=a&&a.restoreVersionNoIssues||s&&s.restoreVersionNoIssues||"All modern data sections were found in this backup.";return l===0?{notificationType:"success",notificationMessage:d,alertMessage:""}:{notificationType:"warning",notificationMessage:u,alertMessage:n}});function invokeSessionRevertAccentColor(){const e=getSessionRuntimeFunction("revertAccentColor");if(typeof e=="function")try{e()}catch(t){console.warn("Failed to revert accent color",t)}}function invokeSessionOpenAutoGearEditor(...e){const t=getSessionRuntimeFunction("openAutoGearEditor");if(typeof t!="function"){console.warn("Auto Gear editor runtime is not available yet.");return}try{t(...e)}catch(o){console.warn("Failed to open Auto Gear editor",o)}}ensureSessionRuntimePlaceholder("autoGearScenarioModeSelect",null);const normalizeAccentValueSafe=ensureSessionRuntimePlaceholder("normalizeAccentValue",()=>e=>typeof e=="string"?e.trim().toLowerCase():""),isPlainObjectFallback=e=>{if(e===null||typeof e!="object"||Array.isArray(e))return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null},isPlainObject=ensureSessionRuntimePlaceholder("isPlainObject",()=>isPlainObjectFallback),applyFontSizeSafe=ensureSessionRuntimePlaceholder("applyFontSize",()=>{const e={"--page-padding":20,"--gap-size":10,"--button-size":32,"--border-radius":5,"--form-label-width":150,"--form-label-min-width":120,"--form-action-width":110},t=Object.keys(e),o={...e};let r=null;const n=()=>{if(r!==null)return;r=16;const a=typeof document<"u"&&document?document.documentElement:null;if(a)try{const s=typeof window<"u"&&window&&typeof window.getComputedStyle=="function"?window.getComputedStyle(a):null;if(!s)return;const l=parseFloat(s.fontSize);Number.isFinite(l)&&l>0&&(r=l);for(let u=0;u<t.length;u+=1){const d=t[u],m=s.getPropertyValue(d),y=parseFloat(m);Number.isFinite(y)&&y>0&&(o[d]=y)}}catch(s){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to capture base UI scale metrics",s)}};return a=>{const s=typeof document<"u"&&document?document.documentElement:null;if(!s)return;const l=Number.parseFloat(a);if(!Number.isFinite(l)||l<=0)return;n(),s.style.fontSize=`${l}px`;const u=Number.isFinite(r)&&r>0?r:l,d=u>0?l/u:1,m=Number.isFinite(d)&&d>0?d:1;for(let y=0;y<t.length;y+=1){const h=t[y],b=o[h];Number.isFinite(b)&&b>0&&s.style.setProperty(h,`${b*m}px`)}s.style.setProperty("--ui-scale",String(m))}}),applyFontFamilySafe=ensureSessionRuntimePlaceholder("applyFontFamily",()=>e=>{const t=typeof document<"u"&&document?document.documentElement:null;if(t)try{t.style.setProperty("--font-family",e||"")}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to apply font family",o)}}),downloadDiagramButton=ensureSessionRuntimePlaceholder("downloadDiagramBtn",()=>{if(typeof document>"u"||!document||typeof document.getElementById!="function")return null;try{return document.getElementById("downloadDiagram")}catch{return null}}),gridSnapToggleButton=ensureSessionRuntimePlaceholder("gridSnapToggleBtn",()=>{if(typeof document>"u"||!document||typeof document.getElementById!="function")return null;try{return document.getElementById("gridSnapToggle")}catch{return null}}),GRID_SNAP_STORAGE_KEY="__cineGridSnapState",readGridSnapState=()=>{try{if(typeof getGridSnapState=="function")return!!getGridSnapState()}catch{}if(typeof gridSnap<"u")try{return!!gridSnap}catch{}const e=getSessionRuntimeScopes();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object")){try{const r=o[GRID_SNAP_STORAGE_KEY];if(typeof r=="boolean")return r}catch{}try{const r=o.gridSnap;if(typeof r=="boolean")return r}catch{}}}return!1},writeGridSnapState=e=>{const t=e===!0;try{if(typeof setGridSnapState=="function")return!!setGridSnapState(t)}catch{}const o=getSessionRuntimeScopes();for(let r=0;r<o.length;r+=1){const n=o[r];if(!(!n||typeof n!="object")){try{n[GRID_SNAP_STORAGE_KEY]=t}catch{try{Object.defineProperty(n,GRID_SNAP_STORAGE_KEY,{configurable:!0,writable:!0,value:t})}catch{}}try{n.gridSnap=t}catch{try{Object.defineProperty(n,"gridSnap",{configurable:!0,writable:!0,value:t})}catch{}}}}try{if(typeof applyLegacyGridSnapValue=="function")return!!applyLegacyGridSnapValue(t)}catch{}return t},resolveDiagramContainer=()=>{if(typeof setupDiagramContainer<"u"&&setupDiagramContainer)return setupDiagramContainer;if(typeof document<"u"&&document&&typeof document.getElementById=="function")try{return document.getElementById("diagramArea")}catch{}return null},applyGridSnapUiState=e=>{const t=resolveDiagramContainer();gridSnapToggleButton&&(gridSnapToggleButton.classList.toggle("active",e),gridSnapToggleButton.setAttribute("aria-pressed",e?"true":"false")),t&&t.classList.toggle("grid-snap",e)};applyGridSnapUiState(readGridSnapState());function getGlobalCineUi(){const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!e||typeof e!="object")return null;try{const t=e.cineUi;return t&&typeof t=="object"?t:null}catch{return null}}function isCineUiEntryRegistered(e,t){if(!e||typeof e!="object")return!1;if(typeof e.get=="function")try{return!!e.get(t)}catch{}if(typeof e.list=="function")try{const o=e.list();return Array.isArray(o)&&o.indexOf(t)!==-1}catch{}return!1}function registerCineUiEntries(e,t,o){if(!(!e||typeof e.register!="function"))for(let r=0;r<t.length;r+=1){const n=t[r];if(!(!n||typeof n.name!="string")&&!isCineUiEntryRegistered(e,n.name))try{e.register(n.name,n.value)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn(o,a)}}}function safeLoadStoredLogoPreview(){if(typeof loadStoredLogoPreview=="function")try{loadStoredLogoPreview()}catch(e){console.warn("Failed to load stored logo preview",e)}}function areSessionEntriesRegistered(e){if(!e||typeof e!="object")return!1;const t=e.controllers,o=e.interactions,r=e.help;return isCineUiEntryRegistered(t,"backupSettings")&&isCineUiEntryRegistered(t,"restoreSettings")&&isCineUiEntryRegistered(o,"performBackup")&&isCineUiEntryRegistered(o,"openRestorePicker")&&isCineUiEntryRegistered(o,"applyRestoreFile")&&isCineUiEntryRegistered(r,"backupSettings")&&isCineUiEntryRegistered(r,"restoreSettings")}let sessionCineUiRegistered=areSessionEntriesRegistered(getGlobalCineUi());function enqueueCineUiRegistration(e){const t=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;if(!t||typeof e!="function")return;try{const r=t.cineUi&&typeof t.cineUi=="object"?t.cineUi:null;if(r){e(r);return}}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("cineUi registration callback (session) failed",r);return}const o="__cineUiReadyQueue";Array.isArray(t[o])||(t[o]=[]),t[o].push(e)}enqueueCineUiRegistration(registerSessionCineUiInternal);const SESSION_GLOBAL_SCOPE=typeof CORE_GLOBAL_SCOPE$1=="object"&&CORE_GLOBAL_SCOPE$1||(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null)||null,SESSION_DEFAULT_ACCENT_COLOR_FALLBACK="#001589",SESSION_HIGH_CONTRAST_ACCENT_COLOR_FALLBACK="#ffffff",resolvedDefaultAccentColor=(()=>{if(SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE.DEFAULT_ACCENT_COLOR=="string"){const e=SESSION_GLOBAL_SCOPE.DEFAULT_ACCENT_COLOR.trim();if(e)return e}if(SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE.accentColor=="string"){const e=SESSION_GLOBAL_SCOPE.accentColor.trim();if(e)return e}return SESSION_DEFAULT_ACCENT_COLOR_FALLBACK})(),resolvedDefaultAccentNormalized=typeof resolvedDefaultAccentColor=="string"?resolvedDefaultAccentColor.toLowerCase():SESSION_DEFAULT_ACCENT_COLOR_FALLBACK.toLowerCase(),resolvedHighContrastAccentColor=(()=>{if(SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE.HIGH_CONTRAST_ACCENT_COLOR=="string"){const e=SESSION_GLOBAL_SCOPE.HIGH_CONTRAST_ACCENT_COLOR.trim();if(e)return e}return SESSION_HIGH_CONTRAST_ACCENT_COLOR_FALLBACK})(),resolvedAccentColor=(()=>{if(SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE.accentColor=="string"){const e=SESSION_GLOBAL_SCOPE.accentColor.trim();if(e)return e}return resolvedDefaultAccentColor})(),hasDefaultAccentColor=typeof DEFAULT_ACCENT_COLOR=="string"&&DEFAULT_ACCENT_COLOR.trim();if(!hasDefaultAccentColor)try{DEFAULT_ACCENT_COLOR=resolvedDefaultAccentColor}catch{SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE=="object"&&(SESSION_GLOBAL_SCOPE.DEFAULT_ACCENT_COLOR=resolvedDefaultAccentColor)}const hasDefaultAccentNormalized=typeof DEFAULT_ACCENT_NORMALIZED=="string"&&DEFAULT_ACCENT_NORMALIZED;if(!hasDefaultAccentNormalized)try{DEFAULT_ACCENT_NORMALIZED=resolvedDefaultAccentNormalized}catch{SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE=="object"&&(SESSION_GLOBAL_SCOPE.DEFAULT_ACCENT_NORMALIZED=resolvedDefaultAccentNormalized)}const hasHighContrastAccent=typeof HIGH_CONTRAST_ACCENT_COLOR=="string"&&HIGH_CONTRAST_ACCENT_COLOR.trim();if(!hasHighContrastAccent)try{HIGH_CONTRAST_ACCENT_COLOR=resolvedHighContrastAccentColor}catch{SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE=="object"&&(SESSION_GLOBAL_SCOPE.HIGH_CONTRAST_ACCENT_COLOR=resolvedHighContrastAccentColor)}const hasAccentColor=typeof accentColor=="string"&&accentColor.trim();if(!hasAccentColor)try{accentColor=resolvedAccentColor}catch{SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE=="object"&&(SESSION_GLOBAL_SCOPE.accentColor=resolvedAccentColor)}const hasPrevAccentColor=typeof prevAccentColor=="string"&&prevAccentColor.trim();if(!hasPrevAccentColor)try{prevAccentColor=resolvedAccentColor}catch{SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE=="object"&&(SESSION_GLOBAL_SCOPE.prevAccentColor=resolvedAccentColor)}if(typeof restoringSession!="boolean")try{restoringSession=!1}catch{SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE=="object"&&(SESSION_GLOBAL_SCOPE.restoringSession=!1)}if(typeof filterSelectElem>"u")try{filterSelectElem=null}catch{SESSION_GLOBAL_SCOPE&&typeof SESSION_GLOBAL_SCOPE=="object"&&(SESSION_GLOBAL_SCOPE.filterSelectElem=null)}function resolveFilterSelectElement(){if(filterSelectElem&&typeof filterSelectElem=="object"&&typeof filterSelectElem.tagName=="string")return filterSelectElem;if(typeof document>"u"||!document)return null;try{const e=document.getElementById("filter");if(e)return filterSelectElem=e,e}catch{}return filterSelectElem}function callSessionCoreFunction(e,t=[],o={}){if(typeof callCoreFunctionIfAvailable=="function")return callCoreFunctionIfAvailable(e,t,o);const r=(typeof globalThis<"u"?globalThis:null)||(typeof window<"u"?window:null)||(typeof self<"u"?self:null)||(typeof global<"u"?global:null),n=typeof e=="string"?r&&r[e]:e;if(typeof n=="function"){try{return n.apply(r,t)}catch(a){typeof console<"u"&&typeof console.error=="function"&&console.error(`Failed to invoke ${e}`,a)}return}if(o&&o.defer===!0){const a=r&&Array.isArray(r.CORE_BOOT_QUEUE)?r.CORE_BOOT_QUEUE:null;a&&a.push(()=>{callSessionCoreFunction(e,t,{...o,defer:!1})})}return o&&Object.prototype.hasOwnProperty.call(o,"defaultValue")?o.defaultValue:void 0}function ensureSessionRuntimeFunction(e,t={}){return ensureSessionRuntimePlaceholder(e,()=>{const o=(...r)=>callSessionCoreFunction(e,r,t);try{Object.defineProperty(o,"__cineSessionProxy__",{value:!0,writable:!1,enumerable:!1})}catch{try{o.__cineSessionProxy__=!0}catch{}}return o})}const AUTO_GEAR_RUNTIME_HANDLERS=["handleAutoGearImportSelection","handleAutoGearPresetSelection","handleAutoGearSavePreset","handleAutoGearDeletePreset","handleAutoGearShowBackupsToggle","handleAutoGearConditionShortcut","saveAutoGearRuleFromEditor"];for(let e=0;e<AUTO_GEAR_RUNTIME_HANDLERS.length;e+=1){const t=AUTO_GEAR_RUNTIME_HANDLERS[e];ensureSessionRuntimeFunction(t,{defer:!0})}const AUTO_GEAR_RUNTIME_FUNCTIONS=["setAutoGearSummaryFocus","focusAutoGearRuleById","setAutoGearSearchQuery","setAutoGearScenarioFilter","clearAutoGearFilters"];for(let e=0;e<AUTO_GEAR_RUNTIME_FUNCTIONS.length;e+=1){const t=AUTO_GEAR_RUNTIME_FUNCTIONS[e];ensureSessionRuntimeFunction(t,{defer:!0})}function getSessionCoreValue(e,t={}){const o=Object.prototype.hasOwnProperty.call(t,"defaultValue")?t.defaultValue:"",r=callSessionCoreFunction(e,[],{defaultValue:o});if(typeof r=="string")return r;if(r==null)return o;try{return String(r)}catch{return o}}function deriveSessionProjectInfo(e){const t=e&&typeof e=="object"?{...e}:{},o=callSessionCoreFunction("deriveProjectInfo",[e],{defaultValue:t});return o&&typeof o=="object"?o:t}const temperaturePreferenceStorageKey=typeof TEMPERATURE_STORAGE_KEY$1=="string"?TEMPERATURE_STORAGE_KEY$1:typeof resolveTemperatureStorageKey=="function"?resolveTemperatureStorageKey():"cameraPowerPlanner_temperatureUnit",sessionGlobalScope=getSessionCloneScope();function normalizeTemperatureUnitValue(e){return e==="fahrenheit"||e==="celsius"?e:e&&typeof e=="string"?e.toLowerCase():"celsius"}function resolveInitialTemperatureUnit(){if(sessionGlobalScope&&typeof sessionGlobalScope.temperatureUnit=="string")return normalizeTemperatureUnitValue(sessionGlobalScope.temperatureUnit);try{if(typeof localStorage<"u"&&localStorage){const e=localStorage.getItem(temperaturePreferenceStorageKey);if(typeof e=="string"&&e)return normalizeTemperatureUnitValue(e)}}catch(e){console.warn("Unable to read stored temperature unit preference",e)}return"celsius"}let localTemperatureUnit=resolveInitialTemperatureUnit();function resolveTemperatureUnitPreferenceController(){if(typeof applyTemperatureUnitPreference=="function")return applyTemperatureUnitPreference;if(sessionGlobalScope&&typeof sessionGlobalScope.applyTemperatureUnitPreference=="function")return sessionGlobalScope.applyTemperatureUnitPreference;if(typeof globalThis<"u")try{const e=globalThis.applyTemperatureUnitPreference;if(typeof e=="function")return e}catch{}return null}function applyTemperatureUnitPreferenceWithFallback(e,t={}){const o=normalizeTemperatureUnitValue(e),r=!(t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"persist")&&t.persist===!1),n=resolveTemperatureUnitPreferenceController();if(n)try{n(e,t)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not apply temperature unit preference via controller",a)}try{localTemperatureUnit=o}catch{}if(sessionGlobalScope&&typeof sessionGlobalScope=="object")try{sessionGlobalScope.temperatureUnit=o}catch(a){typeof console<"u"&&typeof console.debug=="function"&&console.debug("Unable to propagate temperature unit preference to session scope",a)}if(r)try{typeof localStorage<"u"&&localStorage&&localStorage.setItem(temperaturePreferenceStorageKey,o)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Could not save temperature unit preference",a)}return o}if(sessionGlobalScope&&typeof sessionGlobalScope=="object")try{Object.defineProperty(sessionGlobalScope,"temperatureUnit",{configurable:!0,enumerable:!0,get(){return localTemperatureUnit},set(e){localTemperatureUnit=normalizeTemperatureUnitValue(e)}})}catch{try{sessionGlobalScope.temperatureUnit=localTemperatureUnit}catch{}}let recordFullBackupHistoryEntryFn=()=>{},ensureCriticalStorageBackupsFn=()=>({ensured:[],skipped:[],errors:[]});try{({recordFullBackupHistoryEntry:recordFullBackupHistoryEntryFn,ensureCriticalStorageBackups:ensureCriticalStorageBackupsFn}=require("./storage.js"))}catch(e){typeof window<"u"&&window&&typeof window.recordFullBackupHistoryEntry=="function"&&(recordFullBackupHistoryEntryFn=window.recordFullBackupHistoryEntry),typeof window<"u"&&window&&typeof window.ensureCriticalStorageBackups=="function"&&(ensureCriticalStorageBackupsFn=window.ensureCriticalStorageBackups)}const createBackupDiffRefs=()=>{const e=typeof document<"u"?document:null;return e?{toggleButton:e.getElementById("backupDiffToggleButton"),section:e.getElementById("backupDiffSection"),primarySelect:e.getElementById("backupDiffPrimary"),secondarySelect:e.getElementById("backupDiffSecondary"),emptyState:e.getElementById("backupDiffEmptyState"),summary:e.getElementById("backupDiffSummary"),list:e.getElementById("backupDiffList"),listContainer:e.getElementById("backupDiffListContainer"),notes:e.getElementById("backupDiffNotes"),exportButton:e.getElementById("backupDiffExport"),closeButton:e.getElementById("backupDiffClose")}:{toggleButton:null,section:null,primarySelect:null,secondarySelect:null,emptyState:null,summary:null,list:null,listContainer:null,notes:null,exportButton:null,closeButton:null}};let backupDiffToggleButtonEl,backupDiffSectionEl,backupDiffPrimarySelectEl,backupDiffSecondarySelectEl,backupDiffEmptyStateEl,backupDiffSummaryEl,backupDiffListEl,backupDiffListContainerEl,backupDiffNotesEl,backupDiffExportButtonEl,backupDiffCloseButtonEl;({toggleButton:backupDiffToggleButtonEl,section:backupDiffSectionEl,primarySelect:backupDiffPrimarySelectEl,secondarySelect:backupDiffSecondarySelectEl,emptyState:backupDiffEmptyStateEl,summary:backupDiffSummaryEl,list:backupDiffListEl,listContainer:backupDiffListContainerEl,notes:backupDiffNotesEl,exportButton:backupDiffExportButtonEl,closeButton:backupDiffCloseButtonEl}=createBackupDiffRefs());function createRestoreRehearsalRefs(){const e=typeof document<"u"?document:null;if(!e)return{button:null,section:null,heading:null,closeButton:null,input:null,browseButton:null,fileName:null,status:null,table:null,tableBody:null,ruleSection:null,ruleHeading:null,ruleIntro:null,ruleEmpty:null,ruleList:null,actions:null,proceedButton:null,abortButton:null,modeInputs:[]};const t=[e.getElementById("restoreRehearsalModeBackup"),e.getElementById("restoreRehearsalModeProject")].filter(Boolean);return{button:e.getElementById("restoreRehearsalButton"),section:e.getElementById("restoreRehearsalSection"),heading:e.getElementById("restoreRehearsalHeading"),closeButton:e.getElementById("restoreRehearsalClose"),input:e.getElementById("restoreRehearsalInput"),browseButton:e.getElementById("restoreRehearsalBrowse"),fileName:e.getElementById("restoreRehearsalFileName"),status:e.getElementById("restoreRehearsalStatus"),table:e.getElementById("restoreRehearsalTable"),tableBody:e.getElementById("restoreRehearsalTableBody"),ruleSection:e.getElementById("restoreRehearsalRuleSection"),ruleHeading:e.getElementById("restoreRehearsalRuleHeading"),ruleIntro:e.getElementById("restoreRehearsalRuleIntro"),ruleEmpty:e.getElementById("restoreRehearsalRuleEmpty"),ruleList:e.getElementById("restoreRehearsalRuleList"),actions:e.getElementById("restoreRehearsalActions"),proceedButton:e.getElementById("restoreRehearsalProceed"),abortButton:e.getElementById("restoreRehearsalAbort"),modeInputs:t}}const{button:restoreRehearsalButtonEl,section:restoreRehearsalSectionEl,heading:restoreRehearsalHeadingEl,closeButton:restoreRehearsalCloseButtonEl,input:restoreRehearsalInputEl,browseButton:restoreRehearsalBrowseButtonEl,fileName:restoreRehearsalFileNameEl,status:restoreRehearsalStatusEl,table:restoreRehearsalTableEl,tableBody:restoreRehearsalTableBodyEl,ruleSection:restoreRehearsalRuleSectionEl,ruleHeading:restoreRehearsalRuleHeadingEl,ruleIntro:restoreRehearsalRuleIntroEl,ruleEmpty:restoreRehearsalRuleEmptyEl,ruleList:restoreRehearsalRuleListEl,actions:restoreRehearsalActionsEl,proceedButton:restoreRehearsalProceedButtonEl,abortButton:restoreRehearsalAbortButtonEl,modeInputs:restoreRehearsalModeInputs}=createRestoreRehearsalRefs();let restoreRehearsalLastSnapshot=null;function createEmptyRestoreRehearsalCounts(){return RESTORE_REHEARSAL_METRICS.reduce((e,t)=>(e[t.key]=0,e),{})}function countProjectsFromSetups(e){return Array.isArray(e)?e.length:isPlainObject(e)?Object.keys(e).length:typeof e=="string"&&e.trim()?1:0}function countFavoritesEntries(e){return isPlainObject(e)?Object.values(e).reduce((t,o)=>Array.isArray(o)?t+o.filter(Boolean).length:isPlainObject(o)&&Array.isArray(o.entries)?t+o.entries.filter(Boolean).length:t,0):0}function projectInfoValueHasData(e){return e==null?!1:typeof e=="string"?e.trim().length>0:typeof e=="number"?!Number.isNaN(e):typeof e=="boolean"?e:Array.isArray(e)?e.some(t=>projectInfoValueHasData(t)):isPlainObject(e)?Object.keys(e).some(t=>projectInfoValueHasData(e[t])):!1}function countCrewEntries(e){if(!e)return 0;if(Array.isArray(e))return e.reduce((t,o)=>t+countCrewEntries(o),0);if(typeof e=="string")return e.split(/\r?\n+/).map(t=>t.trim()).filter(Boolean).length;if(isPlainObject(e)){if(Array.isArray(e.people))return countCrewEntries(e.people);if(Array.isArray(e.entries))return countCrewEntries(e.entries);if(typeof e.text=="string")return countCrewEntries(e.text);if(typeof e.name=="string"||typeof e.role=="string"||typeof e.phone=="string"||typeof e.email=="string"||typeof e.website=="string"||typeof e.text=="string"){const o=typeof e.name=="string"?e.name.trim():"",r=typeof e.role=="string"?e.role.trim():"",n=typeof e.phone=="string"?e.phone.trim():"",a=typeof e.email=="string"?e.email.trim():"",s=typeof e.website=="string"?e.website.trim():"",l=typeof e.text=="string"?e.text.trim():"";return o||r||n||a||s||l?1:0}const t=Object.keys(e).filter(o=>o!=="__html");if(t.length)return countCrewEntries(t.map(o=>e[o]))}return 0}function countScheduleEntries(e){if(!e)return 0;if(Array.isArray(e))return e.reduce((t,o)=>t+countScheduleEntries(o),0);if(typeof e=="string")return e.split(/\r?\n+/).map(t=>t.trim()).filter(Boolean).length;if(isPlainObject(e)){if(Array.isArray(e.entries))return countScheduleEntries(e.entries);if(typeof e.text=="string")return countScheduleEntries(e.text);if(typeof e.label=="string"||typeof e.value=="string"){const o=typeof e.label=="string"?e.label.trim():"",r=typeof e.value=="string"?e.value.trim():"";return o||r?1:0}const t=Object.keys(e).filter(o=>o!=="__html");if(t.length)return countScheduleEntries(t.map(o=>e[o]))}return 0}function summarizeProjectInfoStats(e){if(typeof e=="string")try{const a=JSON.parse(e);if(isPlainObject(a))return summarizeProjectInfoStats(a)}catch{}if(!e||typeof e!="object"||Array.isArray(e)){const a=projectInfoValueHasData(e);return{details:a?1:0,crew:0,schedule:0,hasDetails:a}}let t=0,o=0,r=0,n=!1;return Object.entries(e).forEach(([a,s])=>{if(a!=="projectName"){if(projectInfoValueHasData(s)&&(t+=1,n=!0),a==="crew"||a==="people"){const l=countCrewEntries(s);l>0&&(o+=l,n=!0)}if(a==="prepDays"||a==="shootingDays"||a==="returnDays"){const l=countScheduleEntries(s);l>0&&(r+=l,n=!0)}}}),{details:t,crew:o,schedule:r,hasDetails:n}}function summarizeProjectCollection(e){const t={details:0,crew:0,schedule:0,hasProjectInfo:!1};return e&&(Array.isArray(e)?e:isPlainObject(e)?Object.values(e):[]).forEach(r=>{if(!r)return;let n=null;if(isPlainObject(r)&&Object.prototype.hasOwnProperty.call(r,"projectInfo")?n=r.projectInfo:isPlainObject(r)&&isPlainObject(r.project)&&Object.prototype.hasOwnProperty.call(r.project,"projectInfo")&&(n=r.project.projectInfo),!n)return;t.hasProjectInfo||(t.hasProjectInfo=!0);const a=summarizeProjectInfoStats(n);a.hasDetails&&(t.hasProjectInfo=!0),t.details+=a.details,t.crew+=a.crew,t.schedule+=a.schedule}),t}function summarizeCountsFromData(e){const t=createEmptyRestoreRehearsalCounts(),o=isPlainObject(e)&&isPlainObject(e.setups)?e.setups:{},r=isPlainObject(e)&&Array.isArray(e.autoGearRules)?e.autoGearRules:[],n=isPlainObject(e)&&isPlainObject(e.favorites)?e.favorites:{},a=isPlainObject(e)?summarizeProjectCollection(e.project):{details:0,crew:0,schedule:0},s=summarizeProjectCollection(o),l=Math.max(a.details,s.details),u=Math.max(a.crew,s.crew),d=Math.max(a.schedule,s.schedule);t.projects=countProjectsFromSetups(o),t.projectDetails=l,t.projectCrew=u,t.projectSchedules=d,t.rules=r.length,t.favorites=countFavoritesEntries(n),t.deviceLibrary=countRestoreRehearsalDeviceEntries(isPlainObject(e)?e.devices:null);const m=isPlainObject(e)?e.session:null;t.sessionSnapshots=isPlainObject(m)&&Object.keys(m).length?1:0,t.feedbackDrafts=countRestoreRehearsalFeedbackDrafts(isPlainObject(e)?e.feedback:null),t.autoGearPresets=Array.isArray(e?.autoGearPresets)?e.autoGearPresets.filter(Boolean).length:0,t.autoGearBackups=Array.isArray(e?.autoGearBackups)?e.autoGearBackups.filter(Boolean).length:0,t.fullBackupHistory=Array.isArray(e?.fullBackupHistory)?e.fullBackupHistory.filter(Boolean).length:0,t.customFonts=Array.isArray(e?.customFonts)?e.customFonts.filter(b=>b?typeof b=="string"?b.trim().length>0:isPlainObject(b)?Object.keys(b).length>0:!1:!1).length:0,t.customLogo=typeof e?.customLogo=="string"&&e.customLogo.trim()?1:0;const y=isPlainObject(e?.preferences)?e.preferences:null;t.storedPreferences=y&&Object.keys(y).length?1:0;const h=e?.schemaCache;return typeof h=="string"?t.schemaCache=h.trim()?1:0:isPlainObject(h)&&(t.schemaCache=Object.keys(h).length?1:0),t}function bundleHasProject(e){return isPlainObject(e)?!!(typeof e.setupName=="string"&&e.setupName.trim()||typeof e.projectHtml=="string"&&e.projectHtml.trim()||typeof e.gearList=="string"&&e.gearList.trim()||isPlainObject(e.projectInfo)&&Object.keys(e.projectInfo).length||isPlainObject(e.gearSelectors)&&Object.keys(e.gearSelectors).length||["camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap"].some(o=>typeof e[o]=="string"&&e[o].trim())||Array.isArray(e.motors)&&e.motors.some(Boolean)||Array.isArray(e.controllers)&&e.controllers.some(Boolean)):!1}const RESTORE_REHEARSAL_BACKUP_HINT_KEYS=["data","payload","plannerData","allData","devices","setups","session","sessions","sessionStorage","sessionState","customLogo","customFonts","preferences","schemaCache","fullBackupHistory"],RESTORE_REHEARSAL_METRICS=[{key:"projects",translationKey:"restoreRehearsalMetricProjects",fallback:"Projects",modes:["backup","project"]},{key:"projectDetails",translationKey:"restoreRehearsalMetricProjectDetails",fallback:"Project details",modes:["backup","project"]},{key:"projectCrew",translationKey:"restoreRehearsalMetricCrew",fallback:"Crew entries",modes:["backup","project"]},{key:"projectSchedules",translationKey:"restoreRehearsalMetricSchedule",fallback:"Schedule entries",modes:["backup","project"]},{key:"rules",translationKey:"restoreRehearsalMetricRules",fallback:"Rules",modes:["backup","project"]},{key:"favorites",translationKey:"restoreRehearsalMetricFavorites",fallback:"Favorites",modes:["backup","project"]},{key:"deviceLibrary",translationKey:"restoreRehearsalMetricDeviceLibrary",fallback:"Device library entries",modes:["backup"]},{key:"sessionSnapshots",translationKey:"restoreRehearsalMetricSession",fallback:"Stored session snapshot",modes:["backup"]},{key:"feedbackDrafts",translationKey:"restoreRehearsalMetricFeedback",fallback:"Feedback drafts",modes:["backup"]},{key:"autoGearPresets",translationKey:"restoreRehearsalMetricAutoPresets",fallback:"Automatic gear presets",modes:["backup"]},{key:"autoGearBackups",translationKey:"restoreRehearsalMetricAutoBackups",fallback:"Automatic gear backups",modes:["backup"]},{key:"fullBackupHistory",translationKey:"restoreRehearsalMetricBackupHistory",fallback:"Backup history entries",modes:["backup"]},{key:"customFonts",translationKey:"restoreRehearsalMetricCustomFonts",fallback:"Custom fonts",modes:["backup"]},{key:"customLogo",translationKey:"restoreRehearsalMetricCustomLogo",fallback:"Custom logo saved",modes:["backup"]},{key:"storedPreferences",translationKey:"restoreRehearsalMetricPreferences",fallback:"Stored preferences",modes:["backup"]},{key:"schemaCache",translationKey:"restoreRehearsalMetricSchemaCache",fallback:"Device schema cache",modes:["backup"]}],RESTORE_REHEARSAL_PROJECT_HINT_KEYS=["setupName","camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap","motors","controllers","project","projectInfo","projectHtml","gearList","gearSelectors","autoGearRules","favorites","feedback","changedDevices"];function hasAnyRestoreRehearsalKeys(e,t){if(!isPlainObject(e))return!1;for(let o=0;o<t.length;o+=1){const r=t[o];if(Object.prototype.hasOwnProperty.call(e,r))return!0}return!1}function looksLikeRestoreRehearsalProjectBundle(e){if(!isPlainObject(e))return!1;if(bundleHasProject(e)||hasAnyRestoreRehearsalKeys(e,RESTORE_REHEARSAL_PROJECT_HINT_KEYS))return!0;const t=isPlainObject(e.project)?e.project:null;return!!hasAnyRestoreRehearsalKeys(t,RESTORE_REHEARSAL_PROJECT_HINT_KEYS)}function looksLikeRestoreRehearsalBackupPayload(e){if(!isPlainObject(e))return!1;if(hasAnyRestoreRehearsalKeys(e,RESTORE_REHEARSAL_BACKUP_HINT_KEYS))return!0;const t=["data","payload","plannerData","allData"];for(let o=0;o<t.length;o+=1){const r=t[o];if(hasAnyRestoreRehearsalKeys(e[r],RESTORE_REHEARSAL_BACKUP_HINT_KEYS))return!0}return!1}function summarizeProjectBundle(e){const t=createEmptyRestoreRehearsalCounts();if(!isPlainObject(e))return t;const o=isPlainObject(e.favorites)?e.favorites:{};let r=null;isPlainObject(e.projectInfo)||typeof e.projectInfo=="string"?r=e.projectInfo:isPlainObject(e.project)&&(isPlainObject(e.project.projectInfo)||typeof e.project.projectInfo=="string")&&(r=e.project.projectInfo);const n=summarizeProjectInfoStats(r);return t.projects=bundleHasProject(e)?1:0,t.projectDetails=n.details,t.projectCrew=n.crew,t.projectSchedules=n.schedule,t.rules=Array.isArray(e.autoGearRules)?e.autoGearRules.length:0,t.favorites=countFavoritesEntries(o),t}function getSelectedRestoreRehearsalMode(){if(!Array.isArray(restoreRehearsalModeInputs)||!restoreRehearsalModeInputs.length)return"backup";const e=restoreRehearsalModeInputs.find(t=>t&&t.checked);return e&&typeof e.value=="string"?e.value:"backup"}function buildRestoreRehearsalRows(e,t,o={}){const r=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",n=texts[r]||texts.en||{},a=typeof o.mode=="string"?o.mode:"backup";return RESTORE_REHEARSAL_METRICS.filter(l=>l.modes.includes(a)).map(l=>({key:l.key,label:n[l.translationKey]||l.fallback})).map(l=>{const u=typeof e[l.key]=="number"?e[l.key]:0,d=typeof t[l.key]=="number"?t[l.key]:0;return{key:l.key,label:l.label,live:u,sandbox:d,diff:d-u}})}function normalizeRestoreRehearsalScenarioLogic(e){if(typeof e!="string")return"all";const t=e.trim().toLowerCase();return t?t==="any"||t==="or"?"any":t==="multiplier"||t==="multiply"?"multiplier":"all":"all"}function normalizeRestoreRehearsalScenarioMultiplier(e){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const t=e.trim();if(t){const o=Number(t);if(Number.isFinite(o))return o}}return 1}function normalizeRestoreRehearsalRuleItems(e){if(!Array.isArray(e))return[];const t=e.map(o=>{if(!isPlainObject(o))return null;const r=typeof o.name=="string"?o.name.trim():"";if(!r)return null;const n=typeof o.category=="string"?o.category.trim():"";let a=1;if(typeof o.quantity=="number"&&Number.isFinite(o.quantity))a=o.quantity;else if(typeof o.quantity=="string"){const v=o.quantity.trim();if(v){const C=Number(v);Number.isFinite(C)&&(a=C)}}const s=typeof o.notes=="string"?o.notes.trim():"",l=typeof o.screenSize=="string"?o.screenSize.trim():"",u=typeof o.selectorType=="string"?o.selectorType.trim():"",d=typeof o.selectorDefault=="string"?o.selectorDefault.trim():"",m=!!o.selectorEnabled,y=Array.isArray(o.contextNotes)?o.contextNotes.map(v=>typeof v=="string"?v.trim():"").filter(Boolean):[];y.sort((v,C)=>v.localeCompare(C));const h={id:typeof o.id=="string"?o.id:"",name:r,category:n,quantity:a,notes:s,screenSize:l,selectorType:u,selectorDefault:d,selectorEnabled:m,contextNotes:y},b={name:r,category:n,quantity:a,notes:s,screenSize:l,selectorType:u,selectorDefault:d,selectorEnabled:m,contextNotes:y};return h.signature=JSON.stringify(b),h}).filter(Boolean);return t.sort((o,r)=>{const n=o.category||"",a=r.category||"";return n!==a?n.localeCompare(a):o.name.localeCompare(r.name)}),t}function formatRestoreRehearsalRuleItem(e){if(!e)return"";const t=e.quantity,r=t!=null&&t!==1?` ×${formatNumberForComparison(t)}`:"",n=e.category?` (${e.category})`:"",a=e.notes?` — ${e.notes}`:"",s=Array.isArray(e.contextNotes)&&e.contextNotes.length?` (${e.contextNotes.join(", ")})`:"",l=e.screenSize?` [${e.screenSize}]`:"",u=[];e.selectorType&&e.selectorType!=="none"&&u.push(e.selectorType),e.selectorDefault&&u.push(e.selectorDefault);const d=u.length?` {${u.join(": ")}}`:"";return`${e.name}${n}${r}${a}${s}${l}${d}`}function normalizeRestoreRehearsalRule(e,t,o){if(!isPlainObject(e))return null;const r={id:typeof e.id=="string"?e.id:"",label:typeof e.label=="string"?e.label.trim():"",always:!!e.always};r.scenarioLogic=normalizeRestoreRehearsalScenarioLogic(e.scenarioLogic),r.scenarioMultiplier=normalizeRestoreRehearsalScenarioMultiplier(e.scenarioMultiplier),r.scenarioLogic!=="multiplier"&&(r.scenarioMultiplier=1),r.scenarioPrimary=typeof e.scenarioPrimary=="string"?e.scenarioPrimary.trim():"";const n=Array.isArray(e.scenarios)?e.scenarios.map(m=>typeof m=="string"?m.trim():"").filter(Boolean):[],a=new Set(n);r.scenarios=Array.from(a).sort((m,y)=>m.localeCompare(y)),r.addItems=normalizeRestoreRehearsalRuleItems(e.add),r.removeItems=normalizeRestoreRehearsalRuleItems(e.remove);const s=r.addItems.map(m=>m.signature).sort(),l=r.removeItems.map(m=>m.signature).sort();r.signature=JSON.stringify({always:r.always,scenarioLogic:r.scenarioLogic,scenarioPrimary:r.scenarioPrimary,scenarioMultiplier:r.scenarioMultiplier,scenarios:r.scenarios,add:s,remove:l});const d=[r.label.toLowerCase(),r.scenarios.join("|").toLowerCase(),r.addItems.map(m=>m.name.toLowerCase()).join("|"),r.removeItems.map(m=>m.name.toLowerCase()).join("|")].filter(Boolean).join("::");return r.matchKey=r.id?`id:${r.id}`:d?`fallback:${d}`:`index:${o}:${t}`,r.entryKey=`${r.matchKey}|${o}|${t}`,r.label?r.displayName=r.label:r.scenarios.length?r.displayName=r.scenarios.join(" + "):r.id?r.displayName=r.id:r.displayName=`Rule ${t+1}`,r}function normalizeRestoreRehearsalRules(e,t="sandbox"){return Array.isArray(e)?e.map((o,r)=>normalizeRestoreRehearsalRule(o,r,t)).filter(Boolean):[]}function indexRestoreRehearsalRules(e){const t=new Map;return Array.isArray(e)&&e.forEach(o=>{if(!o||!o.matchKey)return;const r=t.get(o.matchKey);r?r.push(o):t.set(o.matchKey,[o])}),t}function buildRestoreRehearsalRuleDiff(e,t){const o=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[],n=indexRestoreRehearsalRules(o),a=new Set(o.filter(Boolean)),s=[];r.forEach(d=>{if(!d)return;let m=null;const y=d.matchKey?n.get(d.matchKey):null;y&&y.length&&(m=y.shift(),y.length||n.delete(d.matchKey)),m?(a.delete(m),m.signature!==d.signature&&s.push({status:"changed",label:d.displayName||m.displayName,live:m,sandbox:d,key:`changed:${d.entryKey}`})):s.push({status:"added",label:d.displayName,live:null,sandbox:d,key:`added:${d.entryKey}`})}),a.forEach(d=>{d&&s.push({status:"removed",label:d.displayName,live:d,sandbox:null,key:`removed:${d.entryKey}`})});const l=typeof localeSort=="function"?(d,m)=>localeSort(d,m):(d,m)=>d.localeCompare(m),u={changed:0,removed:1,added:2};return s.sort((d,m)=>{const y=u[d.status]??Number.MAX_SAFE_INTEGER,h=u[m.status]??Number.MAX_SAFE_INTEGER;return y!==h?y-h:l(d.label||"",m.label||"")})}function formatRestoreRehearsalRuleScenarioLines(e,t){if(!e)return[];const o=texts.en||{},r=t.restoreRehearsalRuleLogicLabel||o.restoreRehearsalRuleLogicLabel||"Scenario logic",n=t.restoreRehearsalRuleBaseLabel||o.restoreRehearsalRuleBaseLabel||"Base scenario",a=t.restoreRehearsalRuleMultiplierLabel||o.restoreRehearsalRuleMultiplierLabel||"Multiplier",s=t.restoreRehearsalRuleRequiredLabel||texts[currentLang]?.projectFields?.requiredScenarios||o.projectFields?.requiredScenarios||"Required scenarios",l=t.restoreRehearsalRuleAlwaysLabel||o.restoreRehearsalRuleAlwaysLabel||"Always active",u=t.restoreRehearsalRuleNone||o.restoreRehearsalRuleNone||"None";let d=o.autoGearScenarioModeAll||"Require every selected scenario";e.scenarioLogic==="any"?d=texts[currentLang]?.autoGearScenarioModeAny||o.autoGearScenarioModeAny||"Match any selected scenario":e.scenarioLogic==="multiplier"?d=texts[currentLang]?.autoGearScenarioModeMultiplier||o.autoGearScenarioModeMultiplier||"Multiply when combined":d=texts[currentLang]?.autoGearScenarioModeAll||o.autoGearScenarioModeAll||"Require every selected scenario";const m=[`${r}: ${d}`];return e.scenarioPrimary&&m.push(`${n}: ${e.scenarioPrimary}`),e.scenarioLogic==="multiplier"&&e.scenarioMultiplier!==1&&m.push(`${a}: ×${formatNumberForComparison(e.scenarioMultiplier)}`),e.scenarios&&e.scenarios.length?m.push(`${s}: ${e.scenarios.join(" + ")}`):m.push(`${s}: ${u}`),e.always&&m.push(l),m}function createRestoreRehearsalRuleList(e,t){const o=document.createElement("ul");o.className="restore-rehearsal-rule-list";const r=Array.isArray(e)?e.filter(n=>typeof n=="string"&&n.trim()):[];if(!r.length){const n=document.createElement("li");return n.textContent=t,o.appendChild(n),o}return r.forEach(n=>{const a=document.createElement("li");a.textContent=n,o.appendChild(a)}),o}function createRestoreRehearsalRuleSection(e,t,o){const r=document.createElement("div");r.className="restore-rehearsal-rule-section";const n=document.createElement("span");return n.className="restore-rehearsal-rule-section-label",n.textContent=e,r.appendChild(n),r.appendChild(createRestoreRehearsalRuleList(t,o)),r}function createRestoreRehearsalRuleColumn(e,t,o,r,n){const a=document.createElement("div");a.className="restore-rehearsal-rule-column",o&&a.classList.add(`restore-rehearsal-rule-column--${o}`);const s=document.createElement("div");s.className="restore-rehearsal-rule-column-title",s.textContent=e,a.appendChild(s);const l=t?t.addItems.map(m=>formatRestoreRehearsalRuleItem(m)).filter(Boolean):[];a.appendChild(createRestoreRehearsalRuleSection(r.restoreRehearsalRuleAddsLabel||texts.en?.restoreRehearsalRuleAddsLabel||"Automatic additions",l,n));const u=t?t.removeItems.map(m=>formatRestoreRehearsalRuleItem(m)).filter(Boolean):[];a.appendChild(createRestoreRehearsalRuleSection(r.restoreRehearsalRuleRemovesLabel||texts.en?.restoreRehearsalRuleRemovesLabel||"Automatic removals",u,n));const d=formatRestoreRehearsalRuleScenarioLines(t,r);return a.appendChild(createRestoreRehearsalRuleSection(r.restoreRehearsalRuleScenariosLabel||texts.en?.restoreRehearsalRuleScenariosLabel||"Scenario scope",d,n)),a}function renderRestoreRehearsalRuleDiff(e){if(!restoreRehearsalRuleSectionEl||!restoreRehearsalRuleListEl||!restoreRehearsalRuleEmptyEl)return;const t=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",o=texts[t]||texts.en||{};if(restoreRehearsalRuleListEl.innerHTML="",!(Array.isArray(e)&&e.length>0)){restoreRehearsalRuleEmptyEl&&(restoreRehearsalRuleEmptyEl.textContent=o.restoreRehearsalRuleEmpty||texts.en?.restoreRehearsalRuleEmpty||"No automatic gear rule differences found.",restoreRehearsalRuleEmptyEl.removeAttribute("hidden")),restoreRehearsalRuleSectionEl.removeAttribute("hidden"),restoreRehearsalActionsEl&&restoreRehearsalActionsEl.removeAttribute("hidden");return}restoreRehearsalRuleEmptyEl.setAttribute("hidden","");const n=o.restoreRehearsalLiveColumn||texts.en?.restoreRehearsalLiveColumn||"Live profile",a=o.restoreRehearsalSandboxColumn||texts.en?.restoreRehearsalSandboxColumn||"Sandbox import",s=o.restoreRehearsalRuleNone||texts.en?.restoreRehearsalRuleNone||"None";e.forEach(l=>{if(!l)return;const u=document.createElement("li"),d=l.status?` diff-${l.status}`:"";u.className=`diff-entry${d}`;const m=document.createElement("div");m.className="diff-entry-header";const y=document.createElement("div");y.className="diff-path";const h=l.label||l.sandbox?.displayName||l.live?.displayName||o.restoreRehearsalRuleFallback||texts.en?.restoreRehearsalRuleFallback||"Automatic rule change";y.textContent=h,m.appendChild(y),m.appendChild(createDiffStatusBadge(l.status||"changed")),u.appendChild(m);const b=document.createElement("div");if(b.className="restore-rehearsal-rule-columns",l.status==="changed"&&b.classList.add("restore-rehearsal-rule-columns--split"),l.live){const v=l.status==="added"?null:"removed";b.appendChild(createRestoreRehearsalRuleColumn(n,l.live,v,o,s))}if(l.sandbox){const v=l.status==="removed"?null:"added";b.appendChild(createRestoreRehearsalRuleColumn(a,l.sandbox,v,o,s))}u.appendChild(b),restoreRehearsalRuleListEl.appendChild(u)}),restoreRehearsalRuleSectionEl.removeAttribute("hidden"),restoreRehearsalActionsEl&&restoreRehearsalActionsEl.removeAttribute("hidden")}function getRestoreRehearsalLiveSnapshot(){const e=typeof exportAllData=="function"?exportAllData():{},t=isPlainObject(e)?e:{};return{counts:summarizeCountsFromData(t),rules:normalizeRestoreRehearsalRules(t.autoGearRules,"live")}}function resetRestoreRehearsalState(e={}){const{keepStatus:t=!1}=e||{};if(restoreRehearsalFileNameEl){const o=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",r=texts.en?.restoreRehearsalNoFile||"No file selected yet.",n=texts[o]?.restoreRehearsalNoFile||r;restoreRehearsalFileNameEl.textContent=n}if(!t&&restoreRehearsalStatusEl){const o=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",r=texts.en?.restoreRehearsalReady||"";restoreRehearsalStatusEl.textContent=texts[o]?.restoreRehearsalReady||r}if(restoreRehearsalTableEl&&restoreRehearsalTableEl.setAttribute("hidden",""),restoreRehearsalTableBodyEl)for(;restoreRehearsalTableBodyEl.firstChild;)restoreRehearsalTableBodyEl.removeChild(restoreRehearsalTableBodyEl.firstChild);restoreRehearsalRuleSectionEl&&restoreRehearsalRuleSectionEl.setAttribute("hidden",""),restoreRehearsalRuleListEl&&(restoreRehearsalRuleListEl.innerHTML=""),restoreRehearsalRuleEmptyEl&&restoreRehearsalRuleEmptyEl.setAttribute("hidden",""),restoreRehearsalActionsEl&&restoreRehearsalActionsEl.setAttribute("hidden",""),restoreRehearsalLastSnapshot=null,restoreRehearsalInputEl&&(restoreRehearsalInputEl.value="")}function openRestoreRehearsal(){restoreRehearsalSectionEl&&(restoreRehearsalSectionEl.removeAttribute("hidden"),resetRestoreRehearsalState(),restoreRehearsalHeadingEl&&typeof restoreRehearsalHeadingEl.focus=="function"&&restoreRehearsalHeadingEl.focus({preventScroll:!0}))}function closeRestoreRehearsal(){resetRestoreRehearsalState(),restoreRehearsalSectionEl&&restoreRehearsalSectionEl.setAttribute("hidden","")}function readFileAsText(e){return e?typeof e.text=="function"?Promise.resolve().then(()=>e.text()):new Promise((t,o)=>{if(typeof FileReader!="function"){o(new Error("No supported file reader available"));return}const r=new FileReader;r.onload=()=>t(r.result),r.onerror=()=>o(r.error||new Error("Failed to read file"));try{r.readAsText(e)}catch(n){o(n)}}):Promise.reject(new Error("No file provided"))}function formatRestoreRehearsalSummary(e){const t=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",o=texts[t]||texts.en||{},r=o.restoreRehearsalDifferenceListJoin||", ",n=e.filter(s=>s.diff!==0).map(s=>`${s.label} (${s.diff>0?"+":"−"}${Math.abs(s.diff)})`);return n.length?(o.restoreRehearsalMismatch||texts.en?.restoreRehearsalMismatch||"Differences detected: %s. The sandbox was cleared automatically.").replace("%s",n.join(r)):o.restoreRehearsalMatch||texts.en?.restoreRehearsalMatch||"All counts match. The sandbox was cleared automatically."}function applyRestoreRehearsalDifferenceCell(e,t,o){if(!e)return;const r=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",n=texts[r]||texts.en||{};if(e.textContent="",e.classList.remove("restore-rehearsal-diff-match","restore-rehearsal-diff-positive","restore-rehearsal-diff-negative"),o===0){const u=n.restoreRehearsalMatchLabel||texts.en?.restoreRehearsalMatchLabel||"Match";e.textContent=u,e.classList.add("restore-rehearsal-diff-match"),e.setAttribute("aria-label",`${t} ${u}`);return}const a=Math.abs(o),s=o>0?n.restoreRehearsalIncreaseLabel||texts.en?.restoreRehearsalIncreaseLabel||"Sandbox includes %d more %s.":n.restoreRehearsalDecreaseLabel||texts.en?.restoreRehearsalDecreaseLabel||"Sandbox includes %d fewer %s.",l=`${o>0?"+":"−"}${a}`;e.textContent=l,e.setAttribute("aria-label",s.replace("%d",a).replace("%s",t)),e.classList.add(o>0?"restore-rehearsal-diff-positive":"restore-rehearsal-diff-negative")}function renderRestoreRehearsalResults(e,t){if(!(!restoreRehearsalTableBodyEl||!restoreRehearsalStatusEl)){for(;restoreRehearsalTableBodyEl.firstChild;)restoreRehearsalTableBodyEl.removeChild(restoreRehearsalTableBodyEl.firstChild);e.forEach(o=>{const r=document.createElement("tr"),n=document.createElement("th");n.scope="row",n.textContent=o.label,r.appendChild(n);const a=document.createElement("td");a.textContent=String(o.live),r.appendChild(a);const s=document.createElement("td");s.textContent=String(o.sandbox),r.appendChild(s);const l=document.createElement("td");applyRestoreRehearsalDifferenceCell(l,o.label,o.diff),r.appendChild(l),restoreRehearsalTableBodyEl.appendChild(r)}),restoreRehearsalTableEl&&restoreRehearsalTableEl.removeAttribute("hidden"),restoreRehearsalStatusEl.textContent=formatRestoreRehearsalSummary(e),renderRestoreRehearsalRuleDiff(Array.isArray(t)?t:[])}}function countRestoreRehearsalDeviceEntries(e){if(typeof countDeviceDatabaseEntries=="function")try{const n=countDeviceDatabaseEntries(e);if(typeof n=="number"&&Number.isFinite(n))return n}catch(n){console.warn("Primary device counting failed during restore rehearsal",n)}const t=new Set(["filterOptions","None"]),o=n=>isPlainObject(n)?Object.values(n).some(a=>a===null||typeof a!="object"||Array.isArray(a)):!1,r=n=>{if(!isPlainObject(n))return 0;let a=0;return Object.entries(n).forEach(([s,l])=>{if(!(!s||t.has(s))){if(o(l)){a+=1;return}a+=r(l)}}),a};return r(e)}function countRestoreRehearsalFeedbackDrafts(e){return isPlainObject(e)?Object.values(e).reduce((t,o)=>o?Array.isArray(o)?t+o.filter(Boolean).length:typeof o=="string"?o.trim()?t+1:t:isPlainObject(o)?Object.keys(o).length?t+1:t:t+1:t,0):0}function runRestoreRehearsal(e){if(!e)return;const t=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",o=texts[t]||texts.en||{};if(restoreRehearsalStatusEl){const r=o.restoreRehearsalProcessing||texts.en?.restoreRehearsalProcessing||"Loading file in an isolated sandbox…";restoreRehearsalStatusEl.textContent=r}readFileAsText(e).then(r=>{const n=getSelectedRestoreRehearsalMode();let a,s=[];if(n==="project"){const h=sanitizeBackupPayload(r);if(!h||!h.trim()){const v=new Error("Restore rehearsal received an empty project bundle.");throw v.code="restore-rehearsal-project-mismatch",v}const b=JSON.parse(h);if(!looksLikeRestoreRehearsalProjectBundle(b)){const v=new Error("Restore rehearsal received an unrecognized project bundle.");throw v.code="restore-rehearsal-project-mismatch",v}a=summarizeProjectBundle(b),s=normalizeRestoreRehearsalRules(b.autoGearRules,"sandbox")}else{const h=sanitizeBackupPayload(r);if(!h||!h.trim())throw new Error("Backup payload empty");const b=JSON.parse(h);if(!looksLikeRestoreRehearsalBackupPayload(b)){const A=new Error("Restore rehearsal received an unrecognized backup payload.");throw A.code="restore-rehearsal-backup-mismatch",A}const{data:v}=extractBackupSections(b),C=isPlainObject(v)?v:{};a=summarizeCountsFromData(C),s=normalizeRestoreRehearsalRules(C.autoGearRules,"sandbox")}const l=getRestoreRehearsalLiveSnapshot(),u=l&&isPlainObject(l.counts)?l.counts:{},d=l&&Array.isArray(l.rules)?l.rules:[],m=buildRestoreRehearsalRows(u,a,{mode:n}),y=buildRestoreRehearsalRuleDiff(d,s);renderRestoreRehearsalResults(m,y),restoreRehearsalLastSnapshot={fileName:typeof e.name=="string"?e.name:"",mode:n,processedAt:Date.now(),live:{counts:u,rules:d},sandbox:{counts:a,rules:s},diff:y},restoreRehearsalInputEl&&(restoreRehearsalInputEl.value="")}).catch(r=>{if(console.warn("Restore rehearsal failed",r),restoreRehearsalLastSnapshot=null,restoreRehearsalStatusEl){let n;r&&r.code==="restore-rehearsal-project-mismatch"?n=o.restoreRehearsalProjectMismatch||texts.en?.restoreRehearsalProjectMismatch:r&&r.code==="restore-rehearsal-backup-mismatch"&&(n=o.restoreRehearsalBackupMismatch||texts.en?.restoreRehearsalBackupMismatch),n||(n=o.restoreRehearsalError||texts.en?.restoreRehearsalError||"Restore rehearsal failed. Check the file and try again."),restoreRehearsalStatusEl.textContent=n}restoreRehearsalTableEl&&restoreRehearsalTableEl.setAttribute("hidden",""),restoreRehearsalRuleSectionEl&&restoreRehearsalRuleSectionEl.setAttribute("hidden",""),restoreRehearsalActionsEl&&restoreRehearsalActionsEl.setAttribute("hidden","")}).finally(()=>{if(restoreRehearsalInputEl)try{restoreRehearsalInputEl.value=""}catch{}})}function handleRestoreRehearsalProceed(){const e=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",t=texts[e]||texts.en||{};if(!restoreRehearsalLastSnapshot){if(restoreRehearsalStatusEl){const r=t.restoreRehearsalReady||texts.en?.restoreRehearsalReady||"";restoreRehearsalStatusEl.textContent=r}return}const o=t.restoreRehearsalProceedMessage||texts.en?.restoreRehearsalProceedMessage||"Sandbox snapshot staged. Live data remains untouched until you perform a full restore.";if(restoreRehearsalStatusEl&&(restoreRehearsalStatusEl.textContent=o),typeof document<"u"&&typeof document.dispatchEvent=="function")try{document.dispatchEvent(new CustomEvent("restoreRehearsalProceed",{detail:{fileName:restoreRehearsalLastSnapshot.fileName,mode:restoreRehearsalLastSnapshot.mode,processedAt:restoreRehearsalLastSnapshot.processedAt,sandboxCounts:restoreRehearsalLastSnapshot.sandbox?.counts||{},ruleChanges:Array.isArray(restoreRehearsalLastSnapshot.diff)?restoreRehearsalLastSnapshot.diff.length:0}}))}catch(r){console.warn("Restore rehearsal proceed notification failed",r)}}function handleRestoreRehearsalAbort(){const e=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",o=(texts[e]||texts.en||{}).restoreRehearsalAbortMessage||texts.en?.restoreRehearsalAbortMessage||"Rehearsal sandbox cleared. Live data remains untouched.";restoreRehearsalLastSnapshot=null,resetRestoreRehearsalState({keepStatus:!0}),restoreRehearsalStatusEl&&(restoreRehearsalStatusEl.textContent=o)}function saveCurrentSession$1(e={}){if(restoringSession||factoryResetInProgress$1||typeof window<"u"&&window.cineSuppressAutosave||typeof isProjectPersistenceSuspended=="function"&&isProjectPersistenceSuspended())return;const t=projectForm$1?collectProjectFormData():{};t.sliderBowl=getSessionCoreValue("getSliderBowlValue"),t.easyrig=getSessionCoreValue("getEasyrigValue"),currentProjectInfo$1=deriveSessionProjectInfo(t);const o=batterySelect?batterySelect.value:"",r=batteryPlateSelect$1?batteryPlateSelect$1.value:"",n={setupName:setupNameInput$1?setupNameInput$1.value:"",setupSelect:setupSelect$1?setupSelect$1.value:"",camera:cameraSelect$1?cameraSelect$1.value:"",monitor:monitorSelect$1?monitorSelect$1.value:"",video:videoSelect?videoSelect.value:"",cage:cageSelect?cageSelect.value:"",motors:(typeof window<"u"&&window.motorSelects?window.motorSelects:[]).map(a=>a?a.value:""),controllers:(typeof window<"u"&&window.controllerSelects?window.controllerSelects:[]).map(a=>a?a.value:""),distance:distanceSelect?distanceSelect.value:"",batteryPlate:typeof normalizeBatteryPlateValue=="function"?normalizeBatteryPlateValue(r,o):r,battery:o,batteryHotswap:hotswapSelect$1?hotswapSelect$1.value:"",sliderBowl:t.sliderBowl,easyrig:t.easyrig,projectInfo:currentProjectInfo$1,autoGearHighlight:typeof isAutoGearHighlightEnabled=="function"?!!isAutoGearHighlightEnabled():!1};if(typeof getDiagramManualPositions=="function"){const a=getDiagramManualPositions();a&&Object.keys(a).length&&(n.diagramPositions=a)}storeSession(n),e.skipGearList||saveCurrentGearList$1()}function autoSaveCurrentSetup$1(){if(console.log("DEBUG: autoSaveCurrentSetup ENTERED"),factoryResetInProgress$1)return;const e=typeof setupNameInput$1<"u"?setupNameInput$1:document.getElementById("setupName");if(!e)return;const t=e.value.trim();if(!t)return saveCurrentSession$1({skipGearList:!1}),checkSetupChanged$1(),!1;const o=typeof setupSelect$1<"u"?setupSelect$1:document.getElementById("setupSelect"),r=o?o.value:"";if(!r||t!==r)return saveCurrentSession$1({skipGearList:!1}),checkSetupChanged$1(),!1;const n=typeof getSetups=="function"?getSetups():{};if(!n||typeof n!="object"||!Object.prototype.hasOwnProperty.call(n,t))return saveCurrentSession$1({skipGearList:!1}),checkSetupChanged$1(),!1;const a=n&&typeof n=="object"?n[t]:void 0,s=a?stableStringify(a):"",l={...getCurrentSetupState()},u=getCurrentGearListHtml();if(u&&(l.gearList=u),typeof getDiagramManualPositions=="function"){const y=getDiagramManualPositions();y&&Object.keys(y).length?l.diagramPositions=y:Object.prototype.hasOwnProperty.call(l,"diagramPositions")&&delete l.diagramPositions}const d=!a||s==="";n[t]=l,console.log("DEBUG: calling storeSetups"),storeSetups(n),d&&(console.log("DEBUG: calling populateSetupSelect"),typeof populateSetupSelect=="function"&&populateSetupSelect(),console.log("DEBUG: populateSetupSelect returned")),o&&(o.value=t),saveCurrentSession$1(),typeof storeLoadedSetupState=="function"&&storeLoadedSetupState(getCurrentSetupState()),checkSetupChanged$1();const m=stableStringify(l);return s!==m}const PROJECT_AUTOSAVE_BASE_DELAY_MS=300,PROJECT_AUTOSAVE_RETRY_DELAY_MS=900,PROJECT_AUTOSAVE_RETRY_CAP_MS=5e3,PROJECT_AUTOSAVE_MAX_RETRIES=4;let projectAutoSaveTimer=null,projectAutoSaveFailureCount=0,projectAutoSavePendingWhileRestoring=null,factoryResetInProgress$1=!1;typeof window<"u"&&Object.defineProperty(window,"factoryResetInProgress",{get:()=>factoryResetInProgress$1,set:e=>{factoryResetInProgress$1=e},configurable:!0});let projectAutoSaveLastRequestContext=null;function notifyAutoBackupChange(e){try{const t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:null,o=t&&typeof t.__cineNoteAutoBackupChange=="function"?t.__cineNoteAutoBackupChange:null;o&&o(e||{})}catch(t){console.warn("Failed to record auto backup change context",t)}}function setProjectAutoSaveOverrides(e){if(!e||typeof e!="object")return;const t={};if(e.setupNameState&&typeof e.setupNameState=="object"){const o=e.setupNameState,r=typeof o.typedName=="string"?o.typedName:"",n=typeof o.selectedName=="string"?o.selectedName:"",a=typeof o.storageKey=="string"?o.storageKey:"",s=typeof o.renameInProgress=="boolean"?o.renameInProgress:!!(n&&r&&r!==n),l=!!(r&&o&&typeof o.typedNameHasTrailingWhitespace=="boolean"&&o.typedNameHasTrailingWhitespace);t.setupNameState={typedName:r,selectedName:n,storageKey:a,renameInProgress:s,typedNameHasTrailingWhitespace:l}}t.setupNameState}function clearProjectAutoSaveOverrides(){}function getProjectAutoSaveDelay(){if(projectAutoSaveFailureCount<=0)return PROJECT_AUTOSAVE_BASE_DELAY_MS;const e=PROJECT_AUTOSAVE_BASE_DELAY_MS+PROJECT_AUTOSAVE_RETRY_DELAY_MS*(projectAutoSaveFailureCount-1);return Math.min(e,PROJECT_AUTOSAVE_RETRY_CAP_MS)}function runProjectAutoSave(){console.log("DEBUG: runProjectAutoSave ENTERED"),isProjectAutoSaving=!0;try{if(factoryResetInProgress$1){projectAutoSaveTimer&&(clearTimeout(projectAutoSaveTimer),projectAutoSaveTimer=null);return}if(restoringSession){projectAutoSaveTimer=null,projectAutoSavePendingWhileRestoring!=="immediate"&&(projectAutoSavePendingWhileRestoring=projectAutoSavePendingWhileRestoring||"queued");return}projectAutoSaveTimer=null,projectAutoSavePendingWhileRestoring=null;const e=projectAutoSaveLastRequestContext;projectAutoSaveLastRequestContext=null;let t=!1;const o=(l,u,d)=>{if(typeof l!="function")return{ok:!0,result:void 0};try{const m=l();if(typeof d=="function")try{d(m)}catch(y){console.warn("Auto backup mutation observer callback failed",y)}return{ok:!0,result:m}}catch(m){return t=!0,console.error(`Project autosave failed while ${u}.`,m),{ok:!1,result:void 0}}};let r=!1,n=!1;if(setupNameInput$1&&typeof setupNameInput$1.value=="string"&&setupNameInput$1.value.trim()||o(()=>saveCurrentSession$1(),"saving the current session state"),o(autoSaveCurrentSetup$1,"saving the current setup",l=>{l===!0&&(r=!0)}).ok||o(()=>saveCurrentSession$1({skipGearList:!0}),"saving the current session state as a fallback"),o(saveCurrentGearList$1,"saving the gear list",l=>{l===!0&&(n=!0)}),t){projectAutoSaveFailureCount<PROJECT_AUTOSAVE_MAX_RETRIES?(projectAutoSaveFailureCount+=1,scheduleProjectAutoSave$1()):projectAutoSaveFailureCount===PROJECT_AUTOSAVE_MAX_RETRIES&&console.warn("Project autosave retries have been paused after repeated failures.");return}if(projectAutoSaveFailureCount=0,!t&&(r||n)){const l=Date.now(),u=e&&typeof e.requestedAt=="number"&&Number.isFinite(e.requestedAt)?e.requestedAt:l;notifyAutoBackupChange({commit:!0,context:{immediate:!!(e&&e.immediate),overrides:!!(e&&e.overrides),requestedAt:u,completedAt:l}})}}finally{isProjectAutoSaving=!1}}function scheduleProjectAutoSave$1(e=!1){if(isProjectAutoSaving||typeof window<"u"&&window.cineSuppressAutosave)return;let t=!1,o;typeof e=="object"&&e!==null?(t=!!e.immediate,o=e.overrides):(t=!!e,o=void 0);const r=o!==void 0;if(r&&setProjectAutoSaveOverrides(o),factoryResetInProgress$1){projectAutoSaveTimer&&(clearTimeout(projectAutoSaveTimer),projectAutoSaveTimer=null);return}if(restoringSession){projectAutoSaveTimer&&(clearTimeout(projectAutoSaveTimer),projectAutoSaveTimer=null),projectAutoSavePendingWhileRestoring!=="immediate"&&(projectAutoSavePendingWhileRestoring=t?"immediate":"queued");return}projectAutoSavePendingWhileRestoring=null;const n=Date.now();if(projectAutoSaveLastRequestContext={immediate:t,overrides:r,requestedAt:n},notifyAutoBackupChange({immediate:t,overrides:r,pending:!0}),t){projectAutoSaveTimer&&(clearTimeout(projectAutoSaveTimer),projectAutoSaveTimer=null),console.log("DEBUG: scheduleProjectAutoSave calling runProjectAutoSave"),runProjectAutoSave(),console.log("DEBUG: scheduleProjectAutoSave executed runProjectAutoSave");return}projectAutoSaveTimer&&clearTimeout(projectAutoSaveTimer);const a=getProjectAutoSaveDelay();projectAutoSaveTimer=setTimeout(runProjectAutoSave,a),projectAutoSaveTimer&&typeof projectAutoSaveTimer=="object"&&typeof projectAutoSaveTimer.unref=="function"&&projectAutoSaveTimer.unref()}var projectFormRefSession=typeof projectForm$1<"u"&&projectForm$1?projectForm$1:typeof document<"u"?document.getElementById("projectForm"):null;if(projectFormRefSession){const e=(a,s)=>{const l=m=>{if(!m||typeof m!="object")return null;if(typeof m.closest=="function")return m.closest("select");let y=m.parentElement;for(;y&&y.tagName!=="SELECT";)y=y.parentElement;return y&&y.tagName==="SELECT"?y:null},u=m=>m&&typeof m=="object"&&m.tagName==="OPTION"&&l(m)===s;if(u(a.target))return a.target;if(typeof a.composedPath=="function"){const m=a.composedPath().find(u);if(m)return m}if(a.target&&typeof a.target.closest=="function"){const m=a.target.closest("option");if(u(m))return m}const d=a.type&&a.type.startsWith("touch")&&a.touches&&a.touches[0]?{x:a.touches[0].clientX,y:a.touches[0].clientY}:typeof a.clientX=="number"&&typeof a.clientY=="number"?{x:a.clientX,y:a.clientY}:null;if(d&&typeof document<"u"&&typeof document.elementFromPoint=="function"){const m=document.elementFromPoint(d.x,d.y);if(u(m))return m;if(m&&typeof m.closest=="function"){const y=m.closest("option");if(u(y))return y}}return null},t=a=>{if(!a)return;const s=u=>{if(typeof u.button=="number"&&u.button!==0)return;const d=e(u,a);if(!d||d.disabled)return;u.preventDefault();const m=a.scrollTop,y=!d.selected;d.selected=y,y?d.setAttribute("selected",""):d.removeAttribute("selected");const h=new Event("change",{bubbles:!0});if(a.dispatchEvent(h),typeof a.focus=="function")try{a.focus({preventScroll:!0})}catch{a.focus()}a.scrollTop=m};typeof window<"u"&&typeof window.PointerEvent=="function"?a.addEventListener("pointerdown",s):(a.addEventListener("mousedown",s),a.addEventListener("touchstart",u=>{s(u)},{passive:!1})),a.addEventListener("dblclick",u=>{u.preventDefault()})};projectFormRefSession.querySelectorAll("select[multiple]").forEach(a=>{t(a)});const o=a=>{if(!a)return;const s=typeof updateSelectIconBoxes=="function"?updateSelectIconBoxes:null,l=typeof globalThis<"u"&&globalThis&&typeof globalThis.updateSelectIconBoxes=="function"?globalThis.updateSelectIconBoxes:null,u=s||l;if(typeof u=="function")try{u(a)}catch(d){typeof console<"u"&&typeof console.warn=="function"&&console.warn("updateSelectIconBoxes handler failed",d)}};projectFormRefSession.querySelectorAll("select").forEach(a=>{const s=()=>o(a);a.addEventListener("change",s),s()});const r=()=>{typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty()},n=a=>{typeof window<"u"&&window.cineSuppressAutosave||(r(),scheduleProjectAutoSave$1())};projectFormRefSession.addEventListener("input",n),projectFormRefSession.addEventListener("change",n)}function setSelectValue$1(e,t){if(!e||t===void 0)return;const o=t===null?"":t;if(e.value=o,e.value!==o){o!==""?e.dataset.pendingValue=o:e.dataset.pendingValue&&delete e.dataset.pendingValue;const r=Array.from(e.options||[]),n=r.find(a=>a.value==="None");o===""&&!r.length?e.value="":n?e.value="None":e.selectedIndex=-1}else e.dataset.pendingValue&&delete e.dataset.pendingValue;typeof updateFavoriteButton=="function"?updateFavoriteButton(e):typeof enqueueCoreBootTask$1=="function"&&enqueueCoreBootTask$1(()=>{typeof updateFavoriteButton=="function"&&updateFavoriteButton(e)}),e===cameraSelect$1&&typeof callCoreFunctionIfAvailable=="function"&&callCoreFunctionIfAvailable("updateRecordingMediaOptions"),typeof adjustGearListSelectWidth=="function"?adjustGearListSelectWidth(e):typeof enqueueCoreBootTask$1=="function"&&enqueueCoreBootTask$1(()=>{typeof adjustGearListSelectWidth=="function"&&adjustGearListSelectWidth(e)})}function resetSelectsToNone(e){e.forEach(t=>{if(!t)return;const o=Array.from(t.options||[]);o.find(n=>n.value==="None")?t.value="None":o.length?t.selectedIndex=-1:t.value=""})}const _loadSession=typeof window<"u"&&typeof window.loadSession=="function"?window.loadSession:function e(){return typeof loadSessionState$1=="function"?loadSessionState$1():null};function restoreSessionState(){typeof restoringSession<"u"&&(restoringSession=!0);const e=_loadSession(),t=e&&typeof e=="object"?{...e}:null;if(t){const a=typeof t.battery=="string"?t.battery:"",s=typeof t.batteryPlate=="string"?t.batteryPlate:"",l=typeof normalizeBatteryPlateValue=="function"?normalizeBatteryPlateValue(s,a):s;t.batteryPlate=l}typeof storeLoadedSetupState=="function"&&storeLoadedSetupState(t||null);let o={};if(t&&typeof t.diagramPositions=="object"&&typeof normalizeDiagramPositionsInput=="function"&&(o=normalizeDiagramPositionsInput(t.diagramPositions)),typeof setManualDiagramPositions=="function"&&setManualDiagramPositions(o,{render:!1}),typeof motorSelects<"u"&&resetSelectsToNone(motorSelects),typeof controllerSelects<"u"&&resetSelectsToNone(controllerSelects),t?(setupNameInput$1&&(setupNameInput$1.value=t.setupName||"",setupNameInput$1.dispatchEvent(new Event("input"))),setSelectValue$1(cameraSelect$1,t.camera),_safeUpdateBatteryPlateVisibility(),setSelectValue$1(batteryPlateSelect$1,t.batteryPlate),typeof applyBatteryPlateSelectionFromBattery=="function"&&applyBatteryPlateSelectionFromBattery(t.battery,batteryPlateSelect$1?batteryPlateSelect$1.value:""),_safeUpdateBatteryOptions(),setSelectValue$1(monitorSelect$1,t.monitor),setSelectValue$1(videoSelect,t.video),typeof updateCageSelectOptions=="function"?updateCageSelectOptions(t.cage):setSelectValue$1(cageSelect,t.cage),setSelectValue$1(distanceSelect,t.distance),Array.isArray(t.motors)&&typeof motorSelects<"u"&&t.motors.forEach((a,s)=>{motorSelects[s]&&setSelectValue$1(motorSelects[s],a)}),Array.isArray(t.controllers)&&typeof controllerSelects<"u"&&t.controllers.forEach((a,s)=>{controllerSelects[s]&&setSelectValue$1(controllerSelects[s],a)}),setSelectValue$1(batterySelect,t.battery),typeof applyBatteryPlateSelectionFromBattery=="function"&&applyBatteryPlateSelectionFromBattery(t.battery,batteryPlateSelect$1?batteryPlateSelect$1.value:""),setSelectValue$1(hotswapSelect$1,t.batteryHotswap),(t&&typeof t.battery=="string"&&t.battery.trim()||t&&typeof t.batteryHotswap=="string"&&t.batteryHotswap.trim())&&_safeUpdateBatteryOptions(),setSelectValue$1(setupSelect$1,t.setupSelect),currentProjectInfo$1=t.projectInfo||null,projectForm$1&&typeof populateProjectForm=="function"&&populateProjectForm(currentProjectInfo$1||{})):(gearListOutput$1&&(gearListOutput$1.innerHTML="",gearListOutput$1.classList.add("hidden")),projectRequirementsOutput$1&&(projectRequirementsOutput$1.innerHTML="",projectRequirementsOutput$1.classList.add("hidden"))),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),gearListOutput$1||projectRequirementsOutput$1){const a=safeGetCurrentProjectName(),s=getCurrentProjectStorageKey$1(),l=y=>typeof loadProject$1=="function"&&typeof y=="string"?loadProject$1(y):null,u=y=>{if(!y||typeof y!="object")return!1;if(Object.prototype.hasOwnProperty.call(y,"gearList"))return!0;if(Object.prototype.hasOwnProperty.call(y,"gearSelectors")){const h=y.gearSelectors;if(h&&typeof h=="object"&&Object.keys(h).length)return!0}return Object.prototype.hasOwnProperty.call(y,"gearListAndProjectRequirementsGenerated")?!0:!!(y.projectInfo||y.powerSelection||y.autoGearRules&&y.autoGearRules.length||y.diagramPositions&&Object.keys(y.diagramPositions).length)},d=[];a&&d.push(a),(s||s==="")&&(d.includes(s)||d.push(s));let m=null;for(const y of d)if(m=l(y),u(m))break;if(!u(m)&&t){const y=typeof t.setupSelect=="string"?t.setupSelect.trim():"";if(y&&!d.includes(y)){const h=l(y);u(h)&&(m=h)}}if(u(m)){m&&m.powerSelection&&typeof applyStoredPowerSelection=="function"&&applyStoredPowerSelection(m.powerSelection)&&updateBatteryOptions();const y=Object.prototype.hasOwnProperty.call(m,"projectInfo"),h=y&&m.projectInfo&&typeof m.projectInfo=="object"?m.projectInfo:null,b=currentProjectInfo$1&&typeof currentProjectInfo$1=="object"?currentProjectInfo$1:null;let v=null;if(y?h&&b?v={...h,...b}:h?v={...h}:v=null:b&&(v={...b}),currentProjectInfo$1=v,projectForm$1&&typeof populateProjectForm=="function"&&populateProjectForm(currentProjectInfo$1||{}),typeof normalizeDiagramPositionsInput=="function"&&typeof setManualDiagramPositions=="function"){const C=normalizeDiagramPositionsInput(m.diagramPositions),A=Object.keys(C).length?{...C,...o}:o;setManualDiagramPositions(A,{render:!1}),o=A}displayGearAndRequirements(m.gearList),gearListOutput$1&&m.gearList&&(gearListOutput$1.classList.remove("hidden"),skipNextGearListRefresh=!0),gearListOutput$1&&(ensureGearListActions(),bindGearListCageListener(),bindGearListEasyrigListener(),bindGearListSliderBowlListener(),bindGearListEyeLeatherListener(),bindGearListProGaffTapeListener(),bindGearListDirectorMonitorListener(),m&&isPlainObject(m.gearSelectors)&&Object.keys(m.gearSelectors).length&&applyGearListSelectors(m.gearSelectors),t&&(setSliderBowlValue(t.sliderBowl),setEasyrigValue(t.easyrig)),updateGearListButtonVisibility())}else if(currentProjectInfo$1&&typeof generateGearListHtml$1=="function"){const y=generateGearListHtml$1(currentProjectInfo$1||{});y&&(displayGearAndRequirements(y),gearListOutput$1&&(gearListOutput$1.classList.remove("hidden"),skipNextGearListRefresh=!0,ensureGearListActions(),bindGearListCageListener(),bindGearListEasyrigListener(),bindGearListSliderBowlListener(),bindGearListEyeLeatherListener(),bindGearListProGaffTapeListener(),bindGearListDirectorMonitorListener(),m&&isPlainObject(m.gearSelectors)&&Object.keys(m.gearSelectors).length&&typeof applyGearListSelectors=="function"&&applyGearListSelectors(m.gearSelectors),t&&(setSliderBowlValue(t.sliderBowl),setEasyrigValue(t.easyrig)),updateGearListButtonVisibility()))}}const r=t&&Object.prototype.hasOwnProperty.call(t,"autoGearHighlight")?!!t.autoGearHighlight:!1;if(typeof setAutoGearHighlightEnabled=="function"?setAutoGearHighlightEnabled(r):gearListOutput$1&&gearListOutput$1.classList&&(gearListOutput$1.classList.toggle("show-auto-gear-highlight",r),callSessionCoreFunction("updateAutoGearHighlightToggleButton",[],{defer:!0})),typeof lastSetupName<"u"&&(lastSetupName=setupSelect$1?setupSelect$1.value:""),typeof setActiveProjectCompressionHold=="function"){let a="";if(typeof getCurrentProjectStorageKey$1=="function")try{a=getCurrentProjectStorageKey$1({allowTyped:!0})||""}catch(s){console.warn("Unable to determine active project key for compression hold after session restore",s),a=setupSelect$1&&typeof setupSelect$1.value=="string"?setupSelect$1.value:""}else setupSelect$1&&typeof setupSelect$1.value=="string"&&(a=setupSelect$1.value);setActiveProjectCompressionHold(a)}typeof restoringSession<"u"&&(restoringSession=!1),saveCurrentSession$1();const n=projectAutoSavePendingWhileRestoring;projectAutoSavePendingWhileRestoring=null,n==="immediate"?scheduleProjectAutoSave$1(!0):n==="queued"&&scheduleProjectAutoSave$1()}function ensureImportedProjectBaseNameSession(e){const t=typeof e=="string"?e.trim():"";if(!t)return"Project-imported";const o=t.match(/^(.*?)-imported(?:-(\d+))?$/i);if(o){const r=typeof o[1]=="string"?o[1].trim():"";return r?`${r}-imported`:"Project-imported"}return t.toLowerCase().endsWith("-imported")?t:`${t}-imported`}function resolveImportedProjectNamingContextSession(e){const t=typeof e=="string"?e.trim():"",o=ensureImportedProjectBaseNameSession(e);if(!t)return{base:o,initialCandidate:o,suffixStart:2};const r=t.match(/^(.*?)-imported(?:-(\d+))?$/i),n=r&&r[2]?Number(r[2]):NaN,a=Number.isFinite(n)?n+1:2;return r?{base:o,initialCandidate:t,suffixStart:a}:{base:o,initialCandidate:o,suffixStart:2}}function generateUniqueImportedProjectNameSession(e,t,o){const r=o||new Set([...t].map(u=>typeof u=="string"?u.trim().toLowerCase():"").filter(u=>u)),n=resolveImportedProjectNamingContextSession(e);let a=typeof n.initialCandidate=="string"?n.initialCandidate.trim():"";a||(a=n.base||"Project-imported");let s=a.trim().toLowerCase(),l=n.suffixStart;for(;s&&r.has(s);)a=`${n.base||"Project-imported"}-${l++}`,s=a.trim().toLowerCase();return t.add(a),s&&r.add(s),a}function persistImportedProjectWithFallback(e,t){if(!e||typeof saveProject!="function")return"";let o=new Set,r=new Set;if(typeof loadProject$1=="function")try{const l=loadProject$1();if(l&&typeof l=="object"){const u=Object.keys(l);o=new Set(u),r=new Set(u.map(d=>typeof d=="string"?d.trim().toLowerCase():"").filter(d=>d))}}catch(l){console.warn("Unable to read existing projects while generating fallback name for imported project",l)}const n=Array.isArray(t)?t:[];let a="";for(let l=0;l<n.length;l+=1){const u=typeof n[l]=="string"?n[l].trim():"";if(u){a=u;break}}a||(a="Imported project");const s=generateUniqueImportedProjectNameSession(a,o,r);return saveProject(s,e,{skipOverwriteBackup:!0}),s}function clearOwnedGearExportArtifacts(e){if(!e||typeof e.querySelectorAll!="function")return;e.removeAttribute("data-gear-owned-export-label"),e.querySelectorAll("[data-gear-owned-export]").forEach(o=>{o&&o.parentElement&&o.parentElement.removeChild(o)})}function applyImportedOwnedGearMarkers(e,t={}){if(!Array.isArray(e)||!e.length)return!1;const o=t&&t.root?t.root:gearListOutput$1;if(!o||typeof o.querySelector!="function")return!1;const r=typeof getUserProfileSnapshot$1=="function"?getUserProfileSnapshot$1():null,n=r&&typeof r.name=="string"?r.name.trim():"",a=n?n.toLowerCase():"",s=typeof formatUserProfileProviderName=="function"?formatUserProfileProviderName(n):n,l=s?s.toLowerCase():"";let u=!1;return e.forEach(d=>{if(!d||!d.ownedId)return;const m=typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(d.ownedId):String(d.ownedId).replace(/\\/g,"\\\\").replace(/"/g,'\\"'),y=o.querySelector(`[data-gear-own-gear-id="${m}"]`);if(!y)return;clearOwnedGearExportArtifacts(y);const h=typeof d.ownerDisplayName=="string"?d.ownerDisplayName.trim():"",b=h?h.toLowerCase():"",v=typeof d.ownerProfileName=="string"?d.ownerProfileName.trim():"",C=v?v.toLowerCase():"",A=typeof d.providerLabel=="string"?d.providerLabel.trim():h,w=!!(a&&C&&a===C||l&&b&&l===b||a&&b&&a===b);let R="",_=A;if(w)R="user",_="";else if(d.ownerType==="contact"||h){const G=typeof ensureContactForImportedOwner=="function"?ensureContactForImportedOwner(h||A,{contactId:d.contactId,fallbackLabel:A}):null;G&&G.value?(R=G.value,_=G.label||A):(typeof d.providerValue=="string"&&d.providerValue.startsWith("contact:")||d.providerValue&&d.providerValue!=="user")&&(R=d.providerValue)}else typeof d.providerValue=="string"&&d.providerValue&&(R=d.providerValue);typeof setGearItemProvider=="function"?setGearItemProvider(y,R,{label:_}):(R?y.setAttribute("data-gear-provider",R):y.removeAttribute("data-gear-provider"),_?y.setAttribute("data-gear-provider-label",_):y.removeAttribute("data-gear-provider-label")),u=!0}),u&&typeof dispatchGearProviderDataChanged=="function"&&dispatchGearProviderDataChanged("owned-gear-import"),u}function mergeSharedContactsIntoCache(e){if(!Array.isArray(e)||!e.length)return{added:0,updated:0};if(typeof contactsCache>"u")return{added:0,updated:0};const t=a=>typeof sanitizeContactValue=="function"?sanitizeContactValue(a):typeof a=="string"?a.trim():"",o=Array.isArray(contactsCache)?contactsCache.slice():[];let r=0,n=0;if(e.forEach(a=>{if(!a||typeof a!="object")return;const s=typeof normalizeContactEntry=="function"?normalizeContactEntry(a):{...a};if(!s||typeof s!="object")return;const l=t(s.id||a.id);if(!l)return;const u=o.findIndex(h=>h&&h.id===l),d=Number.isFinite(s.createdAt)?s.createdAt:Number.isFinite(a.createdAt)?a.createdAt:Date.now(),m=Number.isFinite(s.updatedAt)?s.updatedAt:Number.isFinite(a.updatedAt)?a.updatedAt:d;if(u!==-1){const h=o[u];let b=!1;["name","role","phone","email","website","notes"].forEach(C=>{const A=t(Object.prototype.hasOwnProperty.call(s,C)?s[C]:a[C]);if(!A)return;t(h[C])||(h[C]=A,b=!0)});const v=t(s.avatar||a.avatar);v&&!t(h.avatar)&&(h.avatar=v,b=!0),!Number.isFinite(h.createdAt)&&Number.isFinite(d)&&(h.createdAt=d,b=!0),Number.isFinite(m)&&(!Number.isFinite(h.updatedAt)||h.updatedAt<m)?(h.updatedAt=m,b=!0):(b&&Number.isFinite(h.updatedAt)||b&&!Number.isFinite(h.updatedAt))&&(h.updatedAt=Date.now()),b&&(n+=1);return}const y={id:l,name:t(s.name||a.name),role:t(s.role||a.role),phone:t(s.phone||a.phone),email:t(s.email||a.email),website:t(s.website||a.website),notes:t(s.notes||a.notes),avatar:t(s.avatar||a.avatar),createdAt:d,updatedAt:m};y.avatar||delete y.avatar,o.push(y),r+=1}),!r&&!n)return{added:0,updated:0};try{typeof sortContacts=="function"?contactsCache=sortContacts(o):contactsCache=o.filter(Boolean)}catch(a){console.warn("Shared contact merge could not sort contacts",a),contactsCache=o.filter(Boolean)}if(typeof saveContactsToStorage=="function")try{saveContactsToStorage(contactsCache)}catch(a){console.warn("Shared contact merge could not persist contacts",a)}if(typeof renderContactsList=="function")try{renderContactsList()}catch{}if(typeof updateContactPickers=="function")try{updateContactPickers()}catch{}return{added:r,updated:n}}function resolveProjectNameCollisionForImport(e){const t=typeof e=="string"?e.trim():"";if(!t)return{name:t,changed:!1};if(typeof loadProject$1!="function")return{name:t,changed:!1};let o;try{o=loadProject$1()}catch(u){console.warn("Unable to inspect existing projects during shared import",u),o=null}if(!o||typeof o!="object")return{name:t,changed:!1};const r=new Set(Object.keys(o).map(u=>typeof u=="string"?u.trim().toLowerCase():"").filter(u=>u)),n=t.toLowerCase();if(!r.has(n))return{name:t,changed:!1};let a=2,s=`${t} (${a})`,l=s.trim().toLowerCase();for(;r.has(l);)a+=1,s=`${t} (${a})`,l=s.trim().toLowerCase();return{name:s,changed:!0}}function applySharedSetup$1(e,t={}){try{const o=decodeSharedSetup$1(typeof e=="string"?JSON.parse(e):e);o&&o.contacts&&mergeSharedContactsIntoCache(o.contacts),deactivateSharedImportProjectPreset();const r=Array.isArray(o.autoGearRules)?o.autoGearRules:null,n=Array.isArray(t.sharedAutoGearRules)&&t.sharedAutoGearRules.length?t.sharedAutoGearRules:r,a=Array.isArray(n)&&n.length>0,s=t.autoGearMode;let l=Array.isArray(s)?s.slice():typeof s=="string"?[s]:[];l=l.filter((C,A,w)=>(C==="none"||C==="project"||C==="global")&&w.indexOf(C)===A),l.length||(l=a?["project"]:["none"]),l.length>1&&l.includes("none")&&(l=l.filter(C=>C!=="none")),l.length||(l=a?["project"]:["none"]);const u=l.includes("global"),d=l.includes("project"),m=l.length===1&&l[0]==="none";let y=!1;if(u)if(a){const C=mergeAutoGearRules(getBaseAutoGearRules(),n),A=ensureSharedAutoGearPreset(C,o);A&&setActiveAutoGearPresetId(A.id,{persist:!0,skipRender:!0}),setAutoGearRules(C),y=!0}else usingProjectAutoGearRules()&&(clearProjectAutoGearRules(),y=!0);if(d){if(a){const C=ensureSharedAutoGearPreset(n,o);C&&activateSharedImportProjectPreset(C.id),useProjectAutoGearRules(n)}else clearProjectAutoGearRules(),deactivateSharedImportProjectPreset();y=!0}else!u&&(m||!a)&&usingProjectAutoGearRules()&&(clearProjectAutoGearRules(),deactivateSharedImportProjectPreset(),y=!0);y&&(renderAutoGearRulesList(),updateAutoGearCatalogOptions()),o.changedDevices&&applyDeviceChanges(o.changedDevices),setupNameInput$1&&o.setupName&&(setupNameInput$1.value=o.setupName,setupNameInput$1.dispatchEvent(new Event("input"))),typeof motorSelects<"u"&&resetSelectsToNone(motorSelects),typeof controllerSelects<"u"&&resetSelectsToNone(controllerSelects),setSelectValue$1(cameraSelect$1,o.camera),_safeUpdateBatteryPlateVisibility(),setSelectValue$1(batteryPlateSelect$1,o.batteryPlate),typeof applyBatteryPlateSelectionFromBattery=="function"&&applyBatteryPlateSelectionFromBattery(o.battery,batteryPlateSelect$1?batteryPlateSelect$1.value:""),_safeUpdateBatteryOptions(),setSelectValue$1(monitorSelect$1,o.monitor),setSelectValue$1(videoSelect,o.video),typeof updateCageSelectOptions=="function"?updateCageSelectOptions(o.cage):setSelectValue$1(cageSelect,o.cage),setSelectValue$1(distanceSelect,o.distance),Array.isArray(o.motors)&&typeof motorSelects<"u"&&o.motors.forEach((C,A)=>{motorSelects[A]&&setSelectValue$1(motorSelects[A],C)}),Array.isArray(o.controllers)&&typeof controllerSelects<"u"&&o.controllers.forEach((C,A)=>{controllerSelects[A]&&setSelectValue$1(controllerSelects[A],C)}),setSelectValue$1(batterySelect,o.battery),typeof applyBatteryPlateSelectionFromBattery=="function"&&applyBatteryPlateSelectionFromBattery(o.battery,batteryPlateSelect$1?batteryPlateSelect$1.value:""),setSelectValue$1(hotswapSelect$1,o.batteryHotswap);let h=!1;if(o.powerSelection&&typeof applyStoredPowerSelection=="function"&&(h=applyStoredPowerSelection(o.powerSelection)),(typeof o.battery=="string"&&o.battery.trim()||typeof o.batteryHotswap=="string"&&o.batteryHotswap.trim()||h)&&_safeUpdateBatteryOptions(),typeof setManualDiagramPositions=="function"){let C={};typeof normalizeDiagramPositionsInput=="function"&&o.diagramPositions&&(C=normalizeDiagramPositionsInput(o.diagramPositions)),setManualDiagramPositions(C,{render:!1})}if(saveCurrentSession$1(),Array.isArray(o.feedback)&&o.feedback.length){const C=getCurrentSetupKey(),A=loadFeedbackSafe();A[C]=(A[C]||[]).concat(o.feedback),saveFeedbackSafe(A)}currentProjectInfo$1=o.projectInfo||null,projectForm$1&&typeof populateProjectForm=="function"&&populateProjectForm(currentProjectInfo$1||{});let b=!1,v="";if((o.projectHtml||o.gearList)&&(v=`${o.projectHtml||""}${o.gearList||""}`),!v&&o.projectInfo&&typeof generateGearListHtml$1=="function"&&(v=generateGearListHtml$1(o.projectInfo||{})),!v&&typeof generateGearListHtml$1=="function"&&(v=generateGearListHtml$1(currentProjectInfo$1||{})),v&&(displayGearAndRequirements(v),ensureGearListActions(),bindGearListCageListener(),bindGearListEasyrigListener(),bindGearListSliderBowlListener(),bindGearListProGaffTapeListener(),bindGearListDirectorMonitorListener(),b=!0),o.gearSelectors&&b&&applyGearListSelectors(o.gearSelectors),b&&Array.isArray(o.ownedGearMarkers)&&o.ownedGearMarkers.length&&applyImportedOwnedGearMarkers(o.ownedGearMarkers,{root:gearListOutput$1}),o.projectInfo||o.gearSelectors||o.gearList||Object.prototype.hasOwnProperty.call(o,"gearListAndProjectRequirementsGenerated")){const C=getCurrentGearListHtml(),A={projectInfo:o.projectInfo||null,gearListAndProjectRequirementsGenerated:!!C};if(o.gearSelectors&&Object.keys(o.gearSelectors).length&&(A.gearSelectors=o.gearSelectors),typeof getDiagramManualPositions=="function"){const $=getDiagramManualPositions();$&&Object.keys($).length&&(A.diagramPositions=$)}const w=getProjectScopedAutoGearRules();w&&w.length&&(A.autoGearRules=w);const R=setupSelect$1&&typeof setupSelect$1.value=="string"?setupSelect$1.value.trim():"";let _=setupNameInput$1&&typeof setupNameInput$1.value=="string"?setupNameInput$1.value.trim():"",G=R||_;if(!R&&G){const $=resolveProjectNameCollisionForImport(G);if($.changed&&$.name&&(G=$.name,_=$.name,setupNameInput$1&&setupNameInput$1.value!==$.name)){setupNameInput$1.value=$.name;try{setupNameInput$1.dispatchEvent(new Event("input"))}catch(V){}}}const O=Object.prototype.hasOwnProperty.call(A,"gearSelectors"),B=A.autoGearRules&&A.autoGearRules.length;if(typeof G=="string"&&(A.projectInfo||O||A.gearListAndProjectRequirementsGenerated||B||A.diagramPositions))B||delete A.autoGearRules,saveProject(G,A,{skipOverwriteBackup:!0});else if(A&&(A.projectInfo||O||A.gearListAndProjectRequirementsGenerated||B||A.diagramPositions)){B||delete A.autoGearRules;const $=[o.setupName,o.projectInfo&&o.projectInfo.projectName,A.projectInfo&&A.projectInfo.projectName],V=persistImportedProjectWithFallback(A,$);if(V&&(setupNameInput$1&&setupNameInput$1.value!==V&&(setupNameInput$1.value=V,setupNameInput$1.dispatchEvent(new Event("input"))),typeof populateSetupSelect=="function"))try{populateSetupSelect()}catch(M){console.warn("Unable to refresh project selector after saving imported project without a provided name",M)}}}}catch(o){console.error("Failed to apply shared setup",o),alert(texts[currentLang].invalidSharedLink)}}let manualQueryParamWarningShown=!1;function getQueryParam(e,t){if(typeof URLSearchParams=="function")try{return new URLSearchParams(e).get(t)}catch(n){!manualQueryParamWarningShown&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Falling back to manual query parameter parsing.",n),manualQueryParamWarningShown=!0}if(typeof e!="string"||e.length===0)return null;const o=e.charAt(0)==="?"?e.slice(1):e;if(!o)return null;const r=o.split("&");for(let n=0;n<r.length;n+=1){if(!r[n])continue;const[a,s=""]=r[n].split("=");if(!a)continue;let l;try{l=decodeURIComponent(a.replace(/\+/g," "))}catch(u){!manualQueryParamWarningShown&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decode query parameter name",a,u),manualQueryParamWarningShown=!0;continue}if(l===t)try{return decodeURIComponent(s.replace(/\+/g," "))}catch(u){return!manualQueryParamWarningShown&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decode query parameter value",s,u),manualQueryParamWarningShown=!0,s}}return null}function buildSearchWithoutShared(e){if(typeof e!="string"||e.length===0)return"";const t=e.charAt(0)==="?"?e.slice(1):e;if(!t)return"";const o=[],r=t.split("&");for(let n=0;n<r.length;n+=1){const a=r[n];if(!a)continue;const[s]=a.split("=");if(!s){o.push(a);continue}let l;try{l=decodeURIComponent(s.replace(/\+/g," "))}catch(u){!manualQueryParamWarningShown&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decode query parameter name",s,u),manualQueryParamWarningShown=!0,l=s}l!=="shared"&&o.push(a)}return o.length===0?"":`?${o.join("&")}`}function removeSharedQueryParamFromLocation(){if(typeof window>"u")return;const{location:e,history:t}=window;if(!e||!t||typeof t.replaceState!="function")return;const o=typeof e.pathname=="string"&&e.pathname?e.pathname:"/",r=typeof e.search=="string"?e.search:"",n=typeof e.hash=="string"?e.hash:"";let a="",s=!1;if(typeof URLSearchParams=="function")try{const y=new URLSearchParams(r);y.delete("shared");const h=y.toString();a=h?`?${h}`:"",s=!0}catch(y){!manualQueryParamWarningShown&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to rewrite query string with URLSearchParams",y),manualQueryParamWarningShown=!0}s||(a=buildSearchWithoutShared(r));const l=r||"",u=typeof a=="string"?a:"",d=`${o}${l}${n}`,m=`${o}${u}${n}`;d!==m&&t.replaceState(null,"",m)}function applySharedSetupFromUrl$1(){const t=typeof window<"u"&&window.location&&typeof window.location.search=="string"?window.location.search:"",o=getQueryParam(t,"shared");if(o)try{const r=LZString.decompressFromEncodedURIComponent(o);if(typeof r!="string")throw new Error("Shared payload could not be decompressed");const n=JSON.parse(r);applySharedSetup$1(n),typeof updateCalculations$1=="function"&&updateCalculations$1(),removeSharedQueryParamFromLocation()}catch(r){console.error("Failed to apply shared setup from URL",r)}}function getTrackedPowerSelects(){const e=typeof hotswapSelect$1>"u"?null:hotswapSelect$1;return[cameraSelect$1,monitorSelect$1,videoSelect,cageSelect,distanceSelect,batterySelect,e,batteryPlateSelect$1].filter(Boolean)}typeof window<"u"&&(window.getTrackedPowerSelects=getTrackedPowerSelects);function getTrackedPowerSelectsWithSetup(){const e=getTrackedPowerSelects(),t=typeof setupSelect$1>"u"?null:setupSelect$1;return t&&e.push(t),e}typeof window<"u"&&(window.getTrackedPowerSelectsWithSetup=getTrackedPowerSelectsWithSetup);function forEachTrackedSelect(e,t){if(!e||typeof t!="function")return;if(typeof e.forEach=="function"){e.forEach(t);return}(Array.isArray(e)?e:Array.from(e||[])).forEach(t)}const bindPowerSessionEvents=()=>{const e=(m,y)=>m||document.getElementById(y),t=e(typeof cameraSelect$1<"u"?cameraSelect$1:null,"cameraSelect"),o=e(typeof sensorModeDropdown<"u"?sensorModeDropdown:null,"sensorModeDropdown"),r=e(typeof recordingResolutionDropdown<"u"?recordingResolutionDropdown:null,"recordingResolutionDropdown"),n=e(typeof slowMotionSensorModeDropdown<"u"?slowMotionSensorModeDropdown:null,"slowMotionSensorModeDropdown"),a=e(typeof slowMotionRecordingResolutionDropdown<"u"?slowMotionRecordingResolutionDropdown:null,"slowMotionRecordingResolutionDropdown"),s=e(typeof slowMotionAspectRatioSelect<"u"?slowMotionAspectRatioSelect:null,"slowMotionAspectRatioSelect"),l=e(typeof monitoringConfigurationSelect<"u"?monitoringConfigurationSelect:null,"monitoringConfigurationSelect"),u=e(typeof monitorSelect$1<"u"?monitorSelect$1:null,"monitorSelect"),d=e(typeof batteryPlateSelect$1<"u"?batteryPlateSelect$1:null,"batteryPlateSelect");return e(typeof batterySelect<"u"?batterySelect:null,"batterySelect"),!t&&document.readyState==="loading"?!1:(forEachTrackedSelect(getTrackedPowerSelects(),m=>{m.removeEventListener("change",_safeUpdateCalculations),m.addEventListener("change",_safeUpdateCalculations)}),t&&(t.dataset.sessionBound||(t.dataset.sessionBound="true",t.addEventListener("change",()=>{_safeUpdateBatteryPlateVisibility(),_safeUpdateBatteryOptions(),typeof updateCageSelectOptions=="function"&&updateCageSelectOptions();const m=currentProjectInfo$1&&currentProjectInfo$1.recordingFrameRate,y=currentProjectInfo$1&&currentProjectInfo$1.slowMotionRecordingFrameRate;if(_safePopulateRecordingResolutionDropdown(currentProjectInfo$1&&currentProjectInfo$1.recordingResolution),_safePopulateSensorModeDropdown(currentProjectInfo$1&&currentProjectInfo$1.sensorMode),_safePopulateSlowMotionRecordingResolutionDropdown(currentProjectInfo$1&&currentProjectInfo$1.slowMotionRecordingResolution),_safePopulateSlowMotionSensorModeDropdown(currentProjectInfo$1&&currentProjectInfo$1.slowMotionSensorMode),_safePopulateFrameRateDropdown(m),_safePopulateSlowMotionFrameRateDropdown(y),typeof updateStorageRequirementTypeOptions=="function"&&updateStorageRequirementTypeOptions(),typeof document<"u"&&typeof document.dispatchEvent=="function"&&typeof CustomEvent=="function")try{document.dispatchEvent(new CustomEvent("camera-selection-changed"))}catch{}}))),o&&!o.dataset.sessionBound&&(o.dataset.sessionBound="true",o.addEventListener("change",()=>{_safePopulateFrameRateDropdown(getCurrentFrameRateInputValue())})),r&&!r.dataset.sessionBound&&(r.dataset.sessionBound="true",r.addEventListener("change",()=>{_safePopulateFrameRateDropdown(getCurrentFrameRateInputValue())})),n&&!n.dataset.sessionBound&&(n.dataset.sessionBound="true",n.addEventListener("change",()=>{_safePopulateSlowMotionFrameRateDropdown(getFrameRateInputValue(slowMotionRecordingFrameRateInput))})),a&&!a.dataset.sessionBound&&(a.dataset.sessionBound="true",a.addEventListener("change",()=>{_safePopulateSlowMotionFrameRateDropdown(getFrameRateInputValue(slowMotionRecordingFrameRateInput))})),s&&!s.dataset.sessionBound&&(s.dataset.sessionBound="true",s.addEventListener("change",()=>{_safePopulateSlowMotionFrameRateDropdown(getFrameRateInputValue(slowMotionRecordingFrameRateInput))})),l&&!l.dataset.sessionBound&&(l.dataset.sessionBound="true",l.addEventListener("change",()=>{monitoringConfigurationUserChanged=!0,_safeUpdateViewfinderSettingsVisibility()})),u&&!u.dataset.sessionBound&&(u.dataset.sessionBound="true",u.addEventListener("change",_safeUpdateMonitoringConfigurationOptions)),d&&d.addEventListener("change",_safeUpdateBatteryOptions),typeof batterySelect<"u"&&batterySelect&&batterySelect.addEventListener("change",_safeUpdateBatteryOptions),typeof hotswapSelect$1<"u"&&hotswapSelect$1&&hotswapSelect$1.addEventListener("change",_safeUpdateCalculations),!0)};bindPowerSessionEvents()||document.addEventListener("DOMContentLoaded",bindPowerSessionEvents);forEachTrackedSelect(getTrackedPowerSelectsWithSetup(),e=>{e.addEventListener("change",_safeSaveCurrentSession)});typeof motorSelects<"u"&&forEachTrackedSelect(motorSelects,e=>{e&&e.addEventListener("change",_safeSaveCurrentSession)});typeof controllerSelects<"u"&&forEachTrackedSelect(controllerSelects,e=>{e&&e.addEventListener("change",_safeSaveCurrentSession)});if(setupNameInput$1){let e=null;const t=()=>{e&&clearTimeout(e),e=setTimeout(()=>{const o=setupNameInput$1.value?setupNameInput$1.value.trim():"",r=setupSelect$1?setupSelect$1.value:"";saveCurrentSession$1({skipGearList:!!(r&&o&&o!==r)})},500)};setupNameInput$1.addEventListener("input",t)}forEachTrackedSelect(getTrackedPowerSelects(),e=>{e.addEventListener("change",_safeSaveCurrentGearList)});typeof motorSelects<"u"&&forEachTrackedSelect(motorSelects,e=>{e&&e.addEventListener("change",_safeSaveCurrentGearList)});typeof controllerSelects<"u"&&forEachTrackedSelect(controllerSelects,e=>{e&&e.addEventListener("change",_safeSaveCurrentGearList)});forEachTrackedSelect(getTrackedPowerSelects(),e=>{e.addEventListener("change",_safeCheckSetupChanged)});typeof motorSelects<"u"&&forEachTrackedSelect(motorSelects,e=>{e&&e.addEventListener("change",_safeCheckSetupChanged)});typeof controllerSelects<"u"&&forEachTrackedSelect(controllerSelects,e=>{e&&e.addEventListener("change",_safeCheckSetupChanged)});typeof setupNameInput$1<"u"&&setupNameInput$1&&setupNameInput$1.addEventListener("input",_safeCheckSetupChanged);forEachTrackedSelect(getTrackedPowerSelects(),e=>{e.addEventListener("change",_safeAutoSaveCurrentSetup)});typeof motorSelects<"u"&&forEachTrackedSelect(motorSelects,e=>{e&&e.addEventListener("change",_safeAutoSaveCurrentSetup)});typeof controllerSelects<"u"&&forEachTrackedSelect(controllerSelects,e=>{e&&e.addEventListener("change",_safeAutoSaveCurrentSetup)});typeof setupNameInput$1<"u"&&setupNameInput$1&&setupNameInput$1.addEventListener("change",_safeAutoSaveCurrentSetup);function flushProjectAutoSaveOnExit(e){if(factoryResetInProgress$1)return;let t=null,o=null;e&&typeof e=="object"&&(typeof e.type=="string"?t=e:o=e);const r=o&&typeof o.reason=="string"&&o.reason.trim()?o.reason.trim():null,n=t&&typeof t.type=="string"&&t.type?`before-${t.type}`:null,a=r||n||"before-exit",s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:null;let l=null;if(s&&typeof s.__cineShowAutoBackupIndicator=="function")try{const u=texts[currentLang]||{},d=texts.en||{},m=u.autoBackupInProgressNotice||d.autoBackupInProgressNotice||"Auto backup in progress. Performance may pause briefly.";l=s.__cineShowAutoBackupIndicator(m)}catch(u){console.warn("Failed to show auto backup indicator before exit",u),l=null}notifyAutoBackupChange({immediate:!0,reason:a,pending:!0});try{s&&typeof s.autoBackup=="function"&&s.autoBackup({suppressSuccess:!0,triggerAutoSaveNotification:!0,reason:"before-reload"})}catch(u){console.warn("Failed to auto backup before exit",u)}finally{if(l)try{l()}catch(u){console.warn("Failed to hide auto backup indicator after exit flush",u)}}scheduleProjectAutoSave$1(!0)}typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&flushProjectAutoSaveOnExit({reason:"before-visibility-hidden"})});typeof window<"u"&&["pagehide","beforeunload","freeze"].forEach(e=>{window.addEventListener(e,flushProjectAutoSaveOnExit)});if(setupNameInput$1&&saveSetupBtn){const e=()=>{saveSetupBtn.disabled=!setupNameInput$1.value.trim()};e(),setupNameInput$1.addEventListener("input",e),setupNameInput$1.addEventListener("keydown",t=>{t.isComposing||t.keyCode===229||t.key==="Enter"&&!saveSetupBtn.disabled&&saveSetupBtn.click()})}function getSessionMountVoltagePreferencesClone(){if(typeof mountVoltagePreferences!="object"||!mountVoltagePreferences)return{"Arri Alexa 35":"24V","Arri Alexa Mini LF":"12V","Arri Alexa Mini":"12V","Arri Amira":"12V","Sony Venice 2":"24V","Sony Venice":"24V","Red V-Raptor XL":"24V","Red V-Raptor":"12V","Red Komodo-X":"12V","Red Komodo":"12V"};try{return JSON.parse(JSON.stringify(mountVoltagePreferences))}catch(e){return console.warn("cineSession: Failed to clone mount voltage preferences",e),{}}}function cloneMountVoltageDefaultsForSession(){return cineCoreMountVoltage&&typeof cineCoreMountVoltage.cloneMountVoltageMap=="function"?cineCoreMountVoltage.cloneMountVoltageMap():{}}const warnMountVoltageHelper=typeof warnMissingMountVoltageHelper=="function"?warnMissingMountVoltageHelper:()=>{};let updateThemeColor=()=>{},setToggleIcon=()=>{},applyDarkMode$1=()=>{},applyHighContrast$1=()=>{},applyReduceMotion=()=>{},applyRelaxedSpacing=()=>{},applyPinkMode$1=()=>{},persistPinkModePreference=()=>{},rememberSettingsPinkModeBaseline=()=>{},revertSettingsPinkModeIfNeeded=()=>{},rememberSettingsTemperatureUnitBaseline=()=>{},revertSettingsTemperatureUnitIfNeeded=()=>{},rememberSettingsFocusScaleBaseline=()=>{},revertSettingsFocusScaleIfNeeded=()=>{},applyShowAutoBackupsPreference=()=>{},rememberSettingsShowAutoBackupsBaseline=()=>{},revertSettingsShowAutoBackupsIfNeeded=()=>{},rememberSettingsMountVoltagesBaseline=()=>{},revertSettingsMountVoltagesIfNeeded=()=>{},handlePinkModeIconPress=()=>{},triggerPinkModeIconAnimation=()=>{};const pendingPinkModeSupportCalls=[];let pinkModeSupportFlushScheduled=!1;const PINK_MODE_SUPPORT_QUEUE_LIMIT=25;function clonePinkModeSupportArgs(e){if(!Array.isArray(e))return e;try{return e.slice()}catch{}return e}function invokePinkModeSupport(e,t,o){if(typeof PINK_MODE_SUPPORT_API>"u"||!PINK_MODE_SUPPORT_API)return;const r=PINK_MODE_SUPPORT_API[e];if(typeof r=="function")try{return r.apply(PINK_MODE_SUPPORT_API,Array.isArray(t)?t:[])}catch(n){typeof console<"u"&&console&&typeof console.warn=="function"&&o&&console.warn(o,n)}}function flushPendingPinkModeSupportCalls(){if(pinkModeSupportFlushScheduled=!1,typeof PINK_MODE_SUPPORT_API>"u"||!PINK_MODE_SUPPORT_API){pendingPinkModeSupportCalls.length&&typeof setTimeout=="function"&&(pinkModeSupportFlushScheduled=!0,setTimeout(flushPendingPinkModeSupportCalls,50));return}for(;pendingPinkModeSupportCalls.length;){const e=pendingPinkModeSupportCalls.shift();if(e)try{invokePinkModeSupport(e.methodName,e.args,e.warningMessage)}catch{}}}function schedulePinkModeSupportFlush(){pinkModeSupportFlushScheduled||typeof setTimeout!="function"||(pinkModeSupportFlushScheduled=!0,setTimeout(flushPendingPinkModeSupportCalls,0))}function enqueuePinkModeSupportCall(e,t,o){pendingPinkModeSupportCalls.length>=PINK_MODE_SUPPORT_QUEUE_LIMIT&&pendingPinkModeSupportCalls.shift(),pendingPinkModeSupportCalls.push({methodName:e,args:clonePinkModeSupportArgs(t),warningMessage:o}),schedulePinkModeSupportFlush()}function callPinkModeSupport(e,t,o){if(!(typeof PINK_MODE_SUPPORT_API<"u"&&PINK_MODE_SUPPORT_API)){enqueuePinkModeSupportCall(e,t,o);return}const n=invokePinkModeSupport(e,t,o);return pendingPinkModeSupportCalls.length&&flushPendingPinkModeSupportCalls(),n}const FALLBACK_TRIGGER_PINK_MODE_ICON_RAIN=()=>callPinkModeSupport("triggerPinkModeIconRain",null,"cineSession: triggerPinkModeIconRain failed.");let sessionTriggerPinkModeIconRain=typeof window<"u"&&typeof window.triggerPinkModeIconRain=="function"?window.triggerPinkModeIconRain:FALLBACK_TRIGGER_PINK_MODE_ICON_RAIN,startPinkModeIconRotation=()=>{},stopPinkModeIconRotation=()=>{};const FALLBACK_START_PINK_MODE_ANIMATED_ICONS=()=>callPinkModeSupport("startPinkModeAnimatedIcons",null,"cineSession: startPinkModeAnimatedIcons failed.");let sessionStartPinkModeAnimatedIcons=typeof window<"u"&&typeof window.startPinkModeAnimatedIcons=="function"?window.startPinkModeAnimatedIcons:FALLBACK_START_PINK_MODE_ANIMATED_ICONS;const FALLBACK_STOP_PINK_MODE_ANIMATED_ICONS=()=>callPinkModeSupport("stopPinkModeAnimatedIcons",null,"cineSession: stopPinkModeAnimatedIcons failed.");let sessionStopPinkModeAnimatedIcons=typeof window<"u"&&typeof window.stopPinkModeAnimatedIcons=="function"?window.stopPinkModeAnimatedIcons:FALLBACK_STOP_PINK_MODE_ANIMATED_ICONS,startPinkModeAnimatedIconRotation=()=>{},stopPinkModeAnimatedIconRotation=()=>{},applyPinkModeIcon=()=>{},isPinkModeActive=()=>!!(typeof document<"u"&&document.body&&document.body.classList.contains("pink-mode"));const appearanceModuleFactoryPlaceholder=ensureSessionRuntimePlaceholder("cineSettingsAppearance",()=>null),appearanceModuleValidator=e=>!!e&&typeof e.initialize=="function";let themePreferenceController=null,pinkModePreferenceController=null;const pendingThemeControls=[],pendingPinkModeControls=[],processPendingControls=(e,t)=>{if(!(!e||typeof e.registerControl!="function"||!Array.isArray(t)))for(;t.length>0;){const o=t.shift();if(o&&o.element)try{const r=e.registerControl(o.element,o.options);typeof o.callback=="function"&&o.callback(r)}catch(r){console.warn("Failed to process pending control registration",r)}}};let appearanceModuleInitialized=!1,appearanceModuleUnavailableWarningHandle=null;function clearAppearanceModuleUnavailableWarning(){if(appearanceModuleUnavailableWarningHandle!==null){try{clearTimeout(appearanceModuleUnavailableWarningHandle)}catch{}appearanceModuleUnavailableWarningHandle=null}}function warnAppearanceModuleUnavailable(){appearanceModuleInitialized||typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("cineSettingsAppearance module is not available; settings appearance features are limited.")}function scheduleAppearanceModuleUnavailableWarning(){if(appearanceModuleUnavailableWarningHandle===null){if(typeof setTimeout!="function"){warnAppearanceModuleUnavailable();return}appearanceModuleUnavailableWarningHandle=setTimeout(()=>{appearanceModuleUnavailableWarningHandle=null,warnAppearanceModuleUnavailable()},1500)}}const appearanceContext={document:typeof document<"u"?document:null,window:typeof window<"u"?window:null,elements:{darkModeToggle:typeof darkModeToggle<"u"?darkModeToggle:null,pinkModeToggle:typeof pinkModeToggle<"u"?pinkModeToggle:null,pinkModeHelpIcon:typeof pinkModeHelpIcon<"u"?pinkModeHelpIcon:null},settings:{darkMode:typeof settingsDarkMode<"u"?settingsDarkMode:null,highContrast:typeof settingsHighContrast<"u"?settingsHighContrast:null,pinkMode:typeof settingsPinkMode<"u"?settingsPinkMode:null,reduceMotion:typeof settingsReduceMotion<"u"?settingsReduceMotion:null,relaxedSpacing:typeof settingsRelaxedSpacing<"u"?settingsRelaxedSpacing:null,showAutoBackups:typeof settingsShowAutoBackups<"u"?settingsShowAutoBackups:null,temperatureUnit:typeof settingsTemperatureUnit<"u"?settingsTemperatureUnit:null,focusScale:typeof settingsFocusScale<"u"?settingsFocusScale:null},accent:{accentColorInput:typeof accentColorInput<"u"?accentColorInput:null,getAccentColor:()=>accentColor,setAccentColor:e=>{accentColor=e},getPrevAccentColor:()=>prevAccentColor,setPrevAccentColor:e=>{prevAccentColor=e},getHighContrastAccentColor:()=>HIGH_CONTRAST_ACCENT_COLOR,clearAccentColorOverrides:()=>{typeof clearAccentColorOverrides=="function"&&clearAccentColorOverrides()},applyAccentColor:e=>{typeof applyAccentColor=="function"&&applyAccentColor(e)},updateAccentColorResetButtonState:()=>{typeof updateAccentColorResetButtonState=="function"&&updateAccentColorResetButtonState()},refreshDarkModeAccentBoost:e=>{typeof refreshDarkModeAccentBoost=="function"&&refreshDarkModeAccentBoost(e)},isHighContrastActive:()=>typeof isHighContrastActive=="function"?isHighContrastActive():!1},cameraColors:{getColors:()=>getCameraLetterColorsSafeSession(),setColors:e=>applyCameraLetterColors(e)},icons:{registry:typeof ICON_GLYPHS=="object"?ICON_GLYPHS:null,applyIconGlyph:typeof applyIconGlyph=="function"?(e,t)=>applyIconGlyph(e,t):null,get ensureSvgHasAriaHidden(){return typeof ensureSvgHasAriaHidden=="function"?ensureSvgHasAriaHidden:typeof window<"u"&&typeof window.ensureSvgHasAriaHidden=="function"?window.ensureSvgHasAriaHidden:null},get ensurePinkModeLottieRuntime(){const e=typeof window<"u"?window:{},t=e.cineCorePinkModeSupport||e.PINK_MODE_SUPPORT_API||{};return(typeof ensurePinkModeLottieRuntime=="function"?ensurePinkModeLottieRuntime:null)||(typeof e.ensurePinkModeLottieRuntime=="function"?e.ensurePinkModeLottieRuntime:null)||(typeof t.ensurePinkModeLottieRuntime=="function"?t.ensurePinkModeLottieRuntime:null)||(typeof t.resolvePinkModeLottieRuntime=="function"?t.resolvePinkModeLottieRuntime:null)||null},get pinkModeIcons(){return typeof pinkModeIcons=="object"&&pinkModeIcons?pinkModeIcons:typeof window<"u"&&window.pinkModeIcons?window.pinkModeIcons:typeof globalThis<"u"&&globalThis.pinkModeIcons?globalThis.pinkModeIcons:null},startPinkModeAnimatedIcons:(...e)=>{const t=(typeof window<"u"&&typeof window.startPinkModeAnimatedIcons=="function"?window.startPinkModeAnimatedIcons:null)||sessionStartPinkModeAnimatedIcons;return typeof t=="function"?t(...e):void 0},stopPinkModeAnimatedIcons:(...e)=>{const t=(typeof window<"u"&&typeof window.stopPinkModeAnimatedIcons=="function"?window.stopPinkModeAnimatedIcons:null)||sessionStopPinkModeAnimatedIcons;return typeof t=="function"?t(...e):void 0},triggerPinkModeIconRain:(...e)=>{const t=(typeof window<"u"&&typeof window.triggerPinkModeIconRain=="function"?window.triggerPinkModeIconRain:null)||sessionTriggerPinkModeIconRain;return typeof t=="function"?t(...e):void 0}},storage:{getLocalStorage:()=>{try{return typeof localStorage<"u"?localStorage:null}catch{return null}},getSafeLocalStorage:()=>{try{if(typeof getSafeLocalStorage$2=="function")return getSafeLocalStorage$2()}catch(e){console.warn("cineSettingsAppearance: getSafeLocalStorage threw while building context",e)}return null},resolveSafeLocalStorage:()=>{try{if(typeof resolveSafeLocalStorage=="function")return resolveSafeLocalStorage()}catch(e){console.warn("cineSettingsAppearance: resolveSafeLocalStorage threw while building context",e)}return null}},preferences:{getTemperatureUnit:()=>localTemperatureUnit,setTemperatureUnit:e=>{localTemperatureUnit=normalizeTemperatureUnitValue(e)},applyTemperatureUnitPreference:applyTemperatureUnitPreferenceWithFallback,getFocusScale:()=>{const e=typeof focusScalePreference=="string"?focusScalePreference:sessionFocusScale$1;return sessionFocusScale$1=typeof normalizeFocusScale=="function"?normalizeFocusScale(e):e,sessionFocusScale$1},setFocusScale:e=>{sessionFocusScale$1=typeof normalizeFocusScale=="function"?normalizeFocusScale(e):e},applyFocusScalePreference:typeof applyFocusScalePreference=="function"?(e,t)=>{applyFocusScalePreference(e,t),sessionFocusScale$1=typeof normalizeFocusScale=="function"?normalizeFocusScale(e):e}:null,getShowAutoBackups:()=>showAutoBackups$1,setShowAutoBackups:e=>{showAutoBackups$1=!!e},ensureAutoBackupsFromProjects:typeof ensureAutoBackupsFromProjects=="function"?ensureAutoBackupsFromProjects:null},autoBackups:{populateSetupSelect:typeof populateSetupSelect=="function"?populateSetupSelect:null,setupSelect:typeof setupSelect$1<"u"?setupSelect$1:null,setupNameInput:typeof setupNameInput$1<"u"?setupNameInput$1:null},mountVoltages:{getPreferencesClone:()=>getSessionMountVoltagePreferencesClone(),applyPreferences:(e,t)=>applySessionMountVoltagePreferences(e,t),supportedTypes:typeof SUPPORTED_MOUNT_VOLTAGE_TYPES<"u"?SUPPORTED_MOUNT_VOLTAGE_TYPES:[],defaultVoltages:typeof DEFAULT_MOUNT_VOLTAGES<"u"?DEFAULT_MOUNT_VOLTAGES:{},updateInputsFromState:()=>{const e=getSessionRuntimeFunction("updateMountVoltageInputsFromState");if(e)try{e()}catch(t){warnMountVoltageHelper("updateMountVoltageInputsFromState",t)}else warnMountVoltageHelper("updateMountVoltageInputsFromState")},warnMissingHelper:(e,t)=>{warnMountVoltageHelper(e,t)}}};function detectSystemThemePreference(){if(typeof window>"u"||typeof window.matchMedia!="function")return null;try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(e){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("cineSettingsAppearance: detectSystemPreference failed",e)}return null}function buildThemePreferenceController(e){if(!e||typeof e.createThemePreferenceController!="function")return null;try{return e.createThemePreferenceController({detectSystemPreference:detectSystemThemePreference})}catch(t){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("cineSettingsAppearance: failed to create theme preference controller.",t)}return null}function buildPinkModePreferenceController(e){if(!e||typeof e.createPinkModePreferenceController!="function")return null;try{return e.createPinkModePreferenceController({})}catch(t){typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("cineSettingsAppearance: failed to create pink mode preference controller.",t)}return null}function applyAppearanceModuleBindings(e){if(!e||typeof e!="object")return!1;if(clearAppearanceModuleUnavailableWarning(),updateThemeColor=e.updateThemeColor||updateThemeColor,setToggleIcon=e.setToggleIcon||setToggleIcon,applyDarkMode$1=e.applyDarkMode||applyDarkMode$1,applyHighContrast$1=e.applyHighContrast||applyHighContrast$1,applyReduceMotion=e.applyReduceMotion||applyReduceMotion,applyRelaxedSpacing=e.applyRelaxedSpacing||applyRelaxedSpacing,applyPinkMode$1=e.applyPinkMode||applyPinkMode$1,persistPinkModePreference=e.persistPinkModePreference||persistPinkModePreference,rememberSettingsPinkModeBaseline=e.rememberSettingsPinkModeBaseline||rememberSettingsPinkModeBaseline,revertSettingsPinkModeIfNeeded=e.revertSettingsPinkModeIfNeeded||revertSettingsPinkModeIfNeeded,rememberSettingsTemperatureUnitBaseline=e.rememberSettingsTemperatureUnitBaseline||rememberSettingsTemperatureUnitBaseline,revertSettingsTemperatureUnitIfNeeded=e.revertSettingsTemperatureUnitIfNeeded||revertSettingsTemperatureUnitIfNeeded,rememberSettingsFocusScaleBaseline=e.rememberSettingsFocusScaleBaseline||rememberSettingsFocusScaleBaseline,revertSettingsFocusScaleIfNeeded=e.revertSettingsFocusScaleIfNeeded||revertSettingsFocusScaleIfNeeded,applyShowAutoBackupsPreference=e.applyShowAutoBackupsPreference||applyShowAutoBackupsPreference,rememberSettingsShowAutoBackupsBaseline=e.rememberSettingsShowAutoBackupsBaseline||rememberSettingsShowAutoBackupsBaseline,revertSettingsShowAutoBackupsIfNeeded=e.revertSettingsShowAutoBackupsIfNeeded||revertSettingsShowAutoBackupsIfNeeded,rememberSettingsMountVoltagesBaseline=e.rememberSettingsMountVoltagesBaseline||rememberSettingsMountVoltagesBaseline,revertSettingsMountVoltagesIfNeeded=e.revertSettingsMountVoltagesIfNeeded||revertSettingsMountVoltagesIfNeeded,handlePinkModeIconPress=e.handlePinkModeIconPress||handlePinkModeIconPress,triggerPinkModeIconAnimation=e.triggerPinkModeIconAnimation||triggerPinkModeIconAnimation,sessionTriggerPinkModeIconRain=e.triggerPinkModeIconRain||sessionTriggerPinkModeIconRain,startPinkModeIconRotation=e.startPinkModeIconRotation||startPinkModeIconRotation,stopPinkModeIconRotation=e.stopPinkModeIconRotation||stopPinkModeIconRotation,typeof e.startPinkModeAnimatedIcons=="function"){const r=sessionStartPinkModeAnimatedIcons,n=e.startPinkModeAnimatedIcons;sessionStartPinkModeAnimatedIcons=(...a)=>{const s=appearanceContext&&appearanceContext.icons?appearanceContext.icons:null,l=s?s.startPinkModeAnimatedIcons:void 0,u=typeof window<"u",d=u?window.startPinkModeAnimatedIcons:void 0;let m=!1,y;const h=(...b)=>(m=!0,y=r(...b),y);s&&(s.startPinkModeAnimatedIcons=h),u&&(window.startPinkModeAnimatedIcons=h);try{const b=n(...a);return m?y:typeof b>"u"?r(...a):b}catch{return m?y:r(...a)}finally{s&&(s.startPinkModeAnimatedIcons=l),u&&(window.startPinkModeAnimatedIcons=d)}}}if(typeof e.stopPinkModeAnimatedIcons=="function"){const r=sessionStopPinkModeAnimatedIcons,n=e.stopPinkModeAnimatedIcons;sessionStopPinkModeAnimatedIcons=(...a)=>{const s=appearanceContext&&appearanceContext.icons?appearanceContext.icons:null,l=s?s.stopPinkModeAnimatedIcons:void 0,u=typeof window<"u",d=u?window.stopPinkModeAnimatedIcons:void 0;let m=!1,y;const h=(...b)=>(m=!0,y=r(...b),y);s&&(s.stopPinkModeAnimatedIcons=h),u&&(window.stopPinkModeAnimatedIcons=h);try{const b=n(...a);return m?y:typeof b>"u"?r(...a):b}catch{return m?y:r(...a)}finally{s&&(s.stopPinkModeAnimatedIcons=l),u&&(window.stopPinkModeAnimatedIcons=d)}}}startPinkModeAnimatedIconRotation=e.startPinkModeAnimatedIconRotation||startPinkModeAnimatedIconRotation,stopPinkModeAnimatedIconRotation=e.stopPinkModeAnimatedIconRotation||stopPinkModeAnimatedIconRotation,applyPinkModeIcon=e.applyPinkModeIcon||applyPinkModeIcon,isPinkModeActive=e.isPinkModeActive||isPinkModeActive,typeof window<"u"&&(window.triggerPinkModeIconRain=sessionTriggerPinkModeIconRain,window.startPinkModeAnimatedIcons=sessionStartPinkModeAnimatedIcons,window.stopPinkModeAnimatedIcons=sessionStopPinkModeAnimatedIcons),appearanceContext&&appearanceContext.icons&&(appearanceContext.icons.startPinkModeAnimatedIcons=sessionStartPinkModeAnimatedIcons,appearanceContext.icons.stopPinkModeAnimatedIcons=sessionStopPinkModeAnimatedIcons,appearanceContext.icons.triggerPinkModeIconRain=sessionTriggerPinkModeIconRain);const t=buildThemePreferenceController(e);t&&(themePreferenceController=t,processPendingControls(themePreferenceController,pendingThemeControls));const o=buildPinkModePreferenceController(e);return o&&(pinkModePreferenceController=o,processPendingControls(pinkModePreferenceController,pendingPinkModeControls)),!0}function initializeAppearanceModule(e){if(!e||typeof e.initialize!="function")return!1;let t=null;try{t=e.initialize(appearanceContext)||null}catch(o){return typeof console<"u"&&console&&typeof console.error=="function"&&console.error("cineSettingsAppearance: initialize() threw.",o),!1}return!t||typeof t!="object"?!1:applyAppearanceModuleBindings(t)}function attemptAppearanceModuleInitialization(e){if(!appearanceModuleValidator(e))return!1;if(appearanceModuleInitialized)return!0;typeof document<"u"&&(appearanceContext.elements.darkModeToggle||(appearanceContext.elements.darkModeToggle=darkModeToggle||document.getElementById("darkModeToggle")),appearanceContext.elements.pinkModeToggle||(appearanceContext.elements.pinkModeToggle=pinkModeToggle||document.getElementById("pinkModeToggle")),appearanceContext.settings.darkMode||(appearanceContext.settings.darkMode=(typeof settingsDarkMode<"u"?settingsDarkMode:null)||document.getElementById("settingsDarkMode")),appearanceContext.settings.pinkMode||(appearanceContext.settings.pinkMode=(typeof settingsPinkMode<"u"?settingsPinkMode:null)||document.getElementById("settingsPinkMode")));const t=initializeAppearanceModule(e);return t&&(appearanceModuleInitialized=!0,clearAppearanceModuleUnavailableWarning()),t}const resolvedAppearanceModuleFactory=appearanceModuleValidator(appearanceModuleFactoryPlaceholder)?appearanceModuleFactoryPlaceholder:resolveModuleApi("cineSettingsAppearance",appearanceModuleValidator),appearanceModuleReady=attemptAppearanceModuleInitialization(resolvedAppearanceModuleFactory);if(!appearanceModuleReady){scheduleAppearanceModuleUnavailableWarning();const e={interval:200,maxAttempts:300,onTimeout:()=>{typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("cineSettingsAppearance module failed to load after waiting. Appearance features remain limited."),clearAppearanceModuleUnavailableWarning()}},t=o=>{const r=appearanceModuleInitialized;attemptAppearanceModuleInitialization(o)&&!r&&(clearAppearanceModuleUnavailableWarning(),typeof console<"u"&&console&&typeof console.info=="function"&&console.info("cineSettingsAppearance module became available after deferred load."))};whenGlobalValueAvailable("cineSettingsAppearance",appearanceModuleValidator,t,e),whenGlobalValueAvailable("cineModuleGlobals",o=>o&&typeof o.whenModuleAvailable=="function",o=>{if(appearanceModuleInitialized)return;let r=null;if(typeof o.getModule=="function")try{r=o.getModule("cineSettingsAppearance")}catch(n){r=null}if(appearanceModuleValidator(r)){t(r);return}if(typeof o.whenModuleAvailable=="function")try{o.whenModuleAvailable("cineSettingsAppearance",n=>{appearanceModuleValidator(n)&&t(n)})}catch(n){}},{interval:200,maxAttempts:150}),whenGlobalValueAvailable("cineModules",o=>o&&typeof o.get=="function",o=>{if(appearanceModuleInitialized)return;let r=null;try{r=o.get("cineSettingsAppearance")}catch(n){r=null}appearanceModuleValidator(r)&&t(r)},{interval:200,maxAttempts:150})}const CAMERA_LETTERS=["A","B","C","D","E"],CAMERA_COLOR_STORAGE_KEY_SESSION="cameraPowerPlanner_cameraColors";function normalizeCameraColorValue(e){if(typeof e!="string")return"";const t=e.trim();return t?/^#[0-9a-f]{6}$/i.test(t)?t.toLowerCase():/^[0-9a-f]{6}$/i.test(t)?`#${t.toLowerCase()}`:"":""}function generateDefaultCameraColor(e){const t=()=>{let r=0;if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(1);crypto.getRandomValues(a),r=a[0]/255}else r=Math.random();const n=Math.floor(r*200)+28;return Math.max(24,Math.min(232,n))};return`#${[t(),t(),t()].map(r=>r.toString(16).padStart(2,"0")).join("")}`}function getDefaultCameraLetterColors(){const e={A:"#d32f2f",B:"#1e88e5",C:"#fdd835",D:"#43a047",E:"#7b1fa2"},t=generateDefaultCameraColor();return t&&(e.E=t),e}let cachedCameraLetterColors=null;function loadCameraLetterColors(){if(cachedCameraLetterColors)return cachedCameraLetterColors;const e=getDefaultCameraLetterColors();let t=null;try{const r=localStorage.getItem(CAMERA_COLOR_STORAGE_KEY_SESSION);r&&(t=JSON.parse(r))}catch(r){console.warn("Failed to read stored camera colors",r),t=null}const o={...e};if(t&&typeof t=="object")CAMERA_LETTERS.forEach(r=>{const n=t[r]||t[r.toLowerCase()],a=normalizeCameraColorValue(n);a&&(o[r]=a)});else try{localStorage.setItem(CAMERA_COLOR_STORAGE_KEY_SESSION,JSON.stringify(o))}catch(r){console.warn("Unable to persist default camera colors",r)}return cachedCameraLetterColors=o,o}function getCameraLetterColorsSafeSession(){return{...loadCameraLetterColors()}}function applyCameraLetterColors(e={}){const t={...loadCameraLetterColors()};let o=!1;if(CAMERA_LETTERS.forEach(r=>{const n=e[r]||e[r.toLowerCase()],a=normalizeCameraColorValue(n);a&&t[r]!==a&&(t[r]=a,o=!0)}),!o)return t;cachedCameraLetterColors=t;try{localStorage.setItem(CAMERA_COLOR_STORAGE_KEY_SESSION,JSON.stringify(t))}catch(r){console.warn("Failed to persist camera color preferences",r)}if(typeof document<"u"&&typeof document.dispatchEvent=="function"&&typeof CustomEvent=="function")try{document.dispatchEvent(new CustomEvent("camera-colors-changed"))}catch(r){console.warn("Failed to broadcast camera color change",r)}return t}function getCameraColorInputElements(){return typeof document>"u"?[]:CAMERA_LETTERS.map(e=>{const t=`cameraColor${e}`;let o=null;try{o=typeof window<"u"&&window[t]?window[t]:document.getElementById(t)}catch{o=null}return o?{letter:e,element:o}:null}).filter(Boolean)}function updateCameraColorInputsFromState(){const e=getCameraLetterColorsSafeSession();getCameraColorInputElements().forEach(t=>{if(!t||!t.element)return;const o=e[t.letter]||"";o&&(t.element.value=o)})}function collectCameraColorInputValues(){const e={};return getCameraColorInputElements().forEach(t=>{if(!t||!t.element)return;const o=normalizeCameraColorValue(t.element.value||"");o&&(e[t.letter]=o)}),e}try{typeof window<"u"&&(window.getCameraLetterColors=()=>getCameraLetterColorsSafeSession(),window.setCameraLetterColors=e=>applyCameraLetterColors(e))}catch(e){console.warn("Unable to expose camera color helpers",e)}const themePreferenceGlobalScope=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null,setThemePreference=(e,t={})=>{const o=!!e;if(themePreferenceController&&typeof themePreferenceController.setValue=="function"){themePreferenceController.setValue(o,t);return}applyDarkMode$1(o);const r=o?"true":"false",n=[];try{if(typeof resolveSafeLocalStorage=="function"){const a=resolveSafeLocalStorage();a&&typeof a.setItem=="function"&&n.push({name:"safeLocalStorage",storage:a})}}catch(a){console.warn("Could not resolve SafeLocalStorage while persisting dark mode preference",a)}try{typeof localStorage<"u"&&n.push({name:"localStorage",storage:localStorage})}catch(a){console.warn("Could not access localStorage while persisting dark mode preference",a)}n.forEach(a=>{if(!(!a||!a.storage||typeof a.storage.setItem!="function"))try{a.storage.setItem("darkMode",r)}catch(s){console.warn(`Could not persist dark mode preference to ${a.name}`,s)}})},getThemePreference=()=>themePreferenceController&&typeof themePreferenceController.getValue=="function"?!!themePreferenceController.getValue():typeof document<"u"&&document.body&&typeof document.body.classList<"u"&&document.body.classList.contains("dark-mode"),registerThemeControl=(e,t)=>{if(themePreferenceController&&typeof themePreferenceController.registerControl=="function")return themePreferenceController.registerControl(e,t);let o=()=>{};return pendingThemeControls.push({element:e,config:t,callback:r=>{o=r}}),()=>o()},registerPinkModeControl=(e,t)=>{if(pinkModePreferenceController&&typeof pinkModePreferenceController.registerControl=="function")return pinkModePreferenceController.registerControl(e,t);let o=()=>{};return pendingPinkModeControls.push({element:e,options:t,callback:r=>{o=r}}),()=>o()};(darkModeToggle||typeof document<"u"&&document.getElementById("darkModeToggle"))&&registerThemeControl(darkModeToggle||document.getElementById("darkModeToggle"),{type:"button"});if(typeof settingsDarkMode<"u"||typeof document<"u"&&document.getElementById("settingsDarkMode")){const e=(typeof settingsDarkMode<"u"?settingsDarkMode:null)||document.getElementById("settingsDarkMode");e&&registerThemeControl(e,{type:"checkbox"})}if(!themePreferenceController){let e=!1;try{const t=typeof localStorage<"u"?localStorage.getItem("darkMode"):null;t!==null?e=t==="true":typeof window<"u"&&typeof window.matchMedia=="function"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches)}catch(t){console.warn("Could not load dark mode preference",t)}applyDarkMode$1(e)}if(themePreferenceGlobalScope)try{themePreferenceGlobalScope.cineThemePreference={registerControl:(e,t)=>{if(themePreferenceController&&typeof themePreferenceController.registerControl=="function")return themePreferenceController.registerControl(e,t);let o=()=>{};return pendingThemeControls.push({element:e,options:t,callback:r=>{o=r}}),()=>o()},setValue:(e,t)=>setThemePreference(e,t),getValue:()=>getThemePreference(),reloadFromStorage:e=>themePreferenceController&&typeof themePreferenceController.reloadFromStorage=="function"?themePreferenceController.reloadFromStorage(e):getThemePreference()},themePreferenceGlobalScope.cinePinkModePreference={registerControl:(e,t)=>{if(pinkModePreferenceController&&typeof pinkModePreferenceController.registerControl=="function")return pinkModePreferenceController.registerControl(e,t);let o=()=>{};return pendingPinkModeControls.push({element:e,options:t,callback:r=>{o=r}}),()=>o()},setValue:(e,t)=>pinkModePreferenceController&&typeof pinkModePreferenceController.setValue=="function"?pinkModePreferenceController.setValue(e,t):!1,getValue:()=>pinkModePreferenceController&&typeof pinkModePreferenceController.getValue=="function"?pinkModePreferenceController.getValue():isPinkModeActive(),reloadFromStorage:e=>pinkModePreferenceController&&typeof pinkModePreferenceController.reloadFromStorage=="function"?pinkModePreferenceController.reloadFromStorage(e):isPinkModeActive()}}catch(e){console.warn("Unable to expose theme preference bridge",e)}const PINK_MODE_STORAGE_KEY="cameraPowerPlanner_pinkMode",LEGACY_PINK_MODE_STORAGE_KEY="pinkMode";let sessionFocusScale$1=typeof focusScalePreference=="string"?focusScalePreference:"metric",highContrastEnabled=!1;try{highContrastEnabled=localStorage.getItem("highContrast")==="true"}catch(e){console.warn("Could not load high contrast preference",e)}applyHighContrast$1(highContrastEnabled);let fontSize="medium";try{const e=localStorage.getItem("fontSize");e&&(fontSize=e)}catch(e){console.warn("Could not load font size preference",e)}let fontFamily="inter";try{const e=localStorage.getItem("fontFamily");e&&(fontFamily=e)}catch(e){console.warn("Could not load font family preference",e)}typeof window<"u"&&(window.handlePinkModeIconPress=handlePinkModeIconPress,window.triggerPinkModeIconRain=sessionTriggerPinkModeIconRain,window.startPinkModeAnimatedIcons=sessionStartPinkModeAnimatedIcons,window.stopPinkModeAnimatedIcons=sessionStopPinkModeAnimatedIcons);let pinkModeEnabled=!1;try{let e=localStorage.getItem(PINK_MODE_STORAGE_KEY);(e==null||e==="")&&(e=localStorage.getItem(LEGACY_PINK_MODE_STORAGE_KEY)),pinkModeEnabled=e==="true"}catch(e){console.warn("Could not load pink mode preference",e)}applyPinkMode$1(pinkModeEnabled);rememberSettingsPinkModeBaseline();rememberSettingsTemperatureUnitBaseline();rememberSettingsFocusScaleBaseline();rememberSettingsShowAutoBackupsBaseline();rememberSettingsMountVoltagesBaseline();(pinkModeToggle||typeof document<"u"&&document.getElementById("pinkModeToggle"))&&registerPinkModeControl(pinkModeToggle||document.getElementById("pinkModeToggle"),{type:"button"});if(typeof settingsPinkMode<"u"||typeof document<"u"&&document.getElementById("settingsPinkMode")){const e=(typeof settingsPinkMode<"u"?settingsPinkMode:null)||document.getElementById("settingsPinkMode");e&&registerPinkModeControl(e,{type:"checkbox"})}settingsShowAutoBackups&&settingsShowAutoBackups.addEventListener("change",()=>{applyShowAutoBackupsPreference(settingsShowAutoBackups.checked)});settingsTemperatureUnit&&settingsTemperatureUnit.addEventListener("change",()=>{applyTemperatureUnitPreferenceWithFallback(settingsTemperatureUnit.value,{persist:!1})});typeof settingsFocusScale<"u"&&settingsFocusScale&&settingsFocusScale.addEventListener("change",()=>{typeof applyFocusScalePreference=="function"&&(applyFocusScalePreference(settingsFocusScale.value,{persist:!1}),sessionFocusScale$1=typeof normalizeFocusScale=="function"?normalizeFocusScale(settingsFocusScale.value):settingsFocusScale.value);try{populateLensDropdown()}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to refresh lens dropdown after focus scale change",e)}});typeof settingsFocusScale<"u"&&settingsFocusScale&&(settingsFocusScale.value=sessionFocusScale$1);const mountVoltageInputNodes=Array.from(typeof document<"u"?document.querySelectorAll(".mount-voltage-input"):[]);mountVoltageInputNodes.forEach(e=>{e.addEventListener("change",_safeHandleMountVoltageInputChange),e.addEventListener("blur",_safeHandleMountVoltageInputChange)});const mountVoltageResetButtonRef=(()=>{const e=[typeof CORE_GLOBAL_SCOPE$1<"u"&&CORE_GLOBAL_SCOPE$1&&typeof CORE_GLOBAL_SCOPE$1=="object"?CORE_GLOBAL_SCOPE$1:null,typeof globalThis<"u"&&typeof globalThis=="object"?globalThis:null,typeof window<"u"&&typeof window=="object"?window:null,typeof self<"u"&&typeof self=="object"?self:null,typeof global<"u"&&typeof global=="object"?global:null].filter(Boolean);for(let t=0;t<e.length;t+=1){const o=e[t],r=o&&o.mountVoltageResetButton;if(r)return r}return null})();mountVoltageResetButtonRef&&mountVoltageResetButtonRef.addEventListener("click",()=>{const e=getSessionRuntimeFunction("resetMountVoltagePreferences");if(e)try{e({persist:!1,triggerUpdate:!0})}catch(o){warnMissingMountVoltageHelper("resetMountVoltagePreferences",o)}else warnMissingMountVoltageHelper("resetMountVoltagePreferences");const t=getSessionRuntimeFunction("updateMountVoltageInputsFromState");if(t)try{t()}catch(o){warnMissingMountVoltageHelper("updateMountVoltageInputsFromState",o)}else warnMissingMountVoltageHelper("updateMountVoltageInputsFromState")});const initialSettingsButton=resolveSettingsButton(),initialSettingsDialog=resolveSettingsDialog();if(initialSettingsButton&&initialSettingsDialog){const e=initialSettingsButton,t=initialSettingsDialog;e.addEventListener("click",()=>{const s=consumeSettingsOpenContext({reason:"settings-button"}),l=typeof t.hasAttribute=="function"?t.hasAttribute("hidden"):null,u=typeof isDialogOpen=="function"?isDialogOpen(t):!!(t&&t.open);logSettingsEvent("info","Settings dialog open requested",{...s,openBefore:u,hiddenBefore:l},{action:"open-request"}),prevAccentColor=accentColor,rememberSettingsPinkModeBaseline(),rememberSettingsTemperatureUnitBaseline(),rememberSettingsFocusScaleBaseline(),rememberSettingsShowAutoBackupsBaseline(),rememberSettingsMountVoltagesBaseline();const d=getSessionRuntimeFunction("updateMountVoltageInputsFromState");if(d)try{d()}catch(C){warnMissingMountVoltageHelper("updateMountVoltageInputsFromState",C)}else warnMissingMountVoltageHelper("updateMountVoltageInputsFromState");if(settingsLanguage&&(settingsLanguage.value=currentLang),settingsDarkMode&&(settingsDarkMode.checked=getThemePreference()),settingsPinkMode&&(settingsPinkMode.checked=document.body.classList.contains("pink-mode")),settingsHighContrast&&(settingsHighContrast.checked=document.body.classList.contains("high-contrast")),settingsReduceMotion){const C=document.documentElement.classList.contains("reduce-motion");settingsReduceMotion.checked=C}if(settingsRelaxedSpacing){const C=document.documentElement.classList.contains("relaxed-spacing");settingsRelaxedSpacing.checked=C}if(settingsShowAutoBackups){const C=typeof showAutoBackups$1<"u"?showAutoBackups$1:!0;settingsShowAutoBackups.checked=C}if(accentColorInput){const C=localStorage.getItem("accentColor");accentColorInput.value=C||accentColor,typeof updateAccentColorResetButtonState=="function"&&updateAccentColorResetButtonState()}updateCameraColorInputsFromState(),settingsTemperatureUnit&&(settingsTemperatureUnit.value=localTemperatureUnit),settingsFontSize&&(settingsFontSize.value=fontSize),settingsFontFamily&&(settingsFontFamily.value=fontFamily),settingsLogo&&(settingsLogo.value=""),settingsLogoPreview&&safeLoadStoredLogoPreview(),updateStorageSummary(),autoGearEditor&&(closeAutoGearEditor(),callSessionCoreFunction("refreshAutoGearScenarioOptions"),callSessionCoreFunction("refreshAutoGearMatteboxOptions"),callSessionCoreFunction("refreshAutoGearCameraHandleOptions"),callSessionCoreFunction("refreshAutoGearViewfinderExtensionOptions"),callSessionCoreFunction("refreshAutoGearVideoDistributionOptions"),callSessionCoreFunction("refreshAutoGearCameraOptions",[],{defer:!0}),callSessionCoreFunction("refreshAutoGearMonitorOptions"),callSessionCoreFunction("refreshAutoGearWirelessOptions"),callSessionCoreFunction("refreshAutoGearMotorsOptions"),callSessionCoreFunction("refreshAutoGearControllersOptions"),callSessionCoreFunction("refreshAutoGearDistanceOptions"),populateAutoGearCategorySelect(autoGearAddCategorySelect,""),populateAutoGearCategorySelect(autoGearRemoveCategorySelect,""),renderAutoGearRulesList(),renderAutoGearDraftLists(),updateAutoGearCatalogOptions(),callSessionCoreFunction("renderAutoGearBackupControls",[],{defer:!0}),callSessionCoreFunction("applyAutoGearBackupVisibility",[],{defer:!0})),activeSettingsTabId&&activateSettingsTab(activeSettingsTabId),collapseBackupDiffSection(),t.removeAttribute("hidden"),openDialog(t),scheduleSettingsTabsOverflowUpdate();const y=t.querySelector(".settings-panel:not([hidden])")?.querySelector('input:not([type="hidden"]), select:not(#settingsLanguage), textarea');if(y)try{y.focus({preventScroll:!0})}catch{y.focus()}const h=typeof t.hasAttribute=="function"?t.hasAttribute("hidden"):null,b=typeof isDialogOpen=="function"?isDialogOpen(t):!!(t&&t.open),v={...s,openBefore:u,openAfter:b,hiddenAfter:h};logSettingsEvent(b?"info":"warn",b?"Settings dialog opened":"Settings dialog did not open",v,{action:"open-result"})}),settingsCancel&&settingsCancel.addEventListener("click",()=>{revertSettingsPinkModeIfNeeded(),rememberSettingsPinkModeBaseline(),revertSettingsTemperatureUnitIfNeeded(),rememberSettingsTemperatureUnitBaseline(),revertSettingsFocusScaleIfNeeded(),rememberSettingsFocusScaleBaseline(),revertSettingsShowAutoBackupsIfNeeded(),rememberSettingsShowAutoBackupsBaseline(),revertSettingsMountVoltagesIfNeeded(),rememberSettingsMountVoltagesBaseline(),invokeSessionRevertAccentColor(),settingsLogo&&(settingsLogo.value=""),settingsLogoPreview&&safeLoadStoredLogoPreview(),closeAutoGearEditor(),collapseBackupDiffSection(),closeDialog(t),t.setAttribute("hidden","")});const o=async()=>{if(!t)return;if(settingsLanguage&&(await applySetLanguage(settingsLanguage.value),typeof populateUserButtonDropdowns$1=="function"))try{populateUserButtonDropdowns$1()}catch(y){console.warn("Failed to refresh user button selectors after language change",y)}if(settingsDarkMode&&setThemePreference(settingsDarkMode.checked,{persist:!0}),settingsPinkMode&&persistPinkModePreference(settingsPinkMode.checked),settingsHighContrast){const y=settingsHighContrast.checked;applyHighContrast$1(y);try{localStorage.setItem("highContrast",y)}catch(h){console.warn("Could not save high contrast preference",h)}}if(settingsReduceMotion){const y=settingsReduceMotion.checked;applyReduceMotion(y);try{localStorage.setItem("reduceMotion",y)}catch(h){console.warn("Could not save reduce motion preference",h)}}if(settingsRelaxedSpacing){const y=settingsRelaxedSpacing.checked;applyRelaxedSpacing(y);try{localStorage.setItem("relaxedSpacing",y)}catch(h){console.warn("Could not save relaxed spacing preference",h)}}settingsShowAutoBackups&&applyShowAutoBackupsPreference(settingsShowAutoBackups.checked);const s=typeof document<"u"&&typeof document.getElementById=="function"?document.getElementById("autoGearShowBackups"):null;if(s&&callSessionCoreFunction("setAutoGearBackupsVisible",[!!s.checked]),accentColorInput){const y=accentColorInput.value;document.body.classList.contains("pink-mode")||applyAccentColor(y);try{normalizeAccentValueSafe(y)===DEFAULT_ACCENT_NORMALIZED?localStorage.removeItem("accentColor"):localStorage.setItem("accentColor",y)}catch(h){console.warn("Could not save accent color",h)}accentColor=y,prevAccentColor=y,typeof updateAccentColorResetButtonState=="function"&&updateAccentColorResetButtonState()}const l=collectCameraColorInputValues(),u=applyCameraLetterColors(l);if(getCameraColorInputElements().forEach(y=>{const h=u[y.letter];h&&(y.element.value=h)}),settingsTemperatureUnit){const y=typeof settingsTemperatureUnit.value=="string"?settingsTemperatureUnit.value:"celsius";applyTemperatureUnitPreferenceWithFallback(y),rememberSettingsTemperatureUnitBaseline()}if(typeof settingsFocusScale<"u"&&settingsFocusScale&&(typeof applyFocusScalePreference=="function"&&applyFocusScalePreference(settingsFocusScale.value),rememberSettingsFocusScaleBaseline(),sessionFocusScale$1=typeof normalizeFocusScale=="function"?normalizeFocusScale(settingsFocusScale.value):settingsFocusScale.value),applySessionMountVoltagePreferences(collectMountVoltageFormValues(),{persist:!0,triggerUpdate:!0}),rememberSettingsMountVoltagesBaseline(),settingsFontSize){const y=settingsFontSize.value;applyFontSizeSafe(y);try{localStorage.setItem("fontSize",y)}catch(h){console.warn("Could not save font size",h)}fontSize=y}if(settingsFontFamily){const y=settingsFontFamily.value;applyFontFamilySafe(y);try{localStorage.setItem("fontFamily",y)}catch(h){console.warn("Could not save font family",h)}fontFamily=y}const m=document.getElementById("settingsLogo");if(m&&m.files&&m.files[0]){const y=m.files[0];if(console.log("[Settings] Logo upload detected:",y.name,y.type,y.size),y.type==="image/svg+xml"||y.name.toLowerCase().endsWith(".svg")){console.log("[Settings] Logo format valid (SVG). Reading file...");const h=new FileReader;h.onload=b=>{if(!b.target.result){console.error("[Settings] FileReader result is empty"),showNotification$1("error","Failed to read logo file");return}console.log("[Settings] Logo file read success. Length:",b.target.result.length);try{localStorage.setItem("customLogo",b.target.result),console.log("[Settings] Logo saved to localStorage")}catch(v){console.warn("[Settings] Could not save custom logo to localStorage",v),showNotification$1("error","Failed to save logo to storage (quota exceeded?)")}renderSettingsLogoPreview(b.target.result)},h.onerror=b=>{console.error("[Settings] FileReader error:",b),showNotification$1("error","Error reading logo file")},h.readAsDataURL(y)}else console.warn("[Settings] Unsupported logo format:",y.type),showNotification$1("error",texts[currentLang].logoFormatError||"Unsupported logo format. Please use SVG."),m&&(m.value=""),safeLoadStoredLogoPreview()}else m&&m.files&&m.files.length===0||m||console.warn("[Settings] settingsLogo element not found during save");closeAutoGearEditor(),collapseBackupDiffSection(),rememberSettingsPinkModeBaseline(),rememberSettingsTemperatureUnitBaseline(),rememberSettingsFocusScaleBaseline(),rememberSettingsShowAutoBackupsBaseline(),rememberSettingsMountVoltagesBaseline(),closeDialog(t),t.setAttribute("hidden","")};settingsSave&&settingsSave.addEventListener("click",()=>{o()}),t.addEventListener("click",s=>{s.target===t&&o()}),t.addEventListener("cancel",s=>{s.preventDefault(),revertSettingsPinkModeIfNeeded(),rememberSettingsPinkModeBaseline(),revertSettingsTemperatureUnitIfNeeded(),rememberSettingsTemperatureUnitBaseline(),revertSettingsFocusScaleIfNeeded(),rememberSettingsFocusScaleBaseline(),revertSettingsShowAutoBackupsIfNeeded(),rememberSettingsShowAutoBackupsBaseline(),revertSettingsMountVoltagesIfNeeded(),rememberSettingsMountVoltagesBaseline(),invokeSessionRevertAccentColor(),settingsLogo&&(settingsLogo.value=""),settingsLogoPreview&&safeLoadStoredLogoPreview(),closeAutoGearEditor(),collapseBackupDiffSection(),closeDialog(t),t.setAttribute("hidden","")}),typeof autoGearAddRuleBtn<"u"&&autoGearAddRuleBtn&&autoGearAddRuleBtn.addEventListener("click",()=>{typeof invokeSessionOpenAutoGearEditor=="function"?invokeSessionOpenAutoGearEditor():typeof globalThis<"u"&&typeof globalThis.invokeSessionOpenAutoGearEditor=="function"?globalThis.invokeSessionOpenAutoGearEditor():typeof window<"u"&&typeof window.invokeSessionOpenAutoGearEditor=="function"&&window.invokeSessionOpenAutoGearEditor()}),typeof autoGearConditionSelect<"u"&&autoGearConditionSelect&&autoGearConditionSelect.addEventListener("change",()=>{typeof updateAutoGearConditionAddButtonState=="function"?updateAutoGearConditionAddButtonState():typeof globalThis<"u"&&typeof globalThis.updateAutoGearConditionAddButtonState=="function"&&globalThis.updateAutoGearConditionAddButtonState()}),typeof autoGearConditionAddButton<"u"&&autoGearConditionAddButton&&autoGearConditionAddButton.addEventListener("click",()=>{typeof addAutoGearConditionFromPicker=="function"?addAutoGearConditionFromPicker():typeof globalThis<"u"&&typeof globalThis.addAutoGearConditionFromPicker=="function"&&globalThis.addAutoGearConditionFromPicker()});const r=(()=>{let s=null;try{typeof autoGearScenarioModeSelect<"u"&&(s=autoGearScenarioModeSelect)}catch{}if(!s){const l=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null;l&&typeof l=="object"&&"autoGearScenarioModeSelect"in l&&(s=l.autoGearScenarioModeSelect||null)}if(!s&&typeof document<"u"&&document&&typeof document.getElementById=="function")try{s=document.getElementById("autoGearScenarioMode")||null}catch{}return s})();if(r&&typeof r.addEventListener=="function"&&r.addEventListener("change",()=>{if(autoGearEditorDraft){const s=typeof r.value=="string"?r.value:"";autoGearEditorDraft.scenarioLogic=normalizeAutoGearScenarioLogic(s)}applyAutoGearScenarioSettings(getAutoGearScenarioSelectedValues())}),typeof autoGearScenarioBaseSelect<"u"&&autoGearScenarioBaseSelect&&autoGearScenarioBaseSelect.addEventListener("change",()=>{autoGearEditorDraft&&(autoGearEditorDraft.scenarioPrimary=_safeNormalizeAutoGearScenarioPrimary(autoGearScenarioBaseSelect.value))}),typeof autoGearScenarioFactorInput<"u"&&autoGearScenarioFactorInput){const s=()=>{autoGearEditorDraft&&(autoGearEditorDraft.scenarioMultiplier=_safeNormalizeAutoGearScenarioMultiplier(autoGearScenarioFactorInput.value))};autoGearScenarioFactorInput.addEventListener("change",s),autoGearScenarioFactorInput.addEventListener("input",s)}typeof autoGearConditionList<"u"&&autoGearConditionList&&autoGearConditionList.addEventListener("click",s=>{const l=s.target instanceof HTMLElement?s.target.closest("button"):null;if(l){if(l.classList.contains("auto-gear-condition-remove")){const u=l.dataset.condition||"";u&&_safeRemoveAutoGearCondition(u,{focusPicker:!0});return}l.classList.contains("auto-gear-condition-add")&&_safeHandleAutoGearConditionShortcut()}});const n=()=>{if(typeof resetAutoGearRulesToFactoryAdditions=="function")return resetAutoGearRulesToFactoryAdditions;if(typeof globalThis<"u"&&typeof globalThis.resetAutoGearRulesToFactoryAdditions=="function")return globalThis.resetAutoGearRulesToFactoryAdditions;const s=resolveModuleApi("cineFeatureAutoGearRules",l=>l&&typeof l.resetAutoGearRulesToFactoryAdditions=="function");return s&&typeof s.resetAutoGearRulesToFactoryAdditions=="function"?s.resetAutoGearRulesToFactoryAdditions:null};if(typeof autoGearResetFactoryButton<"u"&&autoGearResetFactoryButton){let s=null;const l=()=>{if(s!==null){try{clearTimeout(s)}catch{}s=null}},u=()=>{typeof console<"u"&&typeof console.warn=="function"&&!h&&console.warn("Automatic gear reset action unavailable: reset handler missing.")},d=()=>{if(s===null){if(typeof setTimeout!="function"){u();return}s=setTimeout(()=>{s=null,u()},1500)}},m=()=>{autoGearResetFactoryButton.disabled=!1,autoGearResetFactoryButton.setAttribute("aria-disabled","false")},y=()=>{autoGearResetFactoryButton.disabled=!0,autoGearResetFactoryButton.setAttribute("aria-disabled","true")};let h=!1;const b=A=>h||typeof A!="function"?!1:(autoGearResetFactoryButton.addEventListener("click",A),m(),h=!0,l(),!0),v=n(),C=(A,w={})=>b(A)?(w.logReenabledReason==="deferredModuleLoad"&&typeof console<"u"&&typeof console.info=="function"&&console.info("Automatic gear reset action re-enabled after deferred module load."),!0):!1;C(v)||(y(),d(),whenGlobalValueAvailable("resetAutoGearRulesToFactoryAdditions",A=>typeof A=="function",A=>{C(A,{logReenabledReason:"deferredModuleLoad"})},{interval:200,maxAttempts:300,onTimeout:()=>{l(),typeof console<"u"&&typeof console.warn=="function"&&console.warn("Automatic gear reset action unavailable after waiting for handler registration.")}}),whenGlobalValueAvailable("cineModuleGlobals",A=>A&&typeof A.whenModuleAvailable=="function",A=>{if(h)return;const w=R=>{R&&typeof R.resetAutoGearRulesToFactoryAdditions=="function"&&C(R.resetAutoGearRulesToFactoryAdditions,{logReenabledReason:"deferredModuleLoad"})};if(typeof A.getModule=="function")try{const R=A.getModule("cineFeatureAutoGearRules");w(R)}catch(R){}if(!h&&typeof A.whenModuleAvailable=="function")try{A.whenModuleAvailable("cineFeatureAutoGearRules",R=>{w(R)})}catch(R){}},{interval:200,maxAttempts:150}),whenGlobalValueAvailable("cineModules",A=>A&&typeof A.get=="function",A=>{if(!h)try{const w=A.get("cineFeatureAutoGearRules");w&&typeof w.resetAutoGearRulesToFactoryAdditions=="function"&&C(w.resetAutoGearRulesToFactoryAdditions)}catch(w){}},{interval:200,maxAttempts:150}))}if(typeof autoGearExportButton<"u"&&autoGearExportButton&&autoGearExportButton.addEventListener("click",()=>{callSessionCoreFunction("exportAutoGearRules",[],{defer:!0})}),typeof autoGearImportButton<"u"&&autoGearImportButton&&typeof autoGearImportInput<"u"&&autoGearImportInput&&(autoGearImportButton.addEventListener("click",()=>{autoGearImportInput.click()}),autoGearImportInput.addEventListener("change",_safeHandleAutoGearImportSelection)),typeof autoGearSearchInput<"u"&&autoGearSearchInput){const s=l=>{_safeSetAutoGearSearchQuery(l?.target?.value||"")};autoGearSearchInput.addEventListener("input",s),autoGearSearchInput.addEventListener("search",s)}typeof autoGearFilterScenarioSelect<"u"&&autoGearFilterScenarioSelect&&autoGearFilterScenarioSelect.addEventListener("change",s=>{_safeSetAutoGearScenarioFilter(s?.target?.value||"all")}),typeof autoGearFilterClearButton<"u"&&autoGearFilterClearButton&&autoGearFilterClearButton.addEventListener("click",_safeClearAutoGearFilters),typeof autoGearSummaryCards<"u"&&autoGearSummaryCards&&autoGearSummaryCards.addEventListener("click",s=>{const l=s.target instanceof HTMLElement?s.target.closest(".auto-gear-summary-action"):null;if(!l||l.disabled)return;const u=l.dataset.focus||"all";_safeSetAutoGearSummaryFocus(u)}),autoGearSummaryDetails&&autoGearSummaryDetails.addEventListener("click",s=>{const l=s.target instanceof HTMLElement?s.target:null;if(!l)return;const u=l.closest("button[data-auto-gear-scenario]");if(u){const y=u.dataset.autoGearScenario||"";y&&(setAutoGearSummaryFocus("all"),setAutoGearScenarioFilter(y));return}const d=l.closest("button[data-auto-gear-rule]");if(d){focusAutoGearRuleById(d.dataset.autoGearRule||"");return}l.closest("button[data-auto-gear-summary-reset]")&&setAutoGearSummaryFocus("all")}),typeof autoGearPresetSelect<"u"&&autoGearPresetSelect&&autoGearPresetSelect.addEventListener("change",_safeHandleAutoGearPresetSelection),typeof autoGearSavePresetButton<"u"&&autoGearSavePresetButton&&autoGearSavePresetButton.addEventListener("click",_safeHandleAutoGearSavePreset),typeof autoGearDeletePresetButton<"u"&&autoGearDeletePresetButton&&autoGearDeletePresetButton.addEventListener("click",_safeHandleAutoGearDeletePreset),typeof autoGearAddItemButton<"u"&&autoGearAddItemButton&&autoGearAddItemButton.addEventListener("click",()=>_safeAddAutoGearDraftItem("add")),typeof autoGearRemoveItemButton<"u"&&autoGearRemoveItemButton&&autoGearRemoveItemButton.addEventListener("click",()=>_safeAddAutoGearDraftItem("remove")),typeof autoGearSaveRuleButton<"u"&&autoGearSaveRuleButton&&autoGearSaveRuleButton.addEventListener("click",_safeSaveAutoGearRuleFromEditor),typeof autoGearCancelEditButton<"u"&&autoGearCancelEditButton&&autoGearCancelEditButton.addEventListener("click",()=>{_safeCloseAutoGearEditor(),_safeRenderAutoGearDraftLists()}),typeof autoGearRulesList<"u"&&autoGearRulesList&&(autoGearRulesList.addEventListener("click",s=>{const l=s.target,u=l&&typeof l.closest=="function"?l.closest("button"):null;if(u){if(u.classList.contains("auto-gear-edit")){const d=u.dataset.ruleId||"",m=u.dataset.ruleIndex,y={};m!==void 0&&(y.ruleIndex=m),_safeInvokeSessionOpenAutoGearEditor(d,y)}else if(u.classList.contains("auto-gear-duplicate")){const d=u.dataset.ruleId||"";_safeDuplicateAutoGearRule(d,u.dataset.ruleIndex)}else if(u.classList.contains("auto-gear-delete")){const d=u.dataset.ruleId||"",m=u.dataset.ruleIndex;callSessionCoreFunction("deleteAutoGearRule",m!==void 0?[d,m]:[d])}}}),autoGearRulesList.addEventListener("change",s=>{const l=s.target;if(!(!l||!(l instanceof HTMLElement))&&l.classList.contains("auto-gear-enabled-toggle")){const u=l.dataset.ruleId||"",d=l.dataset.ruleIndex;callSessionCoreFunction("setAutoGearRuleEnabled",[u,l.checked,d])}})),typeof autoGearBackupSelect<"u"&&autoGearBackupSelect&&autoGearBackupSelect.addEventListener("change",()=>{_safeUpdateAutoGearBackupRestoreButtonState()}),typeof autoGearShowBackupsCheckbox<"u"&&autoGearShowBackupsCheckbox&&autoGearShowBackupsCheckbox.addEventListener("change",_safeHandleAutoGearShowBackupsToggle),typeof autoGearBackupRestoreButton<"u"&&autoGearBackupRestoreButton&&autoGearBackupRestoreButton.addEventListener("click",()=>{if(!autoGearBackupSelect)return;const s=autoGearBackupSelect.value;s&&_safeRestoreAutoGearBackup(s)}),typeof autoGearAddCategorySelect<"u"&&autoGearAddCategorySelect&&autoGearAddCategorySelect.addEventListener("change",_safeSyncAutoGearMonitorFieldVisibility),typeof autoGearRemoveCategorySelect<"u"&&autoGearRemoveCategorySelect&&autoGearRemoveCategorySelect.addEventListener("change",_safeSyncAutoGearMonitorFieldVisibility);const a=(s,l)=>{if(!s)return;const u=()=>{_safeUpdateAutoGearMonitorCatalogOptions(s.value,l)};s.addEventListener("change",u),l&&(l.addEventListener("focus",u),l.addEventListener("click",u)),u()};typeof autoGearAddSelectorTypeSelect<"u"&&typeof autoGearAddSelectorDefaultInput<"u"&&a(autoGearAddSelectorTypeSelect,autoGearAddSelectorDefaultInput),typeof autoGearRemoveSelectorTypeSelect<"u"&&typeof autoGearRemoveSelectorDefaultInput<"u"&&a(autoGearRemoveSelectorTypeSelect,autoGearRemoveSelectorDefaultInput),typeof autoGearEditor<"u"&&autoGearEditor&&autoGearEditor.addEventListener("click",s=>{const l=s.target;if(l){if(l.classList.contains("auto-gear-remove-entry")){const d=l.dataset.listType==="remove"?"remove":"add",m=l.dataset.itemId;if(!autoGearEditorDraft||!m)return;const y=d==="remove"?autoGearEditorDraft.remove:autoGearEditorDraft.add,h=y.findIndex(b=>b.id===m);h>=0&&(y.splice(h,1),autoGearEditorActiveItem&&autoGearEditorActiveItem.listType===d&&autoGearEditorActiveItem.itemId===m&&_safeClearAutoGearDraftItemEdit(d,{skipRender:!0}),_safeRenderAutoGearDraftLists(),_safeUpdateAutoGearCatalogOptions());return}l.classList.contains("auto-gear-edit-entry")&&_safeBeginAutoGearDraftItemEdit(l.dataset.listType,l.dataset.itemId)}})}_safeSyncAutoGearMonitorFieldVisibility();const removeNode=e=>{if(!e||typeof e!="object")return;try{if(typeof e.remove=="function"){e.remove();return}}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to remove node via native remove()",o)}const t=e.parentNode;t&&typeof t.removeChild=="function"&&t.removeChild(e)},getNotificationAccentColor=()=>{const e=typeof accentColor=="string"&&accentColor?accentColor:DEFAULT_ACCENT_COLOR;return getCssVariableValue("--accent-color",e)||e},getNotificationTextColor=e=>{try{if(typeof computeRelativeLuminance=="function"){const t=parseColorToRgb(e);if(t)return computeRelativeLuminance(t)>.55?"#000000":"#ffffff"}}catch(t){console.warn("Failed to determine notification text color",t)}return"#ffffff"},getNotificationTopOffset=()=>{let t=16;try{const o=document.getElementById("topBar");if(o&&typeof o.getBoundingClientRect=="function"){const r=o.getBoundingClientRect();r&&typeof r.bottom=="number"&&r.bottom>0&&(t=Math.max(t,r.bottom+16))}}catch(o){console.warn("Failed to measure top bar for notifications",o)}return`${Math.ceil(t)}px`};let notificationContainerEnsureScheduled=!1;const scheduleNotificationContainerEnsure=()=>{if(notificationContainerEnsureScheduled)return;notificationContainerEnsureScheduled=!0;const e=()=>{notificationContainerEnsureScheduled=!1;try{ensureNotificationContainer()}catch(t){console.warn("Failed to ensure notification container after scheduling",t)}};typeof requestAnimationFrame=="function"?requestAnimationFrame(e):typeof setTimeout=="function"&&setTimeout(e,16)},ensureNotificationContainer=()=>{if(typeof document>"u")return null;const e="backupNotificationContainer";let t=document.getElementById(e),o=!1;if(!t&&typeof window<"u"){const n=window.__cineLoadingNotice;if(n&&typeof n.ensureContainer=="function")try{t=n.ensureContainer()}catch(a){console.warn("Failed to reuse bootstrap notification container",a),t=null}}t||(t=document.createElement("div"),t.id=e,t.style.position="fixed",t.style.right="1rem",t.style.zIndex="10000",o=!0),t.classList&&!t.classList.contains("cine-notification-stack")&&t.classList.add("cine-notification-stack"),t.dataset&&t.dataset.bootstrap&&delete t.dataset.bootstrap;const r=typeof document.body<"u"&&document.body?document.body:typeof document.documentElement<"u"?document.documentElement:null;if(r?(t.parentNode!==r&&r.appendChild(t),t.style.top=getNotificationTopOffset()):t.parentNode||scheduleNotificationContainerEnsure(),o&&typeof document.addEventListener=="function"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{try{ensureNotificationContainer()}catch(n){console.warn("Failed to ensure notification container after DOMContentLoaded",n)}},{once:!0}):scheduleNotificationContainerEnsure()),typeof window<"u"){const n=window.__cineLoadingNotice;n&&typeof n=="object"&&(n.container=t)}return t};function showNotification$1(e,t){if(typeof document>"u")return;const o=ensureNotificationContainer();if(!o)return;const r=document.createElement("div");r.textContent=t,r.style.padding="0.75rem 1.25rem",r.style.marginTop="0.5rem",r.style.borderRadius="0.75rem",r.style.border="none",r.style.boxShadow="0 0.75rem 2.5rem rgba(0, 0, 0, 0.14)";const n=getNotificationAccentColor(),a=getNotificationTextColor(n);r.style.background=n,r.style.color=a,o.appendChild(r),setTimeout(()=>{removeNode(r),o.children.length||removeNode(o)},4e3)}const AUTO_BACKUP_INDICATOR_ID="cineAutoBackupIndicator",AUTO_BACKUP_INDICATOR_SPINNER_STYLE_ID="cineAutoBackupSpinnerStyles";let autoBackupIndicatorRefCount=0;const ensureAutoBackupSpinnerStyles=()=>{if(typeof document>"u"||document.getElementById(AUTO_BACKUP_INDICATOR_SPINNER_STYLE_ID))return;const e=document.createElement("style");e.id=AUTO_BACKUP_INDICATOR_SPINNER_STYLE_ID,e.textContent=`@keyframes cineAutoBackupSpinnerRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }`,document.head.appendChild(e)},showAutoBackupActivityIndicator=e=>{if(typeof document>"u")return()=>{};const t=ensureNotificationContainer();if(!t)return()=>{};ensureAutoBackupSpinnerStyles();let o=document.getElementById(AUTO_BACKUP_INDICATOR_ID);if(!o){o=document.createElement("div"),o.id=AUTO_BACKUP_INDICATOR_ID,o.style.display="flex",o.style.alignItems="center",o.style.gap="0.75rem",o.style.padding="0.75rem 1.25rem",o.style.marginTop="0.5rem",o.style.borderRadius="0.75rem",o.style.border="none",o.style.boxShadow="0 0.75rem 2.5rem rgba(0, 0, 0, 0.14)",o.style.background="rgba(32, 40, 62, 0.92)",o.style.color="#ffffff",o.setAttribute("role","status"),o.setAttribute("aria-live","polite");const n=document.createElement("span");n.style.display="inline-block",n.style.width="1.5rem",n.style.height="1.5rem",n.style.borderRadius="50%",n.style.border="0.2rem solid rgba(255, 255, 255, 0.3)",n.style.borderTopColor="#ffffff",n.style.animation="cineAutoBackupSpinnerRotate 1s linear infinite",n.setAttribute("aria-hidden","true"),o.appendChild(n);const a=document.createElement("span");a.className="auto-backup-indicator-text",o.appendChild(a),t.appendChild(o)}const r=o.querySelector(".auto-backup-indicator-text");return r&&(r.textContent=e),autoBackupIndicatorRefCount+=1,o.dataset.count=String(autoBackupIndicatorRefCount),o.style.display="flex",()=>{autoBackupIndicatorRefCount=Math.max(0,autoBackupIndicatorRefCount-1),autoBackupIndicatorRefCount===0&&(removeNode(o),t.children.length||removeNode(t))}},GLOBAL_LOADING_INDICATOR_ID="cineGlobalLoadingIndicator";let globalLoadingIndicatorRefCount=0;const GLOBAL_LOADING_INDICATOR_MESSAGE_KEYS={default:"globalLoadingIndicator",preparing:"globalLoadingIndicatorPreparing",modules:"globalLoadingIndicatorModules",data:"globalLoadingIndicatorData",almost:"globalLoadingIndicatorAlmostReady"},resolveGlobalLoadingIndicatorMessage=e=>{if(typeof e=="string"&&e.trim())return e.trim();const t=texts&&typeof currentLang=="string"&&currentLang&&texts[currentLang]?texts[currentLang]:null,o=texts&&typeof texts.en=="object"&&texts.en?texts.en:null,r=t&&typeof t.globalLoadingIndicator=="string"?t.globalLoadingIndicator.trim():"";if(r)return r;const n=o&&typeof o.globalLoadingIndicator=="string"?o.globalLoadingIndicator.trim():"";return n||"Loading…"},resolveGlobalLoadingIndicatorMessageByKey=(e,t)=>{const o=typeof e=="string"&&e.trim()?e.trim():"",r=o&&GLOBAL_LOADING_INDICATOR_MESSAGE_KEYS[o]?GLOBAL_LOADING_INDICATOR_MESSAGE_KEYS[o]:GLOBAL_LOADING_INDICATOR_MESSAGE_KEYS.default,n=texts&&typeof currentLang=="string"&&currentLang&&texts[currentLang]?texts[currentLang]:null,a=texts&&typeof texts.en=="object"&&texts.en?texts.en:null;let s="";r&&n&&typeof n[r]=="string"&&(s=n[r].trim()),!s&&r&&a&&typeof a[r]=="string"&&(s=a[r].trim());const l=typeof t=="string"&&t.trim()?t.trim():"";return!s&&l&&(s=l),s||(s=resolveGlobalLoadingIndicatorMessage(l)),s||"Loading…"},syncBootstrapLoadingNoticeLocalization=()=>{if(typeof window>"u")return;const e=window.__cineLoadingNotice;if(!e||typeof e.applyLocalization!="function")return;const t=typeof e.getFallbackMessages=="function"?e.getFallbackMessages():{};e.applyLocalization({preparing:resolveGlobalLoadingIndicatorMessageByKey("preparing",t.preparing||""),modules:resolveGlobalLoadingIndicatorMessageByKey("modules",t.modules||""),data:resolveGlobalLoadingIndicatorMessageByKey("data",t.data||""),almost:resolveGlobalLoadingIndicatorMessageByKey("almost",t.almost||"")})},refreshGlobalLoadingIndicatorText=()=>{if(typeof document>"u")return;const e=document.getElementById(GLOBAL_LOADING_INDICATOR_ID);if(!e)return;const t=e.querySelector(".global-loading-indicator-text");if(!t)return;syncBootstrapLoadingNoticeLocalization();const o=e.dataset.messageMode||"auto";if(o==="custom"){const n=e.dataset.customMessage||"";n&&(t.textContent=n);return}if(o==="key"){const n=e.dataset.messageKey||"default",a=e.dataset.fallbackMessage||"",s=resolveGlobalLoadingIndicatorMessageByKey(n,a);t.textContent=s,e.dataset.currentMessage=s;return}const r=resolveGlobalLoadingIndicatorMessage();t.textContent=r,e.dataset.currentMessage=r},GLOBAL_LOADING_INDICATOR_MIN_DISPLAY_MS=260,setGlobalLoadingIndicatorMessageByKey=(e,t)=>{if(typeof document>"u")return;const o=document.getElementById(GLOBAL_LOADING_INDICATOR_ID);if(!o)return;const r=typeof e=="string"&&e.trim()?e.trim():"default",n=resolveGlobalLoadingIndicatorMessageByKey(r,t||""),a=o.querySelector(".global-loading-indicator-text");o.dataset.messageMode="key",o.dataset.messageKey=r,typeof t=="string"&&t.trim()?o.dataset.fallbackMessage=t.trim():delete o.dataset.fallbackMessage,o.dataset.currentMessage=n,a&&(a.textContent=n),syncBootstrapLoadingNoticeLocalization()},getHighResolutionTimestamp=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),showGlobalLoadingIndicator=e=>{if(typeof document>"u")return()=>{};const t=ensureNotificationContainer();if(!t)return()=>{};ensureAutoBackupSpinnerStyles();const o=typeof window<"u"?window.__cineLoadingNotice:null;let r=document.getElementById(GLOBAL_LOADING_INDICATOR_ID);if(!r&&o&&typeof o.ensureIndicator=="function")try{r=o.ensureIndicator()}catch(y){console.warn("Failed to adopt bootstrap loading indicator",y),r=null}r||(r=document.createElement("div"),r.id=GLOBAL_LOADING_INDICATOR_ID),r.setAttribute("role","status"),r.setAttribute("aria-live","polite"),r.setAttribute("aria-busy","true"),r.dataset&&r.dataset.bootstrap&&delete r.dataset.bootstrap,r.classList?r.classList.add("cine-notification","cine-notification--loading"):r.className=[r.className||"","cine-notification","cine-notification--loading"].join(" ").trim();let n=r.querySelector(".cine-notification__spinner");n||(n=document.createElement("span"),n.className="cine-notification__spinner",n.setAttribute("aria-hidden","true"),r.insertBefore(n,r.firstChild));let a=r.querySelector(".global-loading-indicator-text");if(a||(a=document.createElement("span"),a.className="global-loading-indicator-text",r.appendChild(a)),r.parentNode!==t&&t.appendChild(r),o&&typeof o.setBusy=="function")try{o.setBusy(!0)}catch(y){console.warn("Failed to mark bootstrap loading indicator busy",y)}syncBootstrapLoadingNoticeLocalization();const s=!!(e&&typeof e=="string"&&e.trim());let l;s?(l=resolveGlobalLoadingIndicatorMessage(e),r.dataset.messageMode="custom",r.dataset.customMessage=l):r.dataset.messageMode==="key"&&r.dataset.messageKey?(l=resolveGlobalLoadingIndicatorMessageByKey(r.dataset.messageKey,r.dataset.fallbackMessage||""),r.dataset.currentMessage=l,r.dataset.customMessage=""):(l=resolveGlobalLoadingIndicatorMessage(),r.dataset.messageMode="auto",r.dataset.customMessage="",r.dataset.currentMessage=l),a&&(a.textContent=l),o&&typeof o.ensureIndicator=="function"&&(o.indicator=r),globalLoadingIndicatorRefCount=Math.max(0,globalLoadingIndicatorRefCount),globalLoadingIndicatorRefCount+=1,r.dataset.count=String(globalLoadingIndicatorRefCount),r.style.display="flex";const u=getHighResolutionTimestamp();let d=!1;const m=()=>{if(!d&&(d=!0,globalLoadingIndicatorRefCount=Math.max(0,globalLoadingIndicatorRefCount-1),r.dataset.count=String(globalLoadingIndicatorRefCount),globalLoadingIndicatorRefCount===0)){if(r.setAttribute("aria-busy","false"),o&&typeof o.setBusy=="function")try{o.setBusy(!1)}catch(y){console.warn("Failed to clear bootstrap loading indicator busy state",y)}removeNode(r),t.children.length||removeNode(t),o&&typeof o=="object"&&(o.indicator=null)}};return()=>{if(d)return;const y=getHighResolutionTimestamp()-u;if(y<GLOBAL_LOADING_INDICATOR_MIN_DISPLAY_MS){const h=GLOBAL_LOADING_INDICATOR_MIN_DISPLAY_MS-y;if(typeof setTimeout=="function"){setTimeout(m,Math.max(16,h));return}}m()}};try{const e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:null;e&&(e.__cineShowAutoBackupIndicator=showAutoBackupActivityIndicator,e.__cineShowGlobalLoadingIndicator=showGlobalLoadingIndicator,e.__cineSetGlobalLoadingIndicatorMessageKey=setGlobalLoadingIndicatorMessageByKey)}catch(e){console.warn("Failed to expose auto backup indicator helper",e)}const installGlobalFetchLoadingIndicator=()=>{const e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:null;if(!e||typeof e.fetch!="function"||e.__cineFetchWithLoadingIndicatorInstalled)return;const t=e.fetch,o=()=>resolveGlobalLoadingIndicatorMessage(),r=typeof e.__cineShowGlobalLoadingIndicator=="function"?e.__cineShowGlobalLoadingIndicator:showGlobalLoadingIndicator,n=a=>{if(typeof a=="function")try{a()}catch(s){console.warn("Failed to hide global loading indicator after fetch",s)}};e.fetch=function(s,l){let u=null;try{u=r(o())}catch(m){console.warn("Failed to show global loading indicator before fetch",m),u=null}let d;try{d=t.apply(this,arguments)}catch(m){throw n(u),m}return!d||typeof d.then!="function"?(n(u),d):typeof d.finally=="function"?d.finally(()=>{n(u)}):d.then(m=>(n(u),m),m=>{throw n(u),m})},e.__cineFetchWithLoadingIndicatorInstalled=!0};try{installGlobalFetchLoadingIndicator()}catch(e){console.warn("Failed to install global loading indicator for fetch",e)}typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("languagechange",()=>{try{refreshGlobalLoadingIndicatorText()}catch(e){console.warn("Failed to refresh global loading indicator after language change",e)}});const INITIAL_LOADING_INDICATOR_IDLE_TIMEOUT_MS=480;let initialLoadingIndicatorHide=null,initialLoadingIndicatorStarted=!1,initialLoadingIndicatorSettled=!1;const ensureInitialLoadingIndicatorVisible=()=>{if(!(initialLoadingIndicatorStarted||initialLoadingIndicatorSettled)&&typeof showGlobalLoadingIndicator=="function")try{const e=showGlobalLoadingIndicator();typeof e=="function"?initialLoadingIndicatorHide=e:initialLoadingIndicatorHide=null,initialLoadingIndicatorStarted=!0}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to show initial global loading indicator",e),initialLoadingIndicatorHide=null,initialLoadingIndicatorStarted=!1}},hideInitialLoadingIndicatorSafely=()=>{const e=initialLoadingIndicatorHide;if(initialLoadingIndicatorHide=null,initialLoadingIndicatorStarted=!1,typeof e=="function")try{e()}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to hide initial global loading indicator",t)}},finalizeInitialLoadingIndicator=()=>{if(initialLoadingIndicatorSettled||(initialLoadingIndicatorSettled=!0,!initialLoadingIndicatorStarted&&!initialLoadingIndicatorHide))return;const e=()=>{if(typeof requestIdleCallback=="function"){requestIdleCallback(hideInitialLoadingIndicatorSafely,{timeout:INITIAL_LOADING_INDICATOR_IDLE_TIMEOUT_MS});return}if(typeof setTimeout=="function"){setTimeout(hideInitialLoadingIndicatorSafely,GLOBAL_LOADING_INDICATOR_MIN_DISPLAY_MS);return}hideInitialLoadingIndicatorSafely()};typeof requestAnimationFrame=="function"?requestAnimationFrame(e):e()};function getDiffText(e,t=""){if(typeof e!="string"||!e)return typeof t=="string"?t:`${t??""}`;const o=typeof t=="string"?t:`${t??""}`,r=texts&&typeof currentLang=="string"&&currentLang&&texts[currentLang]?texts[currentLang]:null,n=texts&&typeof texts.en=="object"?texts.en:null,a=u=>{if(!u||typeof u!="object"||!Object.prototype.hasOwnProperty.call(u,e))return null;const d=u[e];if(typeof d!="string")return null;const m=d.trim();return m||null},s=a(r);if(s)return s;const l=a(n);return l||o}function formatTimestampForComparison(e,t){if(!(e instanceof Date)||Number.isNaN(e.valueOf()))return"";const o=typeof currentLang=="string"&&currentLang?currentLang:"en",r={year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"};t&&(r.second="2-digit");try{return new Intl.DateTimeFormat(o,r).format(e)}catch(n){if(o!=="en")try{return new Intl.DateTimeFormat("en",r).format(e)}catch(a){console.warn("Date formatting failed for comparison timestamp",n,a)}else console.warn("Date formatting failed for comparison timestamp",n)}return e.toISOString()}function formatComparisonOptionLabel(e,t){if(typeof e!="string")return"";const o=t||parseAutoBackupName(e);if(!o)return`${getDiffText("versionCompareManualLabel","Manual save")} · ${e}`;const r=o.type==="auto-backup-before-delete"?getDiffText("versionCompareAutoDeleteLabel","Auto backup before delete"):getDiffText("versionCompareAutoLabel","Auto backup"),n=formatTimestampForComparison(o.date,o.includeSeconds),a=o.label?` · ${o.label}`:"";return n?`${r} · ${n}${a}`:`${r}${a?` · ${a}`:""}`}function collectBackupDiffOptions(){const e=[],t=typeof getSetups=="function"?getSetups():{};if(t&&typeof t=="object"){const o=Object.keys(t).filter(r=>typeof r=="string"&&r).map(r=>{const n=parseAutoBackupName(r),a=formatComparisonOptionLabel(r,n),s=n&&n.date instanceof Date&&!Number.isNaN(n.date.valueOf());return{value:r,label:a,data:t[r],parsed:n,timestamp:s?n.date.getTime():null}}).sort((r,n)=>{const a=!!r.parsed,s=!!n.parsed;if(a!==s)return a?1:-1;if(a&&s){const l=typeof r.timestamp=="number"?r.timestamp:null,u=typeof n.timestamp=="number"?n.timestamp:null;if(l!==null&&u!==null&&l!==u)return u-l;if(l!==null&&u===null)return-1;if(l===null&&u!==null)return 1}return localeSort(r.label,n.label)}).map(({parsed:r,timestamp:n,...a})=>a);e.push(...o)}return e}function fillBackupDiffSelect(e,t,o){if(!e)return;const r=getDiffText("versionCompareSelectPlaceholder","Select a version"),n=document.createDocumentFragment(),a=document.createElement("option");a.value="",a.textContent=r,a.disabled=t.length>0,a.selected=!0,n.appendChild(a),t.forEach(s=>{const l=document.createElement("option");l.value=s.value,l.textContent=s.label,n.appendChild(l)}),e.innerHTML="",e.appendChild(n),o&&t.some(s=>s.value===o)?(e.value=o,a.selected=!1):e.value=""}function clearBackupDiffResults(){backupDiffListEl&&(backupDiffListEl.innerHTML=""),backupDiffListContainerEl&&(backupDiffListContainerEl.hidden=!0)}function fallbackHumanizeDiffKey(e){if(typeof e!="string")return String(e);const t=e.replace(/[_\s-]+/g," ").replace(/([a-z\d])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z][a-z])/g,"$1 $2").trim();return t?t.split(" ").map(o=>!o||o.length>3&&o===o.toUpperCase()?o:/^\d+$/.test(o)?formatNumberForComparison(Number(o)):o.charAt(0).toUpperCase()+o.slice(1)).join(" "):e}function humanizeDiffKey(e){if(typeof e!="string")return String(e);if(typeof humanizeKey=="function")try{const t=humanizeKey(e);if(typeof t=="string"&&t)return t}catch(t){console.warn("Failed to humanize diff key via humanizeKey",t)}return fallbackHumanizeDiffKey(e)}const ARRAY_COMPARISON_KEY_CANDIDATES=["name","label","title","id","uuid","key","slug"],ARRAY_COMPARISON_KEY_LABEL_OVERRIDES={id:"ID",uuid:"UUID"},ARRAY_COMPARISON_KEY_LABEL_OMIT=new Set(["name","label","title"]);function isDiffComparablePrimitive(e){if(e===null)return!0;const t=typeof e;return t==="string"||t==="number"||t==="boolean"}function arrayHasOnlyComparablePrimitives(e){if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t+=1)if(!isDiffComparablePrimitive(e[t]))return!1;return!0}function createPrimitiveDiffKey(e){return e===null?"primitive:null":typeof e=="number"?Number.isNaN(e)?"primitive:number:NaN":Object.is(e,-0)?"primitive:number:-0":`primitive:number:${e}`:typeof e=="string"?`primitive:string:${e}`:typeof e=="boolean"?`primitive:boolean:${e}`:`primitive:other:${String(e)}`}function buildPrimitiveDiffIndex(e){const t=new Map;if(!Array.isArray(e))return t;for(let o=0;o<e.length;o+=1){const r=e[o];if(!isDiffComparablePrimitive(r))continue;const n=createPrimitiveDiffKey(r);t.has(n)||t.set(n,{value:r,count:0});const a=t.get(n);a.count+=1}return t}function formatPrimitiveDiffPathValue(e){if(typeof e=="number"){if(Number.isNaN(e))return"NaN";if(!Number.isFinite(e))return e>0?"Infinity":"-Infinity";if(Object.is(e,-0))return"-0"}return e}function createKeyedDiffPathSegment(e,t){let o;try{o=JSON.stringify(t)}catch(r){console.warn("Failed to serialize keyed diff path value",r);try{o=JSON.stringify(String(t))}catch(n){console.warn("Failed to stringify keyed diff fallback value",n),o='"?"'}}return`[${e}=${o}]`}function parseKeyedDiffPathSegment(e){if(typeof e!="string")return null;const t=e.match(/^\[([^=[\]]+)=([\s\S]+)\]$/);if(!t)return null;const o=t[1],r=t[2];try{return{key:o,value:JSON.parse(r)}}catch(n){return console.warn("Failed to parse keyed diff path segment",e,n),{key:o,value:r}}}function findArrayComparisonKey(e,t){if(!Array.isArray(e)||!Array.isArray(t))return null;const o=[e,t];for(const r of ARRAY_COMPARISON_KEY_CANDIDATES){let n=!1,a=!0;const s=o.map(()=>new Set);for(let l=0;l<o.length&&a;l+=1){const u=o[l];for(let d=0;d<u.length;d+=1){const m=u[d];if(!isPlainObject(m)){a=!1;break}if(!Object.prototype.hasOwnProperty.call(m,r)){a=!1;break}const y=m[r];if(y==null){a=!1;break}if(typeof y!="string"&&typeof y!="number"){a=!1;break}n=!0;const h=String(y),b=s[l];if(b.has(h)){a=!1;break}b.add(h)}}if(a&&n)return r}return null}function buildArrayKeyIndex(e,t){const o=new Map,r=[];return Array.isArray(e)?(e.forEach(n=>{if(!isPlainObject(n))return;const a=n[t];if(a==null||typeof a!="string"&&typeof a!="number")return;const s=String(a);o.has(s)||(o.set(s,{value:n,keyValue:a}),r.push(s))}),{map:o,order:r}):{map:o,order:r}}function formatDiffListIndex(e){if(typeof e!="string")return null;const t=e.match(/^\[(\d+)\]$/);if(t){const r=Number(t[1]);return!Number.isFinite(r)||r<0?null:getDiffText("versionCompareListItemLabel","Item %s").replace("%s",formatNumberForComparison(r+1))}const o=parseKeyedDiffPathSegment(e);if(o){const{key:r,value:n}=o;let a;if(typeof n=="number"&&Number.isFinite(n))a=formatNumberForComparison(n);else if(typeof n=="string")a=n;else if(n===null)a="null";else try{a=JSON.stringify(n)}catch(m){console.warn("Failed to stringify keyed diff value",m),a=String(n)}const l=getDiffText("versionCompareListItemLabel","Item %s").replace("%s",a);if(ARRAY_COMPARISON_KEY_LABEL_OMIT.has(r))return l;const d=ARRAY_COMPARISON_KEY_LABEL_OVERRIDES[r]||humanizeDiffKey(r);return d?`${d} · ${l}`:l}return null}function formatDiffPathSegment(e){const t=formatDiffListIndex(e);return t||(typeof e!="string"?String(e):humanizeDiffKey(e))}function formatDiffPath(e){return!Array.isArray(e)||!e.length?getDiffText("versionCompareRootPath","Entire setup"):e.map(formatDiffPathSegment).join(" › ")}function valuesEqual(e,t){return e===t?!0:Number.isNaN(e)&&Number.isNaN(t)}function computeSetupDiff(e,t){const o=[];function r(n,a,s){if(valuesEqual(n,a))return;const l=isPlainObject(n),u=isPlainObject(a);if(l&&u){new Set([...Object.keys(n),...Object.keys(a)]).forEach(b=>{const v=Object.prototype.hasOwnProperty.call(n,b),C=Object.prototype.hasOwnProperty.call(a,b);v?C?r(n[b],a[b],s.concat(b)):o.push({type:"removed",path:s.concat(b),before:n[b],after:void 0}):o.push({type:"added",path:s.concat(b),before:void 0,after:a[b]})});return}const d=Array.isArray(n),m=Array.isArray(a);if(d&&m){const h=findArrayComparisonKey(n,a);if(h){const{map:v,order:C}=buildArrayKeyIndex(n,h),{map:A,order:w}=buildArrayKeyIndex(a,h),R=[],_=new Set,G=O=>{_.has(O)||(_.add(O),R.push(O))};C.forEach(G),w.forEach(G),R.forEach(O=>{const B=v.get(O)||null,$=A.get(O)||null,V=B?B.keyValue:$?$.keyValue:O,M=s.concat(createKeyedDiffPathSegment(h,V));!B&&$?o.push({type:"added",path:M,before:void 0,after:$.value}):B&&!$?o.push({type:"removed",path:M,before:B.value,after:void 0}):B&&$&&r(B.value,$.value,M)});return}if(arrayHasOnlyComparablePrimitives(n)&&arrayHasOnlyComparablePrimitives(a)){const v=buildPrimitiveDiffIndex(n),C=buildPrimitiveDiffIndex(a),A=[],w=new Set,R=_=>{w.has(_)||(w.add(_),A.push(_))};for(let _=0;_<n.length;_+=1)R(createPrimitiveDiffKey(n[_]));for(let _=0;_<a.length;_+=1)R(createPrimitiveDiffKey(a[_]));A.forEach(_=>{const G=v.get(_)||null,O=C.get(_)||null,B=G?G.count:0,$=O?O.count:0;if($>B){const V=O?O.value:void 0,M=$-B;for(let F=0;F<M;F+=1)o.push({type:"added",path:s.concat(createKeyedDiffPathSegment("value",formatPrimitiveDiffPathValue(V))),before:void 0,after:V})}if(B>$){const V=G?G.value:void 0,M=B-$;for(let F=0;F<M;F+=1)o.push({type:"removed",path:s.concat(createKeyedDiffPathSegment("value",formatPrimitiveDiffPathValue(V))),before:V,after:void 0})}});return}const b=Math.max(n.length,a.length);for(let v=0;v<b;v+=1){const C=v<n.length,A=v<a.length,w=s.concat(`[${v}]`);C?A?r(n[v],a[v],w):o.push({type:"removed",path:w,before:n[v],after:void 0}):o.push({type:"added",path:w,before:void 0,after:a[v]})}return}if(!l&&!d&&(u||m)){o.push({type:"changed",path:s,before:n,after:a});return}if((l||d)&&!u&&!m){o.push({type:"changed",path:s,before:n,after:a});return}const y=n===void 0?"added":a===void 0?"removed":"changed";o.push({type:y,path:s,before:n,after:a})}return r(e,t,[]),o}function createDiffValueElement(e,t){const o=document.createElement("pre");if(o.className="diff-value",t&&(o.className+=` diff-value-${t}`),e===void 0)return o.textContent=getDiffText("versionCompareMissingValue","Not present"),o;if(e===null)return o.textContent="null",o;if(typeof e=="string")return o.textContent=e,o;if(typeof e=="number"||typeof e=="boolean")return o.textContent=String(e),o;try{o.textContent=JSON.stringify(e,null,2)}catch(r){console.warn("Failed to stringify diff value",r),o.textContent=String(e)}return o}function createDiffChangeBlock(e,t,o){const r=document.createElement("div");r.className="diff-change",o&&r.classList.add(`diff-change-${o}`);const n=document.createElement("span");return n.className="diff-label",n.textContent=e,r.appendChild(n),r.appendChild(createDiffValueElement(t,o)),r}function createDiffStatusBadge(e){const t=document.createElement("span");t.className="diff-label diff-status-badge";let o="changed",r="versionCompareChangeUpdated",n="Updated";return e==="added"?(o="added",r="versionCompareChangeAdded",n="Added"):e==="removed"?(o="removed",r="versionCompareChangeRemoved",n="Removed"):e==="changed"&&(o="changed",r="versionCompareChangeUpdated",n="Updated"),t.classList.add(`diff-status-${o}`),t.textContent=getDiffText(r,n),t}function sortDiffEntries(e){if(!Array.isArray(e))return[];const t={changed:0,added:1,removed:2},o=typeof localeSort=="function"?(r,n)=>localeSort(r,n):(r,n)=>r.localeCompare(n);return e.map(r=>({entry:r,pathText:formatDiffPath(r&&r.path),rank:r&&r.type&&Object.prototype.hasOwnProperty.call(t,r.type)?t[r.type]:3})).sort((r,n)=>r.rank!==n.rank?r.rank-n.rank:o(r.pathText,n.pathText))}function renderBackupDiffEntries(e){if(!backupDiffListEl||!backupDiffListContainerEl)return;if(backupDiffListEl.innerHTML="",!Array.isArray(e)||!e.length){backupDiffListContainerEl.hidden=!0;return}backupDiffListContainerEl.hidden=!1,sortDiffEntries(e).forEach(({entry:o,pathText:r})=>{if(!o)return;const n=document.createElement("li"),a=o.type?` diff-${o.type}`:"";n.className=`diff-entry${a}`;const s=document.createElement("div");s.className="diff-entry-header";const l=document.createElement("div");l.className="diff-path",l.textContent=r,s.appendChild(l),s.appendChild(createDiffStatusBadge(o.type)),n.appendChild(s);const u=document.createElement("div");u.className="diff-change-group",o.type==="changed"?(u.classList.add("diff-change-group--split"),u.appendChild(createDiffChangeBlock(getDiffText("versionCompareChangeRemoved","Removed"),o.before,"removed")),u.appendChild(createDiffChangeBlock(getDiffText("versionCompareChangeAdded","Added"),o.after,"added"))):o.type==="added"?u.appendChild(createDiffChangeBlock(getDiffText("versionCompareChangeAdded","Added"),o.after,"added")):o.type==="removed"?u.appendChild(createDiffChangeBlock(getDiffText("versionCompareChangeRemoved","Removed"),o.before,"removed")):u.appendChild(createDiffChangeBlock(getDiffText("versionCompareChangeUpdated","Updated"),o.after,"changed")),u.childNodes.length&&n.appendChild(u),backupDiffListEl.appendChild(n)})}function formatDiffCount(e){return getDiffText(e===1?"versionCompareDifferencesCountOne":"versionCompareDifferencesCountOther",e===1?"%s difference noted.":"%s differences noted.").replace("%s",formatNumberForComparison(e))}function formatDiffDetail(e,t){return getDiffText(e,"%s").replace("%s",formatNumberForComparison(t))}function updateBackupDiffSummary(e){if(!backupDiffSummaryEl)return;if(!Array.isArray(e)||!e.length){backupDiffSummaryEl.textContent=getDiffText("versionCompareIdentical","Versions match—no changes detected.");return}const t={added:0,removed:0,changed:0};e.forEach(n=>{n&&n.type&&Object.prototype.hasOwnProperty.call(t,n.type)&&(t[n.type]+=1)});const o=formatDiffCount(e.length),r=[];t.added&&r.push(formatDiffDetail("versionCompareSummaryAdded",t.added)),t.removed&&r.push(formatDiffDetail("versionCompareSummaryRemoved",t.removed)),t.changed&&r.push(formatDiffDetail("versionCompareSummaryChanged",t.changed)),backupDiffSummaryEl.textContent=r.length?`${o} (${r.join(" · ")})`:o}function renderBackupDiff(){if(!backupDiffSummaryEl)return;if(!backupDiffOptionsCache.length){clearBackupDiffResults(),backupDiffSummaryEl.textContent=getDiffText("versionCompareEmpty","Save a project or wait for auto-backups to start comparing versions."),backupDiffExportButtonEl&&(backupDiffExportButtonEl.disabled=!0),backupDiffNotesEl&&(backupDiffNotesEl.disabled=!0);return}backupDiffNotesEl&&(backupDiffNotesEl.disabled=!1);const e=backupDiffState.baseline,t=backupDiffState.comparison;if(!e||!t){clearBackupDiffResults(),backupDiffSummaryEl.textContent=getDiffText("versionCompareNoSelection","Choose two versions to generate a diff."),backupDiffExportButtonEl&&(backupDiffExportButtonEl.disabled=!0);return}if(e===t){clearBackupDiffResults(),backupDiffSummaryEl.textContent=getDiffText("versionCompareSameSelection","Select two different versions to compare."),backupDiffExportButtonEl&&(backupDiffExportButtonEl.disabled=!0);return}const o=new Map(backupDiffOptionsCache.map(s=>[s.value,s])),r=o.get(e),n=o.get(t);if(!r||!n){clearBackupDiffResults(),backupDiffSummaryEl.textContent=getDiffText("versionCompareMissingSelection","Select two versions before exporting a log."),backupDiffExportButtonEl&&(backupDiffExportButtonEl.disabled=!0);return}const a=computeSetupDiff(r.data,n.data);renderBackupDiffEntries(a),updateBackupDiffSummary(a),backupDiffExportButtonEl&&(backupDiffExportButtonEl.disabled=!1)}function populateBackupDiffSelectors(){const e=(n,a)=>n||(typeof document<"u"?document.getElementById(a):null),t=e(backupDiffPrimarySelectEl,"backupDiffPrimary"),o=e(backupDiffSecondarySelectEl,"backupDiffSecondary"),r=e(backupDiffEmptyStateEl,"backupDiffEmptyState");backupDiffOptionsCache=collectBackupDiffOptions(),fillBackupDiffSelect(t,backupDiffOptionsCache,backupDiffState.baseline),fillBackupDiffSelect(o,backupDiffOptionsCache,backupDiffState.comparison),r&&(r.hidden=backupDiffOptionsCache.length>0),renderBackupDiff()}function collapseBackupDiffSection(e={}){backupDiffSectionEl&&(backupDiffSectionEl.hasAttribute("hidden")||backupDiffSectionEl.setAttribute("hidden",""),backupDiffToggleButtonEl&&backupDiffToggleButtonEl.setAttribute("aria-expanded","false"),e.resetSelections&&(backupDiffState.baseline="",backupDiffState.comparison=""),e.resetNotes&&backupDiffNotesEl&&(backupDiffNotesEl.value=""))}function showBackupDiffSection(){if(backupDiffSectionEl&&(populateBackupDiffSelectors(),backupDiffSectionEl.removeAttribute("hidden"),backupDiffToggleButtonEl&&backupDiffToggleButtonEl.setAttribute("aria-expanded","true"),backupDiffPrimarySelectEl))try{backupDiffPrimarySelectEl.focus({preventScroll:!0})}catch{backupDiffPrimarySelectEl.focus()}}function handleBackupDiffToggle(){backupDiffSectionEl&&(backupDiffSectionEl.hasAttribute("hidden")?showBackupDiffSection():collapseBackupDiffSection())}function handleBackupDiffSelectionChange(e){const t=e&&e.target?e.target:null;if(!t)return;const o=typeof t.value=="string"?t.value:"";t===backupDiffPrimarySelectEl?backupDiffState.baseline=o:t===backupDiffSecondarySelectEl&&(backupDiffState.comparison=o),renderBackupDiff()}function getComparisonEntryType(e){return typeof e!="string"?"manual":e.startsWith(SESSION_AUTO_BACKUP_DELETION_PREFIX)?"auto-backup-before-delete":e.startsWith(SESSION_AUTO_BACKUP_NAME_PREFIX)?"auto-backup":"manual"}function cloneValueForExport(e){if(e!==void 0)try{return SESSION_DEEP_CLONE(e)}catch(t){return console.warn("Failed to clone comparison snapshot for export",t),e}}function handleBackupDiffExport(){if(!backupDiffOptionsCache.length){showNotification$1("warning",getDiffText("versionCompareEmpty","Save a project or wait for auto-backups to start comparing versions."));return}const e=backupDiffState.baseline,t=backupDiffState.comparison;if(!e||!t||e===t){showNotification$1("warning",getDiffText("versionCompareMissingSelection","Select two versions before exporting a log."));return}const o=new Map(backupDiffOptionsCache.map(C=>[C.value,C])),r=o.get(e),n=o.get(t);if(!r||!n){showNotification$1("warning",getDiffText("versionCompareMissingSelection","Select two versions before exporting a log."));return}const a=computeSetupDiff(r.data,n.data),s={added:0,removed:0,changed:0};a.forEach(C=>{C&&C.type&&Object.prototype.hasOwnProperty.call(s,C.type)&&(s[C.type]+=1)});const l=backupDiffNotesEl&&typeof backupDiffNotesEl.value=="string"?backupDiffNotesEl.value.trim():"",u=new Date,{iso:d}=formatFullBackupFilename(u),y=`cine-power-planner-version-log-${d.replace(/[:]/g,"-")}.json`,h={type:"cine-power-planner-version-log",version:1,createdAt:new Date().toISOString(),appVersion:typeof ACTIVE_APP_VERSION$1=="string"?ACTIVE_APP_VERSION$1:normalizeVersionValue(typeof APP_VERSION=="string"?APP_VERSION:null),baseline:{id:r.value,label:r.label,type:getComparisonEntryType(r.value),snapshot:cloneValueForExport(r.data)},comparison:{id:n.value,label:n.label,type:getComparisonEntryType(n.value),snapshot:cloneValueForExport(n.data)},summary:{totalDifferences:a.length,added:s.added,removed:s.removed,updated:s.changed},differences:a.map(C=>({type:C.type,path:C.path,before:C.before,after:C.after}))};l&&(h.note=l);let b;try{b=JSON.stringify(h,null,2)}catch(C){console.warn("Failed to serialize comparison export payload",C),showNotification$1("error",getDiffText("versionCompareExportFailure","Comparison export failed."));return}const v=downloadBackupPayload(b,y);v&&v.success?showNotification$1("success",getDiffText("versionCompareExportSuccess","Comparison log exported.")):showNotification$1("error",getDiffText("versionCompareExportFailure","Comparison export failed."))}function applyPreferencesFromStorage(e){if(typeof e!="function")return{showAutoBackups:!1,accentColor:null,language:null};const t=e(temperaturePreferenceStorageKey);if(t)try{applyTemperatureUnitPreferenceWithFallback(t,{persist:!1})}catch(u){console.warn("Failed to apply restored temperature unit preference",u)}const o=typeof FOCUS_SCALE_STORAGE_KEY_NAME=="string"&&FOCUS_SCALE_STORAGE_KEY_NAME||typeof globalThis<"u"&&globalThis&&typeof globalThis.FOCUS_SCALE_STORAGE_KEY_NAME=="string"&&globalThis.FOCUS_SCALE_STORAGE_KEY_NAME||"cameraPowerPlanner_focusScale",r=e(o);let n=null;if(r){let u=null;if(typeof normalizeFocusScale=="function")try{u=normalizeFocusScale(r)}catch(d){console.warn("Failed to normalize restored focus scale preference",d)}if((typeof u!="string"||!u)&&(u=typeof r=="string"?r.trim().toLowerCase():""),u==="metric"||u==="imperial"){n=u;try{typeof applyFocusScalePreference=="function"&&applyFocusScalePreference(u,{persist:!1,forceUpdate:!0})}catch(d){console.warn("Failed to apply restored focus scale preference",d)}sessionFocusScale$1=u;try{typeof settingsFocusScale<"u"&&settingsFocusScale&&(settingsFocusScale.value=u)}catch(d){console.warn("Failed to sync restored focus scale selection",d)}if(typeof rememberSettingsFocusScaleBaseline=="function")try{rememberSettingsFocusScaleBaseline()}catch(d){console.warn("Failed to update focus scale baseline after restore",d)}if(typeof globalThis<"u"&&globalThis)try{globalThis.focusScalePreference=u}catch(d){console.warn("Failed to update global focus scale preference",d)}if(typeof focusScalePreference<"u")try{focusScalePreference=u}catch(d){console.warn("Failed to update scoped focus scale preference",d)}}}try{setThemePreference(e("darkMode")==="true",{persist:!0})}catch(u){console.warn("Failed to apply restored dark mode preference",u)}try{let u=e(PINK_MODE_STORAGE_KEY);(u==null||u==="")&&(u=e(LEGACY_PINK_MODE_STORAGE_KEY)),applyPinkMode$1(u==="true")}catch(u){console.warn("Failed to apply restored pink mode preference",u)}try{applyHighContrast$1(e("highContrast")==="true")}catch(u){console.warn("Failed to apply restored high contrast preference",u)}try{applyReduceMotion(e("reduceMotion")==="true")}catch(u){console.warn("Failed to apply restored reduce motion preference",u)}try{applyRelaxedSpacing(e("relaxedSpacing")==="true")}catch(u){console.warn("Failed to apply restored relaxed spacing preference",u)}const a=e("showAutoBackups")==="true",s=e("accentColor");if(s){try{document.documentElement.style.setProperty("--accent-color",s),document.documentElement.style.setProperty("--link-color",s)}catch(u){console.warn("Failed to apply restored accent color",u)}accentColor=s,prevAccentColor=s,accentColorInput&&(accentColorInput.value=s),typeof updateAccentColorResetButtonState=="function"&&updateAccentColorResetButtonState()}const l=e("language");try{const u=typeof getMountVoltageStorageKeyName=="function"?getMountVoltageStorageKeyName():"cameraPowerPlanner_mountVoltages",d=e(u);let m=parseStoredMountVoltages(d),y=!1;if(!m){const h=typeof getMountVoltageStorageBackupKeyName=="function"?getMountVoltageStorageBackupKeyName():`${u}__backup`,b=e(h);if(b!=null){const v=parseStoredMountVoltages(b);v&&(m=v,y=!0)}}if(m){applySessionMountVoltagePreferences(m,{persist:y,triggerUpdate:!0});const h=getSessionRuntimeFunction("updateMountVoltageInputsFromState");if(h)try{h()}catch(b){warnMissingMountVoltageHelper("updateMountVoltageInputsFromState",b)}else warnMissingMountVoltageHelper("updateMountVoltageInputsFromState");rememberSettingsMountVoltagesBaseline()}}catch(u){console.warn("Failed to apply restored mount voltage preferences",u)}return{showAutoBackups:a,accentColor:s||null,language:l||null,focusScale:n}}function captureSetupSelection(){return{value:setupSelect$1?setupSelect$1.value:"",name:setupNameInput$1?setupNameInput$1.value:""}}function restoreSetupSelection(e,t){if(!e||typeof e!="object")return;const{value:o="",name:r=""}=e;if(setupSelect$1)try{t||!o||!o.startsWith("auto-backup-")?setupSelect$1.value=o:setupSelect$1.value=""}catch(n){console.warn("Failed to restore setup selection after restore",n)}if(setupNameInput$1)try{setupNameInput$1.value=r||""}catch(n){console.warn("Failed to restore setup name after restore",n)}}const backupFallbackLoaders=[{key:"devices",loaderName:"loadDeviceData",isValid:e=>e===null||isPlainObject(e),loader:()=>typeof loadDeviceData=="function"?loadDeviceData():void 0},{key:"setups",loaderName:"loadSetups",isValid:e=>isPlainObject(e),loader:()=>typeof loadSetups=="function"?loadSetups():void 0},{key:"session",loaderName:"loadSessionState",isValid:e=>e===null||isPlainObject(e),loader:()=>typeof loadSessionState$1=="function"?loadSessionState$1():void 0},{key:"feedback",loaderName:"loadFeedback",isValid:e=>e===null||isPlainObject(e),loader:()=>typeof loadFeedback=="function"?loadFeedback():void 0},{key:"project",loaderName:"loadProject",isValid:e=>isPlainObject(e),loader:()=>typeof loadProject$1=="function"?loadProject$1():void 0},{key:"favorites",loaderName:"loadFavorites",isValid:e=>isPlainObject(e),loader:()=>typeof loadFavorites=="function"?loadFavorites():void 0},{key:"documentationTracker",loaderName:"loadDocumentationTracker",isValid:e=>e===null||isPlainObject(e)&&Array.isArray(e.releases)||Array.isArray(e),loader:()=>typeof loadDocumentationTracker=="function"?loadDocumentationTracker():void 0},{key:"autoGearBackups",loaderName:"loadAutoGearBackups",isValid:e=>Array.isArray(e),loader:()=>typeof loadAutoGearBackups=="function"?loadAutoGearBackups():void 0},{key:"autoGearPresets",loaderName:"loadAutoGearPresets",isValid:e=>Array.isArray(e),loader:()=>typeof loadAutoGearPresets=="function"?loadAutoGearPresets():void 0},{key:"autoGearMonitorDefaults",loaderName:"loadAutoGearMonitorDefaults",isValid:e=>isPlainObject(e),loader:()=>typeof loadAutoGearMonitorDefaults$1=="function"?loadAutoGearMonitorDefaults$1():void 0},{key:"autoGearSeeded",loaderName:"loadAutoGearSeedFlag",isValid:e=>typeof e=="boolean",loader:()=>typeof loadAutoGearSeedFlag=="function"?loadAutoGearSeedFlag():void 0},{key:"autoGearActivePresetId",loaderName:"loadAutoGearActivePresetId",isValid:e=>typeof e=="string",loader:()=>typeof loadAutoGearActivePresetId=="function"?loadAutoGearActivePresetId():void 0},{key:"autoGearAutoPresetId",loaderName:"loadAutoGearAutoPresetId",isValid:e=>typeof e=="string",loader:()=>typeof loadAutoGearAutoPresetId=="function"?loadAutoGearAutoPresetId():void 0},{key:"autoGearShowBackups",loaderName:"loadAutoGearBackupVisibility",isValid:e=>typeof e=="boolean",loader:()=>typeof loadAutoGearBackupVisibility=="function"?loadAutoGearBackupVisibility():void 0},{key:"autoGearBackupRetention",loaderName:"loadAutoGearBackupRetention",isValid:e=>typeof e=="number"&&Number.isFinite(e),loader:()=>typeof loadAutoGearBackupRetention=="function"?loadAutoGearBackupRetention():void 0},{key:"fullBackupHistory",loaderName:"loadFullBackupHistory",isValid:e=>Array.isArray(e),loader:()=>typeof loadFullBackupHistory=="function"?loadFullBackupHistory():void 0}];function describeError(e){if(!e)return null;if(typeof e=="string")return e;if(typeof e.message=="string"&&e.message.trim())return e.message;try{return JSON.stringify(e)}catch{}try{return String(e)}catch{}return null}function recordDiagnostic(e,t,o,r={}){if(!Array.isArray(e))return;const n={section:t,status:o};if(r.source&&typeof r.source=="string"&&(n.source=r.source),typeof r.message=="string"){const a=r.message.trim();a&&(n.message=a)}e.push(n)}function applyBackupFallbacks(e,t){!e||typeof e!="object"||backupFallbackLoaders.forEach(({key:o,loader:r,loaderName:n,isValid:a})=>{const s=e[o];if(!a(s)&&typeof r=="function")try{const l=r();if(l===void 0){recordDiagnostic(t,o,"missing",{source:n});return}e[o]=l,recordDiagnostic(t,o,"recovered",{source:n})}catch(l){console.warn(`Failed to recover ${o} for full backup`,l);const u=describeError(l);recordDiagnostic(t,o,"error",{source:n,message:u})}})}function mergeAutoGearRuleLists(e,t){const o=Array.isArray(e)?e.slice():[];if(!Array.isArray(t)||!t.length)return{combined:o,changed:!1};const r=new Set(o.map(a=>a&&typeof a.id=="string"?a.id:null).filter(Boolean));let n=!1;return t.forEach(a=>{if(!a)return;const s=a&&typeof a.id=="string"?a.id:null;s&&r.has(s)||(s&&r.add(s),o.push(a),n=!0)}),{combined:o,changed:n}}async function collectFullBackupData(){const e=[];let t={},o=!1,r=!1;if(typeof prepareBackupForExport=="function")try{await prepareBackupForExport()}catch(a){console.warn("Failed to prepare backup vault cache",a)}if(typeof exportAllData=="function"){o=!0;try{t=exportAllData()}catch(a){r=!0,console.warn("Failed to collect planner data for full backup",a);const s=describeError(a);recordDiagnostic(e,"exportAllData","error",{source:"exportAllData",message:s}),t={}}}else recordDiagnostic(e,"exportAllData","missing",{source:"exportAllData"});let n={};if(isPlainObject(t)?n={...t}:o&&!r&&t&&typeof t=="object"?(n={...t},recordDiagnostic(e,"exportAllData","coerced",{source:"exportAllData"})):(o&&!r&&recordDiagnostic(e,"exportAllData","invalid",{source:"exportAllData"}),n={}),applyBackupFallbacks(n,e),!Array.isArray(n.autoGearRules)){let a=null,s="",l=!1;if(typeof getBaseAutoGearRules=="function")try{const d=getBaseAutoGearRules();Array.isArray(d)&&(a=d.slice(),s="getBaseAutoGearRules",l=!0)}catch(d){console.warn("Failed to capture automatic gear rules from state for full backup",d);const m=describeError(d);recordDiagnostic(e,"autoGearRules","error",{source:"getBaseAutoGearRules",message:m})}let u=null;if(typeof loadAutoGearRules=="function")try{u=loadAutoGearRules()}catch(d){console.warn("Failed to load automatic gear rules from storage for full backup",d);const m=describeError(d);recordDiagnostic(e,"autoGearRules","error",{source:"loadAutoGearRules",message:m})}if(Array.isArray(u)&&u.length)if(!Array.isArray(a)||!a.length)a=u,s="loadAutoGearRules",l=!0;else{const{combined:d,changed:m}=mergeAutoGearRuleLists(a,u);a=d,m&&(l=!0,s=s?`${s}+loadAutoGearRules`:"loadAutoGearRules")}Array.isArray(a)?(n.autoGearRules=a,recordDiagnostic(e,"autoGearRules",l?"recovered":"preserved",{source:s||(Array.isArray(u)&&u.length?"loadAutoGearRules":"")})):(n.autoGearRules=[],recordDiagnostic(e,"autoGearRules","defaulted"))}return{data:n,diagnostics:e}}async function buildSettingsBackupPackage$1(e=new Date){const{iso:t,fileName:o}=formatFullBackupFilename(e),r=resolveSafeLocalStorage(),n=captureStorageSnapshot(r),a=captureStorageSnapshot(typeof sessionStorage<"u"?sessionStorage:null),{data:s,diagnostics:l}=await collectFullBackupData(),d={version:ACTIVE_APP_VERSION$1||normalizeVersionValue(typeof APP_VERSION=="string"?APP_VERSION:null)||void 0,generatedAt:t,settings:n,sessionStorage:Object.keys(a).length?a:void 0,data:s};Array.isArray(l)&&l.length&&(d.diagnostics=l);const m=JSON.stringify(d);return{fileName:o,payload:m,iso:t,backup:d,diagnostics:l}}async function performSettingsBackup(e=!0,t=new Date,o={}){try{const r=typeof o=="object"&&o!==null?o:{},n=e&&typeof e=="object"&&typeof e.type=="string",a=r.deferDownload?!1:n?!0:!!e,{fileName:s,payload:l,iso:u}=await buildSettingsBackupPackage$1(t);if(r.deferDownload)return{fileName:s,payload:l,createdAt:u};const d=downloadBackupPayload(l,s);if(!d||!d.success&&!d.queued)throw new Error("No supported download method available");if(d.success){try{recordFullBackupHistoryEntryFn({createdAt:u,fileName:s})}catch(m){console.warn("Failed to record full backup history entry",m)}if(d.method==="window-fallback"){const m=getManualDownloadFallbackMessage$1();showNotification$1("warning",m),typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Download Blocked",message:m}):typeof alert=="function"&&alert(m)}else a&&showNotification$1("success","Full app backup downloaded")}else d.queued&&d.queueMessage&&showNotification$1("warning",d.queueMessage);return{fileName:s,downloadResult:d}}catch(r){return console.warn("Backup failed",r),e&&showNotification$1("error","Backup failed"),null}}function createSettingsBackup$1(e=!0,t=new Date){let o=e,r=t;return e&&typeof e=="object"&&(e instanceof Event||e.type)&&(o=!0,r=new Date),performSettingsBackup(o,r).then(n=>n?n.fileName:null)}typeof backupSettings<"u"&&backupSettings&&backupSettings.addEventListener("click",createSettingsBackup$1);const storageBackupNowControl=typeof document<"u"?document.getElementById("storageBackupNow"):null;storageBackupNowControl&&storageBackupNowControl.addEventListener("click",createSettingsBackup$1);const sessionStoragePersistenceRequestButton=typeof document<"u"?document.getElementById("storagePersistenceRequest"):null,storagePersistenceStatusEl=typeof document<"u"?document.getElementById("storagePersistenceStatus"):null,loggingSectionEl=typeof document<"u"?document.getElementById("loggingSection"):null,loggingHistoryListEl=typeof document<"u"?document.getElementById("loggingHistory"):null,loggingStatusEl=typeof document<"u"?document.getElementById("loggingStatus"):null,loggingEmptyEl=typeof document<"u"?document.getElementById("loggingEmpty"):null,loggingUnavailableEl=typeof document<"u"?document.getElementById("loggingUnavailable"):null,loggingLevelFilterEl=typeof document<"u"?document.getElementById("loggingLevelFilter"):null,loggingNamespaceFilterEl=typeof document<"u"?document.getElementById("loggingNamespaceFilter"):null,loggingNamespaceHelpEl=typeof document<"u"?document.getElementById("loggingNamespaceFilterHelp"):null,loggingHistoryLimitInput=typeof document<"u"?document.getElementById("loggingHistoryLimit"):null,loggingHistoryLimitHelpEl=typeof document<"u"?document.getElementById("loggingHistoryLimitHelp"):null,loggingConsoleOutputInput=typeof document<"u"?document.getElementById("loggingConsoleOutput"):null,loggingCaptureConsoleInput=typeof document<"u"?document.getElementById("loggingCaptureConsole"):null,loggingCaptureErrorsInput=typeof document<"u"?document.getElementById("loggingCaptureErrors"):null,loggingPersistSessionInput=typeof document<"u"?document.getElementById("loggingPersistSession"):null,sessionLoggingExportButton=typeof document<"u"?document.getElementById("loggingExportBtn"):null,storagePersistenceState={supported:null,persisted:null,usage:null,quota:null,checking:!1,requestInFlight:!1,requestAttempted:!1,lastRequestDenied:!1,lastError:null,lastLoggedUsage:null,lastLoggedQuota:null,lastLoggedSupported:null,lastLoggedPersisted:null,lastLoggedSummary:null};let storagePersistenceCheckToken=0;function logStoragePersistenceEstimateUpdate(e={}){const{fromRequest:t=!1}=e||{},o=typeof storagePersistenceState.quota=="number"&&Number.isFinite(storagePersistenceState.quota)?storagePersistenceState.quota:null;if(o===null)return;const r=typeof storagePersistenceState.usage=="number"&&Number.isFinite(storagePersistenceState.usage)?storagePersistenceState.usage:null,n=typeof storagePersistenceState.supported=="boolean"?storagePersistenceState.supported:null,a=typeof storagePersistenceState.persisted=="boolean"?storagePersistenceState.persisted:null,{lang:s,langTexts:l,fallbackTexts:u}=getStoragePersistenceLangInfo(),d=formatStoragePersistenceBytes(o,s),m=r!==null?formatStoragePersistenceBytes(r,s):"";let y="";m?y=(l&&l.storagePersistenceUsage||u&&u.storagePersistenceUsage||"").replace("{used}",m).replace("{quota}",d):y=(l&&l.loggingStorageQuotaOnly||u&&u.loggingStorageQuotaOnly||"").replace("{quota}",d);const h=l&&l.loggingStorageEstimateUpdated||u&&u.loggingStorageEstimateUpdated||"Storage estimate refreshed.";storagePersistenceState.lastLoggedUsage===r&&storagePersistenceState.lastLoggedQuota===o&&storagePersistenceState.lastLoggedSupported===n&&storagePersistenceState.lastLoggedPersisted===a&&storagePersistenceState.lastLoggedSummary===y&&!t||(logSettingsEvent("info",h,{summary:y||null,usageBytes:r,usageDisplay:m||null,quotaBytes:o,quotaDisplay:d||null,supported:n,persisted:a,trigger:t?"user-request":"auto-refresh"},{source:"storage-persistence"}),storagePersistenceState.lastLoggedUsage=r,storagePersistenceState.lastLoggedQuota=o,storagePersistenceState.lastLoggedSupported=n,storagePersistenceState.lastLoggedPersisted=a,storagePersistenceState.lastLoggedSummary=y)}const LOGGING_LEVEL_PRIORITY={debug:10,info:20,warn:30,error:40},LOGGING_HISTORY_MIN=50,LOGGING_HISTORY_MAX=2e3,LOGGING_EXPORT_STATUS_RESET_DELAY=6e3,loggingState={initialized:!1,loggingApi:null,unsubscribeHistory:null,unsubscribeConfig:null,retryTimer:null,renderScheduled:!1,levelFilter:"all",namespaceFilter:"",config:null,namespaceDebounce:null,statusResetTimer:null,degraded:!1};function getLoggingLangInfo(){const e=texts&&texts.en?texts.en:{},t=typeof currentLang=="string"&&texts&&texts[currentLang]?currentLang:"en",o=texts&&texts[t]||e;return{lang:t,langTexts:o,fallbackTexts:e}}function setLoggingStatusKey(e){if(!loggingStatusEl)return;loggingState.statusResetTimer!=null&&(clearTimeout(loggingState.statusResetTimer),loggingState.statusResetTimer=null);const{langTexts:t,fallbackTexts:o}=getLoggingLangInfo(),r=t&&t[e]||o&&o[e]||"";loggingStatusEl.textContent=r,r?loggingStatusEl.setAttribute("data-help",r):loggingStatusEl.removeAttribute("data-help")}function scheduleLoggingStatusReset(e=5e3,t="loggingStatusIdle"){if(loggingState.statusResetTimer!=null&&(clearTimeout(loggingState.statusResetTimer),loggingState.statusResetTimer=null),typeof setTimeout!="function"){t&&setLoggingStatusKey(t);return}const o=typeof e=="number"&&Number.isFinite(e)?Math.max(0,e):5e3;loggingState.statusResetTimer=setTimeout(()=>{loggingState.statusResetTimer=null,t&&setLoggingStatusKey(t)},o)}function resolveLoggingApi(){if(loggingState.loggingApi&&typeof loggingState.loggingApi.getHistory=="function")return loggingState.loggingApi;const e=[];typeof globalThis<"u"&&globalThis&&e.push(globalThis),typeof window<"u"&&window&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&self&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&global&&e.indexOf(global)===-1&&e.push(global);for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const r=o.cineLogging;if(r&&typeof r=="object"&&typeof r.getHistory=="function"&&typeof r.subscribe=="function")return loggingState.loggingApi=r,r}catch(r){console.warn("Unable to resolve cineLogging",r)}}return null}function detachLoggingSubscriptions(){if(loggingState.unsubscribeHistory)try{loggingState.unsubscribeHistory()}catch(e){console.warn("Failed to detach logging history subscription",e)}if(loggingState.unsubscribeConfig)try{loggingState.unsubscribeConfig()}catch(e){console.warn("Failed to detach logging config subscription",e)}loggingState.unsubscribeHistory=null,loggingState.unsubscribeConfig=null}function setLoggingControlsDisabled(e){[loggingLevelFilterEl,loggingNamespaceFilterEl,loggingHistoryLimitInput,loggingConsoleOutputInput,loggingCaptureConsoleInput,loggingCaptureErrorsInput,loggingPersistSessionInput,sessionLoggingExportButton].forEach(o=>{o&&(o.disabled=!!e,e?o.setAttribute("aria-disabled","true"):o.setAttribute("aria-disabled","false"))})}function formatLogDetailValue(e){if(e==null)return"";if(typeof e=="string")return e;try{return JSON.stringify(e,null,2)}catch{return String(e)}}function formatLogTimestamp(e,t,o){const r=typeof currentLang=="string"&&texts&&texts[currentLang]?currentLang:"en",n=typeof e.timestamp=="number"&&Number.isFinite(e.timestamp)?e.timestamp:null;let a="";if(n!=null){const l=new Date(n);if(!Number.isNaN(l.getTime()))try{typeof Intl<"u"&&typeof Intl.DateTimeFormat=="function"?a=new Intl.DateTimeFormat(r,{dateStyle:"short",timeStyle:"medium"}).format(l):a=l.toLocaleString()}catch(u){console.warn("Unable to format log timestamp",u),a=l.toISOString()}}const s=typeof e.isoTimestamp=="string"&&e.isoTimestamp?e.isoTimestamp:n!=null?new Date(n).toISOString():"";return a&&s&&s!==a?(t.loggingTimestampCombined||o.loggingTimestampCombined||"{local} ({iso})").replace("{local}",a).replace("{iso}",s):a||s||""}function createLogDetailsElement(e,t){const o=document.createElement("details");o.className="log-entry-details";const r=document.createElement("summary");r.textContent=e;const n=document.createElement("pre");return n.className="log-entry-detail",n.textContent=formatLogDetailValue(t),o.appendChild(r),o.appendChild(n),o}function sanitizeLoggingFileSegment(e){if(typeof e!="string")return"";const t=e.trim();return t?t.replace(/[^A-Za-z0-9.-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""):""}function buildLoggingExportMetadata(e=new Date){let t=e instanceof Date&&!Number.isNaN(e.getTime())?e:new Date;(!(t instanceof Date)||Number.isNaN(t.getTime()))&&(t=new Date);let o="";if(t&&typeof t.toISOString=="function")try{o=t.toISOString()}catch{o=""}if(!o){const d=new Date(Date.now());try{o=d.toISOString(),t=d}catch{o=String(Date.now())}}const r=o||String(Date.now()),n=sanitizeLoggingFileSegment(r.replace(/[:.]/g,"-"))||sanitizeLoggingFileSegment(r)||String(Date.now()),a=typeof ACTIVE_APP_VERSION$1=="string"&&ACTIVE_APP_VERSION$1?ACTIVE_APP_VERSION$1:typeof APP_VERSION=="string"&&APP_VERSION?APP_VERSION:"",s=sanitizeLoggingFileSegment(a),l=["cine-power-planner-log"];s&&l.push(`v${s}`),l.push(n);const u=typeof t.getTimezoneOffset=="function"?0-t.getTimezoneOffset():null;return{isoTimestamp:o,timezoneOffsetMinutes:u,fileName:`${l.join("-")}.json`}}function cloneLoggingExportValue(e){if(e===null||typeof e!="object")return e;try{return SESSION_DEEP_CLONE(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}return Array.isArray(e)?e.slice():{...e}}function exportLoggingHistory(){const e=resolveLoggingApi(),{langTexts:t,fallbackTexts:o}=getLoggingLangInfo(),r=t&&t.loggingExportUnavailable||o&&o.loggingExportUnavailable||"",n=t&&t.loggingExportError||o&&o.loggingExportError||"",a=t&&t.loggingExportSuccess||o&&o.loggingExportSuccess||"Diagnostics log exported.",s=sessionLoggingExportButton&&!sessionLoggingExportButton.disabled;sessionLoggingExportButton&&(sessionLoggingExportButton.disabled=!0,sessionLoggingExportButton.setAttribute("aria-disabled","true"));try{if(!e||typeof e.getHistory!="function"){r&&showNotification$1("error",r),setLoggingStatusKey("loggingStatusError"),scheduleLoggingStatusReset(LOGGING_EXPORT_STATUS_RESET_DELAY,"loggingStatusIdle");return}setLoggingStatusKey("loggingStatusExporting");const l=e.getHistory({})||[];if(!Array.isArray(l))throw new Error("Invalid diagnostics history snapshot.");const u=l;let d=cloneLoggingExportValue(u);Array.isArray(d)||(d=u.slice());let m=null;if(typeof e.getConfig=="function")try{const w=e.getConfig();if(w&&typeof w=="object"){const R=cloneLoggingExportValue(w);m=R&&typeof R=="object"?R:{...w}}}catch(w){logSettingsEvent("warn","Diagnostics log export config capture failed",{message:describeError(w)},{namespace:"logging-export"})}let y=null;if(typeof e.getStats=="function")try{const w=e.getStats();if(w&&typeof w=="object"){const R=cloneLoggingExportValue(w);y=R&&typeof R=="object"?R:{...w}}}catch(w){logSettingsEvent("warn","Diagnostics log export stats capture failed",{message:describeError(w)},{namespace:"logging-export"})}const h=buildLoggingExportMetadata(new Date),b={exportedAt:h.isoTimestamp,timezoneOffsetMinutes:h.timezoneOffsetMinutes,filters:{level:loggingState.levelFilter||"all",namespace:loggingState.namespaceFilter||""},history:d,historyLength:d.length},v=typeof ACTIVE_APP_VERSION$1=="string"&&ACTIVE_APP_VERSION$1?ACTIVE_APP_VERSION$1:typeof APP_VERSION=="string"&&APP_VERSION?APP_VERSION:null;v&&(b.appVersion=v),m&&typeof m=="object"&&(b.config=m),y&&typeof y=="object"&&(b.stats=y);const C=JSON.stringify(b,null,2);if(!C)throw new Error("Empty diagnostics export payload.");if(typeof downloadBackupPayload!="function")throw new Error("downloadBackupPayload unavailable.");const A=downloadBackupPayload(C,h.fileName);if(!A||!A.success)throw new Error("Diagnostics log download failed.");if(logSettingsEvent("info","Diagnostics log exported",{entries:d.length,fileName:h.fileName},{namespace:"logging-export"}),a&&showNotification$1("success",a),setLoggingStatusKey("loggingStatusExported"),scheduleLoggingStatusReset(LOGGING_EXPORT_STATUS_RESET_DELAY),A.method==="manual"||A.method==="window-fallback"){const w=getManualDownloadFallbackMessage$1();w&&showNotification$1("warning",w)}}catch(l){const u=describeError(l);logSettingsEvent("error","Diagnostics log export failed",{message:u||null},{namespace:"logging-export"}),showNotification$1("error",n||u||"Log export failed."),setLoggingStatusKey("loggingStatusExportFailed"),scheduleLoggingStatusReset(LOGGING_EXPORT_STATUS_RESET_DELAY)}finally{sessionLoggingExportButton&&s&&(sessionLoggingExportButton.disabled=!1,sessionLoggingExportButton.setAttribute("aria-disabled","false"))}}function renderLoggingHistory(){if(loggingState.renderScheduled=!1,!loggingSectionEl||!loggingHistoryListEl)return;const e=resolveLoggingApi(),{langTexts:t,fallbackTexts:o}=getLoggingLangInfo();if(!e||typeof e.getHistory!="function"){setLoggingControlsDisabled(!0),loggingUnavailableEl&&loggingUnavailableEl.removeAttribute("hidden"),loggingEmptyEl&&loggingEmptyEl.setAttribute("hidden",""),loggingHistoryListEl&&(loggingHistoryListEl.textContent=""),setLoggingStatusKey("loggingStatusError");return}setLoggingControlsDisabled(!1),loggingUnavailableEl&&loggingUnavailableEl.setAttribute("hidden","");let r=[];try{const d=e.getHistory({});Array.isArray(d)&&(r=d)}catch(d){console.warn("Unable to read logging history",d);const m={};if(Object.prototype.hasOwnProperty.call(loggingState,"levelFilter")){const h=loggingState.levelFilter;m.level=typeof h>"u"?null:h}if(Object.prototype.hasOwnProperty.call(loggingState,"namespaceFilter")){const h=loggingState.namespaceFilter;m.namespace=typeof h>"u"?null:h}const y={message:describeError(d)};Object.keys(m).length>0&&(y.filters=m),logSettingsEvent("error","Failed to read diagnostics history",y,{namespace:"logging-panel"}),setLoggingStatusKey("loggingStatusError"),r=[]}const n=typeof loggingState.namespaceFilter=="string"?loggingState.namespaceFilter.trim().toLowerCase():"",a=loggingState.levelFilter==="all"?-1/0:LOGGING_LEVEL_PRIORITY[loggingState.levelFilter]||LOGGING_LEVEL_PRIORITY.warn,s=r.slice().reverse().filter(d=>{if(!d||typeof d!="object")return!1;const m=typeof d.level=="string"?d.level.toLowerCase():"info";return!((LOGGING_LEVEL_PRIORITY[m]??LOGGING_LEVEL_PRIORITY.info)<a||n&&!(typeof d.namespace=="string"?d.namespace.toLowerCase():"").includes(n))}),l=document.createDocumentFragment(),u={debug:t.loggingLevelDebug||o.loggingLevelDebug||"Debug",info:t.loggingLevelInfo||o.loggingLevelInfo||"Info",warn:t.loggingLevelWarn||o.loggingLevelWarn||"Warn",error:t.loggingLevelError||o.loggingLevelError||"Error"};if(s.forEach(d=>{const m=typeof d.level=="string"?d.level.toLowerCase():"info",y=document.createElement("li");y.className=`log-entry level-${m}`;const h=document.createElement("div");h.className="log-entry-header";const b=document.createElement("span");b.className="log-entry-message",b.textContent=typeof d.message=="string"?d.message:"";const v=document.createElement("span");v.className="log-entry-level",v.textContent=u[m]||u.info,h.appendChild(b),h.appendChild(v),y.appendChild(h);const C=document.createElement("dl");C.className="log-entry-meta";const A=document.createElement("div");A.className="log-entry-meta-row";const w=document.createElement("dt");w.textContent=t.loggingEntryTimestampLabel||o.loggingEntryTimestampLabel||"Time";const R=document.createElement("dd");R.textContent=formatLogTimestamp(d,t,o),A.appendChild(w),A.appendChild(R),C.appendChild(A);const _=typeof d.namespace=="string"?d.namespace:"";if(_){const G=document.createElement("div");G.className="log-entry-meta-row";const O=document.createElement("dt");O.textContent=t.loggingEntryNamespaceLabel||o.loggingEntryNamespaceLabel||"Namespace";const B=document.createElement("dd");B.textContent=_,G.appendChild(O),G.appendChild(B),C.appendChild(G)}if(y.appendChild(C),d.meta!=null){const G=createLogDetailsElement(t.loggingEntryMetaLabel||o.loggingEntryMetaLabel||"Meta",d.meta);y.appendChild(G)}if(d.detail!=null){const G=createLogDetailsElement(t.loggingEntryDetailLabel||o.loggingEntryDetailLabel||"Details",d.detail);y.appendChild(G)}l.appendChild(y)}),loggingHistoryListEl.textContent="",loggingHistoryListEl.appendChild(l),loggingEmptyEl)if(s.length===0){const d=r.length>0?"loggingEmptyFiltered":"loggingEmptyState",m=t&&t[d]||o&&o[d]||(d==="loggingEmptyFiltered"?"No log entries match the current filters.":"No log entries captured yet.");loggingEmptyEl.textContent=m,loggingEmptyEl.removeAttribute("hidden"),loggingEmptyEl.setAttribute("data-help",m)}else loggingEmptyEl.setAttribute("hidden",""),loggingEmptyEl.removeAttribute("data-help");loggingState.degraded||setLoggingStatusKey("loggingStatusIdle")}function scheduleLoggingRender(e={}){if(loggingState.renderScheduled&&!e.immediate)return;if(e.immediate){renderLoggingHistory();return}loggingState.renderScheduled=!0,(typeof requestAnimationFrame=="function"?requestAnimationFrame:o=>setTimeout(o,50))(()=>{renderLoggingHistory()})}function applyLoggingConfig(e){if(!e||typeof e!="object")return;loggingState.config=e;const{langTexts:t,fallbackTexts:o}=getLoggingLangInfo();if(loggingHistoryLimitInput&&typeof e.historyLimit=="number"){loggingHistoryLimitInput.value=e.historyLimit;const n=t.loggingHistoryLimitStatus||o.loggingHistoryLimitStatus||(loggingHistoryLimitHelpEl?loggingHistoryLimitHelpEl.textContent:"");loggingHistoryLimitHelpEl&&n&&(loggingHistoryLimitHelpEl.textContent=n.replace("{count}",String(e.historyLimit)))}const r=(n,a)=>{if(!n)return;const s=!!a;n.checked=s,n.setAttribute("aria-checked",s?"true":"false")};r(loggingConsoleOutputInput,e.consoleOutput!==!1),r(loggingCaptureConsoleInput,e.captureConsole===!0),r(loggingCaptureErrorsInput,e.captureGlobalErrors!==!1),r(loggingPersistSessionInput,e.persistSession!==!1)}function sanitizeLoggingConfigPartial(e){if(!e||typeof e!="object")return null;const t=64,o={};try{const r=Object.keys(e);o.keys=r.slice(0,20),o.values=o.keys.reduce((n,a)=>{const s=e[a];if(s==null||typeof s=="boolean")return n[a]=s,n;if(typeof s=="number")return n[a]=Number.isFinite(s)?s:"[number]",n;if(typeof s=="string"){const l=s.length>t?`${s.slice(0,t)}…`:s;return n[a]=l,s.length>t&&(n[`${a}Length`]=s.length),n}if(Array.isArray(s))return n[a]=`[array:${s.length}]`,n;if(typeof s=="object"){let l=null;try{l=Object.keys(s).length}catch(u){}return n[a]=`[object${l!=null?`:${l}`:""}]`,n}return n[a]=`[${typeof s}]`,n},{})}catch(r){o.error=describeError(r)}return o}function updateLoggingConfig(e){const t=resolveLoggingApi();if(!(!t||typeof t.setConfig!="function"||!e||typeof e!="object"))try{t.setConfig(e)}catch(o){console.warn("Unable to update logging config",o),logSettingsEvent("error","Failed to update diagnostics logging config",{message:describeError(o),partial:sanitizeLoggingConfigPartial(e)},{namespace:"logging-config"}),setLoggingStatusKey("loggingStatusError")}}function attachLoggingSubscriptions(){const e=resolveLoggingApi();if(!e){detachLoggingSubscriptions(),setLoggingControlsDisabled(!0),loggingUnavailableEl&&loggingUnavailableEl.removeAttribute("hidden"),loggingState.retryTimer==null&&typeof setTimeout=="function"&&(loggingState.retryTimer=setTimeout(()=>{loggingState.retryTimer=null,attachLoggingSubscriptions()},2e3));return}loggingState.retryTimer!=null&&(clearTimeout(loggingState.retryTimer),loggingState.retryTimer=null);try{const t=typeof e.getConfig=="function"?e.getConfig():{};applyLoggingConfig(t),loggingState.degraded=!1}catch(t){loggingState.degraded=!0,setLoggingStatusKey("loggingStatusError"),logSettingsEvent("warn","Failed to load diagnostics logging config snapshot",{message:describeError(t)},{namespace:"logging-panel"}),typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Unable to read logging config",t)}detachLoggingSubscriptions(),typeof e.subscribe=="function"&&(loggingState.unsubscribeHistory=e.subscribe(()=>{loggingState.degraded||setLoggingStatusKey("loggingStatusUpdating"),scheduleLoggingRender()})),typeof e.subscribeConfig=="function"&&(loggingState.unsubscribeConfig=e.subscribeConfig(t=>{applyLoggingConfig(t||{}),loggingState.degraded&&(loggingState.degraded=!1,setLoggingStatusKey("loggingStatusIdle"))})),scheduleLoggingRender({immediate:!0})}function initializeLoggingPanel(){if(!loggingSectionEl||loggingState.initialized)return;if(loggingState.initialized=!0,loggingLevelFilterEl){const t=typeof loggingLevelFilterEl.value=="string"&&loggingLevelFilterEl.value?loggingLevelFilterEl.value:"all";loggingState.levelFilter=t,loggingLevelFilterEl.addEventListener("change",()=>{const o=typeof loggingLevelFilterEl.value=="string"?loggingLevelFilterEl.value:"all";loggingState.levelFilter=o,loggingState.degraded||setLoggingStatusKey("loggingStatusUpdating"),scheduleLoggingRender({immediate:!0})})}if(loggingNamespaceFilterEl){loggingNamespaceFilterEl.value="";const t=200;loggingNamespaceFilterEl.addEventListener("input",()=>{loggingState.namespaceDebounce&&clearTimeout(loggingState.namespaceDebounce),loggingState.namespaceDebounce=setTimeout(()=>{loggingState.namespaceDebounce=null,loggingState.namespaceFilter=loggingNamespaceFilterEl.value||"",loggingState.degraded||setLoggingStatusKey("loggingStatusUpdating"),scheduleLoggingRender({immediate:!0})},t)})}if(loggingHistoryLimitInput){const t=()=>{const o=loggingHistoryLimitInput.value,r=parseInt(o,10);if(!Number.isFinite(r)){loggingState.config&&typeof loggingState.config.historyLimit=="number"&&(loggingHistoryLimitInput.value=loggingState.config.historyLimit);return}const n=Math.min(Math.max(r,LOGGING_HISTORY_MIN),LOGGING_HISTORY_MAX);if(loggingState.config&&loggingState.config.historyLimit===n){r!==n&&(loggingHistoryLimitInput.value=n);return}loggingHistoryLimitInput.value=n,loggingState.degraded||setLoggingStatusKey("loggingStatusUpdating"),updateLoggingConfig({historyLimit:n})};loggingHistoryLimitInput.addEventListener("change",t),loggingHistoryLimitInput.addEventListener("blur",t)}const e=(t,o)=>{t&&t.addEventListener("change",()=>{const r=!!t.checked;if(loggingState.config&&loggingState.config[o]===r){t.setAttribute("aria-checked",r?"true":"false");return}t.setAttribute("aria-checked",r?"true":"false"),loggingState.degraded||setLoggingStatusKey("loggingStatusUpdating"),updateLoggingConfig({[o]:r})})};e(loggingConsoleOutputInput,"consoleOutput"),e(loggingCaptureConsoleInput,"captureConsole"),e(loggingCaptureErrorsInput,"captureGlobalErrors"),e(loggingPersistSessionInput,"persistSession"),sessionLoggingExportButton&&sessionLoggingExportButton.addEventListener("click",()=>{exportLoggingHistory()}),loggingNamespaceHelpEl&&loggingNamespaceHelpEl.setAttribute("aria-live","polite"),attachLoggingSubscriptions()}function getStoragePersistenceLangInfo(){const e=texts&&texts.en?texts.en:{},t=typeof currentLang=="string"&&texts&&texts[currentLang]?currentLang:"en",o=texts&&texts[t]||e;return{lang:t,langTexts:o,fallbackTexts:e}}function getStorageManagerInstance(){return typeof navigator<"u"&&navigator&&typeof navigator.storage=="object"?navigator.storage:null}function formatStoragePersistenceBytes(e,t){if(typeof e!="number"||!Number.isFinite(e)||e<0)return"";const o=["B","KB","MB","GB","TB"];let r=0,n=e;for(;n>=1024&&r<o.length-1;)n/=1024,r+=1;let a="";if(typeof Intl<"u"&&typeof Intl.NumberFormat=="function")try{a=new Intl.NumberFormat(t,{maximumFractionDigits:n>=100?0:1}).format(n)}catch(s){console.warn("Unable to format storage size",s),a=n.toFixed(n>=100?0:1)}else a=n.toFixed(n>=100?0:1);return`${a} ${o[r]}`}function renderStoragePersistenceStatus(){if(!storagePersistenceStatusEl)return;const{lang:e,langTexts:t,fallbackTexts:o}=getStoragePersistenceLangInfo();let r="",n="idle";storagePersistenceState.requestInFlight?(n="requesting",r=t.storagePersistenceStatusRequesting||o.storagePersistenceStatusRequesting||""):storagePersistenceState.checking?(n="checking",r=t.storagePersistenceStatusChecking||o.storagePersistenceStatusChecking||""):storagePersistenceState.supported===!1?(n="unsupported",r=t.storagePersistenceStatusUnsupported||o.storagePersistenceStatusUnsupported||""):storagePersistenceState.persisted?(n="granted",r=t.storagePersistenceStatusGranted||o.storagePersistenceStatusGranted||""):storagePersistenceState.lastError?(n="error",r=t.storagePersistenceStatusError||o.storagePersistenceStatusError||""):storagePersistenceState.requestAttempted&&storagePersistenceState.lastRequestDenied?(n="denied",r=t.storagePersistenceStatusDenied||o.storagePersistenceStatusDenied||""):(n="idle",r=t.storagePersistenceStatusIdle||o.storagePersistenceStatusIdle||"");const a=[r];if(n==="denied"&&isSafariPersistenceIncompatibility()){const u=t.storagePersistenceStatusSafariIncompatible||o.storagePersistenceStatusSafariIncompatible||"";u&&a.push(u)}if(typeof storagePersistenceState.usage=="number"){const u=formatStoragePersistenceBytes(storagePersistenceState.usage,e);if(u)if(typeof storagePersistenceState.quota=="number"&&storagePersistenceState.quota>0){const d=formatStoragePersistenceBytes(storagePersistenceState.quota,e),m=t.storagePersistenceUsage||o.storagePersistenceUsage||"";m?a.push(m.replace("{used}",u).replace("{quota}",d||"")):d?a.push(`${u} / ${d}`):a.push(u)}else{const d=t.storagePersistenceUsageUnknown||o.storagePersistenceUsageUnknown||"";d?a.push(d.replace("{used}",u)):a.push(u)}}const l=a.filter(Boolean).join(" ").trim()||r||"";if(storagePersistenceStatusEl.textContent=l,storagePersistenceStatusEl.dataset.state=n,storagePersistenceStatusEl.setAttribute("data-state",n),l?storagePersistenceStatusEl.setAttribute("data-help",l):storagePersistenceStatusEl.removeAttribute("data-help"),sessionStoragePersistenceRequestButton){const u=!storagePersistenceStatusEl||storagePersistenceState.supported===!1||storagePersistenceState.persisted||storagePersistenceState.requestInFlight||storagePersistenceState.checking;sessionStoragePersistenceRequestButton.disabled=u,sessionStoragePersistenceRequestButton.setAttribute("aria-disabled",u?"true":"false");const d=t.storagePersistenceRequest||o.storagePersistenceRequest||sessionStoragePersistenceRequestButton.dataset.defaultLabel||sessionStoragePersistenceRequestButton.textContent||"",m=t.storagePersistenceRequestHelp||o.storagePersistenceRequestHelp||d;m&&(sessionStoragePersistenceRequestButton.setAttribute("data-help",m),sessionStoragePersistenceRequestButton.setAttribute("title",m),sessionStoragePersistenceRequestButton.setAttribute("aria-label",m))}if(typeof storagePersistenceStatusEl.dispatchEvent=="function")try{let u;const d={state:n,message:l,rawMessage:r};typeof CustomEvent=="function"?u=new CustomEvent("storagepersistencechange",{detail:d}):storagePersistenceStatusEl.ownerDocument&&typeof storagePersistenceStatusEl.ownerDocument.createEvent=="function"&&(u=storagePersistenceStatusEl.ownerDocument.createEvent("CustomEvent"),u.initCustomEvent("storagepersistencechange",!1,!1,d)),u&&storagePersistenceStatusEl.dispatchEvent(u)}catch(u){console.warn("Unable to broadcast storage persistence status change",u)}}function isSafariPersistenceIncompatibility(){if(typeof navigator>"u"||!navigator)return!1;const e=navigator;if(typeof e!="object"||e===null)return!1;if(typeof window<"u"&&window&&typeof window.safari=="object"&&window.safari&&typeof window.safari.pushNotification=="object")return!0;const t=typeof e.vendor=="string"?e.vendor:"",o=typeof e.userAgent=="string"?e.userAgent:"";if(!t&&!o)return!1;const r=t.toLowerCase().trim(),n=o.toLowerCase(),a=["crios","fxios","edgios","edga","edge","opr/","opt/","opera","chrome","chromium"];for(let C=0;C<a.length;C+=1)if(n.includes(a[C]))return!1;const s=r.includes("apple"),l=n.includes("safari"),u=n.includes("applewebkit"),d=n.includes("version/"),m=n.includes("mobile/"),y=n.includes("macintosh")||n.includes("iphone")||n.includes("ipad")||n.includes("ipod")||n.includes("watch")||n.includes("apple tv"),h=r.length===0,b=l||u&&(d||m||y),v=h&&u&&b;return!s&&!v?!1:s?b:v}async function refreshStoragePersistenceStatus(e={}){if(!storagePersistenceStatusEl)return;const{fromRequest:t=!1}=e||{},o=++storagePersistenceCheckToken;storagePersistenceState.checking=!0,t||(storagePersistenceState.lastError=null),renderStoragePersistenceStatus();const r=getStorageManagerInstance();if(!r){if(o!==storagePersistenceCheckToken)return;storagePersistenceState.supported=!1,storagePersistenceState.persisted=!1,storagePersistenceState.usage=null,storagePersistenceState.quota=null,storagePersistenceState.checking=!1,t&&(storagePersistenceState.lastRequestDenied=!0),renderStoragePersistenceStatus();return}const n=typeof r.persist=="function";storagePersistenceState.supported=n;let a=storagePersistenceState.persisted;if(typeof r.persisted=="function")try{a=await r.persisted()}catch(u){console.warn("Unable to determine persistent storage state",u)}let s=storagePersistenceState.usage,l=storagePersistenceState.quota;if(typeof r.estimate=="function")try{const u=await r.estimate();u&&typeof u=="object"&&(typeof u.usage=="number"&&Number.isFinite(u.usage)&&(s=u.usage),typeof u.quota=="number"&&Number.isFinite(u.quota)&&(l=u.quota))}catch(u){console.warn("Unable to estimate storage usage",u)}o===storagePersistenceCheckToken&&(storagePersistenceState.persisted=!!a,storagePersistenceState.usage=typeof s=="number"&&Number.isFinite(s)?s:null,storagePersistenceState.quota=typeof l=="number"&&Number.isFinite(l)?l:null,storagePersistenceState.checking=!1,t&&(storagePersistenceState.lastRequestDenied=!storagePersistenceState.persisted),logStoragePersistenceEstimateUpdate({fromRequest:t}),renderStoragePersistenceStatus())}async function handleStoragePersistenceRequest(e){if(e&&typeof e.preventDefault=="function"&&e.preventDefault(),!sessionStoragePersistenceRequestButton||storagePersistenceState.requestInFlight)return;const t=getStorageManagerInstance();storagePersistenceState.requestAttempted=!0;const o=!!(t&&typeof t.persist=="function");if(!o){storagePersistenceState.supported=o,storagePersistenceState.lastRequestDenied=!0,storagePersistenceState.lastError=null,renderStoragePersistenceStatus();return}storagePersistenceState.requestInFlight=!0,storagePersistenceState.lastError=null,renderStoragePersistenceStatus();let r=!1,n=!1;try{if(typeof requestPersistentStorage=="function"){const a=await requestPersistentStorage();a&&typeof a.supported=="boolean"&&(storagePersistenceState.supported=a.supported),a&&typeof a.granted=="boolean"&&(r=a.granted),a&&typeof a.alreadyGranted=="boolean"&&(n=a.alreadyGranted),a&&a.error&&(storagePersistenceState.lastError=a.error,console.warn("Persistent storage request error",a.error))}else r=await t.persist()}catch(a){storagePersistenceState.lastError=a,console.warn("Persistent storage request failed",a)}storagePersistenceState.requestInFlight=!1,storagePersistenceState.lastRequestDenied=!(r||n),(r||n)&&(storagePersistenceState.persisted=!0),renderStoragePersistenceStatus(),refreshStoragePersistenceStatus({fromRequest:!0}).catch(a=>{console.warn("Persistent storage status refresh failed",a)})}sessionStoragePersistenceRequestButton&&sessionStoragePersistenceRequestButton.addEventListener("click",handleStoragePersistenceRequest);storagePersistenceStatusEl&&refreshStoragePersistenceStatus().catch(e=>{console.warn("Persistent storage status initialization failed",e)});initializeLoggingPanel();typeof window<"u"&&window&&typeof window.addEventListener=="function"&&window.addEventListener("beforeunload",()=>{detachLoggingSubscriptions(),loggingState.retryTimer!=null&&(clearTimeout(loggingState.retryTimer),loggingState.retryTimer=null)});ensureSessionRuntimePlaceholder("renderStoragePersistenceStatus",()=>renderStoragePersistenceStatus);ensureSessionRuntimePlaceholder("refreshStoragePersistenceStatus",()=>refreshStoragePersistenceStatus);const bindBackupDiffEvents=()=>{const e=n=>typeof document<"u"?document.getElementById(n):null,t=(n,a,s)=>{const l=e(n);l?l.addEventListener(a,s):typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"&&cineCoreUiHelpers.whenElementAvailable(n,u=>u.addEventListener(a,s))};t("backupDiffToggleButton","click",handleBackupDiffToggle),t("backupDiffClose","click",()=>collapseBackupDiffSection()),t("backupDiffPrimary","change",handleBackupDiffSelectionChange),t("backupDiffSecondary","change",handleBackupDiffSelectionChange),t("backupDiffExport","click",handleBackupDiffExport);const o=e("backupDiffSummary");o?o.textContent=getDiffText("versionCompareNoSelection","Choose two versions to generate a diff."):typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"&&cineCoreUiHelpers.whenElementAvailable("backupDiffSummary",n=>{n.textContent=getDiffText("versionCompareNoSelection","Choose two versions to generate a diff.")});const r=e("backupDiffExport");r&&(r.disabled=!0)};bindBackupDiffEvents();backupDiffNotesEl&&(backupDiffNotesEl.disabled=!0);backupDiffSectionEl&&collapseBackupDiffSection();function handleRestoreSettingsClick(){restoreSettingsInput&&restoreSettingsInput.click()}function handleRestoreSettingsInputChange(){const e=restoreSettingsInput.files[0];if(!e)return;const t=texts[currentLang]||{},o=texts.en||{},r=t.restoreFailed||o.restoreFailed||"Restore failed. Check the backup file and try again.";let n=null,a=null;try{const w=performSettingsBackup(!1,new Date);n=w?w.fileName:null,a=w?w.downloadResult:null}catch(w){console.error("Backup before restore failed",w)}if(!n||!a||!a.success&&!a.queued){const w=t.restoreBackupFailed||o.restoreBackupFailed||"Backup failed. Restore cancelled.";showNotification$1("error",w),typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Restore Failed",message:w}):alert(w),restoreSettingsInput.value="";return}if(a.success)showNotification$1("success","Full app backup downloaded");else if(a.queued){const w=a.queueMessage||o.queuedBackupDownloadDeferred||"Automatic downloads were blocked. The backup was saved to the local vault.",R=t.restoreBackupQueuedConfirm||o.restoreBackupQueuedConfirm||"The safety backup is waiting in the local vault. Continue with the restore now?";showNotification$1("warning",w);let _=!1;if(typeof confirm=="function"?_=confirm(`${w}

${R}`):typeof alert=="function"&&(alert(`${w}

${R}`),_=!0),!_){restoreSettingsInput.value="";return}}const s=resolveSafeLocalStorage(),l=captureStorageSnapshot(s),u=captureStorageSnapshot(typeof sessionStorage<"u"?sessionStorage:null),d=captureSetupSelection();let m=!1;const y=async()=>{try{restoreSettingsInput.value=""}catch{}},h=async()=>{try{restoreLocalStorageSnapshot(s,l)}catch(_){console.warn("Failed to restore localStorage snapshot after restore failure",_)}try{restoreSessionStorageSnapshot(u)}catch(_){console.warn("Failed to restore sessionStorage snapshot after restore failure",_)}try{safeLoadStoredLogoPreview()}catch(_){console.warn("Failed to refresh logo preview after restore failure",_)}try{syncAutoGearRulesFromStorage()}catch(_){console.warn("Failed to resync automatic gear rules after restore failure",_)}const w=createSafeStorageReader(s,"Failed to read restored storage key"),R=applyPreferencesFromStorage(w);showAutoBackups$1=R.showAutoBackups;try{populateSetupSelect()}catch(_){console.warn("Failed to repopulate setup selector after restore failure",_)}if(restoreSetupSelection(d,showAutoBackups$1),settingsShowAutoBackups)try{settingsShowAutoBackups.checked=showAutoBackups$1}catch(_){console.warn("Failed to restore automatic backup visibility toggle after restore failure",_)}if(R.language)try{if(await applySetLanguage(R.language),typeof populateUserButtonDropdowns$1=="function")try{populateUserButtonDropdowns$1()}catch(_){console.warn("Failed to refresh user button selectors after restoring language",_)}}catch(_){console.warn("Failed to restore language after restore failure",_)}},b=w=>{console.warn("Restore failed",w),showNotification$1("error",r),typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Restore Failed",message:r}):alert(r),y()},v=async w=>{try{const R=sanitizeBackupPayload(w);if(!R||!R.trim())throw new Error("Backup payload empty");const _=JSON.parse(R),{settings:G,sessionStorage:O,data:B,fileVersion:$}=extractBackupSections(_),V=G&&Object.keys(G).length>0,M=O&&Object.keys(O).length>0,F=B&&Object.keys(B).length>0;if(!V&&!M&&!F)throw new Error("Backup missing recognized sections");const z=normalizeVersionValue($),x=ACTIVE_APP_VERSION$1||normalizeVersionValue(typeof APP_VERSION=="string"?APP_VERSION:null);if(z!==x){const de=buildRestoreVersionCompatibilityMessage({langTexts:t,fallbackTexts:o,fileVersion:z,targetVersion:x,data:B,settingsSnapshot:G,sessionSnapshot:O,backupFileName:n});typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Version Compatibility",message:de}):alert(de)}const H=G&&typeof G=="object"&&!Array.isArray(G),W=O&&typeof O=="object"&&!Array.isArray(O);H&&(m=!0,restoreLocalStorageSnapshot(s,G)),W&&(m=!0,restoreSessionStorageSnapshot(O));try{safeLoadStoredLogoPreview()}catch(de){console.warn("Failed to refresh logo preview after restore",de)}B&&typeof importAllData=="function"&&(m=!0,importAllData(B));try{syncAutoGearRulesFromStorage(B?.autoGearRules)}catch(de){console.warn("Failed to sync automatic gear rules after restore",de)}const U=createSafeStorageReader(s,"Failed to read restored storage key"),j=applyPreferencesFromStorage(U);if(showAutoBackups$1=j.showAutoBackups,typeof populateSetupSelect=="function"&&populateSetupSelect(),restoreSetupSelection(d,showAutoBackups$1),settingsShowAutoBackups&&(settingsShowAutoBackups.checked=showAutoBackups$1),j.language&&(await applySetLanguage(j.language),typeof populateUserButtonDropdowns$1=="function"))try{populateUserButtonDropdowns$1()}catch(de){console.warn("Failed to refresh user button selectors after applying restored preferences",de)}W&&restoreSessionStorageSnapshot(O);let Y=null;try{Y=verifyRestoredBackupIntegrity(B)}catch(de){console.warn("Restore verification execution failed",de),Y=null}Y&&Y.notificationType&&Y.notificationMessage&&showNotification$1(Y.notificationType,Y.notificationMessage);const be=[texts[currentLang].restoreSuccess];Y&&Y.alertMessage&&be.push(Y.alertMessage);const re=be.join(`

`);typeof window.cineShowAlertDialog=="function"?window.cineShowAlertDialog({title:"Restore Successful",message:re}):alert(re),y()}catch(R){if(m)try{await h()}catch(_){console.warn("Failed to restore previous state after restore error",_)}b(R)}},C=w=>!e||typeof e.text!="function"?!1:(w?console.warn("FileReader unavailable for restore, using file.text()",w):console.warn("FileReader unavailable for restore, using file.text()"),Promise.resolve().then(()=>e.text()).then(v).catch(b),!0);let A=null;if(typeof FileReader=="function")try{A=new FileReader}catch(w){console.warn("Failed to create FileReader for restore",w),A=null}if(A&&typeof A.readAsText=="function"){A.onload=w=>{const R=w&&w.target?w.target.result:"";v(R)},A.onerror=()=>{const w=A.error||new Error("Failed to read backup file");console.warn("FileReader failed while reading restore file",w),C(w)||b(w)};try{A.readAsText(e);return}catch(w){console.warn("Failed to read restore file",w),C(w)||b(w);return}}C()||b(new Error("No supported file reader available"))}restoreSettings&&restoreSettingsInput&&(restoreSettings.addEventListener("click",handleRestoreSettingsClick),restoreSettingsInput.addEventListener("change",handleRestoreSettingsInputChange));function getSessionLanguageTexts(){const e=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,t=typeof texts<"u"&&texts||(e&&typeof e.texts=="object"?e.texts:null),o=typeof currentLang=="string"&&t&&typeof t[currentLang]=="object"?currentLang:"en",r=t&&typeof t[o]=="object"&&t[o]||{},n=t&&typeof t.en=="object"&&t.en||{};return{langTexts:r,fallbackTexts:n}}function registerSessionCineUiInternal(e){!e||sessionCineUiRegistered||(registerCineUiEntries(e.controllers,[{name:"backupSettings",value:{execute:createSettingsBackup$1}},{name:"restoreSettings",value:{openPicker:handleRestoreSettingsClick,processFile:handleRestoreSettingsInputChange}}],"cineUi controller registration (session) failed"),registerCineUiEntries(e.interactions,[{name:"performBackup",value:createSettingsBackup$1},{name:"openRestorePicker",value:handleRestoreSettingsClick},{name:"applyRestoreFile",value:handleRestoreSettingsInputChange}],"cineUi interaction registration (session) failed"),registerCineUiEntries(e.help,[{name:"backupSettings",value:()=>{const{langTexts:t,fallbackTexts:o}=getSessionLanguageTexts();return t.backupSettingsHelp||o.backupSettingsHelp||"Download a full JSON backup containing every project, device edit, preference, auto-gear rule and runtime log stored on this device. Keep multiple copies in your offline archive."}},{name:"restoreSettings",value:()=>{const{langTexts:t,fallbackTexts:o}=getSessionLanguageTexts();return t.restoreSettingsHelp||o.restoreSettingsHelp||"Restore a full JSON backup. The planner captures a fresh safety copy first, then applies the selected file so you can roll back immediately if anything looks wrong."}}],"cineUi help registration (session) failed"),sessionCineUiRegistered=areSessionEntriesRegistered(e))}function registerSessionCineUi(){const e=typeof globalThis<"u"&&globalThis.cineUi||typeof window<"u"&&window.cineUi||typeof self<"u"&&self.cineUi||null;return e?(registerSessionCineUiInternal(e),!0):!1}registerSessionCineUi();restoreRehearsalButtonEl&&restoreRehearsalButtonEl.addEventListener("click",()=>{openRestoreRehearsal()});restoreRehearsalCloseButtonEl&&restoreRehearsalCloseButtonEl.addEventListener("click",()=>{closeRestoreRehearsal()});restoreRehearsalBrowseButtonEl&&restoreRehearsalInputEl&&restoreRehearsalBrowseButtonEl.addEventListener("click",()=>{restoreRehearsalInputEl.click()});restoreRehearsalProceedButtonEl&&restoreRehearsalProceedButtonEl.addEventListener("click",()=>{handleRestoreRehearsalProceed()});restoreRehearsalAbortButtonEl&&restoreRehearsalAbortButtonEl.addEventListener("click",()=>{handleRestoreRehearsalAbort()});restoreRehearsalInputEl&&restoreRehearsalInputEl.addEventListener("change",()=>{const e=restoreRehearsalInputEl.files&&restoreRehearsalInputEl.files[0];if(!e){resetRestoreRehearsalState({keepStatus:!0});return}restoreRehearsalFileNameEl&&(restoreRehearsalFileNameEl.textContent=e.name||restoreRehearsalFileNameEl.textContent),runRestoreRehearsal(e)});typeof globalThis<"u"&&(globalThis.applySharedSetup=applySharedSetup$1,globalThis.applySharedSetupFromUrl=applySharedSetupFromUrl$1);function resetPlannerStateAfterFactoryReset$1(){const e=typeof suspendProjectPersistence=="function"&&typeof resumeProjectPersistence=="function";if(e)try{suspendProjectPersistence()}catch(t){console.warn("Failed to suspend project persistence during factory reset cleanup",t)}try{try{typeof storeLoadedSetupState=="function"&&storeLoadedSetupState(null)}catch(o){console.warn("Failed to reset loaded setup state during factory reset",o)}try{currentProjectInfo$1=null}catch(o){console.warn("Failed to clear in-memory project info during factory reset",o)}try{typeof populateProjectForm=="function"?populateProjectForm({}):projectForm$1&&typeof projectForm$1.reset=="function"&&projectForm$1.reset()}catch(o){console.warn("Failed to reset project form during factory reset",o)}try{displayGearAndRequirements("")}catch(o){console.warn("Failed to reset gear displays during factory reset",o),gearListOutput$1&&(gearListOutput$1.innerHTML="",gearListOutput$1.classList.add("hidden")),projectRequirementsOutput$1&&(projectRequirementsOutput$1.innerHTML="",projectRequirementsOutput$1.classList.add("hidden"))}[cameraSelect$1,monitorSelect$1,videoSelect,cageSelect,distanceSelect,batterySelect,hotswapSelect$1,batteryPlateSelect$1].forEach(o=>{if(o)try{const r=Array.from(o.options||[]);r.find(a=>a.value==="None")?o.value="None":r.length?o.selectedIndex=0:o.value=""}catch(r){console.warn("Failed to reset selector during factory reset",r)}});try{resetSelectsToNone(motorSelects)}catch(o){console.warn("Failed to reset motor selections during factory reset",o)}try{resetSelectsToNone(controllerSelects)}catch(o){console.warn("Failed to reset controller selections during factory reset",o)}try{if(typeof getSliderBowlSelect=="function"){const o=getSliderBowlSelect();o&&(o.value="")}else console.warn("Skipping slider bowl selection reset during factory reset because helper is unavailable")}catch(o){console.warn("Failed to reset slider bowl selection during factory reset",o)}try{if(typeof getEasyrigSelect=="function"){const o=getEasyrigSelect();o&&(o.value="")}else console.warn("Skipping Easyrig selection reset during factory reset because helper is unavailable")}catch(o){console.warn("Failed to reset Easyrig selection during factory reset",o)}try{setupNameInput$1&&(setupNameInput$1.value="")}catch(o){console.warn("Failed to clear setup name during factory reset",o)}try{setupSelect$1&&(populateSetupSelect(),setupSelect$1.value="")}catch(o){console.warn("Failed to reset setup selector options during factory reset",o)}try{syncAutoGearRulesFromStorage()}catch(o){console.warn("Failed to sync automatic gear rules during factory reset",o);try{clearProjectAutoGearRules()}catch(r){console.warn("Failed to clear project automatic gear rules during factory reset",r)}}try{renderAutoGearRulesList()}catch(o){console.warn("Failed to render automatic gear rules during factory reset",o)}try{resetSharedImportStateForFactoryReset()}catch(o){console.warn("Failed to reset shared import state during factory reset",o)}try{updateAutoGearCatalogOptions()}catch(o){console.warn("Failed to refresh automatic gear catalog during factory reset",o)}try{updateBatteryPlateVisibility()}catch(o){console.warn("Failed to reset battery plate visibility during factory reset",o)}try{updateBatteryOptions()}catch(o){console.warn("Failed to reset battery options during factory reset",o)}try{safeLoadStoredLogoPreview()}catch(o){console.warn("Failed to reset custom logo preview during factory reset",o)}try{typeof resetCustomFontsForFactoryReset=="function"?resetCustomFontsForFactoryReset():console.warn("Skipping custom font reset during factory reset because helper is unavailable")}catch(o){console.warn("Failed to reset custom fonts during factory reset",o)}try{updateStorageSummary()}catch(o){console.warn("Failed to update storage summary during factory reset",o)}try{ensureGearListActions()}catch(o){console.warn("Failed to ensure gear list actions during factory reset",o)}try{checkSetupChanged$1()}catch(o){console.warn("Failed to refresh setup state during factory reset",o)}try{updateCalculations$1()}catch(o){console.warn("Failed to update calculations during factory reset",o)}}finally{if(e)try{resumeProjectPersistence()}catch(t){console.warn("Failed to resume project persistence after factory reset cleanup",t)}}}window.cineShowConfirmDialog=e=>{const{title:t,message:o,confirmLabel:r,cancelLabel:n,onConfirm:a,onCancel:s,danger:l=!1}=e||{},u=document.getElementById("appConfirmDialog"),d=document.getElementById("appConfirmTitle"),m=document.getElementById("appConfirmMessage"),y=document.getElementById("appConfirmBtn"),h=document.getElementById("appConfirmCancelBtn");if(!u||!y||!h){console.warn("Confirmation dialog elements missing");return}d&&(d.textContent=t||"Confirm"),m&&(typeof o=="string"&&o.includes(`
`)?m.innerHTML=o.replace(/\n/g,"<br>"):m.textContent=o||"Are you sure?"),y.textContent=r||"Confirm",h.textContent=n||"Cancel",h.style.display="inline-block",l?y.classList.add("danger"):y.classList.remove("danger");const b=y.cloneNode(!0),v=h.cloneNode(!0);y.parentNode.replaceChild(b,y),h.parentNode.replaceChild(v,h);const C=()=>{typeof u.close=="function"&&u.close(),u.setAttribute("hidden","")};b.addEventListener("click",()=>{C(),typeof a=="function"&&a()}),v.addEventListener("click",()=>{C(),typeof s=="function"&&s()}),u.removeAttribute("hidden"),typeof u.showModal=="function"&&u.showModal()};window.cineShowAlertDialog=e=>{const t=typeof e=="string"?{message:e}:e||{},{title:o,message:r,confirmLabel:n,onConfirm:a}=t,s=document.getElementById("appConfirmDialog"),l=document.getElementById("appConfirmTitle"),u=document.getElementById("appConfirmMessage"),d=document.getElementById("appConfirmBtn"),m=document.getElementById("appConfirmCancelBtn");if(!s||!d||!m){console.warn("Alert dialog elements missing"),typeof alert=="function"&&alert(r);return}l&&(l.textContent=o||"Notification"),u&&(typeof r=="string"&&r.includes(`
`)?u.innerHTML=r.replace(/\n/g,"<br>"):u.textContent=r||""),d.textContent=n||"OK",d.classList.remove("danger"),m.style.display="none";const y=d.cloneNode(!0);d.parentNode.replaceChild(y,d);const h=()=>{typeof s.close=="function"&&s.close(),s.setAttribute("hidden","")};y.addEventListener("click",()=>{h(),typeof a=="function"&&a()}),s.removeAttribute("hidden"),typeof s.showModal=="function"&&s.showModal()};factoryResetButton&&factoryResetButton.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=texts[currentLang]||texts.en||{};window.cineShowConfirmDialog({title:t.factoryResetTitle||"Factory Reset",message:t.confirmFactoryReset||"Create a backup and wipe all planner data? This action cannot be undone.",confirmLabel:t.factoryResetConfirm||"Reset Everything",cancelLabel:t.cancel||"Cancel",danger:!0,onConfirm:async()=>{if(typeof performSettingsBackup!="function"){const l=t.factoryResetError||"Factory reset failed. Please try again.";showNotification$1("error",l);return}let o=null;try{o=await performSettingsBackup(!1,new Date)}catch(l){console.error("Backup before factory reset failed",l)}if(!o||!o.fileName){const l=t.factoryResetBackupFailed||"Backup failed. Data was not deleted.";showNotification$1("error",l);return}let r="unknown",n="unknown";const a=o.downloadResult,s=a&&a.permission?a.permission:null;if(s&&s.initial&&typeof s.initial.then=="function")try{r=await s.initial}catch(l){console.warn("Failed to inspect automatic download permission before factory reset",l),r="unknown"}if(r==="denied"){const l=t.factoryResetDownloadBlocked||"The backup download was blocked. Data was not deleted.";showNotification$1("error",l),typeof alert=="function"&&alert(l);return}if(r==="prompt"){const l=t.factoryResetAwaitDownload||"Allow downloads to save your backup. The factory reset will continue after you accept the download.";showNotification$1("info",l),typeof alert=="function"&&alert(l)}if(s&&s.ready&&typeof s.ready.then=="function")try{n=await s.ready}catch(l){console.warn("Failed to await automatic download permission before factory reset",l),n="unknown"}else n=r;if(r==="prompt"){if((typeof n!="string"||!n)&&(n="unknown"),n!=="granted"){const l=t.factoryResetDownloadBlocked||"The backup download was blocked. Data was not deleted.";showNotification$1("error",l),typeof alert=="function"&&alert(l);return}}else if(n==="denied"){const l=t.factoryResetDownloadBlocked||"The backup download was blocked. Data was not deleted.";showNotification$1("error",l),typeof alert=="function"&&alert(l);return}if(typeof clearAllData!="function"){const l=t.factoryResetError||"Factory reset failed. Please try again.";showNotification$1("error",l);return}try{if(factoryResetInProgress$1=!0,typeof globalThis<"u")try{globalThis.__cameraPowerPlannerFactoryResetting=!0}catch(u){console.warn("Unable to flag factory reset on global scope",u)}projectAutoSaveTimer&&(clearTimeout(projectAutoSaveTimer),projectAutoSaveTimer=null);try{stopPinkModeIconRotation(),stopPinkModeAnimatedIcons()}catch(u){console.warn("Failed to stop pink mode animations during factory reset",u)}await clearAllData();try{if(typeof window<"u"&&typeof window.dispatchEvent=="function"){const u="cameraPowerPlannerFactoryReset";let d=null;typeof window.CustomEvent=="function"?d=new window.CustomEvent(u):typeof document<"u"&&typeof document.createEvent=="function"&&(d=document.createEvent("Event"),d.initEvent(u,!1,!1)),d&&window.dispatchEvent(d)}}catch(u){console.warn("Failed to dispatch factory reset event",u)}try{resetPlannerStateAfterFactoryReset$1()}catch(u){console.warn("Failed to reset planner state after factory reset",u)}try{setThemePreference(!1,{persist:!0})}catch(u){console.warn("Failed to reset dark mode during factory reset",u)}try{highContrastEnabled=!1,applyHighContrast$1(!1),settingsHighContrast&&(settingsHighContrast.checked=!1)}catch(u){console.warn("Failed to reset high contrast during factory reset",u)}try{pinkModeEnabled=!1,applyPinkMode$1(!1),rememberSettingsPinkModeBaseline()}catch(u){console.warn("Failed to reset pink mode during factory reset",u)}showAutoBackups$1=!1,settingsShowAutoBackups&&(settingsShowAutoBackups.checked=!1);try{accentColor=DEFAULT_ACCENT_COLOR,prevAccentColor=DEFAULT_ACCENT_COLOR,clearAccentColorOverrides(),applyAccentColor(accentColor),accentColorInput&&(accentColorInput.value=DEFAULT_ACCENT_COLOR),typeof updateAccentColorResetButtonState=="function"&&updateAccentColorResetButtonState()}catch(u){console.warn("Failed to reset accent color during factory reset",u)}try{const u=getSessionRuntimeFunction("resetMountVoltagePreferences");u?u({persist:!0,triggerUpdate:!0}):warnMissingMountVoltageHelper("resetMountVoltagePreferences");const d=getSessionRuntimeFunction("updateMountVoltageInputsFromState");d?d():warnMissingMountVoltageHelper("updateMountVoltageInputsFromState"),rememberSettingsMountVoltagesBaseline()}catch(u){console.warn("Failed to reset mount voltages during factory reset",u)}try{fontSize="16",applyFontSizeSafe(fontSize),settingsFontSize&&(settingsFontSize.value=fontSize)}catch(u){console.warn("Failed to reset font size during factory reset",u)}try{fontFamily="'Ubuntu', sans-serif",applyFontFamilySafe(fontFamily),settingsFontFamily&&(settingsFontFamily.value=fontFamily)}catch(u){console.warn("Failed to reset font family during factory reset",u)}settingsDialog&&settingsDialog.setAttribute("hidden","");const l=t.factoryResetSuccess||"Backup downloaded. All planner data cleared. Reloading…";showNotification$1("success",l),setTimeout(()=>{typeof window<"u"&&window.location&&window.location.reload&&window.location.reload()},600)}catch(l){if(console.error("Factory reset failed",l),factoryResetInProgress$1=!1,typeof globalThis<"u")try{delete globalThis.__cameraPowerPlannerFactoryResetting}catch(d){console.warn("Unable to clear factory reset flag from global scope",d)}const u=t.factoryResetError||"Factory reset failed. Please try again.";showNotification$1("error",u)}}})});const UI_CACHE_STORAGE_KEYS_FOR_RELOAD=["cameraPowerPlanner_schemaCache","cinePowerPlanner_schemaCache"],UI_CACHE_STORAGE_SUFFIXES_FOR_RELOAD=["","__backup","__legacyMigrationBackup"],uiCacheFallbackWarningKeys=new Set;function collectFallbackUiCacheStorages(){const e=new Set,t=(n,a)=>{if(!n||typeof n!="object"&&typeof n!="function")return;const s=typeof n.removeItem=="function",l=typeof n.delete=="function";!s&&!l||e.add(n)},o=(n,a)=>{if(!n||typeof n!="object"&&typeof n!="function")return;try{t(n.SAFE_LOCAL_STORAGE,`${a}.SAFE_LOCAL_STORAGE`)}catch(l){uiCacheFallbackWarningKeys.has(`${a}.SAFE_LOCAL_STORAGE`)||(uiCacheFallbackWarningKeys.add(`${a}.SAFE_LOCAL_STORAGE`),console.warn(`Unable to inspect ${a}.SAFE_LOCAL_STORAGE while clearing UI caches`,l))}try{t(n.localStorage,`${a}.localStorage`)}catch(l){uiCacheFallbackWarningKeys.has(`${a}.localStorage`)||(uiCacheFallbackWarningKeys.add(`${a}.localStorage`),console.warn(`Unable to inspect ${a}.localStorage while clearing UI caches`,l))}try{t(n.sessionStorage,`${a}.sessionStorage`)}catch(l){uiCacheFallbackWarningKeys.has(`${a}.sessionStorage`)||(uiCacheFallbackWarningKeys.add(`${a}.sessionStorage`),console.warn(`Unable to inspect ${a}.sessionStorage while clearing UI caches`,l))}let s=null;try{s=n.__cineGlobal}catch(l){uiCacheFallbackWarningKeys.has(`${a}.__cineGlobal`)||(uiCacheFallbackWarningKeys.add(`${a}.__cineGlobal`),console.warn(`Unable to inspect ${a}.__cineGlobal while clearing UI caches`,l))}s&&s!==n&&o(s,`${a}.__cineGlobal`)};if(t(resolveSafeLocalStorage()),typeof SAFE_LOCAL_STORAGE<"u")try{t(SAFE_LOCAL_STORAGE,"SAFE_LOCAL_STORAGE")}catch(n){uiCacheFallbackWarningKeys.has("SAFE_LOCAL_STORAGE")||(uiCacheFallbackWarningKeys.add("SAFE_LOCAL_STORAGE"),console.warn("Unable to inspect SAFE_LOCAL_STORAGE while clearing UI caches",n))}const r=[{scope:typeof globalThis<"u"?globalThis:null,label:"globalThis"},{scope:typeof window<"u"?window:null,label:"window"},{scope:typeof self<"u"?self:null,label:"self"},{scope:typeof global<"u"?global:null,label:"global"}];return typeof __cineGlobal<"u"&&r.push({scope:__cineGlobal,label:"__cineGlobal"}),r.forEach(({scope:n,label:a})=>{o(n,a)}),typeof localStorage<"u"&&t(localStorage),typeof sessionStorage<"u"&&t(sessionStorage),e}function clearUiCacheEntriesFallback(){const e=collectFallbackUiCacheStorages();!e||!e.size||e.forEach(t=>{UI_CACHE_STORAGE_KEYS_FOR_RELOAD.forEach(o=>{typeof o!="string"||!o||UI_CACHE_STORAGE_SUFFIXES_FOR_RELOAD.forEach(r=>{const n=r?`${o}${r}`:o;try{typeof t.removeItem=="function"?t.removeItem(n):typeof t.delete=="function"&&t.delete(n)}catch(a){console.warn("Failed to remove UI cache entry",n,a)}})})})}const CACHE_KEY_TOKENS_FOR_RELOAD=["cine-power-planner","cinepowerplanner"];function resolveCineCacheNameForReload(){const e=[typeof globalThis<"u"?globalThis:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const r=o.CINE_CACHE_NAME;if(typeof r=="string"&&r)return r}catch{}}return""}function isRelevantCacheKeyForReload(e,t,o){if(typeof e!="string"||!e)return!1;if(t&&(e===t||e.toLowerCase()===o))return!0;const r=e.toLowerCase();for(let n=0;n<CACHE_KEY_TOKENS_FOR_RELOAD.length;n+=1)if(r.includes(CACHE_KEY_TOKENS_FOR_RELOAD[n]))return!0;return!1}function readLocationHrefSafe(e){if(!e||typeof e!="object")return"";try{const t=e.href;return typeof t=="string"?t:""}catch{return""}}function readLocationPathnameSafe(e){if(!e||typeof e!="object")return"";try{const t=e.pathname;return typeof t=="string"?t:""}catch{return""}}function readLocationOriginSafe(e){if(!e||typeof e!="object")return"";try{const r=e.origin;if(typeof r=="string"&&r)return r}catch{}const t=readLocationHrefSafe(e);if(!t)return"";if(typeof URL=="function")try{return new URL(t).origin}catch{}const o=t.match(/^([a-zA-Z][a-zA-Z\d+.-]*:\/\/[^/]+)/);return o&&o[1]?o[1]:""}function getForceReloadBaseCandidates(e,t){const o=[],r=new Set,n=u=>{if(typeof u!="string")return;const d=u.trim();!d||r.has(d)||(r.add(d),o.push(d))},a=readLocationHrefSafe(e);a&&n(a),typeof t=="string"&&t&&n(t);const s=readLocationOriginSafe(e),l=readLocationPathnameSafe(e);if(s&&(l&&n(`${s}${l}`),n(`${s}/`)),typeof window<"u"&&window&&window.location){const u=readLocationHrefSafe(window.location);u&&n(u)}return o}function normaliseForceReloadHref(e,t){if(typeof e!="string")return"";const o=e.trim();if(!o)return"";if(typeof URL=="function")try{return new URL(o).toString()}catch{if(typeof t=="string"&&t)try{return new URL(o,t).toString()}catch{}}return o}function buildForceReloadHref(e,t){const o=typeof t=="string"&&t?t:"forceReload",r=Date.now().toString(36),n=readLocationHrefSafe(e),a=getForceReloadBaseCandidates(e,n);if(!n)return{originalHref:n,nextHref:n,param:o,timestamp:r};if(typeof URL=="function"){const y=[n,...a];for(let h=0;h<y.length;h+=1){const b=y[h];try{const v=h===0?new URL(b):new URL(n,b);return v.searchParams.set(o,r),{originalHref:n,nextHref:v.toString(),param:o,timestamp:r}}catch{}}}let s=n,l="";const u=s.indexOf("#");u!==-1&&(l=s.slice(u),s=s.slice(0,u));const d=new RegExp(`([?&])${o}=[^&]*`),m=`$1${o}=${r}`;if(d.test(s)?s=s.replace(d,m):s.indexOf("?")!==-1?s+=`&${o}=${r}`:s&&(s+=`?${o}=${r}`),typeof URL=="function")for(let y=0;y<a.length;y+=1){const h=a[y];try{const b=new URL(s+l,h).toString();return{originalHref:n,nextHref:b,param:o,timestamp:r}}catch{}}return{originalHref:n,nextHref:s?s+l:n,param:o,timestamp:r}}function waitForReloadNavigation(e,t={}){if(typeof window>"u"||!window)return Promise.resolve(!1);const o=window,r=typeof e=="string"?e:"",n=t&&typeof t.timeout=="number"&&t.timeout>0?t.timeout:1500,a=t&&typeof t.interval=="number"&&t.interval>0?t.interval:60,s=typeof o.setTimeout=="function"?o.setTimeout.bind(o):setTimeout,l=typeof o.clearTimeout=="function"?o.clearTimeout.bind(o):clearTimeout;return new Promise(u=>{let d=!1,m=null,y=null;const h=()=>{if(m){try{l(m)}catch{}m=null}if(y){try{l(y)}catch{}y=null}if(typeof o.removeEventListener=="function"){try{o.removeEventListener("beforeunload",v,!0)}catch{}try{o.removeEventListener("pagehide",v,!0)}catch{}try{o.removeEventListener("unload",v,!0)}catch{}}},b=A=>{d||(d=!0,h(),u(A))},v=()=>{b(!0)},C=()=>{if(!d){try{const A=readLocationHrefSafe(o.location);if(r&&A&&A!==r){b(!0);return}}catch{}m=s(C,a)}};if(typeof o.addEventListener=="function"){try{o.addEventListener("beforeunload",v,!0)}catch{}try{o.addEventListener("pagehide",v,!0)}catch{}try{o.addEventListener("unload",v,!0)}catch{}}C(),y=s(()=>{b(!1)},n)})}function scheduleForceReloadNavigationWarning(e,t,o,r,n,a){let s=null;try{typeof window<"u"&&window&&typeof window.setTimeout=="function"&&(s=window.setTimeout.bind(window))}catch{}if(!s)if(typeof setTimeout=="function")s=setTimeout;else{console.warn("Forced reload navigation attempt did not update location",{description:o,before:r,after:a,expected:n});return}let l=!1;const u=()=>{const m=readLocationHrefSafe(e),y=normaliseForceReloadHref(m,t);return n&&(y===n||y===`${n}#`)||r!==y&&y&&(!n||y===n)?(l=!0,{matched:!0,value:y}):{matched:!1,value:y}},d=[90,240,480];d.forEach((m,y)=>{const h=y===d.length-1,b=()=>{if(l)return;const v=u();v.matched||h&&(l=!0,console.warn("Forced reload navigation attempt did not update location",{description:o,before:r,after:v.value,expected:n}))};try{s(b,m)}catch{h&&b()}})}function attemptForceReloadNavigation(e,t,o,r,n){if(!e||typeof r!="function"||typeof t!="string"||!t)return!1;const a=readLocationHrefSafe(e),s=normaliseForceReloadHref(a,o);try{r(t)}catch(m){return console.warn("Forced reload navigation helper failed",{description:n,error:m}),!1}const l=readLocationHrefSafe(e),u=normaliseForceReloadHref(l,o),d=normaliseForceReloadHref(t,o);return d&&(u===d||u===`${d}#`)||s!==u&&u&&(!d||u===d)?!0:(scheduleForceReloadNavigationWarning(e,o,n,s,d,u),!1)}function attemptForceReloadHistoryFallback(e,t,o,r){if(!e||!t||typeof o!="string"||!o)return!1;let n=null;try{n=e.history||null}catch(v){console.warn("Forced reload history access failed",v),n=null}if(!n||typeof n.replaceState!="function")return!1;const a=readLocationHrefSafe(t),s=normaliseForceReloadHref(a,r),l=normaliseForceReloadHref(o,r);let u=o;try{const v=a||r||void 0,C=typeof URL=="function"?new URL(o,v):null;C&&(u=`${C.pathname||""}${C.search||""}${C.hash||""}`||C.toString())}catch(v){console.warn("Forced reload history fallback URL parse failed",v),u=o}let d=null,m=!1;try{d=n.state,m=!0}catch(v){console.warn("Forced reload history state snapshot failed",v)}try{n.replaceState(m?d:null,"",u)}catch(v){return console.warn("Forced reload history replaceState failed",v),!1}const y=readLocationHrefSafe(t),h=normaliseForceReloadHref(y,r);if(!(l&&(h===l||h===`${l}#`)||s!==h&&h&&(!l||h===l)))return scheduleForceReloadNavigationWarning(t,r,"history.replaceState",s,l,h),!1;if(typeof t.reload=="function")try{return t.reload(),!0}catch(v){console.warn("Forced reload via history replaceState reload failed",v)}return!0}function scheduleForceReloadFallbacks(e,t,o={}){if(!e||!t)return;let r=null;try{typeof e.setTimeout=="function"&&(r=e.setTimeout.bind(e))}catch{}if(!r)if(typeof setTimeout=="function")r=setTimeout;else return;const n=o.hasReload===!0&&typeof t.reload=="function",a=typeof o.baseHref=="string"?o.baseHref:"",s=typeof o.nextHref=="string"?o.nextHref:"",l=typeof o.originalHref=="string"?o.originalHref:"",u=s||a||l||"",d=u?u.split("#")[0]:a||l||"",m=typeof o.timestamp=="string"&&o.timestamp?o.timestamp:Date.now().toString(36),y=d?`${d}#forceReload-${m}`:"",h=[];let b=120;const v=120,C=A=>{h.push({delay:b,run:A}),b+=v};if(u&&(typeof t.assign=="function"&&C(()=>{try{t.assign(u)}catch(A){console.warn("Forced reload fallback via location.assign failed",A)}}),typeof t.replace=="function"&&C(()=>{try{t.replace(u)}catch(A){console.warn("Forced reload fallback via location.replace failed",A)}}),C(()=>{try{t.href=u}catch(A){console.warn("Forced reload fallback via href assignment failed",A)}})),y&&y!==u&&C(()=>{try{t.href=y}catch(A){console.warn("Forced reload fallback via hash injection failed",A)}}),n){const A=h.length?Math.max(b,280):280;h.push({delay:A,run(){try{t.reload()}catch(w){console.warn("Timed force reload fallback failed",w)}}})}h.length&&h.forEach(A=>{try{r(A.run,A.delay)}catch(w){console.warn("Unable to schedule forced reload fallback",w)}})}function prepareForceReloadContext(e){if(!e||!e.location)return null;const{location:t}=e,o=typeof t.replace=="function",r=typeof t.assign=="function",n=typeof t.reload=="function",a=buildForceReloadHref(t,"forceReload"),{originalHref:s,nextHref:l,timestamp:u}=a,d=normaliseForceReloadHref(s,s)||s;return{win:e,location:t,hasReplace:o,hasAssign:r,hasReload:n,originalHref:s,nextHref:l,timestamp:u,baseHref:d}}function executeForceReloadContext(e){if(!e||!e.location)return!1;const{win:t,location:o,hasReplace:r,hasAssign:n,hasReload:a,originalHref:s,nextHref:l,timestamp:u,baseHref:d}=e;let m=!1;if(r&&l&&(m=attemptForceReloadNavigation(o,l,d,h=>o.replace(h),"location.replace")),!m&&n&&l&&(m=attemptForceReloadNavigation(o,l,d,h=>o.assign(h),"location.assign")),!m&&l&&l!==s&&(m=attemptForceReloadNavigation(o,l,d,h=>{o.href=h},"location.href assignment")),!m&&t&&l&&(m=attemptForceReloadHistoryFallback(t,o,l,d)),!m&&(!l||l===s)&&a)try{o.reload(),m=!0}catch(h){console.warn("Forced reload via location.reload failed",h)}return m||scheduleForceReloadFallbacks(t,o,{originalHref:s,baseHref:d,nextHref:l,hasReload:a,timestamp:u}),m}function tryForceReload(e){const t=prepareForceReloadContext(e);return t?executeForceReloadContext(t):!1}function createReloadFallback(e,t=4500){if(!e)return null;let o=null,r=null;try{typeof e.setTimeout=="function"&&(o=e.setTimeout.bind(e))}catch{}try{typeof e.clearTimeout=="function"&&(r=e.clearTimeout.bind(e))}catch{}if(!o)if(typeof setTimeout=="function")o=setTimeout;else return{triggerNow(){tryForceReload(e)}};r||(r=typeof clearTimeout=="function"?clearTimeout:null);let n=!1,a=null;const s=()=>{if(!n){n=!0,a=null;try{!tryForceReload(e)&&e&&e.location&&typeof e.location.reload=="function"&&e.location.reload()}catch(l){console.warn("Force reload fallback execution failed",l);try{e&&e.location&&typeof e.location.reload=="function"&&e.location.reload()}catch(u){console.warn("Ultimate force reload fallback failed",u)}}}};try{a=o(s,t)}catch(l){console.warn("Unable to schedule reload fallback timer",l),s()}return{triggerNow(){if(!n){if(a!=null&&typeof r=="function")try{r(a)}catch{}s()}}}}const OFFLINE_RELOAD_TIMEOUT_MS=5e3,FORCE_RELOAD_CLEANUP_TIMEOUT_MS=700;function awaitPromiseWithSoftTimeout(e,t,o,r){if(!e||typeof e.then!="function")return Promise.resolve({timedOut:!1,result:e});const n=typeof t=="number"&&t>=0?t:null,a=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null;if(n===null||!a)return e.then(d=>({timedOut:!1,result:d}));let l=!1,u=null;return new Promise((d,m)=>{e.then(y=>{if(l)return y;if(l=!0,u!=null&&s)try{s(u)}catch{}return d({timedOut:!1,result:y}),y},y=>{if(l){if(typeof r=="function")try{r(y)}catch{}return null}if(l=!0,u!=null&&s)try{s(u)}catch{}return m(y),null}),u=a(()=>{if(!l){if(l=!0,typeof o=="function")try{o()}catch{}d({timedOut:!0,result:void 0})}},n)})}function observeServiceWorkerControllerChangeForSession(e){const t=e&&typeof e=="object"?e:null;if(!t||!t.serviceWorker)return null;const{serviceWorker:o}=t;if(!o)return null;let r=!1,n=null,a=null,s=!1;const l=d=>{if(r)return;r=!0;const m=a;if(a=null,typeof n=="function"){try{n()}catch{}n=null}if(typeof m=="function")try{m(d)}catch{}},u=new Promise(d=>{if(a=d,o.controller){l(!0);return}const m=()=>{l(!0)};try{if(typeof o.addEventListener=="function")o.addEventListener("controllerchange",m),n=()=>{try{o.removeEventListener("controllerchange",m)}catch(y){}},s=!0;else if("oncontrollerchange"in o){const y=o.oncontrollerchange;o.oncontrollerchange=function(b){if(typeof y=="function")try{y.call(this,b)}catch(v){console.warn("Existing service worker controllerchange handler failed",v)}m(b)},n=()=>{try{o.oncontrollerchange=y}catch(h){}},s=!0}else l(!1)}catch(y){console.warn("Failed to observe service worker controllerchange",y),l(!1)}});return!s&&!o.controller?(l(!1),null):{promise:u,cancel(){l(!1)}}}async function collectServiceWorkerRegistrationsForReload(e){if(!e)return[];const t=[],o=r=>{r&&t.push(r)};try{if(typeof e.getRegistrations=="function"){const r=await e.getRegistrations();Array.isArray(r)&&r.forEach(o)}else if(typeof e.getRegistration=="function"){const r=await e.getRegistration();o(r)}else if(e.ready&&typeof e.ready.then=="function")try{const r=await e.ready;o(r)}catch(r){console.warn("Failed to await active service worker",r)}}catch(r){console.warn("Failed to query service worker registrations",r)}return t}async function clearCachesAndReload(){const e=typeof navigator<"u"?navigator:void 0;if(isNavigatorExplicitlyOffline(e))return announceForceReloadOfflineNotice(),{blocked:!0,reason:"offline"};try{flushProjectAutoSaveOnExit({reason:"before-manual-reload"})}catch(h){console.warn("Failed to flush auto save before manual reload",h)}const t=typeof window<"u"&&window?createReloadFallback(window):null,o=typeof globalThis<"u"&&globalThis&&globalThis.cineOffline||typeof window<"u"&&window&&window.cineOffline||null,r=typeof window<"u"&&window&&window.location?readLocationHrefSafe(window.location):"",n=typeof caches<"u"?caches:void 0,a=e&&e.serviceWorker?e.serviceWorker:null,s=a?collectServiceWorkerRegistrationsForReload(a):Promise.resolve([]);if(o&&typeof o.reloadApp=="function")try{const h=o.reloadApp({window,navigator:e,caches:n,onOfflineReloadBlocked:announceForceReloadOfflineNotice}),{timedOut:b,result:v}=await awaitPromiseWithSoftTimeout(h,OFFLINE_RELOAD_TIMEOUT_MS,()=>{console.warn("Offline module reload timed out; continuing with manual fallback after soft timeout.",{timeoutMs:OFFLINE_RELOAD_TIMEOUT_MS})},C=>{console.warn("Offline module reload promise rejected after timeout",C)});if(!b&&(v===!0||v&&typeof v=="object"&&(v.reloadTriggered===!0||v.navigationTriggered===!0))&&await waitForReloadNavigation(r).catch(()=>!1))return}catch(h){console.warn("Offline module reload failed, falling back to manual refresh",h)}let l=!1;try{typeof clearUiCacheStorageEntries=="function"&&(clearUiCacheStorageEntries(),l=!0)}catch(h){console.warn("Failed to clear UI caches via storage helper",h)}if(!l)try{clearUiCacheEntriesFallback(),l=!0}catch(h){console.warn("Fallback UI cache clear failed",h)}let u=Promise.resolve(!1),d=Promise.resolve(!1);a&&(u=(async()=>{try{const h=await s;return h.length?(await Promise.all(h.map(b=>!b||typeof b.unregister!="function"?Promise.resolve(!1):b.unregister().catch(v=>(console.warn("Service worker unregister failed",v),!1)))),!0):!1}catch(h){return console.warn("Service worker cleanup failed",h),!1}})()),n&&typeof n.keys=="function"&&(d=(async()=>{try{const h=await n.keys();if(!Array.isArray(h)||!h.length)return!1;const b=resolveCineCacheNameForReload(),v=b?b.toLowerCase():null,C=h.filter(w=>isRelevantCacheKeyForReload(w,b,v));if(!C.length)return!1;let A=!1;return await Promise.all(C.map(w=>!w||typeof n.delete!="function"?Promise.resolve(!1):n.delete(w).then(R=>(A=A||!!R,R)).catch(R=>(console.warn("Failed to delete cache",w,R),!1)))),A}catch(h){return console.warn("Cache clear failed",h),!1}})());let m=null,y=u;e&&e.serviceWorker&&(m=observeServiceWorkerControllerChangeForSession(e),m&&m.promise&&u&&typeof u.then=="function"&&(y=Promise.race([u,m.promise])));try{await awaitPromiseWithSoftTimeout(y,FORCE_RELOAD_CLEANUP_TIMEOUT_MS,()=>{console.warn("Service worker cleanup timed out before reload; continuing anyway.",{timeoutMs:FORCE_RELOAD_CLEANUP_TIMEOUT_MS})},h=>{console.warn("Service worker cleanup failed after reload triggered",h)})}catch(h){console.warn("Service worker cleanup failed",h)}finally{if(m&&typeof m.cancel=="function")try{m.cancel()}catch{}}try{if(t&&typeof t.triggerNow=="function")t.triggerNow();else{const h=typeof window<"u"?window:null;!tryForceReload(h)&&h&&h.location&&typeof h.location.reload=="function"&&h.location.reload()}}catch(h){console.warn("Forced reload failed",h),typeof window<"u"&&window.location&&typeof window.location.reload=="function"&&window.location.reload()}try{await d}catch(h){console.warn("Cache clear failed",h)}}const sessionReloadButton=typeof document<"u"?document.getElementById("reloadButton"):null;sessionReloadButton&&sessionReloadButton.addEventListener("click",clearCachesAndReload);function exportDiagramSvg$1(){if(!setupDiagramContainer)return"";const e=setupDiagramContainer.querySelector("svg");if(!e)return"";const t=e.cloneNode(!0),o=e.querySelectorAll(".edge-label"),r=t.querySelectorAll(".edge-label");o.forEach((l,u)=>{r[u]&&(r[u].textContent=l.textContent)});const n=document.createElementNS("http://www.w3.org/2000/svg","style");let a=typeof getDiagramCss=="function"?getDiagramCss:null;return!a&&typeof moduleApi$2=="object"&&typeof moduleApi$2.getDiagramCss=="function"&&(a=moduleApi$2.getDiagramCss),n.textContent=a?a(!1):"",t.insertBefore(n,t.firstChild),new XMLSerializer().serializeToString(t)}function copyTextToClipboardBestEffort(e){if(typeof e!="string"||!e)return;if(typeof navigator<"u"&&navigator&&navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){navigator.clipboard.writeText(e).catch(()=>{});return}if(typeof document>"u"||!document||!document.body||typeof document.createElement!="function")return;let t=null;const o=document.activeElement;try{t=document.createElement("textarea"),t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-9999px",t.style.opacity="0",document.body.appendChild(t);try{t.focus()}catch{}try{t.select(),typeof t.setSelectionRange=="function"&&t.setSelectionRange(0,t.value.length)}catch{}if(typeof document.execCommand=="function")try{document.execCommand("copy")}catch{}}catch{}finally{if(t&&t.parentNode&&t.parentNode.removeChild(t),o&&typeof o.focus=="function")try{o.focus()}catch{}}}const bindDownloadDiagramListener=()=>{const e=downloadDiagramButton||document.getElementById("downloadDiagram");return e?(e.removeEventListener("click",handleDownloadDiagramClick),e.addEventListener("click",handleDownloadDiagramClick),!0):!1};function handleDownloadDiagramClick(e){const t=exportDiagramSvg$1();if(!t)return;copyTextToClipboardBestEffort(t);const o=u=>String(u).padStart(2,"0"),r=new Date,n=`${r.getFullYear()}-${o(r.getMonth()+1)}-${o(r.getDate())}_${o(r.getHours())}-${o(r.getMinutes())}`,a=(safeGetCurrentProjectName("setup")||"setup").replace(/\s+/g,"-").replace(/[^a-z0-9-_]/gi,""),s=`${n}_${a}_diagram`,l=()=>{const u=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(u),m=document.createElement("a");m.href=d,m.download=`${s}.svg`,m.click(),setTimeout(()=>{URL.revokeObjectURL(d)},6e4)};if(e.shiftKey){const u=new Image;u.onload=()=>{const d=document.createElement("canvas");d.width=u.width,d.height=u.height,d.getContext("2d").drawImage(u,0,0),d.toBlob(y=>{const h=URL.createObjectURL(y),b=document.createElement("a");b.href=h,b.download=`${s}.jpg`,b.click(),setTimeout(()=>{URL.revokeObjectURL(h)},6e4)},"image/jpeg",.95)},u.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t)}else l()}const bindGridSnapListener=()=>{const e=gridSnapToggleButton||document.getElementById("gridSnapToggle");return e?(e.removeEventListener("click",handleGridSnapClick),e.addEventListener("click",handleGridSnapClick),!0):!1};function handleGridSnapClick(){const e=!readGridSnapState(),t=writeGridSnapState(e);applyGridSnapUiState(t)}bindDownloadDiagramListener()||document.addEventListener("DOMContentLoaded",bindDownloadDiagramListener);bindGridSnapListener()||document.addEventListener("DOMContentLoaded",bindGridSnapListener);const setupHelpSystem=()=>{let e=document.getElementById("helpQuickLinksNav"),t=document.getElementById("helpQuickLinksList"),o=document.getElementById("helpQuickLinksHeading"),r=document.getElementById("helpSectionsContainer"),n;const a=helpButton||document.getElementById("helpButton"),s=helpDialog$1||document.getElementById("helpDialog");if(!a||!s)return!1;if(a.dataset.helpInitialized)return!0;a.dataset.helpInitialized="true",a.addEventListener("click",k=>{k.preventDefault(),le()});const l=s.querySelector(".help-content"),u=new Map,d=new Map,m=new Map,y=new Map;(()=>{if(!l)return;l.querySelectorAll("a.help-link").forEach(Q=>{Q.classList.add("button-link")})})();const b=k=>{if(!k)return;const Q=k,X=m.get(Q);X&&clearTimeout(X),Q.classList.add("help-target-focus");const ae=setTimeout(()=>{Q.classList.remove("help-target-focus"),m.delete(Q)},2e3);m.set(Q,ae)},v=k=>{if(!Array.isArray(k)||k.length===0)return;const Q=new Set;k.forEach(X=>{if(!X||typeof X.classList?.add!="function"||Q.has(X))return;Q.add(X);const ae=y.get(X);ae&&clearTimeout(ae),X.classList.add("feature-search-focus");const Ae=setTimeout(()=>{X.classList.remove("feature-search-focus"),y.delete(X)},2500);y.set(X,Ae)})},C=k=>{if(!k)return[];const Q=new Set,X=k.ownerDocument||(typeof document<"u"?document:null);if(k.labels&&typeof k.labels=="object"&&Array.from(k.labels).forEach(ae=>{ae&&Q.add(ae)}),typeof k.closest=="function"){const ae=k.closest("label");ae&&Q.add(ae)}if(X&&typeof k.getAttribute=="function"){const ae=Ae=>{Ae&&Ae.split(/\s+/).filter(Boolean).forEach(Se=>{const Oe=X.getElementById(Se);Oe&&Q.add(Oe)})};ae(k.getAttribute("aria-labelledby")),ae(k.getAttribute("aria-describedby"))}return Array.from(Q)},A=k=>{if(!(!k||typeof k!="object"||typeof k.nodeType!="number")){if(backupDiffSectionEl&&backupDiffSectionEl.contains(k)&&backupDiffSectionEl.hasAttribute("hidden"))if(typeof showBackupDiffSection=="function")try{showBackupDiffSection()}catch(Q){console.warn("Unable to open backup diff section for feature search target",Q),backupDiffSectionEl.removeAttribute("hidden")}else backupDiffSectionEl.removeAttribute("hidden");if(restoreRehearsalSectionEl&&restoreRehearsalSectionEl.contains(k)&&restoreRehearsalSectionEl.hasAttribute("hidden"))if(typeof openRestoreRehearsal=="function")try{openRestoreRehearsal()}catch(Q){console.warn("Unable to open restore rehearsal section for feature search target",Q),restoreRehearsalSectionEl.removeAttribute("hidden")}else restoreRehearsalSectionEl.removeAttribute("hidden")}},w=k=>{if(!k||typeof k.closest!="function")return;A(k);const Q=k.closest("#settingsDialog"),X=k.closest(".settings-panel");if(X){const Fe=(X.getAttribute("aria-labelledby")||"").split(/\s+/).map(_e=>_e.trim()).filter(Boolean).find(_e=>document.getElementById(_e));Fe&&activateSettingsTab(Fe)}if(Q&&!isDialogOpen(settingsDialog)){const Ne={reason:"feature-search",targetId:typeof k.id=="string"&&k.id?k.id:null};if(typeof k.getAttribute=="function"){const Qe=k.getAttribute("aria-label")||k.getAttribute("data-help")||k.getAttribute("data-feature-key");Qe&&(Ne.targetLabel=Qe);const Fe=k.getAttribute("role");Fe&&(Ne.targetRole=Fe)}requestSettingsOpen(Ne)}const ae=k.closest("dialog");ae&&!isDialogOpen(ae)&&(ae.id==="projectDialog"?generateGearListBtn?.click?.():ae.id==="feedbackDialog"?runtimeFeedbackBtn?.click?.():ae.id==="overviewDialog"?generateOverviewBtn?.click?.():openDialog(ae)),k.closest("#device-manager")&&showDeviceManagerSection(),typeof k.scrollIntoView=="function"&&k.scrollIntoView({behavior:"smooth",block:"center"});const Se=k.hasAttribute("tabindex");let Oe=!1;if(!Se){const Ne=k.tabIndex;typeof Ne=="number"&&Ne<0&&(k.setAttribute("tabindex","-1"),Oe=!0)}if(typeof k.focus=="function")try{k.focus({preventScroll:!0})}catch{k.focus()}Oe&&k.addEventListener("blur",()=>k.removeAttribute("tabindex"),{once:!0})},R=k=>{if(!k)return;const Q=k.querySelector("h3, summary, h4, h5, h6")||k.querySelector("button, a");if(!Q)return;const X=Q.hasAttribute("tabindex");X||Q.setAttribute("tabindex","-1");try{Q.focus({preventScroll:!0})}catch{Q.focus()}X||Q.addEventListener("blur",()=>Q.removeAttribute("tabindex"),{once:!0})},_=k=>{if(!k)return;const Q=d.get(k);Q&&clearTimeout(Q),k.classList.add("help-section-focus");const X=setTimeout(()=>{k.classList.remove("help-section-focus"),d.delete(k)},1500);d.set(k,X)};let G=null,O=null;const B=()=>{if(!t||!t.childElementCount)return;const k=()=>{t.querySelectorAll('li[data-quick-link-spacer="true"]').forEach(removeNode);const Q=Array.from(t.children);if(!Q.length)return;const X=[],ae=[],Ae=[];if(Q.forEach((Fe,_e)=>{const He=Fe.querySelector(".help-quick-link");if(!He){Ae.push({index:_e,node:Fe});return}if(Fe.hasAttribute("hidden")){Ae.push({index:_e,node:Fe,button:He}),He.classList.remove("help-quick-link-multiline");return}const st=He.querySelector(".help-quick-link-label");if(!st){ae.push({index:_e,node:Fe,button:He}),He.classList.remove("help-quick-link-multiline");return}const at=window.getComputedStyle(st);let St=Number.parseFloat(at.lineHeight);(!St||Number.isNaN(St))&&(St=Number.parseFloat(at.fontSize)||0);const kt=st.offsetHeight||st.getBoundingClientRect().height,Ht=(St?Math.round(kt/St):1)>1;He.classList.toggle("help-quick-link-multiline",Ht),Ht?X.push({index:_e,node:Fe,button:He}):ae.push({index:_e,node:Fe,button:He})}),!X.length&&!ae.length)return;const Se=document.createDocumentFragment(),Oe=X.sort((Fe,_e)=>Fe.index-_e.index),Ne=ae.sort((Fe,_e)=>Fe.index-_e.index),Qe=Math.max(Math.ceil(Oe.length/2),Math.ceil(Ne.length/2));for(let Fe=0;Fe<Qe;Fe+=1){const _e=Fe*2;if(_e<Oe.length){if(Se.appendChild(Oe[_e].node),_e+1<Oe.length)Se.appendChild(Oe[_e+1].node);else if(Ne.length){const st=document.createElement("li");st.dataset.quickLinkSpacer="true",st.setAttribute("aria-hidden","true"),st.setAttribute("role","presentation"),st.className="help-quick-link-spacer",Se.appendChild(st)}}const He=Fe*2;He<Ne.length&&(Se.appendChild(Ne[He].node),He+1<Ne.length&&Se.appendChild(Ne[He+1].node))}Ae.sort((Fe,_e)=>Fe.index-_e.index).forEach(({node:Fe})=>Se.appendChild(Fe)),Se.childNodes.length&&t.appendChild(Se)};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?(G&&window.cancelAnimationFrame(G),G=window.requestAnimationFrame(()=>{G=null,k()})):k()},$=()=>{O&&clearTimeout(O),O=setTimeout(()=>{O=null,B()},150)},V=()=>{if(!e||!t||!u.size){e&&e.setAttribute("hidden","");return}let k=!1;u.forEach(({section:Q,listItem:X,button:ae})=>{Q&&!Q.hasAttribute("hidden")?(X.removeAttribute("hidden"),k=!0):(X.setAttribute("hidden",""),ae&&ae.classList.remove("active"))}),k?(e.removeAttribute("hidden"),B()):e.setAttribute("hidden","")},M=k=>{if(!e)return;const Q=texts&&texts[k]||{},X=texts&&texts.en||{},ae=Q.helpQuickLinksHeading||X.helpQuickLinksHeading;o&&ae&&(o.textContent=ae);const Ae=Q.helpQuickLinksAriaLabel||ae||X.helpQuickLinksAriaLabel||"Help topics quick navigation";e.setAttribute("aria-label",Ae);const Se=Q.helpQuickLinksHelp||X.helpQuickLinksHelp;Se?e.setAttribute("data-help",Se):e.removeAttribute("data-help");const Oe=Q.helpQuickLinkButtonHelp||X.helpQuickLinkButtonHelp;u.forEach(({button:Ne,label:Qe})=>{if(Ne)if(Oe){const Fe=Oe.replace("%s",Qe);Ne.setAttribute("data-help",Fe),Ne.setAttribute("aria-label",Fe)}else Ne.removeAttribute("data-help"),Ne.setAttribute("aria-label",Qe)}),B()};typeof globalThis<"u"?globalThis.updateHelpQuickLinksForLanguage=M:typeof window<"u"&&(window.updateHelpQuickLinksForLanguage=M),(()=>{if(!e||!t||!r){u.clear(),e&&e.setAttribute("hidden","");return}u.clear(),t.textContent="";const k=document.createDocumentFragment();if(Array.from(r.querySelectorAll("section[data-help-section]")).forEach(X=>{const ae=X.id;if(!ae)return;const Ae=X.querySelector("h3");if(!Ae)return;const Se=Ae.querySelector(".help-icon.icon-glyph");let Oe=Ae.textContent||"";if(Se){const _e=Se.textContent||"";if(_e){const He=Oe.indexOf(_e);He>-1&&(Oe=Oe.slice(0,He)+Oe.slice(He+_e.length))}}if(Oe=Oe.trim(),!Oe)return;const Ne=document.createElement("li"),Qe=document.createElement("button");if(Qe.type="button",Qe.className="help-quick-link button-link",Qe.dataset.targetId=ae,Qe.setAttribute("aria-label",Oe),Se){const _e=Se.cloneNode(!0);_e.classList.remove("help-icon"),_e.classList.add("help-quick-link-icon"),Qe.appendChild(_e)}const Fe=document.createElement("span");Fe.className="help-quick-link-label",Fe.textContent=Oe,Qe.appendChild(Fe),Qe.addEventListener("click",()=>{if(X.hasAttribute("hidden"))return;t&&t.querySelectorAll(".help-quick-link.active").forEach(He=>He.classList.remove("active")),Qe.classList.add("active"),typeof X.scrollIntoView=="function"&&X.scrollIntoView({behavior:"smooth",block:"start"}),_(X),R(X);const _e=X.querySelector('h3, summary, h4, h5, h6, [role="heading"]')||X.querySelector("button, a");v(_e?[_e]:[X])}),Ne.appendChild(Qe),k.appendChild(Ne),u.set(ae,{section:X,button:Qe,listItem:Ne,label:Oe})}),!k.childNodes.length){e.setAttribute("hidden","");return}t.appendChild(k),M(currentLang),V()})(),typeof window<"u"&&window.addEventListener("resize",()=>{!t||e?.hasAttribute("hidden")||$()},{passive:!0}),helpDialog$1&&helpDialog$1.addEventListener("click",k=>{const Q=k.target.closest("a[data-help-target]");if(!Q)return;const ae=(Q.dataset.helpTarget||Q.getAttribute("href")||"").trim();if(!ae)return;let Ae;try{Ae=document.querySelector(ae)}catch{Ae=null}if(!Ae)return;k.preventDefault();const Se=Q.dataset.helpHighlight||"";let Oe=Ae;if(Se)try{const Fe=document.querySelector(Se);Fe&&(Oe=Fe)}catch{}const Ne=helpDialog$1.contains(Ae),Qe=()=>{w(Ae),Oe&&b(Oe);const Fe=C(Oe||Ae);Fe.length&&v(Fe)};if(Ne){Qe();return}Y(null),requestAnimationFrame(()=>{requestAnimationFrame(Qe)})});const z=new Map([["a","àáâãäåāăąǎȁȃȧậắằẵẳấầẫẩảạæ"],["b","ḃɓ"],["c","çćĉċčƈ"],["d","ďđḍḑḓ"],["e","èéêëēĕėęěȅȇẹẻẽếềểễệ"],["f","ƒḟ"],["g","ğģĝġǵḡ"],["h","ĥħḣḥḧẖ"],["i","ìíîïĩīĭįıỉị"],["j","ĵǰ"],["k","ķƙḱḳḵ"],["l","ĺļľłḷḽ"],["m","ḿṁṃ"],["n","ñńņňǹṅṇṋ"],["o","òóôõöōŏőøǒȍȏơộớờỡởợọỏœ"],["p","ṕṗ"],["q","ʠ"],["r","ŕŗřȑȓṛṙ"],["s","śŝşšșṡṣ"],["t","ţťțṫṭṯ"],["u","ùúûüũūŭůűųǔȕȗưựứừữửụủ"],["v","ṽṿ"],["w","ŵẁẃẅẇẉ"],["x","ẋẍ"],["y","ýÿŷỳỷỹỵ"],["z","źżžẑẓẕ"]]),x=k=>{if(!k)return"";let Q=String(k).toLowerCase();return typeof Q.normalize=="function"&&(Q=Q.normalize("NFD")),Q=Q.replace(/[\u0300-\u036f]/g,"").replace(/ß/g,"ss").replace(/æ/g,"ae").replace(/œ/g,"oe").replace(/ø/g,"o").replace(/&/g,"and").replace(/\+/g,"plus").replace(/[°º˚]/g,"deg").replace(/\bdegrees?\b/g,"deg").replace(/[×✕✖✗✘]/g,"x"),typeof normalizeSpellingVariants=="function"&&(Q=normalizeSpellingVariants(Q)),Q=normaliseMarkVariants(Q),Q.replace(/[^a-z0-9]+/g,"")},H=k=>{if(!k)return null;const Q=Se=>Se.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),X=[],ae=Se=>{const Oe=z.get(Se)||"",Ne=new Set,Qe=`${Se}${Oe}`;for(const _e of Qe){Ne.add(_e);const He=_e.toUpperCase();He&&Ne.add(He)}return`[${Array.from(Ne).map(Q).join("")}]`};return Array.from(k).forEach((Se,Oe)=>{Oe>0&&X.push("\\s*"),/[a-z]/.test(Se)?X.push(ae(Se)):/[0-9]/.test(Se)?X.push(Se):X.push(Q(Se))}),`(${X.join("")})`},W=({totalCount:k,visibleCount:Q,hasQuery:X,queryText:ae}={})=>{const Ae=()=>{helpResultsAssist&&(helpResultsAssist.textContent="",helpResultsAssist.setAttribute("hidden",""))};if(!helpResultsSummary){Ae();return}typeof k=="number"&&Number.isFinite(k)&&(helpResultsSummary.dataset.totalCount=String(k)),typeof Q=="number"&&Number.isFinite(Q)&&(helpResultsSummary.dataset.visibleCount=String(Q)),typeof X=="boolean"&&(helpResultsSummary.dataset.hasQuery=X?"true":"false"),typeof ae=="string"&&(helpResultsSummary.dataset.query=ae);const Se=Number(helpResultsSummary.dataset.totalCount||0);if(!Se){helpResultsSummary.textContent="",helpResultsSummary.setAttribute("hidden",""),Ae();return}const Oe=Number(helpResultsSummary.dataset.visibleCount||0),Ne=helpResultsSummary.dataset.hasQuery==="true",Qe=helpResultsSummary.dataset.query||"",Fe=texts&&texts[currentLang]||{},_e=texts&&texts.en||{};let He="";if(Ne){const st=Fe.helpResultsSummaryFiltered||_e.helpResultsSummaryFiltered;st?He=st.replace("%1$s",Oe).replace("%2$s",Se).replace("%3$s",Qe):Qe?He=`Showing ${Oe} of ${Se} help topics for “${Qe}”.`:He=`Showing ${Oe} of ${Se} help topics.`}else{const st=Fe.helpResultsSummaryAll||_e.helpResultsSummaryAll;st?He=st.replace("%s",Se):He=`All ${Se} help topics are shown.`}if(helpResultsSummary.textContent=He,helpResultsSummary.removeAttribute("hidden"),helpResultsAssist)if(Oe>0){const at=Fe.helpResultsAssist||_e.helpResultsAssist||"Tip: Press Tab to move into the quick links, or press Enter to open the top visible topic.";helpResultsAssist.textContent=at,helpResultsAssist.removeAttribute("hidden")}else Ae()};typeof globalThis<"u"?globalThis.updateHelpResultsSummaryText=W:typeof window<"u"&&(window.updateHelpResultsSummaryText=W);const U=()=>{if(!helpSearch){helpResultsSummary&&helpResultsSummary.setAttribute("hidden","");return}const k=helpSearch.value.trim(),Q=x(k),X=Q.length>0,ae=Array.from(helpDialog$1.querySelectorAll("[data-help-section]")),Ae=Array.from(helpDialog$1.querySelectorAll(".faq-item")),Se=ae.concat(Ae),Oe=Se.length;let Ne=0;const Qe=X?H(Q):null,Fe=(He,st)=>{if(!st||typeof document.createTreeWalker!="function"||typeof NodeFilter>"u")return;const at=document.createTreeWalker(He,NodeFilter.SHOW_TEXT,null),St=[];for(;at.nextNode();)St.push(at.currentNode);St.forEach(kt=>{const Zt=kt.textContent;if(!Zt)return;const Ht=new RegExp(st,"giu"),jo=Ht.exec(Zt);if(!jo)return;const ir=document.createDocumentFragment();let sr=0,Ro=jo;do{const Ot=Ro.index,Lr=Ot+Ro[0].length;Ot>sr&&ir.appendChild(document.createTextNode(Zt.slice(sr,Ot)));const Co=document.createElement("mark");Co.textContent=Zt.slice(Ot,Lr),ir.appendChild(Co),sr=Lr,Ht.lastIndex===Ot&&Ht.lastIndex++}while((Ro=Ht.exec(Zt))!==null);sr<Zt.length&&ir.appendChild(document.createTextNode(Zt.slice(sr))),kt.parentNode&&kt.parentNode.replaceChild(ir,kt)})};Se.forEach(He=>{const st=He.classList.contains("faq-item");He.dataset.origHtml?He.innerHTML=He.dataset.origHtml:(He.dataset.origHtml=He.innerHTML,st&&(He.dataset.defaultOpen=He.hasAttribute("open")?"true":"false"));const at=x(He.textContent||""),St=x(He.dataset.helpKeywords||"");!X||at.includes(Q)||St.includes(Q)?(X&&Qe&&Fe(He,Qe),He.removeAttribute("hidden"),st&&(X||He.dataset.defaultOpen==="true"?He.setAttribute("open",""):He.removeAttribute("open")),Ne+=1):(He.setAttribute("hidden",""),st&&He.removeAttribute("open"))}),typeof W=="function"&&W({totalCount:Oe,visibleCount:Ne,hasQuery:X,queryText:k||Q});const _e=X&&Ne===0;helpNoResults&&(_e?helpNoResults.removeAttribute("hidden"):helpNoResults.setAttribute("hidden","")),typeof helpNoResultsSuggestions<"u"&&helpNoResultsSuggestions&&(_e?helpNoResultsSuggestions.removeAttribute("hidden"):helpNoResultsSuggestions.setAttribute("hidden","")),helpSearchClear&&(X?helpSearchClear.removeAttribute("hidden"):helpSearchClear.setAttribute("hidden","")),V()},j=()=>{if(ensureOnboardingTourReady("help-open"),closeSideMenu(),helpDialog$1.removeAttribute("hidden"),openDialog(helpDialog$1),helpSearch)helpSearch.value="",U(),t&&t.querySelectorAll(".help-quick-link.active").forEach(k=>k.classList.remove("active")),l&&(l.scrollTop=0),helpSearch.focus();else try{helpDialog$1.focus({preventScroll:!0})}catch{helpDialog$1.focus()}},Y=(k=helpButton)=>{const Q=helpDialog$1||document.getElementById("helpDialog");if(Q&&(closeDialog(Q),Q.setAttribute("hidden",""),Q.style.display="none"),k&&typeof k.focus=="function")try{k.focus({preventScroll:!0})}catch{k.focus()}},le=()=>{isDialogOpen(helpDialog$1)?Y():j()};let be=!1,re,de=null,ne=null,Ce=null,Ee=null;const Pe=k=>typeof k!="string"?[]:k.split(",").map(Q=>Q.trim()).filter(Boolean),et=k=>typeof k!="string"?[]:k.split(/\s+/).map(Q=>Q.trim()).filter(Boolean),Je=k=>{if(!k||!document?.querySelector)return[];const Q=[],X=new Set,ae=Oe=>{!Oe||!(Oe instanceof Element)||Oe!==k&&(X.has(Oe)||(X.add(Oe),Q.push(Oe)))},Ae=Oe=>{Pe(Oe).forEach(Ne=>{try{const Qe=document.querySelector(Ne);ae(Qe)}catch{}})},Se=Oe=>{et(Oe).forEach(Ne=>{const Qe=document.getElementById(Ne);ae(Qe)})};return Ae(k.getAttribute("data-hover-help-target")),Ae(k.getAttribute("data-hover-help-source")),k.hasAttribute("data-hover-help-skip-help-target")||Ae(k.getAttribute("data-help-target")),Se(k.getAttribute("data-hover-help-targets")),Q},it="[data-help], [aria-label], [title], [aria-labelledby], [alt], [aria-describedby]",rt=k=>{if(!k)return null;const Q=k.closest(it);return!Q||Q.tagName==="SECTION"?null:Q},Pt={control:"Ctrl",ctrl:"Ctrl",meta:"Cmd",cmd:"Cmd",command:"Cmd",option:"Alt",alt:"Alt",shift:"Shift",enter:"Enter",return:"Enter",escape:"Esc",esc:"Esc",space:"Space",spacebar:"Space",tab:"Tab",slash:"/",question:"?",backslash:"\\",minus:"−",dash:"−",plus:"+",period:".",comma:",",semicolon:";",colon:":",arrowup:"↑",arrowdown:"↓",arrowleft:"←",arrowright:"→",pageup:"Page Up",pagedown:"Page Down",home:"Home",end:"End",delete:"Delete",backspace:"Backspace",insert:"Insert"},vt=k=>{if(typeof k!="string")return"";const Q=k.trim();if(!Q)return"";const X=Q.toLowerCase();if(Pt[X])return Pt[X];if(/^f\d{1,2}$/i.test(Q))return Q.toUpperCase();if(/^key[a-z]$/i.test(Q))return Q.slice(3).toUpperCase();if(/^digit\d$/i.test(Q))return Q.slice(5);if(/^numpad\d$/i.test(Q))return`Numpad ${Q.slice(6)}`;if(/^numpad(add|subtract|multiply|divide)$/i.test(X)){const ae=X.slice(6);return`Numpad ${{add:"+",subtract:"−",multiply:"×",divide:"÷"}[ae]||ae}`}return Q.length===1?Q.toUpperCase():Q.replace(/^[a-z]/,ae=>ae.toUpperCase())},bo=k=>{if(typeof k!="string")return"";const Q=k.split("+").map(vt).filter(Boolean);return Q.length?Q.join(" + "):""},Et=k=>typeof k!="string"?[]:k.split(/[;,\n\u2022\u2027\u00b7]+/).map(Q=>Q.trim()).filter(Boolean),Ut=k=>{if(!k)return[];const Q=[];[k.getAttribute("data-shortcut"),k.getAttribute("data-shortcuts"),k.getAttribute("data-help-shortcut"),k.getAttribute("data-help-shortcuts")].forEach(Ae=>{Et(Ae).forEach(Se=>{Se&&Q.push(Se)})});const ae=k.getAttribute("aria-keyshortcuts");return ae&&ae.split(/\s+/).map(bo).filter(Boolean).forEach(Ae=>Q.push(Ae)),Q},ge=k=>{if(!texts||typeof texts!="object")return"";const Q=typeof texts.en=="object"?texts.en[k]:"";if(typeof currentLang=="string"&&texts[currentLang]){const X=texts[currentLang][k];if(typeof X=="string"&&X.trim())return X}return typeof Q=="string"?Q:""},ue=k=>{if(!k)return[];const Q=[],X=_e=>{!_e||Q.includes(_e)||Q.push(_e)},ae=(k.getAttribute("role")||"").toLowerCase(),Ae=k.tagName?k.tagName.toLowerCase():"",Se=(k.getAttribute("type")||"").toLowerCase(),Oe=typeof k.type=="string"?k.type.toLowerCase():"",Ne=Se||Oe,Qe=(k.getAttribute("aria-haspopup")||"").toLowerCase(),Fe=(k.getAttribute("aria-pressed")||"").toLowerCase();if((ae==="dialog"||ae==="alertdialog")&&X("hoverHelpFallbackDialog"),ae==="alertdialog"&&X("hoverHelpFallbackAlert"),ae==="tablist"&&X("hoverHelpFallbackTablist"),ae==="tab"&&X("hoverHelpFallbackTab"),ae==="menu"&&X("hoverHelpFallbackMenu"),ae==="menuitem"&&X("hoverHelpFallbackMenu"),ae==="listbox"&&X("hoverHelpFallbackSelect"),ae==="link"&&X("hoverHelpFallbackLink"),ae==="progressbar"&&X("hoverHelpFallbackProgress"),ae==="status"&&X("hoverHelpFallbackStatus"),ae==="alert"&&X("hoverHelpFallbackAlert"),ae==="switch"&&X("hoverHelpFallbackSwitch"),(ae==="checkbox"||ae==="menuitemcheckbox")&&X("hoverHelpFallbackCheckbox"),(ae==="radio"||ae==="menuitemradio")&&X("hoverHelpFallbackRadio"),ae==="slider"&&X("hoverHelpFallbackSlider"),ae==="spinbutton"&&X("hoverHelpFallbackNumberInput"),(ae==="textbox"||ae==="searchbox")&&X("hoverHelpFallbackTextInput"),ae==="combobox"&&X("hoverHelpFallbackSelect"),Ae==="button"||ae==="button"||k.matches?.("input[type='button']")||k.matches?.("input[type='submit']")||k.matches?.("input[type='reset']"))Qe&&Qe!=="false"&&X("hoverHelpFallbackMenuButton"),(Fe==="true"||Fe==="mixed"||Fe==="false")&&X("hoverHelpFallbackToggleButton"),X("hoverHelpFallbackButton");else if(Ae==="a"&&k.hasAttribute("href"))X("hoverHelpFallbackLink");else if(Ae==="select")X("hoverHelpFallbackSelect");else if(Ae==="textarea")X("hoverHelpFallbackTextarea");else if(Ae==="details")X("hoverHelpFallbackDetails");else if(Ae==="input")switch(Ne){case"checkbox":X("hoverHelpFallbackCheckbox");break;case"radio":X("hoverHelpFallbackRadio");break;case"range":X("hoverHelpFallbackSlider");break;case"number":X("hoverHelpFallbackNumberInput");break;case"file":X("hoverHelpFallbackFileInput");break;case"color":X("hoverHelpFallbackColorInput");break;default:X("hoverHelpFallbackTextInput");break}else k.isContentEditable&&X("hoverHelpFallbackTextarea");return X("hoverHelpFallbackGeneric"),Q},We=k=>{if(!k)return{label:"",details:[]};const Q=new Set,X=[],ae=[],Ae=[],Se=(at,St)=>{if(typeof at!="string")return;const kt=at.replace(/\s+/g," ").trim();!kt||Q.has(kt)||(Q.add(kt),St.push(kt))},Oe=at=>Se(at,X),Ne=at=>Se(at,ae),Qe=at=>Se(at,Ae),Fe=(at,{includeTextContent:St=!1,preferTextAsLabel:kt=!1}={})=>{if(!at)return;Ne(at.getAttribute("data-help")),Ne(at.getAttribute("aria-description")),Ne(at.getAttribute("title")),Ne(at.getAttribute("aria-placeholder")),Oe(at.getAttribute("aria-label")),Oe(at.getAttribute("alt"));const Zt=at.getAttribute("placeholder");Ne(Zt),at.placeholder&&at.placeholder!==Zt&&Ne(at.placeholder);const Ht=at.getAttribute("aria-roledescription");if(Ht&&(kt?Oe(Ht):Ne(Ht)),Ut(at).forEach(Qe),St){const jo=at.textContent;kt?Oe(jo):Ne(jo)}},_e=(at,{preferTextAsLabel:St=!1}={})=>{at&&at.split(/\s+/).map(kt=>kt.trim()).filter(Boolean).forEach(kt=>{const Zt=document.getElementById(kt);Zt&&Fe(Zt,{includeTextContent:!0,preferTextAsLabel:St})})},He=new Set,st=[{element:k,preferTextAsLabel:!0,includeTextContent:!1}];for(;st.length;){const{element:at,preferTextAsLabel:St,includeTextContent:kt}=st.shift();!at||He.has(at)||(He.add(at),Fe(at,{includeTextContent:kt,preferTextAsLabel:St}),_e(at.getAttribute("aria-labelledby"),{preferTextAsLabel:!0}),_e(at.getAttribute("aria-describedby")),_e(at.getAttribute("aria-details")),_e(at.getAttribute("aria-errormessage")),_e(at.getAttribute("aria-controls")),C(at).forEach(Zt=>{Fe(Zt,{includeTextContent:!0,preferTextAsLabel:!0})}),Je(at).forEach(Zt=>{st.push({element:Zt,preferTextAsLabel:!1,includeTextContent:!0})}))}if(X.length||Oe(k.textContent),!ae.length&&X.length>1&&X.slice(1).forEach(at=>Ne(at)),!ae.length){const at=ue(k);let St=!1;at.forEach(kt=>{const Zt=ge(kt);Zt&&(St=!0,Ne(Zt))}),St||Ne(ge("hoverHelpFallbackGeneric"))}return{label:X[0]||"",details:ae,shortcuts:Ae}},Me=()=>{ne&&ne.classList&&ne.classList.remove("hover-help-highlight"),ne=null},Te=k=>{ne!==k&&(Me(),k&&k.classList&&typeof k.classList.add=="function"&&(k.classList.add("hover-help-highlight"),ne=k))},Be=()=>be&&re&&typeof Ce=="number"&&typeof Ee=="number"&&Number.isFinite(Ce)&&Number.isFinite(Ee),Ve=k=>{if(!k)return null;if(typeof k.clientX=="number"&&typeof k.clientY=="number"&&Number.isFinite(k.clientX)&&Number.isFinite(k.clientY))return[k.clientX,k.clientY];if(typeof k.pageX=="number"&&typeof k.pageY=="number"&&Number.isFinite(k.pageX)&&Number.isFinite(k.pageY)){const ae=window.scrollX||window.pageXOffset||0,Ae=window.scrollY||window.pageYOffset||0;return[k.pageX-ae,k.pageY-Ae]}return null},je=k=>{if(!be||!re)return!1;const Q=Ve(k);if(!Q)return!1;const[X,ae]=Q;return Ce=X,Ee=ae,!0},mt=k=>{if(!re||!k)return;const Q=k.getBoundingClientRect(),X=document.documentElement,ae=Math.max(X?.clientWidth||0,window.innerWidth||0),Ae=Math.max(X?.clientHeight||0,window.innerHeight||0),Se=window.scrollX||window.pageXOffset||0,Oe=window.scrollY||window.pageYOffset||0,Ne=12,Qe=10,Fe=8,_e=Number.isFinite(Q.left)?Q.left:0,He=Number.isFinite(Q.right)?Q.right:_e+(Q.width||0),st=Number.isFinite(Q.top)?Q.top:0,at=Number.isFinite(Q.bottom)?Q.bottom:st,St=re.getBoundingClientRect(),kt=St.width||re.offsetWidth||0,Zt=St.height||re.offsetHeight||0,Ht=Be(),jo=Ht&&typeof Ce=="number"?Ce:Number.isFinite(Q.left)?_e+(Q.width||0)/2:ae/2,ir=(()=>{if(kt){const Lr=kt+Ne+Fe,Co=ae-jo,hr=jo;if(Co<Lr&&hr>=Lr)return!0}const Ot=ae*.6;return jo>=Ot})();let sr=Ht?Ee+Oe+Qe:at+Oe+Qe,Ro;if(Ht?(Ro=Ce+Se+Ne,ir&&(Ro=Ce+Se-kt-Ne)):(Ro=(ir?He:_e)+Se+(ir?-Ne:Ne),ir&&(Ro-=kt)),kt){const Ot=Se+ae-Fe;Ro+kt>Ot?Ht?Ro=Ce+Se-kt-Ne:Ro=He+Se-kt-Ne:Ro<Se+Fe&&ir&&(Ro=Math.max(Ro,Se+Fe));const Co=Se+Fe,hr=Se+Math.max(ae-kt-Fe,Fe);Ro<Co?Ro=Co:Ro>hr&&(Ro=hr)}if(Zt){const Ot=Oe+Fe,Lr=Oe+Math.max(Ae-Zt-Fe,Fe);if(sr>Lr){const Co=Ht?Ee+Oe-Zt-Qe:st+Oe-Zt-Qe;Co>=Ot?sr=Co:sr=Math.min(Math.max(sr,Ot),Lr)}else sr<Ot&&(sr=Ot)}re.style.top=`${sr}px`,re.style.left=`${Ro}px`},ct=()=>{re&&(re.setAttribute("hidden",""),re.style.removeProperty("visibility"),Ce=null,Ee=null,Me())},$t=k=>{const Q=document.createDocumentFragment();if(!Array.isArray(k)||k.length===0)return Q;const X=Oe=>{if(!Oe)return;const Ne=document.createElement("p");Ne.textContent=Oe,Q.appendChild(Ne)};let ae=[];const Ae=()=>{if(!ae.length)return;const Oe=document.createElement("ul");ae.forEach(Ne=>{const Qe=document.createElement("li");Qe.textContent=Ne,Oe.appendChild(Qe)}),Q.appendChild(Oe),ae=[]},Se=Oe=>{Oe&&ae.push(Oe)};return k.forEach(Oe=>{if(typeof Oe!="string")return;Oe.replace(/\r\n/g,`
`).replace(/\s*[•‣▪◦⋅·]\s*/g,`
• `).split(/\n+/).map(Fe=>Fe.trim()).filter(Boolean).forEach(Fe=>{const _e=Fe.match(/^[•\-–—]\s*(.+)$/);if(_e){Se(_e[1].trim());return}Ae(),X(Fe)}),Ae()}),Ae(),Q.childElementCount||X(k.filter(Boolean).join(" ")),Q},fo=k=>{if(de=k||null,Te(k||null),!be||!re||!k){ct();return}const{label:Q,details:X,shortcuts:ae}=We(k),Ae=typeof Q=="string"&&Q.trim().length>0,Se=Array.isArray(X)?X.filter(Boolean):[],Oe=Array.isArray(ae)?ae.filter(Boolean):[];if(!Ae&&Se.length===0&&Oe.length===0){ct();return}if(Se.length===0&&Oe.length===0&&(!Ae||Q.trim()==="")){ct();return}if(re.textContent="",Ae){const Fe=document.createElement("div");Fe.className="hover-help-heading",Fe.textContent=Q.trim(),re.appendChild(Fe)}if(Se.length){const Fe=document.createElement("div");Fe.className="hover-help-details",Fe.appendChild($t(Se)),re.appendChild(Fe)}if(Oe.length){const Fe=document.createElement("div");Fe.className="hover-help-shortcuts";const _e=ge("hoverHelpShortcutsHeading");if(_e){const st=document.createElement("div");st.className="hover-help-shortcuts-heading",st.textContent=_e,Fe.appendChild(st)}const He=document.createElement("ul");He.className="hover-help-shortcuts-list",Oe.forEach(st=>{if(!st)return;const at=document.createElement("li");at.className="hover-help-shortcut",at.textContent=st,He.appendChild(at)}),He.childElementCount&&(Fe.appendChild(He),re.appendChild(Fe))}const Ne=ge("hoverHelpExitHint");if(Ne){const Fe=document.createElement("div");Fe.className="hover-help-hint",Fe.textContent=Ne,re.appendChild(Fe)}const Qe=re.hasAttribute("hidden");Qe&&(re.style.visibility="hidden",re.removeAttribute("hidden")),mt(k),Qe&&re.style.removeProperty("visibility"),re.removeAttribute("hidden")},no=k=>!be||!k?!1:!!k.closest("[data-allow-hover-help], #settingsButton, #settingsDialog"),Nt=()=>{be=!1,de=null,re&&(removeNode(re),re=null),Me(),document.body.style.cursor="",document.body.classList.remove("hover-help-active")},xo=()=>{be=!0,Y(),document.body.style.cursor="help",document.body.classList.add("hover-help-active"),Me(),re=document.createElement("div"),re.id="hoverHelpTooltip",re.setAttribute("role","tooltip"),re.setAttribute("hidden",""),document.body.appendChild(re)},Io=()=>{be&&re&&de&&mt(de)};document.addEventListener("mouseover",k=>{if(!be||!re)return;je(k);const Q=rt(k.target);fo(Q)}),document.addEventListener("focusin",k=>{if(!be||!re)return;Ce=null,Ee=null;const Q=rt(k.target);fo(Q)}),document.addEventListener("focusout",k=>{!be||!re||(!k.relatedTarget||!rt(k.relatedTarget))&&(de=null,ct())}),window.addEventListener("scroll",Io,!0),window.addEventListener("resize",Io);const qo=k=>{je(k)&&de&&mt(de)};typeof window<"u"&&"PointerEvent"in window?(window.addEventListener("pointermove",qo,!0),window.addEventListener("pointerdown",qo,!0)):(window.addEventListener("mousemove",qo,!0),window.addEventListener("mousedown",qo,!0)),document.addEventListener("mousedown",k=>{be&&!no(k.target)&&k.preventDefault()},!0),document.addEventListener("click",k=>{be&&(no(k.target)||(k.preventDefault(),Nt()))}),hoverHelpButton&&hoverHelpButton.addEventListener("click",k=>{k.stopPropagation(),xo()});const eo=()=>{if(!featureSearch$1)return;document.getElementById("sideMenu")?.contains(featureSearch$1)&&openSideMenu(),typeof featureSearch$1.scrollIntoView=="function"&&featureSearch$1.scrollIntoView({behavior:"smooth",block:"center"});try{featureSearch$1.focus({preventScroll:!0})}catch{featureSearch$1.focus()}typeof featureSearch$1.select=="function"&&featureSearch$1.select(),featureSearch$1.hasAttribute("data-skip-native-picker")||So(featureSearch$1)},To=k=>typeof k!="string"||!k?"":k.toLowerCase().replace(/[^a-z0-9]/g,""),ko=k=>typeof k!="string"||!k?new Set:new Set(k.toLowerCase().split(/[\s\-_]+/).filter(Boolean)),Jt=(k,Q,X)=>null,lr=(k,Q)=>{featureSearch$1&&(featureSearch$1.value=k)},pt=k=>typeof k!="string"?"":k.trim().toLowerCase();function mo(k){return typeof k!="string"?"":k.trim().toLowerCase().replace(/\s+/g," ")}typeof window<"u"&&(window.normalizeGearNameForComparison=mo);const go=(k,Q,X)=>{typeof console<"u"&&console.debug&&console.debug("Search usage:",k,Q,X)};if(n=k=>{const Q=typeof k=="string"?k:featureSearch$1?.value||"";pt(Q);const X=Q.trim();if(!X)return;const Ae=typeof extractFeatureSearchFilter=="function"?extractFeatureSearchFilter(X):{filterType:null,queryText:X},Se=Ae?.filterType||null,Oe=Se?Ae.queryText:X,Ne=typeof Oe=="string"?Oe.trim():"",Fe=X.toLowerCase().endsWith(" (help)"),_e=Fe?X.slice(0,-7).trim():Ne||(typeof Oe=="string"?Oe.trim():"");if(Se==="help"&&!Fe&&!_e){j(),helpSearch&&(helpSearch.value="",U(),helpSearch.focus());return}const He=_e||(Se?"":X),st=To(He);ko(He);const at=Jt(helpMap,st),St=Jt(deviceMap,st),kt=Jt(featureMap,st),Zt=Jt(actionMap,st),Ht=Se==="feature"?kt:Se==="action"?Zt:Zt?!kt||Zt.score>kt.score?Zt:kt.score>Zt.score?kt:Zt:kt,jo=at?.score||0,ir=St?.score||0,sr=typeof STRONG_SEARCH_MATCH_TYPES<"u"&&STRONG_SEARCH_MATCH_TYPES instanceof Set?STRONG_SEARCH_MATCH_TYPES:FALLBACK_STRONG_SEARCH_MATCH_TYPES,Ro=St?sr.has(St.matchType):!1,Ot=Se==="device",Lr=Se==="action",Co=Se==="feature",hr=Co||Lr,Wo=(()=>{if(!Ht)return null;const Vo=Ht.value;if(!Vo)return null;const Po=Vo.entryType||"feature";return Po==="device"||Ot||Co&&Po!=="feature"||Lr&&Po!=="action"?null:{match:Ht,entryType:Po,entry:Vo}})(),Yo=Ht&&Ht.value&&Ht.value.entryType!=="device"?Ht:null,Tt=Wo?.match||Yo,$o=Tt?.score||0,br=Tt?sr.has(Tt.matchType):!1,Do=Math.max(ir,$o),or=!!at&&(Fe||Se==="help"||!(Ro||br)&&jo>Do);if(!Fe&&!or){const Vo=Tt?.matchType;if(!hr&&!!St&&(!Tt||Ro&&!br||Ro===br&&(ir>$o||ir===$o&&Vo!=="exactKey"))||Ot&&!!St){const co=St.value;if(co&&co.select){if(co.select.value=co.value,co.select.dispatchEvent(new Event("change",{bubbles:!0})),co.label&&lr(co.label),typeof go=="function"){let Sr=co.label;if(!Sr&&co.select){const jr=Array.from(co.select.options||[]).find(Qr=>Qr.value===co.value);jr&&jr.textContent&&(Sr=jr.textContent.trim())}go(St.key,"device",Sr)}w(co.select);const mr=[co.select,...C(co.select)];v(mr);return}if(co&&co.entryType==="deviceLibrary"&&(co.element||co.rawElement)){const mr=co.label||He;mr&&lr(mr),typeof go=="function"&&go(St.key,"device",mr),typeof co.focusLibraryEntry=="function"&&co.focusLibraryEntry();const Sr=co.element||co.rawElement;if(Sr){w(Sr);const jr=[Sr,...C(Sr)];v(jr)}typeof co.highlightLibraryEntry=="function"&&co.highlightLibraryEntry();return}}if(Wo){const co=Wo.entry,mr=co?.element||co;if(mr){const Sr=co?.label||mr.textContent?.trim();if(Sr&&lr(Sr),typeof go=="function"){const Qr=Wo.entryType||"feature",an=Wo.match?.key||Ht?.key;go(an,Qr,Sr)}w(mr);const jr=[mr,...C(mr)];v(jr);return}}}if(at){const Vo=at.value||{},Po=Vo.section;if(typeof go=="function"&&go(at.key,"help",Vo.label),j(),helpSearch&&(helpSearch.value=He,U()),Po){Po.hasAttribute("hidden")&&(Po.removeAttribute("hidden"),helpNoResults&&helpNoResults.setAttribute("hidden",""),typeof helpNoResultsSuggestions<"u"&&helpNoResultsSuggestions&&helpNoResultsSuggestions.setAttribute("hidden",""),V()),typeof Po.scrollIntoView=="function"&&Po.scrollIntoView({behavior:"smooth",block:"start"}),_(Po);const co=Po.querySelector('h3, summary, h4, h5, h6, [role="heading"]')||Po.querySelector("button, a");v(co?[co]:[Po]);const mr=Po.id?u.get(Po.id):null;t&&t.querySelectorAll(".help-quick-link.active").forEach(Sr=>Sr.classList.remove("active")),mr&&mr.button&&mr.button.classList.add("active")}return}j(),helpSearch&&(helpSearch.value=He,U(),v([helpSearch]))},featureSearch$1){const k=document.getElementById("featureSearchDropdown"),Q=_e=>{if(!_e||!k)return null;const He=_e.closest("#featureSearchDropdown")||k,st=He&&He.__optionEntries instanceof Map?He.__optionEntries:null;if(!st)return null;if(_e.id&&st.has(_e.id))return st.get(_e.id)||null;const at=_e.getAttribute("data-entry-key");if(at){for(const St of st.values())if(St&&St.key===at)return St}return null},X=(_e,He)=>{if(!_e)return!1;const st=_e.type||_e.entryType||"feature",at=pt(He||""),St=_e.label||_e.display||_e.optionLabel||at||"",kt=_e.key||null,Zt=()=>{typeof go=="function"&&kt&&go(kt,st==="deviceLibrary"?"device":st,St)};if(st==="device"){if(_e.select){_e.select.value=_e.value,_e.select.dispatchEvent(new Event("change",{bubbles:!0})),St&&lr(St),Zt(),w(_e.select);const Ht=[_e.select,...C(_e.select)];return v(Ht),!0}if(_e.entryType==="deviceLibrary"&&(_e.element||_e.rawElement)){St&&lr(St),Zt(),typeof _e.focusLibraryEntry=="function"&&_e.focusLibraryEntry();const Ht=_e.element||_e.rawElement;if(Ht){w(Ht);const jo=[Ht,...C(Ht)];v(jo)}return typeof _e.highlightLibraryEntry=="function"&&_e.highlightLibraryEntry(),!0}}if(st==="feature"){const Ht=_e.element||_e;if(Ht){St&&lr(St),Zt(),w(Ht);const jo=[Ht,...C(Ht)];return v(jo),!0}}if(st==="help"){Zt(),j(),helpSearch&&(helpSearch.value=St||at,U());const Ht=_e.section;if(Ht){Ht.hasAttribute("hidden")&&(Ht.removeAttribute("hidden"),helpNoResults&&helpNoResults.setAttribute("hidden",""),typeof helpNoResultsSuggestions<"u"&&helpNoResultsSuggestions&&helpNoResultsSuggestions.setAttribute("hidden",""),V()),typeof Ht.scrollIntoView=="function"&&Ht.scrollIntoView({behavior:"smooth",block:"start"}),_(Ht);const jo=Ht.querySelector('h3, summary, h4, h5, h6, [role="heading"]')||Ht.querySelector("button, a");v(jo?[jo]:[Ht]);const ir=Ht.id?u.get(Ht.id):null;return t&&t.querySelectorAll(".help-quick-link.active").forEach(sr=>sr.classList.remove("active")),ir&&ir.button&&ir.button.classList.add("active"),!0}}if(st==="action")switch(Zt(),_e.action){case"create-new-project":return typeof setupSelect$1<"u"&&setupSelect$1&&(setupSelect$1.value="",setupSelect$1.dispatchEvent(new Event("change",{bubbles:!0})),typeof checkSetupChanged$1=="function"&&checkSetupChanged$1()),!0;case"save-project":return typeof saveSetupBtn<"u"&&saveSetupBtn&&saveSetupBtn.click(),!0;case"export-project":return typeof shareSetupBtn<"u"&&shareSetupBtn&&shareSetupBtn.click(),!0;case"toggle-dark-mode":return typeof darkModeToggle<"u"&&darkModeToggle&&darkModeToggle.click(),!0;case"toggle-pink-mode":return typeof pinkModeToggle<"u"&&pinkModeToggle&&pinkModeToggle.click(),!0;case"open-settings":return typeof settingsButton<"u"&&settingsButton&&settingsButton.click(),!0;case"open-help":return typeof helpButton<"u"&&helpButton&&helpButton.click(),!0;case"force-reload":return typeof reloadButton<"u"&&reloadButton&&reloadButton.click(),!0}return!1},ae=()=>k?Array.from(k.querySelectorAll('[role="option"]')||[]):[],Ae=()=>{ae().forEach(He=>{He.setAttribute("tabindex","-1"),He.setAttribute("aria-selected","false")}),featureSearch$1&&featureSearch$1.hasAttribute("aria-activedescendant")&&featureSearch$1.removeAttribute("aria-activedescendant")},Se=(_e,{focusOption:He=!1}={})=>{const st=ae();if(!st.length)return featureSearch$1&&featureSearch$1.hasAttribute("aria-activedescendant")&&featureSearch$1.removeAttribute("aria-activedescendant"),null;const at=Math.max(0,Math.min(_e,st.length-1));return st.forEach((St,kt)=>{const Zt=kt===at;St.setAttribute("tabindex",Zt?"0":"-1"),St.setAttribute("aria-selected",Zt?"true":"false"),Zt&&(featureSearch$1&&(St.id?featureSearch$1.setAttribute("aria-activedescendant",St.id):featureSearch$1.hasAttribute("aria-activedescendant")&&featureSearch$1.removeAttribute("aria-activedescendant")),He&&St.focus())}),k&&(k.dataset.activeIndex=String(at)),st[at]},Oe=()=>{if(!k)return;Ae(),k.dataset.open="false",k.hidden=!0,k.setAttribute("aria-expanded","false"),k.dataset.activeIndex="",featureSearch$1&&featureSearch$1.setAttribute("aria-expanded","false");const _e=k.closest(".feature-search");_e&&_e.classList.remove("feature-search-open")},Ne=()=>{if(!k)return;if(k.dataset.count==="0"){Oe();return}k.dataset.open="true",k.hidden=!1,k.setAttribute("aria-expanded","true"),featureSearch$1&&featureSearch$1.setAttribute("aria-expanded","true");const _e=k.closest(".feature-search");if(_e&&_e.classList.add("feature-search-open"),!ae().length){featureSearch$1&&featureSearch$1.hasAttribute("aria-activedescendant")&&featureSearch$1.removeAttribute("aria-activedescendant");return}const st=k.dataset.activeIndex,at=typeof st=="string"&&st!==""?Number(st):NaN,St=document.activeElement&&document.activeElement!==featureSearch$1;Number.isNaN(at)?Se(0,{focusOption:St}):Se(at,{focusOption:St})},Qe=(_e,He)=>{if(!featureSearch$1||!_e)return;const st=He?Q(He):null;featureSearch$1.value=_e;try{featureSearch$1.focus({preventScroll:!0})}catch{featureSearch$1.focus()}if(featureSearch$1.setSelectionRange?.(_e.length,_e.length),st&&X(st,_e)){updateFeatureSearchSuggestions(_e),Oe();return}updateFeatureSearchSuggestions(_e),n(_e),Oe()},Fe=()=>{Oe(),n(featureSearch$1.value)};featureSearch$1.addEventListener("change",Fe),featureSearch$1.addEventListener("focus",()=>{Ne()}),featureSearch$1.addEventListener("blur",()=>{window.setTimeout(()=>{!k||k.contains(document.activeElement)||Oe()},100)}),featureSearch$1.addEventListener("input",()=>{updateFeatureSearchSuggestions(featureSearch$1.value),Ne()}),featureSearch$1.addEventListener("keydown",_e=>{if(_e.key==="Enter")Fe();else if(_e.key==="Escape")featureSearch$1.value&&(featureSearch$1.value="",restoreFeatureSearchDefaults()),Oe(),_e.preventDefault();else if(_e.key==="ArrowDown"){if(!k||k.dataset.count==="0")return;_e.preventDefault(),Ne();const He=ae(),st=k.dataset.activeIndex,at=st?Number(st)+1:0;Se(at>=He.length?0:at,{focusOption:!1})}else if(_e.key==="ArrowUp"){if(!k||k.dataset.count==="0")return;_e.preventDefault(),Ne();const He=ae();if(!He.length)return;const st=k.dataset.activeIndex;if(!st)Se(He.length-1,{focusOption:!1});else{const at=Number(st)-1;Se(at>=0?at:He.length-1,{focusOption:!1})}}}),k&&(k.addEventListener("mousedown",_e=>{_e.target.closest("[data-value]")&&_e.preventDefault()}),k.addEventListener("click",_e=>{const He=_e.target.closest("[data-value]");if(!He)return;const st=He.getAttribute("data-value")||"";st&&Qe(st,He)}),k.addEventListener("keydown",_e=>{const He=ae();if(!He.length)return;const st=document.activeElement,at=He.indexOf(st);if(_e.key==="ArrowDown"){_e.preventDefault();const St=at>=0?at+1:0;Se(St>=He.length?0:St,{focusOption:!0})}else if(_e.key==="ArrowUp"){_e.preventDefault();const St=at>0?at-1:He.length-1;Se(St,{focusOption:!0})}else if(_e.key==="Home")_e.preventDefault(),Se(0,{focusOption:!0});else if(_e.key==="End")_e.preventDefault(),Se(He.length-1,{focusOption:!0});else if(_e.key==="Enter"){if(_e.preventDefault(),at>=0&&He[at]){const St=He[at].getAttribute("data-value")||"";St&&Qe(St,He[at])}}else _e.key==="Escape"?(_e.preventDefault(),Oe(),eo()):_e.key==="Tab"&&Oe()}),k.addEventListener("focusout",()=>{window.setTimeout(()=>{document.activeElement===featureSearch$1||k&&k.contains(document.activeElement)||Oe()},100)}))}function So(k){if(!(!k||typeof k.showPicker!="function"))try{k.showPicker()}catch(Q){if(Q&&Q.name==="NotAllowedError")return;console.warn("Unable to show picker",Q)}}return document.addEventListener("keydown",k=>{const Q=document.activeElement.tagName,X=Q==="INPUT"||Q==="TEXTAREA",ae=typeof k.key=="string"?k.key:"",Ae=ae.toLowerCase();be&&k.key==="Escape"?Nt():k.key==="Escape"&&isDialogOpen(helpDialog$1)?(k.preventDefault(),Y()):k.key==="Escape"&&settingsDialog&&isDialogOpen(settingsDialog)?(k.preventDefault(),revertSettingsPinkModeIfNeeded(),rememberSettingsPinkModeBaseline(),revertSettingsTemperatureUnitIfNeeded(),rememberSettingsTemperatureUnitBaseline(),revertSettingsFocusScaleIfNeeded(),rememberSettingsFocusScaleBaseline(),invokeSessionRevertAccentColor(),closeDialog(settingsDialog),settingsDialog.setAttribute("hidden","")):k.key==="F1"||(k.key==="/"||k.key==="?")&&(k.ctrlKey||k.metaKey)?(k.preventDefault(),le()):k.key==="/"&&!X&&(!helpDialog$1||typeof isDialogOpen=="function"&&!isDialogOpen(helpDialog$1))?(k.preventDefault(),eo()):k.key==="?"&&!X||Ae==="h"&&!X?(k.preventDefault(),le()):typeof isDialogOpen=="function"&&isDialogOpen(helpDialog$1)&&(k.key==="/"&&!X||Ae==="f"&&(k.ctrlKey||k.metaKey))?(k.preventDefault(),helpSearch&&helpSearch.focus()):ae===","&&(k.ctrlKey||k.metaKey)?(k.preventDefault(),requestSettingsOpen({reason:"keyboard-shortcut",key:ae,ctrl:!!k.ctrlKey,meta:!!k.metaKey,shift:!!k.shiftKey})):Ae==="k"&&(k.ctrlKey||k.metaKey)?(k.preventDefault(),eo()):Ae==="d"&&!X?setThemePreference(!getThemePreference()):Ae==="s"&&(k.ctrlKey||k.metaKey)?(k.preventDefault(),saveSetupBtn&&!saveSetupBtn.disabled&&saveSetupBtn.click()):Ae==="p"&&!X&&persistPinkModePreference(!document.body.classList.contains("pink-mode"))}),s.addEventListener("click",k=>{k.target===s&&Y()}),s.addEventListener("cancel",k=>{k.preventDefault(),Y()}),!0};setupHelpSystem()||document.addEventListener("DOMContentLoaded",setupHelpSystem);const scenarioIcons$1={Indoor:iconGlyph("",ICON_FONT_KEYS.ESSENTIAL),Outdoor:iconGlyph("",ICON_FONT_KEYS.ESSENTIAL),Studio:iconGlyph("",ICON_FONT_KEYS.FILM),Tripod:iconGlyph("",ICON_FONT_KEYS.FILM),Handheld:iconGlyph("",ICON_FONT_KEYS.UICONS),Easyrig:iconGlyph("",ICON_FONT_KEYS.UICONS),"Cine Saddle":iconGlyph("",ICON_FONT_KEYS.UICONS),Steadybag:iconGlyph("",ICON_FONT_KEYS.UICONS),Dolly:iconGlyph("",ICON_FONT_KEYS.FILM),Slider:iconGlyph("",ICON_FONT_KEYS.UICONS),Steadicam:iconGlyph("",ICON_FONT_KEYS.UICONS),Gimbal:iconGlyph("",ICON_FONT_KEYS.UICONS),Trinity:iconGlyph("",ICON_FONT_KEYS.UICONS),Rollcage:iconGlyph("",ICON_FONT_KEYS.UICONS),"Car Mount":iconGlyph("",ICON_FONT_KEYS.UICONS),Jib:iconGlyph("",ICON_FONT_KEYS.UICONS),"Undersling mode":iconGlyph("",ICON_FONT_KEYS.UICONS),Crane:iconGlyph("",ICON_FONT_KEYS.UICONS),"Remote Head":ICON_GLYPHS.controller,"Extreme cold (snow)":iconGlyph("",ICON_FONT_KEYS.UICONS),"Extreme rain":iconGlyph("",ICON_FONT_KEYS.UICONS),"Extreme heat":iconGlyph("",ICON_FONT_KEYS.UICONS),"Rain Machine":iconGlyph("",ICON_FONT_KEYS.UICONS),"Slow Motion":iconGlyph("",ICON_FONT_KEYS.UICONS),"Battery Belt":ICON_GLYPHS.batteryBolt};function registerRequiredScenarioOptionEntriesGetter(e){if(typeof e!="function")return;const t=getSessionRuntimeScopes();for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r!="object"))try{r.getRequiredScenarioOptionEntries=e}catch{try{Object.defineProperty(r,"getRequiredScenarioOptionEntries",{configurable:!0,writable:!0,value:e})}catch{}}}}function getRequiredScenarioOptionEntries(){const e=new Map;return requiredScenariosSelect&&requiredScenariosSelect.options&&Array.from(requiredScenariosSelect.options).forEach(t=>{if(!t||t.disabled)return;const o=typeof t.value=="string"?t.value.trim():"";if(!o)return;const r=typeof t.textContent=="string"&&t.textContent.trim()?t.textContent.trim():o;e.has(o)||e.set(o,r)}),Object.keys(scenarioIcons$1).forEach(t=>{if(typeof t!="string")return;const o=t.trim();!o||e.has(o)||e.set(o,o)}),Array.from(e.entries()).map(([t,o])=>({value:t,label:o})).sort((t,o)=>t.label.localeCompare(o.label,void 0,{sensitivity:"base"}))}registerRequiredScenarioOptionEntriesGetter(getRequiredScenarioOptionEntries);function updateRequiredScenariosSummary(){if(!requiredScenariosSelect||!requiredScenariosSummary)return;requiredScenariosSummary.innerHTML="";let e=Array.from(requiredScenariosSelect.selectedOptions).map(o=>o.value);const t=e.includes("Dolly");if(remoteHeadOption&&(t?remoteHeadOption.hidden=!1:(remoteHeadOption.hidden=!0,remoteHeadOption.selected=!1,e=e.filter(o=>o!=="Remote Head"))),t&&monitorSelect$1&&(!monitorSelect$1.value||monitorSelect$1.value==="None")){const o="SmallHD Ultra 7";if((typeof window<"u"&&window.devices||{})?.monitors?.[o]){if(!Array.from(monitorSelect$1.options).some(n=>n.value===o)){const n=document.createElement("option");n.value=o,n.textContent=o,monitorSelect$1.appendChild(n)}monitorSelect$1.value=o,monitorSelect$1.dispatchEvent(new Event("change"))}}if(videoDistributionSelect){const o=r=>{let n=Array.from(videoDistributionSelect.options).find(a=>a.value===r);n||(n=document.createElement("option"),n.value=r,n.textContent=r,videoDistributionSelect.appendChild(n))};o('DoP Monitor 7" handheld'),o('DoP Monitor 15-21"')}e.forEach(o=>{const r=document.createElement("span");r.className="scenario-box";const n=document.createElement("span");n.className="scenario-icon icon-glyph",applyIconGlyph(n,scenarioIcons$1[o]||ICON_GLYPHS.pin),r.appendChild(n),r.appendChild(document.createTextNode(o)),requiredScenariosSummary.appendChild(r)}),tripodPreferencesRow&&(e.includes("Tripod")?(tripodPreferencesRow.classList.remove("hidden"),tripodPreferencesHeading&&tripodPreferencesHeading.classList.remove("hidden"),tripodPreferencesSection&&tripodPreferencesSection.classList.remove("hidden")):(tripodPreferencesRow.classList.add("hidden"),tripodPreferencesHeading&&tripodPreferencesHeading.classList.add("hidden"),tripodPreferencesSection&&tripodPreferencesSection.classList.add("hidden"),tripodHeadBrandSelect&&(tripodHeadBrandSelect.value=""),tripodBowlSelect&&(tripodBowlSelect.value=""),tripodTypesSelect&&Array.from(tripodTypesSelect.options).forEach(o=>{o.selected=!1}),tripodSpreaderSelect&&(tripodSpreaderSelect.value=""),updateTripodOptions()))}function initApp(){console.log("DEBUG: initApp ENTERED");try{ensureCriticalStorageBackupsFn()}catch(t){typeof console<"u"&&typeof console.error=="function"&&console.error("Critical storage backup guard failed during initialization",t)}const e=resolveFilterSelectElement();sharedLinkRow&&sharedLinkRow.classList.remove("hidden"),applySetLanguage(currentLang,{skipUpdateCalculations:!0}),populateEnvironmentDropdowns(),populateLensDropdown(),populateFilterDropdown(),e&&(e.addEventListener("change",renderFilterDetails$1),e.addEventListener("change",()=>{saveCurrentSession$1(),saveCurrentGearList$1(),checkSetupChanged$1()}),renderFilterDetails$1()),populateUserButtonDropdowns$1(),schedulePostRenderTask(()=>{document.querySelectorAll("#projectForm select").forEach(t=>{typeof attachSelectSearch=="function"&&attachSelectSearch(t),callSessionCoreFunction("initFavoritableSelect",[t],{defer:!0})})}),schedulePostRenderTask(()=>{if(typeof globalThis<"u"&&typeof globalThis.setupInstallBanner=="function")try{globalThis.setupInstallBanner()}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to set up install banner",t)}if(typeof maybeShowIosPwaHelp=="function")try{maybeShowIosPwaHelp()}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Failed to display iOS PWA help prompt",t)}}),typeof resetDeviceForm=="function"&&resetDeviceForm(),typeof ensureDefaultProjectInfoSnapshot=="function"?ensureDefaultProjectInfoSnapshot():typeof window<"u"&&typeof window.ensureDefaultProjectInfoSnapshot=="function"&&window.ensureDefaultProjectInfoSnapshot(),restoreSessionState(),applySharedSetupFromUrl$1(),typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"?(cineCoreUiHelpers.whenElementAvailable("requiredScenarios",t=>{if(typeof requiredScenariosSelect>"u"||!requiredScenariosSelect)try{typeof window<"u"&&(window.requiredScenariosSelect=t)}catch{}t.addEventListener("change",updateRequiredScenariosSummary),updateRequiredScenariosSummary()}),cineCoreUiHelpers.whenElementAvailable("tripodHeadBrand",t=>{if(typeof tripodHeadBrandSelect>"u"||!tripodHeadBrandSelect)try{typeof window<"u"&&(window.tripodHeadBrandSelect=t)}catch{}t.addEventListener("change",updateTripodOptions)}),cineCoreUiHelpers.whenElementAvailable("tripodBowl",t=>{if(typeof tripodBowlSelect>"u"||!tripodBowlSelect)try{typeof window<"u"&&(window.tripodBowlSelect=t)}catch{}t.addEventListener("change",updateTripodOptions)}),cineCoreUiHelpers.whenElementAvailable("tripodTypes",t=>{if(typeof tripodTypesSelect>"u"||!tripodTypesSelect)try{typeof window<"u"&&(window.tripodTypesSelect=t)}catch{}t.addEventListener("change",updateTripodOptions)}),cineCoreUiHelpers.whenElementAvailable("tripodSpreader",t=>{if(typeof tripodSpreaderSelect>"u"||!tripodSpreaderSelect)try{typeof window<"u"&&(window.tripodSpreaderSelect=t)}catch{}t.addEventListener("change",updateTripodOptions)})):(requiredScenariosSelect&&(requiredScenariosSelect.addEventListener("change",updateRequiredScenariosSummary),updateRequiredScenariosSummary()),tripodHeadBrandSelect&&tripodHeadBrandSelect.addEventListener("change",updateTripodOptions),tripodBowlSelect&&tripodBowlSelect.addEventListener("change",updateTripodOptions)),typeof updateTripodOptions=="function"&&updateTripodOptions(),typeof updateViewfinderExtensionVisibility=="function"&&updateViewfinderExtensionVisibility(),typeof updateCalculations$1=="function"&&updateCalculations$1(),typeof applyFilters=="function"&&applyFilters()}function ensureFeedbackTemperatureOptionsSafe(e){if(!e)return;if(typeof ensureFeedbackTemperatureOptions=="function"){ensureFeedbackTemperatureOptions(e);return}const t=typeof FEEDBACK_TEMPERATURE_MIN=="number"?FEEDBACK_TEMPERATURE_MIN:-20,o=typeof FEEDBACK_TEMPERATURE_MAX_LIMIT=="number"?FEEDBACK_TEMPERATURE_MAX_LIMIT:50,r=o-t+2;if(e.options.length===r)return;const n=e.value;e.innerHTML="";const a=document.createElement("option");a.value="",a.textContent="",e.appendChild(a);for(let s=t;s<=o;s+=1){const l=document.createElement("option");l.value=String(s),l.textContent=String(s),e.appendChild(l)}n&&Array.from(e.options).find(l=>l.value===n)&&(e.value=n)}function updateFeedbackTemperatureOptionsSafe(){if(typeof updateFeedbackTemperatureOptions=="function"){updateFeedbackTemperatureOptions();return}const e=document.getElementById("fbTemperature");e&&(ensureFeedbackTemperatureOptionsSafe(e),Array.from(e.options).forEach(t=>{if(t){if(t.value===""){t.textContent="";return}t.textContent=`${t.value}°C`}}))}const POST_RENDER_TIMEOUT_MS=120;function schedulePostRenderTask(e,t={}){if(typeof e!="function")return;const o=typeof t.timeout=="number"&&t.timeout>=0?t.timeout:POST_RENDER_TIMEOUT_MS,r=a=>{try{e(a)}catch(s){typeof console<"u"&&typeof console.error=="function"&&console.error("Deferred task failed during post-render scheduling",s)}},n=()=>{if(typeof requestIdleCallback=="function"){requestIdleCallback(r,{timeout:o});return}setTimeout(r,o)};typeof requestAnimationFrame=="function"?requestAnimationFrame(n):n()}function populateEnvironmentDropdowns(){const e=o=>{o&&(typeof ensureFeedbackTemperatureOptionsSafe=="function"&&ensureFeedbackTemperatureOptionsSafe(o),typeof updateFeedbackTemperatureOptionsSafe=="function"&&updateFeedbackTemperatureOptionsSafe())},t=document.getElementById("fbTemperature");t?e(t):typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"&&cineCoreUiHelpers.whenElementAvailable("fbTemperature",e)}function populateLensDropdown(){const t=typeof lensSelect<"u"&&lensSelect?lensSelect:typeof document<"u"?document.getElementById("lenses"):null;if(!t){typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"&&cineCoreUiHelpers.whenElementAvailable("lenses",R=>{(typeof lensSelect>"u"||!lensSelect)&&typeof window<"u"&&(window.lensSelect=R),populateLensDropdown()});return}const o=t,r=R=>{if(typeof R!="string")return"";const _=R.trim().toLowerCase();return _==="imperial"||_==="metric"?_:""},a=(()=>{const R=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||null,O=(R&&typeof R.focusScalePreference=="string"?R.focusScalePreference:null)||(typeof sessionFocusScale$1<"u"&&sessionFocusScale$1?sessionFocusScale$1:typeof focusScalePreference=="string"?focusScalePreference:null)||"metric";if(typeof normalizeFocusScale=="function")try{const $=normalizeFocusScale(O);if($==="imperial"||$==="metric")return $}catch{}return r(O)||"metric"})(),s=R=>{if(!R||typeof R!="object")return a;if(typeof normalizeFocusScale=="function")try{const G=normalizeFocusScale(R.focusScale);if(G==="imperial"||G==="metric")return G}catch{}return r(R.focusScale)||a},{lang:l}=resolveCompatibilityTexts(),u=(R,_={})=>{const G=typeof R=="string"?Number(R):R;if(!Number.isFinite(G))return"";const O=typeof _.maximumFractionDigits=="number"?_.maximumFractionDigits:0,B=typeof _.minimumFractionDigits=="number"?_.minimumFractionDigits:Math.min(0,O);if(typeof Intl<"u"&&typeof Intl.NumberFormat=="function")try{return new Intl.NumberFormat(l,{maximumFractionDigits:O,minimumFractionDigits:B}).format(G)}catch{}const $=Math.max(B,Math.min(20,O));try{return G.toFixed($)}catch{}return String(G)},d=(R,_=a)=>{const G=typeof R=="string"?Number(R):R;if(!Number.isFinite(G))return"";if(_==="imperial"){const $=G/453.59237,V=$>=10?1:2,M=u($,{maximumFractionDigits:V,minimumFractionDigits:0});return M?`${M} lb`:""}const B=u(G,{maximumFractionDigits:0,minimumFractionDigits:0});return B?`${B} g`:""},m=(R,_=a)=>{const G=typeof R=="string"?Number(R):R;if(!Number.isFinite(G))return"";if(_==="imperial"){const $=G/25.4,V=$>=10?1:2,M=u($,{maximumFractionDigits:V,minimumFractionDigits:0});return M?`${M} in`:""}const B=u(G,{maximumFractionDigits:1,minimumFractionDigits:0});return B?`${B} mm`:""},y=(R,_=a)=>{const G=typeof R=="string"?Number(R):R;if(!Number.isFinite(G))return"";if(_==="imperial"){const V=G*3.280839895,M=V<10?2:1,F=u(V,{maximumFractionDigits:M,minimumFractionDigits:M});return F?`${F} ft`:""}const B=G<1?2:1,$=u(G,{maximumFractionDigits:B,minimumFractionDigits:B});return $?`${$} m`:""},h=typeof window<"u"&&window.devices||{},b=(h&&h.lenses&&Object.keys(h.lenses).length?h.lenses:null)||h&&h.accessories&&h.accessories.lenses||null;if(!b||Object.keys(b).length===0)return;const v=new Set(Array.from(o.selectedOptions||[]).map(R=>R.value)),C=document.createDocumentFragment();if(!o.multiple){const R=document.createElement("option");R.value="",C.appendChild(R)}const A=Object.keys(b),w=typeof localeSort=="function"?localeSort:void 0;A.sort(w);for(let R=0;R<A.length;R+=1){const _=A[R],G=document.createElement("option");G.value=_;const O=b[_]||{},B=s(O),$=[],V=d(O.weight_g,B);if(V&&$.push(V),O.clampOn)if(O.frontDiameterMm){const F=m(O.frontDiameterMm,B);$.push(F?`${F} clamp-on`:"clamp-on")}else $.push("clamp-on");else O.clampOn===!1&&$.push("no clamp-on");const M=O.minFocusMeters??O.minFocus??(O.minFocusCm?O.minFocusCm/100:null);if(Number.isFinite(M)&&M>0){const F=y(M,B);F&&$.push(`${F} min focus`)}G.textContent=$.length?`${_} (${$.join(", ")})`:_,v.has(_)&&(G.selected=!0),C.appendChild(G)}if(o.innerHTML="",o.appendChild(C),typeof updateLensWorkflowCatalog=="function")try{updateLensWorkflowCatalog({preserveSelections:!0,skipEvent:!0,skipDirty:!0})}catch{}}function populateCameraPropertyDropdown(e,t,o=""){const r=a=>{a.innerHTML="";const s=document.createElement("option");s.value="",a.appendChild(s);const l=typeof cameraSelect$1<"u"&&cameraSelect$1?cameraSelect$1.value:"",u=typeof window<"u"&&window.devices||{},d=l&&u&&u.cameras&&u.cameras[l]?u.cameras[l][t]:null;Array.isArray(d)&&d.forEach(m=>{const y=document.createElement("option");y.value=m,y.textContent=m,m===o&&(y.selected=!0),a.appendChild(y)})},n=document.getElementById(e);n?r(n):typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"&&cineCoreUiHelpers.whenElementAvailable(e,r)}function populateRecordingResolutionDropdown$1(e=""){populateCameraPropertyDropdown("recordingResolution","resolutions",e)}typeof window<"u"?window.populateRecordingResolutionDropdown=populateRecordingResolutionDropdown$1:typeof globalThis<"u"&&(globalThis.populateRecordingResolutionDropdown=populateRecordingResolutionDropdown$1);const recordingFrameRateInput=typeof document<"u"?document.getElementById("recordingFrameRate"):null,recordingFrameRateHint=typeof document<"u"?document.getElementById("recordingFrameRateHint"):null,recordingFrameRateOptionsList=typeof document<"u"?document.getElementById("recordingFrameRateOptions"):null;slowMotionRecordingFrameRateInput=typeof document<"u"?document.getElementById("slowMotionRecordingFrameRate"):null;slowMotionRecordingFrameRateHint=typeof document<"u"?document.getElementById("slowMotionRecordingFrameRateHint"):null;slowMotionRecordingFrameRateOptionsList=typeof document<"u"?document.getElementById("slowMotionRecordingFrameRateOptions"):null;sensorModeDropdown=typeof document<"u"?document.getElementById("sensorMode"):null;slowMotionSensorModeDropdown=typeof document<"u"?document.getElementById("slowMotionSensorMode"):null;recordingResolutionDropdown=typeof document<"u"?document.getElementById("recordingResolution"):null;slowMotionRecordingResolutionDropdown=typeof document<"u"?document.getElementById("slowMotionRecordingResolution"):null;slowMotionAspectRatioSelect=typeof document<"u"?document.getElementById("slowMotionAspectRatio"):null;const PREFERRED_FRAME_RATE_VALUES=Object.freeze([.75,1,8,12,12.5,15,23.976,24,25,29.97,30,47.952,48,50,59.94,60,72,75,90,96,100,110,112,120,144,150,160,170,180,200,240]),FALLBACK_FRAME_RATE_VALUES=Object.freeze(["0.75","1","8","12","12.5","15","23.976","24","25","29.97","30","48","50","59.94","60","72","75","90","96","100","110","112","120","144","150","160","170","180","200","240"]),MIN_RECORDING_FRAME_RATE=1,FRAME_RATE_RANGE_TOLERANCE=5e-4;function formatFrameRateValue(e){const t=typeof e=="number"?e:Number.parseFloat(e);if(!Number.isFinite(t))return"";const o=Math.round(t*1e3)/1e3;return Number.isInteger(o)?String(o):o.toFixed(3).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}function tokenizeFrameRateContext(e){if(typeof e!="string"||!e)return[];const t=e.toLowerCase(),o=t.replace(/[\u2013\u2014]/g,"-").replace(/[()]/g," ").replace(/[[\]]/g," ").split(/[\s,/]+/).map(d=>d.replace(/[^a-z0-9:.+-]/g,"").replace(/^[:.+-]+|[:.+-]+$/g,"")).filter(d=>d&&d!=="fps"),r=new Set(o),n=d=>{if(!d)return;const m=d.replace(/[^a-z0-9]/g,"");m&&r.add(m)},a=t.replace(/\u00d7/g,"x"),s=a.replace(/\s+/g,""),l=d=>a.includes(d),u=d=>s.includes(d);return(l("uhd")||l("ultra hd")||u("ultrahd")||/3840\s*x\s*2160/.test(a))&&(n("uhd"),n("4k")),(l("dci")||/4096\s*x\s*2160/.test(a))&&(n("dci"),n("4k")),(u("2048x1080")||/2048\s*x\s*1080/.test(a)||/(?:^|[^a-z0-9])2k(?:[^a-z0-9]|$)/.test(a))&&(n("2k"),n("dci")),(u("fullhd")||l("full hd")||l("full-hd")||l("fhd")||l("1080p")||/1920\s*x\s*1080/.test(a))&&(n("hd"),n("fhd"),n("1080p")),(l("720p")||/1280\s*x\s*720/.test(a))&&(n("hd"),n("720p")),/(?:^|[^a-z0-9])6k(?:[^a-z0-9]|$)/.test(a)&&n("6k"),/(?:^|[^a-z0-9])8k(?:[^a-z0-9]|$)/.test(a)&&n("8k"),(/(?:^|[^a-z0-9])4k(?:[^a-z0-9]|$)/.test(a)||l("4k"))&&n("4k"),Array.from(r)}function normalizeMatchTarget(e){return typeof e!="string"||!e?"":e.toLowerCase().replace(/[^a-z0-9]/g,"")}function includePreferredValuesForRange(e,t,o){if(!Number.isFinite(e)||!Number.isFinite(t)||!o)return;const r=Math.min(e,t),n=Math.max(e,t);PREFERRED_FRAME_RATE_VALUES.forEach(a=>{if(a>=r-5e-4&&a<=n+5e-4){const s=formatFrameRateValue(a);s&&o.add(s)}})}function parseFrameRateNumericValues(e){if(typeof e!="string"||!e.trim())return[];const t=e.replace(/[\u2013\u2014]/g,"-"),o=t.split(":"),r=o.length>1?o.slice(1).join(":"):t,n=new Set,a=/(\d+(?:\.\d+)?)(?:\s*(?:-|to)\s*)(\d+(?:\.\d+)?)(?=\s*(?:fps|FPS))/g;let s=a.exec(r);for(;s;){const d=s[1],m=s[2],y=Number.parseFloat(d),h=Number.parseFloat(m),b=formatFrameRateValue(y),v=formatFrameRateValue(h);b&&n.add(b),v&&n.add(v),includePreferredValuesForRange(y,h,n),s=a.exec(r)}const l=/(?:up to|≤|<=|less than|max(?:imum)?(?:\s*of)?)\s*(\d+(?:\.\d+)?)(?=\s*(?:fps|FPS))/gi;for(;s=l.exec(r);){const d=formatFrameRateValue(s[1]);d&&(n.add(d),includePreferredValuesForRange(0,Number.parseFloat(s[1]),n))}const u=/(\d+(?:\.\d+)?)(?=\s*(?:fps|FPS))/g;for(;s=u.exec(r);){const d=formatFrameRateValue(s[1]);d&&n.add(d)}if(!n.size){const d=r.split("fps")[0]||r,m=/(\d+(?:\.\d+)?)/g;for(;s=m.exec(d);){const y=formatFrameRateValue(s[1]);y&&n.add(y)}}return Array.from(n)}function normalizeRecordingFrameRateValue(e){if(typeof e=="number"&&Number.isFinite(e))return formatFrameRateValue(e);if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const o=t.match(/-?\d+(?:\.\d+)?/);return o&&formatFrameRateValue(o[0])||t}function buildFrameRateSuggestions(e,t){const o=new Map,r=t.filter(a=>Array.isArray(a)&&a.length);if(e.forEach(a=>{if(typeof a!="string")return;const s=a.trim();if(!s)return;const[l]=s.split(":"),u=tokenizeFrameRateContext(l),d=parseFrameRateNumericValues(s);let y=u.length?1:0;if(r.length&&u.length){const h=new Set(u);r.forEach(b=>{let v=0;b.forEach(C=>{h.has(C)&&(v+=1)}),v&&(y+=v*3,v===b.length&&(y+=2))})}d.forEach(h=>{const b=formatFrameRateValue(h);if(!b)return;const v=o.get(b);(!v||y>v.score)&&o.set(b,{score:y,label:s,tokens:u})})}),!o.size)return{values:Array.from(FALLBACK_FRAME_RATE_VALUES),metadata:new Map};const n=Array.from(o.entries()).sort((a,s)=>{if(s[1].score!==a[1].score)return s[1].score-a[1].score;const l=Number.parseFloat(a[0]),u=Number.parseFloat(s[0]);return Number.isFinite(l)&&Number.isFinite(u)?l-u:a[0].localeCompare(s[0])});return{values:n.map(([a])=>a),metadata:new Map(n)}}function findMaxFrameRateForSensor(e,t,o=""){if(!Array.isArray(e)||!e.length||!Array.isArray(t)||!t.length)return null;const r=new Set(t);if(!r.size)return null;const n=normalizeMatchTarget(o),a=new Set(t.map(normalizeMatchTarget).filter(Boolean));let s=0,l=Number.NEGATIVE_INFINITY;return e.forEach(u=>{if(typeof u!="string")return;const d=u.trim();if(!d)return;const[m]=d.split(":"),y=tokenizeFrameRateContext(m),h=parseFrameRateNumericValues(d).map(w=>Number.parseFloat(w)).filter(Number.isFinite);if(!h.length)return;let b=0;const v=normalizeMatchTarget(m),C=y.map(normalizeMatchTarget).filter(Boolean);if(y.forEach(w=>{r.has(w)&&(b+=4)}),C.forEach(w=>{if(a.has(w)){b+=2;return}for(const R of a)if(R&&w.includes(R)){b+=1;break}}),n&&v&&v.includes(n)&&(b+=Math.max(r.size*4,8)),!b)return;const A=Math.max(...h);(b>s||b===s&&A>l)&&(s=b,l=A)}),!s||!Number.isFinite(l)?null:l}function getFrameRateInputValue(e){if(!e)return"";const t=e.value;return typeof t=="string"?t.trim():""}function getCurrentFrameRateInputValue(){return getFrameRateInputValue(recordingFrameRateInput)}function collectFrameRateContextTokens(e){if(!e)return[];if(e.multiple)return Array.from(e.selectedOptions||[]).map(o=>tokenizeFrameRateContext(o&&o.value)).reduce((o,r)=>r&&r.length?o.concat(r):o,[]);const t=typeof e.value=="string"?e.value:"";return tokenizeFrameRateContext(t)}function populateFrameRateDropdownFor(e={}){const{selected:t="",recordingInput:o,optionsList:r,sensorSelect:n,resolutionSelect:a,aspectSelect:s,hintElement:l}=e;if(!o||!r)return;let d=normalizeRecordingFrameRateValue(t)||getFrameRateInputValue(o);const m=cameraSelect$1&&cameraSelect$1.value,y=typeof window<"u"&&window.devices||{},h=m&&y&&y.cameras&&y.cameras[m]?y.cameras[m].frameRates:null,b=n&&typeof n.value=="string"?n.value:"",v=tokenizeFrameRateContext(b),C=a&&typeof a.value=="string"?a.value:"",A=tokenizeFrameRateContext(C),w=collectFrameRateContextTokens(s),R=findMaxFrameRateForSensor(Array.isArray(h)?h:[],v,b),_=findMaxFrameRateForSensor(Array.isArray(h)?h:[],A,recordingResolutionDropdown&&recordingResolutionDropdown.value),{values:G}=buildFrameRateSuggestions(Array.isArray(h)?h:[],[v,A,w]);r.innerHTML="";const O=new Set,B=[],$=[],V=[];Number.isFinite(R)&&V.push(R),Number.isFinite(_)&&V.push(_);const M=V.length?Math.min(...V):null;if(G.forEach(le=>{if(!le)return;let be=le;const re=Number.parseFloat(be);if(Number.isFinite(re)){if(re+FRAME_RATE_RANGE_TOLERANCE<MIN_RECORDING_FRAME_RATE||M!==null&&re>M+FRAME_RATE_RANGE_TOLERANCE)return;const ne=formatFrameRateValue(re);ne&&(be=ne),$.push({numeric:re,formatted:be})}if(O.has(be))return;O.add(be),B.push(be);const de=document.createElement("option");de.value=be,r.appendChild(de)}),d&&!O.has(d)){const le=Number.parseFloat(d);if(!Number.isFinite(le)||le+FRAME_RATE_RANGE_TOLERANCE>=MIN_RECORDING_FRAME_RATE){const be=document.createElement("option");be.value=d,r.appendChild(be)}}const F=$.reduce((le,be)=>be.numeric>le.numeric?be:le,{numeric:Number.NEGATIVE_INFINITY,formatted:""});let z=F.numeric;Number.isFinite(M)&&(z=Number.isFinite(z)?Math.min(z,M):M);const x=Number.isFinite(z)?F.formatted||formatFrameRateValue(z):"",H=formatFrameRateValue(MIN_RECORDING_FRAME_RATE),W=Number.parseFloat(d);let U=d,j=!1;if(Number.isFinite(z)&&Number.isFinite(W)&&W>z+FRAME_RATE_RANGE_TOLERANCE){const le=x||formatFrameRateValue(z);le&&(U=le,U!==d&&(j=!0))}H&&Number.isFinite(W)&&W+FRAME_RATE_RANGE_TOLERANCE<MIN_RECORDING_FRAME_RATE&&(U=H,U!==d&&(j=!0)),j?(o.value=U,d=U,o.dispatchEvent(new Event("input",{bubbles:!0}))):o.value=d;const Y=B[0];if(!d&&Y?o.placeholder=Y:o.placeholder&&(o.placeholder=""),H&&(o.min=H),x?o.setAttribute("max",x):o.removeAttribute("max"),l){let le="";if(x){const be=l.getAttribute("data-range-template");le=be?be.replace("{max}",x):`Enter a recording frame rate from ${H} to ${x} fps.`}else le=l.getAttribute("data-default-message")||"";l.textContent=le,l.hidden=!le}}function populateFrameRateDropdown$1(e=""){const t=(r,n)=>r||(typeof document<"u"?document.getElementById(n):null),o=t(recordingFrameRateInput,"recordingFrameRate");if(!o&&typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"){cineCoreUiHelpers.whenElementAvailable("recordingFrameRate",()=>populateFrameRateDropdown$1(e));return}populateFrameRateDropdownFor({selected:e,recordingInput:o,optionsList:t(recordingFrameRateOptionsList,"recordingFrameRateOptions"),sensorSelect:t(sensorModeDropdown,"sensorMode"),resolutionSelect:t(recordingResolutionDropdown,"recordingResolution"),hintElement:t(recordingFrameRateHint,"recordingFrameRateHint")})}function populateSlowMotionFrameRateDropdown$1(e=""){const t=(r,n)=>r||(typeof document<"u"?document.getElementById(n):null),o=t(slowMotionRecordingFrameRateInput,"slowMotionRecordingFrameRate");if(!o&&typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"){cineCoreUiHelpers.whenElementAvailable("slowMotionRecordingFrameRate",()=>populateSlowMotionFrameRateDropdown$1(e));return}populateFrameRateDropdownFor({selected:e,recordingInput:o,optionsList:t(slowMotionRecordingFrameRateOptionsList,"slowMotionRecordingFrameRateOptions"),sensorSelect:t(slowMotionSensorModeDropdown,"slowMotionSensorMode"),resolutionSelect:t(slowMotionRecordingResolutionDropdown,"slowMotionRecordingResolution"),aspectSelect:t(slowMotionAspectRatioSelect,"slowMotionAspectRatio"),hintElement:t(slowMotionRecordingFrameRateHint,"slowMotionRecordingFrameRateHint")})}function populateSlowMotionRecordingResolutionDropdown$1(e=""){populateCameraPropertyDropdown("slowMotionRecordingResolution","resolutions",e)}typeof window<"u"&&(window.populateSlowMotionRecordingResolutionDropdown=populateSlowMotionRecordingResolutionDropdown$1);function populateSlowMotionSensorModeDropdown$1(e=""){populateCameraPropertyDropdown("slowMotionSensorMode","sensorModes",e)}typeof window<"u"&&(window.populateSlowMotionSensorModeDropdown=populateSlowMotionSensorModeDropdown$1);function populateSensorModeDropdown$1(e=""){populateCameraPropertyDropdown("sensorMode","sensorModes",e)}typeof window<"u"&&(window.populateSensorModeDropdown=populateSensorModeDropdown$1);function populateCodecDropdown(e=""){populateCameraPropertyDropdown("codec","recordingCodecs",e)}function populateFilterDropdown(){const e=o=>{const r=typeof window<"u"&&window.devices||{};if(o&&r&&Array.isArray(r.filterOptions)){const n=document.createDocumentFragment();if(!o.multiple){const a=document.createElement("option");a.value="",n.appendChild(a)}for(let a=0;a<r.filterOptions.length;a+=1){const s=r.filterOptions[a],l=document.createElement("option");l.value=s,l.textContent=s,n.appendChild(l)}o.innerHTML="",o.appendChild(n)}},t=resolveFilterSelectElement();t?e(t):typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"&&cineCoreUiHelpers.whenElementAvailable("filter",o=>{typeof filterSelectElem<"u"&&(!filterSelectElem||typeof filterSelectElem!="object")&&(filterSelectElem=o),e(o)})}const filterId$1=e=>e.replace(/[^a-z0-9]/gi,"_");function getFilterValueConfig(e){switch(e){case"IRND":return{opts:["0.3","0.6","0.9","1.2","1.5","1.8","2.1","2.5"],defaults:["0.3","1.2"]};case"Diopter":return{opts:["+1/4","+1/2","+1","+2","+3","+4"],defaults:["+1/2","+1","+2","+4"]};case"ND Grad HE":return{opts:["0.3 HE Vertical","0.6 HE Vertical","0.9 HE Vertical","1.2 HE Vertical","0.3 HE Horizontal","0.6 HE Horizontal","0.9 HE Horizontal","1.2 HE Horizontal"],defaults:["0.3 HE Horizontal","0.6 HE Horizontal","0.9 HE Horizontal"]};case"ND Grad SE":return{opts:["0.3 SE Vertical","0.6 SE Vertical","0.9 SE Vertical","1.2 SE Vertical","0.3 SE Horizontal","0.6 SE Horizontal","0.9 SE Horizontal","1.2 SE Horizontal"],defaults:["0.3 SE Horizontal","0.6 SE Horizontal","0.9 SE Horizontal"]};default:return{opts:["1","1/2","1/4","1/8","1/16"],defaults:["1/2","1/4","1/8"]}}}const SESSION_DEFAULT_FILTER_SIZE=ensureSessionRuntimePlaceholder("DEFAULT_FILTER_SIZE",()=>"4x5.65");function createFilterSizeSelect(e,t=SESSION_DEFAULT_FILTER_SIZE,o={}){const{includeId:r=!0,idPrefix:n="filter-size-"}=o,a=document.createElement("select");r&&(a.id=`${n}${filterId$1(e)}`);let s=[SESSION_DEFAULT_FILTER_SIZE,"4x4","6x6","95mm"];return e==="Rota-Pol"&&(s=[SESSION_DEFAULT_FILTER_SIZE,"6x6","95mm"]),s.forEach(l=>{const u=document.createElement("option");u.value=l,u.textContent=l,l===t&&(u.selected=!0),a.appendChild(u)}),a}function resolveFilterDisplayInfo(e,t=SESSION_DEFAULT_FILTER_SIZE){switch(e){case"Diopter":return{label:"Schneider CF DIOPTER FULL GEN2",gearName:"Schneider CF DIOPTER FULL GEN2"};case"Clear":return{label:"Clear Filter",gearName:"Clear Filter"};case"IRND":return{label:"IRND Filter Set",gearName:"IRND Filter Set",hideDetails:!1};case"Pol":return{label:"Pol Filter",gearName:"Pol Filter"};case"Rota-Pol":return t==="6x6"?{label:"ARRI Rota Pola Filter Frame (6x6)",gearName:"ARRI Rota Pola Filter Frame (6x6)"}:t==="95mm"?{label:"Tilta 95mm Polarizer Filter for Tilta Mirage",gearName:"Tilta 95mm Polarizer Filter for Tilta Mirage"}:{label:"ARRI Rota Pola Filter Frame",gearName:"ARRI Rota Pola Filter Frame"};case"ND Grad HE":return{label:"ND Grad HE Filter Set",gearName:"ND Grad HE Filter Set",hideDetails:!1};case"ND Grad SE":return{label:"ND Grad SE Filter Set",gearName:"ND Grad SE Filter Set",hideDetails:!1};default:return{label:`${e} Filter Set`,gearName:`${e} Filter Set`,hideDetails:!0}}}function buildFilterGearEntries$1(e=[]){const t=[];return e.forEach(({type:o,size:r=SESSION_DEFAULT_FILTER_SIZE,values:n})=>{if(!o)return;const a=r||SESSION_DEFAULT_FILTER_SIZE,s=`filter-${filterId$1(o)}`;switch(o){case"Diopter":{t.push({id:`${s}-frame`,gearName:"ARRI Diopter Frame 138mm",label:"ARRI Diopter Frame 138mm",type:"",size:"",values:[]});const l=n==null?(getFilterValueConfig(o).defaults||[]).slice():Array.isArray(n)?n.slice():[];t.push({id:`${s}-set`,gearName:"Schneider CF DIOPTER FULL GEN2",label:"Schneider CF DIOPTER FULL GEN2",type:o,size:"",values:l});break}case"Clear":{const{label:l,gearName:u}=resolveFilterDisplayInfo(o,a);t.push({id:s,gearName:u,label:l,type:o,size:a,values:[]});break}case"Pol":{const{label:l,gearName:u}=resolveFilterDisplayInfo(o,a);t.push({id:s,gearName:u,label:l,type:o,size:a,values:[]});break}case"Rota-Pol":{const{label:l,gearName:u}=resolveFilterDisplayInfo(o,a),d=l.includes(a)?"":a;t.push({id:s,gearName:u,label:l,type:o,size:d,values:[]});break}case"ND Grad HE":case"ND Grad SE":{const{label:l,gearName:u,hideDetails:d}=resolveFilterDisplayInfo(o,a),m=n==null?(getFilterValueConfig(o).defaults||[]).slice():Array.isArray(n)?n.slice():[];t.push({id:s,gearName:u,label:l,hideDetails:d,type:o,size:a,values:m});break}default:{const{label:l,gearName:u,hideDetails:d}=resolveFilterDisplayInfo(o,a),m=n==null?(getFilterValueConfig(o).defaults||[]).slice():Array.isArray(n)?n.slice():[];t.push({id:s,gearName:u,label:l,hideDetails:d,type:o,size:a,values:m})}}}),t}typeof window<"u"&&(window.buildFilterGearEntries=buildFilterGearEntries$1);function updateGearListFilterEntries(e=[]){if(!gearListOutput$1)return;const t=new Map(e.map(o=>[o.id,o]));gearListOutput$1.querySelectorAll("[data-filter-entry]").forEach(o=>{const r=o.getAttribute("data-filter-entry");if(!r)return;const n=t.get(r);if(!n)return;const a=typeof n?.label=="string"?n.label:"";o.textContent=a?`1x ${a}`:"",o.setAttribute("data-gear-name",n.gearName),o.setAttribute("data-filter-label",n.label),n.type?o.setAttribute("data-filter-type",n.type):o.removeAttribute("data-filter-type")})}function getGearListFilterDetailsContainer(){return gearListOutput$1?gearListOutput$1.querySelector("#gearListFilterDetails"):null}function filterTypeNeedsValueSelect(e){return e==="Diopter"||e==="IRND"||e==="ND Grad HE"||e==="ND Grad SE"||e!=="Clear"&&e!=="Pol"&&e!=="Rota-Pol"}function createFilterStorageValueSelect(e,t){const o=document.createElement("select");o.id=`filter-values-${filterId$1(e)}`,o.multiple=!0,o.setAttribute("multiple",""),o.hidden=!0,o.setAttribute("aria-hidden","true");const{opts:r,defaults:n=[]}=getFilterValueConfig(e),a=Array.isArray(t)?t.slice():n.slice();return r.forEach(s=>{const l=document.createElement("option");l.value=s,l.textContent=s,a.includes(s)&&(l.selected=!0,l.setAttribute("selected","")),o.appendChild(l)}),o}function resolveFilterDetailsStorageElement(){if(typeof filterDetailsStorage<"u"&&filterDetailsStorage)return filterDetailsStorage;if(typeof document>"u")return null;const e=document.getElementById("filterDetails");if(!e)return null;try{typeof globalThis<"u"&&globalThis?globalThis.filterDetailsStorage=e:typeof window<"u"&&window&&(window.filterDetailsStorage=e)}catch{}return e}function renderFilterDetailsStorage(e){const t=resolveFilterDetailsStorageElement();if(t){if(t.innerHTML="",!e.length){t.hidden=!0;return}t.hidden=!0,e.forEach(o=>{const{type:r,size:n,values:a,needsSize:s,needsValues:l}=o;if(s){const u=createFilterSizeSelect(r,n);u.hidden=!0,u.setAttribute("aria-hidden","true"),u.addEventListener("change",handleFilterDetailChange),t.appendChild(u)}if(l){const u=createFilterStorageValueSelect(r,a);u.addEventListener("change",handleFilterDetailChange),t.appendChild(u)}})}}function resolveGlobalScope(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null}function ensureFilterDetailEditButton(e){if(!e)return null;const t=e.querySelector(".gear-item-edit-btn");if(t)return t;const o=e.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;const r=resolveGlobalScope();let n="Edit item";const a=r&&typeof r.getGearItemEditTexts=="function"?r.getGearItemEditTexts:null;if(a)try{const y=a.call(r)||{};if(y.editButtonLabel&&typeof y.editButtonLabel=="string"){const h=y.editButtonLabel.trim();h&&(n=h)}}catch{}const s=o.createElement("button");s.type="button",s.className="gear-item-edit-btn",s.setAttribute("data-gear-edit",""),n&&(s.setAttribute("aria-label",n),s.setAttribute("title",n));const l=r&&typeof r.setButtonLabelWithIcon=="function"?r.setButtonLabelWithIcon:null,u=r&&r.ICON_GLYPHS?r.ICON_GLYPHS:null,d=u&&(u.sliders||u.gears||u.gearList||u.settingsGeneral||u.note)||null;l&&d?l.call(r,s,"",d):n&&(s.textContent=n);const m=e.querySelector(".gear-item-note");return m&&m.parentNode===e?e.insertBefore(s,m.nextSibling):e.appendChild(s),s}function renderGearListFilterDetails(e){const t=getGearListFilterDetailsContainer();if(t){if(t.innerHTML="",!e.length){t.classList.add("hidden");return}t.classList.remove("hidden"),e.forEach(o=>{const{type:r,label:n,gearName:a,entryId:s,size:l,values:u,needsSize:d,needsValues:m}=o,y=document.createElement("div");y.className="filter-detail",a&&y.setAttribute("data-gear-name",a),r&&y.setAttribute("data-filter-type",r);const h=document.createElement("div");h.className="filter-detail-label gear-item",s&&h.setAttribute("data-filter-entry",s),a&&h.setAttribute("data-gear-name",a),n&&(h.setAttribute("data-filter-label",n),h.setAttribute("data-gear-label",n)),r&&h.setAttribute("data-filter-type",r),!!d?h.setAttribute("data-filter-hide-size",""):h.removeAttribute("data-filter-hide-size"),h.textContent=n?`1x ${n}`:"",y.appendChild(h),typeof enhanceGearItemElement=="function"&&enhanceGearItemElement(h),ensureFilterDetailEditButton(h);const v=document.createElement("div");if(v.className="filter-detail-controls",d){const C=document.createElement("label");C.className="filter-detail-size";const A=document.createElement("span");A.className="filter-detail-sublabel",A.textContent="Size";const w=document.createElement("span");w.className="select-wrapper";const R=createFilterSizeSelect(r,l,{includeId:!1});R.setAttribute("data-storage-id",`filter-size-${filterId$1(r)}`),R.addEventListener("change",()=>{const _=R.getAttribute("data-storage-id");_&&syncGearListFilterSize$1(_,R.value)}),w.appendChild(R),C.append(A,w),v.appendChild(C)}if(m){const C=document.createElement("div");C.className="filter-detail-values";const A=document.createElement("span");A.className="filter-detail-sublabel",A.textContent="Strengths";const w=document.createElement("span");w.className="filter-values-container",w.setAttribute("data-storage-values",`filter-values-${filterId$1(r)}`);const R=w.getAttribute("data-storage-values"),{opts:_,defaults:G=[]}=getFilterValueConfig(r),O=`filterValues-${filterId$1(r)}`,B=u==null?G:Array.isArray(u)?u:[];_.forEach($=>{const V=document.createElement("label");V.className="filter-value-option";const M=document.createElement("input");M.type="checkbox",M.name=O,M.value=$,B.includes($)&&(M.checked=!0,M.setAttribute("checked","")),M.addEventListener("change",()=>{R&&syncGearListFilterValue$1(R,$,M.checked)}),V.append(M,document.createTextNode($)),w.appendChild(V)}),C.append(A,w),v.appendChild(C)}y.appendChild(v),t.appendChild(y)}),adjustGearListSelectWidths(t)}}function syncGearListFilterSize$1(e,t){const o=document.getElementById(e);o&&(o.value!==t&&(o.value=t),typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty(),o.dispatchEvent(new Event("change")))}function syncGearListFilterValue$1(e,t,o){const r=document.getElementById(e);if(!r)return;let n=!1;Array.from(r.options).forEach(a=>{a.value===t&&a.selected!==o&&(a.selected=o,n=!0,o?a.setAttribute("selected",""):a.removeAttribute("selected"))}),n&&typeof markProjectFormDataDirty=="function"&&markProjectFormDataDirty()}function renderFilterDetails$1(e){const t=resolveFilterSelectElement();if(!t)return;const o=Array.from(t.selectedOptions).map(u=>u.value).filter(Boolean);let r;if(Array.isArray(e))r=e.filter(u=>u&&u.type).map(u=>({type:u.type,size:u.size,values:u.values===void 0?void 0:Array.isArray(u.values)?u.values.slice():u.values}));else{const u=collectFilterSelections$1();if(u)r=parseFilterTokens$1(u);else{const d=typeof currentProjectInfo$1<"u"?currentProjectInfo$1:{};d&&d.filter?r=parseFilterTokens$1(d.filter):r=[]}}const n=new Map(r.map(u=>[u.type,u])),a=o.map(u=>{const d=n.get(u)||{},m=d.size||SESSION_DEFAULT_FILTER_SIZE,y=u!=="Diopter",h=filterTypeNeedsValueSelect(u),{label:b,gearName:v,hideDetails:C}=resolveFilterDisplayInfo(u,m);let A=`filter - ${filterId$1(u)} `;return u==="Diopter"&&(A=`${A} -set`),{type:u,label:b,gearName:v,entryId:A,size:m,values:Array.isArray(d.values)?d.values.slice():[],needsSize:y,needsValues:h,hideDetails:C}});renderFilterDetailsStorage(a),renderGearListFilterDetails(a);let s=buildFilterGearEntries$1(r);s.length||(s=a.map(u=>({id:u.entryId,gearName:u.gearName,label:u.label,type:u.type,hideDetails:u.hideDetails})).filter(u=>u.id&&u.label)),updateGearListFilterEntries(s);const l=typeof matteboxSelect<"u"?matteboxSelect:typeof document<"u"?document.getElementById("mattebox"):null;l&&o.some(d=>d==="ND Grad HE"||d==="ND Grad SE")&&(l.value="Swing Away")}typeof window<"u"&&(window.renderFilterDetails=renderFilterDetails$1);function handleFilterDetailChange(){if(!resolveFilterSelectElement())return;const e=collectFilterSelections$1(),t=buildFilterGearEntries$1(parseFilterTokens$1(e));updateGearListFilterEntries(t),gearListOutput$1&&adjustGearListSelectWidths(gearListOutput$1),saveCurrentSession$1(),saveCurrentGearList$1(),checkSetupChanged$1(),renderFilterDetails$1()}function collectFilterSelections$1(){const e=resolveFilterSelectElement();if(!e)return"";const t=Array.from(e.selectedOptions).map(m=>typeof m.value=="string"?m.value.trim():"").filter(Boolean),o=typeof currentProjectInfo$1<"u"?currentProjectInfo$1:{},r=o&&typeof o.filter=="string"?o.filter:"",n=r?parseFilterTokens$1(r):[],a=Object.fromEntries(n.map(m=>[m.type,m])),s={};r&&r.split(",").forEach(m=>{const y=typeof m=="string"?m.trim():"";if(!y)return;const h=y.split(":")[0]?.trim();h&&(s[h]=y)});const l=t.map(m=>{const y=document.getElementById(`filter - size - ${filterId$1(m)} `),h=document.getElementById(`filter - values - ${filterId$1(m)} `),b=a[m]||{},v=y?y.value:b.size||SESSION_DEFAULT_FILTER_SIZE;let C;const A=filterTypeNeedsValueSelect(m);h?C=Array.from(h.selectedOptions).map(R=>R.value):Array.isArray(b.values)&&b.values.length?C=b.values.slice():C=[];let w="";return A&&(w=C.length?`:${C.join("|")} `:":!"),`${m}:${v}${w} `}),u=new Set(Array.from(e.options).map(m=>typeof m.value=="string"?m.value.trim():"").filter(Boolean)),d=new Set(t);return n.forEach(m=>{if(!m||!m.type||d.has(m.type)||u.has(m.type))return;const y=s[m.type]||(()=>{const h=m.size||SESSION_DEFAULT_FILTER_SIZE,b=Array.isArray(m.values)?m.values.filter(Boolean):[];let v="";return filterTypeNeedsValueSelect(m.type)&&(v=b.length?`:${b.join("|")} `:":!"),`${m.type}:${h}${v} `})();l.push(y)}),l.join(",")}function parseFilterTokens$1(e){return e?e.split(",").map(t=>{const o=t.split(":").map(l=>l.trim()),r=o[0],n=o[1]||SESSION_DEFAULT_FILTER_SIZE,a=o.length>2?o[2]:void 0;let s;return a===void 0?s=void 0:a===""||a==="!"?s=[]:s=a.split("|").map(l=>l.trim()).filter(Boolean),{type:r,size:n,values:s}}).filter(t=>t.type):[]}function applyFilterSelectionsToGearList$1(e){if(!gearListOutput$1)return;resolveFilterSelectElement();const t=e&&e.filter?parseFilterTokens$1(e.filter):[],o=buildFilterGearEntries$1(t);updateGearListFilterEntries(o),adjustGearListSelectWidths(gearListOutput$1)}typeof window<"u"&&(window.applyFilterSelectionsToGearList=applyFilterSelectionsToGearList$1);function buildFilterSelectHtml$1(){return'<div id="gearListFilterDetails" class="hidden" aria-live="polite"></div>'}typeof window<"u"&&(window.buildFilterSelectHtml=buildFilterSelectHtml$1);function collectFilterAccessories$1(e=[]){const t=[];return e.forEach(({type:o})=>{}),t}typeof window<"u"&&(window.collectFilterAccessories=collectFilterAccessories$1);const USER_BUTTON_FUNCTION_ITEMS=[{key:"toggleLut",value:"Toggle LUT"},{key:"falseColor",value:"False Color"},{key:"peaking",value:"Peaking"},{key:"anamorphicDesqueeze",value:"Anamorphic Desqueeze"},{key:"surroundView",value:"Surround View"},{key:"oneToOneZoom",value:"1:1 Zoom"},{key:"waveform",value:"Waveform"},{key:"histogram",value:"Histogram"},{key:"vectorscope",value:"Vectorscope"},{key:"zebra",value:"Zebra"},{key:"playback",value:"Playback"},{key:"record",value:"Record"},{key:"zoom",value:"Zoom"},{key:"frameLines",value:"Frame Lines"},{key:"frameGrab",value:"Frame Grab"},{key:"wb",value:"WB"},{key:"iso",value:"ISO"},{key:"nd",value:"ND"},{key:"fps",value:"FPS"},{key:"shutter",value:"Shutter"}];function populateUserButtonDropdowns$1(){const e=typeof currentLang=="string"&&texts[currentLang]?currentLang:"en",t=texts?.en?.projectForm||{},r=(texts?.[e]?.projectForm||t).userButtonFunctions||{},n=t.userButtonFunctions||{},a=USER_BUTTON_FUNCTION_ITEMS.map(l=>{const u=r[l.key]||n[l.key]||l.value;return{...l,label:u}}),s=new Set(a.map(l=>l.value));["monitorUserButtons","cameraUserButtons","viewfinderUserButtons"].forEach(l=>{const u=d=>{if(!d)return;const m=new Set(Array.from(d.selectedOptions||[]).map(b=>b.value)),y=document.createDocumentFragment();for(let b=0;b<a.length;b+=1){const{value:v,label:C}=a[b];if(!v)continue;const A=document.createElement("option");A.value=v,A.textContent=C,m.has(v)&&(A.selected=!0),y.appendChild(A)}m.forEach(b=>{if(s.has(b))return;const v=document.createElement("option");v.value=b,v.textContent=b,v.selected=!0,y.appendChild(v)}),d.innerHTML="",d.appendChild(y);const h=d.options?d.options.length:0;d.size=h>0?h:USER_BUTTON_FUNCTION_ITEMS.length};typeof cineCoreUiHelpers<"u"&&typeof cineCoreUiHelpers.whenElementAvailable=="function"?cineCoreUiHelpers.whenElementAvailable(l,u):u(document.getElementById(l))})}const runInitAppWithInitialLoadingIndicator=()=>{ensureInitialLoadingIndicatorVisible();try{initApp()}finally{finalizeInitialLoadingIndicator()}};ensureInitialLoadingIndicatorVisible();typeof document<"u"&&typeof document.addEventListener=="function"?document.readyState==="loading"?document.addEventListener("DOMContentLoaded",runInitAppWithInitialLoadingIndicator):runInitAppWithInitialLoadingIndicator():finalizeInitialLoadingIndicator();const cineCoreSession={APP_VERSION:typeof ACTIVE_APP_VERSION$1=="string"?ACTIVE_APP_VERSION$1:typeof APP_VERSION<"u"?APP_VERSION:"unknown",closeSideMenu,openSideMenu,setupSideMenu,setupResponsiveControls,setLanguage:applySetLanguage,applySetLanguage,safeGetCurrentProjectName,updateCalculations:function(...e){if(typeof globalThis<"u"&&typeof globalThis.updateCalculations=="function")return globalThis.updateCalculations(...e)},setBatteryPlates:setBatteryPlates$1,getBatteryPlates,setRecordingMedia:setRecordingMedia$1,getRecordingMedia:getRecordingMedia$1,applyDarkMode:applyDarkMode$1,applyPinkMode:applyPinkMode$1,applyHighContrast:applyHighContrast$1,generatePrintableOverview:generatePrintableOverview$1,generateGearListHtml:generateGearListHtml$1,ensureZoomRemoteSetup:ensureZoomRemoteSetup$1,encodeSharedSetup:encodeSharedSetup$1,decodeSharedSetup:decodeSharedSetup$1,applySharedSetupFromUrl:applySharedSetupFromUrl$1,applySharedSetup:applySharedSetup$1,updateBatteryPlateVisibility:_safeUpdateBatteryPlateVisibility,updateBatteryOptions:_safeUpdateBatteryOptions,cameraFizPort,controllerCamPort,controllerDistancePort,detectBrand:detectBrand$1,connectionLabel,generateConnectorSummary:generateConnectorSummary$1,exportDiagramSvg:exportDiagramSvg$1,fixPowerInput:fixPowerInput$2,ensureList:ensureList$2,normalizeVideoType:normalizeVideoType$2,normalizeFizConnectorType:normalizeFizConnectorType$2,normalizeViewfinderType:normalizeViewfinderType$2,normalizePowerPortType:normalizePowerPortType$1,setSelectValue:setSelectValue$1,autoSaveCurrentSetup:_safeAutoSaveCurrentSetup,saveCurrentSession:_safeSaveCurrentSession,saveCurrentGearList:function(...e){if(typeof globalThis<"u"&&typeof globalThis.saveCurrentGearList=="function")return globalThis.saveCurrentGearList(...e)},crewRoles:typeof globalThis<"u"&&Array.isArray(globalThis.crewRoles)?globalThis.crewRoles:[],setSliderBowlValue:function(...e){if(typeof globalThis<"u"&&typeof globalThis.setSliderBowlValue=="function")return globalThis.setSliderBowlValue(...e)},setEasyrigValue:function(...e){if(typeof globalThis<"u"&&typeof globalThis.setEasyrigValue=="function")return globalThis.setEasyrigValue(...e)},restoreSessionState,scenarioIcons:scenarioIcons$1,renderFilterDetails:renderFilterDetails$1,collectFilterSelections:collectFilterSelections$1,parseFilterTokens:parseFilterTokens$1,applyFilterSelectionsToGearList:applyFilterSelectionsToGearList$1,createSettingsBackup:createSettingsBackup$1,buildSettingsBackupPackage:buildSettingsBackupPackage$1,captureStorageSnapshot,sanitizeBackupPayload,extractBackupSections,runFeatureSearch,computeSetupDiff,__versionCompareInternals:{formatDiffPath,formatDiffListIndex,createKeyedDiffPathSegment,parseKeyedDiffPathSegment,findArrayComparisonKey},__featureSearchInternals:{featureMap,actionMap,deviceMap,helpMap,featureSearchEntries,featureSearchDefaultOptions,featureSearchInput:featureSearch$1,featureSearchDropdownElement:typeof globalThis<"u"&&globalThis.featureSearchDropdown?globalThis.featureSearchDropdown:null},__customFontInternals:{addFromData:(e,t,o)=>addCustomFontFromData(e,t,o),getEntries:()=>Array.from(customFontEntries.values())},__sharedImportInternals:{getLastSharedSetupData:()=>lastSharedSetupData,setLastSharedSetupDataForTest:e=>{lastSharedSetupData=e},getLastSharedAutoGearRules:()=>lastSharedAutoGearRules,setLastSharedAutoGearRulesForTest:e=>{lastSharedAutoGearRules=e},isProjectPresetActive:()=>sharedImportProjectPresetActive,setProjectPresetActiveForTest:e=>{sharedImportProjectPresetActive=!!e},getPreviousPresetId:()=>sharedImportPreviousPresetId,setPreviousPresetIdForTest:e=>{sharedImportPreviousPresetId=typeof e=="string"?e:""},isPromptActive:()=>sharedImportPromptActive,setPromptActiveForTest:e=>{sharedImportPromptActive=!!e},getPendingSharedLinkListener:()=>pendingSharedLinkListener,setPendingSharedLinkListenerForTest:e=>{pendingSharedLinkListener=typeof e=="function"?e:null}},__mountVoltageInternals:{getSessionMountVoltagePreferencesClone,applySessionMountVoltagePreferences,cloneMountVoltageDefaultsForSession},resetPlannerStateAfterFactoryReset:resetPlannerStateAfterFactoryReset$1,__autoGearInternals:{buildVideoDistributionAutoRules:typeof window<"u"&&window.buildVideoDistributionAutoRules||void 0},populateFilterDropdown,populateFrameRateDropdownFor,populateSlowMotionFrameRateDropdown:populateSlowMotionFrameRateDropdown$1,populateSensorModeDropdown:populateSensorModeDropdown$1,populateCodecDropdown,populateRecordingResolutionDropdown:populateRecordingResolutionDropdown$1};typeof window<"u"&&(window.cineCoreSession=cineCoreSession,["saveCurrentSession","autoSaveCurrentSetup","createSettingsBackup","handleRestoreRehearsalProceed","handleRestoreRehearsalAbort","downloadSharedProject","encodeSharedSetup","decodeSharedSetup","applySharedSetup","applySharedSetupFromUrl","renderFilterDetails","populateFilterDropdown","populateFrameRateDropdownFor","populateSlowMotionFrameRateDropdown","populateSensorModeDropdown","populateCodecDropdown","populateRecordingResolutionDropdown"].forEach(t=>{cineCoreSession[t]&&(window[t]=cineCoreSession[t])}),cineCoreSession.__autoGearInternals&&(window.__autoGearInternals=cineCoreSession.__autoGearInternals));console.log("app-session.js: Execution complete (ESM)");const cineAppSession={saveCurrentSession:saveCurrentSession$1,autoSaveCurrentSetup:autoSaveCurrentSetup$1,saveCurrentGearList:saveCurrentGearList$1,restoreSessionState,collectFullBackupData,createSettingsBackup:createSettingsBackup$1,captureStorageSnapshot,sanitizeBackupPayload,encodeSharedSetup:encodeSharedSetup$1,decodeSharedSetup:decodeSharedSetup$1,applySharedSetup:applySharedSetup$1,applySharedSetupFromUrl:applySharedSetupFromUrl$1,downloadSharedProject:downloadSharedProject$1,saveProject,handleRestoreRehearsalProceed,handleRestoreRehearsalAbort,proceed:handleRestoreRehearsalProceed,abort:handleRestoreRehearsalAbort,downloadProject:downloadSharedProject$1};typeof window<"u"&&(window.cineAppSession=cineAppSession,window.handleRestoreRehearsalProceed||(window.handleRestoreRehearsalProceed=handleRestoreRehearsalProceed),window.handleRestoreRehearsalAbort||(window.handleRestoreRehearsalAbort=handleRestoreRehearsalAbort),window.downloadSharedProject||(window.downloadSharedProject=downloadSharedProject$1));(function e(t){if(!t||typeof document>"u")return;var o="backupNotificationContainer",r="cineGlobalLoadingIndicator",n="cine-notification-stack",a="cine-notification",s="cine-notification--loading",l="cine-notification__spinner",u="global-loading-indicator-text";if(t.__cineLoadingNotice&&t.__cineLoadingNotice.indicator)return;var d={preparing:"Preparing planner…",modules:"Loading planner interface…",data:"Loading planner data…",almost:"Almost ready…"},m={},y="preparing",h=null,b=null,v=null;function C(){v!==null&&(typeof clearTimeout=="function"&&clearTimeout(v),v=null)}function A(){t.__cineLoadingNotice&&typeof t.__cineLoadingNotice=="object"&&(t.__cineLoadingNotice.container=h,t.__cineLoadingNotice.indicator=b)}function w(){C(),b&&b.parentNode&&b.parentNode.removeChild(b),b=null,h&&(h.children&&h.children.length===0&&h.parentNode&&h.parentNode.removeChild(h),h.children&&h.children.length===0&&(h=null)),A()}function R(){if(v===null){if(typeof setTimeout!="function"){w();return}v=setTimeout(function(){v=null,!(b&&b.dataset&&b.dataset.preventBootstrapHide==="true")&&w()},600)}}function _(W){var U=typeof W=="string"?W.trim():"";if(!U)return"";if(m&&typeof m=="object"){var j=m[U];if(typeof j=="string"&&j.trim())return j.trim()}var Y=d[U];return typeof Y=="string"&&Y.trim()?Y.trim():""}function G(){if(h&&h.parentNode)return h;C();var W=document.getElementById(o);h=W||document.createElement("div"),h.id=o,h.classList?h.classList.add(n):h.className=[h.className||"",n].join(" ").trim(),h.setAttribute("role","presentation"),h.dataset.bootstrap="true";var U=document.body||document.documentElement;return U&&h.parentNode!==U&&U.appendChild(h),A(),h}function O(){if(b&&b.parentNode)return b;C(),h=G();var W=document.getElementById(r);b=W||document.createElement("div"),b.id=r,b.classList?b.classList.add(a,s):b.className=[b.className||"",a,s].join(" ").trim(),b.setAttribute("role","status"),b.setAttribute("aria-live","polite"),b.setAttribute("aria-busy","true"),b.dataset.bootstrap="true";var U=b.querySelector("."+l);U||(U=document.createElement("span"),U.className=l,U.setAttribute("aria-hidden","true"),b.insertBefore(U,b.firstChild));var j=b.querySelector("."+u);return j||(j=document.createElement("span"),j.className=u,b.appendChild(j)),h&&b.parentNode!==h&&h.appendChild(b),A(),b}function B(){var W=b?b.querySelector("."+u):null;if(W){var U=_(y);!U&&y!=="preparing"&&(U=_("preparing")),U||(U="Loading…"),W.textContent=U,b.dataset.messageMode="key",b.dataset.messageKey=y,b.dataset.fallbackMessage=U,b.dataset.currentMessage=U}}function $(W){b&&(W?b.setAttribute("aria-busy","true"):b.setAttribute("aria-busy","false"))}function V(W){var U=typeof W=="string"&&W.trim()?W.trim():"preparing";y=U,O(),B()}function M(W){m=W&&typeof W=="object"?W:{},B()}function F(){if(h){var W=h.parentNode;!W||W===document.body||document.body&&document.body.appendChild(h)}}h=G(),b=O(),V(y),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F,{once:!0}):F();function z(W){if(W){var U=W.detail||{},j=Number(U.total),Y=Number(U.index),le="modules";Number.isFinite(j)&&j>0&&Number.isFinite(Y)&&(Y+1>=j?le="almost":Y>0&&(le="data")),V(le)}}function x(){if(V("almost"),$(!1),R(),typeof setTimeout=="function")try{setTimeout(function(){b&&b.dataset&&b.dataset.bootstrap==="true"&&w()},800)}catch{}}document.addEventListener("cine-loader-progress",z);function H(W,U){!W||typeof W.addEventListener!="function"||typeof U!="function"||W.addEventListener("cine-loader-complete",U,!1)}H(document,x),t.__cineLoadingNotice={container:h,indicator:b,ensureContainer:G,ensureIndicator:O,setMessageKey:V,applyLocalization:M,setBusy:$,refresh:B,getCurrentKey:function(){return y},getFallbackMessages:function(){var W={};for(var U in d)Object.prototype.hasOwnProperty.call(d,U)&&(W[U]=d[U]);return W}}})(typeof window<"u"?window:void 0);const OVERLAY_ID$1="cineGlobalOperationOverlay",OVERLAY_TEXT_ID="cineGlobalOperationText",SPINNER_CLASS="cine-notification__spinner";let overlayElement=null,textElement=null;function ensureOverlay$1(){if(!(overlayElement&&document.contains(overlayElement))){if(overlayElement=document.getElementById(OVERLAY_ID$1),overlayElement||(overlayElement=document.createElement("div"),overlayElement.id=OVERLAY_ID$1,overlayElement.className="cine-notification cine-notification--loading cine-notification--overlay",Object.assign(overlayElement.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"10000",backgroundColor:"var(--bg-surface, #222)",color:"var(--text-primary, #fff)",padding:"1rem 2rem",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",display:"flex",alignItems:"center",gap:"1rem",minWidth:"200px",justifyContent:"center",pointerEvents:"none"})),!textElement||!overlayElement.contains(textElement)){overlayElement.innerHTML="";const e=document.createElement("span");if(e.className=SPINNER_CLASS,!document.querySelector("style#cine-spinner-style")){const t=document.createElement("style");t.id="cine-spinner-style",t.textContent=`
            .@keyframes cine-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            .${SPINNER_CLASS} {
                display: inline-block;
                width: 1rem;
                height: 1rem;
                border: 2px solid currentColor;
                border-right-color: transparent;
                border-radius: 50%;
                animation: cine-spin 0.75s linear infinite;
            }
            .cine-notification--overlay {
                transition: opacity 0.2s ease-in-out;
            }
        `,document.head.appendChild(t)}overlayElement.appendChild(e),textElement=document.createElement("span"),textElement.id=OVERLAY_TEXT_ID,overlayElement.appendChild(textElement)}overlayElement.parentNode||document.body.appendChild(overlayElement)}}function showLoading(e="Loading..."){typeof document>"u"||(ensureOverlay$1(),textElement&&(textElement.textContent=e),overlayElement&&(overlayElement.style.opacity="1",overlayElement.hidden=!1))}function hideLoading(){typeof document>"u"||overlayElement&&(overlayElement.style.opacity="0",setTimeout(()=>{overlayElement&&(overlayElement.hidden=!0)},300))}typeof window<"u"&&(window.cineUiFeedback={showLoading,hideLoading});(function(){function e(){try{const t=document.querySelectorAll("dialog[open], .app-modal[open]");console.log(`Found ${t.length} open dialog(s) on page load`),t.forEach((o,r)=>{console.log(`Closing dialog ${r}:`,o.id||o.className),typeof o.close=="function"&&o.open?o.close():o.removeAttribute("open")})}catch(t){console.warn("Failed to close stuck dialogs:",t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e(),setTimeout(e,500)})();const getScope=()=>typeof window<"u"?window:globalThis;function clearDynamicFields$1(){const e=document.getElementById("dynamicFields");e&&(e.innerHTML="",e.hidden=!0)}function placeWattField$1(e,t){const o=document.getElementById("wattField");o&&(o.style.display="")}function buildDynamicFields$1(e,t={},o=[]){const r=document.getElementById("dynamicFields");if(!r)return;const a=getScope().getSchemaAttributesForCategory;if(typeof a!="function"){console.warn("getSchemaAttributesForCategory not found, skipping dynamic fields.");return}const l=(a(e)||[]).filter(u=>!(o.includes(u)||["powerDrawWatts","name","category","subcategory","notes"].includes(u)||["power","video","recordingMedia","lensMount","fizConnectors"].includes(u)));if(l.length===0){r.hidden=!0;return}r.hidden=!1,l.forEach(u=>{const d=document.createElement("div");d.className="form-row";const m=document.createElement("label");m.htmlFor=`dynamic_${u}`,m.textContent=formatLabel(u);let y;u.startsWith("is")||u.startsWith("has")?(y=document.createElement("input"),y.type="checkbox",y.id=`dynamic_${u}`,y.checked=!!t[u]):u.includes("Count")||u.includes("Amount")||u==="capacity"||u==="pinA"||u==="dtapA"?(y=document.createElement("input"),y.type="number",y.id=`dynamic_${u}`,y.step="any",y.value=t[u]!==void 0?t[u]:""):(y=document.createElement("input"),y.type="text",y.id=`dynamic_${u}`,y.value=t[u]||""),y.dataset.dynamicAttr=u,d.appendChild(m),d.appendChild(y),r.appendChild(d)})}function formatLabel(e){return e.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())}const globalScope=getScope();globalScope&&(globalScope.clearDynamicFields=clearDynamicFields$1,globalScope.placeWattField=placeWattField$1,globalScope.buildDynamicFields=buildDynamicFields$1);function resolvePrimaryGlobalScope(){return typeof globalThis<"u"&&globalThis?globalThis:typeof window<"u"&&window?window:typeof self<"u"&&self?self:typeof global<"u"&&global?global:null}function collectCandidateScopes$1(e){const t=[];try{typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&t.push(CORE_GLOBAL_SCOPE)}catch{}try{typeof CORE_PART1_RUNTIME_SCOPE<"u"&&CORE_PART1_RUNTIME_SCOPE&&t.push(CORE_PART1_RUNTIME_SCOPE)}catch{}try{typeof CORE_PART2_RUNTIME_SCOPE<"u"&&CORE_PART2_RUNTIME_SCOPE&&t.push(CORE_PART2_RUNTIME_SCOPE)}catch{}return e&&t.push(e),typeof window<"u"&&window&&window!==e&&t.push(window),typeof self<"u"&&self&&self!==e&&t.push(self),typeof global<"u"&&global&&global!==e&&t.push(global),t}function resolveCoreUiHelpers(e,t){const o=[];e&&e.helpers&&typeof e.helpers=="object"&&o.push(e.helpers);for(let r=0;r<t.length;r+=1){const n=t[r];if(n)try{const a=n.cineCoreRuntimeUiBridge;a&&a!==e&&typeof a=="object"&&a.helpers&&typeof a.helpers=="object"&&o.push(a.helpers)}catch{}}for(let r=0;r<t.length;r+=1){const n=t[r];if(n)try{const a=n.cineCoreUiHelpers;a&&typeof a=="object"&&o.push(a)}catch{}}for(let r=0;r<o.length;r+=1){const n=o[r];if(n&&typeof n=="object")return n}return{}}const primaryScope=resolvePrimaryGlobalScope();let bridge=null;primaryScope&&typeof primaryScope.cineCoreRuntimeUiBridge=="object"&&primaryScope.cineCoreRuntimeUiBridge&&(bridge=primaryScope.cineCoreRuntimeUiBridge);!bridge&&typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE&&typeof CORE_GLOBAL_SCOPE.cineCoreRuntimeUiBridge=="object"&&(bridge=CORE_GLOBAL_SCOPE.cineCoreRuntimeUiBridge);bridge||(bridge={});const scopes=collectCandidateScopes$1(primaryScope),helpers=resolveCoreUiHelpers(bridge,scopes);function escapeHtmlFallback(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function escapeButtonLabelSafelyFallback(e){return typeof e!="string"||e===""?"":(typeof bridge.escapeHtml=="function"?bridge.escapeHtml:typeof helpers.escapeHtml=="function"?helpers.escapeHtml:escapeHtmlFallback)(e)}function resolveButtonIconMarkupFallback(){return""}function setButtonLabelWithIconFallback(e,t,o){if(!e)return;let r=o;if(typeof r>"u")try{typeof ICON_GLYPHS=="object"&&ICON_GLYPHS&&ICON_GLYPHS.save&&(r=ICON_GLYPHS.save)}catch{}const n=(typeof bridge.resolveButtonIconMarkup=="function"?bridge.resolveButtonIconMarkup:typeof helpers.resolveButtonIconMarkup=="function"?helpers.resolveButtonIconMarkup:resolveButtonIconMarkupFallback)(r),s=(typeof bridge.escapeButtonLabelSafely=="function"?bridge.escapeButtonLabelSafely:typeof helpers.escapeButtonLabelSafely=="function"?helpers.escapeButtonLabelSafely:escapeButtonLabelSafelyFallback)(typeof t=="string"?t:"");try{e.innerHTML=`${n}${s}`}catch{}}const escapeHtml$1=typeof bridge.escapeHtml=="function"?bridge.escapeHtml:typeof helpers.escapeHtml=="function"?helpers.escapeHtml:escapeHtmlFallback,escapeButtonLabelSafely=typeof bridge.escapeButtonLabelSafely=="function"?bridge.escapeButtonLabelSafely:typeof helpers.escapeButtonLabelSafely=="function"?helpers.escapeButtonLabelSafely:function e(t){return escapeButtonLabelSafelyFallback(t)},resolveButtonIconMarkup=typeof bridge.resolveButtonIconMarkup=="function"?bridge.resolveButtonIconMarkup:typeof helpers.resolveButtonIconMarkup=="function"?helpers.resolveButtonIconMarkup:resolveButtonIconMarkupFallback,setButtonLabelWithIcon=typeof bridge.setButtonLabelWithIcon=="function"?bridge.setButtonLabelWithIcon:typeof helpers.setButtonLabelWithIcon=="function"?helpers.setButtonLabelWithIcon:function e(t,o,r){setButtonLabelWithIconFallback(t,o,r)},whenElementAvailable=typeof bridge.whenElementAvailable=="function"?bridge.whenElementAvailable:typeof helpers.whenElementAvailable=="function"?helpers.whenElementAvailable:function e(t,o,r){return typeof helpers.whenElementAvailable=="function"?helpers.whenElementAvailable(t,o,r):!1};bridge.helpers=helpers;bridge.escapeHtml=escapeHtml$1;bridge.escapeButtonLabelSafely=escapeButtonLabelSafely;bridge.resolveButtonIconMarkup=resolveButtonIconMarkup;bridge.setButtonLabelWithIcon=setButtonLabelWithIcon;bridge.whenElementAvailable=whenElementAvailable;bridge.resolveCoreUiHelpers=function e(){return resolveCoreUiHelpers(bridge,scopes)};if(primaryScope)try{primaryScope.cineCoreRuntimeUiBridge=bridge}catch{}if(typeof CORE_GLOBAL_SCOPE<"u"&&CORE_GLOBAL_SCOPE)try{CORE_GLOBAL_SCOPE.cineCoreRuntimeUiBridge=bridge}catch{}const CONTACT_AVATAR_MAX_BYTES=300*1024,CONTACT_AVATAR_MAX_SOURCE_BYTES=6*1024*1024,CONTACT_AVATAR_MAX_DIMENSION$1=256,CONTACT_AVATAR_JPEG_QUALITY=.85,CONTACT_AVATAR_JPEG_MIN_QUALITY=.55,DEFAULT_PROFILE_STATE=Object.freeze({name:"",role:"",avatar:"",phone:"",email:""});function normalizeState(e){return{name:typeof e?.name=="string"?e.name:"",role:typeof e?.role=="string"?e.role:"",avatar:typeof e?.avatar=="string"?e.avatar:"",phone:typeof e?.phone=="string"?e.phone:"",email:typeof e?.email=="string"?e.email:""}}function createProfileController(e={}){const{loadProfile:t=()=>null,saveProfile:o=()=>{},announce:r=()=>{},getText:n=()=>"",dispatchChange:a=()=>{},now:s=()=>Date.now(),schedule:l=(M,F)=>typeof setTimeout=="function"?setTimeout(M,F):M(),throttleMs:u=400}=e;let d=normalizeState(t()||DEFAULT_PROFILE_STATE),m=!1,y=!1,h=null,b=null;const v=new Set;function C(){return{name:d.name.trim(),role:d.role.trim(),avatar:d.avatar||"",phone:d.phone.trim(),email:d.email.trim()}}function A(){const M=C();v.forEach(F=>{try{F(M)}catch{}});try{a(M)}catch{}return M}function w(M={}){return d=normalizeState({...d,...M}),A()}function R(M={}){const{announce:F=!1}=M,z=()=>{b=null;const U=C();try{o(U)}catch(j){console.warn("Failed to save user profile via contacts/profile module",j)}if(m=!1,A(),F){const j=n("userProfileSaved","Profile saved.");j&&r(j),y=!1}},x=typeof h=="number"?h:null,H=x===null?u:s()-x;if(x===null||H>=u){h=s(),z();return}const W=Math.max(0,u-H);b&&clearTimeout(b),b=l(()=>{h=s(),z()},W)}function _(M,F){if(!M)return!1;const z=typeof F=="string"?F:"";return(typeof d[M]=="string"?d[M]:"").trim()===z.trim()?!1:(w({[M]:z}),m=!0,y=!0,R(),!0)}function G(){if(!m&&y){const M=n("userProfileSaved","Profile saved.");M&&r(M),y=!1}}function O(M){return d=normalizeState(M||t()||DEFAULT_PROFILE_STATE),m=!1,y=!1,A(),C()}function B(M,F={}){const{announce:z=!1}=F;w({avatar:typeof M=="string"?M:""}),m=!1,y=y||z,R({announce:z})}function $(M={}){return d.avatar?(B("",M),!0):!1}function V(M){return typeof M!="function"?()=>{}:(v.add(M),()=>v.delete(M))}return{assignUserProfileState:w,getUserProfileSnapshot:C,handleFieldInput:_,handleFieldBlur:G,load:O,setAvatar:B,clearAvatar:$,onChange:V,schedulePersist:R,markDirty:M=>{m=!!M},setPendingAnnouncement:M=>{y=!!M}}}function estimateDataUrlSize(e){if(typeof e!="string"||!e)return 0;const t="base64,",o=e.indexOf(t);if(o===-1)return e.length;const r=e.slice(o+t.length).trim();if(!r)return 0;const n=r.endsWith("==")?2:r.endsWith("=")?1:0;return Math.max(0,Math.floor(r.length/4)*3-n)}function createCanvas(e,t){if(typeof document>"u")return null;const o=document.createElement("canvas");return o.width=e,o.height=t,o}function optimiseAvatarDataUrl(e,t,o,r){if(!e||typeof document>"u"){typeof r=="function"&&r();return}try{const n=new Image,a=()=>{n.onload=null,n.onerror=null,typeof r=="function"&&r()};n.onload=()=>{n.onload=null,n.onerror=null;try{const s=n.naturalWidth||n.width||0,l=n.naturalHeight||n.height||0;if(!s||!l){a();return}const u=Math.min(1,CONTACT_AVATAR_MAX_DIMENSION$1/Math.max(s,l)),d=Math.max(1,Math.round(s*u)),m=Math.max(1,Math.round(l*u)),y=createCanvas(d,m);if(!y){a();return}const h=y.getContext("2d");if(!h){a();return}h.clearRect(0,0,d,m),h.drawImage(n,0,0,d,m);const v=typeof t=="string"&&/image\/(png|gif|webp)/i.test(t)?["image/png","image/jpeg"]:["image/jpeg","image/png"],C=A=>{const w=estimateDataUrlSize(A);return w&&w<=CONTACT_AVATAR_MAX_BYTES?(typeof o=="function"&&o(A),!0):!1};for(let A=0;A<v.length;A+=1){const w=v[A];if(w==="image/jpeg"){let R=CONTACT_AVATAR_JPEG_QUALITY;for(;R+1e-4>=CONTACT_AVATAR_JPEG_MIN_QUALITY;){const _=Math.max(CONTACT_AVATAR_JPEG_MIN_QUALITY,Math.min(.95,Number(R.toFixed(2)))),G=y.toDataURL("image/jpeg",_);if(C(G))return;if(_===CONTACT_AVATAR_JPEG_MIN_QUALITY)break;R-=.1}}else{const R=y.toDataURL(w);if(C(R))return}}a()}catch(s){a()}},n.onerror=a,n.decoding="async",n.src=e}catch{typeof r=="function"&&r()}}function readAvatarFile$1(e,t,o){if(!e)return;const r=CONTACT_AVATAR_MAX_SOURCE_BYTES;if(e.size>r){typeof o=="function"&&o("tooLarge");return}const n=new FileReader,a=s=>{typeof o=="function"&&o(s)};n.addEventListener("error",()=>a("readError")),n.addEventListener("load",()=>{const s=typeof n.result=="string"?n.result:"";if(!s){a("readError");return}const l=estimateDataUrlSize(s);if(l&&l<=CONTACT_AVATAR_MAX_BYTES){typeof t=="function"&&t(s);return}optimiseAvatarDataUrl(s,typeof e.type=="string"?e.type:"",u=>{if(u&&estimateDataUrlSize(u)<=CONTACT_AVATAR_MAX_BYTES){typeof t=="function"&&t(u);return}if(l&&l<=CONTACT_AVATAR_MAX_BYTES){typeof t=="function"&&t(s);return}a("tooLarge")},()=>{if(l&&l<=CONTACT_AVATAR_MAX_BYTES){typeof t=="function"&&t(s);return}a("readError")})});try{n.readAsDataURL(e)}catch{a("readError")}}function isSafeImageUrl(e){if(typeof e!="string")return!1;if(e.startsWith("data:")){const t=["image/png","image/jpeg","image/gif","image/webp"];try{const o=e.indexOf(";",5),r=o>=0?e.substring(5,o):"";if(t.includes(r))return!0}catch{}return!1}return/^\s*(javascript:|https?:|\/\/)/i.test(e)?!1:!!/^[a-zA-Z0-9._-]+$/.test(e)}const PROFILE_MODULE_EXPORT={CONTACT_AVATAR_MAX_BYTES,CONTACT_AVATAR_MAX_SOURCE_BYTES,CONTACT_AVATAR_MAX_DIMENSION:CONTACT_AVATAR_MAX_DIMENSION$1,CONTACT_AVATAR_JPEG_QUALITY,CONTACT_AVATAR_JPEG_MIN_QUALITY,DEFAULT_PROFILE_STATE,createProfileController,estimateDataUrlSize,optimiseAvatarDataUrl,readAvatarFile:readAvatarFile$1,isSafeImageUrl};assignProfileModuleExports(PROFILE_MODULE_EXPORT);function assignProfileModuleExports(e){if(!e||typeof e!="object")return;const t=resolveProfileGlobalScope();t&&(t.CINE_CONTACTS_PROFILE_MODULE=e,(typeof t.CONTACT_AVATAR_MAX_SOURCE_BYTES>"u"||t.CONTACT_AVATAR_MAX_SOURCE_BYTES===null)&&(t.CONTACT_AVATAR_MAX_SOURCE_BYTES=e.CONTACT_AVATAR_MAX_SOURCE_BYTES),typeof t.readAvatarFile!="function"&&(t.readAvatarFile=e.readAvatarFile))}function resolveProfileGlobalScope(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:null}const DEFAULT_CONTACT_FIELDS=Object.freeze(["id","name","role","phone","email","website","avatar","createdAt","updatedAt"]);function sanitizeContactValue$1(e){return typeof e!="string"?"":e.trim()}function createIdGenerator(){return()=>`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function normalizeContactEntry$1(e={},t={}){const o=typeof t.generateContactId=="function"?t.generateContactId:createIdGenerator(),r=sanitizeContactValue$1(e.id)||o(),n=sanitizeContactValue$1(e.name),a=sanitizeContactValue$1(e.role),s=sanitizeContactValue$1(e.phone),l=sanitizeContactValue$1(e.email),u=sanitizeContactValue$1(e.website),d=typeof e.avatar=="string"&&e.avatar.startsWith("data:")?e.avatar:"",m=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),y=Number.isFinite(e.updatedAt)?e.updatedAt:m;return{id:r,name:n,role:a,phone:s,email:l,website:u,avatar:d,createdAt:m,updatedAt:y}}function sortContacts$1(e=[]){return e.map(t=>normalizeContactEntry$1(t)).filter(Boolean).sort((t,o)=>{const r=(t?.name||"").toLowerCase(),n=(o?.name||"").toLowerCase();if(r&&n&&r!==n)try{return r.localeCompare(n)}catch{}return r&&!n?-1:!r&&n?1:(t?.createdAt||0)-(o?.createdAt||0)})}function parseVCard(e,t={}){const o=typeof t.sanitize=="function"?t.sanitize:sanitizeContactValue$1;if(typeof e!="string")return[];const r=e.replace(/\r\n?/g,`
`),n=[];r.split(`
`).forEach(l=>{/^[ \t]/.test(l)&&n.length?n[n.length-1]+=l.replace(/^[ \t]/,""):n.push(l)});const a=[];let s=null;return n.forEach(l=>{if(/^BEGIN:VCARD/i.test(l)){s={name:"",role:"",phone:"",email:"",website:"",avatar:""};return}if(/^END:VCARD/i.test(l)){s&&(s.name||s.email||s.phone||s.website)&&a.push({...s}),s=null;return}if(!s)return;const[u,...d]=l.split(":");if(!d.length)return;const m=u.split(";"),y=m[0]?.toUpperCase(),h=d.join(":").trim();if(y){if(y==="FN"){s.name=o(h);return}if(y==="N"&&!s.name){s.name=h.split(";").filter(Boolean).join(" ").trim();return}if(y==="TEL"){s.phone||(s.phone=o(h));return}if(y==="EMAIL"){s.email||(s.email=o(h));return}if(y==="URL"||/\.URL$/.test(y)){s.website||(s.website=o(h));return}if((y==="ROLE"||y==="TITLE")&&!s.role){s.role=o(h);return}if(y==="ORG"&&!s.role){s.role=o(h);return}if(y==="PHOTO"){let b=h;if(!b)return;if(/^data:/i.test(b)){s.avatar=b;return}const v=m.slice(1);let C="image/jpeg";v.forEach(A=>{const[w,R]=A.split("=");if(!R)return;const _=w.trim().toUpperCase(),G=R.trim();if(_==="MEDIATYPE")C=G;else if(_==="TYPE"){const O=G.toLowerCase();O.includes("/")?C=O:C=`image/${O}`}}),s.avatar=`data:${C};base64,${b}`}}}),a.map(l=>({name:o(l.name),role:o(l.role),phone:o(l.phone),email:o(l.email),website:o(l.website),avatar:typeof l.avatar=="string"&&l.avatar.startsWith("data:")?l.avatar:""})).filter(l=>l.name||l.email||l.phone||l.website)}function mergeImportedContacts(e={}){const{existing:t=[],imported:o=[],now:r=()=>Date.now(),generateContactId:n=createIdGenerator()}=e,a=t.map(u=>normalizeContactEntry$1(u,{generateContactId:n}));let s=0,l=0;return o.forEach(u=>{const d=normalizeContactEntry$1({...u,id:u.id||n(),createdAt:r(),updatedAt:r()},{generateContactId:n}),m=a.find(y=>{if(d.email&&y.email&&d.email.toLowerCase()===y.email.toLowerCase())return!0;if(d.phone&&y.phone){const h=d.phone.replace(/\D+/g,""),b=y.phone.replace(/\D+/g,"");if(h&&b&&h===b)return!0}return!!(d.name&&y.name&&d.name.toLowerCase()===y.name.toLowerCase()||d.website&&y.website&&d.website.toLowerCase()===y.website.toLowerCase())});m?(DEFAULT_CONTACT_FIELDS.forEach(y=>{d[y]&&(m[y]=d[y])}),m.updatedAt=r(),l+=1):(a.push(d),s+=1)}),{contacts:sortContacts$1(a),added:s,updated:l}}function createCrewRowSync(e={},t={}){const o={...e};return o.role=t.role||"",o.name=t.name||"",o.phone=t.phone||"",o.email=t.email||"",o.website=t.website||"",o.avatar=t.avatar||"",o.contactId=t.id||"",o}const CONTACT_LIST_MODULE_EXPORT={sanitizeContactValue:sanitizeContactValue$1,normalizeContactEntry:normalizeContactEntry$1,sortContacts:sortContacts$1,parseVCard,mergeImportedContacts,createCrewRowSync};assignContactsListExports(CONTACT_LIST_MODULE_EXPORT);function assignContactsListExports(e){if(!e||typeof e!="object")return;const t=resolveContactsGlobalScope();t&&(t.CINE_CONTACTS_LIST_MODULE=e)}function resolveContactsGlobalScope(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:null}function detectGlobalScope$2(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$5=detectGlobalScope$2(),missingAutoGearHelperLog=new Set;function logMissingAutoGearHelper(e,t){missingAutoGearHelperLog.has(e)||(missingAutoGearHelperLog.add(e),typeof console<"u"&&typeof console.warn=="function"&&(t?console.warn(`[cine] Missing auto gear helper: ${e}`,t):console.warn(`[cine] Missing auto gear helper: ${e}`)))}function resolveAutoGearUiExports(){if(!GLOBAL_SCOPE$5||typeof GLOBAL_SCOPE$5!="object"&&typeof GLOBAL_SCOPE$5!="function")return null;try{if(GLOBAL_SCOPE$5.cineCoreAutoGearUi&&typeof GLOBAL_SCOPE$5.cineCoreAutoGearUi=="object")return GLOBAL_SCOPE$5.cineCoreAutoGearUi}catch(e){logMissingAutoGearHelper("cineCoreAutoGearUi",e)}return null}function resolveAutoGearHelperFunction(e){if(typeof e!="string"||!e)return null;const t=resolveAutoGearUiExports();return t&&typeof t[e]=="function"?t[e]:GLOBAL_SCOPE$5&&typeof GLOBAL_SCOPE$5[e]=="function"?GLOBAL_SCOPE$5[e]:(logMissingAutoGearHelper(e),null)}function ensureFallbackAutoGearHelper(e,t){if(typeof e!="string"||!e||typeof t!="function")return!1;let o=!1;if(GLOBAL_SCOPE$5&&(typeof GLOBAL_SCOPE$5=="object"||typeof GLOBAL_SCOPE$5=="function")&&typeof(()=>{try{return GLOBAL_SCOPE$5[e]}catch{return}})()!="function")try{Object.defineProperty(GLOBAL_SCOPE$5,e,{configurable:!0,enumerable:!1,writable:!0,value:t}),o=!0}catch{try{GLOBAL_SCOPE$5[e]=t,o=!0}catch{}}const r=resolveAutoGearUiExports();if(r&&typeof r[e]!="function")try{r[e]=t,o=!0}catch{}return o}function fallbackNormalizeVideoDistributionOptionValue(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const o=t.toLowerCase();return o==="__none__"||o==="none"?"__none__":t}ensureFallbackAutoGearHelper("normalizeVideoDistributionOptionValue",fallbackNormalizeVideoDistributionOptionValue);function getFallbackViewfinderLabel(e){if(e==="__none__"){const t=typeof currentLang=="string"&&currentLang?currentLang:"en",o=typeof texts=="object"&&texts?texts[t]||texts.en||{}:{};return o.viewfinderExtensionNone||o.autoGearViewfinderExtensionNone||"No"}return typeof e=="string"?e:""}function getFallbackVideoDistributionLabel(e){if(e==="__none__"){const t=typeof currentLang=="string"&&currentLang?currentLang:"en";return(typeof texts=="object"&&texts?texts[t]||texts.en||{}:{}).autoGearVideoDistributionNone||"No video distribution selected"}return typeof e=="string"?e:""}function invokeAutoGearLabelHelper(e,t,o){const r=resolveAutoGearHelperFunction(e);if(typeof r=="function")try{const n=r.call(GLOBAL_SCOPE$5,o);return n??t(o)}catch(n){logMissingAutoGearHelper(e,n)}return t(o)}function getFallbackMatteboxLabel(e){if(e==="__none__"){const t=typeof currentLang=="string"&&currentLang?currentLang:"en";return(typeof texts=="object"&&texts?texts[t]||texts.en||{}:{}).autoGearMatteboxNone||"No mattebox selected"}return typeof e=="string"?e:""}function getSafeMatteboxFallbackLabel(e){return invokeAutoGearLabelHelper("getMatteboxFallbackLabel",getFallbackMatteboxLabel,e)}ensureFallbackAutoGearHelper("getMatteboxFallbackLabel",getFallbackMatteboxLabel);function fallbackNormalizeMatteboxOptionValue(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const o=t.toLowerCase();return o==="__none__"||o==="none"?"__none__":t}ensureFallbackAutoGearHelper("normalizeMatteboxOptionValue",fallbackNormalizeMatteboxOptionValue);function normalizeMatteboxOption(e){const t=resolveAutoGearHelperFunction("normalizeMatteboxOptionValue");if(typeof t=="function")try{return t.call(GLOBAL_SCOPE$5,e)}catch(o){logMissingAutoGearHelper("normalizeMatteboxOptionValue",o)}return fallbackNormalizeMatteboxOptionValue(e)}function normalizeVideoDistributionOption(e){const t=resolveAutoGearHelperFunction("normalizeVideoDistributionOptionValue");if(typeof t=="function")try{return t.call(GLOBAL_SCOPE$5,e)}catch(n){logMissingAutoGearHelper("normalizeVideoDistributionOptionValue",n)}if(typeof e!="string")return"";const o=e.trim();if(!o)return"";const r=o.toLowerCase();return r==="__none__"||r==="none"?"__none__":o}function getSafeViewfinderFallbackLabel(e){return invokeAutoGearLabelHelper("getViewfinderFallbackLabel",getFallbackViewfinderLabel,e)}function getSafeVideoDistributionFallbackLabel(e){return invokeAutoGearLabelHelper("getVideoDistributionFallbackLabel",getFallbackVideoDistributionLabel,e)}function createModuleBaseFallback(e){const t=e&&(typeof e=="object"||typeof e=="function")?e:detectGlobalScope$2(),o=t&&(typeof t=="object"||typeof t=="function")?t:null;if(!o)return null;let r=null;try{o&&typeof o.cineModuleBase=="object"&&(r=o.cineModuleBase)}catch{r=null}if(r)return r;const n=Object.create(null),a=Object.create(null),s=(b,v)=>{if(typeof b!="string"||!b)return;const C=a[b];if(!(!Array.isArray(C)||C.length===0)){a[b]=[];for(let A=0;A<C.length;A+=1){const w=C[A];if(typeof w=="function")try{w(v)}catch{}}}},l=(b,v)=>{typeof b!="string"||!b||(n[b]=v,s(b,v))},u=b=>typeof b!="string"||!b?null:Object.prototype.hasOwnProperty.call(n,b)?n[b]:null,d=(b,v)=>{if(typeof v!="function"||typeof b!="string"||!b)return!1;const C=u(b);if(C){try{v(C)}catch{}return!0}return Array.isArray(a[b])||(a[b]=[]),a[b].push(v),!0},m=()=>{let b=null;try{b=o.cineModuleGlobals}catch{b=null}(!b||typeof b!="object")&&(b={}),typeof b.getModule!="function"&&(b.getModule=v=>u(v)),typeof b.whenModuleAvailable!="function"&&(b.whenModuleAvailable=(v,C)=>d(v,C)),typeof b.register!="function"&&(b.register=(v,C)=>(l(v,C),!0));try{Object.defineProperty(o,"cineModuleGlobals",{configurable:!0,enumerable:!1,writable:!0,value:b})}catch{try{o.cineModuleGlobals=b}catch{}}return b},y=()=>{let b=null;try{b=o.cineModules}catch{b=null}(!b||typeof b!="object")&&(b={}),typeof b.get!="function"&&(b.get=v=>u(v)),typeof b.register!="function"&&(b.register=(v,C)=>(l(v,C),!0));try{Object.defineProperty(o,"cineModules",{configurable:!0,enumerable:!1,writable:!0,value:b})}catch{try{o.cineModules=b}catch{}}return b},h={freezeDeep(b){return b},safeWarn(b,v){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof v>"u"?console.warn(b):console.warn(b,v)}catch{}},informModuleGlobals(b,v){const C=m();if(C&&typeof C.register=="function")try{return C.register(b,v),!0}catch{}return l(b,v),!0},registerOrQueueModule(b,v){const C=y();if(C&&typeof C.register=="function")try{C.register(b,v)}catch{l(b,v)}else l(b,v);return m(),!0},exposeGlobal(b,v,C,A={}){const w=C&&(typeof C=="object"||typeof C=="function")?C:o;if(!w||typeof w!="object"&&typeof w!="function")return!1;const R={configurable:A.configurable!==!1,enumerable:!!A.enumerable,writable:A.writable===!0,value:v};try{return Object.defineProperty(w,b,R),!0}catch{try{return w[b]=v,!0}catch{}}return!1}};return h.registerOrQueueModule("cineModuleBase",h),h.exposeGlobal("cineModuleBase",h,o,{configurable:!0,enumerable:!1,writable:!1}),m(),y(),h}function moduleJsonDeepClone(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}function moduleResolveStructuredClone(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function moduleCreateResilientDeepClone(e){const t=moduleResolveStructuredClone(e);return t?function(r){if(r===null||typeof r!="object")return r;try{return t(r)}catch{}return moduleJsonDeepClone(r)}:moduleJsonDeepClone}const MODULE_DEEP_CLONE=GLOBAL_SCOPE$5&&typeof GLOBAL_SCOPE$5.__cineDeepClone=="function"?GLOBAL_SCOPE$5.__cineDeepClone:moduleCreateResilientDeepClone(GLOBAL_SCOPE$5);function resolveModuleBase$1(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const MODULE_BASE$1=resolveModuleBase$1(GLOBAL_SCOPE$5)||createModuleBaseFallback(GLOBAL_SCOPE$5),freezeDeep$1=typeof MODULE_BASE$1.freezeDeep=="function"?MODULE_BASE$1.freezeDeep:function e(t){if(!t||typeof t=="function"||typeof t!="object"&&typeof t!="function")return t;const o=new WeakSet;function r(n){if(!n||typeof n!="object"&&typeof n!="function"||o.has(n))return n;o.add(n);try{const a=Object.getOwnPropertyNames(n);for(let s=0;s<a.length;s+=1){const l=a[s];let u;try{u=n[l]}catch(d){u=void 0}!u||typeof u=="function"||typeof u!="object"&&typeof u!="function"||r(u)}Object.freeze(n)}catch{}return n}return r(t)},exposeGlobal$1=typeof MODULE_BASE$1.exposeGlobal=="function"?function e(t,o,r){return MODULE_BASE$1.exposeGlobal(t,o,GLOBAL_SCOPE$5,r||{})}:function e(t,o){try{return GLOBAL_SCOPE$5[t]=o,!0}catch{return!1}},moduleRegistry=typeof MODULE_BASE$1.getModuleRegistry=="function"?MODULE_BASE$1.getModuleRegistry(GLOBAL_SCOPE$5):null,registerOrQueueModule$1=typeof MODULE_BASE$1.registerOrQueueModule=="function"?function e(t,o,r,n){return MODULE_BASE$1.registerOrQueueModule(t,o,r,n,GLOBAL_SCOPE$5,moduleRegistry)}:function e(){return!1};let factoryAutoGearRulesSnapshot=null,factoryAutoGearSeedContext=null;function fallbackCollectCandidateScopes$1(e){const t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}return o(e),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),t}const candidateScopes=(function e(){if(MODULE_BASE$1&&typeof MODULE_BASE$1.collectCandidateScopes=="function")try{const t=MODULE_BASE$1.collectCandidateScopes(GLOBAL_SCOPE$5);if(Array.isArray(t)&&t.length)return t}catch{}return fallbackCollectCandidateScopes$1(GLOBAL_SCOPE$5)})(),structuredCloneCandidates=(function e(){const t=[];function o(r,n){if(typeof r!="function")return;t.some(s=>s&&s.fn===r)||t.push({fn:r,scope:n||null})}if(MODULE_BASE$1&&(typeof MODULE_BASE$1.structuredClone=="function"&&o(MODULE_BASE$1.structuredClone,MODULE_BASE$1),typeof MODULE_BASE$1.getStructuredClone=="function"))try{const r=MODULE_BASE$1.getStructuredClone();o(r,MODULE_BASE$1)}catch{}for(let r=0;r<candidateScopes.length;r+=1){const n=candidateScopes[r];if(!n||typeof n!="object"&&typeof n!="function")continue;const a=n.structuredClone;typeof a=="function"&&o(a,n)}return t})();let cachedStructuredCloneCandidate=null;function tryStructuredCloneValue(e){if(cachedStructuredCloneCandidate)try{const t=cachedStructuredCloneCandidate;return{success:!0,value:t.scope?t.fn.call(t.scope,e):t.fn(e)}}catch{cachedStructuredCloneCandidate=null}for(let t=0;t<structuredCloneCandidates.length;t+=1){const o=structuredCloneCandidates[t];if(!(!o||typeof o.fn!="function"))try{const r=o.scope?o.fn.call(o.scope,e):o.fn(e);return cachedStructuredCloneCandidate=o,{success:!0,value:r}}catch{}}return{success:!1,value:null}}function cloneWithStructuredCloneFallback(e){if(e===null||typeof e>"u")return e;const t=tryStructuredCloneValue(e);if(t.success)return t.value;if(MODULE_DEEP_CLONE)try{const o=MODULE_DEEP_CLONE(e);if(o!==e||e===null||typeof e!="object")return o}catch{}try{return moduleJsonDeepClone(e)}catch{}return Array.isArray(e)?e.slice():typeof e=="object"?{...e}:e}function cloneAutoGearItems(e){return e.map(t=>{const o=normalizeAutoGearItem(t);return o?{...o}:null}).filter(Boolean)}function cloneAutoGearRuleItem(e){return!e||typeof e!="object"?{id:"",name:"",category:"",quantity:0,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:"",contextNotes:[]}:{id:typeof e.id=="string"?e.id:"",name:typeof e.name=="string"?e.name:"",category:typeof e.category=="string"?e.category:"",quantity:normalizeAutoGearQuantity(e.quantity),screenSize:typeof e.screenSize=="string"?e.screenSize:"",selectorType:typeof e.selectorType=="string"?e.selectorType:"none",selectorDefault:typeof e.selectorDefault=="string"?e.selectorDefault:"",selectorEnabled:!!e.selectorEnabled,selectorContext:typeof e.selectorContext=="string"?e.selectorContext:"",notes:typeof e.notes=="string"?e.notes:"",contextNotes:Array.isArray(e.contextNotes)?e.contextNotes.filter(Boolean):[]}}function cloneAutoGearRule(e){return!e||typeof e!="object"?null:{id:typeof e.id=="string"?e.id:"",label:typeof e.label=="string"?e.label:"",always:!!e.always,scenarios:Array.isArray(e.scenarios)?e.scenarios.slice():[],mattebox:Array.isArray(e.mattebox)?e.mattebox.slice():[],cameraHandle:Array.isArray(e.cameraHandle)?e.cameraHandle.slice():[],viewfinderExtension:Array.isArray(e.viewfinderExtension)?e.viewfinderExtension.slice():[],videoDistribution:Array.isArray(e.videoDistribution)?e.videoDistribution.slice():[],camera:Array.isArray(e.camera)?e.camera.slice():[],monitor:Array.isArray(e.monitor)?e.monitor.slice():[],tripodHeadBrand:Array.isArray(e.tripodHeadBrand)?e.tripodHeadBrand.slice():[],tripodBowl:Array.isArray(e.tripodBowl)?e.tripodBowl.slice():[],tripodTypes:Array.isArray(e.tripodTypes)?e.tripodTypes.slice():[],tripodSpreader:Array.isArray(e.tripodSpreader)?e.tripodSpreader.slice():[],crewPresent:Array.isArray(e.crewPresent)?e.crewPresent.slice():[],crewAbsent:Array.isArray(e.crewAbsent)?e.crewAbsent.slice():[],wireless:Array.isArray(e.wireless)?e.wireless.slice():[],motors:Array.isArray(e.motors)?e.motors.slice():[],controllers:Array.isArray(e.controllers)?e.controllers.slice():[],distance:Array.isArray(e.distance)?e.distance.slice():[],shootingDays:normalizeAutoGearShootingDaysCondition(e.shootingDays),add:Array.isArray(e.add)?e.add.map(cloneAutoGearRuleItem):[],remove:Array.isArray(e.remove)?e.remove.map(cloneAutoGearRuleItem):[]}}function cloneAutoGearRules(e){return Array.isArray(e)?e.map(cloneAutoGearRule).filter(Boolean):[]}function setFactoryAutoGearRulesSnapshot(e){if(!Array.isArray(e)){factoryAutoGearRulesSnapshot=null;return}factoryAutoGearRulesSnapshot=cloneAutoGearRules(e)}function subtractScenarioContributions(e,t,o){const r=(n,a)=>n.map(s=>{let l=normalizeAutoGearQuantity(s.quantity);if(t.forEach(d=>{const m=o.get(d);if(!m)return;const y=m[a].find(h=>h.name===s.name&&h.category===s.category);y&&(l-=normalizeAutoGearQuantity(y.quantity))}),l=Math.max(l,0),l<=0)return null;const u=normalizeAutoGearItem(s);return u?{...u,quantity:l}:null}).filter(Boolean);return{add:r(e.add,"add"),remove:r(e.remove,"remove")}}function extractAutoGearSelections(e){return typeof e!="string"?[]:e.split(",").map(t=>t.trim()).filter(Boolean)}function buildCameraHandleAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=extractAutoGearSelections(e&&e.cameraHandle),r=new Set(o),n=[];if(typeof document<"u"){const l=document.getElementById("cameraHandle");l&&Array.from(l.options||[]).forEach(u=>{const d=typeof u.value=="string"?u.value.trim():"";d&&n.push(d)})}const a=Array.from(new Set(o.concat(n).map(l=>typeof l=="string"?l.trim():"").filter(Boolean)));if(!a.length)return[];const s=[];return a.forEach(l=>{const u=l.trim();if(!u)return;let d,m;if(r.has(u)){d=o.filter(A=>A!==u);const b={...e,cameraHandle:d.join(", ")},v=generateGearListHtml({...b,requiredScenarios:""}),C=parseGearTableForAutoRules(v);if(!C)return;m=diffGearTableMaps(C,t)}else{d=o.slice(),d.push(u);const b={...e,cameraHandle:d.join(", ")},v=generateGearListHtml({...b,requiredScenarios:""}),C=parseGearTableForAutoRules(v);if(!C)return;m=diffGearTableMaps(t,C)}if(!m||!m.add.length&&!m.remove.length)return;const y=Array.isArray(m.add)?cloneAutoGearItems(m.add):[],h=Array.isArray(m.remove)?cloneAutoGearItems(m.remove):[];!y.length&&!h.length||s.push({id:generateAutoGearId("rule"),label:u,scenarios:[],mattebox:[],cameraHandle:[u],viewfinderExtension:[],videoDistribution:[],add:y,remove:h})}),s}function buildViewfinderExtensionAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=extractAutoGearSelections(e&&e.viewfinderExtension);if(!o.length)return[];const r=Array.from(new Set(o)),n=[];return r.forEach(a=>{const s=a.trim();if(!s)return;const l=o.filter(v=>v!==s),u={...e,viewfinderExtension:l.join(", ")},d=generateGearListHtml({...u,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;const y=diffGearTableMaps(m,t);if(!y.add.length&&!y.remove.length)return;const h=cloneAutoGearItems(y.add);if(!h.length)return;const b=cloneAutoGearItems(y.remove);n.push({id:generateAutoGearId("rule"),label:getSafeViewfinderFallbackLabel(s),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[s],videoDistribution:[],add:h,remove:b})}),n}function buildBatteryAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=typeof batterySelect<"u"?batterySelect:document.getElementById("battery");if(!o||!o.options)return[];const r=[];if(Array.from(o.options).forEach(s=>{const l=typeof s.value=="string"?s.value.trim():"";l&&l!=="None"&&r.push(l)}),!r.length)return[];const n=e&&typeof e.battery=="string"?e.battery.trim():"",a=[];return r.forEach(s=>{let l,u;if(s===n){l={...e,battery:""};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(m,t)}else{l={...e,battery:s};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(t,m)}!u||!u.add.length&&!u.remove.length||a.push({id:generateAutoGearId("rule"),label:`Battery: ${s}`,scenarios:[],battery:[s],add:cloneAutoGearItems(u.add),remove:cloneAutoGearItems(u.remove)})}),a}function buildDistanceAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=typeof distanceSelect<"u"?distanceSelect:document.getElementById("distance");if(!o||!o.options)return[];const r=[];if(Array.from(o.options).forEach(s=>{const l=typeof s.value=="string"?s.value.trim():"";l&&l!=="None"&&r.push(l)}),!r.length)return[];const n=e&&typeof e.distance=="string"?e.distance.trim():"",a=[];return r.forEach(s=>{let l,u;if(s===n){l={...e,distance:""};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(m,t)}else{l={...e,distance:s};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(t,m)}!u||!u.add.length&&!u.remove.length||a.push({id:generateAutoGearId("rule"),label:`Distance: ${s}`,scenarios:[],distance:[s],add:cloneAutoGearItems(u.add),remove:cloneAutoGearItems(u.remove)})}),a}function buildHotswapAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=typeof hotswapSelect<"u"?hotswapSelect:document.getElementById("hotswap");if(!o||!o.options)return[];const r=[];if(Array.from(o.options).forEach(s=>{const l=typeof s.value=="string"?s.value.trim():"";l&&l!=="None"&&r.push(l)}),!r.length)return[];const n=e&&typeof e.hotswap=="string"?e.hotswap.trim():"",a=[];return r.forEach(s=>{let l,u;if(s===n){l={...e,hotswap:""};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(m,t)}else{l={...e,hotswap:s};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(t,m)}!u||!u.add.length&&!u.remove.length||a.push({id:generateAutoGearId("rule"),label:`Hotswap: ${s}`,scenarios:[],hotswap:[s],add:cloneAutoGearItems(u.add),remove:cloneAutoGearItems(u.remove)})}),a}function buildBatteryPlateAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=typeof batteryPlateSelect<"u"?batteryPlateSelect:document.getElementById("batteryPlate");if(!o||!o.options)return[];const r=[];if(Array.from(o.options).forEach(s=>{const l=typeof s.value=="string"?s.value.trim():"";l&&l!=="None"&&r.push(l)}),!r.length)return[];const n=e&&typeof e.batteryPlate=="string"?e.batteryPlate.trim():"",a=[];return r.forEach(s=>{let l,u;if(s===n){l={...e,batteryPlate:""};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(m,t)}else{l={...e,batteryPlate:s};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(t,m)}!u||!u.add.length&&!u.remove.length||a.push({id:generateAutoGearId("rule"),label:`Battery Plate: ${s}`,scenarios:[],batteryPlate:[s],add:cloneAutoGearItems(u.add),remove:cloneAutoGearItems(u.remove)})}),a}function buildCageAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=typeof cageSelect<"u"?cageSelect:document.getElementById("cage");if(!o||!o.options)return[];const r=[];if(Array.from(o.options).forEach(s=>{const l=typeof s.value=="string"?s.value.trim():"";l&&l!=="None"&&r.push(l)}),!r.length)return[];const n=e&&typeof e.cage=="string"?e.cage.trim():"",a=[];return r.forEach(s=>{let l,u;if(s===n){l={...e,cage:""};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(m,t)}else{l={...e,cage:s};const d=generateGearListHtml({...l,requiredScenarios:""}),m=parseGearTableForAutoRules(d);if(!m)return;u=diffGearTableMaps(t,m)}!u||!u.add.length&&!u.remove.length||a.push({id:generateAutoGearId("rule"),label:`Cage: ${s}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],cage:[s],add:cloneAutoGearItems(u.add),remove:cloneAutoGearItems(u.remove)})}),a}function buildTripodAutoGearRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=e&&typeof e.tripodHeadBrand=="string"?e.tripodHeadBrand.trim():"",r=e&&typeof e.tripodBowl=="string"?e.tripodBowl.trim():"",n=[];if(o&&r&&o!=="None"&&r!=="None"){const l={...e,tripodHeadBrand:"",tripodBowl:""},u=generateGearListHtml({...l,requiredScenarios:""}),d=parseGearTableForAutoRules(u);if(d){const m=diffGearTableMaps(d,t);(m.add.length||m.remove.length)&&n.push({id:generateAutoGearId("rule"),label:`Tripod Head: ${o} (${r})`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],tripodHeadBrand:[o],tripodBowl:[r],add:cloneAutoGearItems(m.add),remove:cloneAutoGearItems(m.remove)})}}const a=e&&typeof e.tripodSpreader=="string"?e.tripodSpreader.trim():"";if(a&&a!=="None"){const l={...e,tripodSpreader:""},u=generateGearListHtml({...l,requiredScenarios:""}),d=parseGearTableForAutoRules(u);if(d){const m=diffGearTableMaps(d,t);(m.add.length||m.remove.length)&&n.push({id:generateAutoGearId("rule"),label:`Tripod Spreader: ${a}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],tripodSpreader:[a],add:cloneAutoGearItems(m.add),remove:cloneAutoGearItems(m.remove)})}}const s=extractAutoGearSelections(e&&e.tripodTypes);return s.forEach(l=>{const u=s.filter(h=>h!==l),d={...e,tripodTypes:u.join(", ")},m=generateGearListHtml({...d,requiredScenarios:""}),y=parseGearTableForAutoRules(m);if(y){const h=diffGearTableMaps(y,t);(h.add.length||h.remove.length)&&n.push({id:generateAutoGearId("rule"),label:`Tripod Type: ${l}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],tripodTypes:[l],add:cloneAutoGearItems(h.add),remove:cloneAutoGearItems(h.remove)})}}),n}function buildTripodPreferenceAutoGearRules(e={}){const t=typeof e.tripodHeadBrand=="string"?e.tripodHeadBrand.trim():"",o=typeof e.tripodBowl=="string"?e.tripodBowl.trim():"";if(!t||!o)return[];const r=normalizeAutoGearTriggerValue(t),n=normalizeAutoGearTriggerValue(o);if(!r||!n)return[];const s=[{brand:"O'Connor",entries:[{bowl:"100mm bowl",item:"O'Connor Ultimate 1040 Fluid-Head 100mm bowl"},{bowl:"150mm bowl",item:"O'Connor Ultimate 2560 Fluid-Head 150mm bowl"},{bowl:"Mitchell Mount",item:"O'Connor Ultimate 2560 Fluid-Head Mitchell Mount"}]},{brand:"Sachtler",entries:[{bowl:"75mm bowl",item:"Sachtler aktiv8 head 75mm bowl"},{bowl:"100mm bowl",item:"Sachtler aktiv18T head 100mm bowl"},{bowl:"150mm bowl",item:"Sachtler Cine 30 head 150mm bowl"},{bowl:"Mitchell Mount",item:"Sachtler Cine 30 head Mitchell mount"}]}].find(u=>normalizeAutoGearTriggerValue(u.brand)===r);if(!s)return[];const l=s.entries.filter(u=>normalizeAutoGearTriggerValue(u.bowl)===n);return l.length?l.map(u=>{const d=u.item,m=["Tripod preferences"];return{id:generateAutoGearId("rule"),label:`Tripod head: ${d}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:[],tripodHeadBrand:[s.brand],tripodBowl:[u.bowl],tripodTypes:[],tripodSpreader:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],add:[{id:generateAutoGearId("item"),name:d,category:"Grip",quantity:1,screenSize:"",selectorType:"tripodHeadBrand",selectorDefault:d,selectorEnabled:!0,notes:"",contextNotes:m}],remove:[]}}):[]}function buildVideoDistributionAutoRules(e,t){if(!t||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const o=extractAutoGearSelections(e&&e.videoDistribution);if(!o.length)return[];const r=Array.from(new Set(o)),n=[];return r.forEach(a=>{const s=a.trim();if(!s)return;const l=s.toLowerCase();if(l==="__none__"||l==="none")return;const u=o.filter(C=>C!==s),d={...e,videoDistribution:u.join(", ")},m=generateGearListHtml({...d,requiredScenarios:""}),y=parseGearTableForAutoRules(m);if(!y)return;const h=diffGearTableMaps(y,t);if(!h.add.length&&!h.remove.length)return;const b=cloneAutoGearItems(h.add);if(!b.length)return;const v=cloneAutoGearItems(h.remove);n.push({id:generateAutoGearId("rule"),label:getSafeVideoDistributionFallbackLabel(s),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[s],add:b,remove:v})}),n}function buildOnboardMonitorRiggingAutoGearRules(){const e=typeof monitorSelect<"u"?monitorSelect:null;if(!e||!e.options)return[];const t=[],o=new Set;if(Array.from(e.options).forEach(a=>{if(!a)return;const s=typeof a.value=="string"?a.value.trim():"";if(!s||s==="None")return;const l=typeof a.textContent=="string"?a.textContent.trim():"";if(!l)return;const u=normalizeAutoGearTriggerValue(l);!u||o.has(u)||(o.add(u),t.push(l))}),!t.length)return[];const r=typeof texts=="object"&&texts&&(texts[currentLang]&&texts[currentLang].autoGearMonitorLabel||texts.en&&texts.en.autoGearMonitorLabel)||"Onboard monitors",n=r;return[{id:generateAutoGearId("rule"),label:r,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:t.slice(),crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],add:[{id:generateAutoGearId("item"),name:'ULCS Arm mit 3/8" und 1/4" double',category:"Rigging",quantity:1,contextNotes:[n]}],remove:[]}]}const ARRI_VIEWFINDER_BRACKET_NAME="ARRI K2.74000.0 VEB-3 Viewfinder Extension Bracket",ARRI_VIEWFINDER_BRACKET_CATEGORY="Camera Support";function createArriViewfinderBracketItem(e){if(typeof generateAutoGearId!="function")return null;const t=Array.isArray(e)?e.filter(o=>typeof o=="string"&&o.trim()):[];return{id:generateAutoGearId("item"),name:ARRI_VIEWFINDER_BRACKET_NAME,category:ARRI_VIEWFINDER_BRACKET_CATEGORY,quantity:1,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:"",contextNotes:t.map(o=>o.trim())}}function collectArriCameraNames(){const e=[],t=devices&&typeof devices=="object"?devices.cameras:null;return!t||typeof t!="object"||Object.keys(t).forEach(o=>{if(!o)return;const r=t[o],n=r&&typeof r.brand=="string"?r.brand:"";/arri/i.test(n||o)&&e.push(o)}),e}function createArriBracketRule(e){if(!e||typeof e!="object")return null;const t=createArriViewfinderBracketItem(e.contextNotes||[]);if(!t)return null;const o=Array.isArray(e.camera)?e.camera.filter(Boolean):[];return{id:generateAutoGearId("rule"),label:typeof e.label=="string"&&e.label.trim()?e.label.trim():"ARRI viewfinder extension support",scenarios:Array.isArray(e.scenarios)?e.scenarios.filter(Boolean):[],mattebox:[],cameraHandle:[],viewfinderExtension:Array.isArray(e.viewfinderExtension)?e.viewfinderExtension.filter(Boolean):[],deliveryResolution:[],videoDistribution:[],camera:o,monitor:[],tripodHeadBrand:[],tripodBowl:[],tripodTypes:[],tripodSpreader:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],shootingDays:null,add:[t],remove:[]}}function buildArriViewfinderBracketRules(e={}){const t=collectArriCameraNames();if(!t.length)return[];const o=e&&typeof e.viewfinderExtension=="string"?e.viewfinderExtension.trim():"",a=(e&&typeof e.requiredScenarios=="string"?e.requiredScenarios.split(",").map(l=>typeof l=="string"?l.trim():"").filter(Boolean):[]).map(l=>normalizeAutoGearTriggerValue(l)).filter(Boolean).includes(normalizeAutoGearTriggerValue("Slider")),s=[];if(o){const l=getSafeViewfinderFallbackLabel(o),u=createArriBracketRule({label:`${l||o} – ARRI viewfinder support`,viewfinderExtension:[o],camera:t.slice(),contextNotes:["ARRI viewfinder extension support"]});u&&s.push(u)}if(a&&!o){const l=createArriBracketRule({label:"Slider – ARRI viewfinder extension support",scenarios:["Slider"],camera:t.slice(),contextNotes:["Slider scenario"]});l&&s.push(l)}return s}function buildDefaultVideoDistributionRules(e={}){if(typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=document.getElementById("videoDistribution");if(!t)return[];const o=[],r=new Set;if(Array.from(t.options||[]).forEach(m=>{if(!m)return;const y=typeof m.value=="string"?m.value.trim():"",h=normalizeVideoDistributionOption(y);!h||h==="__none__"||r.has(h)||(r.add(h),o.push(y))}),!o.length)return[];const n={...e||{}};delete n.videoDistribution;const a=generateGearListHtml({...n,requiredScenarios:""}),s=parseGearTableForAutoRules(a);if(!s)return[];const l=[],u=new Set;if(o.forEach(m=>{const y=typeof m=="string"?m.trim():"";if(!y)return;const h=normalizeVideoDistributionOption(y);if(!h||u.has(h))return;u.add(h);const b={...e||{},videoDistribution:y},v=generateGearListHtml({...b,requiredScenarios:""}),C=parseGearTableForAutoRules(v);if(!C)return;const A=diffGearTableMaps(s,C),w=cloneAutoGearItems(A.add),R=cloneAutoGearItems(A.remove);!w.length&&!R.length||l.push({id:generateAutoGearId("rule"),label:getSafeVideoDistributionFallbackLabel(y),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[y],add:w,remove:R})}),o.some(m=>m&&m.toLowerCase()==="ios video")){const m=o.find(b=>b&&b.toLowerCase()==="ios video")||"IOS Video",y=normalizeAutoGearTriggerValue(m);if(!l.some(b=>Array.isArray(b.videoDistribution)&&b.videoDistribution.some(v=>normalizeAutoGearTriggerValue(v)===y))){const b=new Set,v=(R,_,G=1)=>{if(!R||!_||G<=0)return null;const O=`${R}|${_}`;return b.has(O)?null:(b.add(O),{id:generateAutoGearId("item"),name:R,category:_,quantity:G,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:""})},C=[],A=devices&&typeof devices=="object"?devices.iosVideo:null;if(A&&typeof A=="object"&&Object.keys(A).forEach(R=>{const _=v(R,"Monitoring");_&&C.push(_)}),!C.length){const R=v("Teradek - Link AX WifiRouter/Access Point","Monitoring");R&&C.push(R)}const w=(R,_,G=1)=>{const O=v(R,_,G);O&&C.push(O)};w("Apple iPad Air 5 or better","Monitoring",1),w("USB-C Charger (iOS Video)","Monitoring support",2),w("Wi-Fi Router (iOS Video Village)","Monitoring support"),C.length&&l.push({id:generateAutoGearId("rule"),label:getSafeVideoDistributionFallbackLabel(m),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[m],add:C,remove:[]})}}return l}function buildDefaultMatteboxAutoGearRules(){return[]}function buildMatteboxAutoGearRules(e={}){if(typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=document.getElementById("mattebox");if(!t)return[];const o=[],r=new Set;if(Array.from(t.options||[]).forEach(d=>{if(!d)return;const m=typeof d.value=="string"?d.value.trim():"",y=normalizeMatteboxOption(m);!y||y==="__none__"||r.has(y)||(r.add(y),o.push(m))}),!o.length)return[];const n={...e||{}};delete n.mattebox;const a=generateGearListHtml({...n,requiredScenarios:""}),s=parseGearTableForAutoRules(a);if(!s)return[];const l=[],u=new Set;return o.forEach(d=>{const m=typeof d=="string"?d.trim():"";if(!m)return;const y=normalizeMatteboxOption(m);if(!y||u.has(y))return;u.add(y);const h={...e||{},mattebox:m},b=generateGearListHtml({...h,requiredScenarios:""}),v=parseGearTableForAutoRules(b);if(!v)return;const C=diffGearTableMaps(s,v),A=cloneAutoGearItems(C.add),w=cloneAutoGearItems(C.remove);!A.length&&!w.length||l.push({id:generateAutoGearId("rule"),label:getSafeMatteboxFallbackLabel(m),scenarios:[],mattebox:[m],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],add:A,remove:w})}),l}function resolveHandUnitCompatibilityMaps(){let e=null,t=null;try{typeof AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS<"u"&&AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS&&typeof AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS=="object"&&(e=AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS)}catch{}!e&&GLOBAL_SCOPE$5&&typeof GLOBAL_SCOPE$5.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS=="object"&&(e=GLOBAL_SCOPE$5.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS);try{typeof AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP<"u"&&AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP&&typeof AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP=="object"&&(t=AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP)}catch{}return!t&&GLOBAL_SCOPE$5&&typeof GLOBAL_SCOPE$5.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP=="object"&&(t=GLOBAL_SCOPE$5.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP),{groups:e&&typeof e=="object"?e:null,motorMap:t&&typeof t=="object"?t:null}}function getHandUnitGroupForMotor(e){if(!e)return null;const t=resolveHandUnitCompatibilityMaps();if(!t.groups)return null;const o=normalizeAutoGearTriggerValue(e);if(!o)return null;let r=null;if(t.motorMap&&Object.prototype.hasOwnProperty.call(t.motorMap,o)?r=t.motorMap[o]:Object.prototype.hasOwnProperty.call(t.groups,o)&&(r=o),!r||!t.groups[r])return null;const n=t.groups[r];return!n||!Array.isArray(n.options)||!n.options.length?null:{key:r,group:n}}function collectAllWirelessTransmitterNames(){const e=[];if(!devices||typeof devices!="object")return e;const t=devices.video&&typeof devices.video=="object"?devices.video:null;return t&&Object.keys(t).forEach(o=>{!o||o==="None"||e.includes(o)||e.push(o)}),e}function buildMotorHandUnitAutoGearRules(e){if(!resolveHandUnitCompatibilityMaps().groups)return[];const o=typeof captureSetupSelectValues=="function"?captureSetupSelectValues():null,r=[];o&&Array.isArray(o.motors)&&r.push(...o.motors),e&&Array.isArray(e.motorSelections)&&r.push(...e.motorSelections),e&&Array.isArray(e.motors)&&r.push(...e.motors);const n=r.map(d=>typeof d=="string"?d.trim():"").filter(d=>d&&d!=="None").map(d=>({name:d,normalized:normalizeAutoGearTriggerValue(d)})).filter(d=>d.normalized);if(!n.length)return[];let a="";if(o&&typeof o.video=="string"&&(a=o.video.trim()),!a&&e&&typeof e.wirelessSelection=="string"&&(a=e.wirelessSelection.trim()),!a||a==="None")return[];const s=[],l=new Set;if(n.forEach(d=>{const m=getHandUnitGroupForMotor(d.normalized);if(!m||l.has(m.key))return;l.add(m.key);const y=m.group,h=Array.isArray(y.options)?y.options.filter(Boolean):[];if(!h.length)return;const b=typeof y.defaultOption=="string"&&y.defaultOption?y.defaultOption:h[0],v=[];y.label&&v.push(y.label),Array.isArray(y.motors)&&y.motors.length&&v.push(`Compatible motors: ${y.motors.join(", ")}`),s.push({id:generateAutoGearId("item"),name:b,category:"LDS (FIZ)",quantity:1,screenSize:"",selectorType:"fizHandUnit",selectorDefault:b,selectorEnabled:!0,selectorContext:m.key,notes:"",contextNotes:v})}),!s.length)return[];const u=collectAllWirelessTransmitterNames();return u.length||u.push(a),[{id:generateAutoGearId("rule"),label:"FIZ hand units",scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:[],wireless:u,motors:[AUTO_GEAR_ANY_MOTOR_TOKEN],controllers:[],distance:[],add:s,remove:[]}]}function buildAutoGearAnyMotorRule(){if(typeof captureSetupSelectValues!="function")return null;const e=captureSetupSelectValues();if(!(Array.isArray(e?.motors)?e.motors.filter(a=>typeof a=="string"&&a&&a!=="None"):[]).length)return null;const o=(a,s,l=1)=>!a||!s||l<=0?null:{id:generateAutoGearId("item"),name:a,category:s,quantity:l,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:""},r=[],n=(a,s,l=1)=>{const u=o(a,s,l);u&&r.push(u)};return n('Avenger C-Stand Sliding Leg 20" (Focus)',"Grip"),n("Steelfingers Wheel C-Stand 3er Set (Focus)","Grip"),n("Lite-Tite Swivel Aluminium Umbrella Adapter (Focus)","Grip"),n("Tennis ball","Grip",3),n("D-Tap to Mini XLR 3-pin Cable 0,3m (Focus)","Monitoring support",2),n("Ultraslim BNC Cable 0.3 m (Focus)","Monitoring support",2),n("Bebob V150micro (V-Mount) (Focus)","Monitoring Batteries",3),r.length?{id:generateAutoGearId("rule"),label:"FIZ motor support kit",scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],deliveryResolution:[],videoDistribution:[],camera:[],monitor:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[AUTO_GEAR_ANY_MOTOR_TOKEN],controllers:[],distance:[],add:r,remove:[]}:null}function buildAlwaysAutoGearRule(){const e=(r,n,a=1,s={})=>!r||!n||a<=0?null:{id:generateAutoGearId("item"),name:r,category:n,quantity:a,screenSize:typeof s.screenSize=="string"?s.screenSize:"",selectorType:typeof s.selectorType=="string"?s.selectorType:"none",selectorDefault:typeof s.selectorDefault=="string"?s.selectorDefault:"",selectorEnabled:s.selectorEnabled===!0,notes:typeof s.notes=="string"?s.notes:""},t=[],o=(r,n,a,s)=>{const l=e(r,n,a,s);l&&t.push(l)};return[["BNC Cable 0.5 m","Monitoring support",1],["BNC Cable 1 m","Monitoring support",1],["BNC Cable 5 m","Monitoring support",1],["BNC Cable 10 m","Monitoring support",1],["BNC Drum 25 m","Monitoring support",1],["BNC Connector","Monitoring support",4],['ULCS Bracket with 1/4" to 1/4"',"Rigging",2],['ULCS Bracket with 3/8" to 1/4"',"Rigging",2],["Noga Arm","Rigging",2],["Mini Magic Arm","Rigging",2],["Cine Quick Release","Rigging",4],["SmallRig - Super lightweight 15mm RailBlock","Rigging",1],['Spigot with male 3/8" and 1/4"',"Rigging",3],["Clapper Stick","Rigging",2],["D-Tap Splitter","Rigging",2],["Magliner Senior - with quick release mount + tripod holder + utility tray + O‘Connor-Aufhängung","Carts and Transportation",1],["Securing Straps (25mm wide)","Carts and Transportation",10],["Loading Ramp (pair, 420kg)","Carts and Transportation",1],["Ring Fitting for Airline Rails","Carts and Transportation",20],["Power Cable Drum 25-50 m","Power",1],["Power Cable 10 m","Power",2],["Power Cable 5 m","Power",2],["Power Strip","Power",3],["Power Three Way Splitter","Power",3],["PRCD-S (Portable Residual Current Device-Safety)","Power",3]].forEach(([r,n,a])=>o(r,n,a)),t.length?{id:generateAutoGearId("rule"),label:"Always",always:!0,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:[],wireless:[],motors:[],controllers:[],distance:[],add:t,remove:[]}:null}function buildFiveDayConsumablesAutoGearRule(){const e=(r,n,a=1,s={})=>!r||!n||a<=0?null:{id:generateAutoGearId("item"),name:r,category:n,quantity:a,screenSize:typeof s.screenSize=="string"?s.screenSize:"",selectorType:typeof s.selectorType=="string"?s.selectorType:"none",selectorDefault:typeof s.selectorDefault=="string"?s.selectorDefault:"",selectorEnabled:s.selectorEnabled===!0,notes:typeof s.notes=="string"?s.notes:""},t=[],o=(r,n,a,s)=>{const l=e(r,n,a,s);l&&t.push(l)};return o("Bluestar eye leather made of microfiber oval, large","Consumables",4),o("Pro Gaff Tape","Consumables",2,{notes:"Primary color roll"}),o("Pro Gaff Tape","Consumables",2,{notes:"Secondary color roll"}),o("Clapper Stick","Rigging",4),o("Kimtech Wipes","Consumables",2),o('Sprigs Red 1/4"',"Consumables",1),t.length?{id:generateAutoGearId("rule"),label:"Every 5 shooting days",scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],deliveryResolution:[],videoDistribution:[],camera:[],monitor:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],shootingDays:{mode:"every",value:5},add:t,remove:[]}:null}function ensureDefaultMatteboxAutoGearRules(){const e=buildDefaultMatteboxAutoGearRules();if(!e.length)return!1;const t=new Set(autoGearRules.map(autoGearRuleMatteboxKey).filter(Boolean)),o=e.filter(r=>{const n=autoGearRuleMatteboxKey(r);return!n||t.has(n)?!1:(t.add(n),!0)});return o.length?(setAutoGearRules(autoGearRules.concat(o)),!0):!1}function captureSetupSelectValues(){const e=o=>o.map(r=>r&&typeof r.value=="string"?r.value:""),t={camera:cameraSelect&&typeof cameraSelect.value=="string"?cameraSelect.value:"",monitor:monitorSelect&&typeof monitorSelect.value=="string"?monitorSelect.value:"",video:videoSelect&&typeof videoSelect.value=="string"?videoSelect.value:"",cage:cageSelect&&typeof cageSelect.value=="string"?cageSelect.value:"",distance:distanceSelect&&typeof distanceSelect.value=="string"?distanceSelect.value:"",battery:batterySelect&&typeof batterySelect.value=="string"?batterySelect.value:"",batteryPlate:batteryPlateSelect&&typeof batteryPlateSelect.value=="string"?batteryPlateSelect.value:"",hotswap:hotswapSelect&&typeof hotswapSelect.value=="string"?hotswapSelect.value:"",motors:e(motorSelects),controllers:e(controllerSelects),sliderBowl:typeof getSliderBowlValue=="function"?getSliderBowlValue():"",easyrig:typeof getEasyrigValue=="function"?getEasyrigValue():""};return finalizeCapturedSetupValues(t)}function finalizeCapturedSetupValues(e){return!e||typeof e!="object"||(e.batteryPlate=normalizeBatteryPlateValue(e.batteryPlate,e.battery)),e}function applySetupSelectValues(e){!e||typeof e!="object"||(cameraSelect&&(setSelectValue(cameraSelect,e.camera),typeof updateBatteryPlateVisibility=="function"&&updateBatteryPlateVisibility(),typeof updateBatteryOptions=="function"&&updateBatteryOptions()),batteryPlateSelect&&setSelectValue(batteryPlateSelect,e.batteryPlate),e&&typeof e.battery=="string"&&applyBatteryPlateSelectionFromBattery(e.battery,batteryPlateSelect?batteryPlateSelect.value:""),monitorSelect&&setSelectValue(monitorSelect,e.monitor),videoSelect&&setSelectValue(videoSelect,e.video),cageSelect&&setSelectValue(cageSelect,e.cage),distanceSelect&&setSelectValue(distanceSelect,e.distance),Array.isArray(e.motors)&&e.motors.forEach((t,o)=>{motorSelects[o]&&setSelectValue(motorSelects[o],t)}),Array.isArray(e.controllers)&&e.controllers.forEach((t,o)=>{controllerSelects[o]&&setSelectValue(controllerSelects[o],t)}),batterySelect&&setSelectValue(batterySelect,e.battery),hotswapSelect&&setSelectValue(hotswapSelect,e.hotswap),typeof setSliderBowlValue=="function"&&setSliderBowlValue(e.sliderBowl),typeof setEasyrigValue=="function"&&setEasyrigValue(e.easyrig))}function captureAutoGearSeedContext(){if(factoryAutoGearSeedContext||typeof collectProjectFormData!="function")return;const e=collectProjectFormData()||{};let t=cloneWithStructuredCloneFallback(e);(!t||typeof t!="object")&&(t={...e});const o=requiredScenariosSelect?Array.from(requiredScenariosSelect.options||[]).map(r=>r&&typeof r.value=="string"?r.value:"").filter(r=>r):[];factoryAutoGearSeedContext={projectFormData:t,scenarioValues:o,setupValues:captureSetupSelectValues()}}function buildAutoGearRulesFromBaseInfo(e,t){const o=[],r=typeof generateGearListHtml=="function"&&typeof parseGearTableForAutoRules=="function",n=Array.isArray(t)?t.filter(d=>typeof d=="string"&&d):[];let a=null;if(r){const d=generateGearListHtml({...e,requiredScenarios:""});if(a=parseGearTableForAutoRules(d),a&&n.length){const m=new Map;n.forEach(v=>{const C=generateGearListHtml({...e,requiredScenarios:v}),A=parseGearTableForAutoRules(C);if(!A)return;const w=diffGearTableMaps(a,A);let R=cloneAutoGearItems(w.add),_=cloneAutoGearItems(w.remove);!R.length&&!_.length||(m.set(v,{add:R,remove:_}),o.push({id:generateAutoGearId("rule"),label:v,scenarios:[v],add:R,remove:_}))}),[["Handheld","Easyrig"],["Slider","Undersling mode"]].filter(v=>v.every(C=>n.includes(C))).forEach(v=>{const C=v.join(" + "),A=generateGearListHtml({...e,requiredScenarios:v.join(", ")}),w=parseGearTableForAutoRules(A);if(!w)return;const R=diffGearTableMaps(a,w),_=subtractScenarioContributions({add:cloneAutoGearItems(R.add),remove:cloneAutoGearItems(R.remove)},v,m);!_.add.length&&!_.remove.length||o.push({id:generateAutoGearId("rule"),label:C,scenarios:v.slice(),add:_.add,remove:_.remove})});const h=["Extreme rain","Rain Machine"];if(h.every(v=>m.has(v))){const v=[{name:"Schulz Sprayoff Micro",quantity:1,category:"Matte box + filter"},{name:"Fischer RS to D-Tap cable 0,5m",quantity:2,category:"Rigging"},{name:"Spare Disc (Schulz Sprayoff Micro)",quantity:1,category:"Matte box + filter"}].map(C=>({id:generateAutoGearId("item"),name:C.name,category:C.category,quantity:C.quantity}));o.push({id:generateAutoGearId("rule"),label:"Extreme rain + Rain Machine overlap",scenarios:h.slice(),add:[],remove:v})}}}if(a){buildCameraHandleAutoRules(e,a).forEach(y=>o.push(y)),buildViewfinderExtensionAutoRules(e,a).forEach(y=>o.push(y)),buildVideoDistributionAutoRules(e,a).forEach(y=>o.push(y)),buildMatteboxAutoGearRules(e).forEach(y=>o.push(y)),buildCageAutoRules(e,a).forEach(y=>o.push(y)),buildTripodAutoGearRules(e,a).forEach(y=>o.push(y)),buildBatteryAutoRules(e,a).forEach(y=>o.push(y)),buildDistanceAutoRules(e,a).forEach(y=>o.push(y)),buildHotswapAutoRules(e,a).forEach(y=>o.push(y)),buildBatteryPlateAutoRules(e,a).forEach(y=>o.push(y));const d=new Set(o.map(autoGearRuleSignature).filter(y=>typeof y=="string"&&y)),m=y=>{!Array.isArray(y)||!y.length||y.forEach(h=>{const b=autoGearRuleSignature(h);!b||d.has(b)||(o.push(h),d.add(b))})};m(buildDefaultVideoDistributionRules(e)),m(buildOnboardMonitorRiggingAutoGearRules()),m(buildTripodPreferenceAutoGearRules(e)),m(buildArriViewfinderBracketRules(e)),m(buildMotorHandUnitAutoGearRules(e))}const s=buildAutoGearAnyMotorRule();if(s){const d=autoGearRuleSignature(s);o.some(y=>autoGearRuleSignature(y)===d)||o.push(s)}const l=buildAlwaysAutoGearRule();l&&o.push(l);const u=buildFiveDayConsumablesAutoGearRule();return u&&o.push(u),buildDefaultMatteboxAutoGearRules().forEach(d=>o.push(d)),o}function computeFactoryAutoGearRules(){captureAutoGearSeedContext();const e=factoryAutoGearSeedContext;if(!e)return null;const t=captureSetupSelectValues(),o=hasSeededAutoGearDefaults(),r=autoGearRules.slice(),n=baseAutoGearRulesState.slice(),a=projectScopedAutoGearRules?projectScopedAutoGearRules.slice():null,s=autoGearRulesLastBackupSignature,l=autoGearRulesLastPersistedSignature,u=autoGearRulesDirtySinceBackup;try{o&&clearAutoGearDefaultsSeeded(),assignAutoGearRules([]),baseAutoGearRulesState=[],projectScopedAutoGearRules=null,autoGearRulesLastBackupSignature=s,autoGearRulesLastPersistedSignature=l,autoGearRulesDirtySinceBackup=u,applySetupSelectValues(e.setupValues);const d=e.projectFormData||{};let m=cloneWithStructuredCloneFallback(d);(!m||typeof m!="object")&&(m={...d});const y=buildAutoGearRulesFromBaseInfo(m,e.scenarioValues||[]);return y.length&&setFactoryAutoGearRulesSnapshot(y),y}finally{applySetupSelectValues(t),assignAutoGearRules(r),baseAutoGearRulesState=n.slice(),projectScopedAutoGearRules=a?a.slice():null,autoGearRulesLastBackupSignature=s,autoGearRulesLastPersistedSignature=l,autoGearRulesDirtySinceBackup=u,o&&markAutoGearDefaultsSeeded()}}function seedAutoGearRulesFromCurrentProject(){captureAutoGearSeedContext();const e=hasSeededAutoGearDefaults();if(autoGearRules.length){ensureDefaultMatteboxAutoGearRules()&&!e?(markAutoGearDefaultsSeeded(),setFactoryAutoGearRulesSnapshot(getAutoGearRules())):factoryAutoGearRulesSnapshot||setFactoryAutoGearRulesSnapshot(getAutoGearRules());return}if(e){ensureDefaultMatteboxAutoGearRules()&&!factoryAutoGearRulesSnapshot&&setFactoryAutoGearRulesSnapshot(getAutoGearRules());return}const t=factoryAutoGearSeedContext&&factoryAutoGearSeedContext.projectFormData?{...factoryAutoGearSeedContext.projectFormData}:collectProjectFormData?collectProjectFormData():{},o=factoryAutoGearSeedContext&&Array.isArray(factoryAutoGearSeedContext.scenarioValues)?factoryAutoGearSeedContext.scenarioValues:requiredScenariosSelect?Array.from(requiredScenariosSelect.options||[]).map(n=>n&&n.value).filter(Boolean):[],r=buildAutoGearRulesFromBaseInfo(t,o);if(!r.length){ensureDefaultMatteboxAutoGearRules()&&(markAutoGearDefaultsSeeded(),setFactoryAutoGearRulesSnapshot(getAutoGearRules()));return}setAutoGearRules(r),markAutoGearDefaultsSeeded(),setFactoryAutoGearRulesSnapshot(r)}function resetAutoGearRulesToFactoryAdditions$1(){const e=texts[currentLang]||texts.en||{},t=texts.en||{},o=e.autoGearResetFactoryConfirm||texts.en?.autoGearResetFactoryConfirm||"Replace your automatic gear rules with the default additions?",r=()=>{const n=e.autoGearResetFactoryExportFailed||t.autoGearResetFactoryExportFailed||"Automatic gear preset export failed. Reset cancelled.";let a={status:"skipped",reason:"empty"};if(typeof exportAutoGearPresets=="function")try{a=exportAutoGearPresets({reason:"reset-auto-gear"})||{status:"failed",reason:"unknown"}}catch(m){console.error("Failed to export automatic gear presets before reset",m),a={status:"failed",reason:"exception",error:m}}else a={status:"failed",reason:"unavailable"};if(!a||a.status==="failed"||a.status==="skipped"&&a.reason!=="empty"){typeof showNotification=="function"&&showNotification("error",n);return}const s=ensureAutoBackupBeforeDeletion("reset automatic gear rules");if(!s)return;const l=e.autoGearResetFactoryDone||t.autoGearResetFactoryDone||"Automatic gear rules restored to factory additions.",u=e.autoGearResetFactoryEmpty||t.autoGearResetFactoryEmpty||"Factory additions unavailable. Automatic gear rules cleared.",d=e.autoGearResetFactoryError||t.autoGearResetFactoryError||"Reset failed. Please try again.";try{const m=computeFactoryAutoGearRules();if(Array.isArray(m)&&m.length){setAutoGearRules(m),markAutoGearDefaultsSeeded(),setFactoryAutoGearRulesSnapshot(getAutoGearRules()),typeof showNotification=="function"&&showNotification("success",l);return}if(setAutoGearRules([]),setFactoryAutoGearRulesSnapshot(null),clearAutoGearDefaultsSeeded(),ensureDefaultMatteboxAutoGearRules()){markAutoGearDefaultsSeeded(),setFactoryAutoGearRulesSnapshot(getAutoGearRules()),typeof showNotification=="function"&&showNotification("success",l);return}typeof showNotification=="function"&&showNotification("info",u)}catch(m){if(console.error("Failed to reset automatic gear rules to factory additions",m),typeof showNotification=="function"&&showNotification("error",d),s&&typeof notifyAutoSaveFromBackup=="function")try{notifyAutoSaveFromBackup(d,s,"error")}catch(y){console.warn("Failed to announce automatic backup after reset failure",y)}}};if(typeof window.cineShowConfirmDialog=="function"){window.cineShowConfirmDialog({title:e.autoGearResetFactoryTitle||"Reset to Factory",message:o,confirmLabel:e.autoGearResetFactoryConfirmLabel||"Reset",cancelLabel:e.cancel||"Cancel",danger:!0,onConfirm:r});return}console.warn("Missing window.cineShowConfirmDialog for resetAutoGearRulesToFactoryAdditions")}const autoGearRulesAPI=freezeDeep$1({getFactoryAutoGearRulesSnapshot:function e(){return factoryAutoGearRulesSnapshot?cloneAutoGearRules(factoryAutoGearRulesSnapshot):null},getFactoryAutoGearSeedContext:function e(){if(!factoryAutoGearSeedContext)return null;const t=cloneWithStructuredCloneFallback(factoryAutoGearSeedContext);return t&&typeof t=="object"?t:{...factoryAutoGearSeedContext}},setFactoryAutoGearRulesSnapshot,cloneAutoGearItems,cloneAutoGearRuleItem,cloneAutoGearRule,cloneAutoGearRules,subtractScenarioContributions,extractAutoGearSelections,buildCameraHandleAutoRules,buildViewfinderExtensionAutoRules,buildVideoDistributionAutoRules,buildOnboardMonitorRiggingAutoGearRules,buildTripodPreferenceAutoGearRules,buildDefaultVideoDistributionAutoGearRules:buildDefaultVideoDistributionRules,buildDefaultMatteboxAutoGearRules,buildAutoGearAnyMotorRule,buildAlwaysAutoGearRule,buildFiveDayConsumablesAutoGearRule,buildArriViewfinderBracketRules,ensureDefaultMatteboxAutoGearRules,captureAutoGearSeedContext,buildAutoGearRulesFromBaseInfo,computeFactoryAutoGearRules,seedAutoGearRulesFromCurrentProject,resetAutoGearRulesToFactoryAdditions:resetAutoGearRulesToFactoryAdditions$1});registerOrQueueModule$1("cineFeatureAutoGearRules",autoGearRulesAPI,{category:"feature",description:"Automatic gear rule cloning, factory defaults and seeding helpers.",replace:!0,connections:["cineModuleBase","cineModuleContext","cinePersistence"]},e=>{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to register cineFeatureAutoGearRules module.",e)});const globalExports=[["cineFeatureAutoGearRules",autoGearRulesAPI],["buildDefaultVideoDistributionAutoGearRules",buildDefaultVideoDistributionRules],["buildVideoDistributionAutoRules",buildVideoDistributionAutoRules],["buildTripodPreferenceAutoGearRules",buildTripodPreferenceAutoGearRules],["cloneAutoGearItems",cloneAutoGearItems],["cloneAutoGearRuleItem",cloneAutoGearRuleItem],["cloneAutoGearRule",cloneAutoGearRule],["cloneAutoGearRules",cloneAutoGearRules],["setFactoryAutoGearRulesSnapshot",setFactoryAutoGearRulesSnapshot],["ensureDefaultMatteboxAutoGearRules",ensureDefaultMatteboxAutoGearRules],["captureAutoGearSeedContext",captureAutoGearSeedContext],["buildAutoGearRulesFromBaseInfo",buildAutoGearRulesFromBaseInfo],["buildArriViewfinderBracketRules",buildArriViewfinderBracketRules],["computeFactoryAutoGearRules",computeFactoryAutoGearRules],["seedAutoGearRulesFromCurrentProject",seedAutoGearRulesFromCurrentProject],["resetAutoGearRulesToFactoryAdditions",resetAutoGearRulesToFactoryAdditions$1],["factoryAutoGearRulesSnapshot",null],["factoryAutoGearSeedContext",null]];globalExports.forEach(([e,t])=>{if(e==="factoryAutoGearRulesSnapshot"){Object.defineProperty(GLOBAL_SCOPE$5,e,{configurable:!0,get(){return factoryAutoGearRulesSnapshot},set(o){factoryAutoGearRulesSnapshot=Array.isArray(o)?cloneAutoGearRules(o):null}});return}if(e==="factoryAutoGearSeedContext"){Object.defineProperty(GLOBAL_SCOPE$5,e,{configurable:!0,get(){return factoryAutoGearSeedContext},set(o){factoryAutoGearSeedContext=o&&typeof o=="object"?o:null}});return}exposeGlobal$1(e,t,{configurable:!0,writable:!0})});console.log("✅ Auto Gear Rules loaded (ESM)");const autoGearRules$1=Object.freeze(Object.defineProperty({__proto__:null,default:autoGearRulesAPI},Symbol.toStringTag,{value:"Module"})),PRIMARY_STORAGE_KEY$1="cinePowerPlanner_onboardingTutorial",LEGACY_STORAGE_KEYS$1=["cameraPowerPlanner_onboardingTutorial"],STORAGE_KEYS$1=[PRIMARY_STORAGE_KEY$1,...LEGACY_STORAGE_KEYS$1],SKIP_STATUS_KEY$1=`${PRIMARY_STORAGE_KEY$1}:skip`,WINDOW_NAME_SKIP_TOKEN$1=`${SKIP_STATUS_KEY$1}=true`,HELP_TRIGGER_SELECTOR$1="[data-onboarding-tour-trigger]",HELP_BUTTON_ID$1="helpOnboardingTutorialButton",LOAD_REASON_PREFIX="onboarding-tour:",REQUEST_TIMEOUT_MS=2e3,MODULE_WAIT_TIMEOUT_MS=(()=>{const e=[typeof globalThis<"u"&&globalThis?globalThis.__CPP_ONBOARDING_WAIT_TIMEOUT_MS:void 0,typeof window<"u"&&window?window.__CPP_ONBOARDING_WAIT_TIMEOUT_MS:void 0,typeof self<"u"&&self?self.__CPP_ONBOARDING_WAIT_TIMEOUT_MS:void 0,typeof global<"u"&&global?global.__CPP_ONBOARDING_WAIT_TIMEOUT_MS:void 0];for(let t=0;t<e.length;t+=1){const o=e[t];if(o==null)continue;const r=Number(o);if(Number.isFinite(r)&&r>=0)return r}return 4e3})(),TRIGGER_INTERCEPTOR_RELEASE_MS=4500,MODULE_MONITOR_MAX_DURATION_MS=Math.max((MODULE_WAIT_TIMEOUT_MS||0)*10,MODULE_WAIT_TIMEOUT_MS+1e3);let onboardingModulePromise=null,onboardingModuleReady=!1,triggerInterceptor=null,moduleReadyPromise=null,resolveModuleReadyPromise=null,lastDeferredLoadFailed=!1,moduleTimeoutWarningIssued=!1;const pendingTriggerCallbacks=[],pendingTriggerNodes=typeof WeakSet=="function"?new WeakSet:null;function warnModuleTimeoutOnce(){moduleTimeoutWarningIssued||(moduleTimeoutWarningIssued=!0,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Onboarding tour module did not become available after deferred load."))}function getGlobalScope(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null}function getDocument(e){const t=e||getGlobalScope();if(!t)return null;try{if(t.document&&typeof t.document.addEventListener=="function")return t.document}catch{}return null}function schedule(e,t){if(typeof e!="function")return;const o=t||getGlobalScope();if(o&&typeof o.requestAnimationFrame=="function")try{o.requestAnimationFrame(()=>{try{e()}catch(r){}});return}catch{}setTimeout(()=>{try{e()}catch{}},32)}function requestDeferredLoad(e,t){const o=typeof t=="string"&&t?`${LOAD_REASON_PREFIX}${t}`:`${LOAD_REASON_PREFIX}bootstrap`;return new Promise(r=>{const n=Date.now();function a(){const s=e||getGlobalScope();if(!s){r(!1);return}if(s.cineFeaturesOnboardingTour){r(!0);return}let l=null;try{l=s.cineEnsureDeferredScriptsLoaded}catch{l=null}if(typeof l!="function"){r(!0);return}if(typeof l=="function"){try{const d=l({reason:o});d&&typeof d.then=="function"?d.then(()=>r(!0)).catch(()=>r(!1)):r(!0)}catch{r(!1)}return}let u=null;try{u=s.cineDeferredScriptsReady}catch{u=null}if(u&&typeof u.then=="function"){u.then(()=>r(!0)).catch(()=>r(!1));return}if(Date.now()-n>=REQUEST_TIMEOUT_MS){r(!1);return}schedule(a,s)}a()})}function uninstallTriggerInterceptor(e){if(!triggerInterceptor)return;const t=getDocument(e);if(t&&typeof t.removeEventListener=="function")try{t.removeEventListener("click",triggerInterceptor,!0)}catch{}triggerInterceptor=null}function notifyModuleReady(e,t){if(!t||(onboardingModuleReady=!0,lastDeferredLoadFailed=!1,moduleTimeoutWarningIssued=!1,uninstallTriggerInterceptor(e),!pendingTriggerCallbacks.length))return;const o=pendingTriggerCallbacks.slice();pendingTriggerCallbacks.length=0;for(let r=0;r<o.length;r+=1){const n=o[r];if(typeof n=="function")try{n(t)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Onboarding tour queued trigger failed after module ready.",a)}}}function replayTrigger(e,t,o){schedule(()=>{try{e&&typeof e.click=="function"?e.click():t&&typeof t.start=="function"&&t.start()}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Onboarding tour trigger failed after deferred load.",r)}},o)}function queueTriggerReplay(e,t){if(pendingTriggerNodes&&e)try{if(pendingTriggerNodes.has(e))return;pendingTriggerNodes.add(e)}catch{}pendingTriggerCallbacks.push(o=>{if(pendingTriggerNodes&&e)try{pendingTriggerNodes.delete(e)}catch{}replayTrigger(e,o,t)})}function getModuleReadyPromise(e){if(moduleReadyPromise){const r=e||getGlobalScope();if(r&&r.cineFeaturesOnboardingTour&&(notifyModuleReady(r,r.cineFeaturesOnboardingTour),resolveModuleReadyPromise)){try{resolveModuleReadyPromise(r.cineFeaturesOnboardingTour)}catch{}resolveModuleReadyPromise=null}return moduleReadyPromise}const t=e||getGlobalScope();if(!t)return Promise.resolve(null);if(t.cineFeaturesOnboardingTour)return notifyModuleReady(t,t.cineFeaturesOnboardingTour),Promise.resolve(t.cineFeaturesOnboardingTour);const o=Date.now();return moduleReadyPromise=new Promise(r=>{resolveModuleReadyPromise=r;function n(){const a=e||getGlobalScope();if(!a){r(null),resolveModuleReadyPromise=null;return}if(a.cineFeaturesOnboardingTour){notifyModuleReady(a,a.cineFeaturesOnboardingTour),r(a.cineFeaturesOnboardingTour),resolveModuleReadyPromise=null;return}if(Date.now()-o>=MODULE_MONITOR_MAX_DURATION_MS){r(null),resolveModuleReadyPromise=null;return}schedule(n,a)}n()}).finally(()=>{moduleReadyPromise=null,resolveModuleReadyPromise=null}),moduleReadyPromise}function waitForModule(e){return getModuleReadyPromise(e)}function ensureOnboardingTourLoaded(e){const t=getGlobalScope();if(!t)return Promise.resolve(null);if(onboardingModuleReady&&t.cineFeaturesOnboardingTour)return Promise.resolve(t.cineFeaturesOnboardingTour);if(onboardingModulePromise)return onboardingModulePromise;const o={};return onboardingModulePromise=requestDeferredLoad(t,e).catch(r=>!1).then(r=>{if(!r)return lastDeferredLoadFailed=!0,{moduleApi:null,reason:"deferred-load-unavailable"};lastDeferredLoadFailed=!1;const n=waitForModule(t),a=new Promise(s=>{try{setTimeout(()=>{s(o)},MODULE_WAIT_TIMEOUT_MS)}catch{s(o)}});return Promise.race([n,a]).then(s=>s===o?(n&&typeof n.then=="function"?n.then(l=>{l||warnModuleTimeoutOnce()}).catch(l=>{}):warnModuleTimeoutOnce(),{moduleApi:null,reason:"timeout-pending"}):(s||warnModuleTimeoutOnce(),{moduleApi:s||null,reason:s?"ready":"monitor-timeout"}))}).then(r=>{const n=r&&r.moduleApi;return!n&&typeof console<"u"&&typeof console.warn=="function"&&r&&r.reason==="deferred-load-unavailable"&&console.warn("Onboarding tour module deferred scripts could not be requested."),n||null}).finally(()=>{onboardingModulePromise=null}),onboardingModulePromise}function coerceStoredBooleanFlag(e,t){const o=t||{},r=Array.isArray(o.trueValues)?o.trueValues:[],n=Array.isArray(o.falseValues)?o.falseValues:[];if(e===!0)return!0;if(e===!1)return!1;if(typeof e=="number"){if(Number.isFinite(e)){if(e===1)return!0;if(e===0)return!1}return e}if(typeof e!="string")return e;const a=e.trim().toLowerCase();return a?r.indexOf(a)!==-1?!0:n.indexOf(a)!==-1?!1:e:e}function normalizeStoredStateSnapshot(e){if(!e||typeof e!="object")return null;const t={...e};return Object.prototype.hasOwnProperty.call(t,"completed")&&(t.completed=coerceStoredBooleanFlag(t.completed,{trueValues:["true","1","yes","completed","done","finished"],falseValues:["false","0","no","pending","incomplete"]})),Object.prototype.hasOwnProperty.call(t,"skipped")&&(t.skipped=coerceStoredBooleanFlag(t.skipped,{trueValues:["true","1","yes","skipped","dismissed"],falseValues:["false","0","no","pending","incomplete"]})),t}function parseStoredStateValue(e){if(!e)return null;if(typeof e=="object")return normalizeStoredStateSnapshot(e)||e;if(typeof e!="string")return null;const t=e.trim();if(!t)return null;try{const o=JSON.parse(t);if(o&&typeof o=="object")return normalizeStoredStateSnapshot(o)||o;if(o===!0)return normalizeStoredStateSnapshot({completed:!0})||{completed:!0};if(o===!1)return normalizeStoredStateSnapshot({completed:!1})||{completed:!1};if(typeof o=="string"){if(o==="completed")return normalizeStoredStateSnapshot({completed:!0})||{completed:!0};if(o==="skipped")return normalizeStoredStateSnapshot({skipped:!0})||{skipped:!0}}}catch{}return t==="completed"?normalizeStoredStateSnapshot({completed:!0})||{completed:!0}:t==="skipped"?normalizeStoredStateSnapshot({skipped:!0})||{skipped:!0}:t==="true"?normalizeStoredStateSnapshot({completed:!0})||{completed:!0}:t==="false"?normalizeStoredStateSnapshot({completed:!1})||{completed:!1}:null}function collectStorageCandidates$1(e){const t=[],o=n=>{n&&t.indexOf(n)===-1&&t.push(n)};try{if(typeof getSafeLocalStorage=="function"){const n=getSafeLocalStorage();o(n)}}catch{}typeof SAFE_LOCAL_STORAGE=="object"&&SAFE_LOCAL_STORAGE&&o(SAFE_LOCAL_STORAGE);const r=e||getGlobalScope();return r&&typeof r.localStorage=="object"&&r.localStorage&&o(r.localStorage),r&&typeof r.sessionStorage=="object"&&r.sessionStorage&&o(r.sessionStorage),t}function readSkipPreference(e){const t=collectStorageCandidates$1(e);for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||typeof r.getItem!="function"))try{const n=r.getItem(SKIP_STATUS_KEY$1);if(n===null||typeof n>"u")continue;if(n===!0||n==="true")return!0;if(n===!1||n==="false")return!1;try{const a=JSON.parse(n);if(a===!0||a===!1)return a}catch(a){}}catch{}}try{const o=e||getGlobalScope(),r=o&&typeof o.name=="string"?o.name:"";if(r&&r.indexOf(WINDOW_NAME_SKIP_TOKEN$1)!==-1)return!0}catch{}return null}function isOnboardingSuppressed(e){const t=readStoredState(e),o=normalizeStoredStateSnapshot(t)||t;return!!(o&&typeof o=="object"&&(o.completed===!0||o.skipped===!0))}function readStoredState(e){const t=collectStorageCandidates$1(e);let o=null;if(readSkipPreference(e)===!0)return{skipped:!0,completed:!1};for(let n=0;n<t.length;n+=1){const a=t[n];if(!(!a||typeof a.getItem!="function"))for(let s=0;s<STORAGE_KEYS$1.length;s+=1){const l=STORAGE_KEYS$1[s];try{const u=a.getItem(l),d=parseStoredStateValue(u);if(d){const m=normalizeStoredStateSnapshot(d)||d;if(m.completed===!0||m.skipped===!0)return m;o||(o=m)}}catch{}}}return o&&(normalizeStoredStateSnapshot(o)||o)}function detectFirstRun(e){onboardingModuleReady||isOnboardingSuppressed(e)||schedule(()=>{ensureOnboardingTourLoaded("first-run")},e)}function matchesTrigger(e){return e?typeof e.matches=="function"&&e.matches(HELP_TRIGGER_SELECTOR$1)||typeof e.getAttribute=="function"&&e.getAttribute("data-onboarding-tour-trigger")!==null?!0:typeof e.id=="string"&&e.id===HELP_BUTTON_ID$1:!1}function resolveTrigger(e,t){if(!e)return null;if(typeof e.closest=="function")try{const r=e.closest(`${HELP_TRIGGER_SELECTOR$1}, #${HELP_BUTTON_ID$1}`);if(r)return r}catch{}let o=e;for(;o&&o!==t&&o!==t.documentElement;){if(matchesTrigger(o))return o;o=o.parentElement||o.parentNode||null}if(matchesTrigger(o))return o;if(t&&typeof t.getElementById=="function")try{const r=t.getElementById(HELP_BUTTON_ID$1);if(r&&matchesTrigger(r))return r}catch{}return null}function installTriggerInterceptor(e){if(triggerInterceptor||onboardingModuleReady)return;const t=getDocument(e);if(!(!t||typeof t.addEventListener!="function")){triggerInterceptor=o=>{if(!o||o.defaultPrevented||onboardingModuleReady||o.type!=="click")return;const r=resolveTrigger(o.target,t);if(!r)return;if(isOnboardingSuppressed(e)){uninstallTriggerInterceptor(e);return}if(typeof o.preventDefault=="function"&&o.preventDefault(),typeof o.stopPropagation=="function"&&o.stopPropagation(),typeof o.stopImmediatePropagation=="function"&&o.stopImmediatePropagation(),typeof r.setAttribute=="function")try{r.setAttribute("aria-busy","true")}catch{}let n=null;function a(){if(n!==null){try{clearTimeout(n)}catch{}n=null}if(typeof r.removeAttribute=="function")try{r.removeAttribute("aria-busy")}catch{}}try{typeof setTimeout=="function"&&(n=setTimeout(a,TRIGGER_INTERCEPTOR_RELEASE_MS))}catch{n=null}ensureOnboardingTourLoaded("ui-trigger").then(s=>{if(a(),!s){lastDeferredLoadFailed||queueTriggerReplay(r,e);return}onboardingModuleReady=!0,uninstallTriggerInterceptor(e),replayTrigger(r,s,e)}).catch(s=>{a(),typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to load onboarding tour before handling trigger.",s)})};try{t.addEventListener("click",triggerInterceptor,!0)}catch{triggerInterceptor=null}}}const scope=getGlobalScope();if(scope){try{scope.cineEnsureOnboardingTourLoaded=ensureOnboardingTourLoaded}catch{}installTriggerInterceptor(scope),detectFirstRun(scope)}(function(){const e=typeof window<"u"?window:this;function t(R){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:R&&typeof R.cineModuleBase=="object"?R.cineModuleBase:null}const o=t(e)||{freezeDeep:R=>R,exposeGlobal:(R,_,G)=>{G&&(G[R]=_)},registerOrQueueModule:()=>{}},r={isOpen:!1,elements:{},preferences:{layout:"rental",sections:{project:!0,devices:!0,diagram:!0,gearList:!0,battery:!0}}};function n(R,_){const G=typeof cineCoreAppLocalizationAccessors<"u"?cineCoreAppLocalizationAccessors:typeof window<"u"?window.cineCoreAppLocalizationAccessors:null;if(G&&typeof G.getLanguageTexts=="function"){const O=typeof document<"u"&&document.documentElement&&document.documentElement.lang||"en",B=G.getLanguageTexts(O),$=R.split(".");let V=B;for(const M of $)if(V&&typeof V=="object"&&M in V)V=V[M];else return _;return V||_}return _}function a(){if(!r.elements.modal)return;const R=r.elements.modal.querySelector(".mockup-sidebar");if(!R)return;const _=R.querySelector(".mockup-sidebar-header h2");if(_&&(_.textContent=n("printPreview.title","Print & Export")),r.elements.closeBtn){r.elements.closeBtn.setAttribute("aria-label",n("printPreview.backLabel","Back"));const M=r.elements.closeBtn.querySelector(".btn-text");M&&(M.textContent=n("printPreview.backLabel","Back"))}const G=R.querySelector(".control-section:nth-child(2) .section-title");G&&(G.textContent=n("printPreview.layoutModeTitle","Layout Mode"));const O=R.querySelector('label[for="printLayoutRentalToggle"]');if(O&&O.childNodes.length>0){const M=Array.from(O.childNodes).find(F=>F.nodeType===3&&F.textContent.trim().length>0);M&&(M.textContent=n("printPreview.layoutRentalLabel","Rental Friendly"))}const B=R.querySelector(".control-section:nth-child(2) p");B&&(B.textContent=n("printPreview.layoutRentalDescription","Optimizes layout for rental by grouping items by category."));const $=R.querySelector(".control-section:nth-child(3) .section-title");if($&&($.textContent=n("printPreview.sectionsTitle","Sections")),Object.entries({printSectionProject:"printPreview.sectionProject",printSectionDevices:"printPreview.sectionDevices",printSectionDiagram:"printPreview.sectionDiagram",printSectionGearList:"printPreview.sectionGearList",printSectionBattery:"printPreview.sectionBattery"}).forEach(([M,F])=>{const z=R.querySelector(`#${M}`),x=z?z.closest("label")||R.querySelector(`label[for="${M}"]`):null;if(x){let H=Array.from(x.childNodes).find(W=>W.nodeType===3&&W.textContent.trim().length>0);if(!H){const W=x.querySelector("span:not(.slider)");if(W&&W.textContent.trim().length>0){W.textContent=n(F,W.textContent.trim());return}}if(H){const W=n(F,H.textContent.trim()),U=document.createElement("span");U.style.position="relative",U.style.zIndex="1",U.textContent=" "+W,H.replaceWith(U)}}}),r.elements.exportBtn){const M=r.elements.exportBtn.querySelector(".icon-glyph");r.elements.exportBtn.innerHTML="",M&&r.elements.exportBtn.appendChild(M),r.elements.exportBtn.appendChild(document.createTextNode(" "+n("printPreview.exportPdfButton","Export PDF")))}if(r.elements.printBtn){const M=r.elements.printBtn.querySelector(".icon-glyph");r.elements.printBtn.innerHTML="",M&&r.elements.printBtn.appendChild(M),r.elements.printBtn.appendChild(document.createTextNode(" "+n("printPreview.printButton","Print")))}}function s(){return typeof document>"u"?!1:(r.elements={modal:document.getElementById("printPreviewModal"),closeBtn:document.getElementById("closePrintPreviewBtn"),paper:document.getElementById("printPreviewPaper"),layoutToggle:document.getElementById("printLayoutRentalToggle"),sectionToggles:{project:document.getElementById("printSectionProject"),devices:document.getElementById("printSectionDevices"),diagram:document.getElementById("printSectionDiagram"),gearList:document.getElementById("printSectionGearList"),battery:document.getElementById("printSectionBattery")},exportBtn:document.getElementById("printPreviewExportBtn"),printBtn:document.getElementById("printPreviewPrintBtn")},!!r.elements.modal)}function l(){if(r.elements.modal){if(r.elements.closeBtn){const R=r.elements.closeBtn.cloneNode(!0);r.elements.closeBtn.parentNode.replaceChild(R,r.elements.closeBtn),r.elements.closeBtn=R,r.elements.closeBtn.addEventListener("click",v)}if(r.elements.layoutToggle&&r.elements.layoutToggle.addEventListener("change",R=>{const _=R.target.checked;r.preferences.layout=_?"rental":"standard",_?(r.elements.sectionToggles.devices&&(r.elements.sectionToggles.devices.checked=!1),r.elements.sectionToggles.diagram&&(r.elements.sectionToggles.diagram.checked=!1),r.elements.sectionToggles.battery&&(r.elements.sectionToggles.battery.checked=!0),r.elements.sectionToggles.battery&&(r.elements.sectionToggles.battery.checked=!1),r.preferences.sections.devices=!1,r.preferences.sections.diagram=!1,r.preferences.sections.battery=!1):(r.elements.sectionToggles.devices&&(r.elements.sectionToggles.devices.checked=!0),r.elements.sectionToggles.diagram&&(r.elements.sectionToggles.diagram.checked=!0),r.elements.sectionToggles.battery&&(r.elements.sectionToggles.battery.checked=!0),r.preferences.sections.devices=!0,r.preferences.sections.diagram=!0,r.preferences.sections.battery=!0),h(),y()}),Object.entries(r.elements.sectionToggles).forEach(([R,_])=>{_&&_.addEventListener("change",G=>{r.preferences.sections[R]=G.target.checked,h()})}),r.elements.printBtn){const R=r.elements.printBtn.cloneNode(!0);r.elements.printBtn.parentNode.replaceChild(R,r.elements.printBtn),r.elements.printBtn=R,r.elements.printBtn.addEventListener("click",()=>{C()})}if(r.elements.exportBtn){const R=r.elements.exportBtn.cloneNode(!0);r.elements.exportBtn.parentNode.replaceChild(R,r.elements.exportBtn),r.elements.exportBtn=R,r.elements.exportBtn.addEventListener("click",()=>{C()})}}}typeof document<"u"&&document.body&&document.body.addEventListener("click",R=>{R.target.closest("#openPrintOptionsBtn")&&(R.preventDefault(),R.stopImmediatePropagation(),b())},{capture:!0});function u(){let R=document.getElementById("overviewDeviceSection");if(!R){const $=document.querySelectorAll(".device-category");if($.length>0){const V=document.createElement("div");return V.className="device-category-container",$.forEach(M=>{V.appendChild(M.cloneNode(!0))}),V.outerHTML}return"<p>No devices selected or overview not generated.</p>"}const _=document.createElement("div");_.className="device-category-container";const G=R.querySelectorAll(".device-category");if(G.length>0)return G.forEach($=>{_.appendChild($.cloneNode(!0))}),_.outerHTML;const O=Array.from(R.children);let B=null;return O.forEach($=>{if($.tagName==="H3"){B=document.createElement("div"),B.className="device-category";const V=document.createElement("h3");V.innerHTML=$.innerHTML,B.appendChild(V),_.appendChild(B)}else if($.classList.contains("device-block")){if(!B){B=document.createElement("div"),B.className="device-category";const M=document.createElement("h3");M.textContent=n("categoryNames.other","Other"),B.appendChild(M),_.appendChild(B)}const V=$.cloneNode(!0);B.appendChild(V)}else $.classList.contains("device-category")&&_.appendChild($.cloneNode(!0))}),_.outerHTML}function d(){const R=document.getElementById("heroTotalDraw")?.textContent||document.getElementById("totalPower")?.textContent||"0 W",_=document.getElementById("heroRuntime")?.textContent||document.getElementById("batteryLife")?.textContent||"—",G=document.getElementById("heroBatteryCount")?.textContent||document.getElementById("batteryCount")?.textContent||"0",O=document.getElementById("batterySelect")?.selectedOptions[0]?.text||"Battery",B=document.getElementById("heroCurrent144")?.textContent||document.getElementById("totalCurrent144Elem")?.textContent||"";return`
            <div style="display: flex; gap: 15px;">
                <div style="flex: 1; background: #f0fdf4; padding: 10px; border: 1px solid #bbf7d0; border-radius: 4px;">
                    <div style="font-size: 0.8em; color: #166534; text-transform: uppercase; font-weight: bold;">${n("printPreview.generatedTotalLoad","Total Load")}</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #14532d;">${R}</div>
                    <div style="font-size: 0.8em; color: #166534;">${B?n("printPreview.generatedPeak","Peak:")+" "+B:""}</div>
                </div>
                <div style="flex: 1; background: #eff6ff; padding: 10px; border: 1px solid #bfdbfe; border-radius: 4px;">
                    <div style="font-size: 0.8em; color: #1e40af; text-transform: uppercase; font-weight: bold;">${n("printPreview.generatedEstRuntime","Est. Runtime")}</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #1e3a8a;">${_}</div>
                    <div style="font-size: 0.8em; color: #1e40af;">${n("printPreview.generatedWith","w/")} ${O}</div>
                </div>
                <div style="flex: 1; background: #fff7ed; padding: 10px; border: 1px solid #fed7aa; border-radius: 4px;">
                    <div style="font-size: 0.8em; color: #9a3412; text-transform: uppercase; font-weight: bold;">${n("printPreview.generatedDailyNeeds","Daily Needs")}</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #7c2d12;">${G} ${n("printPreview.generatedBatts","Batts")}</div>
                    <div style="font-size: 0.8em; color: #9a3412;">${n("printPreview.generatedFor12hDay","for 12h day")}</div>
                </div>
            </div>
        `}function m(R){if(!R)return;R.querySelectorAll("input, textarea").forEach(B=>{if(B.type==="hidden")return;const $=B.value;let V=$;B.type==="date"&&$&&e.cineProjectDashboard&&typeof e.cineProjectDashboard.formatDate=="function"&&(V=e.cineProjectDashboard.formatDate($));const M=document.createElement("span");M.className="print-value",M.textContent=V,B.classList.contains("prep-start")&&M.classList.add("prep-start"),B.classList.contains("prep-end")&&M.classList.add("prep-end"),B.classList.contains("shoot-start")&&M.classList.add("shoot-start"),B.classList.contains("shoot-end")&&M.classList.add("shoot-end"),B.classList.contains("return-start")&&M.classList.add("return-start"),B.classList.contains("return-end")&&M.classList.add("return-end"),B.parentNode&&B.parentNode.replaceChild(M,B)}),R.querySelectorAll("select").forEach(B=>{const $=B.options[B.selectedIndex],V=$?$.text:"",M=document.createElement("span");M.className="print-value",M.textContent=V,B.parentNode&&B.parentNode.replaceChild(M,B)}),R.querySelectorAll("button").forEach(B=>B.remove())}function y(){const R=r.elements.paper;if(!R)return;R.innerHTML="";const _=r.preferences.layout==="rental",G=document.createElement("div");G.className="preview-header";const O=document.getElementById("setupName")?.value||"Untitled Project",B=document.getElementById("productionInput")?.value||"",$=new Date().toLocaleDateString();G.innerHTML=`
            <h1>${n("printPreview.generatedTitle","Overview")}</h1>
            <p><strong>${n("printPreview.generatedProjectNameLabel","Project Name:")}</strong> ${O}</p>
            <p><strong>${n("printPreview.generatedProductionLabel","Production:")}</strong> ${B} | <strong>${n("printPreview.generatedDateLabel","Date:")}</strong> ${$}</p>
        `,R.appendChild(G);const V=document.createElement("section");V.id="preview-section-project",V.className="print-section project-requirements-section";const M=document.getElementById("projectRequirementsOutput");if(M){const le=M.cloneNode(!0);m(le),V.appendChild(le)}else V.innerHTML="<p><em>"+n("printPreview.generatedNoProjectRequirements","No project requirements data.")+"</em></p>";R.appendChild(V);const F=document.createElement("section");if(F.id="preview-section-devices",F.className="print-section",F.innerHTML="<h2>"+n("printPreview.generatedDeviceSelectionTitle","Device Selection")+"</h2>",r.preferences.layout==="rental")F.innerHTML+=u();else{const le=document.getElementById("overviewDeviceSection");if(le)F.innerHTML+=le.innerHTML;else{const be=document.querySelectorAll(".device-category");be.length>0?be.forEach(re=>{F.appendChild(re.cloneNode(!0))}):F.innerHTML+="<p>"+n("printPreview.generatedNoDevicesSelected","No devices selected.")+"</p>"}}R.appendChild(F);const z=document.createElement("section");z.id="preview-section-diagram",z.className="print-section",z.innerHTML="<h2>"+n("printPreview.generatedPowerDiagramTitle","Power Diagram")+"</h2>";const x=document.getElementById("setupDiagram");if(x){const le=x.querySelector("svg");le?z.appendChild(le.cloneNode(!0)):z.innerHTML+=x.innerHTML}R.appendChild(z);const H=document.createElement("section");H.id="preview-section-battery",H.className="print-section",H.style.marginTop="20px",H.innerHTML="<h2>"+n("printPreview.generatedPowerSummaryTitle","Power Summary")+"</h2>",H.innerHTML+=d();const W=document.getElementById("batteryComparison");if(W){const le=W.cloneNode(!0),be=le.querySelector("h2");be&&be.remove(),H.appendChild(le)}R.appendChild(H);const U=document.createElement("section");U.id="preview-section-gearList",U.className="print-section gear-list-section",U.innerHTML="<h2>"+n("printPreview.generatedGearListTitle","Gear List")+"</h2>";const j=document.getElementById("gearListOutput");if(j){const le=j.cloneNode(!0);le.querySelectorAll(".gear-rental-toggle, .gear-edit-btn, button, .ui-only").forEach(re=>re.remove()),_&&(le.querySelectorAll(".gear-item").forEach(ne=>{const Ce=ne.textContent||"",Ee=ne.getAttribute("data-gear-attributes")||"",Pe=ne.getAttribute("data-rental-note")||"";if(Ce.includes("Own Gear")||Ee.includes("Own Gear")||Pe.includes("Own Gear")){const Je=ne.nextSibling;Je&&Je.nodeName==="BR"&&Je.remove(),ne.remove()}}),le.querySelectorAll("tbody.category-group, .gear-category").forEach(ne=>{ne.querySelectorAll(".gear-item").length>0||(ne.style.display="none")})),U.appendChild(le)}let Y=!1;if(typeof window.getCurrentProjectInfo=="function"&&typeof window.hasProjectInfoData=="function"){const le=window.getCurrentProjectInfo();Y=window.hasProjectInfoData(le)}Y&&R.appendChild(U),h()}function h(){Object.entries({project:"preview-section-project",devices:"preview-section-devices",diagram:"preview-section-diagram",gearList:"preview-section-gearList",battery:"preview-section-battery"}).forEach(([_,G])=>{const O=document.getElementById(G);O&&(O.style.display=r.preferences.sections[_]?"block":"none")})}function b(R){r.elements.modal||s(),r.elements.modal&&(R&&typeof R=="object"&&(R.layout==="rental"?(r.preferences.layout="rental",r.elements.layoutToggle?(r.elements.layoutToggle.checked=!0,r.elements.layoutToggle.dispatchEvent(new Event("change"))):(r.preferences.sections.devices=!1,r.preferences.sections.diagram=!1,r.preferences.sections.battery=!1)):R.layout==="standard"&&(r.preferences.layout="standard",r.elements.layoutToggle&&(r.elements.layoutToggle.checked=!1,r.elements.layoutToggle.dispatchEvent(new Event("change"))))),y(),typeof r.elements.modal.showModal=="function"&&(r.elements.modal.open||r.elements.modal.showModal()),r.elements.modal.classList.remove("hidden"),r.isOpen=!0,document.body.style.overflow="hidden")}function v(){r.elements.modal&&(typeof r.elements.modal.close=="function"&&r.elements.modal.open&&r.elements.modal.close(),r.elements.modal.classList.add("hidden"),r.isOpen=!1,document.body.style.overflow="")}function C(){document.body.classList.add("printing-preview"),window.print(),document.body.classList.remove("printing-preview")}const A={open:b,close:v};function w(){s()&&(l(),a())}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w()),o.registerOrQueueModule("cineFeaturePrintPreview",A,{category:"feature",description:"Print Preview Modal",connections:["cineUi"]}),o.exposeGlobal("cineFeaturePrintPreview",A)})();function detectGlobalScope$1(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const GLOBAL_SCOPE$4=detectGlobalScope$1();function resolveModuleBase(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"&&e.cineModuleBase?e.cineModuleBase:null}const MODULE_BASE=resolveModuleBase(GLOBAL_SCOPE$4);function freezeShallow(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return e;try{return Object.freeze(e)}catch{}return e}const safeWarn$2=MODULE_BASE&&typeof MODULE_BASE.safeWarn=="function"?function e(t,o){try{MODULE_BASE.safeWarn(t,o)}catch{}if(typeof console<"u"&&console&&typeof console.warn=="function")try{typeof o>"u"?console.warn(t):console.warn(t,o)}catch{}}:function e(t,o){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof o>"u"?console.warn(t):console.warn(t,o)}catch{}},safeError=function e(t,o){try{safeWarn$2(t,o)}catch{}if(!(typeof console>"u"||!console||typeof console.error!="function"))try{typeof o>"u"?console.error(t):console.error(t,o)}catch{}};function collectRegistryCandidates(e){const t=[],o=r=>{!r||typeof r=="function"||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)};return e&&typeof e.cineModules=="object"&&o(e.cineModules),t}function attemptRegistryBackfill(e){const t=e||GLOBAL_SCOPE$4;if(!t||typeof t!="object"&&typeof t!="function")return freezeShallow({registryCount:0,descriptorCount:0,registered:0});const o=collectRegistryCandidates(t),r=[],n=new Set;for(let l=0;l<o.length;l+=1){const u=o[l];!u||typeof u.register!="function"||typeof u.has!="function"||n.has(u)||(n.add(u),r.push(u))}if(r.length===0)return freezeShallow({registryCount:0,descriptorCount:0,registered:0});const a=[{name:"cineModuleBase",category:"infrastructure",description:"Shared helpers for module registration, freezing, and safe global exposure.",resolve(){return t.cineModuleBase||null}},{name:"cineModuleGlobals",category:"infrastructure",description:"Shared module globals for cross-script coordination.",resolve(){return t.cineModuleGlobals||null}},{name:"cineCoreShared",category:"shared",description:"Shared helpers for deterministic stringification, weights, and version markers.",resolve(){return t.cineCoreShared||null}},{name:"cinePersistence",category:"persistence",description:"Data integrity facade for storage, autosave, backups, restore, and share flows.",resolve(){return t.cinePersistence||null}},{name:"cineOffline",category:"offline",description:"Offline helpers for service worker registration and cache recovery.",resolve(){return t.cineOffline||null}},{name:"cineUi",category:"ui",description:"UI controller registry for dialogs, interactions, orchestration, and help copy.",resolve(){return t.cineUi||null}},{name:"cineFeaturePrint",category:"feature",description:"Print orchestration helpers for overview exports and fallback workflows.",resolve(){return t.cineFeaturePrint||null}},{name:"cineCoreProject",category:"domain",description:"Project intelligence helpers for derived metadata, selectors, and calculations.",resolve(){return t.cineCoreProject||null}},{name:"cineCoreGuard",category:"safety",description:"Persistence guards that preserve autosaves, presets, and backup state across workflows.",resolve(){return t.cineCoreGuard||null}},{name:"cineCoreExperience",category:"experience",description:"Experience helpers for UI orchestration, feature discovery, and presentation.",resolve(){return t.cineCoreExperience||null}},{name:"cineRuntime",category:"runtime",description:"Runtime orchestrator ensuring persistence, offline, and UI safeguards stay intact.",resolve(){return t.cineRuntime||null}}];let s=0;for(let l=0;l<a.length;l+=1){const u=a[l];let d=null;try{d=u.resolve()}catch{d=null}if(d)for(let m=0;m<r.length;m+=1){const y=r[m];try{if(y.has(u.name))continue;y.register(u.name,d,{category:u.category,description:u.description,replace:!0}),s+=1}catch{}}}return freezeShallow({registryCount:r.length,descriptorCount:a.length,registered:s})}function attachIntegrity(e,t){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,"__cineRuntimeIntegrity",{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{}try{return e.__cineRuntimeIntegrity=t,!0}catch{}return!1}function resolveRuntime(e){const t=e||GLOBAL_SCOPE$4;if(t)try{const o=t.cineRuntime;if(o&&typeof o=="object")return o}catch{}return null}function verifyRuntimeIntegrity(e,t={}){const o=e||GLOBAL_SCOPE$4;if(!o)return null;const r=resolveRuntime(o);if(!r||typeof r.verifyCriticalFlows!="function")return null;const n=t.warnOnFailure!==!1,a=t.throwOnFailure!==!1;let s;try{s=r.verifyCriticalFlows({warnOnFailure:n})}catch(u){const d=freezeShallow({ok:!1,error:u});if(attachIntegrity(o,d),n&&safeError("cineRuntime.verifyCriticalFlows() threw during startup.",u),a)throw u;return d}const l=s&&typeof s=="object"?s:freezeShallow({ok:!1});if(attachIntegrity(o,l),!l||l.ok!==!0){const u=l&&Array.isArray(l.missing)?JSON.stringify(l.missing):"unknown",d=new Error(`cineRuntime integrity verification failed during startup. Missing: ${u}`);if(d.details=l||null,n&&safeError(d.message,d),a)throw typeof console<"u"&&console.log("INTEGRITY CHECK FAILURE DETAILS:",JSON.stringify(l,null,2)),d}return l}function resolveRuntimeGuard(e){const t=[],o=r=>{!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)};o(e),o(GLOBAL_SCOPE$4),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const a=n&&n.cineRuntimeGuard;if(a&&typeof a=="object")return a}catch{}}return typeof module<"u"&&module&&module.exports?module.exports:null}function bootstrap(e,t={}){const o=e||GLOBAL_SCOPE$4,r=attemptRegistryBackfill(o),n=verifyRuntimeIntegrity(o,t);return freezeShallow({registry:r,integrity:n})}const moduleApi$1=freezeShallow({detectGlobalScope:detectGlobalScope$1,resolveRuntimeGuard,attemptRegistryBackfill,verifyRuntimeIntegrity,bootstrap});if(MODULE_BASE&&typeof MODULE_BASE.registerOrQueueModule=="function")try{MODULE_BASE.registerOrQueueModule("cineRuntimeGuard",moduleApi$1,{category:"infrastructure",description:"Runtime backfill and integrity helpers reused by the legacy entry point.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cinePersistence","cineRuntime"]},e=>safeWarn$2("Unable to register cineRuntimeGuard module.",e),GLOBAL_SCOPE$4,MODULE_BASE.getModuleRegistry&&MODULE_BASE.getModuleRegistry(GLOBAL_SCOPE$4))}catch(e){safeWarn$2("cineRuntimeGuard registration failed.",e)}if(MODULE_BASE&&typeof MODULE_BASE.exposeGlobal=="function")try{MODULE_BASE.exposeGlobal("cineRuntimeGuard",moduleApi$1,GLOBAL_SCOPE$4,{configurable:!0,enumerable:!1,writable:!1})}catch(e){safeWarn$2("cineRuntimeGuard could not expose global api.",e)}else try{GLOBAL_SCOPE$4.cineRuntimeGuard=moduleApi$1}catch(e){safeWarn$2("cineRuntimeGuard could not assign global api.",e)}typeof module<"u"&&module&&module.exports&&(module.exports=moduleApi$1);var define_process_env_default={};function fallbackDetectGlobalScope(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function fallbackCollectCandidateScopes(e){const t=[];function o(r){!r||typeof r!="object"&&typeof r!="function"||t.indexOf(r)===-1&&t.push(r)}return o(e),typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),t}function fallbackLoadModuleEnvironment(e){const t=fallbackCollectCandidateScopes(e);for(let o=0;o<t.length;o+=1){const r=t[o];if(r&&typeof r.cineModuleEnvironment=="object")return r.cineModuleEnvironment}return null}function fallbackLoadEnvironmentBridge(e){const t=fallbackCollectCandidateScopes(e);for(let o=0;o<t.length;o+=1){const r=t[o];if(r&&typeof r.cineEnvironmentBridge=="object")return r.cineEnvironmentBridge}return null}function fallbackResolveModuleGlobals(e){const t=fallbackCollectCandidateScopes(e);for(let o=0;o<t.length;o+=1){const r=t[o];if(r&&typeof r.cineModuleGlobals=="object")return r.cineModuleGlobals}return null}function fallbackTryRequire(e){return null}const LOCAL_SCOPE=fallbackDetectGlobalScope();function resolveEnvironmentContext(e){const t=e||LOCAL_SCOPE;return t&&typeof t.cineModuleEnvironmentContext=="object"?t.cineModuleEnvironmentContext:null}const ENVIRONMENT_CONTEXT=resolveEnvironmentContext(LOCAL_SCOPE),detectGlobalScope=ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.detectGlobalScope=="function"?function e(){try{return ENVIRONMENT_CONTEXT.detectGlobalScope()}catch{}return fallbackDetectGlobalScope()}:fallbackDetectGlobalScope,PRIMARY_SCOPE=ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.getPrimaryScope=="function"?ENVIRONMENT_CONTEXT.getPrimaryScope():detectGlobalScope(),GLOBAL_SCOPE$3=(ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.getGlobalScope=="function"?ENVIRONMENT_CONTEXT.getGlobalScope(PRIMARY_SCOPE):null)||PRIMARY_SCOPE,MODULE_ENV=(ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.resolveModuleEnvironment=="function"?ENVIRONMENT_CONTEXT.resolveModuleEnvironment(GLOBAL_SCOPE$3):null)||fallbackLoadModuleEnvironment(GLOBAL_SCOPE$3),ENV_BRIDGE=(ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.resolveEnvironmentBridge=="function"?ENVIRONMENT_CONTEXT.resolveEnvironmentBridge(GLOBAL_SCOPE$3):null)||fallbackLoadEnvironmentBridge(GLOBAL_SCOPE$3),MODULE_GLOBALS=(ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.resolveModuleGlobals=="function"?ENVIRONMENT_CONTEXT.resolveModuleGlobals(GLOBAL_SCOPE$3):null)||fallbackResolveModuleGlobals(GLOBAL_SCOPE$3);function informModuleGlobals(e,t){if(!(!MODULE_GLOBALS||typeof MODULE_GLOBALS.recordModule!="function"))try{MODULE_GLOBALS.recordModule(e,t)}catch{}}const tryRequire=(function e(){return ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.tryRequire=="function"?function(o){const r=ENVIRONMENT_CONTEXT.tryRequire(o);return typeof r>"u"?fallbackTryRequire():r}:MODULE_GLOBALS&&typeof MODULE_GLOBALS.tryRequire=="function"?MODULE_GLOBALS.tryRequire:ENV_BRIDGE&&typeof ENV_BRIDGE.tryRequire=="function"?function(o){const r=ENV_BRIDGE.tryRequire(o);return typeof r>"u"?fallbackTryRequire():r}:MODULE_ENV&&typeof MODULE_ENV.tryRequire=="function"?MODULE_ENV.tryRequire:fallbackTryRequire})();function fallbackResolveModuleRegistry(e){if(MODULE_GLOBALS&&typeof MODULE_GLOBALS.resolveModuleRegistry=="function")try{const o=MODULE_GLOBALS.resolveModuleRegistry(e||GLOBAL_SCOPE$3);if(o)return o}catch{}if(ENV_BRIDGE&&typeof ENV_BRIDGE.getModuleRegistry=="function")try{const o=ENV_BRIDGE.getModuleRegistry(e||GLOBAL_SCOPE$3);if(o)return o}catch{}if(MODULE_ENV&&typeof MODULE_ENV.resolveModuleRegistry=="function")try{return MODULE_ENV.resolveModuleRegistry(e||GLOBAL_SCOPE$3)}catch{}const t=fallbackCollectCandidateScopes(GLOBAL_SCOPE$3);for(let o=0;o<t.length;o+=1){const r=t[o];if(r&&typeof r.cineModules=="object")return r.cineModules}return null}function resolveModuleRegistry(e){if(ENVIRONMENT_CONTEXT&&typeof ENVIRONMENT_CONTEXT.resolveModuleRegistry=="function")try{const t=ENVIRONMENT_CONTEXT.resolveModuleRegistry(e||GLOBAL_SCOPE$3);if(t)return t}catch{}return fallbackResolveModuleRegistry(e)}const MODULE_REGISTRY=(function(){if(MODULE_GLOBALS&&typeof MODULE_GLOBALS.getModuleRegistry=="function")try{const e=MODULE_GLOBALS.getModuleRegistry(GLOBAL_SCOPE$3);if(e)return e}catch{}if(ENV_BRIDGE&&typeof ENV_BRIDGE.getModuleRegistry=="function")try{const e=ENV_BRIDGE.getModuleRegistry(GLOBAL_SCOPE$3);if(e)return e}catch{}if(MODULE_ENV&&typeof MODULE_ENV.getModuleRegistry=="function")try{const e=MODULE_ENV.getModuleRegistry(GLOBAL_SCOPE$3);if(e)return e}catch{}return resolveModuleRegistry()})(),PENDING_QUEUE_KEY=(function e(){if(MODULE_GLOBALS&&typeof MODULE_GLOBALS.getPendingQueueKey=="function")try{const t=MODULE_GLOBALS.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}if(ENV_BRIDGE&&typeof ENV_BRIDGE.getPendingQueueKey=="function")try{const t=ENV_BRIDGE.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return MODULE_ENV&&typeof MODULE_ENV.PENDING_QUEUE_KEY=="string"?MODULE_ENV.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function cloneOptions(e){if(!e||typeof e!="object")return{};const t={},o=Object.keys(e);for(let r=0;r<o.length;r+=1){const n=o[r];t[n]=e[n]}return t}function fallbackQueueModuleRegistration(e,t,o){if(!GLOBAL_SCOPE$3||typeof GLOBAL_SCOPE$3!="object")return!1;const r=Object.freeze({name:e,api:t,options:Object.freeze(cloneOptions(o))});let n=GLOBAL_SCOPE$3[PENDING_QUEUE_KEY];if(!Array.isArray(n))try{Object.defineProperty(GLOBAL_SCOPE$3,PENDING_QUEUE_KEY,{configurable:!0,enumerable:!1,writable:!0,value:[]}),n=GLOBAL_SCOPE$3[PENDING_QUEUE_KEY]}catch{try{Array.isArray(GLOBAL_SCOPE$3[PENDING_QUEUE_KEY])||(GLOBAL_SCOPE$3[PENDING_QUEUE_KEY]=[]),n=GLOBAL_SCOPE$3[PENDING_QUEUE_KEY]}catch{return!1}}try{n.push(r)}catch{n[n.length]=r}return!0}function queueModuleRegistration(e,t,o){if(MODULE_GLOBALS&&typeof MODULE_GLOBALS.queueModuleRegistration=="function")try{if(MODULE_GLOBALS.queueModuleRegistration(e,t,o,GLOBAL_SCOPE$3))return!0}catch{}if(ENV_BRIDGE&&typeof ENV_BRIDGE.queueModuleRegistration=="function")try{if(ENV_BRIDGE.queueModuleRegistration(e,t,o))return!0}catch{}return MODULE_ENV&&typeof MODULE_ENV.queueModuleRegistration=="function"?MODULE_ENV.queueModuleRegistration(e,t,o,GLOBAL_SCOPE$3):fallbackQueueModuleRegistration(e,t,o)}function fallbackRegisterOrQueue(e,t,o,r){if(MODULE_REGISTRY&&typeof MODULE_REGISTRY.register=="function")try{return MODULE_REGISTRY.register(e,t,o),!0}catch(n){if(typeof r=="function")try{r(n)}catch{}}return queueModuleRegistration(e,t,o),!1}const registerOrQueueModule=(function e(){return MODULE_GLOBALS&&typeof MODULE_GLOBALS.registerOrQueueModule=="function"?function(o,r,n,a){try{if(MODULE_GLOBALS.registerOrQueueModule(o,r,n,a,GLOBAL_SCOPE$3,MODULE_REGISTRY))return!0}catch{}return fallbackRegisterOrQueue(o,r,n,a)}:ENV_BRIDGE&&typeof ENV_BRIDGE.registerOrQueueModule=="function"?function(o,r,n,a){try{if(ENV_BRIDGE.registerOrQueueModule(o,r,n,a,GLOBAL_SCOPE$3,MODULE_REGISTRY))return!0}catch{}return fallbackRegisterOrQueue(o,r,n,a)}:MODULE_ENV&&typeof MODULE_ENV.registerOrQueueModule=="function"?function(o,r,n,a){return MODULE_ENV.registerOrQueueModule(o,r,n,a,GLOBAL_SCOPE$3,MODULE_REGISTRY)}:fallbackRegisterOrQueue})();function isNodeProcessReference(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const o=Function.prototype.toString.call(e);if(o&&o.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function shouldBypassDeepFreeze(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(isNodeProcessReference(e)||typeof process<"u"&&process&&process.release&&e===process.release)return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function fallbackResolveSeenTracker(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(o){return e.indexOf(o)!==-1},add(o){e.indexOf(o)===-1&&e.push(o)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(o){return t.indexOf(o)!==-1},add(o){t.indexOf(o)===-1&&t.push(o)}}}function fallbackFreezeDeep(e,t){if(!e||typeof e!="object"||shouldBypassDeepFreeze(e))return e;if(typeof process<"u"&&process&&define_process_env_default&&define_process_env_default.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const o=fallbackResolveSeenTracker(t);if(o.has(e))return e;o.add(e);const r=Object.getOwnPropertyNames(e);for(let n=0;n<r.length;n+=1){const a=r[n];let s;try{s=e[a]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||fallbackFreezeDeep(s,o)}try{return Object.freeze(e)}catch{return e}}function ensureFrozen(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return e;let t=e;if(typeof Object.freeze=="function")try{t=Object.freeze(t)}catch{}let o=!1;if(typeof Object.isFrozen=="function")try{o=Object.isFrozen(t)}catch{o=!1}if(o)return t;try{const r=Object.getOwnPropertyNames(t);for(let n=0;n<r.length;n+=1){const a=r[n],s=Object.getOwnPropertyDescriptor(t,a);s&&(Object.prototype.hasOwnProperty.call(s,"value")?(s.configurable||s.writable)&&Object.defineProperty(t,a,{configurable:!1,enumerable:s.enumerable,writable:!1,value:s.value}):s.configurable&&Object.defineProperty(t,a,{configurable:!1,enumerable:s.enumerable,get:s.get,set:s.set}))}if(typeof Object.preventExtensions=="function")try{Object.preventExtensions(t)}catch(n){}}catch{}return t}const freezeDeep=(function e(){return MODULE_GLOBALS&&typeof MODULE_GLOBALS.freezeDeep=="function"?MODULE_GLOBALS.freezeDeep:ENV_BRIDGE&&typeof ENV_BRIDGE.freezeDeep=="function"?function(o,r){try{return ENV_BRIDGE.freezeDeep(o,r)}catch{return fallbackFreezeDeep(o,r)}}:MODULE_ENV&&typeof MODULE_ENV.freezeDeep=="function"?MODULE_ENV.freezeDeep:fallbackFreezeDeep})();function fallbackSafeWarn(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const safeWarn$1=(function e(){return MODULE_GLOBALS&&typeof MODULE_GLOBALS.safeWarn=="function"?MODULE_GLOBALS.safeWarn:ENV_BRIDGE&&typeof ENV_BRIDGE.safeWarn=="function"?function(o,r){try{ENV_BRIDGE.safeWarn(o,r)}catch{fallbackSafeWarn(o,r)}}:MODULE_ENV&&typeof MODULE_ENV.safeWarn=="function"?MODULE_ENV.safeWarn:fallbackSafeWarn})();function fallbackExposeGlobal(e,t){if(!GLOBAL_SCOPE$3||typeof GLOBAL_SCOPE$3!="object")return!1;try{return Object.defineProperty(GLOBAL_SCOPE$3,e,{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{try{return GLOBAL_SCOPE$3[e]=t,!0}catch{return!1}}}const exposeGlobal=(function e(){return MODULE_GLOBALS&&typeof MODULE_GLOBALS.exposeGlobal=="function"?function(o,r,n){try{return MODULE_GLOBALS.exposeGlobal(o,r,n)}catch{return fallbackExposeGlobal(o,r)}}:ENV_BRIDGE&&typeof ENV_BRIDGE.exposeGlobal=="function"?function(o,r,n){try{return ENV_BRIDGE.exposeGlobal(o,r,n)}catch{return fallbackExposeGlobal(o,r)}}:MODULE_ENV&&typeof MODULE_ENV.exposeGlobal=="function"?function(o,r,n){return MODULE_ENV.exposeGlobal(o,r,GLOBAL_SCOPE$3,n)}:fallbackExposeGlobal})(),controllerRegistry=new Map,interactionRegistry=new Map,orchestrationRegistry=new Map,WARNED_NAMES=new Set;function normalizeName(e){if(typeof e=="string"&&e.trim())return e.trim();throw new TypeError("cineUi registry names must be non-empty strings.")}function cloneFunction(e){return typeof e!="function"?null:function(){return e.apply(this,arguments)}}function sanitizeDescriptor(e,t){if(!t||typeof t!="object")throw new TypeError(`cineUi controller "${e}" requires a descriptor object.`);const o={},r={},n=Object.getOwnPropertyNames(t);for(let d=0;d<n.length;d+=1){const m=n[d],y=t[m];if(typeof y=="function"){o[m]=cloneFunction(y);continue}if(m==="context"&&y&&typeof y=="object"){const h=Object.getOwnPropertyNames(y);for(let b=0;b<h.length;b+=1){const v=h[b];r[v]=y[v]}continue}r[m]=y}const a=Object.getOwnPropertyNames(o);if(!a.length)throw new Error(`cineUi controller "${e}" did not provide any callable actions.`);const s=Object.create(null),l=Object.getOwnPropertyNames(r);for(let d=0;d<l.length;d+=1){const m=l[d];s[m]=r[m]}ensureFrozen(s);const u={};Object.defineProperty(u,"context",{configurable:!1,enumerable:!0,get(){return s}});for(let d=0;d<a.length;d+=1){const m=a[d],y=o[m];u[m]=function(){return y.apply(u,arguments)}}return ensureFrozen(freezeDeep(u))}function sanitizeInteraction(e,t){const o=cloneFunction(t);if(!o)throw new TypeError(`cineUi interaction "${e}" must be a function.`);return ensureFrozen(freezeDeep({handler:o}))}function sanitizeInitializer(e,t){const o=cloneFunction(t);if(!o)throw new TypeError(`cineUi initializer "${e}" must be a function.`);return ensureFrozen(freezeDeep({initializer:o}))}function warnDuplicate(e,t){const o=`${t}:${e}`;WARNED_NAMES.has(o)||(WARNED_NAMES.add(o),safeWarn$1(`cineUi ${t} "${e}" was replaced. Using the latest registration.`))}function listRegistryKeys(e){return Array.from(e.keys()).sort()}const controllersAPI=freezeDeep({register(e,t){const o=normalizeName(e),r=sanitizeDescriptor(o,t);return controllerRegistry.has(o)&&warnDuplicate(o,"controller"),controllerRegistry.set(o,r),r},get(e){const t=normalizeName(e);return controllerRegistry.get(t)||null},invoke(e,t,...o){const r=this.get(e);if(!r)throw new Error(`cineUi controller "${e}" is not registered.`);const n=r[t];if(typeof n!="function")throw new Error(`cineUi controller "${e}" does not expose "${t}".`);return n.apply(r,o)},list(){return listRegistryKeys(controllerRegistry)},has(e){const t=normalizeName(e);return controllerRegistry.has(t)}}),interactionsAPI=freezeDeep({register(e,t){const o=normalizeName(e),r=sanitizeInteraction(o,t);return interactionRegistry.has(o)&&warnDuplicate(o,"interaction"),interactionRegistry.set(o,r),r.handler},get(e){const t=normalizeName(e),o=interactionRegistry.get(t);return o?o.handler:null},trigger(e,...t){const o=this.get(e);if(typeof o!="function")throw new Error(`cineUi interaction "${e}" is not registered.`);return o.apply(null,t)},list(){return listRegistryKeys(interactionRegistry)},has(e){const t=normalizeName(e);return interactionRegistry.has(t)}}),orchestrationAPI=freezeDeep({register(e,t){const o=normalizeName(e),r=sanitizeInitializer(o,t);return orchestrationRegistry.has(o)&&warnDuplicate(o,"initializer"),orchestrationRegistry.set(o,r),r.initializer},get(e){const t=normalizeName(e),o=orchestrationRegistry.get(t);return o?o.initializer:null},run(e,...t){const o=this.get(e);if(typeof o!="function")throw new Error(`cineUi initializer "${e}" is not registered.`);return o.apply(null,t)},list(){return listRegistryKeys(orchestrationRegistry)},has(e){const t=normalizeName(e);return orchestrationRegistry.has(t)}});function resolveHelpModule(e){const t=[];if(typeof tryRequire=="function"){const r=tryRequire("./help.js");r&&typeof r=="object"&&t.push(r)}const o=fallbackCollectCandidateScopes(e);for(let r=0;r<o.length;r+=1){const n=o[r];if(n){try{const a=n.cineHelpModule;a&&t.indexOf(a)===-1&&t.push(a)}catch{}try{const a=n.cineHelp;if(a){let s=!1;for(let l=0;l<t.length;l+=1){const u=t[l];if(u===a||u&&u.help===a){s=!0;break}}s||t.push({help:a,__internal:null})}}catch{}}}for(let r=0;r<t.length;r+=1){const n=t[r];if(!n)continue;const a=n.help||n;if(a&&typeof a.register=="function"&&typeof a.get=="function"&&typeof a.resolve=="function"&&typeof a.list=="function")return!n.help&&a?{help:a,__internal:n.__internal||null}:n}for(let r=0;r<o.length;r+=1){const n=o[r];if(n)try{const a=n.__cineCreateHelpModule;if(typeof a=="function"){const s=a({freezeDeep,safeWarn:safeWarn$1});if(s&&typeof s=="object")return s}}catch(a){safeWarn$1("cineUi: Failed to create help module from factory.",a)}}return null}const resolvedHelpModule=resolveHelpModule(GLOBAL_SCOPE$3),fallbackHelpRegistry=new Map,helpAPI=resolvedHelpModule&&resolvedHelpModule.help?resolvedHelpModule.help:freezeDeep({register(e,t){const o=typeof e=="string"?e.trim():"";if(!o)throw new TypeError("cineUi registry names must be non-empty strings.");if(typeof t=="function")return fallbackHelpRegistry.set(o,t),t;if(typeof t!="string")throw new TypeError(`cineUi help entry "${o}" must be a string or function.`);const r=t.trim();if(!r)throw new Error(`cineUi help entry "${o}" cannot be empty.`);const n=function(){return r};return fallbackHelpRegistry.set(o,n),n},get(e){const t=typeof e=="string"?e.trim():"";if(!t)throw new TypeError("cineUi registry names must be non-empty strings.");return fallbackHelpRegistry.get(t)||null},resolve(e,...t){const o=this.get(e);if(typeof o!="function")throw new Error(`cineUi help entry "${e}" is not registered.`);return o.apply(null,t)},list(){return typeof listRegistryKeys=="function"?listRegistryKeys(fallbackHelpRegistry):Array.from(fallbackHelpRegistry.keys()).sort()},has(e){const t=typeof e=="string"?e.trim():"";return t?fallbackHelpRegistry.has(t):!1}}),helpModuleInternals=resolvedHelpModule&&resolvedHelpModule.__internal?resolvedHelpModule.__internal:freezeDeep({helpRegistry:fallbackHelpRegistry,clearRegistries(){fallbackHelpRegistry.clear()}});function clearRegistries(){if(controllerRegistry.clear(),interactionRegistry.clear(),orchestrationRegistry.clear(),WARNED_NAMES.clear(),helpModuleInternals&&typeof helpModuleInternals.clearRegistries=="function")try{helpModuleInternals.clearRegistries()}catch(e){safeWarn$1("cineUi: Unable to clear help registry.",e)}else helpModuleInternals&&helpModuleInternals.helpRegistry&&typeof helpModuleInternals.helpRegistry.clear=="function"&&helpModuleInternals.helpRegistry.clear()}const uiAPI={controllers:controllersAPI,interactions:interactionsAPI,orchestration:orchestrationAPI,help:helpAPI,__internal:{controllerRegistry,interactionRegistry,orchestrationRegistry,helpRegistry:helpModuleInternals&&helpModuleInternals.helpRegistry?helpModuleInternals.helpRegistry:fallbackHelpRegistry,clearRegistries}};freezeDeep(uiAPI);informModuleGlobals("cineUi",uiAPI);registerOrQueueModule("cineUi",uiAPI,{category:"ui",description:"UI controller registry for dialogs, interactions, orchestration, and help copy.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineHelp","cineModuleContext"]},e=>{safeWarn$1("Unable to register cineUi module.",e)});if(GLOBAL_SCOPE$3&&typeof GLOBAL_SCOPE$3=="object"){let e=null;try{e=GLOBAL_SCOPE$3.cineUi||null}catch{e=null}e!==uiAPI&&(exposeGlobal("cineUi",uiAPI,{configurable:!0,enumerable:!1,writable:!1})||safeWarn$1("Unable to expose cineUi globally."))}function flushRegistrationQueue(){if(!GLOBAL_SCOPE$3||typeof GLOBAL_SCOPE$3!="object")return;const e="__cineUiReadyQueue",t=Array.isArray(GLOBAL_SCOPE$3[e])?GLOBAL_SCOPE$3[e]:null;if(!t||t.length===0)return;const o=t.slice();t.length=0;for(let r=0;r<o.length;r+=1){const n=o[r];if(typeof n=="function")try{n(uiAPI)}catch(a){safeWarn$1("cineUi registration callback failed.",a)}}}flushRegistrationQueue();function dispatchReadyEvent(){const e=[];if(GLOBAL_SCOPE$3&&typeof GLOBAL_SCOPE$3.dispatchEvent=="function"&&e.push(GLOBAL_SCOPE$3),typeof window<"u"&&window&&typeof window.dispatchEvent=="function"&&e.indexOf(window)===-1&&e.push(window),!!e.length)for(let t=0;t<e.length;t+=1){const o=e[t];let r=null;if(typeof Event=="function")try{r=new Event("cine-ui-ready")}catch{r=null}if(!r){const n=o&&o.document;if(n&&typeof n.createEvent=="function")try{const a=n.createEvent("Event");a.initEvent("cine-ui-ready",!1,!1),r=a}catch{r=null}}if(r)try{o.dispatchEvent(r)}catch(n){safeWarn$1("Unable to dispatch cine-ui-ready event.",n)}}}dispatchReadyEvent();typeof module<"u"&&module&&module.exports&&(module.exports=uiAPI);if(typeof document<"u"){let e=function(R){for(var _=R;_&&_!==document&&_!==document.body;){if(_.classList&&_.classList.contains("form-row"))return _;_=_.parentNode}return null},t=function(R){return R?typeof R.closest=="function"?R.closest(".form-row"):e(R):null},o=function(R){R&&(R.removeEventListener("change",A),R.removeEventListener("input",A))},r=function(R){R&&(R.addEventListener("change",A),R.addEventListener("input",A))},n=function(R){scenarioObserver&&scenarioObserverTarget!==R&&(scenarioObserver.disconnect(),scenarioObserver=null,scenarioObserverTarget=null),!(!R||typeof MutationObserver!="function")&&(scenarioObserver||(scenarioObserver=new MutationObserver(A)),scenarioObserverTarget!==R&&(scenarioObserver.disconnect(),scenarioObserver.observe(R,{attributes:!0,attributeFilter:["hidden","selected","value"],childList:!0,subtree:!0}),scenarioObserverTarget=R))},a=function(){var R=document.getElementById(SCENARIO_SELECT_ID);scenarioSelect!==R&&(o(scenarioSelect),scenarioSelect=R,r(scenarioSelect)),n(R)},s=function(R){R.observer&&R.observerTarget!==R.select&&(R.observer.disconnect(),R.observer=null,R.observerTarget=null),!(!R.select||typeof MutationObserver!="function")&&(R.observer||(R.observer=new MutationObserver(A)),R.observerTarget!==R.select&&(R.observer.disconnect(),R.observer.observe(R.select,{attributes:!0,attributeFilter:["hidden","selected","value"],childList:!0,subtree:!0}),R.observerTarget=R.select))},l=function(R){var _=document.getElementById(R.id);R.select!==_?(o(R.select),R.select=_,R.row=t(_),r(R.select)):(!R.row||R.row&&!R.row.contains(R.select))&&(R.row=t(R.select)),s(R)},u=function(){var R=document.getElementById(EDITOR_ID);editorElement!==R&&(editorObserver&&(editorObserver.disconnect(),editorObserver=null),editorElement=R,!(!R||typeof MutationObserver!="function")&&(editorObserver=new MutationObserver(A),editorObserver.observe(R,{attributes:!0,attributeFilter:["hidden"],childList:!0,subtree:!0})))},d=function(){a();for(var R=0;R<monitoringSelects.length;R+=1)l(monitoringSelects[R]);u()},m=function(R){return R==null?"":typeof R=="string"?R:String(R)},y=function(){var R=document.getElementById(CONDITION_LIST_ID);if(!R)return!1;for(var _=R.querySelectorAll("[data-condition]"),G=0;G<_.length;G+=1){var O=_[G];if(O){var B=O.getAttribute("data-condition");if(MONITORING_CONDITION_KEYS.indexOf(B)!==-1&&!O.hidden&&O.getAttribute("aria-hidden")!=="true")return!0}}return!1},h=function(R){if(!R)return!1;var _=R.selectedOptions||R.options;if(!_)return!1;for(var G=0;G<_.length;G+=1){var O=_[G];if(!(!O||!O.selected)){var B=m(O.value).trim();if(B.length>0)return!0;var $=m(O.textContent).trim();if($.length>0)return!0}}return!1},b=function(){for(var R=0;R<monitoringSelects.length;R+=1)if(h(monitoringSelects[R].select))return!0;return!1},v=function(){for(var R=y()||b(),_=0;_<monitoringSelects.length;_+=1){var G=monitoringSelects[_];if((!G.row||!G.select||!G.row.contains(G.select))&&(G.row=t(G.select)),G.row){var O=!R;G.row.hidden!==O&&(G.row.hidden=O)}}},C=function(){d(),v()},A=function(){updateTimer===null&&(updateTimer=setTimeout(function(){updateTimer=null,C()},0))},w=function(){C()};for(var SCENARIO_SELECT_ID="autoGearScenarios",MONITORING_SELECT_IDS=["autoGearVideoDistribution","autoGearMonitor","autoGearWireless"],MONITORING_CONDITION_KEYS=["videoDistribution","monitor","wireless"],CONDITION_LIST_ID="autoGearConditionList",EDITOR_ID="autoGearEditor",scenarioSelect=null,scenarioObserver=null,scenarioObserverTarget=null,monitoringSelects=[],editorElement=null,editorObserver=null,updateTimer=null,i=0;i<MONITORING_SELECT_IDS.length;i+=1)monitoringSelects.push({id:MONITORING_SELECT_IDS[i],select:null,row:null,observer:null,observerTarget:null});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w(),typeof window<"u"&&(window.autoGearMonitoringVisibility||(window.autoGearMonitoringVisibility={}),window.autoGearMonitoringVisibility.refresh=function(){C()})}var SETTINGS_DIALOG_ID="settingsDialog",SOURCE_NOTE_ID="gearListAutosaveNote",OVERLAY_NOTE_ID="gearListAutosaveOverlayNote",VISIBLE_CLASS="is-visible",dialog=null,overlay=null,sourceNote=null,lastText="",sourceObserver=null,dialogObserver=null,bodyObserver=null;function getDialog(){return typeof document>"u"?null:((!dialog||!document.contains(dialog))&&(dialog=document.getElementById(SETTINGS_DIALOG_ID)||null),dialog)}function ensureOverlay(e){return e?((!overlay||!e.contains(overlay))&&(overlay=e.querySelector("#"+OVERLAY_NOTE_ID)),overlay||(overlay=document.createElement("p"),overlay.id=OVERLAY_NOTE_ID,overlay.className="gear-list-autosave-note gear-list-autosave-note--overlay",overlay.setAttribute("role","status"),overlay.setAttribute("aria-live","polite"),overlay.setAttribute("aria-atomic","true"),overlay.hidden=!0,overlay.setAttribute("aria-hidden","true"),e.appendChild(overlay)),overlay):null}function hideOverlay(){overlay&&(overlay.textContent="",overlay.hidden=!0,overlay.setAttribute("aria-hidden","true"),overlay.classList&&overlay.classList.remove(VISIBLE_CLASS)),dialog&&dialog.classList&&dialog.classList.remove("has-gear-list-note")}function updateOverlayText(e){if(overlay){var t=e&&e.textContent?e.textContent:"";t!==lastText&&(lastText=t,overlay.textContent=t,t||hideOverlay())}}function updateOverlayVisibility(e){if(!(!overlay||!dialog)){if(!e||e.hidden||e.offsetParent===null){hideOverlay();return}if(!dialog.open){hideOverlay();return}overlay.hidden=!1,overlay.removeAttribute("aria-hidden"),overlay.classList&&overlay.classList.add(VISIBLE_CLASS),dialog.classList&&dialog.classList.add("has-gear-list-note")}}function observeSource(e){sourceObserver&&(sourceObserver.disconnect(),sourceObserver=null),!(!e||typeof MutationObserver!="function")&&(sourceObserver=new MutationObserver(function(){updateOverlayText(e),updateOverlayVisibility(e)}),sourceObserver.observe(e,{childList:!0,subtree:!0,characterData:!0,attributes:!0}))}function observeDialog(e){dialogObserver&&(dialogObserver.disconnect(),dialogObserver=null),!(!e||typeof MutationObserver!="function")&&(dialogObserver=new MutationObserver(function(){updateOverlayVisibility(sourceNote)}),dialogObserver.observe(e,{attributes:!0,attributeFilter:["open"]}))}function observeBody(){bodyObserver||typeof MutationObserver!="function"||(bodyObserver=new MutationObserver(function(){var e=document.getElementById(SOURCE_NOTE_ID);e!==sourceNote&&(sourceNote=e||null,observeSource(sourceNote),updateOverlayText(sourceNote),updateOverlayVisibility(sourceNote))}),bodyObserver.observe(document.body,{childList:!0,subtree:!0}))}function bindDialogEvents(e){if(!(!e||typeof e.addEventListener!="function")){var t=function(){updateOverlayVisibility(sourceNote)};e.addEventListener("close",t),e.addEventListener("cancel",t),e.addEventListener("submit",t)}}function bindLanguageChange(){typeof window>"u"||typeof window.addEventListener!="function"||window.addEventListener("languagechange",function(){sourceNote=document.getElementById(SOURCE_NOTE_ID)||null,updateOverlayText(sourceNote),updateOverlayVisibility(sourceNote)})}function setup(){if(!(typeof document>"u")){var e=getDialog();e&&(ensureOverlay(e),sourceNote=document.getElementById(SOURCE_NOTE_ID)||null,updateOverlayText(sourceNote),updateOverlayVisibility(sourceNote),observeDialog(e),observeSource(sourceNote),observeBody(),bindDialogEvents(e),bindLanguageChange())}}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",setup,{once:!0}):setup());const GLOBAL_SCOPE$2=typeof window<"u"?window:{},safeWarn=baseApi.safeWarn;function prefersReducedMotion(){if(!GLOBAL_SCOPE$2||typeof GLOBAL_SCOPE$2.matchMedia!="function")return!1;try{return GLOBAL_SCOPE$2.matchMedia("(prefers-reduced-motion: reduce)").matches===!0}catch{}return!1}function collectCandidateScopes(e){if(typeof baseApi.collectCandidateScopes=="function")try{return baseApi.collectCandidateScopes(e)}catch(t){safeWarn("cine.features.onboardingTour could not collect candidate scopes.",t)}return[e]}function resolveDocument(e){const t=collectCandidateScopes(e||GLOBAL_SCOPE$2);for(let o=0;o<t.length;o+=1){const r=t[o];if(r)try{if(r.document&&typeof r.document.getElementById=="function")return r.document}catch{}}return null}const DOCUMENT=resolveDocument(GLOBAL_SCOPE$2),PRIMARY_STORAGE_KEY="cinePowerPlanner_onboardingTutorial",LEGACY_STORAGE_KEYS=["cameraPowerPlanner_onboardingTutorial"],STORAGE_KEYS=[PRIMARY_STORAGE_KEY,...LEGACY_STORAGE_KEYS],SKIP_STATUS_KEY=`${PRIMARY_STORAGE_KEY}:skip`,WINDOW_NAME_SKIP_TOKEN=`${SKIP_STATUS_KEY}=true`,STORAGE_VERSION=2,OVERLAY_ID="onboardingTutorialOverlay",HELP_BUTTON_ID="helpOnboardingTutorialButton",HELP_TRIGGER_SELECTOR="[data-onboarding-tour-trigger]",HELP_STATUS_ID="helpOnboardingTutorialStatus",MAIN_ANCHOR_ID="mainContent",HEADER_ANCHOR_ID="topBar",HERO_MAX_WIDTH_REM=44,HERO_MARGIN_REM=1.5,HERO_MIN_VIEWPORT_FRACTION=.97,HERO_MARGIN_BREAKPOINTS=[{maxViewportRem:48,marginRem:1.15},{maxViewportRem:26,marginRem:.75}],KEYBOARD_HEIGHT_THRESHOLD=120,KEYBOARD_OFFSET_THRESHOLD=24;function resolveHeroMarginPx(e,t){const o=Number.isFinite(t)&&t>0?t:16;if(!Number.isFinite(e)||e<=0)return Math.max(0,HERO_MARGIN_REM*o);const r=e/o;let n=HERO_MARGIN_REM;if(Number.isFinite(r))for(let a=0;a<HERO_MARGIN_BREAKPOINTS.length;a+=1){const s=HERO_MARGIN_BREAKPOINTS[a];s&&Number.isFinite(s.maxViewportRem)&&r<=s.maxViewportRem&&(n=s.marginRem)}return Math.max(0,n*o)}const supportsDialogTopLayer=(function e(){if(!DOCUMENT||typeof DOCUMENT.createElement!="function"||(function(){if(!GLOBAL_SCOPE$2||!GLOBAL_SCOPE$2.navigator)return!1;const r=GLOBAL_SCOPE$2.navigator.userAgent||"",n=GLOBAL_SCOPE$2.navigator.vendor||"";return/Safari/.test(r)&&/Apple Computer/.test(n)&&!/Chrome|Chromium|Edg/.test(r)})())return!1;try{const o=DOCUMENT.createElement("dialog");return typeof o.show=="function"&&typeof o.close=="function"}catch{return!1}})(),DOM_POSITION_FOLLOWING=typeof Node<"u"&&Node?Node.DOCUMENT_POSITION_FOLLOWING:4,DOM_POSITION_PRECEDING=typeof Node<"u"&&Node?Node.DOCUMENT_POSITION_PRECEDING:2,FOCUSABLE_SELECTOR=["button:not([disabled])","a[href]",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[role="button"]:not([aria-disabled="true"])','[tabindex]:not([tabindex="-1"])'].join(",");function isElementFocusable(e){return!e||typeof e.matches!="function"||e.hasAttribute("disabled")||e.getAttribute&&e.getAttribute("aria-disabled")==="true"||e.hidden||typeof e.getAttribute=="function"&&e.getAttribute("hidden")!==null||typeof e.closest=="function"&&(e.closest('[aria-hidden="true"]')||e.closest("[hidden]"))?!1:e.matches(FOCUSABLE_SELECTOR)}function collectFocusableElements(e,t=!1){if(!e)return[];const o=[];if(t&&isElementFocusable(e)&&o.push(e),typeof e.querySelectorAll!="function")return o;const r=e.querySelectorAll(FOCUSABLE_SELECTOR);for(let n=0;n<r.length;n+=1){const a=r[n];isElementFocusable(a)&&o.push(a)}return o}function sortFocusableByDocumentOrder(e){return Array.isArray(e)?e.slice().sort((t,o)=>{if(!t||!o||t===o||typeof t.compareDocumentPosition!="function")return 0;const r=t.compareDocumentPosition(o);return r&DOM_POSITION_FOLLOWING?-1:r&DOM_POSITION_PRECEDING?1:0}):[]}function getRootFontSizePx(){if(!DOCUMENT||!DOCUMENT.documentElement)return 16;const e=DOCUMENT.documentElement;try{const o=e.ownerDocument&&e.ownerDocument.defaultView?e.ownerDocument.defaultView:DOCUMENT.defaultView||GLOBAL_SCOPE$2;if(o&&typeof o.getComputedStyle=="function"){const r=o.getComputedStyle(e);if(r&&typeof r.fontSize=="string"){const n=parseFloat(r.fontSize);if(Number.isFinite(n)&&n>0)return n}}}catch{}const t=e&&e.style&&typeof e.style.fontSize=="string"?parseFloat(e.style.fontSize):NaN;return Number.isFinite(t)&&t>0?t:16}function isDialogElement(e){return!!(e&&typeof e.nodeName=="string"&&e.nodeName.toLowerCase()==="dialog")}function bringOverlayToTopLayer(){if(overlayRoot&&!(overlayAnchor&&DOCUMENT&&overlayAnchor!==DOCUMENT.body)){if(overlayRoot.style&&(overlayRoot.style.pointerEvents="none"),supportsDialogTopLayer&&isDialogElement(overlayRoot)&&typeof overlayRoot.show=="function"){try{overlayRoot.open&&typeof overlayRoot.close=="function"&&overlayRoot.close()}catch{}try{overlayRoot.show(),overlayRoot.style&&(overlayRoot.style.pointerEvents="none")}catch(e){safeWarn("cine.features.onboardingTour could not refresh overlay top layer.",e)}return}if(overlayRoot.parentNode&&typeof overlayRoot.parentNode.appendChild=="function")try{overlayRoot.parentNode.appendChild(overlayRoot)}catch(e){safeWarn("cine.features.onboardingTour could not move overlay to front.",e)}}}function handleDialogToggle(e){if(!active||!e||!e.target)return;const t=e.target;t!==overlayRoot&&isDialogElement(t)&&t.open&&bringOverlayToTopLayer()}function getSafeLocalStorage$1(){try{if(typeof window<"u"&&window.localStorage)return window.localStorage;if(typeof localStorage<"u")return localStorage}catch{}return null}const SAFE_LOCAL_STORAGE$1=getSafeLocalStorage$1();function resolveStorage(){if(typeof getSafeLocalStorage$1=="function")try{const e=getSafeLocalStorage$1();if(e&&typeof e.getItem=="function")return e}catch(e){safeWarn("cine.features.onboardingTour could not access getSafeLocalStorage()",e)}if(typeof SAFE_LOCAL_STORAGE$1=="object"&&SAFE_LOCAL_STORAGE$1)return SAFE_LOCAL_STORAGE$1;try{if(typeof GLOBAL_SCOPE$2.localStorage=="object"&&GLOBAL_SCOPE$2.localStorage)return GLOBAL_SCOPE$2.localStorage}catch(e){safeWarn("cine.features.onboardingTour could not access window.localStorage.",e)}return null}const SAFE_STORAGE=resolveStorage();function pushUniqueStorage(e,t){if(!(!e||!Array.isArray(e))&&t){try{const o=typeof t.getItem=="function",r=typeof t.setItem=="function";if(!o&&!r)return}catch{return}e.indexOf(t)===-1&&e.push(t)}}function collectStorageCandidates(){const e=[];pushUniqueStorage(e,SAFE_STORAGE);try{if(typeof getSafeLocalStorage$1=="function"){const o=getSafeLocalStorage$1();pushUniqueStorage(e,o)}}catch{}typeof SAFE_LOCAL_STORAGE$1=="object"&&SAFE_LOCAL_STORAGE$1&&pushUniqueStorage(e,SAFE_LOCAL_STORAGE$1);const t=collectCandidateScopes(GLOBAL_SCOPE$2);for(let o=0;o<t.length;o+=1){const r=t[o];if(r){try{r.localStorage&&pushUniqueStorage(e,r.localStorage)}catch{}try{r.sessionStorage&&pushUniqueStorage(e,r.sessionStorage)}catch{}}}return e}function readWindowNameSkipFlag(){try{if(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.name=="string")return GLOBAL_SCOPE$2.name.indexOf(WINDOW_NAME_SKIP_TOKEN)!==-1}catch{}return!1}function writeWindowNameSkipFlag(e){try{if(!GLOBAL_SCOPE$2||typeof GLOBAL_SCOPE$2.name>"u")return!1;const o=(typeof GLOBAL_SCOPE$2.name=="string"?GLOBAL_SCOPE$2.name:"").split(";").map(n=>n.trim()).filter(Boolean).filter(n=>n.indexOf(`${SKIP_STATUS_KEY}=`)!==0);e&&o.push(WINDOW_NAME_SKIP_TOKEN);const r=o.join("; ");return GLOBAL_SCOPE$2.name=r,!0}catch{return!1}}function readSkipStatusPreference(){const e=collectStorageCandidates();for(let t=0;t<e.length;t+=1){const o=e[t];if(!(!o||typeof o.getItem!="function"))try{const r=o.getItem(SKIP_STATUS_KEY);if(r===null||typeof r>"u")continue;if(r===!0||r==="true")return!0;if(r===!1||r==="false")return!1;try{const n=JSON.parse(r);if(n===!0||n===!1)return n}catch(n){}}catch{}}return readWindowNameSkipFlag()?!0:null}function persistSkipStatus(e){const t=collectStorageCandidates();let o=!1;for(let n=0;n<t.length;n+=1){const a=t[n];if(a){if(e===!1&&typeof a.removeItem=="function")try{a.removeItem(SKIP_STATUS_KEY),o=!0;continue}catch{}if(typeof a.setItem=="function")try{a.setItem(SKIP_STATUS_KEY,e?"true":"false"),o=!0}catch{}}}const r=writeWindowNameSkipFlag(!!e);return o||r}let storedStateCache=null,storedStateCacheRaw=null,storedStateCacheSource=null;const deviceLibraryState={lastAdded:null,lastReviewed:null,lastUpdated:null},deviceLibrarySubscribers=[];function sanitizeDeviceDescriptor(e){if(!e||typeof e!="object")return null;const t=typeof e.name=="string"?e.name.trim():"",o=typeof e.category=="string"?e.category.trim():"";let r=null;if(typeof e.subcategory=="string"){const n=e.subcategory.trim();n&&(r=n)}return!t||!o?null:{name:t,category:o,subcategory:r}}function descriptorsMatch(e,t){if(!e||!t)return!1;const o=r=>typeof r=="string"?r.trim().toLowerCase():"";return o(e.name)===o(t.name)&&o(e.category)===o(t.category)&&o(e.subcategory||"")===o(t.subcategory||"")}function notifyDeviceLibrarySubscribers(){if(!deviceLibrarySubscribers.length)return;const e=deviceLibrarySubscribers.slice();for(let t=0;t<e.length;t+=1){const o=e[t];if(typeof o=="function")try{o(deviceLibraryState)}catch(r){safeWarn("cine.features.onboardingTour could not deliver device library update.",r)}}}function subscribeDeviceLibrary(e){return typeof e!="function"?()=>{}:(deviceLibrarySubscribers.push(e),()=>{const t=deviceLibrarySubscribers.indexOf(e);t!==-1&&deviceLibrarySubscribers.splice(t,1)})}DOCUMENT&&typeof DOCUMENT.addEventListener=="function"&&(DOCUMENT.addEventListener("device-library:add",e=>{const t=sanitizeDeviceDescriptor(e&&e.detail);deviceLibraryState.lastAdded=t,deviceLibraryState.lastReviewed=null,deviceLibraryState.lastUpdated=null,notifyDeviceLibrarySubscribers()}),DOCUMENT.addEventListener("device-library:show-details",e=>{const t=sanitizeDeviceDescriptor(e&&e.detail);deviceLibraryState.lastReviewed=t,notifyDeviceLibrarySubscribers()}),DOCUMENT.addEventListener("device-library:update",e=>{const t=sanitizeDeviceDescriptor(e&&e.detail),o=sanitizeDeviceDescriptor(e&&e.detail&&e.detail.original);!t&&!o?deviceLibraryState.lastUpdated=null:deviceLibraryState.lastUpdated={current:t,original:o},notifyDeviceLibrarySubscribers()}));function clone(e){if(typeof baseApi.freezeDeep=="function")try{return baseApi.freezeDeep(e)}catch(t){safeWarn("cine.features.onboardingTour could not deep-freeze value.",t)}return e}const DEFAULT_STEP_KEYS=["intro","userProfile","unitsPreferences","nameProject","saveProject","addCamera","addMonitoring","selectBattery","resultsTotalDraw","resultsBatteryPacks","resultsChangeover","resultsWarnings","batteryComparison","runtimeFeedback","connectionDiagram","connectionDiagramDetails","editDeviceDataAdd","editDeviceDataReview","editDeviceDataEdit","ownGearAccess","ownGearAddDevice","projectRequirementsAccess","projectRequirementsBrief","projectRequirementsCrew","projectRequirementsLogistics","generateGearAndRequirements","autoGearRulesAccess","autoGearRulesEdit","autoGearRulesCreate","gearList","exportImport","overviewAndPrint","help","settingsGeneral","settingsData","settingsBackup","completion"];function resolveOwnGearAccessHighlightSelectors(){if(!DOCUMENT)return[];if(!ownGearDialogRef&&typeof DOCUMENT.getElementById=="function")try{ownGearDialogRef=DOCUMENT.getElementById("ownGearDialog")}catch{ownGearDialogRef=null}let e=null;try{e=DOCUMENT.getElementById("sideMenu")}catch{e=null}let t=null;e&&typeof e.querySelector=="function"&&(t=e.querySelector('[data-sidebar-action="open-own-gear"]')),!t&&typeof DOCUMENT.querySelector=="function"&&(t=DOCUMENT.querySelector('#sideMenu [data-sidebar-action="open-own-gear"]')||DOCUMENT.querySelector('[data-sidebar-action="open-own-gear"]'));let o=null;try{o=DOCUMENT.getElementById("menuToggle")}catch{o=null}const r=!!(e&&typeof e.classList=="object"&&typeof e.classList.contains=="function"&&e.classList.contains("open")),n=[],a=s=>{typeof s!="string"||!s||n.indexOf(s)===-1&&n.push(s)};if(ownGearDialogRef&&typeof isOwnGearDialogVisible=="function"){let s=!1;try{s=isOwnGearDialogVisible()}catch(l){safeWarn("cine.features.onboardingTour could not determine Own Gear dialog highlight state.",l)}s&&a("#ownGearDialog")}return r&&t?a('#sideMenu [data-sidebar-action="open-own-gear"]'):!r&&o?a("#menuToggle"):t?a('#sideMenu [data-sidebar-action="open-own-gear"]'):o&&a("#menuToggle"),n}const DEFAULT_STEP_TEXTS={intro:{title:"",body:"",hero:{heading:"Step 1 · Welcome aboard",subheading:"Power planning without losing data",summary:"Preview how Cine Power Planner protects work-in-progress before you add your first camera. The tour keeps progress local, explains every safety net and helps you confirm each safeguard.",badgeIcon:"",badgeLabel:"Offline-first & private",badgeDescription:"No servers, no accounts, no risk. Saves, autosaves, backups, restores, shares and imports never leave this device.",highlights:[{icon:"",title:"Lock in power, safety, and backups",body:"Model draw, runtime, changeovers, and redundant pack coverage so battery safety margins are confirmed before rolling."},{icon:"",title:"AutoGear builds reusable kits",body:"Generate full gear lists from shooting scenarios with AutoGear rules, adjust those rules for the day, and reuse the presets."},{icon:"",title:"Project requirements ready to hand off",body:"Track requirements, crew coverage, and rental notes, then export PDF packets the crew, rental, and production rely on."}],languageLabel:"Choose your language",languageHint:"Switch languages now—the tutorial, help and exports update instantly across offline saves.",offlineSummary:"Install the Cine Power Planner PWA to mirror safeguarded saves, backups, shares and restore rehearsals on set without subscriptions."}},userProfile:{title:"Complete your crew profile",body:"Set your display name, role, phone, email and photo. Every update syncs to Contacts immediately, stays in offline saves and appears on exports."},unitsPreferences:{title:"Tune theme and units",body:"Open Settings → General to choose the theme, optional pink highlights, focus scale and temperature units. Request persistent storage so the browser keeps preferences and safeguards saves during cleanups."},nameProject:{title:"Name your first project",body:"Give the project a descriptive name to anchor autosave, history, exports and backups. Every workflow references it so your offline library stays organized and easy to restore."},saveProject:{title:"Capture an immediate save",body:"Select Save (or press Ctrl+S/⌘S/Enter) to capture a complete offline snapshot—devices, power math, requirements, notes and diagnostics. The next workflow unlocks once the save finishes."},addCamera:{title:"Select the primary camera",body:"Choose the camera body you are planning. Offline search works inside the menu. That selection unlocks matching accessories, power draws and diagrams."},addMonitoring:{title:"Add monitors, wireless video and FIZ",body:"Pick onboard monitors, wireless transmitters and FIZ motors or controllers. Each selection feeds runtime math, diagrams and automatic gear rules so the generated kit reflects the full build."},selectBattery:{title:"Choose batteries",body:"Select the battery system that powers the rig. Runtime projections update immediately and the selection is stored with your offline project snapshots and backups."},resultsTotalDraw:{title:"Power Summary: Total draw",body:"Start your Power Summary review by confirming the Total Draw card and peak load so the demand math stays accurate before moving on to deeper checks."},resultsBatteryPacks:{title:"Power Summary: Battery runtimes",body:"Review each battery pack's projected runtime, all framed around a worst-case draw so most kits run longer—helping you know how many packs to bring, feel confident the rig won't demand constant swaps, and automatically pair the right batteries with each camera."},resultsChangeover:{title:"Power Summary: Changeovers",body:"Step through the changeover list to check remaining runtime, confirm the next charged pack is staged and mark swaps as complete so the saved snapshot reflects the current handoff plan."},resultsWarnings:{title:"Power Summary: Warnings and backups",body:"Check the connector warning boxes: green shows the pin or D-Tap battery feed is safe, yellow means the battery feed is near its limit, and red means the camera rig is pulling more power than the battery can supply."},batteryComparison:{title:"Battery Comparison",body:"Battery Comparison evaluates alternate packs side by side so you can lock in the safest runtime margin. The table shows which batteries can power the rig—green pins and D-Tap feeds are safe, orange pins-only outputs cover the rig without D-Tap support—and how long each pack runs."},runtimeFeedback:{title:"Submit runtime feedback",body:"Use the runtime feedback button to log real-world results. Entries sync with the current project, strengthen future estimates and remain available offline for audits."},connectionDiagram:{title:"Inspect the connection diagram",body:"The interactive diagram shows how power, video and control gear connect. Drag nodes to plan rig layout, double-click devices to pop open hover details, then save so the arrangement and annotations persist across exports and restores."},connectionDiagramDetails:{title:"Open device hover details",body:"Double-click any device node in the diagram to reveal its hover detail popup. Review draw notes, connector callouts and saved annotations, then close it to continue arranging the layout before saving."},editDeviceDataAdd:{title:"Add a device to the library",body:"Open Device Library, pick a category, name the item and record its draw or connector data. Press Add so the new device is stored offline, included in autosave and ready for backups and exports."},editDeviceDataReview:{title:"Review the device details",body:"Find the device you just saved inside Existing Devices and open its details. Confirm the draw, outputs and compatibility metadata look correct before relying on it in runtime math or shares."},editDeviceDataEdit:{title:"Update and resave the device",body:"Use the Edit button on that same entry, adjust specs or notes, then save. This verifies autosave, backups and exports all carry the most current numbers without risking any loss of user data."},ownGearAccess:{title:"Open the Own Gear dialog",body:"Press the Own Gear button in the sidebar to launch your inventory dialog, then review the summary banner and the Your gear list so you know where saved items, edit buttons and counts live. Finish by exploring the Add gear form—item search, quantity, notes, plus the Save and Reset controls—so you can add equipment instantly once the tour ends."},ownGearAddDevice:{title:"Add your first owned device",body:"Enter the item name, optional quantity and notes, then save. Owned gear is stored offline, included in backups and marked inside exports so teams instantly see what is available without duplicating requests."},projectRequirementsAccess:{title:"Open Project Requirements from Generate",body:"Press Generate Gear List and Project Requirements to open the requirements form. This confirms the dialog opens from the standard trigger while autosave and backups keep your data safe."},projectRequirementsBrief:{title:"Capture the project brief",body:"Open the Project Requirements dialog from Generate Gear List and Project Requirements, then document production company, address, rental preferences, deliverables and schedule notes. These entries auto-fill rental-ready PDFs, stay cached offline and seed the next sections."},projectRequirementsCrew:{title:"Map crew coverage and contacts",body:"Populate Crew, Prep, Shooting and Return rows with names, roles and coverage notes. Link saved Contacts, flag emergency details and duplicate rows when multiple days share the same assignments. Everything syncs to the saved project so exports list who is on set and when."},projectRequirementsLogistics:{title:"Log lenses, rigging and monitoring plans",body:"Work down the remaining sections—camera specs, lens workflow, rigging scenarios, storage/media counts, matte box, tripod and monitoring preferences. Each field feeds automatic gear rules, storage math and monitoring assignments so the generated checklist reflects the full shoot plan."},generateGearAndRequirements:{title:"Save and rebuild the outputs",body:"Press OK inside the Project Requirements dialog to save every entry, regenerate the requirements summary and rebuild the categorized gear list. The planner snapshots the result with the active project so exports, backups and shares stay current."},autoGearRulesAccess:{title:"Open Automatic Gear Rules",body:"Go to Settings → Automatic Gear Rules to review automation controls. Opening the tab shows the presets, stock rules (including smart tripod logic that references your head/legs preference) and safety backups stored with your offline saves."},autoGearRulesEdit:{title:"Edit stock automatic gear rules",body:"Use the rules list to inspect factory additions. Select a stock rule to open it in the editor, adjust items or conditions, then save so the updated automation stays cached with backups and share bundles."},autoGearRulesCreate:{title:"Add a new automatic gear rule",body:"Press Add rule to create a custom automation. Name it, add conditions and required gear, then save. The planner runs new rules offline each time you regenerate the kit and includes them in exports, shares and backups."},gearList:{title:"Audit the generated gear list",body:"Check the categorized gear list for duplicates, counts and auto-added accessories. Edits save instantly, are included in share bundles and appear in printouts and PDFs."},exportImport:{title:"Export and import projects",body:"Use Export Project to download a JSON safety copy and Import Project to rehearse restores. Store exports on redundant media so no workstation loses data if a browser profile resets."},overviewAndPrint:{title:"Generate overview, PDF and printouts",body:"Generate the project overview to access PDF, print and share-ready summaries. The dialog uses saved data only, so you can print or export even while fully offline."},help:{title:"Open the Help center",body:"The Help dialog includes searchable documentation, translation notes and onboarding references. Keep it pinned while working—articles stay cached offline and update when new features arrive."},settingsGeneral:{title:"Revisit Settings → General",body:"Adjust language, typography, theme, pink mode, focus scale and other presentation options anytime. Preferences save locally, sync across projects and are bundled with backups."},settingsData:{title:"Monitor Data & Storage",body:"Use the Data & Storage tab to request persistent storage, watch save timestamps and launch quick safeguards. These controls verify that every project snapshot remains available offline."},settingsBackup:{title:"Maintain Backup & Restore",body:"The Backup & Restore tab manages full-app exports, restore rehearsals and diagnostics. Run backups before major changes, archive the files on external media and verify restores regularly."},completion:{title:"Tutorial complete",body:"You now know every safeguard. Keep saving often, export redundant backups and revisit any step from Help whenever you want a refresher. Cine Power Planner will keep protecting your data offline."}};function isPrefaceStep(e){return!!(e&&e.preface)}function isCompletionStep(e){return!!(e&&e.key==="completion")}function isCountableStep(e){return!!(e&&!isPrefaceStep(e)&&!isCompletionStep(e))}function getCountableStepTotal(e){if(!Array.isArray(e))return 0;let t=0;for(let o=0;o<e.length;o+=1)isCountableStep(e[o])&&(t+=1);return t}function getCountableStepIndex(e,t){if(!Array.isArray(e)||typeof t!="number"||t<0||t>=e.length||!isCountableStep(e[t]))return null;let o=-1;for(let r=0;r<=t;r+=1)isCountableStep(e[r])&&(o+=1);return o}function getCountableCompletedCount(e,t){if(!Array.isArray(e)||!t||typeof t.has!="function")return 0;let o=0;for(let r=0;r<e.length;r+=1){const n=e[r];isCountableStep(n)&&t.has(n.key)&&(o+=1)}return o}function getNextCountableStep(e,t){if(!Array.isArray(e))return null;for(let o=0;o<e.length;o+=1){const r=e[o];if(isCountableStep(r)&&(!t||typeof t.has!="function"||!t.has(r.key)))return r}return null}function getElement(e){if(typeof e!="string"||!e)return null;try{return DOCUMENT.querySelector(e)}catch(t){return safeWarn("cine.features.onboardingTour could not query selector.",t),null}}function getFieldValue(e){return e?typeof e.value=="string"?e.value:typeof e.textContent=="string"?e.textContent:"":""}function createFieldCompletionRequirement(e,t,o){const r=Array.isArray(o)&&o.length?o:["input","change"];return{check(){const n=getElement(e);if(!n)return!1;try{return!!t(getFieldValue(n),n)}catch(a){return safeWarn("cine.features.onboardingTour could not evaluate field requirement.",a),!1}},attach(n){const a=getElement(e);if(!a)return typeof n.complete=="function"&&n.complete(),()=>{};const s=()=>{let l=!1;try{l=!!t(getFieldValue(a),a)}catch(u){safeWarn("cine.features.onboardingTour could not evaluate field change.",u),l=!1}l?typeof n.complete=="function"&&n.complete():typeof n.incomplete=="function"&&n.incomplete()};for(let l=0;l<r.length;l+=1){const u=r[l];a.addEventListener(u,s)}return s(),()=>{for(let l=0;l<r.length;l+=1){const u=r[l];a.removeEventListener(u,s)}}}}}function createClickCompletionRequirement(e,t){const o=Array.isArray(e)?e.slice():[e],r="click";return{check(){return!1},attach(n){const a=[];let s=!1;for(let l=0;l<o.length;l+=1){const u=o[l],d=getElement(u);if(!d)continue;s=!0;const m=()=>{typeof n.complete=="function"&&n.complete()};d.addEventListener(r,m),a.push(()=>{d.removeEventListener(r,m)})}return!s&&typeof n.complete=="function"&&n.complete(),()=>{for(let l=0;l<a.length;l+=1)try{a[l]()}catch(u){safeWarn("cine.features.onboardingTour could not detach click requirement.",u)}}}}}function createProjectDialogSubmitRequirement(){const e="#projectForm";return{check(){return!1},attach(t){const o=getElement(e);if(!o)return typeof t.complete=="function"&&t.complete(),null;typeof t.incomplete=="function"&&t.incomplete();const r=()=>{typeof t.complete=="function"&&t.complete()};return o.addEventListener("submit",r),()=>{try{o.removeEventListener("submit",r)}catch(n){safeWarn("cine.features.onboardingTour could not detach project dialog submit requirement.",n)}}}}}function createDeviceLibraryRequirement(e){const t=typeof e=="function"?e:(()=>!1);return{check(){try{return!!t()}catch(o){return safeWarn("cine.features.onboardingTour could not evaluate device library requirement.",o),!1}},attach(o){const r=()=>{let a=!1;try{a=!!t()}catch(s){safeWarn("cine.features.onboardingTour could not evaluate device library change.",s),a=!1}a?typeof o.complete=="function"&&o.complete():typeof o.incomplete=="function"&&o.incomplete()},n=subscribeDeviceLibrary(r);return r(),()=>{typeof n=="function"&&n()}}}}function createDeviceLibraryAddRequirement(){return createDeviceLibraryRequirement(()=>!!deviceLibraryState.lastAdded)}function createDeviceLibraryReviewRequirement(){return createDeviceLibraryRequirement(()=>{const e=deviceLibraryState.lastAdded,t=deviceLibraryState.lastReviewed;return!e||!t?!1:descriptorsMatch(e,t)})}function createDeviceLibraryEditRequirement(){return createDeviceLibraryRequirement(()=>{const e=deviceLibraryState.lastAdded,t=deviceLibraryState.lastUpdated;if(!e||!t)return!1;const o=t.current?descriptorsMatch(e,t.current):!1,r=t.original?descriptorsMatch(e,t.original):!1;return o||r})}function evaluateOwnGearOpenState(){try{return isOwnGearDialogVisible()}catch(e){return safeWarn("cine.features.onboardingTour could not evaluate Own Gear dialog visibility.",e),!1}}function createOwnGearOpenRequirement(){return{check(){return evaluateOwnGearOpenState()},attach({complete:e,incomplete:t}){const o=getElement("#ownGearDialog");if(!o)return null;let r=null;const n=()=>{evaluateOwnGearOpenState()?e():t()};if(n(),typeof MutationObserver=="function")try{r=new MutationObserver(()=>{n()}),r.observe(o,{attributes:!0,attributeFilter:["open","hidden","aria-hidden"]})}catch(u){safeWarn("cine.features.onboardingTour could not observe Own Gear dialog attributes.",u),r=null}const a=()=>{n()};o.addEventListener("close",a),o.addEventListener("cancel",a);const s=getElement('[data-sidebar-action="open-own-gear"]'),l=()=>{setTimeout(n,100)};return s&&s.addEventListener("click",l),()=>{if(o.removeEventListener("close",a),o.removeEventListener("cancel",a),s&&s.removeEventListener("click",l),r)try{r.disconnect()}catch(u){safeWarn("cine.features.onboardingTour could not disconnect Own Gear dialog observer.",u)}}}}}function createProjectRequirementsAccessRequirement(){return{check(){return!evaluateOwnGearOpenState()&&isProjectDialogVisible()},attach({complete:e,incomplete:t}){const o=[],r=()=>{!evaluateOwnGearOpenState()&&isProjectDialogVisible()?e():t()},n=getElement("#ownGearDialog");if(n){const l=()=>{setTimeout(r,75)};if(n.addEventListener("close",l),n.addEventListener("cancel",l),o.push(()=>{n.removeEventListener("close",l),n.removeEventListener("cancel",l)}),typeof MutationObserver=="function")try{const u=new MutationObserver(()=>{r()});u.observe(n,{attributes:!0,attributeFilter:["open","hidden","aria-hidden"]}),o.push(()=>{u.disconnect()})}catch(u){safeWarn("cine.features.onboardingTour could not observe Own Gear dialog state for project requirements access.",u)}}const a=getElement("#projectDialog");if(a){const l=()=>{setTimeout(r,75)};if(a.addEventListener("close",l),a.addEventListener("cancel",l),o.push(()=>{a.removeEventListener("close",l),a.removeEventListener("cancel",l)}),typeof MutationObserver=="function")try{const u=new MutationObserver(()=>{r()});u.observe(a,{attributes:!0,attributeFilter:["open","hidden","aria-hidden"]}),o.push(()=>{u.disconnect()})}catch(u){safeWarn("cine.features.onboardingTour could not observe project dialog state for requirements access.",u)}}const s=getElement("#generateGearListBtn");if(s){const l=()=>{setTimeout(r,150)};s.addEventListener("click",l),o.push(()=>{s.removeEventListener("click",l)})}return r(),()=>{for(let l=0;l<o.length;l+=1)try{o[l]()}catch(u){safeWarn("cine.features.onboardingTour could not detach project requirements access requirement.",u)}}}}}function hasOwnGearListEntries(){const e=getElement("#ownGearList");if(e&&typeof e.querySelector=="function"&&e.querySelector(".own-gear-item"))return!0;const t=getElement("#ownGearEmptyState");return!!(t&&t.hasAttribute("hidden"))}function createOwnGearItemRequirement(){return{check(){return hasOwnGearListEntries()},attach({complete:e,incomplete:t}){const o=getElement("#ownGearList"),r=getElement("#ownGearEmptyState"),n=()=>{hasOwnGearListEntries()?e():t()};n();let a=null;if(o&&typeof MutationObserver=="function")try{a=new MutationObserver(()=>{n()}),a.observe(o,{childList:!0})}catch(h){safeWarn("cine.features.onboardingTour could not observe Own Gear list changes.",h),a=null}const s=()=>{n()};o&&o.addEventListener("click",s,!0);const l=getElement("#ownGearForm"),u=()=>{setTimeout(n,50)};l&&typeof l.addEventListener=="function"&&l.addEventListener("submit",u);const d=getElement("#ownGearSaveButton"),m=()=>{setTimeout(n,50)};d&&typeof d.addEventListener=="function"&&d.addEventListener("click",m);let y=null;if(r&&typeof MutationObserver=="function")try{y=new MutationObserver(()=>{n()}),y.observe(r,{attributes:!0,attributeFilter:["hidden","aria-hidden"]})}catch(h){safeWarn("cine.features.onboardingTour could not observe Own Gear empty state.",h),y=null}return()=>{if(o&&o.removeEventListener("click",s,!0),l&&typeof l.removeEventListener=="function"&&l.removeEventListener("submit",u),d&&typeof d.removeEventListener=="function"&&d.removeEventListener("click",m),a)try{a.disconnect()}catch(h){safeWarn("cine.features.onboardingTour could not disconnect Own Gear list observer.",h)}if(y)try{y.disconnect()}catch(h){safeWarn("cine.features.onboardingTour could not disconnect Own Gear empty state observer.",h)}}}}}function hasProjectCrewRows(){const e=["#crewContainer .person-row","#prepContainer .period-row","#shootContainer .period-row","#returnContainer .period-row"];for(let t=0;t<e.length;t+=1){const o=e[t];if(o)try{if(DOCUMENT.querySelector(o))return!0}catch(r){safeWarn("cine.features.onboardingTour could not query crew selector.",r)}}return!1}function createProjectCrewRequirement(){const e=()=>hasProjectCrewRows();return{check(){return e()},attach(t){const o=typeof t?.complete=="function"?t.complete:(()=>{}),r=typeof t?.incomplete=="function"?t.incomplete:(()=>{});if(!getElement("#projectForm"))return o(),null;const a=()=>{e()?o():r()},s=["#crewContainer","#prepContainer","#shootContainer","#returnContainer"],l=["#addPersonBtn","#addPrepBtn","#addShootBtn","#addReturnBtn"],u=[];for(let d=0;d<s.length;d+=1){const m=getElement(s[d]);if(!m)continue;const y=()=>{a()};if(m.addEventListener("input",y),m.addEventListener("change",y),u.push(()=>{m.removeEventListener("input",y)}),u.push(()=>{m.removeEventListener("change",y)}),typeof MutationObserver=="function")try{const h=new MutationObserver(()=>{a()});h.observe(m,{childList:!0,subtree:!0}),u.push(()=>{h.disconnect()})}catch(h){safeWarn("cine.features.onboardingTour could not observe crew container.",h)}}for(let d=0;d<l.length;d+=1){const m=getElement(l[d]);if(!m)continue;const y=()=>{setTimeout(a,120)};m.addEventListener("click",y),u.push(()=>{m.removeEventListener("click",y)})}return a(),()=>{for(let d=0;d<u.length;d+=1)try{u[d]()}catch(m){safeWarn("cine.features.onboardingTour could not detach crew requirement listener.",m)}}}}}function hasProjectLogisticsEntry(){const e=["#deliveryResolution","#recordingResolution","#sensorMode","#codec","#recordingFrameRate","#lensManufacturer","#lensSeries","#cameraHandle","#mattebox","#filter","#monitoringConfiguration","#frameGuides","#videoDistribution","#storageNeedsContainer .storage-quantity","#storageNeedsContainer .storage-type","#storageNeedsContainer .storage-variant","#storageNeedsContainer .storage-notes"];for(let t=0;t<e.length;t+=1){const o=e[t];if(!o)continue;let r=[];try{r=DOCUMENT.querySelectorAll(o)}catch(n){safeWarn("cine.features.onboardingTour could not query logistics selector.",n),r=[]}if(!(!r||r.length===0))for(let n=0;n<r.length;n+=1){const a=r[n];if(!a)continue;if(a.multiple){if(a.selectedOptions&&a.selectedOptions.length>0)return!0;continue}if(a.type==="number"){const l=Number(a.value);if(!Number.isNaN(l)&&a.value!=="")return!0;continue}const s=getFieldValue(a);if(typeof s=="string"&&s.trim().length>0)return!0}}return!1}function createProjectLogisticsRequirement(){return{check(){return hasProjectLogisticsEntry()},attach(e){const t=typeof e?.complete=="function"?e.complete:(()=>{}),o=typeof e?.incomplete=="function"?e.incomplete:(()=>{}),r=getElement("#projectForm");if(!r)return t(),null;const n=()=>{hasProjectLogisticsEntry()?t():o()},a=()=>{n()};r.addEventListener("input",a),r.addEventListener("change",a);let s=null;const l=getElement("#storageNeedsContainer");if(l&&typeof MutationObserver=="function")try{s=new MutationObserver(()=>{n()}),s.observe(l,{childList:!0,subtree:!0})}catch(u){safeWarn("cine.features.onboardingTour could not observe storage rows.",u),s=null}return n(),()=>{if(r.removeEventListener("input",a),r.removeEventListener("change",a),s)try{s.disconnect()}catch(u){safeWarn("cine.features.onboardingTour could not detach storage observer.",u)}}}}}function getProjectNameValue(){const e=getElement("#setupName");return typeof e?.value=="string"?e.value.trim():""}function hasSavedSetupForName(e){if(!e)return!1;const t=getElement("#setupSelect");if(!t||!t.options)return!1;for(let o=0;o<t.options.length;o+=1){const r=t.options[o];if(r&&typeof r.value=="string"&&r.value===e)return!0}return!1}function createSaveProjectRequirement(){return{check(){return hasSavedSetupForName(getProjectNameValue())},attach(e){const t=[],o=()=>{hasSavedSetupForName(getProjectNameValue())?typeof e.complete=="function"&&e.complete():typeof e.incomplete=="function"&&e.incomplete()},r=getElement("#saveSetupBtn");if(r){const s=()=>{setTimeout(o,50)};r.addEventListener("click",s),t.push(()=>{r.removeEventListener("click",s)})}const n=getElement("#setupSelect");if(n){const s=()=>{o()};n.addEventListener("change",s),t.push(()=>{n.removeEventListener("change",s)})}const a=getElement("#setupName");if(a){const s=()=>{o()};a.addEventListener("input",s),t.push(()=>{a.removeEventListener("input",s)})}return o(),()=>{for(let s=0;s<t.length;s+=1)try{t[s]()}catch(l){safeWarn("cine.features.onboardingTour could not detach save requirement.",l)}}}}}const STEP_COMPLETION_REQUIREMENTS={nameProject:createFieldCompletionRequirement("#setupName",e=>e.trim().length>0,["input","change"]),saveProject:createSaveProjectRequirement(),addCamera:createFieldCompletionRequirement("#cameraSelect",e=>e&&e!=="None",["change"]),selectBattery:createFieldCompletionRequirement("#batterySelect",e=>e&&e!=="None",["change"]),editDeviceDataAdd:createDeviceLibraryAddRequirement(),editDeviceDataReview:createDeviceLibraryReviewRequirement(),editDeviceDataEdit:createDeviceLibraryEditRequirement(),ownGearAccess:createOwnGearOpenRequirement(),ownGearAddDevice:createOwnGearItemRequirement(),projectRequirementsAccess:createProjectRequirementsAccessRequirement(),projectRequirementsCrew:createProjectCrewRequirement(),projectRequirementsLogistics:createProjectLogisticsRequirement(),generateGearAndRequirements:createProjectDialogSubmitRequirement(),exportImport:createClickCompletionRequirement(["#shareSetupBtn","#applySharedLinkBtn"]),overviewAndPrint:createClickCompletionRequirement("#generateOverviewBtn")},STEP_SIGNATURE=DEFAULT_STEP_KEYS.join("|");function getTimestamp(){if(typeof Date<"u"&&typeof Date.now=="function")return Date.now();try{return new Date().getTime()}catch{}return 0}function normalizeCompletedSteps(e,t){if(!Array.isArray(e))return[];const o=[];for(let r=0;r<e.length;r+=1){const n=e[r];typeof n!="string"||!n||t&&t.indexOf(n)===-1||o.indexOf(n)===-1&&o.push(n)}return o}function normalizeStateSnapshot(e){const t=e&&typeof e=="object"?{...e}:{},o=t.skipped===!0;t.version=STORAGE_VERSION,t.completed=!!t.completed,t.skipped=o&&!t.completed;const r=DEFAULT_STEP_KEYS;t.completedSteps=normalizeCompletedSteps(t.completedSteps,r),t.activeStep=typeof t.activeStep=="string"&&t.activeStep?t.activeStep:null,t.activeStep&&r.indexOf(t.activeStep)===-1&&(t.activeStep=null);const n=typeof t.stepSignature=="string"?t.stepSignature:null;if(n!==STEP_SIGNATURE){if(t.stepSignature=STEP_SIGNATURE,t.completed=!1,t.skipped=o,!t.activeStep)for(let a=0;a<r.length;a+=1){const s=r[a];if(t.completedSteps.indexOf(s)===-1){t.activeStep=s;break}}}else t.stepSignature=STEP_SIGNATURE;return t.completedSteps.length<r.length&&(t.completed=!1),t.skipped=(o||t.skipped===!0)&&!t.completed,(typeof t.timestamp!="number"||Number.isNaN(t.timestamp))&&(t.timestamp=getTimestamp()),t.lastCompletedStep=typeof t.lastCompletedStep=="string"&&t.lastCompletedStep?t.lastCompletedStep:null,t.lastCompletedStep&&r.indexOf(t.lastCompletedStep)===-1&&(t.lastCompletedStep=null),t.lastCompletedAt=typeof t.lastCompletedAt=="number"&&!Number.isNaN(t.lastCompletedAt)?t.lastCompletedAt:null,n!==STEP_SIGNATURE&&(t.lastCompletedStep=null,t.lastCompletedAt=t.timestamp),t}function updateStoredStateCache(e,t,o){storedStateCache=e,storedStateCacheRaw=typeof t=="string"?t:t||null,storedStateCacheSource=o||storedStateCacheSource||null}function createStorageEntry(e,t){if(typeof e!="string")return null;const o=e.trim(),r={priority:t===PRIMARY_STORAGE_KEY?2:1,version:0,hasContent:o?1:0,parsed:0,timestamp:0};let n=null,a=null;try{const s=JSON.parse(e);s&&typeof s=="object"&&(n=s)}catch(s){a=s}return n&&(r.parsed=1,typeof n.timestamp=="number"&&!Number.isNaN(n.timestamp)&&(r.timestamp=n.timestamp),n.version===STORAGE_VERSION?r.version=2:typeof n.version=="number"&&(r.version=1)),{key:t,raw:e,parsed:n,parseError:a,metrics:r}}function isBetterStorageEntry(e,t){if(!e)return!1;if(!t)return!0;const o=["priority","version","hasContent","parsed","timestamp"];for(let r=0;r<o.length;r+=1){const n=o[r],a=e.metrics[n]||0,s=t.metrics[n]||0;if(a!==s)return a>s}return!1}function loadStoredState(){const e=collectStorageCandidates();let t=null,o=null;for(let l=0;l<e.length;l+=1){const u=e[l];if(!(!u||typeof u.getItem!="function"))for(let d=0;d<STORAGE_KEYS.length;d+=1){const m=STORAGE_KEYS[d];let y=null;try{y=u.getItem(m)}catch(v){o||(o=v);continue}if(y===null||typeof y>"u")continue;let h=null;if(typeof y=="string")h=y;else{try{h=JSON.stringify(y)}catch{}if(h===null)try{h=String(y)}catch{}}if(typeof h!="string")continue;const b=createStorageEntry(h,m);b&&(!t||isBetterStorageEntry(b,t))&&(t=b)}}if(!e.length&&!t){if(storedStateCache&&storedStateCacheSource==="memory")return storedStateCache;const l=normalizeStateSnapshot({version:STORAGE_VERSION});return updateStoredStateCache(l,null,"memory"),l}if(!t){if(storedStateCache&&storedStateCacheSource==="memory")return storedStateCache;o&&safeWarn("cine.features.onboardingTour could not read onboarding state.",o);const l=normalizeStateSnapshot({version:STORAGE_VERSION});return updateStoredStateCache(l,null,"memory"),l}const r=t.raw,n="storage";if(typeof r!="string"||!r){const l=normalizeStateSnapshot({version:STORAGE_VERSION});return t.key!==PRIMARY_STORAGE_KEY?saveState(l):(updateStoredStateCache(l,r,n),l)}if(storedStateCache&&storedStateCacheSource==="storage"&&r===storedStateCacheRaw)return storedStateCache;if(t.parseError){safeWarn("cine.features.onboardingTour could not parse onboarding state.",t.parseError);const l=normalizeStateSnapshot({version:STORAGE_VERSION});return t.key!==PRIMARY_STORAGE_KEY?saveState(l):(updateStoredStateCache(l,r,n),l)}const a=t.parsed;if(!a||typeof a!="object"){const l=normalizeStateSnapshot({version:STORAGE_VERSION});return t.key!==PRIMARY_STORAGE_KEY?saveState(l):(updateStoredStateCache(l,r,n),l)}if(a.version!==STORAGE_VERSION){const l=normalizeStateSnapshot({...a,version:STORAGE_VERSION,completed:!1,skipped:!1});return saveState(l)}const s=normalizeStateSnapshot(a);return t.key!==PRIMARY_STORAGE_KEY?saveState(s):(updateStoredStateCache(s,r,n),s)}function saveState(e){const t=normalizeStateSnapshot({...e,version:STORAGE_VERSION}),o={...t,timestamp:getTimestamp()},r=JSON.stringify(o),n=collectStorageCandidates();let a=!1,s=null;for(let l=0;l<n.length;l+=1){const u=n[l];if(!u||typeof u.setItem!="function")continue;let d=!1;for(let m=0;m<STORAGE_KEYS.length;m+=1){const y=STORAGE_KEYS[m];try{u.setItem(y,r),d=!0}catch(h){s||(s=h)}}d&&(a=!0)}return a?(updateStoredStateCache(o,r,"storage"),o):(s&&safeWarn("cine.features.onboardingTour could not persist onboarding state.",s),updateStoredStateCache(t,null,"memory"),t)}let storedState=null;function refreshStoredState(){const e=loadStoredState(),o=readSkipStatusPreference()===!0&&e?normalizeStateSnapshot({...e,skipped:!0,activeStep:null,completed:!1}):e;return storedState=o,o}refreshStoredState();function normalizeLanguageCandidate(e,t){if(!e||typeof e!="string"&&typeof e!="number")return null;const o=t&&typeof t=="object"?t:{},r=String(e).trim();if(!r)return null;if(Object.prototype.hasOwnProperty.call(o,r))return r;const n=r.toLowerCase();if(Object.prototype.hasOwnProperty.call(o,n))return n;const a=n.split(/[-_]/)[0];return a&&Object.prototype.hasOwnProperty.call(o,a)?a:null}function resolveLanguage(){const e=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.texts&&typeof GLOBAL_SCOPE$2.texts=="object"?GLOBAL_SCOPE$2.texts:{},t=Object.prototype.hasOwnProperty.call(e,"en")?"en":Object.keys(e)[0]||"en",o=new Set,r=[],n=a=>{const s=normalizeLanguageCandidate(a,e);!s||o.has(s)||(o.add(s),r.push(s))};try{typeof GLOBAL_SCOPE$2.currentLang=="string"&&n(GLOBAL_SCOPE$2.currentLang)}catch{}if(DOCUMENT&&DOCUMENT.documentElement&&typeof DOCUMENT.documentElement.lang=="string"&&n(DOCUMENT.documentElement.lang),DOCUMENT&&typeof DOCUMENT.getElementById=="function"){const a=DOCUMENT.getElementById("languageSelect");a&&typeof a.value=="string"&&n(a.value);const s=DOCUMENT.getElementById("settingsLanguage");s&&typeof s.value=="string"&&n(s.value)}try{GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.localStorage&&typeof GLOBAL_SCOPE$2.localStorage.getItem=="function"&&n(GLOBAL_SCOPE$2.localStorage.getItem("language"))}catch{}try{const a=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.navigator?GLOBAL_SCOPE$2.navigator:null;if(a){if(Array.isArray(a.languages))for(let s=0;s<a.languages.length;s+=1)n(a.languages[s]);typeof a.language=="string"&&n(a.language)}}catch{}for(let a=0;a<r.length;a+=1){const s=r[a];if(s&&Object.prototype.hasOwnProperty.call(e,s))return s}return t}function resolveTourTexts(){const e=resolveLanguage(),t=GLOBAL_SCOPE$2.texts&&GLOBAL_SCOPE$2.texts.en&&GLOBAL_SCOPE$2.texts.en.onboardingTour?GLOBAL_SCOPE$2.texts.en.onboardingTour:{},o=GLOBAL_SCOPE$2.texts&&GLOBAL_SCOPE$2.texts[e]&&GLOBAL_SCOPE$2.texts[e].onboardingTour?GLOBAL_SCOPE$2.texts[e].onboardingTour:t,r={};for(let a=0;a<DEFAULT_STEP_KEYS.length;a+=1){const s=DEFAULT_STEP_KEYS[a],l=DEFAULT_STEP_TEXTS[s]||{title:s,body:""},u=t.steps&&t.steps[s],d=o.steps&&o.steps[s],m=d&&typeof d.title=="string"&&d.title||u&&typeof u.title=="string"&&u.title||(typeof l.title=="string"?l.title:s),y=d&&typeof d.body=="string"&&d.body||u&&typeof u.body=="string"&&u.body||(typeof l.body=="string"?l.body:""),h={...l&&typeof l=="object"?l:{},...u&&typeof u=="object"?u:{},...d&&typeof d=="object"?d:{},title:m,body:y};r[s]=h}const n=(()=>{const a=o&&typeof o.prefaceIndicator=="string"?o.prefaceIndicator.trim():"";if(a)return a;const s=t&&typeof t.prefaceIndicator=="string"?t.prefaceIndicator.trim():"";return s||"Welcome"})();return{...t,...o,prefaceIndicator:n,steps:r}}let tourTexts=resolveTourTexts();function resolveText(e,t){return tourTexts&&typeof tourTexts[e]=="string"?tourTexts[e]:t}function createStepConfig(){return[{key:"intro",highlight:null,preface:!0,size:"large"},{key:"userProfile",highlight:null,forceFloating:!0,size:"large"},{key:"unitsPreferences",highlight:null,forceFloating:!0,ensureSettings:{tabId:"settingsTab-general",autoOpen:!1},size:"large"},{key:"nameProject",highlight:"#setupName",focus:"#setupName"},{key:"saveProject",highlight:"#saveSetupBtn"},{key:"addCamera",highlight:"#cameraSelect"},{key:"addMonitoring",highlight:["#monitorSelectRow","#wirelessVideoRow","#fizFieldset"],focus:"#monitorSelect"},{key:"selectBattery",highlight:"#batterySelectRow"},{key:"resultsTotalDraw",ensureHeroCard:!0,highlight:["#heroMainStat","#metricCurrent144","#metricCurrent12"]},{key:"resultsBatteryPacks",ensureHeroCard:!0,highlight:["#metricRuntime","#metricBatteryCount"]},{key:"resultsChangeover",highlight:"#breakdownList"},{key:"resultsWarnings",highlight:["#pinWarning","#dtapWarning","#hotswapWarning"]},{key:"batteryComparison",highlight:"#batteryComparison"},{key:"runtimeFeedback",highlight:"#runtimeFeedbackBtn"},{key:"connectionDiagram",highlight:"#diagramArea"},{key:"connectionDiagramDetails",highlight:"#diagramArea"},{key:"editDeviceDataAdd",highlight:["#toggleDeviceManager","#addDeviceHeading","#addDeviceBtn"],focus:"#newName"},{key:"editDeviceDataReview",highlight:"#device-manager",focus:"#deviceListContainer .detail-toggle",ensureDeviceManager:!0},{key:"editDeviceDataEdit",highlight:"#device-manager",focus:"#deviceListContainer .edit-btn",ensureDeviceManager:!0,scrollToTop:!0},{key:"ownGearAccess",highlight:'#sideMenu [data-sidebar-action="open-own-gear"]',alternateHighlight:"#menuToggle",resolveHighlight:resolveOwnGearAccessHighlightSelectors,focus:'[data-sidebar-action="open-own-gear"]'},{key:"ownGearAddDevice",highlight:"#ownGearDialog",ensureOwnGear:!0,focus:"#ownGearName"},{key:"projectRequirementsAccess",highlight:"#generateGearListBtn",autoAdvance:!0},{key:"projectRequirementsBrief",highlight:"#projectRequirementsBriefSection",ensureProjectDialog:!0},{key:"projectRequirementsCrew",highlight:"#projectRequirementsCrewSection",ensureProjectDialog:!0},{key:"projectRequirementsLogistics",highlight:["#projectRequirementsCameraSection","#lensesHeading","#riggingHeading","#storageHeading","#matteboxFilterHeading","#monitoringHeading"],ensureProjectDialog:!0},{key:"generateGearAndRequirements",highlight:"#projectSubmit",focus:"#projectSubmit",ensureProjectDialog:!0},{key:"autoGearRulesAccess",highlight:"#settingsPanel-autoGear",ensureSettings:{tabId:"settingsTab-autoGear"}},{key:"autoGearRulesEdit",highlight:"#autoGearRulesList",ensureSettings:{tabId:"settingsTab-autoGear"}},{key:"autoGearRulesCreate",highlight:"#autoGearAddRule",ensureSettings:{tabId:"settingsTab-autoGear"},focus:"#autoGearAddRule"},{key:"gearList",highlight:"#gearListOutput"},{key:"exportImport",highlight:"#shareSetupBtn",alternateHighlight:"#applySharedLinkBtn"},{key:"overviewAndPrint",highlight:"#generateOverviewBtn"},{key:"help",highlight:"#helpButton",focus:"#helpButton"},{key:"settingsGeneral",highlight:"#settingsPanel-general",ensureSettings:{tabId:"settingsTab-general"}},{key:"settingsData",highlight:"#settingsPanel-data",ensureSettings:{tabId:"settingsTab-data"}},{key:"settingsBackup",highlight:"#settingsPanel-backup",ensureSettings:{tabId:"settingsTab-backup"}},{key:"completion",highlight:null}]}const STEP_CONFIG=(function e(){const t=createStepConfig();if(typeof baseApi.freezeDeep=="function")try{return baseApi.freezeDeep(t)}catch(o){safeWarn("cine.features.onboardingTour could not freeze step config.",o)}if(typeof Object.freeze=="function")try{return Object.freeze(t)}catch{}return t})();function getStepConfig(){return STEP_CONFIG}let stepConfig=getStepConfig(),overlayRoot=null,overlayAnchor=null,highlightEl=null,activeTargetElements=[],keyboardListenerAttached=!1,cardEl=null,titleEl=null,bodyEl=null,progressEl=null,progressMeterEl=null,progressMeterFillEl=null,cardContentEl=null,cardHeaderEl=null,cardActionsEl=null,stepListContainerEl=null,stepListEl=null,resumeHintEl=null,interactionContainerEl=null,helpStatusEl=null,helpButtonsCache=null,helpButtonsObserver=null,backButton=null,nextButton=null,skipButton=null,helpButtonListenerAttached=!1,delegatedHelpListener=null,visualViewportListenersAttached=!1,active=!1,currentIndex=-1,currentStep=null,pendingFrame=null,scrollStateTimer=null,autoOpenedSettings=!1,settingsDialogRef=null,autoOpenedContacts=!1,contactsDialogRef=null,autoOpenedOwnGear=!1,ownGearDialogRef=null,autoOpenedProjectDialog=!1,projectDialogRef=null,projectDialogTriggerRef=null,projectDialogVisibilityCleanup=null,autoOpenedDeviceManager=!1,deviceManagerSectionRef=null,deviceManagerToggleRef=null,sideMenuObserver=null,resumeHintVisible=!1,resumeStartIndex=null,activeRequirementCleanup=null,activeRequirementCompleted=!1,activeInteractionCleanup=null,activeStepAutomationCleanup=null,lastCardPlacement="floating",proxyControlId=0,baselineViewportHeight=null;function getProxyControlId(e){return proxyControlId+=1,`onboarding-${e}-${proxyControlId}`}function setNextButtonDisabled(e){nextButton&&(nextButton.disabled=!!e,e?(nextButton.setAttribute("aria-disabled","true"),nextButton.classList.add("onboarding-next-disabled")):(nextButton.setAttribute("aria-disabled","false"),nextButton.classList.remove("onboarding-next-disabled")))}function updateBaselineViewportHeight(e,t){if(!Number.isFinite(e)||e<=0)return;const o=!!(t&&t.allowDecrease);if(baselineViewportHeight===null){baselineViewportHeight=e;return}if(e>baselineViewportHeight){baselineViewportHeight=e;return}o&&e<baselineViewportHeight&&(baselineViewportHeight=e)}function isTextInputElement(e){if(!e)return!1;const t=typeof e.nodeName=="string"?e.nodeName.toLowerCase():"";if(t==="textarea")return!0;if(t==="input")switch(typeof e.type=="string"&&e.type?e.type.toLowerCase():"text"){case"button":case"checkbox":case"color":case"file":case"hidden":case"image":case"radio":case"range":case"reset":case"submit":return!1;default:return!0}if(e.isContentEditable)return!0;if(typeof e.getAttribute=="function"){const o=e.getAttribute("role");if(o==="textbox"||o==="searchbox")return!0;const r=e.getAttribute("contenteditable");if(r&&r.toLowerCase()!=="false")return!0}return!1}function teardownStepRequirement(){if(typeof activeRequirementCleanup=="function")try{activeRequirementCleanup()}catch(e){safeWarn("cine.features.onboardingTour could not detach active requirement.",e)}activeRequirementCleanup=null,activeRequirementCompleted=!1,setNextButtonDisabled(!1)}function teardownStepInteraction(){if(typeof activeInteractionCleanup=="function")try{activeInteractionCleanup()}catch(e){safeWarn("cine.features.onboardingTour could not detach active interaction.",e)}if(activeInteractionCleanup=null,interactionContainerEl){for(;interactionContainerEl.firstChild;)interactionContainerEl.removeChild(interactionContainerEl.firstChild);interactionContainerEl.hidden=!0}}function teardownStepAutomation(){if(typeof activeStepAutomationCleanup=="function")try{activeStepAutomationCleanup()}catch(e){safeWarn("cine.features.onboardingTour could not detach step automation.",e)}activeStepAutomationCleanup=null}function applyStepRequirement(e){if(!nextButton)return;const t=e?STEP_COMPLETION_REQUIREMENTS[e.key]:null;if(!t){activeRequirementCompleted=!0,setNextButtonDisabled(!1),activeRequirementCleanup=null;return}const o=typeof t.check=="function"?t.check():!1;if(activeRequirementCompleted=o,setNextButtonDisabled(!o),o&&e&&e.autoAdvance){goToNextStep();return}if(typeof t.attach!="function")return;const r=t.attach({complete(){!active||currentStep!==e||activeRequirementCompleted||(activeRequirementCompleted=!0,setNextButtonDisabled(!1),e&&e.autoAdvance&&goToNextStep())},incomplete(){!active||currentStep!==e||(activeRequirementCompleted&&(activeRequirementCompleted=!1),setNextButtonDisabled(!0))}});activeRequirementCleanup=typeof r=="function"?r:null}function applyStepAutomation(e){if(teardownStepAutomation(),!!e){if(e.key==="editDeviceDataAdd")activeStepAutomationCleanup=attachDeviceManagerNameAutofill();else if(e.key==="projectRequirementsAccess"){if(ownGearDialogRef||(ownGearDialogRef=DOCUMENT.getElementById("ownGearDialog")),ownGearDialogRef){if(typeof ownGearDialogRef.close=="function")try{ownGearDialogRef.close()}catch{}ownGearDialogRef.setAttribute("hidden",""),ownGearDialogRef.removeAttribute("open")}autoOpenedOwnGear=!1}}}function clearFrame(){pendingFrame!==null&&(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.cancelAnimationFrame=="function"?GLOBAL_SCOPE$2.cancelAnimationFrame(pendingFrame):clearTimeout(pendingFrame),pendingFrame=null)}function clearScrollStateTimer(){scrollStateTimer!==null&&(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.clearTimeout=="function"?GLOBAL_SCOPE$2.clearTimeout(scrollStateTimer):clearTimeout(scrollStateTimer),scrollStateTimer=null)}function clearScrollState(){clearScrollStateTimer(),overlayRoot&&overlayRoot.classList&&typeof overlayRoot.classList.remove=="function"&&overlayRoot.classList.remove("onboarding-scroll-active")}function markScrollActive(){if(!overlayRoot||!overlayRoot.classList||typeof overlayRoot.classList.add!="function")return;overlayRoot.classList.add("onboarding-scroll-active"),clearScrollStateTimer();const e=function(){scrollStateTimer=null,overlayRoot&&overlayRoot.classList&&typeof overlayRoot.classList.remove=="function"&&overlayRoot.classList.remove("onboarding-scroll-active")};GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.setTimeout=="function"?scrollStateTimer=GLOBAL_SCOPE$2.setTimeout(e,150):scrollStateTimer=setTimeout(e,150)}function isOverlayScrollEvent(e){if(!e||!overlayRoot)return!1;if(typeof e.composedPath=="function")try{const o=e.composedPath();if(Array.isArray(o)){for(let r=0;r<o.length;r+=1)if(o[r]===overlayRoot)return!0}}catch(o){safeWarn("cine.features.onboardingTour could not inspect scroll event composedPath.",o)}const t=e.target;if(t===overlayRoot)return!0;if(t&&typeof t.closest=="function")try{if(t.closest(`#${OVERLAY_ID}`))return!0}catch(o){safeWarn("cine.features.onboardingTour could not evaluate scroll event target.closest.",o)}if(overlayRoot&&typeof overlayRoot.contains=="function"&&t&&typeof t=="object")try{if(overlayRoot.contains(t))return!0}catch(o){safeWarn("cine.features.onboardingTour encountered an error inspecting scroll event containment.",o)}return!1}function handleGlobalScroll(e){active&&(markScrollActive(),!isOverlayScrollEvent(e)&&schedulePositionUpdate())}function getOverlayMetrics(){const e=GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.innerWidth=="number"?GLOBAL_SCOPE$2.innerWidth:DOCUMENT&&DOCUMENT.documentElement&&DOCUMENT.documentElement.clientWidth||0,t=GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.innerHeight=="number"?GLOBAL_SCOPE$2.innerHeight:DOCUMENT&&DOCUMENT.documentElement&&DOCUMENT.documentElement.clientHeight||0;let o=0,r=0,n=e,a=t;if(overlayRoot&&typeof overlayRoot.getBoundingClientRect=="function"){const l=overlayRoot.getBoundingClientRect();l&&(typeof l.left=="number"&&(o=-l.left),typeof l.top=="number"&&(r=-l.top),typeof l.width=="number"&&l.width>0&&(n=l.width),typeof l.height=="number"&&l.height>0&&(a=l.height))}const s=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.visualViewport;if(s){const l=!!(overlayRoot&&overlayRoot.classList&&typeof overlayRoot.classList.contains=="function"&&overlayRoot.classList.contains("onboarding-overlay--anchored")),u=typeof s.width=="number"&&s.width>0?s.width:null,d=typeof s.height=="number"&&s.height>0?s.height:null,m=typeof s.offsetLeft=="number"?s.offsetLeft:typeof s.pageLeft=="number"?s.pageLeft:0,y=typeof s.offsetTop=="number"?s.offsetTop:typeof s.pageTop=="number"?s.pageTop:0,h=Number.isFinite(m)?m:0,b=Number.isFinite(y)?y:0;l?(u!==null&&(n=Math.min(n,u)),d!==null&&(a=Math.min(a,d))):(o=-h,r=-b,u!==null&&(n=u),d!==null&&(a=d))}return{offsetLeft:o,offsetTop:r,viewportWidth:n,viewportHeight:a}}function updateHeroInlineSize(e,t,o){if(!cardEl)return;if(e!=="hero"){cardEl.style.removeProperty("--onboarding-card-hero-inline-size");return}const r=t||getOverlayMetrics();if(!r||typeof r.viewportWidth!="number"){cardEl.style.removeProperty("--onboarding-card-hero-inline-size");return}const n=r.viewportWidth;if(!Number.isFinite(n)||n<=0){cardEl.style.removeProperty("--onboarding-card-hero-inline-size");return}const a=Number.isFinite(o)&&o>0?o:getRootFontSizePx(),s=Math.max(0,HERO_MAX_WIDTH_REM*a),l=resolveHeroMarginPx(n,a),u=n-l*2,d=n*HERO_MIN_VIEWPORT_FRACTION,m=[s,n];Number.isFinite(d)&&d>0&&m.push(d),Number.isFinite(u)&&u>0&&m.push(u);const y=m.filter(b=>Number.isFinite(b)&&b>0);if(y.length===0){cardEl.style.removeProperty("--onboarding-card-hero-inline-size");return}const h=Math.min(...y);cardEl.style.setProperty("--onboarding-card-hero-inline-size",`${h}px`)}function schedulePositionUpdate(){if(!active||pendingFrame!==null)return;const e=function(){pendingFrame=null,updateHighlightPosition()};GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.requestAnimationFrame=="function"?pendingFrame=GLOBAL_SCOPE$2.requestAnimationFrame(e):pendingFrame=setTimeout(e,16)}function handleVisualViewportChange(){schedulePositionUpdate()}function attachVisualViewportListeners(){if(visualViewportListenersAttached)return;const e=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.visualViewport;!e||typeof e.addEventListener!="function"||(e.addEventListener("resize",handleVisualViewportChange),e.addEventListener("scroll",handleVisualViewportChange),visualViewportListenersAttached=!0)}function detachVisualViewportListeners(){if(!visualViewportListenersAttached)return;const e=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.visualViewport;e&&typeof e.removeEventListener=="function"&&(e.removeEventListener("resize",handleVisualViewportChange),e.removeEventListener("scroll",handleVisualViewportChange)),visualViewportListenersAttached=!1}function ensureOverlayElements(){if(overlayRoot&&overlayRoot.parentNode){bringOverlayToTopLayer();return}overlayRoot=DOCUMENT.createElement("div"),overlayRoot.id=OVERLAY_ID,overlayRoot.className="onboarding-overlay",overlayRoot.setAttribute("aria-hidden","true"),overlayRoot.style.pointerEvents="none",clearScrollState(),highlightEl=DOCUMENT.createElement("div"),highlightEl.className="onboarding-highlight",highlightEl.setAttribute("aria-hidden","true"),overlayRoot.appendChild(highlightEl),cardEl=DOCUMENT.createElement("section"),cardEl.className="onboarding-card",cardEl.setAttribute("data-placement","floating"),cardEl.setAttribute("role","dialog"),cardEl.setAttribute("aria-modal","false"),cardEl.tabIndex=-1;const e=DOCUMENT.createElement("div");e.className="onboarding-card-header",cardEl.appendChild(e),cardHeaderEl=e,progressEl=DOCUMENT.createElement("p"),progressEl.className="onboarding-progress",e.appendChild(progressEl),progressMeterEl=DOCUMENT.createElement("div"),progressMeterEl.className="onboarding-progress-meter",progressMeterEl.setAttribute("role","progressbar"),progressMeterEl.setAttribute("aria-valuemin","0"),progressMeterEl.setAttribute("aria-valuemax",String(stepConfig.length)),progressMeterEl.setAttribute("aria-valuenow","0"),progressMeterEl.setAttribute("aria-valuetext","");const t=DOCUMENT.createElement("div");t.className="onboarding-progress-track",progressMeterFillEl=DOCUMENT.createElement("div"),progressMeterFillEl.className="onboarding-progress-fill",t.appendChild(progressMeterFillEl),progressMeterEl.appendChild(t),e.appendChild(progressMeterEl),skipButton=DOCUMENT.createElement("button"),skipButton.type="button",skipButton.className="button-link onboarding-skip",skipButton.addEventListener("click",()=>{active&&handleSkipTutorial()}),e.appendChild(skipButton),cardContentEl=DOCUMENT.createElement("div"),cardContentEl.className="onboarding-card-content",cardEl.appendChild(cardContentEl),resumeHintEl=DOCUMENT.createElement("p"),resumeHintEl.className="onboarding-resume-hint",resumeHintEl.hidden=!0,cardContentEl.appendChild(resumeHintEl),titleEl=DOCUMENT.createElement("h2"),titleEl.id="onboardingCardTitle",cardContentEl.appendChild(titleEl),bodyEl=DOCUMENT.createElement("p"),bodyEl.id="onboardingCardBody",cardContentEl.appendChild(bodyEl),interactionContainerEl=DOCUMENT.createElement("div"),interactionContainerEl.className="onboarding-interaction",interactionContainerEl.hidden=!0,cardContentEl.appendChild(interactionContainerEl),stepListContainerEl=DOCUMENT.createElement("div"),stepListContainerEl.className="onboarding-step-list-container",cardEl.appendChild(stepListContainerEl),stepListEl=DOCUMENT.createElement("ol"),stepListEl.className="onboarding-step-list",stepListEl.setAttribute("role","list"),stepListEl.addEventListener("click",handleStepListClick),stepListContainerEl.appendChild(stepListEl);const o=DOCUMENT.createElement("div");o.className="onboarding-card-actions",cardEl.appendChild(o),cardActionsEl=o,backButton=DOCUMENT.createElement("button"),backButton.type="button",backButton.className="onboarding-back-button secondary",backButton.addEventListener("click",()=>{active&&goToPreviousStep()}),o.appendChild(backButton),nextButton=DOCUMENT.createElement("button"),nextButton.type="button",nextButton.className="onboarding-next-button primary",nextButton.addEventListener("click",()=>{active&&goToNextStep()}),o.appendChild(nextButton),overlayRoot.appendChild(cardEl),DOCUMENT.body.appendChild(overlayRoot),overlayAnchor=DOCUMENT.body,bringOverlayToTopLayer(),attachKeyboardListener()}function teardownOverlayElements(){if(clearFrame(),clearActiveTargetElements(),clearScrollState(),detachKeyboardListener(),overlayRoot&&overlayRoot.parentNode){if(supportsDialogTopLayer&&typeof overlayRoot.close=="function"&&overlayRoot.open)try{overlayRoot.close()}catch(e){safeWarn("cine.features.onboardingTour could not close overlay dialog.",e)}overlayRoot.parentNode.removeChild(overlayRoot)}overlayRoot=null,overlayAnchor=null,highlightEl=null,cardEl=null,titleEl=null,bodyEl=null,progressEl=null,progressMeterEl=null,progressMeterFillEl=null,cardContentEl=null,cardHeaderEl=null,cardActionsEl=null,stepListContainerEl=null,stepListEl=null,resumeHintEl=null,interactionContainerEl=null,backButton=null,nextButton=null,skipButton=null,resumeHintVisible=!1,resumeStartIndex=null,activeInteractionCleanup=null,lastCardPlacement="floating",baselineViewportHeight=null}function attachKeyboardListener(){!DOCUMENT||keyboardListenerAttached||(DOCUMENT.addEventListener("keydown",handleOverlayKeydown,!0),keyboardListenerAttached=!0)}function detachKeyboardListener(){!DOCUMENT||!keyboardListenerAttached||(DOCUMENT.removeEventListener("keydown",handleOverlayKeydown,!0),keyboardListenerAttached=!1)}function formatStepIndicator(e,t){const o=typeof tourTexts.stepIndicator=="string"?tourTexts.stepIndicator:"Step {current} of {total}",r=typeof e=="number"?e:-1,n=typeof t=="number"&&t>0?t:0,a=r>=0?r+1:0;return o.replace("{current}",String(a)).replace("{total}",String(n))}function formatPrefaceIndicator(){return tourTexts&&typeof tourTexts.prefaceIndicator=="string"&&tourTexts.prefaceIndicator.trim()?tourTexts.prefaceIndicator.trim():"Welcome"}function focusCard(){const e=getTargetElement(currentStep);if(e&&typeof e.focus=="function"&&!e.hasAttribute("disabled"))try{e.focus({preventScroll:!0});return}catch{try{e.focus();return}catch{}}if(cardEl)try{cardEl.focus({preventScroll:!0})}catch{try{cardEl.focus()}catch{}}}function toSelectorArray(e){if(typeof e=="string")return e?[e]:[];if(Array.isArray(e)){const t=[];for(let o=0;o<e.length;o+=1){const r=e[o];typeof r=="string"&&r&&t.push(r)}return t}return[]}function callSelectorResolver(e,t){if(typeof e!="function")return null;try{return e()}catch(o){return safeWarn(`cine.features.onboardingTour could not resolve ${t}.`,o),null}}function resolveSelectorElements(e){if(!Array.isArray(e)||e.length===0)return[];const t=[];for(let o=0;o<e.length;o+=1){const r=e[o];if(!r)continue;const n=DOCUMENT.querySelector(r);n&&t.push(n)}return t}function isHighlightElementUsable(e){if(!e||typeof e.isConnected=="boolean"&&!e.isConnected)return!1;if(typeof e.getBoundingClientRect!="function")return!0;let t=null;try{t=e.getBoundingClientRect()}catch(n){return safeWarn("cine.features.onboardingTour could not measure highlight target.",n),!1}if(!t)return!1;const o=Number.isFinite(t.width)?t.width:t.right-t.left,r=Number.isFinite(t.height)?t.height:t.bottom-t.top;if(Number.isFinite(o)&&o>0||Number.isFinite(r)&&r>0)return!0;if(typeof e.getClientRects=="function")try{const n=e.getClientRects();if(n&&n.length>0)for(let a=0;a<n.length;a+=1){const s=n[a],l=Number.isFinite(s.width)?s.width:s.right-s.left,u=Number.isFinite(s.height)?s.height:s.bottom-s.top;if(Number.isFinite(l)&&l>0||Number.isFinite(u)&&u>0)return!0}}catch(n){safeWarn("cine.features.onboardingTour could not inspect highlight target rects.",n)}return!1}function filterUsableHighlightElements(e){if(!Array.isArray(e)||e.length===0)return[];const t=[];for(let o=0;o<e.length;o+=1){const r=e[o];r&&isHighlightElementUsable(r)&&t.push(r)}return t}function ensureHighlightVisible(e){if(!e)return;const t=getHighlightElements(e);if(!t||!t.length)return;let o=null;for(let r=0;r<t.length;r+=1)if(t[r]&&isHighlightElementUsable(t[r])){o=t[r];break}if(o||(o=t[0]),o&&typeof o.scrollIntoView=="function")try{o.scrollIntoView({behavior:"smooth",block:"center"})}catch(r){safeWarn("cine.features.onboardingTour could not scroll to highlight element.",r)}}function getHighlightElements(e){if(!e)return[];const t=[{value:e.resolveHighlight,label:"highlight resolver"},{value:e.highlight,label:"highlight"},{value:e.resolveAlternateHighlight,label:"alternate highlight resolver"},{value:e.alternateHighlight,label:"alternate highlight"}];let o=[];for(let r=0;r<t.length;r+=1){const n=t[r];if(!n.value)continue;const a=typeof n.value=="function"?callSelectorResolver(n.value,n.label):n.value,s=toSelectorArray(a);if(!s.length)continue;const l=resolveSelectorElements(s),u=filterUsableHighlightElements(l);if(u.length>0)return u;!o.length&&l.length>0&&(o=l)}return o}function resolveOverlayAnchorForElements(e){if(!DOCUMENT)return null;const t=Array.isArray(e)?e:[],o=DOCUMENT.getElementById(MAIN_ANCHOR_ID),r=DOCUMENT.getElementById(HEADER_ANCHOR_ID);for(let n=0;n<t.length;n+=1){const a=t[n];if(a){if(typeof a.closest=="function"){const s=a.closest("[data-onboarding-anchor]");if(s)return s;const l=a.closest("dialog");if(l)return l}if(o&&typeof o.contains=="function"&&o.contains(a))return o;if(r&&typeof r.contains=="function"&&r.contains(a))return r}}return DOCUMENT.body||null}function setOverlayAnchorElement(e){if(!overlayRoot||!DOCUMENT){overlayAnchor=e||overlayAnchor;return}const t=e||DOCUMENT.body;if(!t)return;if(overlayAnchor===t&&overlayRoot.parentNode===t){if(t===DOCUMENT.body)overlayRoot.classList.remove("onboarding-overlay--anchored"),bringOverlayToTopLayer();else if(overlayRoot.classList.add("onboarding-overlay--anchored"),supportsDialogTopLayer&&isDialogElement(overlayRoot)&&!overlayRoot.open)try{overlayRoot.open=!0}catch{try{overlayRoot.setAttribute("open","")}catch{}}return}const o=t===DOCUMENT.body,r=supportsDialogTopLayer&&isDialogElement(overlayRoot);if(r&&overlayRoot.open&&!o&&typeof overlayRoot.close=="function")try{overlayRoot.close()}catch(n){safeWarn("cine.features.onboardingTour could not reset overlay dialog state.",n)}if(overlayRoot.parentNode!==t)try{t.appendChild(overlayRoot)}catch(n){safeWarn("cine.features.onboardingTour could not move overlay to anchor.",n)}if(overlayAnchor=t,o){overlayRoot.classList.remove("onboarding-overlay--anchored"),bringOverlayToTopLayer();return}if(overlayRoot.classList.add("onboarding-overlay--anchored"),r&&!overlayRoot.open)try{overlayRoot.open=!0}catch{try{overlayRoot.setAttribute("open","")}catch{}}}function getTargetElement(e){if(!e||e.ensureSettings&&e.ensureSettings.autoOpen!==!1&&(!settingsDialogRef||!isSettingsDialogVisible()))return null;const t=getHighlightElements(e);return t.length>0?t[0]:null}function clearActiveTargetElements(){if(!Array.isArray(activeTargetElements)){activeTargetElements=[];return}activeTargetElements=[]}const DEFAULT_HIGHLIGHT_PADDING=12,EXTRA_ONBOARDING_CARD_VIEWPORT_TOP_MARGIN=20,EXTRA_ONBOARDING_CARD_TOP_PLACEMENT_GAP=20;function normalizeHighlightPaddingValue(e,t){return typeof e=="number"&&Number.isFinite(e)?Math.max(0,e):t}function resolveStepHighlightPadding(e){const t={top:DEFAULT_HIGHLIGHT_PADDING,right:DEFAULT_HIGHLIGHT_PADDING,bottom:DEFAULT_HIGHLIGHT_PADDING,left:DEFAULT_HIGHLIGHT_PADDING};if(!e||typeof e!="object")return t;const o=e.highlightPadding;if(typeof o=="number"&&Number.isFinite(o)){const r=Math.max(0,o);return{top:r,right:r,bottom:r,left:r}}return o&&typeof o=="object"?{top:normalizeHighlightPaddingValue(o.top,t.top),right:normalizeHighlightPaddingValue(o.right,t.right),bottom:normalizeHighlightPaddingValue(o.bottom,t.bottom),left:normalizeHighlightPaddingValue(o.left,t.left)}:t}function updateHighlightPosition(){if(!highlightEl)return;const e=getHighlightElements(currentStep);if(setOverlayAnchorElement(resolveOverlayAnchorForElements(e)),e.length===0){activeTargetElements.length>0&&clearActiveTargetElements(),highlightEl.style.transform="scale(0)",highlightEl.style.opacity="0",positionCard(null,null);return}clearActiveTargetElements();for(let y=0;y<e.length;y+=1){const h=e[y];h&&activeTargetElements.push(h)}const t=e.reduce((y,h)=>{if(!h||typeof h.getBoundingClientRect!="function")return y;const b=h.getBoundingClientRect();return y?{top:Math.min(y.top,b.top),right:Math.max(y.right,b.right),bottom:Math.max(y.bottom,b.bottom),left:Math.min(y.left,b.left)}:{top:b.top,right:b.right,bottom:b.bottom,left:b.left}},null);if(!t){highlightEl.style.transform="scale(0)",highlightEl.style.opacity="0",positionCard(e[0]||null,null);return}t.width=Math.max(0,t.right-t.left),t.height=Math.max(0,t.bottom-t.top);const o=resolveStepHighlightPadding(currentStep),r=Math.max(0,t.width+o.left+o.right),n=Math.max(0,t.height+o.top+o.bottom),{offsetLeft:a,offsetTop:s}=getOverlayMetrics(),l=t.left+a-o.left,u=t.top+s-o.top,d=Number.isFinite(l)?l:0,m=Number.isFinite(u)?u:0;highlightEl.style.width=`${r}px`,highlightEl.style.height=`${n}px`,highlightEl.style.transform=`translate(${d}px, ${m}px)`,highlightEl.style.opacity="1",positionCard(e[0]||null,t)}function positionCard(e,t){if(!cardEl)return;const o=getOverlayMetrics(),r=getRootFontSizePx();updateHeroInlineSize(currentStep&&currentStep.size,o,r);const n=o&&typeof o.offsetLeft=="number"?o.offsetLeft:0,a=o&&typeof o.offsetTop=="number"?o.offsetTop:0,s=o&&typeof o.viewportWidth=="number"?o.viewportWidth:0,l=o&&typeof o.viewportHeight=="number"?o.viewportHeight:0,u=e||getTargetElement(currentStep),d=t||(u?u.getBoundingClientRect():null),m=!!(currentStep&&currentStep.forceFloating),y=cardEl.getBoundingClientRect(),h=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.visualViewport,b=DOCUMENT&&DOCUMENT.activeElement?DOCUMENT.activeElement:null,v=isTextInputElement(b),C=[];Number.isFinite(l)&&l>0&&C.push(l),GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.innerHeight=="number"&&GLOBAL_SCOPE$2.innerHeight>0&&C.push(GLOBAL_SCOPE$2.innerHeight),DOCUMENT&&DOCUMENT.documentElement&&typeof DOCUMENT.documentElement.clientHeight=="number"&&DOCUMENT.documentElement.clientHeight>0&&C.push(DOCUMENT.documentElement.clientHeight);const A=C.length>0?Math.max(...C):null;updateBaselineViewportHeight(A,{allowDecrease:!v});const w=baselineViewportHeight||A||l,R=h?Number.isFinite(h.offsetTop)?h.offsetTop:Number.isFinite(h.pageTop)?h.pageTop:0:0,_=Number.isFinite(R)?R:0,G=Number.isFinite(w)&&Number.isFinite(l)?w-l:0,O=v&&(G>KEYBOARD_HEIGHT_THRESHOLD||_>KEYBOARD_OFFSET_THRESHOLD),B=v&&b&&typeof b.getBoundingClientRect=="function"?b.getBoundingClientRect():null;let $=16;if(currentStep&&currentStep.size==="hero"){const ne=resolveHeroMarginPx(s,r);if(Number.isFinite(ne)){const Ce=Math.max(8,ne);$=Math.min($,Ce)}}const V=$+EXTRA_ONBOARDING_CARD_VIEWPORT_TOP_MARGIN,M=$+Math.max(8,$*.5)+EXTRA_ONBOARDING_CARD_TOP_PLACEMENT_GAP,F=n+s,z=a+l,x=n+$,H=a+V,W=Math.max(x,F-y.width-$),U=Math.max(H,z-y.height-$);let j=a+Math.max(V,(l-y.height)/2),Y=n+Math.max($,(s-y.width)/2),le="floating";if(!m&&u&&d){const ne=d,Ce=ne.top+a,Ee=ne.left+n,Pe=Ee+ne.width/2,et=Ce+ne.height/2,Je=currentStep&&currentStep.cardOverlap?currentStep.cardOverlap:null,it=$t=>typeof $t!="number"||Number.isNaN($t)?0:Math.min(Math.max($t,0),.95),rt=Je?it(Je.top):0,Pt=Je?it(Je.right):0,vt=Je?it(Je.bottom):0,bo=Je?it(Je.left):0,Et=ne.height*rt,Ut=ne.width*Pt,ge=ne.height*vt,ue=ne.width*bo,We=rt>0?$:M,Me=rt>0?$:0,Te=Pt>0?$:0,Be=vt>0?$:0,Ve=bo>0?$:0,mt=[{name:"bottom",top:Ce+ne.height+$-ge-Be,left:Pe-y.width/2,fits:Ce+ne.height+$+y.height-ge-Be<=z-$},{name:"top",top:Ce-y.height-We+Et+Me,left:Pe-y.width/2,fits:Ce-y.height-We+Et+Me>=H},{name:"right",top:et-y.height/2,left:Ee+ne.width+$-Ut-Te,fits:Ee+ne.width+$+y.width-Ut-Te<=F-$},{name:"left",top:et-y.height/2,left:Ee-y.width-$+ue+Ve,fits:Ee-y.width-$+ue+Ve>=x}].map($t=>{const fo=Math.min(Math.max($t.top,H),U),no=Math.min(Math.max($t.left,x),W),Nt=Math.abs(fo-$t.top)+Math.abs(no-$t.left);return{...$t,clampedTop:fo,clampedLeft:no,overflow:Nt}});let ct=mt.find($t=>$t.fits);ct||(ct=mt.reduce(($t,fo)=>!$t||fo.overflow<$t.overflow?fo:$t,null)),ct&&(j=ct.clampedTop,Y=ct.clampedLeft,le=ct.name)}let be=Math.min(Math.max(j,H),U),re=Math.min(Math.max(Y,x),W),de=le;if(O&&B){const ne=Math.max(8,$),Ce=B.top+a,Ee=Ce+B.height;if(be+y.height>Ce-ne&&be<Ee+ne){const Je=Ce-ne,it=Ee+ne,rt=Math.max(0,Je-H),Pt=Math.max(0,z-it),vt=We=>{const Me=We+y.height,Te=Math.max(We,Je),Be=Math.min(Me,it);return Math.max(0,Be-Te)},bo=Math.max(H,Math.min(U,Je-y.height)),Et=Math.min(U,Math.max(H,it)),Ut=vt(bo),ge=vt(Et);let ue;rt>Pt?ue=Ut<=ge?bo:Et:Pt>rt?ue=ge<=Ut?Et:bo:ue=ge<Ut?Et:bo,be=Math.min(Math.max(ue,H),U),de="floating"}}cardEl.style.top=`${be}px`,cardEl.style.left=`${re}px`,de!==lastCardPlacement&&(lastCardPlacement=de,cardEl.setAttribute("data-placement",de))}function ensureSettingsForStep(e){if(!e||!e.ensureSettings)return;const t=DOCUMENT.getElementById("settingsDialog");if(!t)return;const o=e.ensureSettings.autoOpen!==!1,r=typeof isDialogOpen=="function"?isDialogOpen(t):!t.hasAttribute("hidden");if(settingsDialogRef=t,!r&&o){const n=DOCUMENT.getElementById("settingsButton");if(n&&typeof n.click=="function")try{n.click(),autoOpenedSettings=!0}catch(a){safeWarn("cine.features.onboardingTour could not trigger settings button click.",a)}if(!autoOpenedSettings){if(t.removeAttribute("hidden"),typeof openDialog=="function")try{openDialog(t)}catch(a){safeWarn("cine.features.onboardingTour could not open settings dialog.",a)}else if(typeof t.showModal=="function")try{t.showModal()}catch(a){safeWarn("cine.features.onboardingTour could not show modal settings dialog.",a)}autoOpenedSettings=!0}}else autoOpenedSettings=!1;if(e.ensureSettings.tabId&&typeof activateSettingsTab=="function")try{activateSettingsTab(e.ensureSettings.tabId)}catch(n){safeWarn("cine.features.onboardingTour could not activate settings tab.",n)}}function ensureContactsForStep(e){if(!e||!e.ensureContacts)return;contactsDialogRef||(contactsDialogRef=DOCUMENT.getElementById("contactsDialog"));const t=contactsDialogRef;if(!t||isContactsDialogVisible())return;autoOpenedContacts=!0;const r=DOCUMENT.getElementById("openContactsBtn")||DOCUMENT.querySelector('[data-sidebar-action="open-contacts"]');if(r&&typeof r.click=="function")try{r.click()}catch(n){safeWarn("cine.features.onboardingTour could not trigger contacts button click.",n)}if(!isContactsDialogVisible()){if(t.removeAttribute("hidden"),typeof openDialog=="function")try{openDialog(t);return}catch(n){safeWarn("cine.features.onboardingTour could not open contacts dialog.",n)}if(typeof t.showModal=="function")try{t.showModal();return}catch(n){safeWarn("cine.features.onboardingTour could not show contacts dialog.",n)}t.setAttribute("open","")}}function isContactsDialogVisible(){if(!contactsDialogRef)return!1;if(typeof isDialogOpen=="function")try{return isDialogOpen(contactsDialogRef)}catch(e){safeWarn("cine.features.onboardingTour could not evaluate contacts dialog state.",e)}return!contactsDialogRef.hasAttribute("hidden")}function closeContactsIfNeeded(){if(!contactsDialogRef||!autoOpenedContacts){autoOpenedContacts=!1;return}if(typeof closeDialog=="function")try{closeDialog(contactsDialogRef)}catch(e){safeWarn("cine.features.onboardingTour could not close contacts dialog via closeDialog.",e)}else if(typeof contactsDialogRef.close=="function")try{contactsDialogRef.close()}catch(e){safeWarn("cine.features.onboardingTour could not close contacts dialog.",e)}contactsDialogRef.setAttribute("hidden",""),autoOpenedContacts=!1}function ensureHeroCardForStep(e){if(!e||!e.ensureHeroCard)return;const t=DOCUMENT.getElementById("heroCard");t&&t.classList.contains("hidden")&&t.classList.remove("hidden")}function ensureOwnGearForStep(e){if(!e||!e.ensureOwnGear)return;ownGearDialogRef||(ownGearDialogRef=DOCUMENT.getElementById("ownGearDialog"));const t=ownGearDialogRef;if(!t||isOwnGearDialogVisible())return;autoOpenedOwnGear=!0;const o=DOCUMENT.querySelector('[data-sidebar-action="open-own-gear"]');if(o&&typeof o.click=="function")try{o.click()}catch(r){safeWarn("cine.features.onboardingTour could not trigger own gear button click.",r)}if(!isOwnGearDialogVisible()){if(t.removeAttribute("hidden"),typeof openDialog=="function")try{openDialog(t);return}catch(r){safeWarn("cine.features.onboardingTour could not open own gear dialog.",r)}if(typeof t.showModal=="function")try{t.showModal();return}catch(r){safeWarn("cine.features.onboardingTour could not show own gear dialog.",r)}t.setAttribute("open","")}}function isOwnGearDialogVisible(){if(!ownGearDialogRef)return!1;if(typeof isDialogOpen=="function")try{return isDialogOpen(ownGearDialogRef)}catch(e){safeWarn("cine.features.onboardingTour could not evaluate own gear dialog state.",e)}return!ownGearDialogRef.hasAttribute("hidden")}function closeOwnGearIfNeeded(){if(!ownGearDialogRef||!autoOpenedOwnGear){autoOpenedOwnGear=!1;return}if(typeof closeDialog=="function")try{closeDialog(ownGearDialogRef)}catch(e){safeWarn("cine.features.onboardingTour could not close own gear dialog via closeDialog.",e)}else if(typeof ownGearDialogRef.close=="function")try{ownGearDialogRef.close()}catch(e){safeWarn("cine.features.onboardingTour could not close own gear dialog.",e)}ownGearDialogRef.setAttribute("hidden",""),autoOpenedOwnGear=!1}function isProjectDialogVisible(){if(projectDialogRef||(projectDialogRef=DOCUMENT.getElementById("projectDialog")),!projectDialogRef)return!1;if(typeof isDialogOpen=="function")try{return isDialogOpen(projectDialogRef)}catch(o){safeWarn("cine.features.onboardingTour could not evaluate project dialog state.",o)}const e=typeof projectDialogRef.open=="boolean"?projectDialogRef.open:null,t=typeof projectDialogRef.hasAttribute=="function"?projectDialogRef.hasAttribute("open"):!1;return e===null?t:e||t}function ensureProjectDialogForStep(e){if(!(!e||!e.ensureProjectDialog)&&(projectDialogRef||(projectDialogRef=DOCUMENT.getElementById("projectDialog")),!!projectDialogRef)){if(isProjectDialogVisible()){autoOpenedProjectDialog=!1;return}if(autoOpenedProjectDialog=!0,projectDialogTriggerRef||(projectDialogTriggerRef=DOCUMENT.getElementById("generateGearListBtn")),projectDialogTriggerRef&&typeof projectDialogTriggerRef.click=="function")try{projectDialogTriggerRef.click();return}catch(t){safeWarn("cine.features.onboardingTour could not trigger project dialog button.",t)}if(typeof GLOBAL_SCOPE$2.openProjectDialogWithInfo=="function")try{GLOBAL_SCOPE$2.openProjectDialogWithInfo();return}catch(t){safeWarn("cine.features.onboardingTour could not open project dialog via helper.",t)}if(projectDialogRef.removeAttribute("hidden"),typeof openDialog=="function")try{openDialog(projectDialogRef);return}catch(t){safeWarn("cine.features.onboardingTour could not open project dialog.",t)}if(typeof projectDialogRef.showModal=="function")try{projectDialogRef.showModal();return}catch(t){safeWarn("cine.features.onboardingTour could not show project dialog.",t)}projectDialogRef.setAttribute("open","")}}function attachProjectDialogVisibilityMonitor(){if(projectDialogVisibilityCleanup||(projectDialogRef||(projectDialogRef=DOCUMENT.getElementById("projectDialog")),!projectDialogRef))return;const e=()=>{!active||!currentStep||!currentStep.ensureProjectDialog||setTimeout(()=>{isProjectDialogVisible()||ensureProjectDialogForStep(currentStep)},50)};projectDialogRef.addEventListener("close",e),projectDialogRef.addEventListener("cancel",e);let t=null;if(typeof MutationObserver=="function")try{t=new MutationObserver(e),t.observe(projectDialogRef,{attributes:!0,attributeFilter:["open","hidden","aria-hidden"]})}catch(o){safeWarn("cine.features.onboardingTour could not observe project dialog visibility.",o),t=null}projectDialogVisibilityCleanup=()=>{if(projectDialogRef.removeEventListener("close",e),projectDialogRef.removeEventListener("cancel",e),t)try{t.disconnect()}catch(o){safeWarn("cine.features.onboardingTour could not detach project dialog observer.",o)}t=null,projectDialogVisibilityCleanup=null}}function detachProjectDialogVisibilityMonitor(){if(typeof projectDialogVisibilityCleanup=="function")try{projectDialogVisibilityCleanup()}catch(e){safeWarn("cine.features.onboardingTour could not detach project dialog visibility monitor.",e)}projectDialogVisibilityCleanup=null}function closeProjectDialogIfNeeded(){if(!projectDialogRef||!autoOpenedProjectDialog){autoOpenedProjectDialog=!1;return}if(typeof closeDialog=="function")try{closeDialog(projectDialogRef)}catch(e){safeWarn("cine.features.onboardingTour could not close project dialog via closeDialog.",e)}else if(typeof projectDialogRef.close=="function")try{projectDialogRef.close()}catch(e){safeWarn("cine.features.onboardingTour could not close project dialog.",e)}else projectDialogRef.removeAttribute("open");autoOpenedProjectDialog=!1}function isDeviceManagerVisible(){return deviceManagerSectionRef||(deviceManagerSectionRef=DOCUMENT.getElementById("device-manager")),deviceManagerSectionRef?!deviceManagerSectionRef.classList.contains("hidden"):!1}function ensureDeviceManagerForStep(e){if(!e||!e.ensureDeviceManager||(deviceManagerSectionRef||(deviceManagerSectionRef=DOCUMENT.getElementById("device-manager")),!deviceManagerSectionRef))return;if(isDeviceManagerVisible()){autoOpenedDeviceManager=!1;return}if(deviceManagerToggleRef||(deviceManagerToggleRef=DOCUMENT.getElementById("toggleDeviceManager")),autoOpenedDeviceManager=!0,deviceManagerToggleRef&&typeof deviceManagerToggleRef.click=="function")try{deviceManagerToggleRef.click()}catch(o){safeWarn("cine.features.onboardingTour could not trigger device manager toggle.",o)}if(isDeviceManagerVisible())return;const t=GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.showDeviceManagerSection=="function"?GLOBAL_SCOPE$2.showDeviceManagerSection:null;if(t)try{t()}catch(o){safeWarn("cine.features.onboardingTour could not open device manager via showDeviceManagerSection.",o)}isDeviceManagerVisible()||(deviceManagerSectionRef.classList.remove("hidden"),deviceManagerToggleRef||(deviceManagerToggleRef=DOCUMENT.getElementById("toggleDeviceManager")),deviceManagerToggleRef&&deviceManagerToggleRef.setAttribute("aria-expanded","true"),isDeviceManagerVisible()||(autoOpenedDeviceManager=!1))}function closeDeviceManagerIfNeeded(){if(!autoOpenedDeviceManager){autoOpenedDeviceManager=!1;return}if(deviceManagerSectionRef||(deviceManagerSectionRef=DOCUMENT.getElementById("device-manager")),deviceManagerToggleRef||(deviceManagerToggleRef=DOCUMENT.getElementById("toggleDeviceManager")),deviceManagerToggleRef&&typeof deviceManagerToggleRef.click=="function")try{deviceManagerSectionRef&&deviceManagerSectionRef.classList.contains("hidden")||deviceManagerToggleRef.click()}catch(e){safeWarn("cine.features.onboardingTour could not toggle device manager closed.",e)}if(isDeviceManagerVisible()){const e=GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.hideDeviceManagerSection=="function"?GLOBAL_SCOPE$2.hideDeviceManagerSection:null;if(e)try{e()}catch(t){safeWarn("cine.features.onboardingTour could not close device manager via hideDeviceManagerSection.",t)}else deviceManagerSectionRef&&(deviceManagerSectionRef.classList.add("hidden"),deviceManagerToggleRef||(deviceManagerToggleRef=DOCUMENT.getElementById("toggleDeviceManager")),deviceManagerToggleRef&&deviceManagerToggleRef.setAttribute("aria-expanded","false"))}autoOpenedDeviceManager=!1}function focusDeviceManagerNameField(){if(!DOCUMENT)return!1;let e=null;try{e=DOCUMENT.getElementById("newName")}catch{e=null}if(!e||!isHighlightElementUsable(e))return!1;let t=!1;if(typeof e.focus=="function")try{e.focus({preventScroll:!0}),t=!0}catch{try{e.focus(),t=!0}catch{}}if(!t)return!1;if(typeof e.select=="function")try{return e.select(),!0}catch{}if(typeof e.setSelectionRange=="function")try{const o=typeof e.value=="string"?e.value.length:0;return e.setSelectionRange(0,o),!0}catch{}return!0}function attachDeviceManagerNameAutofill(){if(!DOCUMENT)return null;deviceManagerSectionRef||(deviceManagerSectionRef=DOCUMENT.getElementById("device-manager")),deviceManagerToggleRef||(deviceManagerToggleRef=DOCUMENT.getElementById("toggleDeviceManager"));const e=()=>{isDeviceManagerVisible()&&focusDeviceManagerNameField()},t=()=>{typeof setTimeout=="function"?setTimeout(e,50):e()};let o=!1;deviceManagerToggleRef&&typeof deviceManagerToggleRef.addEventListener=="function"&&(deviceManagerToggleRef.addEventListener("click",t),o=!0);let r=null;if(deviceManagerSectionRef&&typeof MutationObserver=="function")try{r=new MutationObserver(()=>{e()}),r.observe(deviceManagerSectionRef,{attributes:!0,attributeFilter:["class","hidden"]})}catch(n){safeWarn("cine.features.onboardingTour could not observe device manager visibility.",n),r=null}return e(),()=>{o&&deviceManagerToggleRef&&typeof deviceManagerToggleRef.removeEventListener=="function"&&deviceManagerToggleRef.removeEventListener("click",t),r&&r.disconnect()}}function isSettingsDialogVisible(){if(!settingsDialogRef)return!1;if(typeof isDialogOpen=="function")try{return isDialogOpen(settingsDialogRef)}catch(e){safeWarn("cine.features.onboardingTour could not evaluate settings dialog state.",e)}return!settingsDialogRef.hasAttribute("hidden")}function closeSettingsIfNeeded(){if(settingsDialogRef&&autoOpenedSettings){if(typeof closeDialog=="function")try{closeDialog(settingsDialogRef)}catch(e){safeWarn("cine.features.onboardingTour could not close settings dialog via closeDialog.",e)}else if(typeof settingsDialogRef.close=="function")try{settingsDialogRef.close()}catch(e){safeWarn("cine.features.onboardingTour could not close settings dialog.",e)}settingsDialogRef.setAttribute("hidden",""),autoOpenedSettings=!1}}function getStepTexts(e){if(!e)return{title:"",body:""};const t=tourTexts.steps&&tourTexts.steps[e.key]?tourTexts.steps[e.key]:{title:e.key,body:""};return{title:typeof t.title=="string"?t.title:e.key,body:typeof t.body=="string"?t.body:""}}function updateResumeHint(e){if(!resumeHintEl)return;if(!resumeHintVisible||typeof e!="number"||e<0){resumeHintEl.hidden=!0,resumeHintEl.textContent="";return}const t=getCountableStepTotal(stepConfig),o=storedState&&Array.isArray(storedState.completedSteps)?storedState.completedSteps:[],r=new Set(o),n=getCountableCompletedCount(stepConfig,r),a=getCountableStepIndex(stepConfig,e);if(a===null){const u=tourTexts.resumeHint||"";if(!u){resumeHintEl.hidden=!0,resumeHintEl.textContent="";return}resumeHintEl.hidden=!1,resumeHintEl.textContent=u;return}const l=(tourTexts.resumeHintDetailed||tourTexts.resumeHint||"Resuming where you left off.").replace("{current}",String(a+1)).replace("{total}",String(t)).replace("{completed}",String(Math.min(n,t)));resumeHintEl.hidden=!1,resumeHintEl.textContent=l}function updateStepList(e){if(!stepListEl)return;const t=typeof e=="number"&&e>=0?e:0,o=stepConfig.length,r={current:tourTexts.stepStatusCurrent||"Current step",complete:tourTexts.stepStatusComplete||"Completed",upcoming:tourTexts.stepStatusUpcoming||"Locked"},n=new Set(storedState&&Array.isArray(storedState.completedSteps)?storedState.completedSteps:[]),a=currentStep?currentStep.key:stepConfig[t]&&stepConfig[t].key;stepListEl.textContent="",typeof stepListEl.setAttribute=="function"&&stepListEl.setAttribute("aria-label",tourTexts.stepListAriaLabel||"Tutorial steps");for(let s=0;s<o;s+=1){const l=stepConfig[s],u=getStepTexts(l),d=DOCUMENT.createElement("li");d.className="onboarding-step-item",l&&typeof l.key=="string"&&l.key&&d.setAttribute("data-step-key",l.key),s<3&&(d.classList.add("onboarding-step-item--pinned"),d&&d.style&&typeof d.style.setProperty=="function"&&d.style.setProperty("--onboarding-step-pinned-index",String(s)));let m;l&&l.key===a?m="current":l&&n.has(l.key)?m="complete":m="upcoming",d.setAttribute("data-status",m);const y=DOCUMENT.createElement("button");y.type="button",y.className="onboarding-step-button",y.disabled=m==="upcoming",y.setAttribute("data-step-index",String(s)),y.setAttribute("aria-current",m==="current"?"step":"false");const h=u.title||l.key,b=r[m]||"";y.setAttribute("aria-label",b?`${h}. ${b}.`:h);const v=DOCUMENT.createElement("span");v.className="onboarding-step-title",v.textContent=h,y.appendChild(v);const C=DOCUMENT.createElement("span");C.className="onboarding-step-status",C.textContent=b,y.appendChild(C),d.appendChild(y),stepListEl.appendChild(d)}}function focusHighlightedElement(e){if(!e)return!1;const t=[],o=toSelectorArray(e.focus);for(let l=0;l<o.length;l+=1){const u=o[l];t.indexOf(u)===-1&&t.push(u)}const r=toSelectorArray(e.highlight);for(let l=0;l<r.length;l+=1){const u=r[l];t.indexOf(u)===-1&&t.push(u)}const n=toSelectorArray(e.alternateHighlight);for(let l=0;l<n.length;l+=1){const u=n[l];t.indexOf(u)===-1&&t.push(u)}let a=null;for(let l=0;l<t.length;l+=1){const u=t[l];if(!u)continue;const d=DOCUMENT.querySelector(u);if(d&&typeof d.focus=="function"&&isHighlightElementUsable(d)){a=d;break}}if(!a)return!1;const s=()=>{try{a.focus({preventScroll:!0})}catch{try{a.focus()}catch{}}const l=a.ownerDocument&&a.ownerDocument.defaultView;if(!!(l&&(a instanceof l.HTMLInputElement||a instanceof l.HTMLTextAreaElement))&&typeof a.select=="function"&&a.value)try{a.select()}catch{}};return typeof queueMicrotask=="function"?queueMicrotask(s):setTimeout(s,0),!0}function dispatchSyntheticEvent(e,t){if(!(!e||!t))try{const o=new Event(t,{bubbles:!0,cancelable:!0});e.dispatchEvent(o)}catch(o){try{const r=DOCUMENT.createEvent("Event");r.initEvent(t,!0,!0),e.dispatchEvent(r)}catch(r){safeWarn("cine.features.onboardingTour could not dispatch synthetic event.",r||o)}}}function applyLanguagePreference(e){const t=typeof e=="string"?e.trim():"";if(!t)return!1;let o=!1;const r={};if(typeof GLOBAL_SCOPE$2.callCoreFunctionIfAvailable=="function")try{GLOBAL_SCOPE$2.callCoreFunctionIfAvailable("setLanguage",[t],{defaultValue:r})!==r&&(o=!0)}catch(n){safeWarn("cine.features.onboardingTour could not route language preference via runtime bridge.",n)}if(!o&&typeof GLOBAL_SCOPE$2.setLanguage=="function")try{const n=GLOBAL_SCOPE$2.setLanguage(t);n&&typeof n.then=="function"&&n.catch(a=>{safeWarn("cine.features.onboardingTour async language sync failed.",a)}),o=!0}catch(n){safeWarn("cine.features.onboardingTour could not sync language preference.",n)}return o}function renderIntroInteraction(e){if(!interactionContainerEl)return!1;const t=tourTexts&&tourTexts.steps&&tourTexts.steps.intro?tourTexts.steps.intro:{},o=t&&typeof t.hero=="object"?t.hero:{},r=Array.isArray(o.highlights)?o.highlights:[],n=typeof o.heading=="string"&&o.heading?o.heading:typeof t.title=="string"?t.title:"",a=typeof o.subheading=="string"?o.subheading:"",s=typeof o.summary=="string"?o.summary:"",l=typeof o.badgeIcon=="string"&&o.badgeIcon?o.badgeIcon:"",u=typeof o.badgeLabel=="string"?o.badgeLabel:"",d=typeof o.badgeDescription=="string"?o.badgeDescription:"",m=typeof o.languageLabel=="string"?o.languageLabel:"Language",y=typeof o.languageHint=="string"?o.languageHint:"",h=typeof o.offlineSummary=="string"?o.offlineSummary:"";interactionContainerEl.hidden=!1,interactionContainerEl.classList.add("onboarding-interaction--hero"),e(()=>{interactionContainerEl.classList.remove("onboarding-interaction--hero")});const b=DOCUMENT.createElement("div");b.className="onboarding-hero";let v=null;if(u||d){const U=DOCUMENT.createElement("li");U.className="onboarding-hero-highlight onboarding-hero-highlight--badge";const j=DOCUMENT.createElement("span");j.className="icon-glyph onboarding-hero-highlight-icon onboarding-hero-highlight-icon--badge",j.setAttribute("data-icon-font","uicons"),j.setAttribute("aria-hidden","true"),j.textContent=l,U.appendChild(j);const Y=DOCUMENT.createElement("div");if(Y.className="onboarding-hero-highlight-text onboarding-hero-highlight-text--badge",u){const le=DOCUMENT.createElement("span");le.className="onboarding-hero-highlight-badge-label",le.textContent=u,Y.appendChild(le)}if(d){const le=DOCUMENT.createElement("span");le.className="onboarding-hero-highlight-badge-description",le.textContent=d,Y.appendChild(le)}U.appendChild(Y),v=U}if(n||a||s){const U=DOCUMENT.createElement("div");U.className="onboarding-hero-banner";const j=DOCUMENT.createElement("div");if(j.className="onboarding-hero-header",n){const Y=DOCUMENT.createElement("h1");Y.className="onboarding-hero-heading",Y.textContent=n,j.appendChild(Y)}if(a){const Y=DOCUMENT.createElement("p");Y.className="onboarding-hero-subheading",Y.textContent=a,j.appendChild(Y)}if(s){const Y=DOCUMENT.createElement("p");Y.className="onboarding-hero-summary",Y.textContent=s,j.appendChild(Y)}U.appendChild(j),b.appendChild(U)}if(r.length||v){const U=DOCUMENT.createElement("ul");U.className="onboarding-hero-highlights",v&&U.appendChild(v);for(let j=0;j<r.length;j+=1){const Y=r[j]&&typeof r[j]=="object"?r[j]:{},le=DOCUMENT.createElement("li");le.className="onboarding-hero-highlight";const be=DOCUMENT.createElement("span");be.className="icon-glyph onboarding-hero-highlight-icon",be.setAttribute("data-icon-font","uicons"),be.setAttribute("aria-hidden","true"),be.textContent=typeof Y.icon=="string"&&Y.icon?Y.icon:"",le.appendChild(be);const re=DOCUMENT.createElement("div");if(re.className="onboarding-hero-highlight-text",typeof Y.title=="string"&&Y.title){const de=DOCUMENT.createElement("h3");de.className="onboarding-hero-highlight-title",de.textContent=Y.title,re.appendChild(de)}if(typeof Y.body=="string"&&Y.body){const de=DOCUMENT.createElement("p");de.className="onboarding-hero-highlight-body",de.textContent=Y.body,re.appendChild(de)}le.appendChild(re),U.appendChild(le)}b.appendChild(U)}const C=DOCUMENT.createElement("div");C.className="onboarding-hero-language";const A=[],w=new Set,R=getProxyControlId("intro-language"),_=DOCUMENT.createElement("label");_.className="onboarding-hero-language-label",_.setAttribute("for",R),_.textContent=m,C.appendChild(_);const G=DOCUMENT.createElement("select");G.id=R,G.className="onboarding-field-select onboarding-hero-language-select";const O=U=>{const j=G.value;if(G.textContent="",!U)return;const Y=U&&U.options?Array.from(U.options):[];if(Y.length)for(let le=0;le<Y.length;le+=1)G.appendChild(Y[le].cloneNode(!0));else if(typeof U.value=="string"){const le=DOCUMENT.createElement("option");le.value=U.value,le.textContent=U.value||"",G.appendChild(le)}j&&(G.value=j)},B=()=>{for(let U=0;U<A.length;U+=1){const j=A[U];if(j&&typeof j.value=="string"&&j.value)return j.value}return""},$=()=>{if(!A.length)return;const U=A[0];if(U){const j=B()||G.value;O(U),j&&(G.value=j)}},V=()=>{const U={en:"English",de:"Deutsch",es:"Español",fr:"Français",it:"Italiano"},j=[],Y=new Set,le=be=>{const re=typeof be=="string"?be.trim():"";!re||Y.has(re)||(Y.add(re),j.push({value:re,label:U[re]||re}))};if(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.texts=="object"&&GLOBAL_SCOPE$2.texts)try{Object.keys(GLOBAL_SCOPE$2.texts).forEach(le)}catch{}return Object.keys(U).forEach(le),j.length||le("en"),j},M=()=>{const U=G.value;G.textContent="";const j=V();for(let le=0;le<j.length;le+=1){const be=DOCUMENT.createElement("option");be.value=j[le].value,be.textContent=j[le].label,G.appendChild(be)}const Y=U||resolveLanguage();Y&&(G.value=Y)},F=()=>{const U=G.value,j=applyLanguagePreference(U);for(let le=0;le<A.length;le+=1){const be=A[le];be&&(typeof be.value=="string"&&be.value!==U&&(be.value=U),j||dispatchSyntheticEvent(be,"change"))}const Y=()=>{try{$()}catch{}if(j)try{handleLanguageChange()}catch{}};if(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.requestAnimationFrame=="function")try{GLOBAL_SCOPE$2.requestAnimationFrame(()=>{Y()});return}catch{}if(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.queueMicrotask=="function")try{GLOBAL_SCOPE$2.queueMicrotask(Y);return}catch{}if(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.setTimeout=="function")try{GLOBAL_SCOPE$2.setTimeout(Y,0);return}catch{}Y()};G.disabled=!1,G.removeAttribute("aria-disabled"),G.addEventListener("change",F),e(()=>{G.removeEventListener("change",F)});const z=()=>{$();try{handleLanguageChange()}catch{}},x=U=>{if(!U||w.has(U))return;w.add(U),A.push(U);const j=()=>{z()};U.addEventListener("change",j),U.addEventListener("input",j);let Y=null;if(GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.MutationObserver&&typeof GLOBAL_SCOPE$2.MutationObserver=="function")try{Y=new GLOBAL_SCOPE$2.MutationObserver(()=>{$()}),Y.observe(U,{childList:!0})}catch{Y=null}e(()=>{if(U.removeEventListener("change",j),U.removeEventListener("input",j),Y)try{Y.disconnect()}catch{}w.delete(U);const le=A.indexOf(U);le!==-1&&A.splice(le,1)}),$(),G.disabled=!1,G.removeAttribute("aria-disabled")},H=()=>{if(!DOCUMENT||typeof DOCUMENT.getElementById!="function")return;const U=DOCUMENT.getElementById("languageSelect");U&&x(U);const j=DOCUMENT.getElementById("settingsLanguage");j&&j!==U&&x(j)};H(),A.length||M();let W=null;if(GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.MutationObserver&&typeof GLOBAL_SCOPE$2.MutationObserver=="function")try{W=new GLOBAL_SCOPE$2.MutationObserver(U=>{let j=!1;if(U&&typeof U[Symbol.iterator]=="function"){for(const le of U)if(le.target!==G&&!G.contains(le.target)){j=!0;break}}else j=!0;if(!j)return;const Y=A.length;H(),A.length?Y||$():M()}),W.observe(DOCUMENT.documentElement||DOCUMENT,{childList:!0,subtree:!0})}catch{W=null}if(e(()=>{if(W)try{W.disconnect()}catch{}}),GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.addEventListener=="function"){const U=()=>{$()};try{GLOBAL_SCOPE$2.addEventListener("languagechange",U),e(()=>{try{GLOBAL_SCOPE$2.removeEventListener("languagechange",U)}catch(j){}})}catch(j){safeWarn("cine.features.onboardingTour could not observe language changes.",j)}}if(C.appendChild(G),y){const U=DOCUMENT.createElement("p");U.className="onboarding-hero-language-hint",U.textContent=y,C.appendChild(U)}if(b.insertBefore(C,b.firstChild||null),h){const U=DOCUMENT.createElement("p");U.className="onboarding-hero-offline",U.textContent=h,b.appendChild(U)}for(;interactionContainerEl.firstChild;)interactionContainerEl.removeChild(interactionContainerEl.firstChild);return interactionContainerEl.appendChild(b),!0}function renderUserProfileInteraction(e){if(!interactionContainerEl)return!1;const t=DOCUMENT.getElementById("userProfileName"),o=DOCUMENT.getElementById("userProfileNameLabel"),r=DOCUMENT.getElementById("userProfileRole"),n=DOCUMENT.getElementById("userProfileRoleLabel"),a=DOCUMENT.getElementById("userProfilePhone"),s=DOCUMENT.getElementById("userProfilePhoneLabel"),l=DOCUMENT.getElementById("userProfileEmail"),u=DOCUMENT.getElementById("userProfileEmailLabel"),d=DOCUMENT.getElementById("userProfileAvatar"),m=DOCUMENT.getElementById("userProfileAvatarButton"),y=DOCUMENT.getElementById("userProfileAvatarButtonLabel"),h=DOCUMENT.getElementById("userProfileAvatarInput"),b=DOCUMENT.createDocumentFragment(),v=DOCUMENT.createElement("p");v.className="onboarding-resume-hint";const C=tourTexts&&typeof tourTexts.userProfileInteractionIntro=="string"?tourTexts.userProfileInteractionIntro:"Enter your crew details once. Each update syncs to Contacts instantly, stays cached offline and flows into exports so crews always know who owns the setup.";v.textContent=C,b.appendChild(v);const A=DOCUMENT.createElement("div");A.className="onboarding-avatar-group";const w=DOCUMENT.createElement("div");w.className="onboarding-avatar-preview",A.appendChild(w);const R=ue=>{const We=DOCUMENT.createElement("span");We.className="contact-card-avatar-initial",We.textContent=ue||"•",w.appendChild(We)},_=()=>{const ue=t&&typeof t.value=="string"?t.value.trim():"";return ue?ue.charAt(0).toUpperCase():"•"},G=()=>{let ue=!1;for(;w.firstChild;)w.removeChild(w.firstChild);if(d){const We=d.querySelector(".contact-card-avatar-visual");if(We){const Me=We.querySelector("img");if(Me&&Me.src){const Te=DOCUMENT.createElement("img");Te.src=Me.src,Te.alt="",w.appendChild(Te),ue=!0}else{const Te=We.textContent?We.textContent.trim():"";if(Te){R(Te.charAt(0).toUpperCase());return}}}}ue||R(_())},O=y&&typeof y.textContent=="string"?y.textContent.trim():"",B=tourTexts&&typeof tourTexts.userProfileAvatarAction=="string"?tourTexts.userProfileAvatarAction:"Add profile photo",$=tourTexts&&typeof tourTexts.userProfileAvatarEditAction=="string"?tourTexts.userProfileAvatarEditAction:"Edit photo",V=(()=>{const ue=resolveLanguage(),We=GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.texts=="object"?GLOBAL_SCOPE$2.texts:{},Me=We&&typeof We[ue]=="object"?We[ue]:null,Te=We&&typeof We.en=="object"?We.en:null,Be=Me&&typeof Me.contacts=="object"?Me.contacts:null,Ve=Te&&typeof Te.contacts=="object"?Te.contacts:null,je=Be&&typeof Be.userProfileAvatarButton=="string"?Be.userProfileAvatarButton.trim():"";return je||(Ve&&typeof Ve.userProfileAvatarButton=="string"?Ve.userProfileAvatarButton.trim():"")})(),M=O?O.trim():"",F=ue=>ue?V&&ue.toLowerCase()===V.toLowerCase():!1,z=ue=>!M||F(M)?ue?$:B:M,x=()=>{if(m){const ue=w.querySelector("img")!==null;m.textContent=z(ue)}},H=typeof GLOBAL_SCOPE$2.readAvatarFile=="function"?GLOBAL_SCOPE$2.readAvatarFile:typeof GLOBAL_SCOPE$2.localReadAvatarFile=="function"?GLOBAL_SCOPE$2.localReadAvatarFile:null,W=typeof GLOBAL_SCOPE$2.setAvatar=="function"?GLOBAL_SCOPE$2.setAvatar:ue=>{if(typeof GLOBAL_SCOPE$2.assignUserProfileState=="function"){let We="";if(typeof GLOBAL_SCOPE$2.getUserProfileSnapshot=="function"){const Me=GLOBAL_SCOPE$2.getUserProfileSnapshot();Me&&Me.name&&(We=Me.name)}GLOBAL_SCOPE$2.assignUserProfileState({avatar:ue,name:We}),typeof GLOBAL_SCOPE$2.persistUserProfileState=="function"&&GLOBAL_SCOPE$2.persistUserProfileState()}};m&&(m.addEventListener("click",G),e(()=>{m.removeEventListener("click",G)}));const U=DOCUMENT.createElement("input");U.type="file",U.id="userProfileAvatarUploadProxy",U.style.opacity="0",U.style.position="absolute",U.style.width="1px",U.style.height="1px",U.style.pointerEvents="none",U.tabIndex=-1,U.setAttribute("aria-hidden","true"),U.addEventListener("change",ue=>{const We=ue.target.files&&ue.target.files[0];We&&typeof H=="function"&&H(We,Me=>{typeof W=="function"&&(W(Me),G(),x())})});const j=ue=>{ue.preventDefault(),ue.stopPropagation(),A.classList.add("onboarding-avatar-group--drag-over")},Y=ue=>{ue.preventDefault(),ue.stopPropagation(),A.classList.remove("onboarding-avatar-group--drag-over")},le=ue=>{ue.preventDefault(),ue.stopPropagation(),A.classList.remove("onboarding-avatar-group--drag-over");const We=ue.dataTransfer&&ue.dataTransfer.files&&ue.dataTransfer.files[0];We&&typeof H=="function"&&H(We,Me=>{typeof W=="function"&&(W(Me),G(),x())})};A.addEventListener("dragenter",j),A.addEventListener("dragover",j),A.addEventListener("dragleave",Y),A.addEventListener("drop",le),e(()=>{A.removeEventListener("dragenter",j),A.removeEventListener("dragover",j),A.removeEventListener("dragleave",Y),A.removeEventListener("drop",le)}),b.appendChild(U),G();let be=null;if(GLOBAL_SCOPE$2.MutationObserver&&d)try{be=new GLOBAL_SCOPE$2.MutationObserver(()=>G()),be.observe(d,{childList:!0,subtree:!0,attributes:!0}),e(()=>{try{be.disconnect()}catch(ue){}})}catch{}const re=DOCUMENT.createElement("button");re.type="button",re.className="onboarding-avatar-action",re.textContent=z(!1);const de=()=>{if(U&&typeof U.click=="function")try{U.click();return}catch(ue){safeWarn("cine.features.onboardingTour could not trigger avatar proxy input.",ue)}if(h&&typeof h.click=="function")try{h.click();return}catch(ue){safeWarn("cine.features.onboardingTour could not trigger avatar input.",ue)}if(m&&typeof m.click=="function")try{m.click()}catch(ue){safeWarn("cine.features.onboardingTour could not open avatar options.",ue)}};re.addEventListener("click",de),e(()=>{re.removeEventListener("click",de)}),A.appendChild(re),b.appendChild(A);let ne=null;const Ce=ue=>{const{fieldKey:We,labelText:Me,placeholder:Te,target:Be,type:Ve,autocomplete:je,onAfterSync:mt}=ue||{},ct=DOCUMENT.createElement("div");ct.className="onboarding-field-group";const $t=getProxyControlId(We),fo=DOCUMENT.createElement("label");fo.className="onboarding-field-label",fo.setAttribute("for",$t),fo.textContent=Me,ct.appendChild(fo);const no=Ve==="select",Nt=no?DOCUMENT.createElement("select"):DOCUMENT.createElement("input");Nt.id=$t,Nt.className="onboarding-field-input",no?Nt.classList.add("onboarding-field-select"):(Nt.type=Ve||"text",typeof Te=="string"&&Te&&(Nt.placeholder=Te),typeof je=="string"&&je&&(Nt.autocomplete=je));const xo=()=>{if(!no)return;const eo=Be&&Be.options?Array.from(Be.options):[];if(Nt.textContent="",eo.length)eo.forEach(To=>{Nt.appendChild(To.cloneNode(!0))});else if(typeof Te=="string"&&Te){const To=DOCUMENT.createElement("option");To.value="",To.textContent=Te,Nt.appendChild(To)}Nt.value=Be&&typeof Be.value=="string"?Be.value:""};no?xo():Nt.value=Be&&typeof Be.value=="string"?Be.value:"";const Io=()=>{Be&&(no?xo():Nt.value!==Be.value&&(Nt.value=Be.value||""),typeof mt=="function"&&mt("from"))},qo=()=>{if(Be){if(no){const eo=Nt.value;Be.value!==eo&&(Be.value=eo)}else Be.value!==Nt.value&&(Be.value=Nt.value);dispatchSyntheticEvent(Be,"input"),dispatchSyntheticEvent(Be,"change"),typeof mt=="function"&&mt("to")}};if(Nt.addEventListener("input",qo),Nt.addEventListener("change",qo),e(()=>{Nt.removeEventListener("input",qo),Nt.removeEventListener("change",qo)}),Be){if(Be.addEventListener("input",Io),Be.addEventListener("change",Io),e(()=>{Be.removeEventListener("input",Io),Be.removeEventListener("change",Io)}),no&&typeof MutationObserver=="function"){const eo=new MutationObserver(Io);eo.observe(Be,{childList:!0}),e(()=>eo.disconnect())}}else Nt.disabled=!0,Nt.setAttribute("aria-disabled","true");return ct.appendChild(Nt),b.appendChild(ct),ne||(ne=Nt),Nt},Ee=o&&typeof o.textContent=="string"?o.textContent:"Display name";let Pe="e.g. Alex Rivera";if(t&&typeof t.getAttribute=="function"){const ue=t.getAttribute("placeholder");typeof ue=="string"&&ue&&(Pe=ue)}const et=Ce({fieldKey:"user-profile-name",labelText:Ee,placeholder:Pe,target:t,type:"text",autocomplete:"name",onAfterSync:()=>G()}),Je=n&&typeof n.textContent=="string"?n.textContent:"Role or title";let it="Select role";if(r&&r.options&&r.options.length){const ue=r.options[0];ue&&ue.textContent&&(it=ue.textContent)}Ce({fieldKey:"user-profile-role",labelText:Je,placeholder:it,target:r,type:"select"});const rt=s&&typeof s.textContent=="string"?s.textContent:"Phone number";let Pt="";if(a&&typeof a.getAttribute=="function"){const ue=a.getAttribute("placeholder");typeof ue=="string"&&ue&&(Pt=ue)}Ce({fieldKey:"user-profile-phone",labelText:rt,placeholder:Pt,target:a,type:"tel",autocomplete:"tel"});const vt=u&&typeof u.textContent=="string"?u.textContent:"Email address";let bo="";if(l&&typeof l.getAttribute=="function"){const ue=l.getAttribute("placeholder");typeof ue=="string"&&ue&&(bo=ue)}Ce({fieldKey:"user-profile-email",labelText:vt,placeholder:bo,target:l,type:"email",autocomplete:"email"});const Et=DOCUMENT.createElement("p");Et.className="onboarding-resume-hint";const Ut=tourTexts&&typeof tourTexts.userProfileInteractionSkipHint=="string"?tourTexts.userProfileInteractionSkipHint:"Press Next when you are ready—Contacts in the sidebar always shows these saved details without resetting tutorial progress.";for(Et.textContent=Ut,b.appendChild(Et);interactionContainerEl.firstChild;)interactionContainerEl.removeChild(interactionContainerEl.firstChild);interactionContainerEl.appendChild(b),interactionContainerEl.hidden=!1;const ge=ne||et;if(ge&&typeof ge.focus=="function"){const ue=()=>{try{ge.focus({preventScroll:!0})}catch{try{ge.focus()}catch{}}};typeof queueMicrotask=="function"?queueMicrotask(ue):setTimeout(ue,0)}return!0}function renderUnitsPreferencesInteraction(e,t){if(!interactionContainerEl)return!1;const o=DOCUMENT.createDocumentFragment(),r=DOCUMENT.getElementById("settingsLanguage"),n=(re,de)=>(tourTexts&&typeof tourTexts[re]=="string"?tourTexts[re].trim():"")||de;if(r){const re=DOCUMENT.createElement("div");re.className="onboarding-field-group";const de=getProxyControlId("language"),ne=DOCUMENT.createElement("label");ne.className="onboarding-field-label",ne.setAttribute("for",de),ne.textContent=n("unitsPreferencesLanguageLabel","Language");const Ce=DOCUMENT.createElement("select");Ce.id=de,Ce.className="onboarding-field-select";const Ee=Array.from(r.options||[]);if(Ee.length===0){const Je=DOCUMENT.createElement("option");Je.value=r.value||"en",Je.textContent=r.value||"English",Ce.appendChild(Je)}else for(let Je=0;Je<Ee.length;Je+=1){const it=Ee[Je],rt=DOCUMENT.createElement("option");rt.value=it.value,rt.textContent=it.textContent||it.value,Ce.appendChild(rt)}Ce.value=r.value||Ce.value;const Pe=()=>{Ce.value!==r.value&&(Ce.value=r.value)},et=()=>{const Je=Ce.value,it=applyLanguagePreference(Je);if(r.value!==Je&&(r.value=Je),dispatchSyntheticEvent(r,"change"),!it)try{Pe()}catch{}};Ce.addEventListener("change",et),e(()=>{Ce.removeEventListener("change",et)}),r.addEventListener("change",Pe),e(()=>{r.removeEventListener("change",Pe)}),re.appendChild(ne),re.appendChild(Ce),o.appendChild(re)}const a=DOCUMENT.getElementById("settingsDarkMode"),s=DOCUMENT.createElement("div");s.className="onboarding-field-group";const l=getProxyControlId("theme"),u=DOCUMENT.createElement("label");u.className="onboarding-field-label",u.setAttribute("for",l),u.textContent=n("unitsPreferencesThemeLabel","Theme");const d=DOCUMENT.createElement("select");d.id=l,d.className="onboarding-field-select";const m=DOCUMENT.createElement("option");m.value="light",m.textContent=n("unitsPreferencesThemeLight","Light");const y=DOCUMENT.createElement("option");y.value="dark",y.textContent=n("unitsPreferencesThemeDark","Dark"),d.appendChild(m),d.appendChild(y);const h=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.cineThemePreference?GLOBAL_SCOPE$2.cineThemePreference:null;if(h&&typeof h.registerControl=="function"&&typeof h.getValue=="function"){try{const de=h.getValue();typeof de=="boolean"&&(d.value=de?"dark":"light")}catch(de){safeWarn("cine.features.onboardingTour: theme bridge getValue failed.",de)}let re=null;try{re=h.registerControl(d,{type:"select"})}catch(de){safeWarn("cine.features.onboardingTour: theme bridge registerControl failed.",de)}typeof re=="function"&&e(()=>{try{re()}catch(de){safeWarn("cine.features.onboardingTour: theme bridge cleanup failed.",de)}})}else{d.value=a&&a.checked?"dark":"light";const re=()=>{const ne=a&&a.checked?"dark":"light";d.value!==ne&&(d.value=ne)},de=()=>{if(!a)return;const ne=d.value==="dark";a.checked!==ne&&(a.checked=ne,dispatchSyntheticEvent(a,"change"))};d.addEventListener("change",de),e(()=>{d.removeEventListener("change",de)}),a&&(a.addEventListener("change",re),e(()=>{a.removeEventListener("change",re)}))}s.appendChild(u),s.appendChild(d),o.appendChild(s);const b=GLOBAL_SCOPE$2&&GLOBAL_SCOPE$2.cinePinkModePreference?GLOBAL_SCOPE$2.cinePinkModePreference:null,v=DOCUMENT.getElementById("settingsPinkMode"),C=DOCUMENT.createElement("div");C.className="onboarding-field-group";const A=getProxyControlId("pink"),w=DOCUMENT.createElement("label");w.className="onboarding-field-label",w.setAttribute("for",A),w.textContent=n("unitsPreferencesPinkLabel","Pink mode accents");const R=DOCUMENT.createElement("select");R.id=A,R.className="onboarding-field-select";const _=DOCUMENT.createElement("option");_.value="disabled",_.textContent=n("unitsPreferencesPinkOff","Disabled");const G=DOCUMENT.createElement("option");if(G.value="enabled",G.textContent=n("unitsPreferencesPinkOn","Enabled"),R.appendChild(_),R.appendChild(G),b&&typeof b.registerControl=="function"&&typeof b.getValue=="function"){try{const de=b.getValue();typeof de=="boolean"&&(R.value=de?"enabled":"disabled")}catch(de){safeWarn("cine.features.onboardingTour: pink bridge getValue failed.",de)}let re=null;try{re=b.registerControl(R,{type:"select"})}catch(de){safeWarn("cine.features.onboardingTour: pink bridge registerControl failed.",de)}typeof re=="function"&&e(()=>{try{re()}catch(de){safeWarn("cine.features.onboardingTour: pink bridge cleanup failed.",de)}})}else if(v){R.value=v.checked?"enabled":"disabled";const re=()=>{const ne=R.value==="enabled";v.checked!==ne&&(v.checked=ne,dispatchSyntheticEvent(v,"change"))},de=()=>{const ne=v.checked?"enabled":"disabled";R.value!==ne&&(R.value=ne)};R.addEventListener("change",re),e(()=>{R.removeEventListener("change",re)}),v.addEventListener("change",de),e(()=>{v.removeEventListener("change",de)})}(b||v)&&(C.appendChild(w),C.appendChild(R),o.appendChild(C));const O=DOCUMENT.getElementById("settingsFocusScale");if(O){const re=DOCUMENT.createElement("div");re.className="onboarding-field-group";const de=getProxyControlId("focus-scale"),ne=DOCUMENT.createElement("label");ne.className="onboarding-field-label",ne.setAttribute("for",de);const Ce=DOCUMENT.getElementById("settingsFocusScaleLabel");ne.textContent=Ce&&typeof Ce.textContent=="string"?Ce.textContent:"Focus scale";const Ee=DOCUMENT.createElement("select");Ee.id=de,Ee.className="onboarding-field-select";const Pe=Array.from(O.options||[]);if(Pe.length===0){const it=DOCUMENT.createElement("option");it.value=O.value||"metric",it.textContent=O.value||"Metric",Ee.appendChild(it)}else for(let it=0;it<Pe.length;it+=1){const rt=Pe[it],Pt=DOCUMENT.createElement("option");Pt.value=rt.value,Pt.textContent=rt.textContent||rt.value,Ee.appendChild(Pt)}Ee.value=O.value||Ee.value;const et=()=>{Ee.value!==O.value&&(Ee.value=O.value)},Je=()=>{O.value!==Ee.value&&(O.value=Ee.value,dispatchSyntheticEvent(O,"change"))};Ee.addEventListener("change",Je),e(()=>{Ee.removeEventListener("change",Je)}),O.addEventListener("change",et),e(()=>{O.removeEventListener("change",et)}),re.appendChild(ne),re.appendChild(Ee),o.appendChild(re)}const B=DOCUMENT.getElementById("settingsTemperatureUnit");if(B){const re=DOCUMENT.createElement("div");re.className="onboarding-field-group";const de=getProxyControlId("units"),ne=DOCUMENT.createElement("label");ne.className="onboarding-field-label",ne.setAttribute("for",de),ne.textContent=n("unitsPreferencesUnitsLabel","Temperature units");const Ce=DOCUMENT.createElement("select");Ce.id=de,Ce.className="onboarding-field-select";const Ee=Array.from(B.options||[]);if(Ee.length===0){const Je=DOCUMENT.createElement("option");Je.value=B.value||"Celsius",Je.textContent=B.value||"Celsius",Ce.appendChild(Je)}else for(let Je=0;Je<Ee.length;Je+=1){const it=Ee[Je],rt=DOCUMENT.createElement("option");rt.value=it.value,rt.textContent=it.textContent||it.value,Ce.appendChild(rt)}Ce.value=B.value||Ce.value;const Pe=()=>{Ce.value!==B.value&&(Ce.value=B.value)},et=()=>{B.value!==Ce.value&&(B.value=Ce.value,dispatchSyntheticEvent(B,"change"))};Ce.addEventListener("change",et),e(()=>{Ce.removeEventListener("change",et)}),B.addEventListener("change",Pe),e(()=>{B.removeEventListener("change",Pe)}),re.appendChild(ne),re.appendChild(Ce),o.appendChild(re)}const $=DOCUMENT.getElementById("storagePersistenceRequest"),V=DOCUMENT.createElement("p");V.className="onboarding-resume-hint",V.textContent=n("unitsPreferencesPersistenceHint","Request persistent storage so the browser keeps planner data even when space runs low."),o.appendChild(V);const M=DOCUMENT.createElement("div");M.className="onboarding-storage-status",M.setAttribute("role","status"),M.setAttribute("aria-live","polite"),M.setAttribute("data-state","checking");const F=DOCUMENT.createElement("span");F.className="onboarding-storage-icon",F.setAttribute("aria-hidden","true");const z=DOCUMENT.createElement("span");z.className="onboarding-storage-text",M.appendChild(F),M.appendChild(z),o.appendChild(M);const x=DOCUMENT.getElementById("storagePersistenceStatus"),H=re=>{if(!re||!GLOBAL_SCOPE$2||typeof GLOBAL_SCOPE$2.texts!="object")return"";const de=resolveLanguage(),ne=GLOBAL_SCOPE$2.texts||{},Ce=ne[de]&&typeof ne[de]=="object"?ne[de]:null,Ee=ne.en&&typeof ne.en=="object"?ne.en:null,Pe=Ce&&typeof Ce[re]=="string"?Ce[re]:null;if(Pe&&Pe.trim())return Pe;const et=Ee&&typeof Ee[re]=="string"?Ee[re]:null;return et&&et.trim()?et:""},W=H("storagePersistenceStatusIdle")||V.textContent||"",U=(re,de)=>{const ne=typeof re=="string"&&re?re:"checking";M.setAttribute("data-state",ne),M.dataset.state=ne;const Ce=typeof de=="string"&&de.trim()?de.trim():ne==="checking"&&H("storagePersistenceStatusChecking")||W;z.textContent=Ce,Ce?M.removeAttribute("data-empty"):M.setAttribute("data-empty","true")},j=re=>{let de=re&&typeof re.state=="string"?re.state:null,ne=re&&typeof re.message=="string"?re.message:null;x&&(!de&&typeof x.getAttribute=="function"&&(de=x.getAttribute("data-state")),!ne&&typeof x.textContent=="string"&&(ne=x.textContent.trim())),!x&&!ne&&(ne=H("storagePersistenceStatusChecking")||W),!x&&!de&&(de="checking"),U(de,ne)};if(j(),x&&typeof x.addEventListener=="function"){const re=ne=>{j(ne&&ne.detail?ne.detail:null)};x.addEventListener("storagepersistencechange",re),e(()=>{x.removeEventListener("storagepersistencechange",re)});const de=GLOBAL_SCOPE$2&&(GLOBAL_SCOPE$2.MutationObserver||GLOBAL_SCOPE$2.WebKitMutationObserver||GLOBAL_SCOPE$2.MozMutationObserver);if(de){let ne=null;try{ne=new de(()=>{j()}),ne.observe(x,{characterData:!0,childList:!0,subtree:!0,attributes:!0}),e(()=>{ne&&typeof ne.disconnect=="function"&&ne.disconnect()})}catch(Ce){safeWarn("cine.features.onboardingTour could not observe persistent storage status.",Ce),ne&&typeof ne.disconnect=="function"&&ne.disconnect()}}}const Y=DOCUMENT.createElement("div");Y.className="onboarding-interaction-actions";const le=DOCUMENT.createElement("button");le.type="button",le.className="onboarding-interaction-button primary",le.textContent=n("unitsPreferencesPersistenceAction","Protect storage on this device"),le.disabled=!$;const be=()=>{if(!$)return;const re=t&&t.ensureSettings&&t.ensureSettings.tabId?t.ensureSettings.tabId:"settingsTab-general";if(typeof activateSettingsTab=="function")try{activateSettingsTab("settingsTab-data")}catch(de){safeWarn("cine.features.onboardingTour could not activate Data & Storage tab.",de)}try{$.click()}catch(de){safeWarn("cine.features.onboardingTour could not request persistent storage.",de)}typeof activateSettingsTab=="function"&&setTimeout(()=>{try{activateSettingsTab(re)}catch(de){safeWarn("cine.features.onboardingTour could not restore settings tab.",de)}},300)};for(le.addEventListener("click",be),e(()=>{le.removeEventListener("click",be)}),Y.appendChild(le),o.appendChild(Y);interactionContainerEl.firstChild;)interactionContainerEl.removeChild(interactionContainerEl.firstChild);return interactionContainerEl.appendChild(o),interactionContainerEl.hidden=!1,!0}function resolveCrewRowForProxy(){const e=getElement("#crewContainer");if(!e)return null;let t=e.querySelector(".person-row");if(t)return t;const o=getElement("#addPersonBtn");if(o&&typeof o.click=="function")try{o.click(),t=e.querySelector(".person-row")}catch(r){safeWarn("cine.features.onboardingTour could not auto-create crew row for proxy.",r)}return t||null}function resolvePeriodRowField(e,t,o){const r=getElement(e);if(!r)return null;let n=r.querySelector(".period-row");if(!n){const a=getElement(t);if(a&&typeof a.click=="function")try{a.click(),n=r.querySelector(".period-row")}catch(s){safeWarn("cine.features.onboardingTour could not auto-create schedule row.",s)}}if(!n)return null;try{return n.querySelector(o)}catch(a){return safeWarn("cine.features.onboardingTour could not resolve schedule field.",a),null}}function resolveStorageFieldForProxy(e){const t=getElement("#storageNeedsContainer");if(!t)return null;const o=t.querySelector(".storage-row");if(o){const r=o.querySelector(e);if(r)return r}try{return t.querySelector(e)}catch(r){safeWarn("cine.features.onboardingTour could not resolve storage proxy field.",r)}return null}const PROJECT_REQUIREMENTS_FLOW=[{key:"projectRequirementsBrief",fields:[{fieldKey:"project-brief-company",targetSelector:"#productionCompany",labelSelector:"#productionCompanyLabel"},{fieldKey:"project-brief-street",targetSelector:"#productionCompanyStreet",labelSelector:"#productionCompanyStreetLabel"},{fieldKey:"project-brief-city",targetSelector:"#productionCompanyCity",labelSelector:"#productionCompanyCityLabel"},{fieldKey:"project-brief-rental",targetSelector:"#rentalHouse",labelSelector:"#rentalHouseLabel"}]},{key:"projectRequirementsCrew",fields:[{fieldKey:"project-crew-role",resolveTarget:()=>{const e=resolveCrewRowForProxy();return e?e.querySelector(".person-role-select"):null},fallbackLabel:"Crew role",type:"select"},{fieldKey:"project-crew-name",resolveTarget:()=>{const e=resolveCrewRowForProxy();return e?e.querySelector(".person-name"):null},fallbackLabel:"Crew member name"},{fieldKey:"project-crew-phone",resolveTarget:()=>{const e=resolveCrewRowForProxy();return e?e.querySelector(".person-phone"):null},fallbackLabel:"Crew phone"},{fieldKey:"project-crew-prep",resolveTarget:()=>resolvePeriodRowField("#prepContainer","#addPrepBtn",".prep-start"),labelSelector:"#prepLabel",inputType:"date"},{fieldKey:"project-crew-shoot",resolveTarget:()=>resolvePeriodRowField("#shootContainer","#addShootBtn",".shoot-start"),labelSelector:"#shootLabel",inputType:"date"},{fieldKey:"project-crew-return",resolveTarget:()=>resolvePeriodRowField("#returnContainer","#addReturnBtn",".return-start"),labelSelector:"#returnLabel",inputType:"date"}]},{key:"projectRequirementsLogistics",fields:[{fieldKey:"project-logistics-delivery",targetSelector:"#deliveryResolution",labelSelector:"#deliveryResolutionLabel",type:"select"},{fieldKey:"project-logistics-recording-rate",targetSelector:"#recordingFrameRate",labelSelector:"#recordingFrameRateLabel",inputType:"number"},{fieldKey:"project-logistics-lens",targetSelector:"#lensManufacturer",labelSelector:"#lensManufacturerLabel",type:"select"},{fieldKey:"project-logistics-storage",resolveTarget:()=>resolveStorageFieldForProxy(".storage-quantity"),labelSelector:"#storageNeedsLabel",inputType:"number"},{fieldKey:"project-logistics-mattebox",targetSelector:"#mattebox",labelSelector:"#matteboxLabel",type:"select"},{fieldKey:"project-logistics-monitoring",targetSelector:"#monitoringConfiguration",labelSelector:"#monitoringConfigurationLabel",type:"select"}]}],PROJECT_REQUIREMENTS_STEP_KEYS=PROJECT_REQUIREMENTS_FLOW.map(e=>e.key);function updateProjectDialogLayoutState(e){const t=DOCUMENT&&DOCUMENT.documentElement;if(!t)return;const o=e&&e.key;o&&PROJECT_REQUIREMENTS_STEP_KEYS.indexOf(o)!==-1?t.setAttribute("data-onboarding-project-dialog","project-requirements"):t.removeAttribute("data-onboarding-project-dialog")}function renderProjectRequirementsInteraction(e,t){if(!interactionContainerEl)return!1;const o=t&&t.key,r=PROJECT_REQUIREMENTS_FLOW.findIndex(O=>O.key===o);if(r===-1)return!1;const n=PROJECT_REQUIREMENTS_FLOW[r],a=DOCUMENT.createDocumentFragment(),s=tourTexts&&typeof tourTexts.stepIndicator=="string"?tourTexts.stepIndicator:"Step {current} of {total}",l=DOCUMENT.createElement("p");l.className="onboarding-resume-hint onboarding-step-indicator",l.textContent=s.replace("{current}",String(r+1)).replace("{total}",String(PROJECT_REQUIREMENTS_FLOW.length)),a.appendChild(l);const u=DOCUMENT.createElement("p");u.className="onboarding-resume-hint",u.textContent=tourTexts&&typeof tourTexts.projectRequirementsMiniIntro=="string"?tourTexts.projectRequirementsMiniIntro:"Fill these proxy fields while the Project Requirements dialog stays open.",a.appendChild(u);const d=tourTexts&&tourTexts.steps&&tourTexts.steps[o]&&typeof tourTexts.steps[o].body=="string"?tourTexts.steps[o].body.trim():"";if(d){const O=DOCUMENT.createElement("p");O.className="onboarding-resume-hint",O.textContent=d,a.appendChild(O)}const m=(O,B)=>{if(O&&typeof O.labelSelector=="string"&&O.labelSelector){const $=getElement(O.labelSelector);if($&&typeof $.textContent=="string"){const V=$.textContent.trim();if(V)return V}}if(O&&typeof O.labelText=="string"&&O.labelText)return O.labelText;if(B){const $=typeof B.getAttribute=="function"?B.getAttribute("aria-label"):null;if($&&$.trim())return $.trim();if(B.id)try{const V=`label[for="${B.id}"]`,M=DOCUMENT.querySelector(V);if(M&&typeof M.textContent=="string"){const F=M.textContent.trim();if(F)return F}}catch(V){safeWarn("cine.features.onboardingTour could not resolve proxy label.",V)}if(typeof B.placeholder=="string"&&B.placeholder.trim())return B.placeholder.trim()}return O&&typeof O.fallbackLabel=="string"&&O.fallbackLabel?O.fallbackLabel:"Field"},y=(O,B)=>O&&typeof O.placeholder=="string"?O.placeholder:B&&typeof B.placeholder=="string"&&B.placeholder?B.placeholder:"",h=(O,B)=>{if(!B||(B.innerHTML="",!O))return;const $=O.options||[];for(let V=0;V<$.length;V+=1){const M=$[V];if(!M)continue;const F=DOCUMENT.createElement("option");F.value=M.value,F.textContent=M.textContent||M.value,O.multiple&&(F.selected=M.selected),B.appendChild(F)}O.multiple||(B.value=O.value||"")};let b=null;const v=O=>{const B=DOCUMENT.createElement("div");B.className="onboarding-field-group";const $=getProxyControlId(O?.fieldKey||"project-field"),V=DOCUMENT.createElement("label");V.className="onboarding-field-label",V.setAttribute("for",$);const M=typeof O?.resolveTarget=="function"?O.resolveTarget():typeof O?.targetSelector=="string"?getElement(O.targetSelector):null;V.textContent=m(O,M),B.appendChild(V);let F=null;const z=M&&typeof M.nodeName=="string"?M.nodeName.toLowerCase():null;if(O&&O.type==="select"||z==="select")F=DOCUMENT.createElement("select"),F.multiple=!!(M&&M.multiple),F.multiple&&M&&M.size&&(F.size=M.size),h(M,F);else if(O&&O.multiline||z==="textarea")F=DOCUMENT.createElement("textarea"),F.rows=O&&O.rows?O.rows:3;else{F=DOCUMENT.createElement("input");const U=O&&O.inputType?O.inputType:M&&M.type?M.type:"text";try{F.type=U}catch{F.type="text"}}F.id=$,F.className="onboarding-field-input";const x=y(O,M);if(x&&(F.placeholder=x),B.appendChild(F),a.appendChild(B),b||(b=F),!M)return F.disabled=!0,F.setAttribute("aria-disabled","true"),F;const H=()=>{if(M){if(F.tagName==="SELECT")if(h(M,F),M.multiple){const U=Array.from(M.selectedOptions||[]).map(j=>j.value);for(let j=0;j<F.options.length;j+=1){const Y=F.options[j];Y.selected=U.indexOf(Y.value)!==-1}}else F.value!==M.value&&(F.value=M.value||"");else F.tagName==="TEXTAREA"?F.value!==M.value&&(F.value=M.value||""):(F.type,F.value=M.value||"");F.disabled=M.disabled,F.setAttribute("aria-disabled",M.disabled?"true":"false")}},W=()=>{if(M){if(F.tagName==="SELECT")if(M.multiple){const U=Array.from(F.selectedOptions||[]).map(Y=>Y.value),j=M.options||[];for(let Y=0;Y<j.length;Y+=1){const le=j[Y];le.selected=U.indexOf(le.value)!==-1}}else M.value!==F.value&&(M.value=F.value);else M.value!==F.value&&(M.value=F.value);dispatchSyntheticEvent(M,"input"),dispatchSyntheticEvent(M,"change")}};if(F.addEventListener("input",W),F.addEventListener("change",W),M.addEventListener("input",H),M.addEventListener("change",H),e(()=>{F.removeEventListener("input",W),F.removeEventListener("change",W),M.removeEventListener("input",H),M.removeEventListener("change",H)}),M.tagName&&M.tagName.toLowerCase()==="select"&&typeof MutationObserver=="function")try{const U=new MutationObserver(()=>{H()});U.observe(M,{childList:!0,subtree:!0}),e(()=>{U.disconnect()})}catch(U){safeWarn("cine.features.onboardingTour could not observe select options.",U)}return H(),F};for(let O=0;O<n.fields.length;O+=1)try{v(n.fields[O])}catch(B){safeWarn("cine.features.onboardingTour could not render project requirements proxy.",B)}const C=DOCUMENT.createElement("p");C.className="onboarding-resume-hint",C.textContent=tourTexts&&typeof tourTexts.projectRequirementsMiniOfflineHint=="string"?tourTexts.projectRequirementsMiniOfflineHint:"All entries save offline immediately. Use Back or Next here without losing work.",a.appendChild(C);const A=DOCUMENT.createElement("div");A.className="onboarding-inline-nav";const w=DOCUMENT.createElement("button");w.type="button",w.className="button onboarding-inline-button",w.textContent=tourTexts&&typeof tourTexts.backLabel=="string"?tourTexts.backLabel:"Back",w.disabled=r===0;const R=O=>{O.preventDefault(),w.disabled||goToPreviousStep()};w.addEventListener("click",R),e(()=>{w.removeEventListener("click",R)}),A.appendChild(w);const _=DOCUMENT.createElement("button");_.type="button",_.className="button onboarding-inline-button onboarding-inline-button--primary",_.textContent=tourTexts&&typeof tourTexts.nextLabel=="string"?tourTexts.nextLabel:"Next";const G=O=>{O.preventDefault(),goToNextStep()};for(_.addEventListener("click",G),e(()=>{_.removeEventListener("click",G)}),A.appendChild(_),a.appendChild(A);interactionContainerEl.firstChild;)interactionContainerEl.removeChild(interactionContainerEl.firstChild);if(interactionContainerEl.appendChild(a),interactionContainerEl.hidden=!1,b&&typeof b.focus=="function"){const O=b,B=()=>{try{O.focus({preventScroll:!0})}catch{try{O.focus()}catch{}}};typeof queueMicrotask=="function"?queueMicrotask(B):setTimeout(B,0)}return e(()=>{for(;interactionContainerEl.firstChild;)interactionContainerEl.removeChild(interactionContainerEl.firstChild)}),!0}function renderStepInteraction(e){if(!interactionContainerEl)return;teardownStepInteraction();const t=e&&e.key,o=!!(t&&t!=="intro"&&t!=="completion");interactionContainerEl.hidden=!0;const r=[],n=s=>{typeof s=="function"&&r.push(s)};if(t==="intro"?renderIntroInteraction(n):t==="userProfile"?renderUserProfileInteraction(n):t==="unitsPreferences"?renderUnitsPreferencesInteraction(n,e):t&&PROJECT_REQUIREMENTS_STEP_KEYS.indexOf(t)!==-1?renderProjectRequirementsInteraction(n,e):!1){focusHighlightedElement(e),schedulePositionUpdate(),activeInteractionCleanup=()=>{for(let s=0;s<r.length;s+=1)try{r[s]()}catch(l){safeWarn("cine.features.onboardingTour could not detach custom interaction.",l)}r.length=0};return}o&&(focusHighlightedElement(e),schedulePositionUpdate()),activeInteractionCleanup=null}function handleStepListClick(e){if(!active)return;const t=e&&e.target;if(!t)return;const o=typeof t.closest=="function"?t.closest(".onboarding-step-button"):t.classList&&t.classList.contains("onboarding-step-button")?t:null;if(!o||o.disabled)return;const r=parseInt(o.getAttribute("data-step-index"),10);Number.isNaN(r)||r>currentIndex||showStep(r)}function moveSkipButtonToActions(){if(!skipButton||!cardActionsEl||cardActionsEl.contains(skipButton))return;const e=nextButton&&cardActionsEl.contains(nextButton)?nextButton:null;cardActionsEl.insertBefore(skipButton,e),skipButton.classList.add("onboarding-skip--intro")}function moveSkipButtonToHeader(){!skipButton||!cardHeaderEl||cardHeaderEl.contains(skipButton)||(cardHeaderEl.appendChild(skipButton),skipButton.classList.remove("onboarding-skip--intro"))}function updateCardForStep(e,t){if(!cardEl)return;if(cardContentEl)if(typeof cardContentEl.scrollTo=="function"&&!prefersReducedMotion())try{cardContentEl.scrollTo({top:0,behavior:"smooth"})}catch(m){safeWarn("cine.features.onboardingTour could not smoothly reset card scroll.",m),cardContentEl.scrollTop=0}else cardContentEl.scrollTop=0;const o=getCountableStepTotal(stepConfig),r=getCountableStepIndex(stepConfig,t),n=getStepTexts(e),a=n.body,s=e&&typeof e.size=="string"&&e.size?e.size:"standard";cardEl.setAttribute("data-size",s),updateHeroInlineSize(s);const l=e&&typeof e.key=="string"?e.key:"";l?cardEl.setAttribute("data-step-key",l):cardEl.removeAttribute("data-step-key"),cardEl.setAttribute("aria-labelledby",titleEl.id),cardEl.setAttribute("aria-describedby",bodyEl.id),titleEl.textContent=n.title||"",bodyEl.textContent=a,e.key==="completion"?progressEl.textContent=tourTexts.completionIndicator||"":isPrefaceStep(e)?progressEl.textContent=formatPrefaceIndicator():progressEl.textContent=formatStepIndicator(r,o),updateProgressMeter(e,t),skipButton.textContent=tourTexts.skipLabel||"Skip tutorial",backButton.textContent=tourTexts.backLabel||"Back";const u=l==="intro",d=l==="completion";d?nextButton.textContent=tourTexts.doneLabel||"Finish":u?nextButton.textContent=tourTexts.introStartLabel||"Start onboarding tour":nextButton.textContent=tourTexts.nextLabel||"Next",u?(backButton.disabled=!0,backButton.hidden=!0):(backButton.disabled=t<=0,backButton.hidden=t<=0),backButton.setAttribute("aria-hidden",backButton.hidden?"true":"false"),backButton.hidden?backButton.tabIndex=-1:backButton.removeAttribute("tabindex"),u?moveSkipButtonToActions():moveSkipButtonToHeader(),u?skipButton.hidden=!1:d?skipButton.hidden=!0:skipButton.hidden=!1,updateResumeHint(t),updateStepList(t),renderStepInteraction(e)}function updateProgressMeter(e,t){if(!progressMeterEl||!progressMeterFillEl)return;const o=getCountableStepTotal(stepConfig),r=storedState&&Array.isArray(storedState.completedSteps)?storedState.completedSteps:[],n=new Set(r),a=getCountableCompletedCount(stepConfig,n),s=getCountableStepIndex(stepConfig,t);let l=a;typeof s=="number"&&(l=Math.max(l,s+1)),isCountableStep(e)&&!n.has(e.key)&&(l=Math.max(l,Math.min(o,a+1))),e&&e.key==="completion"&&(l=o),l=Math.min(o,l);const u=o>0?Math.max(0,Math.min(1,l/o)):0;progressMeterFillEl.style.width=`${u*100}%`;const m=(tourTexts.progressValueLabel||"Completed {completed} of {total} steps").replace("{completed}",String(Math.min(a,o))).replace("{total}",String(o)),y=tourTexts.progressMeterLabel||"Tutorial progress";progressMeterEl.setAttribute("aria-label",y),progressMeterEl.setAttribute("aria-valuemax",String(o)),progressMeterEl.setAttribute("aria-valuenow",String(l)),progressMeterEl.setAttribute("aria-valuetext",m)}function showStep(e){if(e<0||e>=stepConfig.length)return;const t=currentStep;teardownStepRequirement(),teardownStepInteraction(),teardownStepAutomation();const o=stepConfig[e];t&&t.ensureSettings&&(!o.ensureSettings||o.ensureSettings.tabId!==t.ensureSettings.tabId)&&closeSettingsIfNeeded(),t&&t.ensureContacts&&!o.ensureContacts&&closeContactsIfNeeded(),t&&t.ensureOwnGear&&!o.ensureOwnGear&&closeOwnGearIfNeeded(),t&&t.ensureDeviceManager&&!o.ensureDeviceManager&&closeDeviceManagerIfNeeded(),t&&t.ensureProjectDialog&&!o.ensureProjectDialog&&closeProjectDialogIfNeeded(),updateProjectDialogLayoutState(o),currentStep=o,currentIndex=e,autoOpenedSettings=!1,o.ensureSettings?ensureSettingsForStep(o):t&&t.ensureSettings&&closeSettingsIfNeeded(),o.ensureContacts?ensureContactsForStep(o):t&&t.ensureContacts?closeContactsIfNeeded():autoOpenedContacts=!1,o.ensureOwnGear?ensureOwnGearForStep(o):t&&t.ensureOwnGear?closeOwnGearIfNeeded():autoOpenedOwnGear=!1,o.ensureDeviceManager?ensureDeviceManagerForStep(o):t&&t.ensureDeviceManager?closeDeviceManagerIfNeeded():autoOpenedDeviceManager=!1,o.ensureProjectDialog?(ensureProjectDialogForStep(o),attachProjectDialogVisibilityMonitor()):t&&t.ensureProjectDialog?(closeProjectDialogIfNeeded(),detachProjectDialogVisibilityMonitor()):(autoOpenedProjectDialog=!1,detachProjectDialogVisibilityMonitor()),o.ensureHeroCard&&ensureHeroCardForStep(o),ensureHighlightVisible(o),updateCardForStep(o,e),applyStepRequirement(o),applyStepAutomation(o),resumeHintVisible&&resumeStartIndex!==null&&e!==resumeStartIndex&&(resumeHintVisible=!1,updateResumeHint(e)),schedulePositionUpdate(),setTimeout(()=>{schedulePositionUpdate(),positionCard()},50);const r={...storedState,activeStep:o.key,completed:!1,skipped:!1};try{storedState=saveState(r)||normalizeStateSnapshot(r)}catch(n){safeWarn("cine.features.onboardingTour could not update stored step state.",n),storedState=normalizeStateSnapshot(r)}focusCard(),applyHelpButtonLabel()}function goToNextStep(){if(!active)return;currentStep&&recordStepCompletion(currentStep.key);const e=currentIndex+1;if(e>=stepConfig.length){completeTutorial();return}showStep(e)}function goToPreviousStep(){if(!active)return;const e=Math.max(0,currentIndex-1);showStep(e)}function recordStepCompletion(e){if(!e)return;const t=storedState&&Array.isArray(storedState.completedSteps)?storedState.completedSteps.slice():[];if(t.indexOf(e)!==-1)return;t.push(e);const o=getTimestamp(),r={...storedState,completedSteps:t,lastCompletedStep:e,lastCompletedAt:o};storedState=saveState(r)||normalizeStateSnapshot(r),updateStepList(currentIndex),updateProgressMeter(currentStep,currentIndex),applyHelpButtonLabel()}function handleSkipTutorial(e){const t=resolveText("tutorialSkipTitle","Skip Tutorial"),o=resolveText("tutorialSkipMessage","Are you sure you want to skip the tutorial? You can restart it later from the Help menu."),r=resolveText("tutorialSkipConfirm","Skip"),n=resolveText("tutorialSkipCancel","Cancel"),a=GLOBAL_SCOPE$2.cineShowConfirmDialog||(typeof window<"u"?window.cineShowConfirmDialog:null);if(typeof a=="function"){a({title:t,message:o,confirmLabel:r,cancelLabel:n,onConfirm:()=>{skipTutorial()}});return}if(!GLOBAL_SCOPE$2.confirm){skipTutorial();return}const s=`${t}

${o}`.trim();let l=!1;try{l=GLOBAL_SCOPE$2.confirm(`${s}

${r}/${n}`)}catch(u){safeWarn("cine.features.onboardingTour could not show skip confirmation dialog.",u),l=!1}l&&skipTutorial()}function skipTutorial(){closeSettingsIfNeeded(),closeContactsIfNeeded(),closeOwnGearIfNeeded(),closeDeviceManagerIfNeeded(),endTutorial(),persistSkipStatus(!0);const e={...storedState,skipped:!0,completed:!1,activeStep:null};storedState=saveState(e)||normalizeStateSnapshot(e),applyHelpButtonLabel()}function completeTutorial(){closeSettingsIfNeeded(),closeContactsIfNeeded(),closeOwnGearIfNeeded(),closeDeviceManagerIfNeeded(),endTutorial(),persistSkipStatus(!1);const e=stepConfig.map(a=>a.key),t=getTimestamp(),o=e.length?e[e.length-1]:null,r={...storedState,completed:!0,skipped:!1,activeStep:null,completedSteps:e,lastCompletedStep:o,lastCompletedAt:t};storedState=saveState(r)||normalizeStateSnapshot(r),applyHelpButtonLabel()}function handleOverlayKeydown(e){if(!active)return;const t=e&&e.key;if(!t)return;if(t==="Escape"){e.preventDefault(),handleSkipTutorial();return}if(t==="ArrowRight"){e.preventDefault(),goToNextStep();return}if(t==="ArrowLeft"){e.preventDefault(),goToPreviousStep();return}if(t!=="Tab")return;const o=[],r=new Set,n=y=>{y&&(r.has(y)||(r.add(y),o.push(y)))},a=collectFocusableElements(cardEl);for(let y=0;y<a.length;y+=1)n(a[y]);if(Array.isArray(activeTargetElements))for(let y=0;y<activeTargetElements.length;y+=1){const h=activeTargetElements[y],b=collectFocusableElements(h,!0);for(let v=0;v<b.length;v+=1)n(b[v])}const s=sortFocusableByDocumentOrder(o);if(!s.length)return;const l=e.shiftKey?-1:1,u=DOCUMENT.activeElement;let d=s.indexOf(u);d===-1&&(d=l===1?-1:0),d=(d+l+s.length)%s.length,e.preventDefault();const m=s[d];if(m)try{m.focus({preventScroll:!0})}catch{m.focus()}}function attachGlobalListeners(){if(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.addEventListener=="function"&&(GLOBAL_SCOPE$2.addEventListener("resize",schedulePositionUpdate),GLOBAL_SCOPE$2.addEventListener("scroll",handleGlobalScroll,!0)),DOCUMENT&&typeof DOCUMENT.addEventListener=="function"&&(DOCUMENT.addEventListener("scroll",handleGlobalScroll,!0),supportsDialogTopLayer&&DOCUMENT.addEventListener("toggle",handleDialogToggle,!0)),attachVisualViewportListeners(),DOCUMENT&&typeof DOCUMENT.getElementById=="function"&&typeof MutationObserver=="function"){const e=DOCUMENT.getElementById("sideMenu");if(e&&!sideMenuObserver)try{sideMenuObserver=new MutationObserver(()=>{schedulePositionUpdate(),active&&currentStep&&setTimeout(()=>{ensureHighlightVisible(currentStep)},100)}),sideMenuObserver.observe(e,{attributes:!0,attributeFilter:["class","hidden","aria-hidden"]})}catch(t){sideMenuObserver=null,safeWarn("cine.features.onboardingTour could not observe side menu.",t)}}}function detachGlobalListeners(){if(GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.removeEventListener=="function"&&(GLOBAL_SCOPE$2.removeEventListener("resize",schedulePositionUpdate),GLOBAL_SCOPE$2.removeEventListener("scroll",handleGlobalScroll,!0)),DOCUMENT&&typeof DOCUMENT.removeEventListener=="function"&&(DOCUMENT.removeEventListener("scroll",handleGlobalScroll,!0),supportsDialogTopLayer&&DOCUMENT.removeEventListener("toggle",handleDialogToggle,!0)),sideMenuObserver){try{sideMenuObserver.disconnect()}catch{}sideMenuObserver=null}detachVisualViewportListeners()}function startTutorial(e={}){const{resume:t=!1,focusStart:o=!0,allowSkipOverride:r=!1}=e||{};if(ensureOverlayElements(),tourTexts=resolveTourTexts(),stepConfig=getStepConfig(),storedState=refreshStoredState(),storedState&&storedState.skipped&&!r){applyHelpStatus(storedState,stepConfig);return}persistSkipStatus(!1),storedState&&storedState.skipped&&(storedState=normalizeStateSnapshot({...storedState,skipped:!1}));const n=new Set(storedState&&Array.isArray(storedState.completedSteps)?storedState.completedSteps:[]);let a=t&&storedState&&storedState.activeStep?stepConfig.findIndex(l=>l.key===storedState.activeStep):-1;a<0&&(a=stepConfig.findIndex(l=>l&&!n.has(l.key)));const s=a>=0?a:stepConfig.length-1;overlayRoot&&(bringOverlayToTopLayer(),overlayRoot.classList.add("active"),overlayRoot.setAttribute("aria-hidden","false"),overlayRoot.style&&(overlayRoot.style.pointerEvents="none")),active=!0,currentIndex=-1,currentStep=null,autoOpenedSettings=!1,settingsDialogRef=null,resumeHintVisible=!!t,resumeStartIndex=resumeHintVisible?s:null,attachGlobalListeners(),showStep(s),applyHelpStatus(storedState,stepConfig),o&&focusCard()}function endTutorial(){active=!1,clearFrame(),teardownStepRequirement(),updateProjectDialogLayoutState(null),detachProjectDialogVisibilityMonitor(),detachGlobalListeners(),closeSettingsIfNeeded(),closeContactsIfNeeded(),closeOwnGearIfNeeded(),closeDeviceManagerIfNeeded(),overlayRoot&&(overlayRoot.classList.remove("active"),overlayRoot.setAttribute("aria-hidden","true")),teardownOverlayElements()}function handleLanguageChange(){tourTexts=resolveTourTexts(),active&&(updateCardForStep(currentStep,currentIndex),positionCard()),applyHelpButtonLabel()}function invalidateHelpButtonsCache(){helpButtonsCache=null}function nodeContainsHelpTrigger(e){if(!e)return!1;if(matchesHelpTrigger(e))return!0;if(typeof e.querySelector=="function")try{if(e.querySelector(HELP_TRIGGER_SELECTOR))return!0}catch{}return!1}function handleHelpButtonMutations(e){if(!(!Array.isArray(e)||!e.length))for(let t=0;t<e.length;t+=1){const o=e[t];if(o){if(o.type==="attributes"){if(nodeContainsHelpTrigger(o.target)){invalidateHelpButtonsCache();return}}else if(o.type==="childList"){const r=o.addedNodes||[];for(let a=0;a<r.length;a+=1){const s=r[a];if(nodeContainsHelpTrigger(s)){invalidateHelpButtonsCache();return}}const n=o.removedNodes||[];for(let a=0;a<n.length;a+=1){const s=n[a];if(nodeContainsHelpTrigger(s)){invalidateHelpButtonsCache();return}}}}}}function ensureHelpButtonObserver(){if(helpButtonsObserver||typeof MutationObserver!="function"||!DOCUMENT)return;const e=DOCUMENT.body||DOCUMENT.documentElement;if(e)try{helpButtonsObserver=new MutationObserver(handleHelpButtonMutations),helpButtonsObserver.observe(e,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["data-onboarding-tour-trigger","id"]})}catch(t){safeWarn("cine.features.onboardingTour could not observe help trigger mutations.",t),helpButtonsObserver=null}}function matchesHelpTrigger(e){return e?typeof e.matches=="function"&&e.matches(HELP_TRIGGER_SELECTOR)||typeof e.getAttribute=="function"&&e.getAttribute("data-onboarding-tour-trigger")!==null?!0:typeof e.id=="string"&&e.id===HELP_BUTTON_ID:!1}function resolveHelpTrigger(e){let t=e;for(;t&&t!==DOCUMENT&&t!==DOCUMENT.body;){if(matchesHelpTrigger(t))return t;t=t.parentElement||t.parentNode||null}return matchesHelpTrigger(t)?t:null}function collectHelpButtons(e=!1){if(ensureHelpButtonObserver(),!e&&Array.isArray(helpButtonsCache)&&helpButtonsCache.length>0){const n=[];for(let a=0;a<helpButtonsCache.length;a+=1){const s=helpButtonsCache[a];!s||typeof s.addEventListener!="function"||typeof s.isConnected=="boolean"&&!s.isConnected||matchesHelpTrigger(s)&&n.push(s)}if(n.length)return helpButtonsCache=n,n}const o=[],r=new Set;if(DOCUMENT&&typeof DOCUMENT.querySelectorAll=="function"){const n=DOCUMENT.querySelectorAll(HELP_TRIGGER_SELECTOR);for(let a=0;a<n.length;a+=1){const s=n[a];!s||typeof s.addEventListener!="function"||r.has(s)||(r.add(s),o.push(s))}}if(DOCUMENT&&typeof DOCUMENT.getElementById=="function"){const n=DOCUMENT.getElementById(HELP_BUTTON_ID);n&&typeof n.addEventListener=="function"&&!r.has(n)&&o.push(n)}return helpButtonsCache=o,o}function resolveHelpStatusElement(){return helpStatusEl&&helpStatusEl.isConnected?helpStatusEl:!DOCUMENT||typeof DOCUMENT.getElementById!="function"?(helpStatusEl=null,null):(helpStatusEl=DOCUMENT.getElementById(HELP_STATUS_ID)||null,helpStatusEl)}function resolveStepTitle(e){if(!e)return"";const t=tourTexts.steps&&tourTexts.steps[e];return t&&typeof t.title=="string"&&t.title?t.title:e}function formatTimeAgo(e){if(typeof e!="number"||Number.isNaN(e)||e<=0)return"";const t=getTimestamp();if(!t)return"";const o=Math.max(0,t-e),r=60*1e3,n=60*r,a=24*n;if(o<45*1e3)return tourTexts.helpStatusTimeJustNow||"just now";if(o<90*1e3)return tourTexts.helpStatusTimeMinute||"1 minute ago";if(o<45*r){const u=Math.round(o/r);return(tourTexts.helpStatusTimeMinutes||"{count} minutes ago").replace("{count}",String(u))}if(o<90*r)return tourTexts.helpStatusTimeHour||"1 hour ago";if(o<22*n){const u=Math.round(o/n);return(tourTexts.helpStatusTimeHours||"{count} hours ago").replace("{count}",String(u))}if(o<36*n)return tourTexts.helpStatusTimeDay||"1 day ago";const s=Math.round(o/a);return(tourTexts.helpStatusTimeDays||"{count} days ago").replace("{count}",String(s))}function formatProgressUpdate(e,t){const o=formatTimeAgo(t);return o?e?(tourTexts.helpStatusLastCompleted||"Last completed: {step} ({timeAgo}).").replace("{step}",e).replace("{timeAgo}",o):(tourTexts.helpStatusLastUpdated||"Last update: {timeAgo}.").replace("{timeAgo}",o):""}function applyHelpStatus(e,t){const o=resolveHelpStatusElement();if(!o)return;const r=Array.isArray(t)&&t.length?t:getStepConfig(),n=r.map(F=>F&&F.key).filter(Boolean),a=e||storedState||loadStoredState(),s=a&&Array.isArray(a.completedSteps)?a.completedSteps:[],l=new Set;for(let F=0;F<s.length;F+=1){const z=s[F];typeof z=="string"&&n.indexOf(z)!==-1&&l.add(z)}const d=r.filter(isCountableStep).length,m=Math.min(getCountableCompletedCount(r,l),d),y=a&&typeof a.activeStep=="string"?a.activeStep:null,h=y?n.indexOf(y):-1,b=getNextCountableStep(r,l),v=b?b.key:null,C=v?resolveStepTitle(v):"",A=h>=0?resolveStepTitle(y):"",w=a&&typeof a.lastCompletedStep=="string"?a.lastCompletedStep:null,R=w&&n.indexOf(w)!==-1?resolveStepTitle(w):"",_=a&&typeof a.lastCompletedAt=="number"?a.lastCompletedAt:null;let G="notStarted";a&&a.completed?G="completed":a&&a.skipped?G="skipped":h>=0?G="resume":m>0&&(G="inProgress");let O;G==="completed"?(O=tourTexts.helpStatusCompleted||"",O||(O="Tutorial complete. Replay any step anytime for a refresher.")):G==="skipped"?(O=tourTexts.helpStatusSkipped||"",O||(O="Tutorial skipped. Restart when you're ready—the saved progress stays available offline.")):G==="resume"?(O=tourTexts.helpStatusResume||tourTexts.helpStatusInProgress||"",O||(O="Paused at {current}. {completed} of {total} steps already saved offline.")):G==="inProgress"?(O=tourTexts.helpStatusInProgress||"",O||(O="Progress saved offline: {completed} of {total} steps complete. Next: {next}.")):(O=tourTexts.helpStatusNotStarted||"",O||(O="Your guided tutorial progress will be saved offline as you go. Next: {next}."));const B={"{completed}":String(m),"{total}":String(d),"{next}":C||A||"","{current}":A||C||"","{step}":A||C||""};let $=O;const V=Object.keys(B);for(let F=0;F<V.length;F+=1){const z=V[F];$=$.split(z).join(B[z])}const M=formatProgressUpdate(R,_);M&&($=`${$} ${M}`.trim()),o.textContent=$,o.hidden=!$}function applyHelpButtonLabel(){let e=collectHelpButtons();if(e.length||(e=collectHelpButtons(!0)),!e.length){applyHelpStatus();return}const t=storedState||loadStoredState(),o=getStepConfig(),r=getCountableStepTotal(o),n=t&&Array.isArray(t.completedSteps)?t.completedSteps:[],a=new Set(n),s=getCountableCompletedCount(o,a),l=tourTexts.resumeLabelWithProgress||tourTexts.resumeLabel;let u;t&&t.completed?u=tourTexts.restartLabel||tourTexts.startLabel||"Start guided tutorial":t&&t.activeStep?(l&&(u=l.replace("{completed}",String(Math.min(s,r))).replace("{total}",String(r))),u||(u=tourTexts.resumeLabel||tourTexts.startLabel||"Resume guided tutorial")):s>0?l&&(u=l.replace("{completed}",String(Math.min(s,r))).replace("{total}",String(r))):u=tourTexts.startLabel||"Start guided tutorial";const d=typeof tourTexts.startLabel=="string"&&tourTexts.startLabel.trim()?tourTexts.startLabel.trim():"Start guided tutorial",m=typeof u=="string"&&u.trim()?u.trim():d;for(let y=0;y<e.length;y+=1){const h=e[y];if(h&&(h.textContent=m,typeof h.setAttribute=="function"))try{h.setAttribute("aria-label",m)}catch{}}applyHelpStatus(t,o)}function handleHelpButtonClick(e){e&&typeof e.preventDefault=="function"&&e.preventDefault();const t=()=>{storedState=refreshStoredState();const n=!!(storedState&&Array.isArray(storedState.completedSteps)&&storedState.completedSteps.length>0)&&!!(storedState&&storedState.activeStep);startTutorial({resume:n,allowSkipOverride:!0})},o=DOCUMENT&&typeof DOCUMENT.getElementById=="function"?DOCUMENT.getElementById("helpDialog"):null;if(o&&typeof isDialogOpen=="function"&&typeof closeDialog=="function"&&isDialogOpen(o)){if(closeDialog(o),typeof o.setAttribute=="function")try{o.setAttribute("hidden","")}catch{}if(o&&typeof o=="object"&&"hidden"in o)try{o.hidden=!0}catch{}typeof GLOBAL_SCOPE$2.requestAnimationFrame=="function"?GLOBAL_SCOPE$2.requestAnimationFrame(()=>{GLOBAL_SCOPE$2.requestAnimationFrame(t)}):setTimeout(t,0);return}t()}function attachHelpButton(){if(!helpButtonListenerAttached&&DOCUMENT&&typeof DOCUMENT.addEventListener=="function"){delegatedHelpListener||(delegatedHelpListener=e=>{resolveHelpTrigger(e&&e.target)&&handleHelpButtonClick(e)});try{DOCUMENT.addEventListener("click",delegatedHelpListener,!0),helpButtonListenerAttached=!0}catch(e){safeWarn("cine.features.onboardingTour could not attach help trigger listener.",e)}}applyHelpButtonLabel()}function shouldAutoStart(){if(!active&&storedState&&storedState.activeStep&&!storedState.completed&&!storedState.skipped)return!(typeof storedState.lastCompletedAt=="number"&&storedState.lastCompletedAt>0&&getTimestamp()-storedState.lastCompletedAt>3600*1e3);if(!storedState)return console.log("DEBUG: shouldAutoStart storedState:",JSON.stringify(storedState)),!1;if(storedState.completed){const t=new Set(Array.isArray(storedState.completedSteps)?storedState.completedSteps:[]);if(getStepConfig().every(n=>t.has(n.key)))return!1}return!(storedState.skipped||readSkipStatusPreference()===!0)}function scheduleAutoStart(){shouldAutoStart()&&setTimeout(()=>{if(storedState=refreshStoredState(),!shouldAutoStart())return;const e=storedState&&storedState.activeStep;startTutorial({resume:e,focusStart:!0,allowSkipOverride:!0})},600)}function init(){refreshStoredState(),attachHelpButton(),applyHelpButtonLabel(),shouldAutoStart()&&scheduleAutoStart()}DOCUMENT.readyState==="loading"?DOCUMENT.addEventListener("DOMContentLoaded",init,{once:!0}):init();function handleFactoryReset(){persistSkipStatus(!1),storedState=saveState({version:STORAGE_VERSION})||refreshStoredState(),applyHelpButtonLabel(),!active&&shouldAutoStart()&&scheduleAutoStart()}GLOBAL_SCOPE$2&&typeof GLOBAL_SCOPE$2.addEventListener=="function"&&GLOBAL_SCOPE$2.addEventListener("languagechange",handleLanguageChange);function attachFactoryResetListeners(){const e=new Set,t=collectCandidateScopes(GLOBAL_SCOPE$2);for(let o=0;o<t.length;o+=1){const r=t[o];if(!(!r||e.has(r))&&typeof r.addEventListener=="function")try{r.addEventListener("cameraPowerPlannerFactoryReset",handleFactoryReset),e.add(r)}catch(n){safeWarn("cine.features.onboardingTour could not attach factory reset listener.",n)}}if(DOCUMENT&&typeof DOCUMENT.addEventListener=="function"&&!e.has(DOCUMENT))try{DOCUMENT.addEventListener("cameraPowerPlannerFactoryReset",handleFactoryReset),e.add(DOCUMENT)}catch(o){safeWarn("cine.features.onboardingTour could not attach document factory reset listener.",o)}}if(DOCUMENT&&DOCUMENT.documentElement)try{typeof DOCUMENT.documentElement.hasAttribute=="function"&&DOCUMENT.documentElement.hasAttribute("data-onboarding-project-dialog")&&DOCUMENT.documentElement.removeAttribute("data-onboarding-project-dialog")}catch{}attachFactoryResetListeners();const moduleApi=clone({start:startTutorial,skip:skipTutorial,reset(){persistSkipStatus(!1),storedState=saveState({version:STORAGE_VERSION})||refreshStoredState(),applyHelpButtonLabel()},getStatus(){const e=refreshStoredState();return clone(e)},isActive(){return active}});baseApi.registerOrQueueModule("cine.features.onboardingTour",moduleApi,{category:"features",description:"Guided onboarding tutorial for Cine Power Planner workflows.",replace:!0,connections:["cineModuleBase","cineUi"]},e=>safeWarn("Unable to register cine.features.onboardingTour module.",e),GLOBAL_SCOPE$2,baseApi.getModuleRegistry&&baseApi.getModuleRegistry(GLOBAL_SCOPE$2));if(typeof baseApi.exposeGlobal=="function")baseApi.exposeGlobal("cineFeaturesOnboardingTour",moduleApi,GLOBAL_SCOPE$2,{configurable:!0,enumerable:!1,writable:!1});else try{GLOBAL_SCOPE$2.cineFeaturesOnboardingTour=moduleApi}catch{}const APP_VERSION$1="1.0.53";function exposeVersionGlobally(e){typeof window<"u"&&(window.APP_VERSION=e,window.CPP_APP_VERSION=e),typeof globalThis<"u"&&(globalThis.APP_VERSION=e,globalThis.CPP_APP_VERSION=e)}exposeVersionGlobally(APP_VERSION$1);const GLOBAL_SCOPE$1=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||self;if(moduleApi$1&&typeof moduleApi$1.bootstrap=="function")try{moduleApi$1.bootstrap(GLOBAL_SCOPE$1,{warnOnFailure:!0,throwOnFailure:!1}),console.log("✅ Runtime Guard bootstrapped via script.js")}catch(e){console.error("cineRuntimeGuard.bootstrap failed during startup.",e)}console.log("DEBUG: main.js parsing started");console.log("DEBUG: main.js imports START");typeof window<"u"&&(window.rentalHouses=rentalHouses,window.devices=devices$2,window.cineDevices=cineDevices);typeof window<"u"&&(Object.assign(window,autoGearStorage),Object.assign(window,autoGearNormalizers));console.log("✅ Vite entry point (main.js) loaded");window.__viteMainLoaded=!0;console.log("[Vite] Entry point loaded successfully");console.log("[Vite] App version:","1.0.53");console.log("[Vite] Storage shim loaded:",Object.keys(storage).length,"exports");console.log("[Vite] Translations shim loaded:",Object.keys(translations$2).length,"exports");function populateCineDropdowns(e){const t=(o,r)=>{const n=document.getElementById(o);n&&typeof window.populateSelect=="function"&&n.options.length<=1&&window.populateSelect(n,r)};e.cameras&&t("cameraSelect",e.cameras),e.monitors&&t("monitorSelect",e.monitors),e.video&&t("videoSelect",e.video),e.batteries&&t("batterySelect",e.batteries),e.batteryHotswaps&&t("batteryHotswapSelect",e.batteryHotswaps),e.fiz&&["motor1Select","motor2Select","motor3Select","motor4Select","controller1Select","controller2Select","controller3Select","controller4Select"].forEach(o=>{t(o,e.fiz)})}function initWebApp(){if(console.log("[Vite] Starting App Initialization..."),typeof V2Bootstrap<"u"&&V2Bootstrap&&typeof V2Bootstrap.init=="function")try{V2Bootstrap.init()}catch(e){console.error("[Vite] V2 Bootstrap init failed:",e)}try{console.log("[Vite] Processing Core Boot Queue..."),processCoreBootQueue()}catch(e){console.error("[Vite] Failed to process boot queue:",e)}try{typeof window.devices=="object"&&window.devices&&(console.log("[Vite] Populating dropdowns manually..."),populateCineDropdowns(window.devices))}catch(e){console.error("[Vite] Failed to populate dropdowns:",e)}console.log("[Vite] dispatching cine-loader-complete"),document.dispatchEvent(new CustomEvent("cine-loader-complete",{bubbles:!0}))}typeof window<"u"&&initWebApp();console.log("[Vite] main.js execution finished");export{autoGearRules$1 as a,index$1 as i};
//# sourceMappingURL=main-JqIge9Ya.js.map
