{"version":3,"mappings":"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","names":["global","isInitialized","isV2Enabled","V2_STORAGE_KEY","checkV2Enabled","params","urlEnabled","restoreThemeState","isDark","isPink","enableV2","legacyHeader","legacyMain","legacySidebar","menuOverlay","legacyLoader","legacyFooter","installBanner","offlineIndicator","notificationStack","v2Container","bindExitButton","hideV2Loader","showV2Loader","loader","disableV2","exitBtn","toggleV2","loadV2Assets","__vitePreload","viewManager","translations$1","LegacyShim","legacyShim","projectDashboard","projectDetail","sidebar","rulesView","deviceLibraryView","contactsView","settingsView","ownedGearView","helpData","helpService","helpView","backupsView","init","injectV2ToggleButton","settingsDialog","settingsContent","toggleSection","label","description","button","V2Bootstrap","VIEW_SELECTOR","ACTIVE_CLASS","DEFAULT_VIEW","VIEWS","currentView","currentParams","viewHistory","isV2Active","getAppContainer","getAllViews","container","getViewElement","viewId","showView","viewName","viewConfig","viewElement","view","updateHash","dispatchViewChange","updateDocumentTitle","goBack","previous","getCurrentView","getCurrentParams","hash","parseHash","config","match","handleHashChange","event","baseTitle","title","ViewManager","V2_REQUIRED_KEYS","verifyV2Translations","missing","key","isReady","translations","CRITICAL_IDS","ALL_CRITICAL_IDS","legacyContainer","syncEnabled","eventListeners","ensureLegacyContainer","shimToLegacyContainer","elementId","element","syncSelectValue","v2Id","legacyId","v2Element","legacyElement","dispatchNativeEvent","syncInputValue","syncToV2","eventType","options","triggerLegacyClick","loadProject","projectName","setupSelect","opt","saveProject","deleteProject","createProject","setupNameInput","getProjectNames","setups","names","name","e","val","stored","data","setDeviceValue","deviceId","value","getDeviceValue","getDeviceSnapshot","snapshot","id","bindV2Select","handler","bindV2Input","listenLegacyChanges","cleanup","verifyLegacyIds","found","module","GRID_CONTAINER_ID","VIEW_ID","STORAGE_KEY","TILE_COLORS","PROJECT_ICONS","currentFilter","_cachedProjectData","escapeHtml","str","formatDate","dateStr","formatDateRange","rangeStr","parts","_t","path","lang","root","resolve","obj","p","o","i","k","v","refreshProjectDataCache","getFilteredProjects","projects","getProjectMetadata","q","project","updateProjectMetadata","metadata","createTileHtml","index","color","icon","escapedName","status","statusClass","statusKey","statusLabel","periodsHtml","range","fmt","createNewProjectTileHtml","createNoResultsHtml","query","renderProjectGrid","_renderGridContent","main","createEmptyStateHtml","bindEmptyStateEvents","filteredProjects","clearBtn","searchInput","html","bindTileEvents","bindSearchEvents","tile","openProject","showContextMenu","btn","newProjectTile","showProjectDialog","closeContextMenu","menu","duplicateProject","archiveProject","rect","existing","createBtn","showCreateProjectDialog","updateProjectRevision","originalData","newName","counter","newData","existingProject","isEditing","randomColorIndex","selectedColor","selectedIcon","existingMetadata","periods","pid","parseRange","type","start","end","d","periodCounter","PERIOD_TYPES","getColorVar","c","colorSwatchesHtml","iconOptionsHtml","buildPeriodsHtml","typeOptions","t","backdrop","input","errorEl","cancelBtn","closeBtn","periodsContainer","addPeriodBtn","colorTrigger","colorPopover","colorPreview","colorLabel","iconTrigger","iconPopover","swatch","s","iconPreview","updatePeriodData","periodId","field","period","typeInfo","removePeriod","renderPeriods","addPeriod","bindPeriodEvents","row","removeBtn","closeModal","handleCreate","existingNames","formatPeriod","prepDays","shootingDays","returnDays","oldData","waitForProjectAndUpdateMetadata","attempts","REV_KEY","currentRev","createDashboardView","headerBtn","v2Main","ProjectDashboard","TABS","DEFAULT_TAB","currentProject","currentTab","switchTab","tabId","isActive","pane","renderV2Diagram","getCurrentTab","getProjectData","updateProjectStatus","nameElement","projectData","statusSelect","updateStatusSelectStyle","newSelect","newStatus","getCurrentProject","createViewContainer","createDetailViewContent","renderCameraPackageTab","renderPowerSummaryTab","bindDetailViewEvents","reparentLegacyElements","tagName","wrapper","elementToMove","backBtn","printBtn","saveBtn","legacySaveBtn","openProjectRequirementsForm","v2Data","projectInfoForForm","mergedInfo","tab","headerReqsGearBtn","headerExportBtn","legacyExportBtn","headerOverviewBtn","legacyBtn","requirementsTabSaveBtn","collectedFormData","generatedHtml","gearHtmlSections","reqsContainer","kitContainer","gearTabGenerateBtn","downloadDiagramBtn","syntheticEvent","injectAddCustomButtons","context","dialog","css","style","selectElement","syncLegacyResultsToV2","map","legacyEl","v2El","setupPowerObserver","legacyResultContainer","handleViewChange","slugify","text","triggerLegacyAddCustom","translationKey","localizedLabel","slug","cardId","card","header","ProjectDetail","SEARCH_CONTAINER_CLASS","SEARCH_INPUT_ID","DARK_MODE_KEY","PINK_MODE_KEY","FALLBACK_PINK_KEY","TEXT_TO_KEY_MAP","currentLang","initSidebar","injectSidebarHeader","injectTopControls","injectSearchInput","setupLegacySearchProxy","initThemes","initNavigationLogic","initMobileToggle","forceHelpCloseBinding","interceptLegacyHelp","legacySelect","updateSidebarTranslations","logo","controlsContainer","row1","injectLanguageSelector","injectThemeControls","injectHardRefresh","footer","legacyInput","keyEvent","searchContainer","nav","legacyDropdown","closeHelpModal","helpDialog","helpBtn","v1HelpNav","redirect","backupLink","autoRecover","navLinks","link","l","triggers","app","overlay","openSidebar","closeSidebar","select","newVal","el","originalText","applyStoredThemes","darkBtn","toggleDarkMode","pinkBtn","togglePinkMode","updateDarkModeDisplay","updatePinkModeDisplay","newState","enabled","moon","sun","updateAppLogo","V2Sidebar","SCENARIOS","CREW_ROLES","safeCollectKeys","safeCollectCall","fnName","arg","res","langSelect","dict","RulesView","maxRetries","isRetrying","delay","rulesHtml","rules","rule","conditionCount","addCount","count","addBtn","exportBtn","importBtn","resetBtn","tempInput","file","reader","err","newRules","r","monitors","renderOptions","selected","m","getVal","ruleId","isNew","gearNames","categories","items","selectedItems","groupName","selectedSet","item","b","form","category","quantity","listContainer","bindDeleteActions","close","collect","group","cb","sDays","currentRules","CONTENT_CONTAINER_ID","LEGACY_CONTAINER_ID","isReparented","createViewHeader","createTabNav","tabNav","reparentLegacyContent","viewContent","addDeviceSection","addDeviceCard","cardHeader","cardBody","buttonGroup","oldH3","enhanceFormSections","browseSection","browseCard","browseHeader","browseBody","deviceListContainer","existingHeading","applyV2Styles","attachTabListeners","attachActionListeners","sections","subsectionIcons","tabs","contents","targetTab","targetContent","legacyImportBtn","restoreLegacyContent","render","DeviceLibraryView","this","ContactsView","contactsModule","contacts","contentHtml","contact","initials","n","avatarHtml","phoneLink","emailLink","websiteLink","addBtnEmpty","contactId","filtered","existingModal","roles","avatarInput","avatarPreview","removeAvatarBtn","currentAvatar","dataUrl","ev","entry","allContacts","updatedList","normalized","SETTINGS_MAP","SettingsView","legacyVersion","panels","targetId","target","legacyLogo","bindClick","v2Btn","diffBtn","modal","legBtn","rehearsalTrigger","rehearsalModal","closeRehearsalBtns","legacyClose","obsConfigs","observer","cfg","leg","v2","extraObsConfigs","extraObserver","legacyLogoPreview","v2LogoPreview","img","legacyDocList","v2DocList","clone","activeTab","targetPanel","v2Radios","legacyRadios","v2Radio","legRadio","browseBtn","legacyBrowse","proceedBtn","abortBtn","legProceed","legAbort","legacyTableBody","v2TableBody","legacyFilename","v2Filename","legacyProceedBtn","cells","metric","diff","newRow","v2Primary","v2Secondary","legPrimary","legSecondary","syncSelects","obs","legSummary","v2Summary","legList","v2List","li","v2Export","legExport","v2Notes","legNotes","OwnGearView","features","itemId","nameInput","allItems","finalItem","v2HelpData","migratedTopics","V2_TOPICS","getCategorizedV2Topics","essentials","parseMarkdown","block","line","getV1Topics","localization","topicKeys","iconMap","content","getAllSections","guideTopics","refTopics","getGroupedSections","TOC_ID","CONTENT_ID","SEARCH_ID","getElement","renderContent","tocInfo","service","grouped","renderCategory","divider","emptyState","tocList","section","buildToc","tocContainer","ul","targetSection","updateActiveLink","initScrollSpy","callback","entries","initSearch","performSearch","term","noResults","hasVisible","keywords","div","refresh","enter","cineBackupsView","navItem","viewSection","snapshots","dataVault","filename","displayName","storageRepo"],"ignoreList":[],"sources":["../../src/scripts/v2/bootstrap.js","../../src/scripts/v2/view-manager.js","../../src/scripts/v2/translations.js","../../src/scripts/v2/legacy-shim.js","../../src/scripts/v2/project-dashboard.js","../../src/scripts/v2/project-detail.js","../../src/scripts/v2/sidebar.js","../../src/scripts/v2/views/rules-view.mjs","../../src/scripts/v2/views/device-library-view.js","../../src/scripts/v2/views/contacts-view.js","../../src/scripts/v2/views/settings-view.js","../../src/scripts/v2/views/owned-gear-view.js","../../src/scripts/v2/help-data.js","../../src/scripts/v2/help-service.js","../../src/scripts/v2/views/help-view.js","../../src/scripts/v2/views/backups-view.js"],"sourcesContent":["/**\n * Cine Power Planner V2 - Bootstrap\n * ===================================\n * Entry point for V2 UI initialization.\n * \n * DEEP DIVE: The \"Hybrid Swap\" Strategy\n * \n * This module is responsible for the hot-swap between Legacy (V1) and Modern (V2) UIs.\n * It does NOT replace the entire page. Instead, it:\n * 1. Lazy-loads V2 CSS/JS assets (to keep initial bundle size low).\n * 2. Toggles the `v2-mode` class on `document.body`.\n * 3. Manually hides Legacy DOM elements (`#topBar`, `#sideMenu`).\n * 4. Initializes the React-like V2 View Manager.\n * \n * This strategy allows us to ship V2 incrementally without rewriting the V1 engine.\n */\n\n\n// Removed IIFE wrapper for ES Module conversion\n// (function (global) {\n//    'use strict';\n\n// Polyfill global for legacy code\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n\n// =====================\n// STATE\n// =====================\nlet isInitialized = false;\nlet isV2Enabled = false;\n\n// =====================\n// FEATURE FLAG\n// =====================\nconst V2_STORAGE_KEY = 'cine_use_v2_ui';\n\n/**\n * Check if V2 UI is enabled via feature flag\n */\nfunction checkV2Enabled() {\n    try {\n        // Check URL params first\n        const params = new URLSearchParams(window.location.search);\n        if (params.has('v2')) {\n            const urlEnabled = params.get('v2') === 'true';\n            localStorage.setItem(V2_STORAGE_KEY, urlEnabled.toString());\n            return urlEnabled;\n        }\n\n        return localStorage.getItem(V2_STORAGE_KEY) === 'true';\n    } catch (_e) {\n        void _e;\n        return false;\n    }\n}\n\n/**\n * Restore Theme State (Dark/Pink) immediately\n * \n * DEEP DIVE: Persistence Fix\n * When switching UIs, we risk losing the user's theme preference.\n * This function forces a re-read of localStorage to ensure the V2 UI\n * respects the existing specific Dark/Pink mode settings.\n */\nfunction restoreThemeState() {\n    const isDark = localStorage.getItem('darkMode') === 'true';\n    document.body.classList.toggle('dark-mode', isDark);\n\n    const isPink = localStorage.getItem('cameraPowerPlanner_pinkMode') === 'true' ||\n        localStorage.getItem('pinkMode') === 'true';\n    document.body.classList.toggle('pink-mode', isPink);\n}\n\n/**\n * Enable V2 UI\n */\nfunction enableV2() {\n    try {\n        localStorage.setItem(V2_STORAGE_KEY, 'true');\n        isV2Enabled = true;\n\n        // Activate V2 mode on body\n        document.body.classList.add('v2-mode');\n\n        // [Persistence Fix] Restore themes immediately\n        restoreThemeState();\n\n        // Hide legacy UI elements\n        const legacyHeader = document.getElementById('topBar');\n        const legacyMain = document.getElementById('mainContent');\n        const legacySidebar = document.getElementById('sideMenu');\n        const menuOverlay = document.getElementById('menuOverlay');\n\n        // [Fix] Hide Legacy Loader explicitly\n        const legacyLoader = document.getElementById('cineGlobalLoadingIndicator');\n        if (legacyLoader) legacyLoader.style.display = 'none';\n\n        if (legacyHeader) legacyHeader.style.display = 'none';\n        if (legacyMain) legacyMain.style.display = 'none';\n        if (legacySidebar) legacySidebar.style.display = 'none';\n        if (menuOverlay) menuOverlay.style.display = 'none';\n\n        // Hide footer\n        const legacyFooter = document.getElementById('siteFooter');\n        if (legacyFooter) legacyFooter.style.display = 'none';\n\n        // [Fix] Hide All Floating/Fixed Legacy Elements\n        const installBanner = document.getElementById('installPromptBanner');\n        const offlineIndicator = document.getElementById('offlineIndicator');\n        const notificationStack = document.getElementById('backupNotificationContainer');\n\n        if (installBanner) installBanner.style.display = 'none';\n        if (offlineIndicator) offlineIndicator.style.display = 'none';\n        if (notificationStack) notificationStack.style.display = 'none';\n\n        // Show V2 container\n        const v2Container = document.getElementById('v2-app');\n        if (v2Container) {\n            v2Container.style.display = '';\n            v2Container.setAttribute('aria-hidden', 'false');\n        }\n\n        // Initialize project detail FIRST (for view-change events)\n        // IMPORTANT: This must happen BEFORE cineViewManager.enableV2() because\n        // enableV2() dispatches v2:viewchange, and project-detail needs to have\n        // its listener attached to render the top bar correctly.\n        if (global.cineProjectDetail && typeof global.cineProjectDetail.init === 'function') {\n            global.cineProjectDetail.init();\n        }\n\n        // Initialize View Manager (this will dispatch v2:viewchange)\n        if (global.cineViewManager && typeof global.cineViewManager.enableV2 === 'function') {\n            global.cineViewManager.enableV2();\n        }\n\n        // Bind Exit V2 button\n        bindExitButton();\n\n        // Initialize and render the project dashboard\n        if (global.cineProjectDashboard) {\n            if (typeof global.cineProjectDashboard.init === 'function') {\n                global.cineProjectDashboard.init();\n            }\n            // renderProjectGrid handled by v2:viewchange event\n        }\n\n        // Initialize sidebar (search functionality)\n        if (global.cineV2Sidebar && typeof global.cineV2Sidebar.init === 'function') {\n            global.cineV2Sidebar.init();\n        }\n\n        // [Fix] Hide V2 Loader after successfully initializing\n        hideV2Loader();\n\n        console.log('[V2 Bootstrap] V2 UI enabled');\n        return true;\n    } catch (e) {\n        console.error('[V2 Bootstrap] Failed to enable V2:', e);\n        // If failed, make sure loader is gone so user sees error or backup\n        hideV2Loader();\n        return false;\n    }\n}\n\n/**\n * Show V2 Loader\n */\nfunction showV2Loader() {\n    let loader = document.getElementById('v2-loader');\n    if (!loader) {\n        loader = document.createElement('div');\n        loader.id = 'v2-loader';\n        loader.innerHTML = `\n                <div class=\"v2-loader-content\">\n                    <div class=\"v2-spinner\"></div>\n                    <div class=\"v2-loader-text\">Loading Cine Power Planner...</div>\n                </div>\n            `;\n        document.body.appendChild(loader);\n    }\n    loader.classList.add('visible');\n}\n\n/**\n * Hide V2 Loader\n */\nfunction hideV2Loader() {\n    const loader = document.getElementById('v2-loader');\n    if (loader) {\n        loader.classList.remove('visible');\n        setTimeout(() => {\n            if (loader.parentNode) loader.parentNode.removeChild(loader);\n        }, 500); // Wait for fade out\n    }\n}\n\n/**\n * Disable V2 UI\n */\nfunction disableV2() {\n    try {\n        localStorage.setItem(V2_STORAGE_KEY, 'false');\n        isV2Enabled = false;\n\n        // Remove V2 mode from body\n        document.body.classList.remove('v2-mode');\n\n        // Show legacy UI elements\n        const legacyHeader = document.getElementById('topBar');\n        const legacyMain = document.getElementById('mainContent');\n        const legacySidebar = document.getElementById('sideMenu');\n        const menuOverlay = document.getElementById('menuOverlay');\n        const legacyFooter = document.getElementById('siteFooter');\n\n        if (legacyHeader) legacyHeader.style.display = '';\n        if (legacyMain) legacyMain.style.display = '';\n        if (legacySidebar) legacySidebar.style.display = '';\n        if (menuOverlay) menuOverlay.style.display = '';\n        if (legacyFooter) legacyFooter.style.display = '';\n\n        // Hide V2 container\n        const v2Container = document.getElementById('v2-app');\n        if (v2Container) {\n            v2Container.style.display = 'none';\n            v2Container.setAttribute('aria-hidden', 'true');\n        }\n\n        // Disable View Manager\n        if (global.cineViewManager && typeof global.cineViewManager.disableV2 === 'function') {\n            global.cineViewManager.disableV2();\n        }\n\n        console.log('[V2 Bootstrap] V2 UI disabled');\n        return true;\n    } catch (e) {\n        console.error('[V2 Bootstrap] Failed to disable V2:', e);\n        return false;\n    }\n}\n\n/**\n * Bind the Exit V2 button in the sidebar\n */\nfunction bindExitButton() {\n    const exitBtn = document.getElementById('v2ExitBtn');\n    if (exitBtn && !exitBtn.dataset.bound) {\n        exitBtn.dataset.bound = 'true';\n        exitBtn.addEventListener('click', () => {\n            disableV2();\n            window.location.reload();\n        });\n    }\n}\n\n/**\n * Toggle V2 UI\n */\nfunction toggleV2() {\n    if (isV2Enabled) {\n        return disableV2();\n    } else {\n        return enableV2();\n    }\n}\n\n// =====================\n// LAZY LOADING\n// =====================\n\n/**\n * Load a script dynamically\n */\nfunction loadScript(src) {\n    return new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.src = src;\n        script.async = true;\n        script.onload = resolve;\n        script.onerror = reject;\n        document.head.appendChild(script);\n    });\n}\n\n/**\n * Load a stylesheet dynamically\n */\nfunction loadStylesheet(href) {\n    return new Promise((resolve, reject) => {\n        const link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.href = href;\n        link.onload = resolve;\n        link.onerror = reject;\n        document.head.appendChild(link);\n    });\n}\n\n/**\n * Load V2 assets (CSS and JS)\n */\n/**\n * Load V2 assets (CSS and JS)\n */\nasync function loadV2Assets() {\n    try {\n        console.log('[V2 Bootstrap] Loading V2 assets via Vite dynamic imports...');\n\n        // Load V2 CSS\n        // Vite injects styles when imported\n        await import('../../styles/v2/index.css');\n        await import('../../styles/v2/views/rules-view.css');\n        await import('../../styles/v2/views/contacts.css');\n        await import('../../styles/v2/views/settings.css');\n        await import('../../styles/v2/views/owned-gear.css');\n        console.log('[V2 Bootstrap] V2 CSS loaded');\n\n        // Load V2 JS modules\n        // We use specific relative paths for Vite to detect them\n        await import('./view-manager.js');\n        await import('./translations.js');\n        const { LegacyShim } = await import('./legacy-shim.js');\n\n        await import('../modules/features/auto-gear-rules.js');\n        await import('./project-dashboard.js');\n        await import('./project-detail.js'); // Also needed\n\n        await import('./sidebar.js');\n        await import('./views/rules-view.mjs');\n        await import('./views/device-library-view.js');\n\n        await import('../modules/features/contacts.js');\n        await import('../modules/features/own-gear.js');\n\n        await import('./views/contacts-view.js');\n        await import('./views/settings-view.js');\n        await import('./views/owned-gear-view.js');\n        await import('./help-data.js');\n        await import('./help-service.js');\n        await import('./views/help-view.js');\n        await import('./views/backups-view.js');\n\n        // Initialize Backups View\n        if (window.cineBackupsView && typeof window.cineBackupsView.init === 'function') {\n            window.cineBackupsView.init();\n        }\n\n        console.log('[V2 Bootstrap] V2 JS modules loaded');\n\n        // Initialize components (checking globals that should be set by modules)\n        // Note: In a pure module system, we would return the exports, \n        // but we kept the global assignments in the modules for backward compatibility.\n\n        // Initialize Sidebar\n        if (global.cineV2Sidebar && typeof global.cineV2Sidebar.init === 'function') {\n            global.cineV2Sidebar.init();\n        }\n\n        // Initialize Rules View\n        if (global.cineRulesView && typeof global.cineRulesView.init === 'function') {\n            global.cineRulesView.init();\n        }\n\n        // Initialize Device Library View\n        if (global.cineV2DeviceLibrary && typeof global.cineV2DeviceLibrary.init === 'function') {\n            global.cineV2DeviceLibrary.init();\n        }\n\n        // Initialize Contacts View\n        if (global.cineContactsView && typeof global.cineContactsView.init === 'function') {\n            global.cineContactsView.init();\n        }\n\n        // Initialize Settings View\n        if (global.cineSettingsView && typeof global.cineSettingsView.init === 'function') {\n            global.cineSettingsView.init();\n        }\n\n        // Initialize Owned Gear View\n        if (global.cineOwnGearView && typeof global.cineOwnGearView.init === 'function') {\n            global.cineOwnGearView.init();\n        }\n\n        // Initialize Help View\n        if (global.cineHelpView && typeof global.cineHelpView.init === 'function') {\n            global.cineHelpView.init();\n        }\n\n        return true;\n    } catch (e) {\n        console.error('[V2 Bootstrap] Failed to load V2 assets:', e);\n        return false;\n    }\n}\n\n\n// =====================\n// INITIALIZATION\n// =====================\n\n/**\n * Initialize V2 Bootstrap\n */\nasync function init() {\n    if (isInitialized) {\n        console.warn('[V2 Bootstrap] Already initialized');\n        return;\n    }\n\n    isInitialized = true;\n    isV2Enabled = checkV2Enabled();\n\n    console.log(`[V2 Bootstrap] Starting. V2 enabled: ${isV2Enabled}`);\n\n    // Only load V2 assets if V2 is enabled OR if we're in development\n    if (isV2Enabled) {\n        showV2Loader(); // [New] Show immediately\n        const loaded = await loadV2Assets();\n        if (loaded) {\n            enableV2(); // this eventually hides it\n        } else {\n            hideV2Loader(); // Fallback\n        }\n    }\n\n    // Add \"Try New UI\" button to settings (if not already present)\n    injectV2ToggleButton();\n\n    console.log('[V2 Bootstrap] Initialization complete');\n}\n\n/**\n * Inject a toggle button into the settings dialog\n */\nfunction injectV2ToggleButton() {\n    // Check if button already exists\n    if (document.getElementById('v2ToggleBtn')) {\n        return;\n    }\n\n    // Find the settings dialog\n    const settingsDialog = document.getElementById('settingsDialog');\n    if (!settingsDialog) {\n        return;\n    }\n\n    // Find a place to add the button (e.g., settings content area)\n    const settingsContent = settingsDialog.querySelector('.modal-content, .settings-content, .modal-surface');\n    if (!settingsContent) {\n        return;\n    }\n\n    // Create the toggle section\n    const toggleSection = document.createElement('div');\n    toggleSection.className = 'settings-row v2-toggle-section';\n    toggleSection.style.cssText = 'margin-top: 16px; padding-top: 16px; border-top: 1px solid #ddd;';\n\n    const label = document.createElement('label');\n    label.textContent = 'Experimental UI';\n    label.style.cssText = 'font-weight: 600; display: block; margin-bottom: 8px;';\n\n    const description = document.createElement('p');\n    description.textContent = 'Try the new V2 interface design. This is experimental and can be toggled off at any time.';\n    description.style.cssText = 'font-size: 0.875rem; color: #666; margin-bottom: 12px;';\n\n    const button = document.createElement('button');\n    button.id = 'v2ToggleBtn';\n    button.type = 'button';\n    button.className = 'v2-btn v2-btn-secondary';\n    button.style.cssText = 'padding: 8px 16px; border-radius: 6px; cursor: pointer; background: #4a90d9; color: white; border: none;';\n    button.textContent = isV2Enabled ? 'Return to Classic UI' : 'Try New UI';\n\n    button.addEventListener('click', () => {\n        toggleV2();\n        button.textContent = isV2Enabled ? 'Return to Classic UI' : 'Try New UI';\n        // Reload to apply changes\n        window.location.reload();\n    });\n\n    toggleSection.appendChild(label);\n    toggleSection.appendChild(description);\n    toggleSection.appendChild(button);\n    settingsContent.appendChild(toggleSection);\n}\n\n// =====================\n// EXPORTS\n// =====================\nexport const V2Bootstrap = {\n    init,\n    enableV2,\n    disableV2,\n    toggleV2,\n    isV2Enabled: () => isV2Enabled,\n    loadV2Assets\n};\n\n// Expose to global scope for legacy compatibility\nif (typeof globalThis !== 'undefined') {\n    globalThis.cineV2Bootstrap = V2Bootstrap;\n} else if (typeof window !== 'undefined') {\n    window.cineV2Bootstrap = V2Bootstrap;\n}\n\n// Auto-initialize\nif (typeof document !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        // Delay slightly to let other scripts load first\n        setTimeout(init, 100);\n    }\n}\n\n","/**\n * Cine Power Planner V2 - View Manager\n * =====================================\n * Manages SPA-style view switching and URL hash routing.\n * \n * Core responsibilities:\n * 1. Toggle visibility of .app-view sections\n * 2. Manage URL hash routing (#projects, #project/:id, etc.)\n * 3. Dispatch custom events for view changes\n * 4. Handle browser back/forward navigation\n */\n\n\n// Polyfill global for legacy code inside this module\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n\n// =====================\n// CONFIGURATION\n// =====================\nconst VIEW_SELECTOR = '.app-view';\nconst ACTIVE_CLASS = 'active';\nconst DEFAULT_VIEW = 'projects';\n\n// View definitions\nconst VIEWS = {\n    projects: {\n        id: 'view-projects',\n        title: 'Projects',\n        pattern: /^#?\\/?projects?\\/?$/i\n    },\n    projectDetail: {\n        id: 'view-project-detail',\n        title: 'Project',\n        pattern: /^#?\\/?project\\/([^/]+)(\\/([a-z]+))?\\/?$/i\n    },\n    settings: {\n        id: 'view-settings',\n        title: 'Settings',\n        pattern: /^#?\\/?settings?\\/?$/i\n    },\n    contacts: {\n        id: 'view-contacts',\n        title: 'Contacts',\n        pattern: /^#?\\/?contacts?\\/?$/i\n    },\n    devices: {\n        id: 'view-devices',\n        title: 'Device Library',\n        pattern: /^#?\\/?devices?\\/?$/i\n    },\n    help: {\n        id: 'view-help',\n        title: 'Help',\n        pattern: /^#?\\/?help\\/?$/i\n    },\n    rules: {\n        id: 'view-rules',\n        title: 'Auto Gear Rules',\n        pattern: /^#?\\/?rules\\/?$/i\n    },\n    ownGear: {\n        id: 'view-own-gear',\n        title: 'Owned Gear',\n        pattern: /^#?\\/?own-gear\\/?$/i\n    }\n};\n\n// =====================\n// STATE\n// =====================\nlet currentView = null;\nlet currentParams = {};\nlet viewHistory = [];\nlet isV2Active = false;\n\n// =====================\n// DOM HELPERS\n// =====================\n\n/**\n * Get the main V2 app container\n */\nfunction getAppContainer() {\n    return document.querySelector('.v2-app') || document.getElementById('v2-app');\n}\n\n/**\n * Get all view elements\n */\nfunction getAllViews() {\n    const container = getAppContainer();\n    if (!container) return [];\n    return Array.from(container.querySelectorAll(VIEW_SELECTOR));\n}\n\n/**\n * Get a specific view element by ID\n */\nfunction getViewElement(viewId) {\n    return document.getElementById(viewId);\n}\n\n// =====================\n// VIEW SWITCHING\n// =====================\n\n/**\n * Show a specific view and hide all others\n *\n * DEEP DIVE: View Switching Architecture\n *\n * This is the core routing method of the V2 SPA (Single Page Application) layer.\n * Unlike the legacy tabular UI, V2 views are distinct screen states managed via the DOM.\n *\n * Lifecycle:\n * 1. VALIDATION: Ensures the requested view ID exists in the DOM.\n * 2. UNMOUNT (Visual): Removes the 'active' class from ALL views.\n * 3. MOUNT (Visual): Adds the 'active' class to the target view.\n * 4. HISTORY: Pushes the previous state to `viewHistory` stack for back navigation.\n * 5. URL SYNC: Updates the URL fragment (e.g. #/projects) without triggering a reload.\n * 6. EVENT BUS: Dispatches `v2:viewchange` to notify components (Sidebar, Dashboard) to react.\n *\n * @param {string} viewName - The name of the view to show (e.g., 'projects', 'projectDetail')\n * @param {object} params - Optional parameters (e.g., { projectId: 'my-project', tab: 'power' })\n * @returns {boolean} - Whether the view switch was successful\n */\nfunction showView(viewName, params = {}) {\n    const viewConfig = VIEWS[viewName];\n    if (!viewConfig) {\n        console.warn(`[ViewManager] Unknown view: ${viewName}`);\n        return false;\n    }\n\n    const viewElement = getViewElement(viewConfig.id);\n    if (!viewElement) {\n        console.warn(`[ViewManager] View element not found: ${viewConfig.id}`);\n        return false;\n    }\n\n    // Hide all views\n    getAllViews().forEach(view => {\n        view.classList.remove(ACTIVE_CLASS);\n    });\n\n    // Show the target view\n    viewElement.classList.add(ACTIVE_CLASS);\n\n    // Store previous view for history\n    if (currentView && currentView !== viewName) {\n        viewHistory.push({ view: currentView, params: currentParams });\n    }\n\n    // Update state\n    currentView = viewName;\n    currentParams = params;\n\n    // Update URL hash (without triggering hashchange)\n    updateHash(viewName, params);\n\n    // Dispatch view change event\n    dispatchViewChange(viewName, params);\n\n    // Update document title\n    updateDocumentTitle(viewConfig.title, params);\n\n    return true;\n}\n\n/**\n * Navigate back to the previous view\n */\nfunction goBack() {\n    if (viewHistory.length > 0) {\n        const previous = viewHistory.pop();\n        showView(previous.view, previous.params);\n        return true;\n    }\n    // Default to projects view\n    showView(DEFAULT_VIEW);\n    return false;\n}\n\n/**\n * Get the current view name\n */\nfunction getCurrentView() {\n    return currentView;\n}\n\n/**\n * Get the current view parameters\n */\nfunction getCurrentParams() {\n    return { ...currentParams };\n}\n\n// =====================\n// URL HASH ROUTING\n// =====================\n\n/**\n * Update the URL hash to reflect the current view\n */\nfunction updateHash(viewName, params) {\n    let hash = '';\n\n    switch (viewName) {\n        case 'projects':\n            hash = '#/projects';\n            break;\n        case 'projectDetail':\n            hash = `#/project/${encodeURIComponent(params.projectId || 'new')}`;\n            if (params.tab) {\n                hash += `/${params.tab}`;\n            }\n            break;\n        case 'settings':\n            hash = '#/settings';\n            break;\n        case 'contacts':\n            hash = '#/contacts';\n            break;\n        case 'devices':\n            hash = '#/devices';\n            break;\n        case 'help':\n            hash = '#/help';\n            break;\n        case 'rules':\n            hash = '#/rules';\n            break;\n        case 'ownGear':\n            hash = '#/own-gear';\n            break;\n        default:\n            hash = '#/projects';\n    }\n\n    // Update hash without triggering navigation\n    if (window.location.hash !== hash) {\n        history.replaceState(null, '', hash);\n    }\n}\n\n/**\n * Parse the current hash and navigate to the matching view\n */\nfunction parseHash() {\n    const hash = window.location.hash || '#/projects';\n\n    for (const [viewName, config] of Object.entries(VIEWS)) {\n        const match = hash.match(config.pattern);\n        if (match) {\n            const params = {};\n\n            // Extract parameters based on view type\n            if (viewName === 'projectDetail' && match[1]) {\n                params.projectId = decodeURIComponent(match[1]);\n                if (match[3]) {\n                    params.tab = match[3];\n                }\n            }\n\n            return { viewName, params };\n        }\n    }\n\n    // Default to projects view\n    return { viewName: DEFAULT_VIEW, params: {} };\n}\n\n/**\n * Handle hash change events (browser back/forward)\n *\n * This serves as the \"Router Listener\". It ensures that if a user manually changes the URL\n * or uses the browser's Back/Forward buttons, the View Manager reacts appropriately.\n * Ideally, `showView` updates the URL via `replaceState` so this function is primarily\n * for *external* navigation events.\n */\nfunction handleHashChange() {\n    const { viewName, params } = parseHash();\n    showView(viewName, params);\n}\n\n// =====================\n// EVENTS\n// =====================\n\n/**\n * Dispatch a custom view change event\n */\nfunction dispatchViewChange(viewName, params) {\n    const event = new CustomEvent('v2:viewchange', {\n        bubbles: true,\n        detail: {\n            view: viewName,\n            params: params,\n            previousView: viewHistory.length > 0 ? viewHistory[viewHistory.length - 1] : null\n        }\n    });\n    document.dispatchEvent(event);\n}\n\n/**\n * Update the document title based on the current view\n */\nfunction updateDocumentTitle(baseTitle, params) {\n    let title = baseTitle;\n\n    if (params.projectId && params.projectId !== 'new') {\n        title = `${params.projectId} - ${baseTitle}`;\n    }\n\n    document.title = `${title} | Cine Power Planner`;\n}\n\n// =====================\n// V2 UI TOGGLE\n// =====================\n\n/**\n * Check if V2 UI is enabled\n */\nfunction isV2Enabled() {\n    try {\n        return localStorage.getItem('cine_use_v2_ui') === 'true';\n    } catch (_e) {\n        void _e;\n        return false;\n    }\n}\n\n/**\n * Enable the V2 UI\n */\nfunction enableV2() {\n    try {\n        localStorage.setItem('cine_use_v2_ui', 'true');\n        isV2Active = true;\n        document.body.classList.add('v2-mode');\n\n        // Hide legacy UI\n        const legacyMain = document.getElementById('mainContent');\n        if (legacyMain) {\n            legacyMain.style.display = 'none';\n        }\n\n        // Show V2 container\n        const v2Container = getAppContainer();\n        if (v2Container) {\n            v2Container.style.display = '';\n        }\n\n        // Navigate to current hash\n        handleHashChange();\n\n        return true;\n    } catch (e) {\n        console.error('[ViewManager] Failed to enable V2 UI:', e);\n        return false;\n    }\n}\n\n/**\n * Disable the V2 UI and return to legacy\n */\nfunction disableV2() {\n    try {\n        localStorage.setItem('cine_use_v2_ui', 'false');\n        isV2Active = false;\n        document.body.classList.remove('v2-mode');\n\n        // Show legacy UI\n        const legacyMain = document.getElementById('mainContent');\n        if (legacyMain) {\n            legacyMain.style.display = '';\n        }\n\n        // Hide V2 container\n        const v2Container = getAppContainer();\n        if (v2Container) {\n            v2Container.style.display = 'none';\n        }\n\n        return true;\n    } catch (e) {\n        console.error('[ViewManager] Failed to disable V2 UI:', e);\n        return false;\n    }\n}\n\n/**\n * Toggle V2 UI on/off\n */\nfunction toggleV2() {\n    if (isV2Active) {\n        return disableV2();\n    } else {\n        return enableV2();\n    }\n}\n\n// =====================\n// INITIALIZATION\n// =====================\n\n/**\n * Initialize the view manager\n */\nfunction init() {\n    // Listen for hash changes\n    window.addEventListener('hashchange', handleHashChange);\n\n    // Check if V2 is enabled\n    // BUT do not auto-enable here if we want to wait for bootstrap.\n    // If bootstrap is controlling, it will call enableV2().\n    // If standard legacy load (where bootstrap might be missing or different), we might need it.\n    // However, since bootstrap.js is the one loading this file now (mostly), \n    // we should defer to it to avoid race conditions with view containers being created.\n\n    // If we are NOT in the bootstrap flow (e.g. standalone dev), we might want to check.\n    // But for safe integration, let's trust the bootstrap process will call enableV2() when ready.\n\n    // Only if we are already in V2 mode in DOM (unlikely on reload unless persistent state is handled by bootstrap first),\n    // we might want to sync.\n\n    // Better: Just set listener. Logic:\n    // 1. bootstrap calls loadV2Assets\n    // 2. bootstrap calls viewManager.enableV2()\n    // 3. viewManager.enableV2() -> handleHashChange() -> showView()\n\n    // So we remove the auto-call here.\n    if (isV2Enabled() && !global.cineV2Bootstrap) {\n        // Fallback: If no bootstrap global found, maybe we want to try?\n        // But usually bootstrap defines itself before loading assets?\n        // Actually assets are loaded async.\n        // Let's safe: Just don't auto-enable. bootstrap will do it.\n    }\n\n    console.log('[ViewManager] Initialized');\n}\n\n// =====================\n// EXPORTS\n// =====================\nexport const ViewManager = {\n    // View navigation\n    showView,\n    goBack,\n    getCurrentView,\n    getCurrentParams,\n\n    // Hash routing\n    parseHash,\n\n    // V2 toggle\n    isV2Enabled,\n    enableV2,\n    disableV2,\n    toggleV2,\n\n    // Initialization\n    init,\n\n    // Constants\n    VIEWS,\n    DEFAULT_VIEW\n};\n\n// Expose to global scope\nif (typeof globalThis !== 'undefined') {\n    globalThis.cineViewManager = ViewManager;\n} else if (typeof window !== 'undefined') {\n    window.cineViewManager = ViewManager;\n}\n\n// Auto-initialize when DOM is ready (if not controlled by bootstrap)\n// NOTE: In module system, we prefer explicit init, but for now keeping this logic\nif (typeof document !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n}\n\n","/**\n * V2 Translations Bridge\n * \n * This module ensures V2 UI views can access translations from the main locale files.\n * Previously, this file contained hardcoded English strings. Now it simply verifies\n * that the main translation system has loaded the V2 keys.\n * \n * The actual V2 translations are now in:\n * - src/scripts/translations/en.js\n * - src/scripts/translations/de.js\n * - src/scripts/translations/es.js\n * - src/scripts/translations/fr.js\n * - src/scripts/translations/it.js\n */\n\n// Polyfill global for legacy code\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n// V2 required keys - used to verify translations are loaded\nconst V2_REQUIRED_KEYS = [\n    'contactsViewTitle',\n    'rulesViewTitle',\n    'ownGearViewTitle',\n    'deviceLibraryTitle',\n    'buttonAddContact',\n    'buttonAddRule',\n    'buttonAddGearItem'\n];\n\n/**\n * Verify V2 translations are available\n * Returns true if all required V2 keys are present\n */\nfunction verifyV2Translations() {\n    if (!global.texts || !global.texts.en) {\n        console.warn('[V2 Translations] Main translation system not loaded');\n        return false;\n    }\n\n    const missing = V2_REQUIRED_KEYS.filter(key => !(key in global.texts.en));\n\n    if (missing.length > 0) {\n        console.warn('[V2 Translations] Missing keys:', missing);\n        return false;\n    }\n\n    console.log('[V2 Translations] All V2 keys verified');\n    return true;\n}\n\n// Run verification on load\nconst isReady = verifyV2Translations();\n\n// Export for testing\nexport { verifyV2Translations, V2_REQUIRED_KEYS, isReady };\nexport default { verifyV2Translations, isReady };\n","/**\n * Cine Power Planner V2 - Legacy Shim Layer\n * ==========================================\n * Bridges V2 UI components with legacy DOM elements and event handlers.\n * \n * Core responsibilities:\n * 1. Keep legacy IDs (setupSelect, cameraSelect, etc.) functional in the DOM\n * 2. Sync V2 UI state  hidden legacy elements\n * 3. Dispatch native events to trigger legacy handlers\n * 4. Ensure legacy scripts can still find their expected elements\n */\n\n// Removed IIFE wrapper for ES Module conversion\n// (function (global) {\n//    'use strict';\n\n// Polyfill global for legacy code\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n\n// =====================\n// CRITICAL LEGACY IDS\n// =====================\n// These IDs are required by legacy scripts and must remain in the DOM.\nconst CRITICAL_IDS = {\n    // Project Management\n    project: [\n        'setupSelect',       // Project dropdown\n        'setupName',         // Project name input\n        'saveSetupBtn',      // Save project button\n        'deleteSetupBtn'     // Delete project button\n    ],\n\n    // Device Selectors (Camera Package)\n    devices: [\n        'cameraSelect',      // Camera dropdown\n        'monitorSelect',     // Monitor dropdown\n        'videoSelect',       // Wireless transmitter dropdown\n        'motor1Select',      // FIZ motor 1\n        'motor2Select',      // FIZ motor 2\n        'motor3Select',      // FIZ motor 3\n        'motor4Select',      // FIZ motor 4\n        'controller1Select', // FIZ controller 1\n        'controller2Select', // FIZ controller 2\n        'controller3Select', // FIZ controller 3\n        'controller4Select', // FIZ controller 4\n        'distanceSelect',    // Distance sensor\n        'batteryPlateSelect',// Battery plate\n        'batterySelect',     // Battery\n        'batteryHotswapSelect' // Hotswap battery\n    ],\n\n    // Hidden (used by gear list, not shown in Camera Package UI)\n    hidden: [\n        'cageSelect'         // Cage select (for kit list only)\n    ],\n\n    // Power Summary\n    power: [\n        'heroCard',\n        'heroTotalDraw',\n        'heroAvailablePower',\n        'heroRuntime',\n        'heroCurrent144',\n        'heroCurrent12',\n        'heroBatteryCount',\n        'breakdownList',\n        'pinWarning',\n        'dtapWarning',\n        'hotswapWarning'\n    ],\n\n    // Outputs\n    outputs: [\n        'projectRequirementsOutput',\n        'gearListOutput',\n        'batteryTable',\n        'powerDiagram'\n    ]\n};\n\n// All critical IDs flattened\nconst ALL_CRITICAL_IDS = Object.values(CRITICAL_IDS).flat();\n\n// =====================\n// STATE\n// =====================\nlet legacyContainer = null;\nlet syncEnabled = true;\nlet eventListeners = new Map();\n\n// =====================\n// LEGACY CONTAINER\n// =====================\n\n/**\n * Ensure the legacy context container exists\n * This is a hidden container that holds legacy elements for scripts to access\n */\nfunction ensureLegacyContainer() {\n    if (legacyContainer) return legacyContainer;\n\n    legacyContainer = document.getElementById('v2-legacy-context');\n    if (!legacyContainer) {\n        legacyContainer = document.createElement('div');\n        legacyContainer.id = 'v2-legacy-context';\n        legacyContainer.setAttribute('aria-hidden', 'true');\n        legacyContainer.style.cssText = 'position: absolute; width: 1px; height: 1px; overflow: hidden; clip: rect(0, 0, 0, 0);';\n        document.body.appendChild(legacyContainer);\n    }\n\n    return legacyContainer;\n}\n\n/**\n * Move a legacy element to the hidden container (for elements not visible in V2)\n */\nfunction shimToLegacyContainer(elementId) {\n    const element = document.getElementById(elementId);\n    if (!element) {\n        console.warn(`[LegacyShim] Element not found: ${elementId}`);\n        return null;\n    }\n\n    const container = ensureLegacyContainer();\n    container.appendChild(element);\n\n    return element;\n}\n\n// =====================\n// VALUE SYNCING\n// =====================\n\n/**\n * Sync a V2 select element's value to its legacy counterpart\n * @param {string} v2Id - The V2 element ID (e.g., 'v2-camera-select')\n * @param {string} legacyId - The legacy element ID (e.g., 'cameraSelect')\n */\nfunction syncSelectValue(v2Id, legacyId) {\n    if (!syncEnabled) return;\n\n    const v2Element = document.getElementById(v2Id);\n    const legacyElement = document.getElementById(legacyId);\n\n    if (!v2Element || !legacyElement) {\n        return;\n    }\n\n    // Set the legacy element's value\n    legacyElement.value = v2Element.value;\n\n    // Dispatch change event to trigger legacy handlers\n    dispatchNativeEvent(legacyElement, 'change');\n}\n\n/**\n * Sync a V2 input element's value to its legacy counterpart\n */\nfunction syncInputValue(v2Id, legacyId) {\n    if (!syncEnabled) return;\n\n    const v2Element = document.getElementById(v2Id);\n    const legacyElement = document.getElementById(legacyId);\n\n    if (!v2Element || !legacyElement) {\n        return;\n    }\n\n    legacyElement.value = v2Element.value;\n    dispatchNativeEvent(legacyElement, 'input');\n}\n\n/**\n * Sync legacy value TO a V2 element (for loading projects)\n */\nfunction syncToV2(legacyId, v2Id) {\n    const legacyElement = document.getElementById(legacyId);\n    const v2Element = document.getElementById(v2Id);\n\n    if (!legacyElement || !v2Element) {\n        return;\n    }\n\n    // Temporarily disable sync to prevent loops\n    syncEnabled = false;\n    v2Element.value = legacyElement.value;\n    syncEnabled = true;\n}\n\n// =====================\n// EVENT DISPATCHING\n// =====================\n\n/**\n * Dispatch a native DOM event on an element\n * This ensures legacy event handlers are triggered properly\n */\nfunction dispatchNativeEvent(element, eventType, options = {}) {\n    if (!element) return;\n\n    const event = new Event(eventType, {\n        bubbles: true,\n        cancelable: true,\n        ...options\n    });\n\n    element.dispatchEvent(event);\n}\n\n/**\n * Trigger a legacy button click\n */\nfunction triggerLegacyClick(elementId) {\n    const element = document.getElementById(elementId);\n    if (!element) {\n        console.warn(`[LegacyShim] Cannot trigger click, element not found: ${elementId}`);\n        return false;\n    }\n\n    dispatchNativeEvent(element, 'click');\n    return true;\n}\n\n// =====================\n// PROJECT OPERATIONS\n// =====================\n\n/**\n * Load a project by setting setupSelect and dispatching change\n * @param {string} projectName - The project name to load\n */\nfunction loadProject(projectName) {\n    const setupSelect = document.getElementById('setupSelect');\n    if (!setupSelect) {\n        console.error('[LegacyShim] setupSelect not found');\n        return false;\n    }\n\n    // Find the option with this value\n    const option = Array.from(setupSelect.options).find(opt => opt.value === projectName);\n    if (!option) {\n        console.warn(`[LegacyShim] Project not found: ${projectName}`);\n        return false;\n    }\n\n    setupSelect.value = projectName;\n    dispatchNativeEvent(setupSelect, 'change');\n\n    return true;\n}\n\n/**\n * Save the current project\n */\nfunction saveProject() {\n    return triggerLegacyClick('saveSetupBtn');\n}\n\n/**\n * Delete the current project\n */\nfunction deleteProject() {\n    return triggerLegacyClick('deleteSetupBtn');\n}\n\n/**\n * Create a new project\n * @param {string} projectName - The name for the new project\n */\nfunction createProject(projectName) {\n    const setupSelect = document.getElementById('setupSelect');\n    const setupNameInput = document.getElementById('setupName');\n\n    if (!setupSelect || !setupNameInput) {\n        console.error('[LegacyShim] Project elements not found');\n        return false;\n    }\n\n    // Select \"New Project\" option (empty value)\n    setupSelect.value = '';\n    dispatchNativeEvent(setupSelect, 'change');\n\n    // Set the project name\n    setupNameInput.value = projectName;\n    dispatchNativeEvent(setupNameInput, 'input');\n\n    // Save the project\n    return saveProject();\n}\n\n/**\n * Get all saved project names\n * Uses a fallback chain to ensure data availability even during initialization\n */\nfunction getProjectNames() {\n    // Priority 1: Use getSetups() if available (most authoritative source)\n    if (typeof window.getSetups === 'function') {\n        try {\n            const setups = window.getSetups() || {};\n            const names = Object.keys(setups).filter(name => name && !name.startsWith('auto-backup-'));\n            if (names.length > 0) return names;\n        } catch (e) {\n            console.warn('[LegacyShim] getSetups failed:', e);\n        }\n    }\n\n    // Priority 2: Read from setupSelect (if populated)\n    const setupSelect = document.getElementById('setupSelect');\n    if (setupSelect && setupSelect.options.length > 1) {\n        const names = Array.from(setupSelect.options)\n            .map(opt => opt.value)\n            .filter(val => val !== ''); // Exclude \"New Project\" option\n        if (names.length > 0) return [...new Set(names)]; // Deduplicate\n    }\n\n    // Priority 3: Direct localStorage fallback for robustness\n    try {\n        const stored = localStorage.getItem('cameraPowerPlanner_setups');\n        if (stored) {\n            const data = JSON.parse(stored);\n            return Object.keys(data).filter(name => name && !name.startsWith('auto-backup-'));\n        }\n    } catch (e) {\n        console.warn('[LegacyShim] localStorage fallback failed:', e);\n    }\n\n    return [];\n}\n\n// =====================\n// DEVICE SELECTION\n// =====================\n\n/**\n * Set a device selection value and trigger legacy update\n */\nfunction setDeviceValue(deviceId, value) {\n    const element = document.getElementById(deviceId);\n    if (!element) {\n        console.warn(`[LegacyShim] Device element not found: ${deviceId}`);\n        return false;\n    }\n\n    element.value = value;\n    dispatchNativeEvent(element, 'change');\n\n    return true;\n}\n\n/**\n * Get a device selection value\n */\nfunction getDeviceValue(deviceId) {\n    const element = document.getElementById(deviceId);\n    if (!element) return null;\n    return element.value;\n}\n\n/**\n * Get all current device selections\n */\nfunction getDeviceSnapshot() {\n    const snapshot = {};\n\n    CRITICAL_IDS.devices.forEach(id => {\n        const element = document.getElementById(id);\n        if (element) {\n            snapshot[id] = element.value;\n        }\n    });\n\n    return snapshot;\n}\n\n// =====================\n// V2 BINDING HELPERS\n// =====================\n\n/**\n * Bind a V2 select to its legacy counterpart\n * When V2 select changes, legacy select is updated\n */\nfunction bindV2Select(v2Id, legacyId) {\n    const v2Element = document.getElementById(v2Id);\n    if (!v2Element) return;\n\n    const handler = () => syncSelectValue(v2Id, legacyId);\n    v2Element.addEventListener('change', handler);\n\n    // Store for cleanup\n    eventListeners.set(`${v2Id}:change`, { element: v2Element, handler });\n}\n\n/**\n * Bind a V2 input to its legacy counterpart\n */\nfunction bindV2Input(v2Id, legacyId) {\n    const v2Element = document.getElementById(v2Id);\n    if (!v2Element) return;\n\n    const handler = () => syncInputValue(v2Id, legacyId);\n    v2Element.addEventListener('input', handler);\n\n    eventListeners.set(`${v2Id}:input`, { element: v2Element, handler });\n}\n\n/**\n * Listen for legacy element changes to update V2\n * Used when loading projects\n */\nfunction listenLegacyChanges(legacyId, v2Id) {\n    const legacyElement = document.getElementById(legacyId);\n    if (!legacyElement) return;\n\n    const handler = () => syncToV2(legacyId, v2Id);\n    legacyElement.addEventListener('change', handler);\n\n    eventListeners.set(`${legacyId}:legacy:change`, { element: legacyElement, handler });\n}\n\n// =====================\n// CLEANUP\n// =====================\n\n/**\n * Remove all event listeners\n */\nfunction cleanup() {\n    eventListeners.forEach(({ element, handler }, key) => {\n        const eventType = key.split(':')[1];\n        element.removeEventListener(eventType, handler);\n    });\n    eventListeners.clear();\n}\n\n// =====================\n// INITIALIZATION\n// =====================\n\n/**\n * Verify all critical IDs are present in the DOM\n */\nfunction verifyLegacyIds() {\n    const missing = [];\n    const found = [];\n\n    ALL_CRITICAL_IDS.forEach(id => {\n        if (document.getElementById(id)) {\n            found.push(id);\n        } else {\n            missing.push(id);\n        }\n    });\n\n    if (missing.length > 0) {\n        console.warn(`[LegacyShim] Missing critical IDs:`, missing);\n    }\n\n    return { found, missing };\n}\n\n/**\n * Initialize the legacy shim\n */\nfunction init() {\n    const { found, missing } = verifyLegacyIds();\n\n    console.log(`[LegacyShim] Initialized. Found ${found.length}/${ALL_CRITICAL_IDS.length} critical elements.`);\n\n    if (missing.length > 0) {\n        console.warn(`[LegacyShim] Missing elements:`, missing);\n    }\n}\n\n// =====================\n// PUBLIC API\n// =====================\nconst LegacyShim = {\n    // Container management\n    ensureLegacyContainer,\n    shimToLegacyContainer,\n\n    // Value syncing\n    syncSelectValue,\n    syncInputValue,\n    syncToV2,\n\n    // Event dispatching\n    dispatchNativeEvent,\n    triggerLegacyClick,\n\n    // Project operations\n    loadProject,\n    saveProject,\n    deleteProject,\n    createProject,\n    getProjectNames,\n\n    // Device operations\n    setDeviceValue,\n    getDeviceValue,\n    getDeviceSnapshot,\n\n    // V2 binding\n    bindV2Select,\n    bindV2Input,\n    listenLegacyChanges,\n\n    // Utilities\n    verifyLegacyIds,\n    cleanup,\n    init,\n\n    // Constants\n    CRITICAL_IDS,\n    ALL_CRITICAL_IDS\n};\n\n// Expose to global scope\nif (typeof global !== 'undefined') {\n    global.cineLegacyShim = LegacyShim;\n}\n\nif (typeof window !== 'undefined') {\n    window.cineLegacyShim = LegacyShim;\n}\n\n// Auto-initialize when DOM is ready\nif (typeof document !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n}\n\n// Module export\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = LegacyShim;\n}\n\n// Removed IIFE end\nexport { LegacyShim };\n\n","/**\n * Cine Power Planner V2 - Project Dashboard Component\n * =====================================================\n * Renders the project grid with tiles for each saved project.\n */\n\n// Polyfill global for legacy code\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n\n// =====================\n// CONFIGURATION\n// =====================\nconst GRID_CONTAINER_ID = 'projectGrid';\nconst VIEW_ID = 'view-projects';\nconst STORAGE_KEY = 'cameraPowerPlanner_setups';\n\n// Color palette for project tiles\nconst TILE_COLORS = [\n    'blue', 'green', 'orange', 'purple', 'red', 'pink', 'teal', 'indigo',\n    'yellow', 'amber', 'lime', 'emerald', 'cyan', 'sky',\n    'violet', 'fuchsia', 'rose',\n    'slate', 'stone', 'neutral',\n    'gold', 'crimson', 'navy', 'aquamarine'\n];\n\n// Icon options\nconst PROJECT_ICONS = [\n    '', '', '', '', '', '', '', '', '', '', '', '',\n    '', '', '', '', '', '', '', '', '', '', '', '',\n    '', '', '', '', '', '', '', '', '', ''\n];\n\n// =====================\n// STATE\n// =====================\n// let colorIndex = 0;\nlet currentFilter = {\n    query: '',\n    type: 'active' // 'active' | 'archived'\n};\n\n// Cache for project data to avoid O(N) localStorage parsing\nlet _cachedProjectData = null;\n\n// =====================\n// HELPERS\n// =====================\n\n/**\n * Get the next color in the palette\n */\n// Unused helper - keeping for future color cycling if needed\n// function getNextColor() {\n//     const color = TILE_COLORS[colorIndex % TILE_COLORS.length];\n//     colorIndex++;\n//     return color;\n// }\n\n/**\n * Escape HTML to prevent XSS\n */\nfunction escapeHtml(str) {\n    if (typeof str !== 'string') return '';\n    return str\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n}\n\n/**\n * Format a date for display\n */\nfunction formatDate(dateStr) {\n    if (!dateStr) return '';\n    try {\n        const date = new Date(dateStr);\n        return date.toLocaleDateString(undefined, {\n            month: 'short',\n            day: 'numeric',\n            year: 'numeric'\n        });\n    } catch (_e) {\n        void _e;\n        return '';\n    }\n}\n\n/**\n * Format a date range string \"YYYY-MM-DD to YYYY-MM-DD\"\n */\nfunction formatDateRange(rangeStr) {\n    if (!rangeStr || typeof rangeStr !== 'string') return '';\n    const parts = rangeStr.split(' to ');\n    if (parts.length === 1) return formatDate(parts[0]);\n    if (parts.length === 2) {\n        return `${formatDate(parts[0])} - ${formatDate(parts[1])}`;\n    }\n    return rangeStr;\n}\n\n/**\n * Translation Helper\n */\nfunction _t(path, params = {}) {\n    const lang = document.documentElement.lang || 'en';\n    let root = (window.texts && window.texts[lang]) ? window.texts[lang] : null;\n    if (!root && window.texts) root = window.texts['en'];\n\n    // Simple resolve\n    const resolve = (obj, p) => p.split('.').reduce((o, i) => o ? o[i] : null, obj);\n\n    let val = root ? resolve(root, path) : null;\n\n    // Fallback to English if missing in current lang\n    if (!val && lang !== 'en' && window.texts && window.texts['en']) {\n        val = resolve(window.texts['en'], path);\n    }\n\n    if (!val) return path;\n\n    if (typeof val === 'string') {\n        for (const [k, v] of Object.entries(params)) {\n            val = val.replace(`{${k}}`, v);\n        }\n    }\n    return val;\n}\n\n// =====================\n// PROJECT DATA\n// =====================\n\n/**\n * Refresh the project data cache.\n * Uses the optimized loadProjectMetadata API from storage.js if available.\n */\nfunction refreshProjectDataCache() {\n    // [New V2] Use optimized metadata loader from storage.js\n    if (typeof window.loadProjectMetadata === 'function') {\n        try {\n            _cachedProjectData = window.loadProjectMetadata();\n            return;\n        } catch (e) {\n            console.warn('[V2] Failed to load project metadata via storage API:', e);\n        }\n    }\n\n    // [Fallback] Legacy direct read\n    try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored) {\n            _cachedProjectData = JSON.parse(stored);\n        } else {\n            _cachedProjectData = {};\n        }\n    } catch (e) {\n        console.error('[V2] Failed to parse project data:', e);\n        _cachedProjectData = {};\n    }\n}\n\n/**\n * Get all saved project names from legacy system\n * Uses a fallback chain to ensure data availability even during initialization\n */\nfunction getProjectNames() {\n    // Priority 1: Read from cached project data (Fastest & Most Accurate)\n    if (_cachedProjectData) {\n        return Object.keys(_cachedProjectData).filter(name => name && !name.startsWith('auto-backup-'));\n    }\n\n    // Priority 2: Use legacy shim if available\n    if (global.cineLegacyShim && typeof global.cineLegacyShim.getProjectNames === 'function') {\n        const names = global.cineLegacyShim.getProjectNames();\n        if (names.length > 0) return names;\n    }\n\n    // Priority 3: Read from setupSelect (if populated)\n    const setupSelect = document.getElementById('setupSelect');\n    if (setupSelect && setupSelect.options.length > 1) {\n        const names = Array.from(setupSelect.options)\n            .map(opt => opt.value)\n            .filter(val => val !== '');\n        if (names.length > 0) return [...new Set(names)];\n    }\n\n    // Priority 4: Direct localStorage fallback\n    try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored) {\n            const data = JSON.parse(stored);\n            return Object.keys(data).filter(name => name && !name.startsWith('auto-backup-'));\n        }\n    } catch (_e) {\n        void _e;\n    }\n\n    return [];\n}\n\n/**\n * Get filtered projects based on current state\n */\n/**\n * Get filtered projects based on current state\n */\nfunction getFilteredProjects() {\n    let projects = getProjectNames();\n\n    // 0. Filter by Archive Status\n    const showArchived = (currentFilter.type === 'archived');\n    projects = projects.filter(name => {\n        const metadata = getProjectMetadata(name);\n        const isArchived = !!metadata.archived;\n        return showArchived ? isArchived : !isArchived;\n    });\n\n    // 1. Filter by Query\n    if (currentFilter.query) {\n        const q = currentFilter.query.toLowerCase();\n        projects = projects.filter(name => name.toLowerCase().includes(q));\n    }\n\n    return [...new Set(projects)];\n}\n\n/**\n * Get project metadata (color, icon, last modified)\n * Uses module-level cache for performance\n */\nfunction getProjectMetadata(projectName) {\n    // Initialize cache if needed (though it should be primed by render)\n    if (_cachedProjectData === null) {\n        refreshProjectDataCache();\n    }\n\n    const project = _cachedProjectData[projectName];\n    if (project) {\n        return {\n            lastModified: project.lastModified || null,\n            color: project.color || null,\n            icon: project.icon || null,\n            prepDays: project.prepDays || [],\n            shootingDays: project.shootingDays || [],\n            returnDays: project.returnDays || [],\n            archived: project.archived || false,\n            status: project.status || (project.archived ? 'Archived' : 'Planning')\n        };\n    }\n\n    return { lastModified: null, color: null, icon: null, prepDays: [], shootingDays: [], returnDays: [], archived: false, status: 'Planning' };\n}\n\n/**\n * Update project metadata (color, icon, dates)\n */\nfunction updateProjectMetadata(projectName, metadata = {}) {\n    // [New V2] Use storage API to safely update project shards\n    if (typeof window.loadProject === 'function' && typeof window.saveProject === 'function') {\n        try {\n            const project = window.loadProject(projectName);\n            if (project) {\n                if (metadata.color) project.color = metadata.color;\n                if (metadata.icon) project.icon = metadata.icon;\n                if (metadata.prepDays) project.prepDays = metadata.prepDays;\n                if (metadata.shootingDays) project.shootingDays = metadata.shootingDays;\n                if (metadata.returnDays) project.returnDays = metadata.returnDays;\n                if (typeof metadata.archived !== 'undefined') project.archived = metadata.archived;\n                if (metadata.status) project.status = metadata.status;\n\n                window.saveProject(projectName, project);\n\n                // Update cache manually to reflect changes immediately in UI\n                if (_cachedProjectData && _cachedProjectData[projectName]) {\n                    Object.assign(_cachedProjectData[projectName], metadata);\n                }\n                return true;\n            }\n        } catch (e) {\n            console.error('[V2] Failed to update project via storage API:', e);\n            return false;\n        }\n    }\n\n    // [Legacy Fallback] - ONLY use if storage API is missing\n    try {\n        // Ensure cache is fresh before read-modify-write\n        refreshProjectDataCache();\n        const data = _cachedProjectData || {};\n\n        if (data && data[projectName]) {\n            // Merge new metadata\n            if (metadata.color) data[projectName].color = metadata.color;\n            if (metadata.icon) data[projectName].icon = metadata.icon;\n            if (metadata.prepDays) data[projectName].prepDays = metadata.prepDays;\n            if (metadata.shootingDays) data[projectName].shootingDays = metadata.shootingDays;\n            if (metadata.returnDays) data[projectName].returnDays = metadata.returnDays;\n            if (typeof metadata.archived !== 'undefined') data[projectName].archived = metadata.archived;\n            if (metadata.status) data[projectName].status = metadata.status;\n\n            // Persist\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\n            // Update cache reference\n            _cachedProjectData = data;\n\n            return true;\n        }\n    } catch (e) {\n        console.error('[V2] Failed to update project metadata:', e);\n    }\n    return false;\n}\n\n// =====================\n// TILE RENDERING\n// =====================\n\n/**\n * Create a project tile HTML\n */\nfunction createTileHtml(projectName, index) {\n    const metadata = getProjectMetadata(projectName);\n\n    // Use stored color or cycle through palette based on index\n    let color = metadata.color || TILE_COLORS[index % TILE_COLORS.length];\n\n    // Security: Validate color is in the allowed list to prevent injection\n    if (!TILE_COLORS.includes(color)) {\n        color = TILE_COLORS[index % TILE_COLORS.length];\n    }\n\n    // Use stored icon or default\n    // Security: Sanitize icon to prevent XSS\n    const icon = escapeHtml(metadata.icon || '');\n\n    const dateStr = metadata.lastModified ? formatDate(metadata.lastModified) : '';\n    const escapedName = escapeHtml(projectName);\n    const status = metadata.status || 'Planning';\n    const statusClass = status.toLowerCase().replace(/\\s+/g, '-');\n\n    // Translate Status\n    let statusKey = status.toLowerCase().replace(/\\s+/g, '');\n    if (statusKey === 'waitingforapproval') statusKey = 'waitingForApproval'; // Handle capitalization mismatch\n    const statusLabel = _t(`v2.dashboard.status.${statusKey}`) === `v2.dashboard.status.${statusKey}` ? status : _t(`v2.dashboard.status.${statusKey}`);\n\n\n    let periodsHtml = '';\n    const hasDates = (metadata.prepDays?.length > 0) || (metadata.shootingDays?.length > 0) || (metadata.returnDays?.length > 0);\n\n    if (hasDates) {\n        periodsHtml = `<div class=\"v2-tile-periods\">`;\n\n        // Render all Prep dates\n        if (Array.isArray(metadata.prepDays)) {\n            metadata.prepDays.forEach(range => {\n                const fmt = formatDateRange(range);\n                if (fmt) periodsHtml += `<span class=\"v2-period-badge prep\" title=\"${_t('v2.dashboard.projectTile.prep')} ${fmt}\"><span class=\"period-icon\"></span> ${fmt}</span>`;\n            });\n        }\n\n        // Render all Shoot dates\n        if (Array.isArray(metadata.shootingDays)) {\n            metadata.shootingDays.forEach(range => {\n                const fmt = formatDateRange(range);\n                if (fmt) periodsHtml += `<span class=\"v2-period-badge shoot\" title=\"${_t('v2.dashboard.projectTile.shoot')} ${fmt}\"><span class=\"period-icon\"></span> ${fmt}</span>`;\n            });\n        }\n\n        // Render all Return dates\n        if (Array.isArray(metadata.returnDays)) {\n            metadata.returnDays.forEach(range => {\n                const fmt = formatDateRange(range);\n                if (fmt) periodsHtml += `<span class=\"v2-period-badge return\" title=\"${_t('v2.dashboard.projectTile.return')} ${fmt}\"><span class=\"period-icon\"></span> ${fmt}</span>`;\n            });\n        }\n\n        periodsHtml += `</div>`;\n    }\n\n    return `\n      <div class=\"v2-project-tile\" data-project=\"${escapedName}\" tabindex=\"0\" role=\"button\" aria-label=\"${_t('v2.dashboard.projectTile.actionsFor', { project: escapedName })}\">\n        <div class=\"v2-tile-header\">\n          <div class=\"v2-tile-icon color-${color}\">${icon}</div>\n            <div class=\"v2-tile-info\">\n            <h3 class=\"v2-tile-title\">${escapedName}</h3>\n            <div style=\"display: flex; align-items: center; gap: 8px; margin-top: 4px;\">\n                 ${dateStr ? `<span class=\"v2-tile-meta\">${dateStr}</span>` : ''}\n                 <span class=\"v2-status-badge ${statusClass}\">${statusLabel}</span>\n            </div>\n            ${periodsHtml}\n          </div>\n          <div class=\"v2-tile-actions\">\n            <button type=\"button\" class=\"v2-tile-action-btn\" data-action=\"menu\" data-project=\"${escapedName}\" title=\"${_t('v2.dashboard.projectTile.moreOptions')}\" aria-label=\"${_t('v2.dashboard.projectTile.actionsFor', { project: escapedName })}\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <circle cx=\"12\" cy=\"12\" r=\"1\"></circle>\n                <circle cx=\"12\" cy=\"5\" r=\"1\"></circle>\n                <circle cx=\"12\" cy=\"19\" r=\"1\"></circle>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n}\n\n/**\n * Create the \"New Project\" tile HTML\n */\nfunction createNewProjectTileHtml() {\n    return `\n      <div class=\"v2-project-tile new-project\" id=\"v2CreateProjectTile\" tabindex=\"0\" role=\"button\" aria-label=\"${_t('v2.dashboard.newProject')}\">\n        <div class=\"v2-tile-header center\">\n          <div class=\"v2-tile-icon-add\">\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M12 5v14M5 12h14\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n          </div>\n          <h3 class=\"v2-tile-title\">${_t('v2.dashboard.newProject')}</h3>\n        </div>\n      </div>\n    `;\n}\n\n/**\n * Create Empty State HTML (No Projects)\n */\n\n\n/**\n * Create No Results HTML (Search)\n */\nfunction createNoResultsHtml(query) {\n    return `\n      <div class=\"view-empty-state\">\n        <div class=\"view-empty-state-icon\" style=\"font-size: 48px; display: flex; align-items: center; justify-content: center;\"></div>\n        <h2>${_t('v2.dashboard.search.noResults.title')}</h2>\n        <p class=\"text-muted\">${_t('v2.dashboard.search.noResults.subtitle', { query: escapeHtml(query) })}</p>\n        <button id=\"v2ClearSearchBtn\" class=\"v2-btn-secondary\">\n          Clear Search\n        </button>\n      </div>\n    `;\n}\n\n// =====================\n// DASHBOARD RENDERING\n// =====================\n\n/**\n * Render the project grid\n *\n * Core Rendering Logic:\n * 1. Clears the existing grid container.\n * 2. Retrieves the list of projects (from legacy storage or shim).\n * 3. Applies current filters (Search Query).\n * 4. Renders the appropriate state:\n *    - GLOBAL EMPTY STATE: If no projects exist at all.\n *    - NO RESULTS STATE: If projects exist but the search query matches nothing.\n *    - PROJECT GRID: Renders a tile for each matching project.\n * 5. Appends the \"New Project\" tile at the end (unless searching).\n * 6. Re-binds all click/keyboard events to the new DOM elements.\n *\n * Triggered by:\n * - Initial Load\n * - 'v2:viewchange' event (when switching to the Projects view)\n * - 'v2:search' event (real-time filtering from the Sidebar)\n */\nfunction renderProjectGrid() {\n    // Release any held project lock when returning to dashboard\n    if (global.cineProjectLockManager) {\n        global.cineProjectLockManager.releaseLock();\n    }\n\n    const container = document.getElementById(GRID_CONTAINER_ID);\n    if (!container) return;\n\n    // Render immediately - Removed artificial 800ms delay for performance\n    _renderGridContent(container);\n}\n\n/**\n * Internal render logic\n */\nfunction _renderGridContent(container) {\n    // Reset container to be sure\n    container.innerHTML = '';\n    container.className = 'v2-project-grid';\n    container.style = '';\n\n    // Prime the cache ONCE before processing any items\n    // This is the key performance fix\n    refreshProjectDataCache();\n\n    // Check if we have ANY projects at all (Global Empty State)\n    const allProjects = getProjectNames();\n    if (allProjects.length === 0) {\n        container.classList.add('v2-grid-empty');\n\n        // Force styles logic...\n        container.style.display = 'flex';\n        container.style.flexDirection = 'column';\n        container.style.alignItems = 'center';\n        container.style.justifyContent = 'flex-start';\n        container.style.paddingTop = '10vh';\n        container.style.minHeight = '100%';\n        container.style.flex = '1';\n\n        const main = container.closest('.v2-main');\n        if (main) main.classList.add('align-top'); // Fix layout\n\n        container.innerHTML = createEmptyStateHtml();\n        bindEmptyStateEvents(container);\n        return;\n    }\n\n    // Get Filtered Projects\n    const filteredProjects = getFilteredProjects();\n\n    // Check if Search returned nothing\n    if (filteredProjects.length === 0) {\n        container.classList.add('v2-grid-empty');\n\n        // Force styles logic...\n        container.style.display = 'flex';\n        container.style.flexDirection = 'column';\n        container.style.alignItems = 'center';\n        container.style.justifyContent = 'flex-start';\n        container.style.paddingTop = '10vh';\n        container.style.minHeight = '100%';\n        container.style.flex = '1';\n\n        const main = container.closest('.v2-main');\n        if (main) main.classList.add('align-top'); // Fix layout\n\n        container.innerHTML = createNoResultsHtml(currentFilter.query);\n\n        // Bind Clear Search\n        const clearBtn = container.querySelector('#v2ClearSearchBtn');\n        if (clearBtn) {\n            clearBtn.addEventListener('click', () => {\n                // Dispatch clear event or manually clear\n                const searchInput = document.getElementById('v2SidebarSearchInput');\n                if (searchInput) {\n                    searchInput.value = '';\n                    searchInput.dispatchEvent(new Event('input', { bubbles: true })); // Trigger update\n                }\n            });\n        }\n        return;\n    }\n\n    // Has Projects - Render Grid\n    const main = container.closest('.v2-main');\n    if (main) main.classList.remove('align-top'); // Reset layout\n\n    let html = '';\n    filteredProjects.forEach((name, index) => {\n        html += createTileHtml(name, index);\n    });\n\n    // Always show \"New Project\" tile at the end, unless searching\n    if (!currentFilter.query) {\n        html += createNewProjectTileHtml();\n    }\n\n    container.innerHTML = html;\n    bindTileEvents(container);\n}\n\n\n\n// =====================\n// EVENT HANDLING\n// =====================\n\n/**\n * Bind Search Events\n * Listens for the custom 'v2:search' event dispatched by the Sidebar's search input.\n * This decouples the Sidebar component from the Dashboard component.\n */\nfunction bindSearchEvents() {\n    window.addEventListener('v2:search', (e) => {\n        currentFilter.query = e.detail?.query || '';\n        renderProjectGrid();\n    });\n}\n\n/**\n * Bind events to project tiles\n */\n/**\n * Bind events to project tiles\n */\nfunction bindTileEvents(container) {\n    // Click on tile (open project)\n    container.querySelectorAll('.v2-project-tile').forEach(tile => {\n        // Left Click\n        tile.addEventListener('click', (e) => {\n            // Don't trigger if clicking on menu button\n            if (e.target.closest('[data-action=\"menu\"]')) return;\n\n            const projectName = tile.dataset.project;\n            if (projectName) {\n                openProject(projectName);\n            }\n        });\n\n        // Right Click (Context Menu)\n        tile.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            const projectName = tile.dataset.project;\n            if (projectName) {\n                showContextMenu(e, projectName);\n            }\n        });\n\n        // Keyboard support\n        tile.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                tile.click();\n            }\n        });\n    });\n\n    // Click on menu button\n    container.querySelectorAll('[data-action=\"menu\"]').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n            e.stopPropagation();\n            const projectName = btn.dataset.project;\n            if (projectName) {\n                showContextMenu(e, projectName);\n            }\n        });\n    });\n\n    // Click on new project tile\n    const newProjectTile = container.querySelector('#v2CreateProjectTile');\n    if (newProjectTile) {\n        newProjectTile.addEventListener('click', () => showProjectDialog()); // No arg = new\n        newProjectTile.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                showProjectDialog();\n            }\n        });\n    }\n}\n\n/**\n * Show Context Menu\n */\n/**\n * Show Context Menu\n */\nfunction showContextMenu(e, projectName) {\n    // Close existing\n    closeContextMenu();\n\n    const menu = document.createElement('div');\n    menu.className = 'v2-context-menu';\n    menu.innerHTML = `\n            <button class=\"v2-context-menu-item\" data-action=\"open\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <path d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                    <path d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\n                </svg>\n                ${_t('v2.dashboard.contextMenu.open')}\n            </button>\n            <button class=\"v2-context-menu-item\" data-action=\"edit\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\n                    <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\n                </svg>\n                ${_t('v2.dashboard.contextMenu.rename')}\n            </button>\n            <button class=\"v2-context-menu-item\" data-action=\"print\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <polyline points=\"6 9 6 2 18 2 18 9\"></polyline>\n                    <path d=\"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\"></path>\n                    <rect x=\"6\" y=\"14\" width=\"12\" height=\"8\"></rect>\n                </svg>\n                ${_t('v2.dashboard.contextMenu.print')}\n            </button>\n            <button class=\"v2-context-menu-item\" data-action=\"duplicate\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect>\n                    <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path>\n                </svg>\n                ${_t('v2.dashboard.contextMenu.duplicate')}\n            </button>\n            <button class=\"v2-context-menu-item\" data-action=\"archive\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <polyline points=\"21 8 21 21 3 21 3 8\"></polyline>\n                    <rect x=\"1\" y=\"3\" width=\"22\" height=\"5\"></rect>\n                    <line x1=\"10\" y1=\"12\" x2=\"14\" y2=\"12\"></line>\n                </svg>\n                ${_t('v2.dashboard.contextMenu.archive')}\n            </button>\n             <div style=\"height: 1px; background: var(--v2-border-default); margin: 4px 0;\"></div>\n            <button class=\"v2-context-menu-item danger\" data-action=\"delete\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <path d=\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\"/>\n                </svg>\n                ${_t('v2.dashboard.contextMenu.delete')}\n            </button>\n        `;\n\n    // Position\n    menu.style.left = `${e.clientX}px`;\n    menu.style.top = `${e.clientY}px`;\n\n    // Bind Actions\n    menu.querySelector('[data-action=\"open\"]').addEventListener('click', () => {\n        openProject(projectName);\n        closeContextMenu();\n    });\n\n    menu.querySelector('[data-action=\"edit\"]').addEventListener('click', () => {\n        closeContextMenu();\n        showProjectDialog(projectName); // Pass name = edit mode\n    });\n\n    menu.querySelector('[data-action=\"print\"]').addEventListener('click', () => {\n        openProject(projectName, { action: 'print' });\n        closeContextMenu();\n    });\n\n    menu.querySelector('[data-action=\"duplicate\"]').addEventListener('click', () => {\n        duplicateProject(projectName);\n        closeContextMenu();\n    });\n\n    menu.querySelector('[data-action=\"archive\"]').addEventListener('click', () => {\n        archiveProject(projectName);\n        closeContextMenu();\n    });\n\n    menu.querySelector('[data-action=\"delete\"]').addEventListener('click', () => {\n        deleteProject(projectName);\n        closeContextMenu();\n    });\n\n    document.body.appendChild(menu);\n\n    // Adjust constraints (keep onscreen)\n    const rect = menu.getBoundingClientRect();\n    if (rect.right > window.innerWidth) menu.style.left = `${window.innerWidth - rect.width - 10}px`;\n    if (rect.bottom > window.innerHeight) menu.style.top = `${window.innerHeight - rect.height - 10}px`;\n\n    // Bind Close\n    setTimeout(() => {\n        document.addEventListener('click', closeContextMenu, { once: true });\n        document.addEventListener('contextmenu', closeContextMenu, { once: true });\n    }, 0);\n}\n\n/**\n * Close Context Menu\n */\nfunction closeContextMenu() {\n    const existing = document.querySelector('.v2-context-menu');\n    if (existing) existing.remove();\n    document.removeEventListener('click', closeContextMenu);\n}\n\n/**\n * Bind events for empty state\n */\nfunction bindEmptyStateEvents(container) {\n    const createBtn = container.querySelector('#v2EmptyStateCreateBtn');\n    if (createBtn) {\n        createBtn.addEventListener('click', showCreateProjectDialog);\n    }\n}\n\n// =====================\n// PROJECT OPERATIONS\n// =====================\n\n/**\n * Open a project (navigate to detail view)\n */\nasync function openProject(projectName, options = {}) {\n    // Check for cross-tab lock\n    if (global.cineProjectLockManager) {\n        const locked = await global.cineProjectLockManager.requestLock(projectName);\n        if (!locked) {\n            alert(_t('v2.dashboard.projectLocked', { projectName: projectName }));\n            return;\n        }\n    }\n\n    // Load the project via legacy shim\n    if (global.cineLegacyShim) {\n        global.cineLegacyShim.loadProject(projectName);\n    }\n\n    // Navigate to project detail view\n    if (global.cineViewManager) {\n        global.cineViewManager.showView('projectDetail', {\n            projectId: projectName,\n            tab: 'camera',\n            ...options\n        });\n    }\n}\n\n/**\n * Create Empty State HTML (No Projects)\n */\nfunction createEmptyStateHtml() {\n    if (currentFilter.type === 'archived') {\n        return `\n              <div class=\"view-empty-state\">\n                <div class=\"view-empty-state-icon\" style=\"font-size: 64px; opacity: 0.8; margin-bottom: 16px;\">\n                  \n                </div>\n                <h2>${_t('v2.dashboard.emptyState.archiveTitle')}</h2>\n                <p class=\"text-muted\">${_t('v2.dashboard.emptyState.archiveSubtitle')}</p>\n              </div>\n            `;\n    }\n\n    return `\n      <div class=\"view-empty-state\">\n        <div class=\"view-empty-state-icon\" style=\"font-size: 64px; opacity: 0.8; margin-bottom: 16px;\">\n          <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"/>\n            <polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"/>\n            <line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"/>\n          </svg>\n        </div>\n        <h2>${_t('v2.dashboard.emptyState.title')}</h2>\n        <p class=\"text-muted\">${_t('v2.dashboard.emptyState.subtitle')}</p>\n        <div class=\"v2-empty-actions\">\n            <button id=\"v2EmptyStateCreateBtn\" class=\"v2-btn-primary\">\n              + ${_t('v2.dashboard.newProject')}\n            </button>\n            <p class=\"v2-help-link-container\">\n                <a href=\"#/help\" class=\"v2-link-subtle\">${_t('v2.dashboard.emptyState.help')}</a>\n            </p>\n        </div>\n      </div>\n    `;\n}\n\n// ... (createNoResultsHtml and render methods stay same, but we need to jump to project operations area)\n\n// [Skipping middle sections, targeting lines 656-696 for project operations]\n\n/**\n * Delete a project\n */\n/**\n * Delete a project\n */\nfunction deleteProject(projectName) {\n    if (!confirm(_t('v2.dashboard.confirmDelete', { project: projectName }) || `Are you sure you want to delete project \"${projectName}\"?`)) {\n        return;\n    }\n\n    try {\n        // 1. Delete from storage\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored) {\n            const data = JSON.parse(stored);\n            if (data[projectName]) {\n                delete data[projectName];\n                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\n                // UPDATE REVISION for cross-tab sync\n                updateProjectRevision();\n            }\n        }\n\n        // 2. Notify legacy shim if available (to clean up its internal state if any)\n        if (global.cineLegacyShim && typeof global.cineLegacyShim.deleteProject === 'function') {\n            // We typically just need to refresh, but if the shim has specific delete logic, call it.\n            // However, since we manually deleted from storage, we might just need to refresh.\n            if (typeof global.cineLegacyShim.refreshProjects === 'function') {\n                global.cineLegacyShim.refreshProjects();\n            }\n        }\n\n        // 3. Update UI\n        renderProjectGrid();\n\n    } catch (e) {\n        console.error('[V2] Failed to delete project:', e);\n        alert(_t('v2.common.error') || 'An error occurred.');\n    }\n}\n\n/**\n * Archive Project\n */\nfunction archiveProject(projectName) {\n    updateProjectMetadata(projectName, { archived: true, status: 'Archived' });\n    renderProjectGrid();\n}\n\n/**\n * Duplicate Project\n */\nfunction duplicateProject(projectName) {\n    try {\n        // 1. Get original data\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (!stored) return;\n        const data = JSON.parse(stored);\n        const originalData = data[projectName];\n        if (!originalData) return;\n\n        // 2. Generate new unique name\n        let newName = `${projectName} (Copy)`;\n        let counter = 2;\n        while (data[newName]) {\n            newName = `${projectName} (Copy ${counter})`;\n            counter++;\n        }\n\n        // 3. Clone data\n        const newData = JSON.parse(JSON.stringify(originalData));\n        newData.created = new Date().toISOString();\n        newData.lastModified = new Date().toISOString();\n\n        // 4. Save\n        data[newName] = newData;\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\n        // UPDATE REVISION for cross-tab sync\n        updateProjectRevision();\n\n        // Refresh Grid\n        renderProjectGrid();\n\n        // Notify legacy shim if available\n        if (global.cineLegacyShim && typeof global.cineLegacyShim.refreshProjects === 'function') {\n            global.cineLegacyShim.refreshProjects();\n        }\n\n    } catch (e) {\n        console.error('Failed to duplicate project:', e);\n    }\n}\n\n/**\n * Show create project dialog using internal modal\n */\nfunction showProjectDialog(projectName = null) {\n    showCreateProjectDialog(projectName);\n}\n\n/**\n * Internal implementation for showing the modal\n */\nfunction showCreateProjectDialog(existingProject = null) {\n    const isEditing = !!existingProject;\n    const randomColorIndex = Math.floor(Math.random() * TILE_COLORS.length);\n    let selectedColor = TILE_COLORS[randomColorIndex];\n    let selectedIcon = '';\n\n    let existingMetadata = null;\n\n    // If editing, load existing data\n    if (isEditing) {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored) {\n            const data = JSON.parse(stored);\n            if (data[existingProject]) {\n                existingMetadata = data[existingProject];\n                if (existingMetadata.color) selectedColor = existingMetadata.color;\n                if (existingMetadata.icon) selectedIcon = existingMetadata.icon;\n            }\n        }\n    }\n\n    // Dynamic periods state\n    let periods = [];\n\n    if (isEditing && existingMetadata) {\n        // Reconstruct periods from V1 structure\n        let pid = 1;\n\n        // Helpers\n        const parseRange = (str, type, name) => {\n            if (!str) return;\n            let start = '', end = '';\n            if (str.includes(' to ')) {\n                [start, end] = str.split(' to ');\n            } else {\n                start = str;\n                end = str; // Single day range\n            }\n            periods.push({\n                id: `period-${pid++}`,\n                type,\n                name,\n                startDate: start,\n                endDate: end\n            });\n        };\n\n        if (Array.isArray(existingMetadata.prepDays)) existingMetadata.prepDays.forEach(d => parseRange(d, 'prep', 'Prep'));\n        if (Array.isArray(existingMetadata.shootingDays)) existingMetadata.shootingDays.forEach(d => parseRange(d, 'shoot', 'Shoot'));\n        if (Array.isArray(existingMetadata.returnDays)) existingMetadata.returnDays.forEach(d => parseRange(d, 'return', 'Return'));\n    }\n\n    // Default for new projects\n    if (!isEditing && periods.length === 0) {\n        periods = [\n            { id: 'period-1', type: 'prep', name: 'Prep', startDate: '', endDate: '' },\n            { id: 'period-2', type: 'shoot', name: 'Shoot', startDate: '', endDate: '' },\n            { id: 'period-3', type: 'return', name: 'Return', startDate: '', endDate: '' }\n        ];\n    }\n\n    let periodCounter = periods.length > 0 ? periods.length : 3;\n\n    const PERIOD_TYPES = [\n        { value: 'prep', label: 'Prep', icon: '' },\n        { value: 'shoot', label: 'Shoot', icon: '' },\n        { value: 'return', label: 'Return', icon: '' }\n    ];\n\n    // Modal styles moved to src/styles/v2/views/project-dashboard.css\n\n    const getColorVar = (c) => `var(--v2-color-${c})`;\n\n    // Build HTML for swatches\n    const colorSwatchesHtml = TILE_COLORS.map(c => `\n            <button type=\"button\" class=\"v2-color-swatch-sm color-${c} ${c === selectedColor ? 'selected' : ''}\" \n                    data-color=\"${c}\" aria-label=\"Select ${c} color\">\n            </button>\n        `).join('');\n\n    // Build HTML for icons\n    const iconOptionsHtml = PROJECT_ICONS.map(i => `\n            <button type=\"button\" class=\"v2-icon-option-sm ${i === selectedIcon ? 'selected' : ''}\" \n                    data-icon=\"${i}\" aria-label=\"Select icon ${i}\">\n                ${i}\n            </button>\n        `).join('');\n\n    // Build HTML for periods\n    const buildPeriodsHtml = () => {\n        if (periods.length === 0) {\n            return `<div class=\"v2-empty-state\" style=\"padding: 16px; font-size: 13px;\">No dates added yet.</div>`;\n        }\n        return periods.map(p => {\n            const typeOptions = PERIOD_TYPES.map(t =>\n                `<option value=\"${t.value}\" ${p.type === t.value ? 'selected' : ''}>${t.icon} ${t.label}</option>`\n            ).join('');\n\n            return `\n                <div class=\"v2-period-row\" data-period-id=\"${p.id}\">\n                    <div class=\"v2-period-name\">\n                        <select class=\"v2-period-type-select\" data-field=\"type\">\n                            ${typeOptions}\n                        </select>\n                    </div>\n                    <input type=\"date\" class=\"v2-date-input\" value=\"${p.startDate}\" data-field=\"startDate\" aria-label=\"${p.name} Start Date\">\n                    <span class=\"v2-date-separator\">to</span>\n                    <input type=\"date\" class=\"v2-date-input\" value=\"${p.endDate}\" data-field=\"endDate\" aria-label=\"${p.name} End Date\">\n                    <button type=\"button\" class=\"v2-period-remove\" data-period-id=\"${p.id}\" aria-label=\"Remove period\">\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                            <path d=\"M18 6L6 18M6 6l12 12\"/>\n                        </svg>\n                    </button>\n                </div>\n            `}).join('');\n    }\n\n    // Create modal backdrop\n    const backdrop = document.createElement('div');\n    backdrop.className = 'v2-modal-backdrop';\n    backdrop.innerHTML = `\n            <div class=\"v2-modal\" style=\"max-width: 520px;\">\n                <div class=\"v2-modal-header\">\n                    <h3 class=\"v2-modal-title\">${isEditing ? 'Edit Project' : 'Create New Project'}</h3>\n                    <button type=\"button\" class=\"v2-modal-close v2-btn v2-btn-ghost\" aria-label=\"Close\">\n                        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                            <path d=\"M6 18L18 6M6 6l12 12\"/>\n                        </svg>\n                    </button>\n                </div>\n                <div class=\"v2-modal-body\">\n                    <!-- Project Name -->\n                    <div style=\"margin-bottom: var(--v2-space-lg);\">\n                        <label for=\"v2NewProjectName\" class=\"v2-form-section-label\" style=\"font-size: var(--v2-font-size-base); color: var(--v2-text-primary);\">\n                            Project Name\n                        </label>\n                        <input type=\"text\" id=\"v2NewProjectName\" class=\"v2-input\" placeholder=\"Enter project name...\" \n                               value=\"${isEditing ? existingProject : ''}\"\n                               style=\"width: 100%; padding: var(--v2-space-sm) var(--v2-space-md); border: 1px solid var(--v2-border-default); border-radius: var(--v2-radius-md); font-size: var(--v2-font-size-base);\">\n                        ${isEditing ? '<p class=\"text-muted\" style=\"font-size: 12px; margin-top: 4px;\">Warning: Renaming will create a new entry.</p>' : ''}\n                        <p id=\"v2NewProjectError\" style=\"color: var(--v2-status-error); font-size: var(--v2-font-size-sm); margin-top: var(--v2-space-sm); display: none;\"></p>\n                    </div>\n\n                    <!-- Color & Icon Pickers Row -->\n                    <div class=\"v2-picker-row\" style=\"margin-bottom: var(--v2-space-lg);\">\n                        <div class=\"v2-picker-group\">\n                            <label class=\"v2-form-section-label\">Color</label>\n                            <button type=\"button\" class=\"v2-picker-trigger\" id=\"v2ColorPickerTrigger\">\n                                <span class=\"v2-picker-preview\" id=\"v2ColorPreview\" style=\"background-color: ${getColorVar(selectedColor)};\"></span>\n                                <span class=\"v2-picker-label\">${selectedColor.charAt(0).toUpperCase() + selectedColor.slice(1)}</span>\n                                <svg class=\"v2-picker-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                                    <polyline points=\"6 9 12 15 18 9\"/>\n                                </svg>\n                            </button>\n                            <div class=\"v2-picker-popover\" id=\"v2ColorPopover\">\n                                <div class=\"v2-picker-popover-grid\">\n                                    ${colorSwatchesHtml}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"v2-picker-group\">\n                            <label class=\"v2-form-section-label\">Icon</label>\n                            <button type=\"button\" class=\"v2-picker-trigger\" id=\"v2IconPickerTrigger\">\n                                <span class=\"v2-picker-icon-preview\" id=\"v2IconPreview\">${selectedIcon}</span>\n                                <span class=\"v2-picker-label\">Icon</span>\n                                <svg class=\"v2-picker-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                                    <polyline points=\"6 9 12 15 18 9\"/>\n                                </svg>\n                            </button>\n                            <div class=\"v2-picker-popover\" id=\"v2IconPopover\" style=\"min-width: 280px;\">\n                                <div class=\"v2-picker-popover-grid\" style=\"grid-template-columns: repeat(7, 1fr);\">\n                                    ${iconOptionsHtml}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Project Periods -->\n                    <div style=\"margin-bottom: var(--v2-space-md);\">\n                        <label class=\"v2-form-section-label\">Project Roadmap</label>\n                        <div class=\"v2-periods-container\" id=\"v2PeriodsContainer\">\n                            ${buildPeriodsHtml()}\n                        </div>\n                        <button type=\"button\" class=\"v2-add-period-btn\" id=\"v2AddPeriodBtn\" style=\"margin-top: var(--v2-space-sm); width: 100%;\">\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                                <path d=\"M12 5v14M5 12h14\"/>\n                            </svg>\n                            Add Period\n                        </button>\n                    </div>\n                </div>\n                <div class=\"v2-modal-footer\">\n                    <button type=\"button\" class=\"v2-btn v2-btn-secondary\" id=\"v2CancelProjectBtn\">Cancel</button>\n                    <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"v2CreateProjectBtn\">${isEditing ? 'Save Changes' : 'Create Project'}</button>\n                </div>\n            </div>\n        `;\n\n    document.body.appendChild(backdrop);\n\n    // Animate open\n    requestAnimationFrame(() => {\n        backdrop.classList.add('open');\n    });\n\n    const input = backdrop.querySelector('#v2NewProjectName');\n    const errorEl = backdrop.querySelector('#v2NewProjectError');\n    const createBtn = backdrop.querySelector('#v2CreateProjectBtn');\n    const cancelBtn = backdrop.querySelector('#v2CancelProjectBtn');\n    const closeBtn = backdrop.querySelector('.v2-modal-close');\n    const periodsContainer = backdrop.querySelector('#v2PeriodsContainer');\n    const addPeriodBtn = backdrop.querySelector('#v2AddPeriodBtn');\n\n    // Color picker logic\n    const colorTrigger = backdrop.querySelector('#v2ColorPickerTrigger');\n    const colorPopover = backdrop.querySelector('#v2ColorPopover');\n    const colorPreview = backdrop.querySelector('#v2ColorPreview');\n    const colorLabel = colorTrigger.querySelector('.v2-picker-label');\n\n    colorTrigger.addEventListener('click', (e) => {\n        e.stopPropagation();\n        colorTrigger.classList.toggle('open');\n        colorPopover.classList.toggle('open');\n        // Close icon popover\n        iconTrigger.classList.remove('open');\n        iconPopover.classList.remove('open');\n    });\n\n    colorPopover.querySelectorAll('.v2-color-swatch-sm').forEach(swatch => {\n        swatch.addEventListener('click', (e) => {\n            e.stopPropagation();\n            colorPopover.querySelectorAll('.v2-color-swatch-sm').forEach(s => s.classList.remove('selected'));\n            swatch.classList.add('selected');\n            selectedColor = swatch.dataset.color;\n            colorPreview.style.backgroundColor = getColorVar(selectedColor);\n            colorLabel.textContent = selectedColor.charAt(0).toUpperCase() + selectedColor.slice(1);\n            colorTrigger.classList.remove('open');\n            colorPopover.classList.remove('open');\n        });\n    });\n\n    // Icon picker logic\n    const iconTrigger = backdrop.querySelector('#v2IconPickerTrigger');\n    const iconPopover = backdrop.querySelector('#v2IconPopover');\n    const iconPreview = backdrop.querySelector('#v2IconPreview');\n\n    iconTrigger.addEventListener('click', (e) => {\n        e.stopPropagation();\n        iconTrigger.classList.toggle('open');\n        iconPopover.classList.toggle('open');\n        // Close color popover\n        colorTrigger.classList.remove('open');\n        colorPopover.classList.remove('open');\n    });\n\n    iconPopover.querySelectorAll('.v2-icon-option-sm').forEach(opt => {\n        opt.addEventListener('click', (e) => {\n            e.stopPropagation();\n            iconPopover.querySelectorAll('.v2-icon-option-sm').forEach(o => o.classList.remove('selected'));\n            opt.classList.add('selected');\n            selectedIcon = opt.dataset.icon;\n            iconPreview.textContent = selectedIcon;\n            iconTrigger.classList.remove('open');\n            iconPopover.classList.remove('open');\n        });\n    });\n\n    // Close popovers when clicking outside\n    backdrop.addEventListener('click', () => {\n        colorTrigger.classList.remove('open');\n        colorPopover.classList.remove('open');\n        iconTrigger.classList.remove('open');\n        iconPopover.classList.remove('open');\n    });\n\n    // Periods management\n    function updatePeriodData(periodId, field, value) {\n        const period = periods.find(p => p.id === periodId);\n        if (period) {\n            if (field === 'type') {\n                const typeInfo = PERIOD_TYPES.find(t => t.value === value);\n                if (typeInfo) {\n                    period.type = value;\n                    period.name = typeInfo.label;\n                }\n            } else {\n                period[field] = value;\n            }\n        }\n    }\n\n    function removePeriod(periodId) {\n        periods = periods.filter(p => p.id !== periodId);\n        renderPeriods();\n    }\n\n    function addPeriod() {\n        periodCounter++;\n        periods.push({\n            id: `period-${periodCounter}`,\n            type: 'shoot',\n            name: 'Shoot',\n            startDate: '',\n            endDate: ''\n        });\n        renderPeriods();\n        // Focus new date input? Or scroll to bottom\n    }\n\n    function renderPeriods() {\n        periodsContainer.innerHTML = buildPeriodsHtml();\n        bindPeriodEvents();\n    }\n\n    function bindPeriodEvents() {\n        periodsContainer.querySelectorAll('.v2-period-row').forEach(row => {\n            const periodId = row.dataset.periodId;\n\n            // Inputs\n            row.querySelectorAll('input, select').forEach(input => {\n                input.addEventListener('change', () => {\n                    updatePeriodData(periodId, input.dataset.field, input.value);\n                });\n                input.addEventListener('input', () => {\n                    updatePeriodData(periodId, input.dataset.field, input.value);\n                });\n            });\n\n            // Remove button\n            const removeBtn = row.querySelector('.v2-period-remove');\n            if (removeBtn) {\n                removeBtn.addEventListener('click', () => {\n                    removePeriod(periodId);\n                });\n            }\n        });\n    }\n\n    // Initial bind\n    bindPeriodEvents();\n\n    // Add period button\n    addPeriodBtn.addEventListener('click', addPeriod);\n\n    // Focus input (unless editing)\n    if (!isEditing) {\n        setTimeout(() => input.focus(), 100);\n    }\n\n    function closeModal() {\n        backdrop.classList.remove('open');\n        setTimeout(() => backdrop.remove(), 200);\n    }\n\n    function handleCreate() {\n        const projectName = input.value.trim();\n\n        if (!projectName) {\n            errorEl.textContent = 'Please enter a project name.';\n            errorEl.style.display = 'block';\n            input.focus();\n            return;\n        }\n\n        const existingNames = getProjectNames();\n\n        // Check duplicates\n        if (isEditing) {\n            // If named changed, check if new name exists\n            if (projectName !== existingProject && existingNames.includes(projectName)) {\n                errorEl.textContent = 'A project with this name already exists.';\n                errorEl.style.display = 'block';\n                input.focus();\n                return;\n            }\n        } else {\n            // New Project\n            if (existingNames.includes(projectName)) {\n                errorEl.textContent = 'A project with this name already exists.';\n                errorEl.style.display = 'block';\n                input.focus();\n                return;\n            }\n        }\n\n        closeModal();\n\n        // Collect period data into V1 structures\n        const formatPeriod = (period) => {\n            if (!period) return null;\n            const s = period.startDate;\n            const e = period.endDate;\n            if (!s && !e) return null;\n            if (s && e) return `${s} to ${e}`;\n            if (s) return s;\n            if (e) return e;\n            return null;\n        };\n\n        const prepDays = periods.filter(p => p.type === 'prep').map(formatPeriod).filter(Boolean);\n        const shootingDays = periods.filter(p => p.type === 'shoot').map(formatPeriod).filter(Boolean);\n        const returnDays = periods.filter(p => p.type === 'return').map(formatPeriod).filter(Boolean);\n\n        const metadata = {\n            color: selectedColor,\n            icon: selectedIcon,\n            prepDays,\n            shootingDays,\n            returnDays\n        };\n\n        if (isEditing) {\n            // Rename Checks\n            if (projectName !== existingProject) {\n                // RENAME LOGIC: Duplicate then Delete\n                try {\n                    const stored = localStorage.getItem(STORAGE_KEY);\n                    if (stored) {\n                        const data = JSON.parse(stored);\n                        const oldData = data[existingProject];\n                        if (oldData) {\n                            // Create New Entry\n                            data[projectName] = { ...oldData, ...metadata };\n                            data[projectName].lastModified = new Date().toISOString();\n                            // Delete Old Entry\n                            delete data[existingProject];\n                            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\n                            // UPDATE REVISION for cross-tab sync\n                            updateProjectRevision();\n\n                            // If we are renaming the currently active project, we need to update the global session\n                            const setupSelect = document.getElementById('setupSelect');\n                            if (setupSelect && setupSelect.value === existingProject) {\n                                // We can't easily update the active session fully without a reload or deep app-session calls\n                                // But for the dashboard view, we just need to refresh the grid.\n                                // Ideally, we should switch the active project to the new name if it was open.\n                                // For now, let's just refresh the grid which is the primary goal.\n                            }\n\n                            renderProjectGrid();\n\n                            // If the user has the legacy shim, we might need to notify it\n                            if (global.cineLegacyShim && typeof global.cineLegacyShim.refreshProjects === 'function') {\n                                global.cineLegacyShim.refreshProjects();\n                            }\n                        }\n                    }\n                } catch (e) {\n                    console.error('Rename failed', e);\n                }\n            } else {\n                // UPDATE Existing (Same Name)\n                updateProjectMetadata(projectName, metadata);\n                renderProjectGrid(); // Refresh grid\n            }\n        } else {\n            // CREATE New\n            createProject(projectName, metadata);\n        }\n    }\n\n    // Event listeners\n    createBtn.addEventListener('click', handleCreate);\n    cancelBtn.addEventListener('click', closeModal);\n    closeBtn.addEventListener('click', closeModal);\n\n    // Close on backdrop click\n    backdrop.addEventListener('click', (e) => {\n        if (e.target === backdrop) closeModal();\n    });\n\n    // Enter key to create\n    input.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') handleCreate();\n        if (e.key === 'Escape') closeModal();\n    });\n\n    // Clear error on typing\n    input.addEventListener('input', () => {\n        errorEl.style.display = 'none';\n    });\n}\n\n\n/**\n * Create a new project\n */\nfunction createProject(projectName, metadata = {}) {\n    if (global.cineLegacyShim) {\n        global.cineLegacyShim.createProject(projectName);\n\n        // Wait for the project to be saved before updating metadata\n        // The legacy save is async (triggered via button click), so we poll\n        const waitForProjectAndUpdateMetadata = (attempts = 0) => {\n            const maxAttempts = 20; // ~2 seconds max\n            const stored = localStorage.getItem(STORAGE_KEY);\n            if (stored) {\n                try {\n                    const data = JSON.parse(stored);\n                    if (data && data[projectName]) {\n                        updateProjectMetadata(projectName, metadata);\n                        return;\n                    }\n                } catch (_e) { void _e; }\n            }\n            if (attempts < maxAttempts) {\n                setTimeout(() => waitForProjectAndUpdateMetadata(attempts + 1), 100);\n            } else {\n                console.warn('[V2] Timed out waiting for project to be saved:', projectName);\n            }\n        };\n        waitForProjectAndUpdateMetadata();\n    }\n\n    // Navigate to the new project\n    if (global.cineViewManager) {\n        global.cineViewManager.showView('projectDetail', {\n            projectId: projectName,\n            tab: 'camera'\n        });\n    }\n}\n\n/**\n * Helper to update the project revision key for cross-tab sync\n */\nfunction updateProjectRevision() {\n    try {\n        const REV_KEY = 'cameraPowerPlanner_project_rev';\n        const currentRev = parseInt(localStorage.getItem(REV_KEY) || '0', 10);\n        localStorage.setItem(REV_KEY, (currentRev + 1).toString());\n    } catch (e) {\n        console.error('[V2] Failed to update project revision:', e);\n    }\n}\n\n// =====================\n// VIEW MANAGEMENT\n// =====================\n\n/**\n * Create the dashboard view HTML structure\n */\nfunction createDashboardView() {\n    // Check if view already exists\n    if (document.getElementById(VIEW_ID)) {\n        return document.getElementById(VIEW_ID);\n    }\n\n    const view = document.createElement('section');\n    view.id = VIEW_ID;\n    view.className = 'app-view v2-app';\n    view.innerHTML = `\n      <header class=\"view-header\">\n        <h1>Projects</h1>\n        <div class=\"view-header-actions\">\n          <button type=\"button\" class=\"v2-btn v2-btn-secondary\" id=\"v2HeaderImportBtn\" style=\"margin-right: 8px;\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"margin-right: 6px;\">\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\n              <polyline points=\"7 10 12 15 17 10\" />\n              <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" />\n            </svg>\n            Import Project\n          </button>\n          <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"v2HeaderCreateBtn\">\n            + New Project\n          </button>\n        </div>\n      </header>\n      <div class=\"view-content\">\n        <div class=\"v2-project-grid\" id=\"${GRID_CONTAINER_ID}\">\n          <!-- Tiles will be rendered here -->\n        </div>\n      </div>\n    `;\n\n    // Bind header create button\n    const headerBtn = view.querySelector('#v2HeaderCreateBtn');\n    if (headerBtn) {\n        headerBtn.addEventListener('click', showCreateProjectDialog);\n    }\n\n    return view;\n}\n\n/**\n * Initialize the project dashboard\n */\nfunction init() {\n    console.log('[ProjectDashboard] init() called');\n\n    // Create dashboard view if it doesn't exist\n    const view = createDashboardView();\n\n    // Find main content area and append\n    const v2Main = document.querySelector('.v2-main');\n\n    if (v2Main && !document.getElementById(VIEW_ID)) {\n        v2Main.appendChild(view);\n    }\n\n    // Bind the header button event (Delegated for robustness)\n    document.addEventListener('click', (e) => {\n        if (e.target) {\n            if (e.target.closest('#v2HeaderCreateBtn')) {\n                showCreateProjectDialog();\n            } else if (e.target.closest('#v2HeaderImportBtn')) {\n                // Trigger legacy import\n                if (global.cineLegacyShim) {\n                    global.cineLegacyShim.triggerLegacyClick('applySharedLinkBtn');\n                }\n            }\n        }\n    });\n\n    // If we are already on the projects view, render\n    const currentView = document.querySelector('.v2-view.active');\n    if (currentView && currentView.id === VIEW_ID) {\n        renderProjectGrid(true); // Pass true for initial load\n    }\n\n    // Listen for view changes\n    window.addEventListener('v2:viewchange', (e) => {\n        if (e.detail.view === 'projects') {\n            // If switching to this view, treat as initial load\n            renderProjectGrid(true);\n        }\n    });\n\n    bindSearchEvents();\n}\n\n// =====================\n// PUBLIC API\n// =====================\nconst ProjectDashboard = {\n    init,\n    renderProjectGrid,\n    createProject,\n    deleteProject,\n    openProject,\n    getProjectNames,\n    createDashboardView,\n    formatDate,\n    formatDateRange\n};\n\n// Expose to global scope\nif (typeof global !== 'undefined') {\n    global.cineProjectDashboard = ProjectDashboard;\n}\n\nif (typeof window !== 'undefined') {\n    window.cineProjectDashboard = ProjectDashboard;\n}\n\n// Auto-initialize when DOM is ready\nif (typeof document !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => {\n            // Delay init to let other V2 modules load first\n            setTimeout(init, 200);\n        });\n    } else {\n        setTimeout(init, 200);\n    }\n}\n\nexport { ProjectDashboard };\n\n","/**\n * Cine Power Planner V2 - Project Detail View\n * =============================================\n * Handles the project detail view with tabs for Camera Package, \n * Power Summary, Requirements, and Gear List.\n */\n\n// Polyfill global for legacy code\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n\n// =====================\n// CONFIGURATION\n// =====================\n// =====================\n// CONFIGURATION\n// =====================\nconst VIEW_ID = 'view-project-detail';\nconst STORAGE_KEY = 'cameraPowerPlanner_setups';\nconst TABS = ['camera', 'power', 'requirements', 'kit'];\nconst DEFAULT_TAB = 'camera';\n\n// =====================\n// STATE\n// =====================\nlet currentProject = null;\nlet currentTab = DEFAULT_TAB;\nlet isInitialized = false;\nlet _cachedProjectData = null; // Cache for current project data\n\n// =====================\n// TAB MANAGEMENT\n// =====================\n\n/**\n * Switch to a specific tab\n */\nfunction switchTab(tabId) {\n  if (!TABS.includes(tabId)) {\n    console.warn(`[ProjectDetail] Invalid tab: ${tabId}`);\n    return;\n  }\n\n  currentTab = tabId;\n\n  // Update tab buttons\n  const tabBtns = document.querySelectorAll('#view-project-detail .v2-tab-btn');\n  tabBtns.forEach(btn => {\n    const isActive = btn.dataset.tab === tabId;\n    btn.classList.toggle('active', isActive);\n    btn.setAttribute('aria-selected', isActive ? 'true' : 'false');\n  });\n\n  // Update tab panes\n  const tabPanes = document.querySelectorAll('#view-project-detail .v2-tab-pane');\n  tabPanes.forEach(pane => {\n    const isActive = pane.id === `tab-${tabId}`;\n    pane.classList.toggle('active', isActive);\n    pane.hidden = !isActive;\n  });\n\n  // Dispatch event\n  document.dispatchEvent(new CustomEvent('v2:tabchange', {\n    detail: { tab: tabId, project: currentProject }\n  }));\n\n  if (tabId === 'power') {\n    // Slight delay to ensure visibility transitions finish if any\n    setTimeout(() => renderV2Diagram(), 10);\n  }\n}\n\n/**\n * Get current tab\n */\nfunction getCurrentTab() {\n  return currentTab;\n}\n\n// =====================\n// DATA HELPERS\n// =====================\n\n/**\n * Format a date for display\n */\nfunction formatDate(dateStr) {\n  if (!dateStr) return '';\n  try {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(undefined, {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    });\n  } catch (_e) {\n    void _e;\n    return '';\n  }\n}\n\n/**\n * Format a date range string \"YYYY-MM-DD to YYYY-MM-DD\"\n */\nfunction formatDateRange(rangeStr) {\n  if (!rangeStr || typeof rangeStr !== 'string') return '';\n  const parts = rangeStr.split(' to ');\n  if (parts.length === 1) return formatDate(parts[0]);\n  if (parts.length === 2) {\n    return `${formatDate(parts[0])} - ${formatDate(parts[1])}`;\n  }\n  return rangeStr;\n}\n\n/**\n * Translation Helper\n */\nfunction _t(path, params = {}) {\n  const lang = document.documentElement.lang || 'en';\n  let root = (window.texts && window.texts[lang]) ? window.texts[lang] : null;\n  if (!root && window.texts) root = window.texts['en'];\n\n  const resolve = (obj, p) => p.split('.').reduce((o, i) => o ? o[i] : null, obj);\n\n  let val = root ? resolve(root, path) : null;\n\n  if (!val && lang !== 'en' && window.texts && window.texts['en']) {\n    val = resolve(window.texts['en'], path);\n  }\n\n  if (!val) return path;\n\n  if (typeof val === 'string') {\n    for (const [k, v] of Object.entries(params)) {\n      val = val.replace(`{${k}}`, v);\n    }\n  }\n  return val;\n}\n\n/**\n * Get project data from storage\n */\n/**\n * Refresh the project data cache\n */\nfunction refreshProjectDataCache() {\n  try {\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (stored) {\n      _cachedProjectData = JSON.parse(stored);\n    } else {\n      _cachedProjectData = {};\n    }\n  } catch (e) {\n    console.error('[ProjectDetail] Failed to parse project data:', e);\n    _cachedProjectData = {};\n  }\n}\n\n/**\n * Get project data from storage (via cache)\n */\nfunction getProjectData(projectName) {\n  if (_cachedProjectData === null) {\n    refreshProjectDataCache();\n  }\n\n  if (_cachedProjectData && _cachedProjectData[projectName]) {\n    const project = _cachedProjectData[projectName];\n    return {\n      prepDays: project.prepDays || [],\n      shootingDays: project.shootingDays || [],\n      returnDays: project.returnDays || [],\n      status: project.status || (project.archived ? 'Archived' : 'Planning')\n    };\n  }\n\n  return { prepDays: [], shootingDays: [], returnDays: [], status: 'Planning' };\n}\n\n/**\n * Update project status\n */\n/**\n * Update project status\n */\nfunction updateProjectStatus(projectName, status) {\n  try {\n    // Ensure cache is fresh\n    refreshProjectDataCache();\n    const data = _cachedProjectData || {};\n\n    if (data && data[projectName]) {\n      data[projectName].status = status;\n\n      // Sync archived flag\n      if (status === 'Archived') {\n        data[projectName].archived = true;\n      } else {\n        data[projectName].archived = false;\n      }\n\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\n      // Update cache - strictly not needed as we modified the object in place, but safe\n      _cachedProjectData = data;\n\n      return true;\n    }\n  } catch (e) {\n    console.error('[ProjectDetail] Failed to update status:', e);\n  }\n  return false;\n}\n\n// =====================\n// PROJECT LOADING\n// =====================\n\n/**\n * Load project data into the detail view\n */\nfunction loadProject(projectName) {\n  if (!projectName) {\n    console.warn('[ProjectDetail] No project name provided');\n    return false;\n  }\n\n  // Force refresh cache to ensure we have the latest data from persistence\n  refreshProjectDataCache();\n\n  currentProject = projectName;\n\n  // Update project name in header\n  const nameElement = document.getElementById('v2ProjectName');\n  if (nameElement) {\n    nameElement.textContent = projectName;\n  }\n\n  // Load project via legacy shim\n  if (global.cineLegacyShim) {\n    global.cineLegacyShim.loadProject(projectName);\n  }\n\n  // Update Project Periods in Header\n  const projectData = getProjectData(projectName);\n  const periodsContainer = document.getElementById('v2ProjectPeriods');\n  const statusSelect = document.getElementById('v2ProjectStatus');\n\n  // Update Status Select\n  if (statusSelect) {\n    statusSelect.value = projectData.status;\n    updateStatusSelectStyle(statusSelect);\n\n    // Remove old listeners to prevent duplicates (cloning is a quick hack)\n    const newSelect = statusSelect.cloneNode(true);\n    statusSelect.parentNode.replaceChild(newSelect, statusSelect);\n\n    newSelect.addEventListener('change', (e) => {\n      const newStatus = e.target.value;\n      updateProjectStatus(projectName, newStatus);\n      updateStatusSelectStyle(newSelect);\n\n      // If archived, maybe we should warn or just do it?\n      // For now just do it.\n    });\n  }\n\n  if (periodsContainer) {\n    let html = '';\n\n    // Render all Prep dates\n    if (Array.isArray(projectData.prepDays)) {\n      projectData.prepDays.forEach(range => {\n        const fmt = formatDateRange(range);\n        if (fmt) html += `<span class=\"v2-header-badge prep\" title=\"Prep Dates: ${fmt}\"><span class=\"period-icon\"></span> ${fmt}</span>`;\n      });\n    }\n\n    // Render all Shoot dates\n    if (Array.isArray(projectData.shootingDays)) {\n      projectData.shootingDays.forEach(range => {\n        const fmt = formatDateRange(range);\n        if (fmt) html += `<span class=\"v2-header-badge shoot\" title=\"Shooting Dates: ${fmt}\"><span class=\"period-icon\"></span> ${fmt}</span>`;\n      });\n    }\n\n    // Render all Return dates\n    if (Array.isArray(projectData.returnDays)) {\n      projectData.returnDays.forEach(range => {\n        const fmt = formatDateRange(range);\n        if (fmt) html += `<span class=\"v2-header-badge return\" title=\"Return Dates: ${fmt}\"><span class=\"period-icon\"></span> ${fmt}</span>`;\n      });\n    }\n\n    periodsContainer.innerHTML = html;\n    periodsContainer.style.display = html ? 'flex' : 'none';\n  }\n\n  // No need to manually sync if we are reparenting the actual live elements\n  // But we might want to trigger a refresh just in case\n\n  console.log(`[ProjectDetail] Loaded project: ${projectName}`);\n  return true;\n}\n\n/**\n * Get current project name\n */\nfunction getCurrentProject() {\n  return currentProject;\n}\n\n// =====================\n// BACK NAVIGATION\n// =====================\n\n/**\n * Navigate back to projects dashboard\n */\nfunction goBack() {\n  if (global.cineViewManager) {\n    global.cineViewManager.showView('projects');\n  }\n}\n\n// =====================\n// VIEW RENDERING\n// =====================\n\n/**\n * Create the project detail view container if it doesn't exist\n */\nfunction createViewContainer() {\n  if (document.getElementById(VIEW_ID)) return document.getElementById(VIEW_ID);\n\n  const view = document.createElement('section');\n  view.id = VIEW_ID;\n  view.className = 'app-view';\n  // Initially hidden\n\n  const v2Main = document.querySelector('.v2-main');\n  if (v2Main) {\n    v2Main.appendChild(view);\n  }\n  return view;\n}\n\n/**\n * Create the project detail view HTML\n */\nfunction createDetailViewContent() {\n  const view = createViewContainer();\n  if (!view) return;\n\n  // ... rest of content generation ...\n\n  view.innerHTML = `\n      <header class=\"view-header view-header-with-back\">\n        <button type=\"button\" class=\"v2-back-btn\" id=\"v2BackToProjects\" aria-label=\"${_t('v2.detail.backButton')}\">\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M15 18l-6-6 6-6\"/>\n          </svg>\n          <span>${_t('v2.detail.backButton')}</span>\n        </button>\n        <h1 id=\"v2ProjectName\" class=\"view-header-title\">Project</h1>\n        <div class=\"v2-header-status\">\n            <select id=\"v2ProjectStatus\" class=\"v2-status-select\">\n                <option value=\"Draft\">${_t('v2.dashboard.status.draft')}</option>\n                <option value=\"Planning\">${_t('v2.dashboard.status.planning')}</option>\n                <option value=\"Waiting for Approval\">${_t('v2.dashboard.status.waitingForApproval')}</option>\n                <option value=\"Approved\">${_t('v2.dashboard.status.approved')}</option>\n                <option value=\"Shooting\">${_t('v2.dashboard.status.shooting')}</option>\n                <option value=\"Completed\">${_t('v2.dashboard.status.completed')}</option>\n                <option value=\"Archived\">${_t('v2.dashboard.status.archived')}</option>\n            </select>\n        </div>\n        <div id=\"v2ProjectPeriods\" class=\"v2-header-periods\" style=\"display: none;\"></div>\n        <div class=\"view-header-actions\">\n          <button type=\"button\" class=\"v2-btn v2-btn-ghost\" id=\"v2PrintProjectBtn\" title=\"${_t('v2.detail.header.print')}\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <polyline points=\"6 9 6 2 18 2 18 9\"></polyline>\n              <path d=\"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\"></path>\n              <rect x=\"6\" y=\"14\" width=\"12\" height=\"8\"></rect>\n            </svg>\n          </button>\n          <button type=\"button\" class=\"v2-btn v2-btn-ghost\" id=\"v2GenerateReqsGearBtn\" title=\"${_t('v2.detail.header.generateReqs')}\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n               <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n               <polyline points=\"14 2 14 8 20 8\"></polyline>\n               <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\n               <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\n               <line x1=\"10\" y1=\"9\" x2=\"8\" y2=\"9\"></line>\n            </svg>\n            <span class=\"v2-btn-label\">${_t('v2.detail.header.generateReqs')}</span>\n          </button>\n          <button type=\"button\" class=\"v2-btn v2-btn-ghost\" id=\"v2ExportProjectBtn\" title=\"${_t('v2.detail.header.export')}\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n               <path d=\"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8\"/>\n               <polyline points=\"16 6 12 2 8 6\"/>\n               <line x1=\"12\" y1=\"2\" x2=\"12\" y2=\"15\"/>\n            </svg>\n            <span class=\"v2-btn-label\">${_t('v2.detail.header.export')}</span>\n          </button>\n          <button type=\"button\" class=\"v2-btn v2-btn-ghost\" id=\"v2GenerateOverviewBtn\" title=\"${_t('v2.detail.header.generateOverview')}\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n               <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n               <polyline points=\"14 2 14 8 20 8\"></polyline>\n               <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\n               <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\n               <line x1=\"10\" y1=\"9\" x2=\"8\" y2=\"9\"></line>\n            </svg>\n            <span class=\"v2-btn-label\">${_t('v2.detail.header.generateOverview')}</span>\n          </button>\n          <button type=\"button\" class=\"v2-btn v2-btn-secondary\" id=\"v2SaveProjectBtn\">\n            ${_t('v2.detail.header.save')}\n          </button>\n        </div>\n      </header>\n\n\n      \n      <!-- Tab Navigation (Sticky Top) -->\n      <nav class=\"v2-tabs-nav\" role=\"tablist\" aria-label=\"Project sections\">\n        <button type=\"button\" class=\"v2-tab-btn active\" data-tab=\"camera\" role=\"tab\" aria-selected=\"true\" aria-controls=\"tab-camera\">\n          ${_t('v2.detail.tabs.cameraPackage')}\n        </button>\n        <button type=\"button\" class=\"v2-tab-btn\" data-tab=\"power\" role=\"tab\" aria-selected=\"false\" aria-controls=\"tab-power\">\n          ${_t('v2.detail.tabs.powerSummary')}\n        </button>\n        <button type=\"button\" class=\"v2-tab-btn\" data-tab=\"requirements\" role=\"tab\" aria-selected=\"false\" aria-controls=\"tab-requirements\">\n          ${_t('v2.detail.tabs.requirements')}\n        </button>\n        <button type=\"button\" class=\"v2-tab-btn\" data-tab=\"kit\" role=\"tab\" aria-selected=\"false\" aria-controls=\"tab-kit\">\n          ${_t('v2.detail.tabs.gearList')}\n        </button>\n      </nav>\n\n      <div class=\"view-content\">\n        <!-- Tab Content -->\n        <div class=\"v2-tab-content\" style=\"padding-top: var(--v2-space-lg);\">\n          <!-- Camera Package Tab -->\n          <section id=\"tab-camera\" class=\"v2-tab-pane active\" role=\"tabpanel\" aria-labelledby=\"tab-camera-btn\">\n            ${renderCameraPackageTab()}\n          </section>\n          \n          <!-- Power Summary Tab -->\n          <section id=\"tab-power\" class=\"v2-tab-pane\" role=\"tabpanel\" aria-labelledby=\"tab-power-btn\" hidden>\n            ${renderPowerSummaryTab()}\n          </section>\n          \n          <!-- Requirements Tab -->\n          <section id=\"tab-requirements\" class=\"v2-tab-pane\" role=\"tabpanel\" aria-labelledby=\"tab-requirements-btn\" hidden>\n            <div class=\"v2-card\">\n              <div class=\"v2-card-header\">\n                <h2>${_t('v2.detail.actions.projectRequirements')}</h2>\n                <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"v2GenerateRequirementsBtn\">\n                  ${_t('v2.detail.actions.generateRequirements')}\n                </button>\n              </div>\n              <div class=\"v2-card-body\" id=\"v2RequirementsContainer\">\n                <p class=\"v2-text-muted\">${_t('v2.detail.actions.generateRequirementsHelp')}</p>\n                <div data-reparent=\"projectForm\"></div>\n                <div id=\"v2RequirementsOutput\" class=\"v2-requirements-output\" style=\"margin-top: var(--v2-space-md);\"></div>\n              </div>\n            </div>\n          </section>\n          \n          <!-- Gear List Tab -->\n          <section id=\"tab-kit\" class=\"v2-tab-pane\" role=\"tabpanel\" aria-labelledby=\"tab-kit-btn\" hidden>\n            <div class=\"v2-card\">\n              <div class=\"v2-card-header\">\n                <h2>${_t('v2.detail.actions.gearList')}</h2>\n                <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"v2GenerateGearListBtn\">\n                  ${_t('v2.detail.actions.generateGearList')}\n                </button>\n              </div>\n              <div class=\"v2-card-body\" id=\"v2KitListContainer\">\n                <p class=\"v2-text-muted\">${_t('v2.detail.actions.generateGearListHelp')}</p>\n              </div>\n            </div>\n          </section>\n        </div>\n      </div>\n    `;\n\n  bindDetailViewEvents(view);\n\n  // Reparent legacy elements immediately\n  setTimeout(() => reparentLegacyElements(view), 0);\n}\n\n/**\n * Render Camera Package tab content\n * Note: We render *containers* for the legacy selects, not the selects themselves.\n */\nfunction renderCameraPackageTab() {\n  return `\n      <div id=\"v2-setup-config\" style=\"padding: 0; margin: 0;\">\n        <div class=\"form-row\">\n          <label for=\"cameraSelect\" id=\"cameraLabel\">Camera:</label>\n          <div data-reparent=\"cameraSelect\"></div>\n        </div>\n        \n        <div class=\"form-row\" id=\"monitorSelectRow\">\n          <label for=\"monitorSelect\" id=\"monitorLabel\">Monitor:</label>\n          <div data-reparent=\"monitorSelect\"></div>\n        </div>\n        \n        <div class=\"form-row\" id=\"wirelessVideoRow\">\n          <label for=\"videoSelect\" id=\"videoLabel\">Wireless Transmitter:</label>\n          <div data-reparent=\"videoSelect\"></div>\n        </div>\n\n        <fieldset id=\"fizFieldset\">\n          <legend id=\"fizLegend\">FIZ (Follow Focus) Systems</legend>\n          <div class=\"form-row\">\n            <label for=\"motor1Select\" id=\"fizMotorsLabel\">FIZ Motors:</label>\n            <div data-reparent=\"motor1Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"motor2Select\"></label>\n            <div data-reparent=\"motor2Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"motor3Select\"></label>\n            <div data-reparent=\"motor3Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"motor4Select\"></label>\n            <div data-reparent=\"motor4Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"controller1Select\" id=\"fizControllersLabel\">FIZ Controllers:</label>\n            <div data-reparent=\"controller1Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"controller2Select\"></label>\n            <div data-reparent=\"controller2Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"controller3Select\"></label>\n            <div data-reparent=\"controller3Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"controller4Select\"></label>\n            <div data-reparent=\"controller4Select\"></div>\n          </div>\n          <div class=\"form-row\">\n            <label for=\"distanceSelect\" id=\"distanceLabel\">Distance Sensor:</label>\n            <div data-reparent=\"distanceSelect\"></div>\n          </div>\n        </fieldset>\n\n        <div class=\"form-row\" id=\"batteryPlateRow\">\n          <label for=\"batteryPlateSelect\" id=\"batteryPlateLabel\">Battery Plate:</label>\n          <div data-reparent=\"batteryPlateSelect\"></div>\n        </div>\n\n        <div class=\"form-row\" id=\"batterySelectRow\">\n          <label for=\"batterySelect\" id=\"batteryLabel\">Battery:</label>\n          <div data-reparent=\"batterySelect\"></div>\n        </div>\n\n        <div class=\"form-row\" id=\"batteryHotswapRow\">\n          <label for=\"batteryHotswapSelect\" id=\"batteryHotswapLabel\">Battery Hotswap:</label>\n          <div data-reparent=\"batteryHotswapSelect\"></div>\n        </div>\n      </div>\n    `;\n}\n\n/**\n * Re-parent legacy elements into the V2 view\n */\nfunction reparentLegacyElements(view) {\n  const containers = view.querySelectorAll('[data-reparent]');\n  containers.forEach(container => {\n    const legacyId = container.dataset.reparent;\n    const legacyElement = document.getElementById(legacyId);\n\n    if (legacyElement) {\n      // Ensure it's visible (legacy might hide it)\n      // ONLY force display block for inputs/selects which are expected to be always visible in V2 forms.\n      // For dynamic containers (results), preserve their existing display state (handled by CSS/JS).\n      const tagName = legacyElement.tagName.toLowerCase();\n      if (['select', 'input', 'textarea'].includes(tagName)) {\n        legacyElement.style.display = 'block';\n        legacyElement.classList.add('v2-' + tagName); // Add v2-input class etc\n\n        // For inputs, we generally want 100% width in V2 forms\n        legacyElement.style.width = '100%';\n        legacyElement.style.height = '';\n        legacyElement.style.minHeight = '';\n      } else if (tagName === 'form') {\n        // Special handling for the project details form\n        legacyElement.style.display = 'block';\n        legacyElement.style.position = 'static'; // Reset modal positioning\n        legacyElement.style.visibility = 'visible';\n        legacyElement.style.width = '100%';\n        legacyElement.classList.add('v2-reparented-form');\n      } else {\n        // For divs, uls, etc., do NOT reset display or width blindly as it breaks flex layouts (hero card)\n        // Just ensure they aren't constrained by previous inline styles if reasonable, \n        // but 'display' should be left to CSS classes (.hidden handling).\n\n        // Optional: if we want to ensure full width container:\n        // legacyElement.style.width = '100%'; \n\n        // Check if it's one of the result elements? \n        // Actually, for results we want them to behave naturally.\n      }\n\n      legacyElement.style.whiteSpace = '';\n\n      // Check if the element has a wrapper (which holds the favorite button)\n\n      // Check if the element has a wrapper (which holds the favorite button)\n      const wrapper = legacyElement.closest('.select-wrapper');\n      const elementToMove = wrapper || legacyElement;\n\n      // Ensure wrapper also behaves if present\n      if (wrapper) {\n        wrapper.classList.add('v2-select-container'); // Helper class if needed in CSS\n        wrapper.style.width = '100%';\n      }\n\n      // Replace the placeholder container with the legitimate legacy wrapper/element\n      // This ensures the DOM structure matches V1 exactly: .form-row > .select-wrapper > select\n      container.parentNode.replaceChild(elementToMove, container);\n\n    } else {\n      console.warn(`[ProjectDetail] Legacy element not found: ${legacyId}`);\n      container.innerHTML = '<span class=\"v2-error-text\">Element missing</span>';\n    }\n  });\n}\n\n/**\n * Render Power Summary tab content  \n */\nfunction renderPowerSummaryTab() {\n  return `\n      <div class=\"v2-power-grid\">\n        <!-- V1 Results Reparented -->\n        <div id=\"v2-results-legacy-wrapper\" class=\"v2-results-reparented\">\n          <!-- Hero Card -->\n          <div data-reparent=\"heroCard\"></div>\n\n          <!-- Warnings -->\n          <div data-reparent=\"pinWarning\"></div>\n          <div data-reparent=\"dtapWarning\"></div>\n          <div data-reparent=\"hotswapWarning\"></div>\n\n          <!-- Breakdown List -->\n          <ul data-reparent=\"breakdownList\"></ul>\n\n          <!-- Power Diagram -->\n          <div data-reparent=\"powerDiagram\"></div>\n\n          <!-- Plain Summary -->\n          <div data-reparent=\"resultsPlainSummary\"></div>\n\n          <!-- Temperature Note -->\n          <div data-reparent=\"temperatureNote\"></div>\n          \n          <!-- Feedback Button -->\n          <div data-reparent=\"runtimeFeedbackBtn\"></div>\n          <div data-reparent=\"feedbackTableContainer\"></div>\n        </div>\n\n        <!-- Connection Diagram Card (V2 Wrapper) -->\n        <div class=\"v2-card v2-diagram-card\" style=\"margin-top: var(--v2-space-lg);\">\n          <div class=\"v2-card-header v2-card-header-with-actions\">\n            <h3>Connection Diagram</h3>\n            <div class=\"v2-diagram-toolbar\">\n               <button type=\"button\" class=\"v2-btn v2-btn-sm v2-btn-ghost\" id=\"v2ZoomOut\" title=\"${_t('v2.detail.diagram.zoomOut')}\">\n                 <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line></svg>\n               </button>\n               <button type=\"button\" class=\"v2-btn v2-btn-sm v2-btn-ghost\" id=\"v2ResetView\" title=\"${_t('v2.detail.diagram.resetView')}\">\n                 <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line></svg>\n               </button>\n               <button type=\"button\" class=\"v2-btn v2-btn-sm v2-btn-ghost\" id=\"v2ZoomIn\" title=\"${_t('v2.detail.diagram.zoomIn')}\">\n                 <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line></svg>\n               </button>\n               <div class=\"v2-vr\"></div>\n               <button type=\"button\" class=\"v2-btn v2-btn-sm v2-btn-ghost\" id=\"v2DownloadDiagram\" title=\"${_t('v2.detail.diagram.download')}\">\n                 <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"7 10 12 15 17 10\"></polyline><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line></svg>\n               </button>\n            </div>\n          </div>\n          <div class=\"v2-card-body v2-diagram-body\">\n            <div id=\"v2-diagram-area\" class=\"v2-diagram-area\"></div>\n            <div id=\"v2-diagram-legend\" class=\"v2-diagram-legend\"></div>\n            <!-- Hidden containers required by module -->\n            <div id=\"v2-diagram-hint\" style=\"display:none;\"></div>\n          </div>\n        </div>\n\n        <!-- Battery Comparison -->\n        <div class=\"v2-card\" style=\"margin-top: var(--v2-space-lg);\">\n          <div class=\"v2-card-body\" style=\"padding: 0;\">\n             <div data-reparent=\"batteryComparison\" class=\"v2-reparent-full-width\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n}\n\n/**\n * Bind events for the Detail View\n */\nfunction bindDetailViewEvents(view) {\n  // Back button\n  const backBtn = view.querySelector('#v2BackToProjects');\n  if (backBtn) {\n    backBtn.addEventListener('click', goBack);\n  }\n\n  // Print button\n  const printBtn = view.querySelector('#v2PrintProjectBtn');\n  if (printBtn) {\n    printBtn.addEventListener('click', () => {\n      // Intercept for Status Check\n      if (confirm('Do you want to set the project status to \"Waiting for Approval\"?')) {\n        updateProjectStatus(currentProject, 'Waiting for Approval');\n        const statusSelect = document.getElementById('v2ProjectStatus');\n        if (statusSelect) {\n          statusSelect.value = 'Waiting for Approval';\n          updateStatusSelectStyle(statusSelect);\n        }\n      }\n\n      console.log('[ProjectDetail] Triggering Print/Export');\n      if (typeof window.openLegacyPrintDialog === 'function') {\n        window.openLegacyPrintDialog();\n        return;\n      }\n\n      // Fallback\n      if (global.cineFeaturePrint && typeof global.cineFeaturePrint.triggerOverviewPrintWorkflow === 'function') {\n        global.cineFeaturePrint.triggerOverviewPrintWorkflow({}, { reason: 'export' });\n      } else if (typeof global.triggerOverviewPrintWorkflow === 'function') {\n        global.triggerOverviewPrintWorkflow({}, { reason: 'export' });\n      } else {\n        window.print();\n      }\n    });\n  }\n\n  // Save button\n  const saveBtn = view.querySelector('#v2SaveProjectBtn');\n  if (saveBtn) {\n    saveBtn.addEventListener('click', () => {\n      if (global.cineLegacyShim && currentProject) {\n        const legacySaveBtn = document.getElementById('saveSetupBtn');\n        if (legacySaveBtn) legacySaveBtn.click();\n      }\n    });\n  }\n\n\n\n  /**\n   * Helper to open the Requirements Form with synced dates\n   */\n  function openProjectRequirementsForm() {\n    if (!currentProject) return;\n\n    // 1. Get V2 Project Data\n    const v2Data = getProjectData(currentProject);\n\n    // 2. Get Legacy Info\n    let projectInfoForForm = {};\n    if (global.getCurrentProjectInfo && typeof global.getCurrentProjectInfo === 'function') {\n      projectInfoForForm = global.getCurrentProjectInfo();\n    } else {\n      // Fallback if global info not ready (shouldn't happen if project loaded)\n      projectInfoForForm = { projectName: currentProject };\n    }\n\n    // 3. Merge Dates\n    // We use Object.assign to create a fresh object with enforced V2 dates\n    const mergedInfo = Object.assign({}, projectInfoForForm, {\n      prepDays: v2Data.prepDays || [],\n      shootingDays: v2Data.shootingDays || [],\n      returnDays: v2Data.returnDays || [],\n      projectName: currentProject\n    });\n\n    // 4. Populate Form\n    if (global.populateProjectForm && typeof global.populateProjectForm === 'function') {\n      global.populateProjectForm(mergedInfo);\n    } else {\n      console.warn('[ProjectDetail] populateProjectForm not found');\n    }\n\n    // 5. Switch to Tab\n    switchTab('requirements');\n\n    // Scroll top\n    const tab = document.getElementById('tab-requirements');\n    if (tab) tab.scrollIntoView({ behavior: 'smooth' });\n  }\n\n  // Generate Requirements & Gear List Button (Header)\n  const headerReqsGearBtn = view.querySelector('#v2GenerateReqsGearBtn');\n  if (headerReqsGearBtn) {\n    headerReqsGearBtn.addEventListener('click', () => {\n      openProjectRequirementsForm();\n    });\n  }\n\n  // Export button (header icon)\n  const headerExportBtn = view.querySelector('#v2ExportProjectBtn');\n  if (headerExportBtn) {\n    headerExportBtn.addEventListener('click', () => {\n      const legacyExportBtn = document.getElementById('shareSetupBtn');\n      if (legacyExportBtn) legacyExportBtn.click();\n    });\n  }\n\n  // Generate Overview Button (action bar)\n  const headerOverviewBtn = view.querySelector('#v2GenerateOverviewBtn');\n  if (headerOverviewBtn) {\n    headerOverviewBtn.addEventListener('click', () => {\n      const legacyBtn = document.getElementById('generateOverviewBtn');\n      if (legacyBtn) legacyBtn.click();\n    });\n  }\n\n  // Requirements Tab \"Save & Generate\" Button\n  const requirementsTabSaveBtn = view.querySelector('#v2GenerateRequirementsBtn');\n  if (requirementsTabSaveBtn) {\n    requirementsTabSaveBtn.innerHTML = '<i class=\"fas fa-save\"></i> Save & Generate Gear List';\n    requirementsTabSaveBtn.addEventListener('click', () => {\n      // 1. Collect Form Data\n      let collectedFormData = {};\n      if (global.collectProjectFormData && typeof global.collectProjectFormData === 'function') {\n        collectedFormData = global.collectProjectFormData();\n      } else {\n        console.warn('[ProjectDetail] collectProjectFormData not found');\n      }\n\n      // 2. Update Global State\n      // Note: generateGearListHtml uses the passed argument, but we should also ensure app state is consistent if possible.\n      // But relying on formData passed to generator is the safest V1 patterns.\n\n      // 3. Generate Content\n      let generatedHtml = '';\n      if (global.generateGearListHtml && typeof global.generateGearListHtml === 'function') {\n        generatedHtml = global.generateGearListHtml(collectedFormData);\n      } else {\n        alert('Error: Generator module not found.');\n        return;\n      }\n\n      // 4. Split and Inject\n      if (global.getSafeGearListHtmlSections && typeof global.getSafeGearListHtmlSections === 'function') {\n        const gearHtmlSections = global.getSafeGearListHtmlSections(generatedHtml);\n\n\n        // Inject Project Requirements Output\n        const reqsContainer = document.getElementById('v2RequirementsOutput');\n        if (reqsContainer) {\n          if (gearHtmlSections.projectHtml) {\n            reqsContainer.innerHTML = gearHtmlSections.projectHtml;\n            reqsContainer.style.display = 'block';\n          } else {\n            reqsContainer.style.display = 'none';\n          }\n        }\n\n        // Inject Gear List\n        const kitContainer = document.getElementById('v2KitListContainer');\n        if (kitContainer && gearHtmlSections.gearHtml) {\n          kitContainer.innerHTML = gearHtmlSections.gearHtml;\n        } else if (kitContainer) {\n          kitContainer.innerHTML = '<p class=\"v2-text-muted\">No gear list items generated.</p>';\n        }\n\n        alert('Requirements Saved & Gear List Generated!');\n      }\n    });\n  }\n\n  // Gear List Tab \"Generate\" Button\n  const gearTabGenerateBtn = view.querySelector('#v2GenerateGearListBtn');\n  if (gearTabGenerateBtn) {\n    gearTabGenerateBtn.addEventListener('click', () => {\n      openProjectRequirementsForm();\n    });\n  }\n\n  // Tab buttons\n  const tabBtns = view.querySelectorAll('.v2-tab-btn');\n  tabBtns.forEach(btn => {\n    btn.addEventListener('click', () => {\n      const tabId = btn.dataset.tab;\n      switchTab(tabId);\n    });\n  });\n\n  // Download Diagram button\n  const downloadDiagramBtn = view.querySelector('#v2DownloadDiagram');\n  if (downloadDiagramBtn) {\n    downloadDiagramBtn.addEventListener('click', (e) => {\n      // Trigger the legacy download handler from app-session.js\n      const legacyBtn = document.getElementById('downloadDiagram');\n      if (legacyBtn) {\n        // Create a new event with the same shiftKey state for JPG export\n        const syntheticEvent = new MouseEvent('click', {\n          bubbles: true,\n          cancelable: true,\n          shiftKey: e.shiftKey\n        });\n        legacyBtn.dispatchEvent(syntheticEvent);\n      } else {\n        console.warn('[ProjectDetail] Legacy download button not found');\n      }\n    });\n  }\n\n\n  // Inject Add Custom Buttons\n  setTimeout(() => injectAddCustomButtons(view), 0);\n}\n\n// =====================\n// DIAGRAM RENDERING\n// =====================\n\n\n\n/**\n * Initialize and render the Connection Diagram in V2 container\n */\nfunction renderV2Diagram() {\n  if (!currentProject) return;\n\n  // Check if module is available\n  if (!global.cineFeaturesConnectionDiagram || typeof global.cineFeaturesConnectionDiagram.createConnectionDiagram !== 'function') {\n    console.warn('[ProjectDetail] Connection Diagram module not found.');\n    return;\n  }\n\n  const container = document.getElementById('v2-diagram-area');\n  if (!container) return; // Tab might be hidden or not rendered\n\n  console.log('[ProjectDetail] Rendering Power Diagram...');\n\n  // If we already have an instance, we might want to just let it update?\n  // The current module helper creates a new one every time, but handles cleanups internally if we re-call it?\n  // Actually createConnectionDiagram returns an object with { enableDiagramInteractions, ... }\n  // It clears the container.\n\n  // Ensure the legacy dialog elements are accessible in V2 mode\n  // Move them to the V2 container if they're currently hidden in mainContent\n  const ensureDialogAccessible = () => {\n    const dialog = document.getElementById('diagramDetailDialog');\n    if (dialog && dialog.closest('#mainContent')) {\n      // Move dialog to body so it's not hidden when mainContent is display:none\n      document.body.appendChild(dialog);\n    }\n    return dialog;\n  };\n\n  const context = {\n    // Override UI getters to point to V2 elements\n    getSetupDiagramContainer: () => document.getElementById('v2-diagram-area'),\n    getDiagramLegend: () => document.getElementById('v2-diagram-legend'),\n    getDiagramHint: () => document.getElementById('v2-diagram-hint'),\n    getDownloadDiagramBtn: () => document.getElementById('v2DownloadDiagram'),\n    getZoomInBtn: () => document.getElementById('v2ZoomIn'),\n    getZoomOutBtn: () => document.getElementById('v2ZoomOut'),\n    getResetViewBtn: () => document.getElementById('v2ResetView'),\n\n    // Explicit dialog getters to ensure accessibility in V2 mode\n    getDiagramDetailDialog: ensureDialogAccessible,\n    getDiagramDetailContent: () => document.getElementById('diagramDetailDialogContent'),\n\n    // Use existing global getters for data inputs (since we reparented the actual elements)\n    // The module defaults to GLOBAL_SCOPE.cameraSelect etc. which still works.\n  };\n\n  // Inject diagram CSS if needed\n  if (!document.getElementById('v2-diagram-css')) {\n    const css = (typeof global.cineFeaturesConnectionDiagram.getDiagramCss === 'function')\n      ? global.cineFeaturesConnectionDiagram.getDiagramCss(false)\n      : '';\n\n    if (css) {\n      const style = document.createElement('style');\n      style.id = 'v2-diagram-css';\n      style.textContent = css;\n      document.head.appendChild(style);\n    }\n  }\n\n  try {\n    global.cineFeaturesConnectionDiagram.createConnectionDiagram(context);\n  } catch (e) {\n    console.error('[ProjectDetail] Error rendering diagram:', e);\n  }\n}\n\n/**\n * Helper to update status select style\n */\nfunction updateStatusSelectStyle(selectElement) {\n  const status = selectElement.value;\n  const statusClass = status.toLowerCase().replace(/\\s+/g, '-');\n\n  // Remove all status classes\n  selectElement.classList.remove('draft', 'planning', 'waiting-for-approval', 'approved', 'shooting', 'completed', 'archived');\n\n  // Add current\n  selectElement.classList.add(statusClass);\n}\n\n// =====================\n// DATA SYNC\n// =====================\n\n/**\n * Sync legacy calculation results to V2 UI\n */\nfunction syncLegacyResultsToV2() {\n  // Legacy IDs: heroTotalDraw, heroRuntime, heroBatteryCount, heroCurrent144, heroCurrent12\n  // V2 IDs: v2TotalDraw, v2Runtime, v2BatteryCount, v2Current144, v2Current12\n\n  const map = {\n    'heroTotalDraw': 'v2TotalDraw',\n    'heroRuntime': 'v2Runtime',\n    'heroBatteryCount': 'v2BatteryCount',\n    'heroCurrent144': 'v2Current144',\n    'heroCurrent12': 'v2Current12'\n  };\n\n  Object.keys(map).forEach(legacyId => {\n    const legacyEl = document.getElementById(legacyId);\n    const v2El = document.getElementById(map[legacyId]);\n\n    if (legacyEl && v2El) {\n      v2El.textContent = legacyEl.textContent;\n    }\n  });\n\n  // Also refresh diagram if visible\n  if (getCurrentTab() === 'power') {\n    // Debounce slightly to allow legacy calculations to settle if they modify DOM attributes\n    setTimeout(() => renderV2Diagram(), 50);\n  }\n}\n\n/**\n * Setup observer to watch for legacy DOM changes (calculation updates)\n */\nfunction setupPowerObserver() {\n  // Note: We observe the results container, not a specific node.\n  // The observer callback doesn't need to inspect mutations, just re-sync.\n  const legacyResultContainer = document.getElementById('results');\n\n  if (!legacyResultContainer) {\n    console.warn('[ProjectDetail] Legacy results container not found. Auto-sync disabled.');\n    return;\n  }\n\n  const observer = new MutationObserver(() => {\n    syncLegacyResultsToV2();\n  });\n\n  observer.observe(legacyResultContainer, {\n    childList: true,\n    subtree: true,\n    characterData: true\n  });\n\n  console.log('[ProjectDetail] Power observer started');\n}\n\n// =====================\n// INITIALIZATION\n// =====================\n\n/**\n * Initialize module\n */\nfunction init() {\n  if (isInitialized) return;\n  isInitialized = true;\n\n  // Setup power observer\n  setupPowerObserver();\n\n  // [Added by Agent] Initial sync to capture state that existed before observer started\n  syncLegacyResultsToV2();\n\n  // Listen for view changes\n  document.addEventListener('v2:viewchange', handleViewChange);\n\n  // Check if we're already on projectDetail view (handles race condition on page refresh)\n  // ViewManager may have already dispatched the event before we attached our listener\n  if (global.cineViewManager && typeof global.cineViewManager.getCurrentView === 'function') {\n    const currentView = global.cineViewManager.getCurrentView();\n    if (currentView === 'projectDetail') {\n      const currentParams = global.cineViewManager.getCurrentParams ? global.cineViewManager.getCurrentParams() : {};\n      if (currentParams && currentParams.projectId) {\n        console.log('[ProjectDetail] Already on projectDetail, triggering render');\n        handleViewChange({ detail: { view: 'projectDetail', params: currentParams } });\n      }\n    }\n  }\n\n  console.log('[ProjectDetail] Initialized');\n}\n\n/**\n * Handle view change events\n */\nfunction handleViewChange(event) {\n  const { view, params } = event.detail || {};\n\n  if (view === 'projectDetail' && params && params.projectId) {\n    console.log('[ProjectDetail] View change detected, loading:', params.projectId);\n\n    // Get the view container\n    const viewElement = document.getElementById(VIEW_ID);\n    if (!viewElement) {\n      console.warn('[ProjectDetail] View element not found:', VIEW_ID);\n      return;\n    }\n\n    // Create content if not already created\n    // Note: createDetailViewContent() sets innerHTML directly, doesn't return a value\n    if (!viewElement.querySelector('.view-header')) {\n      createDetailViewContent();\n    }\n\n    // Load the project\n    loadProject(params.projectId);\n\n    // Switch to the requested tab if provided\n    if (params.tab) {\n      switchTab(params.tab);\n    }\n\n    // Handle specific actions (e.g. print)\n    if (params.action === 'print') {\n      console.log('[ProjectDetail] Auto-triggering print workflow');\n      setTimeout(() => {\n        if (global.cineFeaturePrint && typeof global.cineFeaturePrint.triggerOverviewPrintWorkflow === 'function') {\n          global.cineFeaturePrint.triggerOverviewPrintWorkflow({}, { reason: 'export' });\n        } else if (typeof global.triggerOverviewPrintWorkflow === 'function') {\n          global.triggerOverviewPrintWorkflow({}, { reason: 'export' });\n        } else {\n          window.print();\n        }\n      }, 800); // Wait for transitions/render\n    }\n  }\n}\n\n// =====================\n// LEGACY MODAL INTEGRATION\n// =====================\n\n/**\n * Slugify a string (matching legacy logic)\n */\nfunction slugify(text) {\n  if (typeof text !== 'string') return '';\n  return text.trim().toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+/, '')\n    .replace(/-+$/, '');\n}\n\n/**\n * Trigger the legacy \"Add Custom Item\" dialog for a specific category\n */\nfunction triggerLegacyAddCustom(translationKey) {\n  // 1. Get localized label\n  const localizedLabel = global.texts ? global.texts[translationKey] : null;\n  if (!localizedLabel) {\n    console.warn(`[ProjectDetail] Translation key not found: ${translationKey}`);\n    return;\n  }\n\n  // 2. Generate slug\n  const slug = slugify(localizedLabel);\n  console.log(`[ProjectDetail] Triggering Add Custom for: ${localizedLabel} (${slug})`);\n\n  // 3. Find the legacy button\n  // The legacy button is in the hidden #gearListOutput table\n  const legacyBtn = document.querySelector(`[data-gear-custom-add=\"${slug}\"]`);\n\n  if (legacyBtn) {\n    legacyBtn.click();\n  } else {\n    console.warn(`[ProjectDetail] Legacy Add Button not found for slug: ${slug}`);\n    // Fallback: If the row doesn't exist yet (empty category), we might need to find the \"Add Custom Item\"\n    // button in a different way or force the category to appear.\n    // However, usually \"Add Custom\" buttons are always present in the legacy view if the category is valid.\n    alert(`Could not open Add Custom dialog for ${localizedLabel}. Legacy element missing.`);\n  }\n}\n\n/**\n * Inject \"+\" buttons into V2 cards\n */\nfunction injectAddCustomButtons(view) {\n  // Definition of where to inject buttons and mapped categories\n  const targets = [\n    { cardId: 'v2-camera-card', key: 'category_cameras' },\n    { cardId: 'v2-power-card', key: 'category_batteries' },\n    // Add more as needed:\n    // { cardId: 'v2-monitor-card', key: 'category_monitors' },\n    // { cardId: 'v2-wireless-card', key: 'category_video' }\n  ];\n\n  targets.forEach(({ cardId, key }) => {\n    const card = view.querySelector(`#${cardId}`);\n    if (!card) return;\n\n    const header = card.querySelector('.v2-card-header');\n    if (!header) return;\n\n    // Prevent duplicate injection\n    if (header.querySelector('.v2-add-custom-btn')) return;\n\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'v2-btn v2-btn-sm v2-btn-ghost v2-add-custom-btn';\n    btn.title = 'Add Custom Item';\n    btn.innerHTML = `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\n          <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\n        </svg>\n      `;\n\n    btn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      triggerLegacyAddCustom(key);\n    });\n\n    header.appendChild(btn);\n  });\n}\n\n// =====================\n// EXPORTS\n// =====================\n\n// Define the ProjectDetail API object\nconst ProjectDetail = {\n  init,\n  createDetailViewContent,\n  loadProject,\n  getCurrentProject,\n  switchTab,\n  getCurrentTab,\n  syncLegacyResultsToV2\n};\n\n// Expose to global scope for legacy compatibility\nif (typeof global !== 'undefined') {\n  global.cineProjectDetail = ProjectDetail;\n}\n\nif (typeof window !== 'undefined') {\n  window.cineProjectDetail = ProjectDetail;\n}\n\n// ESM export\nexport { ProjectDetail };\n","/**\n * Cine Power Planner V2 - Sidebar Logic\n * =====================================\n * Handles sidebar interactions, specifically search functionality\n * and theme toggles (bridging to legacy app).\n */\n\n// Polyfill global for legacy code\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n\nconst SEARCH_CONTAINER_CLASS = 'v2-sidebar-search';\nconst SEARCH_INPUT_ID = 'v2SidebarSearchInput';\n\n// Theme Constants\nconst DARK_MODE_KEY = 'darkMode';\nconst PINK_MODE_KEY = 'cameraPowerPlanner_pinkMode';\nconst FALLBACK_PINK_KEY = 'pinkMode';\n\nconst TEXT_TO_KEY_MAP = {\n    'All Projects': 'v2.sidebar.nav.allProjects',\n    'Active Projects': 'v2.sidebar.nav.activeProjects',\n    'Archive': 'v2.sidebar.nav.archive',\n    'Auto Backups': 'v2.sidebar.nav.autoBackups',\n    'Device Library': 'v2.sidebar.nav.deviceLibrary',\n    'Contacts': 'v2.sidebar.nav.contacts',\n    'Auto Gear Rules': 'v2.sidebar.nav.autoGearRules',\n    'Owned Gear': 'v2.sidebar.nav.ownedGear',\n    'Create New Project': 'v2.sidebar.nav.createProject',\n    'Projects': 'v2.sidebar.nav.projectsSection',\n    'Tools': 'v2.sidebar.nav.toolsSection',\n    'Support': 'v2.sidebar.nav.supportSection',\n    'Help': 'v2.sidebar.nav.help',\n    'Settings': 'v2.sidebar.nav.settings'\n};\n\n/**\n * Translation Helper\n */\nfunction _t(path, params = {}, lang = null) {\n    const currentLang = lang || document.documentElement.lang || 'en';\n    let root = (window.texts && window.texts[currentLang]) ? window.texts[currentLang] : null;\n    if (!root && window.texts) root = window.texts['en'];\n\n    // Simple resolve\n    const resolve = (obj, p) => p.split('.').reduce((o, i) => o ? o[i] : null, obj);\n\n    let val = root ? resolve(root, path) : null;\n\n    // Fallback to English if missing in current lang\n    if (!val && currentLang !== 'en' && window.texts && window.texts['en']) {\n        val = resolve(window.texts['en'], path);\n    }\n\n    if (!val) return path;\n\n    if (typeof val === 'string') {\n        for (const [k, v] of Object.entries(params)) {\n            val = val.replace(`{${k}}`, v);\n        }\n    }\n    return val;\n}\n\nfunction initSidebar() {\n    console.log('[V2 Sidebar] Initializing...');\n\n    // 1. Get Main Sidebar Container [FIXED SELECTOR]\n    // In index.html, the container is <nav class=\"v2-sidebar\">\n    const sidebar = document.querySelector('.v2-sidebar');\n    if (!sidebar) {\n        console.error('[V2 Sidebar] .v2-sidebar not found. Cannot inject controls.');\n        return;\n    }\n\n    // 2. Inject Components in Order\n    // A. Header (Already in HTML usually, but check)\n    injectSidebarHeader(sidebar);\n\n    // B. Top Controls (Rows 1 & 2)\n    injectTopControls(sidebar);\n\n    // C. Search\n    injectSearchInput(sidebar);\n    setupLegacySearchProxy(); // STRICT V1 Proxy\n\n    // 3. Initialize Logic\n    initThemes();\n    initNavigationLogic();\n    initMobileToggle(); // [New] Mobile Toggle\n    forceHelpCloseBinding();\n    interceptLegacyHelp(); // [New] Redirect Legacy Help\n\n    // 4. Initial Translation\n    const legacySelect = document.getElementById('languageSelect');\n    if (legacySelect) {\n        updateSidebarTranslations(legacySelect.value);\n    }\n}\n\nfunction injectSidebarHeader(container) {\n    if (container.querySelector('.v2-sidebar-header')) return;\n\n    const header = document.createElement('div');\n    header.className = 'v2-sidebar-header';\n\n    const logo = document.createElement('img');\n    logo.src = 'src/icons/Icon Bluenew.svg';\n    logo.className = 'v2-sidebar-logo';\n    logo.alt = 'Logo';\n\n    const title = document.createElement('h1'); // V2 uses h1 in HTML now\n    title.className = 'v2-sidebar-title';\n    title.innerHTML = 'Cine Power<br>Planner';\n\n    header.appendChild(logo);\n    header.appendChild(title);\n\n    // Insert at very top\n    container.insertBefore(header, container.firstChild);\n}\n\n/**\n * [Fix] Inject Top Controls in Single Row\n * All controls in one row: Language Selector + Theme Toggles + Hard Refresh\n */\n/**\n * [Refactor] Inject Controls at Bottom (Above Footer)\n * Language Selector + Theme Toggles + Hard Refresh\n */\nfunction injectTopControls(container) {\n    if (container.querySelector('.v2-sidebar-controls-container')) return;\n\n    const controlsContainer = document.createElement('div');\n    controlsContainer.className = 'v2-sidebar-controls-container';\n    // Add some padding/border if needed via CSS, or rely on existing styles\n    // controlsContainer.style.borderTop = '1px solid var(--v2-border-default)'; // Optional separation\n\n    // Single Row with all controls\n    const row1 = document.createElement('div');\n    row1.className = 'v2-controls-row-1';\n    injectLanguageSelector(row1); // Language Dropdown first\n    injectThemeControls(row1);    // Theme Buttons\n    injectHardRefresh(row1);      // Refresh Button\n\n    // Assemble (single row)\n    controlsContainer.appendChild(row1);\n\n    // Insert at bottom: Before Footer\n    const footer = container.querySelector('.v2-sidebar-footer');\n    if (footer) {\n        footer.insertAdjacentElement('beforebegin', controlsContainer);\n    } else {\n        // Fallback: append to end\n        container.appendChild(controlsContainer);\n    }\n}\n\n/**\n * [Fix 1.8] STRICT V1 Search Proxy\n *\n * DEEP DIVE: The \"Legacy Proxy\" Pattern\n *\n * The V2 Search Bar is a \"dumb\" UI component. It does NOT contain search logic itself.\n * Instead, it acts as a remote control for the invisible Legacy Search Input (#featureSearch).\n *\n * Why?\n * The legacy app uses a complex `fuse.js` implementation tightly coupled to the DOM of the\n * hidden V1 table. Rewriting that logic immediately would risk breaking the core tool.\n *\n * Mechanism:\n * 1. EVENT MIRRORING: Typing in V2 -> triggers 'input' event on V1 input.\n * 2. KEY FORWARDING: Arrow keys in V2 -> dispatched to V1 to navigate the dropdown results.\n * 3. FOCUS SYNC: Focusing V2 -> Focuses V1 (to trigger the library dropdown).\n *\n * This allows us to ship a modern UI *today* without rewriting the search engine *yesterday*.\n */\nfunction setupLegacySearchProxy() {\n    const input = document.getElementById(SEARCH_INPUT_ID);\n    const legacyInput = document.getElementById('featureSearch');\n    if (!input || !legacyInput) return;\n\n    // Sync Input: V2 -> Legacy\n    input.addEventListener('input', (e) => {\n        e.stopPropagation(); // Stop 'h'/'?' interference\n        legacyInput.value = e.target.value;\n        legacyInput.dispatchEvent(new Event('input', { bubbles: true }));\n        legacyInput.dispatchEvent(new Event('change', { bubbles: true })); // Ensure listeners fire\n    });\n\n    // Sync Focus: V2 -> Legacy (Opens Dropdown)\n    input.addEventListener('focus', () => {\n        legacyInput.dispatchEvent(new Event('focus', { bubbles: true }));\n    });\n\n    // Sync Blur\n    input.addEventListener('blur', () => {\n        // Small delay to allow clicks on dropdown\n        setTimeout(() => {\n            legacyInput.dispatchEvent(new Event('blur', { bubbles: true }));\n        }, 200);\n    });\n\n    // Sync Keys (Arrows, Enter, Escape)\n    input.addEventListener('keydown', (e) => {\n        // Stop 'h' or '?' from triggering global Help IF typing\n        e.stopPropagation();\n\n        // LIMIT FORWARDING to Navigation Keys only\n        const allowedKeys = ['ArrowUp', 'ArrowDown', 'Enter', 'Escape'];\n        if (!allowedKeys.includes(e.key)) return;\n\n        // Forward keys to legacy input for navigation\n        const keyEvent = new KeyboardEvent('keydown', {\n            key: e.key,\n            code: e.code,\n            keyCode: e.keyCode,\n            bubbles: true,\n            cancelable: true\n        });\n        legacyInput.dispatchEvent(keyEvent);\n    });\n\n    // [New] Dispatch V2 Search Event for Dashboard\n    input.addEventListener('input', (e) => {\n        const query = e.target.value.trim();\n        window.dispatchEvent(new CustomEvent('v2:search', {\n            detail: { query }\n        }));\n    });\n}\n\nfunction injectSearchInput(container) {\n    // Find insert point: After Controls\n    // const controls = container.querySelector('.v2-sidebar-controls-container');\n\n    // Check if already exists\n    if (container.querySelector(`.${SEARCH_CONTAINER_CLASS}`)) return;\n\n    const searchContainer = document.createElement('div');\n    searchContainer.className = SEARCH_CONTAINER_CLASS;\n    searchContainer.innerHTML = `\n            <div class=\"v2-search-input-wrapper\">\n                <svg class=\"v2-search-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <path d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n                <input type=\"text\" id=\"${SEARCH_INPUT_ID}\" class=\"v2-search-input\" placeholder=\"${_t('v2.sidebar.search.placeholder')}\" aria-label=\"Search features\">\n            </div>\n        `;\n\n    // Insert after Header (Top), independent of controls\n    const header = container.querySelector('.v2-sidebar-header');\n    if (header) {\n        header.insertAdjacentElement('afterend', searchContainer);\n    } else {\n        // Fallback\n        const nav = container.querySelector('.v2-sidebar-nav');\n        if (nav) {\n            container.insertBefore(searchContainer, nav);\n        } else {\n            container.insertBefore(searchContainer, container.firstChild);\n        }\n    }\n\n    // [Fix 1.1] Move Legacy Dropdown Here\n    setTimeout(() => {\n        const legacyDropdown = document.getElementById('featureSearchDropdown');\n        const wrapper = searchContainer.querySelector('.v2-search-input-wrapper');\n        if (legacyDropdown && wrapper) {\n            wrapper.appendChild(legacyDropdown);\n            // Reset styles\n            legacyDropdown.style.top = '110%';\n            legacyDropdown.style.left = '0';\n            legacyDropdown.style.visibility = 'visible';\n            legacyDropdown.style.display = 'none'; // Initially hidden\n        }\n    }, 1000);\n}\n\n/**\n * [Fix 1.9] Force Help Close Button Binding\n * Binds a global click listener to intercept the close button\n */\nfunction forceHelpCloseBinding() {\n    document.addEventListener('click', (e) => {\n        // Check for the close button specifically or its connection to the help dialog\n        const btn = e.target.closest('#closeHelp');\n\n        if (btn) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            closeHelpModal();\n        }\n    });\n}\n\nfunction closeHelpModal() {\n    const helpDialog = document.getElementById('helpDialog');\n    if (helpDialog) {\n        helpDialog.setAttribute('hidden', '');\n        helpDialog.style.display = 'none';\n        // Also try legacy global function\n        if (typeof global.closeDialog === 'function') {\n            global.closeDialog(helpDialog);\n        }\n    }\n}\n\n/**\n * [New] Intercept Legacy Help Triggers\n * Redirects legacy help button and shortcuts to V2 Help\n */\nfunction interceptLegacyHelp() {\n    // 1. Header Button\n    const helpBtn = document.getElementById('helpButton');\n    // 2. Sidebar Button\n    const v1HelpNav = document.querySelector('[data-nav-key=\"openHelpNav\"]');\n\n    const redirect = (e) => {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n        window.location.hash = '/help';\n    };\n\n    if (helpBtn) {\n        helpBtn.addEventListener('click', redirect);\n    }\n\n    if (v1HelpNav) {\n        v1HelpNav.addEventListener('click', redirect);\n    }\n\n    // 3. Global Keyboard Shortcuts\n    document.addEventListener('keydown', (e) => {\n        // Ignore if in input\n        if (e.target.matches('input, textarea, [contenteditable]')) return;\n\n        // Shift+? or H or F1\n        if ((e.key === '?' && e.shiftKey) || e.key === 'H' || e.key === 'h' || e.key === 'F1') {\n            redirect(e);\n        }\n        // Ctrl+/ (Cmd+/)\n        if (e.key === '/' && (e.ctrlKey || e.metaKey)) {\n            redirect(e);\n        }\n    }, true); // Capture phase to beat legacy listeners\n}\n\n/**\n * [Fix 1.8] Navigation Logic\n *\n * DEEP DIVE: Navigation State Management\n *\n * This section handles the visual state of the sidebar to match the application routing.\n *\n * KEY CONCEPTS:\n * 1. URL SYNC: On load, it checks `window.location.hash` and highlights the matching link.\n * 2. EXCLUSIVITY: Only one link can be '.active' at a time.\n * 3. FEATURE FLAGS:\n *    - 'Auto Backups' is hidden unless `cineAutoRecover` is true in options.\n *    - This prevents feature pollution for users who haven't opted into unstable recoveries.\n */\nfunction initNavigationLogic() {\n    // Toggle Auto Backups link based on settings\n    const backupLink = document.getElementById('navAutoBackups');\n    if (backupLink) {\n        const autoRecover = localStorage.getItem('cineAutoRecover') === 'true';\n        backupLink.style.display = autoRecover ? 'flex' : 'none';\n    }\n\n    const navLinks = document.querySelectorAll('.v2-sidebar-nav .v2-sidebar-link');\n    navLinks.forEach(link => {\n        link.addEventListener('click', () => {\n            navLinks.forEach(l => l.classList.remove('active'));\n            link.classList.add('active');\n        });\n    });\n\n    // Set initial active state\n    const hash = window.location.hash;\n    if (hash) {\n        navLinks.forEach(link => {\n            if (link.getAttribute('href') === hash) {\n                link.classList.add('active');\n            }\n        });\n    }\n}\n\n/**\n * [New] Mobile Sidebar Toggle\n * Handles opening/closing sidebar on mobile\n */\nfunction initMobileToggle() {\n    const triggers = document.querySelectorAll('.v2-mobile-menu-toggle');\n    const app = document.getElementById('v2-app');\n    const overlay = document.querySelector('.v2-sidebar-overlay');\n\n\n    if (!app) return;\n\n    function openSidebar() {\n        app.classList.add('sidebar-open');\n    }\n\n    function closeSidebar() {\n        app.classList.remove('sidebar-open');\n    }\n\n    // 1. Bind Triggers (Hamburger Buttons)\n    triggers.forEach(btn => {\n        btn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            openSidebar();\n        });\n    });\n\n    // 2. Bind Overlay (Close on click)\n    if (overlay) {\n        overlay.addEventListener('click', closeSidebar);\n    }\n\n    // 3. Close on Navigation\n    // When a nav link is clicked (and we are on mobile), close sidebar\n    const navLinks = document.querySelectorAll('.v2-sidebar-nav .v2-sidebar-link');\n    navLinks.forEach(link => {\n        link.addEventListener('click', () => {\n            // Determine if we are on mobile (check if overlay is visible or check window width)\n            if (window.innerWidth <= 768) {\n                closeSidebar();\n            }\n        });\n    });\n\n    // 4. Close on Exit V2\n    const exitBtn = document.getElementById('v2ExitBtn');\n    if (exitBtn) {\n        exitBtn.addEventListener('click', closeSidebar);\n    }\n}\n\n// =====================\n// CONTROLS INJECTION\n// =====================\n\nfunction injectLanguageSelector(container) {\n    if (!container || container.querySelector('.v2-lang-select-wrapper')) return;\n\n    const legacySelect = document.getElementById('languageSelect');\n    const currentLang = legacySelect ? legacySelect.value : 'en';\n\n    const wrapper = document.createElement('div');\n    wrapper.className = 'v2-lang-select-wrapper';\n\n    // Full language names as requested\n    wrapper.innerHTML = `\n            <select class=\"v2-lang-select\" aria-label=\"Select Language\">\n                <option value=\"en\" ${currentLang === 'en' ? 'selected' : ''}>English</option>\n                <option value=\"de\" ${currentLang === 'de' ? 'selected' : ''}>Deutsch</option>\n                <option value=\"es\" ${currentLang === 'es' ? 'selected' : ''}>Espaol</option>\n                <option value=\"fr\" ${currentLang === 'fr' ? 'selected' : ''}>Franais</option>\n                <option value=\"it\" ${currentLang === 'it' ? 'selected' : ''}>Italiano</option>\n            </select>\n        `;\n\n    const select = wrapper.querySelector('select');\n    select.addEventListener('change', (e) => {\n        const newVal = e.target.value;\n        if (legacySelect) {\n            legacySelect.value = newVal;\n            legacySelect.dispatchEvent(new Event('change', { bubbles: true }));\n\n            if (typeof global.updateLanguage === 'function') {\n                global.updateLanguage(newVal);\n            }\n            updateSidebarTranslations(newVal);\n        }\n    });\n\n    // Sync back from legacy\n    if (legacySelect) {\n        legacySelect.addEventListener('change', () => {\n            if (select.value !== legacySelect.value) {\n                select.value = legacySelect.value;\n                updateSidebarTranslations(legacySelect.value);\n            }\n        });\n    }\n\n    container.appendChild(wrapper);\n}\n\nfunction injectHardRefresh(container) {\n    if (container.querySelector('#v2RefreshBtn')) return;\n\n    const btn = document.createElement('button');\n    btn.className = 'v2-tool-btn';\n    btn.id = 'v2RefreshBtn';\n    btn.title = 'Force reload';\n    btn.setAttribute('aria-label', 'Force reload');\n    btn.innerHTML = `\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n                <polyline points=\"23 4 23 10 17 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n                <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n            </svg>\n        `;\n\n    btn.addEventListener('click', () => {\n        const legacyBtn = document.getElementById('reloadButton');\n        if (legacyBtn) {\n            legacyBtn.click();\n        } else {\n            window.location.reload(true);\n        }\n    });\n\n    container.appendChild(btn);\n}\n\n// Note: injectDatabaseToggle was removed - device database is now\n// accessed via the Device Library view in the V2 sidebar navigation.\n\n/**\n * [New] Sidebar Translations\n * Updates sidebar text based on current language\n */\n/**\n * [New] Sidebar Translations\n * Updates sidebar text based on current language\n */\nfunction updateSidebarTranslations(lang) {\n    // Update Nav Links\n    const textElements = document.querySelectorAll('.v2-sidebar-link-text, .v2-sidebar-section-title');\n\n    textElements.forEach(el => {\n        if (!el.dataset.key) el.dataset.key = el.textContent.trim();\n        const originalText = el.dataset.key; // e.g. \"Settings\" or \"All Projects\"\n\n        const translationKey = TEXT_TO_KEY_MAP[originalText];\n        if (translationKey) {\n            el.textContent = _t(translationKey, {}, lang);\n        }\n    });\n\n    // Update Search Placeholder\n    const searchInput = document.getElementById(SEARCH_INPUT_ID);\n    if (searchInput) {\n        searchInput.placeholder = _t('v2.sidebar.search.placeholder', {}, lang);\n    }\n}\n\n// Expose for external calls\nglobal.updateSidebarTranslations = updateSidebarTranslations;\n\n// =====================\n// THEME HANDLING\n// =====================\n\nfunction initThemes() {\n    // Theme controls are injected via injectTopControls -> injectThemeControls\n    applyStoredThemes();\n}\n\nfunction injectThemeControls(container) {\n    // Prevent duplicate injection\n    if (container.querySelector('#v2ThemeToggleDark')) return;\n\n    // Dark Mode Toggle - V1 Style\n    const darkBtn = document.createElement('button');\n    darkBtn.className = 'v2-theme-toggle';\n    darkBtn.id = 'v2ThemeToggleDark';\n    darkBtn.setAttribute('aria-label', 'Toggle dark mode');\n    darkBtn.setAttribute('aria-pressed', 'false');\n    darkBtn.setAttribute('title', 'Toggle dark mode');\n    // Use V1 uicons glyphs for Moon and Sun\n    darkBtn.innerHTML = `\n            <span class=\"v2-icon-moon icon-glyph\" aria-hidden=\"true\" data-icon-font=\"uicons\">&#xEC7E;</span>\n            <span class=\"v2-icon-sun icon-glyph\" aria-hidden=\"true\" data-icon-font=\"uicons\" style=\"display:none\">&#xF1FE;</span>\n        `;\n    darkBtn.addEventListener('click', toggleDarkMode);\n\n    // Pink Mode Toggle - V1 Style with Capybara SVG\n    const pinkBtn = document.createElement('button');\n    pinkBtn.className = 'v2-theme-toggle';\n    pinkBtn.id = 'v2ThemeTogglePink';\n    pinkBtn.setAttribute('aria-label', 'Toggle pink mode');\n    pinkBtn.setAttribute('aria-pressed', 'false');\n    pinkBtn.setAttribute('title', 'Toggle pink mode');\n    pinkBtn.setAttribute('data-theme', 'pink');\n    // V1 Capybara SVG\n    pinkBtn.innerHTML = `\n            <span class=\"icon-glyph icon-svg pink-mode-icon\" aria-hidden=\"true\">\n                <svg viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\">\n                    <path d=\"m1 40c0-8 3-17 3-17a4.84 4.84 0 0 0-1.829-3.064 1 1 0 0 1 .45-1.716 19.438 19.438 0 0 1 4.379-.22c.579-2.317-1.19-3.963-2.782-4.938a1 1 0 0 1 .393-1.85 14.128 14.128 0 0 1 6.389.788c0-.958-1.147-2.145-2.342-3.122a1 1 0 0 1 .708-1.773 40.655 40.655 0 0 1 6.634.895 3.723 3.723 0 0 0-1.049-2.264 1 1 0 0 1 .823-1.652c6.151.378 9.226 1.916 9.226 1.916l10-1s8.472-2.311 15.954.5a1 1 0 0 1-.084 1.9c-1.455.394-2.87 1.143-2.87 2.6 0 0 4.426.738 5.675 4.114a1 1 0 0 1-1.228 1.317c-1.64-.48-4.273-.88-6.447.569Z\" fill=\"#805333\" />\n                    <path d=\"m30.18 42.82c1.073 2.7 2.6 9.993 3.357 13.8a2 2 0 0 1-1.964 2.38h-28.573a2 2 0 0 1-2-2v-18c0-2.55 10.03-22.11 23.99-23.87Z\" fill=\"#a56a43\" />\n                    <path d=\"m55.67 48.46-6.34 2.97a6 6 0 0 1-7.98-2.88l-.25-.54-.76-1.6a4.956 4.956 0 0 0-4.68-2.87c-.22.01-.44.02-.66.02a16.019 16.019 0 0 1-8.28-29.66c-1.81-2.97-3.45-8.03 2.03-12.49a2.1 2.1 0 0 1 2.5 0c4.23 3.45 4.21 7.25 3.16 10.17a16 16 0 0 1 15.91 11.36l5.31 11.31 2.92 6.22a6.008 6.008 0 0 1-2.88 7.99Z\" fill=\"#cb8252\" />\n                    <circle cx=\"42\" cy=\"26\" r=\"3\" fill=\"#2c2f38\" />\n                    <circle cx=\"54\" cy=\"43\" r=\"1\" fill=\"#805333\" />\n                    <path d=\"m58.55 40.47-2.92-6.22-14.53 13.76.25.54a6 6 0 0 0 7.98 2.88l6.34-2.97a6.008 6.008 0 0 0 2.88-7.99Zm-4.55 3.53a1 1 0 1 1 1-1 1 1 0 0 1-1 1Z\" fill=\"#cf976a\" />\n                    <circle cx=\"41\" cy=\"25\" r=\"1.25\" fill=\"#ecf0f1\" />\n                </svg>\n            </span>\n        `;\n    pinkBtn.addEventListener('click', togglePinkMode);\n\n    container.appendChild(darkBtn);\n    container.appendChild(pinkBtn);\n}\n\nfunction applyStoredThemes() {\n    const isDark = localStorage.getItem(DARK_MODE_KEY) === 'true';\n    updateDarkModeDisplay(isDark);\n    const isPink = localStorage.getItem(PINK_MODE_KEY) === 'true';\n    updatePinkModeDisplay(isPink);\n}\n\nfunction toggleDarkMode() {\n    const isDark = document.body.classList.contains('dark-mode');\n    const newState = !isDark;\n    updateDarkModeDisplay(newState);\n    localStorage.setItem(DARK_MODE_KEY, newState);\n}\n\nfunction updateDarkModeDisplay(enabled) {\n    document.body.classList.toggle('dark-mode', enabled);\n    document.body.classList.toggle('light-mode', !enabled);\n    const btn = document.getElementById('v2ThemeToggleDark');\n    if (btn) {\n        btn.classList.toggle('active', enabled);\n        const moon = btn.querySelector('.v2-icon-moon');\n        const sun = btn.querySelector('.v2-icon-sun');\n        if (moon && sun) {\n            moon.style.display = enabled ? 'none' : 'block';\n            sun.style.display = enabled ? 'block' : 'none';\n        }\n    }\n}\n\nfunction togglePinkMode() {\n    const isPink = document.body.classList.contains('pink-mode');\n    const newState = !isPink;\n    updatePinkModeDisplay(newState);\n    localStorage.setItem(PINK_MODE_KEY, newState);\n    localStorage.setItem(FALLBACK_PINK_KEY, newState);\n}\n\nfunction updatePinkModeDisplay(enabled) {\n    document.body.classList.toggle('pink-mode', enabled);\n    updateAppLogo(enabled);\n    const btn = document.getElementById('v2ThemeTogglePink');\n    if (btn) btn.classList.toggle('active', enabled);\n}\n\nfunction updateAppLogo(isPink) {\n    const logo = document.querySelector('.v2-sidebar-logo');\n    if (!logo) return;\n    logo.src = isPink ? 'src/icons/Icon Pinknew.svg' : 'src/icons/Icon Bluenew.svg';\n}\n\n// =====================\n// EXPORTS\n// =====================\nexport const V2Sidebar = {\n    init: initSidebar\n};\n\n// Expose to global scope\nif (typeof global !== 'undefined') {\n    global.cineV2Sidebar = V2Sidebar;\n}\n\nif (typeof window !== 'undefined') {\n    window.cineV2Sidebar = V2Sidebar;\n}\n\n","/**\n * Cine Power Planner V2 - Auto Gear Rules View\n * ============================================\n * Manages the \"Auto Gear Rules\" view in the V2 UI.\n */\n\n// Removed IIFE wrapper for ES Module conversion\n// (function (global) {\n//    'use strict';\n\n// Polyfill global for legacy code\nconst global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : {};\n\n\n// =====================\n// CONFIGURATION\n// =====================\nconst VIEW_ID = 'view-rules';\n\n// =====================\n// CONSTANTS\n// =====================\nconst SCENARIOS = [\n    'Indoor', 'Outdoor', 'Studio', 'Tripod', 'Handheld', 'Easyrig',\n    'Cine Saddle', 'Steadybag', 'Dolly', 'Slider', 'Steadicam',\n    'Gimbal', 'Trinity', 'Rollcage', 'Car Mount', 'Technocrane',\n    'Crane', 'Jib', 'Ultimate Arm', 'Russian Arm', 'Special'\n];\n\nconst CREW_ROLES = [\n    'DoP', '1st AC', '2nd AC', 'Camera Operator', 'DIT', 'Data Wrangler',\n    'VTR/Playback', 'Gaffer', 'Best Boy', 'Key Grip', 'Grip',\n    'Sound Mixer', 'Boom Operator', 'PA', 'Director', 'Producer',\n    'Script Supervisor', 'Make-up Artist', 'Production Designer'\n];\n\n// =====================\n// STATE\n// =====================\nlet isInitialized = false;\n\n// =====================\n// HELPER: SAFE COLLECT\n// =====================\nfunction safeCollectKeys(obj) {\n    return (obj && typeof obj === 'object') ? Object.keys(obj).sort() : [];\n}\n\nfunction safeCollectCall(fnName, arg) {\n    if (typeof window[fnName] === 'function') {\n        try {\n            const res = window[fnName](arg);\n            // If the result is array of objects {value, label}, map to value\n            if (Array.isArray(res) && res.length > 0 && typeof res[0] === 'object') {\n                return res.map(o => o.value);\n            }\n            return Array.isArray(res) ? res : [];\n        } catch (e) {\n            console.warn(`[RulesView] Error calling ${fnName}`, e);\n            return [];\n        }\n    }\n    return [];\n}\n\nfunction _t(key) {\n    if (typeof window !== 'undefined' && window.texts) {\n        const langSelect = document.getElementById('languageSelect');\n        const lang = (langSelect && langSelect.value) ||\n            (typeof window.currentLanguage === 'string' && window.currentLanguage) ||\n            'en';\n\n        const dict = window.texts[lang] || window.texts['en'];\n\n        if (dict) {\n            return key.split('.').reduce((o, i) => (o ? o[i] : null), dict) || key;\n        }\n    }\n    return key;\n}\n\n\n// =====================\n// PUBLIC API\n// =====================\nconst RulesView = {\n    container: null,\n\n    init() {\n        this.container = document.getElementById(VIEW_ID);\n        if (!this.container) {\n            console.error(`[RulesView] Container element with ID '${VIEW_ID}' not found.`);\n            return;\n        }\n\n        if (!isInitialized) {\n            console.log('[RulesView] Initializing...');\n\n            // Render on view change\n            document.addEventListener('v2:viewchange', (e) => {\n                if (e.detail && e.detail.view === 'rules') {\n                    this.render();\n                }\n            });\n\n            // Listen for the 'cine:ready' event which fires when core modules are loaded\n            document.addEventListener('cine:ready', () => {\n                console.log('[RulesView] cine:ready event received, re-rendering...');\n                this.render();\n            });\n\n            // Also listen for loader completion signal (dispatched by loader.js)\n            document.addEventListener('cine-loader-complete', () => {\n                console.log('[RulesView] cine-loader-complete event received, re-rendering...');\n                this.render();\n            });\n\n            isInitialized = true;\n            console.log('[RulesView] Initialized');\n        }\n    },\n\n    render() {\n        if (!this.container) {\n            this.init();\n            if (!this.container) return;\n        }\n\n        // Check if global function is available\n        const rulesAvailable = (typeof window.getAutoGearRules === 'function');\n\n        if (!rulesAvailable) {\n            // Track retry attempts\n            if (typeof this._retryCount === 'undefined') {\n                this._retryCount = 0;\n            }\n\n            const maxRetries = 10;\n            const isRetrying = this._retryCount < maxRetries;\n\n            // Show loading or error state depending on retry count\n            this.container.innerHTML = `\n                    <div class=\"rules-header\">\n                        <div class=\"rules-title\">\n                            <h1>${_t('rulesViewTitle')}</h1>\n                            <p>${_t('rulesViewSubtitle')}</p>\n                        </div>\n                    </div>\n                    <div class=\"v2-empty-state\">\n                        ${isRetrying ? '<div class=\"v2-spinner\"></div>' : '<span class=\"icon\" style=\"font-size: 48px; color: var(--warning-color);\">warning</span>'}\n                        <p>${isRetrying ? (_t('loadingRules') || 'Loading rules system...') : (_t('rulesLoadError') || 'Unable to load rules system')}</p>\n                        <p class=\"text-muted\" style=\"font-size: 12px; margin-top: 8px;\">${isRetrying ? 'Waiting for core modules...' : 'Please refresh the page to try again.'}</p>\n                        ${!isRetrying ? '<button class=\"v2-btn v2-btn-secondary\" style=\"margin-top: 16px;\" onclick=\"window.location.reload()\">Refresh Page</button>' : ''}\n                    </div>\n                `;\n\n            // Retry with increasing delays (exponential backoff with max 5s)\n            if (isRetrying && !this._loadCheckTimer) {\n                const delay = Math.min(500 * Math.pow(1.5, this._retryCount), 5000);\n                console.log(`[RulesView] Retry ${this._retryCount + 1}/${maxRetries} in ${delay}ms...`);\n\n                this._loadCheckTimer = setTimeout(() => {\n                    this._loadCheckTimer = null;\n                    this._retryCount++;\n                    if (typeof window.getAutoGearRules === 'function') {\n                        this._retryCount = 0; // Reset on success\n                        this.render();\n                    } else if (this._retryCount < maxRetries) {\n                        this.render(); // Retry again\n                    } else {\n                        console.error('[RulesView] Max retries reached. Rules module unavailable.');\n                        this.render(); // Show error state\n                    }\n                }, delay);\n            }\n            return;\n        }\n\n        // Reset retry count on successful load\n        this._retryCount = 0;\n\n        const header = `\n                <div class=\"rules-header\">\n                    <div class=\"rules-title\">\n                        <h1>${_t('rulesViewTitle')}</h1>\n                        <p>${_t('rulesViewSubtitle')}</p>\n                    </div>\n                    <div class=\"rules-header-actions\">\n                         ${this.renderToolbar()}\n                         <button class=\"v2-btn v2-btn-primary\" id=\"btn-add-rule\">\n                            <span class=\"icon\">add</span>\n                            <span>${_t('buttonAddRule')}</span>\n                        </button>\n                    </div>\n                </div>\n                ${this.renderDefaultsSection()}\n            `;\n\n        let rulesHtml = '<div class=\"rules-list\">';\n        const rules = window.getAutoGearRules();\n\n        if (rules.length === 0) {\n            rulesHtml += `\n                    <div class=\"rule-empty-state\">\n                        <h3>${_t('rulesEmptyTitle')}</h3>\n                        <p>${_t('rulesEmptyText')}</p>\n                    </div>\n                `;\n        } else {\n            rules.forEach(rule => {\n                const conditionCount = this.countConditions(rule);\n                const addCount = Array.isArray(rule.add) ? rule.add.length : 0;\n\n                rulesHtml += `\n                        <div class=\"rule-card\" data-rule-id=\"${rule.id}\">\n                             <div class=\"rule-status\">\n                                <label class=\"rule-toggle\">\n                                    <input type=\"checkbox\" ${rule.enabled !== false ? 'checked' : ''} disabled>\n                                    <span class=\"slider round\"></span>\n                                </label>\n                            </div>\n                            <div class=\"rule-content\">\n                                <div class=\"rule-header\">\n                                    <h3 class=\"rule-name\">${this.escapeHtml(rule.label) || 'Untitled Rule'}</h3>\n                                    ${rule.always ? `<span class=\"v2-badge v2-badge-primary\">${_t('ruleBadgeAlways')}</span>` : ''}\n                                </div>\n                                <div class=\"rule-conditions\">\n                                    <span class=\"condition-tag\"><strong>${conditionCount}</strong> ${_t('ruleTagConditions')}</span>\n                                    <span class=\"condition-tag\"><strong>${addCount}</strong> ${_t('ruleTagItemsAdded')}</span>\n                                </div>\n                            </div>\n                            <div class=\"rule-actions\">\n                                <button class=\"v2-btn v2-btn-icon v2-btn-ghost btn-edit-rule\" title=\"${_t('buttonEdit')}\">\n                                    <span class=\"icon\">edit</span>\n                                </button>\n                                <button class=\"v2-btn v2-btn-icon v2-btn-ghost btn-delete-rule\" title=\"${_t('buttonDelete')}\">\n                                    <span class=\"icon\">delete</span>\n                                </button>\n                            </div>\n                        </div>\n                    `;\n            });\n        }\n        rulesHtml += '</div>';\n\n        this.container.innerHTML = header + rulesHtml;\n        this.attachListeners();\n    },\n\n    countConditions(rule) {\n        if (!rule) return 0;\n        let count = 0;\n        if (rule.always) count++;\n        ['scenarios', 'camera', 'mattebox', 'monitor', 'tripodHeadBrand', 'tripodBowl', 'tripodTypes', 'crewPresent'].forEach(key => {\n            if (rule[key] && rule[key].length > 0) count += rule[key].length;\n        });\n        return count;\n    },\n\n    attachListeners() {\n        const addBtn = this.container.querySelector('#btn-add-rule');\n        if (addBtn) addBtn.onclick = () => this.showAddRuleModal();\n\n        this.container.querySelectorAll('.btn-edit-rule').forEach(btn => {\n            btn.onclick = (e) => {\n                const card = e.target.closest('.rule-card');\n                this.showEditRuleModal(card.dataset.ruleId);\n            };\n        });\n\n        this.container.querySelectorAll('.btn-delete-rule').forEach(btn => {\n            btn.onclick = (e) => {\n                const card = e.target.closest('.rule-card');\n                if (confirm(_t('confirmDeleteRule'))) {\n                    this.deleteRule(card.dataset.ruleId);\n                }\n            };\n        });\n\n        // Defaults (using event delegation or direct bind since they are static in render)\n        this.container.querySelectorAll('.default-monitor-select').forEach(select => {\n            select.onchange = (e) => {\n                const key = e.target.dataset.key;\n                const val = e.target.value;\n                if (window.setAutoGearDefault) {\n                    window.setAutoGearDefault(key, val);\n                } else {\n                    localStorage.setItem('auto_gear_default_' + key, val);\n                }\n            };\n        });\n\n        const exportBtn = this.container.querySelector('#btn-export-rules');\n        if (exportBtn) exportBtn.onclick = () => this.exportRules();\n\n        const importBtn = this.container.querySelector('#btn-import-rules');\n        if (importBtn) importBtn.onclick = () => this.triggerImport();\n\n        const resetBtn = this.container.querySelector('#btn-reset-rules');\n        if (resetBtn) resetBtn.onclick = () => this.resetRules();\n    },\n\n    exportRules() {\n        if (window.exportAutoGearPresets) {\n            window.exportAutoGearPresets();\n        } else {\n            console.warn('[RulesView] Export helper not found');\n        }\n    },\n\n    triggerImport() {\n        const input = document.getElementById('autoGearImportInput');\n        if (input) input.click();\n        else {\n            // Fallback: create temporary input\n            const tempInput = document.createElement('input');\n            tempInput.type = 'file';\n            tempInput.accept = '.json,application/json';\n            tempInput.onchange = (e) => this.handleImport(e.target.files[0]);\n            tempInput.click();\n        }\n    },\n\n    handleImport(file) {\n        if (!file) return;\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            try {\n                const data = JSON.parse(e.target.result);\n                if (window.importAutoGearRules) {\n                    window.importAutoGearRules(data);\n                    this.render();\n                }\n            } catch (err) {\n                console.error('Import failed', err);\n                alert('Invalid rules file');\n            }\n        };\n        reader.readAsText(file);\n    },\n\n    resetRules() {\n        if (confirm(_t('confirmResetRules'))) {\n            if (window.clearAutoGearDefaultsSeeded) window.clearAutoGearDefaultsSeeded(); // Logic specific to app\n            // We might need to call a reset helper\n            if (typeof window.resetAutoGearRules === 'function') {\n                window.resetAutoGearRules();\n                this.render();\n            }\n        }\n    },\n\n    deleteRule(id) {\n        if (window.getAutoGearRules && window.setAutoGearRules) {\n            const currentRules = window.getAutoGearRules();\n            const newRules = currentRules.filter(r => r.id !== id);\n            window.setAutoGearRules(newRules);\n            this.render();\n        }\n    },\n\n    showAddRuleModal() {\n        this.showEditRuleModal(null);\n    },\n\n    renderToolbar() {\n        return `\n                <div class=\"v2-toolbar-group\">\n                    <button class=\"v2-btn v2-btn-ghost\" id=\"btn-export-rules\" title=\"${_t('buttonExportRules')}\">\n                        <span class=\"icon\">download</span>\n                    </button>\n                    <button class=\"v2-btn v2-btn-ghost\" id=\"btn-import-rules\" title=\"${_t('buttonImportRules')}\">\n                        <span class=\"icon\">upload</span>\n                    </button>\n                     <button class=\"v2-btn v2-btn-ghost\" id=\"btn-reset-rules\" title=\"${_t('buttonResetRules')}\">\n                        <span class=\"icon\">restart_alt</span>\n                    </button>\n                </div>\n            `;\n    },\n\n    renderDefaultsSection() {\n        // Collect monitor options\n        const monitors = [...safeCollectCall('collectAutoGearMonitorNames', 'monitor'), ...safeCollectCall('collectAutoGearMonitorNames', 'directorMonitor')];\n\n        // Helper to render select options\n        const renderOptions = (selected) => {\n            return [\n                `<option value=\"\">${_t('optionNone')}</option>`,\n                ...monitors.map(m => `<option value=\"${this.escapeHtml(m)}\" ${m === selected ? 'selected' : ''}>${this.escapeHtml(m)}</option>`)\n            ].join('');\n        };\n\n        // Get current values (fallback to localStorage if global helper missing)\n        const getVal = (key) => {\n            if (window.getAutoGearDefault) return window.getAutoGearDefault(key);\n            return localStorage.getItem('auto_gear_default_' + key) || '';\n        };\n\n        return `\n                <div class=\"v2-card rules-defaults-card\">\n                    <div class=\"v2-card-header\">\n                        <h3>${_t('headingMonitorDefaults')}</h3>\n                    </div>\n                    <div class=\"v2-card-body\">\n                         <div class=\"defaults-grid\">\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelFocusMonitor')}</label>\n                                <select class=\"v2-select default-monitor-select\" data-key=\"focusMonitor\">\n                                    ${renderOptions(getVal('focusMonitor'))}\n                                </select>\n                            </div>\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelHandheldMonitor')}</label>\n                                <select class=\"v2-select default-monitor-select\" data-key=\"handheldMonitor\">\n                                    ${renderOptions(getVal('handheldMonitor'))}\n                                </select>\n                            </div>\n                             <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelComboMonitor')}</label>\n                                <select class=\"v2-select default-monitor-select\" data-key=\"comboMonitor\">\n                                    ${renderOptions(getVal('comboMonitor'))}\n                                </select>\n                            </div>\n                             <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelDirectorMonitor')}</label>\n                                <select class=\"v2-select default-monitor-select\" data-key=\"directorMonitor\">\n                                    ${renderOptions(getVal('directorMonitor'))}\n                                </select>\n                            </div>\n                         </div>\n                    </div>\n                </div>\n            `;\n    },\n\n    // ============================================================\n    //  EDIT MODAL (DEEP DIVE IMPLEMENTATION)\n    // ============================================================\n    showEditRuleModal(ruleId) {\n        let rule = null;\n        let isNew = true;\n\n        if (ruleId && window.getAutoGearRules) {\n            const rules = window.getAutoGearRules();\n            const found = rules.find(r => r.id === ruleId);\n            if (found) {\n                rule = JSON.parse(JSON.stringify(found));\n                isNew = false;\n            }\n        }\n\n        if (!rule) {\n            rule = {\n                id: 'rule_' + Date.now(),\n                label: '',\n                enabled: true,\n                always: false,\n                // Context\n                scenarios: [],\n                scenarioMode: 'all', // 'all', 'any', 'multiplier'\n                scenarioBase: '',\n                scenarioFactor: 1,\n                shootingDays: null,\n                shootingDaysMode: 'minimum', // 'minimum', 'maximum', 'every'\n                // Camera\n                camera: [],\n                mattebox: [],\n                viewfinderExtension: [],\n                // Monitor\n                monitor: [], // Includes director monitors in legacy model often mixed or separates? Legacy has separate `directorMonitor` in some places but rule object usually just `monitor`. We'll rely on collection logic.\n                videoDistribution: [],\n                wireless: [],\n                // Support\n                tripodHeadBrand: [],\n                tripodBowl: [],\n                tripodTypes: [],\n                tripodSpreader: [],\n                // Crew\n                crewPresent: [],\n                crewAbsent: [],\n                // Actions\n                add: [],\n                remove: []\n            };\n        }\n\n        const existing = document.querySelector('.v2-modal-backdrop');\n        if (existing) existing.remove();\n\n        const backdrop = document.createElement('div');\n        backdrop.className = 'v2-modal-backdrop';\n\n        // --- DATA COLLECTION ---\n        const d = window.devices || {};\n\n        const data = {\n            // Context\n            scenarios: SCENARIOS,\n\n            // Camera\n            cameras: safeCollectKeys(d.cameras),\n            matteboxes: safeCollectKeys(d.matteboxes), // Fallback if direct mapping exists\n            // If devices.matteboxes doesn't exist, try collect functions?\n            // Actually devices.accessories?.matteboxes is likely used if distinct?\n            // Let's assume devices.matteboxes might not exist. If so, leave empty for now or use `safeCollectKeys(d.accessories?.matteboxes)`.\n            viewfinders: safeCollectCall('getAllViewfinderTypes'),\n\n            // Monitoring\n            monitors: [...safeCollectCall('collectAutoGearMonitorNames', 'monitor'), ...safeCollectCall('collectAutoGearMonitorNames', 'directorMonitor')],\n            wireless: safeCollectKeys(d.wireless), // or d.wirelessTransmitters?\n\n            // Support\n            tripodHeads: safeCollectCall('collectAutoGearTripodNames', 'tripodHead'),\n            tripodBowls: safeCollectCall('collectAutoGearTripodNames', 'tripodBowl'),\n            tripodTypes: safeCollectCall('collectAutoGearTripodNames', 'tripodType'),\n            tripodSpreaders: safeCollectCall('collectAutoGearTripodNames', 'tripodSpreader'),\n\n            // Crew\n            crew: CREW_ROLES\n        };\n\n        // Fix for Matteboxes if not found directly\n        if (data.matteboxes.length === 0 && d.matteboxes) data.matteboxes = Object.keys(d.matteboxes);\n\n        // Gear Catalog for Add Item\n        const gearNames = safeCollectCall('collectAutoGearCatalogNames');\n        const categories = safeCollectCall('collectDeviceManagerCategories');\n        if (!categories.length) categories.push('Power', 'Video', 'Support', 'Cabling', 'Accessories');\n\n\n        // --- HTML GENERATION ---\n        backdrop.innerHTML = `\n                <div class=\"v2-modal v2-modal-lg\">\n                    <div class=\"v2-modal-header\">\n                        <h3 class=\"v2-modal-title\">${isNew ? _t('modalTitleCreateRule') : _t('modalTitleEditRule')}</h3>\n                        <button type=\"button\" class=\"v2-modal-close v2-btn v2-btn-ghost\"><span class=\"icon\">close</span></button>\n                    </div>\n                    <div class=\"v2-modal-body rules-modal-body\">\n                        <datalist id=\"gearCatalogList\">\n                            ${gearNames.map(name => `<option value=\"${this.escapeHtml(name)}\">`).join('')}\n                        </datalist>\n\n                        <div class=\"rules-modal-tabs\">\n                            <button class=\"rules-tab-btn active\" data-tab=\"general\">${_t('tabGeneral')}</button>\n                            <button class=\"rules-tab-btn\" data-tab=\"context\">${_t('tabContext')}</button>\n                            <button class=\"rules-tab-btn\" data-tab=\"camera\">${_t('tabCamera')}</button>\n                            <button class=\"rules-tab-btn\" data-tab=\"monitor\">${_t('tabMonitoring')}</button>\n                            <button class=\"rules-tab-btn\" data-tab=\"support\">${_t('tabSupport')}</button>\n                            <button class=\"rules-tab-btn\" data-tab=\"crew\">${_t('tabCrew')}</button>\n                            <button class=\"rules-tab-btn\" data-tab=\"actions\">${_t('tabActions')}</button>\n                        </div>\n\n                        <!-- 1. GENERAL -->\n                        <div class=\"rules-tab-content active\" id=\"tab-general\">\n                            <div class=\"v2-form-group\">\n                                <label for=\"ruleLabel\" class=\"v2-label\">${_t('labelRuleName')}</label>\n                                <input type=\"text\" id=\"ruleLabel\" class=\"v2-input\" value=\"${this.escapeHtml(rule.label)}\" placeholder=\"${_t('placeholderRuleName')}\">\n                            </div>\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-checkbox-label\">\n                                    <input type=\"checkbox\" id=\"ruleEnabled\" ${rule.enabled !== false ? 'checked' : ''}>\n                                    <span>${_t('labelRuleEnabled')}</span>\n                                </label>\n                            </div>\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-checkbox-label\">\n                                    <input type=\"checkbox\" id=\"ruleAlways\" ${rule.always ? 'checked' : ''}>\n                                    <span>${_t('labelRuleAlways')}</span>\n                                </label>\n                                <p class=\"v2-help-text\">${_t('helpRuleAlways')}</p>\n                            </div>\n                        </div>\n\n                        <!-- 2. CONTEXT -->\n                        <div class=\"rules-tab-content\" id=\"tab-context\">\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionScenarios')}</span>\n                                <div class=\"v2-form-group\">\n                                    <label class=\"v2-label\">${_t('labelScenarioMode')}</label>\n                                    <select id=\"ruleScenarioMode\" class=\"v2-select\">\n                                        <option value=\"all\" ${rule.scenarioMode === 'all' ? 'selected' : ''}>${_t('optionScenarioAll')}</option>\n                                        <option value=\"any\" ${rule.scenarioMode === 'any' ? 'selected' : ''}>${_t('optionScenarioAny')}</option>\n                                        <option value=\"multiplier\" ${rule.scenarioMode === 'multiplier' ? 'selected' : ''}>${_t('optionScenarioMultiplier')}</option>\n                                    </select>\n                                </div>\n                                <div id=\"scenarioMultiplierConfig\" style=\"display: ${rule.scenarioMode === 'multiplier' ? 'block' : 'none'}; padding-left: 10px; border-left: 2px solid var(--border-color);\">\n                                     <div class=\"v2-form-group\">\n                                        <label class=\"v2-label\">${_t('labelScenarioFactor')}</label>\n                                        <input type=\"number\" id=\"ruleScenarioFactor\" class=\"v2-input\" value=\"${rule.scenarioFactor || 1}\" min=\"1\">\n                                    </div>\n                                </div>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.scenarios, rule.scenarios, 'scenarios')}\n                                </div>\n                            </div>\n\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionShootingDays')}</span>\n                                <div class=\"v2-form-group\">\n                                    <label class=\"v2-label\">${_t('labelShootingDaysMode')}</label>\n                                    <select id=\"ruleShootingDaysMode\" class=\"v2-select\">\n                                        <option value=\"minimum\" ${rule.shootingDaysMode === 'minimum' ? 'selected' : ''}>${_t('optionDaysMinimum')}</option>\n                                        <option value=\"maximum\" ${rule.shootingDaysMode === 'maximum' ? 'selected' : ''}>${_t('optionDaysMaximum')}</option>\n                                        <option value=\"every\" ${rule.shootingDaysMode === 'every' ? 'selected' : ''}>${_t('optionDaysEvery')}</option>\n                                    </select>\n                                </div>\n                                <div class=\"v2-form-group\">\n                                    <label class=\"v2-label\">${_t('labelShootingDaysValue')}</label>\n                                    <input type=\"number\" id=\"ruleShootingDays\" class=\"v2-input\" value=\"${rule.shootingDays !== null ? rule.shootingDays : ''}\" placeholder=\"${_t('placeholderOptional')}\">\n                                    <p class=\"v2-help-text\">${_t('helpShootingDays')}</p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- 3. CAMERA -->\n                        <div class=\"rules-tab-content\" id=\"tab-camera\">\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionCameraModels')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.cameras, rule.camera, 'camera')}\n                                </div>\n                            </div>\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionMatteboxes')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.matteboxes, rule.mattebox, 'mattebox')}\n                                </div>\n                            </div>\n                             <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionViewfinders')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.viewfinders, rule.viewfinderExtension, 'viewfinderExtension')}\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- 4. MONITORING -->\n                        <div class=\"rules-tab-content\" id=\"tab-monitor\">\n                             <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionMonitors')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.monitors, rule.monitor, 'monitor')}\n                                </div>\n                            </div>\n                             <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionWireless')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.wireless, rule.wireless, 'wireless')}\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- 5. SUPPORT -->\n                        <div class=\"rules-tab-content\" id=\"tab-support\">\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionTripodHeads')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.tripodHeads, rule.tripodHeadBrand, 'tripodHeadBrand')}\n                                </div>\n                            </div>\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionBowlSize')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.tripodBowls, rule.tripodBowl, 'tripodBowl')}\n                                </div>\n                            </div>\n                             <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionLegTypes')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.tripodTypes, rule.tripodTypes, 'tripodTypes')}\n                                </div>\n                            </div>\n                             <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionSpreaders')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.tripodSpreaders, rule.tripodSpreader, 'tripodSpreader')}\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- 6. CREW -->\n                        <div class=\"rules-tab-content\" id=\"tab-crew\">\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionCrewPresent')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.crew, rule.crewPresent, 'crewPresent')}\n                                </div>\n                            </div>\n                            <div class=\"form-section\">\n                                <span class=\"form-section-title\">${_t('sectionCrewAbsent')}</span>\n                                <div class=\"condition-grid\">\n                                    ${this.renderCheckboxGroup(data.crew, rule.crewAbsent, 'crewAbsent')}\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- 7. ACTIONS -->\n                        <div class=\"rules-tab-content\" id=\"tab-actions\">\n                            <div class=\"form-section\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;\">\n                                    <span class=\"form-section-title\" style=\"margin: 0;\">${_t('sectionItemsToAdd')}</span>\n                                    <button class=\"v2-btn v2-btn-sm v2-btn-secondary btn-show-add-item\" data-type=\"add\">${_t('buttonAddItem')}</button>\n                                </div>\n                                <div class=\"add-item-form-container\" id=\"add-item-form-add\" style=\"display: none; margin-bottom: 10px; padding: 10px; background: var(--bg-surface-active); border-radius: 4px;\">\n                                    ${this.renderAddItemForm('add', categories)}\n                                </div>\n                                <div class=\"action-list\" id=\"action-list-add\">\n                                    ${this.renderActionList(rule.add, 'add')}\n                                </div>\n                            </div>\n                             <div class=\"form-section\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;\">\n                                    <span class=\"form-section-title\" style=\"margin: 0;\">${_t('sectionItemsToRemove')}</span>\n                                    <button class=\"v2-btn v2-btn-sm v2-btn-secondary btn-show-add-item\" data-type=\"remove\">${_t('buttonAddItem')}</button>\n                                </div>\n                                <div class=\"add-item-form-container\" id=\"add-item-form-remove\" style=\"display: none; margin-bottom: 10px; padding: 10px; background: var(--bg-surface-active); border-radius: 4px;\">\n                                    ${this.renderAddItemForm('remove', categories)}\n                                </div>\n                                <div class=\"action-list\" id=\"action-list-remove\">\n                                    ${this.renderActionList(rule.remove, 'remove')}\n                                </div>\n                            </div>\n                        </div>\n\n                    </div>\n                    <div class=\"v2-modal-footer\">\n                        <button type=\"button\" class=\"v2-btn v2-btn-secondary\" id=\"btn-cancel-rule\">${_t('buttonCancel')}</button>\n                        <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"btn-save-rule\">${_t('buttonSaveRule')}</button>\n                    </div>\n                </div>\n            `;\n\n        document.body.appendChild(backdrop);\n        requestAnimationFrame(() => backdrop.classList.add('open'));\n        this.bindModalEvents(backdrop, rule, isNew);\n    },\n\n    // --- RENDER HELPERS ---\n    renderCheckboxGroup(items, selectedItems, groupName) {\n        const selectedSet = new Set(selectedItems || []);\n        if (!items || items.length === 0) return `<div class=\"v2-empty-text\">${_t('textNoOptions')}</div>`;\n\n        return items.map(item => `\n                <label class=\"condition-item\">\n                    <input type=\"checkbox\" data-group=\"${groupName}\" value=\"${this.escapeHtml(item)}\" ${selectedSet.has(item) ? 'checked' : ''}>\n                    <span>${this.escapeHtml(item)}</span>\n                </label>\n            `).join('');\n    },\n\n    renderAddItemForm(type, categories) {\n        return `\n                 <div style=\"display: grid; grid-template-columns: 2fr 1fr 0.5fr auto; gap: 8px; align-items: end;\">\n                    <div>\n                        <label class=\"v2-label\" style=\"font-size: 11px;\">${_t('labelItemName')}</label>\n                        <input type=\"text\" class=\"v2-input input-item-name\" list=\"gearCatalogList\" placeholder=\"${_t('placeholderItemSearch')}\" data-type=\"${type}\">\n                    </div>\n                    <div>\n                        <label class=\"v2-label\" style=\"font-size: 11px;\">${_t('labelCategory')}</label>\n                        <select class=\"v2-select select-item-category\" data-type=\"${type}\">\n                            ${categories.map(c => `<option value=\"${c}\">${c}</option>`).join('')}\n                        </select>\n                    </div>\n                    <div>\n                        <label class=\"v2-label\" style=\"font-size: 11px;\">${_t('labelQty')}</label>\n                        <input type=\"number\" class=\"v2-input input-item-qty\" value=\"1\" min=\"1\" data-type=\"${type}\">\n                    </div>\n                    <div style=\"display: flex; gap: 4px;\">\n                        <button class=\"v2-btn v2-btn-primary btn-confirm-add-item\" data-type=\"${type}\">${_t('buttonAdd')}</button>\n                    </div>\n                </div>\n            `;\n    },\n\n    renderActionList(items, type) {\n        // Same as before\n        if (!items || !items.length) {\n            return `<div class=\"v2-empty-text\">${_t('textNoItems')}</div>`;\n        }\n        return items.map((item, index) => `\n                <div class=\"action-item-row\">\n                    <span style=\"font-weight: 500; flex: 1;\">${this.escapeHtml(item.name)}</span>\n                    <span class=\"v2-badge\">${item.category}</span>\n                    <span class=\"v2-badge v2-badge-outline\">x${item.quantity}</span>\n                    <button type=\"button\" class=\"v2-btn v2-btn-icon v2-btn-ghost btn-delete-action-item\" \n                            data-type=\"${type}\" data-index=\"${index}\" title=\"Remove Item\">\n                        <span class=\"icon\" style=\"font-size: 16px;\">close</span>\n                    </button>\n                </div>\n            `).join('');\n    },\n\n    // --- EVENT BINDING ---\n    bindModalEvents(backdrop, rule, isNew) {\n        // 1. Tabs\n        backdrop.querySelectorAll('.rules-tab-btn').forEach(btn => {\n            btn.onclick = () => {\n                backdrop.querySelectorAll('.rules-tab-btn').forEach(b => b.classList.remove('active'));\n                backdrop.querySelectorAll('.rules-tab-content').forEach(c => c.classList.remove('active'));\n                btn.classList.add('active');\n                backdrop.querySelector(`#tab-${btn.dataset.tab}`).classList.add('active');\n            };\n        });\n\n        // 2. Action Items (Show/Add)\n        backdrop.querySelectorAll('.btn-show-add-item').forEach(btn => {\n            btn.onclick = () => {\n                const type = btn.dataset.type;\n                const form = backdrop.querySelector(`#add-item-form-${type}`);\n                form.style.display = form.style.display === 'none' ? 'block' : 'none';\n            };\n        });\n\n        backdrop.querySelectorAll('.btn-confirm-add-item').forEach(btn => {\n            btn.onclick = () => {\n                const type = btn.dataset.type;\n                const container = backdrop.querySelector(`#add-item-form-${type}`);\n                const name = container.querySelector('.input-item-name').value.trim();\n                const category = container.querySelector('.select-item-category').value;\n                const quantity = parseInt(container.querySelector('.input-item-qty').value, 10) || 1;\n\n                if (!name) return;\n\n                if (!rule[type]) rule[type] = [];\n                rule[type].push({ name, category, quantity });\n\n                container.querySelector('.input-item-name').value = '';\n                container.style.display = 'none';\n\n                // Re-render\n                const listContainer = backdrop.querySelector(`#action-list-${type}`);\n                listContainer.innerHTML = this.renderActionList(rule[type], type);\n                bindDeleteActions();\n            };\n        });\n\n        // 3. Action Items (Delete)\n        const bindDeleteActions = () => {\n            backdrop.querySelectorAll('.btn-delete-action-item').forEach(btn => {\n                btn.onclick = (e) => {\n                    e.stopPropagation();\n                    const type = btn.dataset.type;\n                    const index = parseInt(btn.dataset.index, 10);\n                    if (rule[type]) {\n                        rule[type].splice(index, 1);\n                        backdrop.querySelector(`#action-list-${type}`).innerHTML = this.renderActionList(rule[type], type);\n                        bindDeleteActions();\n                    }\n                };\n            });\n        };\n        bindDeleteActions();\n\n        // 4. Save / Close\n        const close = () => {\n            backdrop.classList.remove('open');\n            setTimeout(() => backdrop.remove(), 200);\n        };\n\n        backdrop.querySelector('.v2-modal-close').onclick = close;\n        backdrop.querySelector('#btn-cancel-rule').onclick = close;\n\n        backdrop.querySelector('#btn-save-rule').onclick = () => {\n            // General\n            rule.label = backdrop.querySelector('#ruleLabel').value.trim();\n            rule.enabled = backdrop.querySelector('#ruleEnabled').checked;\n            rule.always = backdrop.querySelector('#ruleAlways').checked;\n\n            if (!rule.label) {\n                alert(_t('alertEnterRuleName'));\n                return;\n            }\n\n            // Collect Checkboxes\n            const collect = (group) => {\n                return Array.from(backdrop.querySelectorAll(`input[data-group=\"${group}\"]:checked`)).map(cb => cb.value);\n            };\n\n            rule.scenarios = collect('scenarios');\n            rule.scenarioMode = backdrop.querySelector('#ruleScenarioMode').value;\n            rule.scenarioFactor = parseFloat(backdrop.querySelector('#ruleScenarioFactor').value) || 1;\n\n            rule.shootingDaysMode = backdrop.querySelector('#ruleShootingDaysMode').value;\n            const sDays = backdrop.querySelector('#ruleShootingDays').value;\n            rule.shootingDays = sDays !== '' ? parseInt(sDays, 10) : null;\n\n            rule.camera = collect('camera');\n            rule.mattebox = collect('mattebox');\n            rule.viewfinderExtension = collect('viewfinderExtension');\n            rule.monitor = collect('monitor');\n            rule.wireless = collect('wireless');\n            rule.tripodHeadBrand = collect('tripodHeadBrand');\n            rule.tripodBowl = collect('tripodBowl');\n            rule.tripodTypes = collect('tripodTypes');\n            rule.tripodSpreader = collect('tripodSpreader');\n            rule.crewPresent = collect('crewPresent');\n            rule.crewAbsent = collect('crewAbsent');\n\n            this.saveRule(rule, isNew);\n            close();\n        };\n    },\n\n    saveRule(rule, isNew) {\n        if (window.getAutoGearRules && window.setAutoGearRules) {\n            const currentRules = window.getAutoGearRules();\n            let newRules;\n            if (isNew) {\n                newRules = [...currentRules, rule];\n            } else {\n                newRules = currentRules.map(r => r.id === rule.id ? rule : r);\n            }\n            window.setAutoGearRules(newRules);\n            this.render();\n        }\n    },\n\n    escapeHtml(str) {\n        if (typeof str !== 'string') return '';\n        return str.replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n};\n\nglobal.cineRulesView = RulesView;\n\n// Removed IIFE end\nexport { RulesView };\n\n","/**\n * Cine Power Planner V2 - Device Library View\n * ===========================================\n * Manages the Device Library view by integrating the legacy Device Manager.\n * \n * Strategy:\n * This view acts as a wrapper for the existing (Legacy) Device Manager logic.\n * Instead of rewriting the complex CRUD logic for devices, we simply:\n * 1. Create a modern V2 view structure with header and sections\n * 2. \"Borrow\" the DOM elements from the legacy #device-manager section.\n * 3. Reparent them into the V2 layout with proper styling.\n */\n\n(function (global) {\n    'use strict';\n\n    // =====================\n    // CONFIGURATION\n    // =====================\n    const CONTENT_CONTAINER_ID = 'v2-device-library-content';\n    const LEGACY_CONTAINER_ID = 'device-manager';\n\n    // =====================\n    // STATE\n    // =====================\n    let isInitialized = false;\n    let isReparented = false;\n    let activeTab = 'add'; // 'add' or 'browse'\n\n    // =====================\n    // HELPER: Translations\n    // =====================\n    function _t(key) {\n        if (typeof window !== 'undefined' && window.texts) {\n            const langSelect = document.getElementById('languageSelect');\n            const lang = (langSelect && langSelect.value) ||\n                (typeof window.currentLanguage === 'string' && window.currentLanguage) ||\n                'en';\n\n            const dict = window.texts[lang] || window.texts['en'];\n            if (dict) {\n                return key.split('.').reduce((o, i) => (o ? o[i] : null), dict) || key;\n            }\n        }\n        return key;\n    }\n\n    // =====================\n    // DOM MANIPULATION\n    // =====================\n\n    /**\n     * Create the view header\n     */\n    function createViewHeader() {\n        const header = document.createElement('header');\n        header.className = 'view-header';\n        header.innerHTML = `\n            <div class=\"header-content\">\n                <h1>${_t('deviceLibraryTitle') || 'Device Library'}</h1>\n                <p class=\"header-subtitle\">${_t('deviceLibrarySubtitle') || 'Add, edit, and manage devices in your local database'}</p>\n            </div>\n            <div class=\"view-header-actions\">\n                <button class=\"v2-btn v2-btn-secondary\" id=\"v2-export-db-btn\">\n                    <span class=\"icon\">download</span>\n                    <span>Export</span>\n                </button>\n                <button class=\"v2-btn v2-btn-secondary\" id=\"v2-import-db-btn\">\n                    <span class=\"icon\">upload</span>\n                    <span>Import</span>\n                </button>\n            </div>\n        `;\n        return header;\n    }\n\n    /**\n     * Create tabbed navigation\n     */\n    function createTabNav() {\n        const tabNav = document.createElement('div');\n        tabNav.className = 'device-library-tabs';\n        tabNav.innerHTML = `\n            <button class=\"device-library-tab active\" data-tab=\"add\">\n                <span class=\"icon\">add_circle</span>\n                <span>${_t('tabAddDevice') || 'Add Device'}</span>\n            </button>\n            <button class=\"device-library-tab\" data-tab=\"browse\">\n                <span class=\"icon\">list</span>\n                <span>${_t('tabBrowseLibrary') || 'Browse Library'}</span>\n            </button>\n        `;\n        return tabNav;\n    }\n\n    /**\n     * Move Legacy Device Manager elements into V2 View\n     */\n    function reparentLegacyContent() {\n        if (isReparented) return;\n\n        console.log('[DeviceLibraryView] Reparenting legacy content...');\n\n        const v2Container = document.getElementById(CONTENT_CONTAINER_ID);\n        const legacyContainer = document.getElementById(LEGACY_CONTAINER_ID);\n\n        if (!v2Container) {\n            console.error(`[DeviceLibraryView] V2 Container #${CONTENT_CONTAINER_ID} not found.`);\n            return;\n        }\n\n        if (!legacyContainer) {\n            console.error(`[DeviceLibraryView] Legacy Container #${LEGACY_CONTAINER_ID} not found.`);\n            return;\n        }\n\n        // Clear existing content\n        v2Container.innerHTML = '';\n\n        // Add View Header\n        v2Container.appendChild(createViewHeader());\n\n        // Add Tab Navigation\n        v2Container.appendChild(createTabNav());\n\n        // Create view content area\n        const viewContent = document.createElement('div');\n        viewContent.className = 'view-content';\n\n        // ========================================\n        // TAB 1: ADD DEVICE SECTION\n        // ========================================\n        const addDeviceSection = document.createElement('div');\n        addDeviceSection.id = 'device-library-add-tab';\n        addDeviceSection.className = 'device-library-tab-content active';\n\n        const addDeviceCard = document.createElement('div');\n        addDeviceCard.className = 'v2-card v2-device-library-card';\n\n        const cardHeader = document.createElement('div');\n        cardHeader.className = 'v2-card-header';\n        cardHeader.innerHTML = `\n            <div>\n                <h3 class=\"v2-card-title\">\n                    <span class=\"icon section-icon\">add_box</span>\n                    ${_t('addNewDeviceTitle') || 'Add New Device'}\n                </h3>\n                <p class=\"v2-card-subtitle\">${_t('addDeviceSubtitle') || 'Create a custom device entry for your database'}</p>\n            </div>\n        `;\n\n        const cardBody = document.createElement('div');\n        cardBody.className = 'v2-card-body';\n\n        // Move the button-group (add device form) into card body\n        const buttonGroup = legacyContainer.querySelector('.button-group');\n        if (buttonGroup) {\n            // Remove old headings\n            const oldH3 = buttonGroup.querySelector('#addDeviceHeading');\n            if (oldH3) oldH3.remove();\n\n            // Enhance fieldset sections\n            enhanceFormSections(buttonGroup);\n\n            cardBody.appendChild(buttonGroup);\n        }\n\n        addDeviceCard.appendChild(cardHeader);\n        addDeviceCard.appendChild(cardBody);\n        addDeviceSection.appendChild(addDeviceCard);\n\n        // ========================================\n        // TAB 2: BROWSE LIBRARY SECTION\n        // ========================================\n        const browseSection = document.createElement('div');\n        browseSection.id = 'device-library-browse-tab';\n        browseSection.className = 'device-library-tab-content';\n\n        const browseCard = document.createElement('div');\n        browseCard.className = 'v2-card v2-device-library-card';\n\n        const browseHeader = document.createElement('div');\n        browseHeader.className = 'v2-card-header browse-header';\n        browseHeader.innerHTML = `\n            <div>\n                <h3 class=\"v2-card-title\">\n                    <span class=\"icon section-icon\">inventory_2</span>\n                    ${_t('existingDevicesTitle') || 'Existing Devices'}\n                </h3>\n                <p class=\"v2-card-subtitle\">${_t('existingDevicesSubtitle') || 'Browse and manage devices in your library'}</p>\n            </div>\n        `;\n\n        const browseBody = document.createElement('div');\n        browseBody.className = 'v2-card-body';\n\n        // Move the search and device list into browse section\n        const searchContainer = legacyContainer.querySelector('.device-library-search');\n        const deviceListContainer = legacyContainer.querySelector('#deviceListContainer');\n        const existingHeading = legacyContainer.querySelector('#existingDevicesHeading');\n\n        if (existingHeading) existingHeading.remove();\n\n        if (searchContainer) {\n            // Apply V2 styles to search\n            const searchInput = searchContainer.querySelector('input');\n            if (searchInput) {\n                searchInput.classList.add('v2-input');\n            }\n            browseBody.appendChild(searchContainer);\n        }\n\n        if (deviceListContainer) {\n            deviceListContainer.classList.add('v2-device-list');\n            browseBody.appendChild(deviceListContainer);\n        }\n\n        browseCard.appendChild(browseHeader);\n        browseCard.appendChild(browseBody);\n        browseSection.appendChild(browseCard);\n\n        // Move remaining legacy children (export output, etc)\n        while (legacyContainer.firstChild) {\n            if (legacyContainer.firstChild.id === 'deviceManagerHeading') {\n                legacyContainer.removeChild(legacyContainer.firstChild);\n                continue;\n            }\n            // Skip if already moved\n            if (legacyContainer.firstChild.classList &&\n                (legacyContainer.firstChild.classList.contains('button-group') ||\n                    legacyContainer.firstChild.classList.contains('device-library-search'))) {\n                legacyContainer.removeChild(legacyContainer.firstChild);\n                continue;\n            }\n            if (legacyContainer.firstChild.id === 'deviceListContainer') {\n                legacyContainer.removeChild(legacyContainer.firstChild);\n                continue;\n            }\n            // Move other elements to add section\n            addDeviceSection.appendChild(legacyContainer.firstChild);\n        }\n\n        viewContent.appendChild(addDeviceSection);\n        viewContent.appendChild(browseSection);\n        v2Container.appendChild(viewContent);\n\n        // Apply V2 Classes to Legacy Elements\n        applyV2Styles(addDeviceCard);\n        applyV2Styles(browseCard);\n\n        // Attach tab navigation listeners\n        attachTabListeners();\n\n        // Attach export/import button handlers\n        attachActionListeners();\n\n        isReparented = true;\n        console.log('[DeviceLibraryView] Reparenting complete.');\n    }\n\n    /**\n     * Enhance form sections with icons and styling\n     */\n    function enhanceFormSections(container) {\n        const sections = {\n            'cameraFields': { icon: 'videocam', title: 'Camera Settings' },\n            'monitorFields': { icon: 'desktop_windows', title: 'Monitor Settings' },\n            'lensFields': { icon: 'blur_circular', title: 'Lens Settings' },\n            'viewfinderFields': { icon: 'center_focus_weak', title: 'Viewfinder Settings' },\n            'videoFields': { icon: 'sensors', title: 'Video TX Settings' },\n            'motorFields': { icon: 'settings', title: 'Motor Settings' },\n            'controllerFields': { icon: 'tune', title: 'Controller Settings' },\n            'distanceFields': { icon: 'straighten', title: 'Distance Sensor Settings' },\n            'batteryFields': { icon: 'battery_full', title: 'Battery Settings' }\n        };\n\n        Object.keys(sections).forEach(id => {\n            const el = container.querySelector(`#${id}`);\n            if (el) {\n                el.classList.add('device-form-section');\n\n                // Check if section header already exists  \n                if (!el.querySelector('.section-header')) {\n                    const header = document.createElement('div');\n                    header.className = 'section-header';\n                    header.innerHTML = `\n                        <span class=\"icon section-icon\">${sections[id].icon}</span>\n                        <span class=\"section-title\">${sections[id].title}</span>\n                    `;\n                    el.insertBefore(header, el.firstChild);\n                }\n            }\n        });\n\n        // Enhance subsections with icons\n        const subsectionIcons = {\n            'powerInputsHeading': 'bolt',\n            'powerDistributionHeading': 'power',\n            'videoOutputsHeading': 'connected_tv',\n            'fizConnectorHeading': 'settings_input_composite',\n            'mediaHeading': 'sd_card',\n            'viewfinderHeading': 'visibility',\n            'lensMountHeading': 'camera'\n        };\n\n        Object.keys(subsectionIcons).forEach(id => {\n            const el = container.querySelector(`#${id}`);\n            if (el && !el.querySelector('.icon')) {\n                const icon = document.createElement('span');\n                icon.className = 'icon';\n                icon.textContent = subsectionIcons[id];\n                el.insertBefore(icon, el.firstChild);\n            }\n        });\n    }\n\n    /**\n     * Apply V2 classes to legacy elements\n     */\n    function applyV2Styles(container) {\n        // Inputs\n        const inputs = container.querySelectorAll('input[type=\"text\"], input[type=\"number\"], input[type=\"search\"]');\n        inputs.forEach(el => el.classList.add('v2-input'));\n\n        // Selects\n        const selects = container.querySelectorAll('select');\n        selects.forEach(el => el.classList.add('v2-select'));\n\n        // Buttons\n        const buttons = container.querySelectorAll('button');\n        buttons.forEach(btn => {\n            if (btn.classList.contains('v2-btn')) return; // Skip already styled\n            btn.classList.add('v2-btn');\n\n            if (btn.textContent.toLowerCase().includes('add') ||\n                btn.textContent.toLowerCase().includes('save')) {\n                btn.classList.add('v2-btn-primary');\n            }\n        });\n\n        // Form Rows\n        const rows = container.querySelectorAll('.form-row');\n        rows.forEach(row => row.classList.add('v2-form-row'));\n\n        // Labels\n        const labels = container.querySelectorAll('label');\n        labels.forEach(label => label.classList.add('v2-label'));\n    }\n\n    /**\n     * Attach tab navigation event listeners\n     */\n    function attachTabListeners() {\n        const tabs = document.querySelectorAll('.device-library-tab');\n        const contents = document.querySelectorAll('.device-library-tab-content');\n\n        tabs.forEach(tab => {\n            tab.addEventListener('click', () => {\n                const targetTab = tab.dataset.tab;\n                activeTab = targetTab;\n\n                // Update tab states\n                tabs.forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n\n                // Update content visibility\n                contents.forEach(c => c.classList.remove('active'));\n                const targetContent = document.getElementById(`device-library-${targetTab}-tab`);\n                if (targetContent) {\n                    targetContent.classList.add('active');\n                }\n            });\n        });\n    }\n\n    /**\n     * Attach export/import button handlers\n     */\n    function attachActionListeners() {\n        const exportBtn = document.getElementById('v2-export-db-btn');\n        const importBtn = document.getElementById('v2-import-db-btn');\n        const legacyExportBtn = document.getElementById('exportDataBtn');\n        const legacyImportBtn = document.getElementById('importDataBtn');\n\n        if (exportBtn && legacyExportBtn) {\n            exportBtn.addEventListener('click', () => {\n                legacyExportBtn.click();\n            });\n        }\n\n        if (importBtn && legacyImportBtn) {\n            importBtn.addEventListener('click', () => {\n                legacyImportBtn.click();\n            });\n        }\n    }\n\n    /**\n     * Restore Legacy Content (Cleanup)\n     */\n    function restoreLegacyContent() {\n        if (!isReparented) return;\n\n        const v2Container = document.getElementById(CONTENT_CONTAINER_ID);\n        const legacyContainer = document.getElementById(LEGACY_CONTAINER_ID);\n\n        if (v2Container && legacyContainer) {\n            const cardBody = v2Container.querySelector('.v2-card-body');\n\n            if (cardBody) {\n                while (cardBody.firstChild) {\n                    legacyContainer.appendChild(cardBody.firstChild);\n                }\n            } else {\n                while (v2Container.firstChild) {\n                    legacyContainer.appendChild(v2Container.firstChild);\n                }\n            }\n\n            v2Container.innerHTML = '';\n        }\n\n        isReparented = false;\n        console.log('[DeviceLibraryView] Restored legacy content.');\n    }\n\n    // =====================\n    // INITIALIZATION\n    // =====================\n\n    /**\n     * Render the view\n     */\n    function render() {\n        reparentLegacyContent();\n    }\n\n    /**\n     * Initialize the view module\n     */\n    function init() {\n        if (isInitialized) return;\n\n        console.log('[DeviceLibraryView] Initializing...');\n\n        document.addEventListener('v2:viewchange', (e) => {\n            if (e.detail && e.detail.view === 'devices') {\n                render();\n            }\n        });\n\n        // Listen for language changes\n        document.addEventListener('v2:languagechange', () => {\n            if (isReparented) {\n                // Re-render to update translations\n                isReparented = false;\n                render();\n            }\n        });\n\n        isInitialized = true;\n        console.log('[DeviceLibraryView] Initialized');\n    }\n\n    // =====================\n    // PUBLIC API\n    // =====================\n    const DeviceLibraryView = {\n        init,\n        render,\n        restoreLegacyContent\n    };\n\n    global.cineV2DeviceLibrary = DeviceLibraryView;\n\n})(typeof window !== 'undefined' ? window : this);\n","/**\n * Cine Power Planner V2 - Contacts View\n * =====================================\n * Manages the \"Contacts\" view in the V2 UI.\n */\n\n(function (global) {\n    'use strict';\n\n    // =====================\n    // CONFIGURATION\n    // =====================\n    const VIEW_ID = 'view-contacts';\n\n    // =====================\n    // STATE\n    // =====================\n    let isInitialized = false;\n\n    // =====================\n    // HELPER: ESCAPE HTML\n    // =====================\n    function escapeHtml(str) {\n        if (typeof str !== 'string') return '';\n        return str.replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n\n    function _t(key) {\n        if (typeof window !== 'undefined' && window.texts) {\n            const langSelect = document.getElementById('languageSelect');\n            const lang = (langSelect && langSelect.value) ||\n                (typeof window.currentLanguage === 'string' && window.currentLanguage) ||\n                'en';\n            const dict = window.texts[lang] || window.texts['en'];\n            if (dict) {\n                return dict[key] || key;\n            }\n        }\n        return key;\n    }\n\n\n    // =====================\n    // PUBLIC API\n    // =====================\n    const ContactsView = {\n        container: null,\n\n        init() {\n            try {\n                this.container = document.getElementById(VIEW_ID);\n                if (!this.container) {\n                    this.createViewContainer();\n                }\n\n                if (!isInitialized) {\n                    console.log('[ContactsView] Initializing...');\n                    document.addEventListener('v2:viewchange', (e) => {\n                        if (e.detail && e.detail.view === 'contacts') {\n                            this.render();\n                        }\n                    });\n\n                    // Listen for language changes\n                    document.addEventListener('v2:languagechange', () => {\n                        if (this.isVisible()) this.render();\n                    });\n\n                    isInitialized = true;\n                    console.log('[ContactsView] Initialized');\n                }\n            } catch (e) {\n                console.error('[ContactsView] Init failed:', e);\n            }\n        },\n\n        isVisible() {\n            return this.container && !this.container.classList.contains('hidden') && this.container.style.display !== 'none';\n        },\n\n        createViewContainer() {\n            const app = document.querySelector('.v2-app') || document.body;\n            const view = document.createElement('div');\n            view.id = VIEW_ID;\n            view.className = 'app-view';\n            app.appendChild(view);\n            this.container = view;\n        },\n\n        render() {\n            try {\n                if (!this.container) {\n                    this.init();\n                    if (!this.container) return;\n                }\n\n                // Load contacts using the existing module\n                const contactsModule = global.cineFeaturesContacts;\n                if (!contactsModule) {\n                    this.container.innerHTML = `\n                        <div class=\"view-empty-state\">\n                            <p>${_t('statusUnavailable') || 'Contacts module not loaded.'}</p>\n                        </div>\n                    `;\n                    return;\n                }\n\n                const contacts = contactsModule.loadStoredContacts();\n\n                const header = `\n                    <header class=\"view-header\">\n                        <div class=\"header-content\">\n                            <h1>${_t('contactsViewTitle')}</h1>\n                            <p class=\"header-subtitle\">${_t('contactsViewSubtitle')}</p>\n                        </div>\n                        <div class=\"view-header-actions\">\n                            <button class=\"v2-btn v2-btn-primary\" id=\"btn-add-contact\">\n                                <span class=\"icon\">add</span>\n                                <span>${_t('buttonAddContact')}</span>\n                            </button>\n                        </div>\n                    </header>\n                `;\n\n                let contentHtml = '<div class=\"view-content\">';\n\n                if (!contacts || contacts.length === 0) {\n                    contentHtml += `\n                        <div class=\"view-empty-state\">\n                             <div class=\"view-empty-state-icon\">\n                                <span class=\"icon\">group</span>\n                            </div>\n                            <h2>${_t('contactsEmptyTitle')}</h2>\n                            <p class=\"text-muted\" style=\"margin-bottom: 24px;\">${_t('contactsEmptyText')}</p>\n                            <button class=\"v2-btn v2-btn-primary\" id=\"btn-add-contact-empty\">\n                                <span class=\"icon\">add</span>\n                                ${_t('buttonAddFirstContact')}\n                            </button>\n                        </div>\n                    `;\n                } else {\n                    contentHtml += '<div class=\"contacts-grid\">';\n                    contacts.forEach(contact => {\n                        contentHtml += this.renderContactCard(contact);\n                    });\n                    contentHtml += '</div>';\n                }\n\n                contentHtml += '</div>'; // End view-content\n\n                this.container.innerHTML = header + contentHtml;\n                this.attachListeners();\n\n            } catch (err) {\n                console.error('[ContactsView] Render failed', err);\n                if (this.container) {\n                    this.container.innerHTML = `<div class=\"v2-error-state\"><p>Error loading view: ${err.message}</p></div>`;\n                }\n            }\n        },\n\n        renderContactCard(contact) {\n            const initials = contact.name\n                ? contact.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()\n                : '?';\n\n            const avatarHtml = contact.avatar\n                ? `<img src=\"${contact.avatar}\" alt=\"${escapeHtml(contact.name)}\">`\n                : initials;\n\n            const phoneLink = contact.phone ? `<a href=\"tel:${escapeHtml(contact.phone)}\" onclick=\"event.stopPropagation()\">${escapeHtml(contact.phone)}</a>` : '';\n            const emailLink = contact.email ? `<a href=\"mailto:${escapeHtml(contact.email)}\" onclick=\"event.stopPropagation()\">${escapeHtml(contact.email)}</a>` : '';\n            const websiteLink = contact.website ? `<a href=\"${escapeHtml(contact.website)}\" target=\"_blank\" rel=\"noopener noreferrer\" onclick=\"event.stopPropagation()\">${_t('linkWebsite')}</a>` : '';\n\n            // Using Standard V2 Card Structure\n            return `\n                <div class=\"v2-card v2-card-interactive contact-card\" data-contact-id=\"${escapeHtml(contact.id)}\" tabindex=\"0\" role=\"button\">\n                    <div class=\"v2-card-header\">\n                        <div class=\"contact-avatar\">\n                            ${avatarHtml}\n                        </div>\n                        <div class=\"v2-tile-info\">\n                            <h3 class=\"v2-card-title\">${escapeHtml(contact.name || _t('contactUnnamed'))}</h3>\n                            <div class=\"v2-card-subtitle\">${escapeHtml(contact.role || _t('contactNoRole'))}</div>\n                        </div>\n                        <div class=\"v2-card-actions\">\n                            <button class=\"v2-btn v2-btn-icon v2-btn-ghost btn-edit-contact\" title=\"${_t('buttonEdit')}\">\n                                <span class=\"icon\">edit</span>\n                            </button>\n                            <button class=\"v2-btn v2-btn-icon v2-btn-ghost btn-delete-contact\" title=\"${_t('buttonDelete')}\">\n                                <span class=\"icon\">delete</span>\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <div class=\"v2-card-body\">\n                        <div class=\"contact-details\">\n                            ${contact.phone ? `\n                                <div class=\"contact-detail-row\">\n                                    <span class=\"icon\">call</span>\n                                    ${phoneLink}\n                                </div>\n                            ` : ''}\n                            ${contact.email ? `\n                                <div class=\"contact-detail-row\">\n                                    <span class=\"icon\">mail</span>\n                                    ${emailLink}\n                                </div>\n                            ` : ''}\n                            ${contact.website ? `\n                                <div class=\"contact-detail-row\">\n                                    <span class=\"icon\">language</span>\n                                    ${websiteLink}\n                                </div>\n                            ` : ''}\n                             ${contact.notes ? `\n                                <div class=\"contact-detail-row\" style=\"margin-top: 8px; font-style: italic; opacity: 0.8; align-items: flex-start;\">\n                                    <span class=\"icon\" style=\"margin-top:2px;\">description</span>\n                                    <div>${escapeHtml(contact.notes)}</div>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n                </div>\n            `;\n        },\n\n        attachListeners() {\n            const addBtn = this.container.querySelector('#btn-add-contact');\n            const addBtnEmpty = this.container.querySelector('#btn-add-contact-empty');\n\n            if (addBtn) addBtn.onclick = () => this.showEditModal(null);\n            if (addBtnEmpty) addBtnEmpty.onclick = () => this.showEditModal(null);\n\n            this.container.querySelectorAll('.contact-card').forEach(card => {\n                card.onclick = (e) => {\n                    // Prevent if clicked on action buttons or links\n                    if (e.target.closest('button') || e.target.closest('a')) return;\n                    this.showEditModal(card.dataset.contactId);\n                };\n            });\n\n            this.container.querySelectorAll('.btn-edit-contact').forEach(btn => {\n                btn.onclick = (e) => {\n                    e.stopPropagation();\n                    const card = e.target.closest('.contact-card');\n                    this.showEditModal(card.dataset.contactId);\n                };\n            });\n\n            this.container.querySelectorAll('.btn-delete-contact').forEach(btn => {\n                btn.onclick = (e) => {\n                    e.stopPropagation();\n                    const card = e.target.closest('.contact-card');\n                    this.showDeleteConfirmation(card.dataset.contactId);\n                };\n            });\n        },\n\n        showDeleteConfirmation(contactId) {\n            const backdrop = document.createElement('div');\n            backdrop.className = 'v2-modal-backdrop';\n\n            backdrop.innerHTML = `\n                <div class=\"v2-modal\" style=\"max-width: 400px;\">\n                    <div class=\"v2-modal-header\">\n                        <h3 class=\"v2-modal-title\">${_t('modalTitleDeleteContact')}</h3>\n                        <button type=\"button\" class=\"v2-modal-close v2-btn v2-btn-ghost\"><span class=\"icon\">close</span></button>\n                    </div>\n                    <div class=\"v2-modal-body\" style=\"padding: 24px;\">\n                        <p>${_t('confirmDeleteContact')}</p>\n                    </div>\n                    <div class=\"v2-modal-footer\">\n                        <button type=\"button\" class=\"v2-btn v2-btn-secondary\" id=\"btn-cancel-delete\">${_t('buttonCancel')}</button>\n                        <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"btn-confirm-delete\" style=\"background-color: var(--danger-color, #ef4444); border-color: var(--danger-color, #ef4444);\">${_t('buttonDeleteRed')}</button>\n                    </div>\n                </div>\n            `;\n\n            document.body.appendChild(backdrop);\n            requestAnimationFrame(() => backdrop.classList.add('open'));\n\n            const close = () => {\n                backdrop.classList.remove('open');\n                setTimeout(() => backdrop.remove(), 200);\n            };\n\n            backdrop.querySelector('.v2-modal-close').onclick = close;\n            backdrop.querySelector('#btn-cancel-delete').onclick = close;\n            backdrop.querySelector('#btn-confirm-delete').onclick = () => {\n                this.deleteContact(contactId);\n                close();\n            };\n        },\n\n        deleteContact(id) {\n            const module = global.cineFeaturesContacts;\n            if (!module) return;\n\n            const existing = module.loadStoredContacts();\n            const filtered = existing.filter(c => c.id !== id);\n\n            if (module.saveContactsToStorage(filtered)) {\n                this.render();\n            } else {\n                alert('Failed to delete contact.');\n            }\n        },\n\n        showEditModal(contactId) {\n            const module = global.cineFeaturesContacts;\n            if (!module) return;\n\n            let contact = {};\n            let isNew = true;\n\n            if (contactId) {\n                const existing = module.loadStoredContacts();\n                const found = existing.find(c => c.id === contactId);\n                if (found) {\n                    contact = { ...found };\n                    isNew = false;\n                }\n            }\n\n            // Defaults\n            if (isNew) {\n                contact = {\n                    name: '',\n                    role: '',\n                    phone: '',\n                    email: '',\n                    website: '',\n                    notes: '',\n                    avatar: ''\n                };\n            }\n\n            // Remove existing modal if any\n            const existingModal = document.querySelector('.v2-modal-backdrop');\n            if (existingModal) existingModal.remove();\n\n            const backdrop = document.createElement('div');\n            backdrop.className = 'v2-modal-backdrop';\n\n            const roles = [\n                'DoP', '1st AC', '2nd AC', 'Camera Operator', 'DIT', 'Data Wrangler',\n                'VTR/Playback', 'Gaffer', 'Best Boy', 'Key Grip', 'Grip', 'Sound Mixer',\n                'Boom Operator', 'PA', 'Director', 'Producer', 'Line Producer', 'Production Manager',\n                'Rental House', 'Post House', 'Agency', 'Client'\n            ];\n\n            backdrop.innerHTML = `\n                <div class=\"v2-modal contact-modal\">\n                    <div class=\"v2-modal-header\">\n                        <h3 class=\"v2-modal-title\">${isNew ? _t('modalTitleNewContact') : _t('modalTitleEditContact')}</h3>\n                        <button type=\"button\" class=\"v2-modal-close v2-btn v2-btn-ghost\"><span class=\"icon\">close</span></button>\n                    </div>\n                    <div class=\"v2-modal-body contacts-modal-body\">\n                        \n                        <!-- Avatar Upload Section -->\n                        <div class=\"avatar-upload-section\" id=\"avatarDropZone\">\n                            <div class=\"avatar-preview\" id=\"modalAvatarPreview\">\n                                ${contact.avatar ? `<img src=\"${contact.avatar}\">` : '<span class=\"icon\">person</span>'}\n                            </div>\n                            <div class=\"avatar-buttons\">\n                                <label class=\"v2-btn v2-btn-sm v2-btn-secondary\">\n                                    <span class=\"icon\" style=\"font-size:14px; margin-right:4px;\">upload</span>\n                                    ${_t('buttonUploadPhoto')}\n                                    <input type=\"file\" id=\"avatarUploadInput\" accept=\"image/*\" hidden>\n                                </label>\n                                <button type=\"button\" class=\"v2-btn v2-btn-sm v2-btn-ghost text-danger\" id=\"removeAvatarBtn\" ${!contact.avatar ? 'disabled' : ''}>\n                                    ${_t('buttonRemovePhoto')}\n                                </button>\n                            </div>\n                            <div class=\"avatar-hint\">${_t('avatarHint') || 'Drag & drop or click to upload'}</div>\n                        </div>\n\n                        <!-- Basic Info Section -->\n                        <div class=\"contact-form-section\">\n                            <div class=\"contact-form-section-title\">\n                                <span class=\"icon\">badge</span>\n                                ${_t('sectionBasicInfo') || 'Basic Information'}\n                            </div>\n                            \n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelName')}</label>\n                                <div class=\"v2-input-group\">\n                                    <span class=\"input-icon\"><span class=\"icon\">person</span></span>\n                                    <input type=\"text\" id=\"contactName\" class=\"v2-input\" value=\"${escapeHtml(contact.name)}\" placeholder=\"${_t('placeholderFullName')}\" required>\n                                </div>\n                            </div>\n\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelRole')}</label>\n                                <div class=\"v2-input-group\">\n                                    <span class=\"input-icon\"><span class=\"icon\">work</span></span>\n                                    <input type=\"text\" id=\"contactRole\" class=\"v2-input\" value=\"${escapeHtml(contact.role)}\" list=\"roleList\" placeholder=\"${_t('placeholderRole')}\">\n                                </div>\n                                <datalist id=\"roleList\">\n                                    ${roles.map(r => `<option value=\"${r}\">`).join('')}\n                                </datalist>\n                            </div>\n                        </div>\n\n                        <!-- Contact Details Section -->\n                        <div class=\"contact-form-section\">\n                            <div class=\"contact-form-section-title\">\n                                <span class=\"icon\">contacts</span>\n                                ${_t('sectionContactDetails') || 'Contact Details'}\n                            </div>\n\n                            <div class=\"detail-row-group\">\n                                <div class=\"v2-form-group\">\n                                    <label class=\"v2-label\">${_t('labelPhone')}</label>\n                                    <div class=\"v2-input-group\">\n                                        <span class=\"input-icon\"><span class=\"icon\">call</span></span>\n                                        <input type=\"tel\" id=\"contactPhone\" class=\"v2-input\" value=\"${escapeHtml(contact.phone)}\" placeholder=\"${_t('placeholderPhone')}\">\n                                    </div>\n                                </div>\n                                \n                                <div class=\"v2-form-group\">\n                                    <label class=\"v2-label\">${_t('labelEmail')}</label>\n                                    <div class=\"v2-input-group\">\n                                        <span class=\"input-icon\"><span class=\"icon\">mail</span></span>\n                                        <input type=\"email\" id=\"contactEmail\" class=\"v2-input\" value=\"${escapeHtml(contact.email)}\" placeholder=\"${_t('placeholderEmail')}\">\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelWebsite')}</label>\n                                <div class=\"v2-input-group\">\n                                    <span class=\"input-icon\"><span class=\"icon\">language</span></span>\n                                    <input type=\"url\" id=\"contactWebsite\" class=\"v2-input\" value=\"${escapeHtml(contact.website)}\" placeholder=\"${_t('placeholderWebsite')}\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Notes Section -->\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('labelNotes')}</label>\n                            <textarea id=\"contactNotes\" class=\"v2-input\" rows=\"3\" placeholder=\"${_t('placeholderNotes')}\">${escapeHtml(contact.notes)}</textarea>\n                        </div>\n\n                    </div>\n                    <div class=\"v2-modal-footer\">\n                        <button type=\"button\" class=\"v2-btn v2-btn-secondary\" id=\"btn-cancel-contact\">${_t('buttonCancel')}</button>\n                        <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"btn-save-contact\">\n                            <span class=\"icon\" style=\"font-size:16px; margin-right:4px;\">save</span>\n                            ${_t('buttonSaveContact')}\n                        </button>\n                    </div>\n                </div>\n            `;\n\n            document.body.appendChild(backdrop);\n            requestAnimationFrame(() => backdrop.classList.add('open'));\n\n            // --- Modal Events ---\n            const close = () => {\n                backdrop.classList.remove('open');\n                setTimeout(() => backdrop.remove(), 200);\n            };\n\n            backdrop.querySelector('.v2-modal-close').onclick = close;\n            backdrop.querySelector('#btn-cancel-contact').onclick = close;\n\n            // Avatar Handling\n            const avatarInput = backdrop.querySelector('#avatarUploadInput');\n            const avatarPreview = backdrop.querySelector('#modalAvatarPreview');\n            const removeAvatarBtn = backdrop.querySelector('#removeAvatarBtn');\n            let currentAvatar = contact.avatar || '';\n\n            avatarInput.onchange = (e) => {\n                const file = e.target.files[0];\n                if (!file) return;\n\n                // Use the profile module's helpers if available, or basic reader\n                if (global.CINE_CONTACTS_PROFILE_MODULE) {\n                    global.CINE_CONTACTS_PROFILE_MODULE.readAvatarFile(file, (dataUrl) => {\n                        currentAvatar = dataUrl;\n                        avatarPreview.innerHTML = `<img src=\"${dataUrl}\">`;\n                        removeAvatarBtn.disabled = false;\n                    }, (err) => {\n                        alert('Error reading image: ' + err);\n                    });\n                } else {\n                    // Fallback\n                    const reader = new FileReader();\n                    reader.onload = (ev) => {\n                        currentAvatar = ev.target.result;\n                        avatarPreview.innerHTML = `<img src=\"${currentAvatar}\">`;\n                        removeAvatarBtn.disabled = false;\n                    };\n                    reader.readAsDataURL(file);\n                }\n            };\n\n            removeAvatarBtn.onclick = () => {\n                currentAvatar = '';\n                avatarPreview.innerHTML = '<span class=\"icon\">person</span>';\n                removeAvatarBtn.disabled = true;\n                avatarInput.value = '';\n            };\n\n            // Save\n            backdrop.querySelector('#btn-save-contact').onclick = () => {\n                const name = backdrop.querySelector('#contactName').value.trim();\n                if (!name) {\n                    alert(_t('alertEnterName'));\n                    return;\n                }\n\n                // Construct new object\n                const entry = {\n                    id: contactId || undefined, // let module generate if undefined\n                    name: name,\n                    role: backdrop.querySelector('#contactRole').value.trim(),\n                    phone: backdrop.querySelector('#contactPhone').value.trim(),\n                    email: backdrop.querySelector('#contactEmail').value.trim(),\n                    website: backdrop.querySelector('#contactWebsite').value.trim(),\n                    notes: backdrop.querySelector('#contactNotes').value.trim(),\n                    avatar: currentAvatar\n                };\n\n                // Use module to normalize and save\n                const allContacts = module.loadStoredContacts();\n\n                // If editing, remove old entry from list first (to replace it in same position or re-sort)\n                // Actually, the module's save helper replaces the whole list.\n                // We should add/update in the array.\n\n                let updatedList;\n                if (isNew) {\n                    // Normalize to get ID\n                    const normalized = module.normalizeContactEntry(entry);\n                    updatedList = [...allContacts, normalized];\n                } else {\n                    updatedList = allContacts.map(c => {\n                        if (c.id === contactId) {\n                            return module.normalizeContactEntry({ ...c, ...entry });\n                        }\n                        return c;\n                    });\n                }\n\n                // Sort\n                updatedList = module.sortContacts(updatedList);\n\n                if (module.saveContactsToStorage(updatedList)) {\n                    this.render();\n                    close();\n                } else {\n                    alert('Failed to save contact.');\n                }\n            };\n        }\n    };\n\n    global.cineContactsView = ContactsView;\n\n})(typeof window !== 'undefined' ? window : this);\n","(function () {\n    'use strict';\n\n    const VIEW_ID = 'view-settings';\n\n    let isInitialized = false;\n\n    // =====================\n    // HELPERS\n    // =====================\n    function _t(key) {\n        if (typeof window !== 'undefined' && window.texts) {\n            // 1. Get current language\n            const langSelect = document.getElementById('languageSelect');\n            const lang = (langSelect && langSelect.value) ||\n                (typeof window.currentLanguage === 'string' && window.currentLanguage) ||\n                'en';\n\n            // 2. Get correct dictionary\n            const dict = window.texts[lang] || window.texts['en'];\n\n            if (dict) {\n                return key.split('.').reduce((o, i) => (o ? o[i] : null), dict) || key;\n            }\n        }\n        return key;\n    }\n\n    // Map V2 element IDs to Legacy element IDs and types\n    const SETTINGS_MAP = [\n        // --- General ---\n        { v2: 'v2-settings-language', legacy: 'settingsLanguage', type: 'value' },\n        { v2: 'v2-settings-temp-unit', legacy: 'settingsTemperatureUnit', type: 'value' },\n        { v2: 'v2-settings-focus-scale', legacy: 'settingsFocusScale', type: 'value' },\n        { v2: 'v2-settings-dark-mode', legacy: 'settingsDarkMode', type: 'checkbox' },\n        { v2: 'v2-settings-pink-mode', legacy: 'settingsPinkMode', type: 'checkbox' },\n        { v2: 'v2-settings-accent-color', legacy: 'accentColorInput', type: 'color' },\n        { v2: 'v2-settings-font-size', legacy: 'settingsFontSize', type: 'value' },\n        { v2: 'v2-settings-font-family', legacy: 'settingsFontFamily', type: 'value' },\n\n        // Camera Constants\n        { v2: 'v2-cam-color-a', legacy: 'cameraColorA', type: 'color' },\n        { v2: 'v2-cam-color-b', legacy: 'cameraColorB', type: 'color' },\n        { v2: 'v2-cam-color-c', legacy: 'cameraColorC', type: 'color' },\n        { v2: 'v2-cam-color-d', legacy: 'cameraColorD', type: 'color' },\n        { v2: 'v2-cam-color-e', legacy: 'cameraColorE', type: 'color' },\n\n        // --- Accessibility ---\n        { v2: 'v2-settings-high-contrast', legacy: 'settingsHighContrast', type: 'checkbox' },\n        { v2: 'v2-settings-reduce-motion', legacy: 'settingsReduceMotion', type: 'checkbox' },\n        { v2: 'v2-settings-relaxed-spacing', legacy: 'settingsRelaxedSpacing', type: 'checkbox' },\n\n        // Mount Voltages\n        { v2: 'v2-volt-v-high', legacy: 'mountVoltageVHigh', type: 'value' },\n        { v2: 'v2-volt-v-low', legacy: 'mountVoltageVLow', type: 'value' },\n        { v2: 'v2-volt-gold-high', legacy: 'mountVoltageGoldHigh', type: 'value' },\n        { v2: 'v2-volt-gold-low', legacy: 'mountVoltageGoldLow', type: 'value' },\n        { v2: 'v2-volt-b-high', legacy: 'mountVoltageBHigh', type: 'value' },\n        { v2: 'v2-volt-b-low', legacy: 'mountVoltageBLow', type: 'value' },\n\n        // --- Backup & Restore ---\n        { v2: 'v2-settings-auto-backup', legacy: 'settingsShowAutoBackups', type: 'checkbox' },\n        { v2: 'v2-settings-backup-retention', legacy: 'autoGearBackupRetention', type: 'value' },\n\n        // --- Logging ---\n        { v2: 'v2-settings-log-level', legacy: 'loggingLevelFilter', type: 'value' },\n        { v2: 'v2-settings-log-history', legacy: 'loggingHistoryLimit', type: 'value' },\n        { v2: 'v2-settings-log-filter', legacy: 'loggingNamespaceFilter', type: 'value' },\n        { v2: 'v2-settings-log-console', legacy: 'loggingConsoleOutput', type: 'checkbox' },\n        { v2: 'v2-settings-log-capture', legacy: 'loggingCaptureConsole', type: 'checkbox' },\n        { v2: 'v2-settings-log-errors', legacy: 'loggingCaptureErrors', type: 'checkbox' },\n        { v2: 'v2-settings-log-persist', legacy: 'loggingPersistSession', type: 'checkbox' },\n    ];\n\n    const SettingsView = {\n        init() {\n            this.container = document.getElementById(VIEW_ID);\n            if (!this.container) {\n                console.error(`[SettingsView] Container element with ID '${VIEW_ID}' not found.`);\n                return;\n            }\n\n            if (!isInitialized) {\n                console.log('[SettingsView] Initializing...');\n\n                // View Change Listener\n                document.addEventListener('v2:viewchange', (e) => {\n                    if (e.detail && e.detail.view === 'settings') {\n                        this.render();\n                    }\n                });\n\n                // Language Change Listener (Standard DOM event from Legacy Shim)\n                const legacySelect = document.getElementById('languageSelect');\n                if (legacySelect) {\n                    legacySelect.addEventListener('change', () => {\n                        // Re-render if currently visible to apply translations\n                        if (this.isVisible()) {\n                            this.render();\n                        }\n                    });\n                }\n\n                // Also listen for custom v2 event if invoked programmatically (e.g. from Sidebar)\n                document.addEventListener('v2:languagechange', () => {\n                    if (this.isVisible()) {\n                        this.render();\n                    }\n                });\n\n                isInitialized = true;\n            }\n        },\n\n        isVisible() {\n            return this.container && this.container.classList.contains('active');\n        },\n\n        render() {\n            if (!this.container) {\n                this.init();\n                if (!this.container) return;\n            }\n\n            // Generate HTML (Always regenerate to apply new translations)\n            this.container.innerHTML = this.getTemplate();\n\n            // Initialize Logic (Re-attach listeners to new DOM)\n            this.attachListeners();\n            this.syncFromLegacy();\n            this.initTabs();\n            this.initRehearsalSync();\n            this.initStatusObservers();\n            this.initBackupDiffSync();\n            this.initLogViewerSync();\n        },\n\n        getTemplate() {\n            return `\n            <div class=\"v2-modal-header\">\n                <h2>${_t('settingsHeading')}</h2>\n                <button class=\"v2-modal-close\" id=\"v2-settings-close\" aria-label=\"${_t('buttonClose')}\">\n                    <span class=\"icon\">close</span>\n                </button>\n            </div>\n            \n            <nav class=\"v2-tabs-nav v2-settings-tabs-nav\" role=\"tablist\" aria-label=\"${_t('settingsHeading')}\">\n                <button type=\"button\" class=\"v2-tab-btn active\" data-tab=\"general\" role=\"tab\" aria-selected=\"true\" aria-controls=\"v2-panel-general\">\n                    ${_t('settingsTabGeneral')}\n                </button>\n                <button type=\"button\" class=\"v2-tab-btn\" data-tab=\"backup\" role=\"tab\" aria-selected=\"false\" aria-controls=\"v2-panel-backup\">\n                    ${_t('settingsTabBackup')}\n                </button>\n                <button type=\"button\" class=\"v2-tab-btn\" data-tab=\"data\" role=\"tab\" aria-selected=\"false\" aria-controls=\"v2-panel-data\">\n                    ${_t('settingsTabData')}\n                </button>\n                <button type=\"button\" class=\"v2-tab-btn\" data-tab=\"about\" role=\"tab\" aria-selected=\"false\" aria-controls=\"v2-panel-about\">\n                    ${_t('settingsTabAbout')}\n                </button>\n            </nav>\n\n            <div class=\"v2-settings-body\">\n                ${this.getGeneralTabHtml()}\n                ${this.getBackupTabHtml()}\n                ${this.getDataTabHtml()}\n                ${this.getAboutTabHtml()}\n            </div>\n            <div class=\"v2-settings-footer\">\n                <button class=\"v2-btn v2-btn-primary\" id=\"v2-settings-done\">${_t('buttonClose')}</button>\n            </div>\n            \n            <!-- Modals -->\n            ${this.getBackupDiffModalHtml()}\n            ${this.getRehearsalModalHtml()}\n        `;\n        },\n\n        getGeneralTabHtml() {\n            return `\n            <div class=\"v2-settings-panel active\" id=\"v2-panel-general\">\n                <h2>${_t('settingsTabGeneral')}</h2>\n                \n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">language</span> ${_t('generalSectionLanguageHeading')}</h3>\n                    <div class=\"v2-form-grid\">\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('languageSetting')}</label>\n                            <select class=\"v2-select\" id=\"v2-settings-language\">\n                                <option value=\"en\">English</option>\n                                <option value=\"de\">Deutsch</option>\n                                <option value=\"es\">Espaol</option>\n                                <option value=\"fr\">Franais</option>\n                                <option value=\"it\">Italiano</option>\n                            </select>\n                        </div>\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('temperatureUnitSetting')}</label>\n                            <select class=\"v2-select\" id=\"v2-settings-temp-unit\">\n                                <option value=\"celsius\">${_t('temperatureUnitCelsius')}</option>\n                                <option value=\"fahrenheit\">${_t('temperatureUnitFahrenheit')}</option>\n                            </select>\n                        </div>\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('focusScaleSetting')}</label>\n                            <select class=\"v2-select\" id=\"v2-settings-focus-scale\">\n                                <option value=\"metric\">${_t('focusScaleMetric')}</option>\n                                <option value=\"imperial\">${_t('focusScaleImperial')}</option>\n                            </select>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">palette</span> ${_t('generalSectionAppearanceHeading')}</h3>\n                    <div class=\"v2-checkbox-group\">\n                        <label class=\"v2-toggle-row\">\n                            <span class=\"v2-toggle-label\">${_t('darkModeSetting')}</span>\n                            <div class=\"v2-toggle-switch\">\n                                <input type=\"checkbox\" id=\"v2-settings-dark-mode\">\n                                <span class=\"v2-toggle-slider\"></span>\n                            </div>\n                        </label>\n                        <label class=\"v2-toggle-row\">\n                            <span class=\"v2-toggle-label\">${_t('pinkModeSetting')}</span>\n                            <div class=\"v2-toggle-switch\">\n                                <input type=\"checkbox\" id=\"v2-settings-pink-mode\">\n                                <span class=\"v2-toggle-slider\"></span>\n                            </div>\n                        </label>\n                    </div>\n                    <div class=\"v2-form-group\" style=\"margin-top: 1rem;\">\n                        <label class=\"v2-label\">${_t('accentColorSetting')}</label>\n                        <div class=\"v2-color-input-wrapper\">\n                            <input type=\"color\" class=\"v2-color-input\" id=\"v2-settings-accent-color\">\n                            <button class=\"v2-btn v2-btn-sm v2-btn-secondary\" id=\"v2-accent-reset\">${_t('buttonReset')}</button>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">battery_charging_full</span> ${_t('mountVoltageSettingsHeading')}</h3>\n                    <p>${_t('mountVoltageDescription')}</p>\n                    \n                    <div class=\"v2-form-grid v2-voltage-grid\">\n                        \n                        <!-- V-Mount -->\n                        <div class=\"v2-voltage-card\">\n                            <h4>${_t('mountVoltageCardLabelV')}</h4>\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label v2-voltage-label-small\">${_t('mountVoltageHighLabel')}</label>\n                                <input type=\"number\" class=\"v2-input\" id=\"v2-volt-v-high\" step=\"0.1\" min=\"0\">\n                            </div>\n                            <div class=\"v2-form-group\" style=\"margin-top: 0.5rem;\">\n                                <label class=\"v2-label v2-voltage-label-small\">${_t('mountVoltageLowLabel')}</label>\n                                <input type=\"number\" class=\"v2-input\" id=\"v2-volt-v-low\" step=\"0.1\" min=\"0\">\n                            </div>\n                        </div>\n\n                        <!-- Gold Mount -->\n                        <div class=\"v2-voltage-card\">\n                            <h4>${_t('mountVoltageCardLabelGold')}</h4>\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label v2-voltage-label-small\">${_t('mountVoltageHighLabel')}</label>\n                                <input type=\"number\" class=\"v2-input\" id=\"v2-volt-gold-high\" step=\"0.1\" min=\"0\">\n                            </div>\n                             <div class=\"v2-form-group\" style=\"margin-top: 0.5rem;\">\n                                <label class=\"v2-label v2-voltage-label-small\">${_t('mountVoltageLowLabel')}</label>\n                                <input type=\"number\" class=\"v2-input\" id=\"v2-volt-gold-low\" step=\"0.1\" min=\"0\">\n                            </div>\n                        </div>\n\n                        <!-- B-Mount -->\n                        <div class=\"v2-voltage-card\">\n                            <h4>${_t('mountVoltageCardLabelB')}</h4>\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label v2-voltage-label-small\">${_t('mountVoltageHighLabel')}</label>\n                                <input type=\"number\" class=\"v2-input\" id=\"v2-volt-b-high\" step=\"0.1\" min=\"0\">\n                            </div>\n                             <div class=\"v2-form-group\" style=\"margin-top: 0.5rem;\">\n                                <label class=\"v2-label v2-voltage-label-small\">${_t('mountVoltageLowLabel')}</label>\n                                <input type=\"number\" class=\"v2-input\" id=\"v2-volt-b-low\" step=\"0.1\" min=\"0\">\n                            </div>\n                        </div>\n                    </div>\n                     <div style=\"margin-top: 1rem;\">\n                        <button class=\"v2-btn v2-btn-sm v2-btn-secondary\" id=\"v2-volt-reset\">${_t('mountVoltageReset')}</button>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">color_lens</span> ${_t('generalSectionCameraColorsHeading')}</h3>\n                    <p>${_t('cameraColorSettingDescription')}</p>\n                    <div class=\"v2-camera-colors-grid\">\n                        <div class=\"v2-color-field\">\n                            <label>${_t('cameraColorALabel')}</label>\n                            <input type=\"color\" class=\"v2-color-input\" id=\"v2-cam-color-a\">\n                        </div>\n                        <div class=\"v2-color-field\">\n                            <label>${_t('cameraColorBLabel')}</label>\n                            <input type=\"color\" class=\"v2-color-input\" id=\"v2-cam-color-b\">\n                        </div>\n                        <div class=\"v2-color-field\">\n                            <label>${_t('cameraColorCLabel')}</label>\n                            <input type=\"color\" class=\"v2-color-input\" id=\"v2-cam-color-c\">\n                        </div>\n                        <div class=\"v2-color-field\">\n                            <label>${_t('cameraColorDLabel')}</label>\n                            <input type=\"color\" class=\"v2-color-input\" id=\"v2-cam-color-d\">\n                        </div>\n                        <div class=\"v2-color-field\">\n                            <label>${_t('cameraColorELabel')}</label>\n                            <input type=\"color\" class=\"v2-color-input\" id=\"v2-cam-color-e\">\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">tune</span> ${_t('generalSectionInterfaceHeading')}</h3>\n                    <p>${_t('generalSectionInterfaceHelp')}</p>\n                    <div class=\"v2-checkbox-group\">\n                        <label class=\"v2-toggle-row\">\n                             <span class=\"v2-toggle-label\">${_t('checkboxHighContrast')}</span>\n                             <div class=\"v2-toggle-switch\">\n                                 <input type=\"checkbox\" id=\"v2-settings-high-contrast\">\n                                 <span class=\"v2-toggle-slider\"></span>\n                             </div>\n                        </label>\n                        <label class=\"v2-toggle-row\">\n                             <span class=\"v2-toggle-label\">${_t('checkboxReduceMotion')}</span>\n                             <div class=\"v2-toggle-switch\">\n                                 <input type=\"checkbox\" id=\"v2-settings-reduce-motion\">\n                                 <span class=\"v2-toggle-slider\"></span>\n                             </div>\n                        </label>\n                         <label class=\"v2-toggle-row\">\n                             <span class=\"v2-toggle-label\">${_t('checkboxRelaxedSpacing')}</span>\n                             <div class=\"v2-toggle-switch\">\n                                 <input type=\"checkbox\" id=\"v2-settings-relaxed-spacing\">\n                                 <span class=\"v2-toggle-slider\"></span>\n                             </div>\n                        </label>\n                    </div>\n                    \n                    <div class=\"v2-form-group\" style=\"margin-top: 1rem;\">\n                        <label class=\"v2-label\">${_t('fontSizeSetting')}</label>\n                        <select class=\"v2-select\" id=\"v2-settings-font-size\">\n                            <option value=\"13px\">Small (13px)</option>\n                            <option value=\"14px\">Medium (14px)</option>\n                            <option value=\"15px\">Large (15px)</option>\n                            <option value=\"16px\">X-Large (16px)</option>\n                        </select>\n                         <p class=\"v2-help-text\">${_t('fontSizeSettingHelp')}</p>\n                    </div>\n                     <div class=\"v2-form-group\">\n                        <label class=\"v2-label\">${_t('fontFamilySetting')}</label>\n                        <select class=\"v2-select\" id=\"v2-settings-font-family\">\n                            <option value=\"Inter, system-ui, sans-serif\">Inter (Default)</option>\n                            <option value=\"Roboto, sans-serif\">Roboto</option>\n                            <option value=\"Open Sans, sans-serif\">Open Sans</option>\n                            <option value=\"system-ui, sans-serif\">System UI</option>\n                        </select>\n                         <p class=\"v2-help-text\">${_t('fontFamilySettingHelp')}</p>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">verified</span> ${_t('generalSectionBrandingHeading')}</h3>\n                    <p>${_t('logoSettingHelp')}</p>\n                    <div class=\"v2-branding-preview\" id=\"v2-branding-preview\" style=\"margin-bottom: 1rem; padding: 1rem; border: 1px dashed var(--v2-border-default); border-radius: var(--v2-radius-sm); text-align: center;\">\n                        <span style=\"color: var(--v2-text-muted);\">${_t('brandingNoLogo')}</span>\n                    </div>\n                    <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-branding-upload\">\n                        <span class=\"icon\">upload</span> ${_t('buttonUploadSvg')}\n                    </button>\n                    <!-- Legacy File Input is hidden and clicked via proxy -->\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">history_edu</span> ${_t('documentationTrackerHeading')}</h3>\n                    <p>${_t('documentationTrackerDescription')}</p>\n                    <div class=\"v2-doc-tracker-list\" id=\"v2-doc-tracker-list\" style=\"margin: 1rem 0; border: 1px solid var(--v2-border-default); border-radius: var(--v2-radius-sm); min-height: 50px;\">\n                        <!-- Mirrored Items -->\n                        <p style=\"padding: 1rem; color: var(--v2-text-muted); text-align: center;\">${_t('documentationTrackerEmptyShort')}</p>\n                    </div>\n                    <button class=\"v2-btn v2-btn-sm v2-btn-primary\" id=\"v2-btn-doc-tracker-add\">\n                        ${_t('documentationTrackerAddRelease')}\n                    </button>\n                </div>\n            </div>\n        `;\n        },\n\n        getBackupTabHtml() {\n            return `\n            <div class=\"v2-settings-panel\" id=\"v2-panel-backup\" hidden>\n                <h2>${_t('settingsTabBackup')}</h2>\n                \n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">cloud_sync</span> ${_t('settingsBackupAutomatedHeading')}</h3>\n                    <div class=\"v2-form-group\">\n                        <label class=\"v2-toggle-row\">\n                            <span class=\"v2-toggle-label\">${_t('checkboxAutoBackupList')}</span>\n                            <div class=\"v2-toggle-switch\">\n                                <input type=\"checkbox\" id=\"v2-settings-auto-backup\">\n                                <span class=\"v2-toggle-slider\"></span>\n                            </div>\n                        </label>\n                    </div>\n                    <div class=\"v2-form-group\" style=\"margin-top: 1rem;\">\n                        <label class=\"v2-label\">${_t('labelBackupRetention')}</label>\n                        <input type=\"number\" class=\"v2-input\" id=\"v2-settings-backup-retention\" min=\"1\" max=\"50\" style=\"max-width: 120px;\">\n                    </div>\n                    <!-- Compare Versions (Diff) -->\n                    <div style=\"margin-top: 1rem;\">\n                        <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-backup-diff\">\n                            <span class=\"icon\">compare_arrows</span>\n                            ${_t('buttonCompareVersions')}\n                        </button>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">save</span> ${_t('settingsBackupManualHeading')}</h3>\n                    <div class=\"v2-form-row-inline\">\n                        <button class=\"v2-btn v2-btn-primary\" id=\"v2-btn-backup\">\n                            <span class=\"icon\">download</span>\n                            ${_t('buttonDownloadBackup')}\n                        </button>\n                        <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-restore\">\n                            <span class=\"icon\">upload</span>\n                            ${_t('buttonRestore')}\n                        </button>\n                        <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-restore-rehearsal\">\n                            <span class=\"icon\">science</span>\n                            ${_t('buttonRestoreRehearsal')}\n                        </button>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\" style=\"border-color: var(--v2-status-error);\">\n                    <h3 style=\"color: var(--v2-status-error);\"><span class=\"icon\">warning</span> ${_t('settingsBackupDangerHeading')}</h3>\n                    <p>${_t('settingsFactoryResetHelp')}</p>\n                    <button class=\"v2-btn v2-btn-danger\" id=\"v2-btn-factory-reset\">\n                        <span class=\"icon\">delete_forever</span>\n                        ${_t('buttonFactoryReset')}\n                    </button>\n                </div>\n            </div>\n        `;\n        },\n\n        getBackupDiffModalHtml() {\n            return `\n            <div class=\"v2-modal-backdrop\" id=\"v2-backup-diff-modal\" style=\"display: none;\">\n                <div class=\"v2-modal\" role=\"dialog\" aria-modal=\"true\" style=\"max-width: 700px; width: 90%; max-height: 90vh; display: flex; flex-direction: column;\">\n                    <div class=\"v2-modal-header\">\n                        <h3>${_t('backupDiffModalTitle')}</h3>\n                        <button class=\"v2-btn-icon\" data-action=\"close-diff\">close</button>\n                    </div>\n                    <div class=\"v2-modal-content\" style=\"overflow-y: auto;\">\n                        <p style=\"color: var(--v2-text-secondary); margin-bottom: 1.5rem;\">\n                            ${_t('backupDiffModalSubtitle')}\n                        </p>\n                        \n                        <div class=\"v2-form-grid\">\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelBaselineVersion')}</label>\n                                <select class=\"v2-select\" id=\"v2-diff-primary\"></select>\n                            </div>\n                            <div class=\"v2-form-group\">\n                                <label class=\"v2-label\">${_t('labelComparisonVersion')}</label>\n                                <select class=\"v2-select\" id=\"v2-diff-secondary\"></select>\n                            </div>\n                        </div>\n\n                        <div id=\"v2-diff-summary\" style=\"margin: 1rem 0; font-weight: 500;\"></div>\n\n                        <!-- Diff List Mirror -->\n                        <div class=\"v2-diff-list-container\" style=\"border: 1px solid var(--v2-border-default); border-radius: var(--v2-radius-sm); padding: 0.5rem; min-height: 100px; max-height: 300px; overflow-y: auto;\">\n                            <ul id=\"v2-diff-list\" style=\"list-style: none; padding: 0; margin: 0;\"></ul>\n                            <p id=\"v2-diff-empty\" style=\"text-align: center; color: var(--v2-text-muted); padding: 2rem;\">\n                                ${_t('backupDiffEmptyState')}\n                            </p>\n                        </div>\n\n                        <div class=\"v2-form-group\" style=\"margin-top: 1rem;\">\n                            <label class=\"v2-label\">${_t('labelIncidentNotes')}</label>\n                            <textarea class=\"v2-textarea\" id=\"v2-diff-notes\" rows=\"3\" placeholder=\"${_t('placeholderIncidentNotes')}\"></textarea>\n                        </div>\n                    </div>\n                    <div class=\"v2-modal-footer\">\n                        <button class=\"v2-btn v2-btn-secondary\" data-action=\"close-diff\">${_t('buttonClose')}</button>\n                        <button class=\"v2-btn v2-btn-primary\" id=\"v2-btn-diff-export\">${_t('buttonExportLog')}</button>\n                    </div>\n                </div>\n            </div>\n        `;\n        },\n\n        getDataTabHtml() {\n            return `\n            <div class=\"v2-settings-panel\" id=\"v2-panel-data\" hidden>\n                <h2>${_t('settingsTabData')}</h2>\n                \n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">storage</span> ${_t('settingsDataStorageStatusHeading')}</h3>\n                    <div class=\"v2-key-value-list\">\n                         <div class=\"v2-kv-item\">\n                            <span class=\"v2-kv-label\">${_t('labelLatestProjectSave')}</span>\n                            <span class=\"v2-kv-value\" id=\"v2-status-last-project\">---</span>\n                        </div>\n                        <div class=\"v2-kv-item\">\n                            <span class=\"v2-kv-label\">${_t('labelLatestAutoBackup')}</span>\n                            <span class=\"v2-kv-value\" id=\"v2-status-last-auto\">---</span>\n                        </div>\n                         <div class=\"v2-kv-item\">\n                            <span class=\"v2-kv-label\">${_t('labelLatestFullBackup')}</span>\n                            <span class=\"v2-kv-value\" id=\"v2-status-last-full\">---</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">sd_storage</span> ${_t('settingsDataPersistenceHeading')}</h3>\n                    <p>${_t('textManageLocalData')}</p>\n                    <div class=\"v2-form-row-inline\" style=\"margin-bottom: 1rem;\">\n                        <button class=\"v2-btn v2-btn-primary\" id=\"v2-btn-data-backup\">\n                            <span class=\"icon\">download</span>\n                            ${_t('buttonDownloadFullBackup')}\n                        </button>\n                    </div>\n                    <p>${_t('textRequestPersistence')}</p>\n                    <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-storage-persist\">\n                        ${_t('buttonRequestPersistence')}\n                    </button>\n                    <p id=\"v2-status-persistence\" style=\"margin-top: 0.5rem; color: var(--v2-text-secondary); font-size: 0.9rem;\">\n                        ${_t('statusCheckingPersistence')}\n                    </p>\n                </div>\n\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">terminal</span> ${_t('settingsDataLoggingHeading')}</h3>\n                    <div class=\"v2-form-grid\">\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('labelLogLevel')}</label>\n                            <select class=\"v2-select\" id=\"v2-settings-log-level\">\n                                <option value=\"all\">${_t('optionLogLevelAll')}</option>\n                                <option value=\"info\">${_t('optionLogLevelInfo')}</option>\n                                <option value=\"warn\">${_t('optionLogLevelWarn')}</option>\n                                <option value=\"error\">${_t('optionLogLevelError')}</option>\n                            </select>\n                        </div>\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('labelHistoryLimit')}</label>\n                            <input type=\"number\" class=\"v2-input\" id=\"v2-settings-log-history\" min=\"50\" max=\"2000\" step=\"50\">\n                        </div>\n                         <div class=\"v2-form-group\" style=\"grid-column: span 2;\">\n                            <label class=\"v2-label\">${_t('labelNamespaceFilter')}</label>\n                            <input type=\"search\" class=\"v2-input\" id=\"v2-settings-log-filter\" placeholder=\"e.g. storage, backup\">\n                        </div>\n                    </div>\n                    <div class=\"v2-checkbox-group\" style=\"margin-top: 1rem;\">\n                        <label class=\"v2-toggle-row\">\n                            <span class=\"v2-toggle-label\">${_t('checkboxMirrorConsole')}</span>\n                            <div class=\"v2-toggle-switch\">\n                                <input type=\"checkbox\" id=\"v2-settings-log-console\">\n                                <span class=\"v2-toggle-slider\"></span>\n                            </div>\n                        </label>\n                        <label class=\"v2-toggle-row\">\n                            <span class=\"v2-toggle-label\">${_t('checkboxCaptureConsole')}</span>\n                            <div class=\"v2-toggle-switch\">\n                                <input type=\"checkbox\" id=\"v2-settings-log-capture\">\n                                <span class=\"v2-toggle-slider\"></span>\n                            </div>\n                        </label>\n                        <label class=\"v2-toggle-row\">\n                            <span class=\"v2-toggle-label\">${_t('checkboxCaptureGlobalErrors')}</span>\n                            <div class=\"v2-toggle-switch\">\n                                <input type=\"checkbox\" id=\"v2-settings-log-errors\">\n                                <span class=\"v2-toggle-slider\"></span>\n                            </div>\n                        </label>\n                        <label class=\"v2-toggle-row\">\n                            <span class=\"v2-toggle-label\">${_t('checkboxPersistSession')}</span>\n                            <div class=\"v2-toggle-switch\">\n                                <input type=\"checkbox\" id=\"v2-settings-log-persist\">\n                                <span class=\"v2-toggle-slider\"></span>\n                            </div>\n                        </label>\n                    </div>\n                    \n                    <!-- Log Viewer Mirror -->\n                    <div class=\"v2-log-viewer\" style=\"margin-top: 1rem; border: 1px solid var(--v2-border-default); background: var(--v2-surface-muted); height: 200px; overflow-y: auto; padding: 0.5rem; font-family: monospace; font-size: 0.85rem; border-radius: var(--v2-radius-sm);\">\n                        <ol id=\"v2-log-history-list\" style=\"margin: 0; padding-left: 1.5rem;\">\n                            <!-- Mirrored Items -->\n                        </ol>\n                         <p id=\"v2-log-empty\" style=\"text-align: center; color: var(--v2-text-muted); display: none;\">${_t('textNoLogEntries')}</p>\n                    </div>\n\n                    <div class=\"v2-form-row\" style=\"margin-top: 1rem;\">\n                        <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-export-log\">${_t('buttonExportLog')}</button>\n                    </div>\n                </div>\n            </div>\n        `;\n        },\n\n        getAboutTabHtml() {\n            // We'll read the version from legacy\n            const legacyVersion = document.getElementById('aboutVersion')?.textContent || 'v2.0';\n\n            return `\n            <div class=\"v2-settings-panel\" id=\"v2-panel-about\" hidden>\n                <h2>${_t('settingsTabAbout')}</h2>\n                <div class=\"v2-settings-card\">\n                    <h3><span class=\"icon\">info</span> ${_t('appTitle')}</h3>\n                    <p class=\"v2-text-lead\" style=\"font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem;\">${legacyVersion}</p>\n                    <p>${_t('appCreator')}</p>\n                    \n                    <div class=\"v2-form-row-inline\" style=\"margin-top: 1.5rem;\">\n                        <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-support\">${_t('buttonSupport')}</button>\n                        <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-bug\">${_t('buttonReportBug')}</button>\n                        <button class=\"v2-btn v2-btn-secondary\" id=\"v2-btn-feature\">${_t('buttonSuggestFeature')}</button>\n                    </div>\n                </div>\n            </div>\n        `;\n        },\n\n        getRehearsalModalHtml() {\n            return `\n            <div class=\"v2-modal-backdrop\" id=\"v2-rehearsal-modal\" style=\"display: none;\">\n                <div class=\"v2-modal\" role=\"dialog\" aria-modal=\"true\" style=\"max-width: 600px; width: 90%;\">\n                    <div class=\"v2-modal-header\">\n                        <h3>${_t('buttonRestoreRehearsal')}</h3>\n                        <button class=\"v2-btn-icon\" data-action=\"close-rehearsal\">close</button>\n                    </div>\n                    <div class=\"v2-modal-content\">\n                        <p style=\"color: var(--v2-text-secondary); margin-bottom: 1.5rem;\">\n                            ${_t('rehearsalModalSubtitle')}\n                        </p>\n\n                        <!-- Source Selection -->\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('rehearsalModalSourceLabel')}</label>\n                            <div class=\"v2-radio-group\" id=\"v2-rehearsal-mode-group\">\n                                <label class=\"v2-radio-label\">\n                                    <input type=\"radio\" class=\"v2-radio\" name=\"v2RehearsalMode\" value=\"backup\" checked>\n                                    ${_t('rehearsalModalSourceBackup')}\n                                </label>\n                                <label class=\"v2-radio-label\">\n                                    <input type=\"radio\" class=\"v2-radio\" name=\"v2RehearsalMode\" value=\"project\">\n                                    ${_t('rehearsalModalSourceProject')}\n                                </label>\n                            </div>\n                        </div>\n\n                        <!-- File Input -->\n                        <div class=\"v2-form-group\" style=\"margin-top: 1.5rem;\">\n                            <label class=\"v2-label\">${_t('labelSelectFile')}</label>\n                            <div style=\"display: flex; gap: 1rem; align-items: center;\">\n                                <button class=\"v2-btn v2-btn-secondary\" id=\"v2-rehearsal-browse-btn\">\n                                    <span class=\"icon\">folder_open</span>\n                                    ${_t('buttonChooseFile')}\n                                </button>\n                                <span id=\"v2-rehearsal-filename\" style=\"color: var(--v2-text-secondary); font-style: italic;\">${_t('labelNoFileSelected')}</span>\n                            </div>\n                        </div>\n\n                        <!-- Legacy Status Mirror -->\n                        <div id=\"v2-rehearsal-status\" style=\"margin-top: 1rem; font-weight: 500;\"></div>\n\n                        <!-- Table Mirror -->\n                        <div style=\"margin-top: 1.5rem; border: 1px solid var(--v2-border-default); border-radius: var(--v2-radius-md); overflow: hidden;\">\n                            <table class=\"v2-table\" style=\"width: 100%;\">\n                                <thead style=\"background: var(--v2-surface-muted);\">\n                                    <tr>\n                                        <th style=\"padding: 0.75rem; text-align: left;\">${_t('tableHeaderData')}</th>\n                                        <th style=\"padding: 0.75rem; text-align: left;\">${_t('tableHeaderDifference')}</th>\n                                    </tr>\n                                </thead>\n                                <tbody id=\"v2-rehearsal-table-body\">\n                                    <!-- Mirrored rows will go here -->\n                                    <tr><td colspan=\"2\" style=\"padding: 1rem; text-align: center; color: var(--v2-text-muted);\">Load a file to compare...</td></tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n                        <div class=\"v2-modal-footer\" style=\"margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 0.5rem;\">\n                            <!-- Abort is effectively Close, triggers restoreRehearsalAbort -->\n                            <button class=\"v2-btn v2-btn-secondary\" id=\"v2-rehearsal-abort-btn\">Abort Rehearsal</button>\n                            <button class=\"v2-btn v2-btn-primary\" id=\"v2-rehearsal-proceed-btn\">Resume Restore</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        },\n\n        attachListeners() {\n            // Tab Switching\n            const tabs = this.container.querySelectorAll('.v2-tab-btn');\n            const panels = this.container.querySelectorAll('.v2-settings-panel');\n\n            tabs.forEach(tab => {\n                tab.addEventListener('click', () => {\n                    // Deactivate all\n                    tabs.forEach(t => {\n                        t.classList.remove('active');\n                        t.setAttribute('aria-selected', 'false');\n                    });\n                    panels.forEach(p => p.hidden = true);\n\n                    // Activate clicked\n                    tab.classList.add('active');\n                    tab.setAttribute('aria-selected', 'true');\n                    const targetId = `v2-panel-${tab.dataset.tab}`;\n                    const target = document.getElementById(targetId);\n                    if (target) target.hidden = false;\n                });\n            });\n\n            // Sync Logic for Map Items\n            SETTINGS_MAP.forEach(item => {\n                const v2El = document.getElementById(item.v2);\n                if (!v2El) return; // Element not found (e.g. might be in a hidden modal not yet rendered, or just missing)\n\n                const legacyEl = document.getElementById(item.legacy);\n                if (!legacyEl) {\n                    console.warn(`[SettingsView] Legacy element '${item.legacy}' not found.`);\n                    return;\n                }\n\n                v2El.addEventListener('change', (e) => {\n                    if (item.type === 'checkbox') {\n                        legacyEl.checked = e.target.checked;\n                    } else {\n                        legacyEl.value = e.target.value;\n                    }\n\n                    // Trigger events on legacy element\n                    legacyEl.dispatchEvent(new Event('change', { bubbles: true }));\n                    legacyEl.dispatchEvent(new Event('input', { bubbles: true }));\n\n                    // Trigger Save for specific elements that require application via applySettingsAndCloseDialog\n                    const SAVE_REQUIRED_IDS = [\n                        'settingsLanguage',\n                        'settingsTemperatureUnit',\n                        'settingsFocusScale',\n                        'settingsFontSize',\n                        'settingsFontFamily',\n                        'mountVoltageVHigh', 'mountVoltageVLow',\n                        'mountVoltageGoldHigh', 'mountVoltageGoldLow',\n                        'mountVoltageBHigh', 'mountVoltageBLow'\n                    ];\n\n                    if (SAVE_REQUIRED_IDS.includes(item.legacy)) {\n                        const saveBtn = document.getElementById('settingsSave');\n                        if (saveBtn) saveBtn.click();\n                    }\n                });\n            });\n\n            // Special handling for Logo Upload (File Input)\n            const legacyLogo = document.getElementById('settingsLogo');\n            if (legacyLogo) {\n                legacyLogo.addEventListener('change', () => {\n                    const saveBtn = document.getElementById('settingsSave');\n                    if (saveBtn) saveBtn.click();\n                });\n            }\n\n            // Button Actions (Proxy to Legacy)\n            const bindClick = (v2Id, legacyId) => {\n                const v2Btn = document.getElementById(v2Id);\n                const legacyBtn = document.getElementById(legacyId);\n                if (v2Btn && legacyBtn) {\n                    v2Btn.addEventListener('click', () => legacyBtn.click());\n                }\n            };\n\n            bindClick('v2-btn-reset-accent', 'accentColorReset');\n            bindClick('v2-btn-reset-voltages', 'mountVoltageReset');\n            bindClick('v2-btn-backup', 'backupSettings');\n            bindClick('v2-btn-restore', 'restoreSettings');\n            bindClick('v2-btn-factory-reset', 'factoryResetButton');\n            bindClick('v2-btn-data-backup', 'storageBackupNow');\n            bindClick('v2-btn-storage-persist', 'storagePersistenceRequest');\n            bindClick('v2-btn-export-log', 'loggingExportBtn');\n            bindClick('v2-btn-support', 'supportLink');\n            bindClick('v2-btn-bug', 'reportBugLink');\n            bindClick('v2-btn-feature', 'suggestFeatureLink');\n            bindClick('v2-btn-local-font', 'localFontsButton');\n            bindClick('v2-btn-branding-upload', 'settingsLogo');\n            bindClick('v2-btn-doc-tracker-add', 'documentationTrackerAddRelease');\n\n            // Backup Diff Button\n            const diffBtn = document.getElementById('v2-btn-backup-diff');\n            if (diffBtn) {\n                diffBtn.addEventListener('click', () => {\n                    // 1. Open Modal\n                    const modal = document.getElementById('v2-backup-diff-modal');\n                    if (modal) modal.style.display = 'flex';\n                    // 2. Trigger Legacy Toggle to ensure hidden sections are initialized if needed\n                    const legBtn = document.getElementById('backupDiffToggleButton');\n                    if (legBtn) legBtn.click();\n                });\n            }\n\n            // Close Diff Modal\n            const closeDiffBtns = this.container.querySelectorAll('[data-action=\"close-diff\"]');\n            closeDiffBtns.forEach(btn => {\n                btn.addEventListener('click', () => {\n                    const modal = document.getElementById('v2-backup-diff-modal');\n                    if (modal) modal.style.display = 'none';\n                    // Trigger legacy toggle close (optional, to keep state synced)\n                    const legBtn = document.getElementById('backupDiffToggleButton');\n                    if (legBtn) legBtn.click();\n                });\n            });\n\n            // Restore Rehearsal Modal\n            const rehearsalTrigger = document.getElementById('v2-btn-restore-rehearsal');\n            const rehearsalModal = document.getElementById('v2-rehearsal-modal');\n            const closeRehearsalBtns = this.container.querySelectorAll('[data-action=\"close-rehearsal\"]');\n\n            if (rehearsalTrigger && rehearsalModal) {\n                rehearsalTrigger.addEventListener('click', () => {\n                    // Click legacy button to init logic\n                    const legacyBtn = document.getElementById('restoreRehearsalButton');\n                    if (legacyBtn) legacyBtn.click();\n\n                    rehearsalModal.style.display = 'flex';\n                });\n            }\n\n            closeRehearsalBtns.forEach(btn => {\n                btn.addEventListener('click', () => {\n                    if (rehearsalModal) rehearsalModal.style.display = 'none';\n                    const legacyClose = document.getElementById('restoreRehearsalClose');\n                    if (legacyClose) legacyClose.click();\n                });\n            });\n        },\n\n        syncFromLegacy() {\n            SETTINGS_MAP.forEach(item => {\n                const v2El = document.getElementById(item.v2);\n                const legacyEl = document.getElementById(item.legacy);\n\n                if (v2El && legacyEl) {\n                    if (item.type === 'checkbox') {\n                        v2El.checked = legacyEl.checked;\n                    } else if (item.type === 'value' || item.type === 'color') {\n                        v2El.value = legacyEl.value;\n                    }\n                }\n            });\n        },\n\n        initStatusObservers() {\n            const obsConfigs = [\n                { legacyId: 'storageStatusLastProjectValue', v2Id: 'v2-status-last-project' },\n                { legacyId: 'storageStatusLastAutoBackupValue', v2Id: 'v2-status-last-auto' },\n                { legacyId: 'storageStatusLastFullBackupValue', v2Id: 'v2-status-last-full' },\n                { legacyId: 'storagePersistenceStatus', v2Id: 'v2-status-persistence' }\n            ];\n\n            const observer = new MutationObserver(() => {\n                obsConfigs.forEach(cfg => {\n                    const leg = document.getElementById(cfg.legacyId);\n                    const v2 = document.getElementById(cfg.v2Id);\n                    if (leg && v2) {\n                        v2.textContent = leg.textContent;\n                    }\n                });\n            });\n\n            obsConfigs.forEach(cfg => {\n                const leg = document.getElementById(cfg.legacyId);\n                if (leg) {\n                    observer.observe(leg, { childList: true, characterData: true, subtree: true });\n                    const v2 = document.getElementById(cfg.v2Id);\n                    if (v2) v2.textContent = leg.textContent;\n                }\n            });\n\n            // Branding & Doc Tracker\n            const extraObsConfigs = [\n                { legacyId: 'localFontsStatus', v2Id: 'v2-status-local-font' }\n            ];\n            const extraObserver = new MutationObserver(() => {\n                extraObsConfigs.forEach(cfg => {\n                    const leg = document.getElementById(cfg.legacyId);\n                    const v2 = document.getElementById(cfg.v2Id);\n                    if (leg && v2) v2.textContent = leg.textContent;\n                });\n            });\n            extraObsConfigs.forEach(cfg => {\n                const leg = document.getElementById(cfg.legacyId);\n                if (leg) extraObserver.observe(leg, { childList: true, characterData: true, subtree: true });\n            });\n\n            // Branding Preview\n            const legacyLogoPreview = document.getElementById('settingsLogoPreview');\n            const v2LogoPreview = document.getElementById('v2-branding-preview');\n            if (legacyLogoPreview && v2LogoPreview) {\n                const logoObs = new MutationObserver(() => {\n                    if (legacyLogoPreview.hidden || legacyLogoPreview.innerHTML.trim() === '') {\n                        v2LogoPreview.innerHTML = '<span style=\"color: var(--v2-text-muted);\">No custom logo set</span>';\n                    } else {\n                        v2LogoPreview.innerHTML = legacyLogoPreview.innerHTML;\n                        const img = v2LogoPreview.querySelector('img, svg');\n                        if (img) {\n                            img.style.maxWidth = '100%';\n                            img.style.height = 'auto';\n                        }\n                    }\n                });\n                logoObs.observe(legacyLogoPreview, { childList: true, attributes: true, subtree: true });\n                if (!legacyLogoPreview.hidden && legacyLogoPreview.innerHTML.trim() !== '') {\n                    v2LogoPreview.innerHTML = legacyLogoPreview.innerHTML;\n                }\n            }\n\n            // Doc Tracker\n            const legacyDocList = document.getElementById('documentationTrackerList');\n            const v2DocList = document.getElementById('v2-doc-tracker-list');\n            if (legacyDocList && v2DocList) {\n                const docObs = new MutationObserver(() => {\n                    if (legacyDocList.children.length === 0) {\n                        v2DocList.innerHTML = '<p style=\"padding: 1rem; color: var(--v2-text-muted); text-align: center;\">No releases tracked.</p>';\n                    } else {\n                        v2DocList.innerHTML = '';\n                        Array.from(legacyDocList.children).forEach(item => {\n                            const clone = item.cloneNode(true);\n                            clone.style.padding = '0.5rem';\n                            clone.style.borderBottom = '1px solid var(--v2-border-subtle)';\n                            v2DocList.appendChild(clone);\n                        });\n                    }\n                });\n                docObs.observe(legacyDocList, { childList: true, subtree: true });\n            }\n        },\n\n        initTabs() {\n            const activeTab = this.container.querySelector('.v2-tab-btn.active');\n            if (activeTab) {\n                const targetId = `v2-panel-${activeTab.dataset.tab}`;\n                const targetPanel = document.getElementById(targetId);\n                if (targetPanel) targetPanel.hidden = false;\n            }\n        },\n\n        initRehearsalSync() {\n            const v2Radios = document.querySelectorAll('input[name=\"v2RehearsalMode\"]');\n            const legacyRadios = document.getElementsByName('restoreRehearsalMode');\n\n            v2Radios.forEach(v2Radio => {\n                v2Radio.addEventListener('change', () => {\n                    legacyRadios.forEach(legRadio => {\n                        if (legRadio.value === v2Radio.value) {\n                            legRadio.checked = true;\n                            legRadio.dispatchEvent(new Event('change', { bubbles: true }));\n                        }\n                    });\n                });\n            });\n\n            const browseBtn = document.getElementById('v2-rehearsal-browse-btn');\n            const legacyBrowse = document.getElementById('restoreRehearsalBrowse');\n            if (browseBtn && legacyBrowse) {\n                browseBtn.addEventListener('click', () => legacyBrowse.click());\n            }\n\n            const proceedBtn = document.getElementById('v2-rehearsal-proceed-btn');\n            const abortBtn = document.getElementById('v2-rehearsal-abort-btn');\n\n            if (proceedBtn) {\n                proceedBtn.addEventListener('click', () => {\n                    // FIXED ID: restoreRehearsalProceed (not Button)\n                    const legProceed = document.getElementById('restoreRehearsalProceed');\n                    if (legProceed) legProceed.click();\n                    document.getElementById('v2-rehearsal-modal').style.display = 'none';\n                });\n            }\n            if (abortBtn) {\n                abortBtn.addEventListener('click', () => {\n                    // FIXED ID: restoreRehearsalAbort (not Button)\n                    const legAbort = document.getElementById('restoreRehearsalAbort');\n                    if (legAbort) legAbort.click();\n                });\n            }\n\n            // Sync Table\n            const legacyTableBody = document.getElementById('restoreRehearsalTableBody');\n            const v2TableBody = document.getElementById('v2-rehearsal-table-body');\n            const legacyFilename = document.getElementById('restoreRehearsalFileName');\n            const v2Filename = document.getElementById('v2-rehearsal-filename');\n            const legacyProceedBtn = document.getElementById('restoreRehearsalProceed');\n\n            if (legacyTableBody && v2TableBody) {\n                const observer = new MutationObserver(() => {\n                    v2TableBody.innerHTML = '';\n                    Array.from(legacyTableBody.children).forEach(row => {\n                        const cells = row.querySelectorAll('td');\n                        if (cells.length >= 4) {\n                            const metric = cells[0].textContent;\n                            const diff = cells[3].innerHTML;\n                            const newRow = document.createElement('tr');\n                            newRow.innerHTML = `\n                            <td style=\"padding: 0.75rem;\"><strong>${metric}</strong></td>\n                            <td style=\"padding: 0.75rem;\">${diff}</td>\n                        `;\n                            v2TableBody.appendChild(newRow);\n                        }\n                    });\n\n                    if (proceedBtn && legacyProceedBtn) {\n                        proceedBtn.disabled = legacyProceedBtn.disabled;\n                        if (legacyProceedBtn.style.display === 'none') {\n                            proceedBtn.style.display = 'none';\n                        } else {\n                            proceedBtn.style.display = 'inline-block';\n                        }\n                    }\n                });\n\n                observer.observe(legacyTableBody, { childList: true, subtree: true });\n\n                if (legacyProceedBtn) {\n                    const btnObserver = new MutationObserver(() => {\n                        if (proceedBtn) {\n                            proceedBtn.disabled = legacyProceedBtn.disabled;\n                            if (legacyProceedBtn.style.display === 'none') {\n                                proceedBtn.style.display = 'none';\n                            } else {\n                                proceedBtn.style.display = 'inline-block';\n                            }\n                        }\n                    });\n                    btnObserver.observe(legacyProceedBtn, { attributes: true });\n\n                    // Initial Sync\n                    if (proceedBtn) {\n                        proceedBtn.disabled = legacyProceedBtn.disabled;\n                        if (legacyProceedBtn.style.display === 'none') {\n                            proceedBtn.style.display = 'none';\n                        } else {\n                            proceedBtn.style.display = 'inline-block';\n                        }\n                    }\n                }\n            }\n\n            if (legacyFilename && v2Filename) {\n                const observer = new MutationObserver(() => {\n                    v2Filename.textContent = legacyFilename.textContent;\n                });\n                observer.observe(legacyFilename, { childList: true, characterData: true, subtree: true });\n            }\n        },\n\n        initBackupDiffSync() {\n            // Dropdowns\n            const v2Primary = document.getElementById('v2-diff-primary');\n            const v2Secondary = document.getElementById('v2-diff-secondary');\n            const legPrimary = document.getElementById('backupDiffPrimary');\n            const legSecondary = document.getElementById('backupDiffSecondary');\n\n            const syncSelects = () => {\n                if (v2Primary && legPrimary) {\n                    v2Primary.innerHTML = legPrimary.innerHTML;\n                    v2Primary.value = legPrimary.value;\n                }\n                if (v2Secondary && legSecondary) {\n                    v2Secondary.innerHTML = legSecondary.innerHTML;\n                    v2Secondary.value = legSecondary.value;\n                }\n            };\n\n            // Initial sync\n            syncSelects();\n\n            // Observe dropdowns\n            if (legPrimary && legSecondary) {\n                const obs = new MutationObserver(syncSelects);\n                obs.observe(legPrimary, { childList: true });\n                obs.observe(legSecondary, { childList: true });\n            }\n\n            // Bind V2 change to Legacy\n            if (v2Primary) {\n                v2Primary.addEventListener('change', () => {\n                    if (legPrimary) {\n                        legPrimary.value = v2Primary.value;\n                        legPrimary.dispatchEvent(new Event('change', { bubbles: true }));\n                    }\n                });\n            }\n            if (v2Secondary) {\n                v2Secondary.addEventListener('change', () => {\n                    if (legSecondary) {\n                        legSecondary.value = v2Secondary.value;\n                        legSecondary.dispatchEvent(new Event('change', { bubbles: true }));\n                    }\n                });\n            }\n\n            // Sync Summary & List\n            const legSummary = document.getElementById('backupDiffSummary');\n            const v2Summary = document.getElementById('v2-diff-summary');\n            if (legSummary && v2Summary) {\n                const obs = new MutationObserver(() => { v2Summary.innerHTML = legSummary.innerHTML; });\n                obs.observe(legSummary, { childList: true, subtree: true });\n            }\n\n            const legList = document.getElementById('backupDiffList');\n            const v2List = document.getElementById('v2-diff-list');\n            if (legList && v2List) {\n                const obs = new MutationObserver(() => {\n                    v2List.innerHTML = legList.innerHTML;\n                    // Adjust styles if needed\n                    Array.from(v2List.querySelectorAll('li')).forEach(li => {\n                        li.style.padding = '0.5rem';\n                        li.style.borderBottom = '1px solid var(--v2-border-subtle)';\n                    });\n                });\n                obs.observe(legList, { childList: true, subtree: true });\n            }\n\n            // Bind Export\n            const v2Export = document.getElementById('v2-btn-diff-export');\n            const legExport = document.getElementById('backupDiffExport');\n            if (v2Export && legExport) {\n                v2Export.addEventListener('click', () => legExport.click());\n            }\n\n            // Sync Notes\n            const v2Notes = document.getElementById('v2-diff-notes');\n            const legNotes = document.getElementById('backupDiffNotes');\n            if (v2Notes && legNotes) {\n                // Initial\n                v2Notes.value = legNotes.value;\n\n                // Bind V2 -> Legacy\n                v2Notes.addEventListener('input', () => {\n                    legNotes.value = v2Notes.value;\n                    legNotes.dispatchEvent(new Event('input', { bubbles: true }));\n                });\n\n                // Bind Legacy -> V2 (if changed by reset)\n                const obs = new MutationObserver(() => {\n                    if (document.activeElement !== v2Notes) {\n                        v2Notes.value = legNotes.value;\n                    }\n                });\n                obs.observe(legNotes, { attributes: true, attributeFilter: ['value'] }); // Note: value attribute only updates if set via setAttribute, rarely used for textareas. Logic reliance on input events is safer.\n\n                // Fallback polling or event listener on legacy if needed, but usually Notes are one-way user input.\n                legNotes.addEventListener('input', () => {\n                    if (document.activeElement !== v2Notes) {\n                        v2Notes.value = legNotes.value;\n                    }\n                });\n            }\n        },\n\n        initLogViewerSync() {\n            // Sync Log List\n            const legList = document.getElementById('loggingHistory');\n            const v2List = document.getElementById('v2-log-history-list');\n\n            if (legList && v2List) {\n                const obs = new MutationObserver(() => {\n                    v2List.innerHTML = legList.innerHTML;\n                    // Style adjustments for V2 monospace look\n                    Array.from(v2List.querySelectorAll('li')).forEach(li => {\n                        li.style.padding = '0.25rem 0';\n                        li.style.borderBottom = '1px dashed var(--v2-border-subtle)';\n                    });\n                });\n                obs.observe(legList, { childList: true, subtree: true });\n                // Initial\n                v2List.innerHTML = legList.innerHTML;\n            }\n        }\n    };\n\n    // Export to global for bootstrap\n    if (typeof window !== 'undefined') {\n        window.cineSettingsView = SettingsView;\n    }\n\n})(typeof window !== 'undefined' ? window : this);\n","/**\n * Cine Power Planner V2 - Owned Gear View\n * =======================================\n * Manages the \"Owned Gear\" view in the V2 UI.\n */\n\n(function (global) {\n    'use strict';\n\n    // =====================\n    // CONFIGURATION\n    // =====================\n    const VIEW_ID = 'view-own-gear';\n\n    // =====================\n    // STATE\n    // =====================\n    let isInitialized = false;\n\n    // =====================\n    // HELPER: ESCAPE HTML\n    // =====================\n    function escapeHtml(str) {\n        if (typeof str !== 'string') return '';\n        return str.replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n\n    function _t(key) {\n        if (typeof window !== 'undefined' && window.texts) {\n            const langSelect = document.getElementById('languageSelect');\n            const lang = (langSelect && langSelect.value) ||\n                (typeof window.currentLanguage === 'string' && window.currentLanguage) ||\n                'en';\n\n            const dict = window.texts[lang] || window.texts['en'];\n\n            if (dict) {\n                return key.split('.').reduce((o, i) => (o ? o[i] : null), dict) || key;\n            }\n        }\n        return key;\n    }\n\n    // =====================\n    // PUBLIC API\n    // =====================\n    const OwnGearView = {\n        container: null,\n\n        init() {\n            try {\n                this.container = document.getElementById(VIEW_ID);\n                if (!this.container) {\n                    // Try to create it if it doesn't exist\n                    this.createViewContainer();\n                }\n\n                if (!isInitialized) {\n                    console.log('[OwnGearView] Initializing...');\n                    document.addEventListener('v2:viewchange', (e) => {\n                        if (e.detail && e.detail.view === 'ownGear') {\n                            this.render();\n                        }\n                    });\n\n                    // Listen for language changes\n                    document.addEventListener('v2:languagechange', () => {\n                        if (this.isVisible()) this.render();\n                    });\n\n                    isInitialized = true;\n                    console.log('[OwnGearView] Initialized');\n                }\n            } catch (e) {\n                console.error('[OwnGearView] Init failed:', e);\n            }\n        },\n\n        isVisible() {\n            // Check if container is part of DOM and active\n            return this.container && !this.container.classList.contains('hidden') && this.container.style.display !== 'none';\n        },\n\n        createViewContainer() {\n            const container = document.querySelector('.v2-main') || document.querySelector('.v2-app') || document.body;\n            const view = document.createElement('section'); // Semantic HTML\n            view.id = VIEW_ID;\n            view.className = 'app-view';\n\n            // Should be hidden by default until activated\n            // CSS handles .app-view:not(.active) { display: none }\n\n            container.appendChild(view);\n            this.container = view;\n        },\n\n        render() {\n            try {\n                if (!this.container) {\n                    this.init();\n                    if (!this.container) return; // Still not there? Bail.\n                }\n\n                // Load items using the legacy store\n                // We'll use the cineFeaturesOwnGear global which exposes the API directly\n                const features = global.cineFeaturesOwnGear;\n\n                if (!features) {\n                    this.container.innerHTML = `\n                        <div class=\"v2-empty-state\">\n                            <p>${_t('statusUnavailable') || 'Module not available'}</p>\n                        </div>\n                    `;\n                    return;\n                }\n\n                const items = features.loadStoredOwnGearItems();\n\n                const header = `\n                    <header class=\"view-header\">\n                        <div class=\"header-content\">\n                            <h1>${_t('ownGearViewTitle')}</h1>\n                            <p class=\"header-subtitle\">${_t('ownGearViewSubtitle')}</p>\n                        </div>\n                        <div class=\"view-header-actions\">\n                            <button class=\"v2-btn v2-btn-primary\" id=\"btn-add-own-gear\">\n                                <span class=\"icon\">add</span>\n                                <span>${_t('buttonAddGearItem')}</span>\n                            </button>\n                        </div>\n                    </header>\n                `;\n\n                let contentHtml = '<div class=\"view-content\">';\n\n                if (!items || items.length === 0) {\n                    contentHtml += `\n                        <div class=\"own-gear-empty-state\">\n                            <span class=\"icon\">inventory_2</span>\n                            <h3>${_t('ownGearEmptyTitle')}</h3>\n                            <p>${_t('ownGearEmptyText')}</p>\n                            <button class=\"v2-btn v2-btn-primary\" id=\"btn-add-own-gear-empty\">\n                                ${_t('buttonAddFirstGearItem')}\n                            </button>\n                        </div>\n                    `;\n                } else {\n                    contentHtml += '<div class=\"own-gear-list\">';\n                    items.forEach(item => {\n                        contentHtml += this.renderItemRow(item);\n                    });\n                    contentHtml += '</div>';\n                }\n\n                contentHtml += '</div>'; // End view-content\n\n                this.container.innerHTML = header + contentHtml;\n                this.attachListeners();\n\n            } catch (err) {\n                console.error('[OwnGearView] Render failed', err);\n                if (this.container) {\n                    this.container.innerHTML = `<div class=\"v2-error-state\"><p>Error loading view: ${err.message}</p></div>`;\n                }\n            }\n        },\n\n        renderItemRow(item) {\n            return `\n                <div class=\"own-gear-item-card\" data-item-id=\"${escapeHtml(item.id)}\">\n                    <div class=\"own-gear-item-info\">\n                        <div class=\"own-gear-item-name\">${escapeHtml(item.name)}</div>\n                        ${item.notes ? `<div class=\"own-gear-item-notes\">${escapeHtml(item.notes)}</div>` : ''}\n                    </div>\n                     <div class=\"own-gear-item-meta\">\n                        ${item.quantity ? `<span class=\"own-gear-badge qty-badge\">${_t('labelQtyPrefix')}${escapeHtml(item.quantity)}</span>` : ''}\n                        ${item.source ? `<span class=\"own-gear-badge source-badge\">${_t('labelSourcePrefix')}${escapeHtml(item.source)}</span>` : ''}\n                    </div>\n                    <div class=\"own-gear-item-actions\">\n                        <button class=\"v2-btn v2-btn-icon v2-btn-ghost btn-edit-own-gear\" title=\"${_t('buttonEdit')}\" data-id=\"${escapeHtml(item.id)}\">\n                            <span class=\"icon\">edit</span>\n                        </button>\n                        <button class=\"v2-btn v2-btn-icon v2-btn-ghost btn-delete-own-gear\" title=\"${_t('buttonDelete')}\" data-id=\"${escapeHtml(item.id)}\">\n                            <span class=\"icon\">delete</span>\n                        </button>\n                    </div>\n                </div>\n            `;\n        },\n\n        attachListeners() {\n            const addBtn = this.container.querySelector('#btn-add-own-gear');\n            const addBtnEmpty = this.container.querySelector('#btn-add-own-gear-empty');\n\n            if (addBtn) addBtn.onclick = () => this.showEditModal(null);\n            if (addBtnEmpty) addBtnEmpty.onclick = () => this.showEditModal(null);\n\n            this.container.querySelectorAll('.btn-edit-own-gear').forEach(btn => {\n                btn.onclick = (e) => {\n                    e.stopPropagation();\n                    const id = e.currentTarget.dataset.id;\n                    if (id) this.showEditModal(id);\n                };\n            });\n\n            this.container.querySelectorAll('.btn-delete-own-gear').forEach(btn => {\n                btn.onclick = (e) => {\n                    e.stopPropagation();\n                    const id = e.currentTarget.dataset.id;\n                    if (id && confirm(_t('confirmDeleteGearItem'))) {\n                        this.deleteItem(id);\n                    }\n                };\n            });\n        },\n\n        deleteItem(id) {\n            const features = global.cineFeaturesOwnGear;\n            if (!features) return;\n\n            const existing = features.loadStoredOwnGearItems();\n            const filtered = existing.filter(i => i.id !== id);\n\n            if (features.persistOwnGearItems(filtered)) {\n                this.render();\n            } else {\n                alert(_t('alertSaveItemFailed'));\n            }\n        },\n\n        showEditModal(itemId) {\n            const features = global.cineFeaturesOwnGear;\n            if (!features) return;\n\n            let item = {};\n            let isNew = true;\n\n            if (itemId) {\n                const existing = features.loadStoredOwnGearItems();\n                const found = existing.find(i => i.id === itemId);\n                if (found) {\n                    item = { ...found };\n                    isNew = false;\n                }\n            }\n\n            // Defaults\n            if (isNew) {\n                item = {\n                    name: '',\n                    quantity: '',\n                    notes: '',\n                    source: ''\n                };\n            }\n\n            // Remove existing modal if any\n            const existingModal = document.querySelector('.v2-modal-backdrop');\n            if (existingModal) existingModal.remove();\n\n            const backdrop = document.createElement('div');\n            backdrop.className = 'v2-modal-backdrop';\n\n            backdrop.innerHTML = `\n                <div class=\"v2-modal\">\n                    <div class=\"v2-modal-header\">\n                        <h3 class=\"v2-modal-title\">${isNew ? _t('modalTitleNewGearItem') : _t('modalTitleEditGearItem')}</h3>\n                        <button type=\"button\" class=\"v2-modal-close v2-btn v2-btn-ghost\"><span class=\"icon\">close</span></button>\n                    </div>\n                    <div class=\"v2-modal-body own-gear-modal-body\">\n                        \n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('labelItemName')}</label>\n                            <input type=\"text\" id=\"ownGearName\" class=\"v2-input\" value=\"${escapeHtml(item.name)}\" placeholder=\"${_t('placeholderGearName')}\" required>\n                        </div>\n\n                         <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('labelQuantity')}</label>\n                            <input type=\"number\" id=\"ownGearQuantity\" class=\"v2-input\" value=\"${escapeHtml(item.quantity)}\" placeholder=\"${_t('placeholderGearQty')}\">\n                        </div>\n\n                        <div class=\"v2-form-group\">\n                            <label class=\"v2-label\">${_t('labelNotes')}</label>\n                            <textarea id=\"ownGearNotes\" class=\"v2-input\" rows=\"3\" placeholder=\"${_t('placeholderGearNotes')}\">${escapeHtml(item.notes)}</textarea>\n                        </div>\n\n                    </div>\n                    <div class=\"v2-modal-footer\">\n                        <button type=\"button\" class=\"v2-btn v2-btn-secondary\" id=\"btn-cancel-own-gear\">${_t('buttonCancel')}</button>\n                        <button type=\"button\" class=\"v2-btn v2-btn-primary\" id=\"btn-save-own-gear\">${_t('buttonSaveGearItem')}</button>\n                    </div>\n                </div>\n            `;\n\n            document.body.appendChild(backdrop);\n            requestAnimationFrame(() => backdrop.classList.add('open'));\n\n            // --- Modal Events ---\n            const close = () => {\n                backdrop.classList.remove('open');\n                setTimeout(() => backdrop.remove(), 200);\n            };\n\n            const nameInput = backdrop.querySelector('#ownGearName');\n            nameInput.focus();\n\n            backdrop.querySelector('.v2-modal-close').onclick = close;\n            backdrop.querySelector('#btn-cancel-own-gear').onclick = close;\n\n            // Save\n            backdrop.querySelector('#btn-save-own-gear').onclick = () => {\n                const name = nameInput.value.trim();\n                if (!name) {\n                    alert(_t('alertEnterName'));\n                    return;\n                }\n\n                // Construct new object\n                const entry = {\n                    id: itemId || undefined,\n                    name: name,\n                    quantity: backdrop.querySelector('#ownGearQuantity').value.trim(),\n                    notes: backdrop.querySelector('#ownGearNotes').value.trim()\n                };\n\n                // Use features to normalize and save\n                const allItems = features.loadStoredOwnGearItems();\n\n                let finalItem;\n                if (isNew) {\n                    finalItem = features.normalizeOwnGearRecord(entry);\n                } else {\n                    finalItem = features.normalizeOwnGearRecord({ ...item, ...entry });\n                }\n\n                if (!finalItem) {\n                    alert(_t('alertInvalidItemData'));\n                    return;\n                }\n\n                let updatedList;\n                if (isNew) {\n                    updatedList = [...allItems, finalItem];\n                } else {\n                    updatedList = allItems.map(i => i.id === itemId ? finalItem : i);\n                }\n\n                if (features.persistOwnGearItems(updatedList)) {\n                    this.render();\n                    close();\n                } else {\n                    alert(_t('alertSaveItemFailed'));\n                }\n            };\n        }\n    };\n\n    global.cineOwnGearView = OwnGearView;\n\n})(typeof window !== 'undefined' ? window : this);\n","/**\n * Cine Power Planner V2 - Help Data\n * =================================\n * Content for the V2 Help Center.\n */\n\n(function (global) {\n    'use strict';\n\n    const v2HelpData = [\n        {\n            id: 'v2-welcome',\n            title: 'Welcome to V2',\n            keywords: 'v2 new interface update overview navigation sidebar',\n            icon: '',\n            content: `\n                <p>Welcome to the new Cine Power Planner V2 interface! We've redesigned the experience to be faster, more intuitive, and fully responsive.</p>\n                \n                <h4>Key Improvements</h4>\n                <ul>\n                    <li><strong>New Sidebar Navigation:</strong> Quickly access Projects, Tools, and Settings from the dedicated sidebar. Mobile users can access this via the menu button in the header.</li>\n                    <li><strong>Enhanced Visuals:</strong> A modern, clean look with improved Dark Mode and Pink Mode support.</li>\n                    <li><strong>Better Performance:</strong> Faster loading times and smoother transitions between views.</li>\n                </ul>\n\n                <h4>Getting Around</h4>\n                <p>The sidebar is your main control center:</p>\n                <ul>\n                    <li><strong>Projects:</strong> View and manage all your power plans. Filter by Active or Archive.</li>\n                    <li><strong>Tools:</strong> Access the Device Library, Contacts, and Auto Gear Rules.</li>\n                    <li><strong>Settings:</strong> Configure app preferences, backup data, and manage storage.</li>\n                </ul>\n            `\n        },\n        {\n            id: 'v2-projects',\n            title: 'Managing Projects',\n            keywords: 'projects create new delete archive filter active dashboard',\n            icon: '',\n            content: `\n                <p>The Projects Dashboard is where your work begins.</p>\n                \n                <h4>Creating a Project</h4>\n                <p>Click the <strong>+ New Project</strong> button in the top right to start a fresh plan. You'll be prompted to enter a name and optional details.</p>\n\n                <h4>Project Status & Filtering</h4>\n                <p>Use the sidebar to filter your projects:</p>\n                <ul>\n                    <li><strong>All Projects:</strong> Everything you've created.</li>\n                    <li><strong>Active Projects:</strong> Projects you are currently working on.</li>\n                    <li><strong>Archive:</strong> Completed or on-hold projects. You can archive a project from its context menu.</li>\n                </ul>\n\n                <h4>Project Actions</h4>\n                <p>Right-click (or long-press on touch devices) on any project tile to access the context menu:</p>\n                <ul>\n                    <li><strong>Rename:</strong> Change the project details.</li>\n                    <li><strong>Duplicate:</strong> Create an exact copy of a project.</li>\n                    <li><strong>Archive/Unarchive:</strong> Move the project to or from the archive.</li>\n                    <li><strong>Delete:</strong> Permanently remove the project.</li>\n                </ul>\n            `\n        },\n        {\n            id: 'v2-device-library',\n            title: 'Device Library',\n            keywords: 'devices library equipment custom gear add edit database',\n            icon: '',\n            content: `\n                <p>The Device Library allows you to manage the equipment available for your power plans.</p>\n\n                <h4>Browsing Devices</h4>\n                <p>Devices are organized by category (Cameras, Monitors, etc.). Use the tabs or dropdowns to switch between categories. You can also use the search bar to find specific gear instantly.</p>\n\n                <h4>Adding Custom Gear</h4>\n                <p>Can't find your equipment? Click <strong>Add Device</strong> to create a custom entry. You'll need to specify:</p>\n                <ul>\n                    <li><strong>Name:</strong> The model name.</li>\n                    <li><strong>Power Draw:</strong> Typical power consumption in Watts (W).</li>\n                    <li><strong>Voltage:</strong> Operating voltage range (optional but recommended).</li>\n                </ul>\n                <p>Once added, custom devices are available for all your projects.</p>\n            `\n        },\n        {\n            id: 'v2-contacts',\n            title: 'Contacts',\n            keywords: 'contacts people crew rental houses list',\n            icon: '',\n            content: `\n                <p>Keep track of rental houses, crew members, and clients directly in the app.</p>\n\n                <h4>Managing Contacts</h4>\n                <ul>\n                    <li><strong>Add Contact:</strong> Click the <strong>New Contact</strong> button to add details like Name, Role, Phone, and Email.</li>\n                    <li><strong>Edit/Delete:</strong> Use the action buttons on each contact card to update or remove information.</li>\n                </ul>\n                <p>Contacts can be assigned to projects for quick reference (coming soon to project details).</p>\n            `\n        },\n        {\n            id: 'v2-settings',\n            title: 'Settings & Data',\n            keywords: 'settings preferences backup restore data storage theme language',\n            icon: '',\n            content: `\n                <p>Customize your experience and keep your data safe.</p>\n\n                <h4>Data Management</h4>\n                <ul>\n                    <li><strong>Backup:</strong> Download a full backup of all your projects and custom devices. We recommend doing this regularly.</li>\n                    <li><strong>Restore:</strong> Load a previously saved backup file. <em>Note: This replaces current data.</em></li>\n                    <li><strong>Auto-Backups:</strong> Enable automatic snapshots to protect against accidental data loss.</li>\n                </ul>\n\n                <h4>Preferences</h4>\n                <ul>\n                    <li><strong>Units:</strong> Toggle between Metric and Imperial measurements (if applicable).</li>\n                    <li><strong>Theme:</strong> Force Dark Mode, Light Mode, or the special Pink Mode.</li>\n                </ul>\n            `\n        },\n        {\n            id: 'v2-auto-gear',\n            title: 'Auto Gear Rules',\n            keywords: 'auto gear rules automation kit list scenarios production requirements',\n            icon: '',\n            content: `\n                <p>Automate your kit list generation with smart rules based on production scenarios.</p>\n\n                <h4>How it Works</h4>\n                <p>Auto Gear Rules monitor your project's <strong>Production Requirements</strong> (e.g., \"Handheld\", \"Studio\", \"Car Rig\") and automatically add or remove specific items from your kit list.</p>\n\n                <h4>Creating Rules</h4>\n                <p>Go to the <strong>Auto Gear Rules</strong> tool and click <strong>Add Rule</strong>. You can define:</p>\n                <ul>\n                    <li><strong>Conditions:</strong> Triggers based on scenarios, camera models, or other gear selections.</li>\n                    <li><strong>Actions:</strong> Items to <strong>Add</strong> (e.g., \"Shoulder Pad\" for \"Handheld\") or <strong>Remove</strong>.</li>\n                </ul>\n\n                <h4>Presets</h4>\n                <p>Save your favorite rule sets as <strong>Presets</strong> to quickly switch between different production styles (e.g., \"Narrative Feature\" vs \"Commercial\").</p>\n            `\n        },\n        {\n            id: 'v2-print-export',\n            title: 'Printing & Exporting',\n            keywords: 'print pdf export share report kit list diagram',\n            icon: '',\n            content: `\n                <p>Share your power plans with your team or rental house.</p>\n\n                <h4>Project Overview</h4>\n                <p>From the Project Detail view, use the <strong>Print / Export PDF</strong> button to generate a clean summary of your project, including power totals and battery estimates.</p>\n                \n                <h4>Kit List</h4>\n                <p>Generate a dedicated equipment list for quotes and prep. You can filter by department and customize columns before printing.</p>\n\n                <h4>Power Diagram</h4>\n                <p>Need a visual aid? Export the <strong>Connection Diagram</strong> as an image (PNG/JPG) or SVG to include in your tech pack.</p>\n\n                <h4>PDF Tips</h4>\n                <p>To save as a PDF, click \"Print\" and select <strong>\"Save as PDF\"</strong> as your destination in the print dialog.</p>\n            `\n        }\n    ];\n\n    // Migrated Legacy Topics\n    const migratedTopics = [\n        {\n            id: 'v2-quick-start',\n            title: 'Quick Start Checklist',\n            keywords: 'quickstart onboarding tutorial first steps workflow basics getting started new project guide',\n            icon: '',\n            content: `\n                <p>Welcome to Cine Power Planner! Follow these steps to get your first project ready.</p>\n                <ol>\n                    <li>\n                        <strong>Start Guided Tutorial:</strong>\n                        <button type=\"button\" class=\"button-link help-onboarding-secondary\" data-onboarding-tour-trigger=\"secondary\">Start guided tutorial</button>\n                        to walk through every workflow with offline progress tracking.\n                    </li>\n                    <li>\n                        <strong>Name Your Project:</strong>\n                        Enter a name in the <em>Project Name</em> field and click <strong>Save</strong> (or press <kbd>Enter</kbd>/<kbd>Ctrl</kbd>+<kbd>S</kbd>) to capture the current rig.\n                    </li>\n                    <li>\n                        <strong>Configure Devices:</strong>\n                        Walk through <em>Configure Devices</em>, check the <em>Power Summary</em>, and review the <em>Connection Diagram</em>.\n                    </li>\n                    <li>\n                        <strong>Secure Your Data:</strong>\n                        Download an <strong>Export Project</strong> JSON and a full-app <strong>Backup</strong> so you have two offline recovery copies.\n                    </li>\n                    <li>\n                        <strong>Check Offline Status:</strong>\n                        Confirm the offline indicator (in the header) glows before disconnecting.\n                    </li>\n                    <li>\n                        <strong>Rehearse Restore:</strong>\n                        Open <strong>Restore rehearsal</strong> in Settings to verify your backup in a sandbox environment.\n                    </li>\n                </ol>\n                <p class=\"help-callout-note\">\n                    Tip: Keep backups on separate drives when travelling<strong>Restore</strong> always creates a fresh safety copy so nothing is lost when you undo a change.\n                </p>\n            `\n        },\n        {\n            id: 'v2-data-safety',\n            title: 'Data Safety Essentials',\n            keywords: 'backup restore protect save export safety offline preserve',\n            icon: '',\n            content: `\n                <p>Protect your work with these essential habits.</p>\n                <ul>\n                    <li>\n                        <strong>Save Often:</strong> Press <strong>Save</strong> after meaningful tweaks. Manual saves are instant and work offline.\n                    </li>\n                    <li>\n                        <strong>Enable Auto Backups:</strong> Turn on \"Show auto backups in project list\" in Settings to surface background snapshots.\n                    </li>\n                    <li>\n                        <strong>Download Redundancy:</strong> Export your project and download a full Backup whenever you finish a milestone.\n                    </li>\n                    <li>\n                        <strong>Store Safely:</strong> Keep exports on at least two devices.\n                    </li>\n                    <li>\n                        <strong>Update Safely:</strong> Before approving an update, capture a fresh manual backup.\n                    </li>\n                </ul>\n                <p class=\"help-callout-note\">\n                    Manual backups bundle a timestamped copy of every saved project, favorite, rule, and preference. Restores make a safety snapshot first.\n                </p>\n            `\n        },\n        {\n            id: 'v2-shortcuts',\n            title: 'Essential Shortcuts',\n            keywords: 'keyboard shortcuts hotkeys fast navigation',\n            icon: '',\n            content: `\n                <ul>\n                    <li><kbd>?</kbd>, <kbd>H</kbd>, <kbd>F1</kbd>: Open Help</li>\n                    <li><kbd>Ctrl</kbd>+<kbd>/</kbd> (<kbd></kbd>+<kbd>/</kbd>): Toggle Help</li>\n                    <li><kbd>/</kbd> or <kbd>Ctrl</kbd>+<kbd>F</kbd> (<kbd></kbd>+<kbd>F</kbd>): Help Search</li>\n                    <li><kbd>Ctrl</kbd>+<kbd>K</kbd> (<kbd></kbd>+<kbd>K</kbd>): Global Feature Search</li>\n                    <li><kbd>Ctrl</kbd>+<kbd>,</kbd> (<kbd></kbd>+<kbd>,</kbd>): Open Settings</li>\n                    <li><kbd>Ctrl</kbd>+<kbd>S</kbd> (<kbd></kbd>+<kbd>S</kbd>): Save Project</li>\n                    <li><kbd>D</kbd>: Toggle Dark Mode</li>\n                    <li><kbd>P</kbd>: Toggle Pink Mode</li>\n                </ul>\n            `\n        },\n        {\n            id: 'v2-features',\n            title: 'Features at a Glance',\n            keywords: 'overview capabilities highlights offline favorites search',\n            icon: '',\n            content: `\n                <ul>\n                    <li><strong>Rig Planning:</strong> Configure cameras, monitors, and accessories in <em>Configure Devices</em>.</li>\n                    <li><strong>Power Analysis:</strong> Review draw and runtime in <em>Power Summary</em>.</li>\n                    <li><strong>Visual Diagram:</strong> Map connections with the interactive <em>Connection Diagram</em>.</li>\n                    <li><strong>Battery Comparison:</strong> Compare runtimes and output limits.</li>\n                    <li><strong>Device Library:</strong> Customize the database with your own gear.</li>\n                    <li><strong>Contacts & Own Gear:</strong> Manage crew info and personal kits.</li>\n                    <li><strong>Print & Export:</strong> Generate clean PDF summaries and kit lists.</li>\n                    <li><strong>Offline Capable:</strong> Works fully without an internet connection.</li>\n                    <li><strong>Customizable:</strong> Adjust themes (Dark, Light, Pink), fonts, and accent colors.</li>\n                </ul>\n            `\n        }\n    ];\n\n    // Combine\n    v2HelpData.push(...migratedTopics);\n\n    // Expose\n    global.cineV2HelpData = v2HelpData;\n\n})(typeof window !== 'undefined' ? window : this);\n","/**\n * Cine Power Planner V2 - Help Service\n * ====================================\n * Single source of truth for help content, merging V2 guides and V1 reference topics.\n */\n\n(function (global) {\n    'use strict';\n\n    // V2 \"Getting Started\" Content (Hardcoded for now, could be moved to localization later)\n    // V2 Content (Loaded from help-data.js)\n    const V2_TOPICS = global.cineV2HelpData || [];\n\n    // Helper to categorize topics\n    function getCategorizedV2Topics() {\n        const essentials = ['v2-quick-start', 'v2-shortcuts', 'v2-data-safety', 'v2-features'];\n\n        return {\n            essentials: V2_TOPICS.filter(t => essentials.includes(t.id)),\n            guides: V2_TOPICS.filter(t => !essentials.includes(t.id))\n        };\n    }\n\n    /**\n     * Parse simple Markdown-like syntax from translation strings into HTML\n     */\n    function parseMarkdown(text) {\n        if (!text) return '';\n        // Basic inline formatting\n        let html = text\n            .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n            .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n            .replace(/`(.*?)`/g, '<code>$1</code>');\n\n        // Split by double newlines to handle paragraphs and lists\n        return html.split(/\\n\\n+/).map(block => {\n            if (block.trim().startsWith('- ')) {\n                const items = block.trim().split(/\\n/).map(line => {\n                    return `<li>${line.replace(/^- /, '')}</li>`;\n                }).join('');\n                return `<ul>${items}</ul>`;\n            }\n            return `<p>${block}</p>`;\n        }).join('');\n    }\n\n    /**\n     * Get V1 help topics from localization system\n     */\n    function getV1Topics() {\n        // Try to access the localization helper globally\n        // It might be 'cineCoreLocalization' or a similar exposure\n        const localization = global.cineCoreLocalization ||\n            (global.cineModuleBase && global.cineModuleBase.resolveLocalization && global.cineModuleBase.resolveLocalization());\n\n        if (!localization || typeof localization.getString !== 'function') {\n            console.warn('[HelpService] Localization module not found. V1 topics unavailable.');\n            return [];\n        }\n\n        const topicKeys = [\n            'projectManagement',\n            'saveShareBackup',\n            'deviceConfiguration',\n            'powerCalculation',\n            'connectionDiagram',\n            'gearList',\n            'contacts',\n            'ownGear',\n            'settings',\n            'offlineUse',\n            'troubleshooting',\n            'shortcuts',\n            'pinkMode'\n        ];\n\n        const iconMap = {\n            projectManagement: '',\n            saveShareBackup: '',\n            deviceConfiguration: '',\n            powerCalculation: '',\n            connectionDiagram: '',\n            gearList: '',\n            contacts: '',\n            ownGear: '',\n            settings: '',\n            offlineUse: '',\n            troubleshooting: '',\n            shortcuts: '',\n            pinkMode: ''\n        };\n\n        return topicKeys.map(key => {\n            const title = localization.getString(`helpTopics.${key}.title`);\n            const content = localization.getString(`helpTopics.${key}.content`);\n\n            if (!title) return null;\n\n            return {\n                id: `v1-${key}`,\n                category: 'reference',\n                title: title,\n                // Keywords could be enriched here if we had a mapping, for now title + content is search source\n                keywords: 'legacy reference v1',\n                icon: iconMap[key] || '', // Default icon if key missing\n                content: parseMarkdown(content)\n            };\n        }).filter(item => item !== null);\n    }\n\n    /**\n     * Get all help sections, organized or flat\n     */\n    function getAllSections() {\n        const guideTopics = V2_TOPICS;\n        const refTopics = getV1Topics();\n\n        return [\n            ...guideTopics,\n            ...refTopics\n        ];\n    }\n\n    /**\n     * Get sections grouped by category for sidebar\n     */\n    function getGroupedSections() {\n        const v2 = getCategorizedV2Topics();\n\n        return {\n            essentials: {\n                title: 'Essentials',\n                items: v2.essentials\n            },\n            guide: {\n                title: 'Guides',\n                items: v2.guides\n            },\n            reference: {\n                title: 'Topic Reference',\n                items: getV1Topics()\n            }\n        };\n    }\n\n    // Public API\n    global.cineHelpService = {\n        getAllSections,\n        getGroupedSections\n    };\n\n})(typeof window !== 'undefined' ? window : this);\n","/**\n * Cine Power Planner V2 - Help View\n * =================================\n * Manages the Help Center view using the Help Service.\n */\n\n(function (global) {\n    'use strict';\n\n\n    const TOC_ID = 'v2HelpToc';\n    const CONTENT_ID = 'v2HelpContent';\n    const SEARCH_ID = 'v2HelpSearch';\n\n    let observer = null;\n    let isInitialized = false;\n\n    function getElement(id) {\n        return document.getElementById(id);\n    }\n\n    /**\n     * Render the Help Content from Service\n     */\n    function renderContent() {\n        const target = getElement(CONTENT_ID);\n        if (!target) return [];\n\n        target.innerHTML = '';\n        const tocInfo = [];\n\n        const service = global.cineHelpService;\n        if (!service) {\n            target.innerHTML = '<div class=\"v2-empty-state\"><p>Help service unavailable.</p></div>';\n            return [];\n        }\n\n        const grouped = service.getGroupedSections();\n\n        // 1. Render Getting Started (Guide)\n        if (grouped.guide && grouped.guide.items.length > 0) {\n            renderCategory(target, grouped.guide.title, grouped.guide.items, tocInfo);\n        }\n\n        // Divider if both exist\n        if (grouped.guide && grouped.guide.items.length > 0 &&\n            grouped.reference && grouped.reference.items.length > 0) {\n            const divider = document.createElement('hr');\n            divider.className = 'v2-help-divider';\n            target.appendChild(divider);\n        }\n\n        // 2. Render Reference\n        if (grouped.reference && grouped.reference.items.length > 0) {\n            renderCategory(target, grouped.reference.title, grouped.reference.items, tocInfo);\n        }\n\n        // Add Empty State container for Search\n        const emptyState = document.createElement('div');\n        emptyState.id = 'v2HelpNoResults';\n        emptyState.className = 'v2-help-no-results';\n        emptyState.style.display = 'none';\n        emptyState.innerHTML = `\n            <div class=\"v2-help-no-results-content\">\n                <span class=\"v2-help-no-results-icon\"></span>\n                <h3>No results found</h3>\n                <p>Try adjusting your search terms.</p>\n            </div>\n        `;\n        target.appendChild(emptyState);\n\n        return tocInfo;\n    }\n\n    /**\n     * Helper to render a category of topics\n     */\n    function renderCategory(container, title, items, tocList) {\n        // Add Category info to TOC list for headers\n        tocList.push({ type: 'header', title: title });\n\n        items.forEach(item => {\n            const section = document.createElement('section');\n            section.className = 'v2-help-section';\n            section.id = item.id;\n            // Add keywords for search\n            section.setAttribute('data-keywords', (item.keywords || '') + ' ' + (item.title || ''));\n\n            const header = document.createElement('h2');\n            if (item.icon) {\n                header.innerHTML = `<span class=\"v2-help-icon\">${item.icon}</span> ${item.title}`;\n            } else {\n                header.textContent = item.title;\n            }\n\n            const content = document.createElement('div');\n            content.className = 'v2-help-content-body';\n            content.innerHTML = item.content;\n\n            section.appendChild(header);\n            section.appendChild(content);\n            container.appendChild(section);\n\n            tocList.push({\n                type: 'item',\n                id: item.id,\n                title: item.title,\n                keywords: item.keywords,\n                icon: item.icon // Pass icon to TOC\n            });\n        });\n    }\n\n    /**\n     * Build the Table of Contents (Supporting Categories)\n     */\n    function buildToc(tocInfo) {\n        const tocContainer = getElement(TOC_ID);\n        if (!tocContainer) return;\n\n        tocContainer.innerHTML = '';\n        const ul = document.createElement('ul');\n\n        tocInfo.forEach(item => {\n            if (item.type === 'header') {\n                const li = document.createElement('li');\n                li.className = 'v2-help-toc-header';\n                li.textContent = item.title;\n                ul.appendChild(li);\n            } else {\n                const li = document.createElement('li');\n                const link = document.createElement('a');\n                link.href = `#${item.id}`;\n                link.className = 'v2-help-toc-link';\n                link.dataset.target = item.id; // Helper for scroll spy\n\n                // Add icon if available\n                if (item.icon) {\n                    link.innerHTML = `<span class=\"v2-toc-icon\">${item.icon}</span> ${item.title}`;\n                } else {\n                    link.textContent = item.title;\n                }\n\n                link.addEventListener('click', (e) => {\n                    e.preventDefault();\n                    const targetSection = document.getElementById(item.id);\n                    if (targetSection) {\n                        targetSection.scrollIntoView({ behavior: 'smooth' });\n                        // Removed history.pushState to avoid conflicting with SPA router\n                    }\n                    // Manual active state set (observer will correct it shortly if needed)\n                    updateActiveLink(item.id);\n                });\n\n                li.appendChild(link);\n                ul.appendChild(li);\n            }\n        });\n\n        tocContainer.appendChild(ul);\n    }\n\n    function updateActiveLink(id) {\n        document.querySelectorAll('.v2-help-toc-link').forEach(l => {\n            if (l.dataset.target === id) {\n                l.classList.add('active');\n            } else {\n                l.classList.remove('active');\n            }\n        });\n    }\n\n    /**\n     * Initialize Scroll Spy using IntersectionObserver\n     */\n    function initScrollSpy() {\n        if (observer) observer.disconnect();\n\n        const options = {\n            root: getElement(CONTENT_ID),\n            rootMargin: '-10% 0px -80% 0px', // Trigger when section is near top\n            threshold: 0\n        };\n\n        const callback = (entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    updateActiveLink(entry.target.id);\n                }\n            });\n        };\n\n        observer = new IntersectionObserver(callback, options);\n        document.querySelectorAll('.v2-help-section').forEach(section => {\n            observer.observe(section);\n        });\n    }\n\n    /**\n     * Initialize search functionality\n     */\n    /**\n     * Initialize search functionality\n     */\n    function initSearch() {\n        const searchInput = getElement(SEARCH_ID);\n        if (!searchInput) return;\n\n        // Create Clear Button\n        const clearBtn = document.createElement('button');\n        clearBtn.className = 'v2-help-search-clear';\n        clearBtn.innerHTML = '';\n        clearBtn.style.display = 'none';\n        clearBtn.ariaLabel = 'Clear search';\n\n        // Append to container (assuming container is relative/flex)\n        searchInput.parentNode.appendChild(clearBtn);\n\n        function performSearch() {\n            const term = searchInput.value.toLowerCase().trim();\n            const sections = document.querySelectorAll('.v2-help-section');\n            const noResults = getElement('v2HelpNoResults');\n            let hasVisible = false;\n\n            sections.forEach(section => {\n                const text = section.innerText.toLowerCase();\n                const keywords = (section.dataset.keywords || '').toLowerCase();\n                const match = text.includes(term) || keywords.includes(term);\n\n                section.style.display = match ? 'block' : 'none';\n                if (match) hasVisible = true;\n            });\n\n            // Toggle Dividers visibility based on search (hide if searching)\n            document.querySelectorAll('.v2-help-divider').forEach(div => {\n                div.style.display = term ? 'none' : 'block';\n            });\n\n            // Show/Hide No Results\n            if (noResults) {\n                noResults.style.display = !hasVisible && term ? 'flex' : 'none';\n            }\n\n            // Toggle Clear Button\n            clearBtn.style.display = term.length > 0 ? 'block' : 'none';\n        }\n\n        searchInput.addEventListener('input', performSearch);\n\n        clearBtn.addEventListener('click', () => {\n            searchInput.value = '';\n            performSearch();\n            searchInput.focus();\n        });\n    }\n\n    /**\n     * Initialize the view\n     */\n    function init() {\n        if (isInitialized) return;\n\n        console.log('[HelpView] Initializing...');\n\n        refresh();\n        initSearch();\n\n        isInitialized = true;\n    }\n\n    /**\n     * Refresh logic (useful for language changes)\n     */\n    function refresh() {\n        const tocInfo = renderContent();\n        if (tocInfo) {\n            buildToc(tocInfo);\n            // Re-init spy after content render\n            setTimeout(() => initScrollSpy(), 100);\n        }\n    }\n\n    /**\n     * Prepare view when entering\n     */\n    function enter() {\n        if (!isInitialized) {\n            init();\n        } else {\n            // Optional check for language update could go here\n        }\n    }\n\n    // Public API\n    global.cineHelpView = {\n        init,\n        enter,\n        refresh\n    };\n\n})(typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : this);\n","import { dataVault } from '../../modules/storage/DataVault.js';\nimport { storageRepo } from '../../modules/storage/StorageRepository.js';\n\nconst VIEW_ID = 'backups';\n\nexport const cineBackupsView = {\n    init() {\n        // Register with View Manager\n        // Assuming global.cineViewManager exists based on bootstrap.js\n        if (window.cineViewManager) {\n            window.cineViewManager.registerView(VIEW_ID, {\n                onEnter: () => this.render(),\n                onLeave: () => { }\n            });\n        }\n\n        // Expose to sidebar\n        const navItem = document.getElementById('navAutoBackups');\n        if (navItem) {\n            navItem.style.display = 'flex'; // Reveal the menu item\n        }\n    },\n\n    async render() {\n        const container = document.getElementById('v2-main'); // We might need a specific container if not using the standard structure\n        // Actually, looking at index.html, we need to create a section for it if it doesn't exist\n\n        let viewSection = document.getElementById(`view-${VIEW_ID}`);\n        if (!viewSection) {\n            viewSection = document.createElement('section');\n            viewSection.id = `view-${VIEW_ID}`;\n            viewSection.className = 'app-view';\n            viewSection.innerHTML = `\n                <header class=\"view-header\">\n                    <button class=\"v2-mobile-menu-toggle\" aria-label=\"Open menu\">\n                        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                            <line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\"></line>\n                            <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n                            <line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\"></line>\n                        </svg>\n                    </button>\n                    <h1>Data Vault (Backups)</h1>\n                </header>\n                <div class=\"view-content\">\n                    <div class=\"v2-backup-list\" id=\"backupList\">\n                        <div class=\"v2-empty-state\">Loading backups...</div>\n                    </div>\n                </div>\n            `;\n            document.querySelector('.v2-main').appendChild(viewSection);\n        }\n\n        const listContainer = viewSection.querySelector('#backupList');\n        listContainer.innerHTML = '<div class=\"v2-spinner\"></div>';\n\n        try {\n            const snapshots = await dataVault.listSnapshots();\n\n            if (snapshots.length === 0) {\n                listContainer.innerHTML = `\n                    <div class=\"v2-empty-state\">\n                        <p>No backups found in the Vault.</p>\n                        <p class=\"subtext\">Backups are created automatically when you save projects.</p>\n                    </div>`;\n                return;\n            }\n\n            let html = '<ul class=\"v2-list\">';\n            for (const filename of snapshots) {\n                // Parse timestamp from filename \"snapshot_TIMESTAMP.json\"\n                // Assuming format: project_ID_TIMESTAMP.json or similar\n                const displayName = filename.replace('.json', '').replace('snapshot_', '');\n\n                html += `\n                    <li class=\"v2-list-item\">\n                        <div class=\"v2-list-content\">\n                            <div class=\"v2-list-title\">${displayName}</div>\n                        </div>\n                        <div class=\"v2-list-actions\">\n                            <button class=\"v2-btn v2-btn-sm\" onclick=\"cineBackupsView.restore('${filename}')\">Restore</button>\n                            <button class=\"v2-btn v2-btn-sm v2-btn-danger\" onclick=\"cineBackupsView.delete('${filename}')\">Delete</button>\n                        </div>\n                    </li>\n                `;\n            }\n            html += '</ul>';\n            listContainer.innerHTML = html;\n\n        } catch (e) {\n            listContainer.innerHTML = `<div class=\"v2-error-state\">Failed to load backups: ${e.message}</div>`;\n        }\n    },\n\n    async restore(filename) {\n        if (!confirm(`Are you sure you want to restore ${filename}? This will overwrite current data.`)) return;\n\n        try {\n            const data = await dataVault.restoreSnapshot(filename);\n\n            // Restore logic: This depends on what the snapshot contains.\n            // Assuming it's a project export or full dump.\n            // For now, let's assume it's a project object.\n\n            if (data.id && data.name) {\n                await storageRepo.saveProject(data.id, data);\n                alert('Project restored successfully!');\n                // Reload or navigate\n            } else {\n                alert('Unknown backup format.');\n            }\n        } catch (e) {\n            alert('Failed to restore: ' + e.message);\n        }\n    },\n\n    async delete(filename) {\n        if (!confirm(`Delete ${filename}?`)) return;\n        await dataVault.deleteSnapshot(filename);\n        this.render(); // Refresh list\n    }\n};\n\n// Expose global for inline onclick handlers\nwindow.cineBackupsView = cineBackupsView;\n"],"file":"v2-ui-BwEyNXHr.js"}