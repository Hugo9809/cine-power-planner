{"version":3,"file":"auto-gear-rules-DS0lYD-U.js","sources":["../../src/scripts/modules/features/auto-gear-rules.js"],"sourcesContent":["/* global cineModuleBase, normalizeAutoGearItem, normalizeAutoGearQuantity, normalizeAutoGearShootingDaysCondition,\n          normalizeBatteryPlateValue, autoGearRuleSignature,\n          generateGearListHtml, parseGearTableForAutoRules, diffGearTableMaps, generateAutoGearId,\n          monitorSelect, normalizeAutoGearTriggerValue,\n          texts, currentLang, devices, setSelectValue, distanceSelect, motorSelects, controllerSelects, batterySelect,\n          hotswapSelect, setSliderBowlValue, setEasyrigValue, collectProjectFormData, requiredScenariosSelect,\n          autoGearRules, autoGearRuleMatteboxKey, setAutoGearRules, cameraSelect, videoSelect, cageSelect,\n          batteryPlateSelect, updateBatteryPlateVisibility, updateBatteryOptions, applyBatteryPlateSelectionFromBattery,\n          getSliderBowlValue, getEasyrigValue, ensureAutoBackupBeforeDeletion, showNotification, notifyAutoSaveFromBackup,\n          exportAutoGearPresets,\n          markAutoGearDefaultsSeeded, getAutoGearRules, clearAutoGearDefaultsSeeded, hasSeededAutoGearDefaults,\n          assignAutoGearRules, AUTO_GEAR_ANY_MOTOR_TOKEN,\n          AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS, AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP,\n          baseAutoGearRulesState: true, projectScopedAutoGearRules: true,\n          autoGearRulesLastBackupSignature: true, autoGearRulesLastPersistedSignature: true,\n          autoGearRulesDirtySinceBackup: true */\n\n// (function () {\nfunction detectGlobalScope() {\n  if (typeof globalThis !== 'undefined') {\n    return globalThis;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  return {};\n}\n\nconst GLOBAL_SCOPE = detectGlobalScope();\n\nconst missingAutoGearHelperLog = new Set();\n\nfunction logMissingAutoGearHelper(name, error) {\n  if (missingAutoGearHelperLog.has(name)) {\n    return;\n  }\n  missingAutoGearHelperLog.add(name);\n  if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n    if (error) {\n      console.warn(`[cine] Missing auto gear helper: ${name}`, error);\n    } else {\n      console.warn(`[cine] Missing auto gear helper: ${name}`);\n    }\n  }\n}\n\nfunction resolveAutoGearUiExports() {\n  if (!GLOBAL_SCOPE || (typeof GLOBAL_SCOPE !== 'object' && typeof GLOBAL_SCOPE !== 'function')) {\n    return null;\n  }\n  try {\n    if (\n      GLOBAL_SCOPE.cineCoreAutoGearUi\n      && typeof GLOBAL_SCOPE.cineCoreAutoGearUi === 'object'\n    ) {\n      return GLOBAL_SCOPE.cineCoreAutoGearUi;\n    }\n  } catch (readError) {\n    logMissingAutoGearHelper('cineCoreAutoGearUi', readError);\n  }\n  return null;\n}\n\n/*\n * DEEP DIVE: The \"Auto Gear\" Logic Engine\n *\n * This module contains the decision-making rules for the \"Auto Gear\" feature,\n * which automatically recommends accessories (batteries, cables, rods) based\n * on the selected camera and lens.\n *\n * KEY ARCHITECTURE:\n * 1. Soft Dependencies: It uses `resolveAutoGearHelperFunction` to loosely\n *    couple with the UI layer, preventing circular dependencies.\n * 2. Robustness: It aggressively falls back (`ensureFallbackAutoGearHelper`)\n *    to safe defaults if helper functions are missing.\n */\nfunction resolveAutoGearHelperFunction(name) {\n  if (typeof name !== 'string' || !name) {\n    return null;\n  }\n\n  const exports = resolveAutoGearUiExports();\n  if (exports && typeof exports[name] === 'function') {\n    return exports[name];\n  }\n\n  if (GLOBAL_SCOPE && typeof GLOBAL_SCOPE[name] === 'function') {\n    return GLOBAL_SCOPE[name];\n  }\n\n  logMissingAutoGearHelper(name);\n  return null;\n}\n\nfunction ensureFallbackAutoGearHelper(name, implementation) {\n  if (typeof name !== 'string' || !name || typeof implementation !== 'function') {\n    return false;\n  }\n\n  let installed = false;\n\n  if (GLOBAL_SCOPE && (typeof GLOBAL_SCOPE === 'object' || typeof GLOBAL_SCOPE === 'function')) {\n    const existing = (() => {\n      try {\n        return GLOBAL_SCOPE[name];\n      } catch (readError) {\n        void readError;\n        return undefined;\n      }\n    })();\n\n    if (typeof existing !== 'function') {\n      try {\n        Object.defineProperty(GLOBAL_SCOPE, name, {\n          configurable: true,\n          enumerable: false,\n          writable: true,\n          value: implementation,\n        });\n        installed = true;\n      } catch (defineError) {\n        void defineError;\n        try {\n          GLOBAL_SCOPE[name] = implementation;\n          installed = true;\n        } catch (assignError) {\n          void assignError;\n        }\n      }\n    }\n  }\n\n  const exports = resolveAutoGearUiExports();\n  if (exports && typeof exports[name] !== 'function') {\n    try {\n      exports[name] = implementation;\n      installed = true;\n    } catch (assignExportError) {\n      void assignExportError;\n    }\n  }\n\n  return installed;\n}\n\n/**\n * DEEP DIVE: Legacy Normalization\n *\n * Device data comes from many sources (user saves, shared links, old versions).\n * These \"fallback\" normalizers ensure that even if a value is malformed\n * (e.g., \"12G\" string vs `{ type: \"12G-SDI\" }` object), the rules engine\n * can still understand it.\n */\nfunction fallbackNormalizeVideoDistributionOptionValue(value) {\n  if (typeof value !== 'string') {\n    return '';\n  }\n\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return '';\n  }\n\n  const lower = trimmed.toLowerCase();\n  if (lower === '__none__' || lower === 'none') {\n    return '__none__';\n  }\n\n  return trimmed;\n}\n\nensureFallbackAutoGearHelper('normalizeVideoDistributionOptionValue', fallbackNormalizeVideoDistributionOptionValue);\n\nfunction getFallbackViewfinderLabel(value) {\n  if (value === '__none__') {\n    const activeLang = typeof currentLang === 'string' && currentLang ? currentLang : 'en';\n    const textSource =\n      typeof texts === 'object' && texts\n        ? texts[activeLang] || texts.en || {}\n        : {};\n    return (\n      textSource.viewfinderExtensionNone\n      || textSource.autoGearViewfinderExtensionNone\n      || 'No'\n    );\n  }\n  return typeof value === 'string' ? value : '';\n}\n\nfunction getFallbackVideoDistributionLabel(value) {\n  if (value === '__none__') {\n    const activeLang = typeof currentLang === 'string' && currentLang ? currentLang : 'en';\n    const textSource =\n      typeof texts === 'object' && texts\n        ? texts[activeLang] || texts.en || {}\n        : {};\n    return textSource.autoGearVideoDistributionNone || 'No video distribution selected';\n  }\n  return typeof value === 'string' ? value : '';\n}\n\nfunction invokeAutoGearLabelHelper(name, fallback, value) {\n  const helper = resolveAutoGearHelperFunction(name);\n  if (typeof helper === 'function') {\n    try {\n      const result = helper.call(GLOBAL_SCOPE, value);\n      return result !== undefined && result !== null ? result : fallback(value);\n    } catch (invokeError) {\n      logMissingAutoGearHelper(name, invokeError);\n    }\n  }\n  return fallback(value);\n}\n\nfunction getFallbackMatteboxLabel(value) {\n  if (value === '__none__') {\n    const activeLang = typeof currentLang === 'string' && currentLang ? currentLang : 'en';\n    const textSource =\n      typeof texts === 'object' && texts\n        ? texts[activeLang] || texts.en || {}\n        : {};\n    return textSource.autoGearMatteboxNone || 'No mattebox selected';\n  }\n  return typeof value === 'string' ? value : '';\n}\n\nfunction getSafeMatteboxFallbackLabel(value) {\n  return invokeAutoGearLabelHelper(\n    'getMatteboxFallbackLabel',\n    getFallbackMatteboxLabel,\n    value,\n  );\n}\n\nensureFallbackAutoGearHelper('getMatteboxFallbackLabel', getFallbackMatteboxLabel);\n\nfunction fallbackNormalizeMatteboxOptionValue(value) {\n  if (typeof value !== 'string') {\n    return '';\n  }\n\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return '';\n  }\n\n  const lower = trimmed.toLowerCase();\n  if (lower === '__none__' || lower === 'none') {\n    return '__none__';\n  }\n\n  return trimmed;\n}\n\nensureFallbackAutoGearHelper('normalizeMatteboxOptionValue', fallbackNormalizeMatteboxOptionValue);\n\nfunction normalizeMatteboxOption(value) {\n  const helper = resolveAutoGearHelperFunction('normalizeMatteboxOptionValue');\n  if (typeof helper === 'function') {\n    try {\n      return helper.call(GLOBAL_SCOPE, value);\n    } catch (error) {\n      logMissingAutoGearHelper('normalizeMatteboxOptionValue', error);\n    }\n  }\n\n  return fallbackNormalizeMatteboxOptionValue(value);\n}\n\nfunction normalizeVideoDistributionOption(value) {\n  const helper = resolveAutoGearHelperFunction('normalizeVideoDistributionOptionValue');\n  if (typeof helper === 'function') {\n    try {\n      return helper.call(GLOBAL_SCOPE, value);\n    } catch (error) {\n      logMissingAutoGearHelper('normalizeVideoDistributionOptionValue', error);\n    }\n  }\n\n  if (typeof value !== 'string') {\n    return '';\n  }\n\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return '';\n  }\n\n  const lower = trimmed.toLowerCase();\n  if (lower === '__none__' || lower === 'none') {\n    return '__none__';\n  }\n\n  return trimmed;\n}\n\nfunction getSafeViewfinderFallbackLabel(value) {\n  return invokeAutoGearLabelHelper('getViewfinderFallbackLabel', getFallbackViewfinderLabel, value);\n}\n\nfunction getSafeVideoDistributionFallbackLabel(value) {\n  return invokeAutoGearLabelHelper(\n    'getVideoDistributionFallbackLabel',\n    getFallbackVideoDistributionLabel,\n    value,\n  );\n}\n\nfunction createModuleBaseFallback(scope) {\n  const targetScope =\n    scope && (typeof scope === 'object' || typeof scope === 'function') ? scope : detectGlobalScope();\n\n  const resolvedScope =\n    targetScope && (typeof targetScope === 'object' || typeof targetScope === 'function')\n      ? targetScope\n      : null;\n\n  if (!resolvedScope) {\n    return null;\n  }\n\n  let existingBase = null;\n  try {\n    if (resolvedScope && typeof resolvedScope.cineModuleBase === 'object') {\n      existingBase = resolvedScope.cineModuleBase;\n    }\n  } catch (readBaseError) {\n    void readBaseError;\n    existingBase = null;\n  }\n\n  if (existingBase) {\n    return existingBase;\n  }\n\n  const moduleStorage = Object.create(null);\n  const listenerStorage = Object.create(null);\n\n  const notifyListeners = (name, api) => {\n    if (typeof name !== 'string' || !name) {\n      return;\n    }\n\n    const queue = listenerStorage[name];\n    if (!Array.isArray(queue) || queue.length === 0) {\n      return;\n    }\n\n    listenerStorage[name] = [];\n\n    for (let index = 0; index < queue.length; index += 1) {\n      const listener = queue[index];\n      if (typeof listener !== 'function') {\n        continue;\n      }\n\n      try {\n        listener(api);\n      } catch (listenerError) {\n        void listenerError;\n      }\n    }\n  };\n\n  const storeModule = (name, api) => {\n    if (typeof name !== 'string' || !name) {\n      return;\n    }\n\n    moduleStorage[name] = api;\n    notifyListeners(name, api);\n  };\n\n  const getStoredModule = name => {\n    if (typeof name !== 'string' || !name) {\n      return null;\n    }\n\n    if (Object.prototype.hasOwnProperty.call(moduleStorage, name)) {\n      return moduleStorage[name];\n    }\n\n    return null;\n  };\n\n  const whenModuleAvailable = (name, handler) => {\n    if (typeof handler !== 'function' || typeof name !== 'string' || !name) {\n      return false;\n    }\n\n    const existing = getStoredModule(name);\n    if (existing) {\n      try {\n        handler(existing);\n      } catch (listenerError) {\n        void listenerError;\n      }\n      return true;\n    }\n\n    if (!Array.isArray(listenerStorage[name])) {\n      listenerStorage[name] = [];\n    }\n\n    listenerStorage[name].push(handler);\n    return true;\n  };\n\n  const ensureModuleGlobals = () => {\n    let globals = null;\n    try {\n      globals = resolvedScope.cineModuleGlobals;\n    } catch (readError) {\n      void readError;\n      globals = null;\n    }\n\n    if (!globals || typeof globals !== 'object') {\n      globals = {};\n    }\n\n    if (typeof globals.getModule !== 'function') {\n      globals.getModule = name => getStoredModule(name);\n    }\n\n    if (typeof globals.whenModuleAvailable !== 'function') {\n      globals.whenModuleAvailable = (name, handler) => whenModuleAvailable(name, handler);\n    }\n\n    if (typeof globals.register !== 'function') {\n      globals.register = (name, api) => {\n        storeModule(name, api);\n        return true;\n      };\n    }\n\n    try {\n      Object.defineProperty(resolvedScope, 'cineModuleGlobals', {\n        configurable: true,\n        enumerable: false,\n        writable: true,\n        value: globals,\n      });\n    } catch (defineGlobalsError) {\n      void defineGlobalsError;\n      try {\n        resolvedScope.cineModuleGlobals = globals;\n      } catch (assignGlobalsError) {\n        void assignGlobalsError;\n      }\n    }\n\n    return globals;\n  };\n\n  const ensureModuleRegistry = () => {\n    let registry = null;\n    try {\n      registry = resolvedScope.cineModules;\n    } catch (readError) {\n      void readError;\n      registry = null;\n    }\n\n    if (!registry || typeof registry !== 'object') {\n      registry = {};\n    }\n\n    if (typeof registry.get !== 'function') {\n      registry.get = name => getStoredModule(name);\n    }\n\n    if (typeof registry.register !== 'function') {\n      registry.register = (name, api) => {\n        storeModule(name, api);\n        return true;\n      };\n    }\n\n    try {\n      Object.defineProperty(resolvedScope, 'cineModules', {\n        configurable: true,\n        enumerable: false,\n        writable: true,\n        value: registry,\n      });\n    } catch (defineRegistryError) {\n      void defineRegistryError;\n      try {\n        resolvedScope.cineModules = registry;\n      } catch (assignRegistryError) {\n        void assignRegistryError;\n      }\n    }\n\n    return registry;\n  };\n\n  const fallbackBase = {\n    freezeDeep(value) {\n      return value;\n    },\n    safeWarn(message, detail) {\n      if (typeof console === 'undefined' || !console || typeof console.warn !== 'function') {\n        return;\n      }\n\n      try {\n        if (typeof detail === 'undefined') {\n          console.warn(message);\n        } else {\n          console.warn(message, detail);\n        }\n      } catch (warnError) {\n        void warnError;\n      }\n    },\n    informModuleGlobals(name, api) {\n      const globals = ensureModuleGlobals();\n      if (globals && typeof globals.register === 'function') {\n        try {\n          globals.register(name, api);\n          return true;\n        } catch (registerError) {\n          void registerError;\n        }\n      }\n\n      storeModule(name, api);\n      return true;\n    },\n    registerOrQueueModule(name, api) {\n      const registry = ensureModuleRegistry();\n      if (registry && typeof registry.register === 'function') {\n        try {\n          registry.register(name, api);\n        } catch (registerError) {\n          void registerError;\n          storeModule(name, api);\n        }\n      } else {\n        storeModule(name, api);\n      }\n\n      ensureModuleGlobals();\n      return true;\n    },\n    exposeGlobal(name, value, target, options = {}) {\n      const scopeTarget =\n        target && (typeof target === 'object' || typeof target === 'function') ? target : resolvedScope;\n\n      if (!scopeTarget || (typeof scopeTarget !== 'object' && typeof scopeTarget !== 'function')) {\n        return false;\n      }\n\n      const descriptor = {\n        configurable: options.configurable !== false,\n        enumerable: !!options.enumerable,\n        writable: options.writable === true,\n        value,\n      };\n\n      try {\n        Object.defineProperty(scopeTarget, name, descriptor);\n        return true;\n      } catch (defineError) {\n        void defineError;\n        try {\n          scopeTarget[name] = value;\n          return true;\n        } catch (assignError) {\n          void assignError;\n        }\n      }\n\n      return false;\n    },\n  };\n\n  fallbackBase.registerOrQueueModule('cineModuleBase', fallbackBase);\n  fallbackBase.exposeGlobal('cineModuleBase', fallbackBase, resolvedScope, {\n    configurable: true,\n    enumerable: false,\n    writable: false,\n  });\n\n  ensureModuleGlobals();\n  ensureModuleRegistry();\n\n  return fallbackBase;\n}\n\nfunction moduleJsonDeepClone(value) {\n  if (value === null || typeof value !== 'object') {\n    return value;\n  }\n\n  try {\n    return JSON.parse(JSON.stringify(value));\n  } catch (jsonCloneError) {\n    void jsonCloneError;\n  }\n\n  return value;\n}\n\nfunction moduleResolveStructuredClone(scope) {\n  if (typeof structuredClone === 'function') {\n    return structuredClone;\n  }\n\n  if (scope && typeof scope.structuredClone === 'function') {\n    try {\n      return scope.structuredClone.bind(scope);\n    } catch (bindError) {\n      void bindError;\n    }\n  }\n\n  /*\n  if (typeof require === 'function') {\n    try {\n      const nodeUtil = require('node:util');\n      if (nodeUtil && typeof nodeUtil.structuredClone === 'function') {\n        return nodeUtil.structuredClone.bind(nodeUtil);\n      }\n    } catch (nodeUtilError) {\n      void nodeUtilError;\n    }\n\n    try {\n      const legacyUtil = require('util');\n      if (legacyUtil && typeof legacyUtil.structuredClone === 'function') {\n        return legacyUtil.structuredClone.bind(legacyUtil);\n      }\n    } catch (legacyUtilError) {\n      void legacyUtilError;\n    }\n  }\n  */\n\n  return null;\n}\n\nfunction moduleCreateResilientDeepClone(scope) {\n  const structuredCloneImpl = moduleResolveStructuredClone(scope);\n\n  if (!structuredCloneImpl) {\n    return moduleJsonDeepClone;\n  }\n\n  return function moduleResilientDeepClone(value) {\n    if (value === null || typeof value !== 'object') {\n      return value;\n    }\n\n    try {\n      return structuredCloneImpl(value);\n    } catch (structuredCloneError) {\n      void structuredCloneError;\n    }\n\n    return moduleJsonDeepClone(value);\n  };\n}\n\nconst MODULE_DEEP_CLONE =\n  GLOBAL_SCOPE && typeof GLOBAL_SCOPE.__cineDeepClone === 'function'\n    ? GLOBAL_SCOPE.__cineDeepClone\n    : moduleCreateResilientDeepClone(GLOBAL_SCOPE);\n\n// Auto gear rules power the automated project recommendations. They are\n// effectively user data, so every helper below leans on the resilient deep\n// clone to prevent accidental mutations. Documenting this design choice here\n// makes it harder to accidentally bypass the guard rails when extending the\n// module.\n\nfunction resolveModuleBase(scope) {\n  if (typeof cineModuleBase === 'object' && cineModuleBase) {\n    return cineModuleBase;\n  }\n\n  /*\n  if (typeof require === 'function') {\n    try {\n      const required = require('../base.js');\n      if (required && typeof required === 'object') {\n        return required;\n      }\n    } catch (error) {\n      void error;\n    }\n  }\n  */\n\n  if (scope && typeof scope.cineModuleBase === 'object') {\n    return scope.cineModuleBase;\n  }\n\n  return null;\n}\n\nconst MODULE_BASE = resolveModuleBase(GLOBAL_SCOPE) || createModuleBaseFallback(GLOBAL_SCOPE);\n// if (!MODULE_BASE) {\n//   return;\n// }\n\nconst freezeDeep = typeof MODULE_BASE.freezeDeep === 'function'\n  ? MODULE_BASE.freezeDeep\n  : function fallbackFreezeDeep(value) {\n    if (!value || typeof value === 'function' || (typeof value !== 'object' && typeof value !== 'function')) {\n      return value;\n    }\n    const seen = new WeakSet();\n    function freeze(target) {\n      if (!target || (typeof target !== 'object' && typeof target !== 'function')) {\n        return target;\n      }\n      if (seen.has(target)) {\n        return target;\n      }\n      seen.add(target);\n      try {\n        const keys = Object.getOwnPropertyNames(target);\n        for (let index = 0; index < keys.length; index += 1) {\n          const key = keys[index];\n          let child;\n          try {\n            child = target[key];\n          } catch (accessError) {\n            void accessError;\n            child = undefined;\n          }\n          if (!child || typeof child === 'function' || (typeof child !== 'object' && typeof child !== 'function')) {\n            continue;\n          }\n          freeze(child);\n        }\n        Object.freeze(target);\n      } catch (error) {\n        void error;\n      }\n      return target;\n    }\n    return freeze(value);\n  };\n\nconst exposeGlobal = typeof MODULE_BASE.exposeGlobal === 'function'\n  ? function expose(name, value, options) {\n    return MODULE_BASE.exposeGlobal(name, value, GLOBAL_SCOPE, options || {});\n  }\n  : function fallbackExpose(name, value) {\n    try {\n      GLOBAL_SCOPE[name] = value;\n      return true;\n    } catch (error) {\n      void error;\n      return false;\n    }\n  };\n\nconst moduleRegistry = typeof MODULE_BASE.getModuleRegistry === 'function'\n  ? MODULE_BASE.getModuleRegistry(GLOBAL_SCOPE)\n  : null;\n\nconst registerOrQueueModule = typeof MODULE_BASE.registerOrQueueModule === 'function'\n  ? function register(name, api, options, onError) {\n    return MODULE_BASE.registerOrQueueModule(\n      name,\n      api,\n      options,\n      onError,\n      GLOBAL_SCOPE,\n      moduleRegistry,\n    );\n  }\n  : function fallbackRegister() {\n    return false;\n  };\n\nlet factoryAutoGearRulesSnapshot = null;\nlet factoryAutoGearSeedContext = null;\n\nfunction fallbackCollectCandidateScopes(primary) {\n  const scopes = [];\n\n  function push(scope) {\n    if (!scope || (typeof scope !== 'object' && typeof scope !== 'function')) {\n      return;\n    }\n    if (scopes.indexOf(scope) === -1) {\n      scopes.push(scope);\n    }\n  }\n\n  push(primary);\n  if (typeof globalThis !== 'undefined') push(globalThis);\n  if (typeof window !== 'undefined') push(window);\n  if (typeof self !== 'undefined') push(self);\n  if (typeof global !== 'undefined') push(global);\n\n  return scopes;\n}\n\nconst candidateScopes = (function resolveCandidateScopes() {\n  if (MODULE_BASE && typeof MODULE_BASE.collectCandidateScopes === 'function') {\n    try {\n      const collected = MODULE_BASE.collectCandidateScopes(GLOBAL_SCOPE);\n      if (Array.isArray(collected) && collected.length) {\n        return collected;\n      }\n    } catch (error) {\n      void error;\n    }\n  }\n\n  return fallbackCollectCandidateScopes(GLOBAL_SCOPE);\n})();\n\nconst structuredCloneCandidates = (function collectStructuredCloneCandidates() {\n  const candidates = [];\n\n  function addCandidate(fn, scope) {\n    if (typeof fn !== 'function') {\n      return;\n    }\n    const exists = candidates.some(candidate => candidate && candidate.fn === fn);\n    if (!exists) {\n      candidates.push({ fn, scope: scope || null });\n    }\n  }\n\n  if (MODULE_BASE) {\n    if (typeof MODULE_BASE.structuredClone === 'function') {\n      addCandidate(MODULE_BASE.structuredClone, MODULE_BASE);\n    }\n    if (typeof MODULE_BASE.getStructuredClone === 'function') {\n      try {\n        const resolved = MODULE_BASE.getStructuredClone();\n        addCandidate(resolved, MODULE_BASE);\n      } catch (error) {\n        void error;\n      }\n    }\n  }\n\n  for (let index = 0; index < candidateScopes.length; index += 1) {\n    const scope = candidateScopes[index];\n    if (!scope || (typeof scope !== 'object' && typeof scope !== 'function')) {\n      continue;\n    }\n    const candidate = scope.structuredClone;\n    if (typeof candidate === 'function') {\n      addCandidate(candidate, scope);\n    }\n  }\n\n  return candidates;\n})();\n\nlet cachedStructuredCloneCandidate = null;\n\nfunction tryStructuredCloneValue(value) {\n  if (cachedStructuredCloneCandidate) {\n    try {\n      const candidate = cachedStructuredCloneCandidate;\n      return {\n        success: true,\n        value: candidate.scope ? candidate.fn.call(candidate.scope, value) : candidate.fn(value),\n      };\n    } catch (error) {\n      void error;\n      cachedStructuredCloneCandidate = null;\n    }\n  }\n\n  for (let index = 0; index < structuredCloneCandidates.length; index += 1) {\n    const candidate = structuredCloneCandidates[index];\n    if (!candidate || typeof candidate.fn !== 'function') {\n      continue;\n    }\n    try {\n      const cloned = candidate.scope ? candidate.fn.call(candidate.scope, value) : candidate.fn(value);\n      cachedStructuredCloneCandidate = candidate;\n      return { success: true, value: cloned };\n    } catch (error) {\n      void error;\n    }\n  }\n\n  return { success: false, value: null };\n}\n\nfunction cloneWithStructuredCloneFallback(value) {\n  if (value === null || typeof value === 'undefined') {\n    return value;\n  }\n\n  const attempt = tryStructuredCloneValue(value);\n  if (attempt.success) {\n    return attempt.value;\n  }\n\n  if (MODULE_DEEP_CLONE) {\n    try {\n      const cloned = MODULE_DEEP_CLONE(value);\n      if (cloned !== value || value === null || typeof value !== 'object') {\n        return cloned;\n      }\n    } catch (cloneError) {\n      void cloneError;\n    }\n  }\n\n  try {\n    return moduleJsonDeepClone(value);\n  } catch (error) {\n    void error;\n  }\n\n  if (Array.isArray(value)) {\n    return value.slice();\n  }\n\n  if (typeof value === 'object') {\n    return { ...value };\n  }\n\n  return value;\n}\n\nfunction cloneAutoGearItems(items) {\n  return items\n    .map(item => {\n      const normalized = normalizeAutoGearItem(item);\n      if (!normalized) return null;\n      return { ...normalized };\n    })\n    .filter(Boolean);\n}\n\nfunction cloneAutoGearRuleItem(item) {\n  if (!item || typeof item !== 'object') {\n    return {\n      id: '',\n      name: '',\n      category: '',\n      quantity: 0,\n      screenSize: '',\n      selectorType: 'none',\n      selectorDefault: '',\n      selectorEnabled: false,\n      notes: '',\n      contextNotes: [],\n    };\n  }\n  return {\n    id: typeof item.id === 'string' ? item.id : '',\n    name: typeof item.name === 'string' ? item.name : '',\n    category: typeof item.category === 'string' ? item.category : '',\n    quantity: normalizeAutoGearQuantity(item.quantity),\n    screenSize: typeof item.screenSize === 'string' ? item.screenSize : '',\n    selectorType: typeof item.selectorType === 'string' ? item.selectorType : 'none',\n    selectorDefault: typeof item.selectorDefault === 'string' ? item.selectorDefault : '',\n    selectorEnabled: !!item.selectorEnabled,\n    selectorContext: typeof item.selectorContext === 'string' ? item.selectorContext : '',\n    notes: typeof item.notes === 'string' ? item.notes : '',\n    contextNotes: Array.isArray(item.contextNotes) ? item.contextNotes.filter(Boolean) : [],\n  };\n}\n\nfunction cloneAutoGearRule(rule) {\n  if (!rule || typeof rule !== 'object') return null;\n  return {\n    id: typeof rule.id === 'string' ? rule.id : '',\n    label: typeof rule.label === 'string' ? rule.label : '',\n    always: Boolean(rule.always),\n    scenarios: Array.isArray(rule.scenarios) ? rule.scenarios.slice() : [],\n    mattebox: Array.isArray(rule.mattebox) ? rule.mattebox.slice() : [],\n    cameraHandle: Array.isArray(rule.cameraHandle) ? rule.cameraHandle.slice() : [],\n    viewfinderExtension: Array.isArray(rule.viewfinderExtension)\n      ? rule.viewfinderExtension.slice()\n      : [],\n    videoDistribution: Array.isArray(rule.videoDistribution)\n      ? rule.videoDistribution.slice()\n      : [],\n    camera: Array.isArray(rule.camera) ? rule.camera.slice() : [],\n    monitor: Array.isArray(rule.monitor) ? rule.monitor.slice() : [],\n    tripodHeadBrand: Array.isArray(rule.tripodHeadBrand) ? rule.tripodHeadBrand.slice() : [],\n    tripodBowl: Array.isArray(rule.tripodBowl) ? rule.tripodBowl.slice() : [],\n    tripodTypes: Array.isArray(rule.tripodTypes) ? rule.tripodTypes.slice() : [],\n    tripodSpreader: Array.isArray(rule.tripodSpreader) ? rule.tripodSpreader.slice() : [],\n    crewPresent: Array.isArray(rule.crewPresent) ? rule.crewPresent.slice() : [],\n    crewAbsent: Array.isArray(rule.crewAbsent) ? rule.crewAbsent.slice() : [],\n    wireless: Array.isArray(rule.wireless) ? rule.wireless.slice() : [],\n    motors: Array.isArray(rule.motors) ? rule.motors.slice() : [],\n    controllers: Array.isArray(rule.controllers) ? rule.controllers.slice() : [],\n    distance: Array.isArray(rule.distance) ? rule.distance.slice() : [],\n    shootingDays: normalizeAutoGearShootingDaysCondition(rule.shootingDays),\n    add: Array.isArray(rule.add) ? rule.add.map(cloneAutoGearRuleItem) : [],\n    remove: Array.isArray(rule.remove) ? rule.remove.map(cloneAutoGearRuleItem) : [],\n  };\n}\n\nfunction cloneAutoGearRules(rules) {\n  return Array.isArray(rules)\n    ? rules.map(cloneAutoGearRule).filter(Boolean)\n    : [];\n}\n\nfunction setFactoryAutoGearRulesSnapshot(rules) {\n  if (!Array.isArray(rules)) {\n    factoryAutoGearRulesSnapshot = null;\n    return;\n  }\n  factoryAutoGearRulesSnapshot = cloneAutoGearRules(rules);\n}\n\nfunction subtractScenarioContributions(diff, scenarioKeys, scenarioDiffMap) {\n  const adjust = (items, type) => items\n    .map(item => {\n      let remaining = normalizeAutoGearQuantity(item.quantity);\n      scenarioKeys.forEach(key => {\n        const scenarioDiff = scenarioDiffMap.get(key);\n        if (!scenarioDiff) return;\n        const match = scenarioDiff[type].find(entry => entry.name === item.name && entry.category === item.category);\n        if (match) {\n          remaining -= normalizeAutoGearQuantity(match.quantity);\n        }\n      });\n      remaining = Math.max(remaining, 0);\n      if (remaining <= 0) return null;\n      const normalized = normalizeAutoGearItem(item);\n      if (!normalized) return null;\n      return { ...normalized, quantity: remaining };\n    })\n    .filter(Boolean);\n  return { add: adjust(diff.add, 'add'), remove: adjust(diff.remove, 'remove') };\n}\n\nfunction extractAutoGearSelections(value) {\n  if (typeof value !== 'string') return [];\n  return value\n    .split(',')\n    .map(part => part.trim())\n    .filter(Boolean);\n}\n\nfunction buildCameraHandleAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const selections = extractAutoGearSelections(baseInfo && baseInfo.cameraHandle);\n  const selectionSet = new Set(selections);\n  const optionValues = [];\n\n  if (typeof document !== 'undefined') {\n    const handleSelect = document.getElementById('cameraHandle');\n    if (handleSelect) {\n      Array.from(handleSelect.options || []).forEach(option => {\n        const value = typeof option.value === 'string' ? option.value.trim() : '';\n        if (value) optionValues.push(value);\n      });\n    }\n  }\n\n  const candidates = Array.from(new Set(\n    selections\n      .concat(optionValues)\n      .map(value => (typeof value === 'string' ? value.trim() : ''))\n      .filter(Boolean)\n  ));\n\n  if (!candidates.length) return [];\n\n  const rules = [];\n\n  candidates.forEach(candidate => {\n    const trimmed = candidate.trim();\n    if (!trimmed) return;\n\n    let variantHandles;\n    let diff;\n\n    if (selectionSet.has(trimmed)) {\n      variantHandles = selections.filter(value => value !== trimmed);\n      const variantInfo = { ...baseInfo, cameraHandle: variantHandles.join(', ') };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(variantMap, baselineMap);\n    } else {\n      variantHandles = selections.slice();\n      variantHandles.push(trimmed);\n      const variantInfo = { ...baseInfo, cameraHandle: variantHandles.join(', ') };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(baselineMap, variantMap);\n    }\n\n    if (!diff || (!diff.add.length && !diff.remove.length)) return;\n\n    const additions = Array.isArray(diff.add) ? cloneAutoGearItems(diff.add) : [];\n    const removals = Array.isArray(diff.remove) ? cloneAutoGearItems(diff.remove) : [];\n\n    if (!additions.length && !removals.length) return;\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: trimmed,\n      scenarios: [],\n      mattebox: [],\n      cameraHandle: [trimmed],\n      viewfinderExtension: [],\n      videoDistribution: [],\n      add: additions,\n      remove: removals,\n    });\n  });\n\n  return rules;\n}\n\nfunction buildViewfinderExtensionAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const selections = extractAutoGearSelections(baseInfo && baseInfo.viewfinderExtension);\n  if (!selections.length) return [];\n\n  const uniqueSelections = Array.from(new Set(selections));\n  const rules = [];\n\n  uniqueSelections.forEach(selection => {\n    const trimmed = selection.trim();\n    if (!trimmed) return;\n\n    const remainingSelections = selections.filter(value => value !== trimmed);\n    const variantInfo = { ...baseInfo, viewfinderExtension: remainingSelections.join(', ') };\n    const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n    const variantMap = parseGearTableForAutoRules(variantHtml);\n    if (!variantMap) return;\n\n    const diff = diffGearTableMaps(variantMap, baselineMap);\n    if (!diff.add.length && !diff.remove.length) return;\n\n    const additions = cloneAutoGearItems(diff.add);\n    if (!additions.length) return;\n    const removals = cloneAutoGearItems(diff.remove);\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: getSafeViewfinderFallbackLabel(trimmed),\n      scenarios: [],\n      mattebox: [],\n      cameraHandle: [],\n      viewfinderExtension: [trimmed],\n      videoDistribution: [],\n      add: additions,\n      remove: removals,\n    });\n  });\n\n  return rules;\n}\n\nfunction buildBatteryAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const select = typeof batterySelect !== 'undefined' ? batterySelect : document.getElementById('battery');\n  if (!select || !select.options) return [];\n\n  const optionValues = [];\n  Array.from(select.options).forEach(opt => {\n    const val = typeof opt.value === 'string' ? opt.value.trim() : '';\n    if (val && val !== 'None') optionValues.push(val);\n  });\n\n  if (!optionValues.length) return [];\n\n  const currentSelection = baseInfo && typeof baseInfo.battery === 'string' ? baseInfo.battery.trim() : '';\n  const rules = [];\n\n  optionValues.forEach(val => {\n    let variantInfo;\n    let diff;\n\n    if (val === currentSelection) {\n      variantInfo = { ...baseInfo, battery: '' };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(variantMap, baselineMap);\n    } else {\n      variantInfo = { ...baseInfo, battery: val };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(baselineMap, variantMap);\n    }\n\n    if (!diff || (!diff.add.length && !diff.remove.length)) return;\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: `Battery: ${val}`,\n      scenarios: [],\n      battery: [val],\n      add: cloneAutoGearItems(diff.add),\n      remove: cloneAutoGearItems(diff.remove),\n    });\n  });\n\n  return rules;\n}\n\nfunction buildDistanceAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const select = typeof distanceSelect !== 'undefined' ? distanceSelect : document.getElementById('distance');\n  if (!select || !select.options) return [];\n\n  const optionValues = [];\n  Array.from(select.options).forEach(opt => {\n    const val = typeof opt.value === 'string' ? opt.value.trim() : '';\n    if (val && val !== 'None') optionValues.push(val);\n  });\n\n  if (!optionValues.length) return [];\n\n  const currentSelection = baseInfo && typeof baseInfo.distance === 'string' ? baseInfo.distance.trim() : '';\n  const rules = [];\n\n  optionValues.forEach(val => {\n    let variantInfo;\n    let diff;\n\n    if (val === currentSelection) {\n      variantInfo = { ...baseInfo, distance: '' };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(variantMap, baselineMap);\n    } else {\n      variantInfo = { ...baseInfo, distance: val };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(baselineMap, variantMap);\n    }\n\n    if (!diff || (!diff.add.length && !diff.remove.length)) return;\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: `Distance: ${val}`,\n      scenarios: [],\n      distance: [val],\n      add: cloneAutoGearItems(diff.add),\n      remove: cloneAutoGearItems(diff.remove),\n    });\n  });\n\n  return rules;\n}\n\nfunction buildHotswapAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const select = typeof hotswapSelect !== 'undefined' ? hotswapSelect : document.getElementById('hotswap');\n  if (!select || !select.options) return [];\n\n  const optionValues = [];\n  Array.from(select.options).forEach(opt => {\n    const val = typeof opt.value === 'string' ? opt.value.trim() : '';\n    if (val && val !== 'None') optionValues.push(val);\n  });\n\n  if (!optionValues.length) return [];\n\n  const currentSelection = baseInfo && typeof baseInfo.hotswap === 'string' ? baseInfo.hotswap.trim() : '';\n  const rules = [];\n\n  optionValues.forEach(val => {\n    let variantInfo;\n    let diff;\n\n    if (val === currentSelection) {\n      variantInfo = { ...baseInfo, hotswap: '' };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(variantMap, baselineMap);\n    } else {\n      variantInfo = { ...baseInfo, hotswap: val };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(baselineMap, variantMap);\n    }\n\n    if (!diff || (!diff.add.length && !diff.remove.length)) return;\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: `Hotswap: ${val}`,\n      scenarios: [],\n      hotswap: [val],\n      add: cloneAutoGearItems(diff.add),\n      remove: cloneAutoGearItems(diff.remove),\n    });\n  });\n\n  return rules;\n}\n\nfunction buildBatteryPlateAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const select = typeof batteryPlateSelect !== 'undefined' ? batteryPlateSelect : document.getElementById('batteryPlate');\n  if (!select || !select.options) return [];\n\n  const optionValues = [];\n  Array.from(select.options).forEach(opt => {\n    const val = typeof opt.value === 'string' ? opt.value.trim() : '';\n    if (val && val !== 'None') optionValues.push(val);\n  });\n\n  if (!optionValues.length) return [];\n\n  const currentSelection = baseInfo && typeof baseInfo.batteryPlate === 'string' ? baseInfo.batteryPlate.trim() : '';\n  const rules = [];\n\n  optionValues.forEach(val => {\n    let variantInfo;\n    let diff;\n\n    if (val === currentSelection) {\n      variantInfo = { ...baseInfo, batteryPlate: '' };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(variantMap, baselineMap);\n    } else {\n      variantInfo = { ...baseInfo, batteryPlate: val };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(baselineMap, variantMap);\n    }\n\n    if (!diff || (!diff.add.length && !diff.remove.length)) return;\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: `Battery Plate: ${val}`,\n      scenarios: [],\n      batteryPlate: [val],\n      add: cloneAutoGearItems(diff.add),\n      remove: cloneAutoGearItems(diff.remove),\n    });\n  });\n\n  return rules;\n}\n\nfunction buildCageAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const select = typeof cageSelect !== 'undefined' ? cageSelect : document.getElementById('cage');\n  if (!select || !select.options) return [];\n\n  const optionValues = [];\n  Array.from(select.options).forEach(opt => {\n    const val = typeof opt.value === 'string' ? opt.value.trim() : '';\n    if (val && val !== 'None') optionValues.push(val);\n  });\n\n  if (!optionValues.length) return [];\n\n  const currentSelection = baseInfo && typeof baseInfo.cage === 'string' ? baseInfo.cage.trim() : '';\n  const rules = [];\n\n  optionValues.forEach(val => {\n    let variantInfo;\n    let diff;\n\n    if (val === currentSelection) {\n      variantInfo = { ...baseInfo, cage: '' };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(variantMap, baselineMap);\n    } else {\n      variantInfo = { ...baseInfo, cage: val };\n      const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n      const variantMap = parseGearTableForAutoRules(variantHtml);\n      if (!variantMap) return;\n      diff = diffGearTableMaps(baselineMap, variantMap);\n    }\n\n    if (!diff || (!diff.add.length && !diff.remove.length)) return;\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: `Cage: ${val}`,\n      scenarios: [],\n      mattebox: [],\n      cameraHandle: [],\n      viewfinderExtension: [],\n      videoDistribution: [],\n      cage: [val],\n      add: cloneAutoGearItems(diff.add),\n      remove: cloneAutoGearItems(diff.remove),\n    });\n  });\n\n  return rules;\n}\n\nfunction buildTripodAutoGearRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const brand = baseInfo && typeof baseInfo.tripodHeadBrand === 'string' ? baseInfo.tripodHeadBrand.trim() : '';\n  const bowl = baseInfo && typeof baseInfo.tripodBowl === 'string' ? baseInfo.tripodBowl.trim() : '';\n\n  const rules = [];\n\n  if (brand && bowl && brand !== 'None' && bowl !== 'None') {\n    const variantInfo = { ...baseInfo, tripodHeadBrand: '', tripodBowl: '' };\n    const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n    const variantMap = parseGearTableForAutoRules(variantHtml);\n    if (variantMap) {\n      const diff = diffGearTableMaps(variantMap, baselineMap);\n      if (diff.add.length || diff.remove.length) {\n        rules.push({\n          id: generateAutoGearId('rule'),\n          label: `Tripod Head: ${brand} (${bowl})`,\n          scenarios: [],\n          mattebox: [],\n          cameraHandle: [],\n          viewfinderExtension: [],\n          videoDistribution: [],\n          tripodHeadBrand: [brand],\n          tripodBowl: [bowl],\n          add: cloneAutoGearItems(diff.add),\n          remove: cloneAutoGearItems(diff.remove),\n        });\n      }\n    }\n  }\n\n  const spreader = baseInfo && typeof baseInfo.tripodSpreader === 'string' ? baseInfo.tripodSpreader.trim() : '';\n  if (spreader && spreader !== 'None') {\n    const variantInfo = { ...baseInfo, tripodSpreader: '' };\n    const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n    const variantMap = parseGearTableForAutoRules(variantHtml);\n    if (variantMap) {\n      const diff = diffGearTableMaps(variantMap, baselineMap);\n      if (diff.add.length || diff.remove.length) {\n        rules.push({\n          id: generateAutoGearId('rule'),\n          label: `Tripod Spreader: ${spreader}`,\n          scenarios: [],\n          mattebox: [],\n          cameraHandle: [],\n          viewfinderExtension: [],\n          videoDistribution: [],\n          tripodSpreader: [spreader],\n          add: cloneAutoGearItems(diff.add),\n          remove: cloneAutoGearItems(diff.remove),\n        });\n      }\n    }\n  }\n\n  const types = extractAutoGearSelections(baseInfo && baseInfo.tripodTypes);\n  types.forEach(t => {\n    const others = types.filter(val => val !== t);\n    const variantInfo = { ...baseInfo, tripodTypes: others.join(', ') };\n    const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n    const variantMap = parseGearTableForAutoRules(variantHtml);\n    if (variantMap) {\n      const diff = diffGearTableMaps(variantMap, baselineMap);\n      if (diff.add.length || diff.remove.length) {\n        rules.push({\n          id: generateAutoGearId('rule'),\n          label: `Tripod Type: ${t}`,\n          scenarios: [],\n          mattebox: [],\n          cameraHandle: [],\n          viewfinderExtension: [],\n          videoDistribution: [],\n          tripodTypes: [t],\n          add: cloneAutoGearItems(diff.add),\n          remove: cloneAutoGearItems(diff.remove),\n        });\n      }\n    }\n  });\n\n  return rules;\n}\n\nfunction buildTripodPreferenceAutoGearRules(baseInfo = {}) {\n  const brand = typeof baseInfo.tripodHeadBrand === 'string' ? baseInfo.tripodHeadBrand.trim() : '';\n  const bowl = typeof baseInfo.tripodBowl === 'string' ? baseInfo.tripodBowl.trim() : '';\n  if (!brand || !bowl) return [];\n\n  const normalizedBrand = normalizeAutoGearTriggerValue(brand);\n  const normalizedBowl = normalizeAutoGearTriggerValue(bowl);\n  if (!normalizedBrand || !normalizedBowl) return [];\n\n  const combos = [\n    {\n      brand: \"O'Connor\",\n      entries: [\n        { bowl: '100mm bowl', item: \"O'Connor Ultimate 1040 Fluid-Head 100mm bowl\" },\n        { bowl: '150mm bowl', item: \"O'Connor Ultimate 2560 Fluid-Head 150mm bowl\" },\n        { bowl: 'Mitchell Mount', item: \"O'Connor Ultimate 2560 Fluid-Head Mitchell Mount\" },\n      ],\n    },\n    {\n      brand: 'Sachtler',\n      entries: [\n        { bowl: '75mm bowl', item: 'Sachtler aktiv8 head 75mm bowl' },\n        { bowl: '100mm bowl', item: 'Sachtler aktiv18T head 100mm bowl' },\n        { bowl: '150mm bowl', item: 'Sachtler Cine 30 head 150mm bowl' },\n        { bowl: 'Mitchell Mount', item: 'Sachtler Cine 30 head Mitchell mount' },\n      ],\n    },\n  ];\n\n  const matchedBrand = combos.find(entry => normalizeAutoGearTriggerValue(entry.brand) === normalizedBrand);\n  if (!matchedBrand) return [];\n\n  const matchingEntries = matchedBrand.entries.filter(entry => normalizeAutoGearTriggerValue(entry.bowl) === normalizedBowl);\n  if (!matchingEntries.length) return [];\n\n  return matchingEntries.map(entry => {\n    const itemName = entry.item;\n    const contextNotes = ['Tripod preferences'];\n    return {\n      id: generateAutoGearId('rule'),\n      label: `Tripod head: ${itemName}`,\n      scenarios: [],\n      mattebox: [],\n      cameraHandle: [],\n      viewfinderExtension: [],\n      videoDistribution: [],\n      camera: [],\n      monitor: [],\n      tripodHeadBrand: [matchedBrand.brand],\n      tripodBowl: [entry.bowl],\n      tripodTypes: [],\n      tripodSpreader: [],\n      crewPresent: [],\n      crewAbsent: [],\n      wireless: [],\n      motors: [],\n      controllers: [],\n      distance: [],\n      add: [{\n        id: generateAutoGearId('item'),\n        name: itemName,\n        category: 'Grip',\n        quantity: 1,\n        screenSize: '',\n        selectorType: 'tripodHeadBrand',\n        selectorDefault: itemName,\n        selectorEnabled: true,\n        notes: '',\n        contextNotes: contextNotes,\n      }],\n      remove: [],\n    };\n  });\n}\n\nfunction buildVideoDistributionAutoRules(baseInfo, baselineMap) {\n  if (!baselineMap || typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const selections = extractAutoGearSelections(baseInfo && baseInfo.videoDistribution);\n  if (!selections.length) return [];\n\n  const uniqueSelections = Array.from(new Set(selections));\n  const rules = [];\n\n  uniqueSelections.forEach(selection => {\n    const trimmed = selection.trim();\n    if (!trimmed) return;\n    const lower = trimmed.toLowerCase();\n    if (lower === '__none__' || lower === 'none') return;\n\n    const remainingSelections = selections.filter(value => value !== trimmed);\n    const variantInfo = { ...baseInfo, videoDistribution: remainingSelections.join(', ') };\n    const variantHtml = generateGearListHtml({ ...variantInfo, requiredScenarios: '' });\n    const variantMap = parseGearTableForAutoRules(variantHtml);\n    if (!variantMap) return;\n\n    const diff = diffGearTableMaps(variantMap, baselineMap);\n    if (!diff.add.length && !diff.remove.length) return;\n\n    const additions = cloneAutoGearItems(diff.add);\n    if (!additions.length) return;\n    const removals = cloneAutoGearItems(diff.remove);\n\n    rules.push({\n      id: generateAutoGearId('rule'),\n      label: getSafeVideoDistributionFallbackLabel(trimmed),\n      scenarios: [],\n      mattebox: [],\n      cameraHandle: [],\n      viewfinderExtension: [],\n      videoDistribution: [trimmed],\n      add: additions,\n      remove: removals,\n    });\n  });\n\n  return rules;\n}\n\nfunction buildOnboardMonitorRiggingAutoGearRules() {\n  const select = typeof monitorSelect !== 'undefined' ? monitorSelect : null;\n  if (!select || !select.options) {\n    return [];\n  }\n\n  const monitorLabels = [];\n  const seen = new Set();\n\n  Array.from(select.options).forEach(option => {\n    if (!option) return;\n    const rawValue = typeof option.value === 'string' ? option.value.trim() : '';\n    if (!rawValue || rawValue === 'None') return;\n    const label = typeof option.textContent === 'string' ? option.textContent.trim() : '';\n    if (!label) return;\n    const normalized = normalizeAutoGearTriggerValue(label);\n    if (!normalized || seen.has(normalized)) return;\n    seen.add(normalized);\n    monitorLabels.push(label);\n  });\n\n  if (!monitorLabels.length) {\n    return [];\n  }\n\n  const monitorLabelText = (typeof texts === 'object' && texts)\n    ? ((texts[currentLang] && texts[currentLang].autoGearMonitorLabel)\n      || (texts.en && texts.en.autoGearMonitorLabel)\n      || 'Onboard monitors')\n    : 'Onboard monitors';\n  const contextNote = monitorLabelText;\n\n  return [\n    {\n      id: generateAutoGearId('rule'),\n      label: monitorLabelText,\n      scenarios: [],\n      mattebox: [],\n      cameraHandle: [],\n      viewfinderExtension: [],\n      videoDistribution: [],\n      camera: [],\n      monitor: monitorLabels.slice(),\n      crewPresent: [],\n      crewAbsent: [],\n      wireless: [],\n      motors: [],\n      controllers: [],\n      distance: [],\n      add: [\n        {\n          id: generateAutoGearId('item'),\n          name: 'ULCS Arm mit 3/8\" und 1/4\" double',\n          category: 'Rigging',\n          quantity: 1,\n          contextNotes: [contextNote],\n        },\n      ],\n      remove: [],\n    },\n  ];\n}\n\n\n\nconst ARRI_VIEWFINDER_BRACKET_NAME = 'ARRI K2.74000.0 VEB-3 Viewfinder Extension Bracket';\nconst ARRI_VIEWFINDER_BRACKET_CATEGORY = 'Camera Support';\n\nfunction createArriViewfinderBracketItem(contextNotes) {\n  if (typeof generateAutoGearId !== 'function') {\n    return null;\n  }\n  const normalizedNotes = Array.isArray(contextNotes)\n    ? contextNotes.filter(note => typeof note === 'string' && note.trim())\n    : [];\n  return {\n    id: generateAutoGearId('item'),\n    name: ARRI_VIEWFINDER_BRACKET_NAME,\n    category: ARRI_VIEWFINDER_BRACKET_CATEGORY,\n    quantity: 1,\n    screenSize: '',\n    selectorType: 'none',\n    selectorDefault: '',\n    selectorEnabled: false,\n    notes: '',\n    contextNotes: normalizedNotes.map(note => note.trim()),\n  };\n}\n\nfunction collectArriCameraNames() {\n  const arriNames = [];\n  const cameraDb = devices && typeof devices === 'object' ? devices.cameras : null;\n  if (!cameraDb || typeof cameraDb !== 'object') {\n    return arriNames;\n  }\n  Object.keys(cameraDb).forEach(name => {\n    if (!name) return;\n    const entry = cameraDb[name];\n    const brand = entry && typeof entry.brand === 'string' ? entry.brand : '';\n    if (/arri/i.test(brand || name)) {\n      arriNames.push(name);\n    }\n  });\n  return arriNames;\n}\n\nfunction createArriBracketRule(options) {\n  if (!options || typeof options !== 'object') {\n    return null;\n  }\n  const addition = createArriViewfinderBracketItem(options.contextNotes || []);\n  if (!addition) {\n    return null;\n  }\n  const cameraList = Array.isArray(options.camera)\n    ? options.camera.filter(Boolean)\n    : [];\n  return {\n    id: generateAutoGearId('rule'),\n    label: typeof options.label === 'string' && options.label.trim()\n      ? options.label.trim()\n      : 'ARRI viewfinder extension support',\n    scenarios: Array.isArray(options.scenarios) ? options.scenarios.filter(Boolean) : [],\n    mattebox: [],\n    cameraHandle: [],\n    viewfinderExtension: Array.isArray(options.viewfinderExtension)\n      ? options.viewfinderExtension.filter(Boolean)\n      : [],\n    deliveryResolution: [],\n    videoDistribution: [],\n    camera: cameraList,\n    monitor: [],\n    tripodHeadBrand: [],\n    tripodBowl: [],\n    tripodTypes: [],\n    tripodSpreader: [],\n    crewPresent: [],\n    crewAbsent: [],\n    wireless: [],\n    motors: [],\n    controllers: [],\n    distance: [],\n    shootingDays: null,\n    add: [addition],\n    remove: [],\n  };\n}\n\nfunction buildArriViewfinderBracketRules(baseInfo = {}) {\n  const arriCameras = collectArriCameraNames();\n  if (!arriCameras.length) {\n    return [];\n  }\n\n  const viewfinderSelection = baseInfo && typeof baseInfo.viewfinderExtension === 'string'\n    ? baseInfo.viewfinderExtension.trim()\n    : '';\n  const selectedScenarios = baseInfo && typeof baseInfo.requiredScenarios === 'string'\n    ? baseInfo.requiredScenarios\n      .split(',')\n      .map(value => (typeof value === 'string' ? value.trim() : ''))\n      .filter(Boolean)\n    : [];\n  const normalizedScenarios = selectedScenarios.map(value => normalizeAutoGearTriggerValue(value)).filter(Boolean);\n  const sliderActive = normalizedScenarios.includes(normalizeAutoGearTriggerValue('Slider'));\n\n  const rules = [];\n  if (viewfinderSelection) {\n    const contextLabel = getSafeViewfinderFallbackLabel(viewfinderSelection);\n    const viewfinderRule = createArriBracketRule({\n      label: `${contextLabel || viewfinderSelection}  ARRI viewfinder support`,\n      viewfinderExtension: [viewfinderSelection],\n      camera: arriCameras.slice(),\n      contextNotes: ['ARRI viewfinder extension support'],\n    });\n    if (viewfinderRule) {\n      rules.push(viewfinderRule);\n    }\n  }\n\n  if (sliderActive && !viewfinderSelection) {\n    const sliderRule = createArriBracketRule({\n      label: 'Slider  ARRI viewfinder extension support',\n      scenarios: ['Slider'],\n      camera: arriCameras.slice(),\n      contextNotes: ['Slider scenario'],\n    });\n    if (sliderRule) {\n      rules.push(sliderRule);\n    }\n  }\n\n  return rules;\n}\n\nfunction buildDefaultVideoDistributionRules(baseInfo = {}) {\n  if (typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const select = document.getElementById('videoDistribution');\n  if (!select) return [];\n\n  const optionValues = [];\n  const seen = new Set();\n  Array.from(select.options || []).forEach(option => {\n    if (!option) return;\n    const rawValue = typeof option.value === 'string' ? option.value.trim() : '';\n    const normalized = normalizeVideoDistributionOption(rawValue);\n    if (!normalized || normalized === '__none__') return;\n    if (seen.has(normalized)) return;\n    seen.add(normalized);\n    optionValues.push(rawValue);\n  });\n\n  if (!optionValues.length) return [];\n\n  const baseProjectInfo = { ...(baseInfo || {}) };\n  delete baseProjectInfo.videoDistribution;\n  const emptyHtml = generateGearListHtml({ ...baseProjectInfo, requiredScenarios: '' });\n  const emptyMap = parseGearTableForAutoRules(emptyHtml);\n  if (!emptyMap) return [];\n\n  const generatedRules = [];\n  const handledTriggers = new Set();\n\n  optionValues.forEach(rawValue => {\n    const trimmed = typeof rawValue === 'string' ? rawValue.trim() : '';\n    if (!trimmed) return;\n    const normalized = normalizeVideoDistributionOption(trimmed);\n    if (!normalized || handledTriggers.has(normalized)) return;\n    handledTriggers.add(normalized);\n\n    const infoForSelection = { ...(baseInfo || {}), videoDistribution: trimmed };\n    const selectionHtml = generateGearListHtml({ ...infoForSelection, requiredScenarios: '' });\n    const selectionMap = parseGearTableForAutoRules(selectionHtml);\n    if (!selectionMap) return;\n\n    const diff = diffGearTableMaps(emptyMap, selectionMap);\n    const additions = cloneAutoGearItems(diff.add);\n    const removals = cloneAutoGearItems(diff.remove);\n    if (!additions.length && !removals.length) return;\n\n    generatedRules.push({\n      id: generateAutoGearId('rule'),\n      label: getSafeVideoDistributionFallbackLabel(trimmed),\n      scenarios: [],\n      mattebox: [],\n      cameraHandle: [],\n      viewfinderExtension: [],\n      videoDistribution: [trimmed],\n      add: additions,\n      remove: removals,\n    });\n  });\n\n  const hasIosOption = optionValues.some(value => value && value.toLowerCase() === 'ios video');\n  if (hasIosOption) {\n    const iosLabel = optionValues.find(value => value && value.toLowerCase() === 'ios video') || 'IOS Video';\n    const normalizedIos = normalizeAutoGearTriggerValue(iosLabel);\n    const hasGeneratedIosRule = generatedRules.some(rule =>\n      Array.isArray(rule.videoDistribution)\n      && rule.videoDistribution.some(value => normalizeAutoGearTriggerValue(value) === normalizedIos)\n    );\n    if (!hasGeneratedIosRule) {\n      const createdNames = new Set();\n      const createItem = (name, category, quantity = 1) => {\n        if (!name || !category || quantity <= 0) return null;\n        const key = `${name}|${category}`;\n        if (createdNames.has(key)) return null;\n        createdNames.add(key);\n        return {\n          id: generateAutoGearId('item'),\n          name,\n          category,\n          quantity,\n          screenSize: '',\n          selectorType: 'none',\n          selectorDefault: '',\n          selectorEnabled: false,\n          notes: '',\n        };\n      };\n\n      const additions = [];\n      const iosDevices = devices && typeof devices === 'object' ? devices.iosVideo : null;\n      if (iosDevices && typeof iosDevices === 'object') {\n        Object.keys(iosDevices).forEach(deviceName => {\n          const item = createItem(deviceName, 'Monitoring');\n          if (item) additions.push(item);\n        });\n      }\n\n      if (!additions.length) {\n        const fallback = createItem('Teradek - Link AX WifiRouter/Access Point', 'Monitoring');\n        if (fallback) additions.push(fallback);\n      }\n\n      const pushSupport = (name, category, quantity = 1) => {\n        const item = createItem(name, category, quantity);\n        if (item) additions.push(item);\n      };\n\n      pushSupport('Apple iPad Air 5 or better', 'Monitoring', 1);\n      pushSupport('USB-C Charger (iOS Video)', 'Monitoring support', 2);\n      pushSupport('Wi-Fi Router (iOS Video Village)', 'Monitoring support');\n\n      if (additions.length) {\n        generatedRules.push({\n          id: generateAutoGearId('rule'),\n          label: getSafeVideoDistributionFallbackLabel(iosLabel),\n          scenarios: [],\n          mattebox: [],\n          cameraHandle: [],\n          viewfinderExtension: [],\n          videoDistribution: [iosLabel],\n          add: additions,\n          remove: [],\n        });\n      }\n    }\n  }\n\n  return generatedRules;\n}\n\nfunction buildDefaultMatteboxAutoGearRules() {\n  return [];\n}\n\nfunction buildMatteboxAutoGearRules(baseInfo = {}) {\n  if (typeof generateGearListHtml !== 'function' || typeof parseGearTableForAutoRules !== 'function') {\n    return [];\n  }\n\n  const select = document.getElementById('mattebox');\n  if (!select) return [];\n\n  const optionValues = [];\n  const seen = new Set();\n  Array.from(select.options || []).forEach(option => {\n    if (!option) return;\n    const rawValue = typeof option.value === 'string' ? option.value.trim() : '';\n    const normalized = normalizeMatteboxOption(rawValue);\n    if (!normalized || normalized === '__none__') return;\n    if (seen.has(normalized)) return;\n    seen.add(normalized);\n    optionValues.push(rawValue);\n  });\n\n  if (!optionValues.length) return [];\n\n  const baseProjectInfo = { ...(baseInfo || {}) };\n  delete baseProjectInfo.mattebox;\n  const emptyHtml = generateGearListHtml({ ...baseProjectInfo, requiredScenarios: '' });\n  const emptyMap = parseGearTableForAutoRules(emptyHtml);\n  if (!emptyMap) return [];\n\n  const generatedRules = [];\n  const handledTriggers = new Set();\n\n  optionValues.forEach(rawValue => {\n    const trimmed = typeof rawValue === 'string' ? rawValue.trim() : '';\n    if (!trimmed) return;\n    const normalized = normalizeMatteboxOption(trimmed);\n    if (!normalized || handledTriggers.has(normalized)) return;\n    handledTriggers.add(normalized);\n\n    const infoForSelection = { ...(baseInfo || {}), mattebox: trimmed };\n    const selectionHtml = generateGearListHtml({ ...infoForSelection, requiredScenarios: '' });\n    const selectionMap = parseGearTableForAutoRules(selectionHtml);\n    if (!selectionMap) return;\n\n    const diff = diffGearTableMaps(emptyMap, selectionMap);\n    const additions = cloneAutoGearItems(diff.add);\n    const removals = cloneAutoGearItems(diff.remove);\n    if (!additions.length && !removals.length) return;\n\n    generatedRules.push({\n      id: generateAutoGearId('rule'),\n      label: getSafeMatteboxFallbackLabel(trimmed),\n      scenarios: [],\n      mattebox: [trimmed],\n      cameraHandle: [],\n      viewfinderExtension: [],\n      videoDistribution: [],\n      add: additions,\n      remove: removals,\n    });\n  });\n\n  return generatedRules;\n}\n\nfunction resolveHandUnitCompatibilityMaps() {\n  let groups = null;\n  let motorMap = null;\n  try {\n    if (typeof AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS !== 'undefined'\n      && AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS\n      && typeof AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS === 'object') {\n      groups = AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS;\n    }\n  } catch (error) {\n    void error;\n  }\n  if (!groups && GLOBAL_SCOPE && typeof GLOBAL_SCOPE.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS === 'object') {\n    groups = GLOBAL_SCOPE.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS;\n  }\n  try {\n    if (typeof AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP !== 'undefined'\n      && AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP\n      && typeof AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP === 'object') {\n      motorMap = AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP;\n    }\n  } catch (error) {\n    void error;\n  }\n  if (!motorMap && GLOBAL_SCOPE && typeof GLOBAL_SCOPE.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP === 'object') {\n    motorMap = GLOBAL_SCOPE.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP;\n  }\n  return {\n    groups: groups && typeof groups === 'object' ? groups : null,\n    motorMap: motorMap && typeof motorMap === 'object' ? motorMap : null,\n  };\n}\n\nfunction getHandUnitGroupForMotor(motorName) {\n  if (!motorName) return null;\n  const maps = resolveHandUnitCompatibilityMaps();\n  if (!maps.groups) return null;\n  const normalized = normalizeAutoGearTriggerValue(motorName);\n  if (!normalized) return null;\n  let key = null;\n  if (maps.motorMap && Object.prototype.hasOwnProperty.call(maps.motorMap, normalized)) {\n    key = maps.motorMap[normalized];\n  } else if (Object.prototype.hasOwnProperty.call(maps.groups, normalized)) {\n    key = normalized;\n  }\n  if (!key || !maps.groups[key]) {\n    return null;\n  }\n  const group = maps.groups[key];\n  if (!group || !Array.isArray(group.options) || !group.options.length) {\n    return null;\n  }\n  return { key, group };\n}\n\nfunction collectAllWirelessTransmitterNames() {\n  const names = [];\n  if (!devices || typeof devices !== 'object') {\n    return names;\n  }\n  const videoDb = devices.video && typeof devices.video === 'object' ? devices.video : null;\n  if (!videoDb) {\n    return names;\n  }\n  Object.keys(videoDb).forEach(name => {\n    if (!name || name === 'None') return;\n    if (!names.includes(name)) {\n      names.push(name);\n    }\n  });\n  return names;\n}\n\nfunction buildMotorHandUnitAutoGearRules(baseInfo) {\n  const maps = resolveHandUnitCompatibilityMaps();\n  if (!maps.groups) {\n    return [];\n  }\n\n  const setupValues = typeof captureSetupSelectValues === 'function'\n    ? captureSetupSelectValues()\n    : null;\n\n  const rawMotors = [];\n  if (setupValues && Array.isArray(setupValues.motors)) {\n    rawMotors.push(...setupValues.motors);\n  }\n  if (baseInfo && Array.isArray(baseInfo.motorSelections)) {\n    rawMotors.push(...baseInfo.motorSelections);\n  }\n  if (baseInfo && Array.isArray(baseInfo.motors)) {\n    rawMotors.push(...baseInfo.motors);\n  }\n\n  const motorEntries = rawMotors\n    .map(name => (typeof name === 'string' ? name.trim() : ''))\n    .filter(name => name && name !== 'None')\n    .map(name => ({ name, normalized: normalizeAutoGearTriggerValue(name) }))\n    .filter(entry => entry.normalized);\n\n  if (!motorEntries.length) {\n    return [];\n  }\n\n  let wirelessSelection = '';\n  if (setupValues && typeof setupValues.video === 'string') {\n    wirelessSelection = setupValues.video.trim();\n  }\n  if (!wirelessSelection && baseInfo && typeof baseInfo.wirelessSelection === 'string') {\n    wirelessSelection = baseInfo.wirelessSelection.trim();\n  }\n  if (!wirelessSelection || wirelessSelection === 'None') {\n    return [];\n  }\n\n  const additions = [];\n  const handledGroups = new Set();\n  motorEntries.forEach(entry => {\n    const resolved = getHandUnitGroupForMotor(entry.normalized);\n    if (!resolved || handledGroups.has(resolved.key)) {\n      return;\n    }\n    handledGroups.add(resolved.key);\n    const group = resolved.group;\n    const options = Array.isArray(group.options) ? group.options.filter(Boolean) : [];\n    if (!options.length) {\n      return;\n    }\n    const defaultOption = typeof group.defaultOption === 'string' && group.defaultOption\n      ? group.defaultOption\n      : options[0];\n    const contextNotes = [];\n    if (group.label) {\n      contextNotes.push(group.label);\n    }\n    if (Array.isArray(group.motors) && group.motors.length) {\n      contextNotes.push(`Compatible motors: ${group.motors.join(', ')}`);\n    }\n    additions.push({\n      id: generateAutoGearId('item'),\n      name: defaultOption,\n      category: 'LDS (FIZ)',\n      quantity: 1,\n      screenSize: '',\n      selectorType: 'fizHandUnit',\n      selectorDefault: defaultOption,\n      selectorEnabled: true,\n      selectorContext: resolved.key,\n      notes: '',\n      contextNotes,\n    });\n  });\n\n  if (!additions.length) {\n    return [];\n  }\n\n  const wirelessTargets = collectAllWirelessTransmitterNames();\n  if (!wirelessTargets.length) {\n    wirelessTargets.push(wirelessSelection);\n  }\n\n  return [{\n    id: generateAutoGearId('rule'),\n    label: 'FIZ hand units',\n    scenarios: [],\n    mattebox: [],\n    cameraHandle: [],\n    viewfinderExtension: [],\n    videoDistribution: [],\n    camera: [],\n    monitor: [],\n    wireless: wirelessTargets,\n    motors: [AUTO_GEAR_ANY_MOTOR_TOKEN],\n    controllers: [],\n    distance: [],\n    add: additions,\n    remove: [],\n  }];\n}\n\nfunction buildAutoGearAnyMotorRule() {\n  if (typeof captureSetupSelectValues !== 'function') return null;\n  const setupValues = captureSetupSelectValues();\n  const selectedMotors = Array.isArray(setupValues?.motors)\n    ? setupValues.motors.filter(value => typeof value === 'string' && value && value !== 'None')\n    : [];\n  if (!selectedMotors.length) return null;\n\n  const createItem = (name, category, quantity = 1) => {\n    if (!name || !category || quantity <= 0) return null;\n    return {\n      id: generateAutoGearId('item'),\n      name,\n      category,\n      quantity,\n      screenSize: '',\n      selectorType: 'none',\n      selectorDefault: '',\n      selectorEnabled: false,\n      notes: '',\n    };\n  };\n\n  const additions = [];\n  const pushItem = (name, category, quantity = 1) => {\n    const item = createItem(name, category, quantity);\n    if (item) additions.push(item);\n  };\n\n  pushItem('Avenger C-Stand Sliding Leg 20\" (Focus)', 'Grip');\n  pushItem('Steelfingers Wheel C-Stand 3er Set (Focus)', 'Grip');\n  pushItem('Lite-Tite Swivel Aluminium Umbrella Adapter (Focus)', 'Grip');\n  pushItem('Tennis ball', 'Grip', 3);\n  pushItem('D-Tap to Mini XLR 3-pin Cable 0,3m (Focus)', 'Monitoring support', 2);\n  pushItem('Ultraslim BNC Cable 0.3 m (Focus)', 'Monitoring support', 2);\n  pushItem('Bebob V150micro (V-Mount) (Focus)', 'Monitoring Batteries', 3);\n\n  if (!additions.length) return null;\n\n  return {\n    id: generateAutoGearId('rule'),\n    label: 'FIZ motor support kit',\n    scenarios: [],\n    mattebox: [],\n    cameraHandle: [],\n    viewfinderExtension: [],\n    deliveryResolution: [],\n    videoDistribution: [],\n    camera: [],\n    monitor: [],\n    crewPresent: [],\n    crewAbsent: [],\n    wireless: [],\n    motors: [AUTO_GEAR_ANY_MOTOR_TOKEN],\n    controllers: [],\n    distance: [],\n    add: additions,\n    remove: [],\n  };\n}\n\nfunction buildAlwaysAutoGearRule() {\n  const createItem = (name, category, quantity = 1, options = {}) => {\n    if (!name || !category || quantity <= 0) return null;\n    return {\n      id: generateAutoGearId('item'),\n      name,\n      category,\n      quantity,\n      screenSize: typeof options.screenSize === 'string' ? options.screenSize : '',\n      selectorType: typeof options.selectorType === 'string' ? options.selectorType : 'none',\n      selectorDefault: typeof options.selectorDefault === 'string' ? options.selectorDefault : '',\n      selectorEnabled: options.selectorEnabled === true,\n      notes: typeof options.notes === 'string' ? options.notes : '',\n    };\n  };\n  const additions = [];\n  const pushItem = (name, category, quantity, options) => {\n    const item = createItem(name, category, quantity, options);\n    if (item) additions.push(item);\n  };\n  [\n    ['BNC Cable 0.5 m', 'Monitoring support', 1],\n    ['BNC Cable 1 m', 'Monitoring support', 1],\n    ['BNC Cable 5 m', 'Monitoring support', 1],\n    ['BNC Cable 10 m', 'Monitoring support', 1],\n    ['BNC Drum 25 m', 'Monitoring support', 1],\n    ['BNC Connector', 'Monitoring support', 4],\n    ['ULCS Bracket with 1/4\" to 1/4\"', 'Rigging', 2],\n    ['ULCS Bracket with 3/8\" to 1/4\"', 'Rigging', 2],\n    ['Noga Arm', 'Rigging', 2],\n    ['Mini Magic Arm', 'Rigging', 2],\n    ['Cine Quick Release', 'Rigging', 4],\n    ['SmallRig - Super lightweight 15mm RailBlock', 'Rigging', 1],\n    ['Spigot with male 3/8\" and 1/4\"', 'Rigging', 3],\n    ['Clapper Stick', 'Rigging', 2],\n    ['D-Tap Splitter', 'Rigging', 2],\n    ['Magliner Senior - with quick release mount + tripod holder + utility tray + OConnor-Aufhngung', 'Carts and Transportation', 1],\n    ['Securing Straps (25mm wide)', 'Carts and Transportation', 10],\n    ['Loading Ramp (pair, 420kg)', 'Carts and Transportation', 1],\n    ['Ring Fitting for Airline Rails', 'Carts and Transportation', 20],\n    ['Power Cable Drum 25-50 m', 'Power', 1],\n    ['Power Cable 10 m', 'Power', 2],\n    ['Power Cable 5 m', 'Power', 2],\n    ['Power Strip', 'Power', 3],\n    ['Power Three Way Splitter', 'Power', 3],\n    ['PRCD-S (Portable Residual Current Device-Safety)', 'Power', 3],\n  ].forEach(([name, category, quantity]) => pushItem(name, category, quantity));\n\n  if (!additions.length) return null;\n\n  return {\n    id: generateAutoGearId('rule'),\n    label: 'Always',\n    always: true,\n    scenarios: [],\n    mattebox: [],\n    cameraHandle: [],\n    viewfinderExtension: [],\n    videoDistribution: [],\n    camera: [],\n    monitor: [],\n    wireless: [],\n    motors: [],\n    controllers: [],\n    distance: [],\n    add: additions,\n    remove: [],\n  };\n}\n\nfunction buildFiveDayConsumablesAutoGearRule() {\n  const createItem = (name, category, quantity = 1, options = {}) => {\n    if (!name || !category || quantity <= 0) return null;\n    return {\n      id: generateAutoGearId('item'),\n      name,\n      category,\n      quantity,\n      screenSize: typeof options.screenSize === 'string' ? options.screenSize : '',\n      selectorType: typeof options.selectorType === 'string' ? options.selectorType : 'none',\n      selectorDefault: typeof options.selectorDefault === 'string' ? options.selectorDefault : '',\n      selectorEnabled: options.selectorEnabled === true,\n      notes: typeof options.notes === 'string' ? options.notes : '',\n    };\n  };\n\n  const additions = [];\n  const pushItem = (name, category, quantity, options) => {\n    const item = createItem(name, category, quantity, options);\n    if (item) additions.push(item);\n  };\n\n  pushItem('Bluestar eye leather made of microfiber oval, large', 'Consumables', 4);\n  pushItem('Pro Gaff Tape', 'Consumables', 2, { notes: 'Primary color roll' });\n  pushItem('Pro Gaff Tape', 'Consumables', 2, { notes: 'Secondary color roll' });\n  pushItem('Clapper Stick', 'Rigging', 4);\n  pushItem('Kimtech Wipes', 'Consumables', 2);\n  pushItem('Sprigs Red 1/4\"', 'Consumables', 1);\n\n  if (!additions.length) return null;\n\n  return {\n    id: generateAutoGearId('rule'),\n    label: 'Every 5 shooting days',\n    scenarios: [],\n    mattebox: [],\n    cameraHandle: [],\n    viewfinderExtension: [],\n    deliveryResolution: [],\n    videoDistribution: [],\n    camera: [],\n    monitor: [],\n    crewPresent: [],\n    crewAbsent: [],\n    wireless: [],\n    motors: [],\n    controllers: [],\n    distance: [],\n    shootingDays: { mode: 'every', value: 5 },\n    add: additions,\n    remove: [],\n  };\n}\n\nfunction ensureDefaultMatteboxAutoGearRules() {\n  const defaults = buildDefaultMatteboxAutoGearRules();\n  if (!defaults.length) return false;\n  const existingKeys = new Set(\n    autoGearRules\n      .map(autoGearRuleMatteboxKey)\n      .filter(Boolean)\n  );\n  const additions = defaults.filter(rule => {\n    const key = autoGearRuleMatteboxKey(rule);\n    if (!key) return false;\n    if (existingKeys.has(key)) return false;\n    existingKeys.add(key);\n    return true;\n  });\n  if (!additions.length) return false;\n  setAutoGearRules(autoGearRules.concat(additions));\n  return true;\n}\n\nfunction captureSetupSelectValues() {\n  const captureList = list => list.map(sel => (sel && typeof sel.value === 'string') ? sel.value : '');\n  const captured = {\n    camera: cameraSelect && typeof cameraSelect.value === 'string' ? cameraSelect.value : '',\n    monitor: monitorSelect && typeof monitorSelect.value === 'string' ? monitorSelect.value : '',\n    video: videoSelect && typeof videoSelect.value === 'string' ? videoSelect.value : '',\n    cage: cageSelect && typeof cageSelect.value === 'string' ? cageSelect.value : '',\n    distance: distanceSelect && typeof distanceSelect.value === 'string' ? distanceSelect.value : '',\n    battery: batterySelect && typeof batterySelect.value === 'string' ? batterySelect.value : '',\n    batteryPlate: batteryPlateSelect && typeof batteryPlateSelect.value === 'string'\n      ? batteryPlateSelect.value\n      : '',\n    hotswap: hotswapSelect && typeof hotswapSelect.value === 'string' ? hotswapSelect.value : '',\n    motors: captureList(motorSelects),\n    controllers: captureList(controllerSelects),\n    sliderBowl: typeof getSliderBowlValue === 'function' ? getSliderBowlValue() : '',\n    easyrig: typeof getEasyrigValue === 'function' ? getEasyrigValue() : '',\n  };\n  return finalizeCapturedSetupValues(captured);\n}\n\nfunction finalizeCapturedSetupValues(values) {\n  if (!values || typeof values !== 'object') {\n    return values;\n  }\n  values.batteryPlate = normalizeBatteryPlateValue(values.batteryPlate, values.battery);\n  return values;\n}\n\nfunction applySetupSelectValues(values) {\n  if (!values || typeof values !== 'object') return;\n  if (cameraSelect) {\n    setSelectValue(cameraSelect, values.camera);\n    if (typeof updateBatteryPlateVisibility === 'function') {\n      updateBatteryPlateVisibility();\n    }\n    if (typeof updateBatteryOptions === 'function') {\n      updateBatteryOptions();\n    }\n  }\n  if (batteryPlateSelect) setSelectValue(batteryPlateSelect, values.batteryPlate);\n  if (values && typeof values.battery === 'string') {\n    applyBatteryPlateSelectionFromBattery(values.battery, batteryPlateSelect ? batteryPlateSelect.value : '');\n  }\n  if (monitorSelect) setSelectValue(monitorSelect, values.monitor);\n  if (videoSelect) setSelectValue(videoSelect, values.video);\n  if (cageSelect) setSelectValue(cageSelect, values.cage);\n  if (distanceSelect) setSelectValue(distanceSelect, values.distance);\n  if (Array.isArray(values.motors)) {\n    values.motors.forEach((val, index) => {\n      if (motorSelects[index]) setSelectValue(motorSelects[index], val);\n    });\n  }\n  if (Array.isArray(values.controllers)) {\n    values.controllers.forEach((val, index) => {\n      if (controllerSelects[index]) setSelectValue(controllerSelects[index], val);\n    });\n  }\n  if (batterySelect) setSelectValue(batterySelect, values.battery);\n  if (hotswapSelect) setSelectValue(hotswapSelect, values.hotswap);\n  if (typeof setSliderBowlValue === 'function') setSliderBowlValue(values.sliderBowl);\n  if (typeof setEasyrigValue === 'function') setEasyrigValue(values.easyrig);\n}\n\nfunction captureAutoGearSeedContext() {\n  if (factoryAutoGearSeedContext) return;\n  if (typeof collectProjectFormData !== 'function') return;\n  const baseInfo = collectProjectFormData() || {};\n  let projectDataClone = cloneWithStructuredCloneFallback(baseInfo);\n  if (!projectDataClone || typeof projectDataClone !== 'object') {\n    projectDataClone = { ...baseInfo };\n  }\n  const scenarioValues = requiredScenariosSelect\n    ? Array.from(requiredScenariosSelect.options || [])\n      .map(opt => opt && typeof opt.value === 'string' ? opt.value : '')\n      .filter(value => value)\n    : [];\n  factoryAutoGearSeedContext = {\n    projectFormData: projectDataClone,\n    scenarioValues,\n    setupValues: captureSetupSelectValues(),\n  };\n}\n\nfunction buildAutoGearRulesFromBaseInfo(baseInfo, scenarioValues) {\n  const rules = [];\n  const canGenerateRules = typeof generateGearListHtml === 'function'\n    && typeof parseGearTableForAutoRules === 'function';\n  const scenarios = Array.isArray(scenarioValues)\n    ? scenarioValues.filter(value => typeof value === 'string' && value)\n    : [];\n\n  let baselineMap = null;\n  if (canGenerateRules) {\n    const baselineHtml = generateGearListHtml({ ...baseInfo, requiredScenarios: '' });\n    baselineMap = parseGearTableForAutoRules(baselineHtml);\n\n    if (baselineMap && scenarios.length) {\n      const scenarioDiffMap = new Map();\n      scenarios.forEach(value => {\n        const scenarioHtml = generateGearListHtml({ ...baseInfo, requiredScenarios: value });\n        const scenarioMap = parseGearTableForAutoRules(scenarioHtml);\n        if (!scenarioMap) return;\n        const diff = diffGearTableMaps(baselineMap, scenarioMap);\n        let add = cloneAutoGearItems(diff.add);\n        let remove = cloneAutoGearItems(diff.remove);\n        if (!add.length && !remove.length) return;\n        scenarioDiffMap.set(value, { add, remove });\n        rules.push({\n          id: generateAutoGearId('rule'),\n          label: value,\n          scenarios: [value],\n          add,\n          remove,\n        });\n      });\n\n      const comboCandidates = [\n        ['Handheld', 'Easyrig'],\n        ['Slider', 'Undersling mode']\n      ].filter(combo => combo.every(value => scenarios.includes(value)));\n\n      comboCandidates.forEach(combo => {\n        const combinedLabel = combo.join(' + ');\n        const scenarioHtml = generateGearListHtml({\n          ...baseInfo,\n          requiredScenarios: combo.join(', ')\n        });\n        const scenarioMap = parseGearTableForAutoRules(scenarioHtml);\n        if (!scenarioMap) return;\n        const diff = diffGearTableMaps(baselineMap, scenarioMap);\n        const adjusted = subtractScenarioContributions({\n          add: cloneAutoGearItems(diff.add),\n          remove: cloneAutoGearItems(diff.remove)\n        }, combo, scenarioDiffMap);\n        if (!adjusted.add.length && !adjusted.remove.length) return;\n        rules.push({\n          id: generateAutoGearId('rule'),\n          label: combinedLabel,\n          scenarios: combo.slice(),\n          add: adjusted.add,\n          remove: adjusted.remove,\n        });\n      });\n\n      const rainOverlapKeys = ['Extreme rain', 'Rain Machine'];\n      const hasRainOverlap = rainOverlapKeys.every(key => scenarioDiffMap.has(key));\n      if (hasRainOverlap) {\n        const overlapRemovals = [\n          { name: 'Schulz Sprayoff Micro', quantity: 1, category: 'Matte box + filter' },\n          { name: 'Fischer RS to D-Tap cable 0,5m', quantity: 2, category: 'Rigging' },\n          { name: 'Spare Disc (Schulz Sprayoff Micro)', quantity: 1, category: 'Matte box + filter' },\n        ].map(entry => ({\n          id: generateAutoGearId('item'),\n          name: entry.name,\n          category: entry.category,\n          quantity: entry.quantity,\n        }));\n        rules.push({\n          id: generateAutoGearId('rule'),\n          label: 'Extreme rain + Rain Machine overlap',\n          scenarios: rainOverlapKeys.slice(),\n          add: [],\n          remove: overlapRemovals,\n        });\n      }\n    }\n  }\n\n  if (baselineMap) {\n    buildCameraHandleAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildViewfinderExtensionAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildVideoDistributionAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildMatteboxAutoGearRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildCageAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildTripodAutoGearRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildBatteryAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildDistanceAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildHotswapAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n    buildBatteryPlateAutoRules(baseInfo, baselineMap).forEach(rule => rules.push(rule));\n\n    const existingSignatures = new Set(\n      rules\n        .map(autoGearRuleSignature)\n        .filter(signature => typeof signature === 'string' && signature)\n    );\n\n    const appendUniqueRules = additionalRules => {\n      if (!Array.isArray(additionalRules) || !additionalRules.length) {\n        return;\n      }\n      additionalRules.forEach(rule => {\n        const signature = autoGearRuleSignature(rule);\n        if (!signature || existingSignatures.has(signature)) return;\n        rules.push(rule);\n        existingSignatures.add(signature);\n      });\n    };\n\n    appendUniqueRules(buildDefaultVideoDistributionRules(baseInfo));\n    appendUniqueRules(buildOnboardMonitorRiggingAutoGearRules());\n    appendUniqueRules(buildTripodPreferenceAutoGearRules(baseInfo));\n    appendUniqueRules(buildArriViewfinderBracketRules(baseInfo));\n    appendUniqueRules(buildMotorHandUnitAutoGearRules(baseInfo));\n  }\n\n  const anyMotorRule = buildAutoGearAnyMotorRule();\n  if (anyMotorRule) {\n    const targetSignature = autoGearRuleSignature(anyMotorRule);\n    const exists = rules.some(rule => autoGearRuleSignature(rule) === targetSignature);\n    if (!exists) {\n      rules.push(anyMotorRule);\n    }\n  }\n\n  const alwaysRule = buildAlwaysAutoGearRule();\n  if (alwaysRule) {\n    rules.push(alwaysRule);\n  }\n\n  const fiveDayRule = buildFiveDayConsumablesAutoGearRule();\n  if (fiveDayRule) {\n    rules.push(fiveDayRule);\n  }\n\n  buildDefaultMatteboxAutoGearRules().forEach(rule => rules.push(rule));\n  return rules;\n}\n\nfunction computeFactoryAutoGearRules() {\n  captureAutoGearSeedContext();\n  const context = factoryAutoGearSeedContext;\n  if (!context) return null;\n\n  const previousSelectValues = captureSetupSelectValues();\n  const seededBeforeCompute = hasSeededAutoGearDefaults();\n  const savedAutoGearRules = autoGearRules.slice();\n  const savedBaseAutoGearRules = baseAutoGearRulesState.slice();\n  const savedProjectScopedRules = projectScopedAutoGearRules\n    ? projectScopedAutoGearRules.slice()\n    : null;\n  const savedBackupSignature = autoGearRulesLastBackupSignature;\n  const savedPersistedSignature = autoGearRulesLastPersistedSignature;\n  const savedDirtyFlag = autoGearRulesDirtySinceBackup;\n  try {\n    if (seededBeforeCompute) {\n      clearAutoGearDefaultsSeeded();\n    }\n    assignAutoGearRules([]);\n    baseAutoGearRulesState = [];\n    projectScopedAutoGearRules = null;\n    autoGearRulesLastBackupSignature = savedBackupSignature;\n    autoGearRulesLastPersistedSignature = savedPersistedSignature;\n    autoGearRulesDirtySinceBackup = savedDirtyFlag;\n    applySetupSelectValues(context.setupValues);\n    const baseInfoSource = context.projectFormData || {};\n    let baseInfo = cloneWithStructuredCloneFallback(baseInfoSource);\n    if (!baseInfo || typeof baseInfo !== 'object') {\n      baseInfo = { ...baseInfoSource };\n    }\n    const rules = buildAutoGearRulesFromBaseInfo(baseInfo, context.scenarioValues || []);\n    if (rules.length) {\n      setFactoryAutoGearRulesSnapshot(rules);\n    }\n    return rules;\n  } finally {\n    applySetupSelectValues(previousSelectValues);\n    assignAutoGearRules(savedAutoGearRules);\n    baseAutoGearRulesState = savedBaseAutoGearRules.slice();\n    projectScopedAutoGearRules = savedProjectScopedRules\n      ? savedProjectScopedRules.slice()\n      : null;\n    autoGearRulesLastBackupSignature = savedBackupSignature;\n    autoGearRulesLastPersistedSignature = savedPersistedSignature;\n    autoGearRulesDirtySinceBackup = savedDirtyFlag;\n    if (seededBeforeCompute) {\n      markAutoGearDefaultsSeeded();\n    }\n  }\n}\n\nfunction seedAutoGearRulesFromCurrentProject() {\n  captureAutoGearSeedContext();\n  const seededBefore = hasSeededAutoGearDefaults();\n\n  if (autoGearRules.length) {\n    const addedDefaults = ensureDefaultMatteboxAutoGearRules();\n    if (addedDefaults && !seededBefore) {\n      markAutoGearDefaultsSeeded();\n      setFactoryAutoGearRulesSnapshot(getAutoGearRules());\n    } else if (!factoryAutoGearRulesSnapshot) {\n      setFactoryAutoGearRulesSnapshot(getAutoGearRules());\n    }\n    return;\n  }\n\n  if (seededBefore) {\n    const addedDefaults = ensureDefaultMatteboxAutoGearRules();\n    if (addedDefaults && !factoryAutoGearRulesSnapshot) {\n      setFactoryAutoGearRulesSnapshot(getAutoGearRules());\n    }\n    return;\n  }\n\n  const baseInfo = factoryAutoGearSeedContext && factoryAutoGearSeedContext.projectFormData\n    ? { ...factoryAutoGearSeedContext.projectFormData }\n    : (collectProjectFormData ? collectProjectFormData() : {});\n  const scenarioValues = factoryAutoGearSeedContext && Array.isArray(factoryAutoGearSeedContext.scenarioValues)\n    ? factoryAutoGearSeedContext.scenarioValues\n    : (requiredScenariosSelect\n      ? Array.from(requiredScenariosSelect.options || [])\n        .map(opt => opt && opt.value)\n        .filter(Boolean)\n      : []);\n\n  const rules = buildAutoGearRulesFromBaseInfo(baseInfo, scenarioValues);\n  if (!rules.length) {\n    const addedDefaults = ensureDefaultMatteboxAutoGearRules();\n    if (addedDefaults) {\n      markAutoGearDefaultsSeeded();\n      setFactoryAutoGearRulesSnapshot(getAutoGearRules());\n    }\n    return;\n  }\n  setAutoGearRules(rules);\n  markAutoGearDefaultsSeeded();\n  setFactoryAutoGearRulesSnapshot(rules);\n}\n\nfunction resetAutoGearRulesToFactoryAdditions() {\n  const langTexts = texts[currentLang] || texts.en || {};\n  const fallbackTexts = texts.en || {};\n  const confirmation = langTexts.autoGearResetFactoryConfirm\n    || texts.en?.autoGearResetFactoryConfirm\n    || 'Replace your automatic gear rules with the default additions?';\n\n  const performReset = () => {\n    const exportFailureMessage = langTexts.autoGearResetFactoryExportFailed\n      || fallbackTexts.autoGearResetFactoryExportFailed\n      || 'Automatic gear preset export failed. Reset cancelled.';\n\n    let presetExportOutcome = { status: 'skipped', reason: 'empty' };\n    if (typeof exportAutoGearPresets === 'function') {\n      try {\n        const result = exportAutoGearPresets({ reason: 'reset-auto-gear' });\n        presetExportOutcome = result || { status: 'failed', reason: 'unknown' };\n      } catch (exportError) {\n        console.error('Failed to export automatic gear presets before reset', exportError);\n        presetExportOutcome = { status: 'failed', reason: 'exception', error: exportError };\n      }\n    } else {\n      presetExportOutcome = { status: 'failed', reason: 'unavailable' };\n    }\n\n    if (\n      !presetExportOutcome\n      || presetExportOutcome.status === 'failed'\n      || (presetExportOutcome.status === 'skipped' && presetExportOutcome.reason !== 'empty')\n    ) {\n      if (typeof showNotification === 'function') {\n        showNotification('error', exportFailureMessage);\n      }\n      return;\n    }\n\n    const backupName = ensureAutoBackupBeforeDeletion('reset automatic gear rules');\n    if (!backupName) {\n      return;\n    }\n\n    const successMessage = langTexts.autoGearResetFactoryDone\n      || fallbackTexts.autoGearResetFactoryDone\n      || 'Automatic gear rules restored to factory additions.';\n    const emptyMessage = langTexts.autoGearResetFactoryEmpty\n      || fallbackTexts.autoGearResetFactoryEmpty\n      || 'Factory additions unavailable. Automatic gear rules cleared.';\n    const failureMessage = langTexts.autoGearResetFactoryError\n      || fallbackTexts.autoGearResetFactoryError\n      || 'Reset failed. Please try again.';\n\n    try {\n      const factoryRules = computeFactoryAutoGearRules();\n      if (Array.isArray(factoryRules) && factoryRules.length) {\n        setAutoGearRules(factoryRules);\n        markAutoGearDefaultsSeeded();\n        setFactoryAutoGearRulesSnapshot(getAutoGearRules());\n        if (typeof showNotification === 'function') {\n          showNotification('success', successMessage);\n        }\n        return;\n      }\n\n      setAutoGearRules([]);\n      setFactoryAutoGearRulesSnapshot(null);\n      clearAutoGearDefaultsSeeded();\n      const addedDefaults = ensureDefaultMatteboxAutoGearRules();\n      if (addedDefaults) {\n        markAutoGearDefaultsSeeded();\n        setFactoryAutoGearRulesSnapshot(getAutoGearRules());\n        if (typeof showNotification === 'function') {\n          showNotification('success', successMessage);\n        }\n        return;\n      }\n      if (typeof showNotification === 'function') {\n        showNotification('info', emptyMessage);\n      }\n    } catch (error) {\n      console.error('Failed to reset automatic gear rules to factory additions', error);\n      if (typeof showNotification === 'function') {\n        showNotification('error', failureMessage);\n      }\n      if (backupName && typeof notifyAutoSaveFromBackup === 'function') {\n        try {\n          notifyAutoSaveFromBackup(failureMessage, backupName, 'error');\n        } catch (notifyError) {\n          console.warn('Failed to announce automatic backup after reset failure', notifyError);\n        }\n      }\n    }\n  };\n\n  if (typeof window.cineShowConfirmDialog === 'function') {\n    window.cineShowConfirmDialog({\n      title: langTexts.autoGearResetFactoryTitle || 'Reset to Factory',\n      message: confirmation,\n      confirmLabel: langTexts.autoGearResetFactoryConfirmLabel || 'Reset',\n      cancelLabel: langTexts.cancel || 'Cancel',\n      danger: true,\n      onConfirm: performReset,\n    });\n    return;\n  }\n\n  console.warn('Missing window.cineShowConfirmDialog for resetAutoGearRulesToFactoryAdditions');\n}\n\nconst autoGearRulesAPI = freezeDeep({\n  getFactoryAutoGearRulesSnapshot: function getFactoryAutoGearRulesSnapshot() {\n    return factoryAutoGearRulesSnapshot\n      ? cloneAutoGearRules(factoryAutoGearRulesSnapshot)\n      : null;\n  },\n  getFactoryAutoGearSeedContext: function getFactoryAutoGearSeedContext() {\n    if (!factoryAutoGearSeedContext) {\n      return null;\n    }\n    const clonedContext = cloneWithStructuredCloneFallback(factoryAutoGearSeedContext);\n    if (clonedContext && typeof clonedContext === 'object') {\n      return clonedContext;\n    }\n    return { ...factoryAutoGearSeedContext };\n  },\n  setFactoryAutoGearRulesSnapshot,\n  cloneAutoGearItems,\n  cloneAutoGearRuleItem,\n  cloneAutoGearRule,\n  cloneAutoGearRules,\n  subtractScenarioContributions,\n  extractAutoGearSelections,\n  buildCameraHandleAutoRules,\n  buildViewfinderExtensionAutoRules,\n  buildVideoDistributionAutoRules,\n  buildOnboardMonitorRiggingAutoGearRules,\n  buildTripodPreferenceAutoGearRules,\n  buildDefaultVideoDistributionAutoGearRules: buildDefaultVideoDistributionRules,\n  buildDefaultMatteboxAutoGearRules,\n  buildAutoGearAnyMotorRule,\n  buildAlwaysAutoGearRule,\n  buildFiveDayConsumablesAutoGearRule,\n  buildArriViewfinderBracketRules,\n  ensureDefaultMatteboxAutoGearRules,\n  captureAutoGearSeedContext,\n  buildAutoGearRulesFromBaseInfo,\n  computeFactoryAutoGearRules,\n  seedAutoGearRulesFromCurrentProject,\n  resetAutoGearRulesToFactoryAdditions,\n});\n\nregisterOrQueueModule(\n  'cineFeatureAutoGearRules',\n  autoGearRulesAPI,\n  {\n    category: 'feature',\n    description: 'Automatic gear rule cloning, factory defaults and seeding helpers.',\n    replace: true,\n    connections: ['cineModuleBase', 'cineModuleContext', 'cinePersistence'],\n  },\n  (error) => {\n    if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n      console.warn('Unable to register cineFeatureAutoGearRules module.', error);\n    }\n  }\n);\n\nconst globalExports = [\n  ['cineFeatureAutoGearRules', autoGearRulesAPI],\n  ['buildDefaultVideoDistributionAutoGearRules', buildDefaultVideoDistributionRules],\n  ['buildVideoDistributionAutoRules', buildVideoDistributionAutoRules],\n  ['buildTripodPreferenceAutoGearRules', buildTripodPreferenceAutoGearRules],\n  ['cloneAutoGearItems', cloneAutoGearItems],\n  ['cloneAutoGearRuleItem', cloneAutoGearRuleItem],\n  ['cloneAutoGearRule', cloneAutoGearRule],\n  ['cloneAutoGearRules', cloneAutoGearRules],\n  ['setFactoryAutoGearRulesSnapshot', setFactoryAutoGearRulesSnapshot],\n  ['ensureDefaultMatteboxAutoGearRules', ensureDefaultMatteboxAutoGearRules],\n  ['captureAutoGearSeedContext', captureAutoGearSeedContext],\n  ['buildAutoGearRulesFromBaseInfo', buildAutoGearRulesFromBaseInfo],\n  ['buildArriViewfinderBracketRules', buildArriViewfinderBracketRules],\n  ['computeFactoryAutoGearRules', computeFactoryAutoGearRules],\n  ['seedAutoGearRulesFromCurrentProject', seedAutoGearRulesFromCurrentProject],\n  ['resetAutoGearRulesToFactoryAdditions', resetAutoGearRulesToFactoryAdditions],\n  ['factoryAutoGearRulesSnapshot', null],\n  ['factoryAutoGearSeedContext', null],\n];\n\nglobalExports.forEach(([name, value]) => {\n  if (name === 'factoryAutoGearRulesSnapshot') {\n    Object.defineProperty(GLOBAL_SCOPE, name, {\n      configurable: true,\n      get() {\n        return factoryAutoGearRulesSnapshot;\n      },\n      set(next) {\n        factoryAutoGearRulesSnapshot = Array.isArray(next)\n          ? cloneAutoGearRules(next)\n          : null;\n      },\n    });\n    return;\n  }\n  if (name === 'factoryAutoGearSeedContext') {\n    Object.defineProperty(GLOBAL_SCOPE, name, {\n      configurable: true,\n      get() {\n        return factoryAutoGearSeedContext;\n      },\n      set(next) {\n        factoryAutoGearSeedContext = next && typeof next === 'object'\n          ? next\n          : null;\n      },\n    });\n    return;\n  }\n  exposeGlobal(name, value, { configurable: true, writable: true });\n});\n// }) ();\n\nexport default autoGearRulesAPI;\n\nconsole.log(' Auto Gear Rules loaded (ESM)');\n"],"names":["detectGlobalScope","GLOBAL_SCOPE","missingAutoGearHelperLog","logMissingAutoGearHelper","name","error","resolveAutoGearUiExports","readError","resolveAutoGearHelperFunction","exports","ensureFallbackAutoGearHelper","implementation","installed","fallbackNormalizeVideoDistributionOptionValue","value","trimmed","lower","getFallbackViewfinderLabel","activeLang","textSource","getFallbackVideoDistributionLabel","invokeAutoGearLabelHelper","fallback","helper","result","invokeError","getFallbackMatteboxLabel","getSafeMatteboxFallbackLabel","fallbackNormalizeMatteboxOptionValue","normalizeMatteboxOption","normalizeVideoDistributionOption","getSafeViewfinderFallbackLabel","getSafeVideoDistributionFallbackLabel","createModuleBaseFallback","scope","targetScope","resolvedScope","existingBase","moduleStorage","listenerStorage","notifyListeners","api","queue","index","listener","storeModule","getStoredModule","whenModuleAvailable","handler","existing","ensureModuleGlobals","globals","ensureModuleRegistry","registry","fallbackBase","message","detail","target","options","scopeTarget","descriptor","moduleJsonDeepClone","moduleResolveStructuredClone","moduleCreateResilientDeepClone","structuredCloneImpl","MODULE_DEEP_CLONE","resolveModuleBase","MODULE_BASE","freezeDeep","seen","freeze","keys","key","child","accessError","exposeGlobal","moduleRegistry","registerOrQueueModule","onError","factoryAutoGearRulesSnapshot","factoryAutoGearSeedContext","fallbackCollectCandidateScopes","primary","scopes","push","candidateScopes","collected","structuredCloneCandidates","candidates","addCandidate","fn","candidate","resolved","cachedStructuredCloneCandidate","tryStructuredCloneValue","cloned","cloneWithStructuredCloneFallback","attempt","cloneAutoGearItems","items","item","normalized","cloneAutoGearRuleItem","cloneAutoGearRule","rule","cloneAutoGearRules","rules","setFactoryAutoGearRulesSnapshot","subtractScenarioContributions","diff","scenarioKeys","scenarioDiffMap","adjust","type","remaining","scenarioDiff","match","entry","extractAutoGearSelections","part","buildCameraHandleAutoRules","baseInfo","baselineMap","selections","selectionSet","optionValues","handleSelect","option","variantHandles","variantInfo","variantHtml","variantMap","additions","removals","buildViewfinderExtensionAutoRules","uniqueSelections","selection","remainingSelections","buildBatteryAutoRules","select","opt","val","currentSelection","buildDistanceAutoRules","buildHotswapAutoRules","buildBatteryPlateAutoRules","buildCageAutoRules","buildTripodAutoGearRules","brand","bowl","spreader","types","t","others","buildTripodPreferenceAutoGearRules","normalizedBrand","normalizedBowl","matchedBrand","matchingEntries","itemName","contextNotes","buildVideoDistributionAutoRules","buildOnboardMonitorRiggingAutoGearRules","monitorLabels","rawValue","label","monitorLabelText","contextNote","ARRI_VIEWFINDER_BRACKET_NAME","ARRI_VIEWFINDER_BRACKET_CATEGORY","createArriViewfinderBracketItem","normalizedNotes","note","collectArriCameraNames","arriNames","cameraDb","createArriBracketRule","addition","cameraList","buildArriViewfinderBracketRules","arriCameras","viewfinderSelection","sliderActive","contextLabel","viewfinderRule","sliderRule","buildDefaultVideoDistributionRules","baseProjectInfo","emptyHtml","emptyMap","generatedRules","handledTriggers","infoForSelection","selectionHtml","selectionMap","iosLabel","normalizedIos","createdNames","createItem","category","quantity","iosDevices","deviceName","pushSupport","buildDefaultMatteboxAutoGearRules","buildMatteboxAutoGearRules","resolveHandUnitCompatibilityMaps","groups","motorMap","getHandUnitGroupForMotor","motorName","maps","group","collectAllWirelessTransmitterNames","names","videoDb","buildMotorHandUnitAutoGearRules","setupValues","captureSetupSelectValues","rawMotors","motorEntries","wirelessSelection","handledGroups","defaultOption","wirelessTargets","buildAutoGearAnyMotorRule","pushItem","buildAlwaysAutoGearRule","buildFiveDayConsumablesAutoGearRule","ensureDefaultMatteboxAutoGearRules","defaults","existingKeys","captureList","list","sel","captured","finalizeCapturedSetupValues","values","applySetupSelectValues","captureAutoGearSeedContext","projectDataClone","scenarioValues","buildAutoGearRulesFromBaseInfo","canGenerateRules","scenarios","baselineHtml","scenarioHtml","scenarioMap","add","remove","combo","combinedLabel","adjusted","rainOverlapKeys","overlapRemovals","existingSignatures","signature","appendUniqueRules","additionalRules","anyMotorRule","targetSignature","alwaysRule","fiveDayRule","computeFactoryAutoGearRules","context","previousSelectValues","seededBeforeCompute","savedAutoGearRules","savedBaseAutoGearRules","savedProjectScopedRules","savedBackupSignature","savedPersistedSignature","savedDirtyFlag","baseInfoSource","seedAutoGearRulesFromCurrentProject","seededBefore","resetAutoGearRulesToFactoryAdditions","langTexts","fallbackTexts","confirmation","performReset","exportFailureMessage","presetExportOutcome","exportError","backupName","successMessage","emptyMessage","failureMessage","factoryRules","notifyError","autoGearRulesAPI","clonedContext","globalExports","next"],"mappings":"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"}