import{g as vp,L as Ns,s as Lp,d as Rp,c as Tp,k as Mp}from"./vendor-BnBlqqbr.js";function ga(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Sl=ga(),Vn={value:null,time:0};function ma(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Fn(){if(Vn.value&&typeof Vn.value=="object")return Vn.value;try{const e=ga();if(e&&(typeof e=="object"||typeof e=="function"))return Vn.value=e,Vn.time=Date.now(),e}catch{}return Sl}function wl(e,t,r){const n=[],o=s=>{!s||typeof s!="object"&&typeof s!="function"||n.indexOf(s)===-1&&n.push(s)};o(e);const i=typeof r=="function"?r:Fn;try{o(i())}catch{}if(Array.isArray(t))for(let s=0;s<t.length;s+=1)o(t[s]);return typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),o(Sl),n.slice()}function Np(e){if(typeof require!="function")return null;try{return require(e)}catch{return null}}function Gp(e,t){const r=t||{},n=typeof r.predicate=="function"?r.predicate:null,o=Array.isArray(r.scopes)?r.scopes.slice():[],i=wl(r.primaryScope,r.additionalScopes,r.detect);for(let s=0;s<i.length;s+=1)o.indexOf(i[s])===-1&&o.push(i[s]);for(let s=0;s<o.length;s+=1){const a=o[s];if(!(!a||typeof a!="object"&&typeof a!="function")){if(n)try{if(n(a,e))return a}catch{}try{if(e in a)return a}catch{}}}return null}function zp(e,t){if(!e)return typeof t=="function"?t():t;const r=Fn();if(r&&typeof r=="object"){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];const n=typeof t=="function"?t():t;if(ma(r,e,n))try{return r[e]}catch{}return n}return typeof t=="function"?t():t}const Bp={baseDetectGlobalScope:ga,detectGlobalScope:Fn,collectCandidateScopes:wl,tryRequire:Np,defineHiddenProperty:ma,resolveFromScopes:Gp,getCachedGlobalValue:zp},ms=Fn();ms&&!ms.cineScopeUtils&&ma(ms,"cineScopeUtils",Bp);const He=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},ha=(function(){const t=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:null);if(typeof t!="object"||!t)return new Set;const r=Object.values(t).filter(n=>typeof n=="string"&&n);return new Set(r)})();function ro(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return"";if(typeof String.fromCodePoint=="function")try{return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):""}function Ei(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=ro(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=ro(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=ro(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=ro(i[1],10);if(s)return s}return t}function F(e,t){const n=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons",o=t||n,i=ha.has(o)?o:n,a={char:Ei(e),font:i};return typeof Object.freeze=="function"?Object.freeze(a):a}function Xi(e){const r=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons";if(!e)return{char:"",font:r,className:"",size:void 0};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:Ei(e),font:r,className:"",size:void 0};if(typeof e=="object"){const n=typeof e.char=="string"?Ei(e.char):"",o=e.font&&ha.has(e.font)?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:"",size:void 0}}function El(e){return typeof e!="string"?"":e.indexOf('aria-hidden="true"')!==-1?e:e.replace("<svg",'<svg aria-hidden="true"')}function Al(e,t){if(!e)return;const r=Xi(t);if(r.markup){e.innerHTML=El(r.markup),e.setAttribute("aria-hidden","true"),r.className&&r.className.split(/\s+/).filter(Boolean).forEach(o=>e.classList.add(o)),e.removeAttribute("data-icon-font");return}const n=r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font):e.removeAttribute("data-icon-font")}function Ol(e,t){const r=Xi(e),n=[];r.className&&n.push(r.className),t&&n.push(t);const o=n.join(" ");if(r.markup){let s=El(r.markup);return o&&(s.indexOf('class="')!==-1?s=s.replace('class="',`class="${o} `):s=s.replace("<svg",`<svg class="${o}"`)),s}const i=r.char?`data-icon-font="${r.font}"`:"";return`<span class="icon-glyph ${o}" aria-hidden="true" ${i}>${r.char}</span>`}function wr(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function Cl(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=wr(t),a=wr(r),c=wr(n),l=wr(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(u,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[];return/(?:^|\s)width\s*=/i.test(p)||d.push(`width="${c}"`),/(?:^|\s)height\s*=/i.test(p)||d.push(`height="${l}"`),d.push(`x="-${wr(i)}"`),d.push(`y="-${wr(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}const ba=`
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M12 17.25 6.545 20.2 7.9 13.975 3 9.45l6.272-.7L12 3l2.728 5.75L21 9.45l-4.9 4.525 1.355 6.225Z"
    fill="currentColor"
    stroke="currentColor"
    stroke-width="0"
  />
</svg>
`.trim(),x=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons",ESSENTIAL:"essential",GADGET:"gadget",FILM:"film",TEXT:"text"}),Pl=Object.freeze({batteryBolt:F("",x.UICONS),batteryFull:F("",x.UICONS),bolt:F("",x.ESSENTIAL),plug:F("",x.UICONS),sliders:F("",x.ESSENTIAL),screen:F("",x.GADGET),brightness:F("",x.UICONS),wifi:F("",x.UICONS),gears:F("",x.UICONS),controller:F("",x.GADGET),distance:F("",x.UICONS),sensor:F("",x.UICONS),viewfinder:F("",x.FILM),camera:F("",x.UICONS),trash:F("",x.ESSENTIAL),reload:F("",x.ESSENTIAL),load:F("",x.UICONS),installApp:F("",x.UICONS),add:Object.freeze({char:"+",font:x.TEXT,className:"icon-text"}),minus:Object.freeze({char:"−",font:x.TEXT,className:"icon-text"}),arrowLeft:Object.freeze({char:"←",font:x.TEXT,className:"icon-text"}),check:F("",x.UICONS),fileExport:F("",x.UICONS),fileImport:F("",x.UICONS),save:F("",x.ESSENTIAL),share:F("",x.ESSENTIAL),paperPlane:F("",x.UICONS),magnet:F("",x.ESSENTIAL),codec:F("",x.UICONS),timecode:F("",x.FILM),audioIn:F("",x.ESSENTIAL),audioOut:F("",x.ESSENTIAL),note:F("",x.ESSENTIAL),overview:F("",x.UICONS),gearList:F("",x.UICONS),contacts:F("",x.UICONS),feedback:F("",x.UICONS),resetView:F("",x.UICONS),pin:F("",x.ESSENTIAL),sun:F("",x.UICONS),moon:F("",x.UICONS),circleX:F("",x.ESSENTIAL),settingsGeneral:F("",x.UICONS),settingsAutoGear:F("",x.UICONS),settingsAccessibility:F("",x.UICONS),settingsBackup:F("",x.UICONS),settingsData:F("",x.UICONS),settingsAbout:F("",x.UICONS),star:Object.freeze({markup:ba,className:"icon-svg favorite-star-icon"}),warning:F("",x.ESSENTIAL)});He.cineIcons={VALID_ICON_FONTS:ha,toCodePointChar:ro,normalizeGlyphChar:Ei,iconGlyph:F,resolveIconGlyph:Xi,applyIconGlyph:Al,iconMarkup:Ol,formatSvgCoordinate:wr,positionSvgMarkup:Cl,STAR_ICON_SVG:ba,ICON_GLYPHS:Pl};He.iconGlyph=F;He.resolveIconGlyph=Xi;He.applyIconGlyph=Al;He.iconMarkup=Ol;He.formatSvgCoordinate=wr;He.positionSvgMarkup=Cl;He.STAR_ICON_SVG=ba;He.ICON_GLYPHS=Pl;He.cineIcons;const xp="modulepreload",Fp=function(e){return"/"+e},hc={},kl=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let c=function(l){return Promise.all(l.map(f=>Promise.resolve(f).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");o=c(r.map(l=>{if(l=Fp(l),l in hc)return;hc[l]=!0;const f=l.endsWith(".css"),u=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":xp,f||(y.as="script"),y.crossOrigin="",y.href=l,a&&y.setAttribute("nonce",a),document.head.appendChild(y),f)return new Promise((p,d)=>{y.addEventListener("load",p),y.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};function _l(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function jl(e){return!!e&&(typeof e=="object"||typeof e=="function")}function Zi(e){if(typeof Object.freeze=="function")try{return Object.freeze(e)}catch{}return e}function oi(e){if(!e)return[];try{return Array.prototype.slice.call(e)}catch{}const t=[];for(let r=0;r<e.length;r+=1)t[r]=e[r];return t}function bc(){return{objects:typeof WeakMap=="function"?new WeakMap:null,primitives:Object.create(null),empty:null}}function Up(e,t){if(!e)return null;if(jl(t)){if(!e.objects)return null;let o=e.objects.get(t);return o||(o={cached:!1,value:null},e.objects.set(t,o)),o}const r=typeof t+":"+String(t);let n=e.primitives[r];return n||(n={cached:!1,value:null},e.primitives[r]=n),n}function Jt(e,t){jl(t)&&e.indexOf(t)===-1&&e.push(t)}const Gs=(function(){const t=[];return Jt(t,typeof globalThis<"u"?globalThis:null),Jt(t,typeof window<"u"?window:null),Jt(t,typeof self<"u"?self:null),Jt(t,typeof global<"u"?global:null),Zi(t)})(),zs=Zi([]),Il=typeof WeakMap=="function",hs=Il?new WeakMap:null;function Dp(e){if(!Array.isArray(e)||e.length===0)return zs;const t=[];for(let r=0;r<e.length;r+=1)Jt(t,e[r]);return t.length===0?zs:Zi(t)}function Sc(e,t,r){const n=[];Jt(n,e);let o=null;if(typeof t=="function")try{o=t()}catch{o=null}Jt(n,o);for(let i=0;i<Gs.length;i+=1)Jt(n,Gs[i]);if(Array.isArray(r))for(let i=0;i<r.length;i+=1)Jt(n,r[i]);return Zi(n)}function Kp(e,t){if(!e)return null;if(t===zs)return e.empty||(e.empty=bc()),e.empty;if(!e.extras){if(!Il)return null;e.extras=new WeakMap}let r=e.extras.get(t);return r||(r=bc(),e.extras.set(t,r)),r}function $p(e){if(!hs)return null;let t=hs.get(e);return t||(t={empty:null,extras:null},hs.set(e,t)),t}function Vp(e,t,r,n){if(n){const i=Up(n,e);if(i){if(i.cached)return oi(i.value);const s=Sc(e,t,r);return i.value=s,i.cached=!0,oi(s)}}const o=Sc(e,t,r);return oi(o)}function Sa(e){const t=e&&typeof e.detectGlobalScope=="function"?e.detectGlobalScope:_l,r=Dp(e&&e.additionalScopes),n=$p(t),o=Kp(n,r);return function(s){return Vp(s,t,r,o)}}function Hp(e,t){return Sa(t||{})(e)}function qp(){return oi(Gs)}const bs=_l();bs&&!bs.__cineScopeCollector&&(bs.__cineScopeCollector={collectCandidateScopes:Hp,createCollector:Sa,getBaseScopes:qp});const es="__cinePendingModuleRegistrations__";function or(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Wp(e){const t=e||or();if(!t||typeof t!="object"&&typeof t!="function")return;let r=null;try{r=t.console||null}catch{r=null}if(!r||typeof r!="object"&&typeof r!="function")return;const n=["log","warn","error","info","debug"];let o=null;try{o=r.__cineSafeConsoleOriginals||null}catch{o=null}if(!o||typeof o!="object"){o={};try{Object.defineProperty(r,"__cineSafeConsoleOriginals",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{try{r.__cineSafeConsoleOriginals=o}catch{}}}for(let i=0;i<n.length;i+=1){const s=n[i];let a=null;try{a=r[s]}catch{a=null}if(typeof a!="function"||a&&a.__cineSafeConsoleGuard)continue;Object.prototype.hasOwnProperty.call(o,s)||(o[s]=a);const c=function(){try{return a.apply(r,arguments)}catch{}};try{Object.defineProperty(c,"__cineSafeConsoleGuard",{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{c.__cineSafeConsoleGuard=!0}try{r[s]=c}catch{}}}const wc=Sa,Yp={key:"defaultExtras"},Ss=[],Fr=typeof WeakMap=="function"?new WeakMap:[];function Jp(e){if(!e||typeof e!="object"&&typeof e!="function")return;if(Fr&&typeof Fr.get=="function"){let r=Fr.get(e);return r||(r=[e],Fr.set(e,r)),r}for(let r=0;r<Fr.length;r+=1){const n=Fr[r];if(n.scope===e)return n.extras}const t=[e];return Fr.push({scope:e,extras:t}),t}function Qp(e,t){if(!wc)return null;const r=Array.isArray(t)?t:Yp;for(let o=0;o<Ss.length;o+=1){const i=Ss[o];if(i.detect===e&&i.extras===r)return i.collector}const n=wc({detectGlobalScope:e,additionalScopes:Array.isArray(t)?t:void 0});return n?(Ss.push({detect:e,extras:r,collector:n}),n):null}function ts(e,t){const r=t||or(),n=Jp(r),o=Qp(or,n);if(o)return o(e||r);const i=[];function s(a){!a||typeof a!="object"&&typeof a!="function"||i.indexOf(a)===-1&&i.push(a)}return s(e||r),typeof globalThis<"u"&&s(globalThis),typeof window<"u"&&s(window),typeof self<"u"&&s(self),typeof global<"u"&&s(global),i}function vl(e){return null}function Ll(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function wa(e,t,r){const n=e||r,o=typeof t=="string"&&t?t:es;if(!n||typeof n!="object")return null;let i=n[o];return Array.isArray(i)?i:!Ll(n,o,[])||(i=n[o],!Array.isArray(i))?null:i}const ws=(function(){const t="__cineBuiltinImmutabilityGuards__",r=ts(null,or());for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function Bs(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(Ie&&typeof Ie=="object")try{if(e===Ie.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(t){if(t&&typeof t.message=="string"&&/metamask/i.test(t.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function Xp(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function xs(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(Xp(e)||typeof e=="object"&&e&&typeof e.id=="string"&&typeof e.filename=="string"&&(typeof e.loaded=="boolean"||Array.isArray(e.children))||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(ws&&typeof ws.isImmutableBuiltin=="function"&&ws.isImmutableBuiltin(e)||typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function Zp(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function Ea(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||xs(e)||Bs(e))return e;if(typeof e=="function")try{return Object.freeze(e)}catch{return e}const r=Zp(t);if(r.has(e))return e;r.add(e);let n;try{n=Object.getOwnPropertyNames(e)}catch{return e}for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=Object.getOwnPropertyDescriptor(e,i)}catch{s=null}if(s&&(typeof s.get=="function"||typeof s.set=="function"))continue;let a;try{a=e[i]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||xs(a)||Bs(a)||Ea(a,r)}try{return Object.freeze(e)}catch{return e}}function Rl(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function ed(e,t){const n=ts(e||t,t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}function td(e,t,r,n,o){const s=wa(e||o,es,o);if(!s)return!1;const a=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{return s.push(a),!0}catch{}try{return s[s.length]=a,!0}catch{}return!1}function rd(e){const t=e||or();return{detectGlobalScope:or,getGlobalScope(){return t},collectCandidateScopes(r){return ts(r||t,t)},tryRequire:vl,defineHiddenProperty:Ll,ensureQueue(r,n){return wa(r||t,n,t)},freezeDeep:Ea,safeWarn:Rl,resolveModuleRegistry(r){return ed(r||t,t)},queueModuleRegistration(r,n,o,i){return td(r||t,n,o,i,t)},getPendingQueueKey(){return es}}}function nd(e){const t=e||or();return t&&typeof t.cineModuleArchitectureKernel=="object"?t.cineModuleArchitectureKernel:null}const Aa=or();Wp(Aa);const od=nd(Aa),Q=od||rd(Aa);function Ec(){if(Q&&typeof Q.detectGlobalScope=="function")try{const e=Q.detectGlobalScope();if(e)return e}catch{}return or()}const Ie=Q&&typeof Q.getGlobalScope=="function"?(function(){try{const t=Q.getGlobalScope();if(t)return t}catch{}return Ec()})():Ec(),Fs=Q&&typeof Q.getPendingQueueKey=="function"?Q.getPendingQueueKey():es;function Tl(e){if(Q&&typeof Q.collectCandidateScopes=="function")try{const t=Q.collectCandidateScopes(e||Ie);if(Array.isArray(t)&&t.length>0)return t}catch{}return ts(e||Ie,Ie)}function Ml(e){if(Q&&typeof Q.tryRequire=="function")try{const t=Q.tryRequire(e);if(typeof t<"u")return t}catch{}return vl()}function Nl(e){const t=e||Ie;if(Q&&typeof Q.resolveModuleRegistry=="function")try{const o=Q.resolveModuleRegistry(t);if(o&&typeof o=="object")return o}catch{}const r=Ml("./registry.js");if(r&&typeof r=="object")return r;const n=Tl(t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}let Ac=null,Oc=!1;function Us(e){if(!Oc||e&&e!==Ie){const t=Nl(e);if(e&&e!==Ie)return t;Ac=t,Oc=!0}return Ac}function id(e){const t=e||Ie;if(Q&&typeof Q.ensureQueue=="function")try{const r=Q.ensureQueue(t,Fs);if(Array.isArray(r))return r}catch{}return wa(t,Fs,Ie)}function Gl(e,t,r,n){const o=e||Ie;if(Q&&typeof Q.queueModuleRegistration=="function")try{if(Q.queueModuleRegistration(o,t,r,n))return!0}catch{}const i=id(o);if(!i)return!1;const s=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{i.push(s)}catch{i[i.length]=s}return!0}function zl(e,t,r,n,o,i){if(t&&typeof t.register=="function")try{return t.register(r,n,o),!0}catch(s){typeof i=="function"&&i(s)}return Gl(e,r,n,o),!1}function Cc(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||xs(e)||Bs(e))return e;if(Q&&typeof Q.freezeDeep=="function")try{return Q.freezeDeep(e)}catch{}return Ea(e)}function Bl(e,t){if(Q&&typeof Q.safeWarn=="function")try{Q.safeWarn(e,t);return}catch{}Rl(e,t)}function xl(e,t,r,n={}){const o=r||Ie;if(!o||typeof o!="object")return!1;const i={configurable:n.configurable!==!1,enumerable:!!n.enumerable,value:t,writable:n.writable===!0};try{return Object.defineProperty(o,e,i),!0}catch{try{return o[e]=t,!0}catch{return!1}}}const Fl=Cc({getGlobalScope(){return Ie},collectCandidateScopes:Tl,tryRequire:Ml,resolveModuleRegistry:Nl,getModuleRegistry:Us,queueModuleRegistration(e,t,r,n){return Gl(n||Ie,e,t,r)},registerOrQueueModule(e,t,r,n,o,i){const s=o||Ie,a=i||Us(s);return zl(s,a,e,t,r,n)},freezeDeep:Cc,safeWarn:Bl,exposeGlobal:xl,PENDING_QUEUE_KEY:Fs}),sd=Us();zl(Ie,sd,"cineModuleBase",Fl,{category:"infrastructure",description:"Shared helpers for module registration, freezing and safe global exposure.",replace:!0,connections:["cineModuleArchitectureKernel","cineModuleArchitectureHelpers"]},e=>{Bl("Unable to register cineModuleBase.",e)});xl("cineModuleBase",Fl,Ie,{configurable:!0,enumerable:!1,writable:!1});var ad={};const Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};let Ai=null;!Ai&&Ce&&typeof Ce.__cineEnsureConsoleMethodsWritable=="function"&&(Ai=Ce.__cineEnsureConsoleMethodsWritable);typeof Ai=="function"&&Ai(["warn","info"]);const wo="__cinePendingModuleRegistrations__",Oa="__cinePendingModuleRegistrationsTimer__";let $r=Object.create(null),Oi=Object.create(null),ii=null;function Ul(e){const r=[e||Ce];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModuleImmutability=="object")return o.cineModuleImmutability}return null}const Es=(function(){const t="__cineBuiltinImmutabilityGuards__",r=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&r.push(globalThis),typeof window<"u"&&r.push(window),typeof self<"u"&&r.push(self),typeof global<"u"&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function cd(){function e(r){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function")return!1;try{if(Es&&typeof Es.isImmutableBuiltin=="function"&&Es.isImmutableBuiltin(r)||typeof r.pipe=="function"&&typeof r.unpipe=="function")return!0;if(typeof r.on=="function"&&typeof r.emit=="function"){if(typeof r.write=="function"||typeof r.read=="function")return!0;const n=r.constructor&&r.constructor.name;if(n&&/Stream|Emitter|Port/i.test(n))return!0}if(typeof Symbol<"u"&&r[Symbol.toStringTag]){const n=r[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port/i.test(n))return!0}}catch{}return!1}function t(r,n=new WeakSet){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function"||e(r)||n.has(r))return r;n.add(r);const o=Object.getOwnPropertyNames(r);for(let i=0;i<o.length;i+=1){const s=o[i];let a;try{a=r[s]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||t(a,n)}try{return Object.freeze(r)}catch{return r}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const Ca=cd();let Hn=Ul(Ce)||Ca;function ld(){if(Hn!==Ca)return Hn;const e=Ul(Ce);return e&&e!==Hn&&(Hn=e),Hn}function Lt(e,t){const r=ld();try{return r.freezeDeep(e,t)}catch{}return Ca.freezeDeep(e,t)}function zr(e){if(typeof e=="string"){const t=e.trim();if(t)return t}throw new TypeError("cineModules.register expected a non-empty string name.")}function si(e){if(e==null)return[];const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=new Set,n=[];for(let o=0;o<t.length;o+=1){const i=t[o];let s=null;if(typeof i=="string"?s=i:i&&typeof i.name=="string"&&(s=i.name),!s)continue;const a=s.trim();!a||r.has(a)||(r.add(a),n.push(a))}return n}function ud(e,t,r={}){const n=zr(e);if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError(`cineModules.register("${n}") expected an object or function.`);const o=r.freeze!==!1,i=o&&!Object.isFrozen(t)?Lt(t):t;if(Object.prototype.hasOwnProperty.call($r,n)){const s=$r[n];if(s===i)return s;if(!r.replace)throw new Error(`cineModules: Module "${n}" is already registered. Use { replace: true } to overwrite.`)}return $r[n]=i,Oi[n]={description:typeof r.description=="string"?r.description.trim():"",category:typeof r.category=="string"?r.category.trim():"",registeredAt:Date.now(),frozen:o,connections:Lt(si(r.connections||r.links||r.dependencies||null))},i}function fd(e){const t=zr(e);return Object.prototype.hasOwnProperty.call($r,t)?$r[t]:null}function Dl(e){const t=zr(e);return Object.prototype.hasOwnProperty.call($r,t)}function pd(){return Object.freeze(Object.keys($r).sort())}function dd(e){const t=zr(e),r=Oi[t];return r?Object.freeze({name:t,description:r.description,category:r.category,registeredAt:r.registeredAt,frozen:r.frozen,connections:r.connections||Lt([])}):null}function yd(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];try{const s=zr(i);n.has(s)||(n.add(s),r.push(s))}catch{}}return r.length>0?r:null}function gd(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i!="string")continue;const s=i.trim();!s||n.has(s)||(n.add(s),r.push(s))}return r.length>0?r:null}function md(e={}){const t=yd(e&&e.names),r=gd(e&&(e.categories||e.category||null)),n=t?new Set(t):null,o=r?new Set(r):null,i=[],s=n?t:Object.keys(Oi);for(let a=0;a<s.length;a+=1){const c=s[a],l=Oi[c];l&&(o&&!o.has(l.category)||i.push({name:c,description:l.description,category:l.category,registeredAt:l.registeredAt,frozen:l.frozen,connections:l.connections||Lt([])}))}return n||(!e||e.sort!==!1)&&i.sort((c,l)=>c.name.localeCompare(l.name)),Lt(i)}function hd(e){const t=Array.isArray(e)?e.slice():[e],r={},n=[];for(let o=0;o<t.length;o+=1){const i=zr(t[o]),s=Dl(i);r[i]=s,s||n.push(i)}return Object.freeze({ok:n.length===0,missing:Object.freeze(n),detail:Object.freeze(r)})}function bd(e={}){throw typeof process<"u"&&process,new Error("cineModules.__internalResetForTests() is restricted to test environments.")}function Kl(e){if(!e||typeof e!="object")return null;const t=e[Oa];return t&&typeof t=="object"?t:null}function Pa(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Ci(e){const t=Kl(e);if(!t)return;const r=t&&typeof t.clear=="function"?t.clear:null;if(r&&Object.prototype.hasOwnProperty.call(t,"id"))try{r(t.id)}catch{}Pa(e,Oa,null)}function $l(e){if(!e||typeof e!="object")return;const t=e[wo];if(!Array.isArray(t)||t.length===0){Ci(e);return}if(Kl(e))return;const r=typeof e.setTimeout=="function"&&e.setTimeout.bind(e)||typeof Ce.setTimeout=="function"&&Ce.setTimeout.bind(Ce)||(typeof setTimeout=="function"?setTimeout:null);if(typeof r!="function")return;const n=typeof e.clearTimeout=="function"&&e.clearTimeout.bind(e)||typeof Ce.clearTimeout=="function"&&Ce.clearTimeout.bind(Ce)||(typeof clearTimeout=="function"?clearTimeout:null),o=r(function(){Ci(e),Vl(e)},0);Pa(e,Oa,{id:o,clear:typeof n=="function"?n:null})}function Vl(e){if(!e||typeof e!="object")return;const t=e[wo];if(!Array.isArray(t)||t.length===0){Ci(e);return}const r=t.slice();t.length=0;for(let n=0;n<r.length;n+=1){const o=r[n];if(!o||typeof o!="object")continue;const i=o.name,s=o.api,a=o.options||{};try{Se.register(i,s,a)}catch(c){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`cineModules: discard pending registration for "${i}" due to error:`,c);continue}}t.length>0?$l(e):Ci(e)}function Sd(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),r(Ce),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function As(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e[wo];return Array.isArray(t)?t:null}catch{return null}}function wd(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=As(e);if(t||Pa(e,wo,[])&&(t=As(e),t))return t;try{if(e[wo]=[],t=As(e),t)return t}catch{}return null}function Ed(e){const t=Sd(e);for(let r=0;r<t.length;r+=1){const n=t[r],o=wd(n);if(o)return{queue:o,scope:n}}return null}function Ad(e,t){const r=Ed(e||Ce);if(!r||!r.queue)return!1;const n=Lt({name:t&&t.name?zr(t.name):null,api:t?t.api:null,options:Object.freeze({...t&&t.options?t.options:{}})}),{queue:o,scope:i}=r;try{o.push(n)}catch{o[o.length]=n}try{$l(i)}catch{}return!0}function Od(e={}){const t=zr(e.name),r=typeof e.category=="string"?e.category.trim():"";if(!r)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty category string.`);const n=typeof e.description=="string"?e.description.trim():"";if(!n)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty description.`);const o=e.freeze!==!1,i=Lt(si(e.connections)),s=typeof e.factory=="function"?e.factory:null,a=s?null:e.api;if(!s&&(!a||typeof a!="object"&&typeof a!="function"))throw new TypeError(`cineModules.createBlueprint("${t}") expected an object API or factory function.`);const c=Object.freeze({name:t,category:r,description:n,connections:i,freeze:o});let l=null,f=!1,u=null;function y(g){const b={category:c.category,description:c.description,connections:c.connections,freeze:c.freeze};if(!g||typeof g!="object")return Object.freeze({...b});const P={...b};if(Object.prototype.hasOwnProperty.call(g,"category")){const A=typeof g.category=="string"?g.category.trim():"";A&&(P.category=A)}if(Object.prototype.hasOwnProperty.call(g,"description")){const A=typeof g.description=="string"?g.description.trim():"";A&&(P.description=A)}return Object.prototype.hasOwnProperty.call(g,"connections")&&(P.connections=Lt(si(g.connections))),Object.prototype.hasOwnProperty.call(g,"freeze")&&(P.freeze=g.freeze!==!1),Object.freeze(P)}function p(g){if(f){if(u)throw u;return l}f=!0;let b=a;if(s){const P=g&&typeof g=="object"?{...g}:{},A=Object.freeze({registry:ii||null,metadata:c,context:P,freezeDeep:Lt,normalizeConnections:si});try{b=s(A)}catch(O){throw u=O instanceof Error?O:new Error(String(O)),u}}if(!b||typeof b!="object"&&typeof b!="function"){const P=new TypeError(`cineModules.createBlueprint("${t}") factory expected an object or function return value.`);throw u=P,P}return l=o&&!Object.isFrozen(b)?Lt(b):b,l}function d(g={}){const b=g&&typeof g.registry=="object"&&g.registry?g.registry:ii,P=y(g&&g.options),A=g&&g.scope?g.scope:Ce,O=g&&Object.prototype.hasOwnProperty.call(g,"defer")?g.defer!==!1:!0,k=g&&typeof g.onError=="function"?g.onError:null,_=p(g&&g.context),I=b&&typeof b.register=="function"?b:ii;if(!I||typeof I.register!="function")throw new TypeError("cineModules.createBlueprint register() requires a registry with a register() function.");try{return I.register(c.name,_,P)}catch(w){if(O&&Ad(A,{name:c.name,api:_,options:P}),k)try{k(w)}catch{}throw w}}const m={name:c.name,category:c.category,description:c.description,connections:c.connections,freeze:c.freeze,instantiate:p,register:d,getMetadata(){return c},createRegistrationOptions:y,toJSON(){return c}};return Object.freeze(m)}const Se={};Se.register=ud;Se.get=fd;Se.has=Dl;Se.list=pd;Se.describe=dd;Se.describeAll=md;Se.assertRegistered=hd;Se.createBlueprint=Od;Se.__internalResetForTests=bd;ii=Se;const ir=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&ir.push(globalThis);typeof window<"u"&&ir.indexOf(window)===-1&&ir.push(window);typeof self<"u"&&ir.indexOf(self)===-1&&ir.push(self);typeof global<"u"&&ir.indexOf(global)===-1&&ir.push(global);for(let e=0;e<ir.length;e+=1){const t=ir[e];if(!t||typeof t!="object")continue;if(t.cineModules!==Se)try{Object.defineProperty(t,"cineModules",{configurable:!0,enumerable:!1,value:Se,writable:!0})}catch{try{t.cineModules=Se}catch{}}Vl(t)}const Fo=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},Cd=new Set(["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI","DisplayPort"]),Pi="__normalized";function Hl(e){const t=new Map;return r=>{if(!r)return"";const n=String(r).replace(/[™®]/g,"").trim(),o=n.toLowerCase();return t.has(o)||t.set(o,e(n,o)),t.get(o)}}const Pd=[{needles:["12g"],value:"12G-SDI"},{needles:["6g"],value:"6G-SDI"},{needles:["3g"],value:"3G-SDI"},{needles:["hd","sdi"],value:"3G-SDI"},{needles:["mini","bnc"],value:"Mini BNC"},{needles:["micro","hdmi"],value:"Micro HDMI"},{needles:["mini","hdmi"],value:"Mini HDMI"},{needles:["hdmi"],value:"HDMI"},{needles:["displayport"],value:"DisplayPort"},{needles:["display","port"],value:"DisplayPort"},{needles:["dp"],value:"DisplayPort"}],ql=Hl((e,t)=>{const r=Pd.find(({needles:n})=>n.every(o=>t.includes(o)));return r?r.value:""}),kd={"lemo 4-pin (lbus)":"LBUS (LEMO 4-pin)","lbus (lemo 4-pin)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo for motors)":"LBUS (LEMO 4-pin)","4-pin lemo (lbus)":"LBUS (LEMO 4-pin)","lemo 4-pin":"LEMO 4-pin","4-pin lemo":"LEMO 4-pin","lemo 7-pin":"LEMO 7-pin","lemo 7-pin 1b":"LEMO 7-pin","7-pin lemo":"LEMO 7-pin","7-pin lemo (lcs)":"LEMO 7-pin (LCS)","7-pin lemo (cam)":"LEMO 7-pin (CAM)","ext (lemo 7-pin)":"EXT LEMO 7-pin","hirose 12pin":"Hirose 12-pin","12-pin hirose":"Hirose 12-pin","12pin broadcast connector":"Hirose 12-pin","lens 12 pin":"Hirose 12-pin","lens terminal 12-pin":"Hirose 12-pin","lens terminal 12-pin jack":"Hirose 12-pin","lens terminal":"Hirose 12-pin","usb type-c":"USB-C","usb-c":"USB-C","usb-c (usb 3.2 / 3.1 gen 1)":"USB-C","usb-c / gigabit ethernet (via adapter)":"USB-C","active ef mount":"Active EF mount","lanc (2.5mm stereo mini jack)":"LANC","2.5 mm sub-mini (lanc)":"LANC","remote a (2.5mm)":"REMOTE A connector","remote control terminal":"REMOTE A connector","remote 8 pin":"REMOTE B connector"};function ka(e){return Hl((t,r)=>e[r]||t)}const no=ka(kd),_d={'dsmc3 red touch 7" lcd (optional)':'RED Touch 7" LCD (Optional)','red touch 7.0" lcd (optional)':'RED Touch 7" LCD (Optional)',"lcd touch panel":"LCD touchscreen","lcd touchscreen":"LCD touchscreen","native lcd capacitive touchscreen":"LCD touchscreen","integrated touchscreen lcd":"LCD touchscreen","free-angle lcd":"Vari-angle LCD","lcd monitor (native)":"Integrated LCD monitor","native lcd viewfinder":"Integrated LCD monitor","lcd monitor lm-v2 (supplied)":"LCD Monitor LM-V2","integrated main monitor":"Integrated LCD monitor","optional evf-v70 viewfinder":"EVF-V70 (Optional)","optional evf-v50":"EVF-V50 (Optional)","optional oled viewfinder":"OLED EVF (Optional)","blackmagic pocket cinema camera pro evf (optional)":"Blackmagic Pro EVF (Optional)","external backlit lcd status display":"LCD status display","built-in fold-out lcd":"Fold-out LCD","oled lvf (live view finder)":"OLED EVF","lcd capacitive touchscreen":"LCD touchscreen","lemo 26 pin":"LEMO 26-pin port"},Wl=ka(_d),jd={"lemo 8-pin (dc in / bat)":"Bat LEMO 8-pin","lemo 8-pin (bat)":"Bat LEMO 8-pin","bat (lemo 8-pin)":"Bat LEMO 8-pin","lemo 8-pin":"Bat LEMO 8-pin","2-pin dc-input":"2-pin DC-IN","dc-":"DC IN",dc:"DC IN","2-pin xlr":"XLR 2-pin","2-pin locking connector":"LEMO 2-pin","2-pin locking connector / 2-pin lemo":"LEMO 2-pin","4-pin xlr / dc in 12v":"XLR 4-pin","4-pin xlr / v-lock":"XLR 4-pin","xlr 4-pin jack":"XLR 4-pin","xlr 4-pin (main input)":"XLR 4-pin","xlr-type 4 pin (male) / square-shaped 5 pin connector (battery)":"XLR 4-pin / Square 5-pin","12-pin molex connector (at battery plate rear) / 4-pin xlr (external power)":"Molex 12-pin / XLR 4-pin","battery slot":"Battery Slot","usb-c":"USB-C","usb type-c":"USB-C","usb-c pd":"USB-C PD","usb-c (power delivery)":"USB-C PD","usb-c pd,dc coupler":"USB-C PD / DC Coupler","dc coupler":"DC Coupler","dc coupler (dr-e6c)":"DC Coupler","dc input":"DC IN","dc barrel":"DC Barrel","dc (barrel)":"DC Barrel","locking dc barrel":"DC Barrel","dc 24v terminal":"DC Barrel","weipu sf610/s2 (12vdc) input":"Weipu SF610/S2","6-pin 1b dc-in / tb50 battery mount":"6-pin 1B DC-IN","6-pin 1b dc-,tb50":"6-pin 1B DC-IN"},Pc=ka(jd);function ai(e){if(!e)return[];const t=r=>{const n=Pc(r);return n?n.split(/[/,]/).map(o=>Pc(o.trim())).map(o=>o&&o.trim()||"").filter(Boolean):[]};return Array.isArray(e)?e.flatMap(t):t(e)}function Sr(e,t){return Array.isArray(e)?e.map(r=>typeof r=="string"?{...t,type:r}:{...t,...r||{}}):[]}function _a(e){if(!e)return;e.powerInput&&!e.power?.input&&(e.power={...e.power||{},input:{type:ai(e.powerInput)}},delete e.powerInput);const t=e.power?.input;if(!t)return;const r=n=>{if(typeof n=="string")return{type:ai(n)};if(n){const{portType:o,type:i,...s}=n,a=!i&&o?o:i;return{...s,type:a?ai(a):[]}}return{type:[]}};e.power.input=Array.isArray(t)?t.map(r):r(t)}function kc(e){!e||typeof e!="object"||Object.values(e).forEach(_a)}function Yl(e){return!!(e&&Object.prototype.hasOwnProperty.call(e,Pi)&&e[Pi])}function ja(e){if(!e||typeof e!="object")return e;try{Object.defineProperty(e,Pi,{configurable:!0,enumerable:!1,value:!0,writable:!0})}catch{e[Pi]=!0}return e}function Ia(e,t){if(!e||typeof e!="object"||!!!(t&&t.force)&&Yl(e))return e;Object.values(e.cameras||{}).forEach(o=>{o.power?.input&&o.power.input.powerDrawWatts!==void 0&&delete o.power.input.powerDrawWatts,_a(o),Array.isArray(o.power?.batteryPlateSupport)&&(o.power.batteryPlateSupport=o.power.batteryPlateSupport.map(i=>{if(typeof i=="string"){const s=i.match(/([^()]+)(?:\(([^)]+)\))?(?:\s*-\s*(.*))?/),a=s?s[1].trim():i;let c=s&&s[2]?s[2].trim().toLowerCase():"";c?/via adapter/i.test(c)&&(c="adapted"):c=/adapted|via adapter/i.test(i)?"adapted":"native";const l=s&&s[3]?s[3].trim():/via adapter/i.test(i)?"via adapter":"";return{type:a,mount:c,notes:l}}return{type:i.type||"",mount:(i.mount?i.mount:i.native?"native":i.adapted?"adapted":"native").toLowerCase(),notes:i.notes||""}})),o.power&&(o.power.powerDistributionOutputs=Sr(o.power.powerDistributionOutputs,{type:"",voltage:"",current:"",wattage:null,notes:""})),o.videoOutputs=Sr(o.videoOutputs,{type:"",notes:""}).flatMap(i=>{const{count:s,...a}=i||{},c=ql(a.type);if(!Cd.has(c))return[];const l=parseInt(s,10),f=Number.isFinite(l)&&l>0?l:1,u={...a,type:c,notes:a.notes||""};return Array.from({length:f},()=>({...u}))}),o.fizConnectors=Sr(o.fizConnectors,{type:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:no(s)}}),o.viewfinder=Sr(o.viewfinder,{type:"",resolution:"",connector:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:Wl(s)}}),o.recordingMedia=Sr(o.recordingMedia,{type:"",notes:""}).map(i=>{let{type:s="",notes:a=""}=i||{};const c=s.match(/^(.*?)(?:\((.*)\))?$/);return c&&(s=c[1].trim(),a=a||(c[2]?c[2].trim():"")),/^SD UHS-II$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II`:"UHS-II"):/^SD \(UHS-II\/UHS-I\)$/i.test(s)?(s="SD Card",a="UHS-II/UHS-I"):s==="CFast 2.0 card slots"?(s="CFast 2.0",a=a||"Dual Slots"):s==="CFexpress Type B (Dual Slots)"?(s="CFexpress Type B",a=a||"Dual Slots"):s==="CFexpress Type B (via adapter)"?(s="CFexpress Type B",a=a||"via adapter"):/^SD UHS-II \(Dual Slots\)$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II (Dual Slots)`:"UHS-II (Dual Slots)"):s==="SD Card (Dual Slots)"?(s="SD Card",a=a||"Dual Slots"):s==="SD card slot (for proxy/backup)"&&(s="SD Card",a=a||"for proxy/backup"),{type:s,notes:a}}),o.timecode=Sr(o.timecode,{type:"",notes:""}),o.lensMount=Sr(o.lensMount,{type:"",mount:"native",notes:""}).map(i=>({type:i.type,mount:i.mount?i.mount.toLowerCase():"native",notes:i.notes||""})).filter((i,s,a)=>s===a.findIndex(c=>c.type===i.type&&c.mount===i.mount&&c.notes===i.notes))}),Object.values(e.lenses||{}).forEach(o=>{if(!o||typeof o!="object")return;const i=y=>{if(!y)return null;if(typeof y=="string"){const m=y.trim();return m?{type:m,mount:"native"}:null}const p=typeof y.type=="string"?y.type.trim():"";if(!p)return null;const d=typeof y.mount=="string"?y.mount.trim().toLowerCase():"";return{type:p,mount:d==="adapted"?"adapted":"native"}},s=o.mountOptions,a=[],c=y=>{const p=i(y);p&&a.push(p)};if(Array.isArray(s)?s.forEach(c):s&&typeof s=="object"&&c(s),!a.length&&Array.isArray(o.lensMount)&&(o.lensMount.forEach(c),delete o.lensMount),!a.length){const y=typeof o.mount=="string"?o.mount.trim():"";y&&c({type:y,mount:"native"})}const l=[];a.forEach(y=>{if(!y||!y.type)return;const p=y.mount==="adapted"?"adapted":"native";l.some(m=>m.type===y.type&&m.mount===p)||l.push({type:y.type,mount:p})});const f=Array.isArray(l)?l:[];o.mountOptions=f;const u=Array.isArray(o.mountOptions)?o.mountOptions:[];if(u.length){const y=u.find(d=>d&&d.mount==="native"&&d.type)||u[0],p=y&&y.type?y.type:"";p?o.mount=p:typeof o.mount=="string"&&(o.mount=o.mount.trim())}else typeof o.mount=="string"&&(o.mount=o.mount.trim(),o.mount||delete o.mount)}),["monitors","video","viewfinders"].forEach(o=>{kc(e[o])});const n=e.fiz||{};return["motors","controllers","distance"].forEach(o=>{kc(n[o])}),Object.values(e.fiz?.motors||{}).forEach(o=>{o&&(o.connector&&!o.fizConnector&&(o.fizConnector=o.connector,delete o.connector),o.fizConnector&&(o.fizConnector=no(o.fizConnector)))}),Object.values(e.fiz?.controllers||{}).forEach(o=>{if(o)if(o.FIZ_connector&&!o.fizConnector&&!o.fizConnectors&&(o.fizConnector=o.FIZ_connector,delete o.FIZ_connector),Array.isArray(o.fizConnectors))o.fizConnectors=o.fizConnectors.map(i=>{if(!i)return{type:""};const s=no(i.type||i),a=i.notes||void 0;return a?{type:s,notes:a}:{type:s}});else if(o.fizConnector){const i=String(o.fizConnector).split(",").map(s=>s.trim()).filter(Boolean);o.fizConnectors=i.map(s=>({type:no(s)})),delete o.fizConnector}else o.fizConnectors=[]}),ja(e),e}function Jl(e){return Ia(e,{force:!0})}Fo.cineDeviceNormalization={unifyDevices:Ia,normalizeDevicesForPersistence:Jl,markDevicesNormalized:ja,hasNormalizedDevicesMarker:Yl,fixPowerInput:_a,normalizeVideoType:ql,normalizeFizConnectorType:no,normalizeViewfinderType:Wl,normalizePowerPortType:ai,ensureList:Sr};Fo.unifyDevices=Ia;Fo.normalizeDevicesForPersistence=Jl;Fo.markDevicesNormalized=ja;Fo.cineDeviceNormalization;var _c={};function Ql(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Br(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function Id(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function jc(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}const Xl=(function(){const t=Ql();if(t&&typeof t.__cineDeepClone=="function")return t.__cineDeepClone;const r=Id(t);return r?function(o){if(o===null||typeof o!="object")return o;try{return r(o)}catch{}return jc(o)}:jc})();function vd(e){const t=Br(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function Ld(e){const t=Br(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}function Rd(e){const t=Br(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleGlobals=="object")return n.cineModuleGlobals}return null}function Ic(e){return null}const rs=Ql(),Y=vd(rs),J=Ld(rs),q=Rd(rs),W=(J&&typeof J.getGlobalScope=="function"?J.getGlobalScope():null)||(Y&&typeof Y.getGlobalScope=="function"?Y.getGlobalScope():null)||rs;(function(){return q&&typeof q.tryRequire=="function"?q.tryRequire:J&&typeof J.tryRequire=="function"?function(r){const n=J.tryRequire(r);return typeof n>"u"?Ic():n}:Y&&typeof Y.tryRequire=="function"?Y.tryRequire:Ic})();const vc=(function(){const t=[];function r(o,i){if(typeof o!="function")return;t.some(a=>a&&a.fn===o)||t.push({fn:o,scope:i||null})}if(q&&(typeof q.structuredClone=="function"&&r(q.structuredClone,q),typeof q.getStructuredClone=="function"))try{const o=q.getStructuredClone();r(o,q)}catch{}if(J&&(typeof J.structuredClone=="function"&&r(J.structuredClone,J),typeof J.getStructuredClone=="function"))try{const o=J.getStructuredClone();r(o,J)}catch{}if(Y&&(typeof Y.structuredClone=="function"&&r(Y.structuredClone,Y),typeof Y.getStructuredClone=="function"))try{const o=Y.getStructuredClone();r(o,Y)}catch{}const n=Br(W);for(let o=0;o<n.length;o+=1){const i=n[o];if(!i||typeof i!="object"&&typeof i!="function")continue;const s=i.structuredClone;typeof s=="function"&&r(s,i)}return t})();let Ho=null;function Td(e){if(Ho)try{const t=Ho;return{success:!0,value:t.scope?t.fn.call(t.scope,e):t.fn(e)}}catch{Ho=null}for(let t=0;t<vc.length;t+=1){const r=vc[t];if(!(!r||typeof r.fn!="function"))try{const n=r.scope?r.fn.call(r.scope,e):r.fn(e);return Ho=r,{success:!0,value:n}}catch{}}return{success:!1,value:null}}function Md(e){if(q&&typeof q.resolveModuleRegistry=="function")try{const r=q.resolveModuleRegistry(e||W);if(r)return r}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const r=J.getModuleRegistry(e||W);if(r)return r}catch{}if(Y&&typeof Y.resolveModuleRegistry=="function")try{return Y.resolveModuleRegistry(e||W)}catch{}if(Se&&typeof Se=="object")return Se;const t=Br(W);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModules=="object")return n.cineModules}return null}const ci=(function(){if(q&&typeof q.getModuleRegistry=="function")try{const t=q.getModuleRegistry(W);if(t)return t}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const t=J.getModuleRegistry(W);if(t)return t}catch{}if(Y&&typeof Y.getModuleRegistry=="function")try{const t=Y.getModuleRegistry(W);if(t)return t}catch{}return Md()})(),Nd=(function(){return q&&typeof q.queueModuleRegistration=="function"?function(r,n,o,i){try{return q.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:J&&typeof J.queueModuleRegistration=="function"?function(r,n,o){try{const i=J.queueModuleRegistration(r,n,o);return typeof i>"u"?!1:i}catch{return!1}}:Y&&typeof Y.queueModuleRegistration=="function"?function(r,n,o,i){try{return Y.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:function(){return!1}})(),Gd=(function(){return q&&typeof q.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=q.registerOrQueueModule(r,n,o,i,s||W,a||ci);return typeof c>"u"?!1:c}catch{return!1}}:J&&typeof J.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=J.registerOrQueueModule(r,n,o,i,s||W,a||ci);return typeof c>"u"?!1:c}catch{return!1}}:Y&&typeof Y.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{return Y.registerOrQueueModule(r,n,o,i,s||W,a||ci)}catch{return!1}}:function(r,n,o,i){if(typeof i=="function")try{if(typeof window<"u"&&window.cineModuleRegistry&&typeof window.cineModuleRegistry.register=="function")return window.cineModuleRegistry.register(r,n,o),!0;console.warn("Logging module registration deferred - queue unavailable.")}catch{}return!1}})();function zd(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Bd(e){if(!e||typeof e!="object"||zd(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;const t=e.constructor;if(!t)return!1;if(t===Number||t===String||t===Boolean||t===Date||t===RegExp||t===Promise||t===WeakMap||t===WeakSet||t===Map||t===Set)return!0;const r=typeof t.name=="string"?t.name:"";if(r&&/Error|Event|Response|Request|Headers|Node|Element|Window|Document/.test(r))return!0;try{if(typeof e.then=="function"||typeof e.catch=="function"||typeof e.pipe=="function"||typeof e.on=="function"||typeof e.write=="function"||typeof e.read=="function"||typeof e.getReader=="function"||typeof e.getWriter=="function"||typeof e[Symbol.iterator]=="function"&&!Array.isArray(e))return!0;if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const n=e[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port|Process/.test(n))return!0}}catch{}return!1}function Ds(e,t){const r=t||(typeof WeakSet=="function"?new WeakSet:{add(){},has(){return!1}});if(!e||typeof e!="object"||Bd(e))return e;if(typeof process<"u"&&process&&_c&&_c.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(typeof r.has=="function"&&r.has(e))return e;typeof r.add=="function"&&r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||Ds(s,r)}try{try{return Object.freeze(e)}catch(o){return e}}catch{return e}}const ve=(function(){return q&&typeof q.freezeDeep=="function"?q.freezeDeep:J&&typeof J.freezeDeep=="function"?function(r,n){try{return J.freezeDeep(r,n)}catch{return Ds(r,n)}}:Y&&typeof Y.freezeDeep=="function"?Y.freezeDeep:Ds})();function Lc(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Xe=(function(){return q&&typeof q.safeWarn=="function"?q.safeWarn:J&&typeof J.safeWarn=="function"?function(r,n){try{J.safeWarn(r,n)}catch{Lc(r,n)}}:Y&&typeof Y.safeWarn=="function"?Y.safeWarn:Lc})(),jn=["debug","info","warn","error","log"],It=typeof Symbol=="function"?Symbol.for("cineLoggingConsoleProxyInstalled"):"__cineLoggingConsoleProxyInstalled__",de=(function(){const t=Object.create(null);if(typeof console>"u"||!console)return t;for(let r=0;r<jn.length;r+=1){const n=jn[r];try{const o=console[n];t[n]=typeof o=="function"?o:null}catch{t[n]=null}}return t})();let Et=!1,va=!1,Dr=!1,qn=null,qo=!1,Wn=0;const xd=(function(){return q&&typeof q.exposeGlobal=="function"?function(r,n,o){try{return q.exposeGlobal(r,n,o)}catch{return!1}}:function(r,n){if(!W||typeof W!="object"&&typeof W!="function")return!1;try{return W[r]=n,!0}catch{return!1}}})();function Fd(e,t){if(!(!q||typeof q.recordModule!="function"))try{q.recordModule(e,t)}catch{}}const Dt={debug:{priority:10,consoleMethod:"debug"},info:{priority:20,consoleMethod:"info"},warn:{priority:30,consoleMethod:"warn"},error:{priority:40,consoleMethod:"error"}},Ud=ve(Dt),In=Object.freeze(Object.keys(Dt).concat(["other"]));function Un(){const e=Object.create(null);for(let t=0;t<In.length;t+=1){const r=In[t];e[r]=0}return e}function Dd(e){if(!(!e||typeof e!="object"))for(let t=0;t<In.length;t+=1){const r=In[t];e[r]=0}}function Kd(e){if(typeof e=="string"&&e){if(Object.prototype.hasOwnProperty.call(Dt,e))return e;const t=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(Dt,t))return t}return"other"}function Ks(e,t){if(!e||typeof e!="object")return 0;const r=e[t];return typeof r=="number"&&Number.isFinite(r)&&r>0?r:0}function La(e,t,r){if(!e||typeof e!="object"||typeof r!="number"||!Number.isFinite(r)||r===0)return;const n=Kd(t),i=Ks(e,n)+r;e[n]=i>0?i:0}function Zl(e,t,r){if(!(!Array.isArray(t)||!t.length)&&!(typeof r!="number"||!Number.isFinite(r)||r===0))for(let n=0;n<t.length;n+=1){const o=t[n],i=o&&o.level;La(e,i,r)}}function $d(e){const t=Un();return Zl(t,e,1),t}function eu(e,t){if(!(!e||typeof e!="object"||!t||typeof t!="object"))for(let r=0;r<In.length;r+=1){const n=In[r],o=Ks(t,n);if(o){const i=Ks(e,n);e[n]=i+o}}}function tu(e){const t=Un();return eu(t,e),t}function Sn(e){return ve(tu(e))}const ki=50,ru=1,nu=5e3,_i="__cineLoggingHistory",$s="__cineLoggingConfig",Vd=typeof Symbol=="function"?Symbol.for("cineLoggingHandled"):"__cineLoggingHandled__",mt={level:"warn",historyLevel:"info",historyLimit:1200,consoleOutput:!0,persistSession:!0,captureGlobalErrors:!0,captureConsole:!1,stackTraces:!0},Hd=ve(mt),qd="cine-sw-logs",Wd="cine-sw:log-entry",Yd="cine-sw:log-state-request",Jd="cine-sw:log-state",Rc=5e3,Qd=60*1e3,Xd=200;function ou(){return{level:mt.level,historyLevel:mt.historyLevel,historyLimit:mt.historyLimit,consoleOutput:mt.consoleOutput,persistSession:mt.persistSession,captureGlobalErrors:mt.captureGlobalErrors,captureConsole:mt.captureConsole,stackTraces:mt.stackTraces}}let L=ou();const Tt=[],ji=new Set,Ii=new Set,Wo=typeof WeakSet=="function"?new WeakSet:[];let iu=0;const su=Un(),ns=Un(),au=Un();let cu=0,ae=null;const D={initialised:!1,supported:!1,requestInFlight:!1,lastRequestId:null,pollTimer:null,requestTimer:null,broadcastChannel:null,broadcastFailed:!1,seenIds:typeof Set=="function"?new Set:null,fallbackSeenIds:typeof Set!="function"?[]:null,lastSnapshotMeta:null};function Ir(e,t){const r=typeof t=="string"?t:L.level;if(typeof e=="string"){const n=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(Dt,n))return n;if(n==="log"||n==="information")return"info";if(n==="warning")return"warn";if(n==="trace"||n==="verbose")return"debug";if(n==="fatal"||n==="critical")return"error"}return Object.prototype.hasOwnProperty.call(Dt,r)?r:"info"}function vn(e){const t=Ir(e,"info"),r=Dt[t];return r?r.priority:Dt.info.priority}function Yn(e,t){if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:e>0:!!t;if(typeof e=="string"){const r=e.trim().toLowerCase();if(r==="true"||r==="1"||r==="yes"||r==="on")return!0;if(r==="false"||r==="0"||r==="no"||r==="off")return!1}return typeof t=="boolean"?t:!1}function lu(e,t){const n=!!(t&&t.allowReducedMin===!0)?ru:ki;if(typeof e=="number"&&Number.isFinite(e)){const o=Math.abs(Math.floor(e));return o?Math.max(n,Math.min(nu,o)):L.historyLimit}if(typeof e=="string"&&e){const o=Number(e);if(Number.isFinite(o))return lu(o,t)}return L.historyLimit}function Eo(e){if(typeof e=="string")return e;if(e instanceof Error)return e.message||e.name||"Error";if(e&&typeof e=="object"){if(typeof e.message=="string")return e.message;const t=e.constructor&&e.constructor.name;if(t)return t}if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e>"u"||e===null)return"";try{return String(e)}catch{}return Object.prototype.toString.call(e)}function le(e,t,r){const n=typeof t=="number"?t:0,o=r||(typeof WeakSet=="function"?new WeakSet:null);if(e===null||typeof e>"u")return null;const i=typeof e;if(i==="string"||i==="number"||i==="boolean")return e;if(i==="bigint")try{return e.toString()}catch{return"BigInt"}if(i==="symbol")try{return e.toString()}catch{return"Symbol"}if(i==="function")return`[Function${e.name?` ${e.name}`:""}]`;if(e instanceof Date)try{return e.toISOString()}catch{return e.toString()}if(typeof RegExp<"u"&&e instanceof RegExp){try{return e.toString()}catch{}return"[RegExp]"}if(e instanceof Error){const a={name:e.name,message:e.message};if(e.stack&&(a.stack=String(e.stack)),typeof e.code<"u"&&(a.code=e.code),typeof e.status<"u"&&(a.status=e.status),typeof e.cause<"u"&&e.cause!==null&&(a.cause=le(e.cause,n+1,o)),typeof e.details<"u"&&(a.details=le(e.details,n+1,o)),typeof e.errors<"u"&&e.errors!==null){const c=[];let f=0;const u=function(d){if(c.length>=10){f+=1;return}try{c.push(le(d,n+1,o))}catch(m){c.push(m&&m.message?`[Unserializable error: ${m.message}]`:"[Unserializable error]")}},y=e.errors;if(Array.isArray(y)){for(let p=0;p<y.length;p+=1)u(y[p]);y.length>c.length&&(f+=y.length-c.length)}else if(y&&typeof y=="object"){let p=null;try{const d=typeof Symbol=="function"?Symbol.iterator:null;d&&typeof y[d]=="function"&&(p=y[d].call(y))}catch{p=null}if(p&&typeof p.next=="function"){let d=p.next(),m=0;for(;!d.done;){m<10?u(d.value):f+=1,m+=1;try{d=p.next()}catch{f+=1;break}}}else u(y)}else u(y);c.length&&(a.errors=c,f>0&&(a.errorsTruncated=f))}return a}if(i==="object"){if(o)try{if(o.has(e))return"[Circular]";o.add(e)}catch{}if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return{__type:"ArrayBuffer",byteLength:e.byteLength};if(typeof DataView<"u"&&e instanceof DataView)return{__type:"DataView",byteOffset:e.byteOffset,byteLength:e.byteLength};if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(e)){const d=e.constructor&&e.constructor.name,m=32,g=typeof e.length=="number"?e.length:0,b=[],P=Math.min(g,m);for(let O=0;O<P;O+=1)b.push(e[O]);const A={__type:d||"TypedArray",length:g,byteOffset:typeof e.byteOffset=="number"?e.byteOffset:0,byteLength:typeof e.byteLength=="number"?e.byteLength:0};return b.length&&(A.preview=b),g>m&&(A.__truncatedItems=g-m),A}const a=typeof Map=="function"?Map:null;if(a&&e instanceof a){const d=[];let g=0;e.forEach((P,A)=>{g<30&&d.push({key:le(A,n+1,o),value:le(P,n+1,o)}),g+=1});const b={__type:"Map",size:typeof e.size=="number"?e.size:g,entries:d};return g>30&&(b.__truncatedEntries=g-30),b}const c=typeof Set=="function"?Set:null;if(c&&e instanceof c){const d=[];let g=0;e.forEach(P=>{g<30&&d.push(le(P,n+1,o)),g+=1});const b={__type:"Set",size:typeof e.size=="number"?e.size:g,values:d};return g>30&&(b.__truncatedValues=g-30),b}const l=typeof URLSearchParams=="function"?URLSearchParams:null;if(l&&e instanceof l){const d=[],m=typeof e.entries=="function"?e.entries():null;let g=0;if(m&&typeof m.next=="function"){let A=0,O=m.next();for(;!O.done;){if(A<40){const k=O.value||[];d.push({key:le(k[0],n+1,o),value:le(k[1],n+1,o)})}A+=1,O=m.next()}A>d.length&&(g=A-d.length)}const b={__type:"URLSearchParams",entries:d};return g>0&&(b.__truncatedEntries=g),b}if(typeof URL=="function"&&e instanceof URL)try{return e.toString()}catch{}if(n>=4){const d=e.constructor&&e.constructor.name;return d?`[${d}]`:Object.prototype.toString.call(e)}if(Array.isArray(e)){const m=[],g=Math.min(e.length,20);for(let b=0;b<g;b+=1)m.push(le(e[b],n+1,o));return e.length>20&&m.push(`… (${e.length-20} more)`),m}const f={},u=Object.keys(e),y=30,p=Math.min(u.length,y);for(let d=0;d<p;d+=1){const m=u[d];try{f[m]=le(e[m],n+1,o)}catch(g){f[m]=`[Threw: ${g&&g.message?g.message:"error"}]`}}if(u.length>y&&(f.__truncatedKeys=u.length-y),typeof Object.getOwnPropertySymbols=="function"){const d=Object.getOwnPropertySymbols(e),m=Math.min(d.length,5);for(let g=0;g<m;g+=1){const b=d[g],P=typeof b=="symbol"?b.toString():String(b);try{f[P]=le(e[b],n+1,o)}catch(A){f[P]=`[Threw: ${A&&A.message?A.message:"error"}]`}}}if(!u.length){const d=e.constructor&&e.constructor.name;d&&(f.__className=d)}return f}const s=Td(e);if(s.success)return s.value;try{return Xl(e)}catch{}try{return String(e)}catch{}return null}function vi(e){if(typeof e!="string")return null;const t=e.replace(/\r\n?/g,`
`).trim();if(!t)return null;const r=5e3,n=t.length>r,o=n?t.slice(0,r):t,i=t.split(`
`),s=40,a=[];let c=!1;for(let l=0;l<i.length;l+=1){const f=i[l].trim();if(f)if(a.length<s)a.push(f.length>500?`${f.slice(0,500)}…`:f);else{c=!0;break}}return{stack:o,frames:a,truncated:n||c}}function Zd(e){if(!e||typeof e!="object")return null;const t=typeof e.source=="string"&&e.source?e.source:"unknown";let r=null;typeof e.stack=="string"&&e.stack&&(r=vi(e.stack));const n=[];if(Array.isArray(e.frames))for(let s=0;s<e.frames.length&&n.length<40;s+=1){const a=e.frames[s];typeof a=="string"&&a?n.push(a):a!==null&&typeof a<"u"&&n.push(Eo(a))}else if(r&&Array.isArray(r.frames))for(let s=0;s<r.frames.length;s+=1)n.push(r.frames[s]);const o=e.truncated===!0||(r?r.truncated===!0:!1)||n.length>0&&n.length>=40,i={source:t,truncated:o};return r&&r.stack?i.stack=r.stack:typeof e.stack=="string"&&e.stack?i.stack=e.stack:i.stack=null,n.length&&(i.frames=n),!i.stack&&(!i.frames||!i.frames.length)?null:ve(i)}function Uo(){const e=Br(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{const n=r.sessionStorage;if(n&&typeof n.getItem=="function"&&typeof n.setItem=="function")return n}catch{}}return null}function uu(){const e=Uo();if(e)try{e.removeItem(_i)}catch{}}function ey(){const e=Uo();if(e){if(!L.persistSession){try{e.removeItem($s)}catch{}return}try{e.setItem($s,JSON.stringify({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces}))}catch(t){console.warn("cineLogging: Unable to persist logging config",t)}}}function Ra(){if(!L.persistSession){uu();return}const e=Uo();if(e)try{e.setItem(_i,JSON.stringify(Tt))}catch(t){if(t&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")){L.persistSession=!1;try{e.removeItem(_i)}catch{}return}console.warn("cineLogging: Unable to persist log history",t)}}function Ta(){const e=L.persistSession===!1?ru:ki;return Math.max(e,Math.min(nu,Math.floor(L.historyLimit)))}function ty(e,t,r){if(!Array.isArray(e)||e.length===0)return null;cu+=e.length;const n=$d(e),o=r&&typeof r.source=="string"&&r.source.trim()?r.source.trim():"enforce",i=e[0]||null,s=e[e.length-1]||null,a=Date.now();let c="";try{c=new Date(a).toISOString()}catch{c=String(a)}if(ae=ve({count:e.length,limit:t,source:o,timestamp:a,isoTimestamp:c,oldestEntryId:i&&typeof i.id=="string"?i.id:null,oldestEntryTimestamp:i&&typeof i.timestamp=="number"?i.timestamp:null,oldestEntryIsoTimestamp:i&&typeof i.isoTimestamp=="string"?i.isoTimestamp:null,newestEntryId:s&&typeof s.id=="string"?s.id:null,newestEntryTimestamp:s&&typeof s.timestamp=="number"?s.timestamp:null,newestEntryIsoTimestamp:s&&typeof s.isoTimestamp=="string"?s.isoTimestamp:null,levels:Sn(n)}),de&&typeof de.warn=="function")try{de.warn("cineLogging: history trimmed to enforce retention limit",{limit:t,removed:e.length,source:o,levels:tu(n)})}catch{}return n}function Ma(e){const t=Ta();if(Tt.length<=t)return 0;const r=Tt.length-t,n=Tt.splice(0,r);Zl(ns,n,-1);const o=ty(n,t,e);return o&&eu(au,o),r}function fu(e){return vn(e)>=vn(L.historyLevel)}function pu(e){return L.consoleOutput?vn(e)>=vn(L.level):!1}function Na(e){const t=Ir(e,"info"),r=pu(t),n=fu(t);return ve({level:t,enabled:r||n,console:r,history:n,thresholds:ve({console:Ir(L.level,mt.level),history:Ir(L.historyLevel,mt.historyLevel)})})}function du(e,t){const r=Na(e);if(!t||typeof t!="object")return r.enabled;const n=t.console!==!1,o=t.history!==!1;return!n&&!o?!1:t.requireAll===!0?!(n&&!r.console||o&&!r.history):!!(n&&r.console||o&&r.history)}function yu(e){return`log-${e}-${Math.random().toString(36).slice(2,10)}`}function gu(e){if(e){try{Tt.push(e)}catch{return}La(ns,e.level,1)}}function mu(e){gu(e),iu+=1,Ma({source:"append"}),Ra(),ry(e)}function ry(e){if(!ji.size)return;const t=Array.from(ji);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Xe("cineLogging listener execution failed",o)}}}function ny(e){const t=typeof e=="number"&&Number.isFinite(e)?Math.max(0,Math.floor(e)):Tt.length;if(!t)return Object.freeze([]);const r=Math.max(0,Tt.length-t),n=Tt.slice(r);return Object.freeze(n.slice())}function oy(e){if(!Ii.size)return;const t=Array.from(Ii);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Xe("cineLogging config listener failed",o)}}}function Ga(e){if(!e||typeof e.length!="number")return[];const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}function _r(e,t){if(!Array.isArray(e))return!1;try{return typeof Object.isExtensible=="function"&&!Object.isExtensible(e)?!1:(e.push(t),!0)}catch{}return!1}function iy(e){return e==="error"?"error":e==="warn"?"warn":e==="info"?"info":"debug"}function hu(e){if(typeof e!="string"||!e)return null;if(Object.prototype.hasOwnProperty.call(de,e)){const t=de[e];if(typeof t=="function")return t}if(typeof console<"u"&&console){let t=null;try{t=console[e]}catch{t=null}if(typeof t=="function"&&(!t||!t[It]))return t}if((e==="debug"||e==="log")&&typeof de.log=="function")return de.log;if(e==="info"){if(typeof de.info=="function")return de.info;if(typeof de.log=="function")return de.log}if(e==="warn"){if(typeof de.warn=="function")return de.warn;if(typeof de.error=="function")return de.error}return e==="error"&&typeof de.error=="function"?de.error:null}function bu(e,t){const r=hu(e);if(typeof r!="function")return;const n=typeof console<"u"&&console?console:W&&W.console?W.console:null,o=Array.isArray(t)?t:Ga(t);try{return r.apply(n,o)}catch{try{return Function.prototype.apply.call(r,n,o)}catch{}}}function sy(e,t,r){const n=iy(e),o=Array.isArray(t)?t:Ga(t),i=[];for(let d=0;d<o.length;d+=1){const m=o[d],g=typeof m;if(g==="string")_r(i,m);else if(g==="number"||g==="boolean")_r(i,String(m));else if(g==="symbol")try{_r(i,m.toString())}catch{}}let s=i.join(" ").trim();s||(s=`[console.${e||n}]`);let a=null,c=null;if(o.length)try{a=le(o),c={arguments:a}}catch{c={arguments:o.slice()}}const l=[],f=Array.isArray(a)?a:null;for(let d=0;d<o.length;d+=1){const m=o[d],g=f?f[d]:null,b=m instanceof Error,P=g&&typeof g=="object"&&g!==null?typeof g.stack=="string"||typeof g.message=="string"||typeof g.name=="string":!1;if(!b&&!P)continue;let A=P?g:null;if(!A)try{A=le(m)}catch{A=null}!A&&b&&(A={name:m.name||null,message:m.message||Eo(m)||null},typeof m.code<"u"&&(A.code=m.code),typeof m.status<"u"&&(A.status=m.status),typeof m.stack=="string"&&m.stack&&(A.stack=m.stack));let O=A;if(O&&typeof O=="object")try{O=Xl(O)}catch{try{O=Object.assign({},O)}catch{O=A}}const k={index:d};if(O&&typeof O=="object")k.value=O,typeof O.name=="string"&&O.name&&(k.name=O.name),typeof O.message=="string"&&O.message&&(k.message=O.message),typeof O.code<"u"&&(k.code=O.code),typeof O.status<"u"&&(k.status=O.status);else if(typeof O<"u"){k.value=O;const w=Eo(O);w&&(k.message=w)}else k.value=null;const _=m===null?"null":typeof m;if(_==="object"||_==="function"){const w=m&&m.constructor&&m.constructor.name;k.argumentType=typeof w=="string"&&w?w:_}else k.argumentType=_;const I=b&&typeof m.stack=="string"&&m.stack?vi(m.stack):O&&typeof O=="object"&&typeof O.stack=="string"?vi(O.stack):null;I&&(typeof I.stack=="string"&&(k.stack=I.stack),Array.isArray(I.frames)&&I.frames.length&&(k.frames=I.frames),I.truncated&&(k.stackTruncated=!0)),_r(l,k)}const u={channel:"console",method:e||"log"};if(r&&typeof r=="object"){const d=Object.keys(r);for(let m=0;m<d.length;m+=1){const g=d[m];try{u[g]=le(r[g])}catch{u[g]=r[g]}}}if(l.length){c=c||{};const d=[];for(let g=0;g<l.length;g+=1){const b=l[g];d.push(b.index)}c.errors=l,c.errorCount=l.length,c.errorIndices=d,c.primaryError=l[0],u.errorCount=l.length,u.errorIndices=d;const m=l[0];m&&(typeof m.name=="string"&&m.name&&(u.primaryErrorName=m.name),typeof m.message=="string"&&m.message&&(u.primaryErrorMessage=m.message),typeof m.code<"u"&&(u.primaryErrorCode=m.code),typeof m.status<"u"&&(u.primaryErrorStatus=m.status),m.stack&&(u.primaryErrorHasStack=!0))}const y=e==="error"||l.length>0,p={namespace:"console",meta:u};return y&&(p.captureStack=!0),ft(n,s,c,p,{silentConsole:!0})}function ay(){if(Et)return!0;if(va=!0,typeof console>"u"||!console)return Dr=!0,!1;try{if(console[It])return Et=!0,Dr=!1,!0}catch{}let e=!1;for(let t=0;t<jn.length;t+=1){const r=jn[t];let n=hu(r);if(typeof n!="function")try{const i=console[r];typeof i=="function"&&(!i||!i[It])&&(n=i)}catch{n=null}if((!Object.prototype.hasOwnProperty.call(de,r)||de[r]===null)&&(de[r]=typeof n=="function"?n:de[r]),typeof n!="function")continue;const o=function(){const s=Ga(arguments);Wn+=1;try{if(Wn===1){const a=s.length?s[0]:null;if(!(typeof a=="string"&&a.indexOf("cineLogging:")===0))try{sy(r,s,{captured:!0})}catch(l){}}return bu(r,s)}finally{Wn-=1,Wn<0&&(Wn=0)}};try{Object.defineProperty(o,It,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{o[It]=!0}try{console[r]=o,e=!0}catch{}}if(e){Et=!0,Dr=!1;try{Object.defineProperty(console,It,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{try{console[It]=!0}catch{}}}else Dr=!0;return Et}function cy(){if(!Et)return!1;if(typeof console>"u"||!console)return Et=!1,!1;let e=!1;for(let t=0;t<jn.length;t+=1){const r=jn[t],n=de[r];try{typeof n=="function"?(console[r]=n,e=!0):r!=="log"&&r!=="info"&&delete console[r]}catch{}}try{console&&console[It]&&(typeof Object.defineProperty=="function"?Object.defineProperty(console,It,{configurable:!0,enumerable:!1,writable:!0,value:!1}):console[It]=!1)}catch{}return Et=!1,e}function za(){return L.captureConsole?ay()?(qo=!1,qn!=="enabled"&&(ft("info","Console output capture enabled",Os({status:"enabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),qn="enabled"),!0):(qo||(ft("warn","Console output capture failed",Os({status:"failed",reason:typeof console>"u"||!console?"console-unavailable":"installation-failed"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Xe("cineLogging: Unable to capture console output for diagnostics."),qo=!0),qn="failed",!1):(Et&&cy(),qn!=="disabled"&&(ft("info","Console output capture disabled",Os({status:"disabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),qn="disabled"),qo=!1,Dr=!1,!0)}function Ba(){return!!L.captureConsole&&Et===!0}function Os(e){const t={configured:L.captureConsole===!0,installed:Et===!0,attempted:va===!0,failed:Dr===!0};if((typeof console>"u"||!console)&&(t.consoleAvailable=!1),e&&typeof e=="object"){const r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}}return t}function ly(e){return xa({captureConsole:!0},(e&&typeof e=="object"?e:null)||void 0),Ba()}function uy(e){return xa({captureConsole:!1},(e&&typeof e=="object"?e:null)||void 0),Ba()}function fy(e,t,r){const n=r&&Object.prototype.hasOwnProperty.call(r,"captureStack")?r.captureStack:null;return n===!0?!0:n===!1||L.stackTraces!==!0?!1:t instanceof Error?!0:vn(e)>=vn("warn")}function Su(e,t,r,n){if(!fy(e,r,n))return null;let o="generated",i="";if(r instanceof Error){const c=r.stack;typeof c=="string"&&c&&(o="detail",i=c)}if(!i)try{const c=typeof t=="string"&&t?t:`Log ${e}`,l=new Error(c);typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(l,Su),typeof l.stack=="string"&&l.stack&&(i=l.stack)}catch{}const s=vi(i);if(!s)return null;const a={source:o,stack:s.stack,truncated:s.truncated};return Array.isArray(s.frames)&&s.frames.length&&(a.frames=s.frames),ve(a)}function ft(e,t,r,n,o){const i=Ir(e,"info"),s=Date.now();let a="";try{a=new Date(s).toISOString()}catch{a=String(s)}const c=n&&typeof n=="object"?n:null,l=Su(i,t,r,c),f=c&&typeof c.namespace=="string"&&c.namespace?n.namespace:null,u=c&&typeof c.meta<"u"?le(c.meta):null,y=typeof r>"u"?null:le(r),p=ve({id:yu(s),level:i,message:Eo(t),namespace:f,detail:y,meta:u,timestamp:s,isoTimestamp:a,origin:l});La(su,i,1),fu(i)&&mu(p);const d=o&&typeof o=="object"?o:null;if(pu(i)&&(!d||d.silentConsole!==!0)){const g=(Dt[i]||Dt.info).consoleMethod,b=["[cine]"];f&&b.push(`[${f}]`),b.push(p.isoTimestamp);const A=[`${b.join(" ")} ${p.message}`];r!==void 0?_r(A,r):p.detail!==null&&_r(A,p.detail),p.meta!==null&&_r(A,{meta:p.meta}),l&&_r(A,{origin:l}),bu(g,A)}return p}function wu(e,t,r){return ft("debug",e,t,r)}function py(e,t,r){return ft("info",e,t,r)}function dy(e,t,r){return ft("warn",e,t,r)}function yy(e,t,r){return ft("error",e,t,r)}function Ao(){return ve({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces})}function gy(e){const t=e&&typeof e.limit<"u"?e.limit:void 0;return ny(t)}function my(){return ae?ve({count:typeof ae.count=="number"?ae.count:0,limit:typeof ae.limit=="number"?ae.limit:Ta(),source:typeof ae.source=="string"?ae.source:"enforce",timestamp:typeof ae.timestamp=="number"?ae.timestamp:null,isoTimestamp:typeof ae.isoTimestamp=="string"?ae.isoTimestamp:null,oldestEntryId:typeof ae.oldestEntryId=="string"?ae.oldestEntryId:null,oldestEntryTimestamp:typeof ae.oldestEntryTimestamp=="number"?ae.oldestEntryTimestamp:null,oldestEntryIsoTimestamp:typeof ae.oldestEntryIsoTimestamp=="string"?ae.oldestEntryIsoTimestamp:null,newestEntryId:typeof ae.newestEntryId=="string"?ae.newestEntryId:null,newestEntryTimestamp:typeof ae.newestEntryTimestamp=="number"?ae.newestEntryTimestamp:null,newestEntryIsoTimestamp:typeof ae.newestEntryIsoTimestamp=="string"?ae.newestEntryIsoTimestamp:null,levels:ae.levels?Sn(ae.levels):Sn(Un())}):null}function Eu(){return ve({runtimeEntries:iu,retainedEntries:Tt.length,droppedEntries:cu,historyLimit:Ta(),lastDrop:my(),levels:ve({emitted:Sn(su),retained:Sn(ns),dropped:Sn(au)}),consoleCapture:ve({configured:L.captureConsole===!0,installed:Et,attempted:va,failed:Dr})})}function hy(e){return Tt.length=0,Dd(ns),(!e||e.persist!==!1)&&Ra(),!0}function by(e){return typeof e!="function"?function(){return!1}:(ji.add(e),function(){return ji.delete(e),!0})}function Sy(e){return typeof e!="function"?function(){return!1}:(Ii.add(e),function(){return Ii.delete(e),!0})}function wy(e,t){if(!e&&!t)return null;if(!e)return le(t);if(!t)return e;if(typeof e!="object"||typeof t!="object")return le(t);const r={},n=Object.keys(e);for(let i=0;i<n.length;i+=1){const s=n[i];r[s]=e[s]}const o=Object.keys(t);for(let i=0;i<o.length;i+=1){const s=o[i];r[s]=le(t[s])}return r}function Ey(e,t){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?le(t.meta):null;function o(i,s,a,c){const l=wy(n,c);return ft(i,s,a,{namespace:r,meta:l})}return ve({namespace:r,log(i,s,a,c){return o(i,s,a,c)},debug(i,s,a){return o("debug",i,s,a)},info(i,s,a){return o("info",i,s,a)},warn(i,s,a){return o("warn",i,s,a)},error(i,s,a){return o("error",i,s,a)},getConfig:Ao,isLevelEnabled(i,s){return du(i,s)},getLevelState(i){return Na(i)}})}function Au(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;const t=Vd;try{return typeof t=="symbol"?e[t]?!0:(e[t]=!0,!1):Object.prototype.hasOwnProperty.call(e,t)&&e[t]?!0:(Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:!0}),!1)}catch{}return!1}function Ay(e){if(!L.captureGlobalErrors||Au(e))return;const t={message:e&&typeof e.message=="string"?e.message:"",filename:e&&(e.filename||e.fileName)||null,lineno:e&&(e.lineno||e.lineNumber)||null,colno:e&&(e.colno||e.columnNumber)||null,error:e&&e.error?le(e.error):null};e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Global error captured",t,{namespace:"global"})}function Oy(e){if(!L.captureGlobalErrors||Au(e))return;const t={reason:e?le(e.reason):null};e&&e.promise&&(t.promiseState="[Promise]"),e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Unhandled promise rejection captured",t,{namespace:"global"})}function Cy(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;if(Wo instanceof WeakSet)return Wo.has(e)?!0:(Wo.add(e),!1);const t=Wo;return t.indexOf(e)!==-1?!0:(t.push(e),!1)}function Ou(){if(!L.captureGlobalErrors)return;const e=Br(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r.addEventListener!="function")&&!Cy(r)){try{r.addEventListener("error",Ay,!0)}catch{}try{r.addEventListener("unhandledrejection",Oy,!0)}catch{}}}}function os(e){if(!e||typeof e!="object")return{changed:!1,captureChanged:!1,limitChanged:!1};let t=!1,r=!1,n=!1,o=!1;const i=Object.prototype.hasOwnProperty.call(e,"persistSession")?Yn(e.persistSession,L.persistSession):L.persistSession;if(Object.prototype.hasOwnProperty.call(e,"level")){const s=Ir(e.level,L.level);s!==L.level&&(L.level=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLevel")){const s=Ir(e.historyLevel,L.historyLevel);s!==L.historyLevel&&(L.historyLevel=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLimit")){const s=lu(e.historyLimit,{allowReducedMin:i===!1});s!==L.historyLimit&&(L.historyLimit=s,t=!0,n=!0)}if(Object.prototype.hasOwnProperty.call(e,"consoleOutput")){const s=Yn(e.consoleOutput,L.consoleOutput);s!==L.consoleOutput&&(L.consoleOutput=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"persistSession")&&i!==L.persistSession&&(L.persistSession=i,t=!0),L.persistSession&&L.historyLimit<ki&&(L.historyLimit=ki,t=!0,n=!0),Object.prototype.hasOwnProperty.call(e,"captureGlobalErrors")){const s=Yn(e.captureGlobalErrors,L.captureGlobalErrors);s!==L.captureGlobalErrors&&(L.captureGlobalErrors=s,t=!0,r=!0)}if(Object.prototype.hasOwnProperty.call(e,"captureConsole")){const s=Yn(e.captureConsole,L.captureConsole);s!==L.captureConsole&&(L.captureConsole=s,t=!0,o=!0)}if(Object.prototype.hasOwnProperty.call(e,"stackTraces")){const s=Yn(e.stackTraces,L.stackTraces);s!==L.stackTraces&&(L.stackTraces=s,t=!0)}return{changed:t,captureChanged:r,limitChanged:n,consoleCaptureChanged:o}}function xa(e,t){const r=L.captureGlobalErrors,n=L.captureConsole,o=os(e);return o.limitChanged&&Ma({source:"config"}),o.changed&&(!t||t.persist!==!1)&&(ey(),Ra()),L.persistSession||uu(),!r&&L.captureGlobalErrors&&Ou(),(o.consoleCaptureChanged||n!==L.captureConsole)&&za(),o.changed&&oy(Ao()),Ao()}function Py(){const e=Br(W),t=["__cineLoggingConfig","__CINE_LOGGING_CONFIG","cineLoggingConfig"];for(let r=0;r<e.length;r+=1){const n=e[r];if(!(!n||typeof n!="object"&&typeof n!="function"))for(let o=0;o<t.length;o+=1){const i=t[o];let s;try{s=n[i]}catch{s=null}if(s&&typeof s=="object")return s}}return null}function ky(){const e=Uo();if(!e)return;let t="";try{t=e.getItem($s)||""}catch{return}if(t)try{const r=JSON.parse(t);os(r)}catch(r){Xe("cineLogging: Unable to restore logging config from storage",r)}}function _y(){if(!W||!W.location)return;let e="";try{e=W.location.search||""}catch{return}if(typeof e!="string"||!e)return;let t=null;if(typeof URLSearchParams=="function")try{t=new URLSearchParams(e)}catch{}const r={};let n=!1;function o(i,s){r[i]=s,n=!0}if(t)t.has("cineLogLevel")&&o("level",t.get("cineLogLevel")),t.has("cineLogHistoryLevel")&&o("historyLevel",t.get("cineLogHistoryLevel")),t.has("cineLogLimit")&&o("historyLimit",t.get("cineLogLimit")),t.has("cineLogConsole")&&o("consoleOutput",t.get("cineLogConsole")),t.has("cineLogPersist")&&o("persistSession",t.get("cineLogPersist")),t.has("cineLogCapture")&&o("captureGlobalErrors",t.get("cineLogCapture")),t.has("cineLogConsoleCapture")&&o("captureConsole",t.get("cineLogConsoleCapture")),t.has("cineLogStackTraces")&&o("stackTraces",t.get("cineLogStackTraces"));else{const s=(e.charAt(0)==="?"?e.slice(1):e).split("&");for(let a=0;a<s.length;a+=1){const c=s[a];if(!c)continue;const l=c.indexOf("="),f=decodeURIComponent(l===-1?c:c.slice(0,l)),u=l===-1?"":decodeURIComponent(c.slice(l+1));f==="cineLogLevel"?o("level",u):f==="cineLogHistoryLevel"?o("historyLevel",u):f==="cineLogLimit"?o("historyLimit",u):f==="cineLogConsole"?o("consoleOutput",u):f==="cineLogPersist"?o("persistSession",u):f==="cineLogCapture"?o("captureGlobalErrors",u):f==="cineLogConsoleCapture"?o("captureConsole",u):f==="cineLogStackTraces"&&o("stackTraces",u)}}n&&os(r)}function Cu(e){if(!e||typeof e!="object")return null;const t=Ir(e.level,"info"),r=typeof e.timestamp=="number"&&Number.isFinite(e.timestamp)?e.timestamp:Date.now();let n="";if(typeof e.isoTimestamp=="string"&&e.isoTimestamp)n=e.isoTimestamp;else try{n=new Date(r).toISOString()}catch{n=String(r)}const o=typeof e.message=="string"?e.message:Eo(e.message),i=typeof e.namespace=="string"&&e.namespace?e.namespace:null,s=typeof e.id=="string"&&e.id?e.id:yu(r);return ve({id:s,level:t,message:o,namespace:i,detail:typeof e.detail>"u"?null:le(e.detail),meta:typeof e.meta>"u"?null:le(e.meta),timestamp:r,isoTimestamp:n,origin:typeof e.origin>"u"?null:Zd(e.origin)})}function jy(){return W&&typeof W.navigator=="object"&&W.navigator?W.navigator:typeof navigator<"u"&&navigator?navigator:typeof globalThis<"u"&&globalThis&&typeof globalThis.navigator=="object"?globalThis.navigator:null}function Pu(){const e=jy();return!e||typeof e!="object"||!e.serviceWorker?null:e.serviceWorker}function Iy(e){return e?D.seenIds?D.seenIds.has(e)?!1:(D.seenIds.add(e),!0):Array.isArray(D.fallbackSeenIds)?D.fallbackSeenIds.indexOf(e)!==-1?!1:(D.fallbackSeenIds.push(e),!0):!0:!0}function vy(e,t){const r={};if(e&&typeof e.meta<"u")if(e.meta&&typeof e.meta=="object")for(const o in e.meta)Object.prototype.hasOwnProperty.call(e.meta,o)&&(r[o]=e.meta[o]);else r.value=e.meta;const n=e&&typeof e.channel=="string"&&e.channel?e.channel:r.channel;return n?r.channel=n:r.channel="service-worker",t&&typeof t=="object"&&(t.cacheName&&!r.cacheName&&(r.cacheName=t.cacheName),t.cacheVersion&&!r.cacheVersion&&(r.cacheVersion=t.cacheVersion),typeof t.generatedAt=="number"&&Number.isFinite(t.generatedAt)&&(r.snapshotTimestamp||(r.snapshotTimestamp=t.generatedAt)),typeof t.historyLength=="number"&&Number.isFinite(t.historyLength)&&(r.snapshotSize||(r.snapshotSize=t.historyLength))),r}function Tc(e,t){if(!(!Array.isArray(e)||!e.length))for(let r=0;r<e.length;r+=1){const n=e[r];if(!n||typeof n!="object")continue;const o=typeof n.id=="string"&&n.id?n.id:null;if(!Iy(o))continue;const i=n.origin&&typeof n.origin=="object"?n.origin:{runtime:"service-worker"},s=Cu({id:o||void 0,level:n.level,message:n.message,namespace:typeof n.namespace=="string"&&n.namespace?n.namespace:"service-worker",detail:typeof n.detail>"u"?null:n.detail,meta:vy(n,t),timestamp:n.timestamp,isoTimestamp:n.isoTimestamp,origin:i});s&&mu(s)}}function li(e){if(D.requestInFlight&&!(e&&D.lastRequestId&&e!==D.lastRequestId)){if(D.requestInFlight=!1,D.lastRequestId=null,D.requestTimer&&typeof clearTimeout=="function")try{clearTimeout(D.requestTimer)}catch{}D.requestTimer=null}}function Vr(){if(!(D.broadcastChannel||D.broadcastFailed)&&!(D.pollTimer||typeof setTimeout!="function"))try{D.pollTimer=setTimeout(()=>{D.pollTimer=null,ku("poll")},Qd)}catch{}}function Ly(){if(D.broadcastFailed)return null;if(D.broadcastChannel)return D.broadcastChannel;if(typeof BroadcastChannel!="function")return D.broadcastFailed=!0,null;try{const e=new BroadcastChannel(qd);if(e.addEventListener("message",Li),D.broadcastChannel=e,D.pollTimer&&typeof clearTimeout=="function"){try{clearTimeout(D.pollTimer)}catch(t){}D.pollTimer=null}return e}catch(e){return D.broadcastFailed=!0,Xe("cineLogging: Unable to open service worker diagnostics channel",e),null}}function Li(e){if(!e)return;let t=null;try{t=e.data||null}catch{t=null}if(!(!t||typeof t!="object")){if(t.type===Wd){Tc([t.entry],D.lastSnapshotMeta),Vr();return}if(t.type===Jd){li(t.requestId||null);const r=t.state&&typeof t.state=="object"?t.state:null;if(!r){Vr();return}D.lastSnapshotMeta={cacheName:typeof r.cacheName=="string"&&r.cacheName?r.cacheName:null,cacheVersion:r.cacheVersion||null,generatedAt:typeof r.generatedAt=="number"&&Number.isFinite(r.generatedAt)?r.generatedAt:Date.now(),historyLength:typeof r.historyLength=="number"&&Number.isFinite(r.historyLength)?r.historyLength:null},Tc(r.history,D.lastSnapshotMeta),Vr()}}}function ku(e){if(D.requestInFlight)return;const t=Pu();if(!t)return;D.supported=!0;const r=`sw-log-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;D.requestInFlight=!0,D.lastRequestId=r;const n={type:Yd,limit:Xd,reason:typeof e=="string"&&e?e:"sync",requestId:r},o=s=>{if(s){try{s.port1.onmessage=null}catch{}if(typeof s.port1.onmessageerror<"u")try{s.port1.onmessageerror=null}catch{}try{s.port1.close()}catch{}try{s.port2.close()}catch{}}},i=t.ready&&typeof t.ready.then=="function"?t.ready.then(s=>s&&s.active||t.controller||null):Promise.resolve(t.controller||null);Promise.resolve(i).then(s=>{const a=t.controller||null,c=s||a;if(!c||typeof c.postMessage!="function"){li(r),Vr();return}let l=!1,f=null;const u=()=>{l||(l=!0,o(f),li(r))},y=()=>{u(),Vr()},p=b=>{u(),Li(b)},d=()=>{Xe("cineLogging: Service worker diagnostics channel closed before a response was received",{requestId:r}),y()},m=()=>{try{c.postMessage(n)}catch(b){Xe("cineLogging: Unable to post service worker diagnostics request",b),y();return}if(typeof setTimeout=="function")try{D.requestTimer=setTimeout(()=>{l||y()},Rc)}catch{}};if(!(typeof MessageChannel!="function"||!a?!1:c===a)){m();return}if(f=new MessageChannel,f.port1.onmessage=p,typeof f.port1.onmessageerror<"u"&&(f.port1.onmessageerror=d),typeof f.port1.start=="function")try{f.port1.start()}catch{}try{c.postMessage(n,[f.port2])}catch(b){o(f),f=null,Xe("cineLogging: Unable to request service worker diagnostics",b),m();return}if(typeof setTimeout=="function")try{D.requestTimer=setTimeout(()=>{l||d()},Rc)}catch{}}).catch(s=>{li(r),Xe("cineLogging: Unable to await service worker for diagnostics",s),Vr()})}function Ry(){if(D.initialised)return;D.initialised=!0;const e=Pu();if(e){if(D.supported=!0,Ly(),typeof e.addEventListener=="function")try{e.addEventListener("message",Li)}catch(t){Xe("cineLogging: Unable to attach service worker diagnostics listener",t)}else if(typeof e.onmessage>"u")try{e.onmessage=Li}catch{}ku("initial-sync"),D.broadcastChannel||Vr()}}function Ty(){if(!L.persistSession)return;const e=Uo();if(!e)return;let t="";try{t=e.getItem(_i)||""}catch{return}if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;for(let n=0;n<r.length;n+=1){const o=Cu(r[n]);o&&gu(o)}Ma({source:"restore"})}catch(r){Xe("cineLogging: Unable to restore log history from storage",r)}}function My(){L=ou();const e=Py();e&&os(e),ky(),_y()}My();Ty();Ry();za();L.captureGlobalErrors&&Ou();wu("cineLogging initialized",{config:Ao(),stats:Eu()},{namespace:"logging",meta:{lifecycle:"init"}});const is=ve({log:ft,debug:wu,info:py,warn:dy,error:yy,createLogger:Ey,getHistory:gy,getStats:Eu,clearHistory:hy,getConfig:Ao,setConfig:xa,getLevelState:Na,isLevelEnabled:du,subscribe:by,subscribeConfig:Sy,enableConsoleCapture:ly,disableConsoleCapture:uy,syncConsoleCapture:za,isConsoleCaptureActive:Ba,constants:ve({LOG_LEVELS:Ud,DEFAULT_CONFIG:Hd})});Fd("cineLogging",is);const _u={category:"diagnostics",description:"Structured logging utilities for debugging and diagnostics.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},Ny=Gd("cineLogging",is,_u,function(e){Xe("Unable to register cineLogging module.",e)},W,ci);Ny||Nd("cineLogging",is,_u,W);xd("cineLogging",is,{configurable:!0,enumerable:!1,writable:!1})||Xe("Unable to expose cineLogging globally.");const Cs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;function ju(){return(Cs&&typeof Cs=="object"?Cs:null)||(typeof globalThis<"u"?globalThis:null)}function Ri(e){const t=ju();if(!t)return null;let r,n=null;try{r=t.console,n=Object.getOwnPropertyDescriptor(t,"console")}catch{r=typeof console<"u"?console:null}if(!r||typeof r!="object")return null;let o=[];Array.isArray(e)?o=e:typeof e=="string"&&e?o=[e]:o=["warn","info"];const i=Object.create(null);for(let l=0;l<o.length;l+=1){const f=o[l];typeof f=="string"&&f&&(i[f]=!0)}const s=Object.keys(i);if(!s.length)return r;const a=Object.create(null);for(let l=0;l<s.length;l+=1){const f=s[l];let u=r[f];try{const y=Object.getOwnPropertyDescriptor(r,f);y&&Object.prototype.hasOwnProperty.call(y,"value")&&(u=y.value)}catch{}if(typeof u=="function")try{a[f]=u.bind(r)}catch{a[f]=u}else a[f]=u}const c=new Proxy(r,{get(l,f,u){return Object.prototype.hasOwnProperty.call(a,f)?a[f]:Reflect.get(l,f,u)},set(l,f,u,y){if(Object.prototype.hasOwnProperty.call(a,f))return a[f]=u,!0;try{return Reflect.set(l,f,u,y),!0}catch{}return!1},defineProperty(l,f,u){return Object.prototype.hasOwnProperty.call(a,f)?(u&&Object.prototype.hasOwnProperty.call(u,"value")&&(a[f]=u.value),!0):Reflect.defineProperty(l,f,u)},getOwnPropertyDescriptor(l,f){return Object.prototype.hasOwnProperty.call(a,f)?{configurable:!0,enumerable:!0,writable:!0,value:a[f]}:Reflect.getOwnPropertyDescriptor(l,f)},ownKeys(l){const f=Reflect.ownKeys(l);for(let u=0;u<s.length;u+=1)f.indexOf(s[u])===-1&&f.push(s[u]);return f}});try{Object.defineProperty(t,"console",{configurable:!0,enumerable:n?n.enumerable!==!1:!0,writable:!0,value:c})}catch{t.console=c}return c}const Yo=ju();if(Yo&&typeof Yo=="object")try{typeof Yo.__cineEnsureConsoleMethodsWritable!="function"&&(Yo.__cineEnsureConsoleMethodsWritable=Ri)}catch{}const Gy=Object.freeze(Object.defineProperty({__proto__:null,ensureConsoleMethodsWritable:Ri},Symbol.toStringTag,{value:"Module"}));function zy(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const sr=zy();function By(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const we=By(sr),xy=we&&typeof we.freezeDeep=="function"?we.freezeDeep:function(t){return t},Iu=e=>{try{return xy(e)}catch{return e}};function Mc(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return e&&r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}const Fy=we&&typeof we.collectCandidateScopes=="function"?function(t){try{const r=we.collectCandidateScopes(t,sr);if(Array.isArray(r)&&r.length)return r}catch{}return Mc(t||sr)}:Mc;function Uy(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Vs=we&&typeof we.safeWarn=="function"?we.safeWarn:Uy;function Dy(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=null;try{t=e.cineLogging||null}catch{t=null}return t&&typeof t=="object"?t:null}function vu(e={}){const t=e.baseScope||sr;e.allowRequire;const r=Fy(t);for(let n=0;n<r.length;n+=1){const o=Dy(r[n]);if(o)return o}return null}function Or(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const o=[];t.set(e,o);for(let i=0;i<e.length;i+=1)o[i]=Or(e[i],t);return o}const r={};t.set(e,r);const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=Or(e[i],t)}return r}function Ky(e,t){if(!e&&!t)return null;if(!e)return Or(t);if(!t)return Or(e);if(typeof e!="object"||typeof t!="object")return Or(t);const r=Or(e),n=Object.keys(t);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=Or(t[i])}return r}function $y(e){if(typeof console>"u"||!console)return null;const t=typeof e=="string"?e.toLowerCase():"";return t==="error"&&typeof console.error=="function"?console.error.bind(console):t==="warn"&&typeof console.warn=="function"?console.warn.bind(console):t==="info"&&typeof console.info=="function"?console.info.bind(console):t==="debug"&&typeof console.debug=="function"?console.debug.bind(console):typeof console.log=="function"?console.log.bind(console):null}let Nc=!1;function Lu(e,t={}){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?Or(t.meta):null;function o(s,a,c,l){const f=$y(s);if(!f)return null;const u=["[cine-fallback]"];r&&u.push(`[${r}]`);const y=new Date;try{u.push(y.toISOString())}catch{u.push(String(y.getTime()))}const m=[`${u.join(" ")} ${typeof a=="string"&&a?a:"Log entry"}`];typeof c<"u"&&m.push(c);const g=Ky(n,l);g&&m.push({meta:g,source:"console-fallback"});try{f(...m)}catch{}if(!Nc&&typeof console<"u"&&typeof console.warn=="function"){Nc=!0;try{console.warn("[cine-fallback] Structured logging unavailable, using console logger.")}catch{}}return null}return Iu({namespace:r,log(s,a,c,l){return o(s,a,c,l)},debug(s,a,c){return o("debug",s,a,c)},info(s,a,c){return o("info",s,a,c)},warn(s,a,c){return o("warn",s,a,c)},error(s,a,c){return o("error",s,a,c)},getConfig(){return null},isLevelEnabled(){return!0},getLevelState(s){return{level:typeof s=="string"&&s?s:"all",enabled:!0,source:"console-fallback"}},__cineLoggingFallback:!0})}function Vy(e,t={}){const r=vu(t),n=t&&typeof t.meta<"u"?t.meta:void 0;if(r&&typeof r.createLogger=="function")try{const o=r.createLogger(e,typeof n<"u"?{meta:n}:void 0);if(o)return o}catch(o){Vs("cineLoggingResolver: createLogger failed, falling back to console.",o)}return t.allowConsoleFallback===!1?null:Lu(e,{meta:n})}const Hr=Iu({resolveLogging:vu,resolveLogger:Vy,createConsoleFallbackLogger:Lu}),Hy=we&&typeof we.resolveModuleRegistry=="function"?we.resolveModuleRegistry(sr):null;if(we&&typeof we.registerOrQueueModule=="function"&&!we.registerOrQueueModule("cineLoggingResolver",Hr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0,connections:["cineLogging","cineModuleBase","cineEnvironmentBridge"]},t=>{Vs("Unable to register cineLoggingResolver module.",t)},sr,Hy)&&typeof we.queueModuleRegistration=="function")try{we.queueModuleRegistration("cineLoggingResolver",Hr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0},sr)}catch(t){Vs("Unable to queue cineLoggingResolver registration.",t)}if(we&&typeof we.exposeGlobal=="function")we.exposeGlobal("cineLoggingResolver",Hr,sr,{configurable:!0,enumerable:!1,writable:!1});else try{sr.cineLoggingResolver=Hr}catch{}function qy(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const vr=qy(),wt=typeof cineModuleBase=="object"&&cineModuleBase||(vr&&typeof vr.cineModuleBase=="object"?vr.cineModuleBase:null),Mr=wt&&typeof wt.safeWarn=="function"?wt.safeWarn:function(t,r){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof r>"u"?console.warn(t):console.warn(t,r)}catch{}},Fa="cameraPowerPlanner_contacts";function Ru(e){const t=e||vr;try{if(t&&typeof t.localStorage<"u")return t.localStorage}catch(r){Mr("cine.features.contacts could not access localStorage.",r)}return null}function Tu(){return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function Wt(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return Wt(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Mu(e){if(!e||typeof e!="object")return null;const t=Wt(e.id)||Tu(),r=Wt(e.name),n=Wt(e.role),o=Wt(e.phone),i=Wt(e.email),s=Wt(e.website||e.url),a=Wt(e.notes||e.note||e.text),c=typeof e.avatar=="string"&&e.avatar.startsWith("data:")?e.avatar:"",l=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),f=Number.isFinite(e.updatedAt)?e.updatedAt:l,u={id:t,name:r,role:n,phone:o,email:i,website:s,notes:a,createdAt:l,updatedAt:f};return c&&(u.avatar=c),u}function Nu(e){return(Array.isArray(e)?e.filter(Boolean):[]).map(Mu).filter(Boolean).sort((t,r)=>{const n=(t&&t.name?t.name:"").toLowerCase(),o=(r&&r.name?r.name:"").toLowerCase();if(n&&o&&n!==o)try{return n.localeCompare(o)}catch(i){Mr("cine.features.contacts could not sort contacts by locale.",i)}return n&&!o?-1:!n&&o?1:(t&&t.createdAt?t.createdAt:0)-(r&&r.createdAt?r.createdAt:0)})}function Wy(e={}){const t=Ru(e.scope);if(!t||typeof t.getItem!="function")return[];const r=typeof e.storageKey=="string"&&e.storageKey?e.storageKey:Fa;try{const n=t.getItem(r);if(!n)return[];const o=JSON.parse(n);return Array.isArray(o)?Nu(o):[]}catch(n){return Mr("cine.features.contacts could not load contacts from storage.",n),[]}}function Yy(e,t={}){const r=Ru(t.scope);if(!r||typeof r.setItem!="function")return!1;const n=typeof t.storageKey=="string"&&t.storageKey?t.storageKey:Fa;try{return r.setItem(n,JSON.stringify(Array.isArray(e)?e:[])),!0}catch(o){return Mr("cine.features.contacts could not save contacts to storage.",o),!1}}const Ln=Object.freeze({CONTACTS_STORAGE_KEY:Fa,generateContactId:Tu,sanitizeContactValue:Wt,normalizeContactEntry:Mu,sortContacts:Nu,loadStoredContacts:Wy,saveContactsToStorage:Yy});if(wt&&typeof wt.registerOrQueueModule=="function")try{wt.registerOrQueueModule("cine.features.contacts",Ln,{category:"features",description:"Shared helpers for contacts management.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cinePersistence"]},e=>Mr("Unable to register cine.features.contacts module.",e),vr,wt.getModuleRegistry&&wt.getModuleRegistry(vr))}catch(e){Mr("cine.features.contacts registration failed.",e)}let Gu=!1;if(wt&&typeof wt.exposeGlobal=="function")try{wt.exposeGlobal("cineFeaturesContacts",Ln,vr,{configurable:!0,enumerable:!1,writable:!1}),Gu=!0}catch(e){Mr("cine.features.contacts could not expose global api.",e)}if(!Gu)try{vr.cineFeaturesContacts=Ln}catch(e){Mr("cine.features.contacts could not assign global api.",e)}const Rb=Object.freeze(Object.defineProperty({__proto__:null,default:Ln},Symbol.toStringTag,{value:"Module"}));class zu{async init(){throw new Error('Method "init()" must be implemented.')}async getItem(t){throw new Error('Method "getItem()" must be implemented.')}async setItem(t,r){throw new Error('Method "setItem()" must be implemented.')}async removeItem(t){throw new Error('Method "removeItem()" must be implemented.')}async clear(){throw new Error('Method "clear()" must be implemented.')}async getKeys(){throw new Error('Method "getKeys()" must be implemented.')}}class Ti extends zu{constructor(){super(),this.name="IndexedDBAdapter"}async init(){try{if(typeof indexedDB>"u")throw new Error("IndexedDB is not supported in this environment.");return Promise.resolve()}catch(t){throw console.warn("IndexedDB initialization failed:",t),t}}async getItem(t){try{const r=await vp(t);if(r==null)return null;if(typeof r!="string"){if(r&&typeof r=="object")try{return JSON.parse(JSON.stringify(r))}catch{return r}return r}let n=Ns.decompressFromUTF16(r);const o=n!==null?n:r;try{return JSON.parse(o)}catch{return o}}catch(r){return console.warn(`[IndexedDBAdapter] Failed to get/decompress item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r),o=Ns.compressToUTF16(n);await Lp(t,o)}catch(n){throw console.error(`[IndexedDBAdapter] Failed to compress/save item: ${t}`,n),n}}async removeItem(t){return Rp(t)}async clear(){return Tp()}async getKeys(){return Mp()}}class Bu{constructor(){this.userId=null,this.deviceId=null,this.sessionId=null,this.storageKey="cine_user_uuid",this.deviceStorageKey="cine_device_uuid"}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})}init(){if(this.userId&&this.deviceId&&this.sessionId)return this.userId;let t=localStorage.getItem(this.storageKey);t?console.log("[UserContext] Loaded User UUID:",t):(t=this.generateUUID(),localStorage.setItem(this.storageKey,t),console.log("[UserContext] Generated new User UUID:",t)),this.userId=t;let r=localStorage.getItem(this.deviceStorageKey);return r||(r=this.generateUUID(),localStorage.setItem(this.deviceStorageKey,r),console.log("[UserContext] Generated new Device UUID:",r)),this.deviceId=r,this.sessionId=this.generateUUID(),console.log("[UserContext] Session UUID:",this.sessionId),t}getUserId(){return this.userId?this.userId:this.init()}getDeviceId(){return this.deviceId||this.init(),this.deviceId}getSessionId(){return this.sessionId||this.init(),this.sessionId}getScopedKey(t){return`user_${this.getUserId()}_${t}`}getIdentity(){return{userId:this.getUserId(),deviceId:this.getDeviceId(),sessionId:this.getSessionId()}}reset(){localStorage.removeItem(this.storageKey),this.userId=null,this.sessionId=null}}const ze=new Bu,Jy=Object.freeze(Object.defineProperty({__proto__:null,UserContext:Bu,userContext:ze},Symbol.toStringTag,{value:"Module"})),xu=1,Zr=Object.freeze({SYNCED:"synced",PENDING:"pending",CONFLICT:"conflict",SYNCING:"syncing",LOCAL_ONLY:"local_only"}),De=Object.freeze({UNLOCKED:"unlocked",LOCKED_BY_SELF:"locked_by_self",LOCKED_BY_OTHER_TAB:"locked_by_other_tab",LOCKED_BY_OTHER_DEVICE:"locked_by_other_device"});function Ua(){return new Date().toISOString()}function Qy(e="doc"){const t=Date.now().toString(36),r=Math.random().toString(36).substring(2,10);return`${e}_${t}_${r}`}function Fu(e={}){const t=ze.getIdentity(),r=Ua();return{version:xu,docId:e.docId||Qy(e.docType||"doc"),docType:e.docType||"unknown",ownerId:t.userId,createdAt:r,updatedAt:r,syncStatus:Zr.LOCAL_ONLY,syncedAt:null,syncError:null,changeCount:1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId,lock:null,sharedWith:[],permissions:{}}}function Xy(e){if(!e||typeof e!="object")return Fu();const t=ze.getIdentity(),r=Ua();return{...e,version:xu,updatedAt:r,syncStatus:e.syncStatus===Zr.SYNCED?Zr.PENDING:e.syncStatus,changeCount:(e.changeCount||0)+1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId}}function Zy(e,t=null){return!e||typeof e!="object"?(console.warn("[SyncMetadata] Cannot mark null metadata as synced"),e):{...e,syncStatus:Zr.SYNCED,syncedAt:t||Ua(),syncError:null}}function eg(e,t){return!e||typeof e!="object"?e:{...e,syncStatus:Zr.CONFLICT,syncError:t}}function tg(e,t=null,r={}){return{_meta:t?Xy(t):Fu(r),data:e}}function rg(e){return!e||typeof e!="object"?{data:e,meta:null}:e._meta&&"data"in e?{data:e.data,meta:e._meta}:{data:e,meta:null}}function Jo(e){return e&&typeof e=="object"&&"_meta"in e&&"data"in e}const ng="cine-project-locks",og=5e3,ig=3e4,Ps="cine_project_lock_",yr=Object.freeze({LOCK_ACQUIRED:"lock_acquired",LOCK_RELEASED:"lock_released",LOCK_HEARTBEAT:"lock_heartbeat",LOCK_TAKEOVER:"lock_takeover",LOCK_QUERY:"lock_query",LOCK_STATUS:"lock_status"});class sg{constructor(){this.channel=null,this.localLocks=new Map,this.heartbeatIntervals=new Map,this.lockChangeListeners=new Set,this.initialized=!1}init(){if(!this.initialized){if(ze.init(),typeof BroadcastChannel<"u")try{this.channel=new BroadcastChannel(ng),this.channel.onmessage=t=>this._handleChannelMessage(t),console.log("[ProjectLockService] BroadcastChannel initialized")}catch(t){console.warn("[ProjectLockService] BroadcastChannel not available:",t)}this._restoreLocksFromStorage(),typeof window<"u"&&(window.addEventListener("beforeunload",()=>this._handlePageUnload()),window.addEventListener("pagehide",()=>this._handlePageUnload())),this.initialized=!0,console.log("[ProjectLockService] Initialized")}}async acquireLock(t,r={}){this.init();const n=this._getStoredLock(t),o=this._getLockStatusForLock(n);if(o===De.LOCKED_BY_SELF)return{success:!0,status:o,lock:n};if(o!==De.UNLOCKED&&!r.force)return{success:!1,status:o,lock:n};r.force&&n&&this._broadcastTakeover(t,n);const i=this._createLockObject(t);return this._storeLock(t,i),this.localLocks.set(t,i),this._startHeartbeat(t),this._broadcastLockAcquired(t,i),this._notifyListeners(t,De.LOCKED_BY_SELF,i),console.log("[ProjectLockService] Lock acquired:",t),{success:!0,status:De.LOCKED_BY_SELF,lock:i}}async releaseLock(t){this.init();const r=this._getStoredLock(t);return this._getLockStatusForLock(r)!==De.LOCKED_BY_SELF?(console.warn("[ProjectLockService] Cannot release lock not owned by this session"),!1):(this._stopHeartbeat(t),this._clearStoredLock(t),this.localLocks.delete(t),this._broadcastLockReleased(t),this._notifyListeners(t,De.UNLOCKED,null),console.log("[ProjectLockService] Lock released:",t),!0)}getLockInfo(t){this.init();const r=this._getStoredLock(t),n=this._getLockStatusForLock(r);return{status:n,lock:r,isEditable:n===De.UNLOCKED||n===De.LOCKED_BY_SELF}}subscribe(t){return this.lockChangeListeners.add(t),()=>this.lockChangeListeners.delete(t)}refreshHeartbeat(t){const r=this.localLocks.get(t);if(!r)return;const n=ze.getIdentity();if(r.sessionId!==n.sessionId){this._stopHeartbeat(t);return}r.heartbeat=new Date().toISOString(),this._storeLock(t,r),this._broadcastHeartbeat(t,r)}_createLockObject(t){const r=ze.getIdentity(),n=new Date().toISOString();return{projectId:t,userId:r.userId,deviceId:r.deviceId,sessionId:r.sessionId,acquiredAt:n,heartbeat:n}}_getStorageKey(t){return Ps+t}_storeLock(t,r){try{localStorage.setItem(this._getStorageKey(t),JSON.stringify(r))}catch(n){console.warn("[ProjectLockService] Failed to store lock:",n)}}_getStoredLock(t){try{const r=localStorage.getItem(this._getStorageKey(t));if(!r)return null;const n=JSON.parse(r);return this._isLockExpired(n)?(this._clearStoredLock(t),null):n}catch(r){return console.warn("[ProjectLockService] Failed to read lock:",r),null}}_clearStoredLock(t){try{localStorage.removeItem(this._getStorageKey(t))}catch(r){console.warn("[ProjectLockService] Failed to clear lock:",r)}}_isLockExpired(t){return!t||!t.heartbeat?!0:Date.now()-new Date(t.heartbeat).getTime()>ig}_getLockStatusForLock(t){if(!t||this._isLockExpired(t))return De.UNLOCKED;const r=ze.getIdentity();return t.sessionId===r.sessionId?De.LOCKED_BY_SELF:t.deviceId===r.deviceId?De.LOCKED_BY_OTHER_TAB:De.LOCKED_BY_OTHER_DEVICE}_startHeartbeat(t){this._stopHeartbeat(t);const r=setInterval(()=>{this.refreshHeartbeat(t)},og);this.heartbeatIntervals.set(t,r)}_stopHeartbeat(t){const r=this.heartbeatIntervals.get(t);r&&(clearInterval(r),this.heartbeatIntervals.delete(t))}_restoreLocksFromStorage(){const t=ze.getIdentity();try{for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(!n||!n.startsWith(Ps))continue;const o=n.slice(Ps.length),i=this._getStoredLock(o);i&&i.sessionId===t.sessionId&&(this.localLocks.set(o,i),this._startHeartbeat(o),console.log("[ProjectLockService] Restored lock:",o))}}catch(r){console.warn("[ProjectLockService] Failed to restore locks:",r)}}_handlePageUnload(){for(const t of this.localLocks.keys())this._stopHeartbeat(t),this._clearStoredLock(t),this._broadcastLockReleased(t);this.localLocks.clear()}_notifyListeners(t,r,n){for(const o of this.lockChangeListeners)try{o(t,r,n)}catch(i){console.warn("[ProjectLockService] Listener error:",i)}}_broadcast(t,r){if(this.channel)try{this.channel.postMessage({type:t,...r})}catch(n){console.warn("[ProjectLockService] Broadcast failed:",n)}}_broadcastLockAcquired(t,r){this._broadcast(yr.LOCK_ACQUIRED,{projectId:t,lock:r})}_broadcastLockReleased(t){this._broadcast(yr.LOCK_RELEASED,{projectId:t})}_broadcastHeartbeat(t,r){this._broadcast(yr.LOCK_HEARTBEAT,{projectId:t,lock:r})}_broadcastTakeover(t,r){this._broadcast(yr.LOCK_TAKEOVER,{projectId:t,oldLock:r})}_handleChannelMessage(t){const{type:r,projectId:n,lock:o,oldLock:i}=t.data||{};if(!n)return;const s=ze.getIdentity();switch(r){case yr.LOCK_ACQUIRED:o&&o.sessionId!==s.sessionId&&this._notifyListeners(n,this._getLockStatusForLock(o),o);break;case yr.LOCK_RELEASED:this._notifyListeners(n,De.UNLOCKED,null);break;case yr.LOCK_TAKEOVER:i&&i.sessionId===s.sessionId&&(console.warn("[ProjectLockService] Lock taken over by another tab:",n),this._stopHeartbeat(n),this.localLocks.delete(n),this._notifyListeners(n,De.LOCKED_BY_OTHER_TAB,null));break;case yr.LOCK_HEARTBEAT:o&&o.sessionId!==s.sessionId&&this._storeLock(n,o);break}}destroy(){for(const t of this.heartbeatIntervals.keys())this._stopHeartbeat(t);this.channel&&(this.channel.close(),this.channel=null),this.localLocks.clear(),this.lockChangeListeners.clear(),this.initialized=!1}}const an=new sg,Jn="cine_project:";class ag{constructor(){this.driver=new Ti,this.initialized=!1}async init(){this.initialized||(await this.driver.init(),console.log("[StorageRepository] Initialized with default driver:",this.driver.constructor.name),this.initialized=!0,an.init())}async switchDriver(t){console.log("[StorageRepository] Switching driver to:",t.constructor.name),await t.init(),this.driver=t}async getItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.getItem(r)}async setItem(t,r){this.initialized||await this.init();const n=ze.getScopedKey(t);return this.driver.setItem(n,r)}async removeItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.removeItem(r)}async clear(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`,n=t.filter(o=>o.startsWith(r)).map(o=>this.driver.removeItem(o));await Promise.all(n)}async getKeys(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`;return t.filter(n=>n.startsWith(r)).map(n=>n.slice(r.length))}getProjectKeyPrefix(){return Jn}getProjectStorageKey(t){return`${Jn}${t}`}getProjectKeyFromStorageKey(t){return typeof t!="string"||!t.startsWith(Jn)?t:t.slice(Jn.length)}isProjectStorageKey(t){return typeof t=="string"&&t.startsWith(Jn)}async getProjectKeys(){return(await this.getKeys()).filter(r=>this.isProjectStorageKey(r)).map(r=>this.getProjectKeyFromStorageKey(r))}async loadProject(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return rg(n)}async loadProjectRaw(t){return(await this.loadProject(t)).data}async saveProject(t,r,n=null){this.initialized||await this.init();const o=an.getLockInfo(t);if(!o.isEditable)return console.warn("[StorageRepository] Cannot save - project is locked by another session"),{success:!1,error:"PROJECT_LOCKED",lockInfo:o};const i=tg(r,n,{docType:"project",docId:t}),s=this.getProjectStorageKey(t);return await this.setItem(s,i),kl(async()=>{const{dataVault:a}=await Promise.resolve().then(()=>fg);return{dataVault:a}},void 0).then(({dataVault:a})=>{a&&a.saveSnapshot(t,i).catch(c=>console.warn("Auto-backup failed",c))}),console.log("[StorageRepository] Project saved with metadata:",t),{success:!0,meta:i._meta}}async getProjectMeta(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return Jo(n)?n._meta:null}async markProjectSynced(t,r=null){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return Jo(o)?(o._meta=Zy(o._meta,r),await this.setItem(n,o),!0):(console.warn("[StorageRepository] Cannot mark as synced - no metadata"),!1)}async markProjectConflict(t,r){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return Jo(o)?(o._meta=eg(o._meta,r),await this.setItem(n,o),!0):!1}async getPendingSyncProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const o=await this.getProjectMeta(n);o&&(o.syncStatus===Zr.PENDING||o.syncStatus===Zr.LOCAL_ONLY)&&r.push({key:n,meta:o})}return r}async listProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const{data:o,meta:i}=await this.loadProject(n);i&&i.docType==="project"&&r.push({key:n,data:o,meta:i})}return r}async acquireProjectLock(t,r={}){return this.initialized||await this.init(),an.acquireLock(t,r)}async releaseProjectLock(t){return an.releaseLock(t)}getProjectLockInfo(t){return an.getLockInfo(t)}onLockChange(t){return an.subscribe(t)}async removeProject(t){const r=this.getProjectStorageKey(t);return this.removeItem(r)}async migrateUnprefixedProjectRecords({projectIndexKeys:t=[]}={}){this.initialized||await this.init();const r=await this.getKeys(),n=new Set(r.filter(a=>this.isProjectStorageKey(a))),o=new Set;(Array.isArray(t)?t:[]).forEach(a=>{const c=this.getProjectKeyFromStorageKey(a);typeof c=="string"&&c&&o.add(c)});for(const a of r){if(this.isProjectStorageKey(a)||o.has(a))continue;const c=await this.getItem(a);Jo(c)&&c._meta&&c._meta.docType==="project"&&o.add(a)}const s=[];for(const a of o){if(typeof a!="string"||!a)continue;const c=this.getProjectStorageKey(a);if(n.has(c))continue;const l=await this.getItem(a);if(l!=null)try{await this.setItem(c,l),await this.removeItem(a),n.add(c),s.push(a)}catch(f){console.warn(`[StorageRepository] Failed to migrate project key "${a}"`,f)}}return{migratedKeys:s}}}const C=new ag;class cg extends zu{constructor(){super();try{this.storage=window.localStorage}catch(t){console.warn("[LocalStorageAdapter] Unable to access window.localStorage.",t),this.storage=null}}async init(){if(!this.storage)throw new Error("LocalStorage is unavailable. Access to window.localStorage failed or is blocked.");return Promise.resolve()}async getItem(t){try{const r=this.storage.getItem(t);if(r===null)return null;try{return JSON.parse(r)}catch{return r}}catch(r){return console.warn(`[LocalStorageAdapter] Failed to get item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r);this.storage.setItem(t,n)}catch(n){throw console.error(`[LocalStorageAdapter] Failed to save item: ${t}`,n),n}}async removeItem(t){try{this.storage.removeItem(t)}catch(r){console.warn(`[LocalStorageAdapter] Failed to remove item: ${t}`,r)}}async clear(){try{this.storage.clear()}catch(t){console.warn("[LocalStorageAdapter] Failed to clear storage",t)}}async getKeys(){const t=[];for(let r=0;r<this.storage.length;r+=1){const n=this.storage.key(r);n!==null&&t.push(n)}return t}}const Qn="cine_storage_migrated_v2";class lg{constructor(){this.localStorage=new cg,this.indexedDB=new Ti}async runMigrationIfNeeded(){try{if(await this.localStorage.init(),await this.indexedDB.init(),await this.localStorage.getItem(Qn)==="true")return console.log("[MigrationService] Storage already migrated to IndexedDB."),!1;console.log("[MigrationService] Starting storage migration...");const r=await this.localStorage.getKeys();if(r.length===0)return console.log("[MigrationService] No local storage data found. safe to skip."),await this.markAsMigrated(),!1;const n=r.filter(i=>i!==Qn&&i!=="cine_user_uuid");let o;try{o=await this.loadUserContext()}catch(i){return console.error("[MigrationService] Failed to load UserContext for scoping. Aborting migration to prevent data loss.",i),!1}for(const i of n)try{const s=await this.localStorage.getItem(i);if(s!==null){const a=o.getScopedKey(i);await this.indexedDB.setItem(a,s),console.log(`[MigrationService] Migrated key: ${i} -> ${a}`)}}catch(s){console.error(`[MigrationService] Failed to migrate key: ${i}`,s)}return await this.markAsMigrated(),console.log("[MigrationService] Migration complete. IndexedDB is now the primary storage."),!0}catch(t){return console.error("[MigrationService] Critical migration failure:",t),!1}}async markAsMigrated(){const t=async(r,n)=>{try{await r.setItem(Qn,"true")}catch(o){console.warn(`[MigrationService] Failed to set migration flag in ${n}:`,o)}};await Promise.all([t(this.localStorage,"LocalStorage"),t(this.indexedDB,"IndexedDB")])}async loadUserContext(){const r=(await kl(()=>Promise.resolve().then(()=>Jy),void 0)).userContext;if(!r)throw new Error("UserContext module loaded but userContext export is missing");return r.init(),r}async isMigrated(){try{return await this.localStorage.getItem(Qn)==="true"?!0:await this.indexedDB.getItem(Qn)==="true"}catch(t){return console.warn("[MigrationService] Failed to check migration status:",t),!1}}}const qt=new lg,Gc="cameraPowerPlanner_ownGear";class ug{constructor(){this.memoryCache=null}async getOwnGear(){if(this.memoryCache)return this.memoryCache;try{const t=await C.getItem(Gc);if(!t)return[];Array.isArray(t)?this.memoryCache=t:t.items&&Array.isArray(t.items)?this.memoryCache=t.items:this.memoryCache=[]}catch(t){console.warn("[GearRepository] Failed to load own gear:",t),this.memoryCache=[]}return this.memoryCache}async saveOwnGear(t){if(!Array.isArray(t)){console.error("[GearRepository] saveOwnGear expects an array");return}this.memoryCache=t,await C.setItem(Gc,t)}async addOwnGearItem(t){const r=await this.getOwnGear();r.push(t),await this.saveOwnGear(r)}getLibrary(){return typeof window<"u"&&window.deviceLibrary?window.deviceLibrary:typeof globalThis<"u"&&globalThis.deviceLibrary?globalThis.deviceLibrary:{}}async searchGear(t){if(!t)return[];const r=t.toLowerCase();return(await this.getOwnGear()).filter(i=>i.name&&i.name.toLowerCase().includes(r)||i.brand&&i.brand.toLowerCase().includes(r))}}const Uu=new ug;class Du{constructor(){this.root=null,this.initialized=!1}async init(){if(!this.initialized)try{if(!navigator.storage||!navigator.storage.getDirectory){console.warn("[DataVault] OPFS is not supported in this browser.");return}this.root=await navigator.storage.getDirectory(),this.initialized=!0}catch(t){console.error("[DataVault] Failed to initialize OPFS:",t)}}async saveSnapshot(t,r){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const n=t.replace(/[^a-z0-9_\-\.\s]/gi,"_"),i=await(await this.root.getFileHandle(n+".json",{create:!0})).createWritable();return await i.write(JSON.stringify(r)),await i.close(),console.log(`[DataVault] Saved snapshot: ${t}`),!0}catch(n){throw console.error(`[DataVault] Failed to save snapshot ${t}:`,n),n}}async listSnapshots(){if(this.initialized||await this.init(),!this.root)return[];const t=[];try{for await(const[r,n]of this.root.entries())n.kind==="file"&&r.endsWith(".json")&&t.push(r)}catch(r){console.error("[DataVault] Failed to list snapshots:",r)}return t.sort().reverse()}async restoreSnapshot(t){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const o=await(await(await this.root.getFileHandle(t)).getFile()).text();return JSON.parse(o)}catch(r){throw console.error(`[DataVault] Failed to restore snapshot ${t}:`,r),r}}async deleteSnapshot(t){if(this.initialized||await this.init(),!!this.root)try{await this.root.removeEntry(t),console.log(`[DataVault] Deleted snapshot: ${t}`)}catch(r){console.warn(`[DataVault] Failed to delete snapshot ${t}:`,r)}}async clear(){if(this.initialized||await this.init(),!!this.root)try{const t=await this.listSnapshots();for(const r of t)await this.root.removeEntry(r);console.log("[DataVault] All data wiped.")}catch(t){console.error("[DataVault] Failed to wipe vault:",t)}}}const Hs=new Du,fg=Object.freeze(Object.defineProperty({__proto__:null,DataVault:Du,dataVault:Hs},Symbol.toStringTag,{value:"Module"}));var co={};console.log("DEBUG: storage.js execution started");let Ve={},ar=!1;async function Ku(){if(!ar){console.log("[storage.js] Hydrating project cache from storage...");try{const e=C&&typeof C.getProjectKeys=="function"?await C.getProjectKeys():[],t="cameraPowerPlanner_project";let r=null;const n=e.slice();if(C&&typeof C.getItem=="function"){const i=await C.getItem(Rn),s=ic(i);s&&(zn=s),C.getItem(Ft).then(a=>{a&&(Hi=a)}),C.getItem(Ot).then(a=>{a&&(ho=a)}),C.getItem(Qe).then(a=>{a&&(bo=a)}),C.getItem(ut).then(a=>{Array.isArray(a)&&(mn=a)}),C.getItem(Ut).then(a=>{a&&(qi=a)}),C.getItem(lr).then(a=>{a&&(Wi=a)}),C.getItem(Zt).then(a=>{a&&(Io=a)}),C.getItem(rt).then(a=>{a&&(vo=a)}),C.getItem(Nt).then(a=>{a&&(Lo=a)}),C.getItem(Re).then(a=>{a&&(Ro=a)}),C.getItem(tt).then(a=>{a&&(To=a)}),C.getItem(Mt).then(a=>{a&&(Bn=a)}),C.getItem(ct).then(a=>{a&&(Mo=a)}),C.getItem(et).then(a=>{a&&(No=a)}),C.getItem(lt).then(a=>{a&&(Go=a)}),C.getItem(Je).then(a=>{a&&(Kr=a)}),C.getItem(Bt()).then(a=>{a&&(zo=a)}),C.getItem(Fe).then(a=>{a&&(rr=a)}),r=await C.getItem(t)}if(r&&typeof r=="object")try{Object.assign(Ve,r)}catch(i){console.warn("[hydrate] Failed to load monolith",i)}const o=n.map(async i=>{try{const s=await C.loadProjectRaw(i);s&&(Ve[i]=s)}catch(s){console.warn("[hydrate] Failed to load shard",i,s)}});await Promise.all(o),ar=!0,console.log("[storage.js] Project cache hydrated. Keys:",Object.keys(Ve).length)}catch(e){console.warn("Cache hydration failed",e)}}}const h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:null,pg=typeof process<"u"&&process&&co&&(co.JEST_WORKER_ID||co.CINE_FORCE_STORAGE_REINIT),At="cine_factory_reset_lock";if(h&&h.__cineStorageInitialized)if(pg){try{delete h.__cineStorageInitialized}catch{h.__cineStorageInitialized=!1}try{delete h.__cineStorageApi}catch{h.__cineStorageApi=null}try{delete h.__cineMonolithicProjectCleanupDone}catch{h.__cineMonolithicProjectCleanupDone=!1}}else typeof module<"u"&&module.exports&&h.__cineStorageApi&&typeof h.__cineStorageApi=="object"&&(module.exports=h.__cineStorageApi);const dg="cine-power-planner-lifecycle";let je=null;const yg=typeof process<"u"&&process&&co&&co.JEST_WORKER_ID;if(typeof BroadcastChannel<"u"&&!yg)try{je=new BroadcastChannel(dg),je&&(je.onmessage=e=>{if(e&&e.data==="factory-reset"){if(h){h.__cameraPowerPlannerFactoryResetting=!0;try{typeof sessionStorage<"u"&&sessionStorage.setItem(At,"true"),typeof localStorage<"u"&&localStorage.setItem(At,"true")}catch(t){}if(typeof sessionStorage<"u"&&typeof sessionStorage.clear=="function")try{const t=sessionStorage.getItem(At);sessionStorage.clear(),t&&sessionStorage.setItem(At,t)}catch(t){}typeof h.location<"u"&&typeof h.location.reload=="function"&&h.location.reload()}}else e.data==="project-shards-changed"&&cr()})}catch{}if(h)try{const e=[typeof window<"u"?window:null,typeof sessionStorage<"u"?sessionStorage:null,typeof localStorage<"u"?localStorage:null];let t=!1;e.forEach(r=>{if(r&&typeof r.getItem=="function")try{r.getItem(At)&&(t=!0)}catch(n){}}),t&&(h.__cineJustFactoryReset=!0),e.forEach(r=>{if(r&&typeof r.removeItem=="function")try{r.removeItem(At)}catch(n){}}),Object.defineProperty(h,"__cineStorageInitialized",{configurable:!0,writable:!0,value:!0}),(async()=>{try{let r=!1;if(qt&&typeof qt.runMigrationIfNeeded=="function"){const o=await qt.runMigrationIfNeeded(),i=await qt.isMigrated();(o||i)&&(console.log(o?"[storage.js] Migration successful. Switching to IndexedDB.":"[storage.js] Native IndexedDB mode active."),await C.switchDriver(new Ti),r=!0)}else if(qt&&typeof qt.init=="function"){const o=await qt.init();let i=!1;typeof qt.isMigrated=="function"&&(i=await qt.isMigrated()),(o||i)&&(await C.switchDriver(new Ti),r=!0)}const n=await kh();if(r&&(await Ku(),(!n.hasIndex||!zn)&&ar&&Ve&&Object.keys(Ve).length>0))try{_o(Ve,T())}catch(o){console.warn("Failed to refresh project index after migration",o)}}catch(r){console.warn("[storage.js] Migration service failed:",r)}})()}catch{h.__cineStorageInitialized=!0}function gg(){if(je){try{je.close()}catch{}je=null}}typeof module<"u"&&module.exports&&(module.exports.closeStorageLifecycle=gg,module.exports.hydrateProjectCache=Ku,module.exports.__resetProjectMemoryCache=()=>{Ve={},ar=!1});function qs(e,t){if(e===null||typeof e!="object")return e;let r=t;if(r||(r=typeof WeakMap=="function"?new WeakMap:[]),typeof r.has=="function"&&typeof r.get=="function"){if(r.has(e))return r.get(e)}else if(Array.isArray(r))for(let i=0;i<r.length;i+=1){const s=r[i];if(s&&s[0]===e)return s[1]}if(Object.prototype.toString.call(e)==="[object Date]"){let i;try{const s=typeof e.getTime=="function"?e.getTime():e.valueOf();i=new Date(s)}catch{i=new Date(e)}return typeof r.set=="function"?r.set(e,i):Array.isArray(r)&&r.push([e,i]),i}const o=Array.isArray(e)?[]:{};if(typeof r.set=="function"?r.set(e,o):Array.isArray(r)&&r.push([e,o]),Array.isArray(e))for(let i=0;i<e.length;i+=1)o[i]=qs(e[i],r);else{const i=Object.keys(e);for(let s=0;s<i.length;s+=1){const a=i[s];o[a]=qs(e[a],r)}}return o}function Nr(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return qs(e,null)}function mg(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function hg(e){const t=mg(e);return t?function(n){if(n===null||typeof n!="object")return n;try{return t(n)}catch{}return Nr(n)}:Nr}const pr=h&&typeof h.__cineDeepClone=="function"?h.__cineDeepClone:hg(h),wn=typeof WeakSet=="function"?new WeakSet:null;function qr(e){if(!(!wn||typeof wn.add!="function"||!e))try{wn.add(e)}catch{}}function Da(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.sessionStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}(function(){const t=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=Da(t[r]);n&&qr(n)}if(typeof sessionStorage<"u")try{qr(sessionStorage)}catch{}})();function bg(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.localStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}function $u(){const e=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof globalThis<"u"?globalThis:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=[],r=typeof WeakSet=="function"?new WeakSet:null;for(let n=0;n<e.length;n+=1){const o=bg(e[n]);if(o){if(r)try{if(r.has(o))continue;r.add(o)}catch{}else if(t.indexOf(o)!==-1)continue;t.push(o)}}return t}if(h&&typeof h.__cineDeepClone!="function")try{h.__cineDeepClone=pr}catch{}function Vu(){const e=r=>{if(!r||typeof r!="object"&&typeof r!="function")return!1;try{return r.__cameraPowerPlannerFactoryResetting===!0}catch{return!1}};if(e(h))return!0;const t=[typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&n!==h&&e(n))return!0}try{if(typeof sessionStorage<"u"&&sessionStorage.getItem(At)||typeof localStorage<"u"&&localStorage.getItem(At))return!0}catch{}return!1}var Ze="cameraPowerPlanner_devices",Qo=null,pt="cameraPowerPlanner_setups",Xt="cameraPowerPlanner_session",Lr="cameraPowerPlanner_feedback",pe="cameraPowerPlanner_project",Ka="cameraPowerPlanner_project_rev",et="cameraPowerPlanner_favorites",tt="cameraPowerPlanner_contacts",Mt="cameraPowerPlanner_ownGear",ct="cameraPowerPlanner_userProfile",jr="cameraPowerPlanner_documentationTracker",dt="cameraPowerPlanner_schemaCache",Hu="cinePowerPlanner_schemaCache",Zt="cameraPowerPlanner_customFonts",ui="cameraPowerPlanner_mountVoltages",Nt="cameraPowerPlanner_cameraColors",Re="cineRentalPrintSections",Rn="cameraPowerPlanner_projectIndex",lo=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.mountVoltageKey"):null,st=null,Cr=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.storageCache"):"__cineStorageStateCache",Gt="cameraPowerPlanner_prj_",yn=typeof WeakMap=="function"&&typeof Map=="function"?new WeakMap:null,jt=null,zc=!1,Wr=typeof Map=="function"?new Map:null,Xn=[],Sg=6,qu=typeof Object.freeze=="function"?Object.freeze({__cineCompressionMiss:!0}):{__cineCompressionMiss:!0},Bc=Ju(8),xc=Ju(6),Ct=typeof Map=="function"?new Map:null,Pr=[],wg=16;function Mi(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.slice();for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n],i=e[o];t[o]=Array.isArray(i)?i.slice():i}return t}function Wu(e){if(!Ct||typeof e!="string"||!e)return null;var t;try{t=Ct.get(e)}catch{t=null}return!t||!t.payload?null:{payload:Mi(t.payload),compression:t.compression?Mi(t.compression):null}}function fi(e,t,r){if(!(!Ct||typeof e!="string"||!e||!Mn(t))){var n={payload:Mi(t),compression:r?Mi(r):null};try{Ct.set(e,n)}catch{return}var o=Pr.indexOf(e);for(o!==-1&&Pr.splice(o,1),Pr.push(e);Pr.length>wg;){var i=Pr.shift();if(!(!i||i===e))try{Ct.delete(i)}catch{}}}}function Eg(){if(Ct&&typeof Ct.clear=="function")try{Ct.clear()}catch{}Pr.length=0}var Ws=Number.POSITIVE_INFINITY,Ys=8,Yu=60*1e3,oo={entries:Object.create(null),totalWarnings:0,suppressionNoticeShown:!1},bt=null,gr=null,cn=null,Fc=!1;Gy&&typeof Ri=="function"&&(bt=Ri);var er="",zt=!1;!bt&&h&&typeof h.__cineEnsureConsoleMethodsWritable=="function"&&(bt=h.__cineEnsureConsoleMethodsWritable);typeof bt=="function"&&bt(["warn","info"]);function Ag(){var e=[],t=function(n){!n||typeof n!="object"&&typeof n!="function"||e.indexOf(n)===-1&&e.push(n)};return t(h),t(typeof globalThis<"u"?globalThis:null),t(typeof window<"u"?window:null),t(typeof self<"u"?self:null),t(typeof global<"u"?global:null),e}function Og(){if(gr)return gr;if(Hr&&typeof Hr.resolveLogger=="function")return gr=Hr,gr;for(var e=Ag(),t=0;t<e.length;t+=1){var r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{var n=r.cineLoggingResolver;if(n&&typeof n.resolveLogger=="function")return gr=n,gr}catch{}}return gr=null,gr}function Cg(){if(cn||Fc)return cn;Fc=!0;var e=Og();if(e&&typeof e.resolveLogger=="function")try{var t=e.resolveLogger("storage",{meta:{source:"storage-module"}});if(t)return cn=t,cn}catch{}return cn=null,cn}function pn(e){if(!e)return null;if(typeof e=="string")return{message:e};var t={};if(typeof e.name=="string"&&e.name&&(t.name=e.name),typeof e.message=="string"&&e.message&&(t.message=e.message),typeof e.stack=="string"&&e.stack&&(t.stack=e.stack),!Object.keys(t).length)try{t.message=String(e)}catch{return null}return t}function Er(e){if(e&&typeof U<"u"&&U&&U.storage===e)return U&&typeof U.type=="string"?U.type:"unknown";if(e&&h){try{if(h.localStorage&&e===h.localStorage)return"local"}catch{}try{if(h.sessionStorage&&e===h.sessionStorage)return"session"}catch{}}return typeof U<"u"&&U&&typeof U.type=="string"?U.type:"unknown"}function Ar(e,t,r,n,o){var i=typeof e=="string"&&e?e.toLowerCase():"info",s=typeof t=="string"&&t?t:"Storage event",a=Cg(),c=!1,l={module:"storage"};if(n&&typeof n=="object"){l={module:"storage"};for(var f=Object.keys(n),u=0;u<f.length;u+=1){var y=f[u];l[y]=n[y]}}if(a){if(typeof a[i]=="function")try{a[i](s,r,l),c=!0}catch{c=!1}else if(typeof a.log=="function")try{a.log(i,s,r,l),c=!0}catch{c=!1}}if(typeof o=="function"){try{o()}catch{}return c}if(typeof console>"u"||!console)return c;var p=null;if(i==="error"&&typeof console.error=="function"?p=console.error:i==="warn"&&typeof console.warn=="function"?p=console.warn:i==="info"&&typeof console.info=="function"?p=console.info:i==="debug"&&typeof console.debug=="function"?p=console.debug:typeof console.log=="function"&&(p=console.log),typeof p=="function")try{p.call(console,s,r||null)}catch{}return c}function Pg(){if(typeof Date>"u")return null;if(typeof Date.now=="function")return Date.now();try{return new Date().getTime()}catch{}return null}function ss(e,t,r,n,o){var i=typeof e=="string"&&e?e:"generic",s=null;if(typeof t=="string"&&t)s=t;else if(t!=null)try{s=String(t)}catch{s=null}var a={event:"compression-savings",kind:i,key:s,storageType:Er()};typeof n=="number"&&Number.isFinite(n)&&(a.savings=n),typeof o=="number"&&Number.isFinite(o)&&(a.percent=o);var c=function(){if(!(typeof console>"u")){var f=oo,u=f.entries[i],y=Pg();if(u||(u={kind:i,occurrences:0,totalSavings:0,lastPercent:null,lastKey:null,uniqueKeys:Object.create(null),uniqueKeyCount:0,firstLoggedAt:y,lastLoggedAt:y,lastSummaryAt:null,suppressedTotal:0,suppressedSinceSummary:0},f.entries[i]=u),u.occurrences+=1,u.lastLoggedAt=y,s&&(u.lastKey=s,u.uniqueKeys[s]||(u.uniqueKeys[s]=!0,u.uniqueKeyCount+=1)),typeof n=="number"&&Number.isFinite(n)&&(u.totalSavings+=n),typeof o=="number"&&Number.isFinite(o)&&(u.lastPercent=o),f.totalWarnings<Ws){typeof bt=="function"&&bt("warn"),typeof console.warn=="function"&&r&&console.warn(r),f.totalWarnings+=1;return}u.suppressedTotal+=1,u.suppressedSinceSummary+=1,!f.suppressionNoticeShown&&typeof console.info=="function"&&(typeof bt=="function"&&bt("info"),console.info("Additional storage compression warnings are being batched to keep diagnostics readable.",{limit:Ws,batchSize:Ys}),f.suppressionNoticeShown=!0);var p=!1;u.lastSummaryAt?(u.suppressedSinceSummary>=Ys||y!==null&&u.lastSummaryAt!==null&&u.suppressedSinceSummary>0&&y-u.lastSummaryAt>=Yu)&&(p=!0):p=!0,p&&typeof console.info=="function"&&(typeof bt=="function"&&bt("info"),console.info("Suppressed repeated storage compression warnings.",{kind:u.kind,mostRecentKey:u.lastKey,suppressedSinceSummary:u.suppressedSinceSummary,suppressedTotal:u.suppressedTotal,totalOccurrences:u.occurrences,totalSavings:u.totalSavings,lastPercent:u.lastPercent,uniqueKeys:u.uniqueKeyCount}),u.lastSummaryAt=y,u.suppressedSinceSummary=0)}};Ar("info",r,a,{event:"compression-savings",kind:i},c)}function kg(){for(var e={},t=Object.keys(oo.entries),r=0;r<t.length;r+=1){var n=t[r],o=oo.entries[n];o&&(e[n]={kind:o.kind,occurrences:o.occurrences,totalSavings:o.totalSavings,lastPercent:o.lastPercent,lastKey:o.lastKey,uniqueKeyCount:o.uniqueKeyCount,firstLoggedAt:o.firstLoggedAt,lastLoggedAt:o.lastLoggedAt,lastSummaryAt:o.lastSummaryAt,suppressedTotal:o.suppressedTotal})}return{limit:Ws,batchSize:Ys,summaryWindowMs:Yu,totalWarnings:oo.totalWarnings,suppressionNoticeShown:oo.suppressionNoticeShown,entries:e}}function _g(e){if(!Array.isArray(e)||!e.length)return null;for(var t=[],r=0;r<e.length;r+=1){var n=e[r]||{},o=typeof n.variant=="string"?n.variant:"",i=typeof n.compress=="string"?n.compress:"",s=typeof n.decompress=="string"?n.decompress:"";t.push(o+":"+i+":"+s)}return t.join("|")}function jg(e,t){if(!Wr||!e)return null;var r;try{r=Wr.get(e)}catch{r=null}return!r||r.lz!==t?null:!Array.isArray(r.strategies)||!r.strategies.length?Array.isArray(r.strategies)?[]:null:r.strategies.slice()}function Ig(e){if(!(!Wr||!e)){var t=Xn.indexOf(e);for(t!==-1&&Xn.splice(t,1),Xn.push(e);Xn.length>Sg;){var r=Xn.shift();if(typeof Wr.delete=="function")try{Wr.delete(r)}catch{}}}}function vg(e,t,r){if(!(!Wr||!e)){var n={lz:t,strategies:Array.isArray(r)?r.slice():[]};try{Wr.set(e,n),Ig(e)}catch{}}}function Lg(){if(typeof JSON>"u"||!JSON||typeof JSON.stringify!="function")return 0;try{var e={[ur]:!0,version:Ni,algorithm:Po,namespace:tn,data:"",originalLength:0,compressedPayloadLength:0,compressionVariant:""},t=JSON.stringify(e);if(typeof t!="string"||!t)return 0;var r=JSON.stringify("").length;return r>0?t.length-r*2-String(0).length*2:0}catch{}return 0}function Ju(e){if(typeof Map!="function")return null;var t=Number(e);return t>0?{map:new Map,keys:[],limit:Math.floor(t)}:null}function Qu(e){if(!e||typeof e!="object")return null;for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1)t[r[n]]=e[r[n]];return t}function Xu(e,t){if(!(!e||!Array.isArray(e.keys))){var r=e.keys.indexOf(t);r!==-1&&e.keys.splice(r,1),e.keys.push(t)}}function Zu(e,t){if(!e||!e.map||typeof e.map.get!="function")return{hit:!1};if(typeof t!="string"||!t)return{hit:!1};var r;try{r=e.map.get(t)}catch{return{hit:!1}}if(r===void 0)return{hit:!1};if(Xu(e,t),r===qu)return{hit:!0,candidate:null};var n=Qu(r);return n?{hit:!0,candidate:n}:{hit:!0,candidate:null}}function ef(e,t,r){if(!(!e||!e.map||typeof e.map.set!="function")&&!(typeof t!="string"||!t)&&!(!e.limit||e.limit<=0)){var n=r&&typeof r=="object"?Qu(r):qu;try{e.map.set(t,n)}catch{return}for(Xu(e,t);e.keys.length>e.limit;){var o=e.keys.shift();if(!(typeof o!="string"||o===t))try{e.map.delete(o)}catch{}}}}function $a(e,t){if(!e||typeof e!="object"&&typeof e!="function")return null;let r=null;if(Cr)try{r=e[Cr]}catch{r=null}if(!r&&yn)try{r=yn.get(e)||null}catch{r=null}if(r||!t)return r||null;const n=new Map;let o=!1;if(Cr)try{Object.defineProperty(e,Cr,{configurable:!0,writable:!0,value:n}),o=!0}catch{try{e[Cr]=n,o=!0}catch{o=!1}}if(!o&&yn)try{yn.set(e,n),o=!0}catch{o=!1}return o?n:null}function Rg(e,t){const r=$a(e,!1);return!r||typeof t!="string"||!t?null:r.get(t)||null}function Qt(e,t){const r=$a(e,!1);if(!(!r||typeof t!="string"||!t)&&(typeof r.delete=="function"&&r.delete(t),r.size===0)){if(Cr)try{e&&(typeof e=="object"||typeof e=="function")&&Object.prototype.hasOwnProperty.call(e,Cr)&&delete e[Cr]}catch{}if(yn)try{yn.delete(e)}catch{}}}function tf(e){if(e===null||typeof e!="object")return e;try{return pr(e)}catch{}return e}function ks(e){if(!e)return;const{value:t}=e;return t===null||typeof t!="object"?t:tf(t)}function Tn(e,t){const r=new Map;if(!e||typeof e.forEach!="function")return r;const{freezeArray:n=!1}=t||{};return e.forEach((o,i)=>{if(Array.isArray(o)){const s=o.slice();if(n)try{Object.freeze(s)}catch{}r.set(i,s)}else r.set(i,o)}),r}function Js(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Tn(e.raw),normalized:Tn(e.normalized)}}function Tg(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Tn(e.raw),normalized:Tn(e.normalized,{freezeArray:!0})}}function Mg(e){if(!E(e))return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n],i=e[o];if(i&&typeof i=="object")try{Object.freeze(i)}catch{}t[o]=i}try{Object.freeze(t)}catch{}return t}function Uc(e){if(!e||typeof e!="object"){st=null;return}st={projects:Mg(e.projects),changed:!!e.changed,originalValue:e.originalValue,lookup:Tg(e.lookup),rawValue:e.rawValue===void 0?void 0:e.rawValue}}function Ng(e){if(!st)return null;const t=T();let r=null;if(t&&typeof t.getItem=="function")try{r=t.getItem(pe)}catch{r=null}if(st.rawValue!==void 0&&st.rawValue!==r)return st=null,null;const{forMutation:n=!1}=e||{};return{projects:n?pr(st.projects):st.projects,changed:st.changed,originalValue:st.originalValue,lookup:Js(st.lookup)}}function cr(){st=null}function Gg(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}return null}function zg(){return Ka}function rf(e){const t=e||T();if(!t||typeof t.getItem!="function")return null;const r=Me(t,Ka,"Error reading project storage revision from localStorage:",null,{validate:n=>n===null||typeof n=="number"||typeof n=="string"});return Gg(r)}function Va(e){const t=e||T();if(!t||typeof t.setItem!="function")return null;const r=rf(t),n=Number.isFinite(r)?r+1:1;return Ae(t,Ka,n,"Error saving project storage revision to localStorage:",{disableCompression:!0,enableCompressionSweep:!1}),n}function Ke(e,t,r,n,o){if(typeof t!="string"||!t||!e||typeof e!="object"&&typeof e!="function")return;const i=$a(e,!0);if(!i)return;const s=tf(o),c={raw:typeof r=="string"&&r?r:null,normalizedRaw:typeof n=="string"&&n?n:typeof r=="string"&&r?r:null,value:s};i.set(t,c)}function Bg(e,t,r,n){const o=Rg(e,t);if(!o)return{hit:!1};if(typeof n=="string"&&n&&o.raw&&o.raw===n)return{hit:!0,value:ks(o)};if(typeof r=="string"&&r){if(o.normalizedRaw&&o.normalizedRaw===r)return{hit:!0,value:ks(o)};if(o.raw&&o.raw===r)return{hit:!0,value:ks(o)}}return{hit:!1}}function xg(e,t){if(!e||typeof e!="object")return"";var r;try{r=Object.getOwnPropertyDescriptor(e,t)}catch{r=null}if(r&&Object.prototype.hasOwnProperty.call(r,"value")&&typeof r.value=="string"&&r.value)return r.value;var n;try{n=e[t]}catch{n=""}if(typeof n=="string"&&n)return n;if(lo)try{const o=e[lo];if(typeof o=="string"&&o)return o}catch{}return""}function nf(e,t,r){if(!e||typeof e!="object")return"";if(lo)try{e[lo]=r;const i=e[lo];if(typeof i=="string"&&i)return i}catch{}var n;try{n=Object.getOwnPropertyDescriptor(e,t)}catch{n=null}if(n&&Object.prototype.hasOwnProperty.call(n,"value")&&typeof n.value=="string"&&n.value)return n.value;if(n&&n.configurable===!1&&n.writable===!1)return"";var o="";try{e[t]=r,o=e[t]}catch{o=""}return typeof o=="string"&&o?o:(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose mount voltage storage key globally. Using fallback only."),"")}function of(){if(!h||typeof h!="object")return ui;var e=xg(h,"MOUNT_VOLTAGE_STORAGE_KEY");if(e)return e;var t=nf(h,"MOUNT_VOLTAGE_STORAGE_KEY",ui);return t||ui}var pi=of();function sf(){const e=of();if(e&&e!==pi&&(pi=e,h&&nf(h,"MOUNT_VOLTAGE_STORAGE_KEY",e),typeof vt<"u"&&vt&&typeof vt.add=="function")){vt.add(e);const t=kt(e);for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&vt.add(n)}}return pi}function Bt(){return sf()}function af(){const e=sf();return e?`${e}__backup`:`${ui}__backup`}function cf(){if(!h)return Zt;const e=typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:typeof h.CUSTOM_FONT_STORAGE_KEY=="string"?h.CUSTOM_FONT_STORAGE_KEY:Zt;let t=e;return e==="cinePowerPlanner_customFonts"&&(t=Zt),h.CUSTOM_FONT_STORAGE_KEY!==t&&(h.CUSTOM_FONT_STORAGE_KEY=t),h.CUSTOM_FONT_STORAGE_KEY_NAME!==t&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=t),t}function en(){return h&&typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:cf()}cf();var rt="customLogo",Dc="cameraPowerPlanner_temperatureUnit",Kc="cameraPowerPlanner_focusScale";function Fg(){if(!h)return Dc;const e=typeof h.TEMPERATURE_UNIT_STORAGE_KEY=="string"?h.TEMPERATURE_UNIT_STORAGE_KEY:Dc;if(h.TEMPERATURE_UNIT_STORAGE_KEY!==e)try{h.TEMPERATURE_UNIT_STORAGE_KEY=e}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign temperature unit storage key globally.",t);try{Object.defineProperty(h,"TEMPERATURE_UNIT_STORAGE_KEY",{configurable:!0,writable:!0,value:e})}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose temperature unit storage key globally.",r)}}return e}var lt=Fg(),Je=(function(){if(!h)return Kc;const t=typeof h.FOCUS_SCALE_STORAGE_KEY=="string"?h.FOCUS_SCALE_STORAGE_KEY:Kc;if(h.FOCUS_SCALE_STORAGE_KEY!==t)try{h.FOCUS_SCALE_STORAGE_KEY=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign focus scale storage key globally.",r)}if(h.FOCUS_SCALE_STORAGE_KEY_NAME!==t)try{h.FOCUS_SCALE_STORAGE_KEY_NAME=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose focus scale storage key globally.",r)}return t})(),Gr="cameraPowerPlanner_autoGearRules",nn="cameraPowerPlanner_autoGearSeeded",ut="cameraPowerPlanner_autoGearBackups",xt="cameraPowerPlanner_autoGearPresets",Ft="cameraPowerPlanner_autoGearMonitorDefaults",Ot="cameraPowerPlanner_autoGearActivePreset",Qe="cameraPowerPlanner_autoGearAutoPreset",lr="cameraPowerPlanner_autoGearShowBackups",Ut="cameraPowerPlanner_autoGearBackupRetention",Fe="cameraPowerPlanner_fullBackups",Ue="auto-backup-",Pt="auto-backup-before-delete-",Yr="__cineAutoBackupRenamed",Oo="__cineAutoBackupMetadata",En="__cineAutoBackupSnapshot",Jr=1,Ha="__cineAutoBackupCompressedPayload",lf="__cineCircular__",Rr=new Map,_s=typeof Set=="function"?new Set:null,Ug=2048;function Kt(e){return typeof e=="string"&&(e.startsWith(Ue)||e.startsWith(Pt))}if(h&&typeof h=="object")try{Object.prototype.hasOwnProperty.call(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG")||Object.defineProperty(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG",{configurable:!0,writable:!1,value:Yr})}catch{try{h.__CINE_AUTO_BACKUP_RENAMED_FLAG=Yr}catch{}}var gn=240,$c=20,uf=36,at=1,Dg=120;function Kg(){if(!(!h||typeof h!="object")){if(typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=uf}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention default globally.",e)}if(typeof h.AUTO_GEAR_BACKUP_RETENTION_MIN!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_MIN=at}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention minimum globally.",e)}}}Kg();function $g(e){return!e||typeof e!="object"?null:{version:Number.isFinite(e.version)?e.version:Jr,snapshotType:e.snapshotType==="delta"?"delta":"full",base:typeof e.base=="string"?e.base:null,sequence:Number.isFinite(e.sequence)?e.sequence:e.snapshotType==="delta"?1:0,createdAt:typeof e.createdAt=="string"?e.createdAt:null,changedKeys:Array.isArray(e.changedKeys)?e.changedKeys.slice():[],removedKeys:Array.isArray(e.removedKeys)?e.removedKeys.slice():[],payloadSignature:typeof e.payloadSignature=="string"?e.payloadSignature:null,payloadCompression:E(e.payloadCompression)?{...e.payloadCompression}:null,compressedPayload:E(e.compressedPayload)?me(e.compressedPayload,{stripMetadata:!0}):e.compressedPayload&&typeof e.compressedPayload=="string"?e.compressedPayload:null}}function uo(e,t){if(!e||typeof e!="object")return;const r=$g(t);try{Object.defineProperty(e,Oo,{configurable:!0,enumerable:!1,writable:!0,value:r})}catch{try{e[Oo]=r}catch{}}}function Co(e){if(!e||typeof e!="object")return null;const t=e[Oo];return!t||typeof t!="object"?null:t}function Vg(e,t){if(!t||typeof t!="object")return;const r=Co(e);r&&uo(t,r)}function me(e,t,r){const n=t||{},o=r||(typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),i=(s,a)=>{if(!o||!o.stack)return a();if(o.stack.has(s)){if(!o.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function")try{console.warn("Detected circular reference while cloning automatic backup data. Using a placeholder to keep serialization stable.")}catch{}return o&&(o.reportedCycle=!0),lf}o.stack.add(s);try{return a()}finally{o.stack.delete(s)}};return e===null||typeof e!="object"?e:e instanceof Date?new Date(e.getTime()):Array.isArray(e)?i(e,()=>e.map(s=>me(s,n,o))):i(e,()=>{const s={};if(Object.keys(e).forEach(a=>{n.stripMetadata&&a===Oo||(s[a]=me(e[a],n,o))}),!n.stripMetadata){const a=Co(e);a&&uo(s,a)}return s})}function Qs(e,t){const n=me(e,t,typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),o=ue(n);return o!==n?o:n}function Mn(e){return!E(e)||e[Ha]!==!0?!1:typeof e.data=="string"&&e.data}function js(e,t,r){if(!e||typeof e!="object")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:null};const n=r||{};if(n.disableCompression)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:typeof n.payloadSignature=="string"?n.payloadSignature:null};const o=n.reportCompression!==!1;let i=null;try{i=typeof n.payloadSignature=="string"?n.payloadSignature:Pe(e)}catch(y){i=null,console.warn("Unable to compute stable signature for automatic backup payload before compression",y)}const s=typeof n.existingPayloadSignature=="string"?n.existingPayloadSignature:null;if(s&&i&&s===i&&Mn(n.existingCompressedPayload)){const y=me(n.existingCompressedPayload,{stripMetadata:!0}),p=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null;return!n.disableCompression&&typeof i=="string"&&i&&fi(i,y,p),{payload:y,compression:p,compressed:!0,reused:!0,payloadSignature:i}}if(!n.disableCompression&&typeof i=="string"&&i){const y=Wu(i);if(y&&y.payload)return{payload:y.payload,compression:y.compression,compressed:!0,reused:!0,payloadSignature:i}}let a;try{a=JSON.stringify(e)}catch(y){return console.warn("Unable to serialize auto backup payload before compression",y),{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i}}if(typeof a!="string"||a.length<Ug)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};if(!n.disableCompression&&Mn(n.existingCompressedPayload)){const y=Do(n.existingCompressedPayload.data);if(y.success&&typeof y.value=="string"&&y.value===a){const p=me(n.existingCompressedPayload,{stripMetadata:!0}),d=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null,m=typeof i=="string"&&i?i:typeof s=="string"&&s?s:null;return m&&fi(m,p,d),{payload:p,compression:d,compressed:!0,reused:!0,payloadSignature:m}}}const c=Nn(a);if(!c||typeof c.serialized!="string")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};const l=c.originalLength-c.wrappedLength,f={[Ha]:!0,data:c.serialized,originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},u=typeof c.originalLength=="number"&&Number.isFinite(c.originalLength)&&typeof c.wrappedLength=="number"&&Number.isFinite(c.wrappedLength)?{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null}:null;if(!n.disableCompression&&typeof i=="string"&&i&&fi(i,f,u),o&&typeof console<"u"&&typeof console.warn=="function"&&l>0){const y=typeof t=="string"&&t?`"${t}"`:"an automatic backup",p=c.originalLength>0?Math.round(l/c.originalLength*100):0,d=`Stored compressed payload for ${y} snapshot to reduce storage usage by ${l} characters (${p}%).`;ss("auto-backup",t||y,d,l,p)}return{payload:f,compression:{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},compressed:!0,reused:!1,payloadSignature:i}}function Xs(e,t){if(!e||typeof e!="object")return{payload:e,compressed:!1};const r=e.payload;if(!Mn(r))return{payload:r,compressed:!1};const n=Do(r.data);if(!n.success||typeof n.value!="string"){const o=n&&n.error?n.error:null;throw console.warn("Unable to decompress automatic backup payload.",t,o),new Error("Failed to decompress automatic backup payload")}try{return{payload:JSON.parse(n.value),compressed:!0}}catch(o){throw console.warn("Unable to parse decompressed automatic backup payload.",t,o),o}}function fo(e,t){const r=Ja(e);if(r&&Number.isFinite(r.timestamp)&&r.timestamp>0)try{return new Date(r.timestamp).toISOString()}catch{}const n=t instanceof Date?t:new Date;try{return n.toISOString()}catch{return new Date().toISOString()}}function Hg(e,t,r){if(!E(e)||!r||r.snapshotType!=="delta")return{cycle:!1,path:[]};const n=new Set,o=[],i=Math.max(10,Object.keys(e).length+5);let s=0,a=t,c=r;for(;c&&c.snapshotType==="delta";){if(s>i)return{cycle:!0,path:o};const l=typeof c.base=="string"?c.base:null;if(!l)return{cycle:!1,path:o};if(!Kt(l))return{cycle:!1,path:o};if(n.has(l))return o.push(l),{cycle:!0,path:o};n.add(a),o.push(a);const f=Object.prototype.hasOwnProperty.call(e,l)?e[l]:null;if(!E(f))return{cycle:!1,path:o};if(a=l,c=Co(f),!c)return{cycle:!1,path:o};s+=1}return{cycle:!1,path:o}}function qg(e,t,r){if(!e||typeof e!="object")return;e.snapshotType="full",e.base=null,e.sequence=0,e.removedKeys=[];const n=E(r)?Object.keys(r):[];e.changedKeys=n.slice(),(typeof e.createdAt!="string"||!e.createdAt)&&(e.createdAt=fo(t))}function ff(e,t){if(!E(e))return e;const r={},n=new Map,o=t||{},i=typeof o.isAutoBackupKey=="function"?o.isAutoBackupKey:Kt,s=typeof o.filter=="function"?o.filter:null,a=s?l=>{let f=!1;try{f=s(l)}catch{f=!1}return f}:()=>!0,c=(l,f)=>{if(n.has(l))return n.get(l);const u=e[l],y=ls(u,l),p=y.restored?y.value:u;if(!E(p)){const g=me(p);return n.set(l,g),g}const d=p[En];if(d&&typeof d=="object"){if(f.has(l)){console.warn("Detected cyclic auto-backup reference while expanding snapshot",l);let S={},v=[],B=null;try{const G=Xs(d,l);if(G&&E(G.payload)){S=me(G.payload),v=Object.keys(G.payload);try{B=Pe(G.payload)}catch(N){B=null,console.warn("Unable to compute stable signature for automatic backup payload after detecting a cycle",N)}}}catch(G){console.warn("Failed to restore automatic backup payload after detecting a cyclic reference",l,G)}const M={version:Number.isFinite(d.version)?d.version:Jr,snapshotType:"full",base:null,sequence:Number.isFinite(d.sequence)?d.sequence:0,createdAt:typeof d.createdAt=="string"?d.createdAt:fo(l),changedKeys:v.slice(),removedKeys:[],payloadSignature:B};return Mn(d.payload)?(M.compressedPayload=me(d.payload,{stripMetadata:!0}),M.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(M.compressedPayload=null,M.payloadCompression=null),uo(S,M),n.set(l,S),S}f.add(l);const g=d.snapshotType==="delta"?"delta":"full",b=g==="delta"&&typeof d.base=="string"?d.base:null,P=b?me(c(b,f)):{};let A;try{A=Xs(d,l)}catch(S){throw console.warn("Failed to restore automatic backup payload while expanding snapshot",l,S),S}const O=E(A.payload)?A.payload:{},k=Array.isArray(d.changedKeys)&&d.changedKeys.length?d.changedKeys:Object.keys(O),_=Array.isArray(d.removedKeys)?d.removedKeys:[],I=me(P);k.forEach(S=>{Object.prototype.hasOwnProperty.call(O,S)&&I&&(I[S]=me(O[S]))}),_.forEach(S=>{Object.prototype.hasOwnProperty.call(I,S)&&delete I[S]});const w={version:Number.isFinite(d.version)?d.version:Jr,snapshotType:g,base:g==="delta"?b:null,sequence:Number.isFinite(d.sequence)?d.sequence:g==="delta"?1:0,createdAt:typeof d.createdAt=="string"?d.createdAt:fo(l),changedKeys:k.slice(),removedKeys:_.slice()};try{w.payloadSignature=Pe(O)}catch(S){w.payloadSignature=null,console.warn("Unable to compute stable signature for automatic backup payload during expansion",S)}return Mn(d.payload)?(w.compressedPayload=me(d.payload,{stripMetadata:!0}),w.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(w.compressedPayload=null,w.payloadCompression=null),uo(I,w),n.set(l,I),f.delete(l),I}const m=me(p);if(i(l)){const g={version:Jr,snapshotType:"full",base:null,sequence:0,createdAt:fo(l),changedKeys:Object.keys(m),removedKeys:[]};uo(m,g)}return n.set(l,m),m};return Object.keys(e).forEach(l=>{if(a(l)){if(!i(l)){const f=e[l];r[l]=E(f)?me(f):f;return}r[l]=c(l,new Set)}}),r}function Wg(e,t){const r={},n=[],o=[],i=E(t)?Object.keys(t):[],s=E(e)?Object.keys(e):[];return new Set([...i,...s]).forEach(c=>{if(c===Oo)return;const l=Object.prototype.hasOwnProperty.call(e||{},c),f=Object.prototype.hasOwnProperty.call(t||{},c);if(!l&&f){o.push(c);return}if(!l)return;const u=e?e[c]:void 0,y=f?t[c]:void 0,p=Pe(u),d=Pe(y);p!==d&&(n.push(c),r[c]=me(u,{stripMetadata:!0}))}),{payload:r,changedKeys:n,removedKeys:o}}function pf(e,t){if(!E(e))return e;const r=t||{},n=typeof r.isAutoBackupKey=="function"?r.isAutoBackupKey:Kt,o={},i=Object.keys(e),s=(()=>{const a=new Map;i.forEach(l=>{if(!n(l))return;const f=e[l],u=Co(f);let y=Number.NEGATIVE_INFINITY;if(u&&typeof u.createdAt=="string"){const m=Date.parse(u.createdAt);Number.isNaN(m)||(y=m)}if(!Number.isFinite(y)){const m=Ja(l);m&&Number.isFinite(m.timestamp)&&(y=m.timestamp)}const p=l.startsWith(Pt)?Pt:Ue,d=a.get(p);(!d||y>d.timestamp||y===d.timestamp&&l.localeCompare(d.name)>0)&&a.set(p,{name:l,timestamp:y})});const c=new Set;return a.forEach(({name:l})=>{typeof l=="string"&&l&&c.add(l)}),c})();return i.forEach(a=>{const c=e[a],l=Qs(c,{stripMetadata:!0});if(!n(a)||!E(l)){o[a]=l;return}const f=s.has(a),u=Co(c);u&&u.snapshotType==="delta"&&Hg(e,a,u).cycle&&(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Detected cyclic automatic backup chain during serialization. Promoting to full snapshot.",a),qg(u,a,l));const y=u&&typeof u.createdAt=="string"?u.createdAt:fo(a);if(!u||u.snapshotType!=="delta"){o[a]={};const O={version:Jr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(l||{}),removedKeys:[]};let k;try{k=Pe(l)}catch(I){k=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",I)}const _=js(l,a,{disableCompression:f,payloadSignature:k,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(O.payload=_.payload,_.compression&&(O.payloadCompression=_.compression),u){const I=typeof _.payloadSignature=="string"?_.payloadSignature:k;u.payloadSignature=I||null,_.compressed?(u.compressedPayload=me(_.payload,{stripMetadata:!0}),u.payloadCompression=_.compression?{..._.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][En]=O;return}const p=typeof u.base=="string"?u.base:null,d=p&&Object.prototype.hasOwnProperty.call(e,p)?e[p]:null;if(!d||!E(d)){o[a]={};const O={version:Jr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(l||{}),removedKeys:[]};let k;try{k=Pe(l)}catch(I){k=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",I)}const _=js(l,a,{disableCompression:f,payloadSignature:k,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(O.payload=_.payload,_.compression&&(O.payloadCompression=_.compression),u){const I=typeof _.payloadSignature=="string"?_.payloadSignature:k;u.payloadSignature=I||null,_.compressed?(u.compressedPayload=me(_.payload,{stripMetadata:!0}),u.payloadCompression=_.compression?{..._.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][En]=O;return}const m=Qs(d,{stripMetadata:!0}),g=Wg(l,m);o[a]={};const b={version:Number.isFinite(u.version)?u.version:Jr,snapshotType:"delta",base:p,sequence:Number.isFinite(u.sequence)?u.sequence:1,createdAt:y,changedKeys:g.changedKeys,removedKeys:g.removedKeys};let P;try{P=Pe(g.payload)}catch(O){P=null,console.warn("Unable to compute stable signature for automatic backup delta payload before serialization",O)}const A=js(g.payload,a,{disableCompression:f,payloadSignature:P,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(b.payload=A.payload,A.compression&&(b.payloadCompression=A.compression),u){const O=typeof A.payloadSignature=="string"?A.payloadSignature:P;u.payloadSignature=O||null,A.compressed?(u.compressedPayload=me(A.payload,{stripMetadata:!0}),u.payloadCompression=A.compression?{...A.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][En]=b}),o}function kt(e){if(typeof e!="string"||!e)return[e];const t=new Set([e]);return e.startsWith("cameraPowerPlanner_")?t.add(`cinePowerPlanner_${e.slice(19)}`):e.startsWith("cinePowerPlanner_")&&t.add(`cameraPowerPlanner_${e.slice(17)}`),Array.from(t)}var An=new Set(kt(pt));function Yg(){return(!Qo||typeof Qo.has!="function")&&(Qo=new Set(kt(Ze))),Qo}function df(e){if(typeof e!="string"||!e)return!1;const t=Yg();return t&&typeof t.has=="function"?t.has(e):e===Ze}function Jg(e){return!(typeof e!="string"||!e||!An||typeof An.has!="function"||!An.has(e)||zt)}function Qg(e,t){if(!e||typeof e.getItem!="function"||!An||typeof An.forEach!="function")return;const r=new Set,n=t&&typeof t.has=="function"?t:null;An.forEach(o=>{if(!(typeof o!="string"||!o||r.has(o))&&(r.add(o),!(n&&n.has(o))))try{e.getItem(o)}catch{}})}var he="__backup",Xg=3,Zg=100,on="__legacyMigrationBackup",vt=new Set([en(),rt,dt,tt,Mt,jr,pi,Je,Re]);Array.from(vt).forEach(e=>{kt(e).forEach(t=>{typeof t=="string"&&t&&vt.add(t)})});var Vc=[()=>({key:Ze}),()=>({key:pt}),()=>({key:Xt}),()=>({key:Lr}),()=>({key:pe,valueProvider:()=>{if(typeof _t=="function")try{const{projects:e}=_t({forMutation:!1});if(e&&typeof e=="object")return JSON.stringify(e)}catch(e){typeof console<"u"&&console.warn&&console.warn("Failed to reconstruct monolithic project backup",e)}return null}}),()=>({key:et}),()=>({key:tt}),()=>({key:Mt}),()=>({key:jr}),()=>({key:dt}),()=>({key:Gr}),()=>({key:nn}),()=>({key:ut}),()=>({key:xt}),()=>({key:Ot}),()=>({key:Qe}),()=>({key:lr}),()=>({key:Ut}),()=>({key:Ft}),()=>({key:Fe}),()=>({key:rt}),()=>({key:en()}),()=>({key:"darkMode"}),()=>({key:"pinkMode"}),()=>({key:"highContrast"}),()=>({key:"reduceMotion"}),()=>({key:"relaxedSpacing"}),()=>({key:"showAutoBackups"}),()=>({key:"accentColor"}),()=>({key:"fontSize"}),()=>({key:"fontFamily"}),()=>({key:"language"}),()=>({key:"iosPwaHelpShown"}),()=>({key:Re}),()=>({key:lt}),()=>({key:Bt(),backupKey:af()})];function em(e,t={}){if(!e||typeof e!="object")return null;const{key:r,backupKey:n,storage:o=null}=e;if(typeof r!="string"||!r)return null;const i=typeof n=="string"&&n?n:`${r}${he}`;return{key:r,backupKey:i,storage:o,label:typeof t.label=="string"?t.label:r,valueProvider:typeof e.valueProvider=="function"?e.valueProvider:null}}function tm(e={}){const t=[],r=new Set,n=i=>{if(!i)return;const s=kt(i.key),a=`${i.key}${he}`;for(let c=0;c<s.length;c+=1){const l=s[c];if(typeof l!="string"||!l)continue;let f=i.backupKey;l!==i.key&&i.backupKey===a&&(f=`${l}${he}`);const u=l===i.key?i:{...i,key:l,backupKey:f},y=u.storage||null,p=`${u.key}__${y?String(y):"default"}`;r.has(p)||(r.add(p),t.push(u))}};for(let i=0;i<Vc.length;i+=1){const s=Vc[i];if(typeof s!="function")continue;let a;try{a=s(e)}catch(l){var o={event:"critical-storage",action:"collect-keys",reason:"provider-error",storageType:Er(e&&e.storage?e.storage:null),error:pn(l)};Ar("warn","Critical storage key provider failed",o,{event:"critical-storage",stage:"gather"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage key provider failed",l)});continue}const c=em(a,e);c&&n(c)}return t}let yf=null;function rm(e){if(yf=e,!(!h||typeof h!="object"))try{h.__cineCriticalStorageGuard=e}catch{try{Object.defineProperty(h,"__cineCriticalStorageGuard",{configurable:!0,writable:!0,value:e})}catch{}}}function nm(e={}){let t=e&&e.storage?e.storage:null;if(!t)try{t=T()}catch(f){var r={event:"critical-storage",action:"resolve-storage",reason:"resolve-failed",storageType:Er(e&&e.storage?e.storage:null),error:pn(f)};Ar("warn","Unable to resolve safe storage while ensuring backups",r,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve safe storage while ensuring backups",f)}),t=null}const n={ensured:[],skipped:[],errors:[],timestamp:new Date().toISOString(),storageType:U&&U.type?U.type:"unknown"},o=tm(e),i=t&&typeof t.getItem=="function"?t:null;for(let f=0;f<o.length;f+=1){const u=o[f],y=u.storage&&typeof u.storage.getItem=="function"?u.storage:i;if(!y||typeof y.getItem!="function"||typeof y.setItem!="function"){n.skipped.push({key:u.key,reason:"unavailable-storage"});continue}let p;try{u.valueProvider?p=u.valueProvider():p=y.getItem(u.key)}catch(_){n.errors.push({key:u.key,reason:"read-failed",error:_});var s={event:"critical-storage",action:"inspect-primary",key:u.key,storageType:Er(y),reason:"read-failed",error:pn(_)};Ar("warn","Critical storage guard could not inspect "+u.key,s,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not inspect "+u.key,_)});continue}if(p==null){n.skipped.push({key:u.key,reason:"missing"});continue}let d;try{d=y.getItem(u.backupKey)}catch(_){n.errors.push({key:u.key,reason:"backup-read-failed",error:_});var a={event:"critical-storage",action:"inspect-backup",key:u.key,backupKey:u.backupKey,storageType:Er(y),reason:"backup-read-failed",error:pn(_)};Ar("warn","Critical storage guard could not read backup for "+u.key,a,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not read backup for "+u.key,_)});continue}if(typeof d=="string"){n.skipped.push({key:u.key,reason:"exists"});continue}const m=typeof p=="string"?p:p==null?"":String(p),g=_=>{try{return y.setItem(u.backupKey,_),{success:!0,error:null}}catch(I){return{success:!1,error:I}}},b=(_,I="backup-write-failed")=>{n.errors.push({key:u.key,reason:I,error:_});var w={event:"critical-storage",action:"mirror-backup",key:u.key,backupKey:u.backupKey,storageType:Er(y),reason:I,error:pn(_)};O&&(w.compressed=!0),Ar("error","Critical storage guard could not mirror "+u.key,w,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.error=="function"&&console.error("Critical storage guard could not mirror "+u.key,_)})},P=typeof m=="string"&&m&&!m.includes(`"${ur}":true`)&&!df(u.key);let A=m,O=null,k=g(A);if(!k.success&&k.error){if(!Rt(k.error)){b(k.error);continue}if(P){const _=Nn(m);_&&typeof _.serialized=="string"&&_.serialized&&(A=_.serialized,O=_,k=g(A))}if(!k.success&&k.error&&Rt(k.error)){const _=new Set;typeof u.backupKey=="string"&&u.backupKey&&_.add(u.backupKey);const I=Jg(u.key);!I&&typeof u.key=="string"&&u.key&&_.add(u.key),!I&&!zt&&Qg(y,_);const w=wf(y,{skipKeys:Array.from(_)});w&&w.success&&(k=g(A))}if(!k.success){b(k.error,Rt(k.error)?"backup-quota-exceeded":"backup-write-failed"),Rt(k.error)&&ce("critical-backup-quota");continue}}if(n.ensured.push({key:u.key,backupKey:u.backupKey,compressed:!!O}),O&&typeof O.originalLength=="number"&&typeof O.wrappedLength=="number"){const _=O.originalLength-O.wrappedLength,I=O.originalLength>0?Math.round(_/O.originalLength*100):0,w=`Stored compressed critical backup for ${u.key}, reducing storage usage by ${_} characters (${I}%).`;ss("critical-backup",u.key,w,_,I)}}if(rm(n),n.ensured.length){var c={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||Er(),count:n.ensured.length,timestamp:n.timestamp,entries:n.ensured.map(function(u){return{key:u.key,backupKey:u.backupKey,compressed:!!u.compressed}})};Ar("info","Critical storage guard mirrored backup copies",c,{event:"critical-storage",stage:"ensure"},function(){if(typeof console<"u"&&typeof console.info=="function"){const u=n.ensured.map(y=>({key:y.key,backupKey:y.backupKey}));console.info("Critical storage guard mirrored backup copies",{count:n.ensured.length,entries:u})}})}if(n.errors.length){var l={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||Er(),count:n.errors.length,timestamp:n.timestamp,reason:"errors-detected",entries:n.errors.map(function(u){return{key:u&&u.key,reason:u&&u.reason,error:pn(u&&u.error)}})};Ar("warn","Critical storage guard encountered issues",l,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard encountered issues",n.errors)})}return n}function om(){return yf}var im=10,gf="lz-string",mf="json-string",as=[{variant:"utf16",compress:"compressToUTF16",decompress:"decompressFromUTF16"},{variant:"uri-component",compress:"compressToEncodedURIComponent",decompress:"decompressFromEncodedURIComponent"},{variant:"base64",compress:"compressToBase64",decompress:"decompressFromBase64"}],ur="__cineStorageCompressed",Ni=1,Po="lz-string",Hc="lz-string-utf16",hf=as,tn="camera-power-planner:storage-compression",sm=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(Po):'"'.concat(String(Po),'"'),am=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(tn):'"'.concat(String(tn),'"'),qc=Lg(),ln=typeof WeakSet=="function"?new WeakSet:null,cm=40,lm=128,Tr="__cineRawGetItem",um=1024,fm=256,pm=.08;function cs(e){if(!Array.isArray(e)||!e.length)return[];var t=Ns;if(!t)return[];var r=_g(e),n=jg(r,t);if(n!=null)return n;for(var o=[],i=0;i<e.length;i+=1){var s=e[i];if(s){var a=typeof t[s.compress]=="function"?t[s.compress]:null,c=typeof t[s.decompress]=="function"?t[s.decompress]:null,l=null,f=0;if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{l=JSON.stringify(String(s.variant||"")),typeof l=="string"&&l?f=l.length:(l=null,f=0)}catch{l=null,f=0}a&&c&&o.push({variant:s.variant,compress:a,decompress:c,variantLiteral:f>0?l:null,variantLiteralLength:f})}}var u=o.length?o.slice():[];return r&&vg(r,t,u),u}function bf(e,t,r,n){if(typeof e!="string"||!e)return{success:!1};var o=cs(t);if(!o.length)return{success:!1};var i=[];if(r){for(var s=null,a=0;a<o.length;a+=1)if(o[a].variant===r){s=o[a];break}s?i.push(s):typeof console<"u"&&typeof console.warn=="function"&&console.warn("Compression variant ".concat(r," is unavailable while reading ").concat(n||"compressed payload","."))}for(var c=0;c<o.length;c+=1)(!r||o[c].variant!==r)&&i.push(o[c]);for(var l=null,f=0;f<i.length;f+=1){var u=i[f];try{var y=u.decompress(e);if(typeof y=="string"&&y)return{success:!0,value:y,variant:u.variant}}catch(p){l=p,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decompress ".concat(n||"compressed payload"," with ").concat(u.variant," variant"),p)}}return{success:!1,error:l}}function qa(){return cs(as).length>0}function dm(e,t){if(typeof e!="string"||!e||!qa())return null;var r=Zu(xc,e);if(r.hit)return r.candidate;var n=null,o=cs(as);if(!o.length)return null;for(var i=0;i<o.length;i+=1){var s=o[i],a=null;try{a=s.compress(e)}catch(f){console.warn("Unable to compress migration backup payload with ".concat(s.variant," variant"),f);continue}if(!(typeof a!="string"||!a||a.length>=e.length)){var c={createdAt:t,compression:gf,compressionVariant:s.variant,encoding:mf,data:a,originalSize:e.length,compressedSize:a.length},l;try{l=JSON.stringify(c)}catch(f){console.warn("Unable to serialize compressed migration backup payload",f);continue}typeof l!="string"||!l||l.length>=e.length||(!n||l.length<n.serializedLength)&&(n={serialized:l,serializedLength:l.length,originalSize:e.length,compressedSize:a.length,variant:s.variant})}}return ef(xc,e,n),n}function ym(e){if(typeof e!="string"||!e)return{createdAt:0,size:typeof e=="string"?e.length:0};const t={createdAt:0,size:e.length};try{const r=JSON.parse(e);if(r&&typeof r=="object"){let n=null;if(typeof r.createdAt=="string"?n=r.createdAt.trim():typeof r.createdAt=="number"&&Number.isFinite(r.createdAt)&&(t.createdAt=r.createdAt),n){const o=Date.parse(n);Number.isNaN(o)||(t.createdAt=o)}else for(let o=0;o<Gi.length;o+=1){const i=Gi[o];if(typeof r[i]=="string"){const s=r[i].trim();if(s){const a=Date.parse(s);if(!Number.isNaN(a)){t.createdAt=a;break}}}else if(typeof r[i]=="number"&&Number.isFinite(r[i])){t.createdAt=r[i];break}}}}catch{}return t}function Sf(){return qa()}function Nn(e){if(typeof e!="string"||!e||!Sf())return null;var t=Zu(Bc,e);if(t.hit)return t.candidate;var r=cs(hf);if(!r.length)return null;for(var n=typeof qc=="number"?qc:0,o=null,i=null,s=null,a=null,c=String(e.length).length,l=0;l<r.length;l+=1){var f=r[l],u=null;try{u=f.compress(e)}catch(k){console.warn("Unable to compress storage payload with ".concat(f.variant," variant"),k);continue}if(!(typeof u!="string"||!u)){var y;try{y=JSON.stringify(u)}catch(k){console.warn("Unable to serialize compressed storage payload candidate",k);continue}if(!(typeof y!="string"||!y)){var p=typeof f.variantLiteral=="string"&&f.variantLiteral?f.variantLiteral:null,d=typeof f.variantLiteralLength=="number"&&f.variantLiteralLength>0?f.variantLiteralLength:0;if(!p&&typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{p=JSON.stringify(String(f.variant||"")),d=typeof p=="string"&&p?p.length:0}catch{p=null,d=0}var m=null,g=Number.POSITIVE_INFINITY;if(n>0&&d>0){var b=String(u.length).length;g=n+y.length+c+b+d}else{var P={[ur]:!0,version:Ni,algorithm:Po,namespace:tn,data:u,originalLength:e.length,compressedPayloadLength:u.length,compressionVariant:f.variant};try{m=JSON.stringify(P)}catch(k){console.warn("Unable to serialize compressed storage payload wrapper",k);continue}if(typeof m!="string"||!m)continue;g=m.length}g<e.length&&(!o||g<o.wrappedLength)&&(o={originalLength:e.length,wrappedLength:g,compressedPayloadLength:u.length,compressionVariant:f.variant},i=m,s=y,a=p)}}}if(o&&(!i||typeof i!="string"))if(typeof s!="string"||!s)o=null;else{var A;if(typeof a=="string"&&a)A=a;else if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{A=JSON.stringify(String(o.compressionVariant||""))}catch{A=null}if(typeof A!="string"||!A)o=null;else{var O='{"'.concat(ur,'":true,"version":').concat(String(Ni),',"algorithm":').concat(sm,',"namespace":').concat(am,',"data":').concat(s,',"originalLength":').concat(String(o.originalLength),',"compressedPayloadLength":').concat(String(o.compressedPayloadLength),',"compressionVariant":').concat(A,"}");i=O}}return o&&i&&typeof i=="string"&&i.length<o.originalLength?(o.serialized=i,o.wrappedLength=i.length):o=null,ef(Bc,e,o),o}function Do(e){if(typeof e!="string")return{success:!1};if(!e||e.charCodeAt(0)!==123)return{success:!1};if(!e.includes(`"${ur}":true`)||!e.includes(`"namespace":"${tn}`))return{success:!1};let t;try{t=JSON.parse(e)}catch(o){return{success:!1,error:o}}if(!t||t[ur]!==!0)return{success:!1};if(t.namespace!==tn)return{success:!1};if(t.version!==Ni)return console.warn("Unsupported storage compression version",t.version),{success:!1};if(t.algorithm!==Po&&t.algorithm!==Hc)return console.warn("Unsupported storage compression algorithm",t.algorithm),{success:!1};if(typeof t.data!="string"||!t.data)return{success:!1};if(!Sf())return console.warn("Compressed storage payload detected but compression library is unavailable."),{success:!1};var r=null;typeof t.compressionVariant=="string"&&t.compressionVariant?r=t.compressionVariant:t.algorithm===Hc&&(r="utf16");var n=bf(t.data,hf,r,"storage payload");return n.success?(!t.compressionVariant&&n.variant&&(t.compressionVariant=n.variant),{success:!0,value:n.value,metadata:t}):{success:!1,error:n.error}}function ls(e,t){if(typeof e=="string"){const r=Do(e);if(!r.success||typeof r.value!="string")return{restored:!1,value:e};try{return{restored:!0,value:JSON.parse(r.value)}}catch(n){return console.warn("Unable to parse decompressed project entry payload",t||"project entry",n),{restored:!1,value:e}}}if(E(e)&&e[ur]===!0){let r;try{r=JSON.stringify(e)}catch(n){return console.warn("Unable to reserialize compressed project entry wrapper before restoration",t||"project entry",n),{restored:!1,value:e}}if(typeof r=="string"&&r)return ls(r,t)}return{restored:!1,value:e}}function us(e,t){if(typeof e!="string")return;const r=typeof t=="number"&&Number.isFinite(t)?t:Date.now(),n=Be(e);if(n){Rr.set(n,r),n!==e&&Rr.set(e,r);return}Rr.set(e,r)}function gm(e,t){if(!e||typeof e!="object")return;const r=Date.now();Object.keys(e).forEach(n=>{typeof n!="string"||!n||Kt(n)||us(n,r)})}function Zs(e){if(typeof e!="string")return;const t=Be(e);Rr.delete(e),t&&t!==e&&Rr.delete(t)}function mm(e){if(typeof e!="string")return"";const t=Be(e);return typeof t=="string"&&t?t:""}function hm(e){if(!_s||typeof _s.has!="function")return!1;const t=mm(e);if(!t)return!1;try{return _s.has(t)}catch{}return!1}function bm(e,t){const r=ls(e,t);return r.restored?r.value:e}function Sm(e){return E(e)&&Object.keys(e).forEach(t=>{e[t]=bm(e[t],t)}),e}function wm(e){if(!e||typeof e.add!="function")return;const t=[pe,`${pe}${he}`,pt,`${pt}${he}`];for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&e.add(n)}}function Em(e){if(!e||typeof e.add!="function")return;const t=[tt,Mt,ct,Ze];for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n!="string"||!n)continue;const o=kt(n);for(let i=0;i<o.length;i+=1){const s=o[i];typeof s!="string"||!s||(e.add(s),e.add(`${s}${he}`))}}}function sn(e,t){if(typeof e!="string")return e;const r=Do(e);return r.success?r.value:e}function wf(e,t){if(!e||typeof e.length!="number"||typeof e.key!="function")return{success:!1,compressed:0,freed:0};if(If(e))return{success:!1,compressed:0,freed:0};const{skipKeys:r=[],limit:n=cm,minSavings:o=lm}=t||{},i=new Set;if(zt&&er&&i.add(er),zt&&wm(i),Em(i),Array.isArray(r))for(let y=0;y<r.length;y+=1){const p=r[y];typeof p=="string"&&p&&i.add(p)}const s=typeof o=="number"&&o>0?o:0,a=e.length,c=[];for(let y=0;y<a;y+=1){let p;try{p=e.key(y)}catch{p=null}if(typeof p!="string"||!p||i.has(p))continue;let d;try{d=e.getItem(p)}catch{continue}if(typeof d!="string"||!d||d.includes(`"${ur}":true`))continue;const m=Nn(d);if(!m||typeof m.serialized!="string"||!m.serialized)continue;const g=typeof m.originalLength=="number"&&typeof m.wrappedLength=="number"?m.originalLength-m.wrappedLength:0;g<s||c.push({key:p,serialized:m.serialized,savings:g>0?g:0,originalLength:typeof m.originalLength=="number"?m.originalLength:0})}if(!c.length)return{success:!1,compressed:0,freed:0};c.sort((y,p)=>p.savings!==y.savings?p.savings-y.savings:p.originalLength-y.originalLength);const l=typeof n=="number"&&n>0?Math.min(n,c.length):c.length;let f=0,u=0;for(let y=0;y<c.length&&f<l;y+=1){const p=c[y];if(!(!p||typeof p.serialized!="string"||!p.serialized))try{e.setItem(p.key,p.serialized),f+=1,u+=p.savings}catch{}}return f===0?{success:!1,compressed:0,freed:0}:(typeof console<"u"&&typeof console.warn=="function"&&(u>0?console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery, freeing approximately ${u} characters.`):console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery.`)),{success:!0,compressed:f,freed:u})}function tr(e){return e==null?e:sn(e)}function Wc(e){if(!e||typeof e.getItem!="function"||ln&&typeof ln.has=="function"&&ln.has(e))return;const t=e.getItem,r=typeof t=="function"?function(i){return t.call(this,i)}:null,n=function(i){const s=r?r.call(this,i):void 0;return sn(s)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(o){const i=o&&typeof o.message=="string"&&o.message.includes("Cannot redefine property");i||console.warn("Unable to redefine storage.getItem descriptor for compression support",o);try{e.getItem=n}catch(s){const a=s&&typeof s.message=="string"&&s.message.includes("Cannot assign to read only property");return a||console.warn("Unable to patch storage instance getItem for compression support",s),void 0}}if(r)try{Object.defineProperty(e,Tr,{configurable:!0,writable:!0,value:r})}catch{try{e[Tr]=r}catch{}}if(ln&&typeof ln.add=="function")try{ln.add(e)}catch{}}function Am(){if(typeof Storage>"u"){const i=[];h&&typeof h=="object"&&(h.localStorage&&i.push(h.localStorage),h.sessionStorage&&i.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&i.push(global.localStorage),global.sessionStorage&&i.push(global.sessionStorage)),i.forEach(Wc);return}const e=Storage.prototype;if(!e||typeof e.getItem!="function"||e.__cineStorageCompressionPatched)return;const t=e.getItem,r=function(s){return t.call(this,s)},n=function(s){const a=r.call(this,s);return sn(a)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(i){console.warn("Unable to patch Storage.getItem for compression support",i);return}try{Object.defineProperty(e,Tr,{configurable:!0,writable:!1,value:r})}catch{try{e[Tr]=r}catch{}}try{Object.defineProperty(e,"__cineStorageCompressionPatched",{configurable:!0,writable:!1,value:!0})}catch{e.__cineStorageCompressionPatched=!0}const o=[];h&&typeof h=="object"&&(h.localStorage&&o.push(h.localStorage),h.sessionStorage&&o.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&o.push(global.localStorage),global.sessionStorage&&o.push(global.sessionStorage)),o.forEach(Wc)}function Wa(e){if(!e||typeof e!="object")return null;const t=e[Tr];if(typeof t=="function")return t;const r=Object.getPrototypeOf(e);return r&&typeof r[Tr]=="function"?r[Tr]:null}function io(e,t,r){if(!e||typeof t!="string"||!t)return null;const n=typeof r=="function"?r:Wa(e);if(typeof n!="function")return null;try{return n.call(e,t)}catch{return null}}function Om(e,t){if(!e)return[];let r;try{r=Ya(e,{suppressAlerts:!0})}catch(n){return console.warn("Unable to inspect storage while preparing migration backup cleanup",n),[]}return!r||typeof r!="object"?[]:Object.keys(r).filter(n=>!(typeof n!="string"||!n||!n.endsWith(on)||t&&n===t)).map(n=>{const o=r[n],i=typeof o=="string"?o:o==null?"":String(o),s=ym(i);return{key:n,createdAt:s.createdAt,size:s.size}}).sort((n,o)=>n.createdAt&&o.createdAt&&n.createdAt!==o.createdAt?n.createdAt-o.createdAt:n.createdAt&&!o.createdAt?-1:!n.createdAt&&o.createdAt?1:n.size!==o.size?o.size-n.size:n.key.localeCompare(o.key))}function Ef(e,t){const r=Om(e,t);if(!r.length)return[];const n=[],o=r[0];try{e.removeItem(o.key),n.push(o.key)}catch(i){console.warn(`Unable to remove migration backup ${o.key} during cleanup`,i)}return n}function Yc(e,t,r,n){if(!e||typeof e.setItem!="function")return{success:!1,error:null};const o=[];let i=null;if(typeof n!="function")return{success:!1,error:null};const s=()=>{const a=n();return a&&typeof a=="object"&&"error"in a&&a.error&&(i=a.error),a&&a.success?{success:!0,quota:!1}:a&&a.quota?{success:!1,quota:!0,error:a.error||null}:{success:!1,quota:!1,error:a&&a.error?a.error:null}};if(typeof rn=="function"){let a=!1;try{rn(),a=!0}catch(c){console.warn("Unable to clear cached UI storage entries before creating migration backup",c)}if(a){const c=s();if(c.success)return console.warn(`Cleared cached planner data to free storage before creating migration backup for ${t}.`),{success:!0,error:null};if(!c.quota)return{success:!1,error:c.error}}}for(let a=0;a<im;a+=1){const c=Ef(e,r);if(!c.length)break;o.push(...c);const l=s();if(l.success)return console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} to free up storage before creating migration backup for ${t}.`,o),{success:!0,error:null};if(!l.quota)return{success:!1,error:l.error}}return o.length>0&&console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} while attempting to create migration backup for ${t}, but storage quota is still exceeded.`,o),{success:!1,error:i}}function qe(e,t){if(!e||typeof e.getItem!="function"||!t)return null;let r=null;try{r=e.getItem(t)}catch(i){return console.warn(`Unable to inspect existing value for ${t} before creating migration backup`,i),null}if(r==null)return null;let n=r,o=r;if(typeof r=="string"&&r)if(o=sn(r),typeof o=="string"&&o)try{n=JSON.parse(o)}catch{}else n=o;return n&&typeof n=="object"&&(Array.isArray(n)&&n.length===0||!Array.isArray(n)&&Object.keys(n).length===0)||yt(e,t,n),n}var Jc=["payload","value","content","entries","snapshot","state","record"],Gi=["iso","timestamp","time"];function Xo(e){try{return JSON.stringify(e)}catch(t){return console.warn("Unable to serialize normalized migration backup payload",t),null}}function Qc(e,t){const r=typeof t=="string"&&t?t:null;if(typeof e=="string"){const o=e.trim();if(!o)return{value:r||new Date().toISOString(),changed:!0};const i=Number(o);if(!Number.isNaN(i)&&Number.isFinite(i)&&String(i)===o)try{return{value:new Date(i).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}const s=Date.parse(o);if(!Number.isNaN(s))try{const a=new Date(s).toISOString();return{value:a,changed:a!==o}}catch{return{value:r||new Date().toISOString(),changed:!0}}return{value:o,changed:o!==e}}if(typeof e=="number"&&Number.isFinite(e))try{return{value:new Date(e).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}if(e instanceof Date){const o=e.getTime();if(Number.isFinite(o))try{return{value:e.toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}}return r?{value:r,changed:!0}:{value:new Date().toISOString(),changed:!0}}function Cm(e,t){if(typeof e!="string"||!e)return null;const r=typeof t=="string"&&t?t:new Date().toISOString();let n;try{n=JSON.parse(e)}catch{return Xo({createdAt:r,data:e})}if(!n||typeof n!="object")return Xo({createdAt:r,data:n===void 0?e:n});if(Array.isArray(n)){let f=!1;const u=n.map(y=>{if(!y||typeof y!="object")return f=!0,{createdAt:r,data:y};const p=Object.prototype.hasOwnProperty.call(y,"data"),d=y.createdAt,{value:m,changed:g}=Qc(d,r);return p?g||d!==m?(f=!0,{...y,createdAt:m}):y:(f=!0,{createdAt:m,data:y})});return f?Xo(u):null}let o,i=!1;if(Object.prototype.hasOwnProperty.call(n,"data"))o={...n};else{let f=null;for(let u=0;u<Jc.length;u+=1){const y=Jc[u];if(Object.prototype.hasOwnProperty.call(n,y)){f=y;break}}f?(o={...n},o.data=n[f],delete o[f],i=!0):(o={data:n},i=!0)}let s=o.createdAt,a="createdAt";if(s===void 0)for(let f=0;f<Gi.length;f+=1){const u=Gi[f];if(Object.prototype.hasOwnProperty.call(n,u)){s=n[u],a=u;break}}const{value:c,changed:l}=Qc(s,r);return o.createdAt=c,a!=="createdAt"&&a&&Object.prototype.hasOwnProperty.call(o,a)&&(delete o[a],i=!0),l&&(i=!0),i?Xo(o):null}function Pm(e,t,r,n){const o=Cm(r,n);if(o===null)return!0;if(typeof o!="string"||!o)return!1;if(o===r)return!0;try{return e.setItem(t,o),!0}catch(i){return console.warn(`Unable to normalize legacy migration backup for ${t}`,i),!1}}function yt(e,t,r){if(!e||typeof e.setItem!="function"||r==null)return;const n=`${t}${on}`;let o=!1;if(typeof e.getItem=="function")try{const d=e.getItem(n);if(d!=null){o=!0;const m=new Date().toISOString();Pm(e,n,d,m)}}catch(d){console.warn(`Unable to inspect migration backup for ${t}`,d)}if(o)try{const d=e.getItem(n),m=tr(d);let g=null;try{g=JSON.parse(m)}catch(_){g=m}let b=Array.isArray(g)?g:[g];const P={createdAt:new Date().toISOString(),data:r};b.push(P);const A=5;b.length>A&&(b=b.slice(b.length-A));const O=_=>{try{return e.setItem(n,JSON.stringify(_)),{success:!0}}catch(I){return{success:!1,quota:Rt(I),error:I}}};let k=O(b);for(;!k.success&&k.quota&&b.length>1;)b.shift(),console.warn(`Pruning oldest migration backup for ${t} due to quota limit.`),k=O(b);if(k.success)return;if(!k.success&&k.quota){const _=Yc(e,t,n,()=>O(b));if(_&&_.success)return}console.warn("Unable to append to migration backup",k.error);return}catch(d){console.warn("Unable to append to migration backup",d);return}let i;const s=new Date().toISOString();try{i=JSON.stringify({createdAt:s,data:r})}catch(d){console.warn(`Unable to serialize migration backup for ${t}`,d);return}const a=(d,m={})=>{const{logCompression:g=!1,info:b=null}=m||{};try{if(e.setItem(n,d.serialized),g&&b&&!a.compressionLogged){a.compressionLogged=!0;const P=typeof b.serializedLength=="number"?b.serializedLength:b.compressedSize,A=b.originalSize-P,O=A>0?A:0,k=b.originalSize>0?Math.round(O/b.originalSize*100):0,_=`Stored compressed migration backup for ${t} to reduce storage usage by ${O} characters (${k}%) using ${b.variant||"unknown"} variant.`;ss("migration-backup",t,_,O,k)}return{success:!0,quota:!1}}catch(P){return{success:!1,quota:Rt(P),error:P}}};a.compressionLogged=a.compressionLogged||!1;const c={serialized:i},l=a(c);if(l.success)return;const f=d=>{console.warn(`Unable to create migration backup for ${t}`,d)};if(!l.quota){f(l.error);return}const y=!df(t)?dm(i,s):null,p=(d,m,g)=>{const b=Yc(e,t,n,()=>a(d,m));if(b&&b.success)return!0;const P=b&&b.error?b.error:g;return f(P),ce("migration-backup-quota"),!1};if(y){const d=a(y,{logCompression:!0,info:y});if(d.success)return;if(!d.quota){f(d.error);return}return p(y,{logCompression:!0,info:y},d.error),void 0}p(c,{},l.error)}var Xc=[Ze,pt,Xt,Lr,pe,et,dt,Gr,nn,ut,xt,Ot,Qe,lr,Ft,Ut,Fe],Zc=[rt,en(),"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",Nt,lt],On="__cameraPowerPlannerStorageAlertShown",di="__cameraPowerPlannerSessionFallbackAlertShown",yi=!1;h&&(typeof h[On]=="boolean"?yi=h[On]:h[On]=!1);var ea=!1;h&&(typeof h[di]=="boolean"?ea=h[di]:h[di]=!1);var km=["cameras","monitors","video","viewfinders","directorMonitors","iosVideo","videoAssist","media","lenses","batteries","batteryHotswaps","wirelessReceivers"],_m=["motors","handUnits","controllers","distance"],jm=["chargers","cages","powerPlates","cameraSupport","matteboxes","filters","rigging","batteries","cables","videoAssist","media","cardReaders","tripodHeads","tripods","sliders","cameraStabiliser","grip","carts"],Im=()=>typeof navigator<"u"&&navigator&&typeof navigator.storage=="object"?navigator.storage:null,el="__storage_test__",vm=new Set(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"]),Lm=new Set([22,1014]),Rm=new Set([22,1014]);function Rt(e){return!e||typeof e!="object"?!1:!!(typeof e.code=="number"&&Lm.has(e.code)||typeof e.number=="number"&&Rm.has(e.number)||typeof e.name=="string"&&vm.has(e.name))}function Tm(e){if(!e)return!1;try{if(typeof e.length=="number"&&e.length>0)return!0}catch(t){console.warn("Unable to read storage length after quota error",t)}if(typeof e.getItem=="function")try{for(let t=0;t<Xc.length;t+=1){const r=Xc[t],n=kt(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;const s=`${i}${he}`;if(e.getItem(s)!==null)return!0}}for(let t=0;t<Zc.length;t+=1){const r=Zc[t],n=kt(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;if(vt.has(i)){const s=`${i}${he}`;if(e.getItem(s)!==null)return!0}}}}catch(t){console.warn("Unable to inspect known storage keys after quota error",t)}if(typeof e.key=="function")try{const t=typeof e.length=="number"?e.length:0;for(let r=0;r<t;r+=1){const n=e.key(r);if(typeof n=="string"&&n)return!0}}catch(t){console.warn("Unable to iterate storage keys after quota error",t)}return!1}function zi(e){if(!e)return null;try{e.setItem(el,"1")}catch(t){if(Rt(t)&&Tm(e))return console.warn("localStorage quota exceeded. Existing planner data will remain available but new saves may fail.",t),e;throw t}try{e.removeItem(el)}catch(t){console.warn("Unable to clean up storage test key",t)}return e}function Af(){let e={};return{get length(){return Object.keys(e).length},key(t){const r=Object.keys(e);return t>=0&&t<r.length?r[t]:null},getItem(t){return Object.prototype.hasOwnProperty.call(e,t)?sn(e[t]):null},setItem(t,r){e[t]=String(r)},removeItem(t){delete e[t]},clear(){e={}},keys(){return Object.keys(e)}}}function Of(){const e=$u();for(let t=0;t<e.length;t+=1){const r=e[t];if(r)try{const n=zi(r);if(n)return kr=null,{storage:n,type:"local"}}catch(n){console.warn("localStorage is unavailable:",n),kr=r}}if(typeof window<"u")try{if("sessionStorage"in window){const t=zi(window.sessionStorage);if(t)return qr(t),console.warn("Falling back to sessionStorage; data persists for this tab only."),jf(),{storage:t,type:"session"}}}catch(t){console.warn("sessionStorage fallback is unavailable:",t)}return ce(),{storage:Af(),type:"memory"}}var kr=null,U=Of();function Mm(e,t){const r=[],n=[];return!e||!t||typeof t.setItem!="function"?{migratedKeys:r,failedKeys:n}:(Object.keys(e).forEach(o=>{const i=e[o];if(i==null)return;let s=null,a=!1;try{s=t.getItem(o),a=!0}catch(c){console.warn("Unable to inspect localStorage during upgrade",o,c)}if(a&&s!==null&&s!==void 0&&s!==i&&yt(t,o,s),a&&s===i){r.push(o);return}try{t.setItem(o,i),r.push(o)}catch(c){console.warn("Unable to migrate storage key during upgrade",o,c),n.push(o)}}),{migratedKeys:r,failedKeys:n})}function Nm(e,t,r){if(!e||!t||typeof t.removeItem!="function")return;(Array.isArray(r)&&r.length>0?r:Object.keys(e)).forEach(o=>{try{t.removeItem(o)}catch(i){console.warn("Unable to remove migrated storage key from fallback",o,i)}})}function Gm(e,t){!e||typeof e.removeItem!="function"||!Array.isArray(t)||t.forEach(r=>{try{e.removeItem(r)}catch(n){console.warn("Unable to roll back migrated storage key after upgrade failure",r,n)}})}function Ya(e,t={}){const r=Object.create(null);if(!e)return r;const{suppressAlerts:n=!1}=t||{},o=i=>{if(typeof i!="string"||!i)return;let s;try{typeof e.getItem=="function"?s=e.getItem(i):Object.prototype.hasOwnProperty.call(e,i)&&(s=e[i])}catch(a){console.warn("Unable to read storage key during snapshot",i,a),n||ce("migration-read");return}s!=null&&(r[i]=String(s))};if(typeof e.key=="function"&&typeof e.length=="number"){for(let i=0;i<e.length;i+=1)o(e.key(i));return r}if(typeof e.keys=="function"){try{const i=e.keys();Array.isArray(i)&&i.forEach(o)}catch(i){console.warn("Unable to enumerate storage keys during snapshot",i),n||ce("migration-read")}return r}if(typeof e.forEach=="function"){try{e.forEach((i,s)=>{typeof s=="string"&&i!=null&&(r[s]=String(i))})}catch(i){console.warn("Unable to iterate storage entries during snapshot",i),n||ce("migration-read")}return r}return Object.keys(e).forEach(o),r}function Cf(){if(!(!h||typeof h!="object"))try{Object.defineProperty(h,"SAFE_LOCAL_STORAGE",{configurable:!0,get:T});return}catch{try{h.SAFE_LOCAL_STORAGE=T();return}catch(t){console.warn("Unable to refresh SAFE_LOCAL_STORAGE global reference",t)}}}function be(e,t,r){if(!U||U.type==="memory")return;const n=U.storage;if(!n||r&&r!==n)return;let o=Object.create(null);try{o=Ya(n,{suppressAlerts:!0})}catch(c){console.warn("Unable to capture storage snapshot during downgrade",c)}let i=null,s="memory";if(U.type!=="session"){const c=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let l=0;l<c.length;l+=1){const f=Da(c[l]);if(!(!f||f===n||r&&f===r))try{const u=zi(f);if(u){i=u,s="session",qr(u);break}}catch(u){console.warn("Unable to activate sessionStorage fallback during downgrade",u)}}}i||(i=Af()),Object.keys(o).forEach(c=>{const l=o[c];if(l!=null)try{typeof i.setItem=="function"?i.setItem(c,l):i[c]=l}catch(f){console.warn(`Unable to copy storage entry to ${s==="session"?"sessionStorage":"memory"} during downgrade`,c,f)}}),U={storage:i,type:s},kr=null;const a=s==="session"?"sessionStorage":"in-memory fallback";console.warn(e?`Downgraded planner storage to ${a} after ${e} errors.`:`Downgraded planner storage to ${a} after storage errors.`,t),s==="session"&&jf(),Cf()}function zm(){if(!U||U.type==="local")return U.storage;const e=$u(),t=U.storage;let r=null,n=null;for(let a=0;a<e.length;a+=1){const c=e[a];if(!c||c===t||c===kr)continue;let l;try{l=zi(c)}catch(f){console.warn("localStorage upgrade verification failed",f),kr=c;continue}if(!l||l===t){l||(kr=c);continue}r=c,n=l;break}if(!n)return t;const o=Ya(t),{migratedKeys:i,failedKeys:s}=Mm(o,n);return s.length>0?(Gm(n,i),console.warn("Aborting localStorage upgrade because some entries could not be migrated. Continuing to use fallback storage.",s),ce("migration-write"),kr=r||n,t):(Nm(o,t,i),U={storage:n,type:"local"},kr=null,n)}function T(){if(C&&C.driver&&C.driver.storage)return C.driver.storage;(!U||!U.storage)&&(U=Of(),typeof console<"u"&&console.log&&console.log("DEBUG: storage initialized with type:",U.type)),U.type!=="local"&&zm();const e=U.storage;return console.log("DEBUG: getSafeLocalStorage returning",e&&"object"),e}Cf();Am();var Zn=null;function Pf(){const e=Im();if(!(e&&typeof e.persist=="function"))return Promise.resolve({supported:!1,granted:!1,alreadyGranted:!1});if(Zn)return Zn;const n=(async()=>{let o=!1;const i=typeof e.persisted=="function";if(i)try{o=await e.persisted()}catch(s){console.warn("Unable to determine persistent storage state",s)}if(o)return{supported:!0,granted:!0,alreadyGranted:!0};try{const s=await e.persist();if(!s&&i)try{if(await e.persisted())return{supported:!0,granted:!0,alreadyGranted:!0}}catch(a){console.warn("Unable to verify persistent storage after request",a)}return{supported:!0,granted:s,alreadyGranted:!1}}catch(s){return console.warn("Persistent storage request failed",s),{supported:!0,granted:!1,alreadyGranted:!1,error:s}}})().then(o=>((!o||o.granted!==!0)&&(Zn=null),o),o=>{throw Zn=null,o});return Zn=n,n}typeof window<"u"&&typeof navigator<"u"&&Pf();function E(e){if(e===null||typeof e!="object")return!1;let t;try{t=Object.getPrototypeOf(e)}catch{return!1}if(t===null||t===Object.prototype)return!0;if(Object.getPrototypeOf(t)===null&&typeof t.constructor=="function"){const n=t.constructor.name;return n==="Object"||n===""}return!1}function re(e){if(!e||typeof e!="object")return!1;if(Object.prototype.toString.call(e)==="[object Map]")return!0;if(typeof Map<"u")try{if(e instanceof Map)return!0}catch{}return typeof e.size=="number"&&typeof e.entries=="function"&&typeof e.forEach=="function"&&typeof e.get=="function"&&typeof e.set=="function"}function kf(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(typeof e=="symbol")return e.description||e.toString();if(e&&typeof e=="object")try{const t=JSON.stringify(e);if(t&&t!=="{}")return t}catch{}try{return String(e)}catch{}return null}function ne(e){if(!re(e))return null;const t=Object.create(null),r=(o,i)=>{const s=kf(o);s!=null&&(Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i))};let n=!1;if(typeof e.entries=="function")try{const o=e.entries();if(o&&typeof o.next=="function"){for(let i=o.next();!i.done;i=o.next()){const s=i&&i.value;Array.isArray(s)&&s.length>=2&&r(s[0],s[1])}n=!0}}catch(o){console.warn("Unable to iterate map-like value entries",o)}if(!n&&typeof e.forEach=="function")try{e.forEach((o,i)=>{r(i,o)}),n=!0}catch(o){console.warn("Unable to iterate map-like value via forEach",o)}return!Object.keys(t).length&&!n?null:t}var ko=/^long[\s_-]?gop$/i;function tl(e){if(typeof e!="string")return null;var t=e.trim();if(!t)return null;var r=t.toLowerCase();return r==="utf16"||r==="utf-16"?"utf16":r==="uri-component"||r==="uri_component"||r==="encoded-uri-component"||r==="uri"?"uri-component":r==="base64"?"base64":ko.test(r)?"utf16":null}function rl(e){if(typeof e!="string")return e;const t=e.trim();return ko.test(t)?"long-gop":e}function Bm(e){return typeof e!="string"?e:ko.test(e)?"long-gop":e}function ue(e,t){if(e===null||typeof e!="object")return rl(e);const r=t||new WeakSet;if(r.has(e))return e;if(r.add(e),Array.isArray(e)){let n=!1;const o=e.map(i=>{const s=ue(i,r);return s!==i&&(n=!0),s});return n?o:e}if(E(e)){let n=!1;const o={};return Object.keys(e).forEach(i=>{const s=Bm(i),a=e[i],c=ue(a,r);(s!==i||c!==a)&&(n=!0),o[s]=c}),n?o:e}return rl(e)}function Bi(e){if(!Array.isArray(e))return{normalized:Array.isArray(e)?e:[],changed:!1};let t=!1;return{normalized:e.map(n=>{if(n==null)return n;const o=ue(n);return o!==n&&(t=!0),o}),changed:t}}function Ja(e){if(typeof e!="string")return{timestamp:Number.NEGATIVE_INFINITY,label:""};const t=(r,n={})=>{const i=e.slice(r.length).split("-");if(i.length<5)return null;const[s,a,c,l,f]=i,u=Number.parseInt(s,10),y=Number.parseInt(a,10)-1,p=Number.parseInt(c,10),d=Number.parseInt(l,10),m=Number.parseInt(f,10);if([u,y,p,d,m].some(_=>Number.isNaN(_)))return null;let g=!1,b=0,P=5;if(i.length>P){const _=i[P];if(/^\d{1,2}$/u.test(_))g=!0,b=Number.parseInt(_,10),P+=1;else if(n.requireSeconds)return null}else if(n.requireSeconds)return null;const A=i.slice(P).join("-").trim(),k=new Date(u,y,p,d,m,g?b:0,0).getTime();return Number.isNaN(k)?null:{timestamp:k,label:A}};if(e.startsWith(Ue)){const r=t(Ue);return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}if(e.startsWith(Pt)){const r=t(Pt,{requireSeconds:!1});return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}return{timestamp:Number.NEGATIVE_INFINITY,label:""}}function xi(e,t){return!E(e)||typeof t!="string"?[]:Object.keys(e).filter(r=>typeof r=="string"&&r.startsWith(t)).map(r=>{const{timestamp:n,label:o}=Ja(r);return{key:r,timestamp:n,label:o}}).sort((r,n)=>r.timestamp!==n.timestamp?r.timestamp-n.timestamp:r.key.localeCompare(n.key))}function xm(e){if(!(!e||typeof e!="object")){try{e[Yr]=!0}catch{try{Object.defineProperty(e,Yr,{configurable:!0,enumerable:!0,writable:!0,value:!0})}catch{}}if(E(e.projectInfo))try{e.projectInfo[Yr]=!0}catch{}}}function Fm(e){return!e||typeof e!="object"?!1:!!(e[Yr]===!0||E(e.projectInfo)&&e.projectInfo[Yr]===!0)}function Qa(e,t){return!E(e)||typeof t!="string"?!1:Fm(e[t])}function _f(e){if(!e||typeof e!="object")return"";if(typeof e.label=="string"){const t=e.label.trim();if(t)return t}if(typeof e.key=="string"&&e.key.trim()){const t=e.key.trim();return t.startsWith(Ue)||t.startsWith(Pt)?"__auto-backup:unlabeled__":t}return"__auto-backup:unlabeled__"}function Um(e,t){if(!E(e)||!t||typeof t.key!="string")return"undefined";const r=Object.prototype.hasOwnProperty.call(e,t.key)?e[t.key]:void 0;try{let n=r;if(E(r)&&r[En]){const i=me(r,{stripMetadata:!0}),s=i[En];if(s&&typeof s=="object")try{const a=Xs(s,t.key);s.payload=a.payload,Object.prototype.hasOwnProperty.call(s,"payloadCompression")&&delete s.payloadCompression}catch(a){console.warn("Failed to expand automatic backup payload for signature comparison",t.key,a)}n=i}const o=Qs(n,{stripMetadata:!0});return Pe(o)}catch(n){return console.warn("Failed to create stable signature for automatic backup entry",n),"undefined"}}function Pe(e,t){const r=t||(typeof WeakSet=="function"?{seen:new WeakSet,reportedCycle:!1}:null),n=r&&r.seen?r.seen:null,o=(i,s)=>{if(!n)return s();if(n.has(i))return!r.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Detected circular reference while computing automatic backup signature. Using a placeholder token to keep backups stable."),r.reportedCycle=!0,lf;n.add(i);try{return s()}finally{n.delete(i)}};if(e===null)return"null";if(e===void 0)return"undefined";if(Array.isArray(e))return o(e,()=>{let i="[";for(let s=0;s<e.length;s+=1)s>0&&(i+=","),i+=Pe(e[s],r);return i+="]",i});if(e instanceof Date)return o(e,()=>{const i=e.getTime();return Number.isNaN(i)?"date:invalid":`date:${i}`});if(E(e))return o(e,()=>{const i=Object.keys(e).sort();let s="{";for(let a=0;a<i.length;a+=1){const c=i[a];a>0&&(s+=","),s+=`${JSON.stringify(c)}:${Pe(e[c],r)}`}return s+="}",s});if(e&&typeof e=="object")return o(e,()=>`${typeof e}:${String(e)}`);if(typeof e=="number")return Number.isNaN(e)?"number:NaN":Number.isFinite(e)?`number:${e}`:e>0?"number:Infinity":"number:-Infinity";if(typeof e=="bigint")return`bigint:${e.toString()}`;if(typeof e=="boolean")return e?"boolean:true":"boolean:false";if(typeof e=="string"){const i=Do(e);if(i.success&&typeof i.value=="string")try{const s=JSON.parse(i.value);return Pe(s,r)}catch(s){console.warn("Unable to decode compressed string while computing stable value signature",s)}return`string:${e}`}return typeof e=="symbol"?`symbol:${String(e)}`:typeof e=="function"?`function:${e.name||"anonymous"}`:`${typeof e}:${String(e)}`}function ta(e,t){if(!E(e)||!Array.isArray(t)||t.length<2)return null;const r=new Map;for(let n=t.length-1;n>=0;n-=1){const o=t[n];if(!o||typeof o.key!="string"||Qa(e,o.key))continue;const i=_f(o);let s=r.get(i);s||(s=new Map,r.set(i,s));const a=Object.prototype.hasOwnProperty.call(e,o.key)?e[o.key]:void 0,c=Pe(a),l=s.get(c);if(l&&typeof l.key=="string")return delete e[o.key],t.splice(n,1),typeof console<"u"&&typeof console.info=="function"&&console.info("Removed duplicate automatic backup while preserving newer copy.",{removedKey:o.key,preservedKey:l.key,label:i}),o.key;s.set(c,{key:o.key,signature:c})}return null}function nl(e,t){const r=[];for(;;){const n=ta(e,t);if(!n)break;r.push(n)}return r}function ol(e,t,r,n){if(!E(e)||!Array.isArray(t)||t.length<=r)return;const o=new Map;for(let s=0;s<t.length;s+=1){const a=t[s];if(!a||typeof a.key!="string")continue;const c=_f(a),l=Um(e,a),f=`${c}__${l}`,u=o.get(f);u?u.push(s):o.set(f,[s])}const i=Array.from(o.values()).filter(s=>Array.isArray(s)&&s.length>1).flatMap(s=>s.slice(0,-1)).sort((s,a)=>s-a);if(!i.length){t.length>r&&console.warn("Skipped trimming automatic backups because all remaining versions are unique.",{limit:r,total:t.length});return}for(let s=i.length-1;s>=0&&t.length>r;s-=1){const a=i[s],c=t[a];!c||typeof c.key!="string"||Qa(e,c.key)||(delete e[c.key],t.splice(a,1),n.push(c.key))}t.length>r&&console.warn("Unable to trim automatic backups down to the configured limit without losing unique data.",{limit:r,remaining:t.length})}function Xa(e){if(!E(e))return[];const t=[],r=xi(e,Ue);t.push(...nl(e,r)),r.length>gn&&ol(e,r,gn,t);const n=xi(e,Pt);return t.push(...nl(e,n)),n.length>$c&&ol(e,n,$c,t),t.length>0&&console.warn(`Removed ${t.length} older automatic backup${t.length>1?"s":""} to stay within storage limits.`,t),t}function ra(e,t={}){if(!E(e))return null;const{force:r=!1}=t,n=(f,{respectRename:u=!0}={})=>{if(!Array.isArray(f)||f.length===0)return null;for(let y=0;y<f.length;y+=1){const p=f[y];if(!p||typeof p.key!="string")continue;const d=Object.prototype.hasOwnProperty.call(e,p.key),m=d?e[p.key]:void 0;if(!d||m===void 0||m===null||typeof m!="object")return delete e[p.key],p.key;if(!(u&&Qa(e,p.key)))return delete e[p.key],p.key}return null},o=xi(e,Ue),i=ta(e,o);if(i)return i;const s=xi(e,Pt),a=ta(e,s);if(a)return a;const c=n(s,{respectRename:!1});if(c)return c;s.length>0&&console.warn("Unable to free space by removing pre-deletion backups because all copies appear to be protected.");const l=n(o,{respectRename:!r});return l||(o.length>0&&console.warn("Unable to free space by removing automatic backups because the remaining copies were renamed or protected."),null)}function Dm(e){if(!e||typeof e!="object")return"";if(typeof e.note=="string"){const t=e.note.trim();if(t)return t}if(typeof e.createdAt=="string"){const t=e.createdAt.trim();if(t)return t}return typeof e.id=="string"?e.id:""}function na(e){if(!Array.isArray(e)||e.length===0)return null;const t=r=>{const[n]=e.splice(r,1);return{removed:n,label:Dm(n)}};for(let r=e.length-1;r>=0;r-=1){const n=e[r];if(!n||typeof n!="object"||!Array.isArray(n.rules))return t(r)}return t(e.length-1)}function Km(e){if(!e||typeof e.getItem!="function"||typeof e.removeItem!="function")return!1;const t=`${ut}${on}`,r=[];try{const n=e.getItem(t);n!=null&&(e.removeItem(t),r.push(t))}catch(n){console.warn("Unable to inspect automatic gear backup migration snapshot while recovering storage quota.",n)}try{const n=Ef(e,t);Array.isArray(n)&&n.length>0&&r.push(...n)}catch(n){console.warn("Unable to prune migration backups while recovering storage for automatic gear backups.",n)}return r.length>0?(console.warn(`Removed ${r.length} migration backup${r.length>1?"s":""} while freeing storage for automatic gear backups.`,r),!0):!1}function oa(){if(typeof rn!="function")return!1;try{return rn(),console.warn("Cleared cached planner data to free up storage space before saving automatic gear backups."),!0}catch(e){console.warn("Unable to clear cached planner data while recovering storage for automatic gear backups.",e)}return!1}function $m(e){return e?!(e==="migration-read"&&typeof U<"u"&&U&&U.type&&U.type!=="memory"):!0}function ce(e){if(!$m(e)||(h&&typeof h[On]=="boolean"&&(yi=h[On]),yi)||(yi=!0,h&&(h[On]=!0),typeof window>"u"||typeof window.alert!="function"))return;let t="Storage error: Unable to access local data. Changes may not be saved.";try{if(typeof window<"u"&&window.texts){const r=window.texts,n=window.currentLang||"en",o=r[n]?n:"en";t=r[o]?.alertStorageError||t}}catch{}window.alert(t)}function jf(){if(ea||(ea=!0,h&&(h[di]=!0),typeof window>"u"||typeof window.alert!="function"))return;let e="Warning: Local storage is unavailable. Data will only persist for this browser tab.";try{if(typeof window<"u"&&window.texts){const t=window.texts,r=window.currentLang||"en",n=t[r]?r:"en";e=t[n]?.alertSessionFallback||e}}catch{}window.alert(e)}function Fi(e){if(typeof window>"u")return null;try{return window[e]}catch(t){return console.warn(`Unable to access ${e} during legacy migration`,t),null}}function ia(e){if(!Array.isArray(e)||e.length===0)return[];const t=[],r=new Set;for(let n=0;n<e.length;n+=1){const o=e[n];!o||typeof o.getItem!="function"||r.has(o)||(r.add(o),t.push(o))}return t}function Vm(e,t,r,n,o={}){if(!e||typeof e.getItem!="function")return!1;const{keepLegacy:i=!1}=o;let s;try{s=e.getItem(r)}catch(c){return console.warn(`Unable to read legacy storage key ${r}`,c),ce("migration-read"),!1}if(s==null)return!1;const a=t&&typeof t.setItem=="function"?t:e;try{const c=a.getItem(n);if(c!=null){if(!i&&(e!==a||r!==n))try{e.removeItem(r)}catch(l){console.warn(`Unable to remove legacy storage key ${r}`,l)}return!1}}catch(c){console.warn(`Unable to inspect destination storage for ${n}`,c)}try{a.setItem(n,s)}catch(c){return console.warn(`Unable to migrate legacy storage key ${r}`,c),!1}if(!i)try{e.removeItem(r)}catch(c){console.warn(`Unable to remove legacy storage key ${r} after migration`,c)}return!0}function Zo(e,t,r,n,o){let i=!1;for(let s=0;s<e.length;s+=1)Vm(e[s],t,r,n,o)&&(i=!0);return i}function Hm(){const e=T(),t=ia([Fi("localStorage"),e]),r=ia([Fi("sessionStorage"),typeof sessionStorage<"u"?sessionStorage:null]),n="cinePowerPlanner_";[{legacy:`${n}devices`,modern:Ze},{legacy:`${n}setups`,modern:pt},{legacy:`${n}session`,modern:Xt,includeSession:!0},{legacy:`${n}feedback`,modern:Lr},{legacy:`${n}project`,modern:pe},{legacy:`${n}projects`,modern:pe},{legacy:`${n}favorites`,modern:et},{legacy:`${n}ownGear`,modern:Mt},{legacy:`${n}schemaCache`,modern:dt},{legacy:`${n}autoGearRules`,modern:Gr},{legacy:`${n}autoGearBackups`,modern:ut},{legacy:`${n}autoGearSeeded`,modern:nn},{legacy:`${n}autoGearPresets`,modern:xt},{legacy:`${n}autoGearActivePreset`,modern:Ot},{legacy:`${n}autoGearAutoPreset`,modern:Qe},{legacy:`${n}autoGearShowBackups`,modern:lr},{legacy:`${n}autoGearBackupRetention`,modern:Ut},{legacy:`${n}autoGearMonitorDefaults`,modern:Ft},{legacy:`${n}customFonts`,modern:Zt,updateFontKey:!0}].forEach(({legacy:i,modern:s,includeSession:a=!1,updateFontKey:c=!1})=>{const l=Zo(t,e,i,s);Zo(t,e,`${i}${he}`,`${s}${he}`),a&&(Zo(r,null,i,s),Zo(r,null,`${i}${he}`,`${s}${he}`)),c&&l&&h&&(h.CUSTOM_FONT_STORAGE_KEY===i&&(h.CUSTOM_FONT_STORAGE_KEY=s),h.CUSTOM_FONT_STORAGE_KEY_NAME===i&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=s))})}function ke(){Hm()}function If(e){if(!e||typeof e.getItem!="function")return!1;if(wn&&typeof wn.has=="function"&&wn.has(e))return!0;if(U&&U.type==="session"&&U.storage===e)return qr(e),!0;const t=T();if(t&&U&&U.type==="session"&&t===e)return qr(e),!0;const r=[h,h&&h.__cineGlobal?h.__cineGlobal:null,h&&h.window?h.window:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let n=0;n<r.length;n+=1){const o=Da(r[n]);if(o&&o===e)return qr(o),!0}return!1}function Me(e,t,r,n=null,o={}){if(!e)return n;const{disableBackup:i=!1,backupKey:s,validate:a,restoreIfMissing:c=!1,alertOnFailure:l=null,migrationBackupKey:f}=o||{},u=typeof s=="string"&&s?s:`${t}${he}`,y=!i&&u&&u!==t,p=Vu()||h&&h.__cineJustFactoryReset,d=y&&!p,m=!p,g=(()=>{const M=new Set,G=[],N=$=>{typeof $!="string"||!$||M.has($)||(M.add($),G.push($))};typeof f=="string"&&f&&N(f);const z=kt(t);for(let $=0;$<z.length;$+=1)N(`${z[$]}${on}`);return G})(),b=Wa(e);let P=typeof b=="function"?io(e,t,b):void 0,A=!1;const O=(M,G)=>{if(M==null)return{ok:!1,reason:"missing"};const N=typeof M=="string"?sn(M):M;if(typeof M=="string"&&M&&N===M&&M.includes(`"${ur}":true`)&&M.includes(`"namespace":"${tn}`))return console.warn(`${r} Compressed value could not be decoded${G?` (${G})`:""}.`),A=!0,{ok:!1,reason:"compressed"};try{const z=JSON.parse(N);return typeof a=="function"&&!a(z)?(console.warn(`${r} Invalid data${G?` (${G})`:""}.`),A=!0,{ok:!1,reason:"invalid"}):{ok:!0,value:z,raw:M,normalizedRaw:N}}catch(z){return console.error(`${r}${G?` (${G})`:""}`,z),A=!0,{ok:!1,reason:"error"}}};let k=null;try{k=e.getItem(t)}catch(M){console.error(`${r} (read)`,M),be("read access",M,e),A=!0}typeof P>"u"&&typeof b=="function"&&(P=io(e,t,b)),k==null&&P==null&&Qt(e,t);const _=Bg(e,t,k,P);if(_.hit)return _.value;const I=O(k,"");if(I.ok){const M=typeof I.normalizedRaw=="string"&&I.normalizedRaw?I.normalizedRaw:typeof I.raw=="string"&&I.raw?I.raw:null,G=typeof P=="string"&&P?P:typeof I.raw=="string"&&I.raw?I.raw:null;return Ke(e,t,G,M,I.value),I.value}const w=!I.ok&&I.reason==="missing",S=()=>{if(!g.length)return{success:!1,shouldAlert:!1};for(let M=0;M<g.length;M+=1){const G=g[M];let N=null,z;try{N=e.getItem(G)}catch(R){return console.error(`${r} (migration backup read)`,R),be("read access",R,e),{success:!1,shouldAlert:!0}}if(typeof b=="function"&&(z=io(e,G,b)),N==null&&z==null){Qt(e,G);continue}const $=N??z,nt=kn({key:G,value:$,type:"migration-backup"});if(typeof nt>"u")continue;let ye=nt;if(typeof ye=="string"){const R=ye.trim();if(R)try{ye=JSON.parse(R)}catch{}else ye=""}if(typeof a=="function"&&!a(ye)){console.warn(`Ignored migration backup for ${t} because it failed validation.`);continue}Ke(e,G,typeof z=="string"&&z?z:typeof $=="string"&&$?$:null,typeof $=="string"&&$?$:typeof z=="string"&&z?z:null,ye);let ot=null;try{ot=JSON.stringify(ye)}catch(R){console.warn(`Unable to serialize recovered migration backup for ${t}`,R),ot=null}let xr=null,it=!1;if(ot!==null){let R=ot;const K=typeof ot=="string"?Nn(ot):null;K&&typeof K.serialized=="string"&&(R=K.serialized);try{e.setItem(t,R),xr=R}catch(V){console.warn(`Unable to restore primary copy for ${t} from migration backup`,V),be("write access",V,e),it=!0}}else it=!0;xr!==null?Ke(e,t,xr,ot,ye):ot!==null?Ke(e,t,ot,ot,ye):Ke(e,t,null,null,ye),console.warn(xr!==null?`Recovered ${t} from migration backup copy.`:`Recovered ${t} from migration backup copy but could not rewrite the primary entry.`);try{e.removeItem(G),Qt(e,G)}catch(R){console.warn(`Unable to remove migration backup ${G} after recovery`,R)}return{success:!0,value:ye,shouldAlert:it}}return{success:!1,shouldAlert:!1}},v=d&&(A||c||w);if(v){let M=null;try{M=e.getItem(u)}catch(z){console.error(`${r} (backup read)`,z),be("read access",z,e),A=!0}const G=typeof b=="function"?io(e,u,b):void 0,N=O(M,"backup");if(N.ok&&((A||w)&&console.warn(`Recovered ${t} from backup copy.`),N.raw!==null&&N.raw!==void 0)){let z=null;try{if(typeof N.raw=="string"){const nt=typeof N.normalizedRaw=="string"&&N.normalizedRaw?N.normalizedRaw:N.raw,ye=Nn(nt);ye&&typeof ye.serialized=="string"?(e.setItem(t,ye.serialized),z=ye.serialized):nt!==N.raw?(e.setItem(t,nt),z=nt):(e.setItem(t,N.raw),z=N.raw)}else e.setItem(t,N.raw),z=typeof N.raw=="string"?N.raw:null}catch(nt){console.warn(`Unable to restore primary copy for ${t} from backup`,nt),z=null}const $=typeof N.normalizedRaw=="string"&&N.normalizedRaw?N.normalizedRaw:typeof N.raw=="string"&&N.raw?N.raw:null,$t=typeof G=="string"&&G?G:typeof N.raw=="string"&&N.raw?N.raw:null;return Ke(e,u,$t,$,N.value),typeof z=="string"&&z&&Ke(e,t,z,$,N.value),N.value}}const B=m&&g.length>0&&(w||c||A);if(B){const M=S();if(M.success){if(M.shouldAlert&&(A=!0),g.length){const G=g[0].key;try{e.removeItem(G),e[Tr]&&e.removeItem&&e.removeItem(G)}catch(N){console.warn("Post-migration cleanup error:",N)}}return M.value}M.shouldAlert&&(A=!0)}return A&&ce(l),Qt(e,t),w&&!v&&!B&&console.debug(`[Storage] Returning default for ${t} (No primary, no backups found)`),n}function Ae(e,t,r,n,o={}){if(!e){console.warn("DEBUG: saveJSONToStorage NO STORAGE");return}if(Vu()){console.warn("DEBUG: saveJSONToStorage RESET ACTIVE");return}const{disableBackup:i=!1,backupKey:s,onQuotaExceeded:a,enableCompressionSweep:c=!0,disableCompression:l=!1,forceCompressionOnQuota:f=!1}=o||{},u=typeof s=="string"&&s?s:`${t}${he}`,y=!i&&u&&u!==t,p=If(e),d=p||!!l,m=p?!1:f===!0,g=Wa(e),b=R=>io(e,R,g);let P,A=!1,O,k=!1,_=!1,I=!1;const w=()=>{P=void 0,A=!1,O=void 0,k=!1,_=!1,I=!1},S=()=>{if(A)return P;A=!0;try{P=JSON.stringify(r)}catch(R){P=null,console.error(n,R),ce()}return P},v=()=>{if(O!==void 0)return O&&typeof O.serialized=="string"?O.serialized:null;const R=S();if(typeof R!="string"||!R)return O=null,null;const K=Nn(R);return!K||typeof K.serialized!="string"?(O=null,null):(O=K,K.serialized)},B=()=>{if(k){const K=v();if(typeof K=="string")return K;k=!1}const R=S();return typeof R=="string"?R:null},M=({force:R=!1}={})=>{const K=R&&m;if(d&&!K)return _=!0,!1;if(k||_&&!K)return!1;_=!0;const V=S();if(typeof V!="string"||!V)return!1;const _e=v();return typeof _e!="string"||!_e||_e.length>=V.length?!1:(k=!0,!0)},G=()=>{if(!k||!O||I)return;const{originalLength:R,wrappedLength:K}=O;if(typeof R=="number"&&typeof K=="number"&&K<R){const V=R-K,_e=R>0?Math.round(V/R*100):0,te=`Stored compressed value for ${t} to reduce storage usage by ${V} characters (${_e}%).`;ss("storage-value",t,te,V,_e)}I=!0},N=()=>{if(d){_=!0;return}if(k||_)return;const R=S();if(typeof R!="string"||!R||R.length<um)return;const K=v();if(typeof K!="string"||!K)return;const V=R.length-K.length;if(V<fm||(R.length>0?V/R.length:0)<pm)return;const te=b(t);typeof te=="string"&&te===K||(k=!0,_=!0)};let z,$=!1,$t=!1,nt=0,ye=!1,ys=!1;N();const Dn=()=>(nt+=1,nt>Zg?(ye=!0,console.warn(`Exceeded maximum storage recovery attempts while saving ${t}.`),!1):!0),ot=(R,K)=>{if(!R||typeof R.length!="number"||typeof R.key!="function")return{success:!1,freed:0};const{skipKeys:V=[]}=K||{},_e=new Set(V);zt&&er&&_e.add(er);const te=[],Ne=R.length;for(let Ge=0;Ge<Ne;Ge+=1){let se;try{se=R.key(Ge)}catch{continue}if(!(!se||_e.has(se))){if(se.endsWith("__legacyMigrationBackup")){te.push({key:se,priority:1,size:0});continue}if(se.endsWith("__backup")){te.push({key:se,priority:2,size:0});continue}if(se===dt||se===Hu){te.push({key:se,priority:3,size:0});continue}if(se.startsWith(Gt)&&se.includes("auto-backup-")){te.push({key:se,priority:4,size:0});continue}}}if(!te.length)return{success:!1,freed:0};te.sort((Ge,se)=>Ge.priority-se.priority);let xe=0,Vt=0;for(let Ge=0;Ge<te.length;Ge+=1){const se=te[Ge];try{const Ht=R.getItem(se.key),Kn=Ht?Ht.length:0;if(R.removeItem(se.key),Qt(R,se.key),xe+=Kn,Vt+=1,console.warn(`[Storage Cleanup] Removed ${se.key} to free ${Kn} chars.`),xe>5e5)break}catch(Ht){console.warn(`[Storage Cleanup] Failed to remove ${se.key}`,Ht)}}return{success:Vt>0,freed:xe}},xr=(R,K={})=>{if(!Rt(R))return!1;if(typeof a=="function")try{if(a(R,{storage:e,key:t,value:r,...K})===!0)return!0}catch(te){const Ne=K&&K.isBackup?" (backup)":"";console.error(`Error while handling quota exceed for ${t}${Ne}`,te)}if(!ys&&c!==!1){ys=!0;const te=[t];y&&typeof u=="string"&&u&&u!==t&&te.push(u),K&&typeof K.backupKey=="string"&&K.backupKey&&te.push(K.backupKey);const Ne=wf(e,{skipKeys:te});if(Ne&&Ne.success)return!0}const V=[t];y&&typeof u=="string"&&u&&V.push(u);const _e=ot(e,{skipKeys:V});return!!(_e&&_e.success)};let it=0;for(;it<Xg;){it+=1;const R=B();if(typeof R!="string")return;const K=S(),V=typeof K=="string"&&K?K:null;let _e=!1,te,Ne=!1,xe=null,Vt=null,Ge=null;if(typeof e.getItem=="function")try{const oe=e.getItem(t);if(oe===R)_e=!0,Vt=R;else if(k){const Le=b(t);typeof Le=="string"&&(Vt=Le,Le===R&&(_e=!0))}else typeof oe=="string"&&(Vt=oe)}catch(oe){console.warn(`Unable to inspect existing value for ${t}`,oe)}if(y&&typeof e.getItem=="function")try{te=e.getItem(u),Ne=typeof te=="string",Ne&&k?(xe=b(u),typeof xe=="string"&&(Ge=xe)):Ne&&(Ge=te)}catch(oe){console.warn(`Unable to inspect existing backup for ${t}`,oe)}!$&&Ne&&typeof te=="string"&&(z=te,$=!0);const se=(()=>{if(!y)return[];const oe=[];if(k){const Le=S();typeof Le=="string"&&Le&&oe.push({serialized:Le,compressed:!1}),typeof R=="string"&&R&&(!oe.length||oe[oe.length-1].serialized!==R)&&oe.push({serialized:R,compressed:!0})}else typeof R=="string"&&R&&oe.push({serialized:R,compressed:!1});return oe})(),Ht=se.length?se[0]:null,Kn=Ne&&Ht&&typeof Ht.serialized=="string"&&(te===Ht.serialized||typeof xe=="string"&&xe===Ht.serialized);if(_e&&(!y||Kn)){if(V&&(Ke(e,t,k&&typeof Vt=="string"&&Vt?Vt:R,V,r),y&&Ne)){const Le=k&&typeof xe=="string"&&xe?xe:Ge;typeof Le=="string"&&Le&&Ke(e,u,Le,V,r)}return}if(!_e)try{e.setItem(t,R),G(),V&&Ke(e,t,R,V,r)}catch(oe){if(xr(oe)){if(w(),!Dn())break;it>0&&(it-=1);continue}if(!ye&&M({force:m})){if(!Dn())break;it>0&&(it-=1);continue}console.error(n,oe),be("write access",oe,e),ce();return}if(!y)return;if(Kn){if(V&&Ne){const oe=k&&typeof xe=="string"&&xe?xe:Ge;typeof oe=="string"&&oe&&Ke(e,u,oe,V,r)}return}const gc=(()=>{const oe=se.length?se:[{serialized:R,compressed:k}];let Le=null,gs=!1,Vo=null;const mc=dr=>{try{return e.setItem(u,dr.serialized),dr.compressed&&G(),$t=!1,!0}catch(gt){return Le=gt,!1}};for(let dr=0;dr<oe.length;dr+=1){const gt=oe[dr];if(Vo=gt,mc(gt)){if(V){const $n=gt.compressed&&V?V:gt.serialized;Ke(e,u,gt.serialized,$n,r)}return"success"}if(!Rt(Le))break;if(!gs&&Ne)try{if(e.removeItem(u),Qt(e,u),gs=!0,$t=!0,Ne=!1,mc(gt)){if(V){const $n=gt.compressed&&V?V:gt.serialized;Ke(e,u,gt.serialized,$n,r)}return"success"}}catch($n){console.warn(`Unable to remove previous backup for ${t}`,$n)}}if(Rt(Le)&&(xr(Le,{serialized:Vo&&typeof Vo.serialized=="string"?Vo.serialized:R,backupKey:u,isBackup:!0})||!ye&&M({force:m})))return w(),Dn()?"retry":"failure";if(gs&&typeof te=="string")try{e.setItem(u,te),V&&Ke(e,u,te,V,r),$t=!1}catch(dr){console.warn(`Unable to restore previous backup for ${t}`,dr)}return console.warn(`Unable to update backup copy for ${t}`,Le),ce(),"failure"})();if(gc==="success")return;if(gc==="retry"){it>0&&(it-=1);continue}if(ye)break;return}if($&&$t&&typeof z=="string")try{e.setItem(u,z),Qt(e,u)}catch(R){console.warn(`Unable to restore preserved backup for ${t}`,R)}console.error(n,new Error("Unable to save value after multiple attempts.")),ce()}function Ee(e,t,r,n={}){if(!e)return;C&&C.removeItem(t).catch(()=>{});const{disableBackup:o=!1,backupKey:i,disableMigrationCleanup:s=!1}=n||{},a=typeof i=="string"&&i?i:`${t}${he}`,c=!o&&a&&a!==t;Qt(e,t),c&&Qt(e,a),t===pe&&cr();try{e.removeItem(t)}catch(l){console.error(r,l),be("deletion",l,e),ce()}if(c)try{e.removeItem(a)}catch(l){console.error(`${r} (backup)`,l),be("deletion",l,e),ce()}if(!s){const l=`${t}${on}`;try{e.removeItem(l)}catch(f){console.warn(`Unable to remove migration backup for ${t}`,f)}}}var qm=[dt,Hu],ei=new Set;function Wm(){const e=[],t=new Set,r=i=>{!i||typeof i.getItem!="function"||e.push(i)},n=(i,s,a)=>{if(!i||typeof i!="object"&&typeof i!="function")return null;try{return i[s]}catch(c){return a&&!ei.has(a)&&(ei.add(a),console.warn(`Unable to access ${a} while clearing UI caches`,c)),null}},o=(i,s)=>{if(!i||t.has(i))return;t.add(i),r(n(i,"SAFE_LOCAL_STORAGE",`${s}.SAFE_LOCAL_STORAGE`)),r(n(i,"localStorage",`${s}.localStorage`)),r(n(i,"sessionStorage",`${s}.sessionStorage`));const a=n(i,"__cineGlobal",`${s}.__cineGlobal`);a&&a!==i&&o(a,`${s}.__cineGlobal`)};o(typeof globalThis<"u"?globalThis:null,"globalThis"),o(typeof window<"u"?window:null,"window"),o(typeof self<"u"?self:null,"self"),o(typeof global<"u"?global:null,"global"),h&&h.__cineGlobal&&o(h.__cineGlobal,"__cineGlobal"),U&&U.storage&&r(U.storage),typeof T=="function"&&T()&&r(T());try{r(T())}catch(i){ei.has("getSafeLocalStorage")||(ei.add("getSafeLocalStorage"),console.warn("Unable to access safe local storage while clearing UI caches",i))}return r(Fi("localStorage")),r(Fi("sessionStorage")),typeof localStorage<"u"&&r(localStorage),typeof sessionStorage<"u"&&r(sessionStorage),ia(e)}function rn(){const e=Wm();e.length&&qm.forEach(t=>{C&&C.removeItem(t).catch(r=>console.warn("Failed to clear UI cache from repo",r)),!(typeof t!="string"||!t)&&e.forEach(r=>{Ee(r,t,`Failed to clear UI cache entry ${t}`)})})}function vf(e,t,r){if(!e)return!1;try{return e.getItem(t)==="1"}catch(n){return console.error(r,n),be("read access",n,e),ce(),!1}}function Lf(e,t,r,n){if(e)try{r?e.setItem(t,"1"):e.removeItem(t)}catch(o){console.error(n,o),be("write access",o,e),ce()}}function Ym(e,t,r,n,o,i,s,a){const c=Me(e,r,n,null,a);if(c!==null)return c;if(!t)return null;const l={...a||{},alertOnFailure:"migration-read"},f=Me(t,r,o,null,l);return f!==null?(Ae(e,r,f,i),Ee(t,r,s),f):null}function fs(e,t,r){const n=e.trim();let o=n,i=2;const s=r||new Set([...t].map(c=>c.trim().toLowerCase()));let a=n.toLowerCase();for(;s.has(a);)o=`${n} (${i++})`,a=o.toLowerCase();return t.add(o),s.add(a),o}function Jm(e){const t=typeof e=="string"?e.trim():"";if(!t)return"Project-imported";const r=t.match(/^(.*?)-imported(?:-(\d+))?$/i);if(r){const n=typeof r[1]=="string"?r[1].trim():"";return n?`${n}-imported`:"Project-imported"}return t.toLowerCase().endsWith("-imported")?t:`${t}-imported`}function Qm(e){const t=typeof e=="string"?e.trim():"",r=Jm(e);if(!t)return{base:r,initialCandidate:r,suffixStart:2};const n=t.match(/^(.*?)-imported(?:-(\d+))?$/i),o=n&&n[2]?Number(n[2]):NaN,i=Number.isFinite(o)?o+1:2;return n?{base:r,initialCandidate:t,suffixStart:i}:{base:r,initialCandidate:r,suffixStart:2}}function Xm(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=Qm(e);let i=typeof o.initialCandidate=="string"?o.initialCandidate.trim():"";i||(i=o.base||"Project-imported");let s=i.trim().toLowerCase(),a=o.suffixStart;for(;s&&n.has(s);)i=`${o.base||"Project-imported"}-${a++}`,s=i.trim().toLowerCase();return t.add(i),s&&n.add(s),i}function Zm(e){const t=typeof e=="string"?e.trim():"";return t?t.toLowerCase().endsWith("-updated")?t:`${t}-updated`:"Project-updated"}function eo(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=Zm(e);let i=o,s=2,a=i.trim().toLowerCase();for(;a&&n.has(a);)i=`${o}-${s++}`,a=i.trim().toLowerCase();return i}function eh(e){if(e==null)return[];if(typeof e=="string"){const t=e.trim();return t?[t]:[]}return Array.isArray(e)?e.filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):E(e)?Object.values(e).filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):[]}function th(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}function sa(e){if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(!n||typeof n!="object")return;const o=Number(n.x),i=Number(n.y);!Number.isFinite(o)||!Number.isFinite(i)||(t[r]={x:o,y:i})}),t}function rh(e,t){const r=Object.keys(e||{}),n=Object.keys(t||{});if(r.length!==n.length)return!1;for(let o=0;o<r.length;o+=1){const i=r[o];if(!Object.prototype.hasOwnProperty.call(t||{},i))return!1;const s=e[i],a=t[i];if(!s||typeof s!="object"||!a||typeof a!="object"||Number(s.x)!==a.x||Number(s.y)!==a.y)return!1}return!0}function nh(e){if(!E(e))return{state:null,changed:!1};const t={...e};let r=!1;const n=s=>{if(!Object.prototype.hasOwnProperty.call(t,s))return;const a=t[s];if(typeof a=="string"){const c=a.trim();c!==a&&(t[s]=c,r=!0);return}if(a==null){t[s]="",r=!0;return}if(typeof a=="number"||typeof a=="boolean"){t[s]=String(a),r=!0;return}t[s]="",r=!0};["setupName","setupSelect","camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap","sliderBowl","easyrig"].forEach(n);const o=(s,a=[])=>{const c=[],l=[s,...a];let f=!1;l.forEach(m=>{if(Object.prototype.hasOwnProperty.call(t,m)){const g=eh(t[m]);m!==s&&(f=!0),g.length&&c.push(...g)}}),l.slice(1).forEach(m=>{Object.prototype.hasOwnProperty.call(t,m)&&(delete t[m],r=!0)});const u=[],y=new Set;c.forEach(m=>{y.has(m)||(y.add(m),u.push(m))});const p=Object.prototype.hasOwnProperty.call(t,s),d=p&&Array.isArray(t[s])?t[s].filter(m=>typeof m=="string").map(m=>m.trim()).filter(m=>m):[];!p&&!f&&u.length===0&&d.length===0||th(d,u)||(t[s]=u,r=!0)};if(o("motors",["motor","motorSelect"]),o("controllers",["controller","controllerSelect"]),Object.prototype.hasOwnProperty.call(t,"projectInfo")&&!E(t.projectInfo)&&(t.projectInfo=null,r=!0),Object.prototype.hasOwnProperty.call(t,"autoGearHighlight")){const s=t.autoGearHighlight,a=s===!0||s==="true"||s===1||s==="1";(s!==a||typeof s!="boolean")&&(t.autoGearHighlight=a,r=!0)}if(Object.prototype.hasOwnProperty.call(t,"diagramPositions")){const s=sa(t.diagramPositions);Object.keys(s).length===0?(delete t.diagramPositions,r=!0):rh(t.diagramPositions,s)||(t.diagramPositions=s,r=!0)}const i=ue(t);return i!==t?{state:i,changed:!0}:{state:t,changed:r}}function Rf(){ke();const e=T(),t=Ym(e,typeof sessionStorage<"u"?sessionStorage:null,Xt,"Error loading session state from localStorage:","Error loading session state from sessionStorage:","Error saving session state to localStorage:","Error deleting session state from sessionStorage:",{validate:o=>o===null||E(o)});if(t===null)return null;const{state:r,changed:n}=nh(t);return r?(n&&(yt(e,Xt,t),Za(r)),r):null}function Za(e,t={}){const r=T();if(e==null){Ee(r,Xt,"Error deleting session state from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid session state payload. Expected a plain object.");return}qe(r,Xt);const n=ue(e),o=E(t)?t:{},i=o.disableCompression!==!1,s={...o,disableCompression:i,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{if(typeof na=="function"){const a=uc();if(na(a))return console.warn("Removed oldest automatic gear backup to free up space for session state."),!0}return typeof oa=="function"&&oa()?(console.warn("Cleared cached planner data to free up space for session state."),!0):!1}};Ae(r,Xt,n,"Error saving session state to localStorage:",s)}function Tf(e){if(!E(e))return{data:null,changed:!1};const t={...e};let r=!1;const n=(i,s)=>(E(i[s])||(i[s]={},r=!0),i[s]),o=i=>{if(!E(i))return;Object.entries(i).forEach(([a,c])=>{if(typeof a!="string")return;const l=a.trim();if(!l||l===a)return;if(!E(c)){Object.prototype.hasOwnProperty.call(i,l)||(i[l]=c,delete i[a],r=!0);return}const f=n(i,l),u=new Set(Object.keys(f)),y=new Set([...u].map(p=>p.trim().toLowerCase()));Object.entries(c).forEach(([p,d])=>{if(Object.prototype.hasOwnProperty.call(f,p)){const m=fs(p,u,y);f[m]=d;return}f[p]=d,u.add(p),y.add(p.trim().toLowerCase())}),delete i[a],r=!0})};return km.forEach(i=>{n(t,i)}),E(t.fiz)||(t.fiz={},r=!0),_m.forEach(i=>{n(t.fiz,i)}),E(t.accessories)||(t.accessories={},r=!0),jm.forEach(i=>{n(t.accessories,i)}),o(t.accessories),o(t.fiz),Array.isArray(t.filterOptions)||(t.filterOptions=Array.isArray(e.filterOptions)?e.filterOptions.slice():[],r=!0),{data:t,changed:r}}function Mf(){ke();const e=T(),t=Me(e,Ze,"Error loading device data from localStorage:",null,{validate:o=>o===null||E(o)}),{data:r,changed:n}=Tf(t);return r?(n&&(yt(e,Ze,t),Ae(e,Ze,r,"Error updating device data in localStorage during normalization:",{disableCompression:!0,forceCompressionOnQuota:!1})),r):null}function Nf(e){const t=T();if(e==null){Ee(t,Ze,"Error deleting device data from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid device data payload. Expected a plain object.");return}const{data:r}=Tf(e),n=r||e;qe(t,Ze),Ae(t,Ze,n,"Error saving device data to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Gf(e){if(!e)return{data:{},changed:!1};if(Array.isArray(e)){const n={},o=new Set,i=new Set;for(let s=0;s<e.length;s+=1){const a=e[s];if(!E(a))continue;const c=a.name||a.setupName||`Setup ${s+1}`,l=fs(c,o,i);n[l]=a}return{data:n,changed:!0}}if(!E(e))return{data:{},changed:!0};const t={};let r=!1;return Object.keys(e).forEach(n=>{const o=e[n];if(E(o)){const i=ue(o);i!==o&&(r=!0),t[n]=i}else r=!0}),r?{data:t,changed:!0}:{data:e,changed:!1}}function Ko(){ke();const e=T(),t=Me(e,pt,"Error loading setups from localStorage:",null,{validate:o=>o===null||Array.isArray(o)||E(o)}),{data:r,changed:n}=Gf(t);n&&(yt(e,pt,t),Ae(e,pt,r,"Error updating setups in localStorage during normalization:"));try{return ff(r,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Ue)})}catch(o){return console.warn("Failed to expand automatic backup entries while loading setups",o),me(r)}}function ec(e){const{data:t}=Gf(e);Xa(t);const r=pf(t,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Ue)});Sm(r);const n=T();typeof _o=="function"&&_o(t,n),qe(n,pt),Ae(n,pt,r,"Error saving setups to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{const o=ra(r);return o?(console.warn(`Removed automatic backup "${o}" to free up storage space before saving setups.`),!0):!1}})}function tc(e){const t=Ko(),{result:r,changed:n=!0}=e(t)||{};return n&&ec(t),r}function oh(e,t){tc(r=>(r[e]=t,{changed:!0}))}function ih(e){return Ko()[e]}function sh(e){tc(t=>Object.prototype.hasOwnProperty.call(t,e)?(delete t[e],{changed:!0}):{changed:!1})}function ah(e,t){return tc(r=>{if(!Object.prototype.hasOwnProperty.call(r,e))return{result:null,changed:!1};const n=t.trim();if(!n)return{result:e,changed:!1};if(e.trim().toLowerCase()===n.toLowerCase())return{result:e,changed:!1};const o=new Set(Object.keys(r));o.delete(e);const i=fs(n,o),s=r[e];r[i]=s,delete r[e];const a=typeof e=="string"&&e.startsWith(Ue),c=typeof i=="string"&&i.startsWith(Ue);return a&&c&&xm(s),{result:i,changed:!0}})}var ch=new Set(["prepDays","shootingDays","returnDays","crew","productionCompany","productionCompanyAddress"]),zf={productionCompany:["Production Company","Produktionsfirma","Société de production","Productora","Casa di produzione"],productionCompanyAddress:["Production Company Address","Adresse der Produktionsfirma","Adresse de la société de production","Dirección de la productora","Indirizzo della casa di produzione"],productionCompanyStreet:["Street address","Straße und Hausnummer","Adresse","Dirección","Indirizzo"],productionCompanyStreet2:["Address line 2","Adresszusatz","Complément d'adresse","Línea 2 de dirección","Seconda linea indirizzo"],productionCompanyCity:["City","Stadt","Ville","Ciudad","Città"],productionCompanyRegion:["State / Province / Region","Bundesland / Region","État / Région / Département","Estado / Provincia / Región","Regione / Provincia / Stato"],productionCompanyPostalCode:["Postal code","Postleitzahl","Code postal","Código postal","CAP"],productionCompanyCountry:["Country","Land","Pays","País","Paese"],rentalHouse:["Rental","Kameraverleih","Loueur","Noleggio","Verleih","Location","Rental House"],crew:["Crew","Team","Équipe","Equipo","Troupe"],prepDays:["Prep Days","Prep-Tage","Jours de préparation","Días de preparación","Giorni di preparazione"],shootingDays:["Shooting Days","Drehtage","Jours de tournage","Días de rodaje","Giorni di riprese"],returnDays:["Return Days","Rückgabetage","Jours de restitution","Días de devolución","Giorni di restituzione"],deliveryResolution:["Delivery Resolution","Auslieferungsauflösung","Résolution de livraison","Resolución de entrega","Risoluzione di consegna"],recordingResolution:["Recording Resolution","Aufnahmeauflösung","Résolution d’enregistrement","Resolución de grabación","Risoluzione di registrazione"],slowMotionRecordingResolution:["Slow Motion Recording Resolution","Zeitlupen-Aufnahmeauflösung","Résolution d’enregistrement au ralenti","Resolución de grabación en cámara lenta","Risoluzione di registrazione slow motion"],aspectRatio:["Aspect Ratio","Seitenverhältnis","Format d’image","Relación de aspecto","Formato"],codec:["Codec","Codec","Codec","Códec","Codec"],baseFrameRate:["Base Frame Rate","Basis-Framerate","Cadence de base","Velocidad base","Frame rate base"],slowMotionBaseFrameRate:["Slow Motion Base Frame Rate","Zeitlupen-Basis-Framerate","Cadence de base au ralenti","Velocidad base en cámara lenta","Frame rate base slow motion"],recordingFrameRate:["Recording Frame Rate","Aufnahmebildrate","Cadence d’enregistrement","Velocidad de grabación","Frame rate di registrazione"],slowMotionRecordingFrameRate:["Slow Motion Recording Frame Rate","Zeitlupen-Aufnahmebildrate","Cadence d’enregistrement au ralenti","Velocidad de grabación en cámara lenta","Frame rate di registrazione slow motion"],sensorMode:["Sensor Mode","Sensormodus","Mode capteur","Modo de sensor","Modalità sensore"],slowMotionSensorMode:["Slow Motion Sensor Mode","Zeitlupen-Sensormodus","Mode capteur au ralenti","Modo de sensor en cámara lenta","Modalità sensore slow motion"],slowMotionAspectRatio:["Slow Motion Aspect Ratio","Zeitlupen-Seitenverhältnis","Format d’image au ralenti","Relación de aspecto en cámara lenta","Formato slow motion"],lenses:["Lenses","Objektive","Optiques","Ópticas","Obiettivi"],requiredScenarios:["Required Scenarios","Anforderungen","Scénarios requis","Escenarios requeridos","Scenari richiesti"],cameraHandle:["Camera Handle","Kamera-Handgriff","Poignée caméra","Empuñadura de cámara","Maniglia camera"],viewfinderExtension:["Viewfinder Extension","Sucher-Verlängerung","Extension viseur","Extensión de visor","Prolunga mirino"],viewfinderEyeLeatherColor:["Viewfinder Eye Leather Color","Sucher-Augenmuschel-Farbe","Couleur de l’œil du viseur","Color del ocular del visor","Colore gomma mirino"],mattebox:["Mattebox","Matte-Box","Matte box","Matte box","Matte box"],gimbal:["Gimbal","Gimbal-Stabilisator","Stabilisateur gimbal","Estabilizador gimbal","Stabilizzatore gimbal"],videoDistribution:["Video Distribution","Videoverteilung","Distribution vidéo","Distribución de vídeo","Distribuzione video"],monitoringSupport:["Monitoring support","Monitoring-Support","Support de monitoring","Soporte de monitorización","Supporto monitoraggio"],monitoringConfiguration:["Monitoring configuration","Monitoring-Konfiguration","Configuration de monitoring","Configuración de monitorización","Configurazione monitoraggio"],focusMonitor:["Focus Monitor","Fokusmonitor","Moniteur focus","Monitor de foco","Monitor fuoco"],monitorUserButtons:["Onboard Monitor User Buttons","Onboard-Monitor-Buttons","Boutons personnalisés du moniteur","Botones de usuario del monitor integrado","Tasti monitor onboard"],cameraUserButtons:["Camera User Buttons","Kamera-Buttons","Boutons personnalisés caméra","Botones de usuario de la cámara","Tasti camera"],viewfinderUserButtons:["Viewfinder User Buttons","Sucher-Buttons","Boutons personnalisés viseur","Botones de usuario del visor","Tasti mirino"],tripodHeadBrand:["Tripod Head Brand","Kopfmarke","Marque de la tête","Marca de la cabeza","Marca della testa"],tripodBowl:["Tripod Bowl","Schalentyp","Type de bol","Tipo de bowl","Tipo di bowl"],tripodTypes:["Tripod Types","Stativtypen","Types de trépied","Tipos de trípode","Tipi di treppiede"],tripodSpreader:["Tripod Spreader","Spreizer-Option","Type de spreader","Tipo de esparcidor","Tipo di spreader"],sliderBowl:["Slider Bowl","Slider-Schale","Slider bowl","Bowl del slider","Slider bowl"],easyrig:["Further Stabilisation","Weitere Stabilisierung","Stabilisation complémentaire","Estabilización adicional","Stabilizzazione aggiuntiva"]},aa=["productionCompanyAddress","productionCompanyStreet","productionCompanyStreet2","productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"];function Bf(e){return typeof e!="string"?"":e.trim().replace(/[:：]\s*$/,"").trim()}function lh(e){var t={},r=typeof window<"u"&&window.texts?window.texts:null,n=r&&r.en&&r.en.projectFields||{},o=["productionCompany"].concat(aa);return o.forEach(function(i){var s=new Set,a=function(l){if(typeof l=="string"){var f=Bf(l);f&&s.add(f)}};e&&e[i]&&a(e[i]),n&&n[i]&&a(n[i]);var c=zf[i];Array.isArray(c)&&c.forEach(a),t[i]=s}),t}function uh(e,t,r){if(typeof e!="string")return null;var n=e.replace(/\r\n?/g,`
`).split(`
`).map(function(g){return g.trim()}).filter(function(g){return g});if(!n.length)return null;var o=lh(t),i={},s=n[0];s&&(i.productionCompany=s);var a=Array.isArray(r?.lines)?r.lines:null;if(a&&a.length){var c={};if(a.forEach(function(g){if(!(!g||typeof g.text!="string")){var b=g.text.trim();if(b){var P=g.fields;typeof P=="string"&&(P=P.split(/\s+/)),!(!Array.isArray(P)||!P.length)&&P.map(function(A){return typeof A=="string"?A.trim():""}).filter(function(A){return A&&aa.includes(A)}).forEach(function(A){c[A]||(c[A]=[]),c[A].push(b)})}}}),Object.keys(c).length){if(c.productionCompanyAddress&&c.productionCompanyAddress.length&&(i.productionCompanyAddress=c.productionCompanyAddress.join(`
`)),c.productionCompanyStreet&&c.productionCompanyStreet.length){var l=c.productionCompanyStreet;if(i.productionCompanyStreet=l[0],l.length>1){var f=l.slice(1).join(`
`);f&&(i.productionCompanyStreet2=f)}}if(c.productionCompanyStreet2&&c.productionCompanyStreet2.length){var u=c.productionCompanyStreet2.join(`
`);u&&(i.productionCompanyStreet2=i.productionCompanyStreet2?i.productionCompanyStreet2+`
`+u:u)}var y=function(g){if(!(!c[g]||!c[g].length)){var b=c[g].join(" ");b&&(i[g]=b)}};return["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"].forEach(y),i}}var p={},d=null;if(n.slice(1).forEach(function(g){var b=Bf(g),P=null;if(aa.forEach(function(A){P||!o[A]||o[A].has(b)&&(P=A)}),P){d=P,p[d]||(p[d]=[]);return}if(!d){i.productionCompany?i.productionCompany+=`
`+g:i.productionCompany=g;return}p[d]||(p[d]=[]),p[d].push(g)}),p.productionCompanyAddress&&p.productionCompanyAddress.length&&(i.productionCompanyAddress=p.productionCompanyAddress.join(`
`)),p.productionCompanyStreet&&p.productionCompanyStreet.length){var m=p.productionCompanyStreet;i.productionCompanyStreet=m[0],m.length>1&&(i.productionCompanyStreet2=m.slice(1).join(`
`))}return p.productionCompanyCity&&p.productionCompanyCity.length&&(i.productionCompanyCity=p.productionCompanyCity.join(" ")),p.productionCompanyRegion&&p.productionCompanyRegion.length&&(i.productionCompanyRegion=p.productionCompanyRegion.join(" ")),p.productionCompanyPostalCode&&p.productionCompanyPostalCode.length&&(i.productionCompanyPostalCode=p.productionCompanyPostalCode.join(" ")),p.productionCompanyCountry&&p.productionCompanyCountry.length&&(i.productionCompanyCountry=p.productionCompanyCountry.join(" ")),i}var fh=(()=>{const e=new Map,t=r=>typeof r!="string"?"":r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return Object.entries(zf).forEach(([r,n])=>{n.forEach(o=>{const i=t(o);i&&!e.has(i)&&e.set(i,r)})}),e})(),ph={amp:"&",lt:"<",gt:">",quot:'"',apos:"'",nbsp:" "};function po(e){return typeof e!="string"||!e?"":e.replace(/&(#x?[0-9a-fA-F]+|[a-zA-Z]+);/g,(t,r)=>{if(!r)return t;if(r[0]==="#"){const o=r[1]==="x"||r[1]==="X"?parseInt(r.slice(2),16):parseInt(r.slice(1),10);return Number.isFinite(o)?String.fromCodePoint(o):t}const n=ph[r.toLowerCase()];return n!==void 0?n:t})}function yo(e){if(typeof e!="string")return"";let t;do t=e,e=e.replace(/<[^>]*>/g,"");while(e!==t);return e}function dh(e,t){if(typeof e!="string")return"";const r=e.replace(/<\s*br\s*\/?\s*>/gi,`
`).replace(/<\/(p|div|li|ul|ol)>/gi,`
`).replace(/<li[^>]*>/gi,""),o=po(yo(r)).replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(i=>i.replace(/\s+/g," ").trim()).filter(i=>i);return o.length?t&&ch.has(t)?o.join(`
`):o.join(", "):""}function yh(e){if(typeof e!="string")return null;const t=/<span([^>]*)>([\s\S]*?)<\/span>/gi,r=[];let n;for(;n=t.exec(e);){const o=n[1]||"";if(!/class=["'][^"']*req-sub-line[^"']*["']/i.test(o))continue;const i=n[2]||"",s=po(yo(i)).replace(/\s+/g," ").trim();if(!s)continue;const a=o.match(/data-fields=["']([^"']+)["']/i),c=a?null:o.match(/data-field=["']([^"']+)["']/i),l=a?a[1]:c?c[1]:"",f=typeof l=="string"?l.split(/\s+/).map(u=>u.trim()).filter(u=>u):[];r.push({text:s,fields:f})}return r.length?{lines:r}:null}function gh(e){if(typeof e!="string")return"";const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return t&&fh.get(t)||""}function il(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const r={},n=t.match(/<div[^>]*class=["'][^"']*requirements-grid[^"']*["'][^>]*>/i),o=n?n.index:-1;if(o===-1){const d=t.match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(d){const g=po(yo(d[1])).replace(/[“”"']/g,"").trim();g&&(r.projectName=g)}return Object.keys(r).length?r:null}const i=t.slice(o),a=t.slice(0,o).match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(a){const m=po(yo(a[1])).replace(/[“”"']/g,"").trim();m&&!/gear list/i.test(m)&&(r.projectName=m)}const c=/<div[^>]*class=["'][^"']*requirement-box[^"']*["'][^>]*>[\s\S]*?<\/div>/gi;let l;const f=typeof window<"u"&&window.texts?window.texts:null,u=typeof window<"u"&&window.currentLang?window.currentLang:null,y=typeof u=="string"&&f&&f[u]?u:"en",p=f&&f[y]&&f[y].projectFields?f[y].projectFields:f&&f.en&&f.en.projectFields?f.en.projectFields:{};for(;l=c.exec(i);){const d=l[0],m=d.match(/data-field=["']([^"']+)["']/i),g=d.match(/<span[^>]*class=["'][^"']*req-label[^"']*["'][^>]*>([\s\S]*?)<\/span>/i),b=d.match(/<span[^>]*class=["'][^"']*req-value[^"']*["'][^>]*>([\s\S]*)<\/span\s*>/i),P=m?m[1].trim():"",A=g?po(yo(g[1])):"",O=P||gh(A);if(!O)continue;const k=b?b[1]:"",_=dh(k,O);if(!_)continue;let I=_,w=null;if(O==="productionCompany"){w=yh(k);const S=uh(_,p,w);S&&typeof S=="object"&&(S.productionCompany&&(I=S.productionCompany),Object.entries(S).forEach(([v,B])=>{v!=="productionCompany"&&(Object.prototype.hasOwnProperty.call(r,v)||(r[v]=B))}))}Object.prototype.hasOwnProperty.call(r,O)||(r[O]=I)}return Object.keys(r).length?r:null}function Gn(e){if(Array.isArray(e))return e.map(t=>Gn(t));if(E(e)){const t={};return Object.entries(e).forEach(([r,n])=>{t[r]=Gn(n)}),t}return e}function ti(e){if(!E(e))return null;try{return pr(e)}catch(t){console.warn("Unable to serialize project info during normalization",t);try{return Gn(e)}catch(r){return console.warn("Unable to deep clone project info during normalization",r),{...e}}}}function mh(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(r=>{if(!E(r)){const u=rc(r);u!=null&&t.push(u);return}const n={},o=typeof r.name=="string"?r.name.trim():"";o&&(n.name=o);const i=typeof r.phone=="string"?r.phone.trim():"";i&&(n.phone=i);const s=typeof r.email=="string"?r.email.trim():"";s&&(n.email=s);const c=typeof r.website=="string"?r.website.trim():typeof r.url=="string"?r.url.trim():"";c&&(n.website=c);const l=typeof r.text=="string"?r.text.trim():"";l&&(n.text=l);const f=typeof r.role=="string"?r.role.trim():"";f&&(n.role=f),Object.keys(n).length&&t.push(n)}),t}function rc(e){if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t||null}if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="boolean")return e?!0:null;if(Array.isArray(e)){const t=e.map(r=>rc(r)).filter(r=>r!=null&&!(typeof r=="string"&&!r));return t.length?t:null}return E(e)?xf(e):null}function xf(e){if(!E(e))return null;const t={},r=[],n=new Set,o=a=>{if(typeof a!="string")return;const c=a.trim();!c||n.has(c)||(n.add(c),r.push(c))},i=(a,c={})=>{if(a==null)return;if(c.fromSelections){(Array.isArray(a)?a:[a]).forEach(u=>{if(re(u)){const p=ne(u);if(p){i(p,{fromSelections:!0});return}}if(E(u)){const p=nc(u);if(p.length){p.forEach(d=>{d&&typeof d.name=="string"&&o(d.name)});return}}const y=Te(u);y&&o(y)});return}const l=Ye(a);l.length&&l.forEach(f=>{o(f)})};if(i(e.lenses),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&i(e.lensSelections,{fromSelections:!0}),Object.entries(e).forEach(([a,c])=>{if(c==null)return;if(a==="people"){const f=mh(c);f.length&&(t.people=f);return}if(a==="lenses"){const{names:f}=Df(c);t.lenses=f.slice();return}if(a==="lensSelections"){const f=ca(c,r);f.selections&&f.selections.length&&(t.lensSelections=f.selections);return}const l=rc(c);l!=null&&(t[a]=l)}),!Object.prototype.hasOwnProperty.call(t,"lenses")&&r.length&&(t.lenses=r.slice()),!Object.prototype.hasOwnProperty.call(t,"lensSelections")&&r.length){const a=ca([],r);a.selections&&a.selections.length&&(t.lensSelections=a.selections)}return Object.keys(t).length?ue(t):null}function hh(e){if(!Array.isArray(e)||!e.length)return null;try{return pr(e)}catch(t){console.warn("Unable to serialize automatic gear rules during normalization",t);try{return Gn(e)}catch(r){return console.warn("Unable to deep clone automatic gear rules during normalization",r),e.slice()}}}function bh(e){if(!E(e)||!Object.keys(e).length)return{};try{return pr(e)}catch(t){console.warn("Unable to serialize diagram positions during normalization",t);try{return Gn(e)}catch(r){return console.warn("Unable to deep clone diagram positions during normalization",r),{...e}}}}var gi="4x5.65";function ht(e){if(e==null)return[];if(Array.isArray(e)){const r=[];return e.forEach(n=>{if(n==null)return;if(Array.isArray(n)){r.push(...ht(n));return}if(re(n)){const i=ne(n);if(i){r.push(...ht(i));return}}if(typeof n=="object"){r.push(...ht(Object.values(n)));return}const o=String(n).trim();o&&r.push(o)}),r}if(re(e)){const r=ne(e);if(r)return ht(r)}if(typeof e=="object")return Object.prototype.hasOwnProperty.call(e,"values")?ht(e.values):Object.prototype.hasOwnProperty.call(e,"selected")?ht(e.selected):ht(Object.values(e));if(typeof e=="string"){const r=e.trim();if(!r||r==="!")return[];const n=Oe(r);return n.success?ht(n.parsed):r.split(/[|,]/).map(o=>o.trim()).filter(o=>o)}const t=String(e).trim();return t?[t]:[]}function Cn(e,t=""){if(e==null)return null;if(typeof e=="string"){const r=e.trim();if(!r)return null;const n=Oe(r);if(n.success)return Cn(n.parsed,t);const o=r.split(":"),i=o.shift(),s=i?i.trim():"";if(!s)return null;const a=o.shift(),c=a&&a.trim()?a.trim():gi;if(!o.length)return{type:s,size:c,values:[],hasExplicitValues:!1};const l=o.join(":");if(l==="!")return{type:s,size:c,values:[],hasExplicitValues:!0};const f=ht(l);return{type:s,size:c,values:f,hasExplicitValues:!0}}if(Array.isArray(e)){if(!e.length)return null;if(e.length===1)return Cn(e[0],t);const[r,n,o]=e;let i=typeof r=="string"?r.trim():"";if(!i&&typeof t=="string"&&(i=t.trim()),!i)return null;const s=typeof n=="string"&&n.trim()?n.trim():gi,a=e.length>2,c=a?ht(o):[];return{type:i,size:s,values:c,hasExplicitValues:a}}if(re(e)){const r=ne(e);if(r)return Cn(r,t)}if(typeof e=="object"){let r="";const n=["type","filter","name","label"];for(let l=0;l<n.length;l+=1){const f=n[l];if(typeof e[f]=="string"){const u=e[f].trim();if(u){r=u;break}}}if(!r&&typeof t=="string"&&t.trim()&&(r=t.trim()),!r)return null;const o=["size","filterSize","format","dimension","dimensions","diameter"];let i="";for(let l=0;l<o.length;l+=1){const f=o[l];if(typeof e[f]=="string"){const u=e[f].trim();if(u){i=u;break}}}i||(i=gi);const s=["values","value","strengths","strength","options","selected","selections","choices"];let a=!1,c=[];for(let l=0;l<s.length;l+=1){const f=s[l];if(Object.prototype.hasOwnProperty.call(e,f)){a=!0,c=ht(e[f]);break}}return{type:r,size:i,values:c,hasExplicitValues:a}}return null}function Is(e){if(!e||!e.type)return null;const t=e.type,r=e.size&&e.size.trim()?e.size.trim():gi;let n=`${t}:${r}`;const o=Array.isArray(e.values)?Array.from(new Set(e.values.map(i=>typeof i=="string"?i.trim():String(i??"").trim()).filter(i=>i))):[];return(e.hasExplicitValues||o.length)&&(n+=o.length?`:${o.join("|")}`:":!"),n}function Ui(e){if(e===void 0)return null;if(e===null)return"";if(typeof e=="string"){const t=e.trim();if(!t)return"";const r=Oe(t);return r.success?Ui(r.parsed):t}if(Array.isArray(e)){const t=e.map(r=>Cn(r)).filter(Boolean);return t.length?t.map(r=>Is(r)).filter(Boolean).join(","):""}if(re(e)){const t=ne(e);if(t)return Ui(t)}if(typeof e=="object"){const t=Cn(e);if(t)return Is(t)||"";const r=[];return Object.entries(e).forEach(([n,o])=>{const i=Cn(o,n);i&&r.push(i)}),r.length?r.map(n=>Is(n)).filter(Boolean).join(","):""}return String(e).trim()}function vs(e){if(!E(e))return;const t=Ui(e.filter);if(t!==null)t?e.filter=t:delete e.filter;else{const r=Ui(e.filters);r!==null&&(r?e.filter=r:delete e.filter)}Object.prototype.hasOwnProperty.call(e,"filters")&&delete e.filters}function to(e){if(!E(e))return null;const t=n=>{if(Array.isArray(n))return n.map(i=>t(i)).filter(i=>i!==void 0);if(E(n)){const o={};return Object.entries(n).forEach(([i,s])=>{if(typeof i!="string"||!i)return;const a=t(s);a!==void 0&&(o[i]=a)}),o}if(n==null)return"";if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean")return String(n);try{return String(n)}catch{}return""},r={};return Object.entries(e).forEach(([n,o])=>{if(typeof n!="string"||!n)return;const i=t(o);i!==void 0&&(r[n]=i)}),Object.keys(r).length?r:null}function so(e){if(e==null)return null;const t=o=>typeof o=="string"?o.trim():o==null?"":typeof o=="number"||typeof o=="boolean"?String(o):"";if(!E(e))return null;const r={batteryPlate:t(e.batteryPlate),battery:t(e.battery),batteryHotswap:t(e.batteryHotswap)};return Object.keys(r).some(o=>r[o])?r:null}function Sh(e){const t=so(e);return t?{batteryPlate:t.batteryPlate,battery:t.battery,batteryHotswap:t.batteryHotswap}:null}const wh=new Set(["name","lensname","label","title","text","lens","mount","mountlabel","mountname","mounts","note","notes","names","values","selection","legacyvalue","lensselections","selections","entries","items","options","meta","metadata","count","version","length","size","updated","created","createdat","timestamp","id","uuid","key","value"]);function Ff(e){if(typeof e!="string")return!1;const t=e.trim();if(!t||/^[0-9]+$/u.test(t))return!1;const r=t.toLowerCase();return!(r.startsWith("__proto__")||r==="prototype"||r==="constructor"||wh.has(r))}function Uf(e){if(!E(e))return[];const t=Object.keys(e),r=[];return t.forEach(n=>{if(!Ff(n))return;const o=n.trim();o&&r.push(o)}),r}function Te(e){if(e==null)return"";if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return(typeof e=="string"?e:String(e)).trim();if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Te(e[t]);if(r)return r}return""}if(re(e)){const t=ne(e);if(t)return Te(t)}if(E(e)){const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i=="string"){const s=i.trim();if(s)return s}}const r=Uf(e);if(r.length)return r[0];if(Array.isArray(e.names)&&e.names.length){const o=Te(e.names[0]);if(o)return o}if(Array.isArray(e.values)&&e.values.length){const o=Te(e.values[0]);if(o)return o}const n=Object.values(e);for(let o=0;o<n.length;o+=1){const i=Te(n[o]);if(i)return i}}return""}function Ye(e){if(e==null)return[];if(Array.isArray(e)){const t=[];return e.forEach(r=>{if(r==null)return;if(typeof r=="string"){const o=Oe(r);if(o.success){t.push(...Ye(o.parsed));return}const i=r.trim();i&&t.push(i);return}if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint"){t.push(String(r));return}const n=Te(r);if(n){t.push(n);return}if(Array.isArray(r)){t.push(...Ye(r));return}if(re(r)){const o=ne(r);o&&t.push(...Ye(o));return}E(r)&&t.push(...Ye(Object.values(r)))}),t}if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return[String(e)];if(typeof e=="string"){const t=Oe(e);return t.success?Ye(t.parsed):e.split(/[\n,;]/u).map(r=>r.trim()).filter(r=>r)}if(re(e)){const t=ne(e);if(t)return Ye(t)}if(E(e)){const t=Uf(e);if(t.length)return t;const r=Te(e);if(r)return[r];const n=[];return Array.isArray(e.names)&&n.push(...Ye(e.names)),Array.isArray(e.values)&&n.push(...Ye(e.values)),n.length||n.push(...Ye(Object.values(e))),n}return[]}function Df(e){const t=Ye(e),r=Array.isArray(e)&&e.length===t.length&&e.every((n,o)=>typeof n=="string"&&n.trim()===t[o]);return{names:t,changed:!r}}function mi(e){if(e==null)return{selection:null,changed:!1};if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"){const t=Te(e);return t?{selection:{name:t,mount:""},changed:!0}:{selection:null,changed:!0}}if(re(e)){const t=ne(e);if(t)return mi(t)}if(Array.isArray(e)){if(!e.length)return{selection:null,changed:!0};const t=Te(e[0]);if(!t)return{selection:null,changed:!0};const r=e.length>1?e[1]:"",n=typeof r=="string"?r.trim():"",o={name:t};return o.mount=n||"",{selection:o,changed:!0}}if(E(e)){const t={...e};let r=!1;const n=Te(e);if(!n)return{selection:null,changed:!0};t.name!==n&&(t.name=n,r=!0),Object.prototype.hasOwnProperty.call(t,"name")||(t.name=n,r=!0);const o=[];if(typeof e.mount=="string"&&o.push(e.mount),typeof e.mountLabel=="string"&&o.push(e.mountLabel),typeof e.mountName=="string"&&o.push(e.mountName),Array.isArray(e.mounts))for(let s=0;s<e.mounts.length;s+=1){const a=e.mounts[s];if(typeof a=="string"&&a.trim()){o.push(a);break}}let i="";for(let s=0;s<o.length;s+=1){const a=o[s];if(typeof a=="string"){const c=a.trim();if(c){i=c;break}}}if(typeof t.mount=="string"){const s=t.mount.trim();s!==t.mount&&(t.mount=s,r=!0),!i&&s&&(i=s)}return i||(i=""),t.mount!==i&&(t.mount=i,r=!0),Object.prototype.hasOwnProperty.call(t,"mount")||(t.mount=i,r=!0),{selection:t,changed:r}}return{selection:null,changed:!0}}function nc(e){if(!E(e))return[];const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let n=0;n<t.length;n+=1){const o=t[n];if(typeof o=="string"&&o.trim())return[]}const r=[];return Object.entries(e).forEach(([n,o])=>{if(!Ff(n))return;const i=n.trim();if(!i)return;let s=o;if(re(s)){const l=ne(s);l&&(s=l)}if(E(s)){const l={...s};l.name=i;let f="";const u=["mount","mountLabel","mountName"];for(let y=0;y<u.length;y+=1){const p=u[y];if(typeof l[p]!="string")continue;const d=l[p].trim();if(d&&d.toLowerCase()!==i.toLowerCase()){f=d;break}}if(!f&&Array.isArray(l.mounts)){const y=Te(l.mounts);y&&y.toLowerCase()!==i.toLowerCase()&&(f=y)}l.mount=typeof f=="string"?f:"",r.push(l);return}if(Array.isArray(s)){const l=Te(s),f=l&&l.toLowerCase()!==i.toLowerCase()?l:"";r.push({name:i,mount:f});return}if(typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"){const l=Te(s),f=l&&l.toLowerCase()!==i.toLowerCase()?l:"";r.push({name:i,mount:f});return}if(s==null){r.push({name:i,mount:""});return}const a=Te(s),c=a&&a.toLowerCase()!==i.toLowerCase()?a:"";r.push({name:i,mount:c})}),r}function ca(e,t=[]){const r=Array.isArray(e)?e:[e],n=[],o=new Set;let i=!1;const s=(c,l)=>{if(!c||typeof c!="object"){l&&(i=!0);return}const f={...c},y=(typeof f.name=="string"?f.name:"").trim();if(!y){l&&(i=!0);return}f.name!==y&&(f.name=y,l=!0);const d=(typeof f.mount=="string"?f.mount:"").trim();if(f.mount!==d&&(f.mount=d,l=!0),Object.prototype.hasOwnProperty.call(f,"mount")||(f.mount=d,l=!0),Object.prototype.hasOwnProperty.call(f,"mountState")){const g=(typeof f.mountState=="string"?f.mountState:"").trim();f.mountState!==g&&(f.mountState=g,l=!0),g||(delete f.mountState,l=!0)}l&&(i=!0),n.push(f),o.add(y)},a=c=>{if(c==null)return;if(typeof c=="string"){const f=Oe(c);if(f.success){a(f.parsed),i=!0;return}const u=Ye(c);u.length?u.forEach(y=>{s({name:y,mount:""},!0)}):i=!0;return}if(typeof c=="number"||typeof c=="boolean"||typeof c=="bigint"){s({name:String(c),mount:""},!0);return}if(Array.isArray(c)){if(c.length&&c.length<=2&&(typeof c[0]=="string"||typeof c[0]=="number"||typeof c[0]=="boolean"||typeof c[0]=="bigint")){const{selection:f,changed:u}=mi(c);if(f){s(f,u);return}}c.forEach(f=>{const{selection:u,changed:y}=mi(f);u?s(u,y):y&&(i=!0)});return}if(re(c)){const f=ne(c);f&&(a(f),i=!0);return}if(E(c)){const f=nc(c);if(f.length){f.forEach(d=>{s(d,!0)});return}const{selection:u,changed:y}=mi(c);if(u){s(u,y);return}const p=Object.values(c);p.length&&(a(p),i=!0);return}const l=Te(c);l?s({name:l,mount:""},!0):i=!0};for(let c=0;c<r.length;c+=1)a(r[c]);return Array.isArray(t)&&t.forEach(c=>{if(typeof c!="string")return;const l=c.trim();!l||o.has(l)||(n.push({name:l,mount:""}),o.add(l),i=!0)}),n.length?{selections:n,changed:i}:{selections:null,changed:i}}function $e(e){const t=ls(e);if(t.restored)return $e(t.value);if(typeof e=="string"){const r=Oe(e);if(r.success){const n=$e(r.parsed);if(n)return n}return $e({gearList:e,projectInfo:null})}if(re(e)){const r=ne(e);return r?$e(r):null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"gearList")||Object.prototype.hasOwnProperty.call(e,"projectInfo")){const r=re(e.project)?ne(e.project):e.project;let n=e.projectInfo;re(n)&&(n=ne(n));let o=E(n)?n:null;if(!o&&typeof n=="string"){const w=Oe(n);w.success&&E(w.parsed)&&(o=w.parsed)}if(!o&&E(r)){let w=r.projectInfo;if(re(w)&&(w=ne(w)),E(w))o=w;else if(typeof w=="string"){const S=Oe(w);S.success&&E(S.parsed)&&(o=S.parsed)}}let i=null;const s=w=>{if(i&&i.length||w==null)return;let S=w;if(re(S)){const v=ne(S);v&&(S=Object.values(v).filter(B=>B!=null))}if(Array.isArray(S)&&S.length){i=S;return}if(E(S)){const v=Object.values(S).filter(B=>B!=null);if(v.length){i=v;return}}if(typeof S=="string"){const v=Oe(S);v.success&&Array.isArray(v.parsed)&&v.parsed.length&&(i=v.parsed)}};s(e.autoGearRules),!i&&E(r)&&s(r.autoGearRules);let a=re(e.gearList)?ne(e.gearList):e.gearList;if((a==null||typeof a=="string"&&!a)&&E(r)&&Object.prototype.hasOwnProperty.call(r,"gearList")&&(a=r.gearList),re(a)){const w=ne(a);w&&(a=w)}let c=typeof a=="string"||a&&typeof a=="object"?a:"",l=null;const f=re(e.gearSelectors)?ne(e.gearSelectors):e.gearSelectors;if(E(f))l=to(f);else if(typeof f=="string"){const w=Oe(f);w.success&&E(w.parsed)&&(l=to(w.parsed))}const u=re(e.powerSelection)?ne(e.powerSelection):e.powerSelection;let y=so(u);if(!y&&E(u)&&(y=so(u)),typeof c=="string"){const w=Oe(c);if(w.success){const S=$e(w.parsed);S?(c=S.gearList,!o&&S.projectInfo&&(o=S.projectInfo),(!i||!i.length)&&Array.isArray(S.autoGearRules)&&S.autoGearRules.length&&(i=S.autoGearRules),!l&&E(S.gearSelectors)&&(l=to(S.gearSelectors)),!y&&E(S.powerSelection)&&(y=so(S.powerSelection))):(typeof w.parsed=="string"||E(w.parsed)&&Object.values(w.parsed).every(v=>typeof v=="string"))&&(c=w.parsed)}}c&&typeof c=="object"&&!E(c)&&(c=""),o&&vs(o),o&&(o=xf(o)||null),o&&vs(o);const p={gearList:Array.isArray(c)||E(c)?Gn(c):c,projectInfo:o?ti(o):null},d=re(e.diagramPositions)?ne(e.diagramPositions):e.diagramPositions;let m=sa(d);if(Object.keys(m).length===0&&E(r)){const w=re(r.diagramPositions)?ne(r.diagramPositions):r.diagramPositions;m=sa(w)}Object.keys(m).length&&(p.diagramPositions=bh(m));const g=[];if(typeof e.projectHtml=="string"&&g.push(e.projectHtml),typeof e.gearHtml=="string"&&g.push(e.gearHtml),E(r)&&(typeof r.projectHtml=="string"&&g.push(r.projectHtml),typeof r.gearHtml=="string"&&g.push(r.gearHtml)),E(a)&&typeof a.gearHtml=="string"&&g.push(a.gearHtml),E(c)?(typeof c.projectHtml=="string"&&g.push(c.projectHtml),typeof c.gearHtml=="string"&&g.push(c.gearHtml)):typeof c=="string"&&g.push(c),!l&&E(r)){const w=re(r.gearSelectors)?ne(r.gearSelectors):r.gearSelectors;E(w)&&(l=to(w))}if(!l&&E(c)&&E(c.gearSelectors)&&(l=to(c.gearSelectors)),!y&&E(r)){const w=re(r.powerSelection)?ne(r.powerSelection):r.powerSelection;E(w)&&(y=so(w))}if(o){if(g.length)for(let w=0;w<g.length;w+=1){const S=il(g[w]);if(S){const v=ti(S)||{},B=ti(o)||{};p.projectInfo={...v,...B};break}}}else for(let w=0;w<g.length;w+=1){const S=il(g[w]);if(S){p.projectInfo=ti(S);break}}const b=[],P=new Set,A=w=>{if(typeof w!="string")return;const S=w.trim();!S||P.has(S)||(P.add(S),b.push(S))},O=(w,S={})=>{if(w==null)return;if(S.fromSelections){(Array.isArray(w)?w:[w]).forEach(M=>{if(re(M)){const N=ne(M);if(N){O(N,{fromSelections:!0});return}}if(E(M)){const N=nc(M);if(N.length){N.forEach(z=>{z&&typeof z.name=="string"&&A(z.name)});return}}const G=Te(M);G&&A(G)});return}const v=Ye(w);v.length&&v.forEach(B=>{A(B)})};if(p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lenses")){const{names:w}=Df(p.projectInfo.lenses);p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=w.slice(),O(w)}O(e.lenses),E(r)&&O(r.lenses),O(a&&a.lenses),E(c)&&O(c.lenses),(!p.projectInfo||!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&b.length&&(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=b.slice());const k=[];p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&(O(p.projectInfo.lensSelections,{fromSelections:!0}),k.push(p.projectInfo.lensSelections)),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&(O(e.lensSelections,{fromSelections:!0}),k.push(e.lensSelections)),E(r)&&Object.prototype.hasOwnProperty.call(r,"lensSelections")&&(O(r.lensSelections,{fromSelections:!0}),k.push(r.lensSelections)),E(a)&&Object.prototype.hasOwnProperty.call(a,"lensSelections")&&(O(a.lensSelections,{fromSelections:!0}),k.push(a.lensSelections)),E(c)&&Object.prototype.hasOwnProperty.call(c,"lensSelections")&&(O(c.lensSelections,{fromSelections:!0}),k.push(c.lensSelections));const _=ca(k,b);_&&_.selections&&_.selections.length?(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lensSelections=_.selections,(!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&(p.projectInfo.lenses=_.selections.map(w=>typeof w.name=="string"?w.name:"").filter(w=>w))):_&&_.changed&&p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&delete p.projectInfo.lensSelections;const I=typeof e.gearListAndProjectRequirementsGenerated=="boolean"?e.gearListAndProjectRequirementsGenerated:g.some(w=>typeof w=="string"&&w.trim());if(p.gearListAndProjectRequirementsGenerated=I,i&&i.length&&(p.autoGearRules=hh(i)),l&&Object.keys(l).length&&(p.gearSelectors=l),y&&(p.powerSelection=Sh(y)),Vg(e,p),p.projectInfo&&vs(p.projectInfo),p.projectInfo){const w=ue(p.projectInfo);w!==p.projectInfo&&(p.projectInfo=w)}if(p.autoGearRules){const w=ue(p.autoGearRules);w!==p.autoGearRules&&(p.autoGearRules=w)}if(p.gearSelectors){const w=ue(p.gearSelectors);w!==p.gearSelectors&&(p.gearSelectors=w)}if(p.diagramPositions){const w=ue(p.diagramPositions);w!==p.diagramPositions&&(p.diagramPositions=w)}if(p.powerSelection){const w=ue(p.powerSelection);w!==p.powerSelection&&(p.powerSelection=w)}return p}if(Object.prototype.hasOwnProperty.call(e,"projectHtml")||Object.prototype.hasOwnProperty.call(e,"gearHtml"))return{gearList:{projectHtml:e.projectHtml||"",gearHtml:e.gearHtml||""},projectInfo:null};if(E(e.project)){const r=$e(e.project);if(r)return r}else if(typeof e.project=="string"){const r=Oe(e.project);if(r.success){const n=$e(r.parsed);if(n)return n}}}return null}var Eh=new Set(["gearList","projectInfo","projectHtml","gearHtml","autoGearRules","powerSelection","gearListAndProjectRequirementsGenerated"]),Ah=new Set(["gearList","projectInfo","autoGearRules","diagramPositions","gearSelectors","powerSelection","gearListAndProjectRequirementsGenerated"]);function Di(e){if(!E(e)||!Object.keys(e).every(o=>Ah.has(o)))return!1;const{gearList:r,projectInfo:n}=e;if(typeof r!="string"&&!(E(r)&&Object.keys(r).every(o=>typeof r[o]=="string"))||n!==null&&!E(n)||Object.prototype.hasOwnProperty.call(e,"autoGearRules")&&(!Array.isArray(e.autoGearRules)||!e.autoGearRules.length)||Object.prototype.hasOwnProperty.call(e,"diagramPositions")&&!E(e.diagramPositions)||Object.prototype.hasOwnProperty.call(e,"gearSelectors")&&!E(e.gearSelectors))return!1;if(Object.prototype.hasOwnProperty.call(e,"powerSelection")){const o=e.powerSelection;if(!E(o))return!1}return!(Object.prototype.hasOwnProperty.call(e,"gearListAndProjectRequirementsGenerated")&&typeof e.gearListAndProjectRequirementsGenerated!="boolean")}function Be(e){return typeof e!="string"?"":e.trim()}function Oh(e){if(e==null)return er="",zt=!1,"";const t=Be(e);return hm(t)?(er="",zt=!1,t):(er=t,zt=!0,t)}function Ch(e){return!zt||e!==void 0&&Be(e)!==er?!1:(er="",zt=!1,!0)}function Qr(e,t,r,n={}){if(!e||typeof e!="object")return null;const o=typeof r=="string"?r:"";if(Object.prototype.hasOwnProperty.call(e,o))return o;const i=Be(o);if(i&&i!==o&&Object.prototype.hasOwnProperty.call(e,i))return i;if(!t||typeof t!="object")return null;const{raw:s,normalized:a}=t;if(s&&typeof s.get=="function"&&s.has(o)){const c=s.get(o);if(Object.prototype.hasOwnProperty.call(e,c))return c}if(a&&typeof a.get=="function"&&a.has(i)){const c=a.get(i);if(Array.isArray(c)){if(n&&n.preferExact&&o){const f=c.find(u=>u===o&&Object.prototype.hasOwnProperty.call(e,u));if(f)return f}const l=c.find(f=>Object.prototype.hasOwnProperty.call(e,f));if(l)return l}else if(typeof c=="string"&&Object.prototype.hasOwnProperty.call(e,c))return c}return null}function Ph(e={}){const t=new Map,r=new Map;return(e&&typeof e=="object"?Object.keys(e):[]).forEach(o=>{if(typeof o!="string")return;t.set(o,o);const i=Be(o);r.has(i)||r.set(i,[]),r.get(i).push(o)}),{raw:t,normalized:r}}function _t(e={}){const{forceRefresh:t=!1,forMutation:r=!1,skipMigrations:n=!1,skipAutoBackupExpansion:o=!1}=e||{};if(n||ke(),ar&&!t){const S={...Ve},v=Ph(S);return{projects:S,changed:!1,originalValue:{...Ve},lookup:Js(v)}}const i=T();let s=null;if(i&&typeof i.getItem=="function")try{s=i.getItem(pe)}catch{s=null}const a=Me(i,pe,"Error loading project from localStorage:",null,{validate:S=>S===null||typeof S=="string"||Array.isArray(S)||E(S)}),c=a;let l=null;if(E(a)?l={...a}:l={},i&&typeof i.length=="number"){const S=i.length;for(let v=0;v<S;v++){const B=i.key(v);if(!B||!B.startsWith(Gt))continue;const M=B.substring(Gt.length);if(M!=null)try{const G=i.getItem(B),N=JSON.parse(tr(G));l===null&&(l={}),l[M]=N}catch{}}}let f=a;(l!==null&&Object.keys(l).length>0||E(a))&&(f=l);const u={isAutoBackupKey:Kt};o&&(u.filter=S=>!Kt(S));const y=ff(f,u),p={};let d=!1;const m=new Set,g=new Set,b=S=>{if(typeof S!="string")return;m.add(S);const v=S.trim();v&&g.add(v.toLowerCase())},P=new Map,A=new Map,O=(S,v)=>{if(typeof S!="string")return;const B=typeof v=="string"?v:S;P.set(S,B);const M=Be(S);A.has(M)||A.set(M,[]),A.get(M).push(B)},k=()=>({raw:Tn(P),normalized:Tn(A)}),_=()=>{const S={projects:p,changed:d,originalValue:c,lookup:k(),rawValue:s};return d?(Uc(null),r?{projects:pr(S.projects),changed:S.changed,originalValue:S.originalValue,lookup:Js(S.lookup)}:S):t?S:(Uc(S),Ng({forMutation:r})||S)};if(y==null)return _();if(typeof y=="string"){const S=$e(y);if(S){const v=S&&S.projectInfo&&typeof S.projectInfo.projectName=="string"?S.projectInfo.projectName:"",B=eo(v,m,g);p[B]=S,O("",B),b(B)}return d=!0,_()}if(Array.isArray(y)){const S=m,v=g;return y.forEach((B,M)=>{const G=$e(B);if(!G){d=!0;return}const z=(E(B)&&typeof B.name=="string"?B.name.trim():`Project ${M+1}`)||`Project ${M+1}`,$=eo(z,S,v);p[$]=G,O(z,$),b($)}),d=!0,_()}if(!E(y))return d=!0,_();const I=Object.keys(y);if(I.length>0&&I.every(S=>Eh.has(S))){const S=$e(y);if(S){const v=eo("",m,g);p[v]=S,O("",v),b(v)}return d=!0,_()}return I.forEach(S=>{if(Di(y[S])){const v=typeof S=="string"?S.trim():"";v&&g.add(v.toLowerCase())}}),I.forEach(S=>{const v=$e(y[S]);if(v){const B=y[S],G=!Di(B);let N=!1;if(!G)try{const $=Pe(v),$t=Pe(B);$!==$t&&(N=!0)}catch($){N=!0,console.warn("Unable to compare stored project entry during legacy long-GOP normalization check",$)}let z=S;if(G){const $=v&&v.projectInfo&&typeof v.projectInfo.projectName=="string"&&v.projectInfo.projectName?v.projectInfo.projectName:S;z=eo($,m,g),d=!0}z!==S&&Object.prototype.hasOwnProperty.call(p,z)&&(z=eo(z,m,g)),p[z]=v,O(S,z),b(z),!G&&N&&(d=!0)}else d=!0}),_()}function Kf(e,t){if(!e||typeof e.length!="number"||!E(t))return;const r=new Set(Object.keys(t).map(o=>Be(o))),n=[];for(let o=0;o<e.length;o+=1){const i=e.key(o);if(i&&i.startsWith(Gt)){const s=i.substring(Gt.length);r.has(s)||n.push(i)}}n.forEach(o=>Ee(e,o,"Pruning orphan project shard:"))}function $f(e){if(!e||h&&h.__cineMonolithicProjectCleanupDone)return;const t=e.getItem(pe);if(!t){h&&(h.__cineMonolithicProjectCleanupDone=!0);return}try{const r=JSON.parse(tr(t));r&&yt(e,pe,r)}catch{}Ee(e,pe,"Error clearing project monolithic storage after sharding:",{disableBackup:!1,disableMigrationCleanup:!0}),h&&(h.__cineMonolithicProjectCleanupDone=!0)}function Vf(e,t,r={}){if(e==null||t===void 0||t===null)return!1;const n=T();if(!n)return!1;const{skipCompression:o=!1}=r||{},i=Gt+Be(e),s={};s[e]=t;const c=pf(s,{isAutoBackupKey:Kt})[e];return Ae(n,i,c,`Error saving project shard "${e}":`,{disableCompression:o,forceCompressionOnQuota:!0,disableBackup:!0,onQuotaExceeded:()=>{const{projects:f}=_t({forMutation:!1,skipMigrations:!0});let u=ra(f);if(u||(u=ra(f,{force:!0})),u){const y=Gt+Be(u);return Ee(n,y,`Pruning shard "${u}" to recover space:`),!0}return!1}})==="success"}function oc(e,t={}){const{skipCompression:r=!1}=t||{},n=T();if(!(!e||typeof e!="object")){Xa(e),Kf(n,e),Object.keys(e).forEach(o=>{Vf(o,e[o],{skipCompression:r})}),$f(n),Va(n);try{_o(e,n)}catch(o){console.warn("Failed to update project index",o)}if(cr(),je)try{je.postMessage("project-shards-changed")}catch{}}}let zn=null;function ic(e){if(!e||typeof e!="object")return null;const t={};return Object.keys(e).forEach(n=>{if(typeof n!="string")return;const o=C&&typeof C.getProjectKeyFromStorageKey=="function"?C.getProjectKeyFromStorageKey(n):n;if(o==null)return;const i=e[n];if(!Object.prototype.hasOwnProperty.call(t,o)){t[o]=i;return}const s=t[o],a=i&&typeof i=="object"&&typeof i.lastModified=="number"?i.lastModified:null,c=s&&typeof s=="object"&&typeof s.lastModified=="number"?s.lastModified:null;typeof a=="number"&&typeof c=="number"&&a>c&&(t[o]=i)}),Object.keys(t).length?t:null}function Hf(e){if(!e||typeof e!="object")return null;if(!C||typeof C.getProjectStorageKey!="function")return e;const t={};return Object.keys(e).forEach(r=>{if(typeof r!="string")return;const n=C.getProjectStorageKey(r);t[n]=e[r]}),t}async function kh(){if(!C||typeof C.migrateUnprefixedProjectRecords!="function")return{migratedKeys:[],hasIndex:!1};try{const e=await C.getItem(Rn),t=e&&typeof e=="object"?Object.keys(e):[],r=ic(e),n=await C.migrateUnprefixedProjectRecords({projectIndexKeys:t});if(r){zn=r;const o=Hf(r);o&&await C.setItem(Rn,o)}return{migratedKeys:n.migratedKeys||[],hasIndex:!!r}}catch(e){return console.warn("[storage.js] Project prefix migration failed",e),{migratedKeys:[],hasIndex:!1}}}function _h(){if(zn)return zn;const e=T(),t=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";if(!e||typeof e.getItem!="function"||t)return null;try{const r=e.getItem(Rn);if(!r)return null;const n=JSON.parse(r);if(n&&typeof n=="object")return ic(n)||n}catch(r){console.warn("Failed to read project index",r)}return null}function _o(e,t){if(!e||typeof e!="object")return;const r={};Object.keys(e).forEach(o=>{if(Kt(o))return;const i=e[o];i&&(r[o]={color:i.color,icon:i.icon,lastModified:i.lastModified,prepDays:i.prepDays,shootingDays:i.shootingDays,returnDays:i.returnDays,archived:i.archived,status:i.status})}),zn=r;const n=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";if(C){const o=Hf(r);C.setItem(Rn,o).catch(i=>console.warn("Failed to persist index to repo",i))}if(!n&&t&&typeof t.setItem=="function")try{t.setItem(Rn,JSON.stringify(r))}catch(o){console.warn("Failed to write project index",o)}}function qf(e){const t=e!==void 0&&!(typeof e=="string"&&Kt(e));let{projects:r,changed:n,originalValue:o,lookup:i}=_t({skipAutoBackupExpansion:t}),s=null;if(e!==void 0&&(s=Qr(r,i,e,{preferExact:!0}),s!=null&&us(s)),n){const a=T();a&&yt(a,pe,o);const c=pr(r);oc(c),r=c}if(e===void 0)return gm(r),r;if(s!=null&&Object.prototype.hasOwnProperty.call(r,s)){const a=r[s];if(a&&(!a.gearList||a.gearList==="")){const l=Ko()[s];l&&l.gearList&&(a.gearList=l.gearList)}return a}return null}function jh(){const e=_h();if(e)return e;const t=_t({forMutation:!1,skipAutoBackupExpansion:!0}),r={};if(t&&t.projects){const n=Object.keys(t.projects);for(let i=0;i<n.length;i++){const s=n[i];if(Kt(s))continue;const a=t.projects[s];a&&(r[s]={color:a.color,icon:a.icon,lastModified:a.lastModified,prepDays:a.prepDays,shootingDays:a.shootingDays,returnDays:a.returnDays,archived:a.archived,status:a.status})}const o=T();if(o)try{_o(t.projects,o)}catch{}}return r}function Wf(e){if(typeof e!="string")return"";const t=e.replace(/\s+/g," ").trim();return t?t.length<=120?t:t.slice(0,120):""}function Yf(e){const t=r=>String(r).padStart(2,"0");return[e.getFullYear(),t(e.getMonth()+1),t(e.getDate()),t(e.getHours()),t(e.getMinutes()),t(e.getSeconds())].join("-")}function Ih(e,t){const n=Yf(new Date),o=Wf(e),i=o?`${Pt}${n}-${o}`:`${Pt}${n}`,s=new Set(Object.keys(t));if(!s.has(i))return{name:i};let a=2,c=`${i}-${a}`;for(;s.has(c);)a+=1,c=`${i}-${a}`;return{name:c}}function Jf(e){if(e!==void 0){if(e===null||typeof e!="object")return e;try{const t=pr(e),r=ue(t);return r!==t?r:t}catch(t){console.warn("Unable to deep clone project for backup",t);const r={...e},n=ue(r);return n!==r?n:r}}}function Qf(e,t){if(!e||!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(typeof t=="string"&&t.startsWith(Ue))return{status:"skipped"};const r=e[t];if(r===void 0)return{status:"missing"};const{name:n}=Ih(t,e);if(!n)return{status:"failed"};const o=Jf(r);return o===void 0?(typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipping deletion backup for project "${t}" because no stored data was available during backup creation.`),{status:"missing"}):(e[n]=o,{status:"created",backupName:n})}function vh(e){const{projects:t,changed:r,originalValue:n,lookup:o}=_t({forMutation:!0});if(!t||typeof t!="object")return{status:"invalid"};const i=Qr(t,o,e,{preferExact:!0}),s=Be(e),a=i??s;if(!Object.prototype.hasOwnProperty.call(t,a))return{status:"missing"};const c=Qf(t,a);if(c.status!=="created")return c;if(r){const l=T();l&&yt(l,pe,n)}return us(c.backupName),oc(t),c}function Lh(e,t){const r=Yf(new Date),n=Wf(e),o=n?`${Ue}${r}-${n}`:`${Ue}${r}`,i=new Set(Object.keys(t));if(!i.has(o))return{name:o};let s=2,a=`${o}-${s}`;for(;i.has(a);)s+=1,a=`${o}-${s}`;return{name:a}}function Rh(e,t){if(!E(e)||typeof t!="string")return{status:"invalid"};if(!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(t.startsWith(Ue)||t.startsWith(Pt))return{status:"skipped"};const r=Jf(e[t]);if(r===void 0)return{status:"failed"};const{name:n}=Lh(t,e);return n?(e[n]=r,{status:"created",backupName:n}):{status:"failed"}}function sc(e,t,r={}){if(!E(t))return;const n=$e(t);if(!n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped saving project "${e||""}" because the payload could not be normalised.`);return}const o=!!(r&&r.skipOverwriteBackup),i=!!(r&&r.skipCompression),s=typeof e=="string"?e:"",a=Be(s),c=_t({forMutation:!0}),l=E(c.projects)?c.projects:{};if(c.changed){const S=T();S&&yt(S,pe,c.originalValue)}const f=Qr(l,c.lookup,s,{preferExact:!0}),u=f!=null&&Object.prototype.hasOwnProperty.call(l,f)?l[f]:null,y=u?Pe(u):null,p=_t({forMutation:!0}),d=E(p.projects)?p.projects:{};if(p.changed){const S=T();S&&yt(S,pe,p.originalValue)}const m=Qr(d,p.lookup,s,{preferExact:!0});let g=m,b=null;a&&a!==m&&!Object.prototype.hasOwnProperty.call(d,a)&&(g=a,b=m),g==null&&(g=a),!g&&g!==""&&(g="");const P=b??g,A=P!=null&&Object.prototype.hasOwnProperty.call(d,P),O=A?d[P]:null;if(A&&!o){const S=Pe(O),v=Pe(n);S!==v&&Rh(d,P).status==="failed"&&console.warn(`Automatic backup before overwriting project "${P}" failed. Proceeding with save.`)}if(b!=null&&b!==g){let S=!!y;Object.prototype.hasOwnProperty.call(d,b)&&y?Pe(d[b])!==y&&(S=!1):S=!1,S?(delete d[b],Zs(b)):typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped removing "${b}" while saving "${g}" because the original entry changed in another tab.`)}const k=r&&r.renamedFrom;if(k&&k!==g){const S=Qr(d,p.lookup,k,{preferExact:!0});S&&Object.prototype.hasOwnProperty.call(d,S)&&(delete d[S],Zs(S))}const _=g||"";d[_]=n,us(_),Xa(d),C&&C.saveProject(_,n).catch(S=>console.warn("[saveProject] Repo write failed",S)),ar&&(Ve[_]=n);const I=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";let w=!0;if((!I||!ar)&&(w=Vf(_,n,{skipCompression:i})),w){const S=T();if(Kf(S,d),$f(S),cr(),je)try{je.postMessage("project-shards-changed")}catch{}Va(S)}else oc(d,{skipCompression:i})}function Xf(e){if(e===void 0){const u=[T()];typeof localStorage<"u"&&u.indexOf(localStorage)===-1&&u.push(localStorage),u.forEach(p=>{if(p&&typeof p.removeItem=="function")try{p.removeItem(pe);const d=typeof he=="string"?he:"__backup";p.removeItem(`${pe}${d}`),p.removeItem("cameraPowerPlanner_project__backup")}catch(d){console.warn("[FactoryReset] Failed to force delete project keys",d)}if(Ee(p,pe,"Error deleting project from storage:"),p&&typeof p.length=="number"){const d=[];for(let m=0;m<p.length;m++){const g=p.key(m);g&&g.startsWith(Gt)&&d.push(g)}d.forEach(m=>Ee(p,m,"Error deleting project shard from storage:"))}});try{C&&C.clear().catch(p=>console.warn("[FactoryReset] Failed to clear StorageRepository",p)),Hs&&Hs.clear().catch(p=>console.warn("[FactoryReset] Failed to clear DataVault",p)),ze&&ze.reset()}catch(p){console.warn("[FactoryReset] Error clearing modern storage",p)}if(typeof rn=="function")try{rn()}catch(p){console.warn("Failed to clear UI cache during project deletion",p)}if(cr(),je)try{je.postMessage("project-shards-changed")}catch{}Rr&&typeof Rr.clear=="function"&&Rr.clear();const y=T();y&&Va(y);return}const{projects:t,changed:r,originalValue:n,lookup:o}=_t({forMutation:!0});if(r){const u=T();u&&yt(u,pe,n)}const i=Qr(t,o,e,{preferExact:!0}),s=i??Be(e);if(!Object.prototype.hasOwnProperty.call(t,s)){const u=Gt+Be(e),y=T();y&&Ee(y,u,"Error deleting orphan project shard:");return}if(Qf(t,s).status==="failed"){console.warn(`Automatic backup before deleting project "${s}" failed. Deletion aborted.`),ce();return}const c=Gt+Be(s),l=T(),f=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";if(l&&!f&&Ee(l,c,"Error deleting project shard:"),ar&&delete Ve[s],C&&typeof C.removeProject=="function"?C.removeProject(s).catch(u=>console.warn("Failed to delete from repo",u)):C&&C.removeItem(s).catch(u=>console.warn("Failed to delete from repo",u)),delete t[s],Zs(s),cr(),je)try{je.postMessage("project-shards-changed")}catch{}}function Th(e,t){if(!e||!t)return null;const{projects:r}=_t({forMutation:!0}),n=Qr(r,null,e,{preferExact:!0});if(!n||!r[n])return null;const o=t.trim();if(!o||o===n)return n;const i=r[n];if(i.name=o,E(i.projectInfo)||(i.projectInfo={}),i.projectInfo.projectName=o,ar?(delete Ve[n],Ve[o]=i):(delete r[n],r[o]=i),C&&typeof C.removeProject=="function"?C.removeProject(n).catch(s=>console.warn("Failed to delete old project key",s)):C&&C.removeItem(n).catch(s=>console.warn("Failed to delete old project key",s)),sc(o,i),cr(),je)try{je.postMessage("project-shards-changed")}catch{}return o}function sl(){const{projects:e,changed:t,originalValue:r}=_t({forMutation:!0});if(t){const s=T();s&&yt(s,pe,r)}const n=new Set(Object.keys(e)),o=new Set([...n].map(s=>s.trim().toLowerCase())),i="Imported project";return(s,a,c=i)=>{const l=$e(a);if(!l)return;!(a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"gearListAndProjectRequirementsGenerated")&&typeof a.gearListAndProjectRequirementsGenerated=="boolean")&&typeof l.gearListAndProjectRequirementsGenerated!="boolean"&&(l.gearListAndProjectRequirementsGenerated=!1);const u=[];if(typeof s=="string"&&u.push(s.trim()),E(a)){typeof a.name=="string"&&u.push(a.name.trim());const g=a.projectInfo;E(g)&&typeof g.projectName=="string"&&u.push(g.projectName.trim())}const y=typeof c=="string"&&c.trim()?c.trim():i,p=u.length>0?u[0]:y,d=typeof p=="string"?p.trim().toLowerCase():"",m=o.has(d)?Xm(p,n,o):fs(p,n,o);sc(m,l,{skipCompression:!1}),n.add(m),o.add(m.trim().toLowerCase())}}function Oe(e){if(typeof e!="string")return{success:!1,parsed:null};const t=e.trim();if(!t)return{success:!1,parsed:null};const r=t[0],n=t[t.length-1];let o=null;if(r==="{"?o="}":r==="["?o="]":r==='"'&&(o='"'),!o||n!==o)return{success:!1,parsed:null};try{return{success:!0,parsed:JSON.parse(t)}}catch{return{success:!1,parsed:null}}}function go(e,t,r="Imported project"){if(typeof e=="string"){const n=Oe(e);return n.success?go(n.parsed,t,r):(t()(r,e,r),!0)}if(re(e)){const n=ne(e);return n?go(Object.entries(n),t,r):!1}if(Array.isArray(e)){const n=e.map(s=>{if(s==null)return null;if(Array.isArray(s)&&s.length>=2)return{name:s[0],project:s[1]};if(E(s)&&typeof s.name=="string"){const a=Object.prototype.hasOwnProperty.call(s,"project")?s.project:s;return{name:s.name,project:a}}return{name:"",project:s}}).filter(Boolean);if(!n.length)return!0;const o=t();let i=0;return n.forEach(({name:s,project:a})=>{if(a==null)return;i+=1;let c="";typeof s=="string"?c=s:typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"?c=String(s):typeof s=="symbol"&&(c=s.description||s.toString()),o(c,a,`${r} ${i}`)}),!0}if(E(e)){const n=t();return Object.entries(e).forEach(([o,i])=>{const s=typeof o=="string"?o:kf(o);n(typeof s=="string"&&s?s:r,i,r)}),!0}return!1}function Mh(e){if(!e||typeof e!="object")return[];const t=[],r=i=>{i!=null&&t.push(i)};["projectData","projectCollection","projectEntries","legacyProjects","legacyProjectData"].forEach(i=>{Object.prototype.hasOwnProperty.call(e,i)&&r(e[i])}),E(e.data)&&(Object.prototype.hasOwnProperty.call(e.data,"project")&&r(e.data.project),Object.prototype.hasOwnProperty.call(e.data,"projects")&&r(e.data.projects));const o=e.plannerData;return Array.isArray(o)&&o.forEach(i=>{if(Array.isArray(i)&&i.length>=2){const c=i[0];typeof c=="string"&&c.toLowerCase().includes("project")&&r(i[1]);return}if(!i||typeof i!="object")return;const s=typeof i.key=="string"?i.key:typeof i.name=="string"?i.name:typeof i.id=="string"?i.id:typeof i.section=="string"?i.section:null;if(!s||!s.toLowerCase().includes("project"))return;const a=Object.prototype.hasOwnProperty.call(i,"value")?i.value:Object.prototype.hasOwnProperty.call(i,"data")?i.data:Object.prototype.hasOwnProperty.call(i,"project")?i.project:Object.prototype.hasOwnProperty.call(i,"projects")?i.projects:null;a!=null&&r(a)}),t}function Zf(){ke();const e=T(),t=Me(e,et,"Error loading favorites from localStorage:",{},{validate:r=>r===null||E(r)});return E(t)?t:{}}function ep(e){const t=T();if(e==null){Ee(t,et,"Error deleting favorites from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid favorites payload. Expected a plain object.");return}qe(t,et),Ae(t,et,e,"Error saving favorites to localStorage:")}function Nh(){if(jt||(zc||(zc=!0,Ln&&(jt=Ln)),jt))return jt;const e=h&&typeof h=="object"?h:null;if(e&&e.cineFeaturesContacts&&typeof e.cineFeaturesContacts=="object")return jt=e.cineFeaturesContacts,jt;const t=e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null;if(t&&typeof t.resolveModule=="function")try{const r=t.resolveModule("cine.features.contacts",e);if(r&&typeof r=="object")return jt=r,jt}catch{}return jt}function tp(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return tp(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Gh(e){if(e&&typeof e.generateContactId=="function")try{const t=e.generateContactId();if(typeof t=="string"&&t)return t}catch{}return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function zh(e,t){if(!e||typeof e!="object")return null;const r=tp,n=r(e.id)||Gh(t),o=r(e.name),i=r(e.role),s=r(e.phone),a=r(e.email),c=r(e.website||e.url),l=r(e.notes||e.note||e.text),f=typeof e.avatar=="string"?e.avatar.trim():"",u=f&&f.startsWith("data:")?f:"",y=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),p=Number.isFinite(e.updatedAt)?e.updatedAt:y,d={id:n,name:o,role:i,phone:s,email:a,website:c,notes:l,createdAt:y,updatedAt:p};return u&&(d.avatar=u),d}function Bh(e){if(!Array.isArray(e))return[];const t=e.filter(r=>r&&typeof r=="object").map(r=>({...r}));return t.sort((r,n)=>{const o=(r&&r.name?r.name:"").toLowerCase(),i=(n&&n.name?n.name:"").toLowerCase();if(o&&i&&o!==i)try{return o.localeCompare(i)}catch{}if(o&&!i)return-1;if(!o&&i)return 1;const s=r&&typeof r.createdAt=="number"?r.createdAt:0,a=n&&typeof n.createdAt=="number"?n.createdAt:0;return s-a}),t}function ac(e){if(!Array.isArray(e))return[];const t=Nh();if(t&&typeof t.sortContacts=="function")try{const o=t.sortContacts(e);if(Array.isArray(o))return o.filter(i=>i&&typeof i=="object")}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contacts via module.",o)}const r=t&&typeof t.normalizeContactEntry=="function"?t.normalizeContactEntry:null,n=[];for(let o=0;o<e.length;o+=1){const i=e[o];if(!i)continue;let s=null;if(r)try{s=r(i)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contact entry via module.",a),s=null}s||(s=zh(i,t)),s&&typeof s=="object"&&n.push(s)}return Bh(n)}function rp(){ke();const e=T(),t=Me(e,tt,"Error loading contacts from localStorage:",[],{validate:r=>r===null||Array.isArray(r)});return Array.isArray(t)?ac(t):[]}function la(e){const t=T();if(e==null){Ee(t,tt,"Error deleting contacts from localStorage:");return}if(!Array.isArray(e)){console.warn("Ignoring invalid contacts payload. Expected an array.");return}const r=ac(e);qe(t,tt),Ae(t,tt,r,"Error saving contacts to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function xh(){return Uu.getOwnGear()}function np(e){return Uu.saveOwnGear(e)}function dn(e){if(typeof e=="string")return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="bigint")return e.toString();if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return dn(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function cc(e){if(!e||typeof e!="object")return null;const t=dn(e.name),r=dn(e.role),n=dn(e.avatar),o=n&&n.toLowerCase().startsWith("data:")?n:"",i=dn(e.phone),s=dn(e.email);return!t&&!r&&!o&&!i&&!s?{name:"",role:"",avatar:"",phone:"",email:""}:{name:t,role:r,avatar:o,phone:i,email:s}}function op(){ke();const e=T(),t=Me(e,ct,"Error loading user profile from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?cc(t)||{name:"",role:"",avatar:"",phone:"",email:""}:{name:"",role:"",avatar:"",phone:"",email:""}}function hi(e){const t=T();if(e==null){Ee(t,ct,"Error deleting user profile from localStorage:");return}const r=cc(e)||{name:"",role:"",avatar:"",phone:"",email:""};if(!r.name&&!r.role&&!r.avatar&&!r.phone&&!r.email){Ee(t,ct,"Error deleting user profile from localStorage:");return}qe(t,ct),Ae(t,ct,r,"Error saving user profile to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,enableCompressionSweep:!1})}function ip(){ke();const e=T(),t=Me(e,Lr,"Error loading feedback from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?t:{}}function sp(e){const t=T();if(e==null){Ee(t,Lr,"Error deleting feedback from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid feedback payload. Expected a plain object.");return}qe(t,Lr),Ae(t,Lr,e,"Error saving feedback to localStorage:")}function Xr(e){if(!e)return null;if(typeof e=="string"){const t=e.trim();return t?{createdAt:t}:null}if(typeof e=="object"){const t=typeof e.createdAt=="string"&&e.createdAt.trim()?e.createdAt.trim():typeof e.iso=="string"&&e.iso.trim()?e.iso.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?e.timestamp.trim():null;if(!t)return null;const r={createdAt:t};return typeof e.fileName=="string"&&e.fileName.trim()?r.fileName=e.fileName.trim():typeof e.name=="string"&&e.name.trim()&&(r.fileName=e.name.trim()),r}return null}function jo(e=!1){if(!e&&rr!==null){const o=rr;if(Array.isArray(o))return o.map(Xr).filter(Boolean)}ke();const t=T(),r=Me(t,Fe,"Error loading full backup history from localStorage:",[],{validate:o=>o===null||Array.isArray(o)});if(!Array.isArray(r))return[];const n=r.map(Xr).filter(Boolean);return rr=n,C.setItem(Fe,n).catch(o=>{console.warn("[storage.js] Failed to persist backup history to new storage:",o)}),n}function Ki(e){const t=T();if(e==null){rr=[],Ee(t,Fe,"Error deleting full backup history from localStorage:"),C.removeItem(Fe).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)});return}if(!Array.isArray(e)){console.warn("Ignoring invalid full backup history payload. Expected an array.");return}const r=e.map(Xr).filter(Boolean);if(!r.length){e.length===0?(rr=[],Ee(t,Fe,"Error deleting full backup history from localStorage:"),C.removeItem(Fe).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)})):console.warn("Ignoring full backup history update because no valid entries were provided.");return}rr=r,qe(t,Fe),Ae(t,Fe,r,"Error saving full backup history to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0}),C.setItem(Fe,r).catch(n=>{console.warn("[storage.js] Failed to persist backup history to new storage:",n)})}var ap=e=>{const t=Xr(e);if(!t)return jo();const r=jo();r.push(t);const n=r.slice(-200);return Ki(n),n};function Yt(e,t,r=0){if(e==null)return[];if(r>50)return[];if(Array.isArray(e)){const o=[],i=e.length,s=t||new WeakSet;if(s.has(e))return[];s.add(e);for(let a=0;a<i;a+=1){const c=e[a];if(!(typeof c=="object"&&c!==null&&s.has(c)))if(Array.isArray(c)){const l=Yt(c,s,r+1);if(l&&l.length)for(let f=0;f<l.length;f+=1)o.push(l[f])}else{const l=Xr(c);l&&o.push(l)}}return o}const n=t||new WeakSet;if(typeof e=="object"&&e!==null){if(n.has(e))return[];n.add(e)}if(re(e)){const o=ne(e);return o?Yt(Object.values(o),n,r+1):[]}if(typeof e=="string"){const o=Oe(e);if(o.success)return Yt(o.parsed,n,r+1);const i=Xr(e);return i?[i]:[]}if(Array.isArray(e))return[];if(E(e)){if(Array.isArray(e.history))return Yt(e.history,n,r+1);if(Array.isArray(e.entries))return Yt(e.entries,n,r+1);if(Array.isArray(e.list))return Yt(e.list,n,r+1);const o=Xr(e);if(o)return[o];const i=Object.values(e);if(i.length)return Yt(i,n,r+1)}return[]}var $i=1;function Fh(){var e=0;if(typeof Date<"u"&&Date&&typeof Date.now=="function")e=Date.now();else try{e=new Date().getTime()}catch{e=Math.floor(Math.random()*1e9)}var t=0;try{t=Math.floor(Math.random()*1e6)}catch{t=e%1e6}return"doc-tracker-"+e.toString(36)+"-"+t.toString(36)}function al(e){var t=!1,r=null;if(e&&typeof e=="object"){typeof e.completed=="boolean"?t=e.completed:typeof e.checked=="boolean"?t=e.checked:typeof e.value=="boolean"?t=e.value:e.done===!0&&(t=!0);var n=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?n=e.updatedAt.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?n=e.timestamp.trim():typeof e.completedAt=="string"&&e.completedAt.trim()&&(n=e.completedAt.trim()),n&&(r=n)}else if(typeof e=="boolean")t=e;else if(typeof e=="string"){var o=e.trim().toLowerCase();(o==="true"||o==="1"||o==="yes"||o==="done")&&(t=!0)}return{completed:t===!0,updatedAt:typeof r=="string"?r:null}}function Uh(e){var t={};if(Array.isArray(e)){for(var r=0;r<e.length;r+=1){var n=e[r];if(n!=null){if(typeof n=="string"&&n.trim()){t[n.trim()]={completed:!0,updatedAt:null};continue}if(typeof n=="object"){var o=null;if(typeof n.id=="string"&&n.id.trim()?o=n.id.trim():typeof n.key=="string"&&n.key.trim()?o=n.key.trim():typeof n.name=="string"&&n.name.trim()&&(o=n.name.trim()),!o)continue;t[o]=al(n)}}}return t}if(e&&(typeof e=="object"||typeof e=="function"))for(var i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(a!=null){var c=typeof a=="string"?a:String(a);if(c){var l=c.trim();l&&(t[l]=al(e[a]))}}}return t}function Dh(e){var t={};if(e&&(typeof e=="object"||typeof e=="function"))for(var r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n];o&&(t[o]=Uh(e[o]))}return t.locales||(t.locales={}),t.helpTopics||(t.helpTopics={}),t.printGuides||(t.printGuides={}),t}function cl(e){if(!e||typeof e!="object"&&typeof e!="function")return null;var t=null;typeof e.id=="string"&&e.id.trim()&&(t=e.id.trim()),!t&&typeof e.key=="string"&&e.key.trim()&&(t=e.key.trim()),t||(t=Fh());var r="";typeof e.name=="string"?r=e.name.trim():typeof e.title=="string"&&(r=e.title.trim());var n="";typeof e.targetDate=="string"&&e.targetDate.trim()?n=e.targetDate.trim():typeof e.releaseDate=="string"&&e.releaseDate.trim()&&(n=e.releaseDate.trim());var o="";if(typeof e.createdAt=="string"&&e.createdAt.trim()?o=e.createdAt.trim():typeof e.generatedAt=="string"&&e.generatedAt.trim()&&(o=e.generatedAt.trim()),!o)try{o=new Date().toISOString()}catch{o=""}var i=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?i=e.updatedAt.trim():typeof e.modifiedAt=="string"&&e.modifiedAt.trim()?i=e.modifiedAt.trim():typeof e.lastUpdated=="string"&&e.lastUpdated.trim()?i=e.lastUpdated.trim():typeof e.timestamp=="string"&&e.timestamp.trim()&&(i=e.timestamp.trim()),i||(i=o||null);var s="";typeof e.notes=="string"?s=e.notes.trim():typeof e.summary=="string"&&(s=e.summary.trim()),s&&s.length>8e3&&(s=s.slice(0,8e3));var a=!1;if(typeof e.archived=="boolean")a=e.archived;else if(typeof e.status=="string"){var c=e.status.trim().toLowerCase();(c==="archived"||c==="closed"||c==="complete")&&(a=!0)}var l=Dh(e.statuses);return{id:t,name:r,targetDate:n,createdAt:typeof o=="string"?o:"",updatedAt:typeof i=="string"?i:null,statuses:l,notes:s,archived:a===!0}}function mo(e){var t={version:$i,releases:[]};if(e==null)return t;var r=e;if(Array.isArray(r))return t.releases=r.map(cl).filter(Boolean),t;if(typeof r!="object"&&typeof r!="function")return t;typeof r.version=="number"&&Number.isFinite(r.version)&&(t.version=r.version);var n=null;if(Array.isArray(r.releases)?n=r.releases:Array.isArray(r.entries)?n=r.entries:Array.isArray(r.logs)&&(n=r.logs),!n&&r&&typeof r=="object"){var o=Object.values(r);o.length&&o.every(function(i){return i&&typeof i=="object"&&!Array.isArray(i)})&&(n=o)}return!n||!Array.isArray(n)?t.releases=[]:t.releases=n.map(cl).filter(Boolean),t}function cp(){ke();const e=T(),t=Me(e,jr,"Error loading documentation tracker from localStorage:",null,{validate:n=>n===null||E(n)||Array.isArray(n)});if(!t)return{version:$i,releases:[]};const r=mo(t);return!r||!Array.isArray(r.releases)?{version:$i,releases:[]}:r}function bi(e){const t=T();if(e==null){Ee(t,jr,"Error deleting documentation tracker from localStorage:");return}const r=mo(e);if(!r.releases.length){Ee(t,jr,"Error deleting documentation tracker from localStorage:");return}qe(t,jr),Ae(t,jr,{version:$i,releases:r.releases},"Error saving documentation tracker to localStorage:",{disableCompression:!0})}function lp(){ke();const e=T(),t=Me(e,Gr,"Error loading automatic gear rules from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?ue(r):[];if(n!==r&&lc(n,{skipNormalization:!0}),Array.isArray(n)){let o=!1;const i=n.map(s=>s&&typeof s=="object"&&typeof s.enabled>"u"?(o=!0,{...s,enabled:!0}):s);return o?i:n}return[]}function lc(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],i=n?o:Array.isArray(o)?ue(o):[],s=T();return qe(s,Gr),Ae(s,Gr,i,"Error saving automatic gear rules to localStorage:",{disableCompression:!0}),i}function uc(){if(ke(),Array.isArray(mn)&&mn.length){const{normalized:i,changed:s}=Bi(mn);return s&&Vi(i,{skipNormalization:!0}),i}const e=T(),t=Me(e,ut,"Error loading automatic gear rule backups from localStorage:",[],{validate:i=>i===null||Array.isArray(i)}),r=Array.isArray(t)?t:[],{normalized:n,changed:o}=Bi(r);return o&&Vi(n,{skipNormalization:!0}),mn=n,n}function Vi(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],{normalized:i}=n?{normalized:o}:Bi(o);mn=i;const s=T();qe(s,ut);let a=!1,c=!1;if(typeof window<"u"&&window.localStorage===s){const f=typeof C<"u"&&C.driver&&C.driver.constructor.name==="IndexedDBAdapter";typeof C<"u"&&C.setItem(ut,i).catch(u=>{if(console.warn("[Storage] Failed to async persist Auto Gear Backups to IDB:",u),f)try{Ae(s,ut,i,"Error saving automatic gear rule backups to localStorage:")}catch(y){console.warn("[Storage] Failed to persist Auto Gear Backups fallback to localStorage:",y)}})}if(!(typeof C<"u"&&C.driver&&C.driver.constructor.name==="IndexedDBAdapter"))return Ae(s,ut,i,"Error saving automatic gear rule backups to localStorage:",{onQuotaExceeded:(f,u={})=>{const y=na(i);if(y){const d=y.label;return console.warn(d?`Removed automatic gear backup "${d}" to free up storage space before saving gear backups.`:"Removed oldest automatic gear backup entry to free up storage space before saving gear backups."),!0}const p=u&&u.storage?u.storage:s;return!!(!a&&(a=!0,Km(p))||!c&&(c=!0,oa()))}}),i}function up(){ke();const e=T();return vf(e,nn,"Error loading automatic gear seed flag from localStorage:")}function ua(e){const t=T();Lf(t,nn,!!e,"Error saving automatic gear seed flag to localStorage:")}function fp(){ke();const e=T(),t=Me(e,xt,"Error loading automatic gear presets from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?ue(r):[];return n!==r&&ps(n,{skipNormalization:!0}),Array.isArray(n)?n:[]}let Hi=null,ho=null,bo=null,mn=null,qi=null,Wi=null,Io=null,vo=null,Lo=null,Ro=null,To=null,Bn=null,Mo=null,No=null,Go=null,Kr=null,zo=null,rr=null;function Kh(){const e=new Set,t=r=>{if(typeof r=="string"){const n=r.trim();n&&e.add(n)}};if(typeof Yi=="function")try{t(Yi())}catch(r){console.warn("Unable to read automatic gear active preset id while evaluating compression policy.",r)}if(typeof Ji=="function")try{t(Ji())}catch(r){console.warn("Unable to read automatic gear auto preset id while evaluating compression policy.",r)}return e}function ps(e,t={}){const r=t||{},{skipNormalization:n=!1,disableCompression:o}=r,i=Array.isArray(e)?e.slice():[],s=n?i:Array.isArray(i)?ue(i):[],a=T();qe(a,xt);let c=typeof o=="boolean"?o:!1;if(o===void 0){const l=Kh();l.size>0&&(c=s.some(f=>f&&typeof f=="object"&&typeof f.id=="string"&&l.has(f.id)))}return C&&C.setItem(xt,s).catch(l=>console.warn("Failed to save auto gear presets to repo",l)),Ae(a,xt,s,"Error saving automatic gear presets to localStorage:",c?{disableCompression:!0}:void 0),s}function pp(){if(Hi)return Hi;ke();const e=T(),t=Me(e,Ft,"Error loading automatic gear monitor defaults from localStorage:",{},{validate:o=>o===null||typeof o=="object"}),r=t&&typeof t=="object"?t:{},n=E(r)?ue(r):{};return n!==r&&fc(n,{skipNormalization:!0}),n&&typeof n=="object"?n:{}}function fc(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=e&&typeof e=="object"?{...e}:{},i=n?o:E(o)?ue(o):{},s=T();return qe(s,Ft),Hi=i,C&&C.setItem(Ft,i).catch(c=>console.warn("Failed to save monitor defaults to repo",c)),C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter"||Ae(s,Ft,i,"Error saving automatic gear monitor defaults to localStorage:"),i}function ll(e,t){if(!e)return;const r=t||T();if(!r)return;let n;try{n=r.getItem(xt)}catch(a){console.error("Error loading automatic gear presets while removing autosaved preset from localStorage:",a),be("read access",a,r),ce();return}if(n===null||typeof n>"u")return;let o,i=n;typeof n=="string"&&n&&(i=sn(n));try{o=JSON.parse(i)}catch(a){console.error("Error parsing automatic gear presets while removing autosaved preset from localStorage:",a);return}if(!Array.isArray(o))return;const s=o.filter(a=>!a||typeof a!="object"?!0:a.id!==e);s.length!==o.length&&ps(s,{skipNormalization:!0})}function Yi(){if(ho!==null)return typeof ho=="string"?ho:"";ke();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(Ot);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear active preset from localStorage:",t),be("read access",t,e),ce(),""}}function dp(e){if(ho=e||"",C&&(e?C.setItem(Ot,e).catch(n=>console.warn("Failed to save active preset id",n)):C.removeItem(Ot).catch(n=>console.warn("Failed to remove active preset id",n))),C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter")return;const r=T();if(r)try{e?r.setItem(Ot,e):r.removeItem(Ot)}catch(n){console.error("Error saving automatic gear active preset to localStorage:",n),be("write access",n,r),ce()}}function Ji(){if(bo!==null)return typeof bo=="string"?bo:"";ke();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(Qe);if(typeof t=="string"&&t)return t;const r=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(console.log("DEBUG: loadAutoGearAutoPresetId legacy check, legacyStorage exists:",!!r),r&&r.getItem){let n=r.getItem("cinePowerPlanner_autoGearAutoPreset");if(console.log("DEBUG: legacyValue for cinePowerPlanner_autoGearAutoPreset:",n),typeof n=="string"&&n||(n=r.getItem(Qe),typeof n=="string"&&n))return n}return""}catch(t){return console.error("Error loading automatic gear auto preset from localStorage:",t),be("read access",t,e),ce(),""}}function yp(e){bo=e||"",C&&(e?C.setItem(Qe,e).catch(n=>console.warn("Failed to save auto preset id",n)):C.removeItem(Qe).catch(n=>console.warn("Failed to remove auto preset id",n))),C&&C.driver&&C.driver.constructor&&C.driver.constructor.name;const t=T();if(!t)return;let r="";try{const n=t.getItem(Qe);typeof n=="string"&&n&&(r=n)}catch(n){console.error("Error inspecting automatic gear auto preset in localStorage:",n),be("read access",n,t)}try{e?(t.setItem(Qe,e),r&&r!==e&&ll(r,t)):(t.removeItem(Qe),r&&ll(r,t))}catch(n){console.error("Error saving automatic gear auto preset to localStorage:",n),be("write access",n,t),ce()}}function gp(){if(Wi!==null)return!!Wi;ke();const e=T();return vf(e,lr,"Error loading automatic gear backup visibility from localStorage:")}function mp(e){Wi=!!e,C&&C.setItem(lr,!!e).catch(r=>console.warn("Failed to save visibility",r));const t=T();Lf(t,lr,!!e,"Error saving automatic gear backup visibility to localStorage:")}function hp(){const t=Number(Dg);if(!Number.isFinite(t))return gn;const r=Math.round(t);return Number.isFinite(r)?r<at?at:r>gn?gn:r:gn}function hn(e){const t=Number(e);if(!Number.isFinite(t))return Bo();const r=Math.round(t);if(!Number.isFinite(r))return Bo();if(r<at)return at;const n=hp();return r>n?n:r}function Bo(){const e=hp();if(h&&typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=="number"){const r=h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT;if(Number.isFinite(r)&&r>=at){const n=Math.round(r);return Number.isFinite(n)?n<at?at:n>e?e:n:e}}const t=Math.round(uf);return Number.isFinite(t)?t>e?e:t<at?at:t:at}function So(e,t=Bo()){if(e==null)return t;if(typeof e=="number")return hn(e);if(typeof e=="string"){const r=e.trim();if(!r)return t;const n=Number(r);if(Number.isFinite(n))return hn(n);const o=Oe(r);return o&&o.success?So(o.parsed,t):t}if(Array.isArray(e)){for(let r=0;r<e.length;r+=1){const n=So(e[r],null);if(typeof n=="number"&&Number.isFinite(n))return hn(n)}return t}if(E(e)){const r=["value","retention","limit","count"];for(let n=0;n<r.length;n+=1){const o=r[n];if(!Object.prototype.hasOwnProperty.call(e,o))continue;const i=So(e[o],null);if(typeof i=="number"&&Number.isFinite(i))return hn(i)}return t}return t}function bp(){if(qi!==null)return qi;ke();const e=T(),t=Me(e,Ut,"Error loading automatic gear backup retention from localStorage:",Bo(),{validate:r=>r===null||typeof r=="number"||typeof r=="string"||Array.isArray(r)||E(r)});return So(t)}function Sp(e){if(e==null||typeof e=="function"||typeof e=="object"&&!Array.isArray(e)&&!E(e))return;const t=T(),r=So(e);qi=r,C&&C.setItem(Ut,r).catch(n=>console.warn("Failed to save backup retention",n)),qe(t,Ut),Ae(t,Ut,r,"Error saving automatic gear backup retention to localStorage:")}async function $h(){const e=T(),t=(r,n)=>{if(r){if(typeof r.clear=="function")try{r.clear()}catch{}try{const o=[];try{for(let i=0;i<r.length;i++){const s=r.key(i);s&&o.push(s)}}catch(i){}try{Object.keys(r).forEach(i=>{i&&!o.includes(i)&&o.push(i)})}catch(i){}o.forEach(i=>{if(i!==At)try{r.removeItem(i)}catch(s){}})}catch{}}};t(e),typeof localStorage<"u"&&localStorage!==e&&t(localStorage),typeof sessionStorage<"u"&&t(sessionStorage);try{typeof globalThis<"u"&&(globalThis.__cameraPowerPlannerFactoryResetting=!0),typeof global<"u"&&(global.__cameraPowerPlannerFactoryResetting=!0),typeof window<"u"&&(window.__cameraPowerPlannerFactoryResetting=!0),h&&(h.__cameraPowerPlannerFactoryResetting=!0,h.__cineMonolithicProjectCleanupDone=!1),typeof sessionStorage<"u"&&sessionStorage.setItem(At,"true"),typeof localStorage<"u"&&localStorage.setItem(At,"true")}catch{}if(je)try{je.postMessage("factory-reset")}catch{}try{Xf()}catch(r){console.warn("Unable to clear stored projects",r)}cr(),Ct&&typeof Ct.clear=="function"&&Ct.clear(),Array.isArray(Pr)&&(Pr.length=0);try{let r=null;if(h&&typeof h.clearBackupVault=="function"?r=h.clearBackupVault:typeof window<"u"&&typeof window.clearBackupVault=="function"?r=window.clearBackupVault:h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup.clearBackupVault=="function"&&(r=h.cineFeatureBackup.clearBackupVault),r&&await r(),typeof indexedDB<"u"){const n=["cinePowerPlannerBackupVault","cinePowerPlanner","cameraPowerPlanner"];if(typeof indexedDB.databases=="function")try{(await indexedDB.databases()).forEach(i=>{i.name&&!n.includes(i.name)&&n.push(i.name)})}catch(o){}await Promise.all(n.map(o=>new Promise(i=>{try{const s=indexedDB.deleteDatabase(o);s.addEventListener("success",()=>i()),s.addEventListener("error",()=>{console.warn(`Failed to delete IndexedDB database "${o}"`,s.error),i()}),s.addEventListener("blocked",()=>i())}catch{i()}})))}}catch(r){console.warn("Failed to clear backup vault",r)}if(typeof caches<"u"&&typeof caches.keys=="function")try{const r=await caches.keys();await Promise.all(r.map(function(n){return caches.delete(n)}))}catch(r){console.warn("Storage reset: Failed to clear Service Worker caches.",r)}}function ge(e){if(e===Zt&&Io)return Io;if(e===rt&&vo)return vo;if(e===Nt&&Lo)return Lo;if(e===Re&&Ro)return Ro;if(e===tt&&To)return To;if(e===Mt&&Bn)return Bn;if(e===ct&&Mo)return Mo;if(e===et&&No)return No;if(e===lt&&Go)return Go;if(e===Je&&Kr)return Kr;if(e===Bt()&&zo)return zo;const t=T();if(!t||typeof t.getItem!="function")return null;const r=kt(e);for(let o=0;o<r.length;o+=1){const i=r[o];try{const s=t.getItem(i);if(s==null){if(vt.has(i))try{const a=t.getItem(`${i}${he}`);if(a!=null){const c=tr(a);return typeof c=="string"?c:String(a)}}catch(a){console.warn("Unable to read backup key for export",i,a),be("read access",a,t)}}else{const a=tr(s);return typeof a=="string"?a:String(s)}}catch(s){console.warn("Unable to read storage key for backup",i,s),be("read access",s,t)}}if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown"].includes(e)){const o=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(o&&typeof o.getItem=="function")try{const i=o.getItem(e);if(i!=null)return tr(i)}catch(i){console.warn("Unable to read preference from legacy localStorage",e,i)}}return null}function Ur(e){if(e==null)return null;if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isNaN(e)?null:e!==0;const t=String(e).trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}function pc(e){if(e==null)return null;let t=null,r=e;if(typeof e=="string"){const c=e.trim();if(!c)return null;t=c;try{r=JSON.parse(c)}catch{return{normalized:null,serialized:t}}}if(!r||typeof r!="object")return t?{normalized:null,serialized:t}:null;const n=typeof r.sections=="object"&&r.sections!==null,o=n?r.sections:r,i={};if(o&&typeof o=="object"){const c=Object.keys(o);for(let l=0;l<c.length;l+=1){const f=c[l],u=o[f];typeof u=="boolean"&&(i[f]=u)}}let s=null;if(typeof r.layout=="string"){const c=r.layout.trim();c&&(s=c)}s||(s=n?"standard":"rental");const a={sections:i,layout:s};if(n){const c=Object.keys(r);for(let l=0;l<c.length;l+=1){const f=c[l];f==="sections"||f==="layout"||(a[f]=Nr(r[f]))}}return{normalized:a,serialized:t}}function Vh(){const e={},t=Ur(ge("darkMode"));t!==null&&(e.darkMode=t);const r=Ur(ge("pinkMode"));r!==null&&(e.pinkMode=r);const n=Ur(ge("highContrast"));n!==null&&(e.highContrast=n);const o=Ur(ge("reduceMotion"));o!==null&&(e.reduceMotion=o);const i=Ur(ge("relaxedSpacing"));i!==null&&(e.relaxedSpacing=i);const s=Ur(ge("showAutoBackups"));s!==null&&(e.showAutoBackups=s);const a=ge("accentColor");a&&(e.accentColor=a);const c=ge("fontSize");c&&(e.fontSize=c);const l=ge("fontFamily");l&&(e.fontFamily=l);const f=ge("language");f&&(e.language=f);const u=Bt(),y=ge(u);if(y)if(y==="[object Object]"||String(y).includes("[object Object]"))typeof h.DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=h.DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}};else try{e.mountVoltages=JSON.parse(y)}catch(P){console.warn("Failed to parse stored mount voltages for backup",P),typeof h.DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=h.DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}}}const p=Ur(ge("iosPwaHelpShown"));p!==null&&(e.iosPwaHelpShown=p);const d=ge(lt);d&&(e.temperatureUnit=d);const m=ge(Je);m&&(e.focusScale=m);const g=ge(Nt);if(g){let P=null;if(typeof g=="string"){const A=g.trim();if(A)try{P=JSON.parse(A)}catch(O){console.warn("Failed to parse stored camera color preferences for backup",O),P=null}}P&&typeof P=="object"?e.cameraColors=Nr(P):typeof g=="string"&&g.trim()&&(e.cameraColors=g)}const b=ge(Re);if(b!=null){const P=pc(b);P&&(P.normalized?e[Re]=Nr(P.normalized):P.serialized&&(e[Re]=P.serialized))}return e}function wp(e){return Array.isArray(e)?e.map(t=>({id:t&&typeof t.id=="string"?t.id:null,name:t&&typeof t.name=="string"?t.name:"",data:t&&typeof t.data=="string"?t.data:""})).filter(t=>t.id&&t.name&&t.data):[]}function Hh(){const e=ge(en());if(!e)return[];try{const t=JSON.parse(e);return wp(t)}catch(t){return console.warn("Failed to parse stored custom fonts for backup",t),[]}}let ao=[];function qh(e){if(!e||typeof e!="object")return null;const t={};return typeof e.source=="string"&&e.source&&(t.source=e.source),typeof e.reason=="string"&&e.reason&&(t.reason=e.reason),typeof e.permissionState=="string"&&e.permissionState&&(t.permissionState=e.permissionState),Object.keys(t).length?t:null}function Ep(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"";if(!t)return null;const r=typeof e.fileName=="string"&&e.fileName?e.fileName:"cine-power-planner-backup.json",n=typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)?e.createdAtMs:null,o=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:n!==null?new Date(n).toISOString():null;let i=n;if(i===null&&o){const a=Date.parse(o);Number.isFinite(a)&&(i=a)}i===null&&(i=Date.now());const s=qh(e.metadata);return{id:t,fileName:r,payload:e.payload,createdAt:o||new Date(i).toISOString(),createdAtMs:i,metadata:s||{}}}function xo(e){if(!e)return[];let t=e;if(typeof e=="string"){const o=Oe(e);o&&o.success&&(t=o.parsed)}const r=Array.isArray(t)?t:[],n=[];return r.forEach(o=>{const i=Ep(o);i&&n.push(i)}),n}function ul(e){if(!e)return 0;let t=0;return e.payload!==null&&e.payload!==void 0&&(t+=3),typeof e.fileName=="string"&&e.fileName&&(t+=1),typeof e.createdAt=="string"&&e.createdAt&&(t+=1),typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)&&(t+=1),e.metadata&&typeof e.metadata=="object"&&(t+=1),t}function Ap(e,t){const r=new Map,n=o=>{Array.isArray(o)&&o.forEach(i=>{const s=Ep(i);if(!s)return;const a=r.get(s.id);(!a||ul(s)>=ul(a))&&r.set(s.id,s)})};return n(e),n(t),Array.from(r.values())}function Op(){const e=ge("cineBackupVaultFallbackRecords");return xo(e)}function Cp(){return h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup=="object"?h.cineFeatureBackup:h&&typeof h.getQueuedBackupPayloads=="function"?h:null}function Pp(){const e=Cp();if(!e)return;const t=typeof e.listBackupVaultRecords=="function"?e.listBackupVaultRecords:typeof e.getQueuedBackupPayloads=="function"?e.getQueuedBackupPayloads:null;if(!t)return;let r=null;try{r=t()}catch(n){console.warn("Unable to load backup vault records for export",n);return}if(Array.isArray(r)){ao=xo(r);return}return r&&typeof r.then=="function"?r.then(n=>(ao=xo(n),ao)).catch(n=>(console.warn("Unable to load backup vault records for export",n),[])):Promise.resolve(ao)}function kp(){return h&&h.cineAutoGearPersistence?h.cineAutoGearPersistence:h&&h.cineModules&&typeof h.cineModules.get=="function"&&h.cineModules.get("cineAutoGearPersistence")||null}function Wh(){const e=kp();if(!e)return null;const t=typeof e.getCacheSnapshot=="function"?e.getCacheSnapshot():null,r=(n,o,i)=>{if(t&&Object.prototype.hasOwnProperty.call(t,n))return t[n];if(i&&typeof e[i]=="function")try{return e[i]()}catch(s){console.warn(`Failed to read ${n} from Auto-Gear persistence cache`,s)}return o};return{autoGearRules:r("autoGearRules",[],"readAutoGearRules"),autoGearBackups:r("autoGearBackups",[],"readAutoGearBackups"),autoGearPresets:r("autoGearPresets",[],"readAutoGearPresets"),autoGearMonitorDefaults:r("autoGearMonitorDefaults",{},"readAutoGearMonitorDefaults"),autoGearActivePresetId:r("autoGearActivePresetId","","readActivePresetId"),autoGearAutoPresetId:r("autoGearAutoPresetId","","readAutoPresetId"),autoGearBackupRetention:r("autoGearBackupRetention",null,"readBackupRetention"),autoGearShowBackups:r("autoGearShowBackups",!1,"readBackupVisibility")}}async function Yh(){return await Pp()}function Jh(){Pp();const e=Wh(),t={devices:Mf(),setups:Ko(),session:Rf(),feedback:ip(),project:(()=>{const f=qf();if(!f||typeof f!="object")return{};const u={};return Object.keys(f).forEach(y=>{const p=f[y];if(typeof p=="string")try{const d=JSON.parse(p);u[y]=d}catch{console.warn("[Export] Found non-JSON string in project data",y),u[y]=p}else u[y]=p}),u})(),favorites:Zf(),contacts:rp(),ownGear:Bn||[],userProfile:null,autoGearRules:e?e.autoGearRules:lp(),autoGearBackups:e?e.autoGearBackups:uc(),autoGearSeeded:up(),autoGearPresets:e?e.autoGearPresets:fp(),autoGearMonitorDefaults:e?e.autoGearMonitorDefaults:pp(),autoGearActivePresetId:e?e.autoGearActivePresetId:Yi(),autoGearAutoPresetId:e?e.autoGearAutoPresetId:Ji(),autoGearShowBackups:e?e.autoGearShowBackups:gp(),autoGearBackupRetention:e?e.autoGearBackupRetention:bp(),fullBackupHistory:jo()},r=cp();r&&Array.isArray(r.releases)&&r.releases.length&&(t.documentationTracker=r);const n=Vh();Object.keys(n).length&&(t.preferences=n);const o=op();o&&typeof o=="object"&&(typeof o.name=="string"&&o.name||typeof o.role=="string"&&o.role||typeof o.avatar=="string"&&o.avatar||typeof o.phone=="string"&&o.phone||typeof o.email=="string"&&o.email)?t.userProfile=o:delete t.userProfile;const i=ge(rt);i&&(t.customLogo=i);const s=Hh();s.length&&(t.customFonts=s);const a=ge(dt);a!=null&&(t.schemaCache=a);const c=Op(),l=Ap(ao,c);return l.length&&(t.backupVaultRecords=l.map(f=>Nr(f))),t}function fe(e,t){const r=T();if(!r)return;const n=vt.has(e),o=`${e}${he}`;C&&C.driver&&C.driver.constructor&&C.driver.constructor.name;const i=new Set([Zt,rt,Nt,Re,tt,Mt,ct,et,lt,Je,lt,Je,Bt(),Fe,"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",dt,Gr,ut,xt,Ft,Ut,nn,Ot,Qe,lr]),s=()=>{e===Zt&&(Io=null),e===rt&&(vo=null),e===Nt&&(Lo=null),e===Re&&(Ro=null),e===tt&&(To=null),e===Mt&&(Bn=null),e===ct&&(Mo=null),e===et&&(No=null),e===lt&&(Go=null),e===Je&&(Kr=null),e===Je&&(Kr=null),e===Bt()&&(zo=null),e===Fe&&(rr=null)},a=c=>{if(r.setItem(e,c),["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",dt].includes(e)||i.has(e)){const u=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage||typeof globalThis<"u"&&globalThis.localStorage;if(u&&u!==r)try{u.setItem(e,c)}catch{}else u||console.warn("DEBUG: legacyStorage NOT FOUND in writeLegacyStorage for",e)}if(n)try{r.setItem(o,c)}catch(u){console.warn("Unable to update backup key during import",o,u),be("write access",u,r),ce()}};try{if(t==null){s(),C&&C.removeItem(e).catch(l=>console.warn("Failed to remove key from repo",e,l)),r.removeItem(e);const c=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(c&&c!==r)try{c.removeItem(e)}catch(l){}if(n)try{r.removeItem(o)}catch(l){console.warn("Unable to remove backup key during import",o,l),be("deletion",l,r)}}else{const c=String(t);e===Zt&&(Io=c),e===rt&&(vo=c),e===Nt&&(Lo=c),e===Re&&(Ro=c),e===tt&&(To=c),e===Mt&&(Bn=c),e===ct&&(Mo=c),e===et&&(No=c),e===lt&&(Go=c),e===Je&&(Kr=c),e===Je&&(Kr=c),e===Bt()&&(zo=c),e===Fe&&(rr=JSON.parse(c)),C&&C.setItem(e,c).catch(l=>{console.warn("Failed to save key to repo",e,l);try{a(c)}catch(f){console.warn("Unable to persist fallback legacy storage key during repo failure",e,f),be("write access",f,r),n&&ce()}});try{a(c)}catch(l){console.warn("DEBUG: writeLegacyStorage failed",l)}}}catch(c){console.warn("Unable to persist storage key during import",e,c),be("write access",c,r),n&&ce()}}function Pn(e){if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}if(typeof e=="number")return Number.isNaN(e)?null:e!==0;if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Pn(e[t]);if(r!==null)return r}return null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"value"))return Pn(e.value);if(Object.prototype.hasOwnProperty.call(e,"enabled"))return Pn(e.enabled)}return null}function nr(e,t=[],r=null){if(re(e)){const n=ne(e);return n?nr(n,t,r):[]}if(Array.isArray(e))return r?e.filter(n=>r(n)):e.filter(n=>n!=null);if(typeof e=="string"){const n=Oe(e);return n.success?nr(n.parsed,t,r):[]}if(E(e)){for(let o=0;o<t.length;o+=1){const i=t[o];if(!Object.prototype.hasOwnProperty.call(e,i))continue;const s=nr(e[i],t,r);if(s.length)return s}const n=Object.values(e);if(n.length)return r?n.filter(o=>r(o)):n.filter(o=>o!=null)}return[]}function Qh(e){const t=nr(e,["contacts","entries","items","list","values","data"],r=>r&&typeof r=="object");return Array.isArray(t)?ac(t):[]}function Xh(e){const t=nr(e,["rules","items","entries","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?ue(t):[]}function Zh(e){const t=nr(e,["backups","entries","items","list","values","data"],n=>n!==null&&typeof n=="object");if(!Array.isArray(t))return[];const{normalized:r}=Bi(t);return r}function Si(e){if(e==null)return null;if(typeof e=="number")return hn(e);if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return hn(r);const n=Oe(t);return n&&n.success?Si(n.parsed):null}if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Si(e[t]);if(typeof r=="number")return r}return null}if(E(e)){const t=["value","retention","limit","count"];for(let r=0;r<t.length;r+=1){const n=t[r];if(!Object.prototype.hasOwnProperty.call(e,n))continue;const o=Si(e[n]);if(typeof o=="number")return o}return null}return typeof e=="boolean"&&e?at:null}function eb(e){const t=nr(e,["presets","entries","items","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?ue(t):[]}function tb(e){if(!e||typeof e!="object")return{};const t={};Object.entries(e).forEach(([n,o])=>{if(typeof o!="string")return;const i=o.trim();i&&(t[n]=i)});const r=ue(t);return E(r)?r:t}function fa(e){if(typeof e=="string")return e;if(typeof e=="number")return Number.isNaN(e)?"":String(e);if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=fa(e[t]);if(r)return r}return""}if(E(e)){if(typeof e.id=="string"&&e.id)return e.id;if(typeof e.value=="string")return e.value;if(Object.prototype.hasOwnProperty.call(e,"name"))return fa(e.name)}return""}function fl(e){const t=nr(e,["backupVaultRecords","backupVault","vault","records","entries","items","list","values","data"],r=>r&&typeof r=="object");return xo(t)}function pl(e){const t=xo(e);if(!t.length)return;const r=Op(),n=Ap(r,t);try{fe("cineBackupVaultFallbackRecords",JSON.stringify(n))}catch(a){console.warn("Unable to persist imported backup vault fallback records",a)}const o=Cp();if(!o||typeof o.queueBackupPayloadForVault!="function")return;const i=a=>{o.queueBackupPayloadForVault(a.fileName,a.payload,{id:a.id,createdAt:a.createdAt,createdAtMs:a.createdAtMs,source:a.metadata&&a.metadata.source?a.metadata.source:void 0,reason:a.metadata&&a.metadata.reason?a.metadata.reason:void 0,permissionState:a.metadata&&a.metadata.permissionState?a.metadata.permissionState:void 0})},s=typeof o.listBackupVaultRecords=="function"?o.listBackupVaultRecords:typeof o.getQueuedBackupPayloads=="function"?o.getQueuedBackupPayloads:null;if(!s){t.forEach(i);return}try{const a=s();if(Array.isArray(a)){const c=new Set(a.map(l=>l&&l.id?l.id:null));t.forEach(l=>{c.has(l.id)||i(l)});return}if(a&&typeof a.then=="function"){a.then(c=>{const l=new Set(Array.isArray(c)?c.map(f=>f&&f.id?f.id:null):[]);t.forEach(f=>{l.has(f.id)||i(f)})}).catch(c=>{console.warn("Unable to inspect backup vault before import",c),t.forEach(i)});return}t.forEach(i)}catch(a){console.warn("Unable to import backup vault records via backup module",a),t.forEach(i)}}function rb(e){return kt(e)}function We(e,t){if(!E(e))return null;const r=rb(t);for(let n=0;n<r.length;n+=1){const o=r[n];if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"primary"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${he}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"backup"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${on}`;if(console.log("DEBUG: readSnapshotEntry checking migration candidate",o,Object.prototype.hasOwnProperty.call(e,o)),Object.prototype.hasOwnProperty.call(e,o))return console.log("DEBUG: readSnapshotEntry FOUND migration backup",o),{key:o,value:e[o],type:"migration-backup"}}return null}function kn(e){if(!e)return;let t=e.value;if(e.type==="migration-backup")try{const r=typeof t=="string"?JSON.parse(t):t;if(r&&typeof r=="object"){const n=typeof r.compression=="string"?r.compression.trim():"",o=typeof r.encoding=="string"?r.encoding.trim():"",i=n===gf&&o===mf,s=ko.test(n)||ko.test(o);if((i||s)&&typeof r.data=="string")if(qa()){let a=typeof r.compressionVariant=="string"&&r.compressionVariant?r.compressionVariant:null;a||(s?a=tl(o)||tl(n)||"utf16":a="utf16");const c=bf(r.data,as,a,"migration backup entry");if(c.success&&typeof c.value=="string")try{const l=JSON.parse(c.value);l&&typeof l=="object"&&Object.prototype.hasOwnProperty.call(l,"data")?t=l.data:t=null}catch(l){console.log("DEBUG: extractSnapshotStoredValue parse error",l),t=null}else console.log("DEBUG: extractSnapshotStoredValue decompression failed",c),console.warn("Unable to decompress migration backup entry during import",e&&e.key,c.error),t=null}else console.log("DEBUG: extractSnapshotStoredValue compression unavailable"),console.warn("Compression support is unavailable while reading migration backup entry",e&&e.key),t=null;else Object.prototype.hasOwnProperty.call(r,"data")?t=r.data:t=null}else t=null}catch(r){console.warn("Unable to parse migration backup entry during import",e.key,r),t=null}return t}function ri(e){const t=kn(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=tr(t);if(r===null)return null;if(r===void 0)return;if(typeof r!="string")return r;const n=r.trim();if(!n)return"";try{return JSON.parse(n)}catch{return r}}return t}}function mr(e){const t=kn(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=tr(t);if(r===null)return null;if(r===void 0)return;if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return String(r);if(Array.isArray(r)||r&&typeof r=="object")try{return JSON.stringify(r)}catch(n){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,n),null}return null}if(typeof t=="number"||typeof t=="boolean")return String(t);if(Array.isArray(t)||t&&typeof t=="object")try{return JSON.stringify(t)}catch(r){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,r),null}return null}}function nb(e){if(!E(e)||["devices","setups","session","feedback","favorites","contacts","preferences","project","projects","autoGearRules","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","autoGearSeeded","autoGearActivePresetId","autoGearAutoPresetId","autoGearBackupRetention","autoGearShowBackups","fullBackupHistory","fullBackups","backupVaultRecords"].some(w=>Object.prototype.hasOwnProperty.call(e,w)))return null;const n={};let o=!1,i=!1;const s=["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",Nt,Re],a=Bt(),c=new Set([rt,...s,a].filter(w=>typeof w=="string"&&w)),l=new Set(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"]),f=w=>{if(!w||typeof w.key!="string")return;if(w.key.startsWith("cameraPowerPlanner_")||w.key.startsWith("cinePowerPlanner_")||w.key.endsWith(he)||w.key.endsWith(on)){i=!0;return}const S=w.key.replace(/(?:__backup|__legacyMigrationBackup)$/u,"");c.has(S)&&(i=!0)},u=(w,S)=>{const v=We(e,w);if(!v)return;f(v);const B=ri(v);B!==void 0&&(n[S]=B,o=!0)};u(Ze,"devices"),u(pt,"setups"),u(Xt,"session"),u(Lr,"feedback"),u(pe,"project"),u(et,"favorites"),u(tt,"contacts"),u(Mt,"ownGear"),u(ct,"userProfile"),u(jr,"documentationTracker"),u(Gr,"autoGearRules"),u(ut,"autoGearBackups"),u(xt,"autoGearPresets"),u(Ft,"autoGearMonitorDefaults"),u(Ut,"autoGearBackupRetention");const y=We(e,dt);if(y){f(y);const w=mr(y);w!==void 0&&(n.schemaCache=w,o=!0)}const p=We(e,en());if(p){f(p);const w=ri(p);w!==void 0&&(n.customFonts=w,o=!0)}const d=We(e,rt);if(d){f(d);const w=mr(d);w!==void 0&&(n.customLogo=w,o=!0)}const m=We(e,nn);m&&(f(m),n.autoGearSeeded=kn(m),o=!0);const g=We(e,Ot);g&&(f(g),n.autoGearActivePresetId=mr(g),o=!0);const b=We(e,Qe);b&&(f(b),n.autoGearAutoPresetId=mr(b),o=!0);const P=We(e,lr);P&&(f(P),n.autoGearShowBackups=kn(P),o=!0);const A={};s.forEach(w=>{const S=We(e,w);if(!S)return;if(f(S),w===Re){const M=mr(S);if(M!==void 0){const G=pc(M);if(G){if(G.normalized){A[w]=Nr(G.normalized),o=!0;return}if(G.serialized){A[w]=G.serialized,o=!0;return}}}return}const v=kn(S);if(l.has(w)){const M=Pn(v);if(M!==null){A[w]=M,o=!0;return}}const B=mr(S);B!==void 0&&(A[w]=B,o=!0)});const O=We(e,lt);if(O){f(O);const w=mr(O);if(typeof w=="string"){const S=w.trim();S&&(A.temperatureUnit=S,o=!0)}}const k=We(e,Je);if(k){f(k);const w=mr(k);if(typeof w=="string"){const S=w.trim();S&&(A.focusScale=S,o=!0)}}const _=We(e,Nt);if(_){f(_);const w=ri(_);w!==void 0&&(A.cameraColors=w,o=!0)}const I=We(e,a);if(I){f(I);const w=ri(I);w!==void 0&&(A.mountVoltages=w,o=!0)}return Object.keys(A).length>0&&(n.preferences=A),!o||!i?null:n}function _p(e,t={}){if(console.error("DEBUG: importAllData CALLED",Object.keys(e)),Array.isArray(e)){go(e,()=>sl());return}if(!E(e))return;const{skipSnapshotConversion:r=!1}=t||{};if(!r){const p=nb(e);if(p){_p(p,{skipSnapshotConversion:!0});return}}const n=p=>Object.prototype.hasOwnProperty.call(e,p),o=Bt(),i=Nt,s=kp(),a=(p,d,m)=>{if(s&&typeof s[p]=="function")try{return s[p](m),!0}catch(g){console.warn(`Failed to persist Auto-Gear value with ${p}`,g)}return typeof d=="function"&&d(m),!1};if(n("devices")&&Nf(e.devices),n("setups")&&ec(e.setups),n("session")&&Za(e.session,{disableCompression:!0}),n("feedback")&&sp(e.feedback),n("favorites")&&ep(e.favorites),n("contacts"))if(e.contacts===null)la(null);else{const p=Qh(e.contacts);la(p)}if(n("ownGear")){const p=nr(e.ownGear,["items","entries","list","values","data"],d=>d&&typeof d=="object");np(p)}if(n("userProfile")){if(e.userProfile===null)hi(null);else if(E(e.userProfile)){const p=cc(e.userProfile);hi(p||null)}}if(E(e.preferences)){const p=e.preferences;if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"].forEach(g=>{Object.prototype.hasOwnProperty.call(p,g)&&typeof p[g]=="boolean"&&fe(g,p[g])}),["accentColor","fontSize","fontFamily","language"].forEach(g=>{if(Object.prototype.hasOwnProperty.call(p,g)){const b=p[g];typeof b=="string"&&b&&fe(g,b)}}),Object.prototype.hasOwnProperty.call(p,"temperatureUnit")){const g=p.temperatureUnit;if(typeof g=="string"){const b=g.trim();b&&fe(lt,b)}else g===null&&fe(lt,null)}if(Object.prototype.hasOwnProperty.call(p,"focusScale")){const g=p.focusScale;if(typeof g=="string"){const b=g.trim();if(b&&(fe(Je,b),typeof window<"u"&&typeof window.applyFocusScalePreference=="function"))try{window.applyFocusScalePreference(b,{persist:!1,forceUpdate:!0})}catch(P){console.warn("Unable to apply imported focus scale preference",P)}}else g===null&&fe(Je,null)}if(Object.prototype.hasOwnProperty.call(p,Re)){const g=p[Re];if(g===null)fe(Re,null);else{const b=pc(g);if(b){if(b.normalized){const P=Nr(b.normalized);let A=null;try{A=JSON.stringify(P)}catch(O){console.warn("Unable to serialize imported print preferences",O),A=null}if(A!==null)try{fe(Re,A)}catch(O){console.warn("Unable to persist imported print preferences",O)}if(typeof window<"u"&&typeof window.savePrintPreferences=="function")try{window.savePrintPreferences(P)}catch(O){console.warn("Unable to apply imported print preferences",O)}}else if(b.serialized)try{fe(Re,b.serialized)}catch(P){console.warn("Unable to store imported print preferences string value",P)}}}}if(Object.prototype.hasOwnProperty.call(p,"mountVoltages")){const g=p.mountVoltages;if(g&&typeof g=="object"){try{fe(o,JSON.stringify(g))}catch(b){console.warn("Unable to store imported mount voltages",b)}typeof window<"u"&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(g,{persist:!1,triggerUpdate:!0})}else if(typeof g=="string"){if(fe(o,g),typeof window<"u"&&typeof window.parseStoredMountVoltages=="function")try{const b=window.parseStoredMountVoltages(g);b&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(b,{persist:!1,triggerUpdate:!0})}catch(b){console.warn("Unable to parse imported mount voltages",b)}}else g===null&&(fe(o,null),typeof window<"u"&&typeof window.resetMountVoltagePreferences=="function"&&window.resetMountVoltagePreferences({persist:!1,triggerUpdate:!0}))}if(Object.prototype.hasOwnProperty.call(p,"cameraColors")){const g=p.cameraColors,b=P=>{if(!P||typeof P!="object")return!1;let A=!1;if(typeof window<"u"&&window&&typeof window.setCameraLetterColors=="function")try{window.setCameraLetterColors(P),A=!0}catch(k){console.warn("Unable to apply imported camera color preferences",k),A=!1}let O=null;try{O=JSON.stringify(P)}catch(k){console.warn("Unable to serialize imported camera color preferences",k),O=null}if(O)try{fe(i,O)}catch(k){console.warn("Unable to persist imported camera color preferences",k)}return A};if(g&&typeof g=="object")b(g);else if(typeof g=="string"){const P=g.trim();if(P){let A=null;try{A=JSON.parse(P)}catch(O){console.warn("Unable to parse imported camera color palette",O),A=null}if(A&&typeof A=="object")b(A);else try{fe(i,P)}catch(O){console.warn("Unable to store raw imported camera color palette",O)}}}else g===null&&fe(i,null)}}if(Object.prototype.hasOwnProperty.call(e,"customLogo")){const p=e.customLogo;typeof p=="string"&&p?fe(rt,p):fe(rt,null)}if(Object.prototype.hasOwnProperty.call(e,"customFonts")){const p=wp(e.customFonts);if(p.length)try{fe(en(),JSON.stringify(p))}catch(d){console.warn("Unable to store imported custom fonts",d)}else fe(en(),null)}if(Object.prototype.hasOwnProperty.call(e,"schemaCache")){const p=e.schemaCache;if(typeof p=="string"||p===null)fe(dt,p);else if(p&&typeof p=="object")try{fe(dt,JSON.stringify(p))}catch(d){console.warn("Unable to store imported schema cache",d)}}if(Object.prototype.hasOwnProperty.call(e,"documentationTracker")){const p=mo(e.documentationTracker);bi(p)}else if(Object.prototype.hasOwnProperty.call(e,"documentationLogs")){const p=mo({releases:e.documentationLogs});bi(p)}else if(Object.prototype.hasOwnProperty.call(e,"documentationUpdateLog")){const p=mo(e.documentationUpdateLog);bi(p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearRules")){const p=Xh(e.autoGearRules);a("persistAutoGearRules",lc,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackups")){const p=Zh(e.autoGearBackups);a("persistAutoGearBackups",Vi,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearSeeded")){const p=Pn(e.autoGearSeeded);ua(p===null?!1:p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearPresets")){const p=eb(e.autoGearPresets);a("persistAutoGearPresets",ps,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearMonitorDefaults")){const p=tb(e.autoGearMonitorDefaults);a("persistAutoGearMonitorDefaults",fc,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearActivePresetId")){const p=fa(e.autoGearActivePresetId);a("persistActivePresetId",dp,typeof p=="string"?p:"")}if(Object.prototype.hasOwnProperty.call(e,"autoGearAutoPresetId")){const p=typeof e.autoGearAutoPresetId=="string"?e.autoGearAutoPresetId:"";a("persistAutoPresetId",yp,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearShowBackups")){const p=Pn(e.autoGearShowBackups);a("persistBackupVisibility",mp,p===null?!1:p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackupRetention")){const p=Si(e.autoGearBackupRetention);typeof p=="number"&&Number.isFinite(p)&&a("persistBackupRetention",Sp,p)}if(Object.prototype.hasOwnProperty.call(e,"fullBackupHistory")){const p=Yt(e.fullBackupHistory);Ki(p)}else if(Object.prototype.hasOwnProperty.call(e,"fullBackups")){const p=Yt(e.fullBackups);Ki(p)}if(Object.prototype.hasOwnProperty.call(e,"backupVaultRecords")){const p=fl(e.backupVaultRecords);pl(p)}else if(Object.prototype.hasOwnProperty.call(e,"backupVault")){const p=fl(e.backupVault);pl(p)}let c=null;const l=()=>(c||(c=sl()),c);let f=!1;const u=()=>{const p=l();return(d,m,g)=>{f=!0,p(d,m,g)}},y=(p,d)=>{const g=go(p,()=>u(),d);return g&&(f=!0),g};e.project&&y(e.project,""),e.projects?y(e.projects):!e.project&&typeof e.gearList=="string"&&(u()("",{gearList:e.gearList}),f=!0),f||Mh(e).forEach((d,m)=>{if(d&&typeof d=="object"&&!Array.isArray(d)){const b=Di(d)?d:$e(d);if(b&&Di(b)){u()("",b,`Imported project ${m+1}`),f=!0;return}}go(d,()=>u(),`Imported project ${m+1}`)&&(f=!0)})}function ob(){return Ve}var fr={getSafeLocalStorage:T,loadDeviceData:Mf,saveDeviceData:Nf,loadSetups:Ko,saveSetups:ec,saveSetup:oh,loadSetup:ih,deleteSetup:sh,renameSetup:ah,safeSetLocalStorage:fe,readLocalStorageValue:ge,getMountVoltageStorageKeyName:Bt,getMountVoltageStorageBackupKeyName:af,getProjectStorageRevisionKeyName:zg,loadProjectStorageRevision:rf,loadProject:qf,loadProjectMetadata:jh,saveProject:sc,deleteProject:Xf,renameProject:Th,createProjectDeletionBackup:vh,loadSessionState:Rf,saveSessionState:Za,loadFavorites:Zf,saveFavorites:ep,loadContacts:rp,saveContacts:la,loadOwnGear:xh,saveOwnGear:np,loadUserProfile:op,saveUserProfile:hi,loadDocumentationTracker:cp,saveDocumentationTracker:bi,loadAutoGearBackups:uc,saveAutoGearBackups:Vi,loadFeedback:ip,saveFeedback:sp,clearAllData:$h,exportAllData:Jh,prepareBackupForExport:Yh,importAllData:_p,loadAutoGearRules:lp,saveAutoGearRules:lc,loadAutoGearSeedFlag:up,saveAutoGearSeedFlag:ua,loadAutoGearPresets:fp,saveAutoGearPresets:ps,loadAutoGearMonitorDefaults:pp,saveAutoGearMonitorDefaults:fc,loadAutoGearActivePresetId:Yi,saveAutoGearActivePresetId:dp,loadAutoGearAutoPresetId:Ji,saveAutoGearAutoPresetId:yp,loadAutoGearBackupVisibility:gp,saveAutoGearBackupVisibility:mp,loadAutoGearBackupRetention:bp,saveAutoGearBackupRetention:Sp,getAutoGearBackupRetentionDefault:Bo,loadFullBackupHistory:jo,saveFullBackupHistory:Ki,recordFullBackupHistoryEntry:ap,requestPersistentStorage:Pf,clearUiCacheStorageEntries:rn,ensureCriticalStorageBackups:nm,getLastCriticalStorageGuardResult:om,decodeStoredValue:tr,getCompressionLogSnapshot:kg,setActiveProjectCompressionHold:Oh,clearActiveProjectCompressionHold:Ch,invalidateProjectReadCache:cr,getProjectMemoryCache:ob,storageRepo:C},dl={flag:Ha,read:Wu,write:fi,clear:Eg};try{Object.defineProperty(fr,"__testAutoBackupCompressionCache",{configurable:!1,enumerable:!1,writable:!1,value:dl})}catch{fr.__testAutoBackupCompressionCache=dl}typeof module<"u"&&module.exports&&(module.exports=fr);console.log("DEBUG: storage.js: starting global export loop");if(h&&typeof h=="object"){Object.keys(fr).forEach(e=>{const t=fr[e];if(typeof t=="function"&&typeof h[e]!="function")try{h[e]=t}catch{try{Object.defineProperty(h,e,{configurable:!0,writable:!0,value:t})}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Unable to expose storage helper ${e} globally.`,n)}}});try{typeof h.recordFullBackupHistoryEntry!="function"&&(h.recordFullBackupHistoryEntry=ap),typeof h.loadFullBackupHistory!="function"&&(h.loadFullBackupHistory=jo)}catch{}}if(h)try{Object.defineProperty(h,"__cineStorageApi",{configurable:!0,writable:!0,value:fr})}catch{h.__cineStorageApi=fr}console.log("DEBUG: storage.js execution finished");const ib=fr,Ls=Object.freeze(Object.defineProperty({__proto__:null,cineStorage:ib,default:fr},Symbol.toStringTag,{value:"Module"}));var yl={};const ds=Fn();function sb(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const o=n&&n.cineModuleLinker;if(o&&typeof o=="object")return o}catch{}}return null}function ab(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function cb(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}const ie=sb(ds),X=ie&&typeof ie.getModuleEnvironment=="function"?ie.getModuleEnvironment():ab(ds),Z=ie&&typeof ie.getEnvironmentBridge=="function"?ie.getEnvironmentBridge():cb(ds),H=(ie&&typeof ie.getGlobalScope=="function"?ie.getGlobalScope():null)||(Z&&typeof Z.getGlobalScope=="function"?Z.getGlobalScope():null)||(X&&typeof X.getGlobalScope=="function"?X.getGlobalScope():null)||ds;function lb(){const e=[H];typeof globalThis<"u"&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&e.indexOf(global)===-1&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&typeof r.cineModuleGlobals=="object")return r.cineModuleGlobals}return null}const ee=(ie&&typeof ie.getModuleGlobals=="function"?ie.getModuleGlobals():null)||lb();function ub(e,t){if(ie&&typeof ie.recordModule=="function"&&ie.recordModule(e,t),!(!ee||typeof ee.recordModule!="function"))try{ee.recordModule(e,t)}catch{}}function gl(e){return null}(function(){return ie&&typeof ie.tryRequire=="function"?ie.tryRequire:ee&&typeof ee.tryRequire=="function"?ee.tryRequire:Z&&typeof Z.tryRequire=="function"?function(r){const n=Z.tryRequire(r);return typeof n>"u"?gl():n}:X&&typeof X.tryRequire=="function"?X.tryRequire:gl})();function fb(e){const t=e||H;if(ie&&typeof ie.getModuleRegistry=="function"){const n=ie.getModuleRegistry(t);if(n)return n}if(ee&&typeof ee.resolveModuleRegistry=="function")try{const n=ee.resolveModuleRegistry(t);if(n)return n}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const n=Z.getModuleRegistry(t);if(n)return n}catch{}if(X&&typeof X.resolveModuleRegistry=="function")try{const n=X.resolveModuleRegistry(t);if(n)return n}catch{}if(Se&&typeof Se=="object")return Se;const r=[t];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModules=="object")return o.cineModules}return null}const _n=(function(){if(ie&&typeof ie.getModuleRegistry=="function"){const e=ie.getModuleRegistry(H);if(e)return e}if(ee&&typeof ee.getModuleRegistry=="function")try{const e=ee.getModuleRegistry(H);if(e)return e}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const e=Z.getModuleRegistry(H);if(e)return e}catch{}if(X&&typeof X.getModuleRegistry=="function")try{const e=X.getModuleRegistry(H);if(e)return e}catch{}return fb(H)})(),un=(function(){if(ie&&typeof ie.getPendingQueueKey=="function"){const t=ie.getPendingQueueKey();if(typeof t=="string"&&t)return t}if(ee&&typeof ee.getPendingQueueKey=="function")try{const t=ee.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}if(Z&&typeof Z.getPendingQueueKey=="function")try{const t=Z.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return X&&typeof X.PENDING_QUEUE_KEY=="string"?X.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function pb(e){if(!e||typeof e!="object")return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}return t}function db(e,t,r){if(ee&&typeof ee.queueModuleRegistration=="function")try{if(ee.queueModuleRegistration(e,t,r,H))return!0}catch{}if(Z&&typeof Z.queueModuleRegistration=="function")try{if(Z.queueModuleRegistration(e,t,r))return!0}catch{}if(X&&typeof X.queueModuleRegistration=="function")return X.queueModuleRegistration(e,t,r,H);if(!H||typeof H!="object")return!1;const n=Object.freeze({name:e,api:t,options:Object.freeze(pb(r))});let o=H[un];if(!Array.isArray(o))try{Object.defineProperty(H,un,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=H[un]}catch{try{Array.isArray(H[un])||(H[un]=[]),o=H[un]}catch{return!1}}try{o.push(n)}catch{o[o.length]=n}return!0}function Rs(e,t,r,n){if(_n&&typeof _n.register=="function")try{return _n.register(e,t,r),!0}catch(o){if(typeof n=="function")try{n(o)}catch{}}return db(e,t,r),!1}const yb=(function(){return ee&&typeof ee.registerOrQueueModule=="function"?function(r,n,o,i){try{if(ee.registerOrQueueModule(r,n,o,i,H,_n))return!0}catch{}return Rs(r,n,o,i)}:Z&&typeof Z.registerOrQueueModule=="function"?function(r,n,o,i){try{if(Z.registerOrQueueModule(r,n,o,i,H,_n))return!0}catch{}return Rs(r,n,o,i)}:X&&typeof X.registerOrQueueModule=="function"?function(r,n,o,i){return X.registerOrQueueModule(r,n,o,i,H,_n)}:Rs})();function gb(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function mb(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(gb(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function hb(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function pa(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||mb(e))return e;if(typeof process<"u"&&process&&yl&&yl.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const r=hb(t);if(r.has(e))return e;r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||pa(s,r)}try{return Object.freeze(e)}catch{return e}}const dc=(function(){return ee&&typeof ee.freezeDeep=="function"?ee.freezeDeep:Z&&typeof Z.freezeDeep=="function"?function(r,n){try{return Z.freezeDeep(r,n)}catch{return pa(r,n)}}:X&&typeof X.freezeDeep=="function"?X.freezeDeep:pa})();function ml(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const bb=(function(){return ee&&typeof ee.safeWarn=="function"?ee.safeWarn:Z&&typeof Z.safeWarn=="function"?function(r,n){try{Z.safeWarn(r,n)}catch{ml(r,n)}}:X&&typeof X.safeWarn=="function"?X.safeWarn:ml})();function Ts(e,t){if(!H||typeof H!="object")return!1;try{return Object.defineProperty(H,e,{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{try{return H[e]=t,!0}catch{return!1}}}const Sb=(function(){return ee&&typeof ee.exposeGlobal=="function"?function(r,n,o){try{return ee.exposeGlobal(r,n,o)}catch{return Ts(r,n)}}:Z&&typeof Z.exposeGlobal=="function"?function(r,n,o){try{return Z.exposeGlobal(r,n,o)}catch{return Ts(r,n)}}:X&&typeof X.exposeGlobal=="function"?function(r,n,o){return X.exposeGlobal(r,n,H,o)}:Ts})(),da=[];function $o(e,t){!e||typeof e!="object"||da.push({ref:e,name:t||null})}$o(H,"global");Ls&&typeof Ls=="object"&&$o(Ls,"storage");H.cineAppSession&&$o(H.cineAppSession,"session");H.cineAppSetups&&$o(H.cineAppSetups,"setups");const ya=Object.create(null),bn=[];function wb(e){if(!e)return null;if(e.name)return e.name;const t=e.ref;return!t||typeof t!="object"?null:t===H?"global":typeof t.constructor=="function"&&t.constructor.name?t.constructor.name:null}function jp(e,t){const r=String(e);let n=ya[r];return n?t&&n.implementationName!==t&&(n.implementationName=t):(n={name:r,implementationName:t||r,available:!1,providerIndex:-1,providerName:null,lastChecked:null,implementation:null},ya[r]=n,bn.push(r)),n}function yc(e,t={}){const r=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,n=jp(e),o=n.implementationName||String(e);if(!r&&n.implementation&&typeof n.implementation=="function")return n;let i=null;for(let s=0;s<da.length;s+=1){const a=da[s],c=a&&a.ref;if(!c||typeof c!="object")continue;const l=c[o];if(typeof l=="function"){i={implementation:l,providerIndex:s,providerName:wb(a)};break}}return n.available=!!i,n.providerIndex=i?i.providerIndex:-1,n.providerName=i?i.providerName:null,n.lastChecked=Date.now(),n.implementation=i?i.implementation:null,n}function Eb(e){const t=yc(e,{refresh:!0});if(!t||typeof t.implementation!="function"){const r=new Error(`cinePersistence could not resolve function "${e}".`);throw r.code="CINE_PERSISTENCE_BINDING_MISSING",r.binding=e,r.detail={name:e,available:t?t.available:!1,providerName:t?t.providerName:null},r}return t.implementation}function Ip(e){return e?Object.freeze({name:e.name,available:!!e.available,providerIndex:typeof e.providerIndex=="number"?e.providerIndex:-1,providerName:e.providerName||null,lastChecked:e.lastChecked||null,implementation:e.implementationName||e.name}):null}function j(e,t){const r=t||e;return jp(r,e),function(){return Eb(r).apply(this,arguments)}}function Ab(e,t={}){const r=String(e),n=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,o=yc(r,{refresh:n});return Ip(o)}function Ob(e={}){if(e&&Object.prototype.hasOwnProperty.call(e,"refresh")?e.refresh:!0)for(let n=0;n<bn.length;n+=1)yc(bn[n],{refresh:!0});const r={};for(let n=0;n<bn.length;n+=1){const o=bn[n];r[o]=Ip(ya[o])}return dc(r)}function Cb(){return bn.slice()}const xn={bindings:{saveSession:j("saveCurrentSession","saveSession"),autoSaveSetup:j("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:j("saveCurrentGearList","saveGearList"),restoreSessionState:j("restoreSessionState"),collectFullBackupData:j("collectFullBackupData"),createSettingsBackup:j("createSettingsBackup"),captureStorageSnapshot:j("captureStorageSnapshot"),sanitizeBackupPayload:j("sanitizeBackupPayload"),autoBackup:j("autoBackup"),formatFullBackupFilename:j("formatFullBackupFilename"),downloadPayload:j("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:j("recordFullBackupHistoryEntry"),encodeSharedSetup:j("encodeSharedSetup"),decodeSharedSetup:j("decodeSharedSetup"),applySharedSetup:j("applySharedSetup"),applySharedSetupFromUrl:j("applySharedSetupFromUrl"),downloadProject:j("downloadSharedProject","downloadProject"),saveProject:j("saveProject"),proceed:j("handleRestoreRehearsalProceed","proceed"),abort:j("handleRestoreRehearsalAbort","abort")},storage:{loadDeviceData:j("loadDeviceData"),saveDeviceData:j("saveDeviceData"),loadSetups:j("loadSetups"),saveSetups:j("saveSetups"),saveSetup:j("saveSetup"),loadSetup:j("loadSetup"),deleteSetup:j("deleteSetup"),renameSetup:j("renameSetup"),loadSessionState:j("loadSessionState"),saveSessionState:j("saveSessionState"),loadFeedback:j("loadFeedback"),saveFeedback:j("saveFeedback"),saveProject:j("saveProject"),loadProject:j("loadProject"),deleteProject:j("deleteProject"),loadFavorites:j("loadFavorites"),saveFavorites:j("saveFavorites"),exportAllData:j("exportAllData"),importAllData:j("importAllData"),clearAllData:j("clearAllData"),loadAutoGearRules:j("loadAutoGearRules"),saveAutoGearRules:j("saveAutoGearRules"),loadAutoGearBackups:j("loadAutoGearBackups"),saveAutoGearBackups:j("saveAutoGearBackups"),loadAutoGearSeedFlag:j("loadAutoGearSeedFlag"),saveAutoGearSeedFlag:j("saveAutoGearSeedFlag"),loadAutoGearBackupRetention:j("loadAutoGearBackupRetention"),saveAutoGearBackupRetention:j("saveAutoGearBackupRetention"),getAutoGearBackupRetentionDefault:j("getAutoGearBackupRetentionDefault"),loadAutoGearPresets:j("loadAutoGearPresets"),saveAutoGearPresets:j("saveAutoGearPresets"),loadAutoGearActivePresetId:j("loadAutoGearActivePresetId"),saveAutoGearActivePresetId:j("saveAutoGearActivePresetId"),loadAutoGearAutoPresetId:j("loadAutoGearAutoPresetId"),saveAutoGearAutoPresetId:j("saveAutoGearAutoPresetId"),loadAutoGearMonitorDefaults:j("loadAutoGearMonitorDefaults"),saveAutoGearMonitorDefaults:j("saveAutoGearMonitorDefaults"),loadAutoGearBackupVisibility:j("loadAutoGearBackupVisibility"),saveAutoGearBackupVisibility:j("saveAutoGearBackupVisibility"),loadFullBackupHistory:j("loadFullBackupHistory"),saveFullBackupHistory:j("saveFullBackupHistory"),recordFullBackupHistoryEntry:j("recordFullBackupHistoryEntry"),requestPersistentStorage:j("requestPersistentStorage"),clearUiCacheStorageEntries:j("clearUiCacheStorageEntries"),ensureCriticalStorageBackups:j("ensureCriticalStorageBackups"),getLastCriticalStorageGuardResult:j("getLastCriticalStorageGuardResult"),saveSession:j("saveCurrentSession","saveSession"),autoSaveSetup:j("autoSaveCurrentSetup","autoSaveSetup"),proceed:j("handleRestoreRehearsalProceed","proceed"),abort:j("handleRestoreRehearsalAbort","abort")},autosave:{saveSession:j("saveCurrentSession","saveSession"),autoSaveSetup:j("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:j("saveCurrentGearList","saveGearList"),restoreSessionState:j("restoreSessionState")},backups:{collectFullBackupData:j("collectFullBackupData"),createSettingsBackup:j("createSettingsBackup"),captureStorageSnapshot:j("captureStorageSnapshot"),sanitizeBackupPayload:j("sanitizeBackupPayload"),autoBackup:j("autoBackup"),formatFullBackupFilename:j("formatFullBackupFilename"),downloadPayload:j("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:j("recordFullBackupHistoryEntry")},restore:{proceed:j("handleRestoreRehearsalProceed","proceed"),abort:j("handleRestoreRehearsalAbort","abort")},share:{downloadProject:j("downloadSharedProject","downloadProject"),encodeSharedSetup:j("encodeSharedSetup"),decodeSharedSetup:j("decodeSharedSetup"),applySharedSetup:j("applySharedSetup"),applySharedSetupFromUrl:j("applySharedSetupFromUrl")},__internal:dc({listBindings:Cb,inspectBinding(e,t){return Ab(e,t)||null},inspectAllBindings:Ob})};dc(xn);$o(xn.bindings,"bindings");ub("cinePersistence",xn);yb("cinePersistence",xn,{category:"persistence",description:"Data integrity facade for storage, autosave, backups, restore, and share flows.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},e=>{bb("Unable to register cinePersistence module.",e)});if(H&&typeof H=="object"){let e=null;try{e=H.cinePersistence||null}catch{e=null}e!==xn&&!Sb("cinePersistence",xn,{configurable:!0,enumerable:!1,writable:!1})&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose cinePersistence globally.")}function Pb(){return Object.freeze({ESSENTIAL:"essential",FILM:"film",GADGET:"gadget",UICONS:"uicons",TEXT:"text"})}function fn(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function Tb(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=fn(t),a=fn(r),c=fn(n),l=fn(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(u,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[],m=/(?:^|\s)width\s*=/i.test(p),g=/(?:^|\s)height\s*=/i.test(p);return m||d.push(`width="${c}"`),g||d.push(`height="${l}"`),d.push(`x="-${fn(i)}"`),d.push(`y="-${fn(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}function ni(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return null;try{if(typeof String.fromCodePoint=="function")return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):null}function hl(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=ni(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=ni(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=ni(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=ni(i[1],10);if(s)return s}return t}function kb(e){const t=Pb();new Set(Object.values(t).filter(Boolean));const r=t.UICONS;if(!e)return{char:"",font:r,className:""};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:hl(e),font:r,className:""};if(typeof e=="object"){const n=typeof e.char=="string"?hl(e.char):"",o=e.font&&typeof e.font=="string"?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:""}}function Mb(e,t){if(!e)return;const r=kb(t);if(r&&r.markup){let o=r.markup;o.includes("aria-hidden")||(o=o.replace("<svg",'<svg aria-hidden="true"')),e.innerHTML=o,o.includes("aria-hidden")||e.setAttribute("aria-hidden","true"),r.className&&e.classList&&r.className.split(/\s+/).filter(Boolean).forEach(i=>e.classList.add(i)),e.removeAttribute("data-icon-font");return}const n=r&&r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font||"uicons"):e.removeAttribute("data-icon-font")}const Ms=Object.freeze({autoGearRules:"cameraPowerPlanner_autoGearRules",autoGearBackups:"cameraPowerPlanner_autoGearBackups",autoGearPresets:"cameraPowerPlanner_autoGearPresets",autoGearMonitorDefaults:"cameraPowerPlanner_autoGearMonitorDefaults",autoGearActivePresetId:"cameraPowerPlanner_autoGearActivePreset",autoGearAutoPresetId:"cameraPowerPlanner_autoGearAutoPreset",autoGearBackupRetention:"cameraPowerPlanner_autoGearBackupRetention",autoGearShowBackups:"cameraPowerPlanner_autoGearShowBackups"}),hr=Object.freeze({autoGearRules:Object.freeze([]),autoGearBackups:Object.freeze([]),autoGearPresets:Object.freeze([]),autoGearMonitorDefaults:Object.freeze({}),autoGearActivePresetId:"",autoGearAutoPresetId:"",autoGearBackupRetention:null,autoGearShowBackups:!1}),St=Fn();function wi(e){return Array.isArray(e)?e.slice():e&&typeof e=="object"?{...e}:e}function br(e){return{hydrated:!1,value:wi(e)}}function bl(){return{autoGearRules:br(hr.autoGearRules),autoGearBackups:br(hr.autoGearBackups),autoGearPresets:br(hr.autoGearPresets),autoGearMonitorDefaults:br(hr.autoGearMonitorDefaults),autoGearActivePresetId:br(hr.autoGearActivePresetId),autoGearAutoPresetId:br(hr.autoGearAutoPresetId),autoGearBackupRetention:br(hr.autoGearBackupRetention),autoGearShowBackups:br(hr.autoGearShowBackups)}}function _b(){const e=[];St&&e.push(St),typeof globalThis<"u"&&globalThis!==St&&e.push(globalThis),typeof window<"u"&&window!==St&&e.push(window),typeof self<"u"&&self!==St&&e.push(self),typeof global<"u"&&global!==St&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object")){if(r.cinePersistence)return r;if(r.cineModules&&typeof r.cineModules.get=="function"){const n=r.cineModules.get("cinePersistence");if(n)return{cinePersistence:n}}}}return null}class jb{constructor(){this.cache=bl(),this.hydrating=null}hydrateCache(t={}){const r=t&&t.force===!0;return this.hydrating&&!r?this.hydrating:(this.hydrating=(async()=>{const o=Object.keys(Ms).map(async i=>{const s=Ms[i];try{const a=await C.getItem(s);this.setCacheValue(i,a,{hydrate:!0})}catch(a){console.warn("[AutoGearService] Failed to hydrate",s,a),this.setCacheValue(i,void 0,{hydrate:!0,skipUpdate:!0})}});return await Promise.all(o),this.getCacheSnapshot()})(),this.hydrating)}getCacheSnapshot(){const t={};return Object.keys(this.cache).forEach(r=>{t[r]=wi(this.cache[r].value)}),t}setCacheValue(t,r,n={}){const o=this.cache[t];if(!o)return;const i=n&&n.hydrate===!0;!(n&&n.skipUpdate===!0)&&typeof r<"u"&&r!==null&&(o.value=wi(r)),i&&(o.hydrated=!0)}getCacheValue(t){const r=this.cache[t];if(r)return wi(r.value)}async persistValue(t,r,n){this.setCacheValue(t,r);const o=_b(),i=o?o.cinePersistence:null;if(i&&i.storage&&typeof i.storage[n]=="function")return i.storage[n](r);const s=Ms[t];return C.setItem(s,r)}readAutoGearRules(){return this.getCacheValue("autoGearRules")||[]}readAutoGearBackups(){return this.getCacheValue("autoGearBackups")||[]}readAutoGearPresets(){return this.getCacheValue("autoGearPresets")||[]}readAutoGearMonitorDefaults(){return this.getCacheValue("autoGearMonitorDefaults")||{}}readActivePresetId(){const t=this.getCacheValue("autoGearActivePresetId");return typeof t=="string"?t:""}readAutoPresetId(){const t=this.getCacheValue("autoGearAutoPresetId");return typeof t=="string"?t:""}readBackupRetention(){return this.getCacheValue("autoGearBackupRetention")}readBackupVisibility(){return!!this.getCacheValue("autoGearShowBackups")}persistAutoGearRules(t){return this.persistValue("autoGearRules",Array.isArray(t)?t:[],"saveAutoGearRules")}persistAutoGearBackups(t){return this.persistValue("autoGearBackups",Array.isArray(t)?t:[],"saveAutoGearBackups")}persistAutoGearPresets(t){return this.persistValue("autoGearPresets",Array.isArray(t)?t:[],"saveAutoGearPresets")}persistAutoGearMonitorDefaults(t){const r=t&&typeof t=="object"?t:{};return this.persistValue("autoGearMonitorDefaults",r,"saveAutoGearMonitorDefaults")}persistActivePresetId(t){const r=typeof t=="string"?t:"";return this.persistValue("autoGearActivePresetId",r,"saveAutoGearActivePresetId")}persistAutoPresetId(t){const r=typeof t=="string"?t:"";return this.persistValue("autoGearAutoPresetId",r,"saveAutoGearAutoPresetId")}persistBackupRetention(t){return this.persistValue("autoGearBackupRetention",t,"saveAutoGearBackupRetention")}persistBackupVisibility(t){return this.persistValue("autoGearShowBackups",!!t,"saveAutoGearBackupVisibility")}__internalResetCache(){this.cache=bl(),this.hydrating=null}}const Qi=new jb;Qi.hydrateCache().catch(e=>{console.warn("[AutoGearService] Initial hydration failed",e)});if(St&&typeof St=="object"&&!St.cineAutoGearPersistence)try{Object.defineProperty(St,"cineAutoGearPersistence",{configurable:!0,enumerable:!1,writable:!1,value:Qi})}catch{St.cineAutoGearPersistence=Qi}Se.register("cineAutoGearPersistence",Qi,{category:"persistence",description:"Twin-store persistence cache for Auto-Gear state.",connections:["cinePersistence","cineModuleGlobals"],freeze:!1,replace:!0});class Ib{async getProject(t){if(!t)return null;try{const r=await C.loadProject(t);return r?r.data:null}catch(r){return console.error("[ProjectService] Failed to load project:",t,r),null}}async getProjectNames(){try{return await C.getProjectKeys()}catch(t){return console.error("[ProjectService] Failed to get project names:",t),[]}}async getProjectMetadata(t){if(!t)return{};try{const r=await C.getProjectMeta(t),n=await C.loadProject(t);if(n&&n.data)return n.data}catch(r){console.error("[ProjectService] Failed to get project metadata:",t,r)}return{}}async saveProject(t,r){if(!t||!r)return!1;try{return typeof r!="object"?(console.warn("[ProjectService] Invalid project data"),!1):(r.lastModified||(r.lastModified=new Date().toISOString()),(await C.saveProject(t,r)).success)}catch(n){return console.error("[ProjectService] Failed to save project:",t,n),!1}}async createProject(t){if(!t)return!1;const r={created:new Date().toISOString(),lastModified:new Date().toISOString(),gearList:"",projectInfo:null,gearListAndProjectRequirementsGenerated:!1,color:"blue",icon:"📽️"};return this.saveProject(t,r)}async deleteProject(t){if(!t)return!1;try{return await C.removeProject(t),!0}catch(r){return console.error("[ProjectService] Failed to delete project:",t,r),!1}}async duplicateProject(t){try{if(typeof t!="string"||t.length===0)return{success:!1};const r=t.trim(),n=await this.getProject(r);if(!n)return{success:!1};const o=await this.getProjectNames();let i=`${r} (Copy)`,s=2;for(;o.includes(i);)i=`${r} (Copy ${s})`,s++;const a=JSON.parse(JSON.stringify(n));return a.created=new Date().toISOString(),a.lastModified=new Date().toISOString(),{success:await this.saveProject(i,a),newId:i}}catch(r){return console.error("[ProjectService] Failed to duplicate project:",r),{success:!1}}}}const Nb=new Ib;export{Pl as I,kl as _,Fn as a,ma as b,Ol as c,Hs as d,wl as e,Fl as f,Bp as g,Sa as h,F as i,kb as j,fn as k,Tb as l,Mb as m,Pb as n,Rb as o,Nb as p,Se as r,C as s,rg as u};
//# sourceMappingURL=core-modules-DlPoJ4C3.js.map
