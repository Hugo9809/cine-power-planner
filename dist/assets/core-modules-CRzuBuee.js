function Ea(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const kl=Ea(),Jn={value:null,time:0};function Aa(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Vn(){if(Jn.value&&typeof Jn.value=="object")return Jn.value;try{const e=Ea();if(e&&(typeof e=="object"||typeof e=="function"))return Jn.value=e,Jn.time=Date.now(),e}catch{}return kl}function vl(e,t,r){const n=[],o=s=>{!s||typeof s!="object"&&typeof s!="function"||n.indexOf(s)===-1&&n.push(s)};o(e);const i=typeof r=="function"?r:Vn;try{o(i())}catch{}if(Array.isArray(t))for(let s=0;s<t.length;s+=1)o(t[s]);return typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),o(kl),n.slice()}function Gp(e){if(typeof require!="function")return null;try{return require(e)}catch{return null}}function zp(e,t){const r=t||{},n=typeof r.predicate=="function"?r.predicate:null,o=Array.isArray(r.scopes)?r.scopes.slice():[],i=vl(r.primaryScope,r.additionalScopes,r.detect);for(let s=0;s<i.length;s+=1)o.indexOf(i[s])===-1&&o.push(i[s]);for(let s=0;s<o.length;s+=1){const a=o[s];if(!(!a||typeof a!="object"&&typeof a!="function")){if(n)try{if(n(a,e))return a}catch{}try{if(e in a)return a}catch{}}}return null}function Bp(e,t){if(!e)return typeof t=="function"?t():t;const r=Vn();if(r&&typeof r=="object"){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];const n=typeof t=="function"?t():t;if(Aa(r,e,n))try{return r[e]}catch{}return n}return typeof t=="function"?t():t}const xp={baseDetectGlobalScope:Ea,detectGlobalScope:Vn,collectCandidateScopes:vl,tryRequire:Gp,defineHiddenProperty:Aa,resolveFromScopes:zp,getCachedGlobalValue:Bp},Os=Vn();Os&&!Os.cineScopeUtils&&Aa(Os,"cineScopeUtils",xp);const He=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},Oa=(function(){const t=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:null);if(typeof t!="object"||!t)return new Set;const r=Object.values(t).filter(n=>typeof n=="string"&&n);return new Set(r)})();function ao(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return"";if(typeof String.fromCodePoint=="function")try{return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):""}function ki(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=ao(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=ao(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=ao(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=ao(i[1],10);if(s)return s}return t}function F(e,t){const n=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons",o=t||n,i=Oa.has(o)?o:n,a={char:ki(e),font:i};return typeof Object.freeze=="function"?Object.freeze(a):a}function is(e){const r=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons";if(!e)return{char:"",font:r,className:"",size:void 0};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:ki(e),font:r,className:"",size:void 0};if(typeof e=="object"){const n=typeof e.char=="string"?ki(e.char):"",o=e.font&&Oa.has(e.font)?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:"",size:void 0}}function jl(e){return typeof e!="string"?"":e.indexOf('aria-hidden="true"')!==-1?e:e.replace("<svg",'<svg aria-hidden="true"')}function Il(e,t){if(!e)return;const r=is(t);if(r.markup){e.innerHTML=jl(r.markup),e.setAttribute("aria-hidden","true"),r.className&&r.className.split(/\s+/).filter(Boolean).forEach(o=>e.classList.add(o)),e.removeAttribute("data-icon-font");return}const n=r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font):e.removeAttribute("data-icon-font")}function Ll(e,t){const r=is(e),n=[];r.className&&n.push(r.className),t&&n.push(t);const o=n.join(" ");if(r.markup){let s=jl(r.markup);return o&&(s.indexOf('class="')!==-1?s=s.replace('class="',`class="${o} `):s=s.replace("<svg",`<svg class="${o}"`)),s}const i=r.char?`data-icon-font="${r.font}"`:"";return`<span class="icon-glyph ${o}" aria-hidden="true" ${i}>${r.char}</span>`}function Or(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function Rl(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=Or(t),a=Or(r),c=Or(n),l=Or(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(u,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[];return/(?:^|\s)width\s*=/i.test(p)||d.push(`width="${c}"`),/(?:^|\s)height\s*=/i.test(p)||d.push(`height="${l}"`),d.push(`x="-${Or(i)}"`),d.push(`y="-${Or(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}const Ca=`
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M12 17.25 6.545 20.2 7.9 13.975 3 9.45l6.272-.7L12 3l2.728 5.75L21 9.45l-4.9 4.525 1.355 6.225Z"
    fill="currentColor"
    stroke="currentColor"
    stroke-width="0"
  />
</svg>
`.trim(),x=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons",ESSENTIAL:"essential",GADGET:"gadget",FILM:"film",TEXT:"text"}),Tl=Object.freeze({batteryBolt:F("",x.UICONS),batteryFull:F("",x.UICONS),bolt:F("",x.ESSENTIAL),plug:F("",x.UICONS),sliders:F("",x.ESSENTIAL),screen:F("",x.GADGET),brightness:F("",x.UICONS),wifi:F("",x.UICONS),gears:F("",x.UICONS),controller:F("",x.GADGET),distance:F("",x.UICONS),sensor:F("",x.UICONS),viewfinder:F("",x.FILM),camera:F("",x.UICONS),trash:F("",x.ESSENTIAL),reload:F("",x.ESSENTIAL),load:F("",x.UICONS),installApp:F("",x.UICONS),add:Object.freeze({char:"+",font:x.TEXT,className:"icon-text"}),minus:Object.freeze({char:"−",font:x.TEXT,className:"icon-text"}),arrowLeft:Object.freeze({char:"←",font:x.TEXT,className:"icon-text"}),check:F("",x.UICONS),fileExport:F("",x.UICONS),fileImport:F("",x.UICONS),save:F("",x.ESSENTIAL),share:F("",x.ESSENTIAL),paperPlane:F("",x.UICONS),magnet:F("",x.ESSENTIAL),codec:F("",x.UICONS),timecode:F("",x.FILM),audioIn:F("",x.ESSENTIAL),audioOut:F("",x.ESSENTIAL),note:F("",x.ESSENTIAL),overview:F("",x.UICONS),gearList:F("",x.UICONS),contacts:F("",x.UICONS),feedback:F("",x.UICONS),resetView:F("",x.UICONS),pin:F("",x.ESSENTIAL),sun:F("",x.UICONS),moon:F("",x.UICONS),circleX:F("",x.ESSENTIAL),settingsGeneral:F("",x.UICONS),settingsAutoGear:F("",x.UICONS),settingsAccessibility:F("",x.UICONS),settingsBackup:F("",x.UICONS),settingsData:F("",x.UICONS),settingsAbout:F("",x.UICONS),star:Object.freeze({markup:Ca,className:"icon-svg favorite-star-icon"}),warning:F("",x.ESSENTIAL)});He.cineIcons={VALID_ICON_FONTS:Oa,toCodePointChar:ao,normalizeGlyphChar:ki,iconGlyph:F,resolveIconGlyph:is,applyIconGlyph:Il,iconMarkup:Ll,formatSvgCoordinate:Or,positionSvgMarkup:Rl,STAR_ICON_SVG:Ca,ICON_GLYPHS:Tl};He.iconGlyph=F;He.resolveIconGlyph=is;He.applyIconGlyph=Il;He.iconMarkup=Ll;He.formatSvgCoordinate=Or;He.positionSvgMarkup=Rl;He.STAR_ICON_SVG=Ca;He.ICON_GLYPHS=Tl;He.cineIcons;const Fp="modulepreload",Dp=function(e,t){return new URL(e,t).href},_c={},Ml=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let l=function(f){return Promise.all(f.map(u=>Promise.resolve(u).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const s=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");o=l(r.map(f=>{if(f=Dp(f,n),f in _c)return;_c[f]=!0;const u=f.endsWith(".css"),y=u?'[rel="stylesheet"]':"";if(n)for(let d=s.length-1;d>=0;d--){const m=s[d];if(m.href===f&&(!u||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${y}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":Fp,u||(p.as="script"),p.crossOrigin="",p.href=f,c&&p.setAttribute("nonce",c),document.head.appendChild(p),u)return new Promise((d,m)=>{p.addEventListener("load",d),p.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${f}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};function Nl(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Gl(e){return!!e&&(typeof e=="object"||typeof e=="function")}function ss(e){if(typeof Object.freeze=="function")try{return Object.freeze(e)}catch{}return e}function ui(e){if(!e)return[];try{return Array.prototype.slice.call(e)}catch{}const t=[];for(let r=0;r<e.length;r+=1)t[r]=e[r];return t}function Pc(){return{objects:typeof WeakMap=="function"?new WeakMap:null,primitives:Object.create(null),empty:null}}function Up(e,t){if(!e)return null;if(Gl(t)){if(!e.objects)return null;let o=e.objects.get(t);return o||(o={cached:!1,value:null},e.objects.set(t,o)),o}const r=typeof t+":"+String(t);let n=e.primitives[r];return n||(n={cached:!1,value:null},e.primitives[r]=n),n}function Xt(e,t){Gl(t)&&e.indexOf(t)===-1&&e.push(t)}const Us=(function(){const t=[];return Xt(t,typeof globalThis<"u"?globalThis:null),Xt(t,typeof window<"u"?window:null),Xt(t,typeof self<"u"?self:null),Xt(t,typeof global<"u"?global:null),ss(t)})(),Ks=ss([]),zl=typeof WeakMap=="function",Cs=zl?new WeakMap:null;function Kp(e){if(!Array.isArray(e)||e.length===0)return Ks;const t=[];for(let r=0;r<e.length;r+=1)Xt(t,e[r]);return t.length===0?Ks:ss(t)}function kc(e,t,r){const n=[];Xt(n,e);let o=null;if(typeof t=="function")try{o=t()}catch{o=null}Xt(n,o);for(let i=0;i<Us.length;i+=1)Xt(n,Us[i]);if(Array.isArray(r))for(let i=0;i<r.length;i+=1)Xt(n,r[i]);return ss(n)}function $p(e,t){if(!e)return null;if(t===Ks)return e.empty||(e.empty=Pc()),e.empty;if(!e.extras){if(!zl)return null;e.extras=new WeakMap}let r=e.extras.get(t);return r||(r=Pc(),e.extras.set(t,r)),r}function Vp(e){if(!Cs)return null;let t=Cs.get(e);return t||(t={empty:null,extras:null},Cs.set(e,t)),t}function Hp(e,t,r,n){if(n){const i=Up(n,e);if(i){if(i.cached)return ui(i.value);const s=kc(e,t,r);return i.value=s,i.cached=!0,ui(s)}}const o=kc(e,t,r);return ui(o)}function _a(e){const t=e&&typeof e.detectGlobalScope=="function"?e.detectGlobalScope:Nl,r=Kp(e&&e.additionalScopes),n=Vp(t),o=$p(n,r);return function(s){return Hp(s,t,r,o)}}function qp(e,t){return _a(t||{})(e)}function Wp(){return ui(Us)}const _s=Nl();_s&&!_s.__cineScopeCollector&&(_s.__cineScopeCollector={collectCandidateScopes:qp,createCollector:_a,getBaseScopes:Wp});const as="__cinePendingModuleRegistrations__";function sr(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Yp(e){const t=e||sr();if(!t||typeof t!="object"&&typeof t!="function")return;let r=null;try{r=t.console||null}catch{r=null}if(!r||typeof r!="object"&&typeof r!="function")return;const n=["log","warn","error","info","debug"];let o=null;try{o=r.__cineSafeConsoleOriginals||null}catch{o=null}if(!o||typeof o!="object"){o={};try{Object.defineProperty(r,"__cineSafeConsoleOriginals",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{try{r.__cineSafeConsoleOriginals=o}catch{}}}for(let i=0;i<n.length;i+=1){const s=n[i];let a=null;try{a=r[s]}catch{a=null}if(typeof a!="function"||a&&a.__cineSafeConsoleGuard)continue;Object.prototype.hasOwnProperty.call(o,s)||(o[s]=a);const c=function(){try{return a.apply(r,arguments)}catch{}};try{Object.defineProperty(c,"__cineSafeConsoleGuard",{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{c.__cineSafeConsoleGuard=!0}try{r[s]=c}catch{}}}const vc=_a,Jp={key:"defaultExtras"},Ps=[],Ur=typeof WeakMap=="function"?new WeakMap:[];function Qp(e){if(!e||typeof e!="object"&&typeof e!="function")return;if(Ur&&typeof Ur.get=="function"){let r=Ur.get(e);return r||(r=[e],Ur.set(e,r)),r}for(let r=0;r<Ur.length;r+=1){const n=Ur[r];if(n.scope===e)return n.extras}const t=[e];return Ur.push({scope:e,extras:t}),t}function Xp(e,t){if(!vc)return null;const r=Array.isArray(t)?t:Jp;for(let o=0;o<Ps.length;o+=1){const i=Ps[o];if(i.detect===e&&i.extras===r)return i.collector}const n=vc({detectGlobalScope:e,additionalScopes:Array.isArray(t)?t:void 0});return n?(Ps.push({detect:e,extras:r,collector:n}),n):null}function cs(e,t){const r=t||sr(),n=Qp(r),o=Xp(sr,n);if(o)return o(e||r);const i=[];function s(a){!a||typeof a!="object"&&typeof a!="function"||i.indexOf(a)===-1&&i.push(a)}return s(e||r),typeof globalThis<"u"&&s(globalThis),typeof window<"u"&&s(window),typeof self<"u"&&s(self),typeof global<"u"&&s(global),i}function Bl(e){return null}function xl(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Pa(e,t,r){const n=e||r,o=typeof t=="string"&&t?t:as;if(!n||typeof n!="object")return null;let i=n[o];return Array.isArray(i)?i:!xl(n,o,[])||(i=n[o],!Array.isArray(i))?null:i}const ks=(function(){const t="__cineBuiltinImmutabilityGuards__",r=cs(null,sr());for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function $s(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(je&&typeof je=="object")try{if(e===je.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(t){if(t&&typeof t.message=="string"&&/metamask/i.test(t.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function Zp(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Vs(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(Zp(e)||typeof e=="object"&&e&&typeof e.id=="string"&&typeof e.filename=="string"&&(typeof e.loaded=="boolean"||Array.isArray(e.children))||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(ks&&typeof ks.isImmutableBuiltin=="function"&&ks.isImmutableBuiltin(e)||typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function ed(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function ka(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||Vs(e)||$s(e))return e;if(typeof e=="function")try{return Object.freeze(e)}catch{return e}const r=ed(t);if(r.has(e))return e;r.add(e);let n;try{n=Object.getOwnPropertyNames(e)}catch{return e}for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=Object.getOwnPropertyDescriptor(e,i)}catch{s=null}if(s&&(typeof s.get=="function"||typeof s.set=="function"))continue;let a;try{a=e[i]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||Vs(a)||$s(a)||ka(a,r)}try{return Object.freeze(e)}catch{return e}}function Fl(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function td(e,t){const n=cs(e||t,t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}function rd(e,t,r,n,o){const s=Pa(e||o,as,o);if(!s)return!1;const a=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{return s.push(a),!0}catch{}try{return s[s.length]=a,!0}catch{}return!1}function nd(e){const t=e||sr();return{detectGlobalScope:sr,getGlobalScope(){return t},collectCandidateScopes(r){return cs(r||t,t)},tryRequire:Bl,defineHiddenProperty:xl,ensureQueue(r,n){return Pa(r||t,n,t)},freezeDeep:ka,safeWarn:Fl,resolveModuleRegistry(r){return td(r||t,t)},queueModuleRegistration(r,n,o,i){return rd(r||t,n,o,i,t)},getPendingQueueKey(){return as}}}function od(e){const t=e||sr();return t&&typeof t.cineModuleArchitectureKernel=="object"?t.cineModuleArchitectureKernel:null}const va=sr();Yp(va);const id=od(va),Q=id||nd(va);function jc(){if(Q&&typeof Q.detectGlobalScope=="function")try{const e=Q.detectGlobalScope();if(e)return e}catch{}return sr()}const je=Q&&typeof Q.getGlobalScope=="function"?(function(){try{const t=Q.getGlobalScope();if(t)return t}catch{}return jc()})():jc(),Hs=Q&&typeof Q.getPendingQueueKey=="function"?Q.getPendingQueueKey():as;function Dl(e){if(Q&&typeof Q.collectCandidateScopes=="function")try{const t=Q.collectCandidateScopes(e||je);if(Array.isArray(t)&&t.length>0)return t}catch{}return cs(e||je,je)}function Ul(e){if(Q&&typeof Q.tryRequire=="function")try{const t=Q.tryRequire(e);if(typeof t<"u")return t}catch{}return Bl()}function Kl(e){const t=e||je;if(Q&&typeof Q.resolveModuleRegistry=="function")try{const o=Q.resolveModuleRegistry(t);if(o&&typeof o=="object")return o}catch{}const r=Ul("./registry.js");if(r&&typeof r=="object")return r;const n=Dl(t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}let Ic=null,Lc=!1;function qs(e){if(!Lc||e&&e!==je){const t=Kl(e);if(e&&e!==je)return t;Ic=t,Lc=!0}return Ic}function sd(e){const t=e||je;if(Q&&typeof Q.ensureQueue=="function")try{const r=Q.ensureQueue(t,Hs);if(Array.isArray(r))return r}catch{}return Pa(t,Hs,je)}function $l(e,t,r,n){const o=e||je;if(Q&&typeof Q.queueModuleRegistration=="function")try{if(Q.queueModuleRegistration(o,t,r,n))return!0}catch{}const i=sd(o);if(!i)return!1;const s=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{i.push(s)}catch{i[i.length]=s}return!0}function Vl(e,t,r,n,o,i){if(t&&typeof t.register=="function")try{return t.register(r,n,o),!0}catch(s){typeof i=="function"&&i(s)}return $l(e,r,n,o),!1}function Rc(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||Vs(e)||$s(e))return e;if(Q&&typeof Q.freezeDeep=="function")try{return Q.freezeDeep(e)}catch{}return ka(e)}function Hl(e,t){if(Q&&typeof Q.safeWarn=="function")try{Q.safeWarn(e,t);return}catch{}Fl(e,t)}function ql(e,t,r,n={}){const o=r||je;if(!o||typeof o!="object")return!1;const i={configurable:n.configurable!==!1,enumerable:!!n.enumerable,value:t,writable:n.writable===!0};try{return Object.defineProperty(o,e,i),!0}catch{try{return o[e]=t,!0}catch{return!1}}}const Wl=Rc({getGlobalScope(){return je},collectCandidateScopes:Dl,tryRequire:Ul,resolveModuleRegistry:Kl,getModuleRegistry:qs,queueModuleRegistration(e,t,r,n){return $l(n||je,e,t,r)},registerOrQueueModule(e,t,r,n,o,i){const s=o||je,a=i||qs(s);return Vl(s,a,e,t,r,n)},freezeDeep:Rc,safeWarn:Hl,exposeGlobal:ql,PENDING_QUEUE_KEY:Hs}),ad=qs();Vl(je,ad,"cineModuleBase",Wl,{category:"infrastructure",description:"Shared helpers for module registration, freezing and safe global exposure.",replace:!0,connections:["cineModuleArchitectureKernel","cineModuleArchitectureHelpers"]},e=>{Hl("Unable to register cineModuleBase.",e)});ql("cineModuleBase",Wl,je,{configurable:!0,enumerable:!1,writable:!1});var cd={};const Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};let vi=null;!vi&&Ce&&typeof Ce.__cineEnsureConsoleMethodsWritable=="function"&&(vi=Ce.__cineEnsureConsoleMethodsWritable);typeof vi=="function"&&vi(["warn","info"]);const _o="__cinePendingModuleRegistrations__",ja="__cinePendingModuleRegistrationsTimer__";let qr=Object.create(null),ji=Object.create(null),fi=null;function Yl(e){const r=[e||Ce];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModuleImmutability=="object")return o.cineModuleImmutability}return null}const vs=(function(){const t="__cineBuiltinImmutabilityGuards__",r=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&r.push(globalThis),typeof window<"u"&&r.push(window),typeof self<"u"&&r.push(self),typeof global<"u"&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function ld(){function e(r){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function")return!1;try{if(vs&&typeof vs.isImmutableBuiltin=="function"&&vs.isImmutableBuiltin(r)||typeof r.pipe=="function"&&typeof r.unpipe=="function")return!0;if(typeof r.on=="function"&&typeof r.emit=="function"){if(typeof r.write=="function"||typeof r.read=="function")return!0;const n=r.constructor&&r.constructor.name;if(n&&/Stream|Emitter|Port/i.test(n))return!0}if(typeof Symbol<"u"&&r[Symbol.toStringTag]){const n=r[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port/i.test(n))return!0}}catch{}return!1}function t(r,n=new WeakSet){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function"||e(r)||n.has(r))return r;n.add(r);const o=Object.getOwnPropertyNames(r);for(let i=0;i<o.length;i+=1){const s=o[i];let a;try{a=r[s]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||t(a,n)}try{return Object.freeze(r)}catch{return r}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const Ia=ld();let Qn=Yl(Ce)||Ia;function ud(){if(Qn!==Ia)return Qn;const e=Yl(Ce);return e&&e!==Qn&&(Qn=e),Qn}function Rt(e,t){const r=ud();try{return r.freezeDeep(e,t)}catch{}return Ia.freezeDeep(e,t)}function xr(e){if(typeof e=="string"){const t=e.trim();if(t)return t}throw new TypeError("cineModules.register expected a non-empty string name.")}function pi(e){if(e==null)return[];const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=new Set,n=[];for(let o=0;o<t.length;o+=1){const i=t[o];let s=null;if(typeof i=="string"?s=i:i&&typeof i.name=="string"&&(s=i.name),!s)continue;const a=s.trim();!a||r.has(a)||(r.add(a),n.push(a))}return n}function fd(e,t,r={}){const n=xr(e);if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError(`cineModules.register("${n}") expected an object or function.`);const o=r.freeze!==!1,i=o&&!Object.isFrozen(t)?Rt(t):t;if(Object.prototype.hasOwnProperty.call(qr,n)){const s=qr[n];if(s===i)return s;if(!r.replace)throw new Error(`cineModules: Module "${n}" is already registered. Use { replace: true } to overwrite.`)}return qr[n]=i,ji[n]={description:typeof r.description=="string"?r.description.trim():"",category:typeof r.category=="string"?r.category.trim():"",registeredAt:Date.now(),frozen:o,connections:Rt(pi(r.connections||r.links||r.dependencies||null))},i}function pd(e){const t=xr(e);return Object.prototype.hasOwnProperty.call(qr,t)?qr[t]:null}function Jl(e){const t=xr(e);return Object.prototype.hasOwnProperty.call(qr,t)}function dd(){return Object.freeze(Object.keys(qr).sort())}function yd(e){const t=xr(e),r=ji[t];return r?Object.freeze({name:t,description:r.description,category:r.category,registeredAt:r.registeredAt,frozen:r.frozen,connections:r.connections||Rt([])}):null}function gd(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];try{const s=xr(i);n.has(s)||(n.add(s),r.push(s))}catch{}}return r.length>0?r:null}function md(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i!="string")continue;const s=i.trim();!s||n.has(s)||(n.add(s),r.push(s))}return r.length>0?r:null}function hd(e={}){const t=gd(e&&e.names),r=md(e&&(e.categories||e.category||null)),n=t?new Set(t):null,o=r?new Set(r):null,i=[],s=n?t:Object.keys(ji);for(let a=0;a<s.length;a+=1){const c=s[a],l=ji[c];l&&(o&&!o.has(l.category)||i.push({name:c,description:l.description,category:l.category,registeredAt:l.registeredAt,frozen:l.frozen,connections:l.connections||Rt([])}))}return n||(!e||e.sort!==!1)&&i.sort((c,l)=>c.name.localeCompare(l.name)),Rt(i)}function bd(e){const t=Array.isArray(e)?e.slice():[e],r={},n=[];for(let o=0;o<t.length;o+=1){const i=xr(t[o]),s=Jl(i);r[i]=s,s||n.push(i)}return Object.freeze({ok:n.length===0,missing:Object.freeze(n),detail:Object.freeze(r)})}function Sd(e={}){throw typeof process<"u"&&process,new Error("cineModules.__internalResetForTests() is restricted to test environments.")}function Ql(e){if(!e||typeof e!="object")return null;const t=e[ja];return t&&typeof t=="object"?t:null}function La(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Ii(e){const t=Ql(e);if(!t)return;const r=t&&typeof t.clear=="function"?t.clear:null;if(r&&Object.prototype.hasOwnProperty.call(t,"id"))try{r(t.id)}catch{}La(e,ja,null)}function Xl(e){if(!e||typeof e!="object")return;const t=e[_o];if(!Array.isArray(t)||t.length===0){Ii(e);return}if(Ql(e))return;const r=typeof e.setTimeout=="function"&&e.setTimeout.bind(e)||typeof Ce.setTimeout=="function"&&Ce.setTimeout.bind(Ce)||(typeof setTimeout=="function"?setTimeout:null);if(typeof r!="function")return;const n=typeof e.clearTimeout=="function"&&e.clearTimeout.bind(e)||typeof Ce.clearTimeout=="function"&&Ce.clearTimeout.bind(Ce)||(typeof clearTimeout=="function"?clearTimeout:null),o=r(function(){Ii(e),Zl(e)},0);La(e,ja,{id:o,clear:typeof n=="function"?n:null})}function Zl(e){if(!e||typeof e!="object")return;const t=e[_o];if(!Array.isArray(t)||t.length===0){Ii(e);return}const r=t.slice();t.length=0;for(let n=0;n<r.length;n+=1){const o=r[n];if(!o||typeof o!="object")continue;const i=o.name,s=o.api,a=o.options||{};try{Se.register(i,s,a)}catch(c){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`cineModules: discard pending registration for "${i}" due to error:`,c);continue}}t.length>0?Xl(e):Ii(e)}function wd(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),r(Ce),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function js(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e[_o];return Array.isArray(t)?t:null}catch{return null}}function Ed(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=js(e);if(t||La(e,_o,[])&&(t=js(e),t))return t;try{if(e[_o]=[],t=js(e),t)return t}catch{}return null}function Ad(e){const t=wd(e);for(let r=0;r<t.length;r+=1){const n=t[r],o=Ed(n);if(o)return{queue:o,scope:n}}return null}function Od(e,t){const r=Ad(e||Ce);if(!r||!r.queue)return!1;const n=Rt({name:t&&t.name?xr(t.name):null,api:t?t.api:null,options:Object.freeze({...t&&t.options?t.options:{}})}),{queue:o,scope:i}=r;try{o.push(n)}catch{o[o.length]=n}try{Xl(i)}catch{}return!0}function Cd(e={}){const t=xr(e.name),r=typeof e.category=="string"?e.category.trim():"";if(!r)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty category string.`);const n=typeof e.description=="string"?e.description.trim():"";if(!n)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty description.`);const o=e.freeze!==!1,i=Rt(pi(e.connections)),s=typeof e.factory=="function"?e.factory:null,a=s?null:e.api;if(!s&&(!a||typeof a!="object"&&typeof a!="function"))throw new TypeError(`cineModules.createBlueprint("${t}") expected an object API or factory function.`);const c=Object.freeze({name:t,category:r,description:n,connections:i,freeze:o});let l=null,f=!1,u=null;function y(g){const b={category:c.category,description:c.description,connections:c.connections,freeze:c.freeze};if(!g||typeof g!="object")return Object.freeze({...b});const _={...b};if(Object.prototype.hasOwnProperty.call(g,"category")){const w=typeof g.category=="string"?g.category.trim():"";w&&(_.category=w)}if(Object.prototype.hasOwnProperty.call(g,"description")){const w=typeof g.description=="string"?g.description.trim():"";w&&(_.description=w)}return Object.prototype.hasOwnProperty.call(g,"connections")&&(_.connections=Rt(pi(g.connections))),Object.prototype.hasOwnProperty.call(g,"freeze")&&(_.freeze=g.freeze!==!1),Object.freeze(_)}function p(g){if(f){if(u)throw u;return l}f=!0;let b=a;if(s){const _=g&&typeof g=="object"?{...g}:{},w=Object.freeze({registry:fi||null,metadata:c,context:_,freezeDeep:Rt,normalizeConnections:pi});try{b=s(w)}catch(h){throw u=h instanceof Error?h:new Error(String(h)),u}}if(!b||typeof b!="object"&&typeof b!="function"){const _=new TypeError(`cineModules.createBlueprint("${t}") factory expected an object or function return value.`);throw u=_,_}return l=o&&!Object.isFrozen(b)?Rt(b):b,l}function d(g={}){const b=g&&typeof g.registry=="object"&&g.registry?g.registry:fi,_=y(g&&g.options),w=g&&g.scope?g.scope:Ce,h=g&&Object.prototype.hasOwnProperty.call(g,"defer")?g.defer!==!1:!0,A=g&&typeof g.onError=="function"?g.onError:null,C=p(g&&g.context),j=b&&typeof b.register=="function"?b:fi;if(!j||typeof j.register!="function")throw new TypeError("cineModules.createBlueprint register() requires a registry with a register() function.");try{return j.register(c.name,C,_)}catch(O){if(h&&Od(w,{name:c.name,api:C,options:_}),A)try{A(O)}catch{}throw O}}const m={name:c.name,category:c.category,description:c.description,connections:c.connections,freeze:c.freeze,instantiate:p,register:d,getMetadata(){return c},createRegistrationOptions:y,toJSON(){return c}};return Object.freeze(m)}const Se={};Se.register=fd;Se.get=pd;Se.has=Jl;Se.list=dd;Se.describe=yd;Se.describeAll=hd;Se.assertRegistered=bd;Se.createBlueprint=Cd;Se.__internalResetForTests=Sd;fi=Se;const ar=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&ar.push(globalThis);typeof window<"u"&&ar.indexOf(window)===-1&&ar.push(window);typeof self<"u"&&ar.indexOf(self)===-1&&ar.push(self);typeof global<"u"&&ar.indexOf(global)===-1&&ar.push(global);for(let e=0;e<ar.length;e+=1){const t=ar[e];if(!t||typeof t!="object")continue;if(t.cineModules!==Se)try{Object.defineProperty(t,"cineModules",{configurable:!0,enumerable:!1,value:Se,writable:!0})}catch{try{t.cineModules=Se}catch{}}Zl(t)}const Vo=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},_d=new Set(["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI","DisplayPort"]),Li="__normalized";function eu(e){const t=new Map;return r=>{if(!r)return"";const n=String(r).replace(/[™®]/g,"").trim(),o=n.toLowerCase();return t.has(o)||t.set(o,e(n,o)),t.get(o)}}const Pd=[{needles:["12g"],value:"12G-SDI"},{needles:["6g"],value:"6G-SDI"},{needles:["3g"],value:"3G-SDI"},{needles:["hd","sdi"],value:"3G-SDI"},{needles:["mini","bnc"],value:"Mini BNC"},{needles:["micro","hdmi"],value:"Micro HDMI"},{needles:["mini","hdmi"],value:"Mini HDMI"},{needles:["hdmi"],value:"HDMI"},{needles:["displayport"],value:"DisplayPort"},{needles:["display","port"],value:"DisplayPort"},{needles:["dp"],value:"DisplayPort"}],tu=eu((e,t)=>{const r=Pd.find(({needles:n})=>n.every(o=>t.includes(o)));return r?r.value:""}),kd={"lemo 4-pin (lbus)":"LBUS (LEMO 4-pin)","lbus (lemo 4-pin)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo for motors)":"LBUS (LEMO 4-pin)","4-pin lemo (lbus)":"LBUS (LEMO 4-pin)","lemo 4-pin":"LEMO 4-pin","4-pin lemo":"LEMO 4-pin","lemo 7-pin":"LEMO 7-pin","lemo 7-pin 1b":"LEMO 7-pin","7-pin lemo":"LEMO 7-pin","7-pin lemo (lcs)":"LEMO 7-pin (LCS)","7-pin lemo (cam)":"LEMO 7-pin (CAM)","ext (lemo 7-pin)":"EXT LEMO 7-pin","hirose 12pin":"Hirose 12-pin","12-pin hirose":"Hirose 12-pin","12pin broadcast connector":"Hirose 12-pin","lens 12 pin":"Hirose 12-pin","lens terminal 12-pin":"Hirose 12-pin","lens terminal 12-pin jack":"Hirose 12-pin","lens terminal":"Hirose 12-pin","usb type-c":"USB-C","usb-c":"USB-C","usb-c (usb 3.2 / 3.1 gen 1)":"USB-C","usb-c / gigabit ethernet (via adapter)":"USB-C","active ef mount":"Active EF mount","lanc (2.5mm stereo mini jack)":"LANC","2.5 mm sub-mini (lanc)":"LANC","remote a (2.5mm)":"REMOTE A connector","remote control terminal":"REMOTE A connector","remote 8 pin":"REMOTE B connector"};function Ra(e){return eu((t,r)=>e[r]||t)}const co=Ra(kd),vd={'dsmc3 red touch 7" lcd (optional)':'RED Touch 7" LCD (Optional)','red touch 7.0" lcd (optional)':'RED Touch 7" LCD (Optional)',"lcd touch panel":"LCD touchscreen","lcd touchscreen":"LCD touchscreen","native lcd capacitive touchscreen":"LCD touchscreen","integrated touchscreen lcd":"LCD touchscreen","free-angle lcd":"Vari-angle LCD","lcd monitor (native)":"Integrated LCD monitor","native lcd viewfinder":"Integrated LCD monitor","lcd monitor lm-v2 (supplied)":"LCD Monitor LM-V2","integrated main monitor":"Integrated LCD monitor","optional evf-v70 viewfinder":"EVF-V70 (Optional)","optional evf-v50":"EVF-V50 (Optional)","optional oled viewfinder":"OLED EVF (Optional)","blackmagic pocket cinema camera pro evf (optional)":"Blackmagic Pro EVF (Optional)","external backlit lcd status display":"LCD status display","built-in fold-out lcd":"Fold-out LCD","oled lvf (live view finder)":"OLED EVF","lcd capacitive touchscreen":"LCD touchscreen","lemo 26 pin":"LEMO 26-pin port"},ru=Ra(vd),jd={"lemo 8-pin (dc in / bat)":"Bat LEMO 8-pin","lemo 8-pin (bat)":"Bat LEMO 8-pin","bat (lemo 8-pin)":"Bat LEMO 8-pin","lemo 8-pin":"Bat LEMO 8-pin","2-pin dc-input":"2-pin DC-IN","dc-":"DC IN",dc:"DC IN","2-pin xlr":"XLR 2-pin","2-pin locking connector":"LEMO 2-pin","2-pin locking connector / 2-pin lemo":"LEMO 2-pin","4-pin xlr / dc in 12v":"XLR 4-pin","4-pin xlr / v-lock":"XLR 4-pin","xlr 4-pin jack":"XLR 4-pin","xlr 4-pin (main input)":"XLR 4-pin","xlr-type 4 pin (male) / square-shaped 5 pin connector (battery)":"XLR 4-pin / Square 5-pin","12-pin molex connector (at battery plate rear) / 4-pin xlr (external power)":"Molex 12-pin / XLR 4-pin","battery slot":"Battery Slot","usb-c":"USB-C","usb type-c":"USB-C","usb-c pd":"USB-C PD","usb-c (power delivery)":"USB-C PD","usb-c pd,dc coupler":"USB-C PD / DC Coupler","dc coupler":"DC Coupler","dc coupler (dr-e6c)":"DC Coupler","dc input":"DC IN","dc barrel":"DC Barrel","dc (barrel)":"DC Barrel","locking dc barrel":"DC Barrel","dc 24v terminal":"DC Barrel","weipu sf610/s2 (12vdc) input":"Weipu SF610/S2","6-pin 1b dc-in / tb50 battery mount":"6-pin 1B DC-IN","6-pin 1b dc-,tb50":"6-pin 1B DC-IN"},Tc=Ra(jd);function di(e){if(!e)return[];const t=r=>{const n=Tc(r);return n?n.split(/[/,]/).map(o=>Tc(o.trim())).map(o=>o&&o.trim()||"").filter(Boolean):[]};return Array.isArray(e)?e.flatMap(t):t(e)}function Ar(e,t){return Array.isArray(e)?e.map(r=>typeof r=="string"?{...t,type:r}:{...t,...r||{}}):[]}function Ta(e){if(!e)return;e.powerInput&&!e.power?.input&&(e.power={...e.power||{},input:{type:di(e.powerInput)}},delete e.powerInput);const t=e.power?.input;if(!t)return;const r=n=>{if(typeof n=="string")return{type:di(n)};if(n){const{portType:o,type:i,...s}=n,a=!i&&o?o:i;return{...s,type:a?di(a):[]}}return{type:[]}};e.power.input=Array.isArray(t)?t.map(r):r(t)}function Mc(e){!e||typeof e!="object"||Object.values(e).forEach(Ta)}function nu(e){return!!(e&&Object.prototype.hasOwnProperty.call(e,Li)&&e[Li])}function Ma(e){if(!e||typeof e!="object")return e;try{Object.defineProperty(e,Li,{configurable:!0,enumerable:!1,value:!0,writable:!0})}catch{e[Li]=!0}return e}function Na(e,t){if(!e||typeof e!="object"||!!!(t&&t.force)&&nu(e))return e;Object.values(e.cameras||{}).forEach(o=>{o.power?.input&&o.power.input.powerDrawWatts!==void 0&&delete o.power.input.powerDrawWatts,Ta(o),Array.isArray(o.power?.batteryPlateSupport)&&(o.power.batteryPlateSupport=o.power.batteryPlateSupport.map(i=>{if(typeof i=="string"){const s=i.match(/([^()]+)(?:\(([^)]+)\))?(?:\s*-\s*(.*))?/),a=s?s[1].trim():i;let c=s&&s[2]?s[2].trim().toLowerCase():"";c?/via adapter/i.test(c)&&(c="adapted"):c=/adapted|via adapter/i.test(i)?"adapted":"native";const l=s&&s[3]?s[3].trim():/via adapter/i.test(i)?"via adapter":"";return{type:a,mount:c,notes:l}}return{type:i.type||"",mount:(i.mount?i.mount:i.native?"native":i.adapted?"adapted":"native").toLowerCase(),notes:i.notes||""}})),o.power&&(o.power.powerDistributionOutputs=Ar(o.power.powerDistributionOutputs,{type:"",voltage:"",current:"",wattage:null,notes:""})),o.videoOutputs=Ar(o.videoOutputs,{type:"",notes:""}).flatMap(i=>{const{count:s,...a}=i||{},c=tu(a.type);if(!_d.has(c))return[];const l=parseInt(s,10),f=Number.isFinite(l)&&l>0?l:1,u={...a,type:c,notes:a.notes||""};return Array.from({length:f},()=>({...u}))}),o.fizConnectors=Ar(o.fizConnectors,{type:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:co(s)}}),o.viewfinder=Ar(o.viewfinder,{type:"",resolution:"",connector:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:ru(s)}}),o.recordingMedia=Ar(o.recordingMedia,{type:"",notes:""}).map(i=>{let{type:s="",notes:a=""}=i||{};const c=s.match(/^(.*?)(?:\((.*)\))?$/);return c&&(s=c[1].trim(),a=a||(c[2]?c[2].trim():"")),/^SD UHS-II$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II`:"UHS-II"):/^SD \(UHS-II\/UHS-I\)$/i.test(s)?(s="SD Card",a="UHS-II/UHS-I"):s==="CFast 2.0 card slots"?(s="CFast 2.0",a=a||"Dual Slots"):s==="CFexpress Type B (Dual Slots)"?(s="CFexpress Type B",a=a||"Dual Slots"):s==="CFexpress Type B (via adapter)"?(s="CFexpress Type B",a=a||"via adapter"):/^SD UHS-II \(Dual Slots\)$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II (Dual Slots)`:"UHS-II (Dual Slots)"):s==="SD Card (Dual Slots)"?(s="SD Card",a=a||"Dual Slots"):s==="SD card slot (for proxy/backup)"&&(s="SD Card",a=a||"for proxy/backup"),{type:s,notes:a}}),o.timecode=Ar(o.timecode,{type:"",notes:""}),o.lensMount=Ar(o.lensMount,{type:"",mount:"native",notes:""}).map(i=>({type:i.type,mount:i.mount?i.mount.toLowerCase():"native",notes:i.notes||""})).filter((i,s,a)=>s===a.findIndex(c=>c.type===i.type&&c.mount===i.mount&&c.notes===i.notes))}),Object.values(e.lenses||{}).forEach(o=>{if(!o||typeof o!="object")return;const i=y=>{if(!y)return null;if(typeof y=="string"){const m=y.trim();return m?{type:m,mount:"native"}:null}const p=typeof y.type=="string"?y.type.trim():"";if(!p)return null;const d=typeof y.mount=="string"?y.mount.trim().toLowerCase():"";return{type:p,mount:d==="adapted"?"adapted":"native"}},s=o.mountOptions,a=[],c=y=>{const p=i(y);p&&a.push(p)};if(Array.isArray(s)?s.forEach(c):s&&typeof s=="object"&&c(s),!a.length&&Array.isArray(o.lensMount)&&(o.lensMount.forEach(c),delete o.lensMount),!a.length){const y=typeof o.mount=="string"?o.mount.trim():"";y&&c({type:y,mount:"native"})}const l=[];a.forEach(y=>{if(!y||!y.type)return;const p=y.mount==="adapted"?"adapted":"native";l.some(m=>m.type===y.type&&m.mount===p)||l.push({type:y.type,mount:p})});const f=Array.isArray(l)?l:[];o.mountOptions=f;const u=Array.isArray(o.mountOptions)?o.mountOptions:[];if(u.length){const y=u.find(d=>d&&d.mount==="native"&&d.type)||u[0],p=y&&y.type?y.type:"";p?o.mount=p:typeof o.mount=="string"&&(o.mount=o.mount.trim())}else typeof o.mount=="string"&&(o.mount=o.mount.trim(),o.mount||delete o.mount)}),["monitors","video","viewfinders"].forEach(o=>{Mc(e[o])});const n=e.fiz||{};return["motors","controllers","distance"].forEach(o=>{Mc(n[o])}),Object.values(e.fiz?.motors||{}).forEach(o=>{o&&(o.connector&&!o.fizConnector&&(o.fizConnector=o.connector,delete o.connector),o.fizConnector&&(o.fizConnector=co(o.fizConnector)))}),Object.values(e.fiz?.controllers||{}).forEach(o=>{if(o)if(o.FIZ_connector&&!o.fizConnector&&!o.fizConnectors&&(o.fizConnector=o.FIZ_connector,delete o.FIZ_connector),Array.isArray(o.fizConnectors))o.fizConnectors=o.fizConnectors.map(i=>{if(!i)return{type:""};const s=co(i.type||i),a=i.notes||void 0;return a?{type:s,notes:a}:{type:s}});else if(o.fizConnector){const i=String(o.fizConnector).split(",").map(s=>s.trim()).filter(Boolean);o.fizConnectors=i.map(s=>({type:co(s)})),delete o.fizConnector}else o.fizConnectors=[]}),Ma(e),e}function ou(e){return Na(e,{force:!0})}Vo.cineDeviceNormalization={unifyDevices:Na,normalizeDevicesForPersistence:ou,markDevicesNormalized:Ma,hasNormalizedDevicesMarker:nu,fixPowerInput:Ta,normalizeVideoType:tu,normalizeFizConnectorType:co,normalizeViewfinderType:ru,normalizePowerPortType:di,ensureList:Ar};Vo.unifyDevices=Na;Vo.normalizeDevicesForPersistence=ou;Vo.markDevicesNormalized=Ma;Vo.cineDeviceNormalization;var Nc={};function iu(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Fr(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function Id(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function Gc(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}const su=(function(){const t=iu();if(t&&typeof t.__cineDeepClone=="function")return t.__cineDeepClone;const r=Id(t);return r?function(o){if(o===null||typeof o!="object")return o;try{return r(o)}catch{}return Gc(o)}:Gc})();function Ld(e){const t=Fr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function Rd(e){const t=Fr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}function Td(e){const t=Fr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleGlobals=="object")return n.cineModuleGlobals}return null}function zc(e){return null}const ls=iu(),Y=Ld(ls),J=Rd(ls),q=Td(ls),W=(J&&typeof J.getGlobalScope=="function"?J.getGlobalScope():null)||(Y&&typeof Y.getGlobalScope=="function"?Y.getGlobalScope():null)||ls;(function(){return q&&typeof q.tryRequire=="function"?q.tryRequire:J&&typeof J.tryRequire=="function"?function(r){const n=J.tryRequire(r);return typeof n>"u"?zc():n}:Y&&typeof Y.tryRequire=="function"?Y.tryRequire:zc})();const Bc=(function(){const t=[];function r(o,i){if(typeof o!="function")return;t.some(a=>a&&a.fn===o)||t.push({fn:o,scope:i||null})}if(q&&(typeof q.structuredClone=="function"&&r(q.structuredClone,q),typeof q.getStructuredClone=="function"))try{const o=q.getStructuredClone();r(o,q)}catch{}if(J&&(typeof J.structuredClone=="function"&&r(J.structuredClone,J),typeof J.getStructuredClone=="function"))try{const o=J.getStructuredClone();r(o,J)}catch{}if(Y&&(typeof Y.structuredClone=="function"&&r(Y.structuredClone,Y),typeof Y.getStructuredClone=="function"))try{const o=Y.getStructuredClone();r(o,Y)}catch{}const n=Fr(W);for(let o=0;o<n.length;o+=1){const i=n[o];if(!i||typeof i!="object"&&typeof i!="function")continue;const s=i.structuredClone;typeof s=="function"&&r(s,i)}return t})();let Xo=null;function Md(e){if(Xo)try{const t=Xo;return{success:!0,value:t.scope?t.fn.call(t.scope,e):t.fn(e)}}catch{Xo=null}for(let t=0;t<Bc.length;t+=1){const r=Bc[t];if(!(!r||typeof r.fn!="function"))try{const n=r.scope?r.fn.call(r.scope,e):r.fn(e);return Xo=r,{success:!0,value:n}}catch{}}return{success:!1,value:null}}function Nd(e){if(q&&typeof q.resolveModuleRegistry=="function")try{const r=q.resolveModuleRegistry(e||W);if(r)return r}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const r=J.getModuleRegistry(e||W);if(r)return r}catch{}if(Y&&typeof Y.resolveModuleRegistry=="function")try{return Y.resolveModuleRegistry(e||W)}catch{}if(Se&&typeof Se=="object")return Se;const t=Fr(W);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModules=="object")return n.cineModules}return null}const yi=(function(){if(q&&typeof q.getModuleRegistry=="function")try{const t=q.getModuleRegistry(W);if(t)return t}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const t=J.getModuleRegistry(W);if(t)return t}catch{}if(Y&&typeof Y.getModuleRegistry=="function")try{const t=Y.getModuleRegistry(W);if(t)return t}catch{}return Nd()})(),Gd=(function(){return q&&typeof q.queueModuleRegistration=="function"?function(r,n,o,i){try{return q.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:J&&typeof J.queueModuleRegistration=="function"?function(r,n,o){try{const i=J.queueModuleRegistration(r,n,o);return typeof i>"u"?!1:i}catch{return!1}}:Y&&typeof Y.queueModuleRegistration=="function"?function(r,n,o,i){try{return Y.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:function(){return!1}})(),zd=(function(){return q&&typeof q.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=q.registerOrQueueModule(r,n,o,i,s||W,a||yi);return typeof c>"u"?!1:c}catch{return!1}}:J&&typeof J.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=J.registerOrQueueModule(r,n,o,i,s||W,a||yi);return typeof c>"u"?!1:c}catch{return!1}}:Y&&typeof Y.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{return Y.registerOrQueueModule(r,n,o,i,s||W,a||yi)}catch{return!1}}:function(r,n,o,i){if(typeof i=="function")try{if(typeof window<"u"&&window.cineModuleRegistry&&typeof window.cineModuleRegistry.register=="function")return window.cineModuleRegistry.register(r,n,o),!0;console.warn("Logging module registration deferred - queue unavailable.")}catch{}return!1}})();function Bd(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function xd(e){if(!e||typeof e!="object"||Bd(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;const t=e.constructor;if(!t)return!1;if(t===Number||t===String||t===Boolean||t===Date||t===RegExp||t===Promise||t===WeakMap||t===WeakSet||t===Map||t===Set)return!0;const r=typeof t.name=="string"?t.name:"";if(r&&/Error|Event|Response|Request|Headers|Node|Element|Window|Document/.test(r))return!0;try{if(typeof e.then=="function"||typeof e.catch=="function"||typeof e.pipe=="function"||typeof e.on=="function"||typeof e.write=="function"||typeof e.read=="function"||typeof e.getReader=="function"||typeof e.getWriter=="function"||typeof e[Symbol.iterator]=="function"&&!Array.isArray(e))return!0;if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const n=e[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port|Process/.test(n))return!0}}catch{}return!1}function Ws(e,t){const r=t||(typeof WeakSet=="function"?new WeakSet:{add(){},has(){return!1}});if(!e||typeof e!="object"||xd(e))return e;if(typeof process<"u"&&process&&Nc&&Nc.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(typeof r.has=="function"&&r.has(e))return e;typeof r.add=="function"&&r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||Ws(s,r)}try{try{return Object.freeze(e)}catch(o){return e}}catch{return e}}const Ie=(function(){return q&&typeof q.freezeDeep=="function"?q.freezeDeep:J&&typeof J.freezeDeep=="function"?function(r,n){try{return J.freezeDeep(r,n)}catch{return Ws(r,n)}}:Y&&typeof Y.freezeDeep=="function"?Y.freezeDeep:Ws})();function xc(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Xe=(function(){return q&&typeof q.safeWarn=="function"?q.safeWarn:J&&typeof J.safeWarn=="function"?function(r,n){try{J.safeWarn(r,n)}catch{xc(r,n)}}:Y&&typeof Y.safeWarn=="function"?Y.safeWarn:xc})(),Tn=["debug","info","warn","error","log"],It=typeof Symbol=="function"?Symbol.for("cineLoggingConsoleProxyInstalled"):"__cineLoggingConsoleProxyInstalled__",de=(function(){const t=Object.create(null);if(typeof console>"u"||!console)return t;for(let r=0;r<Tn.length;r+=1){const n=Tn[r];try{const o=console[n];t[n]=typeof o=="function"?o:null}catch{t[n]=null}}return t})();let Et=!1,Ga=!1,Vr=!1,Xn=null,Zo=!1,Zn=0;const Fd=(function(){return q&&typeof q.exposeGlobal=="function"?function(r,n,o){try{return q.exposeGlobal(r,n,o)}catch{return!1}}:function(r,n){if(!W||typeof W!="object"&&typeof W!="function")return!1;try{return W[r]=n,!0}catch{return!1}}})();function Dd(e,t){if(!(!q||typeof q.recordModule!="function"))try{q.recordModule(e,t)}catch{}}const $t={debug:{priority:10,consoleMethod:"debug"},info:{priority:20,consoleMethod:"info"},warn:{priority:30,consoleMethod:"warn"},error:{priority:40,consoleMethod:"error"}},Ud=Ie($t),Mn=Object.freeze(Object.keys($t).concat(["other"]));function Hn(){const e=Object.create(null);for(let t=0;t<Mn.length;t+=1){const r=Mn[t];e[r]=0}return e}function Kd(e){if(!(!e||typeof e!="object"))for(let t=0;t<Mn.length;t+=1){const r=Mn[t];e[r]=0}}function $d(e){if(typeof e=="string"&&e){if(Object.prototype.hasOwnProperty.call($t,e))return e;const t=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call($t,t))return t}return"other"}function Ys(e,t){if(!e||typeof e!="object")return 0;const r=e[t];return typeof r=="number"&&Number.isFinite(r)&&r>0?r:0}function za(e,t,r){if(!e||typeof e!="object"||typeof r!="number"||!Number.isFinite(r)||r===0)return;const n=$d(t),i=Ys(e,n)+r;e[n]=i>0?i:0}function au(e,t,r){if(!(!Array.isArray(t)||!t.length)&&!(typeof r!="number"||!Number.isFinite(r)||r===0))for(let n=0;n<t.length;n+=1){const o=t[n],i=o&&o.level;za(e,i,r)}}function Vd(e){const t=Hn();return au(t,e,1),t}function cu(e,t){if(!(!e||typeof e!="object"||!t||typeof t!="object"))for(let r=0;r<Mn.length;r+=1){const n=Mn[r],o=Ys(t,n);if(o){const i=Ys(e,n);e[n]=i+o}}}function lu(e){const t=Hn();return cu(t,e),t}function On(e){return Ie(lu(e))}const Ri=50,uu=1,fu=5e3,Ti="__cineLoggingHistory",Js="__cineLoggingConfig",Hd=typeof Symbol=="function"?Symbol.for("cineLoggingHandled"):"__cineLoggingHandled__",mt={level:"warn",historyLevel:"info",historyLimit:1200,consoleOutput:!0,persistSession:!0,captureGlobalErrors:!0,captureConsole:!1,stackTraces:!0},qd=Ie(mt),Wd="cine-sw-logs",Yd="cine-sw:log-entry",Jd="cine-sw:log-state-request",Qd="cine-sw:log-state",Fc=5e3,Xd=60*1e3,Zd=200;function pu(){return{level:mt.level,historyLevel:mt.historyLevel,historyLimit:mt.historyLimit,consoleOutput:mt.consoleOutput,persistSession:mt.persistSession,captureGlobalErrors:mt.captureGlobalErrors,captureConsole:mt.captureConsole,stackTraces:mt.stackTraces}}let L=pu();const Nt=[],Mi=new Set,Ni=new Set,ei=typeof WeakSet=="function"?new WeakSet:[];let du=0;const yu=Hn(),us=Hn(),gu=Hn();let mu=0,ae=null;const U={initialised:!1,supported:!1,requestInFlight:!1,lastRequestId:null,pollTimer:null,requestTimer:null,broadcastChannel:null,broadcastFailed:!1,seenIds:typeof Set=="function"?new Set:null,fallbackSeenIds:typeof Set!="function"?[]:null,lastSnapshotMeta:null};function Rr(e,t){const r=typeof t=="string"?t:L.level;if(typeof e=="string"){const n=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call($t,n))return n;if(n==="log"||n==="information")return"info";if(n==="warning")return"warn";if(n==="trace"||n==="verbose")return"debug";if(n==="fatal"||n==="critical")return"error"}return Object.prototype.hasOwnProperty.call($t,r)?r:"info"}function Nn(e){const t=Rr(e,"info"),r=$t[t];return r?r.priority:$t.info.priority}function eo(e,t){if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:e>0:!!t;if(typeof e=="string"){const r=e.trim().toLowerCase();if(r==="true"||r==="1"||r==="yes"||r==="on")return!0;if(r==="false"||r==="0"||r==="no"||r==="off")return!1}return typeof t=="boolean"?t:!1}function hu(e,t){const n=!!(t&&t.allowReducedMin===!0)?uu:Ri;if(typeof e=="number"&&Number.isFinite(e)){const o=Math.abs(Math.floor(e));return o?Math.max(n,Math.min(fu,o)):L.historyLimit}if(typeof e=="string"&&e){const o=Number(e);if(Number.isFinite(o))return hu(o,t)}return L.historyLimit}function Po(e){if(typeof e=="string")return e;if(e instanceof Error)return e.message||e.name||"Error";if(e&&typeof e=="object"){if(typeof e.message=="string")return e.message;const t=e.constructor&&e.constructor.name;if(t)return t}if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e>"u"||e===null)return"";try{return String(e)}catch{}return Object.prototype.toString.call(e)}function le(e,t,r){const n=typeof t=="number"?t:0,o=r||(typeof WeakSet=="function"?new WeakSet:null);if(e===null||typeof e>"u")return null;const i=typeof e;if(i==="string"||i==="number"||i==="boolean")return e;if(i==="bigint")try{return e.toString()}catch{return"BigInt"}if(i==="symbol")try{return e.toString()}catch{return"Symbol"}if(i==="function")return`[Function${e.name?` ${e.name}`:""}]`;if(e instanceof Date)try{return e.toISOString()}catch{return e.toString()}if(typeof RegExp<"u"&&e instanceof RegExp){try{return e.toString()}catch{}return"[RegExp]"}if(e instanceof Error){const a={name:e.name,message:e.message};if(e.stack&&(a.stack=String(e.stack)),typeof e.code<"u"&&(a.code=e.code),typeof e.status<"u"&&(a.status=e.status),typeof e.cause<"u"&&e.cause!==null&&(a.cause=le(e.cause,n+1,o)),typeof e.details<"u"&&(a.details=le(e.details,n+1,o)),typeof e.errors<"u"&&e.errors!==null){const c=[];let f=0;const u=function(d){if(c.length>=10){f+=1;return}try{c.push(le(d,n+1,o))}catch(m){c.push(m&&m.message?`[Unserializable error: ${m.message}]`:"[Unserializable error]")}},y=e.errors;if(Array.isArray(y)){for(let p=0;p<y.length;p+=1)u(y[p]);y.length>c.length&&(f+=y.length-c.length)}else if(y&&typeof y=="object"){let p=null;try{const d=typeof Symbol=="function"?Symbol.iterator:null;d&&typeof y[d]=="function"&&(p=y[d].call(y))}catch{p=null}if(p&&typeof p.next=="function"){let d=p.next(),m=0;for(;!d.done;){m<10?u(d.value):f+=1,m+=1;try{d=p.next()}catch{f+=1;break}}}else u(y)}else u(y);c.length&&(a.errors=c,f>0&&(a.errorsTruncated=f))}return a}if(i==="object"){if(o)try{if(o.has(e))return"[Circular]";o.add(e)}catch{}if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return{__type:"ArrayBuffer",byteLength:e.byteLength};if(typeof DataView<"u"&&e instanceof DataView)return{__type:"DataView",byteOffset:e.byteOffset,byteLength:e.byteLength};if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(e)){const d=e.constructor&&e.constructor.name,m=32,g=typeof e.length=="number"?e.length:0,b=[],_=Math.min(g,m);for(let h=0;h<_;h+=1)b.push(e[h]);const w={__type:d||"TypedArray",length:g,byteOffset:typeof e.byteOffset=="number"?e.byteOffset:0,byteLength:typeof e.byteLength=="number"?e.byteLength:0};return b.length&&(w.preview=b),g>m&&(w.__truncatedItems=g-m),w}const a=typeof Map=="function"?Map:null;if(a&&e instanceof a){const d=[];let g=0;e.forEach((_,w)=>{g<30&&d.push({key:le(w,n+1,o),value:le(_,n+1,o)}),g+=1});const b={__type:"Map",size:typeof e.size=="number"?e.size:g,entries:d};return g>30&&(b.__truncatedEntries=g-30),b}const c=typeof Set=="function"?Set:null;if(c&&e instanceof c){const d=[];let g=0;e.forEach(_=>{g<30&&d.push(le(_,n+1,o)),g+=1});const b={__type:"Set",size:typeof e.size=="number"?e.size:g,values:d};return g>30&&(b.__truncatedValues=g-30),b}const l=typeof URLSearchParams=="function"?URLSearchParams:null;if(l&&e instanceof l){const d=[],m=typeof e.entries=="function"?e.entries():null;let g=0;if(m&&typeof m.next=="function"){let w=0,h=m.next();for(;!h.done;){if(w<40){const A=h.value||[];d.push({key:le(A[0],n+1,o),value:le(A[1],n+1,o)})}w+=1,h=m.next()}w>d.length&&(g=w-d.length)}const b={__type:"URLSearchParams",entries:d};return g>0&&(b.__truncatedEntries=g),b}if(typeof URL=="function"&&e instanceof URL)try{return e.toString()}catch{}if(n>=4){const d=e.constructor&&e.constructor.name;return d?`[${d}]`:Object.prototype.toString.call(e)}if(Array.isArray(e)){const m=[],g=Math.min(e.length,20);for(let b=0;b<g;b+=1)m.push(le(e[b],n+1,o));return e.length>20&&m.push(`… (${e.length-20} more)`),m}const f={},u=Object.keys(e),y=30,p=Math.min(u.length,y);for(let d=0;d<p;d+=1){const m=u[d];try{f[m]=le(e[m],n+1,o)}catch(g){f[m]=`[Threw: ${g&&g.message?g.message:"error"}]`}}if(u.length>y&&(f.__truncatedKeys=u.length-y),typeof Object.getOwnPropertySymbols=="function"){const d=Object.getOwnPropertySymbols(e),m=Math.min(d.length,5);for(let g=0;g<m;g+=1){const b=d[g],_=typeof b=="symbol"?b.toString():String(b);try{f[_]=le(e[b],n+1,o)}catch(w){f[_]=`[Threw: ${w&&w.message?w.message:"error"}]`}}}if(!u.length){const d=e.constructor&&e.constructor.name;d&&(f.__className=d)}return f}const s=Md(e);if(s.success)return s.value;try{return su(e)}catch{}try{return String(e)}catch{}return null}function Gi(e){if(typeof e!="string")return null;const t=e.replace(/\r\n?/g,`
`).trim();if(!t)return null;const r=5e3,n=t.length>r,o=n?t.slice(0,r):t,i=t.split(`
`),s=40,a=[];let c=!1;for(let l=0;l<i.length;l+=1){const f=i[l].trim();if(f)if(a.length<s)a.push(f.length>500?`${f.slice(0,500)}…`:f);else{c=!0;break}}return{stack:o,frames:a,truncated:n||c}}function ey(e){if(!e||typeof e!="object")return null;const t=typeof e.source=="string"&&e.source?e.source:"unknown";let r=null;typeof e.stack=="string"&&e.stack&&(r=Gi(e.stack));const n=[];if(Array.isArray(e.frames))for(let s=0;s<e.frames.length&&n.length<40;s+=1){const a=e.frames[s];typeof a=="string"&&a?n.push(a):a!==null&&typeof a<"u"&&n.push(Po(a))}else if(r&&Array.isArray(r.frames))for(let s=0;s<r.frames.length;s+=1)n.push(r.frames[s]);const o=e.truncated===!0||(r?r.truncated===!0:!1)||n.length>0&&n.length>=40,i={source:t,truncated:o};return r&&r.stack?i.stack=r.stack:typeof e.stack=="string"&&e.stack?i.stack=e.stack:i.stack=null,n.length&&(i.frames=n),!i.stack&&(!i.frames||!i.frames.length)?null:Ie(i)}function Ho(){const e=Fr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{const n=r.sessionStorage;if(n&&typeof n.getItem=="function"&&typeof n.setItem=="function")return n}catch{}}return null}function bu(){const e=Ho();if(e)try{e.removeItem(Ti)}catch{}}function ty(){const e=Ho();if(e){if(!L.persistSession){try{e.removeItem(Js)}catch{}return}try{e.setItem(Js,JSON.stringify({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces}))}catch(t){console.warn("cineLogging: Unable to persist logging config",t)}}}function Ba(){if(!L.persistSession){bu();return}const e=Ho();if(e)try{e.setItem(Ti,JSON.stringify(Nt))}catch(t){if(t&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")){L.persistSession=!1;try{e.removeItem(Ti)}catch{}return}console.warn("cineLogging: Unable to persist log history",t)}}function xa(){const e=L.persistSession===!1?uu:Ri;return Math.max(e,Math.min(fu,Math.floor(L.historyLimit)))}function ry(e,t,r){if(!Array.isArray(e)||e.length===0)return null;mu+=e.length;const n=Vd(e),o=r&&typeof r.source=="string"&&r.source.trim()?r.source.trim():"enforce",i=e[0]||null,s=e[e.length-1]||null,a=Date.now();let c="";try{c=new Date(a).toISOString()}catch{c=String(a)}if(ae=Ie({count:e.length,limit:t,source:o,timestamp:a,isoTimestamp:c,oldestEntryId:i&&typeof i.id=="string"?i.id:null,oldestEntryTimestamp:i&&typeof i.timestamp=="number"?i.timestamp:null,oldestEntryIsoTimestamp:i&&typeof i.isoTimestamp=="string"?i.isoTimestamp:null,newestEntryId:s&&typeof s.id=="string"?s.id:null,newestEntryTimestamp:s&&typeof s.timestamp=="number"?s.timestamp:null,newestEntryIsoTimestamp:s&&typeof s.isoTimestamp=="string"?s.isoTimestamp:null,levels:On(n)}),de&&typeof de.warn=="function")try{de.warn("cineLogging: history trimmed to enforce retention limit",{limit:t,removed:e.length,source:o,levels:lu(n)})}catch{}return n}function Fa(e){const t=xa();if(Nt.length<=t)return 0;const r=Nt.length-t,n=Nt.splice(0,r);au(us,n,-1);const o=ry(n,t,e);return o&&cu(gu,o),r}function Su(e){return Nn(e)>=Nn(L.historyLevel)}function wu(e){return L.consoleOutput?Nn(e)>=Nn(L.level):!1}function Da(e){const t=Rr(e,"info"),r=wu(t),n=Su(t);return Ie({level:t,enabled:r||n,console:r,history:n,thresholds:Ie({console:Rr(L.level,mt.level),history:Rr(L.historyLevel,mt.historyLevel)})})}function Eu(e,t){const r=Da(e);if(!t||typeof t!="object")return r.enabled;const n=t.console!==!1,o=t.history!==!1;return!n&&!o?!1:t.requireAll===!0?!(n&&!r.console||o&&!r.history):!!(n&&r.console||o&&r.history)}function Au(e){return`log-${e}-${Math.random().toString(36).slice(2,10)}`}function Ou(e){if(e){try{Nt.push(e)}catch{return}za(us,e.level,1)}}function Cu(e){Ou(e),du+=1,Fa({source:"append"}),Ba(),ny(e)}function ny(e){if(!Mi.size)return;const t=Array.from(Mi);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Xe("cineLogging listener execution failed",o)}}}function oy(e){const t=typeof e=="number"&&Number.isFinite(e)?Math.max(0,Math.floor(e)):Nt.length;if(!t)return Object.freeze([]);const r=Math.max(0,Nt.length-t),n=Nt.slice(r);return Object.freeze(n.slice())}function iy(e){if(!Ni.size)return;const t=Array.from(Ni);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Xe("cineLogging config listener failed",o)}}}function Ua(e){if(!e||typeof e.length!="number")return[];const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}function Ir(e,t){if(!Array.isArray(e))return!1;try{return typeof Object.isExtensible=="function"&&!Object.isExtensible(e)?!1:(e.push(t),!0)}catch{}return!1}function sy(e){return e==="error"?"error":e==="warn"?"warn":e==="info"?"info":"debug"}function _u(e){if(typeof e!="string"||!e)return null;if(Object.prototype.hasOwnProperty.call(de,e)){const t=de[e];if(typeof t=="function")return t}if(typeof console<"u"&&console){let t=null;try{t=console[e]}catch{t=null}if(typeof t=="function"&&(!t||!t[It]))return t}if((e==="debug"||e==="log")&&typeof de.log=="function")return de.log;if(e==="info"){if(typeof de.info=="function")return de.info;if(typeof de.log=="function")return de.log}if(e==="warn"){if(typeof de.warn=="function")return de.warn;if(typeof de.error=="function")return de.error}return e==="error"&&typeof de.error=="function"?de.error:null}function Pu(e,t){const r=_u(e);if(typeof r!="function")return;const n=typeof console<"u"&&console?console:W&&W.console?W.console:null,o=Array.isArray(t)?t:Ua(t);try{return r.apply(n,o)}catch{try{return Function.prototype.apply.call(r,n,o)}catch{}}}function ay(e,t,r){const n=sy(e),o=Array.isArray(t)?t:Ua(t),i=[];for(let d=0;d<o.length;d+=1){const m=o[d],g=typeof m;if(g==="string")Ir(i,m);else if(g==="number"||g==="boolean")Ir(i,String(m));else if(g==="symbol")try{Ir(i,m.toString())}catch{}}let s=i.join(" ").trim();s||(s=`[console.${e||n}]`);let a=null,c=null;if(o.length)try{a=le(o),c={arguments:a}}catch{c={arguments:o.slice()}}const l=[],f=Array.isArray(a)?a:null;for(let d=0;d<o.length;d+=1){const m=o[d],g=f?f[d]:null,b=m instanceof Error,_=g&&typeof g=="object"&&g!==null?typeof g.stack=="string"||typeof g.message=="string"||typeof g.name=="string":!1;if(!b&&!_)continue;let w=_?g:null;if(!w)try{w=le(m)}catch{w=null}!w&&b&&(w={name:m.name||null,message:m.message||Po(m)||null},typeof m.code<"u"&&(w.code=m.code),typeof m.status<"u"&&(w.status=m.status),typeof m.stack=="string"&&m.stack&&(w.stack=m.stack));let h=w;if(h&&typeof h=="object")try{h=su(h)}catch{try{h=Object.assign({},h)}catch{h=w}}const A={index:d};if(h&&typeof h=="object")A.value=h,typeof h.name=="string"&&h.name&&(A.name=h.name),typeof h.message=="string"&&h.message&&(A.message=h.message),typeof h.code<"u"&&(A.code=h.code),typeof h.status<"u"&&(A.status=h.status);else if(typeof h<"u"){A.value=h;const O=Po(h);O&&(A.message=O)}else A.value=null;const C=m===null?"null":typeof m;if(C==="object"||C==="function"){const O=m&&m.constructor&&m.constructor.name;A.argumentType=typeof O=="string"&&O?O:C}else A.argumentType=C;const j=b&&typeof m.stack=="string"&&m.stack?Gi(m.stack):h&&typeof h=="object"&&typeof h.stack=="string"?Gi(h.stack):null;j&&(typeof j.stack=="string"&&(A.stack=j.stack),Array.isArray(j.frames)&&j.frames.length&&(A.frames=j.frames),j.truncated&&(A.stackTruncated=!0)),Ir(l,A)}const u={channel:"console",method:e||"log"};if(r&&typeof r=="object"){const d=Object.keys(r);for(let m=0;m<d.length;m+=1){const g=d[m];try{u[g]=le(r[g])}catch{u[g]=r[g]}}}if(l.length){c=c||{};const d=[];for(let g=0;g<l.length;g+=1){const b=l[g];d.push(b.index)}c.errors=l,c.errorCount=l.length,c.errorIndices=d,c.primaryError=l[0],u.errorCount=l.length,u.errorIndices=d;const m=l[0];m&&(typeof m.name=="string"&&m.name&&(u.primaryErrorName=m.name),typeof m.message=="string"&&m.message&&(u.primaryErrorMessage=m.message),typeof m.code<"u"&&(u.primaryErrorCode=m.code),typeof m.status<"u"&&(u.primaryErrorStatus=m.status),m.stack&&(u.primaryErrorHasStack=!0))}const y=e==="error"||l.length>0,p={namespace:"console",meta:u};return y&&(p.captureStack=!0),ft(n,s,c,p,{silentConsole:!0})}function cy(){if(Et)return!0;if(Ga=!0,typeof console>"u"||!console)return Vr=!0,!1;try{if(console[It])return Et=!0,Vr=!1,!0}catch{}let e=!1;for(let t=0;t<Tn.length;t+=1){const r=Tn[t];let n=_u(r);if(typeof n!="function")try{const i=console[r];typeof i=="function"&&(!i||!i[It])&&(n=i)}catch{n=null}if((!Object.prototype.hasOwnProperty.call(de,r)||de[r]===null)&&(de[r]=typeof n=="function"?n:de[r]),typeof n!="function")continue;const o=function(){const s=Ua(arguments);Zn+=1;try{if(Zn===1){const a=s.length?s[0]:null;if(!(typeof a=="string"&&a.indexOf("cineLogging:")===0))try{ay(r,s,{captured:!0})}catch(l){}}return Pu(r,s)}finally{Zn-=1,Zn<0&&(Zn=0)}};try{Object.defineProperty(o,It,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{o[It]=!0}try{console[r]=o,e=!0}catch{}}if(e){Et=!0,Vr=!1;try{Object.defineProperty(console,It,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{try{console[It]=!0}catch{}}}else Vr=!0;return Et}function ly(){if(!Et)return!1;if(typeof console>"u"||!console)return Et=!1,!1;let e=!1;for(let t=0;t<Tn.length;t+=1){const r=Tn[t],n=de[r];try{typeof n=="function"?(console[r]=n,e=!0):r!=="log"&&r!=="info"&&delete console[r]}catch{}}try{console&&console[It]&&(typeof Object.defineProperty=="function"?Object.defineProperty(console,It,{configurable:!0,enumerable:!1,writable:!0,value:!1}):console[It]=!1)}catch{}return Et=!1,e}function Ka(){return L.captureConsole?cy()?(Zo=!1,Xn!=="enabled"&&(ft("info","Console output capture enabled",Is({status:"enabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Xn="enabled"),!0):(Zo||(ft("warn","Console output capture failed",Is({status:"failed",reason:typeof console>"u"||!console?"console-unavailable":"installation-failed"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Xe("cineLogging: Unable to capture console output for diagnostics."),Zo=!0),Xn="failed",!1):(Et&&ly(),Xn!=="disabled"&&(ft("info","Console output capture disabled",Is({status:"disabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Xn="disabled"),Zo=!1,Vr=!1,!0)}function $a(){return!!L.captureConsole&&Et===!0}function Is(e){const t={configured:L.captureConsole===!0,installed:Et===!0,attempted:Ga===!0,failed:Vr===!0};if((typeof console>"u"||!console)&&(t.consoleAvailable=!1),e&&typeof e=="object"){const r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}}return t}function uy(e){return Va({captureConsole:!0},(e&&typeof e=="object"?e:null)||void 0),$a()}function fy(e){return Va({captureConsole:!1},(e&&typeof e=="object"?e:null)||void 0),$a()}function py(e,t,r){const n=r&&Object.prototype.hasOwnProperty.call(r,"captureStack")?r.captureStack:null;return n===!0?!0:n===!1||L.stackTraces!==!0?!1:t instanceof Error?!0:Nn(e)>=Nn("warn")}function ku(e,t,r,n){if(!py(e,r,n))return null;let o="generated",i="";if(r instanceof Error){const c=r.stack;typeof c=="string"&&c&&(o="detail",i=c)}if(!i)try{const c=typeof t=="string"&&t?t:`Log ${e}`,l=new Error(c);typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(l,ku),typeof l.stack=="string"&&l.stack&&(i=l.stack)}catch{}const s=Gi(i);if(!s)return null;const a={source:o,stack:s.stack,truncated:s.truncated};return Array.isArray(s.frames)&&s.frames.length&&(a.frames=s.frames),Ie(a)}function ft(e,t,r,n,o){const i=Rr(e,"info"),s=Date.now();let a="";try{a=new Date(s).toISOString()}catch{a=String(s)}const c=n&&typeof n=="object"?n:null,l=ku(i,t,r,c),f=c&&typeof c.namespace=="string"&&c.namespace?n.namespace:null,u=c&&typeof c.meta<"u"?le(c.meta):null,y=typeof r>"u"?null:le(r),p=Ie({id:Au(s),level:i,message:Po(t),namespace:f,detail:y,meta:u,timestamp:s,isoTimestamp:a,origin:l});za(yu,i,1),Su(i)&&Cu(p);const d=o&&typeof o=="object"?o:null;if(wu(i)&&(!d||d.silentConsole!==!0)){const g=($t[i]||$t.info).consoleMethod,b=["[cine]"];f&&b.push(`[${f}]`),b.push(p.isoTimestamp);const w=[`${b.join(" ")} ${p.message}`];r!==void 0?Ir(w,r):p.detail!==null&&Ir(w,p.detail),p.meta!==null&&Ir(w,{meta:p.meta}),l&&Ir(w,{origin:l}),Pu(g,w)}return p}function vu(e,t,r){return ft("debug",e,t,r)}function dy(e,t,r){return ft("info",e,t,r)}function yy(e,t,r){return ft("warn",e,t,r)}function gy(e,t,r){return ft("error",e,t,r)}function ko(){return Ie({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces})}function my(e){const t=e&&typeof e.limit<"u"?e.limit:void 0;return oy(t)}function hy(){return ae?Ie({count:typeof ae.count=="number"?ae.count:0,limit:typeof ae.limit=="number"?ae.limit:xa(),source:typeof ae.source=="string"?ae.source:"enforce",timestamp:typeof ae.timestamp=="number"?ae.timestamp:null,isoTimestamp:typeof ae.isoTimestamp=="string"?ae.isoTimestamp:null,oldestEntryId:typeof ae.oldestEntryId=="string"?ae.oldestEntryId:null,oldestEntryTimestamp:typeof ae.oldestEntryTimestamp=="number"?ae.oldestEntryTimestamp:null,oldestEntryIsoTimestamp:typeof ae.oldestEntryIsoTimestamp=="string"?ae.oldestEntryIsoTimestamp:null,newestEntryId:typeof ae.newestEntryId=="string"?ae.newestEntryId:null,newestEntryTimestamp:typeof ae.newestEntryTimestamp=="number"?ae.newestEntryTimestamp:null,newestEntryIsoTimestamp:typeof ae.newestEntryIsoTimestamp=="string"?ae.newestEntryIsoTimestamp:null,levels:ae.levels?On(ae.levels):On(Hn())}):null}function ju(){return Ie({runtimeEntries:du,retainedEntries:Nt.length,droppedEntries:mu,historyLimit:xa(),lastDrop:hy(),levels:Ie({emitted:On(yu),retained:On(us),dropped:On(gu)}),consoleCapture:Ie({configured:L.captureConsole===!0,installed:Et,attempted:Ga,failed:Vr})})}function by(e){return Nt.length=0,Kd(us),(!e||e.persist!==!1)&&Ba(),!0}function Sy(e){return typeof e!="function"?function(){return!1}:(Mi.add(e),function(){return Mi.delete(e),!0})}function wy(e){return typeof e!="function"?function(){return!1}:(Ni.add(e),function(){return Ni.delete(e),!0})}function Ey(e,t){if(!e&&!t)return null;if(!e)return le(t);if(!t)return e;if(typeof e!="object"||typeof t!="object")return le(t);const r={},n=Object.keys(e);for(let i=0;i<n.length;i+=1){const s=n[i];r[s]=e[s]}const o=Object.keys(t);for(let i=0;i<o.length;i+=1){const s=o[i];r[s]=le(t[s])}return r}function Ay(e,t){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?le(t.meta):null;function o(i,s,a,c){const l=Ey(n,c);return ft(i,s,a,{namespace:r,meta:l})}return Ie({namespace:r,log(i,s,a,c){return o(i,s,a,c)},debug(i,s,a){return o("debug",i,s,a)},info(i,s,a){return o("info",i,s,a)},warn(i,s,a){return o("warn",i,s,a)},error(i,s,a){return o("error",i,s,a)},getConfig:ko,isLevelEnabled(i,s){return Eu(i,s)},getLevelState(i){return Da(i)}})}function Iu(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;const t=Hd;try{return typeof t=="symbol"?e[t]?!0:(e[t]=!0,!1):Object.prototype.hasOwnProperty.call(e,t)&&e[t]?!0:(Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:!0}),!1)}catch{}return!1}function Oy(e){if(!L.captureGlobalErrors||Iu(e))return;const t={message:e&&typeof e.message=="string"?e.message:"",filename:e&&(e.filename||e.fileName)||null,lineno:e&&(e.lineno||e.lineNumber)||null,colno:e&&(e.colno||e.columnNumber)||null,error:e&&e.error?le(e.error):null};e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Global error captured",t,{namespace:"global"})}function Cy(e){if(!L.captureGlobalErrors||Iu(e))return;const t={reason:e?le(e.reason):null};e&&e.promise&&(t.promiseState="[Promise]"),e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Unhandled promise rejection captured",t,{namespace:"global"})}function _y(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;if(ei instanceof WeakSet)return ei.has(e)?!0:(ei.add(e),!1);const t=ei;return t.indexOf(e)!==-1?!0:(t.push(e),!1)}function Lu(){if(!L.captureGlobalErrors)return;const e=Fr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r.addEventListener!="function")&&!_y(r)){try{r.addEventListener("error",Oy,!0)}catch{}try{r.addEventListener("unhandledrejection",Cy,!0)}catch{}}}}function fs(e){if(!e||typeof e!="object")return{changed:!1,captureChanged:!1,limitChanged:!1};let t=!1,r=!1,n=!1,o=!1;const i=Object.prototype.hasOwnProperty.call(e,"persistSession")?eo(e.persistSession,L.persistSession):L.persistSession;if(Object.prototype.hasOwnProperty.call(e,"level")){const s=Rr(e.level,L.level);s!==L.level&&(L.level=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLevel")){const s=Rr(e.historyLevel,L.historyLevel);s!==L.historyLevel&&(L.historyLevel=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLimit")){const s=hu(e.historyLimit,{allowReducedMin:i===!1});s!==L.historyLimit&&(L.historyLimit=s,t=!0,n=!0)}if(Object.prototype.hasOwnProperty.call(e,"consoleOutput")){const s=eo(e.consoleOutput,L.consoleOutput);s!==L.consoleOutput&&(L.consoleOutput=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"persistSession")&&i!==L.persistSession&&(L.persistSession=i,t=!0),L.persistSession&&L.historyLimit<Ri&&(L.historyLimit=Ri,t=!0,n=!0),Object.prototype.hasOwnProperty.call(e,"captureGlobalErrors")){const s=eo(e.captureGlobalErrors,L.captureGlobalErrors);s!==L.captureGlobalErrors&&(L.captureGlobalErrors=s,t=!0,r=!0)}if(Object.prototype.hasOwnProperty.call(e,"captureConsole")){const s=eo(e.captureConsole,L.captureConsole);s!==L.captureConsole&&(L.captureConsole=s,t=!0,o=!0)}if(Object.prototype.hasOwnProperty.call(e,"stackTraces")){const s=eo(e.stackTraces,L.stackTraces);s!==L.stackTraces&&(L.stackTraces=s,t=!0)}return{changed:t,captureChanged:r,limitChanged:n,consoleCaptureChanged:o}}function Va(e,t){const r=L.captureGlobalErrors,n=L.captureConsole,o=fs(e);return o.limitChanged&&Fa({source:"config"}),o.changed&&(!t||t.persist!==!1)&&(ty(),Ba()),L.persistSession||bu(),!r&&L.captureGlobalErrors&&Lu(),(o.consoleCaptureChanged||n!==L.captureConsole)&&Ka(),o.changed&&iy(ko()),ko()}function Py(){const e=Fr(W),t=["__cineLoggingConfig","__CINE_LOGGING_CONFIG","cineLoggingConfig"];for(let r=0;r<e.length;r+=1){const n=e[r];if(!(!n||typeof n!="object"&&typeof n!="function"))for(let o=0;o<t.length;o+=1){const i=t[o];let s;try{s=n[i]}catch{s=null}if(s&&typeof s=="object")return s}}return null}function ky(){const e=Ho();if(!e)return;let t="";try{t=e.getItem(Js)||""}catch{return}if(t)try{const r=JSON.parse(t);fs(r)}catch(r){Xe("cineLogging: Unable to restore logging config from storage",r)}}function vy(){if(!W||!W.location)return;let e="";try{e=W.location.search||""}catch{return}if(typeof e!="string"||!e)return;let t=null;if(typeof URLSearchParams=="function")try{t=new URLSearchParams(e)}catch{}const r={};let n=!1;function o(i,s){r[i]=s,n=!0}if(t)t.has("cineLogLevel")&&o("level",t.get("cineLogLevel")),t.has("cineLogHistoryLevel")&&o("historyLevel",t.get("cineLogHistoryLevel")),t.has("cineLogLimit")&&o("historyLimit",t.get("cineLogLimit")),t.has("cineLogConsole")&&o("consoleOutput",t.get("cineLogConsole")),t.has("cineLogPersist")&&o("persistSession",t.get("cineLogPersist")),t.has("cineLogCapture")&&o("captureGlobalErrors",t.get("cineLogCapture")),t.has("cineLogConsoleCapture")&&o("captureConsole",t.get("cineLogConsoleCapture")),t.has("cineLogStackTraces")&&o("stackTraces",t.get("cineLogStackTraces"));else{const s=(e.charAt(0)==="?"?e.slice(1):e).split("&");for(let a=0;a<s.length;a+=1){const c=s[a];if(!c)continue;const l=c.indexOf("="),f=decodeURIComponent(l===-1?c:c.slice(0,l)),u=l===-1?"":decodeURIComponent(c.slice(l+1));f==="cineLogLevel"?o("level",u):f==="cineLogHistoryLevel"?o("historyLevel",u):f==="cineLogLimit"?o("historyLimit",u):f==="cineLogConsole"?o("consoleOutput",u):f==="cineLogPersist"?o("persistSession",u):f==="cineLogCapture"?o("captureGlobalErrors",u):f==="cineLogConsoleCapture"?o("captureConsole",u):f==="cineLogStackTraces"&&o("stackTraces",u)}}n&&fs(r)}function Ru(e){if(!e||typeof e!="object")return null;const t=Rr(e.level,"info"),r=typeof e.timestamp=="number"&&Number.isFinite(e.timestamp)?e.timestamp:Date.now();let n="";if(typeof e.isoTimestamp=="string"&&e.isoTimestamp)n=e.isoTimestamp;else try{n=new Date(r).toISOString()}catch{n=String(r)}const o=typeof e.message=="string"?e.message:Po(e.message),i=typeof e.namespace=="string"&&e.namespace?e.namespace:null,s=typeof e.id=="string"&&e.id?e.id:Au(r);return Ie({id:s,level:t,message:o,namespace:i,detail:typeof e.detail>"u"?null:le(e.detail),meta:typeof e.meta>"u"?null:le(e.meta),timestamp:r,isoTimestamp:n,origin:typeof e.origin>"u"?null:ey(e.origin)})}function jy(){return W&&typeof W.navigator=="object"&&W.navigator?W.navigator:typeof navigator<"u"&&navigator?navigator:typeof globalThis<"u"&&globalThis&&typeof globalThis.navigator=="object"?globalThis.navigator:null}function Tu(){const e=jy();return!e||typeof e!="object"||!e.serviceWorker?null:e.serviceWorker}function Iy(e){return e?U.seenIds?U.seenIds.has(e)?!1:(U.seenIds.add(e),!0):Array.isArray(U.fallbackSeenIds)?U.fallbackSeenIds.indexOf(e)!==-1?!1:(U.fallbackSeenIds.push(e),!0):!0:!0}function Ly(e,t){const r={};if(e&&typeof e.meta<"u")if(e.meta&&typeof e.meta=="object")for(const o in e.meta)Object.prototype.hasOwnProperty.call(e.meta,o)&&(r[o]=e.meta[o]);else r.value=e.meta;const n=e&&typeof e.channel=="string"&&e.channel?e.channel:r.channel;return n?r.channel=n:r.channel="service-worker",t&&typeof t=="object"&&(t.cacheName&&!r.cacheName&&(r.cacheName=t.cacheName),t.cacheVersion&&!r.cacheVersion&&(r.cacheVersion=t.cacheVersion),typeof t.generatedAt=="number"&&Number.isFinite(t.generatedAt)&&(r.snapshotTimestamp||(r.snapshotTimestamp=t.generatedAt)),typeof t.historyLength=="number"&&Number.isFinite(t.historyLength)&&(r.snapshotSize||(r.snapshotSize=t.historyLength))),r}function Dc(e,t){if(!(!Array.isArray(e)||!e.length))for(let r=0;r<e.length;r+=1){const n=e[r];if(!n||typeof n!="object")continue;const o=typeof n.id=="string"&&n.id?n.id:null;if(!Iy(o))continue;const i=n.origin&&typeof n.origin=="object"?n.origin:{runtime:"service-worker"},s=Ru({id:o||void 0,level:n.level,message:n.message,namespace:typeof n.namespace=="string"&&n.namespace?n.namespace:"service-worker",detail:typeof n.detail>"u"?null:n.detail,meta:Ly(n,t),timestamp:n.timestamp,isoTimestamp:n.isoTimestamp,origin:i});s&&Cu(s)}}function gi(e){if(U.requestInFlight&&!(e&&U.lastRequestId&&e!==U.lastRequestId)){if(U.requestInFlight=!1,U.lastRequestId=null,U.requestTimer&&typeof clearTimeout=="function")try{clearTimeout(U.requestTimer)}catch{}U.requestTimer=null}}function Wr(){if(!(U.broadcastChannel||U.broadcastFailed)&&!(U.pollTimer||typeof setTimeout!="function"))try{U.pollTimer=setTimeout(()=>{U.pollTimer=null,Mu("poll")},Xd)}catch{}}function Ry(){if(U.broadcastFailed)return null;if(U.broadcastChannel)return U.broadcastChannel;if(typeof BroadcastChannel!="function")return U.broadcastFailed=!0,null;try{const e=new BroadcastChannel(Wd);if(e.addEventListener("message",zi),U.broadcastChannel=e,U.pollTimer&&typeof clearTimeout=="function"){try{clearTimeout(U.pollTimer)}catch(t){}U.pollTimer=null}return e}catch(e){return U.broadcastFailed=!0,Xe("cineLogging: Unable to open service worker diagnostics channel",e),null}}function zi(e){if(!e)return;let t=null;try{t=e.data||null}catch{t=null}if(!(!t||typeof t!="object")){if(t.type===Yd){Dc([t.entry],U.lastSnapshotMeta),Wr();return}if(t.type===Qd){gi(t.requestId||null);const r=t.state&&typeof t.state=="object"?t.state:null;if(!r){Wr();return}U.lastSnapshotMeta={cacheName:typeof r.cacheName=="string"&&r.cacheName?r.cacheName:null,cacheVersion:r.cacheVersion||null,generatedAt:typeof r.generatedAt=="number"&&Number.isFinite(r.generatedAt)?r.generatedAt:Date.now(),historyLength:typeof r.historyLength=="number"&&Number.isFinite(r.historyLength)?r.historyLength:null},Dc(r.history,U.lastSnapshotMeta),Wr()}}}function Mu(e){if(U.requestInFlight)return;const t=Tu();if(!t)return;U.supported=!0;const r=`sw-log-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;U.requestInFlight=!0,U.lastRequestId=r;const n={type:Jd,limit:Zd,reason:typeof e=="string"&&e?e:"sync",requestId:r},o=s=>{if(s){try{s.port1.onmessage=null}catch{}if(typeof s.port1.onmessageerror<"u")try{s.port1.onmessageerror=null}catch{}try{s.port1.close()}catch{}try{s.port2.close()}catch{}}},i=t.ready&&typeof t.ready.then=="function"?t.ready.then(s=>s&&s.active||t.controller||null):Promise.resolve(t.controller||null);Promise.resolve(i).then(s=>{const a=t.controller||null,c=s||a;if(!c||typeof c.postMessage!="function"){gi(r),Wr();return}let l=!1,f=null;const u=()=>{l||(l=!0,o(f),gi(r))},y=()=>{u(),Wr()},p=b=>{u(),zi(b)},d=()=>{Xe("cineLogging: Service worker diagnostics channel closed before a response was received",{requestId:r}),y()},m=()=>{try{c.postMessage(n)}catch(b){Xe("cineLogging: Unable to post service worker diagnostics request",b),y();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{l||y()},Fc)}catch{}};if(!(typeof MessageChannel!="function"||!a?!1:c===a)){m();return}if(f=new MessageChannel,f.port1.onmessage=p,typeof f.port1.onmessageerror<"u"&&(f.port1.onmessageerror=d),typeof f.port1.start=="function")try{f.port1.start()}catch{}try{c.postMessage(n,[f.port2])}catch(b){o(f),f=null,Xe("cineLogging: Unable to request service worker diagnostics",b),m();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{l||d()},Fc)}catch{}}).catch(s=>{gi(r),Xe("cineLogging: Unable to await service worker for diagnostics",s),Wr()})}function Ty(){if(U.initialised)return;U.initialised=!0;const e=Tu();if(e){if(U.supported=!0,Ry(),typeof e.addEventListener=="function")try{e.addEventListener("message",zi)}catch(t){Xe("cineLogging: Unable to attach service worker diagnostics listener",t)}else if(typeof e.onmessage>"u")try{e.onmessage=zi}catch{}Mu("initial-sync"),U.broadcastChannel||Wr()}}function My(){if(!L.persistSession)return;const e=Ho();if(!e)return;let t="";try{t=e.getItem(Ti)||""}catch{return}if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;for(let n=0;n<r.length;n+=1){const o=Ru(r[n]);o&&Ou(o)}Fa({source:"restore"})}catch(r){Xe("cineLogging: Unable to restore log history from storage",r)}}function Ny(){L=pu();const e=Py();e&&fs(e),ky(),vy()}Ny();My();Ty();Ka();L.captureGlobalErrors&&Lu();vu("cineLogging initialized",{config:ko(),stats:ju()},{namespace:"logging",meta:{lifecycle:"init"}});const ps=Ie({log:ft,debug:vu,info:dy,warn:yy,error:gy,createLogger:Ay,getHistory:my,getStats:ju,clearHistory:by,getConfig:ko,setConfig:Va,getLevelState:Da,isLevelEnabled:Eu,subscribe:Sy,subscribeConfig:wy,enableConsoleCapture:uy,disableConsoleCapture:fy,syncConsoleCapture:Ka,isConsoleCaptureActive:$a,constants:Ie({LOG_LEVELS:Ud,DEFAULT_CONFIG:qd})});Dd("cineLogging",ps);const Nu={category:"diagnostics",description:"Structured logging utilities for debugging and diagnostics.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},Gy=zd("cineLogging",ps,Nu,function(e){Xe("Unable to register cineLogging module.",e)},W,yi);Gy||Gd("cineLogging",ps,Nu,W);Fd("cineLogging",ps,{configurable:!0,enumerable:!1,writable:!1})||Xe("Unable to expose cineLogging globally.");const Ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;function Gu(){return(Ls&&typeof Ls=="object"?Ls:null)||(typeof globalThis<"u"?globalThis:null)}function Bi(e){const t=Gu();if(!t)return null;let r,n=null;try{r=t.console,n=Object.getOwnPropertyDescriptor(t,"console")}catch{r=typeof console<"u"?console:null}if(!r||typeof r!="object")return null;let o=[];Array.isArray(e)?o=e:typeof e=="string"&&e?o=[e]:o=["warn","info"];const i=Object.create(null);for(let l=0;l<o.length;l+=1){const f=o[l];typeof f=="string"&&f&&(i[f]=!0)}const s=Object.keys(i);if(!s.length)return r;const a=Object.create(null);for(let l=0;l<s.length;l+=1){const f=s[l];let u=r[f];try{const y=Object.getOwnPropertyDescriptor(r,f);y&&Object.prototype.hasOwnProperty.call(y,"value")&&(u=y.value)}catch{}if(typeof u=="function")try{a[f]=u.bind(r)}catch{a[f]=u}else a[f]=u}const c=new Proxy(r,{get(l,f,u){return Object.prototype.hasOwnProperty.call(a,f)?a[f]:Reflect.get(l,f,u)},set(l,f,u,y){if(Object.prototype.hasOwnProperty.call(a,f))return a[f]=u,!0;try{return Reflect.set(l,f,u,y),!0}catch{}return!1},defineProperty(l,f,u){return Object.prototype.hasOwnProperty.call(a,f)?(u&&Object.prototype.hasOwnProperty.call(u,"value")&&(a[f]=u.value),!0):Reflect.defineProperty(l,f,u)},getOwnPropertyDescriptor(l,f){return Object.prototype.hasOwnProperty.call(a,f)?{configurable:!0,enumerable:!0,writable:!0,value:a[f]}:Reflect.getOwnPropertyDescriptor(l,f)},ownKeys(l){const f=Reflect.ownKeys(l);for(let u=0;u<s.length;u+=1)f.indexOf(s[u])===-1&&f.push(s[u]);return f}});try{Object.defineProperty(t,"console",{configurable:!0,enumerable:n?n.enumerable!==!1:!0,writable:!0,value:c})}catch{t.console=c}return c}const ti=Gu();if(ti&&typeof ti=="object")try{typeof ti.__cineEnsureConsoleMethodsWritable!="function"&&(ti.__cineEnsureConsoleMethodsWritable=Bi)}catch{}const zy=Object.freeze(Object.defineProperty({__proto__:null,ensureConsoleMethodsWritable:Bi},Symbol.toStringTag,{value:"Module"}));function By(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const cr=By();function xy(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const we=xy(cr),Fy=we&&typeof we.freezeDeep=="function"?we.freezeDeep:function(t){return t},zu=e=>{try{return Fy(e)}catch{return e}};function Uc(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return e&&r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}const Dy=we&&typeof we.collectCandidateScopes=="function"?function(t){try{const r=we.collectCandidateScopes(t,cr);if(Array.isArray(r)&&r.length)return r}catch{}return Uc(t||cr)}:Uc;function Uy(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Qs=we&&typeof we.safeWarn=="function"?we.safeWarn:Uy;function Ky(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=null;try{t=e.cineLogging||null}catch{t=null}return t&&typeof t=="object"?t:null}function Bu(e={}){const t=e.baseScope||cr;e.allowRequire;const r=Dy(t);for(let n=0;n<r.length;n+=1){const o=Ky(r[n]);if(o)return o}return null}function Pr(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const o=[];t.set(e,o);for(let i=0;i<e.length;i+=1)o[i]=Pr(e[i],t);return o}const r={};t.set(e,r);const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=Pr(e[i],t)}return r}function $y(e,t){if(!e&&!t)return null;if(!e)return Pr(t);if(!t)return Pr(e);if(typeof e!="object"||typeof t!="object")return Pr(t);const r=Pr(e),n=Object.keys(t);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=Pr(t[i])}return r}function Vy(e){if(typeof console>"u"||!console)return null;const t=typeof e=="string"?e.toLowerCase():"";return t==="error"&&typeof console.error=="function"?console.error.bind(console):t==="warn"&&typeof console.warn=="function"?console.warn.bind(console):t==="info"&&typeof console.info=="function"?console.info.bind(console):t==="debug"&&typeof console.debug=="function"?console.debug.bind(console):typeof console.log=="function"?console.log.bind(console):null}let Kc=!1;function xu(e,t={}){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?Pr(t.meta):null;function o(s,a,c,l){const f=Vy(s);if(!f)return null;const u=["[cine-fallback]"];r&&u.push(`[${r}]`);const y=new Date;try{u.push(y.toISOString())}catch{u.push(String(y.getTime()))}const m=[`${u.join(" ")} ${typeof a=="string"&&a?a:"Log entry"}`];typeof c<"u"&&m.push(c);const g=$y(n,l);g&&m.push({meta:g,source:"console-fallback"});try{f(...m)}catch{}if(!Kc&&typeof console<"u"&&typeof console.warn=="function"){Kc=!0;try{console.warn("[cine-fallback] Structured logging unavailable, using console logger.")}catch{}}return null}return zu({namespace:r,log(s,a,c,l){return o(s,a,c,l)},debug(s,a,c){return o("debug",s,a,c)},info(s,a,c){return o("info",s,a,c)},warn(s,a,c){return o("warn",s,a,c)},error(s,a,c){return o("error",s,a,c)},getConfig(){return null},isLevelEnabled(){return!0},getLevelState(s){return{level:typeof s=="string"&&s?s:"all",enabled:!0,source:"console-fallback"}},__cineLoggingFallback:!0})}function Hy(e,t={}){const r=Bu(t),n=t&&typeof t.meta<"u"?t.meta:void 0;if(r&&typeof r.createLogger=="function")try{const o=r.createLogger(e,typeof n<"u"?{meta:n}:void 0);if(o)return o}catch(o){Qs("cineLoggingResolver: createLogger failed, falling back to console.",o)}return t.allowConsoleFallback===!1?null:xu(e,{meta:n})}const Yr=zu({resolveLogging:Bu,resolveLogger:Hy,createConsoleFallbackLogger:xu}),qy=we&&typeof we.resolveModuleRegistry=="function"?we.resolveModuleRegistry(cr):null;if(we&&typeof we.registerOrQueueModule=="function"&&!we.registerOrQueueModule("cineLoggingResolver",Yr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0,connections:["cineLogging","cineModuleBase","cineEnvironmentBridge"]},t=>{Qs("Unable to register cineLoggingResolver module.",t)},cr,qy)&&typeof we.queueModuleRegistration=="function")try{we.queueModuleRegistration("cineLoggingResolver",Yr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0},cr)}catch(t){Qs("Unable to queue cineLoggingResolver registration.",t)}if(we&&typeof we.exposeGlobal=="function")we.exposeGlobal("cineLoggingResolver",Yr,cr,{configurable:!0,enumerable:!1,writable:!1});else try{cr.cineLoggingResolver=Yr}catch{}function Wy(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Tr=Wy(),wt=typeof cineModuleBase=="object"&&cineModuleBase||(Tr&&typeof Tr.cineModuleBase=="object"?Tr.cineModuleBase:null),lr=wt&&typeof wt.safeWarn=="function"?wt.safeWarn:function(t,r){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof r>"u"?console.warn(t):console.warn(t,r)}catch{}},Ha="cameraPowerPlanner_contacts";function Fu(e){const t=e||Tr;try{if(t&&typeof t.localStorage<"u")return t.localStorage}catch(r){lr("cine.features.contacts could not access localStorage.",r)}return null}function qa(){return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function jt(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return jt(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function xi(e){if(!e||typeof e!="object")return null;const t=jt(e.id)||qa(),r=jt(e.name),n=jt(e.role),o=jt(e.phone),i=jt(e.email),s=jt(e.website||e.url),a=jt(e.notes||e.note||e.text),c=typeof e.avatar=="string"&&e.avatar.startsWith("data:")?e.avatar:"",l=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),f=Number.isFinite(e.updatedAt)?e.updatedAt:l,u={id:t,name:r,role:n,phone:o,email:i,website:s,notes:a,createdAt:l,updatedAt:f};return c&&(u.avatar=c),u}function Wa(e){return(Array.isArray(e)?e.filter(Boolean):[]).map(xi).filter(Boolean).sort((t,r)=>{const n=(t&&t.name?t.name:"").toLowerCase(),o=(r&&r.name?r.name:"").toLowerCase();if(n&&o&&n!==o)try{return n.localeCompare(o)}catch(i){lr("cine.features.contacts could not sort contacts by locale.",i)}return n&&!o?-1:!n&&o?1:(t&&t.createdAt?t.createdAt:0)-(r&&r.createdAt?r.createdAt:0)})}function Yy(e={}){const t=Fu(e.scope);if(!t||typeof t.getItem!="function")return[];const r=typeof e.storageKey=="string"&&e.storageKey?e.storageKey:Ha;try{const n=t.getItem(r);if(!n)return[];const o=JSON.parse(n);return Array.isArray(o)?Wa(o):[]}catch(n){return lr("cine.features.contacts could not load contacts from storage.",n),[]}}function Jy(e,t={}){const r=Fu(t.scope);if(!r||typeof r.setItem!="function")return!1;const n=typeof t.storageKey=="string"&&t.storageKey?t.storageKey:Ha;try{return r.setItem(n,JSON.stringify(Array.isArray(e)?e:[])),!0}catch(o){return lr("cine.features.contacts could not save contacts to storage.",o),!1}}function Du(e){if(!e||typeof e!="object")return"";const t=["BEGIN:VCARD","VERSION:3.0"];if(e.name){t.push(`FN:${e.name}`);const r=e.name.trim().split(/\s+/);r.length>=2?t.push(`N:${r.slice(1).join(" ")};${r[0]};;;`):t.push(`N:;${e.name};;;`)}if(e.role&&t.push(`TITLE:${e.role}`),e.phone&&t.push(`TEL:${e.phone}`),e.email&&t.push(`EMAIL:${e.email}`),e.website&&t.push(`URL:${e.website}`),e.notes&&t.push(`NOTE:${e.notes.replace(/\r?\n/g,"\\n")}`),e.avatar&&e.avatar.startsWith("data:"))try{const[r,n]=e.avatar.split(","),o=r.match(/data:([^;]+)/),s=(o?o[1]:"image/jpeg").split("/")[1].toUpperCase();t.push(`PHOTO;ENCODING=b;TYPE=${s}:${n}`)}catch(r){lr("Failed to encode avatar for vCard",r)}return t.push("END:VCARD"),t.join(`\r
`)}function Qy(e){return!Array.isArray(e)||e.length===0?"":e.map(Du).join(`\r
\r
`)}const Xy=Object.freeze(["id","name","role","phone","email","website","avatar","createdAt","updatedAt"]);function Zy(e,t={}){const r=typeof t.sanitize=="function"?t.sanitize:jt;if(typeof e!="string")return[];const n=e.replace(/\r\n?/g,`
`),o=[];n.split(`
`).forEach(a=>{/^[ \t]/.test(a)&&o.length?o[o.length-1]+=a.replace(/^[ \t]/,""):o.push(a)});const i=[];let s=null;return o.forEach(a=>{if(/^BEGIN:VCARD/i.test(a)){s={name:"",role:"",phone:"",email:"",website:"",avatar:""};return}if(/^END:VCARD/i.test(a)){s&&(s.name||s.email||s.phone||s.website)&&i.push({...s}),s=null;return}if(!s)return;const[c,...l]=a.split(":");if(!l.length)return;const f=c.split(";"),u=f[0]?.toUpperCase(),y=l.join(":").trim();if(u){if(u==="FN"){s.name=r(y);return}if(u==="N"&&!s.name){s.name=y.split(";").filter(Boolean).join(" ").trim();return}if(u==="TEL"){s.phone||(s.phone=r(y));return}if(u==="EMAIL"){s.email||(s.email=r(y));return}if(u==="URL"||/\.URL$/.test(u)){s.website||(s.website=r(y));return}if((u==="ROLE"||u==="TITLE")&&!s.role){s.role=r(y);return}if(u==="ORG"&&!s.role){s.role=r(y);return}if(u==="PHOTO"){let p=y;if(!p)return;if(/^data:/i.test(p)){s.avatar=p;return}const d=f.slice(1);let m="image/jpeg";d.forEach(g=>{const[b,_]=g.split("=");if(!_)return;const w=b.trim().toUpperCase(),h=_.trim();if(w==="MEDIATYPE")m=h;else if(w==="TYPE"){const A=h.toLowerCase();A.includes("/")?m=A:m=`image/${A}`}}),s.avatar=`data:${m};base64,${p}`}}}),i.map(a=>({name:r(a.name),role:r(a.role),phone:r(a.phone),email:r(a.email),website:r(a.website),avatar:typeof a.avatar=="string"&&a.avatar.startsWith("data:")?a.avatar:""})).filter(a=>a.name||a.email||a.phone||a.website)}function eg(e={}){const{existing:t=[],imported:r=[],now:n=()=>Date.now(),generateContactIdFn:o=qa}=e,i=t.map(c=>xi(c));let s=0,a=0;return r.forEach(c=>{const l=xi({...c,id:c.id||o(),createdAt:n(),updatedAt:n()}),f=i.find(u=>{if(l.email&&u.email&&l.email.toLowerCase()===u.email.toLowerCase())return!0;if(l.phone&&u.phone){const y=l.phone.replace(/\D+/g,""),p=u.phone.replace(/\D+/g,"");if(y&&p&&y===p)return!0}return!!(l.name&&u.name&&l.name.toLowerCase()===u.name.toLowerCase()||l.website&&u.website&&l.website.toLowerCase()===u.website.toLowerCase())});f?(Xy.forEach(u=>{l[u]&&(f[u]=l[u])}),f.updatedAt=n(),a+=1):(i.push(l),s+=1)}),{contacts:Wa(i),added:s,updated:a}}const Gn=Object.freeze({CONTACTS_STORAGE_KEY:Ha,generateContactId:qa,sanitizeContactValue:jt,normalizeContactEntry:xi,sortContacts:Wa,loadStoredContacts:Yy,saveContactsToStorage:Jy,generateVCard:Du,generateAllContactsVCard:Qy,parseVCard:Zy,mergeImportedContacts:eg});if(wt&&typeof wt.registerOrQueueModule=="function")try{wt.registerOrQueueModule("cine.features.contacts",Gn,{category:"features",description:"Shared helpers for contacts management.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cinePersistence"]},e=>lr("Unable to register cine.features.contacts module.",e),Tr,wt.getModuleRegistry&&wt.getModuleRegistry(Tr))}catch(e){lr("cine.features.contacts registration failed.",e)}let Uu=!1;if(wt&&typeof wt.exposeGlobal=="function")try{wt.exposeGlobal("cineFeaturesContacts",Gn,Tr,{configurable:!0,enumerable:!1,writable:!1}),Uu=!0}catch(e){lr("cine.features.contacts could not expose global api.",e)}if(!Uu)try{Tr.cineFeaturesContacts=Gn}catch(e){lr("cine.features.contacts could not assign global api.",e)}const Wb=Object.freeze(Object.defineProperty({__proto__:null,default:Gn},Symbol.toStringTag,{value:"Module"}));function an(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function tg(e,t){let r;const n=()=>{if(r)return r;const o=indexedDB.open(e);return o.onupgradeneeded=()=>o.result.createObjectStore(t),r=an(o),r.then(i=>{i.onclose=()=>r=void 0},()=>{}),r};return(o,i)=>n().then(s=>i(s.transaction(t,o).objectStore(t)))}let Rs;function qo(){return Rs||(Rs=tg("keyval-store","keyval")),Rs}function rg(e,t=qo()){return t("readonly",r=>an(r.get(e)))}function ng(e,t,r=qo()){return r("readwrite",n=>(n.put(t,e),an(n.transaction)))}function og(e,t=qo()){return t("readwrite",r=>(r.delete(e),an(r.transaction)))}function ig(e=qo()){return e("readwrite",t=>(t.clear(),an(t.transaction)))}function sg(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},an(e.transaction)}function ag(e=qo()){return e("readonly",t=>{if(t.getAllKeys)return an(t.getAllKeys());const r=[];return sg(t,n=>r.push(n.key)).then(()=>r)})}var Cn=(function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function o(s,a){if(!n[s]){n[s]={};for(var c=0;c<s.length;c++)n[s][s.charAt(c)]=c}return n[s][a]}var i={compressToBase64:function(s){if(s==null)return"";var a=i._compress(s,6,function(c){return t.charAt(c)});switch(a.length%4){default:case 0:return a;case 1:return a+"===";case 2:return a+"==";case 3:return a+"="}},decompressFromBase64:function(s){return s==null?"":s==""?null:i._decompress(s.length,32,function(a){return o(t,s.charAt(a))})},compressToUTF16:function(s){return s==null?"":i._compress(s,15,function(a){return e(a+32)})+" "},decompressFromUTF16:function(s){return s==null?"":s==""?null:i._decompress(s.length,16384,function(a){return s.charCodeAt(a)-32})},compressToUint8Array:function(s){for(var a=i.compress(s),c=new Uint8Array(a.length*2),l=0,f=a.length;l<f;l++){var u=a.charCodeAt(l);c[l*2]=u>>>8,c[l*2+1]=u%256}return c},decompressFromUint8Array:function(s){if(s==null)return i.decompress(s);for(var a=new Array(s.length/2),c=0,l=a.length;c<l;c++)a[c]=s[c*2]*256+s[c*2+1];var f=[];return a.forEach(function(u){f.push(e(u))}),i.decompress(f.join(""))},compressToEncodedURIComponent:function(s){return s==null?"":i._compress(s,6,function(a){return r.charAt(a)})},decompressFromEncodedURIComponent:function(s){return s==null?"":s==""?null:(s=s.replace(/ /g,"+"),i._decompress(s.length,32,function(a){return o(r,s.charAt(a))}))},compress:function(s){return i._compress(s,16,function(a){return e(a)})},_compress:function(s,a,c){if(s==null)return"";var l,f,u={},y={},p="",d="",m="",g=2,b=3,_=2,w=[],h=0,A=0,C;for(C=0;C<s.length;C+=1)if(p=s.charAt(C),Object.prototype.hasOwnProperty.call(u,p)||(u[p]=b++,y[p]=!0),d=m+p,Object.prototype.hasOwnProperty.call(u,d))m=d;else{if(Object.prototype.hasOwnProperty.call(y,m)){if(m.charCodeAt(0)<256){for(l=0;l<_;l++)h=h<<1,A==a-1?(A=0,w.push(c(h)),h=0):A++;for(f=m.charCodeAt(0),l=0;l<8;l++)h=h<<1|f&1,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=f>>1}else{for(f=1,l=0;l<_;l++)h=h<<1|f,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=0;for(f=m.charCodeAt(0),l=0;l<16;l++)h=h<<1|f&1,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=f>>1}g--,g==0&&(g=Math.pow(2,_),_++),delete y[m]}else for(f=u[m],l=0;l<_;l++)h=h<<1|f&1,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=f>>1;g--,g==0&&(g=Math.pow(2,_),_++),u[d]=b++,m=String(p)}if(m!==""){if(Object.prototype.hasOwnProperty.call(y,m)){if(m.charCodeAt(0)<256){for(l=0;l<_;l++)h=h<<1,A==a-1?(A=0,w.push(c(h)),h=0):A++;for(f=m.charCodeAt(0),l=0;l<8;l++)h=h<<1|f&1,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=f>>1}else{for(f=1,l=0;l<_;l++)h=h<<1|f,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=0;for(f=m.charCodeAt(0),l=0;l<16;l++)h=h<<1|f&1,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=f>>1}g--,g==0&&(g=Math.pow(2,_),_++),delete y[m]}else for(f=u[m],l=0;l<_;l++)h=h<<1|f&1,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=f>>1;g--,g==0&&(g=Math.pow(2,_),_++)}for(f=2,l=0;l<_;l++)h=h<<1|f&1,A==a-1?(A=0,w.push(c(h)),h=0):A++,f=f>>1;for(;;)if(h=h<<1,A==a-1){w.push(c(h));break}else A++;return w.join("")},decompress:function(s){return s==null?"":s==""?null:i._decompress(s.length,32768,function(a){return s.charCodeAt(a)})},_decompress:function(s,a,c){var l=[],f=4,u=4,y=3,p="",d=[],m,g,b,_,w,h,A,C={val:c(0),position:a,index:1};for(m=0;m<3;m+=1)l[m]=m;for(b=0,w=Math.pow(2,2),h=1;h!=w;)_=C.val&C.position,C.position>>=1,C.position==0&&(C.position=a,C.val=c(C.index++)),b|=(_>0?1:0)*h,h<<=1;switch(b){case 0:for(b=0,w=Math.pow(2,8),h=1;h!=w;)_=C.val&C.position,C.position>>=1,C.position==0&&(C.position=a,C.val=c(C.index++)),b|=(_>0?1:0)*h,h<<=1;A=e(b);break;case 1:for(b=0,w=Math.pow(2,16),h=1;h!=w;)_=C.val&C.position,C.position>>=1,C.position==0&&(C.position=a,C.val=c(C.index++)),b|=(_>0?1:0)*h,h<<=1;A=e(b);break;case 2:return""}for(l[3]=A,g=A,d.push(A);;){if(C.index>s)return"";for(b=0,w=Math.pow(2,y),h=1;h!=w;)_=C.val&C.position,C.position>>=1,C.position==0&&(C.position=a,C.val=c(C.index++)),b|=(_>0?1:0)*h,h<<=1;switch(A=b){case 0:for(b=0,w=Math.pow(2,8),h=1;h!=w;)_=C.val&C.position,C.position>>=1,C.position==0&&(C.position=a,C.val=c(C.index++)),b|=(_>0?1:0)*h,h<<=1;l[u++]=e(b),A=u-1,f--;break;case 1:for(b=0,w=Math.pow(2,16),h=1;h!=w;)_=C.val&C.position,C.position>>=1,C.position==0&&(C.position=a,C.val=c(C.index++)),b|=(_>0?1:0)*h,h<<=1;l[u++]=e(b),A=u-1,f--;break;case 2:return d.join("")}if(f==0&&(f=Math.pow(2,y),y++),l[A])p=l[A];else if(A===u)p=g+g.charAt(0);else return null;d.push(p),l[u++]=g+p.charAt(0),f--,g=p,f==0&&(f=Math.pow(2,y),y++)}}};return i})();typeof define=="function"&&define.amd?define(function(){return Cn}):typeof module<"u"&&module!=null?module.exports=Cn:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return Cn});class Ku{async init(){throw new Error('Method "init()" must be implemented.')}async getItem(t){throw new Error('Method "getItem()" must be implemented.')}async setItem(t,r){throw new Error('Method "setItem()" must be implemented.')}async removeItem(t){throw new Error('Method "removeItem()" must be implemented.')}async clear(){throw new Error('Method "clear()" must be implemented.')}async getKeys(){throw new Error('Method "getKeys()" must be implemented.')}}class Fi extends Ku{constructor(){super(),this.name="IndexedDBAdapter"}async init(){try{if(typeof indexedDB>"u")throw new Error("IndexedDB is not supported in this environment.");return Promise.resolve()}catch(t){throw console.warn("IndexedDB initialization failed:",t),t}}async getItem(t){try{const r=await rg(t);if(r==null)return null;if(typeof r!="string"){if(r&&typeof r=="object")try{return JSON.parse(JSON.stringify(r))}catch{return r}return r}let n=Cn.decompressFromUTF16(r);const o=n!==null?n:r;try{return JSON.parse(o)}catch{return o}}catch(r){return console.warn(`[IndexedDBAdapter] Failed to get/decompress item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r),o=Cn.compressToUTF16(n);await ng(t,o)}catch(n){throw console.error(`[IndexedDBAdapter] Failed to compress/save item: ${t}`,n),n}}async removeItem(t){return og(t)}async clear(){return ig()}async getKeys(){return ag()}}class $u{constructor(){this.userId=null,this.deviceId=null,this.sessionId=null,this.storageKey="cine_user_uuid",this.deviceStorageKey="cine_device_uuid"}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})}init(){if(this.userId&&this.deviceId&&this.sessionId)return this.userId;let t=localStorage.getItem(this.storageKey);t?console.log("[UserContext] Loaded User UUID:",t):(t=this.generateUUID(),localStorage.setItem(this.storageKey,t),console.log("[UserContext] Generated new User UUID:",t)),this.userId=t;let r=localStorage.getItem(this.deviceStorageKey);return r||(r=this.generateUUID(),localStorage.setItem(this.deviceStorageKey,r),console.log("[UserContext] Generated new Device UUID:",r)),this.deviceId=r,this.sessionId=this.generateUUID(),console.log("[UserContext] Session UUID:",this.sessionId),t}getUserId(){return this.userId?this.userId:this.init()}getDeviceId(){return this.deviceId||this.init(),this.deviceId}getSessionId(){return this.sessionId||this.init(),this.sessionId}getScopedKey(t){return`user_${this.getUserId()}_${t}`}getIdentity(){return{userId:this.getUserId(),deviceId:this.getDeviceId(),sessionId:this.getSessionId()}}reset(){localStorage.removeItem(this.storageKey),this.userId=null,this.sessionId=null}}const ze=new $u,cg=Object.freeze(Object.defineProperty({__proto__:null,UserContext:$u,userContext:ze},Symbol.toStringTag,{value:"Module"})),Vu=1,rn=Object.freeze({SYNCED:"synced",PENDING:"pending",CONFLICT:"conflict",SYNCING:"syncing",LOCAL_ONLY:"local_only"}),Ue=Object.freeze({UNLOCKED:"unlocked",LOCKED_BY_SELF:"locked_by_self",LOCKED_BY_OTHER_TAB:"locked_by_other_tab",LOCKED_BY_OTHER_DEVICE:"locked_by_other_device"});function Ya(){return new Date().toISOString()}function lg(e="doc"){const t=Date.now().toString(36),r=Math.random().toString(36).substring(2,10);return`${e}_${t}_${r}`}function Hu(e={}){const t=ze.getIdentity(),r=Ya();return{version:Vu,docId:e.docId||lg(e.docType||"doc"),docType:e.docType||"unknown",ownerId:t.userId,createdAt:r,updatedAt:r,syncStatus:rn.LOCAL_ONLY,syncedAt:null,syncError:null,changeCount:1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId,lock:null,sharedWith:[],permissions:{}}}function ug(e){if(!e||typeof e!="object")return Hu();const t=ze.getIdentity(),r=Ya();return{...e,version:Vu,updatedAt:r,syncStatus:e.syncStatus===rn.SYNCED?rn.PENDING:e.syncStatus,changeCount:(e.changeCount||0)+1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId}}function fg(e,t=null){return!e||typeof e!="object"?(console.warn("[SyncMetadata] Cannot mark null metadata as synced"),e):{...e,syncStatus:rn.SYNCED,syncedAt:t||Ya(),syncError:null}}function pg(e,t){return!e||typeof e!="object"?e:{...e,syncStatus:rn.CONFLICT,syncError:t}}function dg(e,t=null,r={}){return{_meta:t?ug(t):Hu(r),data:e}}function yg(e){return!e||typeof e!="object"?{data:e,meta:null}:e._meta&&"data"in e?{data:e.data,meta:e._meta}:{data:e,meta:null}}function ri(e){return e&&typeof e=="object"&&"_meta"in e&&"data"in e}const gg="cine-project-locks",mg=5e3,hg=3e4,Ts="cine_project_lock_",hr=Object.freeze({LOCK_ACQUIRED:"lock_acquired",LOCK_RELEASED:"lock_released",LOCK_HEARTBEAT:"lock_heartbeat",LOCK_TAKEOVER:"lock_takeover",LOCK_QUERY:"lock_query",LOCK_STATUS:"lock_status"});class bg{constructor(){this.channel=null,this.localLocks=new Map,this.heartbeatIntervals=new Map,this.lockChangeListeners=new Set,this.initialized=!1}init(){if(!this.initialized){if(ze.init(),typeof BroadcastChannel<"u")try{this.channel=new BroadcastChannel(gg),this.channel.onmessage=t=>this._handleChannelMessage(t),console.log("[ProjectLockService] BroadcastChannel initialized")}catch(t){console.warn("[ProjectLockService] BroadcastChannel not available:",t)}this._restoreLocksFromStorage(),typeof window<"u"&&(window.addEventListener("beforeunload",()=>this._handlePageUnload()),window.addEventListener("pagehide",()=>this._handlePageUnload())),this.initialized=!0,console.log("[ProjectLockService] Initialized")}}async acquireLock(t,r={}){this.init();const n=this._getStoredLock(t),o=this._getLockStatusForLock(n);if(o===Ue.LOCKED_BY_SELF)return{success:!0,status:o,lock:n};if(o!==Ue.UNLOCKED&&!r.force)return{success:!1,status:o,lock:n};r.force&&n&&this._broadcastTakeover(t,n);const i=this._createLockObject(t);return this._storeLock(t,i),this.localLocks.set(t,i),this._startHeartbeat(t),this._broadcastLockAcquired(t,i),this._notifyListeners(t,Ue.LOCKED_BY_SELF,i),console.log("[ProjectLockService] Lock acquired:",t),{success:!0,status:Ue.LOCKED_BY_SELF,lock:i}}async releaseLock(t){this.init();const r=this._getStoredLock(t);return this._getLockStatusForLock(r)!==Ue.LOCKED_BY_SELF?(console.warn("[ProjectLockService] Cannot release lock not owned by this session"),!1):(this._stopHeartbeat(t),this._clearStoredLock(t),this.localLocks.delete(t),this._broadcastLockReleased(t),this._notifyListeners(t,Ue.UNLOCKED,null),console.log("[ProjectLockService] Lock released:",t),!0)}getLockInfo(t){this.init();const r=this._getStoredLock(t),n=this._getLockStatusForLock(r);return{status:n,lock:r,isEditable:n===Ue.UNLOCKED||n===Ue.LOCKED_BY_SELF}}subscribe(t){return this.lockChangeListeners.add(t),()=>this.lockChangeListeners.delete(t)}refreshHeartbeat(t){const r=this.localLocks.get(t);if(!r)return;const n=ze.getIdentity();if(r.sessionId!==n.sessionId){this._stopHeartbeat(t);return}r.heartbeat=new Date().toISOString(),this._storeLock(t,r),this._broadcastHeartbeat(t,r)}_createLockObject(t){const r=ze.getIdentity(),n=new Date().toISOString();return{projectId:t,userId:r.userId,deviceId:r.deviceId,sessionId:r.sessionId,acquiredAt:n,heartbeat:n}}_getStorageKey(t){return Ts+t}_storeLock(t,r){try{localStorage.setItem(this._getStorageKey(t),JSON.stringify(r))}catch(n){console.warn("[ProjectLockService] Failed to store lock:",n)}}_getStoredLock(t){try{const r=localStorage.getItem(this._getStorageKey(t));if(!r)return null;const n=JSON.parse(r);return this._isLockExpired(n)?(this._clearStoredLock(t),null):n}catch(r){return console.warn("[ProjectLockService] Failed to read lock:",r),null}}_clearStoredLock(t){try{localStorage.removeItem(this._getStorageKey(t))}catch(r){console.warn("[ProjectLockService] Failed to clear lock:",r)}}_isLockExpired(t){return!t||!t.heartbeat?!0:Date.now()-new Date(t.heartbeat).getTime()>hg}_getLockStatusForLock(t){if(!t||this._isLockExpired(t))return Ue.UNLOCKED;const r=ze.getIdentity();return t.sessionId===r.sessionId?Ue.LOCKED_BY_SELF:t.deviceId===r.deviceId?Ue.LOCKED_BY_OTHER_TAB:Ue.LOCKED_BY_OTHER_DEVICE}_startHeartbeat(t){this._stopHeartbeat(t);const r=setInterval(()=>{this.refreshHeartbeat(t)},mg);this.heartbeatIntervals.set(t,r)}_stopHeartbeat(t){const r=this.heartbeatIntervals.get(t);r&&(clearInterval(r),this.heartbeatIntervals.delete(t))}_restoreLocksFromStorage(){const t=ze.getIdentity();try{for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(!n||!n.startsWith(Ts))continue;const o=n.slice(Ts.length),i=this._getStoredLock(o);i&&i.sessionId===t.sessionId&&(this.localLocks.set(o,i),this._startHeartbeat(o),console.log("[ProjectLockService] Restored lock:",o))}}catch(r){console.warn("[ProjectLockService] Failed to restore locks:",r)}}_handlePageUnload(){for(const t of this.localLocks.keys())this._stopHeartbeat(t),this._clearStoredLock(t),this._broadcastLockReleased(t);this.localLocks.clear()}_notifyListeners(t,r,n){for(const o of this.lockChangeListeners)try{o(t,r,n)}catch(i){console.warn("[ProjectLockService] Listener error:",i)}}_broadcast(t,r){if(this.channel)try{this.channel.postMessage({type:t,...r})}catch(n){console.warn("[ProjectLockService] Broadcast failed:",n)}}_broadcastLockAcquired(t,r){this._broadcast(hr.LOCK_ACQUIRED,{projectId:t,lock:r})}_broadcastLockReleased(t){this._broadcast(hr.LOCK_RELEASED,{projectId:t})}_broadcastHeartbeat(t,r){this._broadcast(hr.LOCK_HEARTBEAT,{projectId:t,lock:r})}_broadcastTakeover(t,r){this._broadcast(hr.LOCK_TAKEOVER,{projectId:t,oldLock:r})}_handleChannelMessage(t){const{type:r,projectId:n,lock:o,oldLock:i}=t.data||{};if(!n)return;const s=ze.getIdentity();switch(r){case hr.LOCK_ACQUIRED:o&&o.sessionId!==s.sessionId&&this._notifyListeners(n,this._getLockStatusForLock(o),o);break;case hr.LOCK_RELEASED:this._notifyListeners(n,Ue.UNLOCKED,null);break;case hr.LOCK_TAKEOVER:i&&i.sessionId===s.sessionId&&(console.warn("[ProjectLockService] Lock taken over by another tab:",n),this._stopHeartbeat(n),this.localLocks.delete(n),this._notifyListeners(n,Ue.LOCKED_BY_OTHER_TAB,null));break;case hr.LOCK_HEARTBEAT:o&&o.sessionId!==s.sessionId&&this._storeLock(n,o);break}}destroy(){for(const t of this.heartbeatIntervals.keys())this._stopHeartbeat(t);this.channel&&(this.channel.close(),this.channel=null),this.localLocks.clear(),this.lockChangeListeners.clear(),this.initialized=!1}}const fn=new bg,to="cine_project:";class Sg{constructor(){this.driver=new Fi,this.initialized=!1}async init(){this.initialized||(await this.driver.init(),console.log("[StorageRepository] Initialized with default driver:",this.driver.constructor.name),this.initialized=!0,fn.init())}async switchDriver(t){console.log("[StorageRepository] Switching driver to:",t.constructor.name),await t.init(),this.driver=t}async getItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.getItem(r)}async setItem(t,r){this.initialized||await this.init();const n=ze.getScopedKey(t);return this.driver.setItem(n,r)}async removeItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.removeItem(r)}async clear(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`,n=t.filter(o=>o.startsWith(r)).map(o=>this.driver.removeItem(o));await Promise.all(n)}async getKeys(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`;return t.filter(n=>n.startsWith(r)).map(n=>n.slice(r.length))}getProjectKeyPrefix(){return to}getProjectStorageKey(t){return`${to}${t}`}getProjectKeyFromStorageKey(t){return typeof t!="string"||!t.startsWith(to)?t:t.slice(to.length)}isProjectStorageKey(t){return typeof t=="string"&&t.startsWith(to)}async getProjectKeys(){return(await this.getKeys()).filter(r=>this.isProjectStorageKey(r)).map(r=>this.getProjectKeyFromStorageKey(r))}async loadProject(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return yg(n)}async loadProjectRaw(t){return(await this.loadProject(t)).data}async saveProject(t,r,n=null){this.initialized||await this.init();const o=fn.getLockInfo(t);if(!o.isEditable)return console.warn("[StorageRepository] Cannot save - project is locked by another session"),{success:!1,error:"PROJECT_LOCKED",lockInfo:o};const i=dg(r,n,{docType:"project",docId:t}),s=this.getProjectStorageKey(t);return await this.setItem(s,i),Ml(async()=>{const{dataVault:a}=await Promise.resolve().then(()=>Og);return{dataVault:a}},void 0,import.meta.url).then(({dataVault:a})=>{a&&a.saveSnapshot(t,i).catch(c=>console.warn("Auto-backup failed",c))}),console.log("[StorageRepository] Project saved with metadata:",t),{success:!0,meta:i._meta}}async getProjectMeta(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return ri(n)?n._meta:null}async markProjectSynced(t,r=null){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return ri(o)?(o._meta=fg(o._meta,r),await this.setItem(n,o),!0):(console.warn("[StorageRepository] Cannot mark as synced - no metadata"),!1)}async markProjectConflict(t,r){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return ri(o)?(o._meta=pg(o._meta,r),await this.setItem(n,o),!0):!1}async getPendingSyncProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const o=await this.getProjectMeta(n);o&&(o.syncStatus===rn.PENDING||o.syncStatus===rn.LOCAL_ONLY)&&r.push({key:n,meta:o})}return r}async listProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const{data:o,meta:i}=await this.loadProject(n);i&&i.docType==="project"&&r.push({key:n,data:o,meta:i})}return r}async acquireProjectLock(t,r={}){return this.initialized||await this.init(),fn.acquireLock(t,r)}async releaseProjectLock(t){return fn.releaseLock(t)}getProjectLockInfo(t){return fn.getLockInfo(t)}onLockChange(t){return fn.subscribe(t)}async removeProject(t){const r=this.getProjectStorageKey(t);return this.removeItem(r)}async migrateUnprefixedProjectRecords({projectIndexKeys:t=[]}={}){this.initialized||await this.init();const r=await this.getKeys(),n=new Set(r.filter(a=>this.isProjectStorageKey(a))),o=new Set;(Array.isArray(t)?t:[]).forEach(a=>{const c=this.getProjectKeyFromStorageKey(a);typeof c=="string"&&c&&o.add(c)});for(const a of r){if(this.isProjectStorageKey(a)||o.has(a))continue;const c=await this.getItem(a);ri(c)&&c._meta&&c._meta.docType==="project"&&o.add(a)}const s=[];for(const a of o){if(typeof a!="string"||!a)continue;const c=this.getProjectStorageKey(a);if(n.has(c))continue;const l=await this.getItem(a);if(l!=null)try{await this.setItem(c,l),await this.removeItem(a),n.add(c),s.push(a)}catch(f){console.warn(`[StorageRepository] Failed to migrate project key "${a}"`,f)}}return{migratedKeys:s}}}const k=new Sg;class wg extends Ku{constructor(){super();try{this.storage=window.localStorage}catch(t){console.warn("[LocalStorageAdapter] Unable to access window.localStorage.",t),this.storage=null}}async init(){if(!this.storage)throw new Error("LocalStorage is unavailable. Access to window.localStorage failed or is blocked.");return Promise.resolve()}async getItem(t){try{const r=this.storage.getItem(t);if(r===null)return null;try{return JSON.parse(r)}catch{return r}}catch(r){return console.warn(`[LocalStorageAdapter] Failed to get item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r);this.storage.setItem(t,n)}catch(n){throw console.error(`[LocalStorageAdapter] Failed to save item: ${t}`,n),n}}async removeItem(t){try{this.storage.removeItem(t)}catch(r){console.warn(`[LocalStorageAdapter] Failed to remove item: ${t}`,r)}}async clear(){try{this.storage.clear()}catch(t){console.warn("[LocalStorageAdapter] Failed to clear storage",t)}}async getKeys(){const t=[];for(let r=0;r<this.storage.length;r+=1){const n=this.storage.key(r);n!==null&&t.push(n)}return t}}const ro="cine_storage_migrated_v2";class Eg{constructor(){this.localStorage=new wg,this.indexedDB=new Fi}async runMigrationIfNeeded(){try{if(await this.localStorage.init(),await this.indexedDB.init(),await this.localStorage.getItem(ro)==="true")return console.log("[MigrationService] Storage already migrated to IndexedDB."),!1;console.log("[MigrationService] Starting storage migration...");const r=await this.localStorage.getKeys();if(r.length===0)return console.log("[MigrationService] No local storage data found. safe to skip."),await this.markAsMigrated(),!1;const n=r.filter(i=>i!==ro&&i!=="cine_user_uuid");let o;try{o=await this.loadUserContext()}catch(i){return console.error("[MigrationService] Failed to load UserContext for scoping. Aborting migration to prevent data loss.",i),!1}for(const i of n)try{const s=await this.localStorage.getItem(i);if(s!==null){const a=o.getScopedKey(i);await this.indexedDB.setItem(a,s),console.log(`[MigrationService] Migrated key: ${i} -> ${a}`)}}catch(s){console.error(`[MigrationService] Failed to migrate key: ${i}`,s)}return await this.markAsMigrated(),console.log("[MigrationService] Migration complete. IndexedDB is now the primary storage."),!0}catch(t){return console.error("[MigrationService] Critical migration failure:",t),!1}}async markAsMigrated(){const t=async(r,n)=>{try{await r.setItem(ro,"true")}catch(o){console.warn(`[MigrationService] Failed to set migration flag in ${n}:`,o)}};await Promise.all([t(this.localStorage,"LocalStorage"),t(this.indexedDB,"IndexedDB")])}async loadUserContext(){const r=(await Ml(()=>Promise.resolve().then(()=>cg),void 0,import.meta.url)).userContext;if(!r)throw new Error("UserContext module loaded but userContext export is missing");return r.init(),r}async isMigrated(){try{return await this.localStorage.getItem(ro)==="true"?!0:await this.indexedDB.getItem(ro)==="true"}catch(t){return console.warn("[MigrationService] Failed to check migration status:",t),!1}}}const Yt=new Eg,$c="cameraPowerPlanner_ownGear";class Ag{constructor(){this.memoryCache=null}async getOwnGear(){if(this.memoryCache)return this.memoryCache;try{const t=await k.getItem($c);if(!t)return[];Array.isArray(t)?this.memoryCache=t:t.items&&Array.isArray(t.items)?this.memoryCache=t.items:this.memoryCache=[]}catch(t){console.warn("[GearRepository] Failed to load own gear:",t),this.memoryCache=[]}return this.memoryCache}async saveOwnGear(t){if(!Array.isArray(t)){console.error("[GearRepository] saveOwnGear expects an array");return}this.memoryCache=t,await k.setItem($c,t)}async addOwnGearItem(t){const r=await this.getOwnGear();r.push(t),await this.saveOwnGear(r)}getLibrary(){return typeof window<"u"&&window.deviceLibrary?window.deviceLibrary:typeof globalThis<"u"&&globalThis.deviceLibrary?globalThis.deviceLibrary:{}}async searchGear(t){if(!t)return[];const r=t.toLowerCase();return(await this.getOwnGear()).filter(i=>i.name&&i.name.toLowerCase().includes(r)||i.brand&&i.brand.toLowerCase().includes(r))}}const qu=new Ag;class Wu{constructor(){this.root=null,this.initialized=!1}async init(){if(!this.initialized)try{if(!navigator.storage||!navigator.storage.getDirectory){console.warn("[DataVault] OPFS is not supported in this browser.");return}this.root=await navigator.storage.getDirectory(),this.initialized=!0}catch(t){console.error("[DataVault] Failed to initialize OPFS:",t)}}async saveSnapshot(t,r){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const n=t.replace(/[^a-z0-9_\-\.\s]/gi,"_"),i=await(await this.root.getFileHandle(n+".json",{create:!0})).createWritable();return await i.write(JSON.stringify(r)),await i.close(),console.log(`[DataVault] Saved snapshot: ${t}`),!0}catch(n){throw console.error(`[DataVault] Failed to save snapshot ${t}:`,n),n}}async listSnapshots(){if(this.initialized||await this.init(),!this.root)return[];const t=[];try{for await(const[r,n]of this.root.entries())n.kind==="file"&&r.endsWith(".json")&&t.push(r)}catch(r){console.error("[DataVault] Failed to list snapshots:",r)}return t.sort().reverse()}async restoreSnapshot(t){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const o=await(await(await this.root.getFileHandle(t)).getFile()).text();return JSON.parse(o)}catch(r){throw console.error(`[DataVault] Failed to restore snapshot ${t}:`,r),r}}async deleteSnapshot(t){if(this.initialized||await this.init(),!!this.root)try{await this.root.removeEntry(t),console.log(`[DataVault] Deleted snapshot: ${t}`)}catch(r){console.warn(`[DataVault] Failed to delete snapshot ${t}:`,r)}}async clear(){if(this.initialized||await this.init(),!!this.root)try{const t=await this.listSnapshots();for(const r of t)await this.root.removeEntry(r);console.log("[DataVault] All data wiped.")}catch(t){console.error("[DataVault] Failed to wipe vault:",t)}}}const Xs=new Wu,Og=Object.freeze(Object.defineProperty({__proto__:null,DataVault:Wu,dataVault:Xs},Symbol.toStringTag,{value:"Module"}));var yo={};console.log("DEBUG: storage.js execution started");let Ve={},ur=!1;async function Yu(){if(!ur){console.log("[storage.js] Hydrating project cache from storage...");try{const e=k&&typeof k.getProjectKeys=="function"?await k.getProjectKeys():[],t="cameraPowerPlanner_project";let r=null;const n=e.slice();if(k&&typeof k.getItem=="function"){const i=await k.getItem(zn),s=dc(i);s&&(Un=s),k.getItem(Ut).then(a=>{a&&(Zi=a)}),k.getItem(Ot).then(a=>{a&&(Ao=a)}),k.getItem(Qe).then(a=>{a&&(Oo=a)}),k.getItem(ut).then(a=>{Array.isArray(a)&&(wn=a)}),k.getItem(Kt).then(a=>{a&&(es=a)}),k.getItem(pr).then(a=>{a&&(ts=a)}),k.getItem(tr).then(a=>{a&&(Mo=a)}),k.getItem(rt).then(a=>{a&&(No=a)}),k.getItem(zt).then(a=>{a&&(Go=a)}),k.getItem(Re).then(a=>{a&&(zo=a)}),k.getItem(tt).then(a=>{a&&(Bo=a)}),k.getItem(Gt).then(a=>{a&&(Kn=a)}),k.getItem(ct).then(a=>{a&&(xo=a)}),k.getItem(et).then(a=>{a&&(Fo=a)}),k.getItem(lt).then(a=>{a&&(Do=a)}),k.getItem(Je).then(a=>{a&&(Hr=a)}),k.getItem(Ft()).then(a=>{a&&(Uo=a)}),k.getItem(Fe).then(a=>{a&&(or=a)}),r=await k.getItem(t)}if(r&&typeof r=="object")try{Object.assign(Ve,r)}catch(i){console.warn("[hydrate] Failed to load monolith",i)}const o=n.map(async i=>{try{const s=await k.loadProjectRaw(i);s&&(Ve[i]=s)}catch(s){console.warn("[hydrate] Failed to load shard",i,s)}});await Promise.all(o),ur=!0,console.log("[storage.js] Project cache hydrated. Keys:",Object.keys(Ve).length)}catch(e){console.warn("Cache hydration failed",e)}}}const S=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:null,Cg=typeof process<"u"&&process&&yo&&(yo.JEST_WORKER_ID||yo.CINE_FORCE_STORAGE_REINIT),At="cine_factory_reset_lock";if(S&&S.__cineStorageInitialized)if(Cg){try{delete S.__cineStorageInitialized}catch{S.__cineStorageInitialized=!1}try{delete S.__cineStorageApi}catch{S.__cineStorageApi=null}try{delete S.__cineMonolithicProjectCleanupDone}catch{S.__cineMonolithicProjectCleanupDone=!1}}else typeof module<"u"&&module.exports&&S.__cineStorageApi&&typeof S.__cineStorageApi=="object"&&(module.exports=S.__cineStorageApi);const _g="cine-power-planner-lifecycle";let ve=null;const Pg=typeof process<"u"&&process&&yo&&yo.JEST_WORKER_ID;if(typeof BroadcastChannel<"u"&&!Pg)try{ve=new BroadcastChannel(_g),ve&&(ve.onmessage=e=>{if(e&&e.data==="factory-reset"){if(S){S.__cameraPowerPlannerFactoryResetting=!0;try{typeof sessionStorage<"u"&&sessionStorage.setItem(At,"true"),typeof localStorage<"u"&&localStorage.setItem(At,"true")}catch(t){}if(typeof sessionStorage<"u"&&typeof sessionStorage.clear=="function")try{const t=sessionStorage.getItem(At);sessionStorage.clear(),t&&sessionStorage.setItem(At,t)}catch(t){}typeof S.location<"u"&&typeof S.location.reload=="function"&&S.location.reload()}}else e.data==="project-shards-changed"&&fr()})}catch{}if(S)try{const e=[typeof window<"u"?window:null,typeof sessionStorage<"u"?sessionStorage:null,typeof localStorage<"u"?localStorage:null];let t=!1;e.forEach(r=>{if(r&&typeof r.getItem=="function")try{r.getItem(At)&&(t=!0)}catch(n){}}),t&&(S.__cineJustFactoryReset=!0),e.forEach(r=>{if(r&&typeof r.removeItem=="function")try{r.removeItem(At)}catch(n){}}),Object.defineProperty(S,"__cineStorageInitialized",{configurable:!0,writable:!0,value:!0}),(async()=>{try{let r=!1;if(Yt&&typeof Yt.runMigrationIfNeeded=="function"){const o=await Yt.runMigrationIfNeeded(),i=await Yt.isMigrated();(o||i)&&(console.log(o?"[storage.js] Migration successful. Switching to IndexedDB.":"[storage.js] Native IndexedDB mode active."),await k.switchDriver(new Fi),r=!0)}else if(Yt&&typeof Yt.init=="function"){const o=await Yt.init();let i=!1;typeof Yt.isMigrated=="function"&&(i=await Yt.isMigrated()),(o||i)&&(await k.switchDriver(new Fi),r=!0)}const n=await Bh();if(r&&(await Yu(),(!n.hasIndex||!Un)&&ur&&Ve&&Object.keys(Ve).length>0))try{Ro(Ve,T())}catch(o){console.warn("Failed to refresh project index after migration",o)}}catch(r){console.warn("[storage.js] Migration service failed:",r)}})()}catch{S.__cineStorageInitialized=!0}function kg(){if(ve){try{ve.close()}catch{}ve=null}}typeof module<"u"&&module.exports&&(module.exports.closeStorageLifecycle=kg,module.exports.hydrateProjectCache=Yu,module.exports.__resetProjectMemoryCache=()=>{Ve={},ur=!1});function Zs(e,t){if(e===null||typeof e!="object")return e;let r=t;if(r||(r=typeof WeakMap=="function"?new WeakMap:[]),typeof r.has=="function"&&typeof r.get=="function"){if(r.has(e))return r.get(e)}else if(Array.isArray(r))for(let i=0;i<r.length;i+=1){const s=r[i];if(s&&s[0]===e)return s[1]}if(Object.prototype.toString.call(e)==="[object Date]"){let i;try{const s=typeof e.getTime=="function"?e.getTime():e.valueOf();i=new Date(s)}catch{i=new Date(e)}return typeof r.set=="function"?r.set(e,i):Array.isArray(r)&&r.push([e,i]),i}const o=Array.isArray(e)?[]:{};if(typeof r.set=="function"?r.set(e,o):Array.isArray(r)&&r.push([e,o]),Array.isArray(e))for(let i=0;i<e.length;i+=1)o[i]=Zs(e[i],r);else{const i=Object.keys(e);for(let s=0;s<i.length;s+=1){const a=i[s];o[a]=Zs(e[a],r)}}return o}function zr(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return Zs(e,null)}function vg(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function jg(e){const t=vg(e);return t?function(n){if(n===null||typeof n!="object")return n;try{return t(n)}catch{}return zr(n)}:zr}const gr=S&&typeof S.__cineDeepClone=="function"?S.__cineDeepClone:jg(S),_n=typeof WeakSet=="function"?new WeakSet:null;function Jr(e){if(!(!_n||typeof _n.add!="function"||!e))try{_n.add(e)}catch{}}function Ja(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.sessionStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}(function(){const t=[S,S&&S.window?S.window:null,S&&S.__cineGlobal?S.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=Ja(t[r]);n&&Jr(n)}if(typeof sessionStorage<"u")try{Jr(sessionStorage)}catch{}})();function Ig(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.localStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}function Ju(){const e=[S,S&&S.window?S.window:null,S&&S.__cineGlobal?S.__cineGlobal:null,typeof window<"u"?window:null,typeof globalThis<"u"?globalThis:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=[],r=typeof WeakSet=="function"?new WeakSet:null;for(let n=0;n<e.length;n+=1){const o=Ig(e[n]);if(o){if(r)try{if(r.has(o))continue;r.add(o)}catch{}else if(t.indexOf(o)!==-1)continue;t.push(o)}}return t}if(S&&typeof S.__cineDeepClone!="function")try{S.__cineDeepClone=gr}catch{}function Qu(){const e=r=>{if(!r||typeof r!="object"&&typeof r!="function")return!1;try{return r.__cameraPowerPlannerFactoryResetting===!0}catch{return!1}};if(e(S))return!0;const t=[typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&n!==S&&e(n))return!0}try{if(typeof sessionStorage<"u"&&sessionStorage.getItem(At)||typeof localStorage<"u"&&localStorage.getItem(At))return!0}catch{}return!1}var Ze="cameraPowerPlanner_devices",ni=null,pt="cameraPowerPlanner_setups",er="cameraPowerPlanner_session",Mr="cameraPowerPlanner_feedback",pe="cameraPowerPlanner_project",Qa="cameraPowerPlanner_project_rev",et="cameraPowerPlanner_favorites",tt="cameraPowerPlanner_contacts",Gt="cameraPowerPlanner_ownGear",ct="cameraPowerPlanner_userProfile",Lr="cameraPowerPlanner_documentationTracker",dt="cameraPowerPlanner_schemaCache",Xu="cinePowerPlanner_schemaCache",tr="cameraPowerPlanner_customFonts",mi="cameraPowerPlanner_mountVoltages",zt="cameraPowerPlanner_cameraColors",Re="cineRentalPrintSections",zn="cameraPowerPlanner_projectIndex",go=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.mountVoltageKey"):null,st=null,kr=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.storageCache"):"__cineStorageStateCache",Bt="cameraPowerPlanner_prj_",bn=typeof WeakMap=="function"&&typeof Map=="function"?new WeakMap:null,vt=null,Vc=!1,Qr=typeof Map=="function"?new Map:null,no=[],Lg=6,Zu=typeof Object.freeze=="function"?Object.freeze({__cineCompressionMiss:!0}):{__cineCompressionMiss:!0},Hc=rf(8),qc=rf(6),Ct=typeof Map=="function"?new Map:null,vr=[],Rg=16;function Di(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.slice();for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n],i=e[o];t[o]=Array.isArray(i)?i.slice():i}return t}function ef(e){if(!Ct||typeof e!="string"||!e)return null;var t;try{t=Ct.get(e)}catch{t=null}return!t||!t.payload?null:{payload:Di(t.payload),compression:t.compression?Di(t.compression):null}}function hi(e,t,r){if(!(!Ct||typeof e!="string"||!e||!xn(t))){var n={payload:Di(t),compression:r?Di(r):null};try{Ct.set(e,n)}catch{return}var o=vr.indexOf(e);for(o!==-1&&vr.splice(o,1),vr.push(e);vr.length>Rg;){var i=vr.shift();if(!(!i||i===e))try{Ct.delete(i)}catch{}}}}function Tg(){if(Ct&&typeof Ct.clear=="function")try{Ct.clear()}catch{}vr.length=0}var ea=Number.POSITIVE_INFINITY,ta=8,tf=60*1e3,lo={entries:Object.create(null),totalWarnings:0,suppressionNoticeShown:!1},bt=null,br=null,pn=null,Wc=!1;zy&&typeof Bi=="function"&&(bt=Bi);var rr="",xt=!1;!bt&&S&&typeof S.__cineEnsureConsoleMethodsWritable=="function"&&(bt=S.__cineEnsureConsoleMethodsWritable);typeof bt=="function"&&bt(["warn","info"]);function Mg(){var e=[],t=function(n){!n||typeof n!="object"&&typeof n!="function"||e.indexOf(n)===-1&&e.push(n)};return t(S),t(typeof globalThis<"u"?globalThis:null),t(typeof window<"u"?window:null),t(typeof self<"u"?self:null),t(typeof global<"u"?global:null),e}function Ng(){if(br)return br;if(Yr&&typeof Yr.resolveLogger=="function")return br=Yr,br;for(var e=Mg(),t=0;t<e.length;t+=1){var r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{var n=r.cineLoggingResolver;if(n&&typeof n.resolveLogger=="function")return br=n,br}catch{}}return br=null,br}function Gg(){if(pn||Wc)return pn;Wc=!0;var e=Ng();if(e&&typeof e.resolveLogger=="function")try{var t=e.resolveLogger("storage",{meta:{source:"storage-module"}});if(t)return pn=t,pn}catch{}return pn=null,pn}function mn(e){if(!e)return null;if(typeof e=="string")return{message:e};var t={};if(typeof e.name=="string"&&e.name&&(t.name=e.name),typeof e.message=="string"&&e.message&&(t.message=e.message),typeof e.stack=="string"&&e.stack&&(t.stack=e.stack),!Object.keys(t).length)try{t.message=String(e)}catch{return null}return t}function Cr(e){if(e&&typeof D<"u"&&D&&D.storage===e)return D&&typeof D.type=="string"?D.type:"unknown";if(e&&S){try{if(S.localStorage&&e===S.localStorage)return"local"}catch{}try{if(S.sessionStorage&&e===S.sessionStorage)return"session"}catch{}}return typeof D<"u"&&D&&typeof D.type=="string"?D.type:"unknown"}function _r(e,t,r,n,o){var i=typeof e=="string"&&e?e.toLowerCase():"info",s=typeof t=="string"&&t?t:"Storage event",a=Gg(),c=!1,l={module:"storage"};if(n&&typeof n=="object"){l={module:"storage"};for(var f=Object.keys(n),u=0;u<f.length;u+=1){var y=f[u];l[y]=n[y]}}if(a){if(typeof a[i]=="function")try{a[i](s,r,l),c=!0}catch{c=!1}else if(typeof a.log=="function")try{a.log(i,s,r,l),c=!0}catch{c=!1}}if(typeof o=="function"){try{o()}catch{}return c}if(typeof console>"u"||!console)return c;var p=null;if(i==="error"&&typeof console.error=="function"?p=console.error:i==="warn"&&typeof console.warn=="function"?p=console.warn:i==="info"&&typeof console.info=="function"?p=console.info:i==="debug"&&typeof console.debug=="function"?p=console.debug:typeof console.log=="function"&&(p=console.log),typeof p=="function")try{p.call(console,s,r||null)}catch{}return c}function zg(){if(typeof Date>"u")return null;if(typeof Date.now=="function")return Date.now();try{return new Date().getTime()}catch{}return null}function ds(e,t,r,n,o){var i=typeof e=="string"&&e?e:"generic",s=null;if(typeof t=="string"&&t)s=t;else if(t!=null)try{s=String(t)}catch{s=null}var a={event:"compression-savings",kind:i,key:s,storageType:Cr()};typeof n=="number"&&Number.isFinite(n)&&(a.savings=n),typeof o=="number"&&Number.isFinite(o)&&(a.percent=o);var c=function(){if(!(typeof console>"u")){var f=lo,u=f.entries[i],y=zg();if(u||(u={kind:i,occurrences:0,totalSavings:0,lastPercent:null,lastKey:null,uniqueKeys:Object.create(null),uniqueKeyCount:0,firstLoggedAt:y,lastLoggedAt:y,lastSummaryAt:null,suppressedTotal:0,suppressedSinceSummary:0},f.entries[i]=u),u.occurrences+=1,u.lastLoggedAt=y,s&&(u.lastKey=s,u.uniqueKeys[s]||(u.uniqueKeys[s]=!0,u.uniqueKeyCount+=1)),typeof n=="number"&&Number.isFinite(n)&&(u.totalSavings+=n),typeof o=="number"&&Number.isFinite(o)&&(u.lastPercent=o),f.totalWarnings<ea){typeof bt=="function"&&bt("warn"),typeof console.warn=="function"&&r&&console.warn(r),f.totalWarnings+=1;return}u.suppressedTotal+=1,u.suppressedSinceSummary+=1,!f.suppressionNoticeShown&&typeof console.info=="function"&&(typeof bt=="function"&&bt("info"),console.info("Additional storage compression warnings are being batched to keep diagnostics readable.",{limit:ea,batchSize:ta}),f.suppressionNoticeShown=!0);var p=!1;u.lastSummaryAt?(u.suppressedSinceSummary>=ta||y!==null&&u.lastSummaryAt!==null&&u.suppressedSinceSummary>0&&y-u.lastSummaryAt>=tf)&&(p=!0):p=!0,p&&typeof console.info=="function"&&(typeof bt=="function"&&bt("info"),console.info("Suppressed repeated storage compression warnings.",{kind:u.kind,mostRecentKey:u.lastKey,suppressedSinceSummary:u.suppressedSinceSummary,suppressedTotal:u.suppressedTotal,totalOccurrences:u.occurrences,totalSavings:u.totalSavings,lastPercent:u.lastPercent,uniqueKeys:u.uniqueKeyCount}),u.lastSummaryAt=y,u.suppressedSinceSummary=0)}};_r("info",r,a,{event:"compression-savings",kind:i},c)}function Bg(){for(var e={},t=Object.keys(lo.entries),r=0;r<t.length;r+=1){var n=t[r],o=lo.entries[n];o&&(e[n]={kind:o.kind,occurrences:o.occurrences,totalSavings:o.totalSavings,lastPercent:o.lastPercent,lastKey:o.lastKey,uniqueKeyCount:o.uniqueKeyCount,firstLoggedAt:o.firstLoggedAt,lastLoggedAt:o.lastLoggedAt,lastSummaryAt:o.lastSummaryAt,suppressedTotal:o.suppressedTotal})}return{limit:ea,batchSize:ta,summaryWindowMs:tf,totalWarnings:lo.totalWarnings,suppressionNoticeShown:lo.suppressionNoticeShown,entries:e}}function xg(e){if(!Array.isArray(e)||!e.length)return null;for(var t=[],r=0;r<e.length;r+=1){var n=e[r]||{},o=typeof n.variant=="string"?n.variant:"",i=typeof n.compress=="string"?n.compress:"",s=typeof n.decompress=="string"?n.decompress:"";t.push(o+":"+i+":"+s)}return t.join("|")}function Fg(e,t){if(!Qr||!e)return null;var r;try{r=Qr.get(e)}catch{r=null}return!r||r.lz!==t?null:!Array.isArray(r.strategies)||!r.strategies.length?Array.isArray(r.strategies)?[]:null:r.strategies.slice()}function Dg(e){if(!(!Qr||!e)){var t=no.indexOf(e);for(t!==-1&&no.splice(t,1),no.push(e);no.length>Lg;){var r=no.shift();if(typeof Qr.delete=="function")try{Qr.delete(r)}catch{}}}}function Ug(e,t,r){if(!(!Qr||!e)){var n={lz:t,strategies:Array.isArray(r)?r.slice():[]};try{Qr.set(e,n),Dg(e)}catch{}}}function Kg(){if(typeof JSON>"u"||!JSON||typeof JSON.stringify!="function")return 0;try{var e={[dr]:!0,version:Ui,algorithm:Io,namespace:on,data:"",originalLength:0,compressedPayloadLength:0,compressionVariant:""},t=JSON.stringify(e);if(typeof t!="string"||!t)return 0;var r=JSON.stringify("").length;return r>0?t.length-r*2-String(0).length*2:0}catch{}return 0}function rf(e){if(typeof Map!="function")return null;var t=Number(e);return t>0?{map:new Map,keys:[],limit:Math.floor(t)}:null}function nf(e){if(!e||typeof e!="object")return null;for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1)t[r[n]]=e[r[n]];return t}function of(e,t){if(!(!e||!Array.isArray(e.keys))){var r=e.keys.indexOf(t);r!==-1&&e.keys.splice(r,1),e.keys.push(t)}}function sf(e,t){if(!e||!e.map||typeof e.map.get!="function")return{hit:!1};if(typeof t!="string"||!t)return{hit:!1};var r;try{r=e.map.get(t)}catch{return{hit:!1}}if(r===void 0)return{hit:!1};if(of(e,t),r===Zu)return{hit:!0,candidate:null};var n=nf(r);return n?{hit:!0,candidate:n}:{hit:!0,candidate:null}}function af(e,t,r){if(!(!e||!e.map||typeof e.map.set!="function")&&!(typeof t!="string"||!t)&&!(!e.limit||e.limit<=0)){var n=r&&typeof r=="object"?nf(r):Zu;try{e.map.set(t,n)}catch{return}for(of(e,t);e.keys.length>e.limit;){var o=e.keys.shift();if(!(typeof o!="string"||o===t))try{e.map.delete(o)}catch{}}}}function Xa(e,t){if(!e||typeof e!="object"&&typeof e!="function")return null;let r=null;if(kr)try{r=e[kr]}catch{r=null}if(!r&&bn)try{r=bn.get(e)||null}catch{r=null}if(r||!t)return r||null;const n=new Map;let o=!1;if(kr)try{Object.defineProperty(e,kr,{configurable:!0,writable:!0,value:n}),o=!0}catch{try{e[kr]=n,o=!0}catch{o=!1}}if(!o&&bn)try{bn.set(e,n),o=!0}catch{o=!1}return o?n:null}function $g(e,t){const r=Xa(e,!1);return!r||typeof t!="string"||!t?null:r.get(t)||null}function Zt(e,t){const r=Xa(e,!1);if(!(!r||typeof t!="string"||!t)&&(typeof r.delete=="function"&&r.delete(t),r.size===0)){if(kr)try{e&&(typeof e=="object"||typeof e=="function")&&Object.prototype.hasOwnProperty.call(e,kr)&&delete e[kr]}catch{}if(bn)try{bn.delete(e)}catch{}}}function cf(e){if(e===null||typeof e!="object")return e;try{return gr(e)}catch{}return e}function Ms(e){if(!e)return;const{value:t}=e;return t===null||typeof t!="object"?t:cf(t)}function Bn(e,t){const r=new Map;if(!e||typeof e.forEach!="function")return r;const{freezeArray:n=!1}=t||{};return e.forEach((o,i)=>{if(Array.isArray(o)){const s=o.slice();if(n)try{Object.freeze(s)}catch{}r.set(i,s)}else r.set(i,o)}),r}function ra(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Bn(e.raw),normalized:Bn(e.normalized)}}function Vg(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Bn(e.raw),normalized:Bn(e.normalized,{freezeArray:!0})}}function Hg(e){if(!P(e))return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n],i=e[o];if(i&&typeof i=="object")try{Object.freeze(i)}catch{}t[o]=i}try{Object.freeze(t)}catch{}return t}function Yc(e){if(!e||typeof e!="object"){st=null;return}st={projects:Hg(e.projects),changed:!!e.changed,originalValue:e.originalValue,lookup:Vg(e.lookup),rawValue:e.rawValue===void 0?void 0:e.rawValue}}function qg(e){if(!st)return null;const t=T();let r=null;if(t&&typeof t.getItem=="function")try{r=t.getItem(pe)}catch{r=null}if(st.rawValue!==void 0&&st.rawValue!==r)return st=null,null;const{forMutation:n=!1}=e||{};return{projects:n?gr(st.projects):st.projects,changed:st.changed,originalValue:st.originalValue,lookup:ra(st.lookup)}}function fr(){st=null}function Wg(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}return null}function Yg(){return Qa}function lf(e){const t=e||T();if(!t||typeof t.getItem!="function")return null;const r=Me(t,Qa,"Error reading project storage revision from localStorage:",null,{validate:n=>n===null||typeof n=="number"||typeof n=="string"});return Wg(r)}function Za(e){const t=e||T();if(!t||typeof t.setItem!="function")return null;const r=lf(t),n=Number.isFinite(r)?r+1:1;return Ae(t,Qa,n,"Error saving project storage revision to localStorage:",{disableCompression:!0,enableCompressionSweep:!1}),n}function Ke(e,t,r,n,o){if(typeof t!="string"||!t||!e||typeof e!="object"&&typeof e!="function")return;const i=Xa(e,!0);if(!i)return;const s=cf(o),c={raw:typeof r=="string"&&r?r:null,normalizedRaw:typeof n=="string"&&n?n:typeof r=="string"&&r?r:null,value:s};i.set(t,c)}function Jg(e,t,r,n){const o=$g(e,t);if(!o)return{hit:!1};if(typeof n=="string"&&n&&o.raw&&o.raw===n)return{hit:!0,value:Ms(o)};if(typeof r=="string"&&r){if(o.normalizedRaw&&o.normalizedRaw===r)return{hit:!0,value:Ms(o)};if(o.raw&&o.raw===r)return{hit:!0,value:Ms(o)}}return{hit:!1}}function Qg(e,t){if(!e||typeof e!="object")return"";var r;try{r=Object.getOwnPropertyDescriptor(e,t)}catch{r=null}if(r&&Object.prototype.hasOwnProperty.call(r,"value")&&typeof r.value=="string"&&r.value)return r.value;var n;try{n=e[t]}catch{n=""}if(typeof n=="string"&&n)return n;if(go)try{const o=e[go];if(typeof o=="string"&&o)return o}catch{}return""}function uf(e,t,r){if(!e||typeof e!="object")return"";if(go)try{e[go]=r;const i=e[go];if(typeof i=="string"&&i)return i}catch{}var n;try{n=Object.getOwnPropertyDescriptor(e,t)}catch{n=null}if(n&&Object.prototype.hasOwnProperty.call(n,"value")&&typeof n.value=="string"&&n.value)return n.value;if(n&&n.configurable===!1&&n.writable===!1)return"";var o="";try{e[t]=r,o=e[t]}catch{o=""}return typeof o=="string"&&o?o:(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose mount voltage storage key globally. Using fallback only."),"")}function ff(){if(!S||typeof S!="object")return mi;var e=Qg(S,"MOUNT_VOLTAGE_STORAGE_KEY");if(e)return e;var t=uf(S,"MOUNT_VOLTAGE_STORAGE_KEY",mi);return t||mi}var bi=ff();function pf(){const e=ff();if(e&&e!==bi&&(bi=e,S&&uf(S,"MOUNT_VOLTAGE_STORAGE_KEY",e),typeof Lt<"u"&&Lt&&typeof Lt.add=="function")){Lt.add(e);const t=Pt(e);for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&Lt.add(n)}}return bi}function Ft(){return pf()}function df(){const e=pf();return e?`${e}__backup`:`${mi}__backup`}function yf(){if(!S)return tr;const e=typeof S.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?S.CUSTOM_FONT_STORAGE_KEY_NAME:typeof S.CUSTOM_FONT_STORAGE_KEY=="string"?S.CUSTOM_FONT_STORAGE_KEY:tr;let t=e;return e==="cinePowerPlanner_customFonts"&&(t=tr),S.CUSTOM_FONT_STORAGE_KEY!==t&&(S.CUSTOM_FONT_STORAGE_KEY=t),S.CUSTOM_FONT_STORAGE_KEY_NAME!==t&&(S.CUSTOM_FONT_STORAGE_KEY_NAME=t),t}function nn(){return S&&typeof S.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?S.CUSTOM_FONT_STORAGE_KEY_NAME:yf()}yf();var rt="customLogo",Jc="cameraPowerPlanner_temperatureUnit",Qc="cameraPowerPlanner_focusScale";function Xg(){if(!S)return Jc;const e=typeof S.TEMPERATURE_UNIT_STORAGE_KEY=="string"?S.TEMPERATURE_UNIT_STORAGE_KEY:Jc;if(S.TEMPERATURE_UNIT_STORAGE_KEY!==e)try{S.TEMPERATURE_UNIT_STORAGE_KEY=e}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign temperature unit storage key globally.",t);try{Object.defineProperty(S,"TEMPERATURE_UNIT_STORAGE_KEY",{configurable:!0,writable:!0,value:e})}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose temperature unit storage key globally.",r)}}return e}var lt=Xg(),Je=(function(){if(!S)return Qc;const t=typeof S.FOCUS_SCALE_STORAGE_KEY=="string"?S.FOCUS_SCALE_STORAGE_KEY:Qc;if(S.FOCUS_SCALE_STORAGE_KEY!==t)try{S.FOCUS_SCALE_STORAGE_KEY=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign focus scale storage key globally.",r)}if(S.FOCUS_SCALE_STORAGE_KEY_NAME!==t)try{S.FOCUS_SCALE_STORAGE_KEY_NAME=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose focus scale storage key globally.",r)}return t})(),Br="cameraPowerPlanner_autoGearRules",cn="cameraPowerPlanner_autoGearSeeded",ut="cameraPowerPlanner_autoGearBackups",Dt="cameraPowerPlanner_autoGearPresets",Ut="cameraPowerPlanner_autoGearMonitorDefaults",Ot="cameraPowerPlanner_autoGearActivePreset",Qe="cameraPowerPlanner_autoGearAutoPreset",pr="cameraPowerPlanner_autoGearShowBackups",Kt="cameraPowerPlanner_autoGearBackupRetention",Fe="cameraPowerPlanner_fullBackups",De="auto-backup-",_t="auto-backup-before-delete-",Xr="__cineAutoBackupRenamed",vo="__cineAutoBackupMetadata",Pn="__cineAutoBackupSnapshot",Zr=1,ec="__cineAutoBackupCompressedPayload",gf="__cineCircular__",Nr=new Map,Ns=typeof Set=="function"?new Set:null,Zg=2048;function Vt(e){return typeof e=="string"&&(e.startsWith(De)||e.startsWith(_t))}if(S&&typeof S=="object")try{Object.prototype.hasOwnProperty.call(S,"__CINE_AUTO_BACKUP_RENAMED_FLAG")||Object.defineProperty(S,"__CINE_AUTO_BACKUP_RENAMED_FLAG",{configurable:!0,writable:!1,value:Xr})}catch{try{S.__CINE_AUTO_BACKUP_RENAMED_FLAG=Xr}catch{}}var Sn=240,Xc=20,mf=36,at=1,em=120;function tm(){if(!(!S||typeof S!="object")){if(typeof S.AUTO_GEAR_BACKUP_RETENTION_DEFAULT!="number")try{S.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=mf}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention default globally.",e)}if(typeof S.AUTO_GEAR_BACKUP_RETENTION_MIN!="number")try{S.AUTO_GEAR_BACKUP_RETENTION_MIN=at}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention minimum globally.",e)}}}tm();function rm(e){return!e||typeof e!="object"?null:{version:Number.isFinite(e.version)?e.version:Zr,snapshotType:e.snapshotType==="delta"?"delta":"full",base:typeof e.base=="string"?e.base:null,sequence:Number.isFinite(e.sequence)?e.sequence:e.snapshotType==="delta"?1:0,createdAt:typeof e.createdAt=="string"?e.createdAt:null,changedKeys:Array.isArray(e.changedKeys)?e.changedKeys.slice():[],removedKeys:Array.isArray(e.removedKeys)?e.removedKeys.slice():[],payloadSignature:typeof e.payloadSignature=="string"?e.payloadSignature:null,payloadCompression:P(e.payloadCompression)?{...e.payloadCompression}:null,compressedPayload:P(e.compressedPayload)?me(e.compressedPayload,{stripMetadata:!0}):e.compressedPayload&&typeof e.compressedPayload=="string"?e.compressedPayload:null}}function mo(e,t){if(!e||typeof e!="object")return;const r=rm(t);try{Object.defineProperty(e,vo,{configurable:!0,enumerable:!1,writable:!0,value:r})}catch{try{e[vo]=r}catch{}}}function jo(e){if(!e||typeof e!="object")return null;const t=e[vo];return!t||typeof t!="object"?null:t}function nm(e,t){if(!t||typeof t!="object")return;const r=jo(e);r&&mo(t,r)}function me(e,t,r){const n=t||{},o=r||(typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),i=(s,a)=>{if(!o||!o.stack)return a();if(o.stack.has(s)){if(!o.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function")try{console.warn("Detected circular reference while cloning automatic backup data. Using a placeholder to keep serialization stable.")}catch{}return o&&(o.reportedCycle=!0),gf}o.stack.add(s);try{return a()}finally{o.stack.delete(s)}};return e===null||typeof e!="object"?e:e instanceof Date?new Date(e.getTime()):Array.isArray(e)?i(e,()=>e.map(s=>me(s,n,o))):i(e,()=>{const s={};if(Object.keys(e).forEach(a=>{n.stripMetadata&&a===vo||(s[a]=me(e[a],n,o))}),!n.stripMetadata){const a=jo(e);a&&mo(s,a)}return s})}function na(e,t){const n=me(e,t,typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),o=ue(n);return o!==n?o:n}function xn(e){return!P(e)||e[ec]!==!0?!1:typeof e.data=="string"&&e.data}function Gs(e,t,r){if(!e||typeof e!="object")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:null};const n=r||{};if(n.disableCompression)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:typeof n.payloadSignature=="string"?n.payloadSignature:null};const o=n.reportCompression!==!1;let i=null;try{i=typeof n.payloadSignature=="string"?n.payloadSignature:_e(e)}catch(y){i=null,console.warn("Unable to compute stable signature for automatic backup payload before compression",y)}const s=typeof n.existingPayloadSignature=="string"?n.existingPayloadSignature:null;if(s&&i&&s===i&&xn(n.existingCompressedPayload)){const y=me(n.existingCompressedPayload,{stripMetadata:!0}),p=P(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null;return!n.disableCompression&&typeof i=="string"&&i&&hi(i,y,p),{payload:y,compression:p,compressed:!0,reused:!0,payloadSignature:i}}if(!n.disableCompression&&typeof i=="string"&&i){const y=ef(i);if(y&&y.payload)return{payload:y.payload,compression:y.compression,compressed:!0,reused:!0,payloadSignature:i}}let a;try{a=JSON.stringify(e)}catch(y){return console.warn("Unable to serialize auto backup payload before compression",y),{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i}}if(typeof a!="string"||a.length<Zg)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};if(!n.disableCompression&&xn(n.existingCompressedPayload)){const y=Wo(n.existingCompressedPayload.data);if(y.success&&typeof y.value=="string"&&y.value===a){const p=me(n.existingCompressedPayload,{stripMetadata:!0}),d=P(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null,m=typeof i=="string"&&i?i:typeof s=="string"&&s?s:null;return m&&hi(m,p,d),{payload:p,compression:d,compressed:!0,reused:!0,payloadSignature:m}}}const c=Fn(a);if(!c||typeof c.serialized!="string")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};const l=c.originalLength-c.wrappedLength,f={[ec]:!0,data:c.serialized,originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},u=typeof c.originalLength=="number"&&Number.isFinite(c.originalLength)&&typeof c.wrappedLength=="number"&&Number.isFinite(c.wrappedLength)?{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null}:null;if(!n.disableCompression&&typeof i=="string"&&i&&hi(i,f,u),o&&typeof console<"u"&&typeof console.warn=="function"&&l>0){const y=typeof t=="string"&&t?`"${t}"`:"an automatic backup",p=c.originalLength>0?Math.round(l/c.originalLength*100):0,d=`Stored compressed payload for ${y} snapshot to reduce storage usage by ${l} characters (${p}%).`;ds("auto-backup",t||y,d,l,p)}return{payload:f,compression:{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},compressed:!0,reused:!1,payloadSignature:i}}function oa(e,t){if(!e||typeof e!="object")return{payload:e,compressed:!1};const r=e.payload;if(!xn(r))return{payload:r,compressed:!1};const n=Wo(r.data);if(!n.success||typeof n.value!="string"){const o=n&&n.error?n.error:null;throw console.warn("Unable to decompress automatic backup payload.",t,o),new Error("Failed to decompress automatic backup payload")}try{return{payload:JSON.parse(n.value),compressed:!0}}catch(o){throw console.warn("Unable to parse decompressed automatic backup payload.",t,o),o}}function ho(e,t){const r=oc(e);if(r&&Number.isFinite(r.timestamp)&&r.timestamp>0)try{return new Date(r.timestamp).toISOString()}catch{}const n=t instanceof Date?t:new Date;try{return n.toISOString()}catch{return new Date().toISOString()}}function om(e,t,r){if(!P(e)||!r||r.snapshotType!=="delta")return{cycle:!1,path:[]};const n=new Set,o=[],i=Math.max(10,Object.keys(e).length+5);let s=0,a=t,c=r;for(;c&&c.snapshotType==="delta";){if(s>i)return{cycle:!0,path:o};const l=typeof c.base=="string"?c.base:null;if(!l)return{cycle:!1,path:o};if(!Vt(l))return{cycle:!1,path:o};if(n.has(l))return o.push(l),{cycle:!0,path:o};n.add(a),o.push(a);const f=Object.prototype.hasOwnProperty.call(e,l)?e[l]:null;if(!P(f))return{cycle:!1,path:o};if(a=l,c=jo(f),!c)return{cycle:!1,path:o};s+=1}return{cycle:!1,path:o}}function im(e,t,r){if(!e||typeof e!="object")return;e.snapshotType="full",e.base=null,e.sequence=0,e.removedKeys=[];const n=P(r)?Object.keys(r):[];e.changedKeys=n.slice(),(typeof e.createdAt!="string"||!e.createdAt)&&(e.createdAt=ho(t))}function hf(e,t){if(!P(e))return e;const r={},n=new Map,o=t||{},i=typeof o.isAutoBackupKey=="function"?o.isAutoBackupKey:Vt,s=typeof o.filter=="function"?o.filter:null,a=s?l=>{let f=!1;try{f=s(l)}catch{f=!1}return f}:()=>!0,c=(l,f)=>{if(n.has(l))return n.get(l);const u=e[l],y=ms(u,l),p=y.restored?y.value:u;if(!P(p)){const g=me(p);return n.set(l,g),g}const d=p[Pn];if(d&&typeof d=="object"){if(f.has(l)){console.warn("Detected cyclic auto-backup reference while expanding snapshot",l);let E={},I=[],B=null;try{const G=oa(d,l);if(G&&P(G.payload)){E=me(G.payload),I=Object.keys(G.payload);try{B=_e(G.payload)}catch(N){B=null,console.warn("Unable to compute stable signature for automatic backup payload after detecting a cycle",N)}}}catch(G){console.warn("Failed to restore automatic backup payload after detecting a cyclic reference",l,G)}const M={version:Number.isFinite(d.version)?d.version:Zr,snapshotType:"full",base:null,sequence:Number.isFinite(d.sequence)?d.sequence:0,createdAt:typeof d.createdAt=="string"?d.createdAt:ho(l),changedKeys:I.slice(),removedKeys:[],payloadSignature:B};return xn(d.payload)?(M.compressedPayload=me(d.payload,{stripMetadata:!0}),M.payloadCompression=P(d.payloadCompression)?{...d.payloadCompression}:null):(M.compressedPayload=null,M.payloadCompression=null),mo(E,M),n.set(l,E),E}f.add(l);const g=d.snapshotType==="delta"?"delta":"full",b=g==="delta"&&typeof d.base=="string"?d.base:null,_=b?me(c(b,f)):{};let w;try{w=oa(d,l)}catch(E){throw console.warn("Failed to restore automatic backup payload while expanding snapshot",l,E),E}const h=P(w.payload)?w.payload:{},A=Array.isArray(d.changedKeys)&&d.changedKeys.length?d.changedKeys:Object.keys(h),C=Array.isArray(d.removedKeys)?d.removedKeys:[],j=me(_);A.forEach(E=>{Object.prototype.hasOwnProperty.call(h,E)&&j&&(j[E]=me(h[E]))}),C.forEach(E=>{Object.prototype.hasOwnProperty.call(j,E)&&delete j[E]});const O={version:Number.isFinite(d.version)?d.version:Zr,snapshotType:g,base:g==="delta"?b:null,sequence:Number.isFinite(d.sequence)?d.sequence:g==="delta"?1:0,createdAt:typeof d.createdAt=="string"?d.createdAt:ho(l),changedKeys:A.slice(),removedKeys:C.slice()};try{O.payloadSignature=_e(h)}catch(E){O.payloadSignature=null,console.warn("Unable to compute stable signature for automatic backup payload during expansion",E)}return xn(d.payload)?(O.compressedPayload=me(d.payload,{stripMetadata:!0}),O.payloadCompression=P(d.payloadCompression)?{...d.payloadCompression}:null):(O.compressedPayload=null,O.payloadCompression=null),mo(j,O),n.set(l,j),f.delete(l),j}const m=me(p);if(i(l)){const g={version:Zr,snapshotType:"full",base:null,sequence:0,createdAt:ho(l),changedKeys:Object.keys(m),removedKeys:[]};mo(m,g)}return n.set(l,m),m};return Object.keys(e).forEach(l=>{if(a(l)){if(!i(l)){const f=e[l];r[l]=P(f)?me(f):f;return}r[l]=c(l,new Set)}}),r}function sm(e,t){const r={},n=[],o=[],i=P(t)?Object.keys(t):[],s=P(e)?Object.keys(e):[];return new Set([...i,...s]).forEach(c=>{if(c===vo)return;const l=Object.prototype.hasOwnProperty.call(e||{},c),f=Object.prototype.hasOwnProperty.call(t||{},c);if(!l&&f){o.push(c);return}if(!l)return;const u=e?e[c]:void 0,y=f?t[c]:void 0,p=_e(u),d=_e(y);p!==d&&(n.push(c),r[c]=me(u,{stripMetadata:!0}))}),{payload:r,changedKeys:n,removedKeys:o}}function bf(e,t){if(!P(e))return e;const r=t||{},n=typeof r.isAutoBackupKey=="function"?r.isAutoBackupKey:Vt,o={},i=Object.keys(e),s=(()=>{const a=new Map;i.forEach(l=>{if(!n(l))return;const f=e[l],u=jo(f);let y=Number.NEGATIVE_INFINITY;if(u&&typeof u.createdAt=="string"){const m=Date.parse(u.createdAt);Number.isNaN(m)||(y=m)}if(!Number.isFinite(y)){const m=oc(l);m&&Number.isFinite(m.timestamp)&&(y=m.timestamp)}const p=l.startsWith(_t)?_t:De,d=a.get(p);(!d||y>d.timestamp||y===d.timestamp&&l.localeCompare(d.name)>0)&&a.set(p,{name:l,timestamp:y})});const c=new Set;return a.forEach(({name:l})=>{typeof l=="string"&&l&&c.add(l)}),c})();return i.forEach(a=>{const c=e[a],l=na(c,{stripMetadata:!0});if(!n(a)||!P(l)){o[a]=l;return}const f=s.has(a),u=jo(c);u&&u.snapshotType==="delta"&&om(e,a,u).cycle&&(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Detected cyclic automatic backup chain during serialization. Promoting to full snapshot.",a),im(u,a,l));const y=u&&typeof u.createdAt=="string"?u.createdAt:ho(a);if(!u||u.snapshotType!=="delta"){o[a]={};const h={version:Zr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(l||{}),removedKeys:[]};let A;try{A=_e(l)}catch(j){A=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",j)}const C=Gs(l,a,{disableCompression:f,payloadSignature:A,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(h.payload=C.payload,C.compression&&(h.payloadCompression=C.compression),u){const j=typeof C.payloadSignature=="string"?C.payloadSignature:A;u.payloadSignature=j||null,C.compressed?(u.compressedPayload=me(C.payload,{stripMetadata:!0}),u.payloadCompression=C.compression?{...C.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][Pn]=h;return}const p=typeof u.base=="string"?u.base:null,d=p&&Object.prototype.hasOwnProperty.call(e,p)?e[p]:null;if(!d||!P(d)){o[a]={};const h={version:Zr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(l||{}),removedKeys:[]};let A;try{A=_e(l)}catch(j){A=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",j)}const C=Gs(l,a,{disableCompression:f,payloadSignature:A,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(h.payload=C.payload,C.compression&&(h.payloadCompression=C.compression),u){const j=typeof C.payloadSignature=="string"?C.payloadSignature:A;u.payloadSignature=j||null,C.compressed?(u.compressedPayload=me(C.payload,{stripMetadata:!0}),u.payloadCompression=C.compression?{...C.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][Pn]=h;return}const m=na(d,{stripMetadata:!0}),g=sm(l,m);o[a]={};const b={version:Number.isFinite(u.version)?u.version:Zr,snapshotType:"delta",base:p,sequence:Number.isFinite(u.sequence)?u.sequence:1,createdAt:y,changedKeys:g.changedKeys,removedKeys:g.removedKeys};let _;try{_=_e(g.payload)}catch(h){_=null,console.warn("Unable to compute stable signature for automatic backup delta payload before serialization",h)}const w=Gs(g.payload,a,{disableCompression:f,payloadSignature:_,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(b.payload=w.payload,w.compression&&(b.payloadCompression=w.compression),u){const h=typeof w.payloadSignature=="string"?w.payloadSignature:_;u.payloadSignature=h||null,w.compressed?(u.compressedPayload=me(w.payload,{stripMetadata:!0}),u.payloadCompression=w.compression?{...w.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][Pn]=b}),o}function Pt(e){if(typeof e!="string"||!e)return[e];const t=new Set([e]);return e.startsWith("cameraPowerPlanner_")?t.add(`cinePowerPlanner_${e.slice(19)}`):e.startsWith("cinePowerPlanner_")&&t.add(`cameraPowerPlanner_${e.slice(17)}`),Array.from(t)}var kn=new Set(Pt(pt));function am(){return(!ni||typeof ni.has!="function")&&(ni=new Set(Pt(Ze))),ni}function Sf(e){if(typeof e!="string"||!e)return!1;const t=am();return t&&typeof t.has=="function"?t.has(e):e===Ze}function cm(e){return!(typeof e!="string"||!e||!kn||typeof kn.has!="function"||!kn.has(e)||xt)}function lm(e,t){if(!e||typeof e.getItem!="function"||!kn||typeof kn.forEach!="function")return;const r=new Set,n=t&&typeof t.has=="function"?t:null;kn.forEach(o=>{if(!(typeof o!="string"||!o||r.has(o))&&(r.add(o),!(n&&n.has(o))))try{e.getItem(o)}catch{}})}var he="__backup",um=3,fm=100,ln="__legacyMigrationBackup",Lt=new Set([nn(),rt,dt,tt,Gt,Lr,bi,Je,Re]);Array.from(Lt).forEach(e=>{Pt(e).forEach(t=>{typeof t=="string"&&t&&Lt.add(t)})});var Zc=[()=>({key:Ze}),()=>({key:pt}),()=>({key:er}),()=>({key:Mr}),()=>({key:pe,valueProvider:()=>{if(typeof kt=="function")try{const{projects:e}=kt({forMutation:!1});if(e&&typeof e=="object")return JSON.stringify(e)}catch(e){typeof console<"u"&&console.warn&&console.warn("Failed to reconstruct monolithic project backup",e)}return null}}),()=>({key:et}),()=>({key:tt}),()=>({key:Gt}),()=>({key:Lr}),()=>({key:dt}),()=>({key:Br}),()=>({key:cn}),()=>({key:ut}),()=>({key:Dt}),()=>({key:Ot}),()=>({key:Qe}),()=>({key:pr}),()=>({key:Kt}),()=>({key:Ut}),()=>({key:Fe}),()=>({key:rt}),()=>({key:nn()}),()=>({key:"darkMode"}),()=>({key:"pinkMode"}),()=>({key:"highContrast"}),()=>({key:"reduceMotion"}),()=>({key:"relaxedSpacing"}),()=>({key:"showAutoBackups"}),()=>({key:"accentColor"}),()=>({key:"fontSize"}),()=>({key:"fontFamily"}),()=>({key:"language"}),()=>({key:"iosPwaHelpShown"}),()=>({key:Re}),()=>({key:lt}),()=>({key:Ft(),backupKey:df()})];function pm(e,t={}){if(!e||typeof e!="object")return null;const{key:r,backupKey:n,storage:o=null}=e;if(typeof r!="string"||!r)return null;const i=typeof n=="string"&&n?n:`${r}${he}`;return{key:r,backupKey:i,storage:o,label:typeof t.label=="string"?t.label:r,valueProvider:typeof e.valueProvider=="function"?e.valueProvider:null}}function dm(e={}){const t=[],r=new Set,n=i=>{if(!i)return;const s=Pt(i.key),a=`${i.key}${he}`;for(let c=0;c<s.length;c+=1){const l=s[c];if(typeof l!="string"||!l)continue;let f=i.backupKey;l!==i.key&&i.backupKey===a&&(f=`${l}${he}`);const u=l===i.key?i:{...i,key:l,backupKey:f},y=u.storage||null,p=`${u.key}__${y?String(y):"default"}`;r.has(p)||(r.add(p),t.push(u))}};for(let i=0;i<Zc.length;i+=1){const s=Zc[i];if(typeof s!="function")continue;let a;try{a=s(e)}catch(l){var o={event:"critical-storage",action:"collect-keys",reason:"provider-error",storageType:Cr(e&&e.storage?e.storage:null),error:mn(l)};_r("warn","Critical storage key provider failed",o,{event:"critical-storage",stage:"gather"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage key provider failed",l)});continue}const c=pm(a,e);c&&n(c)}return t}let wf=null;function ym(e){if(wf=e,!(!S||typeof S!="object"))try{S.__cineCriticalStorageGuard=e}catch{try{Object.defineProperty(S,"__cineCriticalStorageGuard",{configurable:!0,writable:!0,value:e})}catch{}}}function gm(e={}){let t=e&&e.storage?e.storage:null;if(!t)try{t=T()}catch(f){var r={event:"critical-storage",action:"resolve-storage",reason:"resolve-failed",storageType:Cr(e&&e.storage?e.storage:null),error:mn(f)};_r("warn","Unable to resolve safe storage while ensuring backups",r,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve safe storage while ensuring backups",f)}),t=null}const n={ensured:[],skipped:[],errors:[],timestamp:new Date().toISOString(),storageType:D&&D.type?D.type:"unknown"},o=dm(e),i=t&&typeof t.getItem=="function"?t:null;for(let f=0;f<o.length;f+=1){const u=o[f],y=u.storage&&typeof u.storage.getItem=="function"?u.storage:i;if(!y||typeof y.getItem!="function"||typeof y.setItem!="function"){n.skipped.push({key:u.key,reason:"unavailable-storage"});continue}let p;try{u.valueProvider?p=u.valueProvider():p=y.getItem(u.key)}catch(C){n.errors.push({key:u.key,reason:"read-failed",error:C});var s={event:"critical-storage",action:"inspect-primary",key:u.key,storageType:Cr(y),reason:"read-failed",error:mn(C)};_r("warn","Critical storage guard could not inspect "+u.key,s,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not inspect "+u.key,C)});continue}if(p==null){n.skipped.push({key:u.key,reason:"missing"});continue}let d;try{d=y.getItem(u.backupKey)}catch(C){n.errors.push({key:u.key,reason:"backup-read-failed",error:C});var a={event:"critical-storage",action:"inspect-backup",key:u.key,backupKey:u.backupKey,storageType:Cr(y),reason:"backup-read-failed",error:mn(C)};_r("warn","Critical storage guard could not read backup for "+u.key,a,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not read backup for "+u.key,C)});continue}if(typeof d=="string"){n.skipped.push({key:u.key,reason:"exists"});continue}const m=typeof p=="string"?p:p==null?"":String(p),g=C=>{try{return y.setItem(u.backupKey,C),{success:!0,error:null}}catch(j){return{success:!1,error:j}}},b=(C,j="backup-write-failed")=>{n.errors.push({key:u.key,reason:j,error:C});var O={event:"critical-storage",action:"mirror-backup",key:u.key,backupKey:u.backupKey,storageType:Cr(y),reason:j,error:mn(C)};h&&(O.compressed=!0),_r("error","Critical storage guard could not mirror "+u.key,O,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.error=="function"&&console.error("Critical storage guard could not mirror "+u.key,C)})},_=typeof m=="string"&&m&&!m.includes(`"${dr}":true`)&&!Sf(u.key);let w=m,h=null,A=g(w);if(!A.success&&A.error){if(!Tt(A.error)){b(A.error);continue}if(_){const C=Fn(m);C&&typeof C.serialized=="string"&&C.serialized&&(w=C.serialized,h=C,A=g(w))}if(!A.success&&A.error&&Tt(A.error)){const C=new Set;typeof u.backupKey=="string"&&u.backupKey&&C.add(u.backupKey);const j=cm(u.key);!j&&typeof u.key=="string"&&u.key&&C.add(u.key),!j&&!xt&&lm(y,C);const O=Pf(y,{skipKeys:Array.from(C)});O&&O.success&&(A=g(w))}if(!A.success){b(A.error,Tt(A.error)?"backup-quota-exceeded":"backup-write-failed"),Tt(A.error)&&ce("critical-backup-quota");continue}}if(n.ensured.push({key:u.key,backupKey:u.backupKey,compressed:!!h}),h&&typeof h.originalLength=="number"&&typeof h.wrappedLength=="number"){const C=h.originalLength-h.wrappedLength,j=h.originalLength>0?Math.round(C/h.originalLength*100):0,O=`Stored compressed critical backup for ${u.key}, reducing storage usage by ${C} characters (${j}%).`;ds("critical-backup",u.key,O,C,j)}}if(ym(n),n.ensured.length){var c={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||Cr(),count:n.ensured.length,timestamp:n.timestamp,entries:n.ensured.map(function(u){return{key:u.key,backupKey:u.backupKey,compressed:!!u.compressed}})};_r("info","Critical storage guard mirrored backup copies",c,{event:"critical-storage",stage:"ensure"},function(){if(typeof console<"u"&&typeof console.info=="function"){const u=n.ensured.map(y=>({key:y.key,backupKey:y.backupKey}));console.info("Critical storage guard mirrored backup copies",{count:n.ensured.length,entries:u})}})}if(n.errors.length){var l={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||Cr(),count:n.errors.length,timestamp:n.timestamp,reason:"errors-detected",entries:n.errors.map(function(u){return{key:u&&u.key,reason:u&&u.reason,error:mn(u&&u.error)}})};_r("warn","Critical storage guard encountered issues",l,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard encountered issues",n.errors)})}return n}function mm(){return wf}var hm=10,Ef="lz-string",Af="json-string",ys=[{variant:"utf16",compress:"compressToUTF16",decompress:"decompressFromUTF16"},{variant:"uri-component",compress:"compressToEncodedURIComponent",decompress:"decompressFromEncodedURIComponent"},{variant:"base64",compress:"compressToBase64",decompress:"decompressFromBase64"}],dr="__cineStorageCompressed",Ui=1,Io="lz-string",el="lz-string-utf16",Of=ys,on="camera-power-planner:storage-compression",bm=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(Io):'"'.concat(String(Io),'"'),Sm=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(on):'"'.concat(String(on),'"'),tl=Kg(),dn=typeof WeakSet=="function"?new WeakSet:null,wm=40,Em=128,Gr="__cineRawGetItem",Am=1024,Om=256,Cm=.08;function gs(e){if(!Array.isArray(e)||!e.length)return[];var t=Cn;if(!t)return[];var r=xg(e),n=Fg(r,t);if(n!=null)return n;for(var o=[],i=0;i<e.length;i+=1){var s=e[i];if(s){var a=typeof t[s.compress]=="function"?t[s.compress]:null,c=typeof t[s.decompress]=="function"?t[s.decompress]:null,l=null,f=0;if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{l=JSON.stringify(String(s.variant||"")),typeof l=="string"&&l?f=l.length:(l=null,f=0)}catch{l=null,f=0}a&&c&&o.push({variant:s.variant,compress:a,decompress:c,variantLiteral:f>0?l:null,variantLiteralLength:f})}}var u=o.length?o.slice():[];return r&&Ug(r,t,u),u}function Cf(e,t,r,n){if(typeof e!="string"||!e)return{success:!1};var o=gs(t);if(!o.length)return{success:!1};var i=[];if(r){for(var s=null,a=0;a<o.length;a+=1)if(o[a].variant===r){s=o[a];break}s?i.push(s):typeof console<"u"&&typeof console.warn=="function"&&console.warn("Compression variant ".concat(r," is unavailable while reading ").concat(n||"compressed payload","."))}for(var c=0;c<o.length;c+=1)(!r||o[c].variant!==r)&&i.push(o[c]);for(var l=null,f=0;f<i.length;f+=1){var u=i[f];try{var y=u.decompress(e);if(typeof y=="string"&&y)return{success:!0,value:y,variant:u.variant}}catch(p){l=p,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decompress ".concat(n||"compressed payload"," with ").concat(u.variant," variant"),p)}}return{success:!1,error:l}}function tc(){return gs(ys).length>0}function _m(e,t){if(typeof e!="string"||!e||!tc())return null;var r=sf(qc,e);if(r.hit)return r.candidate;var n=null,o=gs(ys);if(!o.length)return null;for(var i=0;i<o.length;i+=1){var s=o[i],a=null;try{a=s.compress(e)}catch(f){console.warn("Unable to compress migration backup payload with ".concat(s.variant," variant"),f);continue}if(!(typeof a!="string"||!a||a.length>=e.length)){var c={createdAt:t,compression:Ef,compressionVariant:s.variant,encoding:Af,data:a,originalSize:e.length,compressedSize:a.length},l;try{l=JSON.stringify(c)}catch(f){console.warn("Unable to serialize compressed migration backup payload",f);continue}typeof l!="string"||!l||l.length>=e.length||(!n||l.length<n.serializedLength)&&(n={serialized:l,serializedLength:l.length,originalSize:e.length,compressedSize:a.length,variant:s.variant})}}return af(qc,e,n),n}function Pm(e){if(typeof e!="string"||!e)return{createdAt:0,size:typeof e=="string"?e.length:0};const t={createdAt:0,size:e.length};try{const r=JSON.parse(e);if(r&&typeof r=="object"){let n=null;if(typeof r.createdAt=="string"?n=r.createdAt.trim():typeof r.createdAt=="number"&&Number.isFinite(r.createdAt)&&(t.createdAt=r.createdAt),n){const o=Date.parse(n);Number.isNaN(o)||(t.createdAt=o)}else for(let o=0;o<Ki.length;o+=1){const i=Ki[o];if(typeof r[i]=="string"){const s=r[i].trim();if(s){const a=Date.parse(s);if(!Number.isNaN(a)){t.createdAt=a;break}}}else if(typeof r[i]=="number"&&Number.isFinite(r[i])){t.createdAt=r[i];break}}}}catch{}return t}function _f(){return tc()}function Fn(e){if(typeof e!="string"||!e||!_f())return null;var t=sf(Hc,e);if(t.hit)return t.candidate;var r=gs(Of);if(!r.length)return null;for(var n=typeof tl=="number"?tl:0,o=null,i=null,s=null,a=null,c=String(e.length).length,l=0;l<r.length;l+=1){var f=r[l],u=null;try{u=f.compress(e)}catch(A){console.warn("Unable to compress storage payload with ".concat(f.variant," variant"),A);continue}if(!(typeof u!="string"||!u)){var y;try{y=JSON.stringify(u)}catch(A){console.warn("Unable to serialize compressed storage payload candidate",A);continue}if(!(typeof y!="string"||!y)){var p=typeof f.variantLiteral=="string"&&f.variantLiteral?f.variantLiteral:null,d=typeof f.variantLiteralLength=="number"&&f.variantLiteralLength>0?f.variantLiteralLength:0;if(!p&&typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{p=JSON.stringify(String(f.variant||"")),d=typeof p=="string"&&p?p.length:0}catch{p=null,d=0}var m=null,g=Number.POSITIVE_INFINITY;if(n>0&&d>0){var b=String(u.length).length;g=n+y.length+c+b+d}else{var _={[dr]:!0,version:Ui,algorithm:Io,namespace:on,data:u,originalLength:e.length,compressedPayloadLength:u.length,compressionVariant:f.variant};try{m=JSON.stringify(_)}catch(A){console.warn("Unable to serialize compressed storage payload wrapper",A);continue}if(typeof m!="string"||!m)continue;g=m.length}g<e.length&&(!o||g<o.wrappedLength)&&(o={originalLength:e.length,wrappedLength:g,compressedPayloadLength:u.length,compressionVariant:f.variant},i=m,s=y,a=p)}}}if(o&&(!i||typeof i!="string"))if(typeof s!="string"||!s)o=null;else{var w;if(typeof a=="string"&&a)w=a;else if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{w=JSON.stringify(String(o.compressionVariant||""))}catch{w=null}if(typeof w!="string"||!w)o=null;else{var h='{"'.concat(dr,'":true,"version":').concat(String(Ui),',"algorithm":').concat(bm,',"namespace":').concat(Sm,',"data":').concat(s,',"originalLength":').concat(String(o.originalLength),',"compressedPayloadLength":').concat(String(o.compressedPayloadLength),',"compressionVariant":').concat(w,"}");i=h}}return o&&i&&typeof i=="string"&&i.length<o.originalLength?(o.serialized=i,o.wrappedLength=i.length):o=null,af(Hc,e,o),o}function Wo(e){if(typeof e!="string")return{success:!1};if(!e||e.charCodeAt(0)!==123)return{success:!1};if(!e.includes(`"${dr}":true`)||!e.includes(`"namespace":"${on}`))return{success:!1};let t;try{t=JSON.parse(e)}catch(o){return{success:!1,error:o}}if(!t||t[dr]!==!0)return{success:!1};if(t.namespace!==on)return{success:!1};if(t.version!==Ui)return console.warn("Unsupported storage compression version",t.version),{success:!1};if(t.algorithm!==Io&&t.algorithm!==el)return console.warn("Unsupported storage compression algorithm",t.algorithm),{success:!1};if(typeof t.data!="string"||!t.data)return{success:!1};if(!_f())return console.warn("Compressed storage payload detected but compression library is unavailable."),{success:!1};var r=null;typeof t.compressionVariant=="string"&&t.compressionVariant?r=t.compressionVariant:t.algorithm===el&&(r="utf16");var n=Cf(t.data,Of,r,"storage payload");return n.success?(!t.compressionVariant&&n.variant&&(t.compressionVariant=n.variant),{success:!0,value:n.value,metadata:t}):{success:!1,error:n.error}}function ms(e,t){if(typeof e=="string"){const r=Wo(e);if(!r.success||typeof r.value!="string")return{restored:!1,value:e};try{return{restored:!0,value:JSON.parse(r.value)}}catch(n){return console.warn("Unable to parse decompressed project entry payload",t||"project entry",n),{restored:!1,value:e}}}if(P(e)&&e[dr]===!0){let r;try{r=JSON.stringify(e)}catch(n){return console.warn("Unable to reserialize compressed project entry wrapper before restoration",t||"project entry",n),{restored:!1,value:e}}if(typeof r=="string"&&r)return ms(r,t)}return{restored:!1,value:e}}function hs(e,t){if(typeof e!="string")return;const r=typeof t=="number"&&Number.isFinite(t)?t:Date.now(),n=Be(e);if(n){Nr.set(n,r),n!==e&&Nr.set(e,r);return}Nr.set(e,r)}function km(e,t){if(!e||typeof e!="object")return;const r=Date.now();Object.keys(e).forEach(n=>{typeof n!="string"||!n||Vt(n)||hs(n,r)})}function ia(e){if(typeof e!="string")return;const t=Be(e);Nr.delete(e),t&&t!==e&&Nr.delete(t)}function vm(e){if(typeof e!="string")return"";const t=Be(e);return typeof t=="string"&&t?t:""}function jm(e){if(!Ns||typeof Ns.has!="function")return!1;const t=vm(e);if(!t)return!1;try{return Ns.has(t)}catch{}return!1}function Im(e,t){const r=ms(e,t);return r.restored?r.value:e}function Lm(e){return P(e)&&Object.keys(e).forEach(t=>{e[t]=Im(e[t],t)}),e}function Rm(e){if(!e||typeof e.add!="function")return;const t=[pe,`${pe}${he}`,pt,`${pt}${he}`];for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&e.add(n)}}function Tm(e){if(!e||typeof e.add!="function")return;const t=[tt,Gt,ct,Ze];for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n!="string"||!n)continue;const o=Pt(n);for(let i=0;i<o.length;i+=1){const s=o[i];typeof s!="string"||!s||(e.add(s),e.add(`${s}${he}`))}}}function un(e,t){if(typeof e!="string")return e;const r=Wo(e);return r.success?r.value:e}function Pf(e,t){if(!e||typeof e.length!="number"||typeof e.key!="function")return{success:!1,compressed:0,freed:0};if(Nf(e))return{success:!1,compressed:0,freed:0};const{skipKeys:r=[],limit:n=wm,minSavings:o=Em}=t||{},i=new Set;if(xt&&rr&&i.add(rr),xt&&Rm(i),Tm(i),Array.isArray(r))for(let y=0;y<r.length;y+=1){const p=r[y];typeof p=="string"&&p&&i.add(p)}const s=typeof o=="number"&&o>0?o:0,a=e.length,c=[];for(let y=0;y<a;y+=1){let p;try{p=e.key(y)}catch{p=null}if(typeof p!="string"||!p||i.has(p))continue;let d;try{d=e.getItem(p)}catch{continue}if(typeof d!="string"||!d||d.includes(`"${dr}":true`))continue;const m=Fn(d);if(!m||typeof m.serialized!="string"||!m.serialized)continue;const g=typeof m.originalLength=="number"&&typeof m.wrappedLength=="number"?m.originalLength-m.wrappedLength:0;g<s||c.push({key:p,serialized:m.serialized,savings:g>0?g:0,originalLength:typeof m.originalLength=="number"?m.originalLength:0})}if(!c.length)return{success:!1,compressed:0,freed:0};c.sort((y,p)=>p.savings!==y.savings?p.savings-y.savings:p.originalLength-y.originalLength);const l=typeof n=="number"&&n>0?Math.min(n,c.length):c.length;let f=0,u=0;for(let y=0;y<c.length&&f<l;y+=1){const p=c[y];if(!(!p||typeof p.serialized!="string"||!p.serialized))try{e.setItem(p.key,p.serialized),f+=1,u+=p.savings}catch{}}return f===0?{success:!1,compressed:0,freed:0}:(typeof console<"u"&&typeof console.warn=="function"&&(u>0?console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery, freeing approximately ${u} characters.`):console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery.`)),{success:!0,compressed:f,freed:u})}function nr(e){return e==null?e:un(e)}function rl(e){if(!e||typeof e.getItem!="function"||dn&&typeof dn.has=="function"&&dn.has(e))return;const t=e.getItem,r=typeof t=="function"?function(i){return t.call(this,i)}:null,n=function(i){const s=r?r.call(this,i):void 0;return un(s)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(o){const i=o&&typeof o.message=="string"&&o.message.includes("Cannot redefine property");i||console.warn("Unable to redefine storage.getItem descriptor for compression support",o);try{e.getItem=n}catch(s){const a=s&&typeof s.message=="string"&&s.message.includes("Cannot assign to read only property");return a||console.warn("Unable to patch storage instance getItem for compression support",s),void 0}}if(r)try{Object.defineProperty(e,Gr,{configurable:!0,writable:!0,value:r})}catch{try{e[Gr]=r}catch{}}if(dn&&typeof dn.add=="function")try{dn.add(e)}catch{}}function Mm(){if(typeof Storage>"u"){const i=[];S&&typeof S=="object"&&(S.localStorage&&i.push(S.localStorage),S.sessionStorage&&i.push(S.sessionStorage)),typeof global<"u"&&global&&global!==S&&(global.localStorage&&i.push(global.localStorage),global.sessionStorage&&i.push(global.sessionStorage)),i.forEach(rl);return}const e=Storage.prototype;if(!e||typeof e.getItem!="function"||e.__cineStorageCompressionPatched)return;const t=e.getItem,r=function(s){return t.call(this,s)},n=function(s){const a=r.call(this,s);return un(a)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(i){console.warn("Unable to patch Storage.getItem for compression support",i);return}try{Object.defineProperty(e,Gr,{configurable:!0,writable:!1,value:r})}catch{try{e[Gr]=r}catch{}}try{Object.defineProperty(e,"__cineStorageCompressionPatched",{configurable:!0,writable:!1,value:!0})}catch{e.__cineStorageCompressionPatched=!0}const o=[];S&&typeof S=="object"&&(S.localStorage&&o.push(S.localStorage),S.sessionStorage&&o.push(S.sessionStorage)),typeof global<"u"&&global&&global!==S&&(global.localStorage&&o.push(global.localStorage),global.sessionStorage&&o.push(global.sessionStorage)),o.forEach(rl)}function rc(e){if(!e||typeof e!="object")return null;const t=e[Gr];if(typeof t=="function")return t;const r=Object.getPrototypeOf(e);return r&&typeof r[Gr]=="function"?r[Gr]:null}function uo(e,t,r){if(!e||typeof t!="string"||!t)return null;const n=typeof r=="function"?r:rc(e);if(typeof n!="function")return null;try{return n.call(e,t)}catch{return null}}function Nm(e,t){if(!e)return[];let r;try{r=nc(e,{suppressAlerts:!0})}catch(n){return console.warn("Unable to inspect storage while preparing migration backup cleanup",n),[]}return!r||typeof r!="object"?[]:Object.keys(r).filter(n=>!(typeof n!="string"||!n||!n.endsWith(ln)||t&&n===t)).map(n=>{const o=r[n],i=typeof o=="string"?o:o==null?"":String(o),s=Pm(i);return{key:n,createdAt:s.createdAt,size:s.size}}).sort((n,o)=>n.createdAt&&o.createdAt&&n.createdAt!==o.createdAt?n.createdAt-o.createdAt:n.createdAt&&!o.createdAt?-1:!n.createdAt&&o.createdAt?1:n.size!==o.size?o.size-n.size:n.key.localeCompare(o.key))}function kf(e,t){const r=Nm(e,t);if(!r.length)return[];const n=[],o=r[0];try{e.removeItem(o.key),n.push(o.key)}catch(i){console.warn(`Unable to remove migration backup ${o.key} during cleanup`,i)}return n}function nl(e,t,r,n){if(!e||typeof e.setItem!="function")return{success:!1,error:null};const o=[];let i=null;if(typeof n!="function")return{success:!1,error:null};const s=()=>{const a=n();return a&&typeof a=="object"&&"error"in a&&a.error&&(i=a.error),a&&a.success?{success:!0,quota:!1}:a&&a.quota?{success:!1,quota:!0,error:a.error||null}:{success:!1,quota:!1,error:a&&a.error?a.error:null}};if(typeof sn=="function"){let a=!1;try{sn(),a=!0}catch(c){console.warn("Unable to clear cached UI storage entries before creating migration backup",c)}if(a){const c=s();if(c.success)return console.warn(`Cleared cached planner data to free storage before creating migration backup for ${t}.`),{success:!0,error:null};if(!c.quota)return{success:!1,error:c.error}}}for(let a=0;a<hm;a+=1){const c=kf(e,r);if(!c.length)break;o.push(...c);const l=s();if(l.success)return console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} to free up storage before creating migration backup for ${t}.`,o),{success:!0,error:null};if(!l.quota)return{success:!1,error:l.error}}return o.length>0&&console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} while attempting to create migration backup for ${t}, but storage quota is still exceeded.`,o),{success:!1,error:i}}function qe(e,t){if(!e||typeof e.getItem!="function"||!t)return null;let r=null;try{r=e.getItem(t)}catch(i){return console.warn(`Unable to inspect existing value for ${t} before creating migration backup`,i),null}if(r==null)return null;let n=r,o=r;if(typeof r=="string"&&r)if(o=un(r),typeof o=="string"&&o)try{n=JSON.parse(o)}catch{}else n=o;return n&&typeof n=="object"&&(Array.isArray(n)&&n.length===0||!Array.isArray(n)&&Object.keys(n).length===0)||yt(e,t,n),n}var ol=["payload","value","content","entries","snapshot","state","record"],Ki=["iso","timestamp","time"];function oi(e){try{return JSON.stringify(e)}catch(t){return console.warn("Unable to serialize normalized migration backup payload",t),null}}function il(e,t){const r=typeof t=="string"&&t?t:null;if(typeof e=="string"){const o=e.trim();if(!o)return{value:r||new Date().toISOString(),changed:!0};const i=Number(o);if(!Number.isNaN(i)&&Number.isFinite(i)&&String(i)===o)try{return{value:new Date(i).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}const s=Date.parse(o);if(!Number.isNaN(s))try{const a=new Date(s).toISOString();return{value:a,changed:a!==o}}catch{return{value:r||new Date().toISOString(),changed:!0}}return{value:o,changed:o!==e}}if(typeof e=="number"&&Number.isFinite(e))try{return{value:new Date(e).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}if(e instanceof Date){const o=e.getTime();if(Number.isFinite(o))try{return{value:e.toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}}return r?{value:r,changed:!0}:{value:new Date().toISOString(),changed:!0}}function Gm(e,t){if(typeof e!="string"||!e)return null;const r=typeof t=="string"&&t?t:new Date().toISOString();let n;try{n=JSON.parse(e)}catch{return oi({createdAt:r,data:e})}if(!n||typeof n!="object")return oi({createdAt:r,data:n===void 0?e:n});if(Array.isArray(n)){let f=!1;const u=n.map(y=>{if(!y||typeof y!="object")return f=!0,{createdAt:r,data:y};const p=Object.prototype.hasOwnProperty.call(y,"data"),d=y.createdAt,{value:m,changed:g}=il(d,r);return p?g||d!==m?(f=!0,{...y,createdAt:m}):y:(f=!0,{createdAt:m,data:y})});return f?oi(u):null}let o,i=!1;if(Object.prototype.hasOwnProperty.call(n,"data"))o={...n};else{let f=null;for(let u=0;u<ol.length;u+=1){const y=ol[u];if(Object.prototype.hasOwnProperty.call(n,y)){f=y;break}}f?(o={...n},o.data=n[f],delete o[f],i=!0):(o={data:n},i=!0)}let s=o.createdAt,a="createdAt";if(s===void 0)for(let f=0;f<Ki.length;f+=1){const u=Ki[f];if(Object.prototype.hasOwnProperty.call(n,u)){s=n[u],a=u;break}}const{value:c,changed:l}=il(s,r);return o.createdAt=c,a!=="createdAt"&&a&&Object.prototype.hasOwnProperty.call(o,a)&&(delete o[a],i=!0),l&&(i=!0),i?oi(o):null}function zm(e,t,r,n){const o=Gm(r,n);if(o===null)return!0;if(typeof o!="string"||!o)return!1;if(o===r)return!0;try{return e.setItem(t,o),!0}catch(i){return console.warn(`Unable to normalize legacy migration backup for ${t}`,i),!1}}function yt(e,t,r){if(!e||typeof e.setItem!="function"||r==null)return;const n=`${t}${ln}`;let o=!1;if(typeof e.getItem=="function")try{const d=e.getItem(n);if(d!=null){o=!0;const m=new Date().toISOString();zm(e,n,d,m)}}catch(d){console.warn(`Unable to inspect migration backup for ${t}`,d)}if(o)try{const d=e.getItem(n),m=nr(d);let g=null;try{g=JSON.parse(m)}catch(C){g=m}let b=Array.isArray(g)?g:[g];const _={createdAt:new Date().toISOString(),data:r};b.push(_);const w=5;b.length>w&&(b=b.slice(b.length-w));const h=C=>{try{return e.setItem(n,JSON.stringify(C)),{success:!0}}catch(j){return{success:!1,quota:Tt(j),error:j}}};let A=h(b);for(;!A.success&&A.quota&&b.length>1;)b.shift(),console.warn(`Pruning oldest migration backup for ${t} due to quota limit.`),A=h(b);if(A.success)return;if(!A.success&&A.quota){const C=nl(e,t,n,()=>h(b));if(C&&C.success)return}console.warn("Unable to append to migration backup",A.error);return}catch(d){console.warn("Unable to append to migration backup",d);return}let i;const s=new Date().toISOString();try{i=JSON.stringify({createdAt:s,data:r})}catch(d){console.warn(`Unable to serialize migration backup for ${t}`,d);return}const a=(d,m={})=>{const{logCompression:g=!1,info:b=null}=m||{};try{if(e.setItem(n,d.serialized),g&&b&&!a.compressionLogged){a.compressionLogged=!0;const _=typeof b.serializedLength=="number"?b.serializedLength:b.compressedSize,w=b.originalSize-_,h=w>0?w:0,A=b.originalSize>0?Math.round(h/b.originalSize*100):0,C=`Stored compressed migration backup for ${t} to reduce storage usage by ${h} characters (${A}%) using ${b.variant||"unknown"} variant.`;ds("migration-backup",t,C,h,A)}return{success:!0,quota:!1}}catch(_){return{success:!1,quota:Tt(_),error:_}}};a.compressionLogged=a.compressionLogged||!1;const c={serialized:i},l=a(c);if(l.success)return;const f=d=>{console.warn(`Unable to create migration backup for ${t}`,d)};if(!l.quota){f(l.error);return}const y=!Sf(t)?_m(i,s):null,p=(d,m,g)=>{const b=nl(e,t,n,()=>a(d,m));if(b&&b.success)return!0;const _=b&&b.error?b.error:g;return f(_),ce("migration-backup-quota"),!1};if(y){const d=a(y,{logCompression:!0,info:y});if(d.success)return;if(!d.quota){f(d.error);return}return p(y,{logCompression:!0,info:y},d.error),void 0}p(c,{},l.error)}var sl=[Ze,pt,er,Mr,pe,et,dt,Br,cn,ut,Dt,Ot,Qe,pr,Ut,Kt,Fe],al=[rt,nn(),"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",zt,lt],vn="__cameraPowerPlannerStorageAlertShown",Si="__cameraPowerPlannerSessionFallbackAlertShown",wi=!1;S&&(typeof S[vn]=="boolean"?wi=S[vn]:S[vn]=!1);var sa=!1;S&&(typeof S[Si]=="boolean"?sa=S[Si]:S[Si]=!1);var Bm=["cameras","monitors","video","viewfinders","directorMonitors","iosVideo","videoAssist","media","lenses","batteries","batteryHotswaps","wirelessReceivers"],xm=["motors","handUnits","controllers","distance"],Fm=["chargers","cages","powerPlates","cameraSupport","matteboxes","filters","rigging","batteries","cables","videoAssist","media","cardReaders","tripodHeads","tripods","sliders","cameraStabiliser","grip","carts"],Dm=()=>typeof navigator<"u"&&navigator&&typeof navigator.storage=="object"?navigator.storage:null,cl="__storage_test__",Um=new Set(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"]),Km=new Set([22,1014]),$m=new Set([22,1014]);function Tt(e){return!e||typeof e!="object"?!1:!!(typeof e.code=="number"&&Km.has(e.code)||typeof e.number=="number"&&$m.has(e.number)||typeof e.name=="string"&&Um.has(e.name))}function Vm(e){if(!e)return!1;try{if(typeof e.length=="number"&&e.length>0)return!0}catch(t){console.warn("Unable to read storage length after quota error",t)}if(typeof e.getItem=="function")try{for(let t=0;t<sl.length;t+=1){const r=sl[t],n=Pt(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;const s=`${i}${he}`;if(e.getItem(s)!==null)return!0}}for(let t=0;t<al.length;t+=1){const r=al[t],n=Pt(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;if(Lt.has(i)){const s=`${i}${he}`;if(e.getItem(s)!==null)return!0}}}}catch(t){console.warn("Unable to inspect known storage keys after quota error",t)}if(typeof e.key=="function")try{const t=typeof e.length=="number"?e.length:0;for(let r=0;r<t;r+=1){const n=e.key(r);if(typeof n=="string"&&n)return!0}}catch(t){console.warn("Unable to iterate storage keys after quota error",t)}return!1}function $i(e){if(!e)return null;try{e.setItem(cl,"1")}catch(t){if(Tt(t)&&Vm(e))return console.warn("localStorage quota exceeded. Existing planner data will remain available but new saves may fail.",t),e;throw t}try{e.removeItem(cl)}catch(t){console.warn("Unable to clean up storage test key",t)}return e}function vf(){let e={};return{get length(){return Object.keys(e).length},key(t){const r=Object.keys(e);return t>=0&&t<r.length?r[t]:null},getItem(t){return Object.prototype.hasOwnProperty.call(e,t)?un(e[t]):null},setItem(t,r){e[t]=String(r)},removeItem(t){delete e[t]},clear(){e={}},keys(){return Object.keys(e)}}}function jf(){const e=Ju();for(let t=0;t<e.length;t+=1){const r=e[t];if(r)try{const n=$i(r);if(n)return jr=null,{storage:n,type:"local"}}catch(n){console.warn("localStorage is unavailable:",n),jr=r}}if(typeof window<"u")try{if("sessionStorage"in window){const t=$i(window.sessionStorage);if(t)return Jr(t),console.warn("Falling back to sessionStorage; data persists for this tab only."),Mf(),{storage:t,type:"session"}}}catch(t){console.warn("sessionStorage fallback is unavailable:",t)}return ce(),{storage:vf(),type:"memory"}}var jr=null,D=jf();function Hm(e,t){const r=[],n=[];return!e||!t||typeof t.setItem!="function"?{migratedKeys:r,failedKeys:n}:(Object.keys(e).forEach(o=>{const i=e[o];if(i==null)return;let s=null,a=!1;try{s=t.getItem(o),a=!0}catch(c){console.warn("Unable to inspect localStorage during upgrade",o,c)}if(a&&s!==null&&s!==void 0&&s!==i&&yt(t,o,s),a&&s===i){r.push(o);return}try{t.setItem(o,i),r.push(o)}catch(c){console.warn("Unable to migrate storage key during upgrade",o,c),n.push(o)}}),{migratedKeys:r,failedKeys:n})}function qm(e,t,r){if(!e||!t||typeof t.removeItem!="function")return;(Array.isArray(r)&&r.length>0?r:Object.keys(e)).forEach(o=>{try{t.removeItem(o)}catch(i){console.warn("Unable to remove migrated storage key from fallback",o,i)}})}function Wm(e,t){!e||typeof e.removeItem!="function"||!Array.isArray(t)||t.forEach(r=>{try{e.removeItem(r)}catch(n){console.warn("Unable to roll back migrated storage key after upgrade failure",r,n)}})}function nc(e,t={}){const r=Object.create(null);if(!e)return r;const{suppressAlerts:n=!1}=t||{},o=i=>{if(typeof i!="string"||!i)return;let s;try{typeof e.getItem=="function"?s=e.getItem(i):Object.prototype.hasOwnProperty.call(e,i)&&(s=e[i])}catch(a){console.warn("Unable to read storage key during snapshot",i,a),n||ce("migration-read");return}s!=null&&(r[i]=String(s))};if(typeof e.key=="function"&&typeof e.length=="number"){for(let i=0;i<e.length;i+=1)o(e.key(i));return r}if(typeof e.keys=="function"){try{const i=e.keys();Array.isArray(i)&&i.forEach(o)}catch(i){console.warn("Unable to enumerate storage keys during snapshot",i),n||ce("migration-read")}return r}if(typeof e.forEach=="function"){try{e.forEach((i,s)=>{typeof s=="string"&&i!=null&&(r[s]=String(i))})}catch(i){console.warn("Unable to iterate storage entries during snapshot",i),n||ce("migration-read")}return r}return Object.keys(e).forEach(o),r}function If(){if(!(!S||typeof S!="object"))try{Object.defineProperty(S,"SAFE_LOCAL_STORAGE",{configurable:!0,get:T});return}catch{try{S.SAFE_LOCAL_STORAGE=T();return}catch(t){console.warn("Unable to refresh SAFE_LOCAL_STORAGE global reference",t)}}}function be(e,t,r){if(!D||D.type==="memory")return;const n=D.storage;if(!n||r&&r!==n)return;let o=Object.create(null);try{o=nc(n,{suppressAlerts:!0})}catch(c){console.warn("Unable to capture storage snapshot during downgrade",c)}let i=null,s="memory";if(D.type!=="session"){const c=[S,S&&S.window?S.window:null,S&&S.__cineGlobal?S.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let l=0;l<c.length;l+=1){const f=Ja(c[l]);if(!(!f||f===n||r&&f===r))try{const u=$i(f);if(u){i=u,s="session",Jr(u);break}}catch(u){console.warn("Unable to activate sessionStorage fallback during downgrade",u)}}}i||(i=vf()),Object.keys(o).forEach(c=>{const l=o[c];if(l!=null)try{typeof i.setItem=="function"?i.setItem(c,l):i[c]=l}catch(f){console.warn(`Unable to copy storage entry to ${s==="session"?"sessionStorage":"memory"} during downgrade`,c,f)}}),D={storage:i,type:s},jr=null;const a=s==="session"?"sessionStorage":"in-memory fallback";console.warn(e?`Downgraded planner storage to ${a} after ${e} errors.`:`Downgraded planner storage to ${a} after storage errors.`,t),s==="session"&&Mf(),If()}function Ym(){if(!D||D.type==="local")return D.storage;const e=Ju(),t=D.storage;let r=null,n=null;for(let a=0;a<e.length;a+=1){const c=e[a];if(!c||c===t||c===jr)continue;let l;try{l=$i(c)}catch(f){console.warn("localStorage upgrade verification failed",f),jr=c;continue}if(!l||l===t){l||(jr=c);continue}r=c,n=l;break}if(!n)return t;const o=nc(t),{migratedKeys:i,failedKeys:s}=Hm(o,n);return s.length>0?(Wm(n,i),console.warn("Aborting localStorage upgrade because some entries could not be migrated. Continuing to use fallback storage.",s),ce("migration-write"),jr=r||n,t):(qm(o,t,i),D={storage:n,type:"local"},jr=null,n)}function T(){if(k&&k.driver&&k.driver.storage)return k.driver.storage;(!D||!D.storage)&&(D=jf(),typeof console<"u"&&console.log&&console.log("DEBUG: storage initialized with type:",D.type)),D.type!=="local"&&Ym();const e=D.storage;return console.log("DEBUG: getSafeLocalStorage returning",e&&"object"),e}If();Mm();var oo=null;function Lf(){const e=Dm();if(!(e&&typeof e.persist=="function"))return Promise.resolve({supported:!1,granted:!1,alreadyGranted:!1});if(oo)return oo;const n=(async()=>{let o=!1;const i=typeof e.persisted=="function";if(i)try{o=await e.persisted()}catch(s){console.warn("Unable to determine persistent storage state",s)}if(o)return{supported:!0,granted:!0,alreadyGranted:!0};try{const s=await e.persist();if(!s&&i)try{if(await e.persisted())return{supported:!0,granted:!0,alreadyGranted:!0}}catch(a){console.warn("Unable to verify persistent storage after request",a)}return{supported:!0,granted:s,alreadyGranted:!1}}catch(s){return console.warn("Persistent storage request failed",s),{supported:!0,granted:!1,alreadyGranted:!1,error:s}}})().then(o=>((!o||o.granted!==!0)&&(oo=null),o),o=>{throw oo=null,o});return oo=n,n}typeof window<"u"&&typeof navigator<"u"&&Lf();function P(e){if(e===null||typeof e!="object")return!1;let t;try{t=Object.getPrototypeOf(e)}catch{return!1}if(t===null||t===Object.prototype)return!0;if(Object.getPrototypeOf(t)===null&&typeof t.constructor=="function"){const n=t.constructor.name;return n==="Object"||n===""}return!1}function re(e){if(!e||typeof e!="object")return!1;if(Object.prototype.toString.call(e)==="[object Map]")return!0;if(typeof Map<"u")try{if(e instanceof Map)return!0}catch{}return typeof e.size=="number"&&typeof e.entries=="function"&&typeof e.forEach=="function"&&typeof e.get=="function"&&typeof e.set=="function"}function Rf(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(typeof e=="symbol")return e.description||e.toString();if(e&&typeof e=="object")try{const t=JSON.stringify(e);if(t&&t!=="{}")return t}catch{}try{return String(e)}catch{}return null}function ne(e){if(!re(e))return null;const t=Object.create(null),r=(o,i)=>{const s=Rf(o);s!=null&&(Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i))};let n=!1;if(typeof e.entries=="function")try{const o=e.entries();if(o&&typeof o.next=="function"){for(let i=o.next();!i.done;i=o.next()){const s=i&&i.value;Array.isArray(s)&&s.length>=2&&r(s[0],s[1])}n=!0}}catch(o){console.warn("Unable to iterate map-like value entries",o)}if(!n&&typeof e.forEach=="function")try{e.forEach((o,i)=>{r(i,o)}),n=!0}catch(o){console.warn("Unable to iterate map-like value via forEach",o)}return!Object.keys(t).length&&!n?null:t}var Lo=/^long[\s_-]?gop$/i;function ll(e){if(typeof e!="string")return null;var t=e.trim();if(!t)return null;var r=t.toLowerCase();return r==="utf16"||r==="utf-16"?"utf16":r==="uri-component"||r==="uri_component"||r==="encoded-uri-component"||r==="uri"?"uri-component":r==="base64"?"base64":Lo.test(r)?"utf16":null}function ul(e){if(typeof e!="string")return e;const t=e.trim();return Lo.test(t)?"long-gop":e}function Jm(e){return typeof e!="string"?e:Lo.test(e)?"long-gop":e}function ue(e,t){if(e===null||typeof e!="object")return ul(e);const r=t||new WeakSet;if(r.has(e))return e;if(r.add(e),Array.isArray(e)){let n=!1;const o=e.map(i=>{const s=ue(i,r);return s!==i&&(n=!0),s});return n?o:e}if(P(e)){let n=!1;const o={};return Object.keys(e).forEach(i=>{const s=Jm(i),a=e[i],c=ue(a,r);(s!==i||c!==a)&&(n=!0),o[s]=c}),n?o:e}return ul(e)}function Vi(e){if(!Array.isArray(e))return{normalized:Array.isArray(e)?e:[],changed:!1};let t=!1;return{normalized:e.map(n=>{if(n==null)return n;const o=ue(n);return o!==n&&(t=!0),o}),changed:t}}function oc(e){if(typeof e!="string")return{timestamp:Number.NEGATIVE_INFINITY,label:""};const t=(r,n={})=>{const i=e.slice(r.length).split("-");if(i.length<5)return null;const[s,a,c,l,f]=i,u=Number.parseInt(s,10),y=Number.parseInt(a,10)-1,p=Number.parseInt(c,10),d=Number.parseInt(l,10),m=Number.parseInt(f,10);if([u,y,p,d,m].some(C=>Number.isNaN(C)))return null;let g=!1,b=0,_=5;if(i.length>_){const C=i[_];if(/^\d{1,2}$/u.test(C))g=!0,b=Number.parseInt(C,10),_+=1;else if(n.requireSeconds)return null}else if(n.requireSeconds)return null;const w=i.slice(_).join("-").trim(),A=new Date(u,y,p,d,m,g?b:0,0).getTime();return Number.isNaN(A)?null:{timestamp:A,label:w}};if(e.startsWith(De)){const r=t(De);return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}if(e.startsWith(_t)){const r=t(_t,{requireSeconds:!1});return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}return{timestamp:Number.NEGATIVE_INFINITY,label:""}}function Hi(e,t){return!P(e)||typeof t!="string"?[]:Object.keys(e).filter(r=>typeof r=="string"&&r.startsWith(t)).map(r=>{const{timestamp:n,label:o}=oc(r);return{key:r,timestamp:n,label:o}}).sort((r,n)=>r.timestamp!==n.timestamp?r.timestamp-n.timestamp:r.key.localeCompare(n.key))}function Qm(e){if(!(!e||typeof e!="object")){try{e[Xr]=!0}catch{try{Object.defineProperty(e,Xr,{configurable:!0,enumerable:!0,writable:!0,value:!0})}catch{}}if(P(e.projectInfo))try{e.projectInfo[Xr]=!0}catch{}}}function Xm(e){return!e||typeof e!="object"?!1:!!(e[Xr]===!0||P(e.projectInfo)&&e.projectInfo[Xr]===!0)}function ic(e,t){return!P(e)||typeof t!="string"?!1:Xm(e[t])}function Tf(e){if(!e||typeof e!="object")return"";if(typeof e.label=="string"){const t=e.label.trim();if(t)return t}if(typeof e.key=="string"&&e.key.trim()){const t=e.key.trim();return t.startsWith(De)||t.startsWith(_t)?"__auto-backup:unlabeled__":t}return"__auto-backup:unlabeled__"}function Zm(e,t){if(!P(e)||!t||typeof t.key!="string")return"undefined";const r=Object.prototype.hasOwnProperty.call(e,t.key)?e[t.key]:void 0;try{let n=r;if(P(r)&&r[Pn]){const i=me(r,{stripMetadata:!0}),s=i[Pn];if(s&&typeof s=="object")try{const a=oa(s,t.key);s.payload=a.payload,Object.prototype.hasOwnProperty.call(s,"payloadCompression")&&delete s.payloadCompression}catch(a){console.warn("Failed to expand automatic backup payload for signature comparison",t.key,a)}n=i}const o=na(n,{stripMetadata:!0});return _e(o)}catch(n){return console.warn("Failed to create stable signature for automatic backup entry",n),"undefined"}}function _e(e,t){const r=t||(typeof WeakSet=="function"?{seen:new WeakSet,reportedCycle:!1}:null),n=r&&r.seen?r.seen:null,o=(i,s)=>{if(!n)return s();if(n.has(i))return!r.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Detected circular reference while computing automatic backup signature. Using a placeholder token to keep backups stable."),r.reportedCycle=!0,gf;n.add(i);try{return s()}finally{n.delete(i)}};if(e===null)return"null";if(e===void 0)return"undefined";if(Array.isArray(e))return o(e,()=>{let i="[";for(let s=0;s<e.length;s+=1)s>0&&(i+=","),i+=_e(e[s],r);return i+="]",i});if(e instanceof Date)return o(e,()=>{const i=e.getTime();return Number.isNaN(i)?"date:invalid":`date:${i}`});if(P(e))return o(e,()=>{const i=Object.keys(e).sort();let s="{";for(let a=0;a<i.length;a+=1){const c=i[a];a>0&&(s+=","),s+=`${JSON.stringify(c)}:${_e(e[c],r)}`}return s+="}",s});if(e&&typeof e=="object")return o(e,()=>`${typeof e}:${String(e)}`);if(typeof e=="number")return Number.isNaN(e)?"number:NaN":Number.isFinite(e)?`number:${e}`:e>0?"number:Infinity":"number:-Infinity";if(typeof e=="bigint")return`bigint:${e.toString()}`;if(typeof e=="boolean")return e?"boolean:true":"boolean:false";if(typeof e=="string"){const i=Wo(e);if(i.success&&typeof i.value=="string")try{const s=JSON.parse(i.value);return _e(s,r)}catch(s){console.warn("Unable to decode compressed string while computing stable value signature",s)}return`string:${e}`}return typeof e=="symbol"?`symbol:${String(e)}`:typeof e=="function"?`function:${e.name||"anonymous"}`:`${typeof e}:${String(e)}`}function aa(e,t){if(!P(e)||!Array.isArray(t)||t.length<2)return null;const r=new Map;for(let n=t.length-1;n>=0;n-=1){const o=t[n];if(!o||typeof o.key!="string"||ic(e,o.key))continue;const i=Tf(o);let s=r.get(i);s||(s=new Map,r.set(i,s));const a=Object.prototype.hasOwnProperty.call(e,o.key)?e[o.key]:void 0,c=_e(a),l=s.get(c);if(l&&typeof l.key=="string")return delete e[o.key],t.splice(n,1),typeof console<"u"&&typeof console.info=="function"&&console.info("Removed duplicate automatic backup while preserving newer copy.",{removedKey:o.key,preservedKey:l.key,label:i}),o.key;s.set(c,{key:o.key,signature:c})}return null}function fl(e,t){const r=[];for(;;){const n=aa(e,t);if(!n)break;r.push(n)}return r}function pl(e,t,r,n){if(!P(e)||!Array.isArray(t)||t.length<=r)return;const o=new Map;for(let s=0;s<t.length;s+=1){const a=t[s];if(!a||typeof a.key!="string")continue;const c=Tf(a),l=Zm(e,a),f=`${c}__${l}`,u=o.get(f);u?u.push(s):o.set(f,[s])}const i=Array.from(o.values()).filter(s=>Array.isArray(s)&&s.length>1).flatMap(s=>s.slice(0,-1)).sort((s,a)=>s-a);if(!i.length){t.length>r&&console.warn("Skipped trimming automatic backups because all remaining versions are unique.",{limit:r,total:t.length});return}for(let s=i.length-1;s>=0&&t.length>r;s-=1){const a=i[s],c=t[a];!c||typeof c.key!="string"||ic(e,c.key)||(delete e[c.key],t.splice(a,1),n.push(c.key))}t.length>r&&console.warn("Unable to trim automatic backups down to the configured limit without losing unique data.",{limit:r,remaining:t.length})}function sc(e){if(!P(e))return[];const t=[],r=Hi(e,De);t.push(...fl(e,r)),r.length>Sn&&pl(e,r,Sn,t);const n=Hi(e,_t);return t.push(...fl(e,n)),n.length>Xc&&pl(e,n,Xc,t),t.length>0&&console.warn(`Removed ${t.length} older automatic backup${t.length>1?"s":""} to stay within storage limits.`,t),t}function ca(e,t={}){if(!P(e))return null;const{force:r=!1}=t,n=(f,{respectRename:u=!0}={})=>{if(!Array.isArray(f)||f.length===0)return null;for(let y=0;y<f.length;y+=1){const p=f[y];if(!p||typeof p.key!="string")continue;const d=Object.prototype.hasOwnProperty.call(e,p.key),m=d?e[p.key]:void 0;if(!d||m===void 0||m===null||typeof m!="object")return delete e[p.key],p.key;if(!(u&&ic(e,p.key)))return delete e[p.key],p.key}return null},o=Hi(e,De),i=aa(e,o);if(i)return i;const s=Hi(e,_t),a=aa(e,s);if(a)return a;const c=n(s,{respectRename:!1});if(c)return c;s.length>0&&console.warn("Unable to free space by removing pre-deletion backups because all copies appear to be protected.");const l=n(o,{respectRename:!r});return l||(o.length>0&&console.warn("Unable to free space by removing automatic backups because the remaining copies were renamed or protected."),null)}function eh(e){if(!e||typeof e!="object")return"";if(typeof e.note=="string"){const t=e.note.trim();if(t)return t}if(typeof e.createdAt=="string"){const t=e.createdAt.trim();if(t)return t}return typeof e.id=="string"?e.id:""}function la(e){if(!Array.isArray(e)||e.length===0)return null;const t=r=>{const[n]=e.splice(r,1);return{removed:n,label:eh(n)}};for(let r=e.length-1;r>=0;r-=1){const n=e[r];if(!n||typeof n!="object"||!Array.isArray(n.rules))return t(r)}return t(e.length-1)}function th(e){if(!e||typeof e.getItem!="function"||typeof e.removeItem!="function")return!1;const t=`${ut}${ln}`,r=[];try{const n=e.getItem(t);n!=null&&(e.removeItem(t),r.push(t))}catch(n){console.warn("Unable to inspect automatic gear backup migration snapshot while recovering storage quota.",n)}try{const n=kf(e,t);Array.isArray(n)&&n.length>0&&r.push(...n)}catch(n){console.warn("Unable to prune migration backups while recovering storage for automatic gear backups.",n)}return r.length>0?(console.warn(`Removed ${r.length} migration backup${r.length>1?"s":""} while freeing storage for automatic gear backups.`,r),!0):!1}function ua(){if(typeof sn!="function")return!1;try{return sn(),console.warn("Cleared cached planner data to free up storage space before saving automatic gear backups."),!0}catch(e){console.warn("Unable to clear cached planner data while recovering storage for automatic gear backups.",e)}return!1}function rh(e){return e?!(e==="migration-read"&&typeof D<"u"&&D&&D.type&&D.type!=="memory"):!0}function ce(e){if(!rh(e)||(S&&typeof S[vn]=="boolean"&&(wi=S[vn]),wi)||(wi=!0,S&&(S[vn]=!0),typeof window>"u"||typeof window.alert!="function"))return;let t="Storage error: Unable to access local data. Changes may not be saved.";try{if(typeof window<"u"&&window.texts){const r=window.texts,n=window.currentLang||"en",o=r[n]?n:"en";t=r[o]?.alertStorageError||t}}catch{}window.alert(t)}function Mf(){if(sa||(sa=!0,S&&(S[Si]=!0),typeof window>"u"||typeof window.alert!="function"))return;let e="Warning: Local storage is unavailable. Data will only persist for this browser tab.";try{if(typeof window<"u"&&window.texts){const t=window.texts,r=window.currentLang||"en",n=t[r]?r:"en";e=t[n]?.alertSessionFallback||e}}catch{}window.alert(e)}function qi(e){if(typeof window>"u")return null;try{return window[e]}catch(t){return console.warn(`Unable to access ${e} during legacy migration`,t),null}}function fa(e){if(!Array.isArray(e)||e.length===0)return[];const t=[],r=new Set;for(let n=0;n<e.length;n+=1){const o=e[n];!o||typeof o.getItem!="function"||r.has(o)||(r.add(o),t.push(o))}return t}function nh(e,t,r,n,o={}){if(!e||typeof e.getItem!="function")return!1;const{keepLegacy:i=!1}=o;let s;try{s=e.getItem(r)}catch(c){return console.warn(`Unable to read legacy storage key ${r}`,c),ce("migration-read"),!1}if(s==null)return!1;const a=t&&typeof t.setItem=="function"?t:e;try{const c=a.getItem(n);if(c!=null){if(!i&&(e!==a||r!==n))try{e.removeItem(r)}catch(l){console.warn(`Unable to remove legacy storage key ${r}`,l)}return!1}}catch(c){console.warn(`Unable to inspect destination storage for ${n}`,c)}try{a.setItem(n,s)}catch(c){return console.warn(`Unable to migrate legacy storage key ${r}`,c),!1}if(!i)try{e.removeItem(r)}catch(c){console.warn(`Unable to remove legacy storage key ${r} after migration`,c)}return!0}function ii(e,t,r,n,o){let i=!1;for(let s=0;s<e.length;s+=1)nh(e[s],t,r,n,o)&&(i=!0);return i}function oh(){const e=T(),t=fa([qi("localStorage"),e]),r=fa([qi("sessionStorage"),typeof sessionStorage<"u"?sessionStorage:null]),n="cinePowerPlanner_";[{legacy:`${n}devices`,modern:Ze},{legacy:`${n}setups`,modern:pt},{legacy:`${n}session`,modern:er,includeSession:!0},{legacy:`${n}feedback`,modern:Mr},{legacy:`${n}project`,modern:pe},{legacy:`${n}projects`,modern:pe},{legacy:`${n}favorites`,modern:et},{legacy:`${n}ownGear`,modern:Gt},{legacy:`${n}schemaCache`,modern:dt},{legacy:`${n}autoGearRules`,modern:Br},{legacy:`${n}autoGearBackups`,modern:ut},{legacy:`${n}autoGearSeeded`,modern:cn},{legacy:`${n}autoGearPresets`,modern:Dt},{legacy:`${n}autoGearActivePreset`,modern:Ot},{legacy:`${n}autoGearAutoPreset`,modern:Qe},{legacy:`${n}autoGearShowBackups`,modern:pr},{legacy:`${n}autoGearBackupRetention`,modern:Kt},{legacy:`${n}autoGearMonitorDefaults`,modern:Ut},{legacy:`${n}customFonts`,modern:tr,updateFontKey:!0}].forEach(({legacy:i,modern:s,includeSession:a=!1,updateFontKey:c=!1})=>{const l=ii(t,e,i,s);ii(t,e,`${i}${he}`,`${s}${he}`),a&&(ii(r,null,i,s),ii(r,null,`${i}${he}`,`${s}${he}`)),c&&l&&S&&(S.CUSTOM_FONT_STORAGE_KEY===i&&(S.CUSTOM_FONT_STORAGE_KEY=s),S.CUSTOM_FONT_STORAGE_KEY_NAME===i&&(S.CUSTOM_FONT_STORAGE_KEY_NAME=s))})}function Pe(){oh()}function Nf(e){if(!e||typeof e.getItem!="function")return!1;if(_n&&typeof _n.has=="function"&&_n.has(e))return!0;if(D&&D.type==="session"&&D.storage===e)return Jr(e),!0;const t=T();if(t&&D&&D.type==="session"&&t===e)return Jr(e),!0;const r=[S,S&&S.__cineGlobal?S.__cineGlobal:null,S&&S.window?S.window:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let n=0;n<r.length;n+=1){const o=Ja(r[n]);if(o&&o===e)return Jr(o),!0}return!1}function Me(e,t,r,n=null,o={}){if(!e)return n;const{disableBackup:i=!1,backupKey:s,validate:a,restoreIfMissing:c=!1,alertOnFailure:l=null,migrationBackupKey:f}=o||{},u=typeof s=="string"&&s?s:`${t}${he}`,y=!i&&u&&u!==t,p=Qu()||S&&S.__cineJustFactoryReset,d=y&&!p,m=!p,g=(()=>{const M=new Set,G=[],N=$=>{typeof $!="string"||!$||M.has($)||(M.add($),G.push($))};typeof f=="string"&&f&&N(f);const z=Pt(t);for(let $=0;$<z.length;$+=1)N(`${z[$]}${ln}`);return G})(),b=rc(e);let _=typeof b=="function"?uo(e,t,b):void 0,w=!1;const h=(M,G)=>{if(M==null)return{ok:!1,reason:"missing"};const N=typeof M=="string"?un(M):M;if(typeof M=="string"&&M&&N===M&&M.includes(`"${dr}":true`)&&M.includes(`"namespace":"${on}`))return console.warn(`${r} Compressed value could not be decoded${G?` (${G})`:""}.`),w=!0,{ok:!1,reason:"compressed"};try{const z=JSON.parse(N);return typeof a=="function"&&!a(z)?(console.warn(`${r} Invalid data${G?` (${G})`:""}.`),w=!0,{ok:!1,reason:"invalid"}):{ok:!0,value:z,raw:M,normalizedRaw:N}}catch(z){return console.error(`${r}${G?` (${G})`:""}`,z),w=!0,{ok:!1,reason:"error"}}};let A=null;try{A=e.getItem(t)}catch(M){console.error(`${r} (read)`,M),be("read access",M,e),w=!0}typeof _>"u"&&typeof b=="function"&&(_=uo(e,t,b)),A==null&&_==null&&Zt(e,t);const C=Jg(e,t,A,_);if(C.hit)return C.value;const j=h(A,"");if(j.ok){const M=typeof j.normalizedRaw=="string"&&j.normalizedRaw?j.normalizedRaw:typeof j.raw=="string"&&j.raw?j.raw:null,G=typeof _=="string"&&_?_:typeof j.raw=="string"&&j.raw?j.raw:null;return Ke(e,t,G,M,j.value),j.value}const O=!j.ok&&j.reason==="missing",E=()=>{if(!g.length)return{success:!1,shouldAlert:!1};for(let M=0;M<g.length;M+=1){const G=g[M];let N=null,z;try{N=e.getItem(G)}catch(R){return console.error(`${r} (migration backup read)`,R),be("read access",R,e),{success:!1,shouldAlert:!0}}if(typeof b=="function"&&(z=uo(e,G,b)),N==null&&z==null){Zt(e,G);continue}const $=N??z,nt=Ln({key:G,value:$,type:"migration-backup"});if(typeof nt>"u")continue;let ye=nt;if(typeof ye=="string"){const R=ye.trim();if(R)try{ye=JSON.parse(R)}catch{}else ye=""}if(typeof a=="function"&&!a(ye)){console.warn(`Ignored migration backup for ${t} because it failed validation.`);continue}Ke(e,G,typeof z=="string"&&z?z:typeof $=="string"&&$?$:null,typeof $=="string"&&$?$:typeof z=="string"&&z?z:null,ye);let ot=null;try{ot=JSON.stringify(ye)}catch(R){console.warn(`Unable to serialize recovered migration backup for ${t}`,R),ot=null}let Dr=null,it=!1;if(ot!==null){let R=ot;const K=typeof ot=="string"?Fn(ot):null;K&&typeof K.serialized=="string"&&(R=K.serialized);try{e.setItem(t,R),Dr=R}catch(V){console.warn(`Unable to restore primary copy for ${t} from migration backup`,V),be("write access",V,e),it=!0}}else it=!0;Dr!==null?Ke(e,t,Dr,ot,ye):ot!==null?Ke(e,t,ot,ot,ye):Ke(e,t,null,null,ye),console.warn(Dr!==null?`Recovered ${t} from migration backup copy.`:`Recovered ${t} from migration backup copy but could not rewrite the primary entry.`);try{e.removeItem(G),Zt(e,G)}catch(R){console.warn(`Unable to remove migration backup ${G} after recovery`,R)}return{success:!0,value:ye,shouldAlert:it}}return{success:!1,shouldAlert:!1}},I=d&&(w||c||O);if(I){let M=null;try{M=e.getItem(u)}catch(z){console.error(`${r} (backup read)`,z),be("read access",z,e),w=!0}const G=typeof b=="function"?uo(e,u,b):void 0,N=h(M,"backup");if(N.ok&&((w||O)&&console.warn(`Recovered ${t} from backup copy.`),N.raw!==null&&N.raw!==void 0)){let z=null;try{if(typeof N.raw=="string"){const nt=typeof N.normalizedRaw=="string"&&N.normalizedRaw?N.normalizedRaw:N.raw,ye=Fn(nt);ye&&typeof ye.serialized=="string"?(e.setItem(t,ye.serialized),z=ye.serialized):nt!==N.raw?(e.setItem(t,nt),z=nt):(e.setItem(t,N.raw),z=N.raw)}else e.setItem(t,N.raw),z=typeof N.raw=="string"?N.raw:null}catch(nt){console.warn(`Unable to restore primary copy for ${t} from backup`,nt),z=null}const $=typeof N.normalizedRaw=="string"&&N.normalizedRaw?N.normalizedRaw:typeof N.raw=="string"&&N.raw?N.raw:null,Ht=typeof G=="string"&&G?G:typeof N.raw=="string"&&N.raw?N.raw:null;return Ke(e,u,Ht,$,N.value),typeof z=="string"&&z&&Ke(e,t,z,$,N.value),N.value}}const B=m&&g.length>0&&(O||c||w);if(B){const M=E();if(M.success){if(M.shouldAlert&&(w=!0),g.length){const G=g[0].key;try{e.removeItem(G),e[Gr]&&e.removeItem&&e.removeItem(G)}catch(N){console.warn("Post-migration cleanup error:",N)}}return M.value}M.shouldAlert&&(w=!0)}return w&&ce(l),Zt(e,t),O&&!I&&!B&&console.debug(`[Storage] Returning default for ${t} (No primary, no backups found)`),n}function Ae(e,t,r,n,o={}){if(!e){console.warn("DEBUG: saveJSONToStorage NO STORAGE");return}if(Qu()){console.warn("DEBUG: saveJSONToStorage RESET ACTIVE");return}const{disableBackup:i=!1,backupKey:s,onQuotaExceeded:a,enableCompressionSweep:c=!0,disableCompression:l=!1,forceCompressionOnQuota:f=!1}=o||{},u=typeof s=="string"&&s?s:`${t}${he}`,y=!i&&u&&u!==t,p=Nf(e),d=p||!!l,m=p?!1:f===!0,g=rc(e),b=R=>uo(e,R,g);let _,w=!1,h,A=!1,C=!1,j=!1;const O=()=>{_=void 0,w=!1,h=void 0,A=!1,C=!1,j=!1},E=()=>{if(w)return _;w=!0;try{_=JSON.stringify(r)}catch(R){_=null,console.error(n,R),ce()}return _},I=()=>{if(h!==void 0)return h&&typeof h.serialized=="string"?h.serialized:null;const R=E();if(typeof R!="string"||!R)return h=null,null;const K=Fn(R);return!K||typeof K.serialized!="string"?(h=null,null):(h=K,K.serialized)},B=()=>{if(A){const K=I();if(typeof K=="string")return K;A=!1}const R=E();return typeof R=="string"?R:null},M=({force:R=!1}={})=>{const K=R&&m;if(d&&!K)return C=!0,!1;if(A||C&&!K)return!1;C=!0;const V=E();if(typeof V!="string"||!V)return!1;const ke=I();return typeof ke!="string"||!ke||ke.length>=V.length?!1:(A=!0,!0)},G=()=>{if(!A||!h||j)return;const{originalLength:R,wrappedLength:K}=h;if(typeof R=="number"&&typeof K=="number"&&K<R){const V=R-K,ke=R>0?Math.round(V/R*100):0,te=`Stored compressed value for ${t} to reduce storage usage by ${V} characters (${ke}%).`;ds("storage-value",t,te,V,ke)}j=!0},N=()=>{if(d){C=!0;return}if(A||C)return;const R=E();if(typeof R!="string"||!R||R.length<Am)return;const K=I();if(typeof K!="string"||!K)return;const V=R.length-K.length;if(V<Om||(R.length>0?V/R.length:0)<Cm)return;const te=b(t);typeof te=="string"&&te===K||(A=!0,C=!0)};let z,$=!1,Ht=!1,nt=0,ye=!1,Es=!1;N();const qn=()=>(nt+=1,nt>fm?(ye=!0,console.warn(`Exceeded maximum storage recovery attempts while saving ${t}.`),!1):!0),ot=(R,K)=>{if(!R||typeof R.length!="number"||typeof R.key!="function")return{success:!1,freed:0};const{skipKeys:V=[]}=K||{},ke=new Set(V);xt&&rr&&ke.add(rr);const te=[],Ne=R.length;for(let Ge=0;Ge<Ne;Ge+=1){let se;try{se=R.key(Ge)}catch{continue}if(!(!se||ke.has(se))){if(se.endsWith("__legacyMigrationBackup")){te.push({key:se,priority:1,size:0});continue}if(se.endsWith("__backup")){te.push({key:se,priority:2,size:0});continue}if(se===dt||se===Xu){te.push({key:se,priority:3,size:0});continue}if(se.startsWith(Bt)&&se.includes("auto-backup-")){te.push({key:se,priority:4,size:0});continue}}}if(!te.length)return{success:!1,freed:0};te.sort((Ge,se)=>Ge.priority-se.priority);let xe=0,qt=0;for(let Ge=0;Ge<te.length;Ge+=1){const se=te[Ge];try{const Wt=R.getItem(se.key),Wn=Wt?Wt.length:0;if(R.removeItem(se.key),Zt(R,se.key),xe+=Wn,qt+=1,console.warn(`[Storage Cleanup] Removed ${se.key} to free ${Wn} chars.`),xe>5e5)break}catch(Wt){console.warn(`[Storage Cleanup] Failed to remove ${se.key}`,Wt)}}return{success:qt>0,freed:xe}},Dr=(R,K={})=>{if(!Tt(R))return!1;if(typeof a=="function")try{if(a(R,{storage:e,key:t,value:r,...K})===!0)return!0}catch(te){const Ne=K&&K.isBackup?" (backup)":"";console.error(`Error while handling quota exceed for ${t}${Ne}`,te)}if(!Es&&c!==!1){Es=!0;const te=[t];y&&typeof u=="string"&&u&&u!==t&&te.push(u),K&&typeof K.backupKey=="string"&&K.backupKey&&te.push(K.backupKey);const Ne=Pf(e,{skipKeys:te});if(Ne&&Ne.success)return!0}const V=[t];y&&typeof u=="string"&&u&&V.push(u);const ke=ot(e,{skipKeys:V});return!!(ke&&ke.success)};let it=0;for(;it<um;){it+=1;const R=B();if(typeof R!="string")return;const K=E(),V=typeof K=="string"&&K?K:null;let ke=!1,te,Ne=!1,xe=null,qt=null,Ge=null;if(typeof e.getItem=="function")try{const oe=e.getItem(t);if(oe===R)ke=!0,qt=R;else if(A){const Le=b(t);typeof Le=="string"&&(qt=Le,Le===R&&(ke=!0))}else typeof oe=="string"&&(qt=oe)}catch(oe){console.warn(`Unable to inspect existing value for ${t}`,oe)}if(y&&typeof e.getItem=="function")try{te=e.getItem(u),Ne=typeof te=="string",Ne&&A?(xe=b(u),typeof xe=="string"&&(Ge=xe)):Ne&&(Ge=te)}catch(oe){console.warn(`Unable to inspect existing backup for ${t}`,oe)}!$&&Ne&&typeof te=="string"&&(z=te,$=!0);const se=(()=>{if(!y)return[];const oe=[];if(A){const Le=E();typeof Le=="string"&&Le&&oe.push({serialized:Le,compressed:!1}),typeof R=="string"&&R&&(!oe.length||oe[oe.length-1].serialized!==R)&&oe.push({serialized:R,compressed:!0})}else typeof R=="string"&&R&&oe.push({serialized:R,compressed:!1});return oe})(),Wt=se.length?se[0]:null,Wn=Ne&&Wt&&typeof Wt.serialized=="string"&&(te===Wt.serialized||typeof xe=="string"&&xe===Wt.serialized);if(ke&&(!y||Wn)){if(V&&(Ke(e,t,A&&typeof qt=="string"&&qt?qt:R,V,r),y&&Ne)){const Le=A&&typeof xe=="string"&&xe?xe:Ge;typeof Le=="string"&&Le&&Ke(e,u,Le,V,r)}return}if(!ke)try{e.setItem(t,R),G(),V&&Ke(e,t,R,V,r)}catch(oe){if(Dr(oe)){if(O(),!qn())break;it>0&&(it-=1);continue}if(!ye&&M({force:m})){if(!qn())break;it>0&&(it-=1);continue}console.error(n,oe),be("write access",oe,e),ce();return}if(!y)return;if(Wn){if(V&&Ne){const oe=A&&typeof xe=="string"&&xe?xe:Ge;typeof oe=="string"&&oe&&Ke(e,u,oe,V,r)}return}const Oc=(()=>{const oe=se.length?se:[{serialized:R,compressed:A}];let Le=null,As=!1,Qo=null;const Cc=mr=>{try{return e.setItem(u,mr.serialized),mr.compressed&&G(),Ht=!1,!0}catch(gt){return Le=gt,!1}};for(let mr=0;mr<oe.length;mr+=1){const gt=oe[mr];if(Qo=gt,Cc(gt)){if(V){const Yn=gt.compressed&&V?V:gt.serialized;Ke(e,u,gt.serialized,Yn,r)}return"success"}if(!Tt(Le))break;if(!As&&Ne)try{if(e.removeItem(u),Zt(e,u),As=!0,Ht=!0,Ne=!1,Cc(gt)){if(V){const Yn=gt.compressed&&V?V:gt.serialized;Ke(e,u,gt.serialized,Yn,r)}return"success"}}catch(Yn){console.warn(`Unable to remove previous backup for ${t}`,Yn)}}if(Tt(Le)&&(Dr(Le,{serialized:Qo&&typeof Qo.serialized=="string"?Qo.serialized:R,backupKey:u,isBackup:!0})||!ye&&M({force:m})))return O(),qn()?"retry":"failure";if(As&&typeof te=="string")try{e.setItem(u,te),V&&Ke(e,u,te,V,r),Ht=!1}catch(mr){console.warn(`Unable to restore previous backup for ${t}`,mr)}return console.warn(`Unable to update backup copy for ${t}`,Le),ce(),"failure"})();if(Oc==="success")return;if(Oc==="retry"){it>0&&(it-=1);continue}if(ye)break;return}if($&&Ht&&typeof z=="string")try{e.setItem(u,z),Zt(e,u)}catch(R){console.warn(`Unable to restore preserved backup for ${t}`,R)}console.error(n,new Error("Unable to save value after multiple attempts.")),ce()}function Ee(e,t,r,n={}){if(!e)return;k&&k.removeItem(t).catch(()=>{});const{disableBackup:o=!1,backupKey:i,disableMigrationCleanup:s=!1}=n||{},a=typeof i=="string"&&i?i:`${t}${he}`,c=!o&&a&&a!==t;Zt(e,t),c&&Zt(e,a),t===pe&&fr();try{e.removeItem(t)}catch(l){console.error(r,l),be("deletion",l,e),ce()}if(c)try{e.removeItem(a)}catch(l){console.error(`${r} (backup)`,l),be("deletion",l,e),ce()}if(!s){const l=`${t}${ln}`;try{e.removeItem(l)}catch(f){console.warn(`Unable to remove migration backup for ${t}`,f)}}}var ih=[dt,Xu],si=new Set;function sh(){const e=[],t=new Set,r=i=>{!i||typeof i.getItem!="function"||e.push(i)},n=(i,s,a)=>{if(!i||typeof i!="object"&&typeof i!="function")return null;try{return i[s]}catch(c){return a&&!si.has(a)&&(si.add(a),console.warn(`Unable to access ${a} while clearing UI caches`,c)),null}},o=(i,s)=>{if(!i||t.has(i))return;t.add(i),r(n(i,"SAFE_LOCAL_STORAGE",`${s}.SAFE_LOCAL_STORAGE`)),r(n(i,"localStorage",`${s}.localStorage`)),r(n(i,"sessionStorage",`${s}.sessionStorage`));const a=n(i,"__cineGlobal",`${s}.__cineGlobal`);a&&a!==i&&o(a,`${s}.__cineGlobal`)};o(typeof globalThis<"u"?globalThis:null,"globalThis"),o(typeof window<"u"?window:null,"window"),o(typeof self<"u"?self:null,"self"),o(typeof global<"u"?global:null,"global"),S&&S.__cineGlobal&&o(S.__cineGlobal,"__cineGlobal"),D&&D.storage&&r(D.storage),typeof T=="function"&&T()&&r(T());try{r(T())}catch(i){si.has("getSafeLocalStorage")||(si.add("getSafeLocalStorage"),console.warn("Unable to access safe local storage while clearing UI caches",i))}return r(qi("localStorage")),r(qi("sessionStorage")),typeof localStorage<"u"&&r(localStorage),typeof sessionStorage<"u"&&r(sessionStorage),fa(e)}function sn(){const e=sh();e.length&&ih.forEach(t=>{k&&k.removeItem(t).catch(r=>console.warn("Failed to clear UI cache from repo",r)),!(typeof t!="string"||!t)&&e.forEach(r=>{Ee(r,t,`Failed to clear UI cache entry ${t}`)})})}function Gf(e,t,r){if(!e)return!1;try{return e.getItem(t)==="1"}catch(n){return console.error(r,n),be("read access",n,e),ce(),!1}}function zf(e,t,r,n){if(e)try{r?e.setItem(t,"1"):e.removeItem(t)}catch(o){console.error(n,o),be("write access",o,e),ce()}}function ah(e,t,r,n,o,i,s,a){const c=Me(e,r,n,null,a);if(c!==null)return c;if(!t)return null;const l={...a||{},alertOnFailure:"migration-read"},f=Me(t,r,o,null,l);return f!==null?(Ae(e,r,f,i),Ee(t,r,s),f):null}function bs(e,t,r){const n=e.trim();let o=n,i=2;const s=r||new Set([...t].map(c=>c.trim().toLowerCase()));let a=n.toLowerCase();for(;s.has(a);)o=`${n} (${i++})`,a=o.toLowerCase();return t.add(o),s.add(a),o}function ch(e){const t=typeof e=="string"?e.trim():"";if(!t)return"Project-imported";const r=t.match(/^(.*?)-imported(?:-(\d+))?$/i);if(r){const n=typeof r[1]=="string"?r[1].trim():"";return n?`${n}-imported`:"Project-imported"}return t.toLowerCase().endsWith("-imported")?t:`${t}-imported`}function lh(e){const t=typeof e=="string"?e.trim():"",r=ch(e);if(!t)return{base:r,initialCandidate:r,suffixStart:2};const n=t.match(/^(.*?)-imported(?:-(\d+))?$/i),o=n&&n[2]?Number(n[2]):NaN,i=Number.isFinite(o)?o+1:2;return n?{base:r,initialCandidate:t,suffixStart:i}:{base:r,initialCandidate:r,suffixStart:2}}function uh(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=lh(e);let i=typeof o.initialCandidate=="string"?o.initialCandidate.trim():"";i||(i=o.base||"Project-imported");let s=i.trim().toLowerCase(),a=o.suffixStart;for(;s&&n.has(s);)i=`${o.base||"Project-imported"}-${a++}`,s=i.trim().toLowerCase();return t.add(i),s&&n.add(s),i}function fh(e){const t=typeof e=="string"?e.trim():"";return t?t.toLowerCase().endsWith("-updated")?t:`${t}-updated`:"Project-updated"}function io(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=fh(e);let i=o,s=2,a=i.trim().toLowerCase();for(;a&&n.has(a);)i=`${o}-${s++}`,a=i.trim().toLowerCase();return i}function ph(e){if(e==null)return[];if(typeof e=="string"){const t=e.trim();return t?[t]:[]}return Array.isArray(e)?e.filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):P(e)?Object.values(e).filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):[]}function dh(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}function pa(e){if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(!n||typeof n!="object")return;const o=Number(n.x),i=Number(n.y);!Number.isFinite(o)||!Number.isFinite(i)||(t[r]={x:o,y:i})}),t}function yh(e,t){const r=Object.keys(e||{}),n=Object.keys(t||{});if(r.length!==n.length)return!1;for(let o=0;o<r.length;o+=1){const i=r[o];if(!Object.prototype.hasOwnProperty.call(t||{},i))return!1;const s=e[i],a=t[i];if(!s||typeof s!="object"||!a||typeof a!="object"||Number(s.x)!==a.x||Number(s.y)!==a.y)return!1}return!0}function gh(e){if(!P(e))return{state:null,changed:!1};const t={...e};let r=!1;const n=s=>{if(!Object.prototype.hasOwnProperty.call(t,s))return;const a=t[s];if(typeof a=="string"){const c=a.trim();c!==a&&(t[s]=c,r=!0);return}if(a==null){t[s]="",r=!0;return}if(typeof a=="number"||typeof a=="boolean"){t[s]=String(a),r=!0;return}t[s]="",r=!0};["setupName","setupSelect","camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap","sliderBowl","easyrig"].forEach(n);const o=(s,a=[])=>{const c=[],l=[s,...a];let f=!1;l.forEach(m=>{if(Object.prototype.hasOwnProperty.call(t,m)){const g=ph(t[m]);m!==s&&(f=!0),g.length&&c.push(...g)}}),l.slice(1).forEach(m=>{Object.prototype.hasOwnProperty.call(t,m)&&(delete t[m],r=!0)});const u=[],y=new Set;c.forEach(m=>{y.has(m)||(y.add(m),u.push(m))});const p=Object.prototype.hasOwnProperty.call(t,s),d=p&&Array.isArray(t[s])?t[s].filter(m=>typeof m=="string").map(m=>m.trim()).filter(m=>m):[];!p&&!f&&u.length===0&&d.length===0||dh(d,u)||(t[s]=u,r=!0)};if(o("motors",["motor","motorSelect"]),o("controllers",["controller","controllerSelect"]),Object.prototype.hasOwnProperty.call(t,"projectInfo")&&!P(t.projectInfo)&&(t.projectInfo=null,r=!0),Object.prototype.hasOwnProperty.call(t,"autoGearHighlight")){const s=t.autoGearHighlight,a=s===!0||s==="true"||s===1||s==="1";(s!==a||typeof s!="boolean")&&(t.autoGearHighlight=a,r=!0)}if(Object.prototype.hasOwnProperty.call(t,"diagramPositions")){const s=pa(t.diagramPositions);Object.keys(s).length===0?(delete t.diagramPositions,r=!0):yh(t.diagramPositions,s)||(t.diagramPositions=s,r=!0)}const i=ue(t);return i!==t?{state:i,changed:!0}:{state:t,changed:r}}function Bf(){Pe();const e=T(),t=ah(e,typeof sessionStorage<"u"?sessionStorage:null,er,"Error loading session state from localStorage:","Error loading session state from sessionStorage:","Error saving session state to localStorage:","Error deleting session state from sessionStorage:",{validate:o=>o===null||P(o)});if(t===null)return null;const{state:r,changed:n}=gh(t);return r?(n&&(yt(e,er,t),ac(r)),r):null}function ac(e,t={}){const r=T();if(e==null){Ee(r,er,"Error deleting session state from localStorage:");return}if(!P(e)){console.warn("Ignoring invalid session state payload. Expected a plain object.");return}qe(r,er);const n=ue(e),o=P(t)?t:{},i=o.disableCompression!==!1,s={...o,disableCompression:i,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{if(typeof la=="function"){const a=bc();if(la(a))return console.warn("Removed oldest automatic gear backup to free up space for session state."),!0}return typeof ua=="function"&&ua()?(console.warn("Cleared cached planner data to free up space for session state."),!0):!1}};Ae(r,er,n,"Error saving session state to localStorage:",s)}function xf(e){if(!P(e))return{data:null,changed:!1};const t={...e};let r=!1;const n=(i,s)=>(P(i[s])||(i[s]={},r=!0),i[s]),o=i=>{if(!P(i))return;Object.entries(i).forEach(([a,c])=>{if(typeof a!="string")return;const l=a.trim();if(!l||l===a)return;if(!P(c)){Object.prototype.hasOwnProperty.call(i,l)||(i[l]=c,delete i[a],r=!0);return}const f=n(i,l),u=new Set(Object.keys(f)),y=new Set([...u].map(p=>p.trim().toLowerCase()));Object.entries(c).forEach(([p,d])=>{if(Object.prototype.hasOwnProperty.call(f,p)){const m=bs(p,u,y);f[m]=d;return}f[p]=d,u.add(p),y.add(p.trim().toLowerCase())}),delete i[a],r=!0})};return Bm.forEach(i=>{n(t,i)}),P(t.fiz)||(t.fiz={},r=!0),xm.forEach(i=>{n(t.fiz,i)}),P(t.accessories)||(t.accessories={},r=!0),Fm.forEach(i=>{n(t.accessories,i)}),o(t.accessories),o(t.fiz),Array.isArray(t.filterOptions)||(t.filterOptions=Array.isArray(e.filterOptions)?e.filterOptions.slice():[],r=!0),{data:t,changed:r}}function Ff(){Pe();const e=T(),t=Me(e,Ze,"Error loading device data from localStorage:",null,{validate:o=>o===null||P(o)}),{data:r,changed:n}=xf(t);return r?(n&&(yt(e,Ze,t),Ae(e,Ze,r,"Error updating device data in localStorage during normalization:",{disableCompression:!0,forceCompressionOnQuota:!1})),r):null}function Df(e){const t=T();if(e==null){Ee(t,Ze,"Error deleting device data from localStorage:");return}if(!P(e)){console.warn("Ignoring invalid device data payload. Expected a plain object.");return}const{data:r}=xf(e),n=r||e;qe(t,Ze),Ae(t,Ze,n,"Error saving device data to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Uf(e){if(!e)return{data:{},changed:!1};if(Array.isArray(e)){const n={},o=new Set,i=new Set;for(let s=0;s<e.length;s+=1){const a=e[s];if(!P(a))continue;const c=a.name||a.setupName||`Setup ${s+1}`,l=bs(c,o,i);n[l]=a}return{data:n,changed:!0}}if(!P(e))return{data:{},changed:!0};const t={};let r=!1;return Object.keys(e).forEach(n=>{const o=e[n];if(P(o)){const i=ue(o);i!==o&&(r=!0),t[n]=i}else r=!0}),r?{data:t,changed:!0}:{data:e,changed:!1}}function Yo(){Pe();const e=T(),t=Me(e,pt,"Error loading setups from localStorage:",null,{validate:o=>o===null||Array.isArray(o)||P(o)}),{data:r,changed:n}=Uf(t);n&&(yt(e,pt,t),Ae(e,pt,r,"Error updating setups in localStorage during normalization:"));try{return hf(r,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(De)})}catch(o){return console.warn("Failed to expand automatic backup entries while loading setups",o),me(r)}}function cc(e){const{data:t}=Uf(e);sc(t);const r=bf(t,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(De)});Lm(r);const n=T();typeof Ro=="function"&&Ro(t,n),qe(n,pt),Ae(n,pt,r,"Error saving setups to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{const o=ca(r);return o?(console.warn(`Removed automatic backup "${o}" to free up storage space before saving setups.`),!0):!1}})}function lc(e){const t=Yo(),{result:r,changed:n=!0}=e(t)||{};return n&&cc(t),r}function mh(e,t){lc(r=>(r[e]=t,{changed:!0}))}function hh(e){return Yo()[e]}function bh(e){lc(t=>Object.prototype.hasOwnProperty.call(t,e)?(delete t[e],{changed:!0}):{changed:!1})}function Sh(e,t){return lc(r=>{if(!Object.prototype.hasOwnProperty.call(r,e))return{result:null,changed:!1};const n=t.trim();if(!n)return{result:e,changed:!1};if(e.trim().toLowerCase()===n.toLowerCase())return{result:e,changed:!1};const o=new Set(Object.keys(r));o.delete(e);const i=bs(n,o),s=r[e];r[i]=s,delete r[e];const a=typeof e=="string"&&e.startsWith(De),c=typeof i=="string"&&i.startsWith(De);return a&&c&&Qm(s),{result:i,changed:!0}})}var wh=new Set(["prepDays","shootingDays","returnDays","crew","productionCompany","productionCompanyAddress"]),Kf={productionCompany:["Production Company","Produktionsfirma","Société de production","Productora","Casa di produzione"],productionCompanyAddress:["Production Company Address","Adresse der Produktionsfirma","Adresse de la société de production","Dirección de la productora","Indirizzo della casa di produzione"],productionCompanyStreet:["Street address","Straße und Hausnummer","Adresse","Dirección","Indirizzo"],productionCompanyStreet2:["Address line 2","Adresszusatz","Complément d'adresse","Línea 2 de dirección","Seconda linea indirizzo"],productionCompanyCity:["City","Stadt","Ville","Ciudad","Città"],productionCompanyRegion:["State / Province / Region","Bundesland / Region","État / Région / Département","Estado / Provincia / Región","Regione / Provincia / Stato"],productionCompanyPostalCode:["Postal code","Postleitzahl","Code postal","Código postal","CAP"],productionCompanyCountry:["Country","Land","Pays","País","Paese"],rentalHouse:["Rental","Kameraverleih","Loueur","Noleggio","Verleih","Location","Rental House"],crew:["Crew","Team","Équipe","Equipo","Troupe"],prepDays:["Prep Days","Prep-Tage","Jours de préparation","Días de preparación","Giorni di preparazione"],shootingDays:["Shooting Days","Drehtage","Jours de tournage","Días de rodaje","Giorni di riprese"],returnDays:["Return Days","Rückgabetage","Jours de restitution","Días de devolución","Giorni di restituzione"],deliveryResolution:["Delivery Resolution","Auslieferungsauflösung","Résolution de livraison","Resolución de entrega","Risoluzione di consegna"],recordingResolution:["Recording Resolution","Aufnahmeauflösung","Résolution d’enregistrement","Resolución de grabación","Risoluzione di registrazione"],slowMotionRecordingResolution:["Slow Motion Recording Resolution","Zeitlupen-Aufnahmeauflösung","Résolution d’enregistrement au ralenti","Resolución de grabación en cámara lenta","Risoluzione di registrazione slow motion"],aspectRatio:["Aspect Ratio","Seitenverhältnis","Format d’image","Relación de aspecto","Formato"],codec:["Codec","Codec","Codec","Códec","Codec"],baseFrameRate:["Base Frame Rate","Basis-Framerate","Cadence de base","Velocidad base","Frame rate base"],slowMotionBaseFrameRate:["Slow Motion Base Frame Rate","Zeitlupen-Basis-Framerate","Cadence de base au ralenti","Velocidad base en cámara lenta","Frame rate base slow motion"],recordingFrameRate:["Recording Frame Rate","Aufnahmebildrate","Cadence d’enregistrement","Velocidad de grabación","Frame rate di registrazione"],slowMotionRecordingFrameRate:["Slow Motion Recording Frame Rate","Zeitlupen-Aufnahmebildrate","Cadence d’enregistrement au ralenti","Velocidad de grabación en cámara lenta","Frame rate di registrazione slow motion"],sensorMode:["Sensor Mode","Sensormodus","Mode capteur","Modo de sensor","Modalità sensore"],slowMotionSensorMode:["Slow Motion Sensor Mode","Zeitlupen-Sensormodus","Mode capteur au ralenti","Modo de sensor en cámara lenta","Modalità sensore slow motion"],slowMotionAspectRatio:["Slow Motion Aspect Ratio","Zeitlupen-Seitenverhältnis","Format d’image au ralenti","Relación de aspecto en cámara lenta","Formato slow motion"],lenses:["Lenses","Objektive","Optiques","Ópticas","Obiettivi"],requiredScenarios:["Required Scenarios","Anforderungen","Scénarios requis","Escenarios requeridos","Scenari richiesti"],cameraHandle:["Camera Handle","Kamera-Handgriff","Poignée caméra","Empuñadura de cámara","Maniglia camera"],viewfinderExtension:["Viewfinder Extension","Sucher-Verlängerung","Extension viseur","Extensión de visor","Prolunga mirino"],viewfinderEyeLeatherColor:["Viewfinder Eye Leather Color","Sucher-Augenmuschel-Farbe","Couleur de l’œil du viseur","Color del ocular del visor","Colore gomma mirino"],mattebox:["Mattebox","Matte-Box","Matte box","Matte box","Matte box"],gimbal:["Gimbal","Gimbal-Stabilisator","Stabilisateur gimbal","Estabilizador gimbal","Stabilizzatore gimbal"],videoDistribution:["Video Distribution","Videoverteilung","Distribution vidéo","Distribución de vídeo","Distribuzione video"],monitoringSupport:["Monitoring support","Monitoring-Support","Support de monitoring","Soporte de monitorización","Supporto monitoraggio"],monitoringConfiguration:["Monitoring configuration","Monitoring-Konfiguration","Configuration de monitoring","Configuración de monitorización","Configurazione monitoraggio"],focusMonitor:["Focus Monitor","Fokusmonitor","Moniteur focus","Monitor de foco","Monitor fuoco"],monitorUserButtons:["Onboard Monitor User Buttons","Onboard-Monitor-Buttons","Boutons personnalisés du moniteur","Botones de usuario del monitor integrado","Tasti monitor onboard"],cameraUserButtons:["Camera User Buttons","Kamera-Buttons","Boutons personnalisés caméra","Botones de usuario de la cámara","Tasti camera"],viewfinderUserButtons:["Viewfinder User Buttons","Sucher-Buttons","Boutons personnalisés viseur","Botones de usuario del visor","Tasti mirino"],tripodHeadBrand:["Tripod Head Brand","Kopfmarke","Marque de la tête","Marca de la cabeza","Marca della testa"],tripodBowl:["Tripod Bowl","Schalentyp","Type de bol","Tipo de bowl","Tipo di bowl"],tripodTypes:["Tripod Types","Stativtypen","Types de trépied","Tipos de trípode","Tipi di treppiede"],tripodSpreader:["Tripod Spreader","Spreizer-Option","Type de spreader","Tipo de esparcidor","Tipo di spreader"],sliderBowl:["Slider Bowl","Slider-Schale","Slider bowl","Bowl del slider","Slider bowl"],easyrig:["Further Stabilisation","Weitere Stabilisierung","Stabilisation complémentaire","Estabilización adicional","Stabilizzazione aggiuntiva"]},da=["productionCompanyAddress","productionCompanyStreet","productionCompanyStreet2","productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"];function $f(e){return typeof e!="string"?"":e.trim().replace(/[:：]\s*$/,"").trim()}function Eh(e){var t={},r=typeof window<"u"&&window.texts?window.texts:null,n=r&&r.en&&r.en.projectFields||{},o=["productionCompany"].concat(da);return o.forEach(function(i){var s=new Set,a=function(l){if(typeof l=="string"){var f=$f(l);f&&s.add(f)}};e&&e[i]&&a(e[i]),n&&n[i]&&a(n[i]);var c=Kf[i];Array.isArray(c)&&c.forEach(a),t[i]=s}),t}function Ah(e,t,r){if(typeof e!="string")return null;var n=e.replace(/\r\n?/g,`
`).split(`
`).map(function(g){return g.trim()}).filter(function(g){return g});if(!n.length)return null;var o=Eh(t),i={},s=n[0];s&&(i.productionCompany=s);var a=Array.isArray(r?.lines)?r.lines:null;if(a&&a.length){var c={};if(a.forEach(function(g){if(!(!g||typeof g.text!="string")){var b=g.text.trim();if(b){var _=g.fields;typeof _=="string"&&(_=_.split(/\s+/)),!(!Array.isArray(_)||!_.length)&&_.map(function(w){return typeof w=="string"?w.trim():""}).filter(function(w){return w&&da.includes(w)}).forEach(function(w){c[w]||(c[w]=[]),c[w].push(b)})}}}),Object.keys(c).length){if(c.productionCompanyAddress&&c.productionCompanyAddress.length&&(i.productionCompanyAddress=c.productionCompanyAddress.join(`
`)),c.productionCompanyStreet&&c.productionCompanyStreet.length){var l=c.productionCompanyStreet;if(i.productionCompanyStreet=l[0],l.length>1){var f=l.slice(1).join(`
`);f&&(i.productionCompanyStreet2=f)}}if(c.productionCompanyStreet2&&c.productionCompanyStreet2.length){var u=c.productionCompanyStreet2.join(`
`);u&&(i.productionCompanyStreet2=i.productionCompanyStreet2?i.productionCompanyStreet2+`
`+u:u)}var y=function(g){if(!(!c[g]||!c[g].length)){var b=c[g].join(" ");b&&(i[g]=b)}};return["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"].forEach(y),i}}var p={},d=null;if(n.slice(1).forEach(function(g){var b=$f(g),_=null;if(da.forEach(function(w){_||!o[w]||o[w].has(b)&&(_=w)}),_){d=_,p[d]||(p[d]=[]);return}if(!d){i.productionCompany?i.productionCompany+=`
`+g:i.productionCompany=g;return}p[d]||(p[d]=[]),p[d].push(g)}),p.productionCompanyAddress&&p.productionCompanyAddress.length&&(i.productionCompanyAddress=p.productionCompanyAddress.join(`
`)),p.productionCompanyStreet&&p.productionCompanyStreet.length){var m=p.productionCompanyStreet;i.productionCompanyStreet=m[0],m.length>1&&(i.productionCompanyStreet2=m.slice(1).join(`
`))}return p.productionCompanyCity&&p.productionCompanyCity.length&&(i.productionCompanyCity=p.productionCompanyCity.join(" ")),p.productionCompanyRegion&&p.productionCompanyRegion.length&&(i.productionCompanyRegion=p.productionCompanyRegion.join(" ")),p.productionCompanyPostalCode&&p.productionCompanyPostalCode.length&&(i.productionCompanyPostalCode=p.productionCompanyPostalCode.join(" ")),p.productionCompanyCountry&&p.productionCompanyCountry.length&&(i.productionCompanyCountry=p.productionCompanyCountry.join(" ")),i}var Oh=(()=>{const e=new Map,t=r=>typeof r!="string"?"":r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return Object.entries(Kf).forEach(([r,n])=>{n.forEach(o=>{const i=t(o);i&&!e.has(i)&&e.set(i,r)})}),e})(),Ch={amp:"&",lt:"<",gt:">",quot:'"',apos:"'",nbsp:" "};function bo(e){return typeof e!="string"||!e?"":e.replace(/&(#x?[0-9a-fA-F]+|[a-zA-Z]+);/g,(t,r)=>{if(!r)return t;if(r[0]==="#"){const o=r[1]==="x"||r[1]==="X"?parseInt(r.slice(2),16):parseInt(r.slice(1),10);return Number.isFinite(o)?String.fromCodePoint(o):t}const n=Ch[r.toLowerCase()];return n!==void 0?n:t})}function So(e){if(typeof e!="string")return"";let t;do t=e,e=e.replace(/<[^>]*>/g,"");while(e!==t);return e}function _h(e,t){if(typeof e!="string")return"";const r=e.replace(/<\s*br\s*\/?\s*>/gi,`
`).replace(/<\/(p|div|li|ul|ol)>/gi,`
`).replace(/<li[^>]*>/gi,""),o=bo(So(r)).replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(i=>i.replace(/\s+/g," ").trim()).filter(i=>i);return o.length?t&&wh.has(t)?o.join(`
`):o.join(", "):""}function Ph(e){if(typeof e!="string")return null;const t=/<span([^>]*)>([\s\S]*?)<\/span>/gi,r=[];let n;for(;n=t.exec(e);){const o=n[1]||"";if(!/class=["'][^"']*req-sub-line[^"']*["']/i.test(o))continue;const i=n[2]||"",s=bo(So(i)).replace(/\s+/g," ").trim();if(!s)continue;const a=o.match(/data-fields=["']([^"']+)["']/i),c=a?null:o.match(/data-field=["']([^"']+)["']/i),l=a?a[1]:c?c[1]:"",f=typeof l=="string"?l.split(/\s+/).map(u=>u.trim()).filter(u=>u):[];r.push({text:s,fields:f})}return r.length?{lines:r}:null}function kh(e){if(typeof e!="string")return"";const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return t&&Oh.get(t)||""}function dl(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const r={},n=t.match(/<div[^>]*class=["'][^"']*requirements-grid[^"']*["'][^>]*>/i),o=n?n.index:-1;if(o===-1){const d=t.match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(d){const g=bo(So(d[1])).replace(/[“”"']/g,"").trim();g&&(r.projectName=g)}return Object.keys(r).length?r:null}const i=t.slice(o),a=t.slice(0,o).match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(a){const m=bo(So(a[1])).replace(/[“”"']/g,"").trim();m&&!/gear list/i.test(m)&&(r.projectName=m)}const c=/<div[^>]*class=["'][^"']*requirement-box[^"']*["'][^>]*>[\s\S]*?<\/div>/gi;let l;const f=typeof window<"u"&&window.texts?window.texts:null,u=typeof window<"u"&&window.currentLang?window.currentLang:null,y=typeof u=="string"&&f&&f[u]?u:"en",p=f&&f[y]&&f[y].projectFields?f[y].projectFields:f&&f.en&&f.en.projectFields?f.en.projectFields:{};for(;l=c.exec(i);){const d=l[0],m=d.match(/data-field=["']([^"']+)["']/i),g=d.match(/<span[^>]*class=["'][^"']*req-label[^"']*["'][^>]*>([\s\S]*?)<\/span>/i),b=d.match(/<span[^>]*class=["'][^"']*req-value[^"']*["'][^>]*>([\s\S]*)<\/span\s*>/i),_=m?m[1].trim():"",w=g?bo(So(g[1])):"",h=_||kh(w);if(!h)continue;const A=b?b[1]:"",C=_h(A,h);if(!C)continue;let j=C,O=null;if(h==="productionCompany"){O=Ph(A);const E=Ah(C,p,O);E&&typeof E=="object"&&(E.productionCompany&&(j=E.productionCompany),Object.entries(E).forEach(([I,B])=>{I!=="productionCompany"&&(Object.prototype.hasOwnProperty.call(r,I)||(r[I]=B))}))}Object.prototype.hasOwnProperty.call(r,h)||(r[h]=j)}return Object.keys(r).length?r:null}function Dn(e){if(Array.isArray(e))return e.map(t=>Dn(t));if(P(e)){const t={};return Object.entries(e).forEach(([r,n])=>{t[r]=Dn(n)}),t}return e}function ai(e){if(!P(e))return null;try{return gr(e)}catch(t){console.warn("Unable to serialize project info during normalization",t);try{return Dn(e)}catch(r){return console.warn("Unable to deep clone project info during normalization",r),{...e}}}}function vh(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(r=>{if(!P(r)){const u=uc(r);u!=null&&t.push(u);return}const n={},o=typeof r.name=="string"?r.name.trim():"";o&&(n.name=o);const i=typeof r.phone=="string"?r.phone.trim():"";i&&(n.phone=i);const s=typeof r.email=="string"?r.email.trim():"";s&&(n.email=s);const c=typeof r.website=="string"?r.website.trim():typeof r.url=="string"?r.url.trim():"";c&&(n.website=c);const l=typeof r.text=="string"?r.text.trim():"";l&&(n.text=l);const f=typeof r.role=="string"?r.role.trim():"";f&&(n.role=f),Object.keys(n).length&&t.push(n)}),t}function uc(e){if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t||null}if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="boolean")return e?!0:null;if(Array.isArray(e)){const t=e.map(r=>uc(r)).filter(r=>r!=null&&!(typeof r=="string"&&!r));return t.length?t:null}return P(e)?Vf(e):null}function Vf(e){if(!P(e))return null;const t={},r=[],n=new Set,o=a=>{if(typeof a!="string")return;const c=a.trim();!c||n.has(c)||(n.add(c),r.push(c))},i=(a,c={})=>{if(a==null)return;if(c.fromSelections){(Array.isArray(a)?a:[a]).forEach(u=>{if(re(u)){const p=ne(u);if(p){i(p,{fromSelections:!0});return}}if(P(u)){const p=fc(u);if(p.length){p.forEach(d=>{d&&typeof d.name=="string"&&o(d.name)});return}}const y=Te(u);y&&o(y)});return}const l=Ye(a);l.length&&l.forEach(f=>{o(f)})};if(i(e.lenses),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&i(e.lensSelections,{fromSelections:!0}),Object.entries(e).forEach(([a,c])=>{if(c==null)return;if(a==="people"){const f=vh(c);f.length&&(t.people=f);return}if(a==="lenses"){const{names:f}=Wf(c);t.lenses=f.slice();return}if(a==="lensSelections"){const f=ya(c,r);f.selections&&f.selections.length&&(t.lensSelections=f.selections);return}const l=uc(c);l!=null&&(t[a]=l)}),!Object.prototype.hasOwnProperty.call(t,"lenses")&&r.length&&(t.lenses=r.slice()),!Object.prototype.hasOwnProperty.call(t,"lensSelections")&&r.length){const a=ya([],r);a.selections&&a.selections.length&&(t.lensSelections=a.selections)}return Object.keys(t).length?ue(t):null}function jh(e){if(!Array.isArray(e)||!e.length)return null;try{return gr(e)}catch(t){console.warn("Unable to serialize automatic gear rules during normalization",t);try{return Dn(e)}catch(r){return console.warn("Unable to deep clone automatic gear rules during normalization",r),e.slice()}}}function Ih(e){if(!P(e)||!Object.keys(e).length)return{};try{return gr(e)}catch(t){console.warn("Unable to serialize diagram positions during normalization",t);try{return Dn(e)}catch(r){return console.warn("Unable to deep clone diagram positions during normalization",r),{...e}}}}var Ei="4x5.65";function ht(e){if(e==null)return[];if(Array.isArray(e)){const r=[];return e.forEach(n=>{if(n==null)return;if(Array.isArray(n)){r.push(...ht(n));return}if(re(n)){const i=ne(n);if(i){r.push(...ht(i));return}}if(typeof n=="object"){r.push(...ht(Object.values(n)));return}const o=String(n).trim();o&&r.push(o)}),r}if(re(e)){const r=ne(e);if(r)return ht(r)}if(typeof e=="object")return Object.prototype.hasOwnProperty.call(e,"values")?ht(e.values):Object.prototype.hasOwnProperty.call(e,"selected")?ht(e.selected):ht(Object.values(e));if(typeof e=="string"){const r=e.trim();if(!r||r==="!")return[];const n=Oe(r);return n.success?ht(n.parsed):r.split(/[|,]/).map(o=>o.trim()).filter(o=>o)}const t=String(e).trim();return t?[t]:[]}function jn(e,t=""){if(e==null)return null;if(typeof e=="string"){const r=e.trim();if(!r)return null;const n=Oe(r);if(n.success)return jn(n.parsed,t);const o=r.split(":"),i=o.shift(),s=i?i.trim():"";if(!s)return null;const a=o.shift(),c=a&&a.trim()?a.trim():Ei;if(!o.length)return{type:s,size:c,values:[],hasExplicitValues:!1};const l=o.join(":");if(l==="!")return{type:s,size:c,values:[],hasExplicitValues:!0};const f=ht(l);return{type:s,size:c,values:f,hasExplicitValues:!0}}if(Array.isArray(e)){if(!e.length)return null;if(e.length===1)return jn(e[0],t);const[r,n,o]=e;let i=typeof r=="string"?r.trim():"";if(!i&&typeof t=="string"&&(i=t.trim()),!i)return null;const s=typeof n=="string"&&n.trim()?n.trim():Ei,a=e.length>2,c=a?ht(o):[];return{type:i,size:s,values:c,hasExplicitValues:a}}if(re(e)){const r=ne(e);if(r)return jn(r,t)}if(typeof e=="object"){let r="";const n=["type","filter","name","label"];for(let l=0;l<n.length;l+=1){const f=n[l];if(typeof e[f]=="string"){const u=e[f].trim();if(u){r=u;break}}}if(!r&&typeof t=="string"&&t.trim()&&(r=t.trim()),!r)return null;const o=["size","filterSize","format","dimension","dimensions","diameter"];let i="";for(let l=0;l<o.length;l+=1){const f=o[l];if(typeof e[f]=="string"){const u=e[f].trim();if(u){i=u;break}}}i||(i=Ei);const s=["values","value","strengths","strength","options","selected","selections","choices"];let a=!1,c=[];for(let l=0;l<s.length;l+=1){const f=s[l];if(Object.prototype.hasOwnProperty.call(e,f)){a=!0,c=ht(e[f]);break}}return{type:r,size:i,values:c,hasExplicitValues:a}}return null}function zs(e){if(!e||!e.type)return null;const t=e.type,r=e.size&&e.size.trim()?e.size.trim():Ei;let n=`${t}:${r}`;const o=Array.isArray(e.values)?Array.from(new Set(e.values.map(i=>typeof i=="string"?i.trim():String(i??"").trim()).filter(i=>i))):[];return(e.hasExplicitValues||o.length)&&(n+=o.length?`:${o.join("|")}`:":!"),n}function Wi(e){if(e===void 0)return null;if(e===null)return"";if(typeof e=="string"){const t=e.trim();if(!t)return"";const r=Oe(t);return r.success?Wi(r.parsed):t}if(Array.isArray(e)){const t=e.map(r=>jn(r)).filter(Boolean);return t.length?t.map(r=>zs(r)).filter(Boolean).join(","):""}if(re(e)){const t=ne(e);if(t)return Wi(t)}if(typeof e=="object"){const t=jn(e);if(t)return zs(t)||"";const r=[];return Object.entries(e).forEach(([n,o])=>{const i=jn(o,n);i&&r.push(i)}),r.length?r.map(n=>zs(n)).filter(Boolean).join(","):""}return String(e).trim()}function Bs(e){if(!P(e))return;const t=Wi(e.filter);if(t!==null)t?e.filter=t:delete e.filter;else{const r=Wi(e.filters);r!==null&&(r?e.filter=r:delete e.filter)}Object.prototype.hasOwnProperty.call(e,"filters")&&delete e.filters}function so(e){if(!P(e))return null;const t=n=>{if(Array.isArray(n))return n.map(i=>t(i)).filter(i=>i!==void 0);if(P(n)){const o={};return Object.entries(n).forEach(([i,s])=>{if(typeof i!="string"||!i)return;const a=t(s);a!==void 0&&(o[i]=a)}),o}if(n==null)return"";if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean")return String(n);try{return String(n)}catch{}return""},r={};return Object.entries(e).forEach(([n,o])=>{if(typeof n!="string"||!n)return;const i=t(o);i!==void 0&&(r[n]=i)}),Object.keys(r).length?r:null}function fo(e){if(e==null)return null;const t=o=>typeof o=="string"?o.trim():o==null?"":typeof o=="number"||typeof o=="boolean"?String(o):"";if(!P(e))return null;const r={batteryPlate:t(e.batteryPlate),battery:t(e.battery),batteryHotswap:t(e.batteryHotswap)};return Object.keys(r).some(o=>r[o])?r:null}function Lh(e){const t=fo(e);return t?{batteryPlate:t.batteryPlate,battery:t.battery,batteryHotswap:t.batteryHotswap}:null}const Rh=new Set(["name","lensname","label","title","text","lens","mount","mountlabel","mountname","mounts","note","notes","names","values","selection","legacyvalue","lensselections","selections","entries","items","options","meta","metadata","count","version","length","size","updated","created","createdat","timestamp","id","uuid","key","value"]);function Hf(e){if(typeof e!="string")return!1;const t=e.trim();if(!t||/^[0-9]+$/u.test(t))return!1;const r=t.toLowerCase();return!(r.startsWith("__proto__")||r==="prototype"||r==="constructor"||Rh.has(r))}function qf(e){if(!P(e))return[];const t=Object.keys(e),r=[];return t.forEach(n=>{if(!Hf(n))return;const o=n.trim();o&&r.push(o)}),r}function Te(e){if(e==null)return"";if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return(typeof e=="string"?e:String(e)).trim();if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Te(e[t]);if(r)return r}return""}if(re(e)){const t=ne(e);if(t)return Te(t)}if(P(e)){const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i=="string"){const s=i.trim();if(s)return s}}const r=qf(e);if(r.length)return r[0];if(Array.isArray(e.names)&&e.names.length){const o=Te(e.names[0]);if(o)return o}if(Array.isArray(e.values)&&e.values.length){const o=Te(e.values[0]);if(o)return o}const n=Object.values(e);for(let o=0;o<n.length;o+=1){const i=Te(n[o]);if(i)return i}}return""}function Ye(e){if(e==null)return[];if(Array.isArray(e)){const t=[];return e.forEach(r=>{if(r==null)return;if(typeof r=="string"){const o=Oe(r);if(o.success){t.push(...Ye(o.parsed));return}const i=r.trim();i&&t.push(i);return}if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint"){t.push(String(r));return}const n=Te(r);if(n){t.push(n);return}if(Array.isArray(r)){t.push(...Ye(r));return}if(re(r)){const o=ne(r);o&&t.push(...Ye(o));return}P(r)&&t.push(...Ye(Object.values(r)))}),t}if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return[String(e)];if(typeof e=="string"){const t=Oe(e);return t.success?Ye(t.parsed):e.split(/[\n,;]/u).map(r=>r.trim()).filter(r=>r)}if(re(e)){const t=ne(e);if(t)return Ye(t)}if(P(e)){const t=qf(e);if(t.length)return t;const r=Te(e);if(r)return[r];const n=[];return Array.isArray(e.names)&&n.push(...Ye(e.names)),Array.isArray(e.values)&&n.push(...Ye(e.values)),n.length||n.push(...Ye(Object.values(e))),n}return[]}function Wf(e){const t=Ye(e),r=Array.isArray(e)&&e.length===t.length&&e.every((n,o)=>typeof n=="string"&&n.trim()===t[o]);return{names:t,changed:!r}}function Ai(e){if(e==null)return{selection:null,changed:!1};if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"){const t=Te(e);return t?{selection:{name:t,mount:""},changed:!0}:{selection:null,changed:!0}}if(re(e)){const t=ne(e);if(t)return Ai(t)}if(Array.isArray(e)){if(!e.length)return{selection:null,changed:!0};const t=Te(e[0]);if(!t)return{selection:null,changed:!0};const r=e.length>1?e[1]:"",n=typeof r=="string"?r.trim():"",o={name:t};return o.mount=n||"",{selection:o,changed:!0}}if(P(e)){const t={...e};let r=!1;const n=Te(e);if(!n)return{selection:null,changed:!0};t.name!==n&&(t.name=n,r=!0),Object.prototype.hasOwnProperty.call(t,"name")||(t.name=n,r=!0);const o=[];if(typeof e.mount=="string"&&o.push(e.mount),typeof e.mountLabel=="string"&&o.push(e.mountLabel),typeof e.mountName=="string"&&o.push(e.mountName),Array.isArray(e.mounts))for(let s=0;s<e.mounts.length;s+=1){const a=e.mounts[s];if(typeof a=="string"&&a.trim()){o.push(a);break}}let i="";for(let s=0;s<o.length;s+=1){const a=o[s];if(typeof a=="string"){const c=a.trim();if(c){i=c;break}}}if(typeof t.mount=="string"){const s=t.mount.trim();s!==t.mount&&(t.mount=s,r=!0),!i&&s&&(i=s)}return i||(i=""),t.mount!==i&&(t.mount=i,r=!0),Object.prototype.hasOwnProperty.call(t,"mount")||(t.mount=i,r=!0),{selection:t,changed:r}}return{selection:null,changed:!0}}function fc(e){if(!P(e))return[];const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let n=0;n<t.length;n+=1){const o=t[n];if(typeof o=="string"&&o.trim())return[]}const r=[];return Object.entries(e).forEach(([n,o])=>{if(!Hf(n))return;const i=n.trim();if(!i)return;let s=o;if(re(s)){const l=ne(s);l&&(s=l)}if(P(s)){const l={...s};l.name=i;let f="";const u=["mount","mountLabel","mountName"];for(let y=0;y<u.length;y+=1){const p=u[y];if(typeof l[p]!="string")continue;const d=l[p].trim();if(d&&d.toLowerCase()!==i.toLowerCase()){f=d;break}}if(!f&&Array.isArray(l.mounts)){const y=Te(l.mounts);y&&y.toLowerCase()!==i.toLowerCase()&&(f=y)}l.mount=typeof f=="string"?f:"",r.push(l);return}if(Array.isArray(s)){const l=Te(s),f=l&&l.toLowerCase()!==i.toLowerCase()?l:"";r.push({name:i,mount:f});return}if(typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"){const l=Te(s),f=l&&l.toLowerCase()!==i.toLowerCase()?l:"";r.push({name:i,mount:f});return}if(s==null){r.push({name:i,mount:""});return}const a=Te(s),c=a&&a.toLowerCase()!==i.toLowerCase()?a:"";r.push({name:i,mount:c})}),r}function ya(e,t=[]){const r=Array.isArray(e)?e:[e],n=[],o=new Set;let i=!1;const s=(c,l)=>{if(!c||typeof c!="object"){l&&(i=!0);return}const f={...c},y=(typeof f.name=="string"?f.name:"").trim();if(!y){l&&(i=!0);return}f.name!==y&&(f.name=y,l=!0);const d=(typeof f.mount=="string"?f.mount:"").trim();if(f.mount!==d&&(f.mount=d,l=!0),Object.prototype.hasOwnProperty.call(f,"mount")||(f.mount=d,l=!0),Object.prototype.hasOwnProperty.call(f,"mountState")){const g=(typeof f.mountState=="string"?f.mountState:"").trim();f.mountState!==g&&(f.mountState=g,l=!0),g||(delete f.mountState,l=!0)}l&&(i=!0),n.push(f),o.add(y)},a=c=>{if(c==null)return;if(typeof c=="string"){const f=Oe(c);if(f.success){a(f.parsed),i=!0;return}const u=Ye(c);u.length?u.forEach(y=>{s({name:y,mount:""},!0)}):i=!0;return}if(typeof c=="number"||typeof c=="boolean"||typeof c=="bigint"){s({name:String(c),mount:""},!0);return}if(Array.isArray(c)){if(c.length&&c.length<=2&&(typeof c[0]=="string"||typeof c[0]=="number"||typeof c[0]=="boolean"||typeof c[0]=="bigint")){const{selection:f,changed:u}=Ai(c);if(f){s(f,u);return}}c.forEach(f=>{const{selection:u,changed:y}=Ai(f);u?s(u,y):y&&(i=!0)});return}if(re(c)){const f=ne(c);f&&(a(f),i=!0);return}if(P(c)){const f=fc(c);if(f.length){f.forEach(d=>{s(d,!0)});return}const{selection:u,changed:y}=Ai(c);if(u){s(u,y);return}const p=Object.values(c);p.length&&(a(p),i=!0);return}const l=Te(c);l?s({name:l,mount:""},!0):i=!0};for(let c=0;c<r.length;c+=1)a(r[c]);return Array.isArray(t)&&t.forEach(c=>{if(typeof c!="string")return;const l=c.trim();!l||o.has(l)||(n.push({name:l,mount:""}),o.add(l),i=!0)}),n.length?{selections:n,changed:i}:{selections:null,changed:i}}function $e(e){const t=ms(e);if(t.restored)return $e(t.value);if(typeof e=="string"){const r=Oe(e);if(r.success){const n=$e(r.parsed);if(n)return n}return $e({gearList:e,projectInfo:null})}if(re(e)){const r=ne(e);return r?$e(r):null}if(P(e)){if(Object.prototype.hasOwnProperty.call(e,"gearList")||Object.prototype.hasOwnProperty.call(e,"projectInfo")){const r=re(e.project)?ne(e.project):e.project;let n=e.projectInfo;re(n)&&(n=ne(n));let o=P(n)?n:null;if(!o&&typeof n=="string"){const O=Oe(n);O.success&&P(O.parsed)&&(o=O.parsed)}if(!o&&P(r)){let O=r.projectInfo;if(re(O)&&(O=ne(O)),P(O))o=O;else if(typeof O=="string"){const E=Oe(O);E.success&&P(E.parsed)&&(o=E.parsed)}}let i=null;const s=O=>{if(i&&i.length||O==null)return;let E=O;if(re(E)){const I=ne(E);I&&(E=Object.values(I).filter(B=>B!=null))}if(Array.isArray(E)&&E.length){i=E;return}if(P(E)){const I=Object.values(E).filter(B=>B!=null);if(I.length){i=I;return}}if(typeof E=="string"){const I=Oe(E);I.success&&Array.isArray(I.parsed)&&I.parsed.length&&(i=I.parsed)}};s(e.autoGearRules),!i&&P(r)&&s(r.autoGearRules);let a=re(e.gearList)?ne(e.gearList):e.gearList;if((a==null||typeof a=="string"&&!a)&&P(r)&&Object.prototype.hasOwnProperty.call(r,"gearList")&&(a=r.gearList),re(a)){const O=ne(a);O&&(a=O)}let c=typeof a=="string"||a&&typeof a=="object"?a:"",l=null;const f=re(e.gearSelectors)?ne(e.gearSelectors):e.gearSelectors;if(P(f))l=so(f);else if(typeof f=="string"){const O=Oe(f);O.success&&P(O.parsed)&&(l=so(O.parsed))}const u=re(e.powerSelection)?ne(e.powerSelection):e.powerSelection;let y=fo(u);if(!y&&P(u)&&(y=fo(u)),typeof c=="string"){const O=Oe(c);if(O.success){const E=$e(O.parsed);E?(c=E.gearList,!o&&E.projectInfo&&(o=E.projectInfo),(!i||!i.length)&&Array.isArray(E.autoGearRules)&&E.autoGearRules.length&&(i=E.autoGearRules),!l&&P(E.gearSelectors)&&(l=so(E.gearSelectors)),!y&&P(E.powerSelection)&&(y=fo(E.powerSelection))):(typeof O.parsed=="string"||P(O.parsed)&&Object.values(O.parsed).every(I=>typeof I=="string"))&&(c=O.parsed)}}c&&typeof c=="object"&&!P(c)&&(c=""),o&&Bs(o),o&&(o=Vf(o)||null),o&&Bs(o);const p={gearList:Array.isArray(c)||P(c)?Dn(c):c,projectInfo:o?ai(o):null},d=re(e.diagramPositions)?ne(e.diagramPositions):e.diagramPositions;let m=pa(d);if(Object.keys(m).length===0&&P(r)){const O=re(r.diagramPositions)?ne(r.diagramPositions):r.diagramPositions;m=pa(O)}Object.keys(m).length&&(p.diagramPositions=Ih(m));const g=[];if(typeof e.projectHtml=="string"&&g.push(e.projectHtml),typeof e.gearHtml=="string"&&g.push(e.gearHtml),P(r)&&(typeof r.projectHtml=="string"&&g.push(r.projectHtml),typeof r.gearHtml=="string"&&g.push(r.gearHtml)),P(a)&&typeof a.gearHtml=="string"&&g.push(a.gearHtml),P(c)?(typeof c.projectHtml=="string"&&g.push(c.projectHtml),typeof c.gearHtml=="string"&&g.push(c.gearHtml)):typeof c=="string"&&g.push(c),!l&&P(r)){const O=re(r.gearSelectors)?ne(r.gearSelectors):r.gearSelectors;P(O)&&(l=so(O))}if(!l&&P(c)&&P(c.gearSelectors)&&(l=so(c.gearSelectors)),!y&&P(r)){const O=re(r.powerSelection)?ne(r.powerSelection):r.powerSelection;P(O)&&(y=fo(O))}if(o){if(g.length)for(let O=0;O<g.length;O+=1){const E=dl(g[O]);if(E){const I=ai(E)||{},B=ai(o)||{};p.projectInfo={...I,...B};break}}}else for(let O=0;O<g.length;O+=1){const E=dl(g[O]);if(E){p.projectInfo=ai(E);break}}const b=[],_=new Set,w=O=>{if(typeof O!="string")return;const E=O.trim();!E||_.has(E)||(_.add(E),b.push(E))},h=(O,E={})=>{if(O==null)return;if(E.fromSelections){(Array.isArray(O)?O:[O]).forEach(M=>{if(re(M)){const N=ne(M);if(N){h(N,{fromSelections:!0});return}}if(P(M)){const N=fc(M);if(N.length){N.forEach(z=>{z&&typeof z.name=="string"&&w(z.name)});return}}const G=Te(M);G&&w(G)});return}const I=Ye(O);I.length&&I.forEach(B=>{w(B)})};if(p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lenses")){const{names:O}=Wf(p.projectInfo.lenses);p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=O.slice(),h(O)}h(e.lenses),P(r)&&h(r.lenses),h(a&&a.lenses),P(c)&&h(c.lenses),(!p.projectInfo||!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&b.length&&(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=b.slice());const A=[];p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&(h(p.projectInfo.lensSelections,{fromSelections:!0}),A.push(p.projectInfo.lensSelections)),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&(h(e.lensSelections,{fromSelections:!0}),A.push(e.lensSelections)),P(r)&&Object.prototype.hasOwnProperty.call(r,"lensSelections")&&(h(r.lensSelections,{fromSelections:!0}),A.push(r.lensSelections)),P(a)&&Object.prototype.hasOwnProperty.call(a,"lensSelections")&&(h(a.lensSelections,{fromSelections:!0}),A.push(a.lensSelections)),P(c)&&Object.prototype.hasOwnProperty.call(c,"lensSelections")&&(h(c.lensSelections,{fromSelections:!0}),A.push(c.lensSelections));const C=ya(A,b);C&&C.selections&&C.selections.length?(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lensSelections=C.selections,(!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&(p.projectInfo.lenses=C.selections.map(O=>typeof O.name=="string"?O.name:"").filter(O=>O))):C&&C.changed&&p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&delete p.projectInfo.lensSelections;const j=typeof e.gearListAndProjectRequirementsGenerated=="boolean"?e.gearListAndProjectRequirementsGenerated:g.some(O=>typeof O=="string"&&O.trim());if(p.gearListAndProjectRequirementsGenerated=j,i&&i.length&&(p.autoGearRules=jh(i)),l&&Object.keys(l).length&&(p.gearSelectors=l),y&&(p.powerSelection=Lh(y)),nm(e,p),p.projectInfo&&Bs(p.projectInfo),p.projectInfo){const O=ue(p.projectInfo);O!==p.projectInfo&&(p.projectInfo=O)}if(p.autoGearRules){const O=ue(p.autoGearRules);O!==p.autoGearRules&&(p.autoGearRules=O)}if(p.gearSelectors){const O=ue(p.gearSelectors);O!==p.gearSelectors&&(p.gearSelectors=O)}if(p.diagramPositions){const O=ue(p.diagramPositions);O!==p.diagramPositions&&(p.diagramPositions=O)}if(p.powerSelection){const O=ue(p.powerSelection);O!==p.powerSelection&&(p.powerSelection=O)}return p}if(Object.prototype.hasOwnProperty.call(e,"projectHtml")||Object.prototype.hasOwnProperty.call(e,"gearHtml"))return{gearList:{projectHtml:e.projectHtml||"",gearHtml:e.gearHtml||""},projectInfo:null};if(P(e.project)){const r=$e(e.project);if(r)return r}else if(typeof e.project=="string"){const r=Oe(e.project);if(r.success){const n=$e(r.parsed);if(n)return n}}}return null}var Th=new Set(["gearList","projectInfo","projectHtml","gearHtml","autoGearRules","powerSelection","gearListAndProjectRequirementsGenerated"]),Mh=new Set(["gearList","projectInfo","autoGearRules","diagramPositions","gearSelectors","powerSelection","gearListAndProjectRequirementsGenerated"]);function Yi(e){if(!P(e)||!Object.keys(e).every(o=>Mh.has(o)))return!1;const{gearList:r,projectInfo:n}=e;if(typeof r!="string"&&!(P(r)&&Object.keys(r).every(o=>typeof r[o]=="string"))||n!==null&&!P(n)||Object.prototype.hasOwnProperty.call(e,"autoGearRules")&&(!Array.isArray(e.autoGearRules)||!e.autoGearRules.length)||Object.prototype.hasOwnProperty.call(e,"diagramPositions")&&!P(e.diagramPositions)||Object.prototype.hasOwnProperty.call(e,"gearSelectors")&&!P(e.gearSelectors))return!1;if(Object.prototype.hasOwnProperty.call(e,"powerSelection")){const o=e.powerSelection;if(!P(o))return!1}return!(Object.prototype.hasOwnProperty.call(e,"gearListAndProjectRequirementsGenerated")&&typeof e.gearListAndProjectRequirementsGenerated!="boolean")}function Be(e){return typeof e!="string"?"":e.trim()}function Nh(e){if(e==null)return rr="",xt=!1,"";const t=Be(e);return jm(t)?(rr="",xt=!1,t):(rr=t,xt=!0,t)}function Gh(e){return!xt||e!==void 0&&Be(e)!==rr?!1:(rr="",xt=!1,!0)}function en(e,t,r,n={}){if(!e||typeof e!="object")return null;const o=typeof r=="string"?r:"";if(Object.prototype.hasOwnProperty.call(e,o))return o;const i=Be(o);if(i&&i!==o&&Object.prototype.hasOwnProperty.call(e,i))return i;if(!t||typeof t!="object")return null;const{raw:s,normalized:a}=t;if(s&&typeof s.get=="function"&&s.has(o)){const c=s.get(o);if(Object.prototype.hasOwnProperty.call(e,c))return c}if(a&&typeof a.get=="function"&&a.has(i)){const c=a.get(i);if(Array.isArray(c)){if(n&&n.preferExact&&o){const f=c.find(u=>u===o&&Object.prototype.hasOwnProperty.call(e,u));if(f)return f}const l=c.find(f=>Object.prototype.hasOwnProperty.call(e,f));if(l)return l}else if(typeof c=="string"&&Object.prototype.hasOwnProperty.call(e,c))return c}return null}function zh(e={}){const t=new Map,r=new Map;return(e&&typeof e=="object"?Object.keys(e):[]).forEach(o=>{if(typeof o!="string")return;t.set(o,o);const i=Be(o);r.has(i)||r.set(i,[]),r.get(i).push(o)}),{raw:t,normalized:r}}function kt(e={}){const{forceRefresh:t=!1,forMutation:r=!1,skipMigrations:n=!1,skipAutoBackupExpansion:o=!1}=e||{};if(n||Pe(),ur&&!t){const E={...Ve},I=zh(E);return{projects:E,changed:!1,originalValue:{...Ve},lookup:ra(I)}}const i=T();let s=null;if(i&&typeof i.getItem=="function")try{s=i.getItem(pe)}catch{s=null}const a=Me(i,pe,"Error loading project from localStorage:",null,{validate:E=>E===null||typeof E=="string"||Array.isArray(E)||P(E)}),c=a;let l=null;if(P(a)?l={...a}:l={},i&&typeof i.length=="number"){const E=i.length;for(let I=0;I<E;I++){const B=i.key(I);if(!B||!B.startsWith(Bt))continue;const M=B.substring(Bt.length);if(M!=null)try{const G=i.getItem(B),N=JSON.parse(nr(G));l===null&&(l={}),l[M]=N}catch{}}}let f=a;(l!==null&&Object.keys(l).length>0||P(a))&&(f=l);const u={isAutoBackupKey:Vt};o&&(u.filter=E=>!Vt(E));const y=hf(f,u),p={};let d=!1;const m=new Set,g=new Set,b=E=>{if(typeof E!="string")return;m.add(E);const I=E.trim();I&&g.add(I.toLowerCase())},_=new Map,w=new Map,h=(E,I)=>{if(typeof E!="string")return;const B=typeof I=="string"?I:E;_.set(E,B);const M=Be(E);w.has(M)||w.set(M,[]),w.get(M).push(B)},A=()=>({raw:Bn(_),normalized:Bn(w)}),C=()=>{const E={projects:p,changed:d,originalValue:c,lookup:A(),rawValue:s};return d?(Yc(null),r?{projects:gr(E.projects),changed:E.changed,originalValue:E.originalValue,lookup:ra(E.lookup)}:E):t?E:(Yc(E),qg({forMutation:r})||E)};if(y==null)return C();if(typeof y=="string"){const E=$e(y);if(E){const I=E&&E.projectInfo&&typeof E.projectInfo.projectName=="string"?E.projectInfo.projectName:"",B=io(I,m,g);p[B]=E,h("",B),b(B)}return d=!0,C()}if(Array.isArray(y)){const E=m,I=g;return y.forEach((B,M)=>{const G=$e(B);if(!G){d=!0;return}const z=(P(B)&&typeof B.name=="string"?B.name.trim():`Project ${M+1}`)||`Project ${M+1}`,$=io(z,E,I);p[$]=G,h(z,$),b($)}),d=!0,C()}if(!P(y))return d=!0,C();const j=Object.keys(y);if(j.length>0&&j.every(E=>Th.has(E))){const E=$e(y);if(E){const I=io("",m,g);p[I]=E,h("",I),b(I)}return d=!0,C()}return j.forEach(E=>{if(Yi(y[E])){const I=typeof E=="string"?E.trim():"";I&&g.add(I.toLowerCase())}}),j.forEach(E=>{const I=$e(y[E]);if(I){const B=y[E],G=!Yi(B);let N=!1;if(!G)try{const $=_e(I),Ht=_e(B);$!==Ht&&(N=!0)}catch($){N=!0,console.warn("Unable to compare stored project entry during legacy long-GOP normalization check",$)}let z=E;if(G){const $=I&&I.projectInfo&&typeof I.projectInfo.projectName=="string"&&I.projectInfo.projectName?I.projectInfo.projectName:E;z=io($,m,g),d=!0}z!==E&&Object.prototype.hasOwnProperty.call(p,z)&&(z=io(z,m,g)),p[z]=I,h(E,z),b(z),!G&&N&&(d=!0)}else d=!0}),C()}function Yf(e,t){if(!e||typeof e.length!="number"||!P(t))return;const r=new Set(Object.keys(t).map(o=>Be(o))),n=[];for(let o=0;o<e.length;o+=1){const i=e.key(o);if(i&&i.startsWith(Bt)){const s=i.substring(Bt.length);r.has(s)||n.push(i)}}n.forEach(o=>Ee(e,o,"Pruning orphan project shard:"))}function Jf(e){if(!e||S&&S.__cineMonolithicProjectCleanupDone)return;const t=e.getItem(pe);if(!t){S&&(S.__cineMonolithicProjectCleanupDone=!0);return}try{const r=JSON.parse(nr(t));r&&yt(e,pe,r)}catch{}Ee(e,pe,"Error clearing project monolithic storage after sharding:",{disableBackup:!1,disableMigrationCleanup:!0}),S&&(S.__cineMonolithicProjectCleanupDone=!0)}function Qf(e,t,r={}){if(e==null||t===void 0||t===null)return!1;const n=T();if(!n)return!1;const{skipCompression:o=!1}=r||{},i=Bt+Be(e),s={};s[e]=t;const c=bf(s,{isAutoBackupKey:Vt})[e];return Ae(n,i,c,`Error saving project shard "${e}":`,{disableCompression:o,forceCompressionOnQuota:!0,disableBackup:!0,onQuotaExceeded:()=>{const{projects:f}=kt({forMutation:!1,skipMigrations:!0});let u=ca(f);if(u||(u=ca(f,{force:!0})),u){const y=Bt+Be(u);return Ee(n,y,`Pruning shard "${u}" to recover space:`),!0}return!1}})==="success"}function pc(e,t={}){const{skipCompression:r=!1}=t||{},n=T();if(!(!e||typeof e!="object")){sc(e),Yf(n,e),Object.keys(e).forEach(o=>{Qf(o,e[o],{skipCompression:r})}),Jf(n),Za(n);try{Ro(e,n)}catch(o){console.warn("Failed to update project index",o)}if(fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}}}let Un=null;function dc(e){if(!e||typeof e!="object")return null;const t={};return Object.keys(e).forEach(n=>{if(typeof n!="string")return;const o=k&&typeof k.getProjectKeyFromStorageKey=="function"?k.getProjectKeyFromStorageKey(n):n;if(o==null)return;const i=e[n];if(!Object.prototype.hasOwnProperty.call(t,o)){t[o]=i;return}const s=t[o],a=i&&typeof i=="object"&&typeof i.lastModified=="number"?i.lastModified:null,c=s&&typeof s=="object"&&typeof s.lastModified=="number"?s.lastModified:null;typeof a=="number"&&typeof c=="number"&&a>c&&(t[o]=i)}),Object.keys(t).length?t:null}function Xf(e){if(!e||typeof e!="object")return null;if(!k||typeof k.getProjectStorageKey!="function")return e;const t={};return Object.keys(e).forEach(r=>{if(typeof r!="string")return;const n=k.getProjectStorageKey(r);t[n]=e[r]}),t}async function Bh(){if(!k||typeof k.migrateUnprefixedProjectRecords!="function")return{migratedKeys:[],hasIndex:!1};try{const e=await k.getItem(zn),t=e&&typeof e=="object"?Object.keys(e):[],r=dc(e),n=await k.migrateUnprefixedProjectRecords({projectIndexKeys:t});if(r){Un=r;const o=Xf(r);o&&await k.setItem(zn,o)}return{migratedKeys:n.migratedKeys||[],hasIndex:!!r}}catch(e){return console.warn("[storage.js] Project prefix migration failed",e),{migratedKeys:[],hasIndex:!1}}}function xh(){if(Un)return Un;const e=T(),t=k&&k.driver&&k.driver.constructor&&k.driver.constructor.name==="IndexedDBAdapter";if(!e||typeof e.getItem!="function"||t)return null;try{const r=e.getItem(zn);if(!r)return null;const n=JSON.parse(r);if(n&&typeof n=="object")return dc(n)||n}catch(r){console.warn("Failed to read project index",r)}return null}function Ro(e,t){if(!e||typeof e!="object")return;const r={};Object.keys(e).forEach(o=>{if(Vt(o))return;const i=e[o];i&&(r[o]={color:i.color,icon:i.icon,lastModified:i.lastModified,prepDays:i.prepDays,shootingDays:i.shootingDays,returnDays:i.returnDays,archived:i.archived,status:i.status})}),Un=r;const n=k&&k.driver&&k.driver.constructor&&k.driver.constructor.name==="IndexedDBAdapter";if(k){const o=Xf(r);k.setItem(zn,o).catch(i=>console.warn("Failed to persist index to repo",i))}if(!n&&t&&typeof t.setItem=="function")try{t.setItem(zn,JSON.stringify(r))}catch(o){console.warn("Failed to write project index",o)}}function Zf(e){const t=e!==void 0&&!(typeof e=="string"&&Vt(e));let{projects:r,changed:n,originalValue:o,lookup:i}=kt({skipAutoBackupExpansion:t}),s=null;if(e!==void 0&&(s=en(r,i,e,{preferExact:!0}),s!=null&&hs(s)),n){const a=T();a&&yt(a,pe,o);const c=gr(r);pc(c),r=c}if(e===void 0)return km(r),r;if(s!=null&&Object.prototype.hasOwnProperty.call(r,s)){const a=r[s];if(a&&(!a.gearList||a.gearList==="")){const l=Yo()[s];l&&l.gearList&&(a.gearList=l.gearList)}return a}return null}function Fh(){const e=xh();if(e)return e;const t=kt({forMutation:!1,skipAutoBackupExpansion:!0}),r={};if(t&&t.projects){const n=Object.keys(t.projects);for(let i=0;i<n.length;i++){const s=n[i];if(Vt(s))continue;const a=t.projects[s];a&&(r[s]={color:a.color,icon:a.icon,lastModified:a.lastModified,prepDays:a.prepDays,shootingDays:a.shootingDays,returnDays:a.returnDays,archived:a.archived,status:a.status})}const o=T();if(o)try{Ro(t.projects,o)}catch{}}return r}function ep(e){if(typeof e!="string")return"";const t=e.replace(/\s+/g," ").trim();return t?t.length<=120?t:t.slice(0,120):""}function tp(e){const t=r=>String(r).padStart(2,"0");return[e.getFullYear(),t(e.getMonth()+1),t(e.getDate()),t(e.getHours()),t(e.getMinutes()),t(e.getSeconds())].join("-")}function Dh(e,t){const n=tp(new Date),o=ep(e),i=o?`${_t}${n}-${o}`:`${_t}${n}`,s=new Set(Object.keys(t));if(!s.has(i))return{name:i};let a=2,c=`${i}-${a}`;for(;s.has(c);)a+=1,c=`${i}-${a}`;return{name:c}}function rp(e){if(e!==void 0){if(e===null||typeof e!="object")return e;try{const t=gr(e),r=ue(t);return r!==t?r:t}catch(t){console.warn("Unable to deep clone project for backup",t);const r={...e},n=ue(r);return n!==r?n:r}}}function np(e,t){if(!e||!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(typeof t=="string"&&t.startsWith(De))return{status:"skipped"};const r=e[t];if(r===void 0)return{status:"missing"};const{name:n}=Dh(t,e);if(!n)return{status:"failed"};const o=rp(r);return o===void 0?(typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipping deletion backup for project "${t}" because no stored data was available during backup creation.`),{status:"missing"}):(e[n]=o,{status:"created",backupName:n})}function Uh(e){const{projects:t,changed:r,originalValue:n,lookup:o}=kt({forMutation:!0});if(!t||typeof t!="object")return{status:"invalid"};const i=en(t,o,e,{preferExact:!0}),s=Be(e),a=i??s;if(!Object.prototype.hasOwnProperty.call(t,a))return{status:"missing"};const c=np(t,a);if(c.status!=="created")return c;if(r){const l=T();l&&yt(l,pe,n)}return hs(c.backupName),pc(t),c}function Kh(e,t){const r=tp(new Date),n=ep(e),o=n?`${De}${r}-${n}`:`${De}${r}`,i=new Set(Object.keys(t));if(!i.has(o))return{name:o};let s=2,a=`${o}-${s}`;for(;i.has(a);)s+=1,a=`${o}-${s}`;return{name:a}}function $h(e,t){if(!P(e)||typeof t!="string")return{status:"invalid"};if(!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(t.startsWith(De)||t.startsWith(_t))return{status:"skipped"};const r=rp(e[t]);if(r===void 0)return{status:"failed"};const{name:n}=Kh(t,e);return n?(e[n]=r,{status:"created",backupName:n}):{status:"failed"}}function yc(e,t,r={}){if(!P(t))return;const n=$e(t);if(!n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped saving project "${e||""}" because the payload could not be normalised.`);return}const o=!!(r&&r.skipOverwriteBackup),i=!!(r&&r.skipCompression),s=typeof e=="string"?e:"",a=Be(s),c=kt({forMutation:!0}),l=P(c.projects)?c.projects:{};if(c.changed){const E=T();E&&yt(E,pe,c.originalValue)}const f=en(l,c.lookup,s,{preferExact:!0}),u=f!=null&&Object.prototype.hasOwnProperty.call(l,f)?l[f]:null,y=u?_e(u):null,p=kt({forMutation:!0}),d=P(p.projects)?p.projects:{};if(p.changed){const E=T();E&&yt(E,pe,p.originalValue)}const m=en(d,p.lookup,s,{preferExact:!0});let g=m,b=null;a&&a!==m&&!Object.prototype.hasOwnProperty.call(d,a)&&(g=a,b=m),g==null&&(g=a),!g&&g!==""&&(g="");const _=b??g,w=_!=null&&Object.prototype.hasOwnProperty.call(d,_),h=w?d[_]:null;if(w&&!o){const E=_e(h),I=_e(n);E!==I&&$h(d,_).status==="failed"&&console.warn(`Automatic backup before overwriting project "${_}" failed. Proceeding with save.`)}if(b!=null&&b!==g){let E=!!y;Object.prototype.hasOwnProperty.call(d,b)&&y?_e(d[b])!==y&&(E=!1):E=!1,E?(delete d[b],ia(b)):typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped removing "${b}" while saving "${g}" because the original entry changed in another tab.`)}const A=r&&r.renamedFrom;if(A&&A!==g){const E=en(d,p.lookup,A,{preferExact:!0});E&&Object.prototype.hasOwnProperty.call(d,E)&&(delete d[E],ia(E))}const C=g||"";d[C]=n,hs(C),sc(d),k&&k.saveProject(C,n).catch(E=>console.warn("[saveProject] Repo write failed",E)),ur&&(Ve[C]=n);const j=k&&k.driver&&k.driver.constructor&&k.driver.constructor.name==="IndexedDBAdapter";let O=!0;if((!j||!ur)&&(O=Qf(C,n,{skipCompression:i})),O){const E=T();if(Yf(E,d),Jf(E),fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}Za(E)}else pc(d,{skipCompression:i})}function op(e){if(e===void 0){const u=[T()];typeof localStorage<"u"&&u.indexOf(localStorage)===-1&&u.push(localStorage),u.forEach(p=>{if(p&&typeof p.removeItem=="function")try{p.removeItem(pe);const d=typeof he=="string"?he:"__backup";p.removeItem(`${pe}${d}`),p.removeItem("cameraPowerPlanner_project__backup")}catch(d){console.warn("[FactoryReset] Failed to force delete project keys",d)}if(Ee(p,pe,"Error deleting project from storage:"),p&&typeof p.length=="number"){const d=[];for(let m=0;m<p.length;m++){const g=p.key(m);g&&g.startsWith(Bt)&&d.push(g)}d.forEach(m=>Ee(p,m,"Error deleting project shard from storage:"))}});try{k&&k.clear().catch(p=>console.warn("[FactoryReset] Failed to clear StorageRepository",p)),Xs&&Xs.clear().catch(p=>console.warn("[FactoryReset] Failed to clear DataVault",p)),ze&&ze.reset()}catch(p){console.warn("[FactoryReset] Error clearing modern storage",p)}if(typeof sn=="function")try{sn()}catch(p){console.warn("Failed to clear UI cache during project deletion",p)}if(fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}Nr&&typeof Nr.clear=="function"&&Nr.clear();const y=T();y&&Za(y);return}const{projects:t,changed:r,originalValue:n,lookup:o}=kt({forMutation:!0});if(r){const u=T();u&&yt(u,pe,n)}const i=en(t,o,e,{preferExact:!0}),s=i??Be(e);if(!Object.prototype.hasOwnProperty.call(t,s)){const u=Bt+Be(e),y=T();y&&Ee(y,u,"Error deleting orphan project shard:");return}if(np(t,s).status==="failed"){console.warn(`Automatic backup before deleting project "${s}" failed. Deletion aborted.`),ce();return}const c=Bt+Be(s),l=T(),f=k&&k.driver&&k.driver.constructor&&k.driver.constructor.name==="IndexedDBAdapter";if(l&&!f&&Ee(l,c,"Error deleting project shard:"),ur&&delete Ve[s],k&&typeof k.removeProject=="function"?k.removeProject(s).catch(u=>console.warn("Failed to delete from repo",u)):k&&k.removeItem(s).catch(u=>console.warn("Failed to delete from repo",u)),delete t[s],ia(s),fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}}function Vh(e,t){if(!e||!t)return null;const{projects:r}=kt({forMutation:!0}),n=en(r,null,e,{preferExact:!0});if(!n||!r[n])return null;const o=t.trim();if(!o||o===n)return n;const i=r[n];if(i.name=o,P(i.projectInfo)||(i.projectInfo={}),i.projectInfo.projectName=o,ur?(delete Ve[n],Ve[o]=i):(delete r[n],r[o]=i),k&&typeof k.removeProject=="function"?k.removeProject(n).catch(s=>console.warn("Failed to delete old project key",s)):k&&k.removeItem(n).catch(s=>console.warn("Failed to delete old project key",s)),yc(o,i),fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}return o}function yl(){const{projects:e,changed:t,originalValue:r}=kt({forMutation:!0});if(t){const s=T();s&&yt(s,pe,r)}const n=new Set(Object.keys(e)),o=new Set([...n].map(s=>s.trim().toLowerCase())),i="Imported project";return(s,a,c=i)=>{const l=$e(a);if(!l)return;!(a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"gearListAndProjectRequirementsGenerated")&&typeof a.gearListAndProjectRequirementsGenerated=="boolean")&&typeof l.gearListAndProjectRequirementsGenerated!="boolean"&&(l.gearListAndProjectRequirementsGenerated=!1);const u=[];if(typeof s=="string"&&u.push(s.trim()),P(a)){typeof a.name=="string"&&u.push(a.name.trim());const g=a.projectInfo;P(g)&&typeof g.projectName=="string"&&u.push(g.projectName.trim())}const y=typeof c=="string"&&c.trim()?c.trim():i,p=u.length>0?u[0]:y,d=typeof p=="string"?p.trim().toLowerCase():"",m=o.has(d)?uh(p,n,o):bs(p,n,o);yc(m,l,{skipCompression:!1}),n.add(m),o.add(m.trim().toLowerCase())}}function Oe(e){if(typeof e!="string")return{success:!1,parsed:null};const t=e.trim();if(!t)return{success:!1,parsed:null};const r=t[0],n=t[t.length-1];let o=null;if(r==="{"?o="}":r==="["?o="]":r==='"'&&(o='"'),!o||n!==o)return{success:!1,parsed:null};try{return{success:!0,parsed:JSON.parse(t)}}catch{return{success:!1,parsed:null}}}function wo(e,t,r="Imported project"){if(typeof e=="string"){const n=Oe(e);return n.success?wo(n.parsed,t,r):(t()(r,e,r),!0)}if(re(e)){const n=ne(e);return n?wo(Object.entries(n),t,r):!1}if(Array.isArray(e)){const n=e.map(s=>{if(s==null)return null;if(Array.isArray(s)&&s.length>=2)return{name:s[0],project:s[1]};if(P(s)&&typeof s.name=="string"){const a=Object.prototype.hasOwnProperty.call(s,"project")?s.project:s;return{name:s.name,project:a}}return{name:"",project:s}}).filter(Boolean);if(!n.length)return!0;const o=t();let i=0;return n.forEach(({name:s,project:a})=>{if(a==null)return;i+=1;let c="";typeof s=="string"?c=s:typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"?c=String(s):typeof s=="symbol"&&(c=s.description||s.toString()),o(c,a,`${r} ${i}`)}),!0}if(P(e)){const n=t();return Object.entries(e).forEach(([o,i])=>{const s=typeof o=="string"?o:Rf(o);n(typeof s=="string"&&s?s:r,i,r)}),!0}return!1}function Hh(e){if(!e||typeof e!="object")return[];const t=[],r=i=>{i!=null&&t.push(i)};["projectData","projectCollection","projectEntries","legacyProjects","legacyProjectData"].forEach(i=>{Object.prototype.hasOwnProperty.call(e,i)&&r(e[i])}),P(e.data)&&(Object.prototype.hasOwnProperty.call(e.data,"project")&&r(e.data.project),Object.prototype.hasOwnProperty.call(e.data,"projects")&&r(e.data.projects));const o=e.plannerData;return Array.isArray(o)&&o.forEach(i=>{if(Array.isArray(i)&&i.length>=2){const c=i[0];typeof c=="string"&&c.toLowerCase().includes("project")&&r(i[1]);return}if(!i||typeof i!="object")return;const s=typeof i.key=="string"?i.key:typeof i.name=="string"?i.name:typeof i.id=="string"?i.id:typeof i.section=="string"?i.section:null;if(!s||!s.toLowerCase().includes("project"))return;const a=Object.prototype.hasOwnProperty.call(i,"value")?i.value:Object.prototype.hasOwnProperty.call(i,"data")?i.data:Object.prototype.hasOwnProperty.call(i,"project")?i.project:Object.prototype.hasOwnProperty.call(i,"projects")?i.projects:null;a!=null&&r(a)}),t}function ip(){Pe();const e=T(),t=Me(e,et,"Error loading favorites from localStorage:",{},{validate:r=>r===null||P(r)});return P(t)?t:{}}function sp(e){const t=T();if(e==null){Ee(t,et,"Error deleting favorites from localStorage:");return}if(!P(e)){console.warn("Ignoring invalid favorites payload. Expected a plain object.");return}qe(t,et),Ae(t,et,e,"Error saving favorites to localStorage:")}function qh(){if(vt||(Vc||(Vc=!0,Gn&&(vt=Gn)),vt))return vt;const e=S&&typeof S=="object"?S:null;if(e&&e.cineFeaturesContacts&&typeof e.cineFeaturesContacts=="object")return vt=e.cineFeaturesContacts,vt;const t=e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null;if(t&&typeof t.resolveModule=="function")try{const r=t.resolveModule("cine.features.contacts",e);if(r&&typeof r=="object")return vt=r,vt}catch{}return vt}function ap(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return ap(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Wh(e){if(e&&typeof e.generateContactId=="function")try{const t=e.generateContactId();if(typeof t=="string"&&t)return t}catch{}return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function Yh(e,t){if(!e||typeof e!="object")return null;const r=ap,n=r(e.id)||Wh(t),o=r(e.name),i=r(e.role),s=r(e.phone),a=r(e.email),c=r(e.website||e.url),l=r(e.notes||e.note||e.text),f=typeof e.avatar=="string"?e.avatar.trim():"",u=f&&f.startsWith("data:")?f:"",y=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),p=Number.isFinite(e.updatedAt)?e.updatedAt:y,d={id:n,name:o,role:i,phone:s,email:a,website:c,notes:l,createdAt:y,updatedAt:p};return u&&(d.avatar=u),d}function Jh(e){if(!Array.isArray(e))return[];const t=e.filter(r=>r&&typeof r=="object").map(r=>({...r}));return t.sort((r,n)=>{const o=(r&&r.name?r.name:"").toLowerCase(),i=(n&&n.name?n.name:"").toLowerCase();if(o&&i&&o!==i)try{return o.localeCompare(i)}catch{}if(o&&!i)return-1;if(!o&&i)return 1;const s=r&&typeof r.createdAt=="number"?r.createdAt:0,a=n&&typeof n.createdAt=="number"?n.createdAt:0;return s-a}),t}function gc(e){if(!Array.isArray(e))return[];const t=qh();if(t&&typeof t.sortContacts=="function")try{const o=t.sortContacts(e);if(Array.isArray(o))return o.filter(i=>i&&typeof i=="object")}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contacts via module.",o)}const r=t&&typeof t.normalizeContactEntry=="function"?t.normalizeContactEntry:null,n=[];for(let o=0;o<e.length;o+=1){const i=e[o];if(!i)continue;let s=null;if(r)try{s=r(i)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contact entry via module.",a),s=null}s||(s=Yh(i,t)),s&&typeof s=="object"&&n.push(s)}return Jh(n)}function cp(){Pe();const e=T(),t=Me(e,tt,"Error loading contacts from localStorage:",[],{validate:r=>r===null||Array.isArray(r)});return Array.isArray(t)?gc(t):[]}function ga(e){const t=T();if(e==null){Ee(t,tt,"Error deleting contacts from localStorage:");return}if(!Array.isArray(e)){console.warn("Ignoring invalid contacts payload. Expected an array.");return}const r=gc(e);qe(t,tt),Ae(t,tt,r,"Error saving contacts to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Qh(){return qu.getOwnGear()}function lp(e){return qu.saveOwnGear(e)}function hn(e){if(typeof e=="string")return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="bigint")return e.toString();if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return hn(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function mc(e){if(!e||typeof e!="object")return null;const t=hn(e.name),r=hn(e.role),n=hn(e.avatar),o=n&&n.toLowerCase().startsWith("data:")?n:"",i=hn(e.phone),s=hn(e.email);return!t&&!r&&!o&&!i&&!s?{name:"",role:"",avatar:"",phone:"",email:""}:{name:t,role:r,avatar:o,phone:i,email:s}}function up(){Pe();const e=T(),t=Me(e,ct,"Error loading user profile from localStorage:",null,{validate:r=>r===null||P(r)});return P(t)?mc(t)||{name:"",role:"",avatar:"",phone:"",email:""}:{name:"",role:"",avatar:"",phone:"",email:""}}function Oi(e){const t=T();if(e==null){Ee(t,ct,"Error deleting user profile from localStorage:");return}const r=mc(e)||{name:"",role:"",avatar:"",phone:"",email:""};if(!r.name&&!r.role&&!r.avatar&&!r.phone&&!r.email){Ee(t,ct,"Error deleting user profile from localStorage:");return}qe(t,ct),Ae(t,ct,r,"Error saving user profile to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,enableCompressionSweep:!1})}function fp(){Pe();const e=T(),t=Me(e,Mr,"Error loading feedback from localStorage:",null,{validate:r=>r===null||P(r)});return P(t)?t:{}}function pp(e){const t=T();if(e==null){Ee(t,Mr,"Error deleting feedback from localStorage:");return}if(!P(e)){console.warn("Ignoring invalid feedback payload. Expected a plain object.");return}qe(t,Mr),Ae(t,Mr,e,"Error saving feedback to localStorage:")}function tn(e){if(!e)return null;if(typeof e=="string"){const t=e.trim();return t?{createdAt:t}:null}if(typeof e=="object"){const t=typeof e.createdAt=="string"&&e.createdAt.trim()?e.createdAt.trim():typeof e.iso=="string"&&e.iso.trim()?e.iso.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?e.timestamp.trim():null;if(!t)return null;const r={createdAt:t};return typeof e.fileName=="string"&&e.fileName.trim()?r.fileName=e.fileName.trim():typeof e.name=="string"&&e.name.trim()&&(r.fileName=e.name.trim()),r}return null}function To(e=!1){if(!e&&or!==null){const o=or;if(Array.isArray(o))return o.map(tn).filter(Boolean)}Pe();const t=T(),r=Me(t,Fe,"Error loading full backup history from localStorage:",[],{validate:o=>o===null||Array.isArray(o)});if(!Array.isArray(r))return[];const n=r.map(tn).filter(Boolean);return or=n,k.setItem(Fe,n).catch(o=>{console.warn("[storage.js] Failed to persist backup history to new storage:",o)}),n}function Ji(e){const t=T();if(e==null){or=[],Ee(t,Fe,"Error deleting full backup history from localStorage:"),k.removeItem(Fe).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)});return}if(!Array.isArray(e)){console.warn("Ignoring invalid full backup history payload. Expected an array.");return}const r=e.map(tn).filter(Boolean);if(!r.length){e.length===0?(or=[],Ee(t,Fe,"Error deleting full backup history from localStorage:"),k.removeItem(Fe).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)})):console.warn("Ignoring full backup history update because no valid entries were provided.");return}or=r,qe(t,Fe),Ae(t,Fe,r,"Error saving full backup history to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0}),k.setItem(Fe,r).catch(n=>{console.warn("[storage.js] Failed to persist backup history to new storage:",n)})}var dp=e=>{const t=tn(e);if(!t)return To();const r=To();r.push(t);const n=r.slice(-200);return Ji(n),n};function Jt(e,t,r=0){if(e==null)return[];if(r>50)return[];if(Array.isArray(e)){const o=[],i=e.length,s=t||new WeakSet;if(s.has(e))return[];s.add(e);for(let a=0;a<i;a+=1){const c=e[a];if(!(typeof c=="object"&&c!==null&&s.has(c)))if(Array.isArray(c)){const l=Jt(c,s,r+1);if(l&&l.length)for(let f=0;f<l.length;f+=1)o.push(l[f])}else{const l=tn(c);l&&o.push(l)}}return o}const n=t||new WeakSet;if(typeof e=="object"&&e!==null){if(n.has(e))return[];n.add(e)}if(re(e)){const o=ne(e);return o?Jt(Object.values(o),n,r+1):[]}if(typeof e=="string"){const o=Oe(e);if(o.success)return Jt(o.parsed,n,r+1);const i=tn(e);return i?[i]:[]}if(Array.isArray(e))return[];if(P(e)){if(Array.isArray(e.history))return Jt(e.history,n,r+1);if(Array.isArray(e.entries))return Jt(e.entries,n,r+1);if(Array.isArray(e.list))return Jt(e.list,n,r+1);const o=tn(e);if(o)return[o];const i=Object.values(e);if(i.length)return Jt(i,n,r+1)}return[]}var Qi=1;function Xh(){var e=0;if(typeof Date<"u"&&Date&&typeof Date.now=="function")e=Date.now();else try{e=new Date().getTime()}catch{e=Math.floor(Math.random()*1e9)}var t=0;try{t=Math.floor(Math.random()*1e6)}catch{t=e%1e6}return"doc-tracker-"+e.toString(36)+"-"+t.toString(36)}function gl(e){var t=!1,r=null;if(e&&typeof e=="object"){typeof e.completed=="boolean"?t=e.completed:typeof e.checked=="boolean"?t=e.checked:typeof e.value=="boolean"?t=e.value:e.done===!0&&(t=!0);var n=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?n=e.updatedAt.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?n=e.timestamp.trim():typeof e.completedAt=="string"&&e.completedAt.trim()&&(n=e.completedAt.trim()),n&&(r=n)}else if(typeof e=="boolean")t=e;else if(typeof e=="string"){var o=e.trim().toLowerCase();(o==="true"||o==="1"||o==="yes"||o==="done")&&(t=!0)}return{completed:t===!0,updatedAt:typeof r=="string"?r:null}}function Zh(e){var t={};if(Array.isArray(e)){for(var r=0;r<e.length;r+=1){var n=e[r];if(n!=null){if(typeof n=="string"&&n.trim()){t[n.trim()]={completed:!0,updatedAt:null};continue}if(typeof n=="object"){var o=null;if(typeof n.id=="string"&&n.id.trim()?o=n.id.trim():typeof n.key=="string"&&n.key.trim()?o=n.key.trim():typeof n.name=="string"&&n.name.trim()&&(o=n.name.trim()),!o)continue;t[o]=gl(n)}}}return t}if(e&&(typeof e=="object"||typeof e=="function"))for(var i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(a!=null){var c=typeof a=="string"?a:String(a);if(c){var l=c.trim();l&&(t[l]=gl(e[a]))}}}return t}function eb(e){var t={};if(e&&(typeof e=="object"||typeof e=="function"))for(var r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n];o&&(t[o]=Zh(e[o]))}return t.locales||(t.locales={}),t.helpTopics||(t.helpTopics={}),t.printGuides||(t.printGuides={}),t}function ml(e){if(!e||typeof e!="object"&&typeof e!="function")return null;var t=null;typeof e.id=="string"&&e.id.trim()&&(t=e.id.trim()),!t&&typeof e.key=="string"&&e.key.trim()&&(t=e.key.trim()),t||(t=Xh());var r="";typeof e.name=="string"?r=e.name.trim():typeof e.title=="string"&&(r=e.title.trim());var n="";typeof e.targetDate=="string"&&e.targetDate.trim()?n=e.targetDate.trim():typeof e.releaseDate=="string"&&e.releaseDate.trim()&&(n=e.releaseDate.trim());var o="";if(typeof e.createdAt=="string"&&e.createdAt.trim()?o=e.createdAt.trim():typeof e.generatedAt=="string"&&e.generatedAt.trim()&&(o=e.generatedAt.trim()),!o)try{o=new Date().toISOString()}catch{o=""}var i=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?i=e.updatedAt.trim():typeof e.modifiedAt=="string"&&e.modifiedAt.trim()?i=e.modifiedAt.trim():typeof e.lastUpdated=="string"&&e.lastUpdated.trim()?i=e.lastUpdated.trim():typeof e.timestamp=="string"&&e.timestamp.trim()&&(i=e.timestamp.trim()),i||(i=o||null);var s="";typeof e.notes=="string"?s=e.notes.trim():typeof e.summary=="string"&&(s=e.summary.trim()),s&&s.length>8e3&&(s=s.slice(0,8e3));var a=!1;if(typeof e.archived=="boolean")a=e.archived;else if(typeof e.status=="string"){var c=e.status.trim().toLowerCase();(c==="archived"||c==="closed"||c==="complete")&&(a=!0)}var l=eb(e.statuses);return{id:t,name:r,targetDate:n,createdAt:typeof o=="string"?o:"",updatedAt:typeof i=="string"?i:null,statuses:l,notes:s,archived:a===!0}}function Eo(e){var t={version:Qi,releases:[]};if(e==null)return t;var r=e;if(Array.isArray(r))return t.releases=r.map(ml).filter(Boolean),t;if(typeof r!="object"&&typeof r!="function")return t;typeof r.version=="number"&&Number.isFinite(r.version)&&(t.version=r.version);var n=null;if(Array.isArray(r.releases)?n=r.releases:Array.isArray(r.entries)?n=r.entries:Array.isArray(r.logs)&&(n=r.logs),!n&&r&&typeof r=="object"){var o=Object.values(r);o.length&&o.every(function(i){return i&&typeof i=="object"&&!Array.isArray(i)})&&(n=o)}return!n||!Array.isArray(n)?t.releases=[]:t.releases=n.map(ml).filter(Boolean),t}function yp(){Pe();const e=T(),t=Me(e,Lr,"Error loading documentation tracker from localStorage:",null,{validate:n=>n===null||P(n)||Array.isArray(n)});if(!t)return{version:Qi,releases:[]};const r=Eo(t);return!r||!Array.isArray(r.releases)?{version:Qi,releases:[]}:r}function Ci(e){const t=T();if(e==null){Ee(t,Lr,"Error deleting documentation tracker from localStorage:");return}const r=Eo(e);if(!r.releases.length){Ee(t,Lr,"Error deleting documentation tracker from localStorage:");return}qe(t,Lr),Ae(t,Lr,{version:Qi,releases:r.releases},"Error saving documentation tracker to localStorage:",{disableCompression:!0})}function gp(){Pe();const e=T(),t=Me(e,Br,"Error loading automatic gear rules from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?ue(r):[];if(n!==r&&hc(n,{skipNormalization:!0}),Array.isArray(n)){let o=!1;const i=n.map(s=>s&&typeof s=="object"&&typeof s.enabled>"u"?(o=!0,{...s,enabled:!0}):s);return o?i:n}return[]}function hc(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],i=n?o:Array.isArray(o)?ue(o):[],s=T();return qe(s,Br),Ae(s,Br,i,"Error saving automatic gear rules to localStorage:",{disableCompression:!0}),i}function bc(){if(Pe(),Array.isArray(wn)&&wn.length){const{normalized:i,changed:s}=Vi(wn);return s&&Xi(i,{skipNormalization:!0}),i}const e=T(),t=Me(e,ut,"Error loading automatic gear rule backups from localStorage:",[],{validate:i=>i===null||Array.isArray(i)}),r=Array.isArray(t)?t:[],{normalized:n,changed:o}=Vi(r);return o&&Xi(n,{skipNormalization:!0}),wn=n,n}function Xi(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],{normalized:i}=n?{normalized:o}:Vi(o);wn=i;const s=T();qe(s,ut);let a=!1,c=!1;if(typeof window<"u"&&window.localStorage===s){const f=typeof k<"u"&&k.driver&&k.driver.constructor.name==="IndexedDBAdapter";typeof k<"u"&&k.setItem(ut,i).catch(u=>{if(console.warn("[Storage] Failed to async persist Auto Gear Backups to IDB:",u),f)try{Ae(s,ut,i,"Error saving automatic gear rule backups to localStorage:")}catch(y){console.warn("[Storage] Failed to persist Auto Gear Backups fallback to localStorage:",y)}})}if(!(typeof k<"u"&&k.driver&&k.driver.constructor.name==="IndexedDBAdapter"))return Ae(s,ut,i,"Error saving automatic gear rule backups to localStorage:",{onQuotaExceeded:(f,u={})=>{const y=la(i);if(y){const d=y.label;return console.warn(d?`Removed automatic gear backup "${d}" to free up storage space before saving gear backups.`:"Removed oldest automatic gear backup entry to free up storage space before saving gear backups."),!0}const p=u&&u.storage?u.storage:s;return!!(!a&&(a=!0,th(p))||!c&&(c=!0,ua()))}}),i}function mp(){Pe();const e=T();return Gf(e,cn,"Error loading automatic gear seed flag from localStorage:")}function ma(e){const t=T();zf(t,cn,!!e,"Error saving automatic gear seed flag to localStorage:")}function hp(){Pe();const e=T(),t=Me(e,Dt,"Error loading automatic gear presets from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?ue(r):[];return n!==r&&Ss(n,{skipNormalization:!0}),Array.isArray(n)?n:[]}let Zi=null,Ao=null,Oo=null,wn=null,es=null,ts=null,Mo=null,No=null,Go=null,zo=null,Bo=null,Kn=null,xo=null,Fo=null,Do=null,Hr=null,Uo=null,or=null;function tb(){const e=new Set,t=r=>{if(typeof r=="string"){const n=r.trim();n&&e.add(n)}};if(typeof rs=="function")try{t(rs())}catch(r){console.warn("Unable to read automatic gear active preset id while evaluating compression policy.",r)}if(typeof ns=="function")try{t(ns())}catch(r){console.warn("Unable to read automatic gear auto preset id while evaluating compression policy.",r)}return e}function Ss(e,t={}){const r=t||{},{skipNormalization:n=!1,disableCompression:o}=r,i=Array.isArray(e)?e.slice():[],s=n?i:Array.isArray(i)?ue(i):[],a=T();qe(a,Dt);let c=typeof o=="boolean"?o:!1;if(o===void 0){const l=tb();l.size>0&&(c=s.some(f=>f&&typeof f=="object"&&typeof f.id=="string"&&l.has(f.id)))}return k&&k.setItem(Dt,s).catch(l=>console.warn("Failed to save auto gear presets to repo",l)),Ae(a,Dt,s,"Error saving automatic gear presets to localStorage:",c?{disableCompression:!0}:void 0),s}function bp(){if(Zi)return Zi;Pe();const e=T(),t=Me(e,Ut,"Error loading automatic gear monitor defaults from localStorage:",{},{validate:o=>o===null||typeof o=="object"}),r=t&&typeof t=="object"?t:{},n=P(r)?ue(r):{};return n!==r&&Sc(n,{skipNormalization:!0}),n&&typeof n=="object"?n:{}}function Sc(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=e&&typeof e=="object"?{...e}:{},i=n?o:P(o)?ue(o):{},s=T();return qe(s,Ut),Zi=i,k&&k.setItem(Ut,i).catch(c=>console.warn("Failed to save monitor defaults to repo",c)),k&&k.driver&&k.driver.constructor&&k.driver.constructor.name==="IndexedDBAdapter"||Ae(s,Ut,i,"Error saving automatic gear monitor defaults to localStorage:"),i}function hl(e,t){if(!e)return;const r=t||T();if(!r)return;let n;try{n=r.getItem(Dt)}catch(a){console.error("Error loading automatic gear presets while removing autosaved preset from localStorage:",a),be("read access",a,r),ce();return}if(n===null||typeof n>"u")return;let o,i=n;typeof n=="string"&&n&&(i=un(n));try{o=JSON.parse(i)}catch(a){console.error("Error parsing automatic gear presets while removing autosaved preset from localStorage:",a);return}if(!Array.isArray(o))return;const s=o.filter(a=>!a||typeof a!="object"?!0:a.id!==e);s.length!==o.length&&Ss(s,{skipNormalization:!0})}function rs(){if(Ao!==null)return typeof Ao=="string"?Ao:"";Pe();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(Ot);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear active preset from localStorage:",t),be("read access",t,e),ce(),""}}function Sp(e){if(Ao=e||"",k&&(e?k.setItem(Ot,e).catch(n=>console.warn("Failed to save active preset id",n)):k.removeItem(Ot).catch(n=>console.warn("Failed to remove active preset id",n))),k&&k.driver&&k.driver.constructor&&k.driver.constructor.name==="IndexedDBAdapter")return;const r=T();if(r)try{e?r.setItem(Ot,e):r.removeItem(Ot)}catch(n){console.error("Error saving automatic gear active preset to localStorage:",n),be("write access",n,r),ce()}}function ns(){if(Oo!==null)return typeof Oo=="string"?Oo:"";Pe();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(Qe);if(typeof t=="string"&&t)return t;const r=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(console.log("DEBUG: loadAutoGearAutoPresetId legacy check, legacyStorage exists:",!!r),r&&r.getItem){let n=r.getItem("cinePowerPlanner_autoGearAutoPreset");if(console.log("DEBUG: legacyValue for cinePowerPlanner_autoGearAutoPreset:",n),typeof n=="string"&&n||(n=r.getItem(Qe),typeof n=="string"&&n))return n}return""}catch(t){return console.error("Error loading automatic gear auto preset from localStorage:",t),be("read access",t,e),ce(),""}}function wp(e){Oo=e||"",k&&(e?k.setItem(Qe,e).catch(n=>console.warn("Failed to save auto preset id",n)):k.removeItem(Qe).catch(n=>console.warn("Failed to remove auto preset id",n))),k&&k.driver&&k.driver.constructor&&k.driver.constructor.name;const t=T();if(!t)return;let r="";try{const n=t.getItem(Qe);typeof n=="string"&&n&&(r=n)}catch(n){console.error("Error inspecting automatic gear auto preset in localStorage:",n),be("read access",n,t)}try{e?(t.setItem(Qe,e),r&&r!==e&&hl(r,t)):(t.removeItem(Qe),r&&hl(r,t))}catch(n){console.error("Error saving automatic gear auto preset to localStorage:",n),be("write access",n,t),ce()}}function Ep(){if(ts!==null)return!!ts;Pe();const e=T();return Gf(e,pr,"Error loading automatic gear backup visibility from localStorage:")}function Ap(e){ts=!!e,k&&k.setItem(pr,!!e).catch(r=>console.warn("Failed to save visibility",r));const t=T();zf(t,pr,!!e,"Error saving automatic gear backup visibility to localStorage:")}function Op(){const t=Number(em);if(!Number.isFinite(t))return Sn;const r=Math.round(t);return Number.isFinite(r)?r<at?at:r>Sn?Sn:r:Sn}function En(e){const t=Number(e);if(!Number.isFinite(t))return Ko();const r=Math.round(t);if(!Number.isFinite(r))return Ko();if(r<at)return at;const n=Op();return r>n?n:r}function Ko(){const e=Op();if(S&&typeof S.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=="number"){const r=S.AUTO_GEAR_BACKUP_RETENTION_DEFAULT;if(Number.isFinite(r)&&r>=at){const n=Math.round(r);return Number.isFinite(n)?n<at?at:n>e?e:n:e}}const t=Math.round(mf);return Number.isFinite(t)?t>e?e:t<at?at:t:at}function Co(e,t=Ko()){if(e==null)return t;if(typeof e=="number")return En(e);if(typeof e=="string"){const r=e.trim();if(!r)return t;const n=Number(r);if(Number.isFinite(n))return En(n);const o=Oe(r);return o&&o.success?Co(o.parsed,t):t}if(Array.isArray(e)){for(let r=0;r<e.length;r+=1){const n=Co(e[r],null);if(typeof n=="number"&&Number.isFinite(n))return En(n)}return t}if(P(e)){const r=["value","retention","limit","count"];for(let n=0;n<r.length;n+=1){const o=r[n];if(!Object.prototype.hasOwnProperty.call(e,o))continue;const i=Co(e[o],null);if(typeof i=="number"&&Number.isFinite(i))return En(i)}return t}return t}function Cp(){if(es!==null)return es;Pe();const e=T(),t=Me(e,Kt,"Error loading automatic gear backup retention from localStorage:",Ko(),{validate:r=>r===null||typeof r=="number"||typeof r=="string"||Array.isArray(r)||P(r)});return Co(t)}function _p(e){if(e==null||typeof e=="function"||typeof e=="object"&&!Array.isArray(e)&&!P(e))return;const t=T(),r=Co(e);es=r,k&&k.setItem(Kt,r).catch(n=>console.warn("Failed to save backup retention",n)),qe(t,Kt),Ae(t,Kt,r,"Error saving automatic gear backup retention to localStorage:")}async function rb(){const e=T(),t=(r,n)=>{if(r){if(typeof r.clear=="function")try{r.clear()}catch{}try{const o=[];try{for(let i=0;i<r.length;i++){const s=r.key(i);s&&o.push(s)}}catch(i){}try{Object.keys(r).forEach(i=>{i&&!o.includes(i)&&o.push(i)})}catch(i){}o.forEach(i=>{if(i!==At)try{r.removeItem(i)}catch(s){}})}catch{}}};t(e),typeof localStorage<"u"&&localStorage!==e&&t(localStorage),typeof sessionStorage<"u"&&t(sessionStorage);try{typeof globalThis<"u"&&(globalThis.__cameraPowerPlannerFactoryResetting=!0),typeof global<"u"&&(global.__cameraPowerPlannerFactoryResetting=!0),typeof window<"u"&&(window.__cameraPowerPlannerFactoryResetting=!0),S&&(S.__cameraPowerPlannerFactoryResetting=!0,S.__cineMonolithicProjectCleanupDone=!1),typeof sessionStorage<"u"&&sessionStorage.setItem(At,"true"),typeof localStorage<"u"&&localStorage.setItem(At,"true")}catch{}if(ve)try{ve.postMessage("factory-reset")}catch{}try{op()}catch(r){console.warn("Unable to clear stored projects",r)}fr(),Ct&&typeof Ct.clear=="function"&&Ct.clear(),Array.isArray(vr)&&(vr.length=0);try{let r=null;if(S&&typeof S.clearBackupVault=="function"?r=S.clearBackupVault:typeof window<"u"&&typeof window.clearBackupVault=="function"?r=window.clearBackupVault:S&&S.cineFeatureBackup&&typeof S.cineFeatureBackup.clearBackupVault=="function"&&(r=S.cineFeatureBackup.clearBackupVault),r&&await r(),typeof indexedDB<"u"){const n=["cinePowerPlannerBackupVault","cinePowerPlanner","cameraPowerPlanner"];if(typeof indexedDB.databases=="function")try{(await indexedDB.databases()).forEach(i=>{i.name&&!n.includes(i.name)&&n.push(i.name)})}catch(o){}await Promise.all(n.map(o=>new Promise(i=>{try{const s=indexedDB.deleteDatabase(o);s.addEventListener("success",()=>i()),s.addEventListener("error",()=>{console.warn(`Failed to delete IndexedDB database "${o}"`,s.error),i()}),s.addEventListener("blocked",()=>i())}catch{i()}})))}}catch(r){console.warn("Failed to clear backup vault",r)}if(typeof caches<"u"&&typeof caches.keys=="function")try{const r=await caches.keys();await Promise.all(r.map(function(n){return caches.delete(n)}))}catch(r){console.warn("Storage reset: Failed to clear Service Worker caches.",r)}}function ge(e){if(e===tr&&Mo)return Mo;if(e===rt&&No)return No;if(e===zt&&Go)return Go;if(e===Re&&zo)return zo;if(e===tt&&Bo)return Bo;if(e===Gt&&Kn)return Kn;if(e===ct&&xo)return xo;if(e===et&&Fo)return Fo;if(e===lt&&Do)return Do;if(e===Je&&Hr)return Hr;if(e===Ft()&&Uo)return Uo;const t=T();if(!t||typeof t.getItem!="function")return null;const r=Pt(e);for(let o=0;o<r.length;o+=1){const i=r[o];try{const s=t.getItem(i);if(s==null){if(Lt.has(i))try{const a=t.getItem(`${i}${he}`);if(a!=null){const c=nr(a);return typeof c=="string"?c:String(a)}}catch(a){console.warn("Unable to read backup key for export",i,a),be("read access",a,t)}}else{const a=nr(s);return typeof a=="string"?a:String(s)}}catch(s){console.warn("Unable to read storage key for backup",i,s),be("read access",s,t)}}if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown"].includes(e)){const o=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(o&&typeof o.getItem=="function")try{const i=o.getItem(e);if(i!=null)return nr(i)}catch(i){console.warn("Unable to read preference from legacy localStorage",e,i)}}return null}function Kr(e){if(e==null)return null;if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isNaN(e)?null:e!==0;const t=String(e).trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}function wc(e){if(e==null)return null;let t=null,r=e;if(typeof e=="string"){const c=e.trim();if(!c)return null;t=c;try{r=JSON.parse(c)}catch{return{normalized:null,serialized:t}}}if(!r||typeof r!="object")return t?{normalized:null,serialized:t}:null;const n=typeof r.sections=="object"&&r.sections!==null,o=n?r.sections:r,i={};if(o&&typeof o=="object"){const c=Object.keys(o);for(let l=0;l<c.length;l+=1){const f=c[l],u=o[f];typeof u=="boolean"&&(i[f]=u)}}let s=null;if(typeof r.layout=="string"){const c=r.layout.trim();c&&(s=c)}s||(s=n?"standard":"rental");const a={sections:i,layout:s};if(n){const c=Object.keys(r);for(let l=0;l<c.length;l+=1){const f=c[l];f==="sections"||f==="layout"||(a[f]=zr(r[f]))}}return{normalized:a,serialized:t}}function nb(){const e={},t=Kr(ge("darkMode"));t!==null&&(e.darkMode=t);const r=Kr(ge("pinkMode"));r!==null&&(e.pinkMode=r);const n=Kr(ge("highContrast"));n!==null&&(e.highContrast=n);const o=Kr(ge("reduceMotion"));o!==null&&(e.reduceMotion=o);const i=Kr(ge("relaxedSpacing"));i!==null&&(e.relaxedSpacing=i);const s=Kr(ge("showAutoBackups"));s!==null&&(e.showAutoBackups=s);const a=ge("accentColor");a&&(e.accentColor=a);const c=ge("fontSize");c&&(e.fontSize=c);const l=ge("fontFamily");l&&(e.fontFamily=l);const f=ge("language");f&&(e.language=f);const u=Ft(),y=ge(u);if(y)if(y==="[object Object]"||String(y).includes("[object Object]"))typeof S.DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=S.DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}};else try{e.mountVoltages=JSON.parse(y)}catch(_){console.warn("Failed to parse stored mount voltages for backup",_),typeof S.DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=S.DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}}}const p=Kr(ge("iosPwaHelpShown"));p!==null&&(e.iosPwaHelpShown=p);const d=ge(lt);d&&(e.temperatureUnit=d);const m=ge(Je);m&&(e.focusScale=m);const g=ge(zt);if(g){let _=null;if(typeof g=="string"){const w=g.trim();if(w)try{_=JSON.parse(w)}catch(h){console.warn("Failed to parse stored camera color preferences for backup",h),_=null}}_&&typeof _=="object"?e.cameraColors=zr(_):typeof g=="string"&&g.trim()&&(e.cameraColors=g)}const b=ge(Re);if(b!=null){const _=wc(b);_&&(_.normalized?e[Re]=zr(_.normalized):_.serialized&&(e[Re]=_.serialized))}return e}function Pp(e){return Array.isArray(e)?e.map(t=>({id:t&&typeof t.id=="string"?t.id:null,name:t&&typeof t.name=="string"?t.name:"",data:t&&typeof t.data=="string"?t.data:""})).filter(t=>t.id&&t.name&&t.data):[]}function ob(){const e=ge(nn());if(!e)return[];try{const t=JSON.parse(e);return Pp(t)}catch(t){return console.warn("Failed to parse stored custom fonts for backup",t),[]}}let po=[];function ib(e){if(!e||typeof e!="object")return null;const t={};return typeof e.source=="string"&&e.source&&(t.source=e.source),typeof e.reason=="string"&&e.reason&&(t.reason=e.reason),typeof e.permissionState=="string"&&e.permissionState&&(t.permissionState=e.permissionState),Object.keys(t).length?t:null}function kp(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"";if(!t)return null;const r=typeof e.fileName=="string"&&e.fileName?e.fileName:"cine-power-planner-backup.json",n=typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)?e.createdAtMs:null,o=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:n!==null?new Date(n).toISOString():null;let i=n;if(i===null&&o){const a=Date.parse(o);Number.isFinite(a)&&(i=a)}i===null&&(i=Date.now());const s=ib(e.metadata);return{id:t,fileName:r,payload:e.payload,createdAt:o||new Date(i).toISOString(),createdAtMs:i,metadata:s||{}}}function $o(e){if(!e)return[];let t=e;if(typeof e=="string"){const o=Oe(e);o&&o.success&&(t=o.parsed)}const r=Array.isArray(t)?t:[],n=[];return r.forEach(o=>{const i=kp(o);i&&n.push(i)}),n}function bl(e){if(!e)return 0;let t=0;return e.payload!==null&&e.payload!==void 0&&(t+=3),typeof e.fileName=="string"&&e.fileName&&(t+=1),typeof e.createdAt=="string"&&e.createdAt&&(t+=1),typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)&&(t+=1),e.metadata&&typeof e.metadata=="object"&&(t+=1),t}function vp(e,t){const r=new Map,n=o=>{Array.isArray(o)&&o.forEach(i=>{const s=kp(i);if(!s)return;const a=r.get(s.id);(!a||bl(s)>=bl(a))&&r.set(s.id,s)})};return n(e),n(t),Array.from(r.values())}function jp(){const e=ge("cineBackupVaultFallbackRecords");return $o(e)}function Ip(){return S&&S.cineFeatureBackup&&typeof S.cineFeatureBackup=="object"?S.cineFeatureBackup:S&&typeof S.getQueuedBackupPayloads=="function"?S:null}function Lp(){const e=Ip();if(!e)return;const t=typeof e.listBackupVaultRecords=="function"?e.listBackupVaultRecords:typeof e.getQueuedBackupPayloads=="function"?e.getQueuedBackupPayloads:null;if(!t)return;let r=null;try{r=t()}catch(n){console.warn("Unable to load backup vault records for export",n);return}if(Array.isArray(r)){po=$o(r);return}return r&&typeof r.then=="function"?r.then(n=>(po=$o(n),po)).catch(n=>(console.warn("Unable to load backup vault records for export",n),[])):Promise.resolve(po)}function Rp(){return S&&S.cineAutoGearPersistence?S.cineAutoGearPersistence:S&&S.cineModules&&typeof S.cineModules.get=="function"&&S.cineModules.get("cineAutoGearPersistence")||null}function sb(){const e=Rp();if(!e)return null;const t=typeof e.getCacheSnapshot=="function"?e.getCacheSnapshot():null,r=(n,o,i)=>{if(t&&Object.prototype.hasOwnProperty.call(t,n))return t[n];if(i&&typeof e[i]=="function")try{return e[i]()}catch(s){console.warn(`Failed to read ${n} from Auto-Gear persistence cache`,s)}return o};return{autoGearRules:r("autoGearRules",[],"readAutoGearRules"),autoGearBackups:r("autoGearBackups",[],"readAutoGearBackups"),autoGearPresets:r("autoGearPresets",[],"readAutoGearPresets"),autoGearMonitorDefaults:r("autoGearMonitorDefaults",{},"readAutoGearMonitorDefaults"),autoGearActivePresetId:r("autoGearActivePresetId","","readActivePresetId"),autoGearAutoPresetId:r("autoGearAutoPresetId","","readAutoPresetId"),autoGearBackupRetention:r("autoGearBackupRetention",null,"readBackupRetention"),autoGearShowBackups:r("autoGearShowBackups",!1,"readBackupVisibility")}}async function ab(){return await Lp()}function cb(){Lp();const e=sb(),t={devices:Ff(),setups:Yo(),session:Bf(),feedback:fp(),project:(()=>{const f=Zf();if(!f||typeof f!="object")return{};const u={};return Object.keys(f).forEach(y=>{const p=f[y];if(typeof p=="string")try{const d=JSON.parse(p);u[y]=d}catch{console.warn("[Export] Found non-JSON string in project data",y),u[y]=p}else u[y]=p}),u})(),favorites:ip(),contacts:cp(),ownGear:Kn||[],userProfile:null,autoGearRules:e?e.autoGearRules:gp(),autoGearBackups:e?e.autoGearBackups:bc(),autoGearSeeded:mp(),autoGearPresets:e?e.autoGearPresets:hp(),autoGearMonitorDefaults:e?e.autoGearMonitorDefaults:bp(),autoGearActivePresetId:e?e.autoGearActivePresetId:rs(),autoGearAutoPresetId:e?e.autoGearAutoPresetId:ns(),autoGearShowBackups:e?e.autoGearShowBackups:Ep(),autoGearBackupRetention:e?e.autoGearBackupRetention:Cp(),fullBackupHistory:To()},r=yp();r&&Array.isArray(r.releases)&&r.releases.length&&(t.documentationTracker=r);const n=nb();Object.keys(n).length&&(t.preferences=n);const o=up();o&&typeof o=="object"&&(typeof o.name=="string"&&o.name||typeof o.role=="string"&&o.role||typeof o.avatar=="string"&&o.avatar||typeof o.phone=="string"&&o.phone||typeof o.email=="string"&&o.email)?t.userProfile=o:delete t.userProfile;const i=ge(rt);i&&(t.customLogo=i);const s=ob();s.length&&(t.customFonts=s);const a=ge(dt);a!=null&&(t.schemaCache=a);const c=jp(),l=vp(po,c);return l.length&&(t.backupVaultRecords=l.map(f=>zr(f))),t}function fe(e,t){const r=T();if(!r)return;const n=Lt.has(e),o=`${e}${he}`;k&&k.driver&&k.driver.constructor&&k.driver.constructor.name;const i=new Set([tr,rt,zt,Re,tt,Gt,ct,et,lt,Je,lt,Je,Ft(),Fe,"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",dt,Br,ut,Dt,Ut,Kt,cn,Ot,Qe,pr]),s=()=>{e===tr&&(Mo=null),e===rt&&(No=null),e===zt&&(Go=null),e===Re&&(zo=null),e===tt&&(Bo=null),e===Gt&&(Kn=null),e===ct&&(xo=null),e===et&&(Fo=null),e===lt&&(Do=null),e===Je&&(Hr=null),e===Je&&(Hr=null),e===Ft()&&(Uo=null),e===Fe&&(or=null)},a=c=>{if(r.setItem(e,c),["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",dt].includes(e)||i.has(e)){const u=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage||typeof globalThis<"u"&&globalThis.localStorage;if(u&&u!==r)try{u.setItem(e,c)}catch{}else u||console.warn("DEBUG: legacyStorage NOT FOUND in writeLegacyStorage for",e)}if(n)try{r.setItem(o,c)}catch(u){console.warn("Unable to update backup key during import",o,u),be("write access",u,r),ce()}};try{if(t==null){s(),k&&k.removeItem(e).catch(l=>console.warn("Failed to remove key from repo",e,l)),r.removeItem(e);const c=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(c&&c!==r)try{c.removeItem(e)}catch(l){}if(n)try{r.removeItem(o)}catch(l){console.warn("Unable to remove backup key during import",o,l),be("deletion",l,r)}}else{const c=String(t);e===tr&&(Mo=c),e===rt&&(No=c),e===zt&&(Go=c),e===Re&&(zo=c),e===tt&&(Bo=c),e===Gt&&(Kn=c),e===ct&&(xo=c),e===et&&(Fo=c),e===lt&&(Do=c),e===Je&&(Hr=c),e===Je&&(Hr=c),e===Ft()&&(Uo=c),e===Fe&&(or=JSON.parse(c)),k&&k.setItem(e,c).catch(l=>{console.warn("Failed to save key to repo",e,l);try{a(c)}catch(f){console.warn("Unable to persist fallback legacy storage key during repo failure",e,f),be("write access",f,r),n&&ce()}});try{a(c)}catch(l){console.warn("DEBUG: writeLegacyStorage failed",l)}}}catch(c){console.warn("Unable to persist storage key during import",e,c),be("write access",c,r),n&&ce()}}function In(e){if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}if(typeof e=="number")return Number.isNaN(e)?null:e!==0;if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=In(e[t]);if(r!==null)return r}return null}if(P(e)){if(Object.prototype.hasOwnProperty.call(e,"value"))return In(e.value);if(Object.prototype.hasOwnProperty.call(e,"enabled"))return In(e.enabled)}return null}function ir(e,t=[],r=null){if(re(e)){const n=ne(e);return n?ir(n,t,r):[]}if(Array.isArray(e))return r?e.filter(n=>r(n)):e.filter(n=>n!=null);if(typeof e=="string"){const n=Oe(e);return n.success?ir(n.parsed,t,r):[]}if(P(e)){for(let o=0;o<t.length;o+=1){const i=t[o];if(!Object.prototype.hasOwnProperty.call(e,i))continue;const s=ir(e[i],t,r);if(s.length)return s}const n=Object.values(e);if(n.length)return r?n.filter(o=>r(o)):n.filter(o=>o!=null)}return[]}function lb(e){const t=ir(e,["contacts","entries","items","list","values","data"],r=>r&&typeof r=="object");return Array.isArray(t)?gc(t):[]}function ub(e){const t=ir(e,["rules","items","entries","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?ue(t):[]}function fb(e){const t=ir(e,["backups","entries","items","list","values","data"],n=>n!==null&&typeof n=="object");if(!Array.isArray(t))return[];const{normalized:r}=Vi(t);return r}function _i(e){if(e==null)return null;if(typeof e=="number")return En(e);if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return En(r);const n=Oe(t);return n&&n.success?_i(n.parsed):null}if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=_i(e[t]);if(typeof r=="number")return r}return null}if(P(e)){const t=["value","retention","limit","count"];for(let r=0;r<t.length;r+=1){const n=t[r];if(!Object.prototype.hasOwnProperty.call(e,n))continue;const o=_i(e[n]);if(typeof o=="number")return o}return null}return typeof e=="boolean"&&e?at:null}function pb(e){const t=ir(e,["presets","entries","items","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?ue(t):[]}function db(e){if(!e||typeof e!="object")return{};const t={};Object.entries(e).forEach(([n,o])=>{if(typeof o!="string")return;const i=o.trim();i&&(t[n]=i)});const r=ue(t);return P(r)?r:t}function ha(e){if(typeof e=="string")return e;if(typeof e=="number")return Number.isNaN(e)?"":String(e);if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=ha(e[t]);if(r)return r}return""}if(P(e)){if(typeof e.id=="string"&&e.id)return e.id;if(typeof e.value=="string")return e.value;if(Object.prototype.hasOwnProperty.call(e,"name"))return ha(e.name)}return""}function Sl(e){const t=ir(e,["backupVaultRecords","backupVault","vault","records","entries","items","list","values","data"],r=>r&&typeof r=="object");return $o(t)}function wl(e){const t=$o(e);if(!t.length)return;const r=jp(),n=vp(r,t);try{fe("cineBackupVaultFallbackRecords",JSON.stringify(n))}catch(a){console.warn("Unable to persist imported backup vault fallback records",a)}const o=Ip();if(!o||typeof o.queueBackupPayloadForVault!="function")return;const i=a=>{o.queueBackupPayloadForVault(a.fileName,a.payload,{id:a.id,createdAt:a.createdAt,createdAtMs:a.createdAtMs,source:a.metadata&&a.metadata.source?a.metadata.source:void 0,reason:a.metadata&&a.metadata.reason?a.metadata.reason:void 0,permissionState:a.metadata&&a.metadata.permissionState?a.metadata.permissionState:void 0})},s=typeof o.listBackupVaultRecords=="function"?o.listBackupVaultRecords:typeof o.getQueuedBackupPayloads=="function"?o.getQueuedBackupPayloads:null;if(!s){t.forEach(i);return}try{const a=s();if(Array.isArray(a)){const c=new Set(a.map(l=>l&&l.id?l.id:null));t.forEach(l=>{c.has(l.id)||i(l)});return}if(a&&typeof a.then=="function"){a.then(c=>{const l=new Set(Array.isArray(c)?c.map(f=>f&&f.id?f.id:null):[]);t.forEach(f=>{l.has(f.id)||i(f)})}).catch(c=>{console.warn("Unable to inspect backup vault before import",c),t.forEach(i)});return}t.forEach(i)}catch(a){console.warn("Unable to import backup vault records via backup module",a),t.forEach(i)}}function yb(e){return Pt(e)}function We(e,t){if(!P(e))return null;const r=yb(t);for(let n=0;n<r.length;n+=1){const o=r[n];if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"primary"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${he}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"backup"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${ln}`;if(console.log("DEBUG: readSnapshotEntry checking migration candidate",o,Object.prototype.hasOwnProperty.call(e,o)),Object.prototype.hasOwnProperty.call(e,o))return console.log("DEBUG: readSnapshotEntry FOUND migration backup",o),{key:o,value:e[o],type:"migration-backup"}}return null}function Ln(e){if(!e)return;let t=e.value;if(e.type==="migration-backup")try{const r=typeof t=="string"?JSON.parse(t):t;if(r&&typeof r=="object"){const n=typeof r.compression=="string"?r.compression.trim():"",o=typeof r.encoding=="string"?r.encoding.trim():"",i=n===Ef&&o===Af,s=Lo.test(n)||Lo.test(o);if((i||s)&&typeof r.data=="string")if(tc()){let a=typeof r.compressionVariant=="string"&&r.compressionVariant?r.compressionVariant:null;a||(s?a=ll(o)||ll(n)||"utf16":a="utf16");const c=Cf(r.data,ys,a,"migration backup entry");if(c.success&&typeof c.value=="string")try{const l=JSON.parse(c.value);l&&typeof l=="object"&&Object.prototype.hasOwnProperty.call(l,"data")?t=l.data:t=null}catch(l){console.log("DEBUG: extractSnapshotStoredValue parse error",l),t=null}else console.log("DEBUG: extractSnapshotStoredValue decompression failed",c),console.warn("Unable to decompress migration backup entry during import",e&&e.key,c.error),t=null}else console.log("DEBUG: extractSnapshotStoredValue compression unavailable"),console.warn("Compression support is unavailable while reading migration backup entry",e&&e.key),t=null;else Object.prototype.hasOwnProperty.call(r,"data")?t=r.data:t=null}else t=null}catch(r){console.warn("Unable to parse migration backup entry during import",e.key,r),t=null}return t}function ci(e){const t=Ln(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=nr(t);if(r===null)return null;if(r===void 0)return;if(typeof r!="string")return r;const n=r.trim();if(!n)return"";try{return JSON.parse(n)}catch{return r}}return t}}function Sr(e){const t=Ln(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=nr(t);if(r===null)return null;if(r===void 0)return;if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return String(r);if(Array.isArray(r)||r&&typeof r=="object")try{return JSON.stringify(r)}catch(n){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,n),null}return null}if(typeof t=="number"||typeof t=="boolean")return String(t);if(Array.isArray(t)||t&&typeof t=="object")try{return JSON.stringify(t)}catch(r){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,r),null}return null}}function gb(e){if(!P(e)||["devices","setups","session","feedback","favorites","contacts","preferences","project","projects","autoGearRules","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","autoGearSeeded","autoGearActivePresetId","autoGearAutoPresetId","autoGearBackupRetention","autoGearShowBackups","fullBackupHistory","fullBackups","backupVaultRecords"].some(O=>Object.prototype.hasOwnProperty.call(e,O)))return null;const n={};let o=!1,i=!1;const s=["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",zt,Re],a=Ft(),c=new Set([rt,...s,a].filter(O=>typeof O=="string"&&O)),l=new Set(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"]),f=O=>{if(!O||typeof O.key!="string")return;if(O.key.startsWith("cameraPowerPlanner_")||O.key.startsWith("cinePowerPlanner_")||O.key.endsWith(he)||O.key.endsWith(ln)){i=!0;return}const E=O.key.replace(/(?:__backup|__legacyMigrationBackup)$/u,"");c.has(E)&&(i=!0)},u=(O,E)=>{const I=We(e,O);if(!I)return;f(I);const B=ci(I);B!==void 0&&(n[E]=B,o=!0)};u(Ze,"devices"),u(pt,"setups"),u(er,"session"),u(Mr,"feedback"),u(pe,"project"),u(et,"favorites"),u(tt,"contacts"),u(Gt,"ownGear"),u(ct,"userProfile"),u(Lr,"documentationTracker"),u(Br,"autoGearRules"),u(ut,"autoGearBackups"),u(Dt,"autoGearPresets"),u(Ut,"autoGearMonitorDefaults"),u(Kt,"autoGearBackupRetention");const y=We(e,dt);if(y){f(y);const O=Sr(y);O!==void 0&&(n.schemaCache=O,o=!0)}const p=We(e,nn());if(p){f(p);const O=ci(p);O!==void 0&&(n.customFonts=O,o=!0)}const d=We(e,rt);if(d){f(d);const O=Sr(d);O!==void 0&&(n.customLogo=O,o=!0)}const m=We(e,cn);m&&(f(m),n.autoGearSeeded=Ln(m),o=!0);const g=We(e,Ot);g&&(f(g),n.autoGearActivePresetId=Sr(g),o=!0);const b=We(e,Qe);b&&(f(b),n.autoGearAutoPresetId=Sr(b),o=!0);const _=We(e,pr);_&&(f(_),n.autoGearShowBackups=Ln(_),o=!0);const w={};s.forEach(O=>{const E=We(e,O);if(!E)return;if(f(E),O===Re){const M=Sr(E);if(M!==void 0){const G=wc(M);if(G){if(G.normalized){w[O]=zr(G.normalized),o=!0;return}if(G.serialized){w[O]=G.serialized,o=!0;return}}}return}const I=Ln(E);if(l.has(O)){const M=In(I);if(M!==null){w[O]=M,o=!0;return}}const B=Sr(E);B!==void 0&&(w[O]=B,o=!0)});const h=We(e,lt);if(h){f(h);const O=Sr(h);if(typeof O=="string"){const E=O.trim();E&&(w.temperatureUnit=E,o=!0)}}const A=We(e,Je);if(A){f(A);const O=Sr(A);if(typeof O=="string"){const E=O.trim();E&&(w.focusScale=E,o=!0)}}const C=We(e,zt);if(C){f(C);const O=ci(C);O!==void 0&&(w.cameraColors=O,o=!0)}const j=We(e,a);if(j){f(j);const O=ci(j);O!==void 0&&(w.mountVoltages=O,o=!0)}return Object.keys(w).length>0&&(n.preferences=w),!o||!i?null:n}function Tp(e,t={}){if(console.error("DEBUG: importAllData CALLED",Object.keys(e)),Array.isArray(e)){wo(e,()=>yl());return}if(!P(e))return;const{skipSnapshotConversion:r=!1}=t||{};if(!r){const p=gb(e);if(p){Tp(p,{skipSnapshotConversion:!0});return}}const n=p=>Object.prototype.hasOwnProperty.call(e,p),o=Ft(),i=zt,s=Rp(),a=(p,d,m)=>{if(s&&typeof s[p]=="function")try{return s[p](m),!0}catch(g){console.warn(`Failed to persist Auto-Gear value with ${p}`,g)}return typeof d=="function"&&d(m),!1};if(n("devices")&&Df(e.devices),n("setups")&&cc(e.setups),n("session")&&ac(e.session,{disableCompression:!0}),n("feedback")&&pp(e.feedback),n("favorites")&&sp(e.favorites),n("contacts"))if(e.contacts===null)ga(null);else{const p=lb(e.contacts);ga(p)}if(n("ownGear")){const p=ir(e.ownGear,["items","entries","list","values","data"],d=>d&&typeof d=="object");lp(p)}if(n("userProfile")){if(e.userProfile===null)Oi(null);else if(P(e.userProfile)){const p=mc(e.userProfile);Oi(p||null)}}if(P(e.preferences)){const p=e.preferences;if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"].forEach(g=>{Object.prototype.hasOwnProperty.call(p,g)&&typeof p[g]=="boolean"&&fe(g,p[g])}),["accentColor","fontSize","fontFamily","language"].forEach(g=>{if(Object.prototype.hasOwnProperty.call(p,g)){const b=p[g];typeof b=="string"&&b&&fe(g,b)}}),Object.prototype.hasOwnProperty.call(p,"temperatureUnit")){const g=p.temperatureUnit;if(typeof g=="string"){const b=g.trim();b&&fe(lt,b)}else g===null&&fe(lt,null)}if(Object.prototype.hasOwnProperty.call(p,"focusScale")){const g=p.focusScale;if(typeof g=="string"){const b=g.trim();if(b&&(fe(Je,b),typeof window<"u"&&typeof window.applyFocusScalePreference=="function"))try{window.applyFocusScalePreference(b,{persist:!1,forceUpdate:!0})}catch(_){console.warn("Unable to apply imported focus scale preference",_)}}else g===null&&fe(Je,null)}if(Object.prototype.hasOwnProperty.call(p,Re)){const g=p[Re];if(g===null)fe(Re,null);else{const b=wc(g);if(b){if(b.normalized){const _=zr(b.normalized);let w=null;try{w=JSON.stringify(_)}catch(h){console.warn("Unable to serialize imported print preferences",h),w=null}if(w!==null)try{fe(Re,w)}catch(h){console.warn("Unable to persist imported print preferences",h)}if(typeof window<"u"&&typeof window.savePrintPreferences=="function")try{window.savePrintPreferences(_)}catch(h){console.warn("Unable to apply imported print preferences",h)}}else if(b.serialized)try{fe(Re,b.serialized)}catch(_){console.warn("Unable to store imported print preferences string value",_)}}}}if(Object.prototype.hasOwnProperty.call(p,"mountVoltages")){const g=p.mountVoltages;if(g&&typeof g=="object"){try{fe(o,JSON.stringify(g))}catch(b){console.warn("Unable to store imported mount voltages",b)}typeof window<"u"&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(g,{persist:!1,triggerUpdate:!0})}else if(typeof g=="string"){if(fe(o,g),typeof window<"u"&&typeof window.parseStoredMountVoltages=="function")try{const b=window.parseStoredMountVoltages(g);b&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(b,{persist:!1,triggerUpdate:!0})}catch(b){console.warn("Unable to parse imported mount voltages",b)}}else g===null&&(fe(o,null),typeof window<"u"&&typeof window.resetMountVoltagePreferences=="function"&&window.resetMountVoltagePreferences({persist:!1,triggerUpdate:!0}))}if(Object.prototype.hasOwnProperty.call(p,"cameraColors")){const g=p.cameraColors,b=_=>{if(!_||typeof _!="object")return!1;let w=!1;if(typeof window<"u"&&window&&typeof window.setCameraLetterColors=="function")try{window.setCameraLetterColors(_),w=!0}catch(A){console.warn("Unable to apply imported camera color preferences",A),w=!1}let h=null;try{h=JSON.stringify(_)}catch(A){console.warn("Unable to serialize imported camera color preferences",A),h=null}if(h)try{fe(i,h)}catch(A){console.warn("Unable to persist imported camera color preferences",A)}return w};if(g&&typeof g=="object")b(g);else if(typeof g=="string"){const _=g.trim();if(_){let w=null;try{w=JSON.parse(_)}catch(h){console.warn("Unable to parse imported camera color palette",h),w=null}if(w&&typeof w=="object")b(w);else try{fe(i,_)}catch(h){console.warn("Unable to store raw imported camera color palette",h)}}}else g===null&&fe(i,null)}}if(Object.prototype.hasOwnProperty.call(e,"customLogo")){const p=e.customLogo;typeof p=="string"&&p?fe(rt,p):fe(rt,null)}if(Object.prototype.hasOwnProperty.call(e,"customFonts")){const p=Pp(e.customFonts);if(p.length)try{fe(nn(),JSON.stringify(p))}catch(d){console.warn("Unable to store imported custom fonts",d)}else fe(nn(),null)}if(Object.prototype.hasOwnProperty.call(e,"schemaCache")){const p=e.schemaCache;if(typeof p=="string"||p===null)fe(dt,p);else if(p&&typeof p=="object")try{fe(dt,JSON.stringify(p))}catch(d){console.warn("Unable to store imported schema cache",d)}}if(Object.prototype.hasOwnProperty.call(e,"documentationTracker")){const p=Eo(e.documentationTracker);Ci(p)}else if(Object.prototype.hasOwnProperty.call(e,"documentationLogs")){const p=Eo({releases:e.documentationLogs});Ci(p)}else if(Object.prototype.hasOwnProperty.call(e,"documentationUpdateLog")){const p=Eo(e.documentationUpdateLog);Ci(p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearRules")){const p=ub(e.autoGearRules);a("persistAutoGearRules",hc,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackups")){const p=fb(e.autoGearBackups);a("persistAutoGearBackups",Xi,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearSeeded")){const p=In(e.autoGearSeeded);ma(p===null?!1:p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearPresets")){const p=pb(e.autoGearPresets);a("persistAutoGearPresets",Ss,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearMonitorDefaults")){const p=db(e.autoGearMonitorDefaults);a("persistAutoGearMonitorDefaults",Sc,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearActivePresetId")){const p=ha(e.autoGearActivePresetId);a("persistActivePresetId",Sp,typeof p=="string"?p:"")}if(Object.prototype.hasOwnProperty.call(e,"autoGearAutoPresetId")){const p=typeof e.autoGearAutoPresetId=="string"?e.autoGearAutoPresetId:"";a("persistAutoPresetId",wp,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearShowBackups")){const p=In(e.autoGearShowBackups);a("persistBackupVisibility",Ap,p===null?!1:p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackupRetention")){const p=_i(e.autoGearBackupRetention);typeof p=="number"&&Number.isFinite(p)&&a("persistBackupRetention",_p,p)}if(Object.prototype.hasOwnProperty.call(e,"fullBackupHistory")){const p=Jt(e.fullBackupHistory);Ji(p)}else if(Object.prototype.hasOwnProperty.call(e,"fullBackups")){const p=Jt(e.fullBackups);Ji(p)}if(Object.prototype.hasOwnProperty.call(e,"backupVaultRecords")){const p=Sl(e.backupVaultRecords);wl(p)}else if(Object.prototype.hasOwnProperty.call(e,"backupVault")){const p=Sl(e.backupVault);wl(p)}let c=null;const l=()=>(c||(c=yl()),c);let f=!1;const u=()=>{const p=l();return(d,m,g)=>{f=!0,p(d,m,g)}},y=(p,d)=>{const g=wo(p,()=>u(),d);return g&&(f=!0),g};e.project&&y(e.project,""),e.projects?y(e.projects):!e.project&&typeof e.gearList=="string"&&(u()("",{gearList:e.gearList}),f=!0),f||Hh(e).forEach((d,m)=>{if(d&&typeof d=="object"&&!Array.isArray(d)){const b=Yi(d)?d:$e(d);if(b&&Yi(b)){u()("",b,`Imported project ${m+1}`),f=!0;return}}wo(d,()=>u(),`Imported project ${m+1}`)&&(f=!0)})}function mb(){return Ve}var yr={getSafeLocalStorage:T,loadDeviceData:Ff,saveDeviceData:Df,loadSetups:Yo,saveSetups:cc,saveSetup:mh,loadSetup:hh,deleteSetup:bh,renameSetup:Sh,safeSetLocalStorage:fe,readLocalStorageValue:ge,getMountVoltageStorageKeyName:Ft,getMountVoltageStorageBackupKeyName:df,getProjectStorageRevisionKeyName:Yg,loadProjectStorageRevision:lf,loadProject:Zf,loadProjectMetadata:Fh,saveProject:yc,deleteProject:op,renameProject:Vh,createProjectDeletionBackup:Uh,loadSessionState:Bf,saveSessionState:ac,loadFavorites:ip,saveFavorites:sp,loadContacts:cp,saveContacts:ga,loadOwnGear:Qh,saveOwnGear:lp,loadUserProfile:up,saveUserProfile:Oi,loadDocumentationTracker:yp,saveDocumentationTracker:Ci,loadAutoGearBackups:bc,saveAutoGearBackups:Xi,loadFeedback:fp,saveFeedback:pp,clearAllData:rb,exportAllData:cb,prepareBackupForExport:ab,importAllData:Tp,loadAutoGearRules:gp,saveAutoGearRules:hc,loadAutoGearSeedFlag:mp,saveAutoGearSeedFlag:ma,loadAutoGearPresets:hp,saveAutoGearPresets:Ss,loadAutoGearMonitorDefaults:bp,saveAutoGearMonitorDefaults:Sc,loadAutoGearActivePresetId:rs,saveAutoGearActivePresetId:Sp,loadAutoGearAutoPresetId:ns,saveAutoGearAutoPresetId:wp,loadAutoGearBackupVisibility:Ep,saveAutoGearBackupVisibility:Ap,loadAutoGearBackupRetention:Cp,saveAutoGearBackupRetention:_p,getAutoGearBackupRetentionDefault:Ko,loadFullBackupHistory:To,saveFullBackupHistory:Ji,recordFullBackupHistoryEntry:dp,requestPersistentStorage:Lf,clearUiCacheStorageEntries:sn,ensureCriticalStorageBackups:gm,getLastCriticalStorageGuardResult:mm,decodeStoredValue:nr,getCompressionLogSnapshot:Bg,setActiveProjectCompressionHold:Nh,clearActiveProjectCompressionHold:Gh,invalidateProjectReadCache:fr,getProjectMemoryCache:mb,storageRepo:k},El={flag:ec,read:ef,write:hi,clear:Tg};try{Object.defineProperty(yr,"__testAutoBackupCompressionCache",{configurable:!1,enumerable:!1,writable:!1,value:El})}catch{yr.__testAutoBackupCompressionCache=El}typeof module<"u"&&module.exports&&(module.exports=yr);console.log("DEBUG: storage.js: starting global export loop");if(S&&typeof S=="object"){Object.keys(yr).forEach(e=>{const t=yr[e];if(typeof t=="function"&&typeof S[e]!="function")try{S[e]=t}catch{try{Object.defineProperty(S,e,{configurable:!0,writable:!0,value:t})}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Unable to expose storage helper ${e} globally.`,n)}}});try{typeof S.recordFullBackupHistoryEntry!="function"&&(S.recordFullBackupHistoryEntry=dp),typeof S.loadFullBackupHistory!="function"&&(S.loadFullBackupHistory=To)}catch{}}if(S)try{Object.defineProperty(S,"__cineStorageApi",{configurable:!0,writable:!0,value:yr})}catch{S.__cineStorageApi=yr}console.log("DEBUG: storage.js execution finished");const hb=yr,Qt=Object.freeze(Object.defineProperty({__proto__:null,cineStorage:hb,default:yr},Symbol.toStringTag,{value:"Module"}));var Al={};const ws=Vn();function bb(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const o=n&&n.cineModuleLinker;if(o&&typeof o=="object")return o}catch{}}return null}function Sb(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function wb(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}const ie=bb(ws),X=ie&&typeof ie.getModuleEnvironment=="function"?ie.getModuleEnvironment():Sb(ws),Z=ie&&typeof ie.getEnvironmentBridge=="function"?ie.getEnvironmentBridge():wb(ws),H=(ie&&typeof ie.getGlobalScope=="function"?ie.getGlobalScope():null)||(Z&&typeof Z.getGlobalScope=="function"?Z.getGlobalScope():null)||(X&&typeof X.getGlobalScope=="function"?X.getGlobalScope():null)||ws;function Eb(){const e=[H];typeof globalThis<"u"&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&e.indexOf(global)===-1&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&typeof r.cineModuleGlobals=="object")return r.cineModuleGlobals}return null}const ee=(ie&&typeof ie.getModuleGlobals=="function"?ie.getModuleGlobals():null)||Eb();function Ab(e,t){if(ie&&typeof ie.recordModule=="function"&&ie.recordModule(e,t),!(!ee||typeof ee.recordModule!="function"))try{ee.recordModule(e,t)}catch{}}function Ol(e){return null}(function(){return ie&&typeof ie.tryRequire=="function"?ie.tryRequire:ee&&typeof ee.tryRequire=="function"?ee.tryRequire:Z&&typeof Z.tryRequire=="function"?function(r){const n=Z.tryRequire(r);return typeof n>"u"?Ol():n}:X&&typeof X.tryRequire=="function"?X.tryRequire:Ol})();function Ob(e){const t=e||H;if(ie&&typeof ie.getModuleRegistry=="function"){const n=ie.getModuleRegistry(t);if(n)return n}if(ee&&typeof ee.resolveModuleRegistry=="function")try{const n=ee.resolveModuleRegistry(t);if(n)return n}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const n=Z.getModuleRegistry(t);if(n)return n}catch{}if(X&&typeof X.resolveModuleRegistry=="function")try{const n=X.resolveModuleRegistry(t);if(n)return n}catch{}if(Se&&typeof Se=="object")return Se;const r=[t];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModules=="object")return o.cineModules}return null}const Rn=(function(){if(ie&&typeof ie.getModuleRegistry=="function"){const e=ie.getModuleRegistry(H);if(e)return e}if(ee&&typeof ee.getModuleRegistry=="function")try{const e=ee.getModuleRegistry(H);if(e)return e}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const e=Z.getModuleRegistry(H);if(e)return e}catch{}if(X&&typeof X.getModuleRegistry=="function")try{const e=X.getModuleRegistry(H);if(e)return e}catch{}return Ob(H)})(),yn=(function(){if(ie&&typeof ie.getPendingQueueKey=="function"){const t=ie.getPendingQueueKey();if(typeof t=="string"&&t)return t}if(ee&&typeof ee.getPendingQueueKey=="function")try{const t=ee.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}if(Z&&typeof Z.getPendingQueueKey=="function")try{const t=Z.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return X&&typeof X.PENDING_QUEUE_KEY=="string"?X.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function Cb(e){if(!e||typeof e!="object")return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}return t}function _b(e,t,r){if(ee&&typeof ee.queueModuleRegistration=="function")try{if(ee.queueModuleRegistration(e,t,r,H))return!0}catch{}if(Z&&typeof Z.queueModuleRegistration=="function")try{if(Z.queueModuleRegistration(e,t,r))return!0}catch{}if(X&&typeof X.queueModuleRegistration=="function")return X.queueModuleRegistration(e,t,r,H);if(!H||typeof H!="object")return!1;const n=Object.freeze({name:e,api:t,options:Object.freeze(Cb(r))});let o=H[yn];if(!Array.isArray(o))try{Object.defineProperty(H,yn,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=H[yn]}catch{try{Array.isArray(H[yn])||(H[yn]=[]),o=H[yn]}catch{return!1}}try{o.push(n)}catch{o[o.length]=n}return!0}function xs(e,t,r,n){if(Rn&&typeof Rn.register=="function")try{return Rn.register(e,t,r),!0}catch(o){if(typeof n=="function")try{n(o)}catch{}}return _b(e,t,r),!1}const Pb=(function(){return ee&&typeof ee.registerOrQueueModule=="function"?function(r,n,o,i){try{if(ee.registerOrQueueModule(r,n,o,i,H,Rn))return!0}catch{}return xs(r,n,o,i)}:Z&&typeof Z.registerOrQueueModule=="function"?function(r,n,o,i){try{if(Z.registerOrQueueModule(r,n,o,i,H,Rn))return!0}catch{}return xs(r,n,o,i)}:X&&typeof X.registerOrQueueModule=="function"?function(r,n,o,i){return X.registerOrQueueModule(r,n,o,i,H,Rn)}:xs})();function kb(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function vb(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(kb(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function jb(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function ba(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||vb(e))return e;if(typeof process<"u"&&process&&Al&&Al.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const r=jb(t);if(r.has(e))return e;r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||ba(s,r)}try{return Object.freeze(e)}catch{return e}}const Ec=(function(){return ee&&typeof ee.freezeDeep=="function"?ee.freezeDeep:Z&&typeof Z.freezeDeep=="function"?function(r,n){try{return Z.freezeDeep(r,n)}catch{return ba(r,n)}}:X&&typeof X.freezeDeep=="function"?X.freezeDeep:ba})();function Cl(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Ib=(function(){return ee&&typeof ee.safeWarn=="function"?ee.safeWarn:Z&&typeof Z.safeWarn=="function"?function(r,n){try{Z.safeWarn(r,n)}catch{Cl(r,n)}}:X&&typeof X.safeWarn=="function"?X.safeWarn:Cl})();function Fs(e,t){if(!H||typeof H!="object")return!1;try{return Object.defineProperty(H,e,{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{try{return H[e]=t,!0}catch{return!1}}}const Lb=(function(){return ee&&typeof ee.exposeGlobal=="function"?function(r,n,o){try{return ee.exposeGlobal(r,n,o)}catch{return Fs(r,n)}}:Z&&typeof Z.exposeGlobal=="function"?function(r,n,o){try{return Z.exposeGlobal(r,n,o)}catch{return Fs(r,n)}}:X&&typeof X.exposeGlobal=="function"?function(r,n,o){return X.exposeGlobal(r,n,H,o)}:Fs})(),Sa=[];function Jo(e,t){!e||typeof e!="object"||Sa.push({ref:e,name:t||null})}Jo(H,"global");Qt&&typeof Qt=="object"&&Jo(Qt,"storage");H.cineAppSession&&Jo(H.cineAppSession,"session");H.cineAppSetups&&Jo(H.cineAppSetups,"setups");const wa=Object.create(null),An=[];function Rb(e){if(!e)return null;if(e.name)return e.name;const t=e.ref;return!t||typeof t!="object"?null:t===H?"global":typeof t.constructor=="function"&&t.constructor.name?t.constructor.name:null}function Mp(e,t){const r=String(e);let n=wa[r];return n?t&&n.implementationName!==t&&(n.implementationName=t):(n={name:r,implementationName:t||r,available:!1,providerIndex:-1,providerName:null,lastChecked:null,implementation:null},wa[r]=n,An.push(r)),n}function Ac(e,t={}){const r=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,n=Mp(e),o=n.implementationName||String(e);if(!r&&n.implementation&&typeof n.implementation=="function")return n;let i=null;for(let s=0;s<Sa.length;s+=1){const a=Sa[s],c=a&&a.ref;if(!c||typeof c!="object")continue;const l=c[o];if(typeof l=="function"){i={implementation:l,providerIndex:s,providerName:Rb(a)};break}}return n.available=!!i,n.providerIndex=i?i.providerIndex:-1,n.providerName=i?i.providerName:null,n.lastChecked=Date.now(),n.implementation=i?i.implementation:null,n}function Tb(e){const t=Ac(e,{refresh:!0});if(!t||typeof t.implementation!="function"){const r=new Error(`cinePersistence could not resolve function "${e}".`);throw r.code="CINE_PERSISTENCE_BINDING_MISSING",r.binding=e,r.detail={name:e,available:t?t.available:!1,providerName:t?t.providerName:null},r}return t.implementation}function Np(e){return e?Object.freeze({name:e.name,available:!!e.available,providerIndex:typeof e.providerIndex=="number"?e.providerIndex:-1,providerName:e.providerName||null,lastChecked:e.lastChecked||null,implementation:e.implementationName||e.name}):null}function v(e,t){const r=t||e;return Mp(r,e),function(){return Tb(r).apply(this,arguments)}}function Mb(e,t={}){const r=String(e),n=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,o=Ac(r,{refresh:n});return Np(o)}function Nb(e={}){if(e&&Object.prototype.hasOwnProperty.call(e,"refresh")?e.refresh:!0)for(let n=0;n<An.length;n+=1)Ac(An[n],{refresh:!0});const r={};for(let n=0;n<An.length;n+=1){const o=An[n];r[o]=Np(wa[o])}return Ec(r)}function Gb(){return An.slice()}const $n={bindings:{saveSession:v("saveCurrentSession","saveSession"),autoSaveSetup:v("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:v("saveCurrentGearList","saveGearList"),restoreSessionState:v("restoreSessionState"),collectFullBackupData:v("collectFullBackupData"),createSettingsBackup:v("createSettingsBackup"),captureStorageSnapshot:v("captureStorageSnapshot"),sanitizeBackupPayload:v("sanitizeBackupPayload"),autoBackup:v("autoBackup"),formatFullBackupFilename:v("formatFullBackupFilename"),downloadPayload:v("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:v("recordFullBackupHistoryEntry"),encodeSharedSetup:v("encodeSharedSetup"),decodeSharedSetup:v("decodeSharedSetup"),applySharedSetup:v("applySharedSetup"),applySharedSetupFromUrl:v("applySharedSetupFromUrl"),downloadProject:v("downloadSharedProject","downloadProject"),saveProject:v("saveProject"),proceed:v("handleRestoreRehearsalProceed","proceed"),abort:v("handleRestoreRehearsalAbort","abort")},storage:{loadDeviceData:v("loadDeviceData"),saveDeviceData:v("saveDeviceData"),loadSetups:v("loadSetups"),saveSetups:v("saveSetups"),saveSetup:v("saveSetup"),loadSetup:v("loadSetup"),deleteSetup:v("deleteSetup"),renameSetup:v("renameSetup"),loadSessionState:v("loadSessionState"),saveSessionState:v("saveSessionState"),loadFeedback:v("loadFeedback"),saveFeedback:v("saveFeedback"),saveProject:v("saveProject"),loadProject:v("loadProject"),deleteProject:v("deleteProject"),loadFavorites:v("loadFavorites"),saveFavorites:v("saveFavorites"),exportAllData:v("exportAllData"),importAllData:v("importAllData"),clearAllData:v("clearAllData"),loadAutoGearRules:v("loadAutoGearRules"),saveAutoGearRules:v("saveAutoGearRules"),loadAutoGearBackups:v("loadAutoGearBackups"),saveAutoGearBackups:v("saveAutoGearBackups"),loadAutoGearSeedFlag:v("loadAutoGearSeedFlag"),saveAutoGearSeedFlag:v("saveAutoGearSeedFlag"),loadAutoGearBackupRetention:v("loadAutoGearBackupRetention"),saveAutoGearBackupRetention:v("saveAutoGearBackupRetention"),getAutoGearBackupRetentionDefault:v("getAutoGearBackupRetentionDefault"),loadAutoGearPresets:v("loadAutoGearPresets"),saveAutoGearPresets:v("saveAutoGearPresets"),loadAutoGearActivePresetId:v("loadAutoGearActivePresetId"),saveAutoGearActivePresetId:v("saveAutoGearActivePresetId"),loadAutoGearAutoPresetId:v("loadAutoGearAutoPresetId"),saveAutoGearAutoPresetId:v("saveAutoGearAutoPresetId"),loadAutoGearMonitorDefaults:v("loadAutoGearMonitorDefaults"),saveAutoGearMonitorDefaults:v("saveAutoGearMonitorDefaults"),loadAutoGearBackupVisibility:v("loadAutoGearBackupVisibility"),saveAutoGearBackupVisibility:v("saveAutoGearBackupVisibility"),loadFullBackupHistory:v("loadFullBackupHistory"),saveFullBackupHistory:v("saveFullBackupHistory"),recordFullBackupHistoryEntry:v("recordFullBackupHistoryEntry"),requestPersistentStorage:v("requestPersistentStorage"),clearUiCacheStorageEntries:v("clearUiCacheStorageEntries"),ensureCriticalStorageBackups:v("ensureCriticalStorageBackups"),getLastCriticalStorageGuardResult:v("getLastCriticalStorageGuardResult"),saveSession:v("saveCurrentSession","saveSession"),autoSaveSetup:v("autoSaveCurrentSetup","autoSaveSetup"),proceed:v("handleRestoreRehearsalProceed","proceed"),abort:v("handleRestoreRehearsalAbort","abort")},autosave:{saveSession:v("saveCurrentSession","saveSession"),autoSaveSetup:v("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:v("saveCurrentGearList","saveGearList"),restoreSessionState:v("restoreSessionState")},backups:{collectFullBackupData:v("collectFullBackupData"),createSettingsBackup:v("createSettingsBackup"),captureStorageSnapshot:v("captureStorageSnapshot"),sanitizeBackupPayload:v("sanitizeBackupPayload"),autoBackup:v("autoBackup"),formatFullBackupFilename:v("formatFullBackupFilename"),downloadPayload:v("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:v("recordFullBackupHistoryEntry")},restore:{proceed:v("handleRestoreRehearsalProceed","proceed"),abort:v("handleRestoreRehearsalAbort","abort")},share:{downloadProject:v("downloadSharedProject","downloadProject"),encodeSharedSetup:v("encodeSharedSetup"),decodeSharedSetup:v("decodeSharedSetup"),applySharedSetup:v("applySharedSetup"),applySharedSetupFromUrl:v("applySharedSetupFromUrl")},__internal:Ec({listBindings:Gb,inspectBinding(e,t){return Mb(e,t)||null},inspectAllBindings:Nb})};Ec($n);Jo($n.bindings,"bindings");Ab("cinePersistence",$n);Pb("cinePersistence",$n,{category:"persistence",description:"Data integrity facade for storage, autosave, backups, restore, and share flows.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},e=>{Ib("Unable to register cinePersistence module.",e)});if(H&&typeof H=="object"){let e=null;try{e=H.cinePersistence||null}catch{e=null}e!==$n&&!Lb("cinePersistence",$n,{configurable:!0,enumerable:!1,writable:!1})&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose cinePersistence globally.")}function zb(){return Object.freeze({ESSENTIAL:"essential",FILM:"film",GADGET:"gadget",UICONS:"uicons",TEXT:"text"})}function gn(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function Yb(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=gn(t),a=gn(r),c=gn(n),l=gn(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(u,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[],m=/(?:^|\s)width\s*=/i.test(p),g=/(?:^|\s)height\s*=/i.test(p);return m||d.push(`width="${c}"`),g||d.push(`height="${l}"`),d.push(`x="-${gn(i)}"`),d.push(`y="-${gn(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}function li(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return null;try{if(typeof String.fromCodePoint=="function")return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):null}function _l(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=li(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=li(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=li(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=li(i[1],10);if(s)return s}return t}function Bb(e){const t=zb();new Set(Object.values(t).filter(Boolean));const r=t.UICONS;if(!e)return{char:"",font:r,className:""};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:_l(e),font:r,className:""};if(typeof e=="object"){const n=typeof e.char=="string"?_l(e.char):"",o=e.font&&typeof e.font=="string"?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:""}}function Jb(e,t){if(!e)return;const r=Bb(t);if(r&&r.markup){let o=r.markup;o.includes("aria-hidden")||(o=o.replace("<svg",'<svg aria-hidden="true"')),e.innerHTML=o,o.includes("aria-hidden")||e.setAttribute("aria-hidden","true"),r.className&&e.classList&&r.className.split(/\s+/).filter(Boolean).forEach(i=>e.classList.add(i)),e.removeAttribute("data-icon-font");return}const n=r&&r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font||"uicons"):e.removeAttribute("data-icon-font")}const xb="__backup",Fb="__legacyMigrationBackup",$r="cameraPowerPlanner_devices",Mt=(function(){const t={},r=(o,i)=>{if(!o||typeof t[i]=="function")return;const s=o[i];typeof s=="function"&&(t[i]=s)};Qt&&(r(Qt,"getSafeLocalStorage"),r(Qt,"saveDeviceData"),r(Qt,"clearUiCacheStorageEntries"),r(Qt,"getDeviceStorageKeyVariants"),r(Qt,"getStorageKeyVariants"));const n=[];typeof globalThis<"u"&&n.push(globalThis),typeof window<"u"&&n.push(window),typeof self<"u"&&n.push(self);for(const o of n)if(o&&(r(o,"getSafeLocalStorage"),r(o,"saveDeviceData"),r(o,"clearUiCacheStorageEntries"),t.getSafeLocalStorage&&t.saveDeviceData&&t.clearUiCacheStorageEntries))break;return t})();function Db(e,t){if(typeof e!="string"||!e)return!1;const r=t||{},n=new Set;n.add(e),n.add(`${e}${xb}`),n.add(`${e}${Fb}`);let o=!1;const i=r.logPrefix||"Failed to clear device storage variant",s=new Set;if(Mt.getSafeLocalStorage)try{const c=Mt.getSafeLocalStorage();c&&s.add(c)}catch(c){console.warn(`${i}: safe storage lookup failed`,c)}typeof localStorage<"u"&&s.add(localStorage),typeof window<"u"&&window.localStorage&&s.add(window.localStorage);const a=Array.from(n);if(s.forEach(c=>{!c||typeof c.removeItem!="function"||a.forEach(l=>{try{c.removeItem(l),o=!0}catch(f){console.warn(`${i} "${l}"`,f)}})}),Mt.clearUiCacheStorageEntries)try{Mt.clearUiCacheStorageEntries(a)}catch(c){console.warn("Failed to clear UI cache entries for device storage reset",c)}return o}function Ub(){if(Mt.getDeviceStorageKeyVariants)return Array.from(Mt.getDeviceStorageKeyVariants());if(Mt.getStorageKeyVariants)return Array.from(Mt.getStorageKeyVariants($r));const e=new Set;return e.add($r),$r.startsWith("cameraPowerPlanner_")?e.add(`cinePowerPlanner_${$r.slice(19)}`):$r.startsWith("cinePowerPlanner_")&&e.add(`cameraPowerPlanner_${$r.slice(17)}`),Array.from(e)}function Qb(){const e=Ub();if(!e)return!1;let t=!1;return e.forEach(r=>{if(r===$r&&Mt.saveDeviceData)try{Mt.saveDeviceData(null),t=!0}catch(n){console.warn("Failed to clear primary device storage via saveDeviceData",n)}Db(r,{logPrefix:"Failed to clear device storage variant"})&&(t=!0)}),t}const Kb=Object.freeze(["power","video","fiz","cables"]);function Xb(e){const t=[],r=new Set,n=o=>{if(typeof o!="string")return;const i=o.trim();!i||r.has(i)||(r.add(i),t.push(i))};try{const o=typeof deviceSchema<"u"?deviceSchema:null;o?.accessories?.cables&&Object.keys(o.accessories.cables).forEach(n)}catch{}Kb.forEach(n);try{const o=typeof devices<"u"?devices:null;o?.accessories?.cables&&Object.keys(o.accessories.cables).forEach(n)}catch{}return Array.isArray(e)?e.forEach(n):e&&n(e),t}const Ds=Object.freeze({autoGearRules:"cameraPowerPlanner_autoGearRules",autoGearBackups:"cameraPowerPlanner_autoGearBackups",autoGearPresets:"cameraPowerPlanner_autoGearPresets",autoGearMonitorDefaults:"cameraPowerPlanner_autoGearMonitorDefaults",autoGearActivePresetId:"cameraPowerPlanner_autoGearActivePreset",autoGearAutoPresetId:"cameraPowerPlanner_autoGearAutoPreset",autoGearBackupRetention:"cameraPowerPlanner_autoGearBackupRetention",autoGearShowBackups:"cameraPowerPlanner_autoGearShowBackups"}),wr=Object.freeze({autoGearRules:Object.freeze([]),autoGearBackups:Object.freeze([]),autoGearPresets:Object.freeze([]),autoGearMonitorDefaults:Object.freeze({}),autoGearActivePresetId:"",autoGearAutoPresetId:"",autoGearBackupRetention:null,autoGearShowBackups:!1}),St=Vn();function Pi(e){return Array.isArray(e)?e.slice():e&&typeof e=="object"?{...e}:e}function Er(e){return{hydrated:!1,value:Pi(e)}}function Pl(){return{autoGearRules:Er(wr.autoGearRules),autoGearBackups:Er(wr.autoGearBackups),autoGearPresets:Er(wr.autoGearPresets),autoGearMonitorDefaults:Er(wr.autoGearMonitorDefaults),autoGearActivePresetId:Er(wr.autoGearActivePresetId),autoGearAutoPresetId:Er(wr.autoGearAutoPresetId),autoGearBackupRetention:Er(wr.autoGearBackupRetention),autoGearShowBackups:Er(wr.autoGearShowBackups)}}function $b(){const e=[];St&&e.push(St),typeof globalThis<"u"&&globalThis!==St&&e.push(globalThis),typeof window<"u"&&window!==St&&e.push(window),typeof self<"u"&&self!==St&&e.push(self),typeof global<"u"&&global!==St&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object")){if(r.cinePersistence)return r;if(r.cineModules&&typeof r.cineModules.get=="function"){const n=r.cineModules.get("cinePersistence");if(n)return{cinePersistence:n}}}}return null}class Vb{constructor(){this.cache=Pl(),this.hydrating=null}hydrateCache(t={}){const r=t&&t.force===!0;return this.hydrating&&!r?this.hydrating:(this.hydrating=(async()=>{const o=Object.keys(Ds).map(async i=>{const s=Ds[i];try{const a=await k.getItem(s);this.setCacheValue(i,a,{hydrate:!0})}catch(a){console.warn("[AutoGearService] Failed to hydrate",s,a),this.setCacheValue(i,void 0,{hydrate:!0,skipUpdate:!0})}});return await Promise.all(o),this.getCacheSnapshot()})(),this.hydrating)}getCacheSnapshot(){const t={};return Object.keys(this.cache).forEach(r=>{t[r]=Pi(this.cache[r].value)}),t}setCacheValue(t,r,n={}){const o=this.cache[t];if(!o)return;const i=n&&n.hydrate===!0;!(n&&n.skipUpdate===!0)&&typeof r<"u"&&r!==null&&(o.value=Pi(r)),i&&(o.hydrated=!0)}getCacheValue(t){const r=this.cache[t];if(r)return Pi(r.value)}async persistValue(t,r,n){this.setCacheValue(t,r);const o=$b(),i=o?o.cinePersistence:null;if(i&&i.storage&&typeof i.storage[n]=="function")return i.storage[n](r);const s=Ds[t];return k.setItem(s,r)}readAutoGearRules(){return this.getCacheValue("autoGearRules")||[]}readAutoGearBackups(){return this.getCacheValue("autoGearBackups")||[]}readAutoGearPresets(){return this.getCacheValue("autoGearPresets")||[]}readAutoGearMonitorDefaults(){return this.getCacheValue("autoGearMonitorDefaults")||{}}readActivePresetId(){const t=this.getCacheValue("autoGearActivePresetId");return typeof t=="string"?t:""}readAutoPresetId(){const t=this.getCacheValue("autoGearAutoPresetId");return typeof t=="string"?t:""}readBackupRetention(){return this.getCacheValue("autoGearBackupRetention")}readBackupVisibility(){return!!this.getCacheValue("autoGearShowBackups")}persistAutoGearRules(t){return this.persistValue("autoGearRules",Array.isArray(t)?t:[],"saveAutoGearRules")}persistAutoGearBackups(t){return this.persistValue("autoGearBackups",Array.isArray(t)?t:[],"saveAutoGearBackups")}persistAutoGearPresets(t){return this.persistValue("autoGearPresets",Array.isArray(t)?t:[],"saveAutoGearPresets")}persistAutoGearMonitorDefaults(t){const r=t&&typeof t=="object"?t:{};return this.persistValue("autoGearMonitorDefaults",r,"saveAutoGearMonitorDefaults")}persistActivePresetId(t){const r=typeof t=="string"?t:"";return this.persistValue("autoGearActivePresetId",r,"saveAutoGearActivePresetId")}persistAutoPresetId(t){const r=typeof t=="string"?t:"";return this.persistValue("autoGearAutoPresetId",r,"saveAutoGearAutoPresetId")}persistBackupRetention(t){return this.persistValue("autoGearBackupRetention",t,"saveAutoGearBackupRetention")}persistBackupVisibility(t){return this.persistValue("autoGearShowBackups",!!t,"saveAutoGearBackupVisibility")}__internalResetCache(){this.cache=Pl(),this.hydrating=null}}const os=new Vb;os.hydrateCache().catch(e=>{console.warn("[AutoGearService] Initial hydration failed",e)});if(St&&typeof St=="object"&&!St.cineAutoGearPersistence)try{Object.defineProperty(St,"cineAutoGearPersistence",{configurable:!0,enumerable:!1,writable:!1,value:os})}catch{St.cineAutoGearPersistence=os}Se.register("cineAutoGearPersistence",os,{category:"persistence",description:"Twin-store persistence cache for Auto-Gear state.",connections:["cinePersistence","cineModuleGlobals"],freeze:!1,replace:!0});class Hb{async getProject(t){if(!t)return null;try{const r=await k.loadProject(t);return r?r.data:null}catch(r){return console.error("[ProjectService] Failed to load project:",t,r),null}}async getProjectNames(){try{return await k.getProjectKeys()}catch(t){return console.error("[ProjectService] Failed to get project names:",t),[]}}async getProjectMetadata(t){if(!t)return{};try{const r=await k.getProjectMeta(t),n=await k.loadProject(t);if(n&&n.data)return n.data}catch(r){console.error("[ProjectService] Failed to get project metadata:",t,r)}return{}}async saveProject(t,r){if(!t||!r)return!1;try{return typeof r!="object"?(console.warn("[ProjectService] Invalid project data"),!1):(r.lastModified||(r.lastModified=new Date().toISOString()),(await k.saveProject(t,r)).success)}catch(n){return console.error("[ProjectService] Failed to save project:",t,n),!1}}async createProject(t){if(!t)return!1;const r={created:new Date().toISOString(),lastModified:new Date().toISOString(),gearList:"",projectInfo:null,gearListAndProjectRequirementsGenerated:!1,color:"blue",icon:"📽️"};return this.saveProject(t,r)}async deleteProject(t){if(!t)return!1;try{return await k.removeProject(t),!0}catch(r){return console.error("[ProjectService] Failed to delete project:",t,r),!1}}async duplicateProject(t){try{if(typeof t!="string"||t.length===0)return{success:!1};const r=t.trim(),n=await this.getProject(r);if(!n)return{success:!1};const o=await this.getProjectNames();let i=`${r} (Copy)`,s=2;for(;o.includes(i);)i=`${r} (Copy ${s})`,s++;const a=JSON.parse(JSON.stringify(n));return a.created=new Date().toISOString(),a.lastModified=new Date().toISOString(),{success:await this.saveProject(i,a),newId:i}}catch(r){return console.error("[ProjectService] Failed to duplicate project:",r),{success:!1}}}}const Zb=new Hb;export{Tl as I,Ml as _,Vn as a,Aa as b,Ll as c,Xs as d,vl as e,Wl as f,xp as g,_a as h,F as i,Bb as j,gn as k,Yb as l,Jb as m,zb as n,Xb as o,Zb as p,Qb as q,Se as r,k as s,Wb as t,yg as u};
//# sourceMappingURL=core-modules-CRzuBuee.js.map
