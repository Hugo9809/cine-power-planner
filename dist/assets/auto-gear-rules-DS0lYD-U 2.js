function ne(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const g=ne(),Y=new Set;function _(e,r){Y.has(e)||(Y.add(e),typeof console<"u"&&typeof console.warn=="function"&&(r?console.warn(`[cine] Missing auto gear helper: ${e}`,r):console.warn(`[cine] Missing auto gear helper: ${e}`)))}function ie(){if(!g||typeof g!="object"&&typeof g!="function")return null;try{if(g.cineCoreAutoGearUi&&typeof g.cineCoreAutoGearUi=="object")return g.cineCoreAutoGearUi}catch(e){_("cineCoreAutoGearUi",e)}return null}function N(e){if(typeof e!="string"||!e)return null;const r=ie();return r&&typeof r[e]=="function"?r[e]:g&&typeof g[e]=="function"?g[e]:(_(e),null)}function j(e,r){if(typeof e!="string"||!e||typeof r!="function")return!1;let t=!1;if(g&&(typeof g=="object"||typeof g=="function")&&typeof(()=>{try{return g[e]}catch{return}})()!="function")try{Object.defineProperty(g,e,{configurable:!0,enumerable:!1,writable:!0,value:r}),t=!0}catch{try{g[e]=r,t=!0}catch{}}const o=ie();if(o&&typeof o[e]!="function")try{o[e]=r,t=!0}catch{}return t}function Ge(e){if(typeof e!="string")return"";const r=e.trim();if(!r)return"";const t=r.toLowerCase();return t==="__none__"||t==="none"?"__none__":r}j("normalizeVideoDistributionOptionValue",Ge);function Se(e){if(e==="__none__"){const r=typeof currentLang=="string"&&currentLang?currentLang:"en",t=typeof texts=="object"&&texts?texts[r]||texts.en||{}:{};return t.viewfinderExtensionNone||t.autoGearViewfinderExtensionNone||"No"}return typeof e=="string"?e:""}function Re(e){if(e==="__none__"){const r=typeof currentLang=="string"&&currentLang?currentLang:"en";return(typeof texts=="object"&&texts?texts[r]||texts.en||{}:{}).autoGearVideoDistributionNone||"No video distribution selected"}return typeof e=="string"?e:""}function k(e,r,t){const o=N(e);if(typeof o=="function")try{const a=o.call(g,t);return a??r(t)}catch(a){_(e,a)}return r(t)}function ae(e){if(e==="__none__"){const r=typeof currentLang=="string"&&currentLang?currentLang:"en";return(typeof texts=="object"&&texts?texts[r]||texts.en||{}:{}).autoGearMatteboxNone||"No mattebox selected"}return typeof e=="string"?e:""}function we(e){return k("getMatteboxFallbackLabel",ae,e)}j("getMatteboxFallbackLabel",ae);function se(e){if(typeof e!="string")return"";const r=e.trim();if(!r)return"";const t=r.toLowerCase();return t==="__none__"||t==="none"?"__none__":r}j("normalizeMatteboxOptionValue",se);function J(e){const r=N("normalizeMatteboxOptionValue");if(typeof r=="function")try{return r.call(g,e)}catch(t){_("normalizeMatteboxOptionValue",t)}return se(e)}function Z(e){const r=N("normalizeVideoDistributionOptionValue");if(typeof r=="function")try{return r.call(g,e)}catch(a){_("normalizeVideoDistributionOptionValue",a)}if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const o=t.toLowerCase();return o==="__none__"||o==="none"?"__none__":t}function le(e){return k("getViewfinderFallbackLabel",Se,e)}function P(e){return k("getVideoDistributionFallbackLabel",Re,e)}function ve(e){const r=e&&(typeof e=="object"||typeof e=="function")?e:ne(),t=r&&(typeof r=="object"||typeof r=="function")?r:null;if(!t)return null;let o=null;try{t&&typeof t.cineModuleBase=="object"&&(o=t.cineModuleBase)}catch{o=null}if(o)return o;const a=Object.create(null),l=Object.create(null),n=(u,p)=>{if(typeof u!="string"||!u)return;const y=l[u];if(!(!Array.isArray(y)||y.length===0)){l[u]=[];for(let A=0;A<y.length;A+=1){const h=y[A];if(typeof h=="function")try{h(p)}catch{}}}},i=(u,p)=>{typeof u!="string"||!u||(a[u]=p,n(u,p))},c=u=>typeof u!="string"||!u?null:Object.prototype.hasOwnProperty.call(a,u)?a[u]:null,f=(u,p)=>{if(typeof p!="function"||typeof u!="string"||!u)return!1;const y=c(u);if(y){try{p(y)}catch{}return!0}return Array.isArray(l[u])||(l[u]=[]),l[u].push(p),!0},s=()=>{let u=null;try{u=t.cineModuleGlobals}catch{u=null}(!u||typeof u!="object")&&(u={}),typeof u.getModule!="function"&&(u.getModule=p=>c(p)),typeof u.whenModuleAvailable!="function"&&(u.whenModuleAvailable=(p,y)=>f(p,y)),typeof u.register!="function"&&(u.register=(p,y)=>(i(p,y),!0));try{Object.defineProperty(t,"cineModuleGlobals",{configurable:!0,enumerable:!1,writable:!0,value:u})}catch{try{t.cineModuleGlobals=u}catch{}}return u},d=()=>{let u=null;try{u=t.cineModules}catch{u=null}(!u||typeof u!="object")&&(u={}),typeof u.get!="function"&&(u.get=p=>c(p)),typeof u.register!="function"&&(u.register=(p,y)=>(i(p,y),!0));try{Object.defineProperty(t,"cineModules",{configurable:!0,enumerable:!1,writable:!0,value:u})}catch{try{t.cineModules=u}catch{}}return u},m={freezeDeep(u){return u},safeWarn(u,p){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof p>"u"?console.warn(u):console.warn(u,p)}catch{}},informModuleGlobals(u,p){const y=s();if(y&&typeof y.register=="function")try{return y.register(u,p),!0}catch{}return i(u,p),!0},registerOrQueueModule(u,p){const y=d();if(y&&typeof y.register=="function")try{y.register(u,p)}catch{i(u,p)}else i(u,p);return s(),!0},exposeGlobal(u,p,y,A={}){const h=y&&(typeof y=="object"||typeof y=="function")?y:t;if(!h||typeof h!="object"&&typeof h!="function")return!1;const G={configurable:A.configurable!==!1,enumerable:!!A.enumerable,writable:A.writable===!0,value:p};try{return Object.defineProperty(h,u,G),!0}catch{try{return h[u]=p,!0}catch{}}return!1}};return m.registerOrQueueModule("cineModuleBase",m),m.exposeGlobal("cineModuleBase",m,t,{configurable:!0,enumerable:!1,writable:!1}),s(),d(),m}function V(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}function Te(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function Ee(e){const r=Te(e);return r?function(o){if(o===null||typeof o!="object")return o;try{return r(o)}catch{}return V(o)}:V}const X=g&&typeof g.__cineDeepClone=="function"?g.__cineDeepClone:Ee(g);function xe(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const R=xe(g)||ve(g),Me=typeof R.freezeDeep=="function"?R.freezeDeep:function(r){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function")return r;const t=new WeakSet;function o(a){if(!a||typeof a!="object"&&typeof a!="function"||t.has(a))return a;t.add(a);try{const l=Object.getOwnPropertyNames(a);for(let n=0;n<l.length;n+=1){const i=l[n];let c;try{c=a[i]}catch(f){c=void 0}!c||typeof c=="function"||typeof c!="object"&&typeof c!="function"||o(c)}Object.freeze(a)}catch{}return a}return o(r)},De=typeof R.exposeGlobal=="function"?function(r,t,o){return R.exposeGlobal(r,t,g,o||{})}:function(r,t){try{return g[r]=t,!0}catch{return!1}},Ce=typeof R.getModuleRegistry=="function"?R.getModuleRegistry(g):null,_e=typeof R.registerOrQueueModule=="function"?function(r,t,o,a){return R.registerOrQueueModule(r,t,o,a,g,Ce)}:function(){return!1};let T=null,w=null;function Be(e){const r=[];function t(o){!o||typeof o!="object"&&typeof o!="function"||r.indexOf(o)===-1&&r.push(o)}return t(e),typeof globalThis<"u"&&t(globalThis),typeof window<"u"&&t(window),typeof self<"u"&&t(self),typeof global<"u"&&t(global),r}const ee=(function(){if(R&&typeof R.collectCandidateScopes=="function")try{const r=R.collectCandidateScopes(g);if(Array.isArray(r)&&r.length)return r}catch{}return Be(g)})(),te=(function(){const r=[];function t(o,a){if(typeof o!="function")return;r.some(n=>n&&n.fn===o)||r.push({fn:o,scope:a||null})}if(R&&(typeof R.structuredClone=="function"&&t(R.structuredClone,R),typeof R.getStructuredClone=="function"))try{const o=R.getStructuredClone();t(o,R)}catch{}for(let o=0;o<ee.length;o+=1){const a=ee[o];if(!a||typeof a!="object"&&typeof a!="function")continue;const l=a.structuredClone;typeof l=="function"&&t(l,a)}return r})();let H=null;function He(e){if(H)try{const r=H;return{success:!0,value:r.scope?r.fn.call(r.scope,e):r.fn(e)}}catch{H=null}for(let r=0;r<te.length;r+=1){const t=te[r];if(!(!t||typeof t.fn!="function"))try{const o=t.scope?t.fn.call(t.scope,e):t.fn(e);return H=t,{success:!0,value:o}}catch{}}return{success:!1,value:null}}function z(e){if(e===null||typeof e>"u")return e;const r=He(e);if(r.success)return r.value;if(X)try{const t=X(e);if(t!==e||e===null||typeof e!="object")return t}catch{}try{return V(e)}catch{}return Array.isArray(e)?e.slice():typeof e=="object"?{...e}:e}function b(e){return e.map(r=>{const t=normalizeAutoGearItem(r);return t?{...t}:null}).filter(Boolean)}function O(e){return!e||typeof e!="object"?{id:"",name:"",category:"",quantity:0,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:"",contextNotes:[]}:{id:typeof e.id=="string"?e.id:"",name:typeof e.name=="string"?e.name:"",category:typeof e.category=="string"?e.category:"",quantity:normalizeAutoGearQuantity(e.quantity),screenSize:typeof e.screenSize=="string"?e.screenSize:"",selectorType:typeof e.selectorType=="string"?e.selectorType:"none",selectorDefault:typeof e.selectorDefault=="string"?e.selectorDefault:"",selectorEnabled:!!e.selectorEnabled,selectorContext:typeof e.selectorContext=="string"?e.selectorContext:"",notes:typeof e.notes=="string"?e.notes:"",contextNotes:Array.isArray(e.contextNotes)?e.contextNotes.filter(Boolean):[]}}function U(e){return!e||typeof e!="object"?null:{id:typeof e.id=="string"?e.id:"",label:typeof e.label=="string"?e.label:"",always:!!e.always,scenarios:Array.isArray(e.scenarios)?e.scenarios.slice():[],mattebox:Array.isArray(e.mattebox)?e.mattebox.slice():[],cameraHandle:Array.isArray(e.cameraHandle)?e.cameraHandle.slice():[],viewfinderExtension:Array.isArray(e.viewfinderExtension)?e.viewfinderExtension.slice():[],videoDistribution:Array.isArray(e.videoDistribution)?e.videoDistribution.slice():[],camera:Array.isArray(e.camera)?e.camera.slice():[],monitor:Array.isArray(e.monitor)?e.monitor.slice():[],tripodHeadBrand:Array.isArray(e.tripodHeadBrand)?e.tripodHeadBrand.slice():[],tripodBowl:Array.isArray(e.tripodBowl)?e.tripodBowl.slice():[],tripodTypes:Array.isArray(e.tripodTypes)?e.tripodTypes.slice():[],tripodSpreader:Array.isArray(e.tripodSpreader)?e.tripodSpreader.slice():[],crewPresent:Array.isArray(e.crewPresent)?e.crewPresent.slice():[],crewAbsent:Array.isArray(e.crewAbsent)?e.crewAbsent.slice():[],wireless:Array.isArray(e.wireless)?e.wireless.slice():[],motors:Array.isArray(e.motors)?e.motors.slice():[],controllers:Array.isArray(e.controllers)?e.controllers.slice():[],distance:Array.isArray(e.distance)?e.distance.slice():[],shootingDays:normalizeAutoGearShootingDaysCondition(e.shootingDays),add:Array.isArray(e.add)?e.add.map(O):[],remove:Array.isArray(e.remove)?e.remove.map(O):[]}}function C(e){return Array.isArray(e)?e.map(U).filter(Boolean):[]}function v(e){if(!Array.isArray(e)){T=null;return}T=C(e)}function ce(e,r,t){const o=(a,l)=>a.map(n=>{let i=normalizeAutoGearQuantity(n.quantity);if(r.forEach(f=>{const s=t.get(f);if(!s)return;const d=s[l].find(m=>m.name===n.name&&m.category===n.category);d&&(i-=normalizeAutoGearQuantity(d.quantity))}),i=Math.max(i,0),i<=0)return null;const c=normalizeAutoGearItem(n);return c?{...c,quantity:i}:null}).filter(Boolean);return{add:o(e.add,"add"),remove:o(e.remove,"remove")}}function B(e){return typeof e!="string"?[]:e.split(",").map(r=>r.trim()).filter(Boolean)}function ue(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=B(e&&e.cameraHandle),o=new Set(t),a=[];if(typeof document<"u"){const i=document.getElementById("cameraHandle");i&&Array.from(i.options||[]).forEach(c=>{const f=typeof c.value=="string"?c.value.trim():"";f&&a.push(f)})}const l=Array.from(new Set(t.concat(a).map(i=>typeof i=="string"?i.trim():"").filter(Boolean)));if(!l.length)return[];const n=[];return l.forEach(i=>{const c=i.trim();if(!c)return;let f,s;if(o.has(c)){f=t.filter(A=>A!==c);const u={...e,cameraHandle:f.join(", ")},p=generateGearListHtml({...u,requiredScenarios:""}),y=parseGearTableForAutoRules(p);if(!y)return;s=diffGearTableMaps(y,r)}else{f=t.slice(),f.push(c);const u={...e,cameraHandle:f.join(", ")},p=generateGearListHtml({...u,requiredScenarios:""}),y=parseGearTableForAutoRules(p);if(!y)return;s=diffGearTableMaps(r,y)}if(!s||!s.add.length&&!s.remove.length)return;const d=Array.isArray(s.add)?b(s.add):[],m=Array.isArray(s.remove)?b(s.remove):[];!d.length&&!m.length||n.push({id:generateAutoGearId("rule"),label:c,scenarios:[],mattebox:[],cameraHandle:[c],viewfinderExtension:[],videoDistribution:[],add:d,remove:m})}),n}function fe(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=B(e&&e.viewfinderExtension);if(!t.length)return[];const o=Array.from(new Set(t)),a=[];return o.forEach(l=>{const n=l.trim();if(!n)return;const i=t.filter(p=>p!==n),c={...e,viewfinderExtension:i.join(", ")},f=generateGearListHtml({...c,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;const d=diffGearTableMaps(s,r);if(!d.add.length&&!d.remove.length)return;const m=b(d.add);if(!m.length)return;const u=b(d.remove);a.push({id:generateAutoGearId("rule"),label:le(n),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[n],videoDistribution:[],add:m,remove:u})}),a}function Oe(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=typeof batterySelect<"u"?batterySelect:document.getElementById("battery");if(!t||!t.options)return[];const o=[];if(Array.from(t.options).forEach(n=>{const i=typeof n.value=="string"?n.value.trim():"";i&&i!=="None"&&o.push(i)}),!o.length)return[];const a=e&&typeof e.battery=="string"?e.battery.trim():"",l=[];return o.forEach(n=>{let i,c;if(n===a){i={...e,battery:""};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(s,r)}else{i={...e,battery:n};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(r,s)}!c||!c.add.length&&!c.remove.length||l.push({id:generateAutoGearId("rule"),label:`Battery: ${n}`,scenarios:[],battery:[n],add:b(c.add),remove:b(c.remove)})}),l}function Fe(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=typeof distanceSelect<"u"?distanceSelect:document.getElementById("distance");if(!t||!t.options)return[];const o=[];if(Array.from(t.options).forEach(n=>{const i=typeof n.value=="string"?n.value.trim():"";i&&i!=="None"&&o.push(i)}),!o.length)return[];const a=e&&typeof e.distance=="string"?e.distance.trim():"",l=[];return o.forEach(n=>{let i,c;if(n===a){i={...e,distance:""};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(s,r)}else{i={...e,distance:n};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(r,s)}!c||!c.add.length&&!c.remove.length||l.push({id:generateAutoGearId("rule"),label:`Distance: ${n}`,scenarios:[],distance:[n],add:b(c.add),remove:b(c.remove)})}),l}function Le(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=typeof hotswapSelect<"u"?hotswapSelect:document.getElementById("hotswap");if(!t||!t.options)return[];const o=[];if(Array.from(t.options).forEach(n=>{const i=typeof n.value=="string"?n.value.trim():"";i&&i!=="None"&&o.push(i)}),!o.length)return[];const a=e&&typeof e.hotswap=="string"?e.hotswap.trim():"",l=[];return o.forEach(n=>{let i,c;if(n===a){i={...e,hotswap:""};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(s,r)}else{i={...e,hotswap:n};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(r,s)}!c||!c.add.length&&!c.remove.length||l.push({id:generateAutoGearId("rule"),label:`Hotswap: ${n}`,scenarios:[],hotswap:[n],add:b(c.add),remove:b(c.remove)})}),l}function Pe(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=typeof batteryPlateSelect<"u"?batteryPlateSelect:document.getElementById("batteryPlate");if(!t||!t.options)return[];const o=[];if(Array.from(t.options).forEach(n=>{const i=typeof n.value=="string"?n.value.trim():"";i&&i!=="None"&&o.push(i)}),!o.length)return[];const a=e&&typeof e.batteryPlate=="string"?e.batteryPlate.trim():"",l=[];return o.forEach(n=>{let i,c;if(n===a){i={...e,batteryPlate:""};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(s,r)}else{i={...e,batteryPlate:n};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(r,s)}!c||!c.add.length&&!c.remove.length||l.push({id:generateAutoGearId("rule"),label:`Battery Plate: ${n}`,scenarios:[],batteryPlate:[n],add:b(c.add),remove:b(c.remove)})}),l}function Ve(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=typeof cageSelect<"u"?cageSelect:document.getElementById("cage");if(!t||!t.options)return[];const o=[];if(Array.from(t.options).forEach(n=>{const i=typeof n.value=="string"?n.value.trim():"";i&&i!=="None"&&o.push(i)}),!o.length)return[];const a=e&&typeof e.cage=="string"?e.cage.trim():"",l=[];return o.forEach(n=>{let i,c;if(n===a){i={...e,cage:""};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(s,r)}else{i={...e,cage:n};const f=generateGearListHtml({...i,requiredScenarios:""}),s=parseGearTableForAutoRules(f);if(!s)return;c=diffGearTableMaps(r,s)}!c||!c.add.length&&!c.remove.length||l.push({id:generateAutoGearId("rule"),label:`Cage: ${n}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],cage:[n],add:b(c.add),remove:b(c.remove)})}),l}function Ne(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=e&&typeof e.tripodHeadBrand=="string"?e.tripodHeadBrand.trim():"",o=e&&typeof e.tripodBowl=="string"?e.tripodBowl.trim():"",a=[];if(t&&o&&t!=="None"&&o!=="None"){const i={...e,tripodHeadBrand:"",tripodBowl:""},c=generateGearListHtml({...i,requiredScenarios:""}),f=parseGearTableForAutoRules(c);if(f){const s=diffGearTableMaps(f,r);(s.add.length||s.remove.length)&&a.push({id:generateAutoGearId("rule"),label:`Tripod Head: ${t} (${o})`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],tripodHeadBrand:[t],tripodBowl:[o],add:b(s.add),remove:b(s.remove)})}}const l=e&&typeof e.tripodSpreader=="string"?e.tripodSpreader.trim():"";if(l&&l!=="None"){const i={...e,tripodSpreader:""},c=generateGearListHtml({...i,requiredScenarios:""}),f=parseGearTableForAutoRules(c);if(f){const s=diffGearTableMaps(f,r);(s.add.length||s.remove.length)&&a.push({id:generateAutoGearId("rule"),label:`Tripod Spreader: ${l}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],tripodSpreader:[l],add:b(s.add),remove:b(s.remove)})}}const n=B(e&&e.tripodTypes);return n.forEach(i=>{const c=n.filter(m=>m!==i),f={...e,tripodTypes:c.join(", ")},s=generateGearListHtml({...f,requiredScenarios:""}),d=parseGearTableForAutoRules(s);if(d){const m=diffGearTableMaps(d,r);(m.add.length||m.remove.length)&&a.push({id:generateAutoGearId("rule"),label:`Tripod Type: ${i}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],tripodTypes:[i],add:b(m.add),remove:b(m.remove)})}}),a}function I(e={}){const r=typeof e.tripodHeadBrand=="string"?e.tripodHeadBrand.trim():"",t=typeof e.tripodBowl=="string"?e.tripodBowl.trim():"";if(!r||!t)return[];const o=normalizeAutoGearTriggerValue(r),a=normalizeAutoGearTriggerValue(t);if(!o||!a)return[];const n=[{brand:"O'Connor",entries:[{bowl:"100mm bowl",item:"O'Connor Ultimate 1040 Fluid-Head 100mm bowl"},{bowl:"150mm bowl",item:"O'Connor Ultimate 2560 Fluid-Head 150mm bowl"},{bowl:"Mitchell Mount",item:"O'Connor Ultimate 2560 Fluid-Head Mitchell Mount"}]},{brand:"Sachtler",entries:[{bowl:"75mm bowl",item:"Sachtler aktiv8 head 75mm bowl"},{bowl:"100mm bowl",item:"Sachtler aktiv18T head 100mm bowl"},{bowl:"150mm bowl",item:"Sachtler Cine 30 head 150mm bowl"},{bowl:"Mitchell Mount",item:"Sachtler Cine 30 head Mitchell mount"}]}].find(c=>normalizeAutoGearTriggerValue(c.brand)===o);if(!n)return[];const i=n.entries.filter(c=>normalizeAutoGearTriggerValue(c.bowl)===a);return i.length?i.map(c=>{const f=c.item,s=["Tripod preferences"];return{id:generateAutoGearId("rule"),label:`Tripod head: ${f}`,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:[],tripodHeadBrand:[n.brand],tripodBowl:[c.bowl],tripodTypes:[],tripodSpreader:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],add:[{id:generateAutoGearId("item"),name:f,category:"Grip",quantity:1,screenSize:"",selectorType:"tripodHeadBrand",selectorDefault:f,selectorEnabled:!0,notes:"",contextNotes:s}],remove:[]}}):[]}function q(e,r){if(!r||typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const t=B(e&&e.videoDistribution);if(!t.length)return[];const o=Array.from(new Set(t)),a=[];return o.forEach(l=>{const n=l.trim();if(!n)return;const i=n.toLowerCase();if(i==="__none__"||i==="none")return;const c=t.filter(y=>y!==n),f={...e,videoDistribution:c.join(", ")},s=generateGearListHtml({...f,requiredScenarios:""}),d=parseGearTableForAutoRules(s);if(!d)return;const m=diffGearTableMaps(d,r);if(!m.add.length&&!m.remove.length)return;const u=b(m.add);if(!u.length)return;const p=b(m.remove);a.push({id:generateAutoGearId("rule"),label:P(n),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[n],add:u,remove:p})}),a}function de(){const e=typeof monitorSelect<"u"?monitorSelect:null;if(!e||!e.options)return[];const r=[],t=new Set;if(Array.from(e.options).forEach(l=>{if(!l)return;const n=typeof l.value=="string"?l.value.trim():"";if(!n||n==="None")return;const i=typeof l.textContent=="string"?l.textContent.trim():"";if(!i)return;const c=normalizeAutoGearTriggerValue(i);!c||t.has(c)||(t.add(c),r.push(i))}),!r.length)return[];const o=typeof texts=="object"&&texts&&(texts[currentLang]&&texts[currentLang].autoGearMonitorLabel||texts.en&&texts.en.autoGearMonitorLabel)||"Onboard monitors",a=o;return[{id:generateAutoGearId("rule"),label:o,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:r.slice(),crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],add:[{id:generateAutoGearId("item"),name:'ULCS Arm mit 3/8" und 1/4" double',category:"Rigging",quantity:1,contextNotes:[a]}],remove:[]}]}const je="ARRI K2.74000.0 VEB-3 Viewfinder Extension Bracket",ke="Camera Support";function ze(e){if(typeof generateAutoGearId!="function")return null;const r=Array.isArray(e)?e.filter(t=>typeof t=="string"&&t.trim()):[];return{id:generateAutoGearId("item"),name:je,category:ke,quantity:1,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:"",contextNotes:r.map(t=>t.trim())}}function Ue(){const e=[],r=devices&&typeof devices=="object"?devices.cameras:null;return!r||typeof r!="object"||Object.keys(r).forEach(t=>{if(!t)return;const o=r[t],a=o&&typeof o.brand=="string"?o.brand:"";/arri/i.test(a||t)&&e.push(t)}),e}function re(e){if(!e||typeof e!="object")return null;const r=ze(e.contextNotes||[]);if(!r)return null;const t=Array.isArray(e.camera)?e.camera.filter(Boolean):[];return{id:generateAutoGearId("rule"),label:typeof e.label=="string"&&e.label.trim()?e.label.trim():"ARRI viewfinder extension support",scenarios:Array.isArray(e.scenarios)?e.scenarios.filter(Boolean):[],mattebox:[],cameraHandle:[],viewfinderExtension:Array.isArray(e.viewfinderExtension)?e.viewfinderExtension.filter(Boolean):[],deliveryResolution:[],videoDistribution:[],camera:t,monitor:[],tripodHeadBrand:[],tripodBowl:[],tripodTypes:[],tripodSpreader:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],shootingDays:null,add:[r],remove:[]}}function $(e={}){const r=Ue();if(!r.length)return[];const t=e&&typeof e.viewfinderExtension=="string"?e.viewfinderExtension.trim():"",l=(e&&typeof e.requiredScenarios=="string"?e.requiredScenarios.split(",").map(i=>typeof i=="string"?i.trim():"").filter(Boolean):[]).map(i=>normalizeAutoGearTriggerValue(i)).filter(Boolean).includes(normalizeAutoGearTriggerValue("Slider")),n=[];if(t){const i=le(t),c=re({label:`${i||t} – ARRI viewfinder support`,viewfinderExtension:[t],camera:r.slice(),contextNotes:["ARRI viewfinder extension support"]});c&&n.push(c)}if(l&&!t){const i=re({label:"Slider – ARRI viewfinder extension support",scenarios:["Slider"],camera:r.slice(),contextNotes:["Slider scenario"]});i&&n.push(i)}return n}function W(e={}){if(typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const r=document.getElementById("videoDistribution");if(!r)return[];const t=[],o=new Set;if(Array.from(r.options||[]).forEach(s=>{if(!s)return;const d=typeof s.value=="string"?s.value.trim():"",m=Z(d);!m||m==="__none__"||o.has(m)||(o.add(m),t.push(d))}),!t.length)return[];const a={...e||{}};delete a.videoDistribution;const l=generateGearListHtml({...a,requiredScenarios:""}),n=parseGearTableForAutoRules(l);if(!n)return[];const i=[],c=new Set;if(t.forEach(s=>{const d=typeof s=="string"?s.trim():"";if(!d)return;const m=Z(d);if(!m||c.has(m))return;c.add(m);const u={...e||{},videoDistribution:d},p=generateGearListHtml({...u,requiredScenarios:""}),y=parseGearTableForAutoRules(p);if(!y)return;const A=diffGearTableMaps(n,y),h=b(A.add),G=b(A.remove);!h.length&&!G.length||i.push({id:generateAutoGearId("rule"),label:P(d),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[d],add:h,remove:G})}),t.some(s=>s&&s.toLowerCase()==="ios video")){const s=t.find(u=>u&&u.toLowerCase()==="ios video")||"IOS Video",d=normalizeAutoGearTriggerValue(s);if(!i.some(u=>Array.isArray(u.videoDistribution)&&u.videoDistribution.some(p=>normalizeAutoGearTriggerValue(p)===d))){const u=new Set,p=(G,S,M=1)=>{if(!G||!S||M<=0)return null;const D=`${G}|${S}`;return u.has(D)?null:(u.add(D),{id:generateAutoGearId("item"),name:G,category:S,quantity:M,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:""})},y=[],A=devices&&typeof devices=="object"?devices.iosVideo:null;if(A&&typeof A=="object"&&Object.keys(A).forEach(G=>{const S=p(G,"Monitoring");S&&y.push(S)}),!y.length){const G=p("Teradek - Link AX WifiRouter/Access Point","Monitoring");G&&y.push(G)}const h=(G,S,M=1)=>{const D=p(G,S,M);D&&y.push(D)};h("Apple iPad Air 5 or better","Monitoring",1),h("USB-C Charger (iOS Video)","Monitoring support",2),h("Wi-Fi Router (iOS Video Village)","Monitoring support"),y.length&&i.push({id:generateAutoGearId("rule"),label:P(s),scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[s],add:y,remove:[]})}}return i}function K(){return[]}function Ie(e={}){if(typeof generateGearListHtml!="function"||typeof parseGearTableForAutoRules!="function")return[];const r=document.getElementById("mattebox");if(!r)return[];const t=[],o=new Set;if(Array.from(r.options||[]).forEach(f=>{if(!f)return;const s=typeof f.value=="string"?f.value.trim():"",d=J(s);!d||d==="__none__"||o.has(d)||(o.add(d),t.push(s))}),!t.length)return[];const a={...e||{}};delete a.mattebox;const l=generateGearListHtml({...a,requiredScenarios:""}),n=parseGearTableForAutoRules(l);if(!n)return[];const i=[],c=new Set;return t.forEach(f=>{const s=typeof f=="string"?f.trim():"";if(!s)return;const d=J(s);if(!d||c.has(d))return;c.add(d);const m={...e||{},mattebox:s},u=generateGearListHtml({...m,requiredScenarios:""}),p=parseGearTableForAutoRules(u);if(!p)return;const y=diffGearTableMaps(n,p),A=b(y.add),h=b(y.remove);!A.length&&!h.length||i.push({id:generateAutoGearId("rule"),label:we(s),scenarios:[],mattebox:[s],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],add:A,remove:h})}),i}function pe(){let e=null,r=null;try{typeof AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS<"u"&&AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS&&typeof AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS=="object"&&(e=AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS)}catch{}!e&&g&&typeof g.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS=="object"&&(e=g.AUTO_GEAR_HAND_UNIT_COMPATIBILITY_GROUPS);try{typeof AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP<"u"&&AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP&&typeof AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP=="object"&&(r=AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP)}catch{}return!r&&g&&typeof g.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP=="object"&&(r=g.AUTO_GEAR_HAND_UNIT_MOTOR_TO_GROUP),{groups:e&&typeof e=="object"?e:null,motorMap:r&&typeof r=="object"?r:null}}function qe(e){if(!e)return null;const r=pe();if(!r.groups)return null;const t=normalizeAutoGearTriggerValue(e);if(!t)return null;let o=null;if(r.motorMap&&Object.prototype.hasOwnProperty.call(r.motorMap,t)?o=r.motorMap[t]:Object.prototype.hasOwnProperty.call(r.groups,t)&&(o=t),!o||!r.groups[o])return null;const a=r.groups[o];return!a||!Array.isArray(a.options)||!a.options.length?null:{key:o,group:a}}function $e(){const e=[];if(!devices||typeof devices!="object")return e;const r=devices.video&&typeof devices.video=="object"?devices.video:null;return r&&Object.keys(r).forEach(t=>{!t||t==="None"||e.includes(t)||e.push(t)}),e}function We(e){if(!pe().groups)return[];const t=typeof x=="function"?x():null,o=[];t&&Array.isArray(t.motors)&&o.push(...t.motors),e&&Array.isArray(e.motorSelections)&&o.push(...e.motorSelections),e&&Array.isArray(e.motors)&&o.push(...e.motors);const a=o.map(f=>typeof f=="string"?f.trim():"").filter(f=>f&&f!=="None").map(f=>({name:f,normalized:normalizeAutoGearTriggerValue(f)})).filter(f=>f.normalized);if(!a.length)return[];let l="";if(t&&typeof t.video=="string"&&(l=t.video.trim()),!l&&e&&typeof e.wirelessSelection=="string"&&(l=e.wirelessSelection.trim()),!l||l==="None")return[];const n=[],i=new Set;if(a.forEach(f=>{const s=qe(f.normalized);if(!s||i.has(s.key))return;i.add(s.key);const d=s.group,m=Array.isArray(d.options)?d.options.filter(Boolean):[];if(!m.length)return;const u=typeof d.defaultOption=="string"&&d.defaultOption?d.defaultOption:m[0],p=[];d.label&&p.push(d.label),Array.isArray(d.motors)&&d.motors.length&&p.push(`Compatible motors: ${d.motors.join(", ")}`),n.push({id:generateAutoGearId("item"),name:u,category:"LDS (FIZ)",quantity:1,screenSize:"",selectorType:"fizHandUnit",selectorDefault:u,selectorEnabled:!0,selectorContext:s.key,notes:"",contextNotes:p})}),!n.length)return[];const c=$e();return c.length||c.push(l),[{id:generateAutoGearId("rule"),label:"FIZ hand units",scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:[],wireless:c,motors:[AUTO_GEAR_ANY_MOTOR_TOKEN],controllers:[],distance:[],add:n,remove:[]}]}function ye(){if(typeof x!="function")return null;const e=x();if(!(Array.isArray(e?.motors)?e.motors.filter(l=>typeof l=="string"&&l&&l!=="None"):[]).length)return null;const t=(l,n,i=1)=>!l||!n||i<=0?null:{id:generateAutoGearId("item"),name:l,category:n,quantity:i,screenSize:"",selectorType:"none",selectorDefault:"",selectorEnabled:!1,notes:""},o=[],a=(l,n,i=1)=>{const c=t(l,n,i);c&&o.push(c)};return a('Avenger C-Stand Sliding Leg 20" (Focus)',"Grip"),a("Steelfingers Wheel C-Stand 3er Set (Focus)","Grip"),a("Lite-Tite Swivel Aluminium Umbrella Adapter (Focus)","Grip"),a("Tennis ball","Grip",3),a("D-Tap to Mini XLR 3-pin Cable 0,3m (Focus)","Monitoring support",2),a("Ultraslim BNC Cable 0.3 m (Focus)","Monitoring support",2),a("Bebob V150micro (V-Mount) (Focus)","Monitoring Batteries",3),o.length?{id:generateAutoGearId("rule"),label:"FIZ motor support kit",scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],deliveryResolution:[],videoDistribution:[],camera:[],monitor:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[AUTO_GEAR_ANY_MOTOR_TOKEN],controllers:[],distance:[],add:o,remove:[]}:null}function me(){const e=(o,a,l=1,n={})=>!o||!a||l<=0?null:{id:generateAutoGearId("item"),name:o,category:a,quantity:l,screenSize:typeof n.screenSize=="string"?n.screenSize:"",selectorType:typeof n.selectorType=="string"?n.selectorType:"none",selectorDefault:typeof n.selectorDefault=="string"?n.selectorDefault:"",selectorEnabled:n.selectorEnabled===!0,notes:typeof n.notes=="string"?n.notes:""},r=[],t=(o,a,l,n)=>{const i=e(o,a,l,n);i&&r.push(i)};return[["BNC Cable 0.5 m","Monitoring support",1],["BNC Cable 1 m","Monitoring support",1],["BNC Cable 5 m","Monitoring support",1],["BNC Cable 10 m","Monitoring support",1],["BNC Drum 25 m","Monitoring support",1],["BNC Connector","Monitoring support",4],['ULCS Bracket with 1/4" to 1/4"',"Rigging",2],['ULCS Bracket with 3/8" to 1/4"',"Rigging",2],["Noga Arm","Rigging",2],["Mini Magic Arm","Rigging",2],["Cine Quick Release","Rigging",4],["SmallRig - Super lightweight 15mm RailBlock","Rigging",1],['Spigot with male 3/8" and 1/4"',"Rigging",3],["Clapper Stick","Rigging",2],["D-Tap Splitter","Rigging",2],["Magliner Senior - with quick release mount + tripod holder + utility tray + O‘Connor-Aufhängung","Carts and Transportation",1],["Securing Straps (25mm wide)","Carts and Transportation",10],["Loading Ramp (pair, 420kg)","Carts and Transportation",1],["Ring Fitting for Airline Rails","Carts and Transportation",20],["Power Cable Drum 25-50 m","Power",1],["Power Cable 10 m","Power",2],["Power Cable 5 m","Power",2],["Power Strip","Power",3],["Power Three Way Splitter","Power",3],["PRCD-S (Portable Residual Current Device-Safety)","Power",3]].forEach(([o,a,l])=>t(o,a,l)),r.length?{id:generateAutoGearId("rule"),label:"Always",always:!0,scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],videoDistribution:[],camera:[],monitor:[],wireless:[],motors:[],controllers:[],distance:[],add:r,remove:[]}:null}function ge(){const e=(o,a,l=1,n={})=>!o||!a||l<=0?null:{id:generateAutoGearId("item"),name:o,category:a,quantity:l,screenSize:typeof n.screenSize=="string"?n.screenSize:"",selectorType:typeof n.selectorType=="string"?n.selectorType:"none",selectorDefault:typeof n.selectorDefault=="string"?n.selectorDefault:"",selectorEnabled:n.selectorEnabled===!0,notes:typeof n.notes=="string"?n.notes:""},r=[],t=(o,a,l,n)=>{const i=e(o,a,l,n);i&&r.push(i)};return t("Bluestar eye leather made of microfiber oval, large","Consumables",4),t("Pro Gaff Tape","Consumables",2,{notes:"Primary color roll"}),t("Pro Gaff Tape","Consumables",2,{notes:"Secondary color roll"}),t("Clapper Stick","Rigging",4),t("Kimtech Wipes","Consumables",2),t('Sprigs Red 1/4"',"Consumables",1),r.length?{id:generateAutoGearId("rule"),label:"Every 5 shooting days",scenarios:[],mattebox:[],cameraHandle:[],viewfinderExtension:[],deliveryResolution:[],videoDistribution:[],camera:[],monitor:[],crewPresent:[],crewAbsent:[],wireless:[],motors:[],controllers:[],distance:[],shootingDays:{mode:"every",value:5},add:r,remove:[]}:null}function E(){const e=K();if(!e.length)return!1;const r=new Set(autoGearRules.map(autoGearRuleMatteboxKey).filter(Boolean)),t=e.filter(o=>{const a=autoGearRuleMatteboxKey(o);return!a||r.has(a)?!1:(r.add(a),!0)});return t.length?(setAutoGearRules(autoGearRules.concat(t)),!0):!1}function x(){const e=t=>t.map(o=>o&&typeof o.value=="string"?o.value:""),r={camera:cameraSelect&&typeof cameraSelect.value=="string"?cameraSelect.value:"",monitor:monitorSelect&&typeof monitorSelect.value=="string"?monitorSelect.value:"",video:videoSelect&&typeof videoSelect.value=="string"?videoSelect.value:"",cage:cageSelect&&typeof cageSelect.value=="string"?cageSelect.value:"",distance:distanceSelect&&typeof distanceSelect.value=="string"?distanceSelect.value:"",battery:batterySelect&&typeof batterySelect.value=="string"?batterySelect.value:"",batteryPlate:batteryPlateSelect&&typeof batteryPlateSelect.value=="string"?batteryPlateSelect.value:"",hotswap:hotswapSelect&&typeof hotswapSelect.value=="string"?hotswapSelect.value:"",motors:e(motorSelects),controllers:e(controllerSelects),sliderBowl:typeof getSliderBowlValue=="function"?getSliderBowlValue():"",easyrig:typeof getEasyrigValue=="function"?getEasyrigValue():""};return Ke(r)}function Ke(e){return!e||typeof e!="object"||(e.batteryPlate=normalizeBatteryPlateValue(e.batteryPlate,e.battery)),e}function oe(e){!e||typeof e!="object"||(cameraSelect&&(setSelectValue(cameraSelect,e.camera),typeof updateBatteryPlateVisibility=="function"&&updateBatteryPlateVisibility(),typeof updateBatteryOptions=="function"&&updateBatteryOptions()),batteryPlateSelect&&setSelectValue(batteryPlateSelect,e.batteryPlate),e&&typeof e.battery=="string"&&applyBatteryPlateSelectionFromBattery(e.battery,batteryPlateSelect?batteryPlateSelect.value:""),monitorSelect&&setSelectValue(monitorSelect,e.monitor),videoSelect&&setSelectValue(videoSelect,e.video),cageSelect&&setSelectValue(cageSelect,e.cage),distanceSelect&&setSelectValue(distanceSelect,e.distance),Array.isArray(e.motors)&&e.motors.forEach((r,t)=>{motorSelects[t]&&setSelectValue(motorSelects[t],r)}),Array.isArray(e.controllers)&&e.controllers.forEach((r,t)=>{controllerSelects[t]&&setSelectValue(controllerSelects[t],r)}),batterySelect&&setSelectValue(batterySelect,e.battery),hotswapSelect&&setSelectValue(hotswapSelect,e.hotswap),typeof setSliderBowlValue=="function"&&setSliderBowlValue(e.sliderBowl),typeof setEasyrigValue=="function"&&setEasyrigValue(e.easyrig))}function F(){if(w||typeof collectProjectFormData!="function")return;const e=collectProjectFormData()||{};let r=z(e);(!r||typeof r!="object")&&(r={...e});const t=requiredScenariosSelect?Array.from(requiredScenariosSelect.options||[]).map(o=>o&&typeof o.value=="string"?o.value:"").filter(o=>o):[];w={projectFormData:r,scenarioValues:t,setupValues:x()}}function L(e,r){const t=[],o=typeof generateGearListHtml=="function"&&typeof parseGearTableForAutoRules=="function",a=Array.isArray(r)?r.filter(f=>typeof f=="string"&&f):[];let l=null;if(o){const f=generateGearListHtml({...e,requiredScenarios:""});if(l=parseGearTableForAutoRules(f),l&&a.length){const s=new Map;a.forEach(p=>{const y=generateGearListHtml({...e,requiredScenarios:p}),A=parseGearTableForAutoRules(y);if(!A)return;const h=diffGearTableMaps(l,A);let G=b(h.add),S=b(h.remove);!G.length&&!S.length||(s.set(p,{add:G,remove:S}),t.push({id:generateAutoGearId("rule"),label:p,scenarios:[p],add:G,remove:S}))}),[["Handheld","Easyrig"],["Slider","Undersling mode"]].filter(p=>p.every(y=>a.includes(y))).forEach(p=>{const y=p.join(" + "),A=generateGearListHtml({...e,requiredScenarios:p.join(", ")}),h=parseGearTableForAutoRules(A);if(!h)return;const G=diffGearTableMaps(l,h),S=ce({add:b(G.add),remove:b(G.remove)},p,s);!S.add.length&&!S.remove.length||t.push({id:generateAutoGearId("rule"),label:y,scenarios:p.slice(),add:S.add,remove:S.remove})});const m=["Extreme rain","Rain Machine"];if(m.every(p=>s.has(p))){const p=[{name:"Schulz Sprayoff Micro",quantity:1,category:"Matte box + filter"},{name:"Fischer RS to D-Tap cable 0,5m",quantity:2,category:"Rigging"},{name:"Spare Disc (Schulz Sprayoff Micro)",quantity:1,category:"Matte box + filter"}].map(y=>({id:generateAutoGearId("item"),name:y.name,category:y.category,quantity:y.quantity}));t.push({id:generateAutoGearId("rule"),label:"Extreme rain + Rain Machine overlap",scenarios:m.slice(),add:[],remove:p})}}}if(l){ue(e,l).forEach(d=>t.push(d)),fe(e,l).forEach(d=>t.push(d)),q(e,l).forEach(d=>t.push(d)),Ie(e).forEach(d=>t.push(d)),Ve(e,l).forEach(d=>t.push(d)),Ne(e,l).forEach(d=>t.push(d)),Oe(e,l).forEach(d=>t.push(d)),Fe(e,l).forEach(d=>t.push(d)),Le(e,l).forEach(d=>t.push(d)),Pe(e,l).forEach(d=>t.push(d));const f=new Set(t.map(autoGearRuleSignature).filter(d=>typeof d=="string"&&d)),s=d=>{!Array.isArray(d)||!d.length||d.forEach(m=>{const u=autoGearRuleSignature(m);!u||f.has(u)||(t.push(m),f.add(u))})};s(W(e)),s(de()),s(I(e)),s($(e)),s(We(e))}const n=ye();if(n){const f=autoGearRuleSignature(n);t.some(d=>autoGearRuleSignature(d)===f)||t.push(n)}const i=me();i&&t.push(i);const c=ge();return c&&t.push(c),K().forEach(f=>t.push(f)),t}function Q(){F();const e=w;if(!e)return null;const r=x(),t=hasSeededAutoGearDefaults(),o=autoGearRules.slice(),a=baseAutoGearRulesState.slice(),l=projectScopedAutoGearRules?projectScopedAutoGearRules.slice():null,n=autoGearRulesLastBackupSignature,i=autoGearRulesLastPersistedSignature,c=autoGearRulesDirtySinceBackup;try{t&&clearAutoGearDefaultsSeeded(),assignAutoGearRules([]),baseAutoGearRulesState=[],projectScopedAutoGearRules=null,autoGearRulesLastBackupSignature=n,autoGearRulesLastPersistedSignature=i,autoGearRulesDirtySinceBackup=c,oe(e.setupValues);const f=e.projectFormData||{};let s=z(f);(!s||typeof s!="object")&&(s={...f});const d=L(s,e.scenarioValues||[]);return d.length&&v(d),d}finally{oe(r),assignAutoGearRules(o),baseAutoGearRulesState=a.slice(),projectScopedAutoGearRules=l?l.slice():null,autoGearRulesLastBackupSignature=n,autoGearRulesLastPersistedSignature=i,autoGearRulesDirtySinceBackup=c,t&&markAutoGearDefaultsSeeded()}}function be(){F();const e=hasSeededAutoGearDefaults();if(autoGearRules.length){E()&&!e?(markAutoGearDefaultsSeeded(),v(getAutoGearRules())):T||v(getAutoGearRules());return}if(e){E()&&!T&&v(getAutoGearRules());return}const r=w&&w.projectFormData?{...w.projectFormData}:collectProjectFormData?collectProjectFormData():{},t=w&&Array.isArray(w.scenarioValues)?w.scenarioValues:requiredScenariosSelect?Array.from(requiredScenariosSelect.options||[]).map(a=>a&&a.value).filter(Boolean):[],o=L(r,t);if(!o.length){E()&&(markAutoGearDefaultsSeeded(),v(getAutoGearRules()));return}setAutoGearRules(o),markAutoGearDefaultsSeeded(),v(o)}function Ae(){const e=texts[currentLang]||texts.en||{},r=texts.en||{},t=e.autoGearResetFactoryConfirm||texts.en?.autoGearResetFactoryConfirm||"Replace your automatic gear rules with the default additions?",o=()=>{const a=e.autoGearResetFactoryExportFailed||r.autoGearResetFactoryExportFailed||"Automatic gear preset export failed. Reset cancelled.";let l={status:"skipped",reason:"empty"};if(typeof exportAutoGearPresets=="function")try{l=exportAutoGearPresets({reason:"reset-auto-gear"})||{status:"failed",reason:"unknown"}}catch(s){console.error("Failed to export automatic gear presets before reset",s),l={status:"failed",reason:"exception",error:s}}else l={status:"failed",reason:"unavailable"};if(!l||l.status==="failed"||l.status==="skipped"&&l.reason!=="empty"){typeof showNotification=="function"&&showNotification("error",a);return}const n=ensureAutoBackupBeforeDeletion("reset automatic gear rules");if(!n)return;const i=e.autoGearResetFactoryDone||r.autoGearResetFactoryDone||"Automatic gear rules restored to factory additions.",c=e.autoGearResetFactoryEmpty||r.autoGearResetFactoryEmpty||"Factory additions unavailable. Automatic gear rules cleared.",f=e.autoGearResetFactoryError||r.autoGearResetFactoryError||"Reset failed. Please try again.";try{const s=Q();if(Array.isArray(s)&&s.length){setAutoGearRules(s),markAutoGearDefaultsSeeded(),v(getAutoGearRules()),typeof showNotification=="function"&&showNotification("success",i);return}if(setAutoGearRules([]),v(null),clearAutoGearDefaultsSeeded(),E()){markAutoGearDefaultsSeeded(),v(getAutoGearRules()),typeof showNotification=="function"&&showNotification("success",i);return}typeof showNotification=="function"&&showNotification("info",c)}catch(s){if(console.error("Failed to reset automatic gear rules to factory additions",s),typeof showNotification=="function"&&showNotification("error",f),n&&typeof notifyAutoSaveFromBackup=="function")try{notifyAutoSaveFromBackup(f,n,"error")}catch(d){console.warn("Failed to announce automatic backup after reset failure",d)}}};if(typeof window.cineShowConfirmDialog=="function"){window.cineShowConfirmDialog({title:e.autoGearResetFactoryTitle||"Reset to Factory",message:t,confirmLabel:e.autoGearResetFactoryConfirmLabel||"Reset",cancelLabel:e.cancel||"Cancel",danger:!0,onConfirm:o});return}console.warn("Missing window.cineShowConfirmDialog for resetAutoGearRulesToFactoryAdditions")}const he=Me({getFactoryAutoGearRulesSnapshot:function(){return T?C(T):null},getFactoryAutoGearSeedContext:function(){if(!w)return null;const r=z(w);return r&&typeof r=="object"?r:{...w}},setFactoryAutoGearRulesSnapshot:v,cloneAutoGearItems:b,cloneAutoGearRuleItem:O,cloneAutoGearRule:U,cloneAutoGearRules:C,subtractScenarioContributions:ce,extractAutoGearSelections:B,buildCameraHandleAutoRules:ue,buildViewfinderExtensionAutoRules:fe,buildVideoDistributionAutoRules:q,buildOnboardMonitorRiggingAutoGearRules:de,buildTripodPreferenceAutoGearRules:I,buildDefaultVideoDistributionAutoGearRules:W,buildDefaultMatteboxAutoGearRules:K,buildAutoGearAnyMotorRule:ye,buildAlwaysAutoGearRule:me,buildFiveDayConsumablesAutoGearRule:ge,buildArriViewfinderBracketRules:$,ensureDefaultMatteboxAutoGearRules:E,captureAutoGearSeedContext:F,buildAutoGearRulesFromBaseInfo:L,computeFactoryAutoGearRules:Q,seedAutoGearRulesFromCurrentProject:be,resetAutoGearRulesToFactoryAdditions:Ae});_e("cineFeatureAutoGearRules",he,{category:"feature",description:"Automatic gear rule cloning, factory defaults and seeding helpers.",replace:!0,connections:["cineModuleBase","cineModuleContext","cinePersistence"]},e=>{typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to register cineFeatureAutoGearRules module.",e)});const Qe=[["cineFeatureAutoGearRules",he],["buildDefaultVideoDistributionAutoGearRules",W],["buildVideoDistributionAutoRules",q],["buildTripodPreferenceAutoGearRules",I],["cloneAutoGearItems",b],["cloneAutoGearRuleItem",O],["cloneAutoGearRule",U],["cloneAutoGearRules",C],["setFactoryAutoGearRulesSnapshot",v],["ensureDefaultMatteboxAutoGearRules",E],["captureAutoGearSeedContext",F],["buildAutoGearRulesFromBaseInfo",L],["buildArriViewfinderBracketRules",$],["computeFactoryAutoGearRules",Q],["seedAutoGearRulesFromCurrentProject",be],["resetAutoGearRulesToFactoryAdditions",Ae],["factoryAutoGearRulesSnapshot",null],["factoryAutoGearSeedContext",null]];Qe.forEach(([e,r])=>{if(e==="factoryAutoGearRulesSnapshot"){Object.defineProperty(g,e,{configurable:!0,get(){return T},set(t){T=Array.isArray(t)?C(t):null}});return}if(e==="factoryAutoGearSeedContext"){Object.defineProperty(g,e,{configurable:!0,get(){return w},set(t){w=t&&typeof t=="object"?t:null}});return}De(e,r,{configurable:!0,writable:!0})});console.log("✅ Auto Gear Rules loaded (ESM)");export{he as default};
//# sourceMappingURL=auto-gear-rules-DS0lYD-U.js.map
