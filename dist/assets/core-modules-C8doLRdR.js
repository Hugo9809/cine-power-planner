import{g as gp,L as Es,s as mp,d as hp,c as bp,k as Sp}from"./vendor-DzOFLsIx.js";const He=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},ra=(function(){const t=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:null);if(typeof t!="object"||!t)return new Set;const r=Object.values(t).filter(n=>typeof n=="string"&&n);return new Set(r)})();function Hn(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return"";if(typeof String.fromCodePoint=="function")try{return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):""}function ei(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=Hn(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=Hn(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=Hn(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=Hn(i[1],10);if(s)return s}return t}function F(e,t){const n=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons",o=t||n,i=ra.has(o)?o:n,a={char:ei(e),font:i};return typeof Object.freeze=="function"?Object.freeze(a):a}function Gi(e){const r=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons";if(!e)return{char:"",font:r,className:"",size:void 0};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:ei(e),font:r,className:"",size:void 0};if(typeof e=="object"){const n=typeof e.char=="string"?ei(e.char):"",o=e.font&&ra.has(e.font)?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:"",size:void 0}}function sl(e){return typeof e!="string"?"":e.indexOf('aria-hidden="true"')!==-1?e:e.replace("<svg",'<svg aria-hidden="true"')}function al(e,t){if(!e)return;const r=Gi(t);if(r.markup){e.innerHTML=sl(r.markup),e.setAttribute("aria-hidden","true"),r.className&&r.className.split(/\s+/).filter(Boolean).forEach(o=>e.classList.add(o)),e.removeAttribute("data-icon-font");return}const n=r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font):e.removeAttribute("data-icon-font")}function cl(e,t){const r=Gi(e),n=[];r.className&&n.push(r.className),t&&n.push(t);const o=n.join(" ");if(r.markup){let s=sl(r.markup);return o&&(s.indexOf('class="')!==-1?s=s.replace('class="',`class="${o} `):s=s.replace("<svg",`<svg class="${o}"`)),s}const i=r.char?`data-icon-font="${r.font}"`:"";return`<span class="icon-glyph ${o}" aria-hidden="true" ${i}>${r.char}</span>`}function dr(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function ll(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=dr(t),a=dr(r),c=dr(n),u=dr(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(l,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[];return/(?:^|\s)width\s*=/i.test(p)||d.push(`width="${c}"`),/(?:^|\s)height\s*=/i.test(p)||d.push(`height="${u}"`),d.push(`x="-${dr(i)}"`),d.push(`y="-${dr(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}const na=`
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M12 17.25 6.545 20.2 7.9 13.975 3 9.45l6.272-.7L12 3l2.728 5.75L21 9.45l-4.9 4.525 1.355 6.225Z"
    fill="currentColor"
    stroke="currentColor"
    stroke-width="0"
  />
</svg>
`.trim(),G=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons",ESSENTIAL:"essential",GADGET:"gadget",FILM:"film",TEXT:"text"}),ul=Object.freeze({batteryBolt:F("",G.UICONS),batteryFull:F("",G.UICONS),bolt:F("",G.ESSENTIAL),plug:F("",G.UICONS),sliders:F("",G.ESSENTIAL),screen:F("",G.GADGET),brightness:F("",G.UICONS),wifi:F("",G.UICONS),gears:F("",G.UICONS),controller:F("",G.GADGET),distance:F("",G.UICONS),sensor:F("",G.UICONS),viewfinder:F("",G.FILM),camera:F("",G.UICONS),trash:F("",G.ESSENTIAL),reload:F("",G.ESSENTIAL),load:F("",G.UICONS),installApp:F("",G.UICONS),add:Object.freeze({char:"+",font:G.TEXT,className:"icon-text"}),minus:Object.freeze({char:"−",font:G.TEXT,className:"icon-text"}),arrowLeft:Object.freeze({char:"←",font:G.TEXT,className:"icon-text"}),check:F("",G.UICONS),fileExport:F("",G.UICONS),fileImport:F("",G.UICONS),save:F("",G.ESSENTIAL),share:F("",G.ESSENTIAL),paperPlane:F("",G.UICONS),magnet:F("",G.ESSENTIAL),codec:F("",G.UICONS),timecode:F("",G.FILM),audioIn:F("",G.ESSENTIAL),audioOut:F("",G.ESSENTIAL),note:F("",G.ESSENTIAL),overview:F("",G.UICONS),gearList:F("",G.UICONS),contacts:F("",G.UICONS),feedback:F("",G.UICONS),resetView:F("",G.UICONS),pin:F("",G.ESSENTIAL),sun:F("",G.UICONS),moon:F("",G.UICONS),circleX:F("",G.ESSENTIAL),settingsGeneral:F("",G.UICONS),settingsAutoGear:F("",G.UICONS),settingsAccessibility:F("",G.UICONS),settingsBackup:F("",G.UICONS),settingsData:F("",G.UICONS),settingsAbout:F("",G.UICONS),star:Object.freeze({markup:na,className:"icon-svg favorite-star-icon"}),warning:F("",G.ESSENTIAL)});He.cineIcons={VALID_ICON_FONTS:ra,toCodePointChar:Hn,normalizeGlyphChar:ei,iconGlyph:F,resolveIconGlyph:Gi,applyIconGlyph:al,iconMarkup:cl,formatSvgCoordinate:dr,positionSvgMarkup:ll,STAR_ICON_SVG:na,ICON_GLYPHS:ul};He.iconGlyph=F;He.resolveIconGlyph=Gi;He.applyIconGlyph=al;He.iconMarkup=cl;He.formatSvgCoordinate=dr;He.positionSvgMarkup=ll;He.STAR_ICON_SVG=na;He.ICON_GLYPHS=ul;He.cineIcons;const wp="modulepreload",Ep=function(e){return"/"+e},sc={},fl=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");o=c(r.map(u=>{if(u=Ep(u),u in sc)return;sc[u]=!0;const f=u.endsWith(".css"),l=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":wp,f||(y.as="script"),y.crossOrigin="",y.href=u,a&&y.setAttribute("nonce",a),document.head.appendChild(y),f)return new Promise((p,d)=>{y.addEventListener("load",p),y.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};function pl(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function dl(e){return!!e&&(typeof e=="object"||typeof e=="function")}function Fi(e){if(typeof Object.freeze=="function")try{return Object.freeze(e)}catch{}return e}function xo(e){if(!e)return[];try{return Array.prototype.slice.call(e)}catch{}const t=[];for(let r=0;r<e.length;r+=1)t[r]=e[r];return t}function ac(){return{objects:typeof WeakMap=="function"?new WeakMap:null,primitives:Object.create(null),empty:null}}function Op(e,t){if(!e)return null;if(dl(t)){if(!e.objects)return null;let o=e.objects.get(t);return o||(o={cached:!1,value:null},e.objects.set(t,o)),o}const r=typeof t+":"+String(t);let n=e.primitives[r];return n||(n={cached:!1,value:null},e.primitives[r]=n),n}function $t(e,t){dl(t)&&e.indexOf(t)===-1&&e.push(t)}const Os=(function(){const t=[];return $t(t,typeof globalThis<"u"?globalThis:null),$t(t,typeof window<"u"?window:null),$t(t,typeof self<"u"?self:null),$t(t,typeof global<"u"?global:null),Fi(t)})(),As=Fi([]),yl=typeof WeakMap=="function",ns=yl?new WeakMap:null;function Ap(e){if(!Array.isArray(e)||e.length===0)return As;const t=[];for(let r=0;r<e.length;r+=1)$t(t,e[r]);return t.length===0?As:Fi(t)}function cc(e,t,r){const n=[];$t(n,e);let o=null;if(typeof t=="function")try{o=t()}catch{o=null}$t(n,o);for(let i=0;i<Os.length;i+=1)$t(n,Os[i]);if(Array.isArray(r))for(let i=0;i<r.length;i+=1)$t(n,r[i]);return Fi(n)}function Cp(e,t){if(!e)return null;if(t===As)return e.empty||(e.empty=ac()),e.empty;if(!e.extras){if(!yl)return null;e.extras=new WeakMap}let r=e.extras.get(t);return r||(r=ac(),e.extras.set(t,r)),r}function _p(e){if(!ns)return null;let t=ns.get(e);return t||(t={empty:null,extras:null},ns.set(e,t)),t}function kp(e,t,r,n){if(n){const i=Op(n,e);if(i){if(i.cached)return xo(i.value);const s=cc(e,t,r);return i.value=s,i.cached=!0,xo(s)}}const o=cc(e,t,r);return xo(o)}function oa(e){const t=e&&typeof e.detectGlobalScope=="function"?e.detectGlobalScope:pl,r=Ap(e&&e.additionalScopes),n=_p(t),o=Cp(n,r);return function(s){return kp(s,t,r,o)}}function Pp(e,t){return oa(t||{})(e)}function Ip(){return xo(Os)}const os=pl();os&&!os.__cineScopeCollector&&(os.__cineScopeCollector={collectCandidateScopes:Pp,createCollector:oa,getBaseScopes:Ip});const Di="__cinePendingModuleRegistrations__";function Qt(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function vp(e){const t=e||Qt();if(!t||typeof t!="object"&&typeof t!="function")return;let r=null;try{r=t.console||null}catch{r=null}if(!r||typeof r!="object"&&typeof r!="function")return;const n=["log","warn","error","info","debug"];let o=null;try{o=r.__cineSafeConsoleOriginals||null}catch{o=null}if(!o||typeof o!="object"){o={};try{Object.defineProperty(r,"__cineSafeConsoleOriginals",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{try{r.__cineSafeConsoleOriginals=o}catch{}}}for(let i=0;i<n.length;i+=1){const s=n[i];let a=null;try{a=r[s]}catch{a=null}if(typeof a!="function"||a&&a.__cineSafeConsoleGuard)continue;Object.prototype.hasOwnProperty.call(o,s)||(o[s]=a);const c=function(){try{return a.apply(r,arguments)}catch{}};try{Object.defineProperty(c,"__cineSafeConsoleGuard",{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{c.__cineSafeConsoleGuard=!0}try{r[s]=c}catch{}}}const lc=oa,jp={key:"defaultExtras"},is=[],zr=typeof WeakMap=="function"?new WeakMap:[];function Lp(e){if(!e||typeof e!="object"&&typeof e!="function")return;if(zr&&typeof zr.get=="function"){let r=zr.get(e);return r||(r=[e],zr.set(e,r)),r}for(let r=0;r<zr.length;r+=1){const n=zr[r];if(n.scope===e)return n.extras}const t=[e];return zr.push({scope:e,extras:t}),t}function Rp(e,t){if(!lc)return null;const r=Array.isArray(t)?t:jp;for(let o=0;o<is.length;o+=1){const i=is[o];if(i.detect===e&&i.extras===r)return i.collector}const n=lc({detectGlobalScope:e,additionalScopes:Array.isArray(t)?t:void 0});return n?(is.push({detect:e,extras:r,collector:n}),n):null}function Ui(e,t){const r=t||Qt(),n=Lp(r),o=Rp(Qt,n);if(o)return o(e||r);const i=[];function s(a){!a||typeof a!="object"&&typeof a!="function"||i.indexOf(a)===-1&&i.push(a)}return s(e||r),typeof globalThis<"u"&&s(globalThis),typeof window<"u"&&s(window),typeof self<"u"&&s(self),typeof global<"u"&&s(global),i}function gl(e){return null}function ml(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function ia(e,t,r){const n=e||r,o=typeof t=="string"&&t?t:Di;if(!n||typeof n!="object")return null;let i=n[o];return Array.isArray(i)?i:!ml(n,o,[])||(i=n[o],!Array.isArray(i))?null:i}const ss=(function(){const t="__cineBuiltinImmutabilityGuards__",r=Ui(null,Qt());for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function Cs(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(ve&&typeof ve=="object")try{if(e===ve.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(t){if(t&&typeof t.message=="string"&&/metamask/i.test(t.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function Tp(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function _s(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(Tp(e)||typeof e=="object"&&e&&typeof e.id=="string"&&typeof e.filename=="string"&&(typeof e.loaded=="boolean"||Array.isArray(e.children))||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(ss&&typeof ss.isImmutableBuiltin=="function"&&ss.isImmutableBuiltin(e)||typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function Np(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function sa(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||_s(e)||Cs(e))return e;if(typeof e=="function")try{return Object.freeze(e)}catch{return e}const r=Np(t);if(r.has(e))return e;r.add(e);let n;try{n=Object.getOwnPropertyNames(e)}catch{return e}for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=Object.getOwnPropertyDescriptor(e,i)}catch{s=null}if(s&&(typeof s.get=="function"||typeof s.set=="function"))continue;let a;try{a=e[i]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||_s(a)||Cs(a)||sa(a,r)}try{return Object.freeze(e)}catch{return e}}function hl(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function Mp(e,t){const n=Ui(e||t,t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}function zp(e,t,r,n,o){const s=ia(e||o,Di,o);if(!s)return!1;const a=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{return s.push(a),!0}catch{}try{return s[s.length]=a,!0}catch{}return!1}function Bp(e){const t=e||Qt();return{detectGlobalScope:Qt,getGlobalScope(){return t},collectCandidateScopes(r){return Ui(r||t,t)},tryRequire:gl,defineHiddenProperty:ml,ensureQueue(r,n){return ia(r||t,n,t)},freezeDeep:sa,safeWarn:hl,resolveModuleRegistry(r){return Mp(r||t,t)},queueModuleRegistration(r,n,o,i){return zp(r||t,n,o,i,t)},getPendingQueueKey(){return Di}}}function xp(e){const t=e||Qt();return t&&typeof t.cineModuleArchitectureKernel=="object"?t.cineModuleArchitectureKernel:null}const aa=Qt();vp(aa);const Gp=xp(aa),Q=Gp||Bp(aa);function uc(){if(Q&&typeof Q.detectGlobalScope=="function")try{const e=Q.detectGlobalScope();if(e)return e}catch{}return Qt()}const ve=Q&&typeof Q.getGlobalScope=="function"?(function(){try{const t=Q.getGlobalScope();if(t)return t}catch{}return uc()})():uc(),ks=Q&&typeof Q.getPendingQueueKey=="function"?Q.getPendingQueueKey():Di;function bl(e){if(Q&&typeof Q.collectCandidateScopes=="function")try{const t=Q.collectCandidateScopes(e||ve);if(Array.isArray(t)&&t.length>0)return t}catch{}return Ui(e||ve,ve)}function Sl(e){if(Q&&typeof Q.tryRequire=="function")try{const t=Q.tryRequire(e);if(typeof t<"u")return t}catch{}return gl()}function wl(e){const t=e||ve;if(Q&&typeof Q.resolveModuleRegistry=="function")try{const o=Q.resolveModuleRegistry(t);if(o&&typeof o=="object")return o}catch{}const r=Sl("./registry.js");if(r&&typeof r=="object")return r;const n=bl(t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}let fc=null,pc=!1;function Ps(e){if(!pc||e&&e!==ve){const t=wl(e);if(e&&e!==ve)return t;fc=t,pc=!0}return fc}function Fp(e){const t=e||ve;if(Q&&typeof Q.ensureQueue=="function")try{const r=Q.ensureQueue(t,ks);if(Array.isArray(r))return r}catch{}return ia(t,ks,ve)}function El(e,t,r,n){const o=e||ve;if(Q&&typeof Q.queueModuleRegistration=="function")try{if(Q.queueModuleRegistration(o,t,r,n))return!0}catch{}const i=Fp(o);if(!i)return!1;const s=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{i.push(s)}catch{i[i.length]=s}return!0}function Ol(e,t,r,n,o,i){if(t&&typeof t.register=="function")try{return t.register(r,n,o),!0}catch(s){typeof i=="function"&&i(s)}return El(e,r,n,o),!1}function dc(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||_s(e)||Cs(e))return e;if(Q&&typeof Q.freezeDeep=="function")try{return Q.freezeDeep(e)}catch{}return sa(e)}function Al(e,t){if(Q&&typeof Q.safeWarn=="function")try{Q.safeWarn(e,t);return}catch{}hl(e,t)}function Cl(e,t,r,n={}){const o=r||ve;if(!o||typeof o!="object")return!1;const i={configurable:n.configurable!==!1,enumerable:!!n.enumerable,value:t,writable:n.writable===!0};try{return Object.defineProperty(o,e,i),!0}catch{try{return o[e]=t,!0}catch{return!1}}}const _l=dc({getGlobalScope(){return ve},collectCandidateScopes:bl,tryRequire:Sl,resolveModuleRegistry:wl,getModuleRegistry:Ps,queueModuleRegistration(e,t,r,n){return El(n||ve,e,t,r)},registerOrQueueModule(e,t,r,n,o,i){const s=o||ve,a=i||Ps(s);return Ol(s,a,e,t,r,n)},freezeDeep:dc,safeWarn:Al,exposeGlobal:Cl,PENDING_QUEUE_KEY:ks}),Dp=Ps();Ol(ve,Dp,"cineModuleBase",_l,{category:"infrastructure",description:"Shared helpers for module registration, freezing and safe global exposure.",replace:!0,connections:["cineModuleArchitectureKernel","cineModuleArchitectureHelpers"]},e=>{Al("Unable to register cineModuleBase.",e)});Cl("cineModuleBase",_l,ve,{configurable:!0,enumerable:!1,writable:!1});var Up={};const Ae=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};let ti=null;!ti&&Ae&&typeof Ae.__cineEnsureConsoleMethodsWritable=="function"&&(ti=Ae.__cineEnsureConsoleMethodsWritable);typeof ti=="function"&&ti(["warn","info"]);const lo="__cinePendingModuleRegistrations__",ca="__cinePendingModuleRegistrationsTimer__";let Fr=Object.create(null),ri=Object.create(null),Go=null;function kl(e){const r=[e||Ae];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModuleImmutability=="object")return o.cineModuleImmutability}return null}const as=(function(){const t="__cineBuiltinImmutabilityGuards__",r=[Ae];typeof globalThis<"u"&&globalThis!==Ae&&r.push(globalThis),typeof window<"u"&&r.push(window),typeof self<"u"&&r.push(self),typeof global<"u"&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function Kp(){function e(r){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function")return!1;try{if(as&&typeof as.isImmutableBuiltin=="function"&&as.isImmutableBuiltin(r)||typeof r.pipe=="function"&&typeof r.unpipe=="function")return!0;if(typeof r.on=="function"&&typeof r.emit=="function"){if(typeof r.write=="function"||typeof r.read=="function")return!0;const n=r.constructor&&r.constructor.name;if(n&&/Stream|Emitter|Port/i.test(n))return!0}if(typeof Symbol<"u"&&r[Symbol.toStringTag]){const n=r[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port/i.test(n))return!0}}catch{}return!1}function t(r,n=new WeakSet){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function"||e(r)||n.has(r))return r;n.add(r);const o=Object.getOwnPropertyNames(r);for(let i=0;i<o.length;i+=1){const s=o[i];let a;try{a=r[s]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||t(a,n)}try{return Object.freeze(r)}catch{return r}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const la=Kp();let Bn=kl(Ae)||la;function $p(){if(Bn!==la)return Bn;const e=kl(Ae);return e&&e!==Bn&&(Bn=e),Bn}function Pt(e,t){const r=$p();try{return r.freezeDeep(e,t)}catch{}return la.freezeDeep(e,t)}function Lr(e){if(typeof e=="string"){const t=e.trim();if(t)return t}throw new TypeError("cineModules.register expected a non-empty string name.")}function Fo(e){if(e==null)return[];const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=new Set,n=[];for(let o=0;o<t.length;o+=1){const i=t[o];let s=null;if(typeof i=="string"?s=i:i&&typeof i.name=="string"&&(s=i.name),!s)continue;const a=s.trim();!a||r.has(a)||(r.add(a),n.push(a))}return n}function Vp(e,t,r={}){const n=Lr(e);if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError(`cineModules.register("${n}") expected an object or function.`);const o=r.freeze!==!1,i=o&&!Object.isFrozen(t)?Pt(t):t;if(Object.prototype.hasOwnProperty.call(Fr,n)){const s=Fr[n];if(s===i)return s;if(!r.replace)throw new Error(`cineModules: Module "${n}" is already registered. Use { replace: true } to overwrite.`)}return Fr[n]=i,ri[n]={description:typeof r.description=="string"?r.description.trim():"",category:typeof r.category=="string"?r.category.trim():"",registeredAt:Date.now(),frozen:o,connections:Pt(Fo(r.connections||r.links||r.dependencies||null))},i}function Hp(e){const t=Lr(e);return Object.prototype.hasOwnProperty.call(Fr,t)?Fr[t]:null}function Pl(e){const t=Lr(e);return Object.prototype.hasOwnProperty.call(Fr,t)}function qp(){return Object.freeze(Object.keys(Fr).sort())}function Wp(e){const t=Lr(e),r=ri[t];return r?Object.freeze({name:t,description:r.description,category:r.category,registeredAt:r.registeredAt,frozen:r.frozen,connections:r.connections||Pt([])}):null}function Yp(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];try{const s=Lr(i);n.has(s)||(n.add(s),r.push(s))}catch{}}return r.length>0?r:null}function Jp(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i!="string")continue;const s=i.trim();!s||n.has(s)||(n.add(s),r.push(s))}return r.length>0?r:null}function Qp(e={}){const t=Yp(e&&e.names),r=Jp(e&&(e.categories||e.category||null)),n=t?new Set(t):null,o=r?new Set(r):null,i=[],s=n?t:Object.keys(ri);for(let a=0;a<s.length;a+=1){const c=s[a],u=ri[c];u&&(o&&!o.has(u.category)||i.push({name:c,description:u.description,category:u.category,registeredAt:u.registeredAt,frozen:u.frozen,connections:u.connections||Pt([])}))}return n||(!e||e.sort!==!1)&&i.sort((c,u)=>c.name.localeCompare(u.name)),Pt(i)}function Xp(e){const t=Array.isArray(e)?e.slice():[e],r={},n=[];for(let o=0;o<t.length;o+=1){const i=Lr(t[o]),s=Pl(i);r[i]=s,s||n.push(i)}return Object.freeze({ok:n.length===0,missing:Object.freeze(n),detail:Object.freeze(r)})}function Zp(e={}){throw typeof process<"u"&&process,new Error("cineModules.__internalResetForTests() is restricted to test environments.")}function Il(e){if(!e||typeof e!="object")return null;const t=e[ca];return t&&typeof t=="object"?t:null}function ua(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function ni(e){const t=Il(e);if(!t)return;const r=t&&typeof t.clear=="function"?t.clear:null;if(r&&Object.prototype.hasOwnProperty.call(t,"id"))try{r(t.id)}catch{}ua(e,ca,null)}function vl(e){if(!e||typeof e!="object")return;const t=e[lo];if(!Array.isArray(t)||t.length===0){ni(e);return}if(Il(e))return;const r=typeof e.setTimeout=="function"&&e.setTimeout.bind(e)||typeof Ae.setTimeout=="function"&&Ae.setTimeout.bind(Ae)||(typeof setTimeout=="function"?setTimeout:null);if(typeof r!="function")return;const n=typeof e.clearTimeout=="function"&&e.clearTimeout.bind(e)||typeof Ae.clearTimeout=="function"&&Ae.clearTimeout.bind(Ae)||(typeof clearTimeout=="function"?clearTimeout:null),o=r(function(){ni(e),jl(e)},0);ua(e,ca,{id:o,clear:typeof n=="function"?n:null})}function jl(e){if(!e||typeof e!="object")return;const t=e[lo];if(!Array.isArray(t)||t.length===0){ni(e);return}const r=t.slice();t.length=0;for(let n=0;n<r.length;n+=1){const o=r[n];if(!o||typeof o!="object")continue;const i=o.name,s=o.api,a=o.options||{};try{Ee.register(i,s,a)}catch(c){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`cineModules: discard pending registration for "${i}" due to error:`,c);continue}}t.length>0?vl(e):ni(e)}function ed(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),r(Ae),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function cs(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e[lo];return Array.isArray(t)?t:null}catch{return null}}function td(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=cs(e);if(t||ua(e,lo,[])&&(t=cs(e),t))return t;try{if(e[lo]=[],t=cs(e),t)return t}catch{}return null}function rd(e){const t=ed(e);for(let r=0;r<t.length;r+=1){const n=t[r],o=td(n);if(o)return{queue:o,scope:n}}return null}function nd(e,t){const r=rd(e||Ae);if(!r||!r.queue)return!1;const n=Pt({name:t&&t.name?Lr(t.name):null,api:t?t.api:null,options:Object.freeze({...t&&t.options?t.options:{}})}),{queue:o,scope:i}=r;try{o.push(n)}catch{o[o.length]=n}try{vl(i)}catch{}return!0}function od(e={}){const t=Lr(e.name),r=typeof e.category=="string"?e.category.trim():"";if(!r)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty category string.`);const n=typeof e.description=="string"?e.description.trim():"";if(!n)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty description.`);const o=e.freeze!==!1,i=Pt(Fo(e.connections)),s=typeof e.factory=="function"?e.factory:null,a=s?null:e.api;if(!s&&(!a||typeof a!="object"&&typeof a!="function"))throw new TypeError(`cineModules.createBlueprint("${t}") expected an object API or factory function.`);const c=Object.freeze({name:t,category:r,description:n,connections:i,freeze:o});let u=null,f=!1,l=null;function y(m){const b={category:c.category,description:c.description,connections:c.connections,freeze:c.freeze};if(!m||typeof m!="object")return Object.freeze({...b});const A={...b};if(Object.prototype.hasOwnProperty.call(m,"category")){const O=typeof m.category=="string"?m.category.trim():"";O&&(A.category=O)}if(Object.prototype.hasOwnProperty.call(m,"description")){const O=typeof m.description=="string"?m.description.trim():"";O&&(A.description=O)}return Object.prototype.hasOwnProperty.call(m,"connections")&&(A.connections=Pt(Fo(m.connections))),Object.prototype.hasOwnProperty.call(m,"freeze")&&(A.freeze=m.freeze!==!1),Object.freeze(A)}function p(m){if(f){if(l)throw l;return u}f=!0;let b=a;if(s){const A=m&&typeof m=="object"?{...m}:{},O=Object.freeze({registry:Go||null,metadata:c,context:A,freezeDeep:Pt,normalizeConnections:Fo});try{b=s(O)}catch(C){throw l=C instanceof Error?C:new Error(String(C)),l}}if(!b||typeof b!="object"&&typeof b!="function"){const A=new TypeError(`cineModules.createBlueprint("${t}") factory expected an object or function return value.`);throw l=A,A}return u=o&&!Object.isFrozen(b)?Pt(b):b,u}function d(m={}){const b=m&&typeof m.registry=="object"&&m.registry?m.registry:Go,A=y(m&&m.options),O=m&&m.scope?m.scope:Ae,C=m&&Object.prototype.hasOwnProperty.call(m,"defer")?m.defer!==!1:!0,k=m&&typeof m.onError=="function"?m.onError:null,_=p(m&&m.context),v=b&&typeof b.register=="function"?b:Go;if(!v||typeof v.register!="function")throw new TypeError("cineModules.createBlueprint register() requires a registry with a register() function.");try{return v.register(c.name,_,A)}catch(S){if(C&&nd(O,{name:c.name,api:_,options:A}),k)try{k(S)}catch{}throw S}}const g={name:c.name,category:c.category,description:c.description,connections:c.connections,freeze:c.freeze,instantiate:p,register:d,getMetadata(){return c},createRegistrationOptions:y,toJSON(){return c}};return Object.freeze(g)}const Ee={};Ee.register=Vp;Ee.get=Hp;Ee.has=Pl;Ee.list=qp;Ee.describe=Wp;Ee.describeAll=Qp;Ee.assertRegistered=Xp;Ee.createBlueprint=od;Ee.__internalResetForTests=Zp;Go=Ee;const Xt=[Ae];typeof globalThis<"u"&&globalThis!==Ae&&Xt.push(globalThis);typeof window<"u"&&Xt.indexOf(window)===-1&&Xt.push(window);typeof self<"u"&&Xt.indexOf(self)===-1&&Xt.push(self);typeof global<"u"&&Xt.indexOf(global)===-1&&Xt.push(global);for(let e=0;e<Xt.length;e+=1){const t=Xt[e];if(!t||typeof t!="object")continue;if(t.cineModules!==Ee)try{Object.defineProperty(t,"cineModules",{configurable:!0,enumerable:!1,value:Ee,writable:!0})}catch{try{t.cineModules=Ee}catch{}}jl(t)}function fa(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Ll=fa(),xn={value:null,time:0};function pa(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Eo(){if(xn.value&&typeof xn.value=="object")return xn.value;try{const e=fa();if(e&&(typeof e=="object"||typeof e=="function"))return xn.value=e,xn.time=Date.now(),e}catch{}return Ll}function Rl(e,t,r){const n=[],o=s=>{!s||typeof s!="object"&&typeof s!="function"||n.indexOf(s)===-1&&n.push(s)};o(e);const i=typeof r=="function"?r:Eo;try{o(i())}catch{}if(Array.isArray(t))for(let s=0;s<t.length;s+=1)o(t[s]);return typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),o(Ll),n.slice()}function id(e){if(typeof require!="function")return null;try{return require(e)}catch{return null}}function sd(e,t){const r=t||{},n=typeof r.predicate=="function"?r.predicate:null,o=Array.isArray(r.scopes)?r.scopes.slice():[],i=Rl(r.primaryScope,r.additionalScopes,r.detect);for(let s=0;s<i.length;s+=1)o.indexOf(i[s])===-1&&o.push(i[s]);for(let s=0;s<o.length;s+=1){const a=o[s];if(!(!a||typeof a!="object"&&typeof a!="function")){if(n)try{if(n(a,e))return a}catch{}try{if(e in a)return a}catch{}}}return null}function ad(e,t){if(!e)return typeof t=="function"?t():t;const r=Eo();if(r&&typeof r=="object"){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];const n=typeof t=="function"?t():t;if(pa(r,e,n))try{return r[e]}catch{}return n}return typeof t=="function"?t():t}const cd={baseDetectGlobalScope:fa,detectGlobalScope:Eo,collectCandidateScopes:Rl,tryRequire:id,defineHiddenProperty:pa,resolveFromScopes:sd,getCachedGlobalValue:ad},ls=Eo();ls&&!ls.cineScopeUtils&&pa(ls,"cineScopeUtils",cd);const Oo=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},ld=new Set(["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI","DisplayPort"]),oi="__normalized";function Tl(e){const t=new Map;return r=>{if(!r)return"";const n=String(r).replace(/[™®]/g,"").trim(),o=n.toLowerCase();return t.has(o)||t.set(o,e(n,o)),t.get(o)}}const ud=[{needles:["12g"],value:"12G-SDI"},{needles:["6g"],value:"6G-SDI"},{needles:["3g"],value:"3G-SDI"},{needles:["hd","sdi"],value:"3G-SDI"},{needles:["mini","bnc"],value:"Mini BNC"},{needles:["micro","hdmi"],value:"Micro HDMI"},{needles:["mini","hdmi"],value:"Mini HDMI"},{needles:["hdmi"],value:"HDMI"},{needles:["displayport"],value:"DisplayPort"},{needles:["display","port"],value:"DisplayPort"},{needles:["dp"],value:"DisplayPort"}],Nl=Tl((e,t)=>{const r=ud.find(({needles:n})=>n.every(o=>t.includes(o)));return r?r.value:""}),fd={"lemo 4-pin (lbus)":"LBUS (LEMO 4-pin)","lbus (lemo 4-pin)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo for motors)":"LBUS (LEMO 4-pin)","4-pin lemo (lbus)":"LBUS (LEMO 4-pin)","lemo 4-pin":"LEMO 4-pin","4-pin lemo":"LEMO 4-pin","lemo 7-pin":"LEMO 7-pin","lemo 7-pin 1b":"LEMO 7-pin","7-pin lemo":"LEMO 7-pin","7-pin lemo (lcs)":"LEMO 7-pin (LCS)","7-pin lemo (cam)":"LEMO 7-pin (CAM)","ext (lemo 7-pin)":"EXT LEMO 7-pin","hirose 12pin":"Hirose 12-pin","12-pin hirose":"Hirose 12-pin","12pin broadcast connector":"Hirose 12-pin","lens 12 pin":"Hirose 12-pin","lens terminal 12-pin":"Hirose 12-pin","lens terminal 12-pin jack":"Hirose 12-pin","lens terminal":"Hirose 12-pin","usb type-c":"USB-C","usb-c":"USB-C","usb-c (usb 3.2 / 3.1 gen 1)":"USB-C","usb-c / gigabit ethernet (via adapter)":"USB-C","active ef mount":"Active EF mount","lanc (2.5mm stereo mini jack)":"LANC","2.5 mm sub-mini (lanc)":"LANC","remote a (2.5mm)":"REMOTE A connector","remote control terminal":"REMOTE A connector","remote 8 pin":"REMOTE B connector"};function da(e){return Tl((t,r)=>e[r]||t)}const qn=da(fd),pd={'dsmc3 red touch 7" lcd (optional)':'RED Touch 7" LCD (Optional)','red touch 7.0" lcd (optional)':'RED Touch 7" LCD (Optional)',"lcd touch panel":"LCD touchscreen","lcd touchscreen":"LCD touchscreen","native lcd capacitive touchscreen":"LCD touchscreen","integrated touchscreen lcd":"LCD touchscreen","free-angle lcd":"Vari-angle LCD","lcd monitor (native)":"Integrated LCD monitor","native lcd viewfinder":"Integrated LCD monitor","lcd monitor lm-v2 (supplied)":"LCD Monitor LM-V2","integrated main monitor":"Integrated LCD monitor","optional evf-v70 viewfinder":"EVF-V70 (Optional)","optional evf-v50":"EVF-V50 (Optional)","optional oled viewfinder":"OLED EVF (Optional)","blackmagic pocket cinema camera pro evf (optional)":"Blackmagic Pro EVF (Optional)","external backlit lcd status display":"LCD status display","built-in fold-out lcd":"Fold-out LCD","oled lvf (live view finder)":"OLED EVF","lcd capacitive touchscreen":"LCD touchscreen","lemo 26 pin":"LEMO 26-pin port"},Ml=da(pd),dd={"lemo 8-pin (dc in / bat)":"Bat LEMO 8-pin","lemo 8-pin (bat)":"Bat LEMO 8-pin","bat (lemo 8-pin)":"Bat LEMO 8-pin","lemo 8-pin":"Bat LEMO 8-pin","2-pin dc-input":"2-pin DC-IN","dc-":"DC IN",dc:"DC IN","2-pin xlr":"XLR 2-pin","2-pin locking connector":"LEMO 2-pin","2-pin locking connector / 2-pin lemo":"LEMO 2-pin","4-pin xlr / dc in 12v":"XLR 4-pin","4-pin xlr / v-lock":"XLR 4-pin","xlr 4-pin jack":"XLR 4-pin","xlr 4-pin (main input)":"XLR 4-pin","xlr-type 4 pin (male) / square-shaped 5 pin connector (battery)":"XLR 4-pin / Square 5-pin","12-pin molex connector (at battery plate rear) / 4-pin xlr (external power)":"Molex 12-pin / XLR 4-pin","battery slot":"Battery Slot","usb-c":"USB-C","usb type-c":"USB-C","usb-c pd":"USB-C PD","usb-c (power delivery)":"USB-C PD","usb-c pd,dc coupler":"USB-C PD / DC Coupler","dc coupler":"DC Coupler","dc coupler (dr-e6c)":"DC Coupler","dc input":"DC IN","dc barrel":"DC Barrel","dc (barrel)":"DC Barrel","locking dc barrel":"DC Barrel","dc 24v terminal":"DC Barrel","weipu sf610/s2 (12vdc) input":"Weipu SF610/S2","6-pin 1b dc-in / tb50 battery mount":"6-pin 1B DC-IN","6-pin 1b dc-,tb50":"6-pin 1B DC-IN"},yc=da(dd);function Do(e){if(!e)return[];const t=r=>{const n=yc(r);return n?n.split(/[/,]/).map(o=>yc(o.trim())).map(o=>o&&o.trim()||"").filter(Boolean):[]};return Array.isArray(e)?e.flatMap(t):t(e)}function pr(e,t){return Array.isArray(e)?e.map(r=>typeof r=="string"?{...t,type:r}:{...t,...r||{}}):[]}function ya(e){if(!e)return;e.powerInput&&!e.power?.input&&(e.power={...e.power||{},input:{type:Do(e.powerInput)}},delete e.powerInput);const t=e.power?.input;if(!t)return;const r=n=>{if(typeof n=="string")return{type:Do(n)};if(n){const{portType:o,type:i,...s}=n,a=!i&&o?o:i;return{...s,type:a?Do(a):[]}}return{type:[]}};e.power.input=Array.isArray(t)?t.map(r):r(t)}function gc(e){!e||typeof e!="object"||Object.values(e).forEach(ya)}function zl(e){return!!(e&&Object.prototype.hasOwnProperty.call(e,oi)&&e[oi])}function ga(e){if(!e||typeof e!="object")return e;try{Object.defineProperty(e,oi,{configurable:!0,enumerable:!1,value:!0,writable:!0})}catch{e[oi]=!0}return e}function ma(e,t){if(!e||typeof e!="object"||!!!(t&&t.force)&&zl(e))return e;Object.values(e.cameras||{}).forEach(o=>{o.power?.input&&o.power.input.powerDrawWatts!==void 0&&delete o.power.input.powerDrawWatts,ya(o),Array.isArray(o.power?.batteryPlateSupport)&&(o.power.batteryPlateSupport=o.power.batteryPlateSupport.map(i=>{if(typeof i=="string"){const s=i.match(/([^()]+)(?:\(([^)]+)\))?(?:\s*-\s*(.*))?/),a=s?s[1].trim():i;let c=s&&s[2]?s[2].trim().toLowerCase():"";c?/via adapter/i.test(c)&&(c="adapted"):c=/adapted|via adapter/i.test(i)?"adapted":"native";const u=s&&s[3]?s[3].trim():/via adapter/i.test(i)?"via adapter":"";return{type:a,mount:c,notes:u}}return{type:i.type||"",mount:(i.mount?i.mount:i.native?"native":i.adapted?"adapted":"native").toLowerCase(),notes:i.notes||""}})),o.power&&(o.power.powerDistributionOutputs=pr(o.power.powerDistributionOutputs,{type:"",voltage:"",current:"",wattage:null,notes:""})),o.videoOutputs=pr(o.videoOutputs,{type:"",notes:""}).flatMap(i=>{const{count:s,...a}=i||{},c=Nl(a.type);if(!ld.has(c))return[];const u=parseInt(s,10),f=Number.isFinite(u)&&u>0?u:1,l={...a,type:c,notes:a.notes||""};return Array.from({length:f},()=>({...l}))}),o.fizConnectors=pr(o.fizConnectors,{type:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:qn(s)}}),o.viewfinder=pr(o.viewfinder,{type:"",resolution:"",connector:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:Ml(s)}}),o.recordingMedia=pr(o.recordingMedia,{type:"",notes:""}).map(i=>{let{type:s="",notes:a=""}=i||{};const c=s.match(/^(.*?)(?:\((.*)\))?$/);return c&&(s=c[1].trim(),a=a||(c[2]?c[2].trim():"")),/^SD UHS-II$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II`:"UHS-II"):/^SD \(UHS-II\/UHS-I\)$/i.test(s)?(s="SD Card",a="UHS-II/UHS-I"):s==="CFast 2.0 card slots"?(s="CFast 2.0",a=a||"Dual Slots"):s==="CFexpress Type B (Dual Slots)"?(s="CFexpress Type B",a=a||"Dual Slots"):s==="CFexpress Type B (via adapter)"?(s="CFexpress Type B",a=a||"via adapter"):/^SD UHS-II \(Dual Slots\)$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II (Dual Slots)`:"UHS-II (Dual Slots)"):s==="SD Card (Dual Slots)"?(s="SD Card",a=a||"Dual Slots"):s==="SD card slot (for proxy/backup)"&&(s="SD Card",a=a||"for proxy/backup"),{type:s,notes:a}}),o.timecode=pr(o.timecode,{type:"",notes:""}),o.lensMount=pr(o.lensMount,{type:"",mount:"native",notes:""}).map(i=>({type:i.type,mount:i.mount?i.mount.toLowerCase():"native",notes:i.notes||""})).filter((i,s,a)=>s===a.findIndex(c=>c.type===i.type&&c.mount===i.mount&&c.notes===i.notes))}),Object.values(e.lenses||{}).forEach(o=>{if(!o||typeof o!="object")return;const i=y=>{if(!y)return null;if(typeof y=="string"){const g=y.trim();return g?{type:g,mount:"native"}:null}const p=typeof y.type=="string"?y.type.trim():"";if(!p)return null;const d=typeof y.mount=="string"?y.mount.trim().toLowerCase():"";return{type:p,mount:d==="adapted"?"adapted":"native"}},s=o.mountOptions,a=[],c=y=>{const p=i(y);p&&a.push(p)};if(Array.isArray(s)?s.forEach(c):s&&typeof s=="object"&&c(s),!a.length&&Array.isArray(o.lensMount)&&(o.lensMount.forEach(c),delete o.lensMount),!a.length){const y=typeof o.mount=="string"?o.mount.trim():"";y&&c({type:y,mount:"native"})}const u=[];a.forEach(y=>{if(!y||!y.type)return;const p=y.mount==="adapted"?"adapted":"native";u.some(g=>g.type===y.type&&g.mount===p)||u.push({type:y.type,mount:p})});const f=Array.isArray(u)?u:[];o.mountOptions=f;const l=Array.isArray(o.mountOptions)?o.mountOptions:[];if(l.length){const y=l.find(d=>d&&d.mount==="native"&&d.type)||l[0],p=y&&y.type?y.type:"";p?o.mount=p:typeof o.mount=="string"&&(o.mount=o.mount.trim())}else typeof o.mount=="string"&&(o.mount=o.mount.trim(),o.mount||delete o.mount)}),["monitors","video","viewfinders"].forEach(o=>{gc(e[o])});const n=e.fiz||{};return["motors","controllers","distance"].forEach(o=>{gc(n[o])}),Object.values(e.fiz?.motors||{}).forEach(o=>{o&&(o.connector&&!o.fizConnector&&(o.fizConnector=o.connector,delete o.connector),o.fizConnector&&(o.fizConnector=qn(o.fizConnector)))}),Object.values(e.fiz?.controllers||{}).forEach(o=>{if(o)if(o.FIZ_connector&&!o.fizConnector&&!o.fizConnectors&&(o.fizConnector=o.FIZ_connector,delete o.FIZ_connector),Array.isArray(o.fizConnectors))o.fizConnectors=o.fizConnectors.map(i=>{if(!i)return{type:""};const s=qn(i.type||i),a=i.notes||void 0;return a?{type:s,notes:a}:{type:s}});else if(o.fizConnector){const i=String(o.fizConnector).split(",").map(s=>s.trim()).filter(Boolean);o.fizConnectors=i.map(s=>({type:qn(s)})),delete o.fizConnector}else o.fizConnectors=[]}),ga(e),e}function Bl(e){return ma(e,{force:!0})}Oo.cineDeviceNormalization={unifyDevices:ma,normalizeDevicesForPersistence:Bl,markDevicesNormalized:ga,hasNormalizedDevicesMarker:zl,fixPowerInput:ya,normalizeVideoType:Nl,normalizeFizConnectorType:qn,normalizeViewfinderType:Ml,normalizePowerPortType:Do,ensureList:pr};Oo.unifyDevices=ma;Oo.normalizeDevicesForPersistence=Bl;Oo.markDevicesNormalized=ga;Oo.cineDeviceNormalization;var mc={};function xl(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Rr(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function yd(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function hc(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}const Gl=(function(){const t=xl();if(t&&typeof t.__cineDeepClone=="function")return t.__cineDeepClone;const r=yd(t);return r?function(o){if(o===null||typeof o!="object")return o;try{return r(o)}catch{}return hc(o)}:hc})();function gd(e){const t=Rr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function md(e){const t=Rr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}function hd(e){const t=Rr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleGlobals=="object")return n.cineModuleGlobals}return null}function bc(e){return null}const Ki=xl(),Y=gd(Ki),J=md(Ki),q=hd(Ki),W=(J&&typeof J.getGlobalScope=="function"?J.getGlobalScope():null)||(Y&&typeof Y.getGlobalScope=="function"?Y.getGlobalScope():null)||Ki;(function(){return q&&typeof q.tryRequire=="function"?q.tryRequire:J&&typeof J.tryRequire=="function"?function(r){const n=J.tryRequire(r);return typeof n>"u"?bc():n}:Y&&typeof Y.tryRequire=="function"?Y.tryRequire:bc})();const Sc=(function(){const t=[];function r(o,i){if(typeof o!="function")return;t.some(a=>a&&a.fn===o)||t.push({fn:o,scope:i||null})}if(q&&(typeof q.structuredClone=="function"&&r(q.structuredClone,q),typeof q.getStructuredClone=="function"))try{const o=q.getStructuredClone();r(o,q)}catch{}if(J&&(typeof J.structuredClone=="function"&&r(J.structuredClone,J),typeof J.getStructuredClone=="function"))try{const o=J.getStructuredClone();r(o,J)}catch{}if(Y&&(typeof Y.structuredClone=="function"&&r(Y.structuredClone,Y),typeof Y.getStructuredClone=="function"))try{const o=Y.getStructuredClone();r(o,Y)}catch{}const n=Rr(W);for(let o=0;o<n.length;o+=1){const i=n[o];if(!i||typeof i!="object"&&typeof i!="function")continue;const s=i.structuredClone;typeof s=="function"&&r(s,i)}return t})();let Io=null;function bd(e){if(Io)try{const t=Io;return{success:!0,value:t.scope?t.fn.call(t.scope,e):t.fn(e)}}catch{Io=null}for(let t=0;t<Sc.length;t+=1){const r=Sc[t];if(!(!r||typeof r.fn!="function"))try{const n=r.scope?r.fn.call(r.scope,e):r.fn(e);return Io=r,{success:!0,value:n}}catch{}}return{success:!1,value:null}}function Sd(e){if(q&&typeof q.resolveModuleRegistry=="function")try{const r=q.resolveModuleRegistry(e||W);if(r)return r}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const r=J.getModuleRegistry(e||W);if(r)return r}catch{}if(Y&&typeof Y.resolveModuleRegistry=="function")try{return Y.resolveModuleRegistry(e||W)}catch{}if(Ee&&typeof Ee=="object")return Ee;const t=Rr(W);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModules=="object")return n.cineModules}return null}const Uo=(function(){if(q&&typeof q.getModuleRegistry=="function")try{const t=q.getModuleRegistry(W);if(t)return t}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const t=J.getModuleRegistry(W);if(t)return t}catch{}if(Y&&typeof Y.getModuleRegistry=="function")try{const t=Y.getModuleRegistry(W);if(t)return t}catch{}return Sd()})(),wd=(function(){return q&&typeof q.queueModuleRegistration=="function"?function(r,n,o,i){try{return q.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:J&&typeof J.queueModuleRegistration=="function"?function(r,n,o){try{const i=J.queueModuleRegistration(r,n,o);return typeof i>"u"?!1:i}catch{return!1}}:Y&&typeof Y.queueModuleRegistration=="function"?function(r,n,o,i){try{return Y.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:function(){return!1}})(),Ed=(function(){return q&&typeof q.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=q.registerOrQueueModule(r,n,o,i,s||W,a||Uo);return typeof c>"u"?!1:c}catch{return!1}}:J&&typeof J.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=J.registerOrQueueModule(r,n,o,i,s||W,a||Uo);return typeof c>"u"?!1:c}catch{return!1}}:Y&&typeof Y.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{return Y.registerOrQueueModule(r,n,o,i,s||W,a||Uo)}catch{return!1}}:function(r,n,o,i){if(typeof i=="function")try{if(typeof window<"u"&&window.cineModuleRegistry&&typeof window.cineModuleRegistry.register=="function")return window.cineModuleRegistry.register(r,n,o),!0;console.warn("Logging module registration deferred - queue unavailable.")}catch{}return!1}})();function Od(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Ad(e){if(!e||typeof e!="object"||Od(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;const t=e.constructor;if(!t)return!1;if(t===Number||t===String||t===Boolean||t===Date||t===RegExp||t===Promise||t===WeakMap||t===WeakSet||t===Map||t===Set)return!0;const r=typeof t.name=="string"?t.name:"";if(r&&/Error|Event|Response|Request|Headers|Node|Element|Window|Document/.test(r))return!0;try{if(typeof e.then=="function"||typeof e.catch=="function"||typeof e.pipe=="function"||typeof e.on=="function"||typeof e.write=="function"||typeof e.read=="function"||typeof e.getReader=="function"||typeof e.getWriter=="function"||typeof e[Symbol.iterator]=="function"&&!Array.isArray(e))return!0;if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const n=e[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port|Process/.test(n))return!0}}catch{}return!1}function Is(e,t){const r=t||(typeof WeakSet=="function"?new WeakSet:{add(){},has(){return!1}});if(!e||typeof e!="object"||Ad(e))return e;if(typeof process<"u"&&process&&mc&&mc.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(typeof r.has=="function"&&r.has(e))return e;typeof r.add=="function"&&r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||Is(s,r)}try{try{return Object.freeze(e)}catch(o){return e}}catch{return e}}const je=(function(){return q&&typeof q.freezeDeep=="function"?q.freezeDeep:J&&typeof J.freezeDeep=="function"?function(r,n){try{return J.freezeDeep(r,n)}catch{return Is(r,n)}}:Y&&typeof Y.freezeDeep=="function"?Y.freezeDeep:Is})();function wc(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Qe=(function(){return q&&typeof q.safeWarn=="function"?q.safeWarn:J&&typeof J.safeWarn=="function"?function(r,n){try{J.safeWarn(r,n)}catch{wc(r,n)}}:Y&&typeof Y.safeWarn=="function"?Y.safeWarn:wc})(),On=["debug","info","warn","error","log"],_t=typeof Symbol=="function"?Symbol.for("cineLoggingConsoleProxyInstalled"):"__cineLoggingConsoleProxyInstalled__",ge=(function(){const t=Object.create(null);if(typeof console>"u"||!console)return t;for(let r=0;r<On.length;r+=1){const n=On[r];try{const o=console[n];t[n]=typeof o=="function"?o:null}catch{t[n]=null}}return t})();let gt=!1,ha=!1,xr=!1,Gn=null,vo=!1,Fn=0;const Cd=(function(){return q&&typeof q.exposeGlobal=="function"?function(r,n,o){try{return q.exposeGlobal(r,n,o)}catch{return!1}}:function(r,n){if(!W||typeof W!="object"&&typeof W!="function")return!1;try{return W[r]=n,!0}catch{return!1}}})();function _d(e,t){if(!(!q||typeof q.recordModule!="function"))try{q.recordModule(e,t)}catch{}}const zt={debug:{priority:10,consoleMethod:"debug"},info:{priority:20,consoleMethod:"info"},warn:{priority:30,consoleMethod:"warn"},error:{priority:40,consoleMethod:"error"}},kd=je(zt),An=Object.freeze(Object.keys(zt).concat(["other"]));function Tn(){const e=Object.create(null);for(let t=0;t<An.length;t+=1){const r=An[t];e[r]=0}return e}function Pd(e){if(!(!e||typeof e!="object"))for(let t=0;t<An.length;t+=1){const r=An[t];e[r]=0}}function Id(e){if(typeof e=="string"&&e){if(Object.prototype.hasOwnProperty.call(zt,e))return e;const t=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(zt,t))return t}return"other"}function vs(e,t){if(!e||typeof e!="object")return 0;const r=e[t];return typeof r=="number"&&Number.isFinite(r)&&r>0?r:0}function ba(e,t,r){if(!e||typeof e!="object"||typeof r!="number"||!Number.isFinite(r)||r===0)return;const n=Id(t),i=vs(e,n)+r;e[n]=i>0?i:0}function Fl(e,t,r){if(!(!Array.isArray(t)||!t.length)&&!(typeof r!="number"||!Number.isFinite(r)||r===0))for(let n=0;n<t.length;n+=1){const o=t[n],i=o&&o.level;ba(e,i,r)}}function vd(e){const t=Tn();return Fl(t,e,1),t}function Dl(e,t){if(!(!e||typeof e!="object"||!t||typeof t!="object"))for(let r=0;r<An.length;r+=1){const n=An[r],o=vs(t,n);if(o){const i=vs(e,n);e[n]=i+o}}}function Ul(e){const t=Tn();return Dl(t,e),t}function dn(e){return je(Ul(e))}const ii=50,Kl=1,$l=5e3,si="__cineLoggingHistory",js="__cineLoggingConfig",jd=typeof Symbol=="function"?Symbol.for("cineLoggingHandled"):"__cineLoggingHandled__",ft={level:"warn",historyLevel:"info",historyLimit:1200,consoleOutput:!0,persistSession:!0,captureGlobalErrors:!0,captureConsole:!1,stackTraces:!0},Ld=je(ft),Rd="cine-sw-logs",Td="cine-sw:log-entry",Nd="cine-sw:log-state-request",Md="cine-sw:log-state",Ec=5e3,zd=60*1e3,Bd=200;function Vl(){return{level:ft.level,historyLevel:ft.historyLevel,historyLimit:ft.historyLimit,consoleOutput:ft.consoleOutput,persistSession:ft.persistSession,captureGlobalErrors:ft.captureGlobalErrors,captureConsole:ft.captureConsole,stackTraces:ft.stackTraces}}let L=Vl();const vt=[],ai=new Set,ci=new Set,jo=typeof WeakSet=="function"?new WeakSet:[];let Hl=0;const ql=Tn(),$i=Tn(),Wl=Tn();let Yl=0,ae=null;const U={initialised:!1,supported:!1,requestInFlight:!1,lastRequestId:null,pollTimer:null,requestTimer:null,broadcastChannel:null,broadcastFailed:!1,seenIds:typeof Set=="function"?new Set:null,fallbackSeenIds:typeof Set!="function"?[]:null,lastSnapshotMeta:null};function Er(e,t){const r=typeof t=="string"?t:L.level;if(typeof e=="string"){const n=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(zt,n))return n;if(n==="log"||n==="information")return"info";if(n==="warning")return"warn";if(n==="trace"||n==="verbose")return"debug";if(n==="fatal"||n==="critical")return"error"}return Object.prototype.hasOwnProperty.call(zt,r)?r:"info"}function Cn(e){const t=Er(e,"info"),r=zt[t];return r?r.priority:zt.info.priority}function Dn(e,t){if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:e>0:!!t;if(typeof e=="string"){const r=e.trim().toLowerCase();if(r==="true"||r==="1"||r==="yes"||r==="on")return!0;if(r==="false"||r==="0"||r==="no"||r==="off")return!1}return typeof t=="boolean"?t:!1}function Jl(e,t){const n=!!(t&&t.allowReducedMin===!0)?Kl:ii;if(typeof e=="number"&&Number.isFinite(e)){const o=Math.abs(Math.floor(e));return o?Math.max(n,Math.min($l,o)):L.historyLimit}if(typeof e=="string"&&e){const o=Number(e);if(Number.isFinite(o))return Jl(o,t)}return L.historyLimit}function uo(e){if(typeof e=="string")return e;if(e instanceof Error)return e.message||e.name||"Error";if(e&&typeof e=="object"){if(typeof e.message=="string")return e.message;const t=e.constructor&&e.constructor.name;if(t)return t}if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e>"u"||e===null)return"";try{return String(e)}catch{}return Object.prototype.toString.call(e)}function ue(e,t,r){const n=typeof t=="number"?t:0,o=r||(typeof WeakSet=="function"?new WeakSet:null);if(e===null||typeof e>"u")return null;const i=typeof e;if(i==="string"||i==="number"||i==="boolean")return e;if(i==="bigint")try{return e.toString()}catch{return"BigInt"}if(i==="symbol")try{return e.toString()}catch{return"Symbol"}if(i==="function")return`[Function${e.name?` ${e.name}`:""}]`;if(e instanceof Date)try{return e.toISOString()}catch{return e.toString()}if(typeof RegExp<"u"&&e instanceof RegExp){try{return e.toString()}catch{}return"[RegExp]"}if(e instanceof Error){const a={name:e.name,message:e.message};if(e.stack&&(a.stack=String(e.stack)),typeof e.code<"u"&&(a.code=e.code),typeof e.status<"u"&&(a.status=e.status),typeof e.cause<"u"&&e.cause!==null&&(a.cause=ue(e.cause,n+1,o)),typeof e.details<"u"&&(a.details=ue(e.details,n+1,o)),typeof e.errors<"u"&&e.errors!==null){const c=[];let f=0;const l=function(d){if(c.length>=10){f+=1;return}try{c.push(ue(d,n+1,o))}catch(g){c.push(g&&g.message?`[Unserializable error: ${g.message}]`:"[Unserializable error]")}},y=e.errors;if(Array.isArray(y)){for(let p=0;p<y.length;p+=1)l(y[p]);y.length>c.length&&(f+=y.length-c.length)}else if(y&&typeof y=="object"){let p=null;try{const d=typeof Symbol=="function"?Symbol.iterator:null;d&&typeof y[d]=="function"&&(p=y[d].call(y))}catch{p=null}if(p&&typeof p.next=="function"){let d=p.next(),g=0;for(;!d.done;){g<10?l(d.value):f+=1,g+=1;try{d=p.next()}catch{f+=1;break}}}else l(y)}else l(y);c.length&&(a.errors=c,f>0&&(a.errorsTruncated=f))}return a}if(i==="object"){if(o)try{if(o.has(e))return"[Circular]";o.add(e)}catch{}if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return{__type:"ArrayBuffer",byteLength:e.byteLength};if(typeof DataView<"u"&&e instanceof DataView)return{__type:"DataView",byteOffset:e.byteOffset,byteLength:e.byteLength};if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(e)){const d=e.constructor&&e.constructor.name,g=32,m=typeof e.length=="number"?e.length:0,b=[],A=Math.min(m,g);for(let C=0;C<A;C+=1)b.push(e[C]);const O={__type:d||"TypedArray",length:m,byteOffset:typeof e.byteOffset=="number"?e.byteOffset:0,byteLength:typeof e.byteLength=="number"?e.byteLength:0};return b.length&&(O.preview=b),m>g&&(O.__truncatedItems=m-g),O}const a=typeof Map=="function"?Map:null;if(a&&e instanceof a){const d=[];let m=0;e.forEach((A,O)=>{m<30&&d.push({key:ue(O,n+1,o),value:ue(A,n+1,o)}),m+=1});const b={__type:"Map",size:typeof e.size=="number"?e.size:m,entries:d};return m>30&&(b.__truncatedEntries=m-30),b}const c=typeof Set=="function"?Set:null;if(c&&e instanceof c){const d=[];let m=0;e.forEach(A=>{m<30&&d.push(ue(A,n+1,o)),m+=1});const b={__type:"Set",size:typeof e.size=="number"?e.size:m,values:d};return m>30&&(b.__truncatedValues=m-30),b}const u=typeof URLSearchParams=="function"?URLSearchParams:null;if(u&&e instanceof u){const d=[],g=typeof e.entries=="function"?e.entries():null;let m=0;if(g&&typeof g.next=="function"){let O=0,C=g.next();for(;!C.done;){if(O<40){const k=C.value||[];d.push({key:ue(k[0],n+1,o),value:ue(k[1],n+1,o)})}O+=1,C=g.next()}O>d.length&&(m=O-d.length)}const b={__type:"URLSearchParams",entries:d};return m>0&&(b.__truncatedEntries=m),b}if(typeof URL=="function"&&e instanceof URL)try{return e.toString()}catch{}if(n>=4){const d=e.constructor&&e.constructor.name;return d?`[${d}]`:Object.prototype.toString.call(e)}if(Array.isArray(e)){const g=[],m=Math.min(e.length,20);for(let b=0;b<m;b+=1)g.push(ue(e[b],n+1,o));return e.length>20&&g.push(`… (${e.length-20} more)`),g}const f={},l=Object.keys(e),y=30,p=Math.min(l.length,y);for(let d=0;d<p;d+=1){const g=l[d];try{f[g]=ue(e[g],n+1,o)}catch(m){f[g]=`[Threw: ${m&&m.message?m.message:"error"}]`}}if(l.length>y&&(f.__truncatedKeys=l.length-y),typeof Object.getOwnPropertySymbols=="function"){const d=Object.getOwnPropertySymbols(e),g=Math.min(d.length,5);for(let m=0;m<g;m+=1){const b=d[m],A=typeof b=="symbol"?b.toString():String(b);try{f[A]=ue(e[b],n+1,o)}catch(O){f[A]=`[Threw: ${O&&O.message?O.message:"error"}]`}}}if(!l.length){const d=e.constructor&&e.constructor.name;d&&(f.__className=d)}return f}const s=bd(e);if(s.success)return s.value;try{return Gl(e)}catch{}try{return String(e)}catch{}return null}function li(e){if(typeof e!="string")return null;const t=e.replace(/\r\n?/g,`
`).trim();if(!t)return null;const r=5e3,n=t.length>r,o=n?t.slice(0,r):t,i=t.split(`
`),s=40,a=[];let c=!1;for(let u=0;u<i.length;u+=1){const f=i[u].trim();if(f)if(a.length<s)a.push(f.length>500?`${f.slice(0,500)}…`:f);else{c=!0;break}}return{stack:o,frames:a,truncated:n||c}}function xd(e){if(!e||typeof e!="object")return null;const t=typeof e.source=="string"&&e.source?e.source:"unknown";let r=null;typeof e.stack=="string"&&e.stack&&(r=li(e.stack));const n=[];if(Array.isArray(e.frames))for(let s=0;s<e.frames.length&&n.length<40;s+=1){const a=e.frames[s];typeof a=="string"&&a?n.push(a):a!==null&&typeof a<"u"&&n.push(uo(a))}else if(r&&Array.isArray(r.frames))for(let s=0;s<r.frames.length;s+=1)n.push(r.frames[s]);const o=e.truncated===!0||(r?r.truncated===!0:!1)||n.length>0&&n.length>=40,i={source:t,truncated:o};return r&&r.stack?i.stack=r.stack:typeof e.stack=="string"&&e.stack?i.stack=e.stack:i.stack=null,n.length&&(i.frames=n),!i.stack&&(!i.frames||!i.frames.length)?null:je(i)}function Ao(){const e=Rr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{const n=r.sessionStorage;if(n&&typeof n.getItem=="function"&&typeof n.setItem=="function")return n}catch{}}return null}function Ql(){const e=Ao();if(e)try{e.removeItem(si)}catch{}}function Gd(){const e=Ao();if(e){if(!L.persistSession){try{e.removeItem(js)}catch{}return}try{e.setItem(js,JSON.stringify({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces}))}catch(t){console.warn("cineLogging: Unable to persist logging config",t)}}}function Sa(){if(!L.persistSession){Ql();return}const e=Ao();if(e)try{e.setItem(si,JSON.stringify(vt))}catch(t){if(t&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")){L.persistSession=!1;try{e.removeItem(si)}catch{}return}console.warn("cineLogging: Unable to persist log history",t)}}function wa(){const e=L.persistSession===!1?Kl:ii;return Math.max(e,Math.min($l,Math.floor(L.historyLimit)))}function Fd(e,t,r){if(!Array.isArray(e)||e.length===0)return null;Yl+=e.length;const n=vd(e),o=r&&typeof r.source=="string"&&r.source.trim()?r.source.trim():"enforce",i=e[0]||null,s=e[e.length-1]||null,a=Date.now();let c="";try{c=new Date(a).toISOString()}catch{c=String(a)}if(ae=je({count:e.length,limit:t,source:o,timestamp:a,isoTimestamp:c,oldestEntryId:i&&typeof i.id=="string"?i.id:null,oldestEntryTimestamp:i&&typeof i.timestamp=="number"?i.timestamp:null,oldestEntryIsoTimestamp:i&&typeof i.isoTimestamp=="string"?i.isoTimestamp:null,newestEntryId:s&&typeof s.id=="string"?s.id:null,newestEntryTimestamp:s&&typeof s.timestamp=="number"?s.timestamp:null,newestEntryIsoTimestamp:s&&typeof s.isoTimestamp=="string"?s.isoTimestamp:null,levels:dn(n)}),ge&&typeof ge.warn=="function")try{ge.warn("cineLogging: history trimmed to enforce retention limit",{limit:t,removed:e.length,source:o,levels:Ul(n)})}catch{}return n}function Ea(e){const t=wa();if(vt.length<=t)return 0;const r=vt.length-t,n=vt.splice(0,r);Fl($i,n,-1);const o=Fd(n,t,e);return o&&Dl(Wl,o),r}function Xl(e){return Cn(e)>=Cn(L.historyLevel)}function Zl(e){return L.consoleOutput?Cn(e)>=Cn(L.level):!1}function Oa(e){const t=Er(e,"info"),r=Zl(t),n=Xl(t);return je({level:t,enabled:r||n,console:r,history:n,thresholds:je({console:Er(L.level,ft.level),history:Er(L.historyLevel,ft.historyLevel)})})}function eu(e,t){const r=Oa(e);if(!t||typeof t!="object")return r.enabled;const n=t.console!==!1,o=t.history!==!1;return!n&&!o?!1:t.requireAll===!0?!(n&&!r.console||o&&!r.history):!!(n&&r.console||o&&r.history)}function tu(e){return`log-${e}-${Math.random().toString(36).slice(2,10)}`}function ru(e){if(e){try{vt.push(e)}catch{return}ba($i,e.level,1)}}function nu(e){ru(e),Hl+=1,Ea({source:"append"}),Sa(),Dd(e)}function Dd(e){if(!ai.size)return;const t=Array.from(ai);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Qe("cineLogging listener execution failed",o)}}}function Ud(e){const t=typeof e=="number"&&Number.isFinite(e)?Math.max(0,Math.floor(e)):vt.length;if(!t)return Object.freeze([]);const r=Math.max(0,vt.length-t),n=vt.slice(r);return Object.freeze(n.slice())}function Kd(e){if(!ci.size)return;const t=Array.from(ci);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Qe("cineLogging config listener failed",o)}}}function Aa(e){if(!e||typeof e.length!="number")return[];const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}function wr(e,t){if(!Array.isArray(e))return!1;try{return typeof Object.isExtensible=="function"&&!Object.isExtensible(e)?!1:(e.push(t),!0)}catch{}return!1}function $d(e){return e==="error"?"error":e==="warn"?"warn":e==="info"?"info":"debug"}function ou(e){if(typeof e!="string"||!e)return null;if(Object.prototype.hasOwnProperty.call(ge,e)){const t=ge[e];if(typeof t=="function")return t}if(typeof console<"u"&&console){let t=null;try{t=console[e]}catch{t=null}if(typeof t=="function"&&(!t||!t[_t]))return t}if((e==="debug"||e==="log")&&typeof ge.log=="function")return ge.log;if(e==="info"){if(typeof ge.info=="function")return ge.info;if(typeof ge.log=="function")return ge.log}if(e==="warn"){if(typeof ge.warn=="function")return ge.warn;if(typeof ge.error=="function")return ge.error}return e==="error"&&typeof ge.error=="function"?ge.error:null}function iu(e,t){const r=ou(e);if(typeof r!="function")return;const n=typeof console<"u"&&console?console:W&&W.console?W.console:null,o=Array.isArray(t)?t:Aa(t);try{return r.apply(n,o)}catch{try{return Function.prototype.apply.call(r,n,o)}catch{}}}function Vd(e,t,r){const n=$d(e),o=Array.isArray(t)?t:Aa(t),i=[];for(let d=0;d<o.length;d+=1){const g=o[d],m=typeof g;if(m==="string")wr(i,g);else if(m==="number"||m==="boolean")wr(i,String(g));else if(m==="symbol")try{wr(i,g.toString())}catch{}}let s=i.join(" ").trim();s||(s=`[console.${e||n}]`);let a=null,c=null;if(o.length)try{a=ue(o),c={arguments:a}}catch{c={arguments:o.slice()}}const u=[],f=Array.isArray(a)?a:null;for(let d=0;d<o.length;d+=1){const g=o[d],m=f?f[d]:null,b=g instanceof Error,A=m&&typeof m=="object"&&m!==null?typeof m.stack=="string"||typeof m.message=="string"||typeof m.name=="string":!1;if(!b&&!A)continue;let O=A?m:null;if(!O)try{O=ue(g)}catch{O=null}!O&&b&&(O={name:g.name||null,message:g.message||uo(g)||null},typeof g.code<"u"&&(O.code=g.code),typeof g.status<"u"&&(O.status=g.status),typeof g.stack=="string"&&g.stack&&(O.stack=g.stack));let C=O;if(C&&typeof C=="object")try{C=Gl(C)}catch{try{C=Object.assign({},C)}catch{C=O}}const k={index:d};if(C&&typeof C=="object")k.value=C,typeof C.name=="string"&&C.name&&(k.name=C.name),typeof C.message=="string"&&C.message&&(k.message=C.message),typeof C.code<"u"&&(k.code=C.code),typeof C.status<"u"&&(k.status=C.status);else if(typeof C<"u"){k.value=C;const S=uo(C);S&&(k.message=S)}else k.value=null;const _=g===null?"null":typeof g;if(_==="object"||_==="function"){const S=g&&g.constructor&&g.constructor.name;k.argumentType=typeof S=="string"&&S?S:_}else k.argumentType=_;const v=b&&typeof g.stack=="string"&&g.stack?li(g.stack):C&&typeof C=="object"&&typeof C.stack=="string"?li(C.stack):null;v&&(typeof v.stack=="string"&&(k.stack=v.stack),Array.isArray(v.frames)&&v.frames.length&&(k.frames=v.frames),v.truncated&&(k.stackTruncated=!0)),wr(u,k)}const l={channel:"console",method:e||"log"};if(r&&typeof r=="object"){const d=Object.keys(r);for(let g=0;g<d.length;g+=1){const m=d[g];try{l[m]=ue(r[m])}catch{l[m]=r[m]}}}if(u.length){c=c||{};const d=[];for(let m=0;m<u.length;m+=1){const b=u[m];d.push(b.index)}c.errors=u,c.errorCount=u.length,c.errorIndices=d,c.primaryError=u[0],l.errorCount=u.length,l.errorIndices=d;const g=u[0];g&&(typeof g.name=="string"&&g.name&&(l.primaryErrorName=g.name),typeof g.message=="string"&&g.message&&(l.primaryErrorMessage=g.message),typeof g.code<"u"&&(l.primaryErrorCode=g.code),typeof g.status<"u"&&(l.primaryErrorStatus=g.status),g.stack&&(l.primaryErrorHasStack=!0))}const y=e==="error"||u.length>0,p={namespace:"console",meta:l};return y&&(p.captureStack=!0),it(n,s,c,p,{silentConsole:!0})}function Hd(){if(gt)return!0;if(ha=!0,typeof console>"u"||!console)return xr=!0,!1;try{if(console[_t])return gt=!0,xr=!1,!0}catch{}let e=!1;for(let t=0;t<On.length;t+=1){const r=On[t];let n=ou(r);if(typeof n!="function")try{const i=console[r];typeof i=="function"&&(!i||!i[_t])&&(n=i)}catch{n=null}if((!Object.prototype.hasOwnProperty.call(ge,r)||ge[r]===null)&&(ge[r]=typeof n=="function"?n:ge[r]),typeof n!="function")continue;const o=function(){const s=Aa(arguments);Fn+=1;try{if(Fn===1){const a=s.length?s[0]:null;if(!(typeof a=="string"&&a.indexOf("cineLogging:")===0))try{Vd(r,s,{captured:!0})}catch(u){}}return iu(r,s)}finally{Fn-=1,Fn<0&&(Fn=0)}};try{Object.defineProperty(o,_t,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{o[_t]=!0}try{console[r]=o,e=!0}catch{}}if(e){gt=!0,xr=!1;try{Object.defineProperty(console,_t,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{try{console[_t]=!0}catch{}}}else xr=!0;return gt}function qd(){if(!gt)return!1;if(typeof console>"u"||!console)return gt=!1,!1;let e=!1;for(let t=0;t<On.length;t+=1){const r=On[t],n=ge[r];try{typeof n=="function"?(console[r]=n,e=!0):r!=="log"&&r!=="info"&&delete console[r]}catch{}}try{console&&console[_t]&&(typeof Object.defineProperty=="function"?Object.defineProperty(console,_t,{configurable:!0,enumerable:!1,writable:!0,value:!1}):console[_t]=!1)}catch{}return gt=!1,e}function Ca(){return L.captureConsole?Hd()?(vo=!1,Gn!=="enabled"&&(it("info","Console output capture enabled",us({status:"enabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Gn="enabled"),!0):(vo||(it("warn","Console output capture failed",us({status:"failed",reason:typeof console>"u"||!console?"console-unavailable":"installation-failed"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Qe("cineLogging: Unable to capture console output for diagnostics."),vo=!0),Gn="failed",!1):(gt&&qd(),Gn!=="disabled"&&(it("info","Console output capture disabled",us({status:"disabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Gn="disabled"),vo=!1,xr=!1,!0)}function _a(){return!!L.captureConsole&&gt===!0}function us(e){const t={configured:L.captureConsole===!0,installed:gt===!0,attempted:ha===!0,failed:xr===!0};if((typeof console>"u"||!console)&&(t.consoleAvailable=!1),e&&typeof e=="object"){const r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}}return t}function Wd(e){return ka({captureConsole:!0},(e&&typeof e=="object"?e:null)||void 0),_a()}function Yd(e){return ka({captureConsole:!1},(e&&typeof e=="object"?e:null)||void 0),_a()}function Jd(e,t,r){const n=r&&Object.prototype.hasOwnProperty.call(r,"captureStack")?r.captureStack:null;return n===!0?!0:n===!1||L.stackTraces!==!0?!1:t instanceof Error?!0:Cn(e)>=Cn("warn")}function su(e,t,r,n){if(!Jd(e,r,n))return null;let o="generated",i="";if(r instanceof Error){const c=r.stack;typeof c=="string"&&c&&(o="detail",i=c)}if(!i)try{const c=typeof t=="string"&&t?t:`Log ${e}`,u=new Error(c);typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(u,su),typeof u.stack=="string"&&u.stack&&(i=u.stack)}catch{}const s=li(i);if(!s)return null;const a={source:o,stack:s.stack,truncated:s.truncated};return Array.isArray(s.frames)&&s.frames.length&&(a.frames=s.frames),je(a)}function it(e,t,r,n,o){const i=Er(e,"info"),s=Date.now();let a="";try{a=new Date(s).toISOString()}catch{a=String(s)}const c=n&&typeof n=="object"?n:null,u=su(i,t,r,c),f=c&&typeof c.namespace=="string"&&c.namespace?n.namespace:null,l=c&&typeof c.meta<"u"?ue(c.meta):null,y=typeof r>"u"?null:ue(r),p=je({id:tu(s),level:i,message:uo(t),namespace:f,detail:y,meta:l,timestamp:s,isoTimestamp:a,origin:u});ba(ql,i,1),Xl(i)&&nu(p);const d=o&&typeof o=="object"?o:null;if(Zl(i)&&(!d||d.silentConsole!==!0)){const m=(zt[i]||zt.info).consoleMethod,b=["[cine]"];f&&b.push(`[${f}]`),b.push(p.isoTimestamp);const O=[`${b.join(" ")} ${p.message}`];r!==void 0?wr(O,r):p.detail!==null&&wr(O,p.detail),p.meta!==null&&wr(O,{meta:p.meta}),u&&wr(O,{origin:u}),iu(m,O)}return p}function au(e,t,r){return it("debug",e,t,r)}function Qd(e,t,r){return it("info",e,t,r)}function Xd(e,t,r){return it("warn",e,t,r)}function Zd(e,t,r){return it("error",e,t,r)}function fo(){return je({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces})}function ey(e){const t=e&&typeof e.limit<"u"?e.limit:void 0;return Ud(t)}function ty(){return ae?je({count:typeof ae.count=="number"?ae.count:0,limit:typeof ae.limit=="number"?ae.limit:wa(),source:typeof ae.source=="string"?ae.source:"enforce",timestamp:typeof ae.timestamp=="number"?ae.timestamp:null,isoTimestamp:typeof ae.isoTimestamp=="string"?ae.isoTimestamp:null,oldestEntryId:typeof ae.oldestEntryId=="string"?ae.oldestEntryId:null,oldestEntryTimestamp:typeof ae.oldestEntryTimestamp=="number"?ae.oldestEntryTimestamp:null,oldestEntryIsoTimestamp:typeof ae.oldestEntryIsoTimestamp=="string"?ae.oldestEntryIsoTimestamp:null,newestEntryId:typeof ae.newestEntryId=="string"?ae.newestEntryId:null,newestEntryTimestamp:typeof ae.newestEntryTimestamp=="number"?ae.newestEntryTimestamp:null,newestEntryIsoTimestamp:typeof ae.newestEntryIsoTimestamp=="string"?ae.newestEntryIsoTimestamp:null,levels:ae.levels?dn(ae.levels):dn(Tn())}):null}function cu(){return je({runtimeEntries:Hl,retainedEntries:vt.length,droppedEntries:Yl,historyLimit:wa(),lastDrop:ty(),levels:je({emitted:dn(ql),retained:dn($i),dropped:dn(Wl)}),consoleCapture:je({configured:L.captureConsole===!0,installed:gt,attempted:ha,failed:xr})})}function ry(e){return vt.length=0,Pd($i),(!e||e.persist!==!1)&&Sa(),!0}function ny(e){return typeof e!="function"?function(){return!1}:(ai.add(e),function(){return ai.delete(e),!0})}function oy(e){return typeof e!="function"?function(){return!1}:(ci.add(e),function(){return ci.delete(e),!0})}function iy(e,t){if(!e&&!t)return null;if(!e)return ue(t);if(!t)return e;if(typeof e!="object"||typeof t!="object")return ue(t);const r={},n=Object.keys(e);for(let i=0;i<n.length;i+=1){const s=n[i];r[s]=e[s]}const o=Object.keys(t);for(let i=0;i<o.length;i+=1){const s=o[i];r[s]=ue(t[s])}return r}function sy(e,t){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?ue(t.meta):null;function o(i,s,a,c){const u=iy(n,c);return it(i,s,a,{namespace:r,meta:u})}return je({namespace:r,log(i,s,a,c){return o(i,s,a,c)},debug(i,s,a){return o("debug",i,s,a)},info(i,s,a){return o("info",i,s,a)},warn(i,s,a){return o("warn",i,s,a)},error(i,s,a){return o("error",i,s,a)},getConfig:fo,isLevelEnabled(i,s){return eu(i,s)},getLevelState(i){return Oa(i)}})}function lu(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;const t=jd;try{return typeof t=="symbol"?e[t]?!0:(e[t]=!0,!1):Object.prototype.hasOwnProperty.call(e,t)&&e[t]?!0:(Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:!0}),!1)}catch{}return!1}function ay(e){if(!L.captureGlobalErrors||lu(e))return;const t={message:e&&typeof e.message=="string"?e.message:"",filename:e&&(e.filename||e.fileName)||null,lineno:e&&(e.lineno||e.lineNumber)||null,colno:e&&(e.colno||e.columnNumber)||null,error:e&&e.error?ue(e.error):null};e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),it("error","Global error captured",t,{namespace:"global"})}function cy(e){if(!L.captureGlobalErrors||lu(e))return;const t={reason:e?ue(e.reason):null};e&&e.promise&&(t.promiseState="[Promise]"),e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),it("error","Unhandled promise rejection captured",t,{namespace:"global"})}function ly(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;if(jo instanceof WeakSet)return jo.has(e)?!0:(jo.add(e),!1);const t=jo;return t.indexOf(e)!==-1?!0:(t.push(e),!1)}function uu(){if(!L.captureGlobalErrors)return;const e=Rr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r.addEventListener!="function")&&!ly(r)){try{r.addEventListener("error",ay,!0)}catch{}try{r.addEventListener("unhandledrejection",cy,!0)}catch{}}}}function Vi(e){if(!e||typeof e!="object")return{changed:!1,captureChanged:!1,limitChanged:!1};let t=!1,r=!1,n=!1,o=!1;const i=Object.prototype.hasOwnProperty.call(e,"persistSession")?Dn(e.persistSession,L.persistSession):L.persistSession;if(Object.prototype.hasOwnProperty.call(e,"level")){const s=Er(e.level,L.level);s!==L.level&&(L.level=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLevel")){const s=Er(e.historyLevel,L.historyLevel);s!==L.historyLevel&&(L.historyLevel=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLimit")){const s=Jl(e.historyLimit,{allowReducedMin:i===!1});s!==L.historyLimit&&(L.historyLimit=s,t=!0,n=!0)}if(Object.prototype.hasOwnProperty.call(e,"consoleOutput")){const s=Dn(e.consoleOutput,L.consoleOutput);s!==L.consoleOutput&&(L.consoleOutput=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"persistSession")&&i!==L.persistSession&&(L.persistSession=i,t=!0),L.persistSession&&L.historyLimit<ii&&(L.historyLimit=ii,t=!0,n=!0),Object.prototype.hasOwnProperty.call(e,"captureGlobalErrors")){const s=Dn(e.captureGlobalErrors,L.captureGlobalErrors);s!==L.captureGlobalErrors&&(L.captureGlobalErrors=s,t=!0,r=!0)}if(Object.prototype.hasOwnProperty.call(e,"captureConsole")){const s=Dn(e.captureConsole,L.captureConsole);s!==L.captureConsole&&(L.captureConsole=s,t=!0,o=!0)}if(Object.prototype.hasOwnProperty.call(e,"stackTraces")){const s=Dn(e.stackTraces,L.stackTraces);s!==L.stackTraces&&(L.stackTraces=s,t=!0)}return{changed:t,captureChanged:r,limitChanged:n,consoleCaptureChanged:o}}function ka(e,t){const r=L.captureGlobalErrors,n=L.captureConsole,o=Vi(e);return o.limitChanged&&Ea({source:"config"}),o.changed&&(!t||t.persist!==!1)&&(Gd(),Sa()),L.persistSession||Ql(),!r&&L.captureGlobalErrors&&uu(),(o.consoleCaptureChanged||n!==L.captureConsole)&&Ca(),o.changed&&Kd(fo()),fo()}function uy(){const e=Rr(W),t=["__cineLoggingConfig","__CINE_LOGGING_CONFIG","cineLoggingConfig"];for(let r=0;r<e.length;r+=1){const n=e[r];if(!(!n||typeof n!="object"&&typeof n!="function"))for(let o=0;o<t.length;o+=1){const i=t[o];let s;try{s=n[i]}catch{s=null}if(s&&typeof s=="object")return s}}return null}function fy(){const e=Ao();if(!e)return;let t="";try{t=e.getItem(js)||""}catch{return}if(t)try{const r=JSON.parse(t);Vi(r)}catch(r){Qe("cineLogging: Unable to restore logging config from storage",r)}}function py(){if(!W||!W.location)return;let e="";try{e=W.location.search||""}catch{return}if(typeof e!="string"||!e)return;let t=null;if(typeof URLSearchParams=="function")try{t=new URLSearchParams(e)}catch{}const r={};let n=!1;function o(i,s){r[i]=s,n=!0}if(t)t.has("cineLogLevel")&&o("level",t.get("cineLogLevel")),t.has("cineLogHistoryLevel")&&o("historyLevel",t.get("cineLogHistoryLevel")),t.has("cineLogLimit")&&o("historyLimit",t.get("cineLogLimit")),t.has("cineLogConsole")&&o("consoleOutput",t.get("cineLogConsole")),t.has("cineLogPersist")&&o("persistSession",t.get("cineLogPersist")),t.has("cineLogCapture")&&o("captureGlobalErrors",t.get("cineLogCapture")),t.has("cineLogConsoleCapture")&&o("captureConsole",t.get("cineLogConsoleCapture")),t.has("cineLogStackTraces")&&o("stackTraces",t.get("cineLogStackTraces"));else{const s=(e.charAt(0)==="?"?e.slice(1):e).split("&");for(let a=0;a<s.length;a+=1){const c=s[a];if(!c)continue;const u=c.indexOf("="),f=decodeURIComponent(u===-1?c:c.slice(0,u)),l=u===-1?"":decodeURIComponent(c.slice(u+1));f==="cineLogLevel"?o("level",l):f==="cineLogHistoryLevel"?o("historyLevel",l):f==="cineLogLimit"?o("historyLimit",l):f==="cineLogConsole"?o("consoleOutput",l):f==="cineLogPersist"?o("persistSession",l):f==="cineLogCapture"?o("captureGlobalErrors",l):f==="cineLogConsoleCapture"?o("captureConsole",l):f==="cineLogStackTraces"&&o("stackTraces",l)}}n&&Vi(r)}function fu(e){if(!e||typeof e!="object")return null;const t=Er(e.level,"info"),r=typeof e.timestamp=="number"&&Number.isFinite(e.timestamp)?e.timestamp:Date.now();let n="";if(typeof e.isoTimestamp=="string"&&e.isoTimestamp)n=e.isoTimestamp;else try{n=new Date(r).toISOString()}catch{n=String(r)}const o=typeof e.message=="string"?e.message:uo(e.message),i=typeof e.namespace=="string"&&e.namespace?e.namespace:null,s=typeof e.id=="string"&&e.id?e.id:tu(r);return je({id:s,level:t,message:o,namespace:i,detail:typeof e.detail>"u"?null:ue(e.detail),meta:typeof e.meta>"u"?null:ue(e.meta),timestamp:r,isoTimestamp:n,origin:typeof e.origin>"u"?null:xd(e.origin)})}function dy(){return W&&typeof W.navigator=="object"&&W.navigator?W.navigator:typeof navigator<"u"&&navigator?navigator:typeof globalThis<"u"&&globalThis&&typeof globalThis.navigator=="object"?globalThis.navigator:null}function pu(){const e=dy();return!e||typeof e!="object"||!e.serviceWorker?null:e.serviceWorker}function yy(e){return e?U.seenIds?U.seenIds.has(e)?!1:(U.seenIds.add(e),!0):Array.isArray(U.fallbackSeenIds)?U.fallbackSeenIds.indexOf(e)!==-1?!1:(U.fallbackSeenIds.push(e),!0):!0:!0}function gy(e,t){const r={};if(e&&typeof e.meta<"u")if(e.meta&&typeof e.meta=="object")for(const o in e.meta)Object.prototype.hasOwnProperty.call(e.meta,o)&&(r[o]=e.meta[o]);else r.value=e.meta;const n=e&&typeof e.channel=="string"&&e.channel?e.channel:r.channel;return n?r.channel=n:r.channel="service-worker",t&&typeof t=="object"&&(t.cacheName&&!r.cacheName&&(r.cacheName=t.cacheName),t.cacheVersion&&!r.cacheVersion&&(r.cacheVersion=t.cacheVersion),typeof t.generatedAt=="number"&&Number.isFinite(t.generatedAt)&&(r.snapshotTimestamp||(r.snapshotTimestamp=t.generatedAt)),typeof t.historyLength=="number"&&Number.isFinite(t.historyLength)&&(r.snapshotSize||(r.snapshotSize=t.historyLength))),r}function Oc(e,t){if(!(!Array.isArray(e)||!e.length))for(let r=0;r<e.length;r+=1){const n=e[r];if(!n||typeof n!="object")continue;const o=typeof n.id=="string"&&n.id?n.id:null;if(!yy(o))continue;const i=n.origin&&typeof n.origin=="object"?n.origin:{runtime:"service-worker"},s=fu({id:o||void 0,level:n.level,message:n.message,namespace:typeof n.namespace=="string"&&n.namespace?n.namespace:"service-worker",detail:typeof n.detail>"u"?null:n.detail,meta:gy(n,t),timestamp:n.timestamp,isoTimestamp:n.isoTimestamp,origin:i});s&&nu(s)}}function Ko(e){if(U.requestInFlight&&!(e&&U.lastRequestId&&e!==U.lastRequestId)){if(U.requestInFlight=!1,U.lastRequestId=null,U.requestTimer&&typeof clearTimeout=="function")try{clearTimeout(U.requestTimer)}catch{}U.requestTimer=null}}function Dr(){if(!(U.broadcastChannel||U.broadcastFailed)&&!(U.pollTimer||typeof setTimeout!="function"))try{U.pollTimer=setTimeout(()=>{U.pollTimer=null,du("poll")},zd)}catch{}}function my(){if(U.broadcastFailed)return null;if(U.broadcastChannel)return U.broadcastChannel;if(typeof BroadcastChannel!="function")return U.broadcastFailed=!0,null;try{const e=new BroadcastChannel(Rd);if(e.addEventListener("message",ui),U.broadcastChannel=e,U.pollTimer&&typeof clearTimeout=="function"){try{clearTimeout(U.pollTimer)}catch(t){}U.pollTimer=null}return e}catch(e){return U.broadcastFailed=!0,Qe("cineLogging: Unable to open service worker diagnostics channel",e),null}}function ui(e){if(!e)return;let t=null;try{t=e.data||null}catch{t=null}if(!(!t||typeof t!="object")){if(t.type===Td){Oc([t.entry],U.lastSnapshotMeta),Dr();return}if(t.type===Md){Ko(t.requestId||null);const r=t.state&&typeof t.state=="object"?t.state:null;if(!r){Dr();return}U.lastSnapshotMeta={cacheName:typeof r.cacheName=="string"&&r.cacheName?r.cacheName:null,cacheVersion:r.cacheVersion||null,generatedAt:typeof r.generatedAt=="number"&&Number.isFinite(r.generatedAt)?r.generatedAt:Date.now(),historyLength:typeof r.historyLength=="number"&&Number.isFinite(r.historyLength)?r.historyLength:null},Oc(r.history,U.lastSnapshotMeta),Dr()}}}function du(e){if(U.requestInFlight)return;const t=pu();if(!t)return;U.supported=!0;const r=`sw-log-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;U.requestInFlight=!0,U.lastRequestId=r;const n={type:Nd,limit:Bd,reason:typeof e=="string"&&e?e:"sync",requestId:r},o=s=>{if(s){try{s.port1.onmessage=null}catch{}if(typeof s.port1.onmessageerror<"u")try{s.port1.onmessageerror=null}catch{}try{s.port1.close()}catch{}try{s.port2.close()}catch{}}},i=t.ready&&typeof t.ready.then=="function"?t.ready.then(s=>s&&s.active||t.controller||null):Promise.resolve(t.controller||null);Promise.resolve(i).then(s=>{const a=t.controller||null,c=s||a;if(!c||typeof c.postMessage!="function"){Ko(r),Dr();return}let u=!1,f=null;const l=()=>{u||(u=!0,o(f),Ko(r))},y=()=>{l(),Dr()},p=b=>{l(),ui(b)},d=()=>{Qe("cineLogging: Service worker diagnostics channel closed before a response was received",{requestId:r}),y()},g=()=>{try{c.postMessage(n)}catch(b){Qe("cineLogging: Unable to post service worker diagnostics request",b),y();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{u||y()},Ec)}catch{}};if(!(typeof MessageChannel!="function"||!a?!1:c===a)){g();return}if(f=new MessageChannel,f.port1.onmessage=p,typeof f.port1.onmessageerror<"u"&&(f.port1.onmessageerror=d),typeof f.port1.start=="function")try{f.port1.start()}catch{}try{c.postMessage(n,[f.port2])}catch(b){o(f),f=null,Qe("cineLogging: Unable to request service worker diagnostics",b),g();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{u||d()},Ec)}catch{}}).catch(s=>{Ko(r),Qe("cineLogging: Unable to await service worker for diagnostics",s),Dr()})}function hy(){if(U.initialised)return;U.initialised=!0;const e=pu();if(e){if(U.supported=!0,my(),typeof e.addEventListener=="function")try{e.addEventListener("message",ui)}catch(t){Qe("cineLogging: Unable to attach service worker diagnostics listener",t)}else if(typeof e.onmessage>"u")try{e.onmessage=ui}catch{}du("initial-sync"),U.broadcastChannel||Dr()}}function by(){if(!L.persistSession)return;const e=Ao();if(!e)return;let t="";try{t=e.getItem(si)||""}catch{return}if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;for(let n=0;n<r.length;n+=1){const o=fu(r[n]);o&&ru(o)}Ea({source:"restore"})}catch(r){Qe("cineLogging: Unable to restore log history from storage",r)}}function Sy(){L=Vl();const e=uy();e&&Vi(e),fy(),py()}Sy();by();hy();Ca();L.captureGlobalErrors&&uu();au("cineLogging initialized",{config:fo(),stats:cu()},{namespace:"logging",meta:{lifecycle:"init"}});const Hi=je({log:it,debug:au,info:Qd,warn:Xd,error:Zd,createLogger:sy,getHistory:ey,getStats:cu,clearHistory:ry,getConfig:fo,setConfig:ka,getLevelState:Oa,isLevelEnabled:eu,subscribe:ny,subscribeConfig:oy,enableConsoleCapture:Wd,disableConsoleCapture:Yd,syncConsoleCapture:Ca,isConsoleCaptureActive:_a,constants:je({LOG_LEVELS:kd,DEFAULT_CONFIG:Ld})});_d("cineLogging",Hi);const yu={category:"diagnostics",description:"Structured logging utilities for debugging and diagnostics.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},wy=Ed("cineLogging",Hi,yu,function(e){Qe("Unable to register cineLogging module.",e)},W,Uo);wy||wd("cineLogging",Hi,yu,W);Cd("cineLogging",Hi,{configurable:!0,enumerable:!1,writable:!1})||Qe("Unable to expose cineLogging globally.");const Gr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;function fi(e){const t=(Gr&&typeof Gr=="object"?Gr:null)||(typeof globalThis<"u"?globalThis:null);if(!t)return null;let r,n=null;try{r=t.console,n=Object.getOwnPropertyDescriptor(t,"console")}catch{r=typeof console<"u"?console:null}if(!r||typeof r!="object")return null;let o=[];Array.isArray(e)?o=e:typeof e=="string"&&e?o=[e]:o=["warn","info"];const i=Object.create(null);for(let u=0;u<o.length;u+=1){const f=o[u];typeof f=="string"&&f&&(i[f]=!0)}const s=Object.keys(i);if(!s.length)return r;const a=Object.create(null);for(let u=0;u<s.length;u+=1){const f=s[u];let l=r[f];try{const y=Object.getOwnPropertyDescriptor(r,f);y&&Object.prototype.hasOwnProperty.call(y,"value")&&(l=y.value)}catch{}if(typeof l=="function")try{a[f]=l.bind(r)}catch{a[f]=l}else a[f]=l}const c=new Proxy(r,{get(u,f,l){return Object.prototype.hasOwnProperty.call(a,f)?a[f]:Reflect.get(u,f,l)},set(u,f,l,y){if(Object.prototype.hasOwnProperty.call(a,f))return a[f]=l,!0;try{return Reflect.set(u,f,l,y),!0}catch{}return!1},defineProperty(u,f,l){return Object.prototype.hasOwnProperty.call(a,f)?(l&&Object.prototype.hasOwnProperty.call(l,"value")&&(a[f]=l.value),!0):Reflect.defineProperty(u,f,l)},getOwnPropertyDescriptor(u,f){return Object.prototype.hasOwnProperty.call(a,f)?{configurable:!0,enumerable:!0,writable:!0,value:a[f]}:Reflect.getOwnPropertyDescriptor(u,f)},ownKeys(u){const f=Reflect.ownKeys(u);for(let l=0;l<s.length;l+=1)f.indexOf(s[l])===-1&&f.push(s[l]);return f}});try{Object.defineProperty(t,"console",{configurable:!0,enumerable:n?n.enumerable!==!1:!0,writable:!0,value:c})}catch{t.console=c}return c}if(Gr&&typeof Gr=="object")try{typeof Gr.__cineEnsureConsoleMethodsWritable!="function"&&(Gr.__cineEnsureConsoleMethodsWritable=fi)}catch{}const Ey=Object.freeze(Object.defineProperty({__proto__:null,ensureConsoleMethodsWritable:fi},Symbol.toStringTag,{value:"Module"}));function Oy(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Zt=Oy();function Ay(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const Se=Ay(Zt),Cy=Se&&typeof Se.freezeDeep=="function"?Se.freezeDeep:function(t){return t},gu=e=>{try{return Cy(e)}catch{return e}};function Ac(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return e&&r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}const _y=Se&&typeof Se.collectCandidateScopes=="function"?function(t){try{const r=Se.collectCandidateScopes(t,Zt);if(Array.isArray(r)&&r.length)return r}catch{}return Ac(t||Zt)}:Ac;function ky(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Ls=Se&&typeof Se.safeWarn=="function"?Se.safeWarn:ky;function Py(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=null;try{t=e.cineLogging||null}catch{t=null}return t&&typeof t=="object"?t:null}function mu(e={}){const t=e.baseScope||Zt;e.allowRequire;const r=_y(t);for(let n=0;n<r.length;n+=1){const o=Py(r[n]);if(o)return o}return null}function mr(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const o=[];t.set(e,o);for(let i=0;i<e.length;i+=1)o[i]=mr(e[i],t);return o}const r={};t.set(e,r);const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=mr(e[i],t)}return r}function Iy(e,t){if(!e&&!t)return null;if(!e)return mr(t);if(!t)return mr(e);if(typeof e!="object"||typeof t!="object")return mr(t);const r=mr(e),n=Object.keys(t);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=mr(t[i])}return r}function vy(e){if(typeof console>"u"||!console)return null;const t=typeof e=="string"?e.toLowerCase():"";return t==="error"&&typeof console.error=="function"?console.error.bind(console):t==="warn"&&typeof console.warn=="function"?console.warn.bind(console):t==="info"&&typeof console.info=="function"?console.info.bind(console):t==="debug"&&typeof console.debug=="function"?console.debug.bind(console):typeof console.log=="function"?console.log.bind(console):null}let Cc=!1;function hu(e,t={}){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?mr(t.meta):null;function o(s,a,c,u){const f=vy(s);if(!f)return null;const l=["[cine-fallback]"];r&&l.push(`[${r}]`);const y=new Date;try{l.push(y.toISOString())}catch{l.push(String(y.getTime()))}const g=[`${l.join(" ")} ${typeof a=="string"&&a?a:"Log entry"}`];typeof c<"u"&&g.push(c);const m=Iy(n,u);m&&g.push({meta:m,source:"console-fallback"});try{f(...g)}catch{}if(!Cc&&typeof console<"u"&&typeof console.warn=="function"){Cc=!0;try{console.warn("[cine-fallback] Structured logging unavailable, using console logger.")}catch{}}return null}return gu({namespace:r,log(s,a,c,u){return o(s,a,c,u)},debug(s,a,c){return o("debug",s,a,c)},info(s,a,c){return o("info",s,a,c)},warn(s,a,c){return o("warn",s,a,c)},error(s,a,c){return o("error",s,a,c)},getConfig(){return null},isLevelEnabled(){return!0},getLevelState(s){return{level:typeof s=="string"&&s?s:"all",enabled:!0,source:"console-fallback"}},__cineLoggingFallback:!0})}function jy(e,t={}){const r=mu(t),n=t&&typeof t.meta<"u"?t.meta:void 0;if(r&&typeof r.createLogger=="function")try{const o=r.createLogger(e,typeof n<"u"?{meta:n}:void 0);if(o)return o}catch(o){Ls("cineLoggingResolver: createLogger failed, falling back to console.",o)}return t.allowConsoleFallback===!1?null:hu(e,{meta:n})}const Ur=gu({resolveLogging:mu,resolveLogger:jy,createConsoleFallbackLogger:hu}),Ly=Se&&typeof Se.resolveModuleRegistry=="function"?Se.resolveModuleRegistry(Zt):null;if(Se&&typeof Se.registerOrQueueModule=="function"&&!Se.registerOrQueueModule("cineLoggingResolver",Ur,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0,connections:["cineLogging","cineModuleBase","cineEnvironmentBridge"]},t=>{Ls("Unable to register cineLoggingResolver module.",t)},Zt,Ly)&&typeof Se.queueModuleRegistration=="function")try{Se.queueModuleRegistration("cineLoggingResolver",Ur,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0},Zt)}catch(t){Ls("Unable to queue cineLoggingResolver registration.",t)}if(Se&&typeof Se.exposeGlobal=="function")Se.exposeGlobal("cineLoggingResolver",Ur,Zt,{configurable:!0,enumerable:!1,writable:!1});else try{Zt.cineLoggingResolver=Ur}catch{}function Ry(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Or=Ry(),yt=typeof cineModuleBase=="object"&&cineModuleBase||(Or&&typeof Or.cineModuleBase=="object"?Or.cineModuleBase:null),_r=yt&&typeof yt.safeWarn=="function"?yt.safeWarn:function(t,r){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof r>"u"?console.warn(t):console.warn(t,r)}catch{}},Pa="cameraPowerPlanner_contacts";function bu(e){const t=e||Or;try{if(t&&typeof t.localStorage<"u")return t.localStorage}catch(r){_r("cine.features.contacts could not access localStorage.",r)}return null}function Su(){return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function Ut(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return Ut(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function wu(e){if(!e||typeof e!="object")return null;const t=Ut(e.id)||Su(),r=Ut(e.name),n=Ut(e.role),o=Ut(e.phone),i=Ut(e.email),s=Ut(e.website||e.url),a=Ut(e.notes||e.note||e.text),c=typeof e.avatar=="string"&&e.avatar.startsWith("data:")?e.avatar:"",u=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),f=Number.isFinite(e.updatedAt)?e.updatedAt:u,l={id:t,name:r,role:n,phone:o,email:i,website:s,notes:a,createdAt:u,updatedAt:f};return c&&(l.avatar=c),l}function Eu(e){return(Array.isArray(e)?e.filter(Boolean):[]).map(wu).filter(Boolean).sort((t,r)=>{const n=(t&&t.name?t.name:"").toLowerCase(),o=(r&&r.name?r.name:"").toLowerCase();if(n&&o&&n!==o)try{return n.localeCompare(o)}catch(i){_r("cine.features.contacts could not sort contacts by locale.",i)}return n&&!o?-1:!n&&o?1:(t&&t.createdAt?t.createdAt:0)-(r&&r.createdAt?r.createdAt:0)})}function Ty(e={}){const t=bu(e.scope);if(!t||typeof t.getItem!="function")return[];const r=typeof e.storageKey=="string"&&e.storageKey?e.storageKey:Pa;try{const n=t.getItem(r);if(!n)return[];const o=JSON.parse(n);return Array.isArray(o)?Eu(o):[]}catch(n){return _r("cine.features.contacts could not load contacts from storage.",n),[]}}function Ny(e,t={}){const r=bu(t.scope);if(!r||typeof r.setItem!="function")return!1;const n=typeof t.storageKey=="string"&&t.storageKey?t.storageKey:Pa;try{return r.setItem(n,JSON.stringify(Array.isArray(e)?e:[])),!0}catch(o){return _r("cine.features.contacts could not save contacts to storage.",o),!1}}const _n=Object.freeze({CONTACTS_STORAGE_KEY:Pa,generateContactId:Su,sanitizeContactValue:Ut,normalizeContactEntry:wu,sortContacts:Eu,loadStoredContacts:Ty,saveContactsToStorage:Ny});if(yt&&typeof yt.registerOrQueueModule=="function")try{yt.registerOrQueueModule("cine.features.contacts",_n,{category:"features",description:"Shared helpers for contacts management.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cinePersistence"]},e=>_r("Unable to register cine.features.contacts module.",e),Or,yt.getModuleRegistry&&yt.getModuleRegistry(Or))}catch(e){_r("cine.features.contacts registration failed.",e)}let Ou=!1;if(yt&&typeof yt.exposeGlobal=="function")try{yt.exposeGlobal("cineFeaturesContacts",_n,Or,{configurable:!0,enumerable:!1,writable:!1}),Ou=!0}catch(e){_r("cine.features.contacts could not expose global api.",e)}if(!Ou)try{Or.cineFeaturesContacts=_n}catch(e){_r("cine.features.contacts could not assign global api.",e)}const sb=Object.freeze(Object.defineProperty({__proto__:null,default:_n},Symbol.toStringTag,{value:"Module"}));class Au{async init(){throw new Error('Method "init()" must be implemented.')}async getItem(t){throw new Error('Method "getItem()" must be implemented.')}async setItem(t,r){throw new Error('Method "setItem()" must be implemented.')}async removeItem(t){throw new Error('Method "removeItem()" must be implemented.')}async clear(){throw new Error('Method "clear()" must be implemented.')}async getKeys(){throw new Error('Method "getKeys()" must be implemented.')}}class Cu extends Au{constructor(){super(),this.storage=window.localStorage}async init(){if(!this.storage)throw new Error("LocalStorage is not supported in this environment.");return Promise.resolve()}async getItem(t){try{const r=this.storage.getItem(t);if(r===null)return null;try{return JSON.parse(r)}catch{return r}}catch(r){return console.warn(`[LocalStorageAdapter] Failed to get item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r);this.storage.setItem(t,n)}catch(n){throw console.error(`[LocalStorageAdapter] Failed to save item: ${t}`,n),n}}async removeItem(t){try{this.storage.removeItem(t)}catch(r){console.warn(`[LocalStorageAdapter] Failed to remove item: ${t}`,r)}}async clear(){try{this.storage.clear()}catch(t){console.warn("[LocalStorageAdapter] Failed to clear storage",t)}}async getKeys(){return Object.keys(this.storage)}}class _u{constructor(){this.userId=null,this.deviceId=null,this.sessionId=null,this.storageKey="cine_user_uuid",this.deviceStorageKey="cine_device_uuid"}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})}init(){if(this.userId&&this.deviceId&&this.sessionId)return this.userId;let t=localStorage.getItem(this.storageKey);t?console.log("[UserContext] Loaded User UUID:",t):(t=this.generateUUID(),localStorage.setItem(this.storageKey,t),console.log("[UserContext] Generated new User UUID:",t)),this.userId=t;let r=localStorage.getItem(this.deviceStorageKey);return r||(r=this.generateUUID(),localStorage.setItem(this.deviceStorageKey,r),console.log("[UserContext] Generated new Device UUID:",r)),this.deviceId=r,this.sessionId=this.generateUUID(),console.log("[UserContext] Session UUID:",this.sessionId),t}getUserId(){return this.userId?this.userId:this.init()}getDeviceId(){return this.deviceId||this.init(),this.deviceId}getSessionId(){return this.sessionId||this.init(),this.sessionId}getScopedKey(t){return`user_${this.getUserId()}_${t}`}getIdentity(){return{userId:this.getUserId(),deviceId:this.getDeviceId(),sessionId:this.getSessionId()}}reset(){localStorage.removeItem(this.storageKey),this.userId=null,this.sessionId=null}}const ze=new _u,My=Object.freeze(Object.defineProperty({__proto__:null,UserContext:_u,userContext:ze},Symbol.toStringTag,{value:"Module"})),ku=1,Qr=Object.freeze({SYNCED:"synced",PENDING:"pending",CONFLICT:"conflict",SYNCING:"syncing",LOCAL_ONLY:"local_only"}),De=Object.freeze({UNLOCKED:"unlocked",LOCKED_BY_SELF:"locked_by_self",LOCKED_BY_OTHER_TAB:"locked_by_other_tab",LOCKED_BY_OTHER_DEVICE:"locked_by_other_device"});function Ia(){return new Date().toISOString()}function zy(e="doc"){const t=Date.now().toString(36),r=Math.random().toString(36).substring(2,10);return`${e}_${t}_${r}`}function Pu(e={}){const t=ze.getIdentity(),r=Ia();return{version:ku,docId:e.docId||zy(e.docType||"doc"),docType:e.docType||"unknown",ownerId:t.userId,createdAt:r,updatedAt:r,syncStatus:Qr.LOCAL_ONLY,syncedAt:null,syncError:null,changeCount:1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId,lock:null,sharedWith:[],permissions:{}}}function By(e){if(!e||typeof e!="object")return Pu();const t=ze.getIdentity(),r=Ia();return{...e,version:ku,updatedAt:r,syncStatus:e.syncStatus===Qr.SYNCED?Qr.PENDING:e.syncStatus,changeCount:(e.changeCount||0)+1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId}}function xy(e,t=null){return!e||typeof e!="object"?(console.warn("[SyncMetadata] Cannot mark null metadata as synced"),e):{...e,syncStatus:Qr.SYNCED,syncedAt:t||Ia(),syncError:null}}function Gy(e,t){return!e||typeof e!="object"?e:{...e,syncStatus:Qr.CONFLICT,syncError:t}}function Fy(e,t=null,r={}){return{_meta:t?By(t):Pu(r),data:e}}function Dy(e){return!e||typeof e!="object"?{data:e,meta:null}:e._meta&&"data"in e?{data:e.data,meta:e._meta}:{data:e,meta:null}}function fs(e){return e&&typeof e=="object"&&"_meta"in e&&"data"in e}const Uy="cine-project-locks",Ky=5e3,$y=3e4,ps="cine_project_lock_",lr=Object.freeze({LOCK_ACQUIRED:"lock_acquired",LOCK_RELEASED:"lock_released",LOCK_HEARTBEAT:"lock_heartbeat",LOCK_TAKEOVER:"lock_takeover",LOCK_QUERY:"lock_query",LOCK_STATUS:"lock_status"});class Vy{constructor(){this.channel=null,this.localLocks=new Map,this.heartbeatIntervals=new Map,this.lockChangeListeners=new Set,this.initialized=!1}init(){if(!this.initialized){if(ze.init(),typeof BroadcastChannel<"u")try{this.channel=new BroadcastChannel(Uy),this.channel.onmessage=t=>this._handleChannelMessage(t),console.log("[ProjectLockService] BroadcastChannel initialized")}catch(t){console.warn("[ProjectLockService] BroadcastChannel not available:",t)}this._restoreLocksFromStorage(),typeof window<"u"&&(window.addEventListener("beforeunload",()=>this._handlePageUnload()),window.addEventListener("pagehide",()=>this._handlePageUnload())),this.initialized=!0,console.log("[ProjectLockService] Initialized")}}async acquireLock(t,r={}){this.init();const n=this._getStoredLock(t),o=this._getLockStatusForLock(n);if(o===De.LOCKED_BY_SELF)return{success:!0,status:o,lock:n};if(o!==De.UNLOCKED&&!r.force)return{success:!1,status:o,lock:n};r.force&&n&&this._broadcastTakeover(t,n);const i=this._createLockObject(t);return this._storeLock(t,i),this.localLocks.set(t,i),this._startHeartbeat(t),this._broadcastLockAcquired(t,i),this._notifyListeners(t,De.LOCKED_BY_SELF,i),console.log("[ProjectLockService] Lock acquired:",t),{success:!0,status:De.LOCKED_BY_SELF,lock:i}}async releaseLock(t){this.init();const r=this._getStoredLock(t);return this._getLockStatusForLock(r)!==De.LOCKED_BY_SELF?(console.warn("[ProjectLockService] Cannot release lock not owned by this session"),!1):(this._stopHeartbeat(t),this._clearStoredLock(t),this.localLocks.delete(t),this._broadcastLockReleased(t),this._notifyListeners(t,De.UNLOCKED,null),console.log("[ProjectLockService] Lock released:",t),!0)}getLockInfo(t){this.init();const r=this._getStoredLock(t),n=this._getLockStatusForLock(r);return{status:n,lock:r,isEditable:n===De.UNLOCKED||n===De.LOCKED_BY_SELF}}subscribe(t){return this.lockChangeListeners.add(t),()=>this.lockChangeListeners.delete(t)}refreshHeartbeat(t){const r=this.localLocks.get(t);if(!r)return;const n=ze.getIdentity();if(r.sessionId!==n.sessionId){this._stopHeartbeat(t);return}r.heartbeat=new Date().toISOString(),this._storeLock(t,r),this._broadcastHeartbeat(t,r)}_createLockObject(t){const r=ze.getIdentity(),n=new Date().toISOString();return{projectId:t,userId:r.userId,deviceId:r.deviceId,sessionId:r.sessionId,acquiredAt:n,heartbeat:n}}_getStorageKey(t){return ps+t}_storeLock(t,r){try{localStorage.setItem(this._getStorageKey(t),JSON.stringify(r))}catch(n){console.warn("[ProjectLockService] Failed to store lock:",n)}}_getStoredLock(t){try{const r=localStorage.getItem(this._getStorageKey(t));if(!r)return null;const n=JSON.parse(r);return this._isLockExpired(n)?(this._clearStoredLock(t),null):n}catch(r){return console.warn("[ProjectLockService] Failed to read lock:",r),null}}_clearStoredLock(t){try{localStorage.removeItem(this._getStorageKey(t))}catch(r){console.warn("[ProjectLockService] Failed to clear lock:",r)}}_isLockExpired(t){return!t||!t.heartbeat?!0:Date.now()-new Date(t.heartbeat).getTime()>$y}_getLockStatusForLock(t){if(!t||this._isLockExpired(t))return De.UNLOCKED;const r=ze.getIdentity();return t.sessionId===r.sessionId?De.LOCKED_BY_SELF:t.deviceId===r.deviceId?De.LOCKED_BY_OTHER_TAB:De.LOCKED_BY_OTHER_DEVICE}_startHeartbeat(t){this._stopHeartbeat(t);const r=setInterval(()=>{this.refreshHeartbeat(t)},Ky);this.heartbeatIntervals.set(t,r)}_stopHeartbeat(t){const r=this.heartbeatIntervals.get(t);r&&(clearInterval(r),this.heartbeatIntervals.delete(t))}_restoreLocksFromStorage(){const t=ze.getIdentity();try{for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(!n||!n.startsWith(ps))continue;const o=n.slice(ps.length),i=this._getStoredLock(o);i&&i.sessionId===t.sessionId&&(this.localLocks.set(o,i),this._startHeartbeat(o),console.log("[ProjectLockService] Restored lock:",o))}}catch(r){console.warn("[ProjectLockService] Failed to restore locks:",r)}}_handlePageUnload(){for(const t of this.localLocks.keys())this._stopHeartbeat(t),this._clearStoredLock(t),this._broadcastLockReleased(t);this.localLocks.clear()}_notifyListeners(t,r,n){for(const o of this.lockChangeListeners)try{o(t,r,n)}catch(i){console.warn("[ProjectLockService] Listener error:",i)}}_broadcast(t,r){if(this.channel)try{this.channel.postMessage({type:t,...r})}catch(n){console.warn("[ProjectLockService] Broadcast failed:",n)}}_broadcastLockAcquired(t,r){this._broadcast(lr.LOCK_ACQUIRED,{projectId:t,lock:r})}_broadcastLockReleased(t){this._broadcast(lr.LOCK_RELEASED,{projectId:t})}_broadcastHeartbeat(t,r){this._broadcast(lr.LOCK_HEARTBEAT,{projectId:t,lock:r})}_broadcastTakeover(t,r){this._broadcast(lr.LOCK_TAKEOVER,{projectId:t,oldLock:r})}_handleChannelMessage(t){const{type:r,projectId:n,lock:o,oldLock:i}=t.data||{};if(!n)return;const s=ze.getIdentity();switch(r){case lr.LOCK_ACQUIRED:o&&o.sessionId!==s.sessionId&&this._notifyListeners(n,this._getLockStatusForLock(o),o);break;case lr.LOCK_RELEASED:this._notifyListeners(n,De.UNLOCKED,null);break;case lr.LOCK_TAKEOVER:i&&i.sessionId===s.sessionId&&(console.warn("[ProjectLockService] Lock taken over by another tab:",n),this._stopHeartbeat(n),this.localLocks.delete(n),this._notifyListeners(n,De.LOCKED_BY_OTHER_TAB,null));break;case lr.LOCK_HEARTBEAT:o&&o.sessionId!==s.sessionId&&this._storeLock(n,o);break}}destroy(){for(const t of this.heartbeatIntervals.keys())this._stopHeartbeat(t);this.channel&&(this.channel.close(),this.channel=null),this.localLocks.clear(),this.lockChangeListeners.clear(),this.initialized=!1}}const tn=new Vy;class Hy{constructor(){this.driver=new Cu,this.initialized=!1}async init(){this.initialized||(await this.driver.init(),console.log("[StorageRepository] Initialized with default driver:",this.driver.constructor.name),this.initialized=!0,tn.init())}async switchDriver(t){console.log("[StorageRepository] Switching driver to:",t.constructor.name),await t.init(),this.driver=t}async getItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.getItem(r)}async setItem(t,r){this.initialized||await this.init();const n=ze.getScopedKey(t);return this.driver.setItem(n,r)}async removeItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.removeItem(r)}async clear(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`,n=t.filter(o=>o.startsWith(r)).map(o=>this.driver.removeItem(o));await Promise.all(n)}async getKeys(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`;return t.filter(n=>n.startsWith(r)).map(n=>n.slice(r.length))}async loadProject(t){const r=await this.getItem(t);return Dy(r)}async loadProjectRaw(t){return(await this.loadProject(t)).data}async saveProject(t,r,n=null){this.initialized||await this.init();const o=tn.getLockInfo(t);if(!o.isEditable)return console.warn("[StorageRepository] Cannot save - project is locked by another session"),{success:!1,error:"PROJECT_LOCKED",lockInfo:o};const i=Fy(r,n,{docType:"project",docId:t});return await this.setItem(t,i),fl(async()=>{const{dataVault:s}=await Promise.resolve().then(()=>Yy);return{dataVault:s}},void 0).then(({dataVault:s})=>{s&&s.saveSnapshot(t,i).catch(a=>console.warn("Auto-backup failed",a))}),console.log("[StorageRepository] Project saved with metadata:",t),{success:!0,meta:i._meta}}async getProjectMeta(t){const r=await this.getItem(t);return fs(r)?r._meta:null}async markProjectSynced(t,r=null){const n=await this.getItem(t);return fs(n)?(n._meta=xy(n._meta,r),await this.setItem(t,n),!0):(console.warn("[StorageRepository] Cannot mark as synced - no metadata"),!1)}async markProjectConflict(t,r){const n=await this.getItem(t);return fs(n)?(n._meta=Gy(n._meta,r),await this.setItem(t,n),!0):!1}async getPendingSyncProjects(){const t=await this.getKeys(),r=[];for(const n of t){const o=await this.getProjectMeta(n);o&&(o.syncStatus===Qr.PENDING||o.syncStatus===Qr.LOCAL_ONLY)&&r.push({key:n,meta:o})}return r}async listProjects(){const t=await this.getKeys(),r=[];for(const n of t){const{data:o,meta:i}=await this.loadProject(n);i&&i.docType==="project"&&r.push({key:n,data:o,meta:i})}return r}async acquireProjectLock(t,r={}){return this.initialized||await this.init(),tn.acquireLock(t,r)}async releaseProjectLock(t){return tn.releaseLock(t)}getProjectLockInfo(t){return tn.getLockInfo(t)}onLockChange(t){return tn.subscribe(t)}}const P=new Hy;class Rs extends Au{constructor(){super(),this.name="IndexedDBAdapter"}async init(){try{if(typeof indexedDB>"u")throw new Error("IndexedDB is not supported in this environment.");return Promise.resolve()}catch(t){throw console.warn("IndexedDB initialization failed:",t),t}}async getItem(t){try{const r=await gp(t);if(!r)return null;let n=Es.decompressFromUTF16(r);const o=n!==null?n:r;try{return JSON.parse(o)}catch{return o}}catch(r){return console.warn(`[IndexedDBAdapter] Failed to get/decompress item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r),o=Es.compressToUTF16(n);await mp(t,o)}catch(n){throw console.error(`[IndexedDBAdapter] Failed to compress/save item: ${t}`,n),n}}async removeItem(t){return hp(t)}async clear(){return bp()}async getKeys(){return Sp()}}const Lo="cine_storage_migrated_v2";class qy{constructor(){this.localStorage=new Cu,this.indexedDB=new Rs}async runMigrationIfNeeded(){try{if(await this.localStorage.init(),await this.indexedDB.init(),await this.localStorage.getItem(Lo)==="true")return console.log("[MigrationService] Storage already migrated to IndexedDB."),!1;console.log("[MigrationService] Starting storage migration...");const r=await this.localStorage.getKeys();if(r.length===0)return console.log("[MigrationService] No local storage data found. safe to skip."),await this.markAsMigrated(),!1;const n=r.filter(i=>i!==Lo&&i!=="cine_user_uuid");let o;try{if(o=(await fl(()=>Promise.resolve().then(()=>My),void 0)).userContext,!o)throw new Error("UserContext module loaded but userContext export is missing");o.init()}catch(i){return console.error("[MigrationService] Failed to load UserContext for scoping. Aborting migration to prevent data loss.",i),!1}for(const i of n)try{const s=await this.localStorage.getItem(i);if(s!==null){const a=o.getScopedKey(i);await this.indexedDB.setItem(a,s),console.log(`[MigrationService] Migrated key: ${i} -> ${a}`)}}catch(s){console.error(`[MigrationService] Failed to migrate key: ${i}`,s)}return await this.markAsMigrated(),console.log("[MigrationService] Migration complete. IndexedDB is now the primary storage."),!0}catch(t){return console.error("[MigrationService] Critical migration failure:",t),!1}}async markAsMigrated(){await this.localStorage.setItem(Lo,"true"),await this.indexedDB.setItem(Lo,"true")}}const rn=new qy,_c="cameraPowerPlanner_ownGear";class Wy{constructor(){this.memoryCache=null}async getOwnGear(){if(this.memoryCache)return this.memoryCache;try{const t=await P.getItem(_c);if(!t)return[];Array.isArray(t)?this.memoryCache=t:t.items&&Array.isArray(t.items)?this.memoryCache=t.items:this.memoryCache=[]}catch(t){console.warn("[GearRepository] Failed to load own gear:",t),this.memoryCache=[]}return this.memoryCache}async saveOwnGear(t){if(!Array.isArray(t)){console.error("[GearRepository] saveOwnGear expects an array");return}this.memoryCache=t,await P.setItem(_c,t)}async addOwnGearItem(t){const r=await this.getOwnGear();r.push(t),await this.saveOwnGear(r)}getLibrary(){return typeof window<"u"&&window.deviceLibrary?window.deviceLibrary:typeof globalThis<"u"&&globalThis.deviceLibrary?globalThis.deviceLibrary:{}}async searchGear(t){if(!t)return[];const r=t.toLowerCase();return(await this.getOwnGear()).filter(i=>i.name&&i.name.toLowerCase().includes(r)||i.brand&&i.brand.toLowerCase().includes(r))}}const Iu=new Wy;class vu{constructor(){this.root=null,this.initialized=!1}async init(){if(!this.initialized)try{if(!navigator.storage||!navigator.storage.getDirectory){console.warn("[DataVault] OPFS is not supported in this browser.");return}this.root=await navigator.storage.getDirectory(),this.initialized=!0}catch(t){console.error("[DataVault] Failed to initialize OPFS:",t)}}async saveSnapshot(t,r){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const n=t.replace(/[^a-z0-9_\-\.\s]/gi,"_"),i=await(await this.root.getFileHandle(n+".json",{create:!0})).createWritable();return await i.write(JSON.stringify(r)),await i.close(),console.log(`[DataVault] Saved snapshot: ${t}`),!0}catch(n){throw console.error(`[DataVault] Failed to save snapshot ${t}:`,n),n}}async listSnapshots(){if(this.initialized||await this.init(),!this.root)return[];const t=[];try{for await(const[r,n]of this.root.entries())n.kind==="file"&&r.endsWith(".json")&&t.push(r)}catch(r){console.error("[DataVault] Failed to list snapshots:",r)}return t.sort().reverse()}async restoreSnapshot(t){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const o=await(await(await this.root.getFileHandle(t)).getFile()).text();return JSON.parse(o)}catch(r){throw console.error(`[DataVault] Failed to restore snapshot ${t}:`,r),r}}async deleteSnapshot(t){if(this.initialized||await this.init(),!!this.root)try{await this.root.removeEntry(t),console.log(`[DataVault] Deleted snapshot: ${t}`)}catch(r){console.warn(`[DataVault] Failed to delete snapshot ${t}:`,r)}}async clear(){if(this.initialized||await this.init(),!!this.root)try{const t=await this.listSnapshots();for(const r of t)await this.root.removeEntry(r);console.log("[DataVault] All data wiped.")}catch(t){console.error("[DataVault] Failed to wipe vault:",t)}}}const Ts=new vu,Yy=Object.freeze(Object.defineProperty({__proto__:null,DataVault:vu,dataVault:Ts},Symbol.toStringTag,{value:"Module"}));var Xn={};console.log("DEBUG: storage.js execution started");let qt={},kn=!1;async function kc(){if(!kn){console.log("[storage.js] Hydrating project cache from storage...");try{const e=await P.getKeys(),t="cameraPowerPlanner_project";let r=!1;const n=[];for(const i of e)if(!(i.startsWith("cine_")||i.startsWith("user_"))){if(i===pi){P.getItem(i).then(s=>{s&&(wi=s)});continue}if(i===Nt){P.getItem(i).then(s=>{s&&(Ai=s)});continue}if(i===ht){P.getItem(i).then(s=>{s&&(so=s)});continue}if(i===ot){P.getItem(i).then(s=>{s&&(ao=s)});continue}if(i===Mt){P.getItem(i).then(s=>{s&&(Ci=s)});continue}if(i===nr){P.getItem(i).then(s=>{s&&(_i=s)});continue}if(i===$r){P.getItem(i).then(s=>{s&&(ki=s)});continue}if(i===ct){P.getItem(i).then(s=>{s&&(Pi=s)});continue}if(i===er){P.getItem(i).then(s=>{s&&(Ii=s)});continue}if(i===Be){P.getItem(i).then(s=>{s&&(vi=s)});continue}if(i===at){P.getItem(i).then(s=>{s&&(ji=s)});continue}if(i===ar){P.getItem(i).then(s=>{s&&(Li=s)});continue}if(i===mt){P.getItem(i).then(s=>{s&&(Ri=s)});continue}if(i===st){P.getItem(i).then(s=>{s&&(Ti=s)});continue}if(i===rr){P.getItem(i).then(s=>{s&&(Ni=s)});continue}if(i===Ir){P.getItem(i).then(s=>{s&&(Mi=s)});continue}if(i===Tr()){P.getItem(i).then(s=>{s&&(zi=s)});continue}if(i===Je){P.getItem(i).then(s=>{s&&(Jr=s)});continue}i===t?r=!0:n.push(i)}if(r)try{const i=await P.getItem(t);i&&typeof i=="object"&&Object.assign(qt,i)}catch(i){console.warn("[hydrate] Failed to load monolith",i)}const o=n.map(async i=>{try{const s=await P.getItem(i);s&&(qt[i]=s)}catch(s){console.warn("[hydrate] Failed to load shard",i,s)}});await Promise.all(o),kn=!0,console.log("[storage.js] Project cache hydrated. Keys:",Object.keys(qt).length)}catch(e){console.warn("Cache hydration failed",e)}}}const h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:null,Jy=typeof process<"u"&&process&&Xn&&(Xn.JEST_WORKER_ID||Xn.CINE_FORCE_STORAGE_REINIT),$e="cine_factory_reset_lock";if(h&&h.__cineStorageInitialized)if(Jy){try{delete h.__cineStorageInitialized}catch{h.__cineStorageInitialized=!1}try{delete h.__cineStorageApi}catch{h.__cineStorageApi=null}try{delete h.__cineMonolithicProjectCleanupDone}catch{h.__cineMonolithicProjectCleanupDone=!1}}else typeof module<"u"&&module.exports&&h.__cineStorageApi&&typeof h.__cineStorageApi=="object"&&(module.exports=h.__cineStorageApi);const Qy="cine-power-planner-lifecycle";let Ie=null;const Xy=typeof process<"u"&&process&&Xn&&Xn.JEST_WORKER_ID;if(typeof BroadcastChannel<"u"&&!Xy)try{Ie=new BroadcastChannel(Qy),Ie&&(Ie.onmessage=e=>{if(e&&e.data==="factory-reset"){if(h){h.__cameraPowerPlannerFactoryResetting=!0;try{typeof sessionStorage<"u"&&sessionStorage.setItem($e,"true"),typeof localStorage<"u"&&localStorage.setItem($e,"true")}catch(t){}if(typeof sessionStorage<"u"&&typeof sessionStorage.clear=="function")try{const t=sessionStorage.getItem($e);sessionStorage.clear(),t&&sessionStorage.setItem($e,t)}catch(t){}typeof h.location<"u"&&typeof h.location.reload=="function"&&h.location.reload()}}else e.data==="project-shards-changed"&&tr()})}catch{}if(h)try{const e=[typeof window<"u"?window:null,typeof sessionStorage<"u"?sessionStorage:null,typeof localStorage<"u"?localStorage:null];let t=!1;e.forEach(r=>{if(r&&typeof r.getItem=="function")try{r.getItem($e)&&(t=!0)}catch(n){}}),t&&(h.__cineJustFactoryReset=!0),e.forEach(r=>{if(r&&typeof r.removeItem=="function")try{r.removeItem($e)}catch(n){}}),Object.defineProperty(h,"__cineStorageInitialized",{configurable:!0,writable:!0,value:!0}),(async()=>{try{rn&&typeof rn.runMigrationIfNeeded=="function"?await rn.runMigrationIfNeeded()&&(console.log("[storage.js] Migration successful. Switching to IndexedDB."),await P.switchDriver(new Rs),await kc()):rn&&typeof rn.init=="function"&&await rn.init()&&(await P.switchDriver(new Rs),await kc())}catch(r){console.warn("[storage.js] Migration service failed:",r)}})()}catch{h.__cineStorageInitialized=!0}function Zy(){if(Ie){try{Ie.close()}catch{}Ie=null}}typeof module<"u"&&module.exports&&(module.exports.closeStorageLifecycle=Zy);function Ns(e,t){if(e===null||typeof e!="object")return e;let r=t;if(r||(r=typeof WeakMap=="function"?new WeakMap:[]),typeof r.has=="function"&&typeof r.get=="function"){if(r.has(e))return r.get(e)}else if(Array.isArray(r))for(let i=0;i<r.length;i+=1){const s=r[i];if(s&&s[0]===e)return s[1]}if(Object.prototype.toString.call(e)==="[object Date]"){let i;try{const s=typeof e.getTime=="function"?e.getTime():e.valueOf();i=new Date(s)}catch{i=new Date(e)}return typeof r.set=="function"?r.set(e,i):Array.isArray(r)&&r.push([e,i]),i}const o=Array.isArray(e)?[]:{};if(typeof r.set=="function"?r.set(e,o):Array.isArray(r)&&r.push([e,o]),Array.isArray(e))for(let i=0;i<e.length;i+=1)o[i]=Ns(e[i],r);else{const i=Object.keys(e);for(let s=0;s<i.length;s+=1){const a=i[s];o[a]=Ns(e[a],r)}}return o}function kr(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return Ns(e,null)}function eg(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function tg(e){const t=eg(e);return t?function(n){if(n===null||typeof n!="object")return n;try{return t(n)}catch{}return kr(n)}:kr}const sr=h&&typeof h.__cineDeepClone=="function"?h.__cineDeepClone:tg(h),yn=typeof WeakSet=="function"?new WeakSet:null;function Kr(e){if(!(!yn||typeof yn.add!="function"||!e))try{yn.add(e)}catch{}}function va(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.sessionStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}(function(){const t=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=va(t[r]);n&&Kr(n)}if(typeof sessionStorage<"u")try{Kr(sessionStorage)}catch{}})();function rg(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.localStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}function ju(){const e=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof globalThis<"u"?globalThis:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=[],r=typeof WeakSet=="function"?new WeakSet:null;for(let n=0;n<e.length;n+=1){const o=rg(e[n]);if(o){if(r)try{if(r.has(o))continue;r.add(o)}catch{}else if(t.indexOf(o)!==-1)continue;t.push(o)}}return t}if(h&&typeof h.__cineDeepClone!="function")try{h.__cineDeepClone=sr}catch{}function Lu(){const e=r=>{if(!r||typeof r!="object"&&typeof r!="function")return!1;try{return r.__cameraPowerPlannerFactoryResetting===!0}catch{return!1}};if(e(h))return!0;const t=[typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&n!==h&&e(n))return!0}try{if(typeof sessionStorage<"u"&&sessionStorage.getItem($e)||typeof localStorage<"u"&&localStorage.getItem($e))return!0}catch{}return!1}var Ve="cameraPowerPlanner_devices",Ro=null,Xe="cameraPowerPlanner_setups",bt="cameraPowerPlanner_session",Wt="cameraPowerPlanner_feedback",pe="cameraPowerPlanner_project",qi="cameraPowerPlanner_project_rev",st="cameraPowerPlanner_favorites",at="cameraPowerPlanner_contacts",ar="cameraPowerPlanner_ownGear",mt="cameraPowerPlanner_userProfile",Vt="cameraPowerPlanner_documentationTracker",wt="cameraPowerPlanner_schemaCache",ja="cinePowerPlanner_schemaCache",$r="cameraPowerPlanner_customFonts",$o="cameraPowerPlanner_mountVoltages",er="cameraPowerPlanner_cameraColors",Be="cineRentalPrintSections",pi="cameraPowerPlanner_projectIndex",Zn=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.mountVoltageKey"):null,rt=null,hr=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.storageCache"):"__cineStorageStateCache",jt="cameraPowerPlanner_prj_",ln=typeof WeakMap=="function"&&typeof Map=="function"?new WeakMap:null,Ct=null,Pc=!1,Vr=typeof Map=="function"?new Map:null,Un=[],ng=6,Ru=typeof Object.freeze=="function"?Object.freeze({__cineCompressionMiss:!0}):{__cineCompressionMiss:!0},Ic=Mu(8),vc=Mu(6),St=typeof Map=="function"?new Map:null,br=[],og=16;function di(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.slice();for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n],i=e[o];t[o]=Array.isArray(i)?i.slice():i}return t}function Tu(e){if(!St||typeof e!="string"||!e)return null;var t;try{t=St.get(e)}catch{t=null}return!t||!t.payload?null:{payload:di(t.payload),compression:t.compression?di(t.compression):null}}function Vo(e,t,r){if(!(!St||typeof e!="string"||!e||!In(t))){var n={payload:di(t),compression:r?di(r):null};try{St.set(e,n)}catch{return}var o=br.indexOf(e);for(o!==-1&&br.splice(o,1),br.push(e);br.length>og;){var i=br.shift();if(!(!i||i===e))try{St.delete(i)}catch{}}}}function ig(){if(St&&typeof St.clear=="function")try{St.clear()}catch{}br.length=0}var Ms=Number.POSITIVE_INFINITY,zs=8,Nu=60*1e3,Wn={entries:Object.create(null),totalWarnings:0,suppressionNoticeShown:!1},dt=null,ur=null,nn=null,jc=!1;Ey&&typeof fi=="function"&&(dt=fi);var Yt="",Lt=!1;!dt&&h&&typeof h.__cineEnsureConsoleMethodsWritable=="function"&&(dt=h.__cineEnsureConsoleMethodsWritable);typeof dt=="function"&&dt(["warn","info"]);function sg(){var e=[],t=function(n){!n||typeof n!="object"&&typeof n!="function"||e.indexOf(n)===-1&&e.push(n)};return t(h),t(typeof globalThis<"u"?globalThis:null),t(typeof window<"u"?window:null),t(typeof self<"u"?self:null),t(typeof global<"u"?global:null),e}function ag(){if(ur)return ur;if(Ur&&typeof Ur.resolveLogger=="function")return ur=Ur,ur;for(var e=sg(),t=0;t<e.length;t+=1){var r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{var n=r.cineLoggingResolver;if(n&&typeof n.resolveLogger=="function")return ur=n,ur}catch{}}return ur=null,ur}function cg(){if(nn||jc)return nn;jc=!0;var e=ag();if(e&&typeof e.resolveLogger=="function")try{var t=e.resolveLogger("storage",{meta:{source:"storage-module"}});if(t)return nn=t,nn}catch{}return nn=null,nn}function an(e){if(!e)return null;if(typeof e=="string")return{message:e};var t={};if(typeof e.name=="string"&&e.name&&(t.name=e.name),typeof e.message=="string"&&e.message&&(t.message=e.message),typeof e.stack=="string"&&e.stack&&(t.stack=e.stack),!Object.keys(t).length)try{t.message=String(e)}catch{return null}return t}function yr(e){if(e&&typeof D<"u"&&D&&D.storage===e)return D&&typeof D.type=="string"?D.type:"unknown";if(e&&h){try{if(h.localStorage&&e===h.localStorage)return"local"}catch{}try{if(h.sessionStorage&&e===h.sessionStorage)return"session"}catch{}}return typeof D<"u"&&D&&typeof D.type=="string"?D.type:"unknown"}function gr(e,t,r,n,o){var i=typeof e=="string"&&e?e.toLowerCase():"info",s=typeof t=="string"&&t?t:"Storage event",a=cg(),c=!1,u={module:"storage"};if(n&&typeof n=="object"){u={module:"storage"};for(var f=Object.keys(n),l=0;l<f.length;l+=1){var y=f[l];u[y]=n[y]}}if(a){if(typeof a[i]=="function")try{a[i](s,r,u),c=!0}catch{c=!1}else if(typeof a.log=="function")try{a.log(i,s,r,u),c=!0}catch{c=!1}}if(typeof o=="function"){try{o()}catch{}return c}if(typeof console>"u"||!console)return c;var p=null;if(i==="error"&&typeof console.error=="function"?p=console.error:i==="warn"&&typeof console.warn=="function"?p=console.warn:i==="info"&&typeof console.info=="function"?p=console.info:i==="debug"&&typeof console.debug=="function"?p=console.debug:typeof console.log=="function"&&(p=console.log),typeof p=="function")try{p.call(console,s,r||null)}catch{}return c}function lg(){if(typeof Date>"u")return null;if(typeof Date.now=="function")return Date.now();try{return new Date().getTime()}catch{}return null}function Wi(e,t,r,n,o){var i=typeof e=="string"&&e?e:"generic",s=null;if(typeof t=="string"&&t)s=t;else if(t!=null)try{s=String(t)}catch{s=null}var a={event:"compression-savings",kind:i,key:s,storageType:yr()};typeof n=="number"&&Number.isFinite(n)&&(a.savings=n),typeof o=="number"&&Number.isFinite(o)&&(a.percent=o);var c=function(){if(!(typeof console>"u")){var f=Wn,l=f.entries[i],y=lg();if(l||(l={kind:i,occurrences:0,totalSavings:0,lastPercent:null,lastKey:null,uniqueKeys:Object.create(null),uniqueKeyCount:0,firstLoggedAt:y,lastLoggedAt:y,lastSummaryAt:null,suppressedTotal:0,suppressedSinceSummary:0},f.entries[i]=l),l.occurrences+=1,l.lastLoggedAt=y,s&&(l.lastKey=s,l.uniqueKeys[s]||(l.uniqueKeys[s]=!0,l.uniqueKeyCount+=1)),typeof n=="number"&&Number.isFinite(n)&&(l.totalSavings+=n),typeof o=="number"&&Number.isFinite(o)&&(l.lastPercent=o),f.totalWarnings<Ms){typeof dt=="function"&&dt("warn"),typeof console.warn=="function"&&r&&console.warn(r),f.totalWarnings+=1;return}l.suppressedTotal+=1,l.suppressedSinceSummary+=1,!f.suppressionNoticeShown&&typeof console.info=="function"&&(typeof dt=="function"&&dt("info"),console.info("Additional storage compression warnings are being batched to keep diagnostics readable.",{limit:Ms,batchSize:zs}),f.suppressionNoticeShown=!0);var p=!1;l.lastSummaryAt?(l.suppressedSinceSummary>=zs||y!==null&&l.lastSummaryAt!==null&&l.suppressedSinceSummary>0&&y-l.lastSummaryAt>=Nu)&&(p=!0):p=!0,p&&typeof console.info=="function"&&(typeof dt=="function"&&dt("info"),console.info("Suppressed repeated storage compression warnings.",{kind:l.kind,mostRecentKey:l.lastKey,suppressedSinceSummary:l.suppressedSinceSummary,suppressedTotal:l.suppressedTotal,totalOccurrences:l.occurrences,totalSavings:l.totalSavings,lastPercent:l.lastPercent,uniqueKeys:l.uniqueKeyCount}),l.lastSummaryAt=y,l.suppressedSinceSummary=0)}};gr("info",r,a,{event:"compression-savings",kind:i},c)}function ug(){for(var e={},t=Object.keys(Wn.entries),r=0;r<t.length;r+=1){var n=t[r],o=Wn.entries[n];o&&(e[n]={kind:o.kind,occurrences:o.occurrences,totalSavings:o.totalSavings,lastPercent:o.lastPercent,lastKey:o.lastKey,uniqueKeyCount:o.uniqueKeyCount,firstLoggedAt:o.firstLoggedAt,lastLoggedAt:o.lastLoggedAt,lastSummaryAt:o.lastSummaryAt,suppressedTotal:o.suppressedTotal})}return{limit:Ms,batchSize:zs,summaryWindowMs:Nu,totalWarnings:Wn.totalWarnings,suppressionNoticeShown:Wn.suppressionNoticeShown,entries:e}}function fg(e){if(!Array.isArray(e)||!e.length)return null;for(var t=[],r=0;r<e.length;r+=1){var n=e[r]||{},o=typeof n.variant=="string"?n.variant:"",i=typeof n.compress=="string"?n.compress:"",s=typeof n.decompress=="string"?n.decompress:"";t.push(o+":"+i+":"+s)}return t.join("|")}function pg(e,t){if(!Vr||!e)return null;var r;try{r=Vr.get(e)}catch{r=null}return!r||r.lz!==t?null:!Array.isArray(r.strategies)||!r.strategies.length?Array.isArray(r.strategies)?[]:null:r.strategies.slice()}function dg(e){if(!(!Vr||!e)){var t=Un.indexOf(e);for(t!==-1&&Un.splice(t,1),Un.push(e);Un.length>ng;){var r=Un.shift();if(typeof Vr.delete=="function")try{Vr.delete(r)}catch{}}}}function yg(e,t,r){if(!(!Vr||!e)){var n={lz:t,strategies:Array.isArray(r)?r.slice():[]};try{Vr.set(e,n),dg(e)}catch{}}}function gg(){if(typeof JSON>"u"||!JSON||typeof JSON.stringify!="function")return 0;try{var e={[xt]:!0,version:yi,algorithm:go,namespace:Xr,data:"",originalLength:0,compressedPayloadLength:0,compressionVariant:""},t=JSON.stringify(e);if(typeof t!="string"||!t)return 0;var r=JSON.stringify("").length;return r>0?t.length-r*2-String(0).length*2:0}catch{}return 0}function Mu(e){if(typeof Map!="function")return null;var t=Number(e);return t>0?{map:new Map,keys:[],limit:Math.floor(t)}:null}function zu(e){if(!e||typeof e!="object")return null;for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1)t[r[n]]=e[r[n]];return t}function Bu(e,t){if(!(!e||!Array.isArray(e.keys))){var r=e.keys.indexOf(t);r!==-1&&e.keys.splice(r,1),e.keys.push(t)}}function xu(e,t){if(!e||!e.map||typeof e.map.get!="function")return{hit:!1};if(typeof t!="string"||!t)return{hit:!1};var r;try{r=e.map.get(t)}catch{return{hit:!1}}if(r===void 0)return{hit:!1};if(Bu(e,t),r===Ru)return{hit:!0,candidate:null};var n=zu(r);return n?{hit:!0,candidate:n}:{hit:!0,candidate:null}}function Gu(e,t,r){if(!(!e||!e.map||typeof e.map.set!="function")&&!(typeof t!="string"||!t)&&!(!e.limit||e.limit<=0)){var n=r&&typeof r=="object"?zu(r):Ru;try{e.map.set(t,n)}catch{return}for(Bu(e,t);e.keys.length>e.limit;){var o=e.keys.shift();if(!(typeof o!="string"||o===t))try{e.map.delete(o)}catch{}}}}function La(e,t){if(!e||typeof e!="object"&&typeof e!="function")return null;let r=null;if(hr)try{r=e[hr]}catch{r=null}if(!r&&ln)try{r=ln.get(e)||null}catch{r=null}if(r||!t)return r||null;const n=new Map;let o=!1;if(hr)try{Object.defineProperty(e,hr,{configurable:!0,writable:!0,value:n}),o=!0}catch{try{e[hr]=n,o=!0}catch{o=!1}}if(!o&&ln)try{ln.set(e,n),o=!0}catch{o=!1}return o?n:null}function mg(e,t){const r=La(e,!1);return!r||typeof t!="string"||!t?null:r.get(t)||null}function Ht(e,t){const r=La(e,!1);if(!(!r||typeof t!="string"||!t)&&(typeof r.delete=="function"&&r.delete(t),r.size===0)){if(hr)try{e&&(typeof e=="object"||typeof e=="function")&&Object.prototype.hasOwnProperty.call(e,hr)&&delete e[hr]}catch{}if(ln)try{ln.delete(e)}catch{}}}function Fu(e){if(e===null||typeof e!="object")return e;try{return sr(e)}catch{}return e}function ds(e){if(!e)return;const{value:t}=e;return t===null||typeof t!="object"?t:Fu(t)}function Pn(e,t){const r=new Map;if(!e||typeof e.forEach!="function")return r;const{freezeArray:n=!1}=t||{};return e.forEach((o,i)=>{if(Array.isArray(o)){const s=o.slice();if(n)try{Object.freeze(s)}catch{}r.set(i,s)}else r.set(i,o)}),r}function Du(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Pn(e.raw),normalized:Pn(e.normalized)}}function hg(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Pn(e.raw),normalized:Pn(e.normalized,{freezeArray:!0})}}function bg(e){if(!E(e))return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n],i=e[o];if(i&&typeof i=="object")try{Object.freeze(i)}catch{}t[o]=i}try{Object.freeze(t)}catch{}return t}function Lc(e){if(!e||typeof e!="object"){rt=null;return}rt={projects:bg(e.projects),changed:!!e.changed,originalValue:e.originalValue,lookup:hg(e.lookup),rawValue:e.rawValue===void 0?void 0:e.rawValue}}function Sg(e){if(!rt)return null;const t=T();let r=null;if(t&&typeof t.getItem=="function")try{r=t.getItem(pe)}catch{r=null}if(rt.rawValue!==void 0&&rt.rawValue!==r)return rt=null,null;const{forMutation:n=!1}=e||{};return{projects:n?sr(rt.projects):rt.projects,changed:rt.changed,originalValue:rt.originalValue,lookup:Du(rt.lookup)}}function tr(){rt=null}function wg(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}return null}function Eg(){return qi}function Uu(e){const t=e||T();if(!t||typeof t.getItem!="function")return null;const r=Te(t,qi,"Error reading project storage revision from localStorage:",null,{validate:n=>n===null||typeof n=="number"||typeof n=="string"});return wg(r)}function Ra(e){const t=e||T();if(!t||typeof t.setItem!="function")return null;const r=Uu(t),n=Number.isFinite(r)?r+1:1;return ke(t,qi,n,"Error saving project storage revision to localStorage:",{disableCompression:!0,enableCompressionSweep:!1}),n}function Ue(e,t,r,n,o){if(typeof t!="string"||!t||!e||typeof e!="object"&&typeof e!="function")return;const i=La(e,!0);if(!i)return;const s=Fu(o),c={raw:typeof r=="string"&&r?r:null,normalizedRaw:typeof n=="string"&&n?n:typeof r=="string"&&r?r:null,value:s};i.set(t,c)}function Og(e,t,r,n){const o=mg(e,t);if(!o)return{hit:!1};if(typeof n=="string"&&n&&o.raw&&o.raw===n)return{hit:!0,value:ds(o)};if(typeof r=="string"&&r){if(o.normalizedRaw&&o.normalizedRaw===r)return{hit:!0,value:ds(o)};if(o.raw&&o.raw===r)return{hit:!0,value:ds(o)}}return{hit:!1}}function Ag(e,t){if(!e||typeof e!="object")return"";var r;try{r=Object.getOwnPropertyDescriptor(e,t)}catch{r=null}if(r&&Object.prototype.hasOwnProperty.call(r,"value")&&typeof r.value=="string"&&r.value)return r.value;var n;try{n=e[t]}catch{n=""}if(typeof n=="string"&&n)return n;if(Zn)try{const o=e[Zn];if(typeof o=="string"&&o)return o}catch{}return""}function Ku(e,t,r){if(!e||typeof e!="object")return"";if(Zn)try{e[Zn]=r;const i=e[Zn];if(typeof i=="string"&&i)return i}catch{}var n;try{n=Object.getOwnPropertyDescriptor(e,t)}catch{n=null}if(n&&Object.prototype.hasOwnProperty.call(n,"value")&&typeof n.value=="string"&&n.value)return n.value;if(n&&n.configurable===!1&&n.writable===!1)return"";var o="";try{e[t]=r,o=e[t]}catch{o=""}return typeof o=="string"&&o?o:(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose mount voltage storage key globally. Using fallback only."),"")}function $u(){if(!h||typeof h!="object")return $o;var e=Ag(h,"MOUNT_VOLTAGE_STORAGE_KEY");if(e)return e;var t=Ku(h,"MOUNT_VOLTAGE_STORAGE_KEY",$o);return t||$o}var Ho=$u();function Vu(){const e=$u();if(e&&e!==Ho&&(Ho=e,h&&Ku(h,"MOUNT_VOLTAGE_STORAGE_KEY",e),typeof kt<"u"&&kt&&typeof kt.add=="function")){kt.add(e);const t=Ot(e);for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&kt.add(n)}}return Ho}function Tr(){return Vu()}function Hu(){const e=Vu();return e?`${e}__backup`:`${$o}__backup`}function qu(){if(!h)return $r;const e=typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:typeof h.CUSTOM_FONT_STORAGE_KEY=="string"?h.CUSTOM_FONT_STORAGE_KEY:$r;let t=e;return e==="cinePowerPlanner_customFonts"&&(t=$r),h.CUSTOM_FONT_STORAGE_KEY!==t&&(h.CUSTOM_FONT_STORAGE_KEY=t),h.CUSTOM_FONT_STORAGE_KEY_NAME!==t&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=t),t}function Pr(){return h&&typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:qu()}qu();var ct="customLogo",Rc="cameraPowerPlanner_temperatureUnit",Tc="cameraPowerPlanner_focusScale";function Cg(){if(!h)return Rc;const e=typeof h.TEMPERATURE_UNIT_STORAGE_KEY=="string"?h.TEMPERATURE_UNIT_STORAGE_KEY:Rc;if(h.TEMPERATURE_UNIT_STORAGE_KEY!==e)try{h.TEMPERATURE_UNIT_STORAGE_KEY=e}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign temperature unit storage key globally.",t);try{Object.defineProperty(h,"TEMPERATURE_UNIT_STORAGE_KEY",{configurable:!0,writable:!0,value:e})}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose temperature unit storage key globally.",r)}}return e}var rr=Cg(),Ir=(function(){if(!h)return Tc;const t=typeof h.FOCUS_SCALE_STORAGE_KEY=="string"?h.FOCUS_SCALE_STORAGE_KEY:Tc;if(h.FOCUS_SCALE_STORAGE_KEY!==t)try{h.FOCUS_SCALE_STORAGE_KEY=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign focus scale storage key globally.",r)}if(h.FOCUS_SCALE_STORAGE_KEY_NAME!==t)try{h.FOCUS_SCALE_STORAGE_KEY_NAME=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose focus scale storage key globally.",r)}return t})(),vr="cameraPowerPlanner_autoGearRules",Zr="cameraPowerPlanner_autoGearSeeded",Rt="cameraPowerPlanner_autoGearBackups",Tt="cameraPowerPlanner_autoGearPresets",Nt="cameraPowerPlanner_autoGearMonitorDefaults",ht="cameraPowerPlanner_autoGearActivePreset",ot="cameraPowerPlanner_autoGearAutoPreset",nr="cameraPowerPlanner_autoGearShowBackups",Mt="cameraPowerPlanner_autoGearBackupRetention",Je="cameraPowerPlanner_fullBackups",Fe="auto-backup-",Et="auto-backup-before-delete-",Hr="__cineAutoBackupRenamed",po="__cineAutoBackupMetadata",gn="__cineAutoBackupSnapshot",qr=1,Ta="__cineAutoBackupCompressedPayload",Wu="__cineCircular__",Ar=new Map,ys=typeof Set=="function"?new Set:null,_g=2048;function Bt(e){return typeof e=="string"&&(e.startsWith(Fe)||e.startsWith(Et))}if(h&&typeof h=="object")try{Object.prototype.hasOwnProperty.call(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG")||Object.defineProperty(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG",{configurable:!0,writable:!1,value:Hr})}catch{try{h.__CINE_AUTO_BACKUP_RENAMED_FLAG=Hr}catch{}}var un=240,Nc=20,Yu=36,nt=1,kg=120;function Pg(){if(!(!h||typeof h!="object")){if(typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=Yu}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention default globally.",e)}if(typeof h.AUTO_GEAR_BACKUP_RETENTION_MIN!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_MIN=nt}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention minimum globally.",e)}}}Pg();function Ig(e){return!e||typeof e!="object"?null:{version:Number.isFinite(e.version)?e.version:qr,snapshotType:e.snapshotType==="delta"?"delta":"full",base:typeof e.base=="string"?e.base:null,sequence:Number.isFinite(e.sequence)?e.sequence:e.snapshotType==="delta"?1:0,createdAt:typeof e.createdAt=="string"?e.createdAt:null,changedKeys:Array.isArray(e.changedKeys)?e.changedKeys.slice():[],removedKeys:Array.isArray(e.removedKeys)?e.removedKeys.slice():[],payloadSignature:typeof e.payloadSignature=="string"?e.payloadSignature:null,payloadCompression:E(e.payloadCompression)?{...e.payloadCompression}:null,compressedPayload:E(e.compressedPayload)?be(e.compressedPayload,{stripMetadata:!0}):e.compressedPayload&&typeof e.compressedPayload=="string"?e.compressedPayload:null}}function eo(e,t){if(!e||typeof e!="object")return;const r=Ig(t);try{Object.defineProperty(e,po,{configurable:!0,enumerable:!1,writable:!0,value:r})}catch{try{e[po]=r}catch{}}}function yo(e){if(!e||typeof e!="object")return null;const t=e[po];return!t||typeof t!="object"?null:t}function vg(e,t){if(!t||typeof t!="object")return;const r=yo(e);r&&eo(t,r)}function be(e,t,r){const n=t||{},o=r||(typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),i=(s,a)=>{if(!o||!o.stack)return a();if(o.stack.has(s)){if(!o.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function")try{console.warn("Detected circular reference while cloning automatic backup data. Using a placeholder to keep serialization stable.")}catch{}return o&&(o.reportedCycle=!0),Wu}o.stack.add(s);try{return a()}finally{o.stack.delete(s)}};return e===null||typeof e!="object"?e:e instanceof Date?new Date(e.getTime()):Array.isArray(e)?i(e,()=>e.map(s=>be(s,n,o))):i(e,()=>{const s={};if(Object.keys(e).forEach(a=>{n.stripMetadata&&a===po||(s[a]=be(e[a],n,o))}),!n.stripMetadata){const a=yo(e);a&&eo(s,a)}return s})}function Bs(e,t){const n=be(e,t,typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),o=fe(n);return o!==n?o:n}function In(e){return!E(e)||e[Ta]!==!0?!1:typeof e.data=="string"&&e.data}function gs(e,t,r){if(!e||typeof e!="object")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:null};const n=r||{};if(n.disableCompression)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:typeof n.payloadSignature=="string"?n.payloadSignature:null};const o=n.reportCompression!==!1;let i=null;try{i=typeof n.payloadSignature=="string"?n.payloadSignature:Ce(e)}catch(y){i=null,console.warn("Unable to compute stable signature for automatic backup payload before compression",y)}const s=typeof n.existingPayloadSignature=="string"?n.existingPayloadSignature:null;if(s&&i&&s===i&&In(n.existingCompressedPayload)){const y=be(n.existingCompressedPayload,{stripMetadata:!0}),p=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null;return!n.disableCompression&&typeof i=="string"&&i&&Vo(i,y,p),{payload:y,compression:p,compressed:!0,reused:!0,payloadSignature:i}}if(!n.disableCompression&&typeof i=="string"&&i){const y=Tu(i);if(y&&y.payload)return{payload:y.payload,compression:y.compression,compressed:!0,reused:!0,payloadSignature:i}}let a;try{a=JSON.stringify(e)}catch(y){return console.warn("Unable to serialize auto backup payload before compression",y),{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i}}if(typeof a!="string"||a.length<_g)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};if(!n.disableCompression&&In(n.existingCompressedPayload)){const y=Co(n.existingCompressedPayload.data);if(y.success&&typeof y.value=="string"&&y.value===a){const p=be(n.existingCompressedPayload,{stripMetadata:!0}),d=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null,g=typeof i=="string"&&i?i:typeof s=="string"&&s?s:null;return g&&Vo(g,p,d),{payload:p,compression:d,compressed:!0,reused:!0,payloadSignature:g}}}const c=vn(a);if(!c||typeof c.serialized!="string")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};const u=c.originalLength-c.wrappedLength,f={[Ta]:!0,data:c.serialized,originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},l=typeof c.originalLength=="number"&&Number.isFinite(c.originalLength)&&typeof c.wrappedLength=="number"&&Number.isFinite(c.wrappedLength)?{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null}:null;if(!n.disableCompression&&typeof i=="string"&&i&&Vo(i,f,l),o&&typeof console<"u"&&typeof console.warn=="function"&&u>0){const y=typeof t=="string"&&t?`"${t}"`:"an automatic backup",p=c.originalLength>0?Math.round(u/c.originalLength*100):0,d=`Stored compressed payload for ${y} snapshot to reduce storage usage by ${u} characters (${p}%).`;Wi("auto-backup",t||y,d,u,p)}return{payload:f,compression:{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},compressed:!0,reused:!1,payloadSignature:i}}function xs(e,t){if(!e||typeof e!="object")return{payload:e,compressed:!1};const r=e.payload;if(!In(r))return{payload:r,compressed:!1};const n=Co(r.data);if(!n.success||typeof n.value!="string"){const o=n&&n.error?n.error:null;throw console.warn("Unable to decompress automatic backup payload.",t,o),new Error("Failed to decompress automatic backup payload")}try{return{payload:JSON.parse(n.value),compressed:!0}}catch(o){throw console.warn("Unable to parse decompressed automatic backup payload.",t,o),o}}function to(e,t){const r=xa(e);if(r&&Number.isFinite(r.timestamp)&&r.timestamp>0)try{return new Date(r.timestamp).toISOString()}catch{}const n=t instanceof Date?t:new Date;try{return n.toISOString()}catch{return new Date().toISOString()}}function jg(e,t,r){if(!E(e)||!r||r.snapshotType!=="delta")return{cycle:!1,path:[]};const n=new Set,o=[],i=Math.max(10,Object.keys(e).length+5);let s=0,a=t,c=r;for(;c&&c.snapshotType==="delta";){if(s>i)return{cycle:!0,path:o};const u=typeof c.base=="string"?c.base:null;if(!u)return{cycle:!1,path:o};if(!Bt(u))return{cycle:!1,path:o};if(n.has(u))return o.push(u),{cycle:!0,path:o};n.add(a),o.push(a);const f=Object.prototype.hasOwnProperty.call(e,u)?e[u]:null;if(!E(f))return{cycle:!1,path:o};if(a=u,c=yo(f),!c)return{cycle:!1,path:o};s+=1}return{cycle:!1,path:o}}function Lg(e,t,r){if(!e||typeof e!="object")return;e.snapshotType="full",e.base=null,e.sequence=0,e.removedKeys=[];const n=E(r)?Object.keys(r):[];e.changedKeys=n.slice(),(typeof e.createdAt!="string"||!e.createdAt)&&(e.createdAt=to(t))}function Ju(e,t){if(!E(e))return e;const r={},n=new Map,o=t||{},i=typeof o.isAutoBackupKey=="function"?o.isAutoBackupKey:Bt,s=typeof o.filter=="function"?o.filter:null,a=s?u=>{let f=!1;try{f=s(u)}catch{f=!1}return f}:()=>!0,c=(u,f)=>{if(n.has(u))return n.get(u);const l=e[u],y=Qi(l,u),p=y.restored?y.value:l;if(!E(p)){const m=be(p);return n.set(u,m),m}const d=p[gn];if(d&&typeof d=="object"){if(f.has(u)){console.warn("Detected cyclic auto-backup reference while expanding snapshot",u);let w={},j=[],x=null;try{const z=xs(d,u);if(z&&E(z.payload)){w=be(z.payload),j=Object.keys(z.payload);try{x=Ce(z.payload)}catch(M){x=null,console.warn("Unable to compute stable signature for automatic backup payload after detecting a cycle",M)}}}catch(z){console.warn("Failed to restore automatic backup payload after detecting a cyclic reference",u,z)}const N={version:Number.isFinite(d.version)?d.version:qr,snapshotType:"full",base:null,sequence:Number.isFinite(d.sequence)?d.sequence:0,createdAt:typeof d.createdAt=="string"?d.createdAt:to(u),changedKeys:j.slice(),removedKeys:[],payloadSignature:x};return In(d.payload)?(N.compressedPayload=be(d.payload,{stripMetadata:!0}),N.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(N.compressedPayload=null,N.payloadCompression=null),eo(w,N),n.set(u,w),w}f.add(u);const m=d.snapshotType==="delta"?"delta":"full",b=m==="delta"&&typeof d.base=="string"?d.base:null,A=b?be(c(b,f)):{};let O;try{O=xs(d,u)}catch(w){throw console.warn("Failed to restore automatic backup payload while expanding snapshot",u,w),w}const C=E(O.payload)?O.payload:{},k=Array.isArray(d.changedKeys)&&d.changedKeys.length?d.changedKeys:Object.keys(C),_=Array.isArray(d.removedKeys)?d.removedKeys:[],v=be(A);k.forEach(w=>{Object.prototype.hasOwnProperty.call(C,w)&&v&&(v[w]=be(C[w]))}),_.forEach(w=>{Object.prototype.hasOwnProperty.call(v,w)&&delete v[w]});const S={version:Number.isFinite(d.version)?d.version:qr,snapshotType:m,base:m==="delta"?b:null,sequence:Number.isFinite(d.sequence)?d.sequence:m==="delta"?1:0,createdAt:typeof d.createdAt=="string"?d.createdAt:to(u),changedKeys:k.slice(),removedKeys:_.slice()};try{S.payloadSignature=Ce(C)}catch(w){S.payloadSignature=null,console.warn("Unable to compute stable signature for automatic backup payload during expansion",w)}return In(d.payload)?(S.compressedPayload=be(d.payload,{stripMetadata:!0}),S.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(S.compressedPayload=null,S.payloadCompression=null),eo(v,S),n.set(u,v),f.delete(u),v}const g=be(p);if(i(u)){const m={version:qr,snapshotType:"full",base:null,sequence:0,createdAt:to(u),changedKeys:Object.keys(g),removedKeys:[]};eo(g,m)}return n.set(u,g),g};return Object.keys(e).forEach(u=>{if(a(u)){if(!i(u)){const f=e[u];r[u]=E(f)?be(f):f;return}r[u]=c(u,new Set)}}),r}function Rg(e,t){const r={},n=[],o=[],i=E(t)?Object.keys(t):[],s=E(e)?Object.keys(e):[];return new Set([...i,...s]).forEach(c=>{if(c===po)return;const u=Object.prototype.hasOwnProperty.call(e||{},c),f=Object.prototype.hasOwnProperty.call(t||{},c);if(!u&&f){o.push(c);return}if(!u)return;const l=e?e[c]:void 0,y=f?t[c]:void 0,p=Ce(l),d=Ce(y);p!==d&&(n.push(c),r[c]=be(l,{stripMetadata:!0}))}),{payload:r,changedKeys:n,removedKeys:o}}function Qu(e,t){if(!E(e))return e;const r=t||{},n=typeof r.isAutoBackupKey=="function"?r.isAutoBackupKey:Bt,o={},i=Object.keys(e),s=(()=>{const a=new Map;i.forEach(u=>{if(!n(u))return;const f=e[u],l=yo(f);let y=Number.NEGATIVE_INFINITY;if(l&&typeof l.createdAt=="string"){const g=Date.parse(l.createdAt);Number.isNaN(g)||(y=g)}if(!Number.isFinite(y)){const g=xa(u);g&&Number.isFinite(g.timestamp)&&(y=g.timestamp)}const p=u.startsWith(Et)?Et:Fe,d=a.get(p);(!d||y>d.timestamp||y===d.timestamp&&u.localeCompare(d.name)>0)&&a.set(p,{name:u,timestamp:y})});const c=new Set;return a.forEach(({name:u})=>{typeof u=="string"&&u&&c.add(u)}),c})();return i.forEach(a=>{const c=e[a],u=Bs(c,{stripMetadata:!0});if(!n(a)||!E(u)){o[a]=u;return}const f=s.has(a),l=yo(c);l&&l.snapshotType==="delta"&&jg(e,a,l).cycle&&(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Detected cyclic automatic backup chain during serialization. Promoting to full snapshot.",a),Lg(l,a,u));const y=l&&typeof l.createdAt=="string"?l.createdAt:to(a);if(!l||l.snapshotType!=="delta"){o[a]={};const C={version:qr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(u||{}),removedKeys:[]};let k;try{k=Ce(u)}catch(v){k=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",v)}const _=gs(u,a,{disableCompression:f,payloadSignature:k,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(C.payload=_.payload,_.compression&&(C.payloadCompression=_.compression),l){const v=typeof _.payloadSignature=="string"?_.payloadSignature:k;l.payloadSignature=v||null,_.compressed?(l.compressedPayload=be(_.payload,{stripMetadata:!0}),l.payloadCompression=_.compression?{..._.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][gn]=C;return}const p=typeof l.base=="string"?l.base:null,d=p&&Object.prototype.hasOwnProperty.call(e,p)?e[p]:null;if(!d||!E(d)){o[a]={};const C={version:qr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(u||{}),removedKeys:[]};let k;try{k=Ce(u)}catch(v){k=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",v)}const _=gs(u,a,{disableCompression:f,payloadSignature:k,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(C.payload=_.payload,_.compression&&(C.payloadCompression=_.compression),l){const v=typeof _.payloadSignature=="string"?_.payloadSignature:k;l.payloadSignature=v||null,_.compressed?(l.compressedPayload=be(_.payload,{stripMetadata:!0}),l.payloadCompression=_.compression?{..._.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][gn]=C;return}const g=Bs(d,{stripMetadata:!0}),m=Rg(u,g);o[a]={};const b={version:Number.isFinite(l.version)?l.version:qr,snapshotType:"delta",base:p,sequence:Number.isFinite(l.sequence)?l.sequence:1,createdAt:y,changedKeys:m.changedKeys,removedKeys:m.removedKeys};let A;try{A=Ce(m.payload)}catch(C){A=null,console.warn("Unable to compute stable signature for automatic backup delta payload before serialization",C)}const O=gs(m.payload,a,{disableCompression:f,payloadSignature:A,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(b.payload=O.payload,O.compression&&(b.payloadCompression=O.compression),l){const C=typeof O.payloadSignature=="string"?O.payloadSignature:A;l.payloadSignature=C||null,O.compressed?(l.compressedPayload=be(O.payload,{stripMetadata:!0}),l.payloadCompression=O.compression?{...O.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][gn]=b}),o}function Ot(e){if(typeof e!="string"||!e)return[e];const t=new Set([e]);return e.startsWith("cameraPowerPlanner_")?t.add(`cinePowerPlanner_${e.slice(19)}`):e.startsWith("cinePowerPlanner_")&&t.add(`cameraPowerPlanner_${e.slice(17)}`),Array.from(t)}var mn=new Set(Ot(Xe));function Tg(){return(!Ro||typeof Ro.has!="function")&&(Ro=new Set(Ot(Ve))),Ro}function Xu(e){if(typeof e!="string"||!e)return!1;const t=Tg();return t&&typeof t.has=="function"?t.has(e):e===Ve}function Ng(e){return!(typeof e!="string"||!e||!mn||typeof mn.has!="function"||!mn.has(e)||Lt)}function Mg(e,t){if(!e||typeof e.getItem!="function"||!mn||typeof mn.forEach!="function")return;const r=new Set,n=t&&typeof t.has=="function"?t:null;mn.forEach(o=>{if(!(typeof o!="string"||!o||r.has(o))&&(r.add(o),!(n&&n.has(o))))try{e.getItem(o)}catch{}})}var de="__backup",zg=3,Bg=100,Nr="__legacyMigrationBackup",kt=new Set([Pr(),ct,wt,at,ar,Vt,Ho,Ir,Be]);Array.from(kt).forEach(e=>{Ot(e).forEach(t=>{typeof t=="string"&&t&&kt.add(t)})});var Mc=[()=>({key:Ve}),()=>({key:Xe}),()=>({key:bt}),()=>({key:Wt}),()=>({key:pe,valueProvider:()=>{if(typeof At=="function")try{const{projects:e}=At({forMutation:!1});if(e&&typeof e=="object")return JSON.stringify(e)}catch(e){typeof console<"u"&&console.warn&&console.warn("Failed to reconstruct monolithic project backup",e)}return null}}),()=>({key:st}),()=>({key:at}),()=>({key:ar}),()=>({key:Vt}),()=>({key:wt}),()=>({key:vr}),()=>({key:Zr}),()=>({key:Rt}),()=>({key:Tt}),()=>({key:ht}),()=>({key:ot}),()=>({key:nr}),()=>({key:Mt}),()=>({key:Nt}),()=>({key:Je}),()=>({key:ct}),()=>({key:Pr()}),()=>({key:"darkMode"}),()=>({key:"pinkMode"}),()=>({key:"highContrast"}),()=>({key:"reduceMotion"}),()=>({key:"relaxedSpacing"}),()=>({key:"showAutoBackups"}),()=>({key:"accentColor"}),()=>({key:"fontSize"}),()=>({key:"fontFamily"}),()=>({key:"language"}),()=>({key:"iosPwaHelpShown"}),()=>({key:Be}),()=>({key:rr}),()=>({key:Tr(),backupKey:Hu()})];function xg(e,t={}){if(!e||typeof e!="object")return null;const{key:r,backupKey:n,storage:o=null}=e;if(typeof r!="string"||!r)return null;const i=typeof n=="string"&&n?n:`${r}${de}`;return{key:r,backupKey:i,storage:o,label:typeof t.label=="string"?t.label:r,valueProvider:typeof e.valueProvider=="function"?e.valueProvider:null}}function Gg(e={}){const t=[],r=new Set,n=i=>{if(!i)return;const s=Ot(i.key),a=`${i.key}${de}`;for(let c=0;c<s.length;c+=1){const u=s[c];if(typeof u!="string"||!u)continue;let f=i.backupKey;u!==i.key&&i.backupKey===a&&(f=`${u}${de}`);const l=u===i.key?i:{...i,key:u,backupKey:f},y=l.storage||null,p=`${l.key}__${y?String(y):"default"}`;r.has(p)||(r.add(p),t.push(l))}};for(let i=0;i<Mc.length;i+=1){const s=Mc[i];if(typeof s!="function")continue;let a;try{a=s(e)}catch(u){var o={event:"critical-storage",action:"collect-keys",reason:"provider-error",storageType:yr(e&&e.storage?e.storage:null),error:an(u)};gr("warn","Critical storage key provider failed",o,{event:"critical-storage",stage:"gather"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage key provider failed",u)});continue}const c=xg(a,e);c&&n(c)}return t}let Zu=null;function Fg(e){if(Zu=e,!(!h||typeof h!="object"))try{h.__cineCriticalStorageGuard=e}catch{try{Object.defineProperty(h,"__cineCriticalStorageGuard",{configurable:!0,writable:!0,value:e})}catch{}}}function Dg(e={}){let t=e&&e.storage?e.storage:null;if(!t)try{t=T()}catch(f){var r={event:"critical-storage",action:"resolve-storage",reason:"resolve-failed",storageType:yr(e&&e.storage?e.storage:null),error:an(f)};gr("warn","Unable to resolve safe storage while ensuring backups",r,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve safe storage while ensuring backups",f)}),t=null}const n={ensured:[],skipped:[],errors:[],timestamp:new Date().toISOString(),storageType:D&&D.type?D.type:"unknown"},o=Gg(e),i=t&&typeof t.getItem=="function"?t:null;for(let f=0;f<o.length;f+=1){const l=o[f],y=l.storage&&typeof l.storage.getItem=="function"?l.storage:i;if(!y||typeof y.getItem!="function"||typeof y.setItem!="function"){n.skipped.push({key:l.key,reason:"unavailable-storage"});continue}let p;try{l.valueProvider?p=l.valueProvider():p=y.getItem(l.key)}catch(_){n.errors.push({key:l.key,reason:"read-failed",error:_});var s={event:"critical-storage",action:"inspect-primary",key:l.key,storageType:yr(y),reason:"read-failed",error:an(_)};gr("warn","Critical storage guard could not inspect "+l.key,s,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not inspect "+l.key,_)});continue}if(p==null){n.skipped.push({key:l.key,reason:"missing"});continue}let d;try{d=y.getItem(l.backupKey)}catch(_){n.errors.push({key:l.key,reason:"backup-read-failed",error:_});var a={event:"critical-storage",action:"inspect-backup",key:l.key,backupKey:l.backupKey,storageType:yr(y),reason:"backup-read-failed",error:an(_)};gr("warn","Critical storage guard could not read backup for "+l.key,a,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not read backup for "+l.key,_)});continue}if(typeof d=="string"){n.skipped.push({key:l.key,reason:"exists"});continue}const g=typeof p=="string"?p:p==null?"":String(p),m=_=>{try{return y.setItem(l.backupKey,_),{success:!0,error:null}}catch(v){return{success:!1,error:v}}},b=(_,v="backup-write-failed")=>{n.errors.push({key:l.key,reason:v,error:_});var S={event:"critical-storage",action:"mirror-backup",key:l.key,backupKey:l.backupKey,storageType:yr(y),reason:v,error:an(_)};C&&(S.compressed=!0),gr("error","Critical storage guard could not mirror "+l.key,S,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.error=="function"&&console.error("Critical storage guard could not mirror "+l.key,_)})},A=typeof g=="string"&&g&&!g.includes(`"${xt}":true`)&&!Xu(l.key);let O=g,C=null,k=m(O);if(!k.success&&k.error){if(!It(k.error)){b(k.error);continue}if(A){const _=vn(g);_&&typeof _.serialized=="string"&&_.serialized&&(O=_.serialized,C=_,k=m(O))}if(!k.success&&k.error&&It(k.error)){const _=new Set;typeof l.backupKey=="string"&&l.backupKey&&_.add(l.backupKey);const v=Ng(l.key);!v&&typeof l.key=="string"&&l.key&&_.add(l.key),!v&&!Lt&&Mg(y,_);const S=sf(y,{skipKeys:Array.from(_)});S&&S.success&&(k=m(O))}if(!k.success){b(k.error,It(k.error)?"backup-quota-exceeded":"backup-write-failed"),It(k.error)&&le("critical-backup-quota");continue}}if(n.ensured.push({key:l.key,backupKey:l.backupKey,compressed:!!C}),C&&typeof C.originalLength=="number"&&typeof C.wrappedLength=="number"){const _=C.originalLength-C.wrappedLength,v=C.originalLength>0?Math.round(_/C.originalLength*100):0,S=`Stored compressed critical backup for ${l.key}, reducing storage usage by ${_} characters (${v}%).`;Wi("critical-backup",l.key,S,_,v)}}if(Fg(n),n.ensured.length){var c={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||yr(),count:n.ensured.length,timestamp:n.timestamp,entries:n.ensured.map(function(l){return{key:l.key,backupKey:l.backupKey,compressed:!!l.compressed}})};gr("info","Critical storage guard mirrored backup copies",c,{event:"critical-storage",stage:"ensure"},function(){if(typeof console<"u"&&typeof console.info=="function"){const l=n.ensured.map(y=>({key:y.key,backupKey:y.backupKey}));console.info("Critical storage guard mirrored backup copies",{count:n.ensured.length,entries:l})}})}if(n.errors.length){var u={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||yr(),count:n.errors.length,timestamp:n.timestamp,reason:"errors-detected",entries:n.errors.map(function(l){return{key:l&&l.key,reason:l&&l.reason,error:an(l&&l.error)}})};gr("warn","Critical storage guard encountered issues",u,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard encountered issues",n.errors)})}return n}function Ug(){return Zu}var Kg=10,ef="lz-string",tf="json-string",Yi=[{variant:"utf16",compress:"compressToUTF16",decompress:"decompressFromUTF16"},{variant:"uri-component",compress:"compressToEncodedURIComponent",decompress:"decompressFromEncodedURIComponent"},{variant:"base64",compress:"compressToBase64",decompress:"decompressFromBase64"}],xt="__cineStorageCompressed",yi=1,go="lz-string",zc="lz-string-utf16",rf=Yi,Xr="camera-power-planner:storage-compression",$g=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(go):'"'.concat(String(go),'"'),Vg=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(Xr):'"'.concat(String(Xr),'"'),Bc=gg(),on=typeof WeakSet=="function"?new WeakSet:null,Hg=40,qg=128,Cr="__cineRawGetItem",Wg=1024,Yg=256,Jg=.08;function Ji(e){if(!Array.isArray(e)||!e.length)return[];var t=Es;if(!t)return[];var r=fg(e),n=pg(r,t);if(n!=null)return n;for(var o=[],i=0;i<e.length;i+=1){var s=e[i];if(s){var a=typeof t[s.compress]=="function"?t[s.compress]:null,c=typeof t[s.decompress]=="function"?t[s.decompress]:null,u=null,f=0;if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{u=JSON.stringify(String(s.variant||"")),typeof u=="string"&&u?f=u.length:(u=null,f=0)}catch{u=null,f=0}a&&c&&o.push({variant:s.variant,compress:a,decompress:c,variantLiteral:f>0?u:null,variantLiteralLength:f})}}var l=o.length?o.slice():[];return r&&yg(r,t,l),l}function nf(e,t,r,n){if(typeof e!="string"||!e)return{success:!1};var o=Ji(t);if(!o.length)return{success:!1};var i=[];if(r){for(var s=null,a=0;a<o.length;a+=1)if(o[a].variant===r){s=o[a];break}s?i.push(s):typeof console<"u"&&typeof console.warn=="function"&&console.warn("Compression variant ".concat(r," is unavailable while reading ").concat(n||"compressed payload","."))}for(var c=0;c<o.length;c+=1)(!r||o[c].variant!==r)&&i.push(o[c]);for(var u=null,f=0;f<i.length;f+=1){var l=i[f];try{var y=l.decompress(e);if(typeof y=="string"&&y)return{success:!0,value:y,variant:l.variant}}catch(p){u=p,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decompress ".concat(n||"compressed payload"," with ").concat(l.variant," variant"),p)}}return{success:!1,error:u}}function Na(){return Ji(Yi).length>0}function Qg(e,t){if(typeof e!="string"||!e||!Na())return null;var r=xu(vc,e);if(r.hit)return r.candidate;var n=null,o=Ji(Yi);if(!o.length)return null;for(var i=0;i<o.length;i+=1){var s=o[i],a=null;try{a=s.compress(e)}catch(f){console.warn("Unable to compress migration backup payload with ".concat(s.variant," variant"),f);continue}if(!(typeof a!="string"||!a||a.length>=e.length)){var c={createdAt:t,compression:ef,compressionVariant:s.variant,encoding:tf,data:a,originalSize:e.length,compressedSize:a.length},u;try{u=JSON.stringify(c)}catch(f){console.warn("Unable to serialize compressed migration backup payload",f);continue}typeof u!="string"||!u||u.length>=e.length||(!n||u.length<n.serializedLength)&&(n={serialized:u,serializedLength:u.length,originalSize:e.length,compressedSize:a.length,variant:s.variant})}}return Gu(vc,e,n),n}function Xg(e){if(typeof e!="string"||!e)return{createdAt:0,size:typeof e=="string"?e.length:0};const t={createdAt:0,size:e.length};try{const r=JSON.parse(e);if(r&&typeof r=="object"){let n=null;if(typeof r.createdAt=="string"?n=r.createdAt.trim():typeof r.createdAt=="number"&&Number.isFinite(r.createdAt)&&(t.createdAt=r.createdAt),n){const o=Date.parse(n);Number.isNaN(o)||(t.createdAt=o)}else for(let o=0;o<gi.length;o+=1){const i=gi[o];if(typeof r[i]=="string"){const s=r[i].trim();if(s){const a=Date.parse(s);if(!Number.isNaN(a)){t.createdAt=a;break}}}else if(typeof r[i]=="number"&&Number.isFinite(r[i])){t.createdAt=r[i];break}}}}catch{}return t}function of(){return Na()}function vn(e){if(typeof e!="string"||!e||!of())return null;var t=xu(Ic,e);if(t.hit)return t.candidate;var r=Ji(rf);if(!r.length)return null;for(var n=typeof Bc=="number"?Bc:0,o=null,i=null,s=null,a=null,c=String(e.length).length,u=0;u<r.length;u+=1){var f=r[u],l=null;try{l=f.compress(e)}catch(k){console.warn("Unable to compress storage payload with ".concat(f.variant," variant"),k);continue}if(!(typeof l!="string"||!l)){var y;try{y=JSON.stringify(l)}catch(k){console.warn("Unable to serialize compressed storage payload candidate",k);continue}if(!(typeof y!="string"||!y)){var p=typeof f.variantLiteral=="string"&&f.variantLiteral?f.variantLiteral:null,d=typeof f.variantLiteralLength=="number"&&f.variantLiteralLength>0?f.variantLiteralLength:0;if(!p&&typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{p=JSON.stringify(String(f.variant||"")),d=typeof p=="string"&&p?p.length:0}catch{p=null,d=0}var g=null,m=Number.POSITIVE_INFINITY;if(n>0&&d>0){var b=String(l.length).length;m=n+y.length+c+b+d}else{var A={[xt]:!0,version:yi,algorithm:go,namespace:Xr,data:l,originalLength:e.length,compressedPayloadLength:l.length,compressionVariant:f.variant};try{g=JSON.stringify(A)}catch(k){console.warn("Unable to serialize compressed storage payload wrapper",k);continue}if(typeof g!="string"||!g)continue;m=g.length}m<e.length&&(!o||m<o.wrappedLength)&&(o={originalLength:e.length,wrappedLength:m,compressedPayloadLength:l.length,compressionVariant:f.variant},i=g,s=y,a=p)}}}if(o&&(!i||typeof i!="string"))if(typeof s!="string"||!s)o=null;else{var O;if(typeof a=="string"&&a)O=a;else if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{O=JSON.stringify(String(o.compressionVariant||""))}catch{O=null}if(typeof O!="string"||!O)o=null;else{var C='{"'.concat(xt,'":true,"version":').concat(String(yi),',"algorithm":').concat($g,',"namespace":').concat(Vg,',"data":').concat(s,',"originalLength":').concat(String(o.originalLength),',"compressedPayloadLength":').concat(String(o.compressedPayloadLength),',"compressionVariant":').concat(O,"}");i=C}}return o&&i&&typeof i=="string"&&i.length<o.originalLength?(o.serialized=i,o.wrappedLength=i.length):o=null,Gu(Ic,e,o),o}function Co(e){if(typeof e!="string")return{success:!1};if(!e||e.charCodeAt(0)!==123)return{success:!1};if(!e.includes(`"${xt}":true`)||!e.includes(`"namespace":"${Xr}`))return{success:!1};let t;try{t=JSON.parse(e)}catch(o){return{success:!1,error:o}}if(!t||t[xt]!==!0)return{success:!1};if(t.namespace!==Xr)return{success:!1};if(t.version!==yi)return console.warn("Unsupported storage compression version",t.version),{success:!1};if(t.algorithm!==go&&t.algorithm!==zc)return console.warn("Unsupported storage compression algorithm",t.algorithm),{success:!1};if(typeof t.data!="string"||!t.data)return{success:!1};if(!of())return console.warn("Compressed storage payload detected but compression library is unavailable."),{success:!1};var r=null;typeof t.compressionVariant=="string"&&t.compressionVariant?r=t.compressionVariant:t.algorithm===zc&&(r="utf16");var n=nf(t.data,rf,r,"storage payload");return n.success?(!t.compressionVariant&&n.variant&&(t.compressionVariant=n.variant),{success:!0,value:n.value,metadata:t}):{success:!1,error:n.error}}function Qi(e,t){if(typeof e=="string"){const r=Co(e);if(!r.success||typeof r.value!="string")return{restored:!1,value:e};try{return{restored:!0,value:JSON.parse(r.value)}}catch(n){return console.warn("Unable to parse decompressed project entry payload",t||"project entry",n),{restored:!1,value:e}}}if(E(e)&&e[xt]===!0){let r;try{r=JSON.stringify(e)}catch(n){return console.warn("Unable to reserialize compressed project entry wrapper before restoration",t||"project entry",n),{restored:!1,value:e}}if(typeof r=="string"&&r)return Qi(r,t)}return{restored:!1,value:e}}function Xi(e,t){if(typeof e!="string")return;const r=typeof t=="number"&&Number.isFinite(t)?t:Date.now(),n=Ge(e);if(n){Ar.set(n,r),n!==e&&Ar.set(e,r);return}Ar.set(e,r)}function Zg(e,t){if(!e||typeof e!="object")return;const r=Date.now();Object.keys(e).forEach(n=>{typeof n!="string"||!n||Bt(n)||Xi(n,r)})}function Gs(e){if(typeof e!="string")return;const t=Ge(e);Ar.delete(e),t&&t!==e&&Ar.delete(t)}function em(e){if(typeof e!="string")return"";const t=Ge(e);return typeof t=="string"&&t?t:""}function tm(e){if(!ys||typeof ys.has!="function")return!1;const t=em(e);if(!t)return!1;try{return ys.has(t)}catch{}return!1}function rm(e,t){const r=Qi(e,t);return r.restored?r.value:e}function nm(e){return E(e)&&Object.keys(e).forEach(t=>{e[t]=rm(e[t],t)}),e}function om(e){if(!e||typeof e.add!="function")return;const t=[pe,`${pe}${de}`,Xe,`${Xe}${de}`];for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&e.add(n)}}function im(e){if(!e||typeof e.add!="function")return;const t=[at,ar,mt,Ve];for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n!="string"||!n)continue;const o=Ot(n);for(let i=0;i<o.length;i+=1){const s=o[i];typeof s!="string"||!s||(e.add(s),e.add(`${s}${de}`))}}}function en(e,t){if(typeof e!="string")return e;const r=Co(e);return r.success?r.value:e}function sf(e,t){if(!e||typeof e.length!="number"||typeof e.key!="function")return{success:!1,compressed:0,freed:0};if(gf(e))return{success:!1,compressed:0,freed:0};const{skipKeys:r=[],limit:n=Hg,minSavings:o=qg}=t||{},i=new Set;if(Lt&&Yt&&i.add(Yt),Lt&&om(i),im(i),Array.isArray(r))for(let y=0;y<r.length;y+=1){const p=r[y];typeof p=="string"&&p&&i.add(p)}const s=typeof o=="number"&&o>0?o:0,a=e.length,c=[];for(let y=0;y<a;y+=1){let p;try{p=e.key(y)}catch{p=null}if(typeof p!="string"||!p||i.has(p))continue;let d;try{d=e.getItem(p)}catch{continue}if(typeof d!="string"||!d||d.includes(`"${xt}":true`))continue;const g=vn(d);if(!g||typeof g.serialized!="string"||!g.serialized)continue;const m=typeof g.originalLength=="number"&&typeof g.wrappedLength=="number"?g.originalLength-g.wrappedLength:0;m<s||c.push({key:p,serialized:g.serialized,savings:m>0?m:0,originalLength:typeof g.originalLength=="number"?g.originalLength:0})}if(!c.length)return{success:!1,compressed:0,freed:0};c.sort((y,p)=>p.savings!==y.savings?p.savings-y.savings:p.originalLength-y.originalLength);const u=typeof n=="number"&&n>0?Math.min(n,c.length):c.length;let f=0,l=0;for(let y=0;y<c.length&&f<u;y+=1){const p=c[y];if(!(!p||typeof p.serialized!="string"||!p.serialized))try{e.setItem(p.key,p.serialized),f+=1,l+=p.savings}catch{}}return f===0?{success:!1,compressed:0,freed:0}:(typeof console<"u"&&typeof console.warn=="function"&&(l>0?console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery, freeing approximately ${l} characters.`):console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery.`)),{success:!0,compressed:f,freed:l})}function jr(e){return e==null?e:en(e)}function xc(e){if(!e||typeof e.getItem!="function"||on&&typeof on.has=="function"&&on.has(e))return;const t=e.getItem,r=typeof t=="function"?function(i){return t.call(this,i)}:null,n=function(i){const s=r?r.call(this,i):void 0;return en(s)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(o){const i=o&&typeof o.message=="string"&&o.message.includes("Cannot redefine property");i||console.warn("Unable to redefine storage.getItem descriptor for compression support",o);try{e.getItem=n}catch(s){const a=s&&typeof s.message=="string"&&s.message.includes("Cannot assign to read only property");return a||console.warn("Unable to patch storage instance getItem for compression support",s),void 0}}if(r)try{Object.defineProperty(e,Cr,{configurable:!0,writable:!0,value:r})}catch{try{e[Cr]=r}catch{}}if(on&&typeof on.add=="function")try{on.add(e)}catch{}}function sm(){if(typeof Storage>"u"){const i=[];h&&typeof h=="object"&&(h.localStorage&&i.push(h.localStorage),h.sessionStorage&&i.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&i.push(global.localStorage),global.sessionStorage&&i.push(global.sessionStorage)),i.forEach(xc);return}const e=Storage.prototype;if(!e||typeof e.getItem!="function"||e.__cineStorageCompressionPatched)return;const t=e.getItem,r=function(s){return t.call(this,s)},n=function(s){const a=r.call(this,s);return en(a)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(i){console.warn("Unable to patch Storage.getItem for compression support",i);return}try{Object.defineProperty(e,Cr,{configurable:!0,writable:!1,value:r})}catch{try{e[Cr]=r}catch{}}try{Object.defineProperty(e,"__cineStorageCompressionPatched",{configurable:!0,writable:!1,value:!0})}catch{e.__cineStorageCompressionPatched=!0}const o=[];h&&typeof h=="object"&&(h.localStorage&&o.push(h.localStorage),h.sessionStorage&&o.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&o.push(global.localStorage),global.sessionStorage&&o.push(global.sessionStorage)),o.forEach(xc)}function Ma(e){if(!e||typeof e!="object")return null;const t=e[Cr];if(typeof t=="function")return t;const r=Object.getPrototypeOf(e);return r&&typeof r[Cr]=="function"?r[Cr]:null}function Yn(e,t,r){if(!e||typeof t!="string"||!t)return null;const n=typeof r=="function"?r:Ma(e);if(typeof n!="function")return null;try{return n.call(e,t)}catch{return null}}function am(e,t){if(!e)return[];let r;try{r=za(e,{suppressAlerts:!0})}catch(n){return console.warn("Unable to inspect storage while preparing migration backup cleanup",n),[]}return!r||typeof r!="object"?[]:Object.keys(r).filter(n=>!(typeof n!="string"||!n||!n.endsWith(Nr)||t&&n===t)).map(n=>{const o=r[n],i=typeof o=="string"?o:o==null?"":String(o),s=Xg(i);return{key:n,createdAt:s.createdAt,size:s.size}}).sort((n,o)=>n.createdAt&&o.createdAt&&n.createdAt!==o.createdAt?n.createdAt-o.createdAt:n.createdAt&&!o.createdAt?-1:!n.createdAt&&o.createdAt?1:n.size!==o.size?o.size-n.size:n.key.localeCompare(o.key))}function af(e,t){const r=am(e,t);if(!r.length)return[];const n=[],o=r[0];try{e.removeItem(o.key),n.push(o.key)}catch(i){console.warn(`Unable to remove migration backup ${o.key} during cleanup`,i)}return n}function Gc(e,t,r,n){if(!e||typeof e.setItem!="function")return{success:!1,error:null};const o=[];let i=null;if(typeof n!="function")return{success:!1,error:null};const s=()=>{const a=n();return a&&typeof a=="object"&&"error"in a&&a.error&&(i=a.error),a&&a.success?{success:!0,quota:!1}:a&&a.quota?{success:!1,quota:!0,error:a.error||null}:{success:!1,quota:!1,error:a&&a.error?a.error:null}};if(typeof or=="function"){let a=!1;try{or(),a=!0}catch(c){console.warn("Unable to clear cached UI storage entries before creating migration backup",c)}if(a){const c=s();if(c.success)return console.warn(`Cleared cached planner data to free storage before creating migration backup for ${t}.`),{success:!0,error:null};if(!c.quota)return{success:!1,error:c.error}}}for(let a=0;a<Kg;a+=1){const c=af(e,r);if(!c.length)break;o.push(...c);const u=s();if(u.success)return console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} to free up storage before creating migration backup for ${t}.`,o),{success:!0,error:null};if(!u.quota)return{success:!1,error:u.error}}return o.length>0&&console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} while attempting to create migration backup for ${t}, but storage quota is still exceeded.`,o),{success:!1,error:i}}function qe(e,t){if(!e||typeof e.getItem!="function"||!t)return null;let r=null;try{r=e.getItem(t)}catch(i){return console.warn(`Unable to inspect existing value for ${t} before creating migration backup`,i),null}if(r==null)return null;let n=r,o=r;if(typeof r=="string"&&r)if(o=en(r),typeof o=="string"&&o)try{n=JSON.parse(o)}catch{}else n=o;return n&&typeof n=="object"&&(Array.isArray(n)&&n.length===0||!Array.isArray(n)&&Object.keys(n).length===0)||lt(e,t,n),n}var Fc=["payload","value","content","entries","snapshot","state","record"],gi=["iso","timestamp","time"];function To(e){try{return JSON.stringify(e)}catch(t){return console.warn("Unable to serialize normalized migration backup payload",t),null}}function Dc(e,t){const r=typeof t=="string"&&t?t:null;if(typeof e=="string"){const o=e.trim();if(!o)return{value:r||new Date().toISOString(),changed:!0};const i=Number(o);if(!Number.isNaN(i)&&Number.isFinite(i)&&String(i)===o)try{return{value:new Date(i).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}const s=Date.parse(o);if(!Number.isNaN(s))try{const a=new Date(s).toISOString();return{value:a,changed:a!==o}}catch{return{value:r||new Date().toISOString(),changed:!0}}return{value:o,changed:o!==e}}if(typeof e=="number"&&Number.isFinite(e))try{return{value:new Date(e).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}if(e instanceof Date){const o=e.getTime();if(Number.isFinite(o))try{return{value:e.toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}}return r?{value:r,changed:!0}:{value:new Date().toISOString(),changed:!0}}function cm(e,t){if(typeof e!="string"||!e)return null;const r=typeof t=="string"&&t?t:new Date().toISOString();let n;try{n=JSON.parse(e)}catch{return To({createdAt:r,data:e})}if(!n||typeof n!="object")return To({createdAt:r,data:n===void 0?e:n});if(Array.isArray(n)){let f=!1;const l=n.map(y=>{if(!y||typeof y!="object")return f=!0,{createdAt:r,data:y};const p=Object.prototype.hasOwnProperty.call(y,"data"),d=y.createdAt,{value:g,changed:m}=Dc(d,r);return p?m||d!==g?(f=!0,{...y,createdAt:g}):y:(f=!0,{createdAt:g,data:y})});return f?To(l):null}let o,i=!1;if(Object.prototype.hasOwnProperty.call(n,"data"))o={...n};else{let f=null;for(let l=0;l<Fc.length;l+=1){const y=Fc[l];if(Object.prototype.hasOwnProperty.call(n,y)){f=y;break}}f?(o={...n},o.data=n[f],delete o[f],i=!0):(o={data:n},i=!0)}let s=o.createdAt,a="createdAt";if(s===void 0)for(let f=0;f<gi.length;f+=1){const l=gi[f];if(Object.prototype.hasOwnProperty.call(n,l)){s=n[l],a=l;break}}const{value:c,changed:u}=Dc(s,r);return o.createdAt=c,a!=="createdAt"&&a&&Object.prototype.hasOwnProperty.call(o,a)&&(delete o[a],i=!0),u&&(i=!0),i?To(o):null}function lm(e,t,r,n){const o=cm(r,n);if(o===null)return!0;if(typeof o!="string"||!o)return!1;if(o===r)return!0;try{return e.setItem(t,o),!0}catch(i){return console.warn(`Unable to normalize legacy migration backup for ${t}`,i),!1}}function lt(e,t,r){if(!e||typeof e.setItem!="function"||r==null)return;const n=`${t}${Nr}`;let o=!1;if(typeof e.getItem=="function")try{const d=e.getItem(n);if(d!=null){o=!0;const g=new Date().toISOString();lm(e,n,d,g)}}catch(d){console.warn(`Unable to inspect migration backup for ${t}`,d)}if(o)try{const d=e.getItem(n),g=jr(d);let m=null;try{m=JSON.parse(g)}catch(_){m=g}let b=Array.isArray(m)?m:[m];const A={createdAt:new Date().toISOString(),data:r};b.push(A);const O=5;b.length>O&&(b=b.slice(b.length-O));const C=_=>{try{return e.setItem(n,JSON.stringify(_)),{success:!0}}catch(v){return{success:!1,quota:It(v),error:v}}};let k=C(b);for(;!k.success&&k.quota&&b.length>1;)b.shift(),console.warn(`Pruning oldest migration backup for ${t} due to quota limit.`),k=C(b);if(k.success)return;if(!k.success&&k.quota){const _=Gc(e,t,n,()=>C(b));if(_&&_.success)return}console.warn("Unable to append to migration backup",k.error);return}catch(d){console.warn("Unable to append to migration backup",d);return}let i;const s=new Date().toISOString();try{i=JSON.stringify({createdAt:s,data:r})}catch(d){console.warn(`Unable to serialize migration backup for ${t}`,d);return}const a=(d,g={})=>{const{logCompression:m=!1,info:b=null}=g||{};try{if(e.setItem(n,d.serialized),m&&b&&!a.compressionLogged){a.compressionLogged=!0;const A=typeof b.serializedLength=="number"?b.serializedLength:b.compressedSize,O=b.originalSize-A,C=O>0?O:0,k=b.originalSize>0?Math.round(C/b.originalSize*100):0,_=`Stored compressed migration backup for ${t} to reduce storage usage by ${C} characters (${k}%) using ${b.variant||"unknown"} variant.`;Wi("migration-backup",t,_,C,k)}return{success:!0,quota:!1}}catch(A){return{success:!1,quota:It(A),error:A}}};a.compressionLogged=a.compressionLogged||!1;const c={serialized:i},u=a(c);if(u.success)return;const f=d=>{console.warn(`Unable to create migration backup for ${t}`,d)};if(!u.quota){f(u.error);return}const y=!Xu(t)?Qg(i,s):null,p=(d,g,m)=>{const b=Gc(e,t,n,()=>a(d,g));if(b&&b.success)return!0;const A=b&&b.error?b.error:m;return f(A),le("migration-backup-quota"),!1};if(y){const d=a(y,{logCompression:!0,info:y});if(d.success)return;if(!d.quota){f(d.error);return}return p(y,{logCompression:!0,info:y},d.error),void 0}p(c,{},u.error)}var Uc=[Ve,Xe,bt,Wt,pe,st,wt,vr,Zr,Rt,Tt,ht,ot,nr,Nt,Mt,Je],Kc=[ct,Pr(),"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",er,rr],hn="__cameraPowerPlannerStorageAlertShown",qo="__cameraPowerPlannerSessionFallbackAlertShown",Wo=!1;h&&(typeof h[hn]=="boolean"?Wo=h[hn]:h[hn]=!1);var Fs=!1;h&&(typeof h[qo]=="boolean"?Fs=h[qo]:h[qo]=!1);var um=["cameras","monitors","video","viewfinders","directorMonitors","iosVideo","videoAssist","media","lenses","batteries","batteryHotswaps","wirelessReceivers"],fm=["motors","handUnits","controllers","distance"],pm=["chargers","cages","powerPlates","cameraSupport","matteboxes","filters","rigging","batteries","cables","videoAssist","media","cardReaders","tripodHeads","tripods","sliders","cameraStabiliser","grip","carts"],dm=()=>typeof navigator<"u"&&navigator&&typeof navigator.storage=="object"?navigator.storage:null,Ds="__storage_test__",ym=new Set(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"]),gm=new Set([22,1014]),mm=new Set([22,1014]);function It(e){return!e||typeof e!="object"?!1:!!(typeof e.code=="number"&&gm.has(e.code)||typeof e.number=="number"&&mm.has(e.number)||typeof e.name=="string"&&ym.has(e.name))}function hm(e){if(!e)return!1;try{if(typeof e.length=="number"&&e.length>0)return!0}catch(t){console.warn("Unable to read storage length after quota error",t)}if(typeof e.getItem=="function")try{for(let t=0;t<Uc.length;t+=1){const r=Uc[t],n=Ot(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;const s=`${i}${de}`;if(e.getItem(s)!==null)return!0}}for(let t=0;t<Kc.length;t+=1){const r=Kc[t],n=Ot(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;if(kt.has(i)){const s=`${i}${de}`;if(e.getItem(s)!==null)return!0}}}}catch(t){console.warn("Unable to inspect known storage keys after quota error",t)}if(typeof e.key=="function")try{const t=typeof e.length=="number"?e.length:0;for(let r=0;r<t;r+=1){const n=e.key(r);if(typeof n=="string"&&n)return!0}}catch(t){console.warn("Unable to iterate storage keys after quota error",t)}return!1}function mi(e){if(!e)return null;try{e.setItem(Ds,"1")}catch(t){if(It(t)&&hm(e))return console.warn("localStorage quota exceeded. Existing planner data will remain available but new saves may fail.",t),e;throw t}try{e.removeItem(Ds)}catch(t){console.warn("Unable to clean up storage test key",t)}return e}function cf(){let e={};return{get length(){return Object.keys(e).length},key(t){const r=Object.keys(e);return t>=0&&t<r.length?r[t]:null},getItem(t){return Object.prototype.hasOwnProperty.call(e,t)?en(e[t]):null},setItem(t,r){e[t]=String(r)},removeItem(t){delete e[t]},clear(){e={}},keys(){return Object.keys(e)}}}function lf(){const e=ju();for(let t=0;t<e.length;t+=1){const r=e[t];if(r)try{const n=mi(r);if(n)return Sr=null,{storage:n,type:"local"}}catch(n){console.warn("localStorage is unavailable:",n),Sr=r}}if(typeof window<"u")try{if("sessionStorage"in window){const t=mi(window.sessionStorage);if(t)return Kr(t),console.warn("Falling back to sessionStorage; data persists for this tab only."),yf(),{storage:t,type:"session"}}}catch(t){console.warn("sessionStorage fallback is unavailable:",t)}return le(),{storage:cf(),type:"memory"}}var Sr=null,D=lf();function bm(e,t){const r=[],n=[];return!e||!t||typeof t.setItem!="function"?{migratedKeys:r,failedKeys:n}:(Object.keys(e).forEach(o=>{const i=e[o];if(i==null)return;let s=null,a=!1;try{s=t.getItem(o),a=!0}catch(c){console.warn("Unable to inspect localStorage during upgrade",o,c)}if(a&&s!==null&&s!==void 0&&s!==i&&lt(t,o,s),a&&s===i){r.push(o);return}try{t.setItem(o,i),r.push(o)}catch(c){console.warn("Unable to migrate storage key during upgrade",o,c),n.push(o)}}),{migratedKeys:r,failedKeys:n})}function Sm(e,t,r){if(!e||!t||typeof t.removeItem!="function")return;(Array.isArray(r)&&r.length>0?r:Object.keys(e)).forEach(o=>{try{t.removeItem(o)}catch(i){console.warn("Unable to remove migrated storage key from fallback",o,i)}})}function wm(e,t){!e||typeof e.removeItem!="function"||!Array.isArray(t)||t.forEach(r=>{try{e.removeItem(r)}catch(n){console.warn("Unable to roll back migrated storage key after upgrade failure",r,n)}})}function za(e,t={}){const r=Object.create(null);if(!e)return r;const{suppressAlerts:n=!1}=t||{},o=i=>{if(typeof i!="string"||!i)return;let s;try{typeof e.getItem=="function"?s=e.getItem(i):Object.prototype.hasOwnProperty.call(e,i)&&(s=e[i])}catch(a){console.warn("Unable to read storage key during snapshot",i,a),n||le("migration-read");return}s!=null&&(r[i]=String(s))};if(typeof e.key=="function"&&typeof e.length=="number"){for(let i=0;i<e.length;i+=1)o(e.key(i));return r}if(typeof e.keys=="function"){try{const i=e.keys();Array.isArray(i)&&i.forEach(o)}catch(i){console.warn("Unable to enumerate storage keys during snapshot",i),n||le("migration-read")}return r}if(typeof e.forEach=="function"){try{e.forEach((i,s)=>{typeof s=="string"&&i!=null&&(r[s]=String(i))})}catch(i){console.warn("Unable to iterate storage entries during snapshot",i),n||le("migration-read")}return r}return Object.keys(e).forEach(o),r}function uf(){if(!(!h||typeof h!="object"))try{Object.defineProperty(h,"SAFE_LOCAL_STORAGE",{configurable:!0,get:T});return}catch{try{h.SAFE_LOCAL_STORAGE=T();return}catch(t){console.warn("Unable to refresh SAFE_LOCAL_STORAGE global reference",t)}}}function we(e,t,r){if(!D||D.type==="memory")return;const n=D.storage;if(!n||r&&r!==n)return;let o=Object.create(null);try{o=za(n,{suppressAlerts:!0})}catch(c){console.warn("Unable to capture storage snapshot during downgrade",c)}let i=null,s="memory";if(D.type!=="session"){const c=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let u=0;u<c.length;u+=1){const f=va(c[u]);if(!(!f||f===n||r&&f===r))try{const l=mi(f);if(l){i=l,s="session",Kr(l);break}}catch(l){console.warn("Unable to activate sessionStorage fallback during downgrade",l)}}}i||(i=cf()),Object.keys(o).forEach(c=>{const u=o[c];if(u!=null)try{typeof i.setItem=="function"?i.setItem(c,u):i[c]=u}catch(f){console.warn(`Unable to copy storage entry to ${s==="session"?"sessionStorage":"memory"} during downgrade`,c,f)}}),D={storage:i,type:s},Sr=null;const a=s==="session"?"sessionStorage":"in-memory fallback";console.warn(e?`Downgraded planner storage to ${a} after ${e} errors.`:`Downgraded planner storage to ${a} after storage errors.`,t),s==="session"&&yf(),uf()}function Em(){if(!D||D.type==="local")return D.storage;const e=ju(),t=D.storage;let r=null,n=null;for(let a=0;a<e.length;a+=1){const c=e[a];if(!c||c===t||c===Sr)continue;let u;try{u=mi(c)}catch(f){console.warn("localStorage upgrade verification failed",f),Sr=c;continue}if(!u||u===t){u||(Sr=c);continue}r=c,n=u;break}if(!n)return t;const o=za(t),{migratedKeys:i,failedKeys:s}=bm(o,n);return s.length>0?(wm(n,i),console.warn("Aborting localStorage upgrade because some entries could not be migrated. Continuing to use fallback storage.",s),le("migration-write"),Sr=r||n,t):(Sm(o,t,i),D={storage:n,type:"local"},Sr=null,n)}function T(){return P&&P.driver&&P.driver.storage?P.driver.storage:((!D||!D.storage)&&(D=lf(),typeof console<"u"&&console.log&&console.log("DEBUG: storage initialized with type:",D.type)),D.type!=="local"&&Em(),D.storage)}uf();sm();var Kn=null;function ff(){const e=dm();if(!(e&&typeof e.persist=="function"))return Promise.resolve({supported:!1,granted:!1,alreadyGranted:!1});if(Kn)return Kn;const n=(async()=>{let o=!1;const i=typeof e.persisted=="function";if(i)try{o=await e.persisted()}catch(s){console.warn("Unable to determine persistent storage state",s)}if(o)return{supported:!0,granted:!0,alreadyGranted:!0};try{const s=await e.persist();if(!s&&i)try{if(await e.persisted())return{supported:!0,granted:!0,alreadyGranted:!0}}catch(a){console.warn("Unable to verify persistent storage after request",a)}return{supported:!0,granted:s,alreadyGranted:!1}}catch(s){return console.warn("Persistent storage request failed",s),{supported:!0,granted:!1,alreadyGranted:!1,error:s}}})().then(o=>((!o||o.granted!==!0)&&(Kn=null),o),o=>{throw Kn=null,o});return Kn=n,n}typeof window<"u"&&typeof navigator<"u"&&ff();function E(e){if(e===null||typeof e!="object")return!1;let t;try{t=Object.getPrototypeOf(e)}catch{return!1}if(t===null||t===Object.prototype)return!0;if(Object.getPrototypeOf(t)===null&&typeof t.constructor=="function"){const n=t.constructor.name;return n==="Object"||n===""}return!1}function re(e){if(!e||typeof e!="object")return!1;if(Object.prototype.toString.call(e)==="[object Map]")return!0;if(typeof Map<"u")try{if(e instanceof Map)return!0}catch{}return typeof e.size=="number"&&typeof e.entries=="function"&&typeof e.forEach=="function"&&typeof e.get=="function"&&typeof e.set=="function"}function pf(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(typeof e=="symbol")return e.description||e.toString();if(e&&typeof e=="object")try{const t=JSON.stringify(e);if(t&&t!=="{}")return t}catch{}try{return String(e)}catch{}return null}function ne(e){if(!re(e))return null;const t=Object.create(null),r=(o,i)=>{const s=pf(o);s!=null&&(Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i))};let n=!1;if(typeof e.entries=="function")try{const o=e.entries();if(o&&typeof o.next=="function"){for(let i=o.next();!i.done;i=o.next()){const s=i&&i.value;Array.isArray(s)&&s.length>=2&&r(s[0],s[1])}n=!0}}catch(o){console.warn("Unable to iterate map-like value entries",o)}if(!n&&typeof e.forEach=="function")try{e.forEach((o,i)=>{r(i,o)}),n=!0}catch(o){console.warn("Unable to iterate map-like value via forEach",o)}return!Object.keys(t).length&&!n?null:t}var mo=/^long[\s_-]?gop$/i;function $c(e){if(typeof e!="string")return null;var t=e.trim();if(!t)return null;var r=t.toLowerCase();return r==="utf16"||r==="utf-16"?"utf16":r==="uri-component"||r==="uri_component"||r==="encoded-uri-component"||r==="uri"?"uri-component":r==="base64"?"base64":mo.test(r)?"utf16":null}function Vc(e){if(typeof e!="string")return e;const t=e.trim();return mo.test(t)?"long-gop":e}function Om(e){return typeof e!="string"?e:mo.test(e)?"long-gop":e}function fe(e,t){if(e===null||typeof e!="object")return Vc(e);const r=t||new WeakSet;if(r.has(e))return e;if(r.add(e),Array.isArray(e)){let n=!1;const o=e.map(i=>{const s=fe(i,r);return s!==i&&(n=!0),s});return n?o:e}if(E(e)){let n=!1;const o={};return Object.keys(e).forEach(i=>{const s=Om(i),a=e[i],c=fe(a,r);(s!==i||c!==a)&&(n=!0),o[s]=c}),n?o:e}return Vc(e)}function Ba(e){if(!Array.isArray(e))return{normalized:Array.isArray(e)?e:[],changed:!1};let t=!1;return{normalized:e.map(n=>{if(n==null)return n;const o=fe(n);return o!==n&&(t=!0),o}),changed:t}}function xa(e){if(typeof e!="string")return{timestamp:Number.NEGATIVE_INFINITY,label:""};const t=(r,n={})=>{const i=e.slice(r.length).split("-");if(i.length<5)return null;const[s,a,c,u,f]=i,l=Number.parseInt(s,10),y=Number.parseInt(a,10)-1,p=Number.parseInt(c,10),d=Number.parseInt(u,10),g=Number.parseInt(f,10);if([l,y,p,d,g].some(_=>Number.isNaN(_)))return null;let m=!1,b=0,A=5;if(i.length>A){const _=i[A];if(/^\d{1,2}$/u.test(_))m=!0,b=Number.parseInt(_,10),A+=1;else if(n.requireSeconds)return null}else if(n.requireSeconds)return null;const O=i.slice(A).join("-").trim(),k=new Date(l,y,p,d,g,m?b:0,0).getTime();return Number.isNaN(k)?null:{timestamp:k,label:O}};if(e.startsWith(Fe)){const r=t(Fe);return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}if(e.startsWith(Et)){const r=t(Et,{requireSeconds:!1});return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}return{timestamp:Number.NEGATIVE_INFINITY,label:""}}function hi(e,t){return!E(e)||typeof t!="string"?[]:Object.keys(e).filter(r=>typeof r=="string"&&r.startsWith(t)).map(r=>{const{timestamp:n,label:o}=xa(r);return{key:r,timestamp:n,label:o}}).sort((r,n)=>r.timestamp!==n.timestamp?r.timestamp-n.timestamp:r.key.localeCompare(n.key))}function Am(e){if(!(!e||typeof e!="object")){try{e[Hr]=!0}catch{try{Object.defineProperty(e,Hr,{configurable:!0,enumerable:!0,writable:!0,value:!0})}catch{}}if(E(e.projectInfo))try{e.projectInfo[Hr]=!0}catch{}}}function Cm(e){return!e||typeof e!="object"?!1:!!(e[Hr]===!0||E(e.projectInfo)&&e.projectInfo[Hr]===!0)}function Ga(e,t){return!E(e)||typeof t!="string"?!1:Cm(e[t])}function df(e){if(!e||typeof e!="object")return"";if(typeof e.label=="string"){const t=e.label.trim();if(t)return t}if(typeof e.key=="string"&&e.key.trim()){const t=e.key.trim();return t.startsWith(Fe)||t.startsWith(Et)?"__auto-backup:unlabeled__":t}return"__auto-backup:unlabeled__"}function _m(e,t){if(!E(e)||!t||typeof t.key!="string")return"undefined";const r=Object.prototype.hasOwnProperty.call(e,t.key)?e[t.key]:void 0;try{let n=r;if(E(r)&&r[gn]){const i=be(r,{stripMetadata:!0}),s=i[gn];if(s&&typeof s=="object")try{const a=xs(s,t.key);s.payload=a.payload,Object.prototype.hasOwnProperty.call(s,"payloadCompression")&&delete s.payloadCompression}catch(a){console.warn("Failed to expand automatic backup payload for signature comparison",t.key,a)}n=i}const o=Bs(n,{stripMetadata:!0});return Ce(o)}catch(n){return console.warn("Failed to create stable signature for automatic backup entry",n),"undefined"}}function Ce(e,t){const r=t||(typeof WeakSet=="function"?{seen:new WeakSet,reportedCycle:!1}:null),n=r&&r.seen?r.seen:null,o=(i,s)=>{if(!n)return s();if(n.has(i))return!r.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Detected circular reference while computing automatic backup signature. Using a placeholder token to keep backups stable."),r.reportedCycle=!0,Wu;n.add(i);try{return s()}finally{n.delete(i)}};if(e===null)return"null";if(e===void 0)return"undefined";if(Array.isArray(e))return o(e,()=>{let i="[";for(let s=0;s<e.length;s+=1)s>0&&(i+=","),i+=Ce(e[s],r);return i+="]",i});if(e instanceof Date)return o(e,()=>{const i=e.getTime();return Number.isNaN(i)?"date:invalid":`date:${i}`});if(E(e))return o(e,()=>{const i=Object.keys(e).sort();let s="{";for(let a=0;a<i.length;a+=1){const c=i[a];a>0&&(s+=","),s+=`${JSON.stringify(c)}:${Ce(e[c],r)}`}return s+="}",s});if(e&&typeof e=="object")return o(e,()=>`${typeof e}:${String(e)}`);if(typeof e=="number")return Number.isNaN(e)?"number:NaN":Number.isFinite(e)?`number:${e}`:e>0?"number:Infinity":"number:-Infinity";if(typeof e=="bigint")return`bigint:${e.toString()}`;if(typeof e=="boolean")return e?"boolean:true":"boolean:false";if(typeof e=="string"){const i=Co(e);if(i.success&&typeof i.value=="string")try{const s=JSON.parse(i.value);return Ce(s,r)}catch(s){console.warn("Unable to decode compressed string while computing stable value signature",s)}return`string:${e}`}return typeof e=="symbol"?`symbol:${String(e)}`:typeof e=="function"?`function:${e.name||"anonymous"}`:`${typeof e}:${String(e)}`}function Us(e,t){if(!E(e)||!Array.isArray(t)||t.length<2)return null;const r=new Map;for(let n=t.length-1;n>=0;n-=1){const o=t[n];if(!o||typeof o.key!="string"||Ga(e,o.key))continue;const i=df(o);let s=r.get(i);s||(s=new Map,r.set(i,s));const a=Object.prototype.hasOwnProperty.call(e,o.key)?e[o.key]:void 0,c=Ce(a),u=s.get(c);if(u&&typeof u.key=="string")return delete e[o.key],t.splice(n,1),typeof console<"u"&&typeof console.info=="function"&&console.info("Removed duplicate automatic backup while preserving newer copy.",{removedKey:o.key,preservedKey:u.key,label:i}),o.key;s.set(c,{key:o.key,signature:c})}return null}function Hc(e,t){const r=[];for(;;){const n=Us(e,t);if(!n)break;r.push(n)}return r}function qc(e,t,r,n){if(!E(e)||!Array.isArray(t)||t.length<=r)return;const o=new Map;for(let s=0;s<t.length;s+=1){const a=t[s];if(!a||typeof a.key!="string")continue;const c=df(a),u=_m(e,a),f=`${c}__${u}`,l=o.get(f);l?l.push(s):o.set(f,[s])}const i=Array.from(o.values()).filter(s=>Array.isArray(s)&&s.length>1).flatMap(s=>s.slice(0,-1)).sort((s,a)=>s-a);if(!i.length){t.length>r&&console.warn("Skipped trimming automatic backups because all remaining versions are unique.",{limit:r,total:t.length});return}for(let s=i.length-1;s>=0&&t.length>r;s-=1){const a=i[s],c=t[a];!c||typeof c.key!="string"||Ga(e,c.key)||(delete e[c.key],t.splice(a,1),n.push(c.key))}t.length>r&&console.warn("Unable to trim automatic backups down to the configured limit without losing unique data.",{limit:r,remaining:t.length})}function Fa(e){if(!E(e))return[];const t=[],r=hi(e,Fe);t.push(...Hc(e,r)),r.length>un&&qc(e,r,un,t);const n=hi(e,Et);return t.push(...Hc(e,n)),n.length>Nc&&qc(e,n,Nc,t),t.length>0&&console.warn(`Removed ${t.length} older automatic backup${t.length>1?"s":""} to stay within storage limits.`,t),t}function Ks(e,t={}){if(!E(e))return null;const{force:r=!1}=t,n=(f,{respectRename:l=!0}={})=>{if(!Array.isArray(f)||f.length===0)return null;for(let y=0;y<f.length;y+=1){const p=f[y];if(!p||typeof p.key!="string")continue;const d=Object.prototype.hasOwnProperty.call(e,p.key),g=d?e[p.key]:void 0;if(!d||g===void 0||g===null||typeof g!="object")return delete e[p.key],p.key;if(!(l&&Ga(e,p.key)))return delete e[p.key],p.key}return null},o=hi(e,Fe),i=Us(e,o);if(i)return i;const s=hi(e,Et),a=Us(e,s);if(a)return a;const c=n(s,{respectRename:!1});if(c)return c;s.length>0&&console.warn("Unable to free space by removing pre-deletion backups because all copies appear to be protected.");const u=n(o,{respectRename:!r});return u||(o.length>0&&console.warn("Unable to free space by removing automatic backups because the remaining copies were renamed or protected."),null)}function km(e){if(!e||typeof e!="object")return"";if(typeof e.note=="string"){const t=e.note.trim();if(t)return t}if(typeof e.createdAt=="string"){const t=e.createdAt.trim();if(t)return t}return typeof e.id=="string"?e.id:""}function $s(e){if(!Array.isArray(e)||e.length===0)return null;const t=r=>{const[n]=e.splice(r,1);return{removed:n,label:km(n)}};for(let r=e.length-1;r>=0;r-=1){const n=e[r];if(!n||typeof n!="object"||!Array.isArray(n.rules))return t(r)}return t(e.length-1)}function Pm(e){if(!e||typeof e.getItem!="function"||typeof e.removeItem!="function")return!1;const t=`${Rt}${Nr}`,r=[];try{const n=e.getItem(t);n!=null&&(e.removeItem(t),r.push(t))}catch(n){console.warn("Unable to inspect automatic gear backup migration snapshot while recovering storage quota.",n)}try{const n=af(e,t);Array.isArray(n)&&n.length>0&&r.push(...n)}catch(n){console.warn("Unable to prune migration backups while recovering storage for automatic gear backups.",n)}return r.length>0?(console.warn(`Removed ${r.length} migration backup${r.length>1?"s":""} while freeing storage for automatic gear backups.`,r),!0):!1}function Vs(){if(typeof or!="function")return!1;try{return or(),console.warn("Cleared cached planner data to free up storage space before saving automatic gear backups."),!0}catch(e){console.warn("Unable to clear cached planner data while recovering storage for automatic gear backups.",e)}return!1}function Im(e){return e?!(e==="migration-read"&&typeof D<"u"&&D&&D.type&&D.type!=="memory"):!0}function le(e){if(!Im(e)||(h&&typeof h[hn]=="boolean"&&(Wo=h[hn]),Wo)||(Wo=!0,h&&(h[hn]=!0),typeof window>"u"||typeof window.alert!="function"))return;let t="Storage error: Unable to access local data. Changes may not be saved.";try{if(typeof window<"u"&&window.texts){const r=window.texts,n=window.currentLang||"en",o=r[n]?n:"en";t=r[o]?.alertStorageError||t}}catch{}window.alert(t)}function yf(){if(Fs||(Fs=!0,h&&(h[qo]=!0),typeof window>"u"||typeof window.alert!="function"))return;let e="Warning: Local storage is unavailable. Data will only persist for this browser tab.";try{if(typeof window<"u"&&window.texts){const t=window.texts,r=window.currentLang||"en",n=t[r]?r:"en";e=t[n]?.alertSessionFallback||e}}catch{}window.alert(e)}function jn(e){if(typeof window>"u")return null;try{return window[e]}catch(t){return console.warn(`Unable to access ${e} during legacy migration`,t),null}}function ho(e){if(!Array.isArray(e)||e.length===0)return[];const t=[],r=new Set;for(let n=0;n<e.length;n+=1){const o=e[n];!o||typeof o.getItem!="function"||r.has(o)||(r.add(o),t.push(o))}return t}function vm(e,t,r,n,o={}){if(!e||typeof e.getItem!="function")return!1;const{keepLegacy:i=!1}=o;let s;try{s=e.getItem(r)}catch(c){return console.warn(`Unable to read legacy storage key ${r}`,c),le("migration-read"),!1}if(s==null)return!1;const a=t&&typeof t.setItem=="function"?t:e;try{const c=a.getItem(n);if(c!=null){if(!i&&(e!==a||r!==n))try{e.removeItem(r)}catch(u){console.warn(`Unable to remove legacy storage key ${r}`,u)}return!1}}catch(c){console.warn(`Unable to inspect destination storage for ${n}`,c)}try{a.setItem(n,s)}catch(c){return console.warn(`Unable to migrate legacy storage key ${r}`,c),!1}if(!i)try{e.removeItem(r)}catch(c){console.warn(`Unable to remove legacy storage key ${r} after migration`,c)}return!0}function No(e,t,r,n,o){let i=!1;for(let s=0;s<e.length;s+=1)vm(e[s],t,r,n,o)&&(i=!0);return i}function jm(){const e=T(),t=ho([jn("localStorage"),e]),r=ho([jn("sessionStorage"),typeof sessionStorage<"u"?sessionStorage:null]),n="cinePowerPlanner_";[{legacy:`${n}devices`,modern:Ve},{legacy:`${n}setups`,modern:Xe},{legacy:`${n}session`,modern:bt,includeSession:!0},{legacy:`${n}feedback`,modern:Wt},{legacy:`${n}project`,modern:pe},{legacy:`${n}projects`,modern:pe},{legacy:`${n}favorites`,modern:st},{legacy:`${n}ownGear`,modern:ar},{legacy:`${n}schemaCache`,modern:wt},{legacy:`${n}autoGearRules`,modern:vr},{legacy:`${n}autoGearBackups`,modern:Rt},{legacy:`${n}autoGearSeeded`,modern:Zr},{legacy:`${n}autoGearPresets`,modern:Tt},{legacy:`${n}autoGearActivePreset`,modern:ht},{legacy:`${n}autoGearAutoPreset`,modern:ot},{legacy:`${n}autoGearShowBackups`,modern:nr},{legacy:`${n}autoGearBackupRetention`,modern:Mt},{legacy:`${n}autoGearMonitorDefaults`,modern:Nt},{legacy:`${n}customFonts`,modern:$r,updateFontKey:!0}].forEach(({legacy:i,modern:s,includeSession:a=!1,updateFontKey:c=!1})=>{const u=No(t,e,i,s);No(t,e,`${i}${de}`,`${s}${de}`),a&&(No(r,null,i,s),No(r,null,`${i}${de}`,`${s}${de}`)),c&&u&&h&&(h.CUSTOM_FONT_STORAGE_KEY===i&&(h.CUSTOM_FONT_STORAGE_KEY=s),h.CUSTOM_FONT_STORAGE_KEY_NAME===i&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=s))})}function _e(){jm()}function gf(e){if(!e||typeof e.getItem!="function")return!1;if(yn&&typeof yn.has=="function"&&yn.has(e))return!0;if(D&&D.type==="session"&&D.storage===e)return Kr(e),!0;const t=T();if(t&&D&&D.type==="session"&&t===e)return Kr(e),!0;const r=[h,h&&h.__cineGlobal?h.__cineGlobal:null,h&&h.window?h.window:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let n=0;n<r.length;n+=1){const o=va(r[n]);if(o&&o===e)return Kr(o),!0}return!1}function Te(e,t,r,n=null,o={}){if(!e)return n;const{disableBackup:i=!1,backupKey:s,validate:a,restoreIfMissing:c=!1,alertOnFailure:u=null,migrationBackupKey:f}=o||{},l=typeof s=="string"&&s?s:`${t}${de}`,y=!i&&l&&l!==t,p=Lu()||h&&h.__cineJustFactoryReset,d=y&&!p,g=!p,m=(()=>{const N=new Set,z=[],M=$=>{typeof $!="string"||!$||N.has($)||(N.add($),z.push($))};typeof f=="string"&&f&&M(f);const B=Ot(t);for(let $=0;$<B.length;$+=1)M(`${B[$]}${Nr}`);return z})(),b=Ma(e);let A=typeof b=="function"?Yn(e,t,b):void 0,O=!1;const C=(N,z)=>{if(N==null)return{ok:!1,reason:"missing"};const M=typeof N=="string"?en(N):N;if(typeof N=="string"&&N&&M===N&&N.includes(`"${xt}":true`)&&N.includes(`"namespace":"${Xr}`))return console.warn(`${r} Compressed value could not be decoded${z?` (${z})`:""}.`),O=!0,{ok:!1,reason:"compressed"};try{const B=JSON.parse(M);return typeof a=="function"&&!a(B)?(console.warn(`${r} Invalid data${z?` (${z})`:""}.`),O=!0,{ok:!1,reason:"invalid"}):{ok:!0,value:B,raw:N,normalizedRaw:M}}catch(B){return console.error(`${r}${z?` (${z})`:""}`,B),O=!0,{ok:!1,reason:"error"}}};let k=null;try{k=e.getItem(t)}catch(N){console.error(`${r} (read)`,N),we("read access",N,e),O=!0}typeof A>"u"&&typeof b=="function"&&(A=Yn(e,t,b)),k==null&&A==null&&Ht(e,t);const _=Og(e,t,k,A);if(_.hit)return _.value;const v=C(k,"");if(v.ok){const N=typeof v.normalizedRaw=="string"&&v.normalizedRaw?v.normalizedRaw:typeof v.raw=="string"&&v.raw?v.raw:null,z=typeof A=="string"&&A?A:typeof v.raw=="string"&&v.raw?v.raw:null;return Ue(e,t,z,N,v.value),v.value}const S=!v.ok&&v.reason==="missing",w=()=>{if(!m.length)return{success:!1,shouldAlert:!1};for(let N=0;N<m.length;N+=1){const z=m[N];let M=null,B;try{M=e.getItem(z)}catch(R){return console.error(`${r} (migration backup read)`,R),we("read access",R,e),{success:!1,shouldAlert:!0}}if(typeof b=="function"&&(B=Yn(e,z,b)),M==null&&B==null){Ht(e,z);continue}const $=M??B,Ze=wn({key:z,value:$,type:"migration-backup"});if(typeof Ze>"u")continue;let me=Ze;if(typeof me=="string"){const R=me.trim();if(R)try{me=JSON.parse(R)}catch{}else me=""}if(typeof a=="function"&&!a(me)){console.warn(`Ignored migration backup for ${t} because it failed validation.`);continue}Ue(e,z,typeof B=="string"&&B?B:typeof $=="string"&&$?$:null,typeof $=="string"&&$?$:typeof B=="string"&&B?B:null,me);let et=null;try{et=JSON.stringify(me)}catch(R){console.warn(`Unable to serialize recovered migration backup for ${t}`,R),et=null}let Mr=null,tt=!1;if(et!==null){let R=et;const K=typeof et=="string"?vn(et):null;K&&typeof K.serialized=="string"&&(R=K.serialized);try{e.setItem(t,R),Mr=R}catch(V){console.warn(`Unable to restore primary copy for ${t} from migration backup`,V),we("write access",V,e),tt=!0}}else tt=!0;Mr!==null?Ue(e,t,Mr,et,me):et!==null?Ue(e,t,et,et,me):Ue(e,t,null,null,me),console.warn(Mr!==null?`Recovered ${t} from migration backup copy.`:`Recovered ${t} from migration backup copy but could not rewrite the primary entry.`);try{e.removeItem(z),Ht(e,z)}catch(R){console.warn(`Unable to remove migration backup ${z} after recovery`,R)}return{success:!0,value:me,shouldAlert:tt}}return{success:!1,shouldAlert:!1}},j=d&&(O||c||S);if(j){let N=null;try{N=e.getItem(l)}catch(B){console.error(`${r} (backup read)`,B),we("read access",B,e),O=!0}const z=typeof b=="function"?Yn(e,l,b):void 0,M=C(N,"backup");if(M.ok&&((O||S)&&console.warn(`Recovered ${t} from backup copy.`),M.raw!==null&&M.raw!==void 0)){let B=null;try{if(typeof M.raw=="string"){const Ze=typeof M.normalizedRaw=="string"&&M.normalizedRaw?M.normalizedRaw:M.raw,me=vn(Ze);me&&typeof me.serialized=="string"?(e.setItem(t,me.serialized),B=me.serialized):Ze!==M.raw?(e.setItem(t,Ze),B=Ze):(e.setItem(t,M.raw),B=M.raw)}else e.setItem(t,M.raw),B=typeof M.raw=="string"?M.raw:null}catch(Ze){console.warn(`Unable to restore primary copy for ${t} from backup`,Ze),B=null}const $=typeof M.normalizedRaw=="string"&&M.normalizedRaw?M.normalizedRaw:typeof M.raw=="string"&&M.raw?M.raw:null,Gt=typeof z=="string"&&z?z:typeof M.raw=="string"&&M.raw?M.raw:null;return Ue(e,l,Gt,$,M.value),typeof B=="string"&&B&&Ue(e,t,B,$,M.value),M.value}}const x=g&&m.length>0&&(S||c||O);if(x){const N=w();if(N.success){if(N.shouldAlert&&(O=!0),m.length){const z=m[0].key;try{e.removeItem(z),e[Cr]&&e.removeItem&&e.removeItem(z)}catch(M){console.warn("Post-migration cleanup error:",M)}}return N.value}N.shouldAlert&&(O=!0)}return O&&le(u),Ht(e,t),S&&!j&&!x&&console.debug(`[Storage] Returning default for ${t} (No primary, no backups found)`),n}function ke(e,t,r,n,o={}){if(!e){console.warn("DEBUG: saveJSONToStorage NO STORAGE");return}if(Lu()){console.warn("DEBUG: saveJSONToStorage RESET ACTIVE");return}const{disableBackup:i=!1,backupKey:s,onQuotaExceeded:a,enableCompressionSweep:c=!0,disableCompression:u=!1,forceCompressionOnQuota:f=!1}=o||{},l=typeof s=="string"&&s?s:`${t}${de}`,y=!i&&l&&l!==t,p=gf(e),d=p||!!u,g=p?!1:f===!0,m=Ma(e),b=R=>Yn(e,R,m);let A,O=!1,C,k=!1,_=!1,v=!1;const S=()=>{A=void 0,O=!1,C=void 0,k=!1,_=!1,v=!1},w=()=>{if(O)return A;O=!0;try{A=JSON.stringify(r)}catch(R){A=null,console.error(n,R),le()}return A},j=()=>{if(C!==void 0)return C&&typeof C.serialized=="string"?C.serialized:null;const R=w();if(typeof R!="string"||!R)return C=null,null;const K=vn(R);return!K||typeof K.serialized!="string"?(C=null,null):(C=K,K.serialized)},x=()=>{if(k){const K=j();if(typeof K=="string")return K;k=!1}const R=w();return typeof R=="string"?R:null},N=({force:R=!1}={})=>{const K=R&&g;if(d&&!K)return _=!0,!1;if(k||_&&!K)return!1;_=!0;const V=w();if(typeof V!="string"||!V)return!1;const Pe=j();return typeof Pe!="string"||!Pe||Pe.length>=V.length?!1:(k=!0,!0)},z=()=>{if(!k||!C||v)return;const{originalLength:R,wrappedLength:K}=C;if(typeof R=="number"&&typeof K=="number"&&K<R){const V=R-K,Pe=R>0?Math.round(V/R*100):0,te=`Stored compressed value for ${t} to reduce storage usage by ${V} characters (${Pe}%).`;Wi("storage-value",t,te,V,Pe)}v=!0},M=()=>{if(d){_=!0;return}if(k||_)return;const R=w();if(typeof R!="string"||!R||R.length<Wg)return;const K=j();if(typeof K!="string"||!K)return;const V=R.length-K.length;if(V<Yg||(R.length>0?V/R.length:0)<Jg)return;const te=b(t);typeof te=="string"&&te===K||(k=!0,_=!0)};let B,$=!1,Gt=!1,Ze=0,me=!1,ts=!1;M();const Nn=()=>(Ze+=1,Ze>Bg?(me=!0,console.warn(`Exceeded maximum storage recovery attempts while saving ${t}.`),!1):!0),et=(R,K)=>{if(!R||typeof R.length!="number"||typeof R.key!="function")return{success:!1,freed:0};const{skipKeys:V=[]}=K||{},Pe=new Set(V);Lt&&Yt&&Pe.add(Yt);const te=[],Ne=R.length;for(let Me=0;Me<Ne;Me+=1){let se;try{se=R.key(Me)}catch{continue}if(!(!se||Pe.has(se))){if(se.endsWith("__legacyMigrationBackup")){te.push({key:se,priority:1,size:0});continue}if(se.endsWith("__backup")){te.push({key:se,priority:2,size:0});continue}if(se===wt||se===ja){te.push({key:se,priority:3,size:0});continue}if(se.startsWith(jt)&&se.includes("auto-backup-")){te.push({key:se,priority:4,size:0});continue}}}if(!te.length)return{success:!1,freed:0};te.sort((Me,se)=>Me.priority-se.priority);let xe=0,Ft=0;for(let Me=0;Me<te.length;Me+=1){const se=te[Me];try{const Dt=R.getItem(se.key),Mn=Dt?Dt.length:0;if(R.removeItem(se.key),Ht(R,se.key),xe+=Mn,Ft+=1,console.warn(`[Storage Cleanup] Removed ${se.key} to free ${Mn} chars.`),xe>5e5)break}catch(Dt){console.warn(`[Storage Cleanup] Failed to remove ${se.key}`,Dt)}}return{success:Ft>0,freed:xe}},Mr=(R,K={})=>{if(!It(R))return!1;if(typeof a=="function")try{if(a(R,{storage:e,key:t,value:r,...K})===!0)return!0}catch(te){const Ne=K&&K.isBackup?" (backup)":"";console.error(`Error while handling quota exceed for ${t}${Ne}`,te)}if(!ts&&c!==!1){ts=!0;const te=[t];y&&typeof l=="string"&&l&&l!==t&&te.push(l),K&&typeof K.backupKey=="string"&&K.backupKey&&te.push(K.backupKey);const Ne=sf(e,{skipKeys:te});if(Ne&&Ne.success)return!0}const V=[t];y&&typeof l=="string"&&l&&V.push(l);const Pe=et(e,{skipKeys:V});return!!(Pe&&Pe.success)};let tt=0;for(;tt<zg;){tt+=1;const R=x();if(typeof R!="string")return;const K=w(),V=typeof K=="string"&&K?K:null;let Pe=!1,te,Ne=!1,xe=null,Ft=null,Me=null;if(typeof e.getItem=="function")try{const oe=e.getItem(t);if(oe===R)Pe=!0,Ft=R;else if(k){const Le=b(t);typeof Le=="string"&&(Ft=Le,Le===R&&(Pe=!0))}else typeof oe=="string"&&(Ft=oe)}catch(oe){console.warn(`Unable to inspect existing value for ${t}`,oe)}if(y&&typeof e.getItem=="function")try{te=e.getItem(l),Ne=typeof te=="string",Ne&&k?(xe=b(l),typeof xe=="string"&&(Me=xe)):Ne&&(Me=te)}catch(oe){console.warn(`Unable to inspect existing backup for ${t}`,oe)}!$&&Ne&&typeof te=="string"&&(B=te,$=!0);const se=(()=>{if(!y)return[];const oe=[];if(k){const Le=w();typeof Le=="string"&&Le&&oe.push({serialized:Le,compressed:!1}),typeof R=="string"&&R&&(!oe.length||oe[oe.length-1].serialized!==R)&&oe.push({serialized:R,compressed:!0})}else typeof R=="string"&&R&&oe.push({serialized:R,compressed:!1});return oe})(),Dt=se.length?se[0]:null,Mn=Ne&&Dt&&typeof Dt.serialized=="string"&&(te===Dt.serialized||typeof xe=="string"&&xe===Dt.serialized);if(Pe&&(!y||Mn)){if(V&&(Ue(e,t,k&&typeof Ft=="string"&&Ft?Ft:R,V,r),y&&Ne)){const Le=k&&typeof xe=="string"&&xe?xe:Me;typeof Le=="string"&&Le&&Ue(e,l,Le,V,r)}return}if(!Pe)try{e.setItem(t,R),z(),V&&Ue(e,t,R,V,r)}catch(oe){if(Mr(oe)){if(S(),!Nn())break;tt>0&&(tt-=1);continue}if(!me&&N({force:g})){if(!Nn())break;tt>0&&(tt-=1);continue}console.error(n,oe),we("write access",oe,e),le();return}if(!y)return;if(Mn){if(V&&Ne){const oe=k&&typeof xe=="string"&&xe?xe:Me;typeof oe=="string"&&oe&&Ue(e,l,oe,V,r)}return}const oc=(()=>{const oe=se.length?se:[{serialized:R,compressed:k}];let Le=null,rs=!1,Po=null;const ic=cr=>{try{return e.setItem(l,cr.serialized),cr.compressed&&z(),Gt=!1,!0}catch(ut){return Le=ut,!1}};for(let cr=0;cr<oe.length;cr+=1){const ut=oe[cr];if(Po=ut,ic(ut)){if(V){const zn=ut.compressed&&V?V:ut.serialized;Ue(e,l,ut.serialized,zn,r)}return"success"}if(!It(Le))break;if(!rs&&Ne)try{if(e.removeItem(l),Ht(e,l),rs=!0,Gt=!0,Ne=!1,ic(ut)){if(V){const zn=ut.compressed&&V?V:ut.serialized;Ue(e,l,ut.serialized,zn,r)}return"success"}}catch(zn){console.warn(`Unable to remove previous backup for ${t}`,zn)}}if(It(Le)&&(Mr(Le,{serialized:Po&&typeof Po.serialized=="string"?Po.serialized:R,backupKey:l,isBackup:!0})||!me&&N({force:g})))return S(),Nn()?"retry":"failure";if(rs&&typeof te=="string")try{e.setItem(l,te),V&&Ue(e,l,te,V,r),Gt=!1}catch(cr){console.warn(`Unable to restore previous backup for ${t}`,cr)}return console.warn(`Unable to update backup copy for ${t}`,Le),le(),"failure"})();if(oc==="success")return;if(oc==="retry"){tt>0&&(tt-=1);continue}if(me)break;return}if($&&Gt&&typeof B=="string")try{e.setItem(l,B),Ht(e,l)}catch(R){console.warn(`Unable to restore preserved backup for ${t}`,R)}console.error(n,new Error("Unable to save value after multiple attempts.")),le()}function ce(e,t,r,n={}){if(!e)return;P&&P.removeItem(t).catch(()=>{});const{disableBackup:o=!1,backupKey:i,disableMigrationCleanup:s=!1}=n||{},a=typeof i=="string"&&i?i:`${t}${de}`,c=!o&&a&&a!==t;Ht(e,t),c&&Ht(e,a),t===pe&&tr();try{e.removeItem(t)}catch(u){console.error(r,u),we("deletion",u,e),le()}if(c)try{e.removeItem(a)}catch(u){console.error(`${r} (backup)`,u),we("deletion",u,e),le()}if(!s){const u=`${t}${Nr}`;try{e.removeItem(u)}catch(f){console.warn(`Unable to remove migration backup for ${t}`,f)}}}var Lm=[wt,ja],Mo=new Set;function Rm(){const e=[],t=new Set,r=i=>{!i||typeof i.getItem!="function"||e.push(i)},n=(i,s,a)=>{if(!i||typeof i!="object"&&typeof i!="function")return null;try{return i[s]}catch(c){return a&&!Mo.has(a)&&(Mo.add(a),console.warn(`Unable to access ${a} while clearing UI caches`,c)),null}},o=(i,s)=>{if(!i||t.has(i))return;t.add(i),r(n(i,"SAFE_LOCAL_STORAGE",`${s}.SAFE_LOCAL_STORAGE`)),r(n(i,"localStorage",`${s}.localStorage`)),r(n(i,"sessionStorage",`${s}.sessionStorage`));const a=n(i,"__cineGlobal",`${s}.__cineGlobal`);a&&a!==i&&o(a,`${s}.__cineGlobal`)};o(typeof globalThis<"u"?globalThis:null,"globalThis"),o(typeof window<"u"?window:null,"window"),o(typeof self<"u"?self:null,"self"),o(typeof global<"u"?global:null,"global"),h&&h.__cineGlobal&&o(h.__cineGlobal,"__cineGlobal"),D&&D.storage&&r(D.storage),typeof T=="function"&&T()&&r(T());try{r(T())}catch(i){Mo.has("getSafeLocalStorage")||(Mo.add("getSafeLocalStorage"),console.warn("Unable to access safe local storage while clearing UI caches",i))}return r(jn("localStorage")),r(jn("sessionStorage")),typeof localStorage<"u"&&r(localStorage),typeof sessionStorage<"u"&&r(sessionStorage),ho(e)}function or(){const e=Rm();e.length&&Lm.forEach(t=>{P&&P.removeItem(t).catch(r=>console.warn("Failed to clear UI cache from repo",r)),!(typeof t!="string"||!t)&&e.forEach(r=>{ce(r,t,`Failed to clear UI cache entry ${t}`)})})}function mf(e,t,r){if(!e)return!1;try{return e.getItem(t)==="1"}catch(n){return console.error(r,n),we("read access",n,e),le(),!1}}function hf(e,t,r,n){if(e)try{r?e.setItem(t,"1"):e.removeItem(t)}catch(o){console.error(n,o),we("write access",o,e),le()}}function Tm(e,t,r,n,o,i,s,a){const c=Te(e,r,n,null,a);if(c!==null)return c;if(!t)return null;const u={...a||{},alertOnFailure:"migration-read"},f=Te(t,r,o,null,u);return f!==null?(ke(e,r,f,i),ce(t,r,s),f):null}function Da(e,t,r){const n=e.trim();let o=n,i=2;const s=r||new Set([...t].map(c=>c.trim().toLowerCase()));let a=n.toLowerCase();for(;s.has(a);)o=`${n} (${i++})`,a=o.toLowerCase();return t.add(o),s.add(a),o}function Nm(e){const t=typeof e=="string"?e.trim():"";if(!t)return"Project-imported";const r=t.match(/^(.*?)-imported(?:-(\d+))?$/i);if(r){const n=typeof r[1]=="string"?r[1].trim():"";return n?`${n}-imported`:"Project-imported"}return t.toLowerCase().endsWith("-imported")?t:`${t}-imported`}function Mm(e){const t=typeof e=="string"?e.trim():"",r=Nm(e);if(!t)return{base:r,initialCandidate:r,suffixStart:2};const n=t.match(/^(.*?)-imported(?:-(\d+))?$/i),o=n&&n[2]?Number(n[2]):NaN,i=Number.isFinite(o)?o+1:2;return n?{base:r,initialCandidate:t,suffixStart:i}:{base:r,initialCandidate:r,suffixStart:2}}function zm(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=Mm(e);let i=typeof o.initialCandidate=="string"?o.initialCandidate.trim():"";i||(i=o.base||"Project-imported");let s=i.trim().toLowerCase(),a=o.suffixStart;for(;s&&n.has(s);)i=`${o.base||"Project-imported"}-${a++}`,s=i.trim().toLowerCase();return t.add(i),s&&n.add(s),i}function Bm(e){const t=typeof e=="string"?e.trim():"";return t?t.toLowerCase().endsWith("-updated")?t:`${t}-updated`:"Project-updated"}function $n(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=Bm(e);let i=o,s=2,a=i.trim().toLowerCase();for(;a&&n.has(a);)i=`${o}-${s++}`,a=i.trim().toLowerCase();return i}function xm(e){if(e==null)return[];if(typeof e=="string"){const t=e.trim();return t?[t]:[]}return Array.isArray(e)?e.filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):E(e)?Object.values(e).filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):[]}function Gm(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}function Hs(e){if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(!n||typeof n!="object")return;const o=Number(n.x),i=Number(n.y);!Number.isFinite(o)||!Number.isFinite(i)||(t[r]={x:o,y:i})}),t}function Fm(e,t){const r=Object.keys(e||{}),n=Object.keys(t||{});if(r.length!==n.length)return!1;for(let o=0;o<r.length;o+=1){const i=r[o];if(!Object.prototype.hasOwnProperty.call(t||{},i))return!1;const s=e[i],a=t[i];if(!s||typeof s!="object"||!a||typeof a!="object"||Number(s.x)!==a.x||Number(s.y)!==a.y)return!1}return!0}function Dm(e){if(!E(e))return{state:null,changed:!1};const t={...e};let r=!1;const n=s=>{if(!Object.prototype.hasOwnProperty.call(t,s))return;const a=t[s];if(typeof a=="string"){const c=a.trim();c!==a&&(t[s]=c,r=!0);return}if(a==null){t[s]="",r=!0;return}if(typeof a=="number"||typeof a=="boolean"){t[s]=String(a),r=!0;return}t[s]="",r=!0};["setupName","setupSelect","camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap","sliderBowl","easyrig"].forEach(n);const o=(s,a=[])=>{const c=[],u=[s,...a];let f=!1;u.forEach(g=>{if(Object.prototype.hasOwnProperty.call(t,g)){const m=xm(t[g]);g!==s&&(f=!0),m.length&&c.push(...m)}}),u.slice(1).forEach(g=>{Object.prototype.hasOwnProperty.call(t,g)&&(delete t[g],r=!0)});const l=[],y=new Set;c.forEach(g=>{y.has(g)||(y.add(g),l.push(g))});const p=Object.prototype.hasOwnProperty.call(t,s),d=p&&Array.isArray(t[s])?t[s].filter(g=>typeof g=="string").map(g=>g.trim()).filter(g=>g):[];!p&&!f&&l.length===0&&d.length===0||Gm(d,l)||(t[s]=l,r=!0)};if(o("motors",["motor","motorSelect"]),o("controllers",["controller","controllerSelect"]),Object.prototype.hasOwnProperty.call(t,"projectInfo")&&!E(t.projectInfo)&&(t.projectInfo=null,r=!0),Object.prototype.hasOwnProperty.call(t,"autoGearHighlight")){const s=t.autoGearHighlight,a=s===!0||s==="true"||s===1||s==="1";(s!==a||typeof s!="boolean")&&(t.autoGearHighlight=a,r=!0)}if(Object.prototype.hasOwnProperty.call(t,"diagramPositions")){const s=Hs(t.diagramPositions);Object.keys(s).length===0?(delete t.diagramPositions,r=!0):Fm(t.diagramPositions,s)||(t.diagramPositions=s,r=!0)}const i=fe(t);return i!==t?{state:i,changed:!0}:{state:t,changed:r}}function bf(){_e();const e=T(),t=Tm(e,typeof sessionStorage<"u"?sessionStorage:null,bt,"Error loading session state from localStorage:","Error loading session state from sessionStorage:","Error saving session state to localStorage:","Error deleting session state from sessionStorage:",{validate:o=>o===null||E(o)});if(t===null)return null;const{state:r,changed:n}=Dm(t);return r?(n&&(lt(e,bt,t),Ua(r)),r):null}function Ua(e,t={}){const r=T();if(e==null){ce(r,bt,"Error deleting session state from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid session state payload. Expected a plain object.");return}qe(r,bt);const n=fe(e),o=E(t)?t:{},i=o.disableCompression!==!1,s={...o,disableCompression:i,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{if(typeof $s=="function"){const a=Xa();if($s(a))return console.warn("Removed oldest automatic gear backup to free up space for session state."),!0}return typeof Vs=="function"&&Vs()?(console.warn("Cleared cached planner data to free up space for session state."),!0):!1}};ke(r,bt,n,"Error saving session state to localStorage:",s)}function Sf(e){if(!E(e))return{data:null,changed:!1};const t={...e};let r=!1;const n=(o,i)=>(E(o[i])||(o[i]={},r=!0),o[i]);return um.forEach(o=>{n(t,o)}),E(t.fiz)||(t.fiz={},r=!0),fm.forEach(o=>{n(t.fiz,o)}),E(t.accessories)||(t.accessories={},r=!0),pm.forEach(o=>{n(t.accessories,o)}),Array.isArray(t.filterOptions)||(t.filterOptions=Array.isArray(e.filterOptions)?e.filterOptions.slice():[],r=!0),{data:t,changed:r}}function wf(){_e();const e=T(),t=Te(e,Ve,"Error loading device data from localStorage:",null,{validate:o=>o===null||E(o)}),{data:r,changed:n}=Sf(t);return r?(n&&(lt(e,Ve,t),ke(e,Ve,r,"Error updating device data in localStorage during normalization:",{disableCompression:!0,forceCompressionOnQuota:!1})),r):null}function Ef(e){const t=T();if(e==null){ce(t,Ve,"Error deleting device data from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid device data payload. Expected a plain object.");return}const{data:r}=Sf(e),n=r||e;qe(t,Ve),ke(t,Ve,n,"Error saving device data to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Of(e){if(!e)return{data:{},changed:!1};if(Array.isArray(e)){const n={},o=new Set,i=new Set;for(let s=0;s<e.length;s+=1){const a=e[s];if(!E(a))continue;const c=a.name||a.setupName||`Setup ${s+1}`,u=Da(c,o,i);n[u]=a}return{data:n,changed:!0}}if(!E(e))return{data:{},changed:!0};const t={};let r=!1;return Object.keys(e).forEach(n=>{const o=e[n];if(E(o)){const i=fe(o);i!==o&&(r=!0),t[n]=i}else r=!0}),r?{data:t,changed:!0}:{data:e,changed:!1}}function _o(){_e();const e=T(),t=Te(e,Xe,"Error loading setups from localStorage:",null,{validate:o=>o===null||Array.isArray(o)||E(o)}),{data:r,changed:n}=Of(t);n&&(lt(e,Xe,t),ke(e,Xe,r,"Error updating setups in localStorage during normalization:"));try{return Ju(r,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Fe)})}catch(o){return console.warn("Failed to expand automatic backup entries while loading setups",o),be(r)}}function Ka(e){const{data:t}=Of(e);Fa(t);const r=Qu(t,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Fe)});nm(r);const n=T();qe(n,Xe),ke(n,Xe,r,"Error saving setups to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{const o=Ks(r);return o?(console.warn(`Removed automatic backup "${o}" to free up storage space before saving setups.`),!0):!1}})}function $a(e){const t=_o(),{result:r,changed:n=!0}=e(t)||{};return n&&Ka(t),r}function Um(e,t){$a(r=>(r[e]=t,{changed:!0}))}function Km(e){return _o()[e]}function $m(e){$a(t=>Object.prototype.hasOwnProperty.call(t,e)?(delete t[e],{changed:!0}):{changed:!1})}function Vm(e,t){return $a(r=>{if(!Object.prototype.hasOwnProperty.call(r,e))return{result:null,changed:!1};const n=t.trim();if(!n)return{result:e,changed:!1};if(e.trim().toLowerCase()===n.toLowerCase())return{result:e,changed:!1};const o=new Set(Object.keys(r));o.delete(e);const i=Da(n,o),s=r[e];r[i]=s,delete r[e];const a=typeof e=="string"&&e.startsWith(Fe),c=typeof i=="string"&&i.startsWith(Fe);return a&&c&&Am(s),{result:i,changed:!0}})}var Hm=new Set(["prepDays","shootingDays","returnDays","crew","productionCompany","productionCompanyAddress"]),Af={productionCompany:["Production Company","Produktionsfirma","Société de production","Productora","Casa di produzione"],productionCompanyAddress:["Production Company Address","Adresse der Produktionsfirma","Adresse de la société de production","Dirección de la productora","Indirizzo della casa di produzione"],productionCompanyStreet:["Street address","Straße und Hausnummer","Adresse","Dirección","Indirizzo"],productionCompanyStreet2:["Address line 2","Adresszusatz","Complément d'adresse","Línea 2 de dirección","Seconda linea indirizzo"],productionCompanyCity:["City","Stadt","Ville","Ciudad","Città"],productionCompanyRegion:["State / Province / Region","Bundesland / Region","État / Région / Département","Estado / Provincia / Región","Regione / Provincia / Stato"],productionCompanyPostalCode:["Postal code","Postleitzahl","Code postal","Código postal","CAP"],productionCompanyCountry:["Country","Land","Pays","País","Paese"],rentalHouse:["Rental","Kameraverleih","Loueur","Noleggio","Verleih","Location","Rental House"],crew:["Crew","Team","Équipe","Equipo","Troupe"],prepDays:["Prep Days","Prep-Tage","Jours de préparation","Días de preparación","Giorni di preparazione"],shootingDays:["Shooting Days","Drehtage","Jours de tournage","Días de rodaje","Giorni di riprese"],returnDays:["Return Days","Rückgabetage","Jours de restitution","Días de devolución","Giorni di restituzione"],deliveryResolution:["Delivery Resolution","Auslieferungsauflösung","Résolution de livraison","Resolución de entrega","Risoluzione di consegna"],recordingResolution:["Recording Resolution","Aufnahmeauflösung","Résolution d’enregistrement","Resolución de grabación","Risoluzione di registrazione"],slowMotionRecordingResolution:["Slow Motion Recording Resolution","Zeitlupen-Aufnahmeauflösung","Résolution d’enregistrement au ralenti","Resolución de grabación en cámara lenta","Risoluzione di registrazione slow motion"],aspectRatio:["Aspect Ratio","Seitenverhältnis","Format d’image","Relación de aspecto","Formato"],codec:["Codec","Codec","Codec","Códec","Codec"],baseFrameRate:["Base Frame Rate","Basis-Framerate","Cadence de base","Velocidad base","Frame rate base"],slowMotionBaseFrameRate:["Slow Motion Base Frame Rate","Zeitlupen-Basis-Framerate","Cadence de base au ralenti","Velocidad base en cámara lenta","Frame rate base slow motion"],recordingFrameRate:["Recording Frame Rate","Aufnahmebildrate","Cadence d’enregistrement","Velocidad de grabación","Frame rate di registrazione"],slowMotionRecordingFrameRate:["Slow Motion Recording Frame Rate","Zeitlupen-Aufnahmebildrate","Cadence d’enregistrement au ralenti","Velocidad de grabación en cámara lenta","Frame rate di registrazione slow motion"],sensorMode:["Sensor Mode","Sensormodus","Mode capteur","Modo de sensor","Modalità sensore"],slowMotionSensorMode:["Slow Motion Sensor Mode","Zeitlupen-Sensormodus","Mode capteur au ralenti","Modo de sensor en cámara lenta","Modalità sensore slow motion"],slowMotionAspectRatio:["Slow Motion Aspect Ratio","Zeitlupen-Seitenverhältnis","Format d’image au ralenti","Relación de aspecto en cámara lenta","Formato slow motion"],lenses:["Lenses","Objektive","Optiques","Ópticas","Obiettivi"],requiredScenarios:["Required Scenarios","Anforderungen","Scénarios requis","Escenarios requeridos","Scenari richiesti"],cameraHandle:["Camera Handle","Kamera-Handgriff","Poignée caméra","Empuñadura de cámara","Maniglia camera"],viewfinderExtension:["Viewfinder Extension","Sucher-Verlängerung","Extension viseur","Extensión de visor","Prolunga mirino"],viewfinderEyeLeatherColor:["Viewfinder Eye Leather Color","Sucher-Augenmuschel-Farbe","Couleur de l’œil du viseur","Color del ocular del visor","Colore gomma mirino"],mattebox:["Mattebox","Matte-Box","Matte box","Matte box","Matte box"],gimbal:["Gimbal","Gimbal-Stabilisator","Stabilisateur gimbal","Estabilizador gimbal","Stabilizzatore gimbal"],videoDistribution:["Video Distribution","Videoverteilung","Distribution vidéo","Distribución de vídeo","Distribuzione video"],monitoringSupport:["Monitoring support","Monitoring-Support","Support de monitoring","Soporte de monitorización","Supporto monitoraggio"],monitoringConfiguration:["Monitoring configuration","Monitoring-Konfiguration","Configuration de monitoring","Configuración de monitorización","Configurazione monitoraggio"],focusMonitor:["Focus Monitor","Fokusmonitor","Moniteur focus","Monitor de foco","Monitor fuoco"],monitorUserButtons:["Onboard Monitor User Buttons","Onboard-Monitor-Buttons","Boutons personnalisés du moniteur","Botones de usuario del monitor integrado","Tasti monitor onboard"],cameraUserButtons:["Camera User Buttons","Kamera-Buttons","Boutons personnalisés caméra","Botones de usuario de la cámara","Tasti camera"],viewfinderUserButtons:["Viewfinder User Buttons","Sucher-Buttons","Boutons personnalisés viseur","Botones de usuario del visor","Tasti mirino"],tripodHeadBrand:["Tripod Head Brand","Kopfmarke","Marque de la tête","Marca de la cabeza","Marca della testa"],tripodBowl:["Tripod Bowl","Schalentyp","Type de bol","Tipo de bowl","Tipo di bowl"],tripodTypes:["Tripod Types","Stativtypen","Types de trépied","Tipos de trípode","Tipi di treppiede"],tripodSpreader:["Tripod Spreader","Spreizer-Option","Type de spreader","Tipo de esparcidor","Tipo di spreader"],sliderBowl:["Slider Bowl","Slider-Schale","Slider bowl","Bowl del slider","Slider bowl"],easyrig:["Further Stabilisation","Weitere Stabilisierung","Stabilisation complémentaire","Estabilización adicional","Stabilizzazione aggiuntiva"]},qs=["productionCompanyAddress","productionCompanyStreet","productionCompanyStreet2","productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"];function Cf(e){return typeof e!="string"?"":e.trim().replace(/[:：]\s*$/,"").trim()}function qm(e){var t={},r=typeof window<"u"&&window.texts?window.texts:null,n=r&&r.en&&r.en.projectFields||{},o=["productionCompany"].concat(qs);return o.forEach(function(i){var s=new Set,a=function(u){if(typeof u=="string"){var f=Cf(u);f&&s.add(f)}};e&&e[i]&&a(e[i]),n&&n[i]&&a(n[i]);var c=Af[i];Array.isArray(c)&&c.forEach(a),t[i]=s}),t}function Wm(e,t,r){if(typeof e!="string")return null;var n=e.replace(/\r\n?/g,`
`).split(`
`).map(function(m){return m.trim()}).filter(function(m){return m});if(!n.length)return null;var o=qm(t),i={},s=n[0];s&&(i.productionCompany=s);var a=Array.isArray(r?.lines)?r.lines:null;if(a&&a.length){var c={};if(a.forEach(function(m){if(!(!m||typeof m.text!="string")){var b=m.text.trim();if(b){var A=m.fields;typeof A=="string"&&(A=A.split(/\s+/)),!(!Array.isArray(A)||!A.length)&&A.map(function(O){return typeof O=="string"?O.trim():""}).filter(function(O){return O&&qs.includes(O)}).forEach(function(O){c[O]||(c[O]=[]),c[O].push(b)})}}}),Object.keys(c).length){if(c.productionCompanyAddress&&c.productionCompanyAddress.length&&(i.productionCompanyAddress=c.productionCompanyAddress.join(`
`)),c.productionCompanyStreet&&c.productionCompanyStreet.length){var u=c.productionCompanyStreet;if(i.productionCompanyStreet=u[0],u.length>1){var f=u.slice(1).join(`
`);f&&(i.productionCompanyStreet2=f)}}if(c.productionCompanyStreet2&&c.productionCompanyStreet2.length){var l=c.productionCompanyStreet2.join(`
`);l&&(i.productionCompanyStreet2=i.productionCompanyStreet2?i.productionCompanyStreet2+`
`+l:l)}var y=function(m){if(!(!c[m]||!c[m].length)){var b=c[m].join(" ");b&&(i[m]=b)}};return["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"].forEach(y),i}}var p={},d=null;if(n.slice(1).forEach(function(m){var b=Cf(m),A=null;if(qs.forEach(function(O){A||!o[O]||o[O].has(b)&&(A=O)}),A){d=A,p[d]||(p[d]=[]);return}if(!d){i.productionCompany?i.productionCompany+=`
`+m:i.productionCompany=m;return}p[d]||(p[d]=[]),p[d].push(m)}),p.productionCompanyAddress&&p.productionCompanyAddress.length&&(i.productionCompanyAddress=p.productionCompanyAddress.join(`
`)),p.productionCompanyStreet&&p.productionCompanyStreet.length){var g=p.productionCompanyStreet;i.productionCompanyStreet=g[0],g.length>1&&(i.productionCompanyStreet2=g.slice(1).join(`
`))}return p.productionCompanyCity&&p.productionCompanyCity.length&&(i.productionCompanyCity=p.productionCompanyCity.join(" ")),p.productionCompanyRegion&&p.productionCompanyRegion.length&&(i.productionCompanyRegion=p.productionCompanyRegion.join(" ")),p.productionCompanyPostalCode&&p.productionCompanyPostalCode.length&&(i.productionCompanyPostalCode=p.productionCompanyPostalCode.join(" ")),p.productionCompanyCountry&&p.productionCompanyCountry.length&&(i.productionCompanyCountry=p.productionCompanyCountry.join(" ")),i}var Ym=(()=>{const e=new Map,t=r=>typeof r!="string"?"":r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return Object.entries(Af).forEach(([r,n])=>{n.forEach(o=>{const i=t(o);i&&!e.has(i)&&e.set(i,r)})}),e})(),Jm={amp:"&",lt:"<",gt:">",quot:'"',apos:"'",nbsp:" "};function ro(e){return typeof e!="string"||!e?"":e.replace(/&(#x?[0-9a-fA-F]+|[a-zA-Z]+);/g,(t,r)=>{if(!r)return t;if(r[0]==="#"){const o=r[1]==="x"||r[1]==="X"?parseInt(r.slice(2),16):parseInt(r.slice(1),10);return Number.isFinite(o)?String.fromCodePoint(o):t}const n=Jm[r.toLowerCase()];return n!==void 0?n:t})}function no(e){if(typeof e!="string")return"";let t;do t=e,e=e.replace(/<[^>]*>/g,"");while(e!==t);return e}function Qm(e,t){if(typeof e!="string")return"";const r=e.replace(/<\s*br\s*\/?\s*>/gi,`
`).replace(/<\/(p|div|li|ul|ol)>/gi,`
`).replace(/<li[^>]*>/gi,""),o=ro(no(r)).replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(i=>i.replace(/\s+/g," ").trim()).filter(i=>i);return o.length?t&&Hm.has(t)?o.join(`
`):o.join(", "):""}function Xm(e){if(typeof e!="string")return null;const t=/<span([^>]*)>([\s\S]*?)<\/span>/gi,r=[];let n;for(;n=t.exec(e);){const o=n[1]||"";if(!/class=["'][^"']*req-sub-line[^"']*["']/i.test(o))continue;const i=n[2]||"",s=ro(no(i)).replace(/\s+/g," ").trim();if(!s)continue;const a=o.match(/data-fields=["']([^"']+)["']/i),c=a?null:o.match(/data-field=["']([^"']+)["']/i),u=a?a[1]:c?c[1]:"",f=typeof u=="string"?u.split(/\s+/).map(l=>l.trim()).filter(l=>l):[];r.push({text:s,fields:f})}return r.length?{lines:r}:null}function Zm(e){if(typeof e!="string")return"";const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return t&&Ym.get(t)||""}function Wc(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const r={},n=t.match(/<div[^>]*class=["'][^"']*requirements-grid[^"']*["'][^>]*>/i),o=n?n.index:-1;if(o===-1){const d=t.match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(d){const m=ro(no(d[1])).replace(/[“”"']/g,"").trim();m&&(r.projectName=m)}return Object.keys(r).length?r:null}const i=t.slice(o),a=t.slice(0,o).match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(a){const g=ro(no(a[1])).replace(/[“”"']/g,"").trim();g&&!/gear list/i.test(g)&&(r.projectName=g)}const c=/<div[^>]*class=["'][^"']*requirement-box[^"']*["'][^>]*>[\s\S]*?<\/div>/gi;let u;const f=typeof window<"u"&&window.texts?window.texts:null,l=typeof window<"u"&&window.currentLang?window.currentLang:null,y=typeof l=="string"&&f&&f[l]?l:"en",p=f&&f[y]&&f[y].projectFields?f[y].projectFields:f&&f.en&&f.en.projectFields?f.en.projectFields:{};for(;u=c.exec(i);){const d=u[0],g=d.match(/data-field=["']([^"']+)["']/i),m=d.match(/<span[^>]*class=["'][^"']*req-label[^"']*["'][^>]*>([\s\S]*?)<\/span>/i),b=d.match(/<span[^>]*class=["'][^"']*req-value[^"']*["'][^>]*>([\s\S]*)<\/span\s*>/i),A=g?g[1].trim():"",O=m?ro(no(m[1])):"",C=A||Zm(O);if(!C)continue;const k=b?b[1]:"",_=Qm(k,C);if(!_)continue;let v=_,S=null;if(C==="productionCompany"){S=Xm(k);const w=Wm(_,p,S);w&&typeof w=="object"&&(w.productionCompany&&(v=w.productionCompany),Object.entries(w).forEach(([j,x])=>{j!=="productionCompany"&&(Object.prototype.hasOwnProperty.call(r,j)||(r[j]=x))}))}Object.prototype.hasOwnProperty.call(r,C)||(r[C]=v)}return Object.keys(r).length?r:null}function Ln(e){if(Array.isArray(e))return e.map(t=>Ln(t));if(E(e)){const t={};return Object.entries(e).forEach(([r,n])=>{t[r]=Ln(n)}),t}return e}function zo(e){if(!E(e))return null;try{return sr(e)}catch(t){console.warn("Unable to serialize project info during normalization",t);try{return Ln(e)}catch(r){return console.warn("Unable to deep clone project info during normalization",r),{...e}}}}function eh(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(r=>{if(!E(r)){const l=Va(r);l!=null&&t.push(l);return}const n={},o=typeof r.name=="string"?r.name.trim():"";o&&(n.name=o);const i=typeof r.phone=="string"?r.phone.trim():"";i&&(n.phone=i);const s=typeof r.email=="string"?r.email.trim():"";s&&(n.email=s);const c=typeof r.website=="string"?r.website.trim():typeof r.url=="string"?r.url.trim():"";c&&(n.website=c);const u=typeof r.text=="string"?r.text.trim():"";u&&(n.text=u);const f=typeof r.role=="string"?r.role.trim():"";f&&(n.role=f),Object.keys(n).length&&t.push(n)}),t}function Va(e){if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t||null}if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="boolean")return e?!0:null;if(Array.isArray(e)){const t=e.map(r=>Va(r)).filter(r=>r!=null&&!(typeof r=="string"&&!r));return t.length?t:null}return E(e)?_f(e):null}function _f(e){if(!E(e))return null;const t={},r=[],n=new Set,o=a=>{if(typeof a!="string")return;const c=a.trim();!c||n.has(c)||(n.add(c),r.push(c))},i=(a,c={})=>{if(a==null)return;if(c.fromSelections){(Array.isArray(a)?a:[a]).forEach(l=>{if(re(l)){const p=ne(l);if(p){i(p,{fromSelections:!0});return}}if(E(l)){const p=Ha(l);if(p.length){p.forEach(d=>{d&&typeof d.name=="string"&&o(d.name)});return}}const y=Re(l);y&&o(y)});return}const u=Ye(a);u.length&&u.forEach(f=>{o(f)})};if(i(e.lenses),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&i(e.lensSelections,{fromSelections:!0}),Object.entries(e).forEach(([a,c])=>{if(c==null)return;if(a==="people"){const f=eh(c);f.length&&(t.people=f);return}if(a==="lenses"){const{names:f}=If(c);t.lenses=f.slice();return}if(a==="lensSelections"){const f=Ws(c,r);f.selections&&f.selections.length&&(t.lensSelections=f.selections);return}const u=Va(c);u!=null&&(t[a]=u)}),!Object.prototype.hasOwnProperty.call(t,"lenses")&&r.length&&(t.lenses=r.slice()),!Object.prototype.hasOwnProperty.call(t,"lensSelections")&&r.length){const a=Ws([],r);a.selections&&a.selections.length&&(t.lensSelections=a.selections)}return Object.keys(t).length?fe(t):null}function th(e){if(!Array.isArray(e)||!e.length)return null;try{return sr(e)}catch(t){console.warn("Unable to serialize automatic gear rules during normalization",t);try{return Ln(e)}catch(r){return console.warn("Unable to deep clone automatic gear rules during normalization",r),e.slice()}}}function rh(e){if(!E(e)||!Object.keys(e).length)return{};try{return sr(e)}catch(t){console.warn("Unable to serialize diagram positions during normalization",t);try{return Ln(e)}catch(r){return console.warn("Unable to deep clone diagram positions during normalization",r),{...e}}}}var Yo="4x5.65";function pt(e){if(e==null)return[];if(Array.isArray(e)){const r=[];return e.forEach(n=>{if(n==null)return;if(Array.isArray(n)){r.push(...pt(n));return}if(re(n)){const i=ne(n);if(i){r.push(...pt(i));return}}if(typeof n=="object"){r.push(...pt(Object.values(n)));return}const o=String(n).trim();o&&r.push(o)}),r}if(re(e)){const r=ne(e);if(r)return pt(r)}if(typeof e=="object")return Object.prototype.hasOwnProperty.call(e,"values")?pt(e.values):Object.prototype.hasOwnProperty.call(e,"selected")?pt(e.selected):pt(Object.values(e));if(typeof e=="string"){const r=e.trim();if(!r||r==="!")return[];const n=Oe(r);return n.success?pt(n.parsed):r.split(/[|,]/).map(o=>o.trim()).filter(o=>o)}const t=String(e).trim();return t?[t]:[]}function bn(e,t=""){if(e==null)return null;if(typeof e=="string"){const r=e.trim();if(!r)return null;const n=Oe(r);if(n.success)return bn(n.parsed,t);const o=r.split(":"),i=o.shift(),s=i?i.trim():"";if(!s)return null;const a=o.shift(),c=a&&a.trim()?a.trim():Yo;if(!o.length)return{type:s,size:c,values:[],hasExplicitValues:!1};const u=o.join(":");if(u==="!")return{type:s,size:c,values:[],hasExplicitValues:!0};const f=pt(u);return{type:s,size:c,values:f,hasExplicitValues:!0}}if(Array.isArray(e)){if(!e.length)return null;if(e.length===1)return bn(e[0],t);const[r,n,o]=e;let i=typeof r=="string"?r.trim():"";if(!i&&typeof t=="string"&&(i=t.trim()),!i)return null;const s=typeof n=="string"&&n.trim()?n.trim():Yo,a=e.length>2,c=a?pt(o):[];return{type:i,size:s,values:c,hasExplicitValues:a}}if(re(e)){const r=ne(e);if(r)return bn(r,t)}if(typeof e=="object"){let r="";const n=["type","filter","name","label"];for(let u=0;u<n.length;u+=1){const f=n[u];if(typeof e[f]=="string"){const l=e[f].trim();if(l){r=l;break}}}if(!r&&typeof t=="string"&&t.trim()&&(r=t.trim()),!r)return null;const o=["size","filterSize","format","dimension","dimensions","diameter"];let i="";for(let u=0;u<o.length;u+=1){const f=o[u];if(typeof e[f]=="string"){const l=e[f].trim();if(l){i=l;break}}}i||(i=Yo);const s=["values","value","strengths","strength","options","selected","selections","choices"];let a=!1,c=[];for(let u=0;u<s.length;u+=1){const f=s[u];if(Object.prototype.hasOwnProperty.call(e,f)){a=!0,c=pt(e[f]);break}}return{type:r,size:i,values:c,hasExplicitValues:a}}return null}function ms(e){if(!e||!e.type)return null;const t=e.type,r=e.size&&e.size.trim()?e.size.trim():Yo;let n=`${t}:${r}`;const o=Array.isArray(e.values)?Array.from(new Set(e.values.map(i=>typeof i=="string"?i.trim():String(i??"").trim()).filter(i=>i))):[];return(e.hasExplicitValues||o.length)&&(n+=o.length?`:${o.join("|")}`:":!"),n}function bi(e){if(e===void 0)return null;if(e===null)return"";if(typeof e=="string"){const t=e.trim();if(!t)return"";const r=Oe(t);return r.success?bi(r.parsed):t}if(Array.isArray(e)){const t=e.map(r=>bn(r)).filter(Boolean);return t.length?t.map(r=>ms(r)).filter(Boolean).join(","):""}if(re(e)){const t=ne(e);if(t)return bi(t)}if(typeof e=="object"){const t=bn(e);if(t)return ms(t)||"";const r=[];return Object.entries(e).forEach(([n,o])=>{const i=bn(o,n);i&&r.push(i)}),r.length?r.map(n=>ms(n)).filter(Boolean).join(","):""}return String(e).trim()}function hs(e){if(!E(e))return;const t=bi(e.filter);if(t!==null)t?e.filter=t:delete e.filter;else{const r=bi(e.filters);r!==null&&(r?e.filter=r:delete e.filter)}Object.prototype.hasOwnProperty.call(e,"filters")&&delete e.filters}function Vn(e){if(!E(e))return null;const t=n=>{if(Array.isArray(n))return n.map(i=>t(i)).filter(i=>i!==void 0);if(E(n)){const o={};return Object.entries(n).forEach(([i,s])=>{if(typeof i!="string"||!i)return;const a=t(s);a!==void 0&&(o[i]=a)}),o}if(n==null)return"";if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean")return String(n);try{return String(n)}catch{}return""},r={};return Object.entries(e).forEach(([n,o])=>{if(typeof n!="string"||!n)return;const i=t(o);i!==void 0&&(r[n]=i)}),Object.keys(r).length?r:null}function Jn(e){if(e==null)return null;const t=o=>typeof o=="string"?o.trim():o==null?"":typeof o=="number"||typeof o=="boolean"?String(o):"";if(!E(e))return null;const r={batteryPlate:t(e.batteryPlate),battery:t(e.battery),batteryHotswap:t(e.batteryHotswap)};return Object.keys(r).some(o=>r[o])?r:null}function nh(e){const t=Jn(e);return t?{batteryPlate:t.batteryPlate,battery:t.battery,batteryHotswap:t.batteryHotswap}:null}const oh=new Set(["name","lensname","label","title","text","lens","mount","mountlabel","mountname","mounts","note","notes","names","values","selection","legacyvalue","lensselections","selections","entries","items","options","meta","metadata","count","version","length","size","updated","created","createdat","timestamp","id","uuid","key","value"]);function kf(e){if(typeof e!="string")return!1;const t=e.trim();if(!t||/^[0-9]+$/u.test(t))return!1;const r=t.toLowerCase();return!(r.startsWith("__proto__")||r==="prototype"||r==="constructor"||oh.has(r))}function Pf(e){if(!E(e))return[];const t=Object.keys(e),r=[];return t.forEach(n=>{if(!kf(n))return;const o=n.trim();o&&r.push(o)}),r}function Re(e){if(e==null)return"";if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return(typeof e=="string"?e:String(e)).trim();if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Re(e[t]);if(r)return r}return""}if(re(e)){const t=ne(e);if(t)return Re(t)}if(E(e)){const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i=="string"){const s=i.trim();if(s)return s}}const r=Pf(e);if(r.length)return r[0];if(Array.isArray(e.names)&&e.names.length){const o=Re(e.names[0]);if(o)return o}if(Array.isArray(e.values)&&e.values.length){const o=Re(e.values[0]);if(o)return o}const n=Object.values(e);for(let o=0;o<n.length;o+=1){const i=Re(n[o]);if(i)return i}}return""}function Ye(e){if(e==null)return[];if(Array.isArray(e)){const t=[];return e.forEach(r=>{if(r==null)return;if(typeof r=="string"){const o=Oe(r);if(o.success){t.push(...Ye(o.parsed));return}const i=r.trim();i&&t.push(i);return}if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint"){t.push(String(r));return}const n=Re(r);if(n){t.push(n);return}if(Array.isArray(r)){t.push(...Ye(r));return}if(re(r)){const o=ne(r);o&&t.push(...Ye(o));return}E(r)&&t.push(...Ye(Object.values(r)))}),t}if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return[String(e)];if(typeof e=="string"){const t=Oe(e);return t.success?Ye(t.parsed):e.split(/[\n,;]/u).map(r=>r.trim()).filter(r=>r)}if(re(e)){const t=ne(e);if(t)return Ye(t)}if(E(e)){const t=Pf(e);if(t.length)return t;const r=Re(e);if(r)return[r];const n=[];return Array.isArray(e.names)&&n.push(...Ye(e.names)),Array.isArray(e.values)&&n.push(...Ye(e.values)),n.length||n.push(...Ye(Object.values(e))),n}return[]}function If(e){const t=Ye(e),r=Array.isArray(e)&&e.length===t.length&&e.every((n,o)=>typeof n=="string"&&n.trim()===t[o]);return{names:t,changed:!r}}function Jo(e){if(e==null)return{selection:null,changed:!1};if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"){const t=Re(e);return t?{selection:{name:t,mount:""},changed:!0}:{selection:null,changed:!0}}if(re(e)){const t=ne(e);if(t)return Jo(t)}if(Array.isArray(e)){if(!e.length)return{selection:null,changed:!0};const t=Re(e[0]);if(!t)return{selection:null,changed:!0};const r=e.length>1?e[1]:"",n=typeof r=="string"?r.trim():"",o={name:t};return o.mount=n||"",{selection:o,changed:!0}}if(E(e)){const t={...e};let r=!1;const n=Re(e);if(!n)return{selection:null,changed:!0};t.name!==n&&(t.name=n,r=!0),Object.prototype.hasOwnProperty.call(t,"name")||(t.name=n,r=!0);const o=[];if(typeof e.mount=="string"&&o.push(e.mount),typeof e.mountLabel=="string"&&o.push(e.mountLabel),typeof e.mountName=="string"&&o.push(e.mountName),Array.isArray(e.mounts))for(let s=0;s<e.mounts.length;s+=1){const a=e.mounts[s];if(typeof a=="string"&&a.trim()){o.push(a);break}}let i="";for(let s=0;s<o.length;s+=1){const a=o[s];if(typeof a=="string"){const c=a.trim();if(c){i=c;break}}}if(typeof t.mount=="string"){const s=t.mount.trim();s!==t.mount&&(t.mount=s,r=!0),!i&&s&&(i=s)}return i||(i=""),t.mount!==i&&(t.mount=i,r=!0),Object.prototype.hasOwnProperty.call(t,"mount")||(t.mount=i,r=!0),{selection:t,changed:r}}return{selection:null,changed:!0}}function Ha(e){if(!E(e))return[];const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let n=0;n<t.length;n+=1){const o=t[n];if(typeof o=="string"&&o.trim())return[]}const r=[];return Object.entries(e).forEach(([n,o])=>{if(!kf(n))return;const i=n.trim();if(!i)return;let s=o;if(re(s)){const u=ne(s);u&&(s=u)}if(E(s)){const u={...s};u.name=i;let f="";const l=["mount","mountLabel","mountName"];for(let y=0;y<l.length;y+=1){const p=l[y];if(typeof u[p]!="string")continue;const d=u[p].trim();if(d&&d.toLowerCase()!==i.toLowerCase()){f=d;break}}if(!f&&Array.isArray(u.mounts)){const y=Re(u.mounts);y&&y.toLowerCase()!==i.toLowerCase()&&(f=y)}u.mount=typeof f=="string"?f:"",r.push(u);return}if(Array.isArray(s)){const u=Re(s),f=u&&u.toLowerCase()!==i.toLowerCase()?u:"";r.push({name:i,mount:f});return}if(typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"){const u=Re(s),f=u&&u.toLowerCase()!==i.toLowerCase()?u:"";r.push({name:i,mount:f});return}if(s==null){r.push({name:i,mount:""});return}const a=Re(s),c=a&&a.toLowerCase()!==i.toLowerCase()?a:"";r.push({name:i,mount:c})}),r}function Ws(e,t=[]){const r=Array.isArray(e)?e:[e],n=[],o=new Set;let i=!1;const s=(c,u)=>{if(!c||typeof c!="object"){u&&(i=!0);return}const f={...c},y=(typeof f.name=="string"?f.name:"").trim();if(!y){u&&(i=!0);return}f.name!==y&&(f.name=y,u=!0);const d=(typeof f.mount=="string"?f.mount:"").trim();if(f.mount!==d&&(f.mount=d,u=!0),Object.prototype.hasOwnProperty.call(f,"mount")||(f.mount=d,u=!0),Object.prototype.hasOwnProperty.call(f,"mountState")){const m=(typeof f.mountState=="string"?f.mountState:"").trim();f.mountState!==m&&(f.mountState=m,u=!0),m||(delete f.mountState,u=!0)}u&&(i=!0),n.push(f),o.add(y)},a=c=>{if(c==null)return;if(typeof c=="string"){const f=Oe(c);if(f.success){a(f.parsed),i=!0;return}const l=Ye(c);l.length?l.forEach(y=>{s({name:y,mount:""},!0)}):i=!0;return}if(typeof c=="number"||typeof c=="boolean"||typeof c=="bigint"){s({name:String(c),mount:""},!0);return}if(Array.isArray(c)){if(c.length&&c.length<=2&&(typeof c[0]=="string"||typeof c[0]=="number"||typeof c[0]=="boolean"||typeof c[0]=="bigint")){const{selection:f,changed:l}=Jo(c);if(f){s(f,l);return}}c.forEach(f=>{const{selection:l,changed:y}=Jo(f);l?s(l,y):y&&(i=!0)});return}if(re(c)){const f=ne(c);f&&(a(f),i=!0);return}if(E(c)){const f=Ha(c);if(f.length){f.forEach(d=>{s(d,!0)});return}const{selection:l,changed:y}=Jo(c);if(l){s(l,y);return}const p=Object.values(c);p.length&&(a(p),i=!0);return}const u=Re(c);u?s({name:u,mount:""},!0):i=!0};for(let c=0;c<r.length;c+=1)a(r[c]);return Array.isArray(t)&&t.forEach(c=>{if(typeof c!="string")return;const u=c.trim();!u||o.has(u)||(n.push({name:u,mount:""}),o.add(u),i=!0)}),n.length?{selections:n,changed:i}:{selections:null,changed:i}}function Ke(e){const t=Qi(e);if(t.restored)return Ke(t.value);if(typeof e=="string"){const r=Oe(e);if(r.success){const n=Ke(r.parsed);if(n)return n}return Ke({gearList:e,projectInfo:null})}if(re(e)){const r=ne(e);return r?Ke(r):null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"gearList")||Object.prototype.hasOwnProperty.call(e,"projectInfo")){const r=re(e.project)?ne(e.project):e.project;let n=e.projectInfo;re(n)&&(n=ne(n));let o=E(n)?n:null;if(!o&&typeof n=="string"){const S=Oe(n);S.success&&E(S.parsed)&&(o=S.parsed)}if(!o&&E(r)){let S=r.projectInfo;if(re(S)&&(S=ne(S)),E(S))o=S;else if(typeof S=="string"){const w=Oe(S);w.success&&E(w.parsed)&&(o=w.parsed)}}let i=null;const s=S=>{if(i&&i.length||S==null)return;let w=S;if(re(w)){const j=ne(w);j&&(w=Object.values(j).filter(x=>x!=null))}if(Array.isArray(w)&&w.length){i=w;return}if(E(w)){const j=Object.values(w).filter(x=>x!=null);if(j.length){i=j;return}}if(typeof w=="string"){const j=Oe(w);j.success&&Array.isArray(j.parsed)&&j.parsed.length&&(i=j.parsed)}};s(e.autoGearRules),!i&&E(r)&&s(r.autoGearRules);let a=re(e.gearList)?ne(e.gearList):e.gearList;if((a==null||typeof a=="string"&&!a)&&E(r)&&Object.prototype.hasOwnProperty.call(r,"gearList")&&(a=r.gearList),re(a)){const S=ne(a);S&&(a=S)}let c=typeof a=="string"||a&&typeof a=="object"?a:"",u=null;const f=re(e.gearSelectors)?ne(e.gearSelectors):e.gearSelectors;if(E(f))u=Vn(f);else if(typeof f=="string"){const S=Oe(f);S.success&&E(S.parsed)&&(u=Vn(S.parsed))}const l=re(e.powerSelection)?ne(e.powerSelection):e.powerSelection;let y=Jn(l);if(!y&&E(l)&&(y=Jn(l)),typeof c=="string"){const S=Oe(c);if(S.success){const w=Ke(S.parsed);w?(c=w.gearList,!o&&w.projectInfo&&(o=w.projectInfo),(!i||!i.length)&&Array.isArray(w.autoGearRules)&&w.autoGearRules.length&&(i=w.autoGearRules),!u&&E(w.gearSelectors)&&(u=Vn(w.gearSelectors)),!y&&E(w.powerSelection)&&(y=Jn(w.powerSelection))):(typeof S.parsed=="string"||E(S.parsed)&&Object.values(S.parsed).every(j=>typeof j=="string"))&&(c=S.parsed)}}c&&typeof c=="object"&&!E(c)&&(c=""),o&&hs(o),o&&(o=_f(o)||null),o&&hs(o);const p={gearList:Array.isArray(c)||E(c)?Ln(c):c,projectInfo:o?zo(o):null},d=re(e.diagramPositions)?ne(e.diagramPositions):e.diagramPositions;let g=Hs(d);if(Object.keys(g).length===0&&E(r)){const S=re(r.diagramPositions)?ne(r.diagramPositions):r.diagramPositions;g=Hs(S)}Object.keys(g).length&&(p.diagramPositions=rh(g));const m=[];if(typeof e.projectHtml=="string"&&m.push(e.projectHtml),typeof e.gearHtml=="string"&&m.push(e.gearHtml),E(r)&&(typeof r.projectHtml=="string"&&m.push(r.projectHtml),typeof r.gearHtml=="string"&&m.push(r.gearHtml)),E(a)&&typeof a.gearHtml=="string"&&m.push(a.gearHtml),E(c)?(typeof c.projectHtml=="string"&&m.push(c.projectHtml),typeof c.gearHtml=="string"&&m.push(c.gearHtml)):typeof c=="string"&&m.push(c),!u&&E(r)){const S=re(r.gearSelectors)?ne(r.gearSelectors):r.gearSelectors;E(S)&&(u=Vn(S))}if(!u&&E(c)&&E(c.gearSelectors)&&(u=Vn(c.gearSelectors)),!y&&E(r)){const S=re(r.powerSelection)?ne(r.powerSelection):r.powerSelection;E(S)&&(y=Jn(S))}if(o){if(m.length)for(let S=0;S<m.length;S+=1){const w=Wc(m[S]);if(w){const j=zo(w)||{},x=zo(o)||{};p.projectInfo={...j,...x};break}}}else for(let S=0;S<m.length;S+=1){const w=Wc(m[S]);if(w){p.projectInfo=zo(w);break}}const b=[],A=new Set,O=S=>{if(typeof S!="string")return;const w=S.trim();!w||A.has(w)||(A.add(w),b.push(w))},C=(S,w={})=>{if(S==null)return;if(w.fromSelections){(Array.isArray(S)?S:[S]).forEach(N=>{if(re(N)){const M=ne(N);if(M){C(M,{fromSelections:!0});return}}if(E(N)){const M=Ha(N);if(M.length){M.forEach(B=>{B&&typeof B.name=="string"&&O(B.name)});return}}const z=Re(N);z&&O(z)});return}const j=Ye(S);j.length&&j.forEach(x=>{O(x)})};if(p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lenses")){const{names:S}=If(p.projectInfo.lenses);p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=S.slice(),C(S)}C(e.lenses),E(r)&&C(r.lenses),C(a&&a.lenses),E(c)&&C(c.lenses),(!p.projectInfo||!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&b.length&&(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=b.slice());const k=[];p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&(C(p.projectInfo.lensSelections,{fromSelections:!0}),k.push(p.projectInfo.lensSelections)),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&(C(e.lensSelections,{fromSelections:!0}),k.push(e.lensSelections)),E(r)&&Object.prototype.hasOwnProperty.call(r,"lensSelections")&&(C(r.lensSelections,{fromSelections:!0}),k.push(r.lensSelections)),E(a)&&Object.prototype.hasOwnProperty.call(a,"lensSelections")&&(C(a.lensSelections,{fromSelections:!0}),k.push(a.lensSelections)),E(c)&&Object.prototype.hasOwnProperty.call(c,"lensSelections")&&(C(c.lensSelections,{fromSelections:!0}),k.push(c.lensSelections));const _=Ws(k,b);_&&_.selections&&_.selections.length?(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lensSelections=_.selections,(!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&(p.projectInfo.lenses=_.selections.map(S=>typeof S.name=="string"?S.name:"").filter(S=>S))):_&&_.changed&&p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&delete p.projectInfo.lensSelections;const v=typeof e.gearListAndProjectRequirementsGenerated=="boolean"?e.gearListAndProjectRequirementsGenerated:m.some(S=>typeof S=="string"&&S.trim());if(p.gearListAndProjectRequirementsGenerated=v,i&&i.length&&(p.autoGearRules=th(i)),u&&Object.keys(u).length&&(p.gearSelectors=u),y&&(p.powerSelection=nh(y)),vg(e,p),p.projectInfo&&hs(p.projectInfo),p.projectInfo){const S=fe(p.projectInfo);S!==p.projectInfo&&(p.projectInfo=S)}if(p.autoGearRules){const S=fe(p.autoGearRules);S!==p.autoGearRules&&(p.autoGearRules=S)}if(p.gearSelectors){const S=fe(p.gearSelectors);S!==p.gearSelectors&&(p.gearSelectors=S)}if(p.diagramPositions){const S=fe(p.diagramPositions);S!==p.diagramPositions&&(p.diagramPositions=S)}if(p.powerSelection){const S=fe(p.powerSelection);S!==p.powerSelection&&(p.powerSelection=S)}return p}if(Object.prototype.hasOwnProperty.call(e,"projectHtml")||Object.prototype.hasOwnProperty.call(e,"gearHtml"))return{gearList:{projectHtml:e.projectHtml||"",gearHtml:e.gearHtml||""},projectInfo:null};if(E(e.project)){const r=Ke(e.project);if(r)return r}else if(typeof e.project=="string"){const r=Oe(e.project);if(r.success){const n=Ke(r.parsed);if(n)return n}}}return null}var ih=new Set(["gearList","projectInfo","projectHtml","gearHtml","autoGearRules","powerSelection","gearListAndProjectRequirementsGenerated"]),sh=new Set(["gearList","projectInfo","autoGearRules","diagramPositions","gearSelectors","powerSelection","gearListAndProjectRequirementsGenerated"]);function Si(e){if(!E(e)||!Object.keys(e).every(o=>sh.has(o)))return!1;const{gearList:r,projectInfo:n}=e;if(typeof r!="string"&&!(E(r)&&Object.keys(r).every(o=>typeof r[o]=="string"))||n!==null&&!E(n)||Object.prototype.hasOwnProperty.call(e,"autoGearRules")&&(!Array.isArray(e.autoGearRules)||!e.autoGearRules.length)||Object.prototype.hasOwnProperty.call(e,"diagramPositions")&&!E(e.diagramPositions)||Object.prototype.hasOwnProperty.call(e,"gearSelectors")&&!E(e.gearSelectors))return!1;if(Object.prototype.hasOwnProperty.call(e,"powerSelection")){const o=e.powerSelection;if(!E(o))return!1}return!(Object.prototype.hasOwnProperty.call(e,"gearListAndProjectRequirementsGenerated")&&typeof e.gearListAndProjectRequirementsGenerated!="boolean")}function Ge(e){return typeof e!="string"?"":e.trim()}function ah(e){if(e==null)return Yt="",Lt=!1,"";const t=Ge(e);return tm(t)?(Yt="",Lt=!1,t):(Yt=t,Lt=!0,t)}function ch(e){return!Lt||e!==void 0&&Ge(e)!==Yt?!1:(Yt="",Lt=!1,!0)}function Wr(e,t,r,n={}){if(!e||typeof e!="object")return null;const o=typeof r=="string"?r:"";if(Object.prototype.hasOwnProperty.call(e,o))return o;const i=Ge(o);if(i&&i!==o&&Object.prototype.hasOwnProperty.call(e,i))return i;if(!t||typeof t!="object")return null;const{raw:s,normalized:a}=t;if(s&&typeof s.get=="function"&&s.has(o)){const c=s.get(o);if(Object.prototype.hasOwnProperty.call(e,c))return c}if(a&&typeof a.get=="function"&&a.has(i)){const c=a.get(i);if(Array.isArray(c)){if(n&&n.preferExact&&o){const f=c.find(l=>l===o&&Object.prototype.hasOwnProperty.call(e,l));if(f)return f}const u=c.find(f=>Object.prototype.hasOwnProperty.call(e,f));if(u)return u}else if(typeof c=="string"&&Object.prototype.hasOwnProperty.call(e,c))return c}return null}function At(e={}){const{forceRefresh:t=!1,forMutation:r=!1,skipMigrations:n=!1,skipAutoBackupExpansion:o=!1}=e||{};if(n||_e(),kn)return{projects:{...qt},changed:!1,originalValue:{...qt},lookup:{raw:new Map,normalized:new Map}};const i=T();let s=null;if(i&&typeof i.getItem=="function")try{s=i.getItem(pe)}catch{s=null}const a=Te(i,pe,"Error loading project from localStorage:",null,{validate:w=>w===null||typeof w=="string"||Array.isArray(w)||E(w)}),c=a;let u=null;if(E(a)?u={...a}:u={},i&&typeof i.length=="number"){const w=i.length;for(let j=0;j<w;j++){const x=i.key(j);if(!x||!x.startsWith(jt))continue;const N=x.substring(jt.length);if(N!=null)try{const z=i.getItem(x),M=JSON.parse(jr(z));u===null&&(u={}),u[N]=M}catch{}}}let f=a;(u!==null&&Object.keys(u).length>0||E(a))&&(f=u);const l={isAutoBackupKey:Bt};o&&(l.filter=w=>!Bt(w));const y=Ju(f,l),p={};let d=!1;const g=new Set,m=new Set,b=w=>{if(typeof w!="string")return;g.add(w);const j=w.trim();j&&m.add(j.toLowerCase())},A=new Map,O=new Map,C=(w,j)=>{if(typeof w!="string")return;const x=typeof j=="string"?j:w;A.set(w,x);const N=Ge(w);O.has(N)||O.set(N,[]),O.get(N).push(x)},k=()=>({raw:Pn(A),normalized:Pn(O)}),_=()=>{const w={projects:p,changed:d,originalValue:c,lookup:k(),rawValue:s};return d?(Lc(null),r?{projects:sr(w.projects),changed:w.changed,originalValue:w.originalValue,lookup:Du(w.lookup)}:w):t?w:(Lc(w),Sg({forMutation:r})||w)};if(y==null)return _();if(typeof y=="string"){const w=Ke(y);if(w){const j=w&&w.projectInfo&&typeof w.projectInfo.projectName=="string"?w.projectInfo.projectName:"",x=$n(j,g,m);p[x]=w,C("",x),b(x)}return d=!0,_()}if(Array.isArray(y)){const w=g,j=m;return y.forEach((x,N)=>{const z=Ke(x);if(!z){d=!0;return}const B=(E(x)&&typeof x.name=="string"?x.name.trim():`Project ${N+1}`)||`Project ${N+1}`,$=$n(B,w,j);p[$]=z,C(B,$),b($)}),d=!0,_()}if(!E(y))return d=!0,_();const v=Object.keys(y);if(v.length>0&&v.every(w=>ih.has(w))){const w=Ke(y);if(w){const j=$n("",g,m);p[j]=w,C("",j),b(j)}return d=!0,_()}return v.forEach(w=>{if(Si(y[w])){const j=typeof w=="string"?w.trim():"";j&&m.add(j.toLowerCase())}}),v.forEach(w=>{const j=Ke(y[w]);if(j){const x=y[w],z=!Si(x);let M=!1;if(!z)try{const $=Ce(j),Gt=Ce(x);$!==Gt&&(M=!0)}catch($){M=!0,console.warn("Unable to compare stored project entry during legacy long-GOP normalization check",$)}let B=w;if(z){const $=j&&j.projectInfo&&typeof j.projectInfo.projectName=="string"&&j.projectInfo.projectName?j.projectInfo.projectName:w;B=$n($,g,m),d=!0}B!==w&&Object.prototype.hasOwnProperty.call(p,B)&&(B=$n(B,g,m)),p[B]=j,C(w,B),b(B),!z&&M&&(d=!0)}else d=!0}),_()}function vf(e,t){if(!e||typeof e.length!="number"||!E(t))return;const r=new Set(Object.keys(t).map(o=>Ge(o))),n=[];for(let o=0;o<e.length;o+=1){const i=e.key(o);if(i&&i.startsWith(jt)){const s=i.substring(jt.length);r.has(s)||n.push(i)}}n.forEach(o=>ce(e,o,"Pruning orphan project shard:"))}function jf(e){if(!e||h&&h.__cineMonolithicProjectCleanupDone)return;const t=e.getItem(pe);if(!t){h&&(h.__cineMonolithicProjectCleanupDone=!0);return}try{const r=JSON.parse(jr(t));r&&lt(e,pe,r)}catch{}ce(e,pe,"Error clearing project monolithic storage after sharding:",{disableBackup:!1,disableMigrationCleanup:!0}),h&&(h.__cineMonolithicProjectCleanupDone=!0)}function Lf(e,t,r={}){if(e==null||t===void 0||t===null)return!1;const n=T();if(!n)return!1;const{skipCompression:o=!1}=r||{},i=jt+Ge(e),s={};s[e]=t;const c=Qu(s,{isAutoBackupKey:Bt})[e];return ke(n,i,c,`Error saving project shard "${e}":`,{disableCompression:o,forceCompressionOnQuota:!0,disableBackup:!0,onQuotaExceeded:()=>{const{projects:f}=At({forMutation:!1,skipMigrations:!0});let l=Ks(f);if(l||(l=Ks(f,{force:!0})),l){const y=jt+Ge(l);return ce(n,y,`Pruning shard "${l}" to recover space:`),!0}return!1}})==="success"}function qa(e,t={}){const{skipCompression:r=!1}=t||{},n=T();if(!(!e||typeof e!="object")){Fa(e),vf(n,e),Object.keys(e).forEach(o=>{Lf(o,e[o],{skipCompression:r})}),jf(n),Ra(n);try{Rf(e,n)}catch(o){console.warn("Failed to update project index",o)}if(tr(),Ie)try{Ie.postMessage("project-shards-changed")}catch{}}}let wi=null;function lh(){if(wi)return wi;const e=T(),t=P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter";if(!e||typeof e.getItem!="function"||t)return null;try{const r=e.getItem(pi);if(!r)return null;const n=JSON.parse(r);if(n&&typeof n=="object")return n}catch(r){console.warn("Failed to read project index",r)}return null}function Rf(e,t){if(!e||typeof e!="object")return;const r={};Object.keys(e).forEach(o=>{if(Bt(o))return;const i=e[o];i&&(r[o]={color:i.color,icon:i.icon,lastModified:i.lastModified,prepDays:i.prepDays,shootingDays:i.shootingDays,returnDays:i.returnDays,archived:i.archived,status:i.status})}),wi=r;const n=P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter";if(P&&P.setItem(pi,r).catch(o=>console.warn("Failed to persist index to repo",o)),!n&&t&&typeof t.setItem=="function")try{t.setItem(pi,JSON.stringify(r))}catch(o){console.warn("Failed to write project index",o)}}function Tf(e){const t=e!==void 0&&!(typeof e=="string"&&Bt(e));let{projects:r,changed:n,originalValue:o,lookup:i}=At({skipAutoBackupExpansion:t}),s=null;if(e!==void 0&&(s=Wr(r,i,e,{preferExact:!0}),s!=null&&Xi(s)),n){const a=T();a&&lt(a,pe,o);const c=sr(r);qa(c),r=c}if(e===void 0)return Zg(r),r;if(s!=null&&Object.prototype.hasOwnProperty.call(r,s)){const a=r[s];if(a&&(!a.gearList||a.gearList==="")){const u=_o()[s];u&&u.gearList&&(a.gearList=u.gearList)}return a}return null}function uh(){const e=lh();if(e)return e;const t=At({forMutation:!1,skipAutoBackupExpansion:!0}),r={};if(t&&t.projects){const n=Object.keys(t.projects);for(let i=0;i<n.length;i++){const s=n[i];if(Bt(s))continue;const a=t.projects[s];a&&(r[s]={color:a.color,icon:a.icon,lastModified:a.lastModified,prepDays:a.prepDays,shootingDays:a.shootingDays,returnDays:a.returnDays,archived:a.archived,status:a.status})}const o=T();if(o)try{Rf(t.projects,o)}catch{}}return r}function Nf(e){if(typeof e!="string")return"";const t=e.replace(/\s+/g," ").trim();return t?t.length<=120?t:t.slice(0,120):""}function Mf(e){const t=r=>String(r).padStart(2,"0");return[e.getFullYear(),t(e.getMonth()+1),t(e.getDate()),t(e.getHours()),t(e.getMinutes()),t(e.getSeconds())].join("-")}function fh(e,t){const n=Mf(new Date),o=Nf(e),i=o?`${Et}${n}-${o}`:`${Et}${n}`,s=new Set(Object.keys(t));if(!s.has(i))return{name:i};let a=2,c=`${i}-${a}`;for(;s.has(c);)a+=1,c=`${i}-${a}`;return{name:c}}function zf(e){if(e!==void 0){if(e===null||typeof e!="object")return e;try{const t=sr(e),r=fe(t);return r!==t?r:t}catch(t){console.warn("Unable to deep clone project for backup",t);const r={...e},n=fe(r);return n!==r?n:r}}}function Bf(e,t){if(!e||!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(typeof t=="string"&&t.startsWith(Fe))return{status:"skipped"};const r=e[t];if(r===void 0)return{status:"missing"};const{name:n}=fh(t,e);if(!n)return{status:"failed"};const o=zf(r);return o===void 0?(typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipping deletion backup for project "${t}" because no stored data was available during backup creation.`),{status:"missing"}):(e[n]=o,{status:"created",backupName:n})}function ph(e){const{projects:t,changed:r,originalValue:n,lookup:o}=At({forMutation:!0});if(!t||typeof t!="object")return{status:"invalid"};const i=Wr(t,o,e,{preferExact:!0}),s=Ge(e),a=i??s;if(!Object.prototype.hasOwnProperty.call(t,a))return{status:"missing"};const c=Bf(t,a);if(c.status!=="created")return c;if(r){const u=T();u&&lt(u,pe,n)}return Xi(c.backupName),qa(t),c}function dh(e,t){const r=Mf(new Date),n=Nf(e),o=n?`${Fe}${r}-${n}`:`${Fe}${r}`,i=new Set(Object.keys(t));if(!i.has(o))return{name:o};let s=2,a=`${o}-${s}`;for(;i.has(a);)s+=1,a=`${o}-${s}`;return{name:a}}function yh(e,t){if(!E(e)||typeof t!="string")return{status:"invalid"};if(!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(t.startsWith(Fe)||t.startsWith(Et))return{status:"skipped"};const r=zf(e[t]);if(r===void 0)return{status:"failed"};const{name:n}=dh(t,e);return n?(e[n]=r,{status:"created",backupName:n}):{status:"failed"}}function Wa(e,t,r={}){if(!E(t))return;const n=Ke(t);if(!n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped saving project "${e||""}" because the payload could not be normalised.`);return}const o=!!(r&&r.skipOverwriteBackup),i=!!(r&&r.skipCompression),s=typeof e=="string"?e:"",a=Ge(s),c=At({forMutation:!0}),u=E(c.projects)?c.projects:{};if(c.changed){const w=T();w&&lt(w,pe,c.originalValue)}const f=Wr(u,c.lookup,s,{preferExact:!0}),l=f!=null&&Object.prototype.hasOwnProperty.call(u,f)?u[f]:null,y=l?Ce(l):null,p=At({forMutation:!0}),d=E(p.projects)?p.projects:{};if(p.changed){const w=T();w&&lt(w,pe,p.originalValue)}const g=Wr(d,p.lookup,s,{preferExact:!0});let m=g,b=null;a&&a!==g&&!Object.prototype.hasOwnProperty.call(d,a)&&(m=a,b=g),m==null&&(m=a),!m&&m!==""&&(m="");const A=b??m,O=A!=null&&Object.prototype.hasOwnProperty.call(d,A),C=O?d[A]:null;if(O&&!o){const w=Ce(C),j=Ce(n);w!==j&&yh(d,A).status==="failed"&&console.warn(`Automatic backup before overwriting project "${A}" failed. Proceeding with save.`)}if(b!=null&&b!==m){let w=!!y;Object.prototype.hasOwnProperty.call(d,b)&&y?Ce(d[b])!==y&&(w=!1):w=!1,w?(delete d[b],Gs(b)):typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped removing "${b}" while saving "${m}" because the original entry changed in another tab.`)}const k=r&&r.renamedFrom;if(k&&k!==m){const w=Wr(d,p.lookup,k,{preferExact:!0});w&&Object.prototype.hasOwnProperty.call(d,w)&&(delete d[w],Gs(w))}const _=m||"";d[_]=n,Xi(_),Fa(d),P&&P.saveProject(_,n).catch(w=>console.warn("[saveProject] Repo write failed",w)),kn&&(qt[_]=n);const v=P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter";let S=!0;if(v||(S=Lf(_,n,{skipCompression:i})),S){const w=T();if(vf(w,d),jf(w),tr(),Ie)try{Ie.postMessage("project-shards-changed")}catch{}Ra(w)}else qa(d,{skipCompression:i})}function xf(e){if(e===void 0){const l=[T()];typeof localStorage<"u"&&l.indexOf(localStorage)===-1&&l.push(localStorage),l.forEach(p=>{if(p&&typeof p.removeItem=="function")try{p.removeItem(pe);const d=typeof de=="string"?de:"__backup";p.removeItem(`${pe}${d}`),p.removeItem("cameraPowerPlanner_project__backup")}catch(d){console.warn("[FactoryReset] Failed to force delete project keys",d)}if(ce(p,pe,"Error deleting project from storage:"),p&&typeof p.length=="number"){const d=[];for(let g=0;g<p.length;g++){const m=p.key(g);m&&m.startsWith(jt)&&d.push(m)}d.forEach(g=>ce(p,g,"Error deleting project shard from storage:"))}});try{P&&P.clear().catch(p=>console.warn("[FactoryReset] Failed to clear StorageRepository",p)),Ts&&Ts.clear().catch(p=>console.warn("[FactoryReset] Failed to clear DataVault",p)),ze&&ze.reset()}catch(p){console.warn("[FactoryReset] Error clearing modern storage",p)}if(typeof or=="function")try{or()}catch(p){console.warn("Failed to clear UI cache during project deletion",p)}if(tr(),Ie)try{Ie.postMessage("project-shards-changed")}catch{}Ar&&typeof Ar.clear=="function"&&Ar.clear();const y=T();y&&Ra(y);return}const{projects:t,changed:r,originalValue:n,lookup:o}=At({forMutation:!0});if(r){const l=T();l&&lt(l,pe,n)}const i=Wr(t,o,e,{preferExact:!0}),s=i??Ge(e);if(!Object.prototype.hasOwnProperty.call(t,s)){const l=jt+Ge(e),y=T();y&&ce(y,l,"Error deleting orphan project shard:");return}if(Bf(t,s).status==="failed"){console.warn(`Automatic backup before deleting project "${s}" failed. Deletion aborted.`),le();return}const c=jt+Ge(s),u=T(),f=P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter";if(u&&!f&&ce(u,c,"Error deleting project shard:"),kn&&delete qt[s],P.removeItem(s).catch(l=>console.warn("Failed to delete from repo",l)),delete t[s],Gs(s),tr(),Ie)try{Ie.postMessage("project-shards-changed")}catch{}}function gh(e,t){if(!e||!t)return null;const{projects:r}=At({forMutation:!0}),n=Wr(r,null,e,{preferExact:!0});if(!n||!r[n])return null;const o=t.trim();if(!o||o===n)return n;const i=r[n];if(i.name=o,kn?(delete qt[n],qt[o]=i):(delete r[n],r[o]=i),P.removeItem(n).catch(s=>console.warn("Failed to delete old project key",s)),Wa(o,i),tr(),Ie)try{Ie.postMessage("project-shards-changed")}catch{}return o}function Yc(){const{projects:e,changed:t,originalValue:r}=At({forMutation:!0});if(t){const s=T();s&&lt(s,pe,r)}const n=new Set(Object.keys(e)),o=new Set([...n].map(s=>s.trim().toLowerCase())),i="Imported project";return(s,a,c=i)=>{const u=Ke(a);if(!u)return;!(a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"gearListAndProjectRequirementsGenerated")&&typeof a.gearListAndProjectRequirementsGenerated=="boolean")&&typeof u.gearListAndProjectRequirementsGenerated!="boolean"&&(u.gearListAndProjectRequirementsGenerated=!1);const l=[];if(typeof s=="string"&&l.push(s.trim()),E(a)){typeof a.name=="string"&&l.push(a.name.trim());const m=a.projectInfo;E(m)&&typeof m.projectName=="string"&&l.push(m.projectName.trim())}const y=typeof c=="string"&&c.trim()?c.trim():i,p=l.length>0?l[0]:y,d=typeof p=="string"?p.trim().toLowerCase():"",g=o.has(d)?zm(p,n,o):Da(p,n,o);Wa(g,u,{skipCompression:!1})}}function Oe(e){if(typeof e!="string")return{success:!1,parsed:null};const t=e.trim();if(!t)return{success:!1,parsed:null};const r=t[0],n=t[t.length-1];let o=null;if(r==="{"?o="}":r==="["?o="]":r==='"'&&(o='"'),!o||n!==o)return{success:!1,parsed:null};try{return{success:!0,parsed:JSON.parse(t)}}catch{return{success:!1,parsed:null}}}function oo(e,t,r="Imported project"){if(typeof e=="string"){const n=Oe(e);return n.success?oo(n.parsed,t,r):(t()(r,e,r),!0)}if(re(e)){const n=ne(e);return n?oo(Object.entries(n),t,r):!1}if(Array.isArray(e)){const n=e.map(s=>s==null?null:Array.isArray(s)&&s.length>=2?{name:s[0],project:s[1]}:E(s)&&typeof s.name=="string"?{name:s.name,project:s}:{name:"",project:s}).filter(Boolean);if(!n.length)return!0;const o=t();let i=0;return n.forEach(({name:s,project:a})=>{if(a==null)return;i+=1;let c="";typeof s=="string"?c=s:typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"?c=String(s):typeof s=="symbol"&&(c=s.description||s.toString()),o(c,a,`${r} ${i}`)}),!0}if(E(e)){const n=t();return Object.entries(e).forEach(([o,i])=>{const s=typeof o=="string"?o:pf(o);n(typeof s=="string"&&s?s:r,i,r)}),!0}return!1}function mh(e){if(!e||typeof e!="object")return[];const t=[],r=i=>{i!=null&&t.push(i)};["projectData","projectCollection","projectEntries","legacyProjects","legacyProjectData"].forEach(i=>{Object.prototype.hasOwnProperty.call(e,i)&&r(e[i])}),E(e.data)&&(Object.prototype.hasOwnProperty.call(e.data,"project")&&r(e.data.project),Object.prototype.hasOwnProperty.call(e.data,"projects")&&r(e.data.projects));const o=e.plannerData;return Array.isArray(o)&&o.forEach(i=>{if(Array.isArray(i)&&i.length>=2){const c=i[0];typeof c=="string"&&c.toLowerCase().includes("project")&&r(i[1]);return}if(!i||typeof i!="object")return;const s=typeof i.key=="string"?i.key:typeof i.name=="string"?i.name:typeof i.id=="string"?i.id:typeof i.section=="string"?i.section:null;if(!s||!s.toLowerCase().includes("project"))return;const a=Object.prototype.hasOwnProperty.call(i,"value")?i.value:Object.prototype.hasOwnProperty.call(i,"data")?i.data:Object.prototype.hasOwnProperty.call(i,"project")?i.project:Object.prototype.hasOwnProperty.call(i,"projects")?i.projects:null;a!=null&&r(a)}),t}function Gf(){_e();const e=T(),t=Te(e,st,"Error loading favorites from localStorage:",{},{validate:r=>r===null||E(r)});return E(t)?t:{}}function Ff(e){const t=T();if(e==null){ce(t,st,"Error deleting favorites from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid favorites payload. Expected a plain object.");return}qe(t,st),ke(t,st,e,"Error saving favorites to localStorage:")}function hh(){if(Ct||(Pc||(Pc=!0,_n&&(Ct=_n)),Ct))return Ct;const e=h&&typeof h=="object"?h:null;if(e&&e.cineFeaturesContacts&&typeof e.cineFeaturesContacts=="object")return Ct=e.cineFeaturesContacts,Ct;const t=e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null;if(t&&typeof t.resolveModule=="function")try{const r=t.resolveModule("cine.features.contacts",e);if(r&&typeof r=="object")return Ct=r,Ct}catch{}return Ct}function Df(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return Df(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function bh(e){if(e&&typeof e.generateContactId=="function")try{const t=e.generateContactId();if(typeof t=="string"&&t)return t}catch{}return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function Sh(e,t){if(!e||typeof e!="object")return null;const r=Df,n=r(e.id)||bh(t),o=r(e.name),i=r(e.role),s=r(e.phone),a=r(e.email),c=r(e.website||e.url),u=r(e.notes||e.note||e.text),f=typeof e.avatar=="string"?e.avatar.trim():"",l=f&&f.startsWith("data:")?f:"",y=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),p=Number.isFinite(e.updatedAt)?e.updatedAt:y,d={id:n,name:o,role:i,phone:s,email:a,website:c,notes:u,createdAt:y,updatedAt:p};return l&&(d.avatar=l),d}function wh(e){if(!Array.isArray(e))return[];const t=e.filter(r=>r&&typeof r=="object").map(r=>({...r}));return t.sort((r,n)=>{const o=(r&&r.name?r.name:"").toLowerCase(),i=(n&&n.name?n.name:"").toLowerCase();if(o&&i&&o!==i)try{return o.localeCompare(i)}catch{}if(o&&!i)return-1;if(!o&&i)return 1;const s=r&&typeof r.createdAt=="number"?r.createdAt:0,a=n&&typeof n.createdAt=="number"?n.createdAt:0;return s-a}),t}function Ya(e){if(!Array.isArray(e))return[];const t=hh();if(t&&typeof t.sortContacts=="function")try{const o=t.sortContacts(e);if(Array.isArray(o))return o.filter(i=>i&&typeof i=="object")}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contacts via module.",o)}const r=t&&typeof t.normalizeContactEntry=="function"?t.normalizeContactEntry:null,n=[];for(let o=0;o<e.length;o+=1){const i=e[o];if(!i)continue;let s=null;if(r)try{s=r(i)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contact entry via module.",a),s=null}s||(s=Sh(i,t)),s&&typeof s=="object"&&n.push(s)}return wh(n)}function Uf(){_e();const e=T(),t=Te(e,at,"Error loading contacts from localStorage:",[],{validate:r=>r===null||Array.isArray(r)});return Array.isArray(t)?Ya(t):[]}function Ys(e){const t=T();if(e==null){ce(t,at,"Error deleting contacts from localStorage:");return}if(!Array.isArray(e)){console.warn("Ignoring invalid contacts payload. Expected an array.");return}const r=Ya(e);qe(t,at),ke(t,at,r,"Error saving contacts to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Kf(){return Iu.getOwnGear()}function $f(e){return Iu.saveOwnGear(e)}function cn(e){if(typeof e=="string")return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="bigint")return e.toString();if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return cn(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Ja(e){if(!e||typeof e!="object")return null;const t=cn(e.name),r=cn(e.role),n=cn(e.avatar),o=n&&n.toLowerCase().startsWith("data:")?n:"",i=cn(e.phone),s=cn(e.email);return!t&&!r&&!o&&!i&&!s?{name:"",role:"",avatar:"",phone:"",email:""}:{name:t,role:r,avatar:o,phone:i,email:s}}function Vf(){_e();const e=T(),t=Te(e,mt,"Error loading user profile from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?Ja(t)||{name:"",role:"",avatar:"",phone:"",email:""}:{name:"",role:"",avatar:"",phone:"",email:""}}function Qo(e){const t=T();if(e==null){ce(t,mt,"Error deleting user profile from localStorage:");return}const r=Ja(e)||{name:"",role:"",avatar:"",phone:"",email:""};if(!r.name&&!r.role&&!r.avatar&&!r.phone&&!r.email){ce(t,mt,"Error deleting user profile from localStorage:");return}qe(t,mt),ke(t,mt,r,"Error saving user profile to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,enableCompressionSweep:!1})}function Hf(){_e();const e=T(),t=Te(e,Wt,"Error loading feedback from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?t:{}}function qf(e){const t=T();if(e==null){ce(t,Wt,"Error deleting feedback from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid feedback payload. Expected a plain object.");return}qe(t,Wt),ke(t,Wt,e,"Error saving feedback to localStorage:")}function Yr(e){if(!e)return null;if(typeof e=="string"){const t=e.trim();return t?{createdAt:t}:null}if(typeof e=="object"){const t=typeof e.createdAt=="string"&&e.createdAt.trim()?e.createdAt.trim():typeof e.iso=="string"&&e.iso.trim()?e.iso.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?e.timestamp.trim():null;if(!t)return null;const r={createdAt:t};return typeof e.fileName=="string"&&e.fileName.trim()?r.fileName=e.fileName.trim():typeof e.name=="string"&&e.name.trim()&&(r.fileName=e.name.trim()),r}return null}function bo(){if(Jr!==null){const n=Jr;if(Array.isArray(n))return n.map(Yr).filter(Boolean)}_e();const e=T(),t=Te(e,Je,"Error loading full backup history from localStorage:",[],{validate:n=>n===null||Array.isArray(n)});if(!Array.isArray(t))return[];const r=t.map(Yr).filter(Boolean);return Jr=r,P.setItem(Je,r).catch(n=>{console.warn("[storage.js] Failed to persist backup history to new storage:",n)}),r}function Ei(e){const t=T();if(e==null){Jr=[],ce(t,Je,"Error deleting full backup history from localStorage:"),P.removeItem(Je).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)});return}if(!Array.isArray(e)){console.warn("Ignoring invalid full backup history payload. Expected an array.");return}const r=e.map(Yr).filter(Boolean);if(!r.length){e.length===0?(Jr=[],ce(t,Je,"Error deleting full backup history from localStorage:"),P.removeItem(Je).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)})):console.warn("Ignoring full backup history update because no valid entries were provided.");return}Jr=r,qe(t,Je),ke(t,Je,r,"Error saving full backup history to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0}),P.setItem(Je,r).catch(n=>{console.warn("[storage.js] Failed to persist backup history to new storage:",n)})}var Wf=e=>{const t=Yr(e);if(!t)return bo();const r=bo();r.push(t);const n=r.slice(-200);return Ei(n),n};function Kt(e,t,r=0){if(e==null)return[];if(r>50)return[];if(Array.isArray(e)){const o=[],i=e.length,s=t||new WeakSet;if(s.has(e))return[];s.add(e);for(let a=0;a<i;a+=1){const c=e[a];if(!(typeof c=="object"&&c!==null&&s.has(c)))if(Array.isArray(c)){const u=Kt(c,s,r+1);if(u&&u.length)for(let f=0;f<u.length;f+=1)o.push(u[f])}else{const u=Yr(c);u&&o.push(u)}}return o}const n=t||new WeakSet;if(typeof e=="object"&&e!==null){if(n.has(e))return[];n.add(e)}if(re(e)){const o=ne(e);return o?Kt(Object.values(o),n,r+1):[]}if(typeof e=="string"){const o=Oe(e);if(o.success)return Kt(o.parsed,n,r+1);const i=Yr(e);return i?[i]:[]}if(Array.isArray(e))return[];if(E(e)){if(Array.isArray(e.history))return Kt(e.history,n,r+1);if(Array.isArray(e.entries))return Kt(e.entries,n,r+1);if(Array.isArray(e.list))return Kt(e.list,n,r+1);const o=Yr(e);if(o)return[o];const i=Object.values(e);if(i.length)return Kt(i,n,r+1)}return[]}var Oi=1;function Eh(){var e=0;if(typeof Date<"u"&&Date&&typeof Date.now=="function")e=Date.now();else try{e=new Date().getTime()}catch{e=Math.floor(Math.random()*1e9)}var t=0;try{t=Math.floor(Math.random()*1e6)}catch{t=e%1e6}return"doc-tracker-"+e.toString(36)+"-"+t.toString(36)}function Jc(e){var t=!1,r=null;if(e&&typeof e=="object"){typeof e.completed=="boolean"?t=e.completed:typeof e.checked=="boolean"?t=e.checked:typeof e.value=="boolean"?t=e.value:e.done===!0&&(t=!0);var n=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?n=e.updatedAt.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?n=e.timestamp.trim():typeof e.completedAt=="string"&&e.completedAt.trim()&&(n=e.completedAt.trim()),n&&(r=n)}else if(typeof e=="boolean")t=e;else if(typeof e=="string"){var o=e.trim().toLowerCase();(o==="true"||o==="1"||o==="yes"||o==="done")&&(t=!0)}return{completed:t===!0,updatedAt:typeof r=="string"?r:null}}function Oh(e){var t={};if(Array.isArray(e)){for(var r=0;r<e.length;r+=1){var n=e[r];if(n!=null){if(typeof n=="string"&&n.trim()){t[n.trim()]={completed:!0,updatedAt:null};continue}if(typeof n=="object"){var o=null;if(typeof n.id=="string"&&n.id.trim()?o=n.id.trim():typeof n.key=="string"&&n.key.trim()?o=n.key.trim():typeof n.name=="string"&&n.name.trim()&&(o=n.name.trim()),!o)continue;t[o]=Jc(n)}}}return t}if(e&&(typeof e=="object"||typeof e=="function"))for(var i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(a!=null){var c=typeof a=="string"?a:String(a);if(c){var u=c.trim();u&&(t[u]=Jc(e[a]))}}}return t}function Ah(e){var t={};if(e&&(typeof e=="object"||typeof e=="function"))for(var r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n];o&&(t[o]=Oh(e[o]))}return t.locales||(t.locales={}),t.helpTopics||(t.helpTopics={}),t.printGuides||(t.printGuides={}),t}function Qc(e){if(!e||typeof e!="object"&&typeof e!="function")return null;var t=null;typeof e.id=="string"&&e.id.trim()&&(t=e.id.trim()),!t&&typeof e.key=="string"&&e.key.trim()&&(t=e.key.trim()),t||(t=Eh());var r="";typeof e.name=="string"?r=e.name.trim():typeof e.title=="string"&&(r=e.title.trim());var n="";typeof e.targetDate=="string"&&e.targetDate.trim()?n=e.targetDate.trim():typeof e.releaseDate=="string"&&e.releaseDate.trim()&&(n=e.releaseDate.trim());var o="";if(typeof e.createdAt=="string"&&e.createdAt.trim()?o=e.createdAt.trim():typeof e.generatedAt=="string"&&e.generatedAt.trim()&&(o=e.generatedAt.trim()),!o)try{o=new Date().toISOString()}catch{o=""}var i=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?i=e.updatedAt.trim():typeof e.modifiedAt=="string"&&e.modifiedAt.trim()?i=e.modifiedAt.trim():typeof e.lastUpdated=="string"&&e.lastUpdated.trim()?i=e.lastUpdated.trim():typeof e.timestamp=="string"&&e.timestamp.trim()&&(i=e.timestamp.trim()),i||(i=o||null);var s="";typeof e.notes=="string"?s=e.notes.trim():typeof e.summary=="string"&&(s=e.summary.trim()),s&&s.length>8e3&&(s=s.slice(0,8e3));var a=!1;if(typeof e.archived=="boolean")a=e.archived;else if(typeof e.status=="string"){var c=e.status.trim().toLowerCase();(c==="archived"||c==="closed"||c==="complete")&&(a=!0)}var u=Ah(e.statuses);return{id:t,name:r,targetDate:n,createdAt:typeof o=="string"?o:"",updatedAt:typeof i=="string"?i:null,statuses:u,notes:s,archived:a===!0}}function io(e){var t={version:Oi,releases:[]};if(e==null)return t;var r=e;if(Array.isArray(r))return t.releases=r.map(Qc).filter(Boolean),t;if(typeof r!="object"&&typeof r!="function")return t;typeof r.version=="number"&&Number.isFinite(r.version)&&(t.version=r.version);var n=null;if(Array.isArray(r.releases)?n=r.releases:Array.isArray(r.entries)?n=r.entries:Array.isArray(r.logs)&&(n=r.logs),!n&&r&&typeof r=="object"){var o=Object.values(r);o.length&&o.every(function(i){return i&&typeof i=="object"&&!Array.isArray(i)})&&(n=o)}return!n||!Array.isArray(n)?t.releases=[]:t.releases=n.map(Qc).filter(Boolean),t}function Yf(){_e();const e=T(),t=Te(e,Vt,"Error loading documentation tracker from localStorage:",null,{validate:n=>n===null||E(n)||Array.isArray(n)});if(!t)return{version:Oi,releases:[]};const r=io(t);return!r||!Array.isArray(r.releases)?{version:Oi,releases:[]}:r}function Xo(e){const t=T();if(e==null){ce(t,Vt,"Error deleting documentation tracker from localStorage:");return}const r=io(e);if(!r.releases.length){ce(t,Vt,"Error deleting documentation tracker from localStorage:");return}qe(t,Vt),ke(t,Vt,{version:Oi,releases:r.releases},"Error saving documentation tracker to localStorage:",{disableCompression:!0})}function Jf(){_e();const e=T(),t=Te(e,vr,"Error loading automatic gear rules from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?fe(r):[];if(n!==r&&Qa(n,{skipNormalization:!0}),Array.isArray(n)){let o=!1;const i=n.map(s=>s&&typeof s=="object"&&typeof s.enabled>"u"?(o=!0,{...s,enabled:!0}):s);return o?i:n}return[]}function Qa(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],i=n?o:Array.isArray(o)?fe(o):[],s=T();return qe(s,vr),ke(s,vr,i,"Error saving automatic gear rules to localStorage:",{disableCompression:!0}),i}function Xa(){_e();const e=T(),t=Te(e,Rt,"Error loading automatic gear rule backups from localStorage:",[],{validate:i=>i===null||Array.isArray(i)}),r=Array.isArray(t)?t:[],{normalized:n,changed:o}=Ba(r);return o&&Za(n,{skipNormalization:!0}),n}function Za(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],{normalized:i}=n?{normalized:o}:Ba(o),s=T();qe(s,Rt);let a=!1,c=!1;if(typeof window<"u"&&window.localStorage===s&&typeof P<"u"&&P.setItem(Rt,i).catch(f=>{console.warn("[Storage] Failed to async persist Auto Gear Backups to IDB:",f)}),!(typeof P<"u"&&P.driver&&P.driver.constructor.name==="IndexedDBAdapter"))return ke(s,Rt,i,"Error saving automatic gear rule backups to localStorage:",{onQuotaExceeded:(f,l={})=>{const y=$s(i);if(y){const d=y.label;return console.warn(d?`Removed automatic gear backup "${d}" to free up storage space before saving gear backups.`:"Removed oldest automatic gear backup entry to free up storage space before saving gear backups."),!0}const p=l&&l.storage?l.storage:s;return!!(!a&&(a=!0,Pm(p))||!c&&(c=!0,Vs()))}}),i}function Qf(){_e();const e=T();return mf(e,Zr,"Error loading automatic gear seed flag from localStorage:")}function Js(e){const t=T();hf(t,Zr,!!e,"Error saving automatic gear seed flag to localStorage:")}function Xf(){_e();const e=T(),t=Te(e,Tt,"Error loading automatic gear presets from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?fe(r):[];return n!==r&&Zi(n,{skipNormalization:!0}),Array.isArray(n)?n:[]}let Ai=null,so=null,ao=null,Ci=null,_i=null,ki=null,Pi=null,Ii=null,vi=null,ji=null,Li=null,Ri=null,Ti=null,Ni=null,Mi=null,zi=null,Jr=null;function Ch(){const e=new Set,t=r=>{if(typeof r=="string"){const n=r.trim();n&&e.add(n)}};if(typeof Bi=="function")try{t(Bi())}catch(r){console.warn("Unable to read automatic gear active preset id while evaluating compression policy.",r)}if(typeof xi=="function")try{t(xi())}catch(r){console.warn("Unable to read automatic gear auto preset id while evaluating compression policy.",r)}return e}function Zi(e,t={}){const r=t||{},{skipNormalization:n=!1,disableCompression:o}=r,i=Array.isArray(e)?e.slice():[],s=n?i:Array.isArray(i)?fe(i):[],a=T();qe(a,Tt);let c=typeof o=="boolean"?o:!1;if(o===void 0){const f=Ch();f.size>0&&(c=s.some(l=>l&&typeof l=="object"&&typeof l.id=="string"&&f.has(l.id)))}return P&&P.setItem(Tt,s).catch(f=>console.warn("Failed to save auto gear presets to repo",f)),P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter"||ke(a,Tt,s,"Error saving automatic gear presets to localStorage:",c?{disableCompression:!0}:void 0),s}function Zf(){if(Ai)return Ai;_e();const e=T(),t=Te(e,Nt,"Error loading automatic gear monitor defaults from localStorage:",{},{validate:o=>o===null||typeof o=="object"}),r=t&&typeof t=="object"?t:{},n=E(r)?fe(r):{};return n!==r&&ec(n,{skipNormalization:!0}),n&&typeof n=="object"?n:{}}function ec(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=e&&typeof e=="object"?{...e}:{},i=n?o:E(o)?fe(o):{},s=T();return qe(s,Nt),Ai=i,P&&P.setItem(Nt,i).catch(c=>console.warn("Failed to save monitor defaults to repo",c)),P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter"||ke(s,Nt,i,"Error saving automatic gear monitor defaults to localStorage:"),i}function Xc(e,t){if(!e)return;const r=t||T();if(!r)return;let n;try{n=r.getItem(Tt)}catch(a){console.error("Error loading automatic gear presets while removing autosaved preset from localStorage:",a),we("read access",a,r),le();return}if(n===null||typeof n>"u")return;let o,i=n;typeof n=="string"&&n&&(i=en(n));try{o=JSON.parse(i)}catch(a){console.error("Error parsing automatic gear presets while removing autosaved preset from localStorage:",a);return}if(!Array.isArray(o))return;const s=o.filter(a=>!a||typeof a!="object"?!0:a.id!==e);s.length!==o.length&&Zi(s,{skipNormalization:!0})}function Bi(){if(so!==null)return typeof so=="string"?so:"";_e();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(ht);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear active preset from localStorage:",t),we("read access",t,e),le(),""}}function ep(e){if(so=e||"",P&&(e?P.setItem(ht,e).catch(n=>console.warn("Failed to save active preset id",n)):P.removeItem(ht).catch(n=>console.warn("Failed to remove active preset id",n))),P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter")return;const r=T();if(r)try{e?r.setItem(ht,e):r.removeItem(ht)}catch(n){console.error("Error saving automatic gear active preset to localStorage:",n),we("write access",n,r),le()}}function xi(){if(ao!==null)return typeof ao=="string"?ao:"";_e();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(ot);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear auto preset from localStorage:",t),we("read access",t,e),le(),""}}function tp(e){if(ao=e||"",P&&(e?P.setItem(ot,e).catch(o=>console.warn("Failed to save auto preset id",o)):P.removeItem(ot).catch(o=>console.warn("Failed to remove auto preset id",o))),P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter")return;const r=T();if(!r)return;let n="";try{const o=r.getItem(ot);typeof o=="string"&&o&&(n=o)}catch(o){console.error("Error inspecting automatic gear auto preset in localStorage:",o),we("read access",o,r)}try{e?(r.setItem(ot,e),n&&n!==e&&Xc(n,r)):(r.removeItem(ot),n&&Xc(n,r))}catch(o){console.error("Error saving automatic gear auto preset to localStorage:",o),we("write access",o,r),le()}}function rp(){if(_i!==null)return!!_i;_e();const e=T();return mf(e,nr,"Error loading automatic gear backup visibility from localStorage:")}function Qs(e){if(_i=!!e,P&&P.setItem(nr,!!e).catch(n=>console.warn("Failed to save visibility",n)),P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter")return;const r=T();hf(r,nr,!!e,"Error saving automatic gear backup visibility to localStorage:")}function np(){const t=Number(kg);if(!Number.isFinite(t))return un;const r=Math.round(t);return Number.isFinite(r)?r<nt?nt:r>un?un:r:un}function fn(e){const t=Number(e);if(!Number.isFinite(t))return So();const r=Math.round(t);if(!Number.isFinite(r))return So();if(r<nt)return nt;const n=np();return r>n?n:r}function So(){const e=np();if(h&&typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=="number"){const r=h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT;if(Number.isFinite(r)&&r>=nt){const n=Math.round(r);return Number.isFinite(n)?n<nt?nt:n>e?e:n:e}}const t=Math.round(Yu);return Number.isFinite(t)?t>e?e:t<nt?nt:t:nt}function co(e,t=So()){if(e==null)return t;if(typeof e=="number")return fn(e);if(typeof e=="string"){const r=e.trim();if(!r)return t;const n=Number(r);if(Number.isFinite(n))return fn(n);const o=Oe(r);return o&&o.success?co(o.parsed,t):t}if(Array.isArray(e)){for(let r=0;r<e.length;r+=1){const n=co(e[r],null);if(typeof n=="number"&&Number.isFinite(n))return fn(n)}return t}if(E(e)){const r=["value","retention","limit","count"];for(let n=0;n<r.length;n+=1){const o=r[n];if(!Object.prototype.hasOwnProperty.call(e,o))continue;const i=co(e[o],null);if(typeof i=="number"&&Number.isFinite(i))return fn(i)}return t}return t}function op(){if(Ci!==null)return Ci;_e();const e=T(),t=Te(e,Mt,"Error loading automatic gear backup retention from localStorage:",So(),{validate:r=>r===null||typeof r=="number"||typeof r=="string"||Array.isArray(r)||E(r)});return co(t)}function ip(e){if(e==null||typeof e=="function"||typeof e=="object"&&!Array.isArray(e)&&!E(e))return;const t=T(),r=co(e);Ci=r,P&&P.setItem(Mt,r).catch(o=>console.warn("Failed to save backup retention",o)),!(P&&P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter")&&(qe(t,Mt),ke(t,Mt,r,"Error saving automatic gear backup retention to localStorage:"))}async function _h(){try{typeof globalThis<"u"&&(globalThis.__cameraPowerPlannerFactoryResetting=!0),typeof global<"u"&&(global.__cameraPowerPlannerFactoryResetting=!0),typeof window<"u"&&(window.__cameraPowerPlannerFactoryResetting=!0),h&&(h.__cameraPowerPlannerFactoryResetting=!0,h.__cineMonolithicProjectCleanupDone=!1),typeof sessionStorage<"u"&&sessionStorage.setItem($e,"true"),typeof localStorage<"u"&&localStorage.setItem($e,"true")}catch{}if(Ie)try{Ie.postMessage("factory-reset")}catch{}const e="Error clearing storage:";try{xf()}catch(l){console.warn("Unable to clear stored projects during factory reset",l)}tr(),St&&typeof St.clear=="function"&&St.clear(),Array.isArray(br)&&(br.length=0);try{let l=null;if(h&&typeof h.clearBackupVault=="function"?l=h.clearBackupVault:typeof window<"u"&&typeof window.clearBackupVault=="function"?l=window.clearBackupVault:h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup.clearBackupVault=="function"&&(l=h.cineFeatureBackup.clearBackupVault),l&&await l(),typeof indexedDB<"u"){const y=["cinePowerPlannerBackupVault","cinePowerPlanner","cameraPowerPlanner"];if(typeof indexedDB.databases=="function")try{(await indexedDB.databases()).forEach(d=>{d.name&&!y.includes(d.name)&&y.push(d.name)})}catch(p){console.warn("Failed to list IndexedDB databases during factory reset",p)}await Promise.all(y.map(p=>new Promise(d=>{try{const g=indexedDB.deleteDatabase(p);g.addEventListener("success",()=>d()),g.addEventListener("error",()=>{console.warn(`Failed to delete IndexedDB database "${p}" during factory reset`,g.error),d()}),g.addEventListener("blocked",()=>{console.warn(`Deletion of IndexedDB database "${p}" blocked during factory reset`),d()})}catch(g){console.warn(`Error initiating deletion of IndexedDB database "${p}"`,g),d()}})))}}catch(l){console.warn("Failed to clear backup vault during factory reset",l)}const t=T(),r=(l,y)=>{if(l){if(typeof l.clear=="function")try{l.clear()}catch(p){console.warn(`Failed to clear ${y} using clear(), falling back to manual removal.`,p)}try{const p=[];try{const d=l.length;for(let g=0;g<d;g++){const m=l.key(g);m&&p.push(m)}}catch(d){console.warn(`Failed to iterate ${y} by index`,d)}try{const d=Object.keys(l);Array.isArray(d)&&d.forEach(g=>{g&&!p.includes(g)&&p.push(g)})}catch(d){}p.forEach(d=>{if(d!==$e)try{l.removeItem(d)}catch(g){console.warn(`Failed to remove key ${d} from ${y}`,g)}})}catch(p){console.warn(`Failed to iterate ${y} for strict cleanup`,p)}}};r(t,"safeLocalStorage"),typeof localStorage<"u"&&localStorage!==t&&r(localStorage,"localStorage"),typeof sessionStorage<"u"&&r(sessionStorage,"sessionStorage");const n=["settingsActiveTab",typeof h<"u"&&h&&typeof h.INSTALL_BANNER_DISMISSED_KEY=="string"?h.INSTALL_BANNER_DISMISSED_KEY:"cine_install_banner_dismissed"],o=(l,y)=>{if(!l||typeof l.length!="number"||typeof l.key!="function")return;const p=[],d=l.length;for(let g=0;g<d;g++){const m=l.key(g);m&&(m.startsWith("cameraPowerPlanner_")||m.startsWith("cine_")||m.startsWith("cinePowerPlanner_")||m.startsWith("cinePowerPlanner")||m.startsWith("cineRental")||m.startsWith("__cine")||m.startsWith("cine_")||n.includes(m))&&m!==$e&&p.push(m)}p.forEach(g=>{try{l.removeItem(g)}catch(m){console.warn(`Failed to remove key ${g} from ${y}`,m)}})};if(o(t,"safeLocalStorage"),typeof localStorage<"u"&&localStorage!==t&&o(localStorage,"localStorage"),typeof sessionStorage<"u"&&o(sessionStorage,"sessionStorage"),typeof or=="function")try{or()}catch{}if(["cineBackupVaultFallbackRecords",Ve,Xe,Wt,pe,qi,"cameraPowerPlanner_projects","cameraPowerPlanner_project_shards",st,at,vr,Rt,Zr,Tt,ht,ot,nr,Mt,Nt,Pr(),ct,wt,ja,ar,mt,Vt,Je,xt,Ds,bt,"cameraPowerPlanner_lastProject","cameraPowerPlanner_onboardingComplete","cameraPowerPlanner_tourShown","cameraPowerPlanner_v1_migration","cameraPowerPlanner_v2_migration","cameraPowerPlanner_sharded","cameraPowerPlanner_forceLegacyBundle","cameraPowerPlanner_forceLegacyBundleRetry",typeof h<"u"&&h.TEMPERATURE_UNIT_STORAGE_KEY,typeof h<"u"&&h.FOCUS_SCALE_STORAGE_KEY,typeof h<"u"&&h.INSTALL_BANNER_DISMISSED_KEY,"cine_install_banner_dismissed","cameraPowerPlanner_project__backup","cameraPowerPlanner_project__legacyMigrationBackup","cameraPowerPlanner_setups__backup","cameraPowerPlanner_setups__legacyMigrationBackup"].forEach(l=>{l&&(ce(t,l,e),typeof t.removeItem=="function"&&(t.removeItem(`${l}${de}`),t.removeItem(`${l}${Nr}`)))}),typeof sessionStorage<"u"){ce(sessionStorage,bt,e),ce(sessionStorage,"__cineLoggingHistory",e),ce(sessionStorage,"__cineLoggingConfig",e);try{const l=sessionStorage.getItem($e);sessionStorage.clear(),l&&sessionStorage.setItem($e,l)}catch{}}if(typeof caches<"u"&&typeof caches.keys=="function")try{const l=await caches.keys();await Promise.all(l.map(function(y){return caches.delete(y)})),typeof console<"u"&&typeof console.log=="function"&&console.log("Storage reset: Service Worker caches cleared.")}catch(l){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Storage reset: Failed to clear Service Worker caches.",l)}["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",er,Be].forEach(l=>{ce(t,l,e,{disableBackup:!0}),typeof t.removeItem=="function"&&t.removeItem(`${l}${de}`)});const a=["cameraPowerPlanner_onboardingTutorial","cinePowerPlanner_onboardingTutorial","cameraPowerPlanner_onboardingComplete","cameraPowerPlanner_tourShown"],c=l=>{if(l)for(let y=0;y<a.length;y+=1){const p=a[y];ce(l,p,e),typeof l.removeItem=="function"&&l.removeItem(`${p}${de}`)}},u=ho([t,T(),jn("localStorage"),typeof localStorage<"u"?localStorage:null]);for(let l=0;l<u.length;l+=1)c(u[l]);const f=ho([typeof sessionStorage<"u"?sessionStorage:null,jn("sessionStorage")]);for(let l=0;l<f.length;l+=1)c(f[l]);try{const l=h&&h.cineLogging?h.cineLogging:null;l&&typeof l.clearHistory=="function"&&l.clearHistory({persist:!1})}catch(l){console.warn("Unable to clear logging history during factory reset",l)}try{h&&typeof h.name=="string"&&(h.name=""),typeof window<"u"&&typeof window.name=="string"&&(window.name="")}catch(l){console.warn("Unable to reset window.name during factory reset",l)}try{if(typeof navigator<"u"&&navigator.serviceWorker){const l=await navigator.serviceWorker.getRegistrations();for(const y of l)await y.unregister()}}catch(l){console.warn("Failed to unregister service workers",l)}typeof console<"u"&&typeof console.log=="function"&&console.log("Factory reset cleanup complete. Waiting for reload.")}function he(e){if(e===$r&&ki)return ki;if(e===ct&&Pi)return Pi;if(e===er&&Ii)return Ii;if(e===Be&&vi)return vi;if(e===at&&ji)return ji;if(e===ar&&Li)return Li;if(e===mt&&Ri)return Ri;if(e===st&&Ti)return Ti;if(e===rr&&Ni)return Ni;if(e===Ir&&Mi)return Mi;if(e===Tr()&&zi)return zi;const t=T();if(!t||typeof t.getItem!="function")return null;const r=Ot(e);for(let n=0;n<r.length;n+=1){const o=r[n];try{const i=t.getItem(o);if(i==null){if(kt.has(o))try{const s=t.getItem(`${o}${de}`);if(s!=null){const a=jr(s);return typeof a=="string"?a:String(s)}}catch(s){console.warn("Unable to read backup key for export",o,s),we("read access",s,t)}}else{const s=jr(i);return typeof s=="string"?s:String(i)}}catch(i){console.warn("Unable to read storage key for backup",o,i),we("read access",i,t)}}return null}function Br(e){if(e==null)return null;if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isNaN(e)?null:e!==0;const t=String(e).trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}function tc(e){if(e==null)return null;let t=null,r=e;if(typeof e=="string"){const c=e.trim();if(!c)return null;t=c;try{r=JSON.parse(c)}catch{return{normalized:null,serialized:t}}}if(!r||typeof r!="object")return t?{normalized:null,serialized:t}:null;const n=typeof r.sections=="object"&&r.sections!==null,o=n?r.sections:r,i={};if(o&&typeof o=="object"){const c=Object.keys(o);for(let u=0;u<c.length;u+=1){const f=c[u],l=o[f];typeof l=="boolean"&&(i[f]=l)}}let s=null;if(typeof r.layout=="string"){const c=r.layout.trim();c&&(s=c)}s||(s=n?"standard":"rental");const a={sections:i,layout:s};if(n){const c=Object.keys(r);for(let u=0;u<c.length;u+=1){const f=c[u];f==="sections"||f==="layout"||(a[f]=kr(r[f]))}}return{normalized:a,serialized:t}}function kh(){const e={},t=Br(he("darkMode"));t!==null&&(e.darkMode=t);const r=Br(he("pinkMode"));r!==null&&(e.pinkMode=r);const n=Br(he("highContrast"));n!==null&&(e.highContrast=n);const o=Br(he("reduceMotion"));o!==null&&(e.reduceMotion=o);const i=Br(he("relaxedSpacing"));i!==null&&(e.relaxedSpacing=i);const s=Br(he("showAutoBackups"));s!==null&&(e.showAutoBackups=s);const a=he("accentColor");a&&(e.accentColor=a);const c=he("fontSize");c&&(e.fontSize=c);const u=he("fontFamily");u&&(e.fontFamily=u);const f=he("language");f&&(e.language=f);const l=Tr(),y=he(l);if(y)if(y==="[object Object]")typeof DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}};else try{e.mountVoltages=JSON.parse(y)}catch(A){console.warn("Failed to parse stored mount voltages for backup",A),e.mountVoltages=y}const p=Br(he("iosPwaHelpShown"));p!==null&&(e.iosPwaHelpShown=p);const d=he(rr);d&&(e.temperatureUnit=d);const g=he(Ir);g&&(e.focusScale=g);const m=he(er);if(m){let A=null;if(typeof m=="string"){const O=m.trim();if(O)try{A=JSON.parse(O)}catch(C){console.warn("Failed to parse stored camera color preferences for backup",C),A=null}}A&&typeof A=="object"?e.cameraColors=kr(A):typeof m=="string"&&m.trim()&&(e.cameraColors=m)}const b=he(Be);if(b!=null){const A=tc(b);A&&(A.normalized?e[Be]=kr(A.normalized):A.serialized&&(e[Be]=A.serialized))}return e}function sp(e){return Array.isArray(e)?e.map(t=>({id:t&&typeof t.id=="string"?t.id:null,name:t&&typeof t.name=="string"?t.name:"",data:t&&typeof t.data=="string"?t.data:""})).filter(t=>t.id&&t.name&&t.data):[]}function Ph(){const e=he(Pr());if(!e)return[];try{const t=JSON.parse(e);return sp(t)}catch(t){return console.warn("Failed to parse stored custom fonts for backup",t),[]}}let Qn=[];function Ih(e){if(!e||typeof e!="object")return null;const t={};return typeof e.source=="string"&&e.source&&(t.source=e.source),typeof e.reason=="string"&&e.reason&&(t.reason=e.reason),typeof e.permissionState=="string"&&e.permissionState&&(t.permissionState=e.permissionState),Object.keys(t).length?t:null}function ap(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"";if(!t)return null;const r=typeof e.fileName=="string"&&e.fileName?e.fileName:"cine-power-planner-backup.json",n=typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)?e.createdAtMs:null,o=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:n!==null?new Date(n).toISOString():null;let i=n;if(i===null&&o){const a=Date.parse(o);Number.isFinite(a)&&(i=a)}i===null&&(i=Date.now());const s=Ih(e.metadata);return{id:t,fileName:r,payload:e.payload,createdAt:o||new Date(i).toISOString(),createdAtMs:i,metadata:s||{}}}function wo(e){if(!e)return[];let t=e;if(typeof e=="string"){const o=Oe(e);o&&o.success&&(t=o.parsed)}const r=Array.isArray(t)?t:[],n=[];return r.forEach(o=>{const i=ap(o);i&&n.push(i)}),n}function Zc(e){if(!e)return 0;let t=0;return e.payload!==null&&e.payload!==void 0&&(t+=3),typeof e.fileName=="string"&&e.fileName&&(t+=1),typeof e.createdAt=="string"&&e.createdAt&&(t+=1),typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)&&(t+=1),e.metadata&&typeof e.metadata=="object"&&(t+=1),t}function cp(e,t){const r=new Map,n=o=>{Array.isArray(o)&&o.forEach(i=>{const s=ap(i);if(!s)return;const a=r.get(s.id);(!a||Zc(s)>=Zc(a))&&r.set(s.id,s)})};return n(e),n(t),Array.from(r.values())}function lp(){const e=he("cineBackupVaultFallbackRecords");return wo(e)}function up(){return h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup=="object"?h.cineFeatureBackup:h&&typeof h.getQueuedBackupPayloads=="function"?h:null}function fp(){const e=up();if(!e)return;const t=typeof e.listBackupVaultRecords=="function"?e.listBackupVaultRecords:typeof e.getQueuedBackupPayloads=="function"?e.getQueuedBackupPayloads:null;if(!t)return;let r=null;try{r=t()}catch(n){console.warn("Unable to load backup vault records for export",n);return}if(Array.isArray(r)){Qn=wo(r);return}return r&&typeof r.then=="function"?r.then(n=>(Qn=wo(n),Qn)).catch(n=>(console.warn("Unable to load backup vault records for export",n),[])):Promise.resolve(Qn)}async function vh(){return await fp()}function jh(){fp();const e={devices:wf(),setups:_o(),session:bf(),feedback:Hf(),project:Tf(),favorites:Gf(),contacts:Uf(),ownGear:Kf(),userProfile:null,autoGearRules:Jf(),autoGearBackups:Xa(),autoGearSeeded:Qf(),autoGearPresets:Xf(),autoGearMonitorDefaults:Zf(),autoGearActivePresetId:Bi(),autoGearAutoPresetId:xi(),autoGearShowBackups:rp(),autoGearBackupRetention:op(),fullBackupHistory:bo()},t=Yf();t&&Array.isArray(t.releases)&&t.releases.length&&(e.documentationTracker=t);const r=kh();Object.keys(r).length&&(e.preferences=r);const n=Vf();n&&typeof n=="object"&&(typeof n.name=="string"&&n.name||typeof n.role=="string"&&n.role||typeof n.avatar=="string"&&n.avatar||typeof n.phone=="string"&&n.phone||typeof n.email=="string"&&n.email)?e.userProfile=n:delete e.userProfile;const o=he(ct);o&&(e.customLogo=o);const i=Ph();i.length&&(e.customFonts=i);const s=he(wt);s!=null&&(e.schemaCache=s);const a=lp(),c=cp(Qn,a);return c.length&&(e.backupVaultRecords=c.map(u=>kr(u))),e}function ye(e,t){const r=T();if(!r)return;const n=kt.has(e),o=`${e}${de}`;try{if(t==null){if(r.removeItem(e),n)try{r.removeItem(o)}catch(i){console.warn("Unable to remove backup key during import",o,i),we("deletion",i,r)}}else{const i=String(t);if(e===$r&&(ki=i),e===ct&&(Pi=i),e===er&&(Ii=i),e===Be&&(vi=i),e===at&&(ji=i),e===ar&&(Li=i),e===mt&&(Ri=i),e===st&&(Ti=i),e===rr&&(Ni=i),e===Ir&&(Mi=i),e===Tr()&&(zi=i),P&&(P.setItem(e,i).catch(a=>console.warn("Failed to save key to repo",e,a)),P.driver&&P.driver.constructor&&P.driver.constructor.name==="IndexedDBAdapter"))return;if(r.setItem(e,i),n)try{r.setItem(o,i)}catch(s){console.warn("Unable to update backup key during import",o,s),we("write access",s,r),le()}}}catch(i){console.warn("Unable to persist storage key during import",e,i),we("write access",i,r),n&&le()}}function Sn(e){if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}if(typeof e=="number")return Number.isNaN(e)?null:e!==0;if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Sn(e[t]);if(r!==null)return r}return null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"value"))return Sn(e.value);if(Object.prototype.hasOwnProperty.call(e,"enabled"))return Sn(e.enabled)}return null}function Jt(e,t=[],r=null){if(re(e)){const n=ne(e);return n?Jt(n,t,r):[]}if(Array.isArray(e))return r?e.filter(n=>r(n)):e.filter(n=>n!=null);if(typeof e=="string"){const n=Oe(e);return n.success?Jt(n.parsed,t,r):[]}if(E(e)){for(let o=0;o<t.length;o+=1){const i=t[o];if(!Object.prototype.hasOwnProperty.call(e,i))continue;const s=Jt(e[i],t,r);if(s.length)return s}const n=Object.values(e);if(n.length)return r?n.filter(o=>r(o)):n.filter(o=>o!=null)}return[]}function Lh(e){const t=Jt(e,["contacts","entries","items","list","values","data"],r=>r&&typeof r=="object");return Array.isArray(t)?Ya(t):[]}function Rh(e){const t=Jt(e,["rules","items","entries","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?fe(t):[]}function Th(e){const t=Jt(e,["backups","entries","items","list","values","data"],n=>n!==null&&typeof n=="object");if(!Array.isArray(t))return[];const{normalized:r}=Ba(t);return r}function Zo(e){if(e==null)return null;if(typeof e=="number")return fn(e);if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return fn(r);const n=Oe(t);return n&&n.success?Zo(n.parsed):null}if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Zo(e[t]);if(typeof r=="number")return r}return null}if(E(e)){const t=["value","retention","limit","count"];for(let r=0;r<t.length;r+=1){const n=t[r];if(!Object.prototype.hasOwnProperty.call(e,n))continue;const o=Zo(e[n]);if(typeof o=="number")return o}return null}return typeof e=="boolean"&&e?nt:null}function Nh(e){const t=Jt(e,["presets","entries","items","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?fe(t):[]}function Mh(e){if(!e||typeof e!="object")return{};const t={};Object.entries(e).forEach(([n,o])=>{if(typeof o!="string")return;const i=o.trim();i&&(t[n]=i)});const r=fe(t);return E(r)?r:t}function Xs(e){if(typeof e=="string")return e;if(typeof e=="number")return Number.isNaN(e)?"":String(e);if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Xs(e[t]);if(r)return r}return""}if(E(e)){if(typeof e.id=="string"&&e.id)return e.id;if(typeof e.value=="string")return e.value;if(Object.prototype.hasOwnProperty.call(e,"name"))return Xs(e.name)}return""}function el(e){const t=Jt(e,["backupVaultRecords","backupVault","vault","records","entries","items","list","values","data"],r=>r&&typeof r=="object");return wo(t)}function tl(e){const t=wo(e);if(!t.length)return;const r=lp(),n=cp(r,t);try{ye("cineBackupVaultFallbackRecords",JSON.stringify(n))}catch(a){console.warn("Unable to persist imported backup vault fallback records",a)}const o=up();if(!o||typeof o.queueBackupPayloadForVault!="function")return;const i=a=>{o.queueBackupPayloadForVault(a.fileName,a.payload,{id:a.id,createdAt:a.createdAt,createdAtMs:a.createdAtMs,source:a.metadata&&a.metadata.source?a.metadata.source:void 0,reason:a.metadata&&a.metadata.reason?a.metadata.reason:void 0,permissionState:a.metadata&&a.metadata.permissionState?a.metadata.permissionState:void 0})},s=typeof o.listBackupVaultRecords=="function"?o.listBackupVaultRecords:typeof o.getQueuedBackupPayloads=="function"?o.getQueuedBackupPayloads:null;if(!s){t.forEach(i);return}try{const a=s();if(Array.isArray(a)){const c=new Set(a.map(u=>u&&u.id?u.id:null));t.forEach(u=>{c.has(u.id)||i(u)});return}if(a&&typeof a.then=="function"){a.then(c=>{const u=new Set(Array.isArray(c)?c.map(f=>f&&f.id?f.id:null):[]);t.forEach(f=>{u.has(f.id)||i(f)})}).catch(c=>{console.warn("Unable to inspect backup vault before import",c),t.forEach(i)});return}t.forEach(i)}catch(a){console.warn("Unable to import backup vault records via backup module",a),t.forEach(i)}}function zh(e){return Ot(e)}function We(e,t){if(!E(e))return null;const r=zh(t);for(let n=0;n<r.length;n+=1){const o=r[n];if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"primary"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${de}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"backup"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${Nr}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"migration-backup"}}return null}function wn(e){if(!e)return;let t=e.value;if(e.type==="migration-backup")try{const r=typeof t=="string"?JSON.parse(t):t;if(r&&typeof r=="object"){const n=typeof r.compression=="string"?r.compression.trim():"",o=typeof r.encoding=="string"?r.encoding.trim():"",i=n===ef&&o===tf,s=mo.test(n)||mo.test(o);if((i||s)&&typeof r.data=="string")if(Na()){let a=typeof r.compressionVariant=="string"&&r.compressionVariant?r.compressionVariant:null;a||(s?a=$c(o)||$c(n)||"utf16":a="utf16");const c=nf(r.data,Yi,a,"migration backup entry");if(c.success&&typeof c.value=="string")try{const u=JSON.parse(c.value);u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"data")?t=u.data:t=null}catch(u){console.warn("Unable to parse migration backup entry during import",e.key,u),t=null}else console.warn("Unable to decompress migration backup entry during import",e&&e.key,c.error),t=null}else console.warn("Compression support is unavailable while reading migration backup entry",e&&e.key),t=null;else Object.prototype.hasOwnProperty.call(r,"data")?t=r.data:t=null}else t=null}catch(r){console.warn("Unable to parse migration backup entry during import",e.key,r),t=null}return t}function Bo(e){const t=wn(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=jr(t);if(r===null)return null;if(r===void 0)return;if(typeof r!="string")return r;const n=r.trim();if(!n)return"";try{return JSON.parse(n)}catch{return r}}return t}}function fr(e){const t=wn(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=jr(t);if(r===null)return null;if(r===void 0)return;if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return String(r);if(Array.isArray(r)||r&&typeof r=="object")try{return JSON.stringify(r)}catch(n){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,n),null}return null}if(typeof t=="number"||typeof t=="boolean")return String(t);if(Array.isArray(t)||t&&typeof t=="object")try{return JSON.stringify(t)}catch(r){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,r),null}return null}}function Bh(e){if(!E(e)||["devices","setups","session","feedback","favorites","contacts","preferences","project","projects","autoGearRules","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","autoGearSeeded","autoGearActivePresetId","autoGearAutoPresetId","autoGearBackupRetention","autoGearShowBackups","fullBackupHistory","fullBackups","backupVaultRecords"].some(S=>Object.prototype.hasOwnProperty.call(e,S)))return null;const n={};let o=!1,i=!1;const s=["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",er,Be],a=Tr(),c=new Set([ct,...s,a].filter(S=>typeof S=="string"&&S)),u=new Set(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"]),f=S=>{if(!S||typeof S.key!="string")return;if(S.key.startsWith("cameraPowerPlanner_")||S.key.startsWith("cinePowerPlanner_")||S.key.endsWith(de)||S.key.endsWith(Nr)){i=!0;return}const w=S.key.replace(/(?:__backup|__legacyMigrationBackup)$/u,"");c.has(w)&&(i=!0)},l=(S,w)=>{const j=We(e,S);if(!j)return;f(j);const x=Bo(j);x!==void 0&&(n[w]=x,o=!0)};l(Ve,"devices"),l(Xe,"setups"),l(bt,"session"),l(Wt,"feedback"),l(pe,"project"),l(st,"favorites"),l(at,"contacts"),l(ar,"ownGear"),l(mt,"userProfile"),l(Vt,"documentationTracker"),l(vr,"autoGearRules"),l(Rt,"autoGearBackups"),l(Tt,"autoGearPresets"),l(Nt,"autoGearMonitorDefaults"),l(Mt,"autoGearBackupRetention");const y=We(e,wt);if(y){f(y);const S=fr(y);S!==void 0&&(n.schemaCache=S,o=!0)}const p=We(e,Pr());if(p){f(p);const S=Bo(p);S!==void 0&&(n.customFonts=S,o=!0)}const d=We(e,ct);if(d){f(d);const S=fr(d);S!==void 0&&(n.customLogo=S,o=!0)}const g=We(e,Zr);g&&(f(g),n.autoGearSeeded=wn(g),o=!0);const m=We(e,ht);m&&(f(m),n.autoGearActivePresetId=fr(m),o=!0);const b=We(e,ot);b&&(f(b),n.autoGearAutoPresetId=fr(b),o=!0);const A=We(e,nr);A&&(f(A),n.autoGearShowBackups=wn(A),o=!0);const O={};s.forEach(S=>{const w=We(e,S);if(!w)return;if(f(w),S===Be){const N=fr(w);if(N!==void 0){const z=tc(N);if(z){if(z.normalized){O[S]=kr(z.normalized),o=!0;return}if(z.serialized){O[S]=z.serialized,o=!0;return}}}return}const j=wn(w);if(u.has(S)){const N=Sn(j);if(N!==null){O[S]=N,o=!0;return}}const x=fr(w);x!==void 0&&(O[S]=x,o=!0)});const C=We(e,rr);if(C){f(C);const S=fr(C);if(typeof S=="string"){const w=S.trim();w&&(O.temperatureUnit=w,o=!0)}}const k=We(e,Ir);if(k){f(k);const S=fr(k);if(typeof S=="string"){const w=S.trim();w&&(O.focusScale=w,o=!0)}}const _=We(e,er);if(_){f(_);const S=Bo(_);S!==void 0&&(O.cameraColors=S,o=!0)}const v=We(e,a);if(v){f(v);const S=Bo(v);S!==void 0&&(O.mountVoltages=S,o=!0)}return Object.keys(O).length>0&&(n.preferences=O),!o||!i?null:n}function pp(e,t={}){if(Array.isArray(e)){oo(e,()=>Yc());return}if(!E(e))return;const{skipSnapshotConversion:r=!1}=t||{};if(!r){const l=Bh(e);if(l){pp(l,{skipSnapshotConversion:!0});return}}const n=l=>Object.prototype.hasOwnProperty.call(e,l),o=Tr(),i=er;if(n("devices")&&Ef(e.devices),n("setups")&&Ka(e.setups),n("session")&&Ua(e.session,{disableCompression:!0}),n("feedback")&&qf(e.feedback),n("favorites")&&Ff(e.favorites),n("contacts"))if(e.contacts===null)Ys(null);else{const l=Lh(e.contacts);Ys(l)}if(n("ownGear")){const l=Jt(e.ownGear,["items","entries","list","values","data"],y=>y&&typeof y=="object");$f(l)}if(n("userProfile")){if(e.userProfile===null)Qo(null);else if(E(e.userProfile)){const l=Ja(e.userProfile);Qo(l||null)}}if(E(e.preferences)){const l=e.preferences;if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"].forEach(d=>{Object.prototype.hasOwnProperty.call(l,d)&&typeof l[d]=="boolean"&&ye(d,l[d])}),["accentColor","fontSize","fontFamily","language"].forEach(d=>{if(Object.prototype.hasOwnProperty.call(l,d)){const g=l[d];typeof g=="string"&&g&&ye(d,g)}}),Object.prototype.hasOwnProperty.call(l,"temperatureUnit")){const d=l.temperatureUnit;if(typeof d=="string"){const g=d.trim();g&&ye(rr,g)}else d===null&&ye(rr,null)}if(Object.prototype.hasOwnProperty.call(l,"focusScale")){const d=l.focusScale;if(typeof d=="string"){const g=d.trim();if(g&&(ye(Ir,g),typeof window<"u"&&typeof window.applyFocusScalePreference=="function"))try{window.applyFocusScalePreference(g,{persist:!1,forceUpdate:!0})}catch(m){console.warn("Unable to apply imported focus scale preference",m)}}else d===null&&ye(Ir,null)}if(Object.prototype.hasOwnProperty.call(l,Be)){const d=l[Be];if(d===null)ye(Be,null);else{const g=tc(d);if(g){if(g.normalized){const m=kr(g.normalized);let b=null;try{b=JSON.stringify(m)}catch(A){console.warn("Unable to serialize imported print preferences",A),b=null}if(b!==null)try{ye(Be,b)}catch(A){console.warn("Unable to persist imported print preferences",A)}if(typeof window<"u"&&typeof window.savePrintPreferences=="function")try{window.savePrintPreferences(m)}catch(A){console.warn("Unable to apply imported print preferences",A)}}else if(g.serialized)try{ye(Be,g.serialized)}catch(m){console.warn("Unable to store imported print preferences string value",m)}}}}if(Object.prototype.hasOwnProperty.call(l,"mountVoltages")){const d=l.mountVoltages;if(d&&typeof d=="object"){try{ye(o,JSON.stringify(d))}catch(g){console.warn("Unable to store imported mount voltages",g)}typeof window<"u"&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(d,{persist:!1,triggerUpdate:!0})}else if(typeof d=="string"){if(ye(o,d),typeof window<"u"&&typeof window.parseStoredMountVoltages=="function")try{const g=window.parseStoredMountVoltages(d);g&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(g,{persist:!1,triggerUpdate:!0})}catch(g){console.warn("Unable to parse imported mount voltages",g)}}else d===null&&(ye(o,null),typeof window<"u"&&typeof window.resetMountVoltagePreferences=="function"&&window.resetMountVoltagePreferences({persist:!1,triggerUpdate:!0}))}if(Object.prototype.hasOwnProperty.call(l,"cameraColors")){const d=l.cameraColors,g=m=>{if(!m||typeof m!="object")return!1;let b=!1;if(typeof window<"u"&&window&&typeof window.setCameraLetterColors=="function")try{window.setCameraLetterColors(m),b=!0}catch(O){console.warn("Unable to apply imported camera color preferences",O),b=!1}let A=null;try{A=JSON.stringify(m)}catch(O){console.warn("Unable to serialize imported camera color preferences",O),A=null}if(A)try{ye(i,A)}catch(O){console.warn("Unable to persist imported camera color preferences",O)}return b};if(d&&typeof d=="object")g(d);else if(typeof d=="string"){const m=d.trim();if(m){let b=null;try{b=JSON.parse(m)}catch(A){console.warn("Unable to parse imported camera color palette",A),b=null}if(b&&typeof b=="object")g(b);else try{ye(i,m)}catch(A){console.warn("Unable to store raw imported camera color palette",A)}}}else d===null&&ye(i,null)}}if(Object.prototype.hasOwnProperty.call(e,"customLogo")){const l=e.customLogo;typeof l=="string"&&l?ye(ct,l):ye(ct,null)}if(Object.prototype.hasOwnProperty.call(e,"customFonts")){const l=sp(e.customFonts);if(l.length)try{ye(Pr(),JSON.stringify(l))}catch(y){console.warn("Unable to store imported custom fonts",y)}else ye(Pr(),null)}if(Object.prototype.hasOwnProperty.call(e,"schemaCache")){const l=e.schemaCache;if(typeof l=="string"||l===null)ye(wt,l);else if(l&&typeof l=="object")try{ye(wt,JSON.stringify(l))}catch(y){console.warn("Unable to store imported schema cache",y)}}if(Object.prototype.hasOwnProperty.call(e,"documentationTracker")){const l=io(e.documentationTracker);Xo(l)}else if(Object.prototype.hasOwnProperty.call(e,"documentationLogs")){const l=io({releases:e.documentationLogs});Xo(l)}else if(Object.prototype.hasOwnProperty.call(e,"documentationUpdateLog")){const l=io(e.documentationUpdateLog);Xo(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearRules")){const l=Rh(e.autoGearRules);Qa(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackups")){const l=Th(e.autoGearBackups);Za(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearSeeded")){const l=Sn(e.autoGearSeeded);Js(l===null?!1:l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearPresets")){const l=Nh(e.autoGearPresets);Zi(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearMonitorDefaults")){const l=Mh(e.autoGearMonitorDefaults);ec(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearActivePresetId")){const l=Xs(e.autoGearActivePresetId);ep(typeof l=="string"?l:"")}if(Object.prototype.hasOwnProperty.call(e,"autoGearAutoPresetId")&&tp(typeof e.autoGearAutoPresetId=="string"?e.autoGearAutoPresetId:""),Object.prototype.hasOwnProperty.call(e,"autoGearShowBackups")){const l=Sn(e.autoGearShowBackups);Qs(l===null?!1:l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackupRetention")){const l=Zo(e.autoGearBackupRetention);typeof l=="number"&&Number.isFinite(l)&&ip(l)}if(Object.prototype.hasOwnProperty.call(e,"fullBackupHistory")){const l=Kt(e.fullBackupHistory);Ei(l)}else if(Object.prototype.hasOwnProperty.call(e,"fullBackups")){const l=Kt(e.fullBackups);Ei(l)}if(Object.prototype.hasOwnProperty.call(e,"backupVaultRecords")){const l=el(e.backupVaultRecords);tl(l)}else if(Object.prototype.hasOwnProperty.call(e,"backupVault")){const l=el(e.backupVault);tl(l)}let s=null;const a=()=>(s||(s=Yc()),s);let c=!1;const u=()=>{const l=a();return(y,p,d)=>{c=!0,l(y,p,d)}},f=(l,y)=>{const d=oo(l,()=>u(),y);return d&&(c=!0),d};e.project&&f(e.project,""),e.projects?f(e.projects):!e.project&&typeof e.gearList=="string"&&(u()("",{gearList:e.gearList}),c=!0),c||mh(e).forEach((y,p)=>{if(y&&typeof y=="object"&&!Array.isArray(y)){const g=Si(y)?y:Ke(y);if(g&&Si(g)){u()("",g,`Imported project ${p+1}`),c=!0;return}}oo(y,()=>u(),`Imported project ${p+1}`)&&(c=!0)})}var ir={getSafeLocalStorage:T,loadDeviceData:wf,saveDeviceData:Ef,loadSetups:_o,saveSetups:Ka,saveSetup:Um,loadSetup:Km,deleteSetup:$m,renameSetup:Vm,safeSetLocalStorage:ye,readLocalStorageValue:he,getMountVoltageStorageKeyName:Tr,getMountVoltageStorageBackupKeyName:Hu,getProjectStorageRevisionKeyName:Eg,loadProjectStorageRevision:Uu,loadProject:Tf,loadProjectMetadata:uh,saveProject:Wa,deleteProject:xf,renameProject:gh,createProjectDeletionBackup:ph,loadSessionState:bf,saveSessionState:Ua,loadFavorites:Gf,saveFavorites:Ff,loadContacts:Uf,saveContacts:Ys,loadOwnGear:Kf,saveOwnGear:$f,loadUserProfile:Vf,saveUserProfile:Qo,loadDocumentationTracker:Yf,saveDocumentationTracker:Xo,loadAutoGearBackups:Xa,saveAutoGearBackups:Za,loadFeedback:Hf,saveFeedback:qf,clearAllData:_h,exportAllData:jh,prepareBackupForExport:vh,importAllData:pp,loadAutoGearRules:Jf,saveAutoGearRules:Qa,loadAutoGearSeedFlag:Qf,saveAutoGearSeedFlag:Js,loadAutoGearPresets:Xf,saveAutoGearPresets:Zi,loadAutoGearMonitorDefaults:Zf,saveAutoGearMonitorDefaults:ec,loadAutoGearActivePresetId:Bi,saveAutoGearActivePresetId:ep,loadAutoGearAutoPresetId:xi,saveAutoGearAutoPresetId:tp,loadAutoGearBackupVisibility:rp,saveAutoGearBackupVisibility:Qs,loadAutoGearBackupRetention:op,saveAutoGearBackupRetention:ip,getAutoGearBackupRetentionDefault:So,loadFullBackupHistory:bo,saveFullBackupHistory:Ei,recordFullBackupHistoryEntry:Wf,requestPersistentStorage:ff,clearUiCacheStorageEntries:or,ensureCriticalStorageBackups:Dg,getLastCriticalStorageGuardResult:Ug,decodeStoredValue:jr,getCompressionLogSnapshot:ug,setActiveProjectCompressionHold:ah,clearActiveProjectCompressionHold:ch,invalidateProjectReadCache:tr,storageRepo:P},rl={flag:Ta,read:Tu,write:Vo,clear:ig};try{Object.defineProperty(ir,"__testAutoBackupCompressionCache",{configurable:!1,enumerable:!1,writable:!1,value:rl})}catch{ir.__testAutoBackupCompressionCache=rl}typeof module<"u"&&module.exports&&(module.exports=ir);console.log("DEBUG: storage.js: starting global export loop");if(h&&typeof h=="object"){Object.keys(ir).forEach(e=>{const t=ir[e];if(typeof t=="function"&&typeof h[e]!="function")try{h[e]=t}catch{try{Object.defineProperty(h,e,{configurable:!0,writable:!0,value:t})}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Unable to expose storage helper ${e} globally.`,n)}}});try{typeof h.recordFullBackupHistoryEntry!="function"&&(h.recordFullBackupHistoryEntry=Wf),typeof h.loadFullBackupHistory!="function"&&(h.loadFullBackupHistory=bo)}catch{}}if(h)try{Object.defineProperty(h,"__cineStorageApi",{configurable:!0,writable:!0,value:ir})}catch{h.__cineStorageApi=ir}console.log("DEBUG: storage.js execution finished");const xh=ir,bs=Object.freeze(Object.defineProperty({__proto__:null,cineStorage:xh,default:ir},Symbol.toStringTag,{value:"Module"}));var nl={};const es=Eo();function Gh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const o=n&&n.cineModuleLinker;if(o&&typeof o=="object")return o}catch{}}return null}function Fh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function Dh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}const ie=Gh(es),X=ie&&typeof ie.getModuleEnvironment=="function"?ie.getModuleEnvironment():Fh(es),Z=ie&&typeof ie.getEnvironmentBridge=="function"?ie.getEnvironmentBridge():Dh(es),H=(ie&&typeof ie.getGlobalScope=="function"?ie.getGlobalScope():null)||(Z&&typeof Z.getGlobalScope=="function"?Z.getGlobalScope():null)||(X&&typeof X.getGlobalScope=="function"?X.getGlobalScope():null)||es;function Uh(){const e=[H];typeof globalThis<"u"&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&e.indexOf(global)===-1&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&typeof r.cineModuleGlobals=="object")return r.cineModuleGlobals}return null}const ee=(ie&&typeof ie.getModuleGlobals=="function"?ie.getModuleGlobals():null)||Uh();function Kh(e,t){if(ie&&typeof ie.recordModule=="function"&&ie.recordModule(e,t),!(!ee||typeof ee.recordModule!="function"))try{ee.recordModule(e,t)}catch{}}function ol(e){return null}(function(){return ie&&typeof ie.tryRequire=="function"?ie.tryRequire:ee&&typeof ee.tryRequire=="function"?ee.tryRequire:Z&&typeof Z.tryRequire=="function"?function(r){const n=Z.tryRequire(r);return typeof n>"u"?ol():n}:X&&typeof X.tryRequire=="function"?X.tryRequire:ol})();function $h(e){const t=e||H;if(ie&&typeof ie.getModuleRegistry=="function"){const n=ie.getModuleRegistry(t);if(n)return n}if(ee&&typeof ee.resolveModuleRegistry=="function")try{const n=ee.resolveModuleRegistry(t);if(n)return n}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const n=Z.getModuleRegistry(t);if(n)return n}catch{}if(X&&typeof X.resolveModuleRegistry=="function")try{const n=X.resolveModuleRegistry(t);if(n)return n}catch{}if(Ee&&typeof Ee=="object")return Ee;const r=[t];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModules=="object")return o.cineModules}return null}const En=(function(){if(ie&&typeof ie.getModuleRegistry=="function"){const e=ie.getModuleRegistry(H);if(e)return e}if(ee&&typeof ee.getModuleRegistry=="function")try{const e=ee.getModuleRegistry(H);if(e)return e}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const e=Z.getModuleRegistry(H);if(e)return e}catch{}if(X&&typeof X.getModuleRegistry=="function")try{const e=X.getModuleRegistry(H);if(e)return e}catch{}return $h(H)})(),sn=(function(){if(ie&&typeof ie.getPendingQueueKey=="function"){const t=ie.getPendingQueueKey();if(typeof t=="string"&&t)return t}if(ee&&typeof ee.getPendingQueueKey=="function")try{const t=ee.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}if(Z&&typeof Z.getPendingQueueKey=="function")try{const t=Z.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return X&&typeof X.PENDING_QUEUE_KEY=="string"?X.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function Vh(e){if(!e||typeof e!="object")return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}return t}function Hh(e,t,r){if(ee&&typeof ee.queueModuleRegistration=="function")try{if(ee.queueModuleRegistration(e,t,r,H))return!0}catch{}if(Z&&typeof Z.queueModuleRegistration=="function")try{if(Z.queueModuleRegistration(e,t,r))return!0}catch{}if(X&&typeof X.queueModuleRegistration=="function")return X.queueModuleRegistration(e,t,r,H);if(!H||typeof H!="object")return!1;const n=Object.freeze({name:e,api:t,options:Object.freeze(Vh(r))});let o=H[sn];if(!Array.isArray(o))try{Object.defineProperty(H,sn,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=H[sn]}catch{try{Array.isArray(H[sn])||(H[sn]=[]),o=H[sn]}catch{return!1}}try{o.push(n)}catch{o[o.length]=n}return!0}function Ss(e,t,r,n){if(En&&typeof En.register=="function")try{return En.register(e,t,r),!0}catch(o){if(typeof n=="function")try{n(o)}catch{}}return Hh(e,t,r),!1}const qh=(function(){return ee&&typeof ee.registerOrQueueModule=="function"?function(r,n,o,i){try{if(ee.registerOrQueueModule(r,n,o,i,H,En))return!0}catch{}return Ss(r,n,o,i)}:Z&&typeof Z.registerOrQueueModule=="function"?function(r,n,o,i){try{if(Z.registerOrQueueModule(r,n,o,i,H,En))return!0}catch{}return Ss(r,n,o,i)}:X&&typeof X.registerOrQueueModule=="function"?function(r,n,o,i){return X.registerOrQueueModule(r,n,o,i,H,En)}:Ss})();function Wh(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Yh(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(Wh(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function Jh(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function Zs(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||Yh(e))return e;if(typeof process<"u"&&process&&nl&&nl.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const r=Jh(t);if(r.has(e))return e;r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||Zs(s,r)}try{return Object.freeze(e)}catch{return e}}const rc=(function(){return ee&&typeof ee.freezeDeep=="function"?ee.freezeDeep:Z&&typeof Z.freezeDeep=="function"?function(r,n){try{return Z.freezeDeep(r,n)}catch{return Zs(r,n)}}:X&&typeof X.freezeDeep=="function"?X.freezeDeep:Zs})();function il(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Qh=(function(){return ee&&typeof ee.safeWarn=="function"?ee.safeWarn:Z&&typeof Z.safeWarn=="function"?function(r,n){try{Z.safeWarn(r,n)}catch{il(r,n)}}:X&&typeof X.safeWarn=="function"?X.safeWarn:il})();function ws(e,t){if(!H||typeof H!="object")return!1;try{return Object.defineProperty(H,e,{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{try{return H[e]=t,!0}catch{return!1}}}const Xh=(function(){return ee&&typeof ee.exposeGlobal=="function"?function(r,n,o){try{return ee.exposeGlobal(r,n,o)}catch{return ws(r,n)}}:Z&&typeof Z.exposeGlobal=="function"?function(r,n,o){try{return Z.exposeGlobal(r,n,o)}catch{return ws(r,n)}}:X&&typeof X.exposeGlobal=="function"?function(r,n,o){return X.exposeGlobal(r,n,H,o)}:ws})(),ea=[];function ko(e,t){!e||typeof e!="object"||ea.push({ref:e,name:t||null})}ko(H,"global");bs&&typeof bs=="object"&&ko(bs,"storage");H.cineAppSession&&ko(H.cineAppSession,"session");H.cineAppSetups&&ko(H.cineAppSetups,"setups");const ta=Object.create(null),pn=[];function Zh(e){if(!e)return null;if(e.name)return e.name;const t=e.ref;return!t||typeof t!="object"?null:t===H?"global":typeof t.constructor=="function"&&t.constructor.name?t.constructor.name:null}function dp(e,t){const r=String(e);let n=ta[r];return n?t&&n.implementationName!==t&&(n.implementationName=t):(n={name:r,implementationName:t||r,available:!1,providerIndex:-1,providerName:null,lastChecked:null,implementation:null},ta[r]=n,pn.push(r)),n}function nc(e,t={}){const r=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,n=dp(e),o=n.implementationName||String(e);if(!r&&n.implementation&&typeof n.implementation=="function")return n;let i=null;for(let s=0;s<ea.length;s+=1){const a=ea[s],c=a&&a.ref;if(!c||typeof c!="object")continue;const u=c[o];if(typeof u=="function"){i={implementation:u,providerIndex:s,providerName:Zh(a)};break}}return n.available=!!i,n.providerIndex=i?i.providerIndex:-1,n.providerName=i?i.providerName:null,n.lastChecked=Date.now(),n.implementation=i?i.implementation:null,n}function eb(e){const t=nc(e,{refresh:!0});if(!t||typeof t.implementation!="function"){const r=new Error(`cinePersistence could not resolve function "${e}".`);throw r.code="CINE_PERSISTENCE_BINDING_MISSING",r.binding=e,r.detail={name:e,available:t?t.available:!1,providerName:t?t.providerName:null},r}return t.implementation}function yp(e){return e?Object.freeze({name:e.name,available:!!e.available,providerIndex:typeof e.providerIndex=="number"?e.providerIndex:-1,providerName:e.providerName||null,lastChecked:e.lastChecked||null,implementation:e.implementationName||e.name}):null}function I(e,t){const r=t||e;return dp(r,e),function(){return eb(r).apply(this,arguments)}}function tb(e,t={}){const r=String(e),n=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,o=nc(r,{refresh:n});return yp(o)}function rb(e={}){if(e&&Object.prototype.hasOwnProperty.call(e,"refresh")?e.refresh:!0)for(let n=0;n<pn.length;n+=1)nc(pn[n],{refresh:!0});const r={};for(let n=0;n<pn.length;n+=1){const o=pn[n];r[o]=yp(ta[o])}return rc(r)}function nb(){return pn.slice()}const Rn={bindings:{saveSession:I("saveCurrentSession","saveSession"),autoSaveSetup:I("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:I("saveCurrentGearList","saveGearList"),restoreSessionState:I("restoreSessionState"),collectFullBackupData:I("collectFullBackupData"),createSettingsBackup:I("createSettingsBackup"),captureStorageSnapshot:I("captureStorageSnapshot"),sanitizeBackupPayload:I("sanitizeBackupPayload"),autoBackup:I("autoBackup"),formatFullBackupFilename:I("formatFullBackupFilename"),downloadPayload:I("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:I("recordFullBackupHistoryEntry"),encodeSharedSetup:I("encodeSharedSetup"),decodeSharedSetup:I("decodeSharedSetup"),applySharedSetup:I("applySharedSetup"),applySharedSetupFromUrl:I("applySharedSetupFromUrl"),downloadProject:I("downloadSharedProject","downloadProject"),saveProject:I("saveProject"),proceed:I("handleRestoreRehearsalProceed","proceed"),abort:I("handleRestoreRehearsalAbort","abort")},storage:{loadDeviceData:I("loadDeviceData"),saveDeviceData:I("saveDeviceData"),loadSetups:I("loadSetups"),saveSetups:I("saveSetups"),saveSetup:I("saveSetup"),loadSetup:I("loadSetup"),deleteSetup:I("deleteSetup"),renameSetup:I("renameSetup"),loadSessionState:I("loadSessionState"),saveSessionState:I("saveSessionState"),loadFeedback:I("loadFeedback"),saveFeedback:I("saveFeedback"),saveProject:I("saveProject"),loadProject:I("loadProject"),deleteProject:I("deleteProject"),loadFavorites:I("loadFavorites"),saveFavorites:I("saveFavorites"),exportAllData:I("exportAllData"),importAllData:I("importAllData"),clearAllData:I("clearAllData"),loadAutoGearRules:I("loadAutoGearRules"),saveAutoGearRules:I("saveAutoGearRules"),loadAutoGearBackups:I("loadAutoGearBackups"),saveAutoGearBackups:I("saveAutoGearBackups"),loadAutoGearSeedFlag:I("loadAutoGearSeedFlag"),saveAutoGearSeedFlag:I("saveAutoGearSeedFlag"),loadAutoGearBackupRetention:I("loadAutoGearBackupRetention"),saveAutoGearBackupRetention:I("saveAutoGearBackupRetention"),getAutoGearBackupRetentionDefault:I("getAutoGearBackupRetentionDefault"),loadAutoGearPresets:I("loadAutoGearPresets"),saveAutoGearPresets:I("saveAutoGearPresets"),loadAutoGearActivePresetId:I("loadAutoGearActivePresetId"),saveAutoGearActivePresetId:I("saveAutoGearActivePresetId"),loadAutoGearAutoPresetId:I("loadAutoGearAutoPresetId"),saveAutoGearAutoPresetId:I("saveAutoGearAutoPresetId"),loadAutoGearMonitorDefaults:I("loadAutoGearMonitorDefaults"),saveAutoGearMonitorDefaults:I("saveAutoGearMonitorDefaults"),loadAutoGearBackupVisibility:I("loadAutoGearBackupVisibility"),saveAutoGearBackupVisibility:I("saveAutoGearBackupVisibility"),loadFullBackupHistory:I("loadFullBackupHistory"),saveFullBackupHistory:I("saveFullBackupHistory"),recordFullBackupHistoryEntry:I("recordFullBackupHistoryEntry"),requestPersistentStorage:I("requestPersistentStorage"),clearUiCacheStorageEntries:I("clearUiCacheStorageEntries"),ensureCriticalStorageBackups:I("ensureCriticalStorageBackups"),getLastCriticalStorageGuardResult:I("getLastCriticalStorageGuardResult"),saveSession:I("saveCurrentSession","saveSession"),autoSaveSetup:I("autoSaveCurrentSetup","autoSaveSetup"),proceed:I("handleRestoreRehearsalProceed","proceed"),abort:I("handleRestoreRehearsalAbort","abort")},autosave:{saveSession:I("saveCurrentSession","saveSession"),autoSaveSetup:I("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:I("saveCurrentGearList","saveGearList"),restoreSessionState:I("restoreSessionState")},backups:{collectFullBackupData:I("collectFullBackupData"),createSettingsBackup:I("createSettingsBackup"),captureStorageSnapshot:I("captureStorageSnapshot"),sanitizeBackupPayload:I("sanitizeBackupPayload"),autoBackup:I("autoBackup"),formatFullBackupFilename:I("formatFullBackupFilename"),downloadPayload:I("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:I("recordFullBackupHistoryEntry")},restore:{proceed:I("handleRestoreRehearsalProceed","proceed"),abort:I("handleRestoreRehearsalAbort","abort")},share:{downloadProject:I("downloadSharedProject","downloadProject"),encodeSharedSetup:I("encodeSharedSetup"),decodeSharedSetup:I("decodeSharedSetup"),applySharedSetup:I("applySharedSetup"),applySharedSetupFromUrl:I("applySharedSetupFromUrl")},__internal:rc({listBindings:nb,inspectBinding(e,t){return tb(e,t)||null},inspectAllBindings:rb})};rc(Rn);ko(Rn.bindings,"bindings");Kh("cinePersistence",Rn);qh("cinePersistence",Rn,{category:"persistence",description:"Data integrity facade for storage, autosave, backups, restore, and share flows.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},e=>{Qh("Unable to register cinePersistence module.",e)});if(H&&typeof H=="object"){let e=null;try{e=H.cinePersistence||null}catch{e=null}e!==Rn&&!Xh("cinePersistence",Rn,{configurable:!0,enumerable:!1,writable:!1})&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose cinePersistence globally.")}export{ul as I,fl as _,cl as a,Eo as b,_l as c,Ts as d,cd as e,oa as f,Ur as g,xh as h,F as i,Ml as j,qn as k,Nl as l,pr as m,Do as n,ya as o,sb as p,Ee as r,P as s,Dy as u};
//# sourceMappingURL=core-modules-C8doLRdR.js.map
