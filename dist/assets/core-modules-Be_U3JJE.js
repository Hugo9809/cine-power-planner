import{g as bp,L as ks,s as Sp,d as wp,c as Ep,k as Op}from"./vendor-DzOFLsIx.js";const He=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},ca=(function(){const t=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:null);if(typeof t!="object"||!t)return new Set;const r=Object.values(t).filter(n=>typeof n=="string"&&n);return new Set(r)})();function Qn(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return"";if(typeof String.fromCodePoint=="function")try{return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):""}function hi(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=Qn(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=Qn(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=Qn(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=Qn(i[1],10);if(s)return s}return t}function F(e,t){const n=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons",o=t||n,i=ca.has(o)?o:n,a={char:hi(e),font:i};return typeof Object.freeze=="function"?Object.freeze(a):a}function Vi(e){const r=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons";if(!e)return{char:"",font:r,className:"",size:void 0};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:hi(e),font:r,className:"",size:void 0};if(typeof e=="object"){const n=typeof e.char=="string"?hi(e.char):"",o=e.font&&ca.has(e.font)?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:"",size:void 0}}function ul(e){return typeof e!="string"?"":e.indexOf('aria-hidden="true"')!==-1?e:e.replace("<svg",'<svg aria-hidden="true"')}function fl(e,t){if(!e)return;const r=Vi(t);if(r.markup){e.innerHTML=ul(r.markup),e.setAttribute("aria-hidden","true"),r.className&&r.className.split(/\s+/).filter(Boolean).forEach(o=>e.classList.add(o)),e.removeAttribute("data-icon-font");return}const n=r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font):e.removeAttribute("data-icon-font")}function pl(e,t){const r=Vi(e),n=[];r.className&&n.push(r.className),t&&n.push(t);const o=n.join(" ");if(r.markup){let s=ul(r.markup);return o&&(s.indexOf('class="')!==-1?s=s.replace('class="',`class="${o} `):s=s.replace("<svg",`<svg class="${o}"`)),s}const i=r.char?`data-icon-font="${r.font}"`:"";return`<span class="icon-glyph ${o}" aria-hidden="true" ${i}>${r.char}</span>`}function mr(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function dl(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=mr(t),a=mr(r),c=mr(n),u=mr(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(l,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[];return/(?:^|\s)width\s*=/i.test(p)||d.push(`width="${c}"`),/(?:^|\s)height\s*=/i.test(p)||d.push(`height="${u}"`),d.push(`x="-${mr(i)}"`),d.push(`y="-${mr(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}const la=`
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M12 17.25 6.545 20.2 7.9 13.975 3 9.45l6.272-.7L12 3l2.728 5.75L21 9.45l-4.9 4.525 1.355 6.225Z"
    fill="currentColor"
    stroke="currentColor"
    stroke-width="0"
  />
</svg>
`.trim(),G=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons",ESSENTIAL:"essential",GADGET:"gadget",FILM:"film",TEXT:"text"}),yl=Object.freeze({batteryBolt:F("",G.UICONS),batteryFull:F("",G.UICONS),bolt:F("",G.ESSENTIAL),plug:F("",G.UICONS),sliders:F("",G.ESSENTIAL),screen:F("",G.GADGET),brightness:F("",G.UICONS),wifi:F("",G.UICONS),gears:F("",G.UICONS),controller:F("",G.GADGET),distance:F("",G.UICONS),sensor:F("",G.UICONS),viewfinder:F("",G.FILM),camera:F("",G.UICONS),trash:F("",G.ESSENTIAL),reload:F("",G.ESSENTIAL),load:F("",G.UICONS),installApp:F("",G.UICONS),add:Object.freeze({char:"+",font:G.TEXT,className:"icon-text"}),minus:Object.freeze({char:"−",font:G.TEXT,className:"icon-text"}),arrowLeft:Object.freeze({char:"←",font:G.TEXT,className:"icon-text"}),check:F("",G.UICONS),fileExport:F("",G.UICONS),fileImport:F("",G.UICONS),save:F("",G.ESSENTIAL),share:F("",G.ESSENTIAL),paperPlane:F("",G.UICONS),magnet:F("",G.ESSENTIAL),codec:F("",G.UICONS),timecode:F("",G.FILM),audioIn:F("",G.ESSENTIAL),audioOut:F("",G.ESSENTIAL),note:F("",G.ESSENTIAL),overview:F("",G.UICONS),gearList:F("",G.UICONS),contacts:F("",G.UICONS),feedback:F("",G.UICONS),resetView:F("",G.UICONS),pin:F("",G.ESSENTIAL),sun:F("",G.UICONS),moon:F("",G.UICONS),circleX:F("",G.ESSENTIAL),settingsGeneral:F("",G.UICONS),settingsAutoGear:F("",G.UICONS),settingsAccessibility:F("",G.UICONS),settingsBackup:F("",G.UICONS),settingsData:F("",G.UICONS),settingsAbout:F("",G.UICONS),star:Object.freeze({markup:la,className:"icon-svg favorite-star-icon"}),warning:F("",G.ESSENTIAL)});He.cineIcons={VALID_ICON_FONTS:ca,toCodePointChar:Qn,normalizeGlyphChar:hi,iconGlyph:F,resolveIconGlyph:Vi,applyIconGlyph:fl,iconMarkup:pl,formatSvgCoordinate:mr,positionSvgMarkup:dl,STAR_ICON_SVG:la,ICON_GLYPHS:yl};He.iconGlyph=F;He.resolveIconGlyph=Vi;He.applyIconGlyph=fl;He.iconMarkup=pl;He.formatSvgCoordinate=mr;He.positionSvgMarkup=dl;He.STAR_ICON_SVG=la;He.ICON_GLYPHS=yl;He.cineIcons;const Ap="modulepreload",Cp=function(e){return"/"+e},fc={},gl=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");o=c(r.map(u=>{if(u=Cp(u),u in fc)return;fc[u]=!0;const f=u.endsWith(".css"),l=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":Ap,f||(y.as="script"),y.crossOrigin="",y.href=u,a&&y.setAttribute("nonce",a),document.head.appendChild(y),f)return new Promise((p,d)=>{y.addEventListener("load",p),y.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};function ml(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function hl(e){return!!e&&(typeof e=="object"||typeof e=="function")}function Hi(e){if(typeof Object.freeze=="function")try{return Object.freeze(e)}catch{}return e}function ti(e){if(!e)return[];try{return Array.prototype.slice.call(e)}catch{}const t=[];for(let r=0;r<e.length;r+=1)t[r]=e[r];return t}function pc(){return{objects:typeof WeakMap=="function"?new WeakMap:null,primitives:Object.create(null),empty:null}}function _p(e,t){if(!e)return null;if(hl(t)){if(!e.objects)return null;let o=e.objects.get(t);return o||(o={cached:!1,value:null},e.objects.set(t,o)),o}const r=typeof t+":"+String(t);let n=e.primitives[r];return n||(n={cached:!1,value:null},e.primitives[r]=n),n}function Yt(e,t){hl(t)&&e.indexOf(t)===-1&&e.push(t)}const Ps=(function(){const t=[];return Yt(t,typeof globalThis<"u"?globalThis:null),Yt(t,typeof window<"u"?window:null),Yt(t,typeof self<"u"?self:null),Yt(t,typeof global<"u"?global:null),Hi(t)})(),js=Hi([]),bl=typeof WeakMap=="function",ls=bl?new WeakMap:null;function kp(e){if(!Array.isArray(e)||e.length===0)return js;const t=[];for(let r=0;r<e.length;r+=1)Yt(t,e[r]);return t.length===0?js:Hi(t)}function dc(e,t,r){const n=[];Yt(n,e);let o=null;if(typeof t=="function")try{o=t()}catch{o=null}Yt(n,o);for(let i=0;i<Ps.length;i+=1)Yt(n,Ps[i]);if(Array.isArray(r))for(let i=0;i<r.length;i+=1)Yt(n,r[i]);return Hi(n)}function Pp(e,t){if(!e)return null;if(t===js)return e.empty||(e.empty=pc()),e.empty;if(!e.extras){if(!bl)return null;e.extras=new WeakMap}let r=e.extras.get(t);return r||(r=pc(),e.extras.set(t,r)),r}function jp(e){if(!ls)return null;let t=ls.get(e);return t||(t={empty:null,extras:null},ls.set(e,t)),t}function Ip(e,t,r,n){if(n){const i=_p(n,e);if(i){if(i.cached)return ti(i.value);const s=dc(e,t,r);return i.value=s,i.cached=!0,ti(s)}}const o=dc(e,t,r);return ti(o)}function ua(e){const t=e&&typeof e.detectGlobalScope=="function"?e.detectGlobalScope:ml,r=kp(e&&e.additionalScopes),n=jp(t),o=Pp(n,r);return function(s){return Ip(s,t,r,o)}}function vp(e,t){return ua(t||{})(e)}function Lp(){return ti(Ps)}const us=ml();us&&!us.__cineScopeCollector&&(us.__cineScopeCollector={collectCandidateScopes:vp,createCollector:ua,getBaseScopes:Lp});const qi="__cinePendingModuleRegistrations__";function tr(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Rp(e){const t=e||tr();if(!t||typeof t!="object"&&typeof t!="function")return;let r=null;try{r=t.console||null}catch{r=null}if(!r||typeof r!="object"&&typeof r!="function")return;const n=["log","warn","error","info","debug"];let o=null;try{o=r.__cineSafeConsoleOriginals||null}catch{o=null}if(!o||typeof o!="object"){o={};try{Object.defineProperty(r,"__cineSafeConsoleOriginals",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{try{r.__cineSafeConsoleOriginals=o}catch{}}}for(let i=0;i<n.length;i+=1){const s=n[i];let a=null;try{a=r[s]}catch{a=null}if(typeof a!="function"||a&&a.__cineSafeConsoleGuard)continue;Object.prototype.hasOwnProperty.call(o,s)||(o[s]=a);const c=function(){try{return a.apply(r,arguments)}catch{}};try{Object.defineProperty(c,"__cineSafeConsoleGuard",{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{c.__cineSafeConsoleGuard=!0}try{r[s]=c}catch{}}}const yc=ua,Tp={key:"defaultExtras"},fs=[],Br=typeof WeakMap=="function"?new WeakMap:[];function Np(e){if(!e||typeof e!="object"&&typeof e!="function")return;if(Br&&typeof Br.get=="function"){let r=Br.get(e);return r||(r=[e],Br.set(e,r)),r}for(let r=0;r<Br.length;r+=1){const n=Br[r];if(n.scope===e)return n.extras}const t=[e];return Br.push({scope:e,extras:t}),t}function Mp(e,t){if(!yc)return null;const r=Array.isArray(t)?t:Tp;for(let o=0;o<fs.length;o+=1){const i=fs[o];if(i.detect===e&&i.extras===r)return i.collector}const n=yc({detectGlobalScope:e,additionalScopes:Array.isArray(t)?t:void 0});return n?(fs.push({detect:e,extras:r,collector:n}),n):null}function Wi(e,t){const r=t||tr(),n=Np(r),o=Mp(tr,n);if(o)return o(e||r);const i=[];function s(a){!a||typeof a!="object"&&typeof a!="function"||i.indexOf(a)===-1&&i.push(a)}return s(e||r),typeof globalThis<"u"&&s(globalThis),typeof window<"u"&&s(window),typeof self<"u"&&s(self),typeof global<"u"&&s(global),i}function Sl(e){return null}function wl(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function fa(e,t,r){const n=e||r,o=typeof t=="string"&&t?t:qi;if(!n||typeof n!="object")return null;let i=n[o];return Array.isArray(i)?i:!wl(n,o,[])||(i=n[o],!Array.isArray(i))?null:i}const ps=(function(){const t="__cineBuiltinImmutabilityGuards__",r=Wi(null,tr());for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function Is(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(Ie&&typeof Ie=="object")try{if(e===Ie.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(t){if(t&&typeof t.message=="string"&&/metamask/i.test(t.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function zp(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function vs(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(zp(e)||typeof e=="object"&&e&&typeof e.id=="string"&&typeof e.filename=="string"&&(typeof e.loaded=="boolean"||Array.isArray(e.children))||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(ps&&typeof ps.isImmutableBuiltin=="function"&&ps.isImmutableBuiltin(e)||typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function xp(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function pa(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||vs(e)||Is(e))return e;if(typeof e=="function")try{return Object.freeze(e)}catch{return e}const r=xp(t);if(r.has(e))return e;r.add(e);let n;try{n=Object.getOwnPropertyNames(e)}catch{return e}for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=Object.getOwnPropertyDescriptor(e,i)}catch{s=null}if(s&&(typeof s.get=="function"||typeof s.set=="function"))continue;let a;try{a=e[i]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||vs(a)||Is(a)||pa(a,r)}try{return Object.freeze(e)}catch{return e}}function El(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function Bp(e,t){const n=Wi(e||t,t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}function Gp(e,t,r,n,o){const s=fa(e||o,qi,o);if(!s)return!1;const a=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{return s.push(a),!0}catch{}try{return s[s.length]=a,!0}catch{}return!1}function Fp(e){const t=e||tr();return{detectGlobalScope:tr,getGlobalScope(){return t},collectCandidateScopes(r){return Wi(r||t,t)},tryRequire:Sl,defineHiddenProperty:wl,ensureQueue(r,n){return fa(r||t,n,t)},freezeDeep:pa,safeWarn:El,resolveModuleRegistry(r){return Bp(r||t,t)},queueModuleRegistration(r,n,o,i){return Gp(r||t,n,o,i,t)},getPendingQueueKey(){return qi}}}function Dp(e){const t=e||tr();return t&&typeof t.cineModuleArchitectureKernel=="object"?t.cineModuleArchitectureKernel:null}const da=tr();Rp(da);const Up=Dp(da),Q=Up||Fp(da);function gc(){if(Q&&typeof Q.detectGlobalScope=="function")try{const e=Q.detectGlobalScope();if(e)return e}catch{}return tr()}const Ie=Q&&typeof Q.getGlobalScope=="function"?(function(){try{const t=Q.getGlobalScope();if(t)return t}catch{}return gc()})():gc(),Ls=Q&&typeof Q.getPendingQueueKey=="function"?Q.getPendingQueueKey():qi;function Ol(e){if(Q&&typeof Q.collectCandidateScopes=="function")try{const t=Q.collectCandidateScopes(e||Ie);if(Array.isArray(t)&&t.length>0)return t}catch{}return Wi(e||Ie,Ie)}function Al(e){if(Q&&typeof Q.tryRequire=="function")try{const t=Q.tryRequire(e);if(typeof t<"u")return t}catch{}return Sl()}function Cl(e){const t=e||Ie;if(Q&&typeof Q.resolveModuleRegistry=="function")try{const o=Q.resolveModuleRegistry(t);if(o&&typeof o=="object")return o}catch{}const r=Al("./registry.js");if(r&&typeof r=="object")return r;const n=Ol(t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}let mc=null,hc=!1;function Rs(e){if(!hc||e&&e!==Ie){const t=Cl(e);if(e&&e!==Ie)return t;mc=t,hc=!0}return mc}function Kp(e){const t=e||Ie;if(Q&&typeof Q.ensureQueue=="function")try{const r=Q.ensureQueue(t,Ls);if(Array.isArray(r))return r}catch{}return fa(t,Ls,Ie)}function _l(e,t,r,n){const o=e||Ie;if(Q&&typeof Q.queueModuleRegistration=="function")try{if(Q.queueModuleRegistration(o,t,r,n))return!0}catch{}const i=Kp(o);if(!i)return!1;const s=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{i.push(s)}catch{i[i.length]=s}return!0}function kl(e,t,r,n,o,i){if(t&&typeof t.register=="function")try{return t.register(r,n,o),!0}catch(s){typeof i=="function"&&i(s)}return _l(e,r,n,o),!1}function bc(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||vs(e)||Is(e))return e;if(Q&&typeof Q.freezeDeep=="function")try{return Q.freezeDeep(e)}catch{}return pa(e)}function Pl(e,t){if(Q&&typeof Q.safeWarn=="function")try{Q.safeWarn(e,t);return}catch{}El(e,t)}function jl(e,t,r,n={}){const o=r||Ie;if(!o||typeof o!="object")return!1;const i={configurable:n.configurable!==!1,enumerable:!!n.enumerable,value:t,writable:n.writable===!0};try{return Object.defineProperty(o,e,i),!0}catch{try{return o[e]=t,!0}catch{return!1}}}const Il=bc({getGlobalScope(){return Ie},collectCandidateScopes:Ol,tryRequire:Al,resolveModuleRegistry:Cl,getModuleRegistry:Rs,queueModuleRegistration(e,t,r,n){return _l(n||Ie,e,t,r)},registerOrQueueModule(e,t,r,n,o,i){const s=o||Ie,a=i||Rs(s);return kl(s,a,e,t,r,n)},freezeDeep:bc,safeWarn:Pl,exposeGlobal:jl,PENDING_QUEUE_KEY:Ls}),$p=Rs();kl(Ie,$p,"cineModuleBase",Il,{category:"infrastructure",description:"Shared helpers for module registration, freezing and safe global exposure.",replace:!0,connections:["cineModuleArchitectureKernel","cineModuleArchitectureHelpers"]},e=>{Pl("Unable to register cineModuleBase.",e)});jl("cineModuleBase",Il,Ie,{configurable:!0,enumerable:!1,writable:!1});var Vp={};const Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};let bi=null;!bi&&Ce&&typeof Ce.__cineEnsureConsoleMethodsWritable=="function"&&(bi=Ce.__cineEnsureConsoleMethodsWritable);typeof bi=="function"&&bi(["warn","info"]);const go="__cinePendingModuleRegistrations__",ya="__cinePendingModuleRegistrationsTimer__";let Ur=Object.create(null),Si=Object.create(null),ri=null;function vl(e){const r=[e||Ce];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModuleImmutability=="object")return o.cineModuleImmutability}return null}const ds=(function(){const t="__cineBuiltinImmutabilityGuards__",r=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&r.push(globalThis),typeof window<"u"&&r.push(window),typeof self<"u"&&r.push(self),typeof global<"u"&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function Hp(){function e(r){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function")return!1;try{if(ds&&typeof ds.isImmutableBuiltin=="function"&&ds.isImmutableBuiltin(r)||typeof r.pipe=="function"&&typeof r.unpipe=="function")return!0;if(typeof r.on=="function"&&typeof r.emit=="function"){if(typeof r.write=="function"||typeof r.read=="function")return!0;const n=r.constructor&&r.constructor.name;if(n&&/Stream|Emitter|Port/i.test(n))return!0}if(typeof Symbol<"u"&&r[Symbol.toStringTag]){const n=r[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port/i.test(n))return!0}}catch{}return!1}function t(r,n=new WeakSet){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function"||e(r)||n.has(r))return r;n.add(r);const o=Object.getOwnPropertyNames(r);for(let i=0;i<o.length;i+=1){const s=o[i];let a;try{a=r[s]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||t(a,n)}try{return Object.freeze(r)}catch{return r}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const ga=Hp();let Fn=vl(Ce)||ga;function qp(){if(Fn!==ga)return Fn;const e=vl(Ce);return e&&e!==Fn&&(Fn=e),Fn}function It(e,t){const r=qp();try{return r.freezeDeep(e,t)}catch{}return ga.freezeDeep(e,t)}function Nr(e){if(typeof e=="string"){const t=e.trim();if(t)return t}throw new TypeError("cineModules.register expected a non-empty string name.")}function ni(e){if(e==null)return[];const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=new Set,n=[];for(let o=0;o<t.length;o+=1){const i=t[o];let s=null;if(typeof i=="string"?s=i:i&&typeof i.name=="string"&&(s=i.name),!s)continue;const a=s.trim();!a||r.has(a)||(r.add(a),n.push(a))}return n}function Wp(e,t,r={}){const n=Nr(e);if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError(`cineModules.register("${n}") expected an object or function.`);const o=r.freeze!==!1,i=o&&!Object.isFrozen(t)?It(t):t;if(Object.prototype.hasOwnProperty.call(Ur,n)){const s=Ur[n];if(s===i)return s;if(!r.replace)throw new Error(`cineModules: Module "${n}" is already registered. Use { replace: true } to overwrite.`)}return Ur[n]=i,Si[n]={description:typeof r.description=="string"?r.description.trim():"",category:typeof r.category=="string"?r.category.trim():"",registeredAt:Date.now(),frozen:o,connections:It(ni(r.connections||r.links||r.dependencies||null))},i}function Yp(e){const t=Nr(e);return Object.prototype.hasOwnProperty.call(Ur,t)?Ur[t]:null}function Ll(e){const t=Nr(e);return Object.prototype.hasOwnProperty.call(Ur,t)}function Jp(){return Object.freeze(Object.keys(Ur).sort())}function Qp(e){const t=Nr(e),r=Si[t];return r?Object.freeze({name:t,description:r.description,category:r.category,registeredAt:r.registeredAt,frozen:r.frozen,connections:r.connections||It([])}):null}function Xp(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];try{const s=Nr(i);n.has(s)||(n.add(s),r.push(s))}catch{}}return r.length>0?r:null}function Zp(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i!="string")continue;const s=i.trim();!s||n.has(s)||(n.add(s),r.push(s))}return r.length>0?r:null}function ed(e={}){const t=Xp(e&&e.names),r=Zp(e&&(e.categories||e.category||null)),n=t?new Set(t):null,o=r?new Set(r):null,i=[],s=n?t:Object.keys(Si);for(let a=0;a<s.length;a+=1){const c=s[a],u=Si[c];u&&(o&&!o.has(u.category)||i.push({name:c,description:u.description,category:u.category,registeredAt:u.registeredAt,frozen:u.frozen,connections:u.connections||It([])}))}return n||(!e||e.sort!==!1)&&i.sort((c,u)=>c.name.localeCompare(u.name)),It(i)}function td(e){const t=Array.isArray(e)?e.slice():[e],r={},n=[];for(let o=0;o<t.length;o+=1){const i=Nr(t[o]),s=Ll(i);r[i]=s,s||n.push(i)}return Object.freeze({ok:n.length===0,missing:Object.freeze(n),detail:Object.freeze(r)})}function rd(e={}){throw typeof process<"u"&&process,new Error("cineModules.__internalResetForTests() is restricted to test environments.")}function Rl(e){if(!e||typeof e!="object")return null;const t=e[ya];return t&&typeof t=="object"?t:null}function ma(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function wi(e){const t=Rl(e);if(!t)return;const r=t&&typeof t.clear=="function"?t.clear:null;if(r&&Object.prototype.hasOwnProperty.call(t,"id"))try{r(t.id)}catch{}ma(e,ya,null)}function Tl(e){if(!e||typeof e!="object")return;const t=e[go];if(!Array.isArray(t)||t.length===0){wi(e);return}if(Rl(e))return;const r=typeof e.setTimeout=="function"&&e.setTimeout.bind(e)||typeof Ce.setTimeout=="function"&&Ce.setTimeout.bind(Ce)||(typeof setTimeout=="function"?setTimeout:null);if(typeof r!="function")return;const n=typeof e.clearTimeout=="function"&&e.clearTimeout.bind(e)||typeof Ce.clearTimeout=="function"&&Ce.clearTimeout.bind(Ce)||(typeof clearTimeout=="function"?clearTimeout:null),o=r(function(){wi(e),Nl(e)},0);ma(e,ya,{id:o,clear:typeof n=="function"?n:null})}function Nl(e){if(!e||typeof e!="object")return;const t=e[go];if(!Array.isArray(t)||t.length===0){wi(e);return}const r=t.slice();t.length=0;for(let n=0;n<r.length;n+=1){const o=r[n];if(!o||typeof o!="object")continue;const i=o.name,s=o.api,a=o.options||{};try{Ee.register(i,s,a)}catch(c){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`cineModules: discard pending registration for "${i}" due to error:`,c);continue}}t.length>0?Tl(e):wi(e)}function nd(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),r(Ce),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function ys(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e[go];return Array.isArray(t)?t:null}catch{return null}}function od(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=ys(e);if(t||ma(e,go,[])&&(t=ys(e),t))return t;try{if(e[go]=[],t=ys(e),t)return t}catch{}return null}function id(e){const t=nd(e);for(let r=0;r<t.length;r+=1){const n=t[r],o=od(n);if(o)return{queue:o,scope:n}}return null}function sd(e,t){const r=id(e||Ce);if(!r||!r.queue)return!1;const n=It({name:t&&t.name?Nr(t.name):null,api:t?t.api:null,options:Object.freeze({...t&&t.options?t.options:{}})}),{queue:o,scope:i}=r;try{o.push(n)}catch{o[o.length]=n}try{Tl(i)}catch{}return!0}function ad(e={}){const t=Nr(e.name),r=typeof e.category=="string"?e.category.trim():"";if(!r)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty category string.`);const n=typeof e.description=="string"?e.description.trim():"";if(!n)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty description.`);const o=e.freeze!==!1,i=It(ni(e.connections)),s=typeof e.factory=="function"?e.factory:null,a=s?null:e.api;if(!s&&(!a||typeof a!="object"&&typeof a!="function"))throw new TypeError(`cineModules.createBlueprint("${t}") expected an object API or factory function.`);const c=Object.freeze({name:t,category:r,description:n,connections:i,freeze:o});let u=null,f=!1,l=null;function y(m){const b={category:c.category,description:c.description,connections:c.connections,freeze:c.freeze};if(!m||typeof m!="object")return Object.freeze({...b});const C={...b};if(Object.prototype.hasOwnProperty.call(m,"category")){const A=typeof m.category=="string"?m.category.trim():"";A&&(C.category=A)}if(Object.prototype.hasOwnProperty.call(m,"description")){const A=typeof m.description=="string"?m.description.trim():"";A&&(C.description=A)}return Object.prototype.hasOwnProperty.call(m,"connections")&&(C.connections=It(ni(m.connections))),Object.prototype.hasOwnProperty.call(m,"freeze")&&(C.freeze=m.freeze!==!1),Object.freeze(C)}function p(m){if(f){if(l)throw l;return u}f=!0;let b=a;if(s){const C=m&&typeof m=="object"?{...m}:{},A=Object.freeze({registry:ri||null,metadata:c,context:C,freezeDeep:It,normalizeConnections:ni});try{b=s(A)}catch(_){throw l=_ instanceof Error?_:new Error(String(_)),l}}if(!b||typeof b!="object"&&typeof b!="function"){const C=new TypeError(`cineModules.createBlueprint("${t}") factory expected an object or function return value.`);throw l=C,C}return u=o&&!Object.isFrozen(b)?It(b):b,u}function d(m={}){const b=m&&typeof m.registry=="object"&&m.registry?m.registry:ri,C=y(m&&m.options),A=m&&m.scope?m.scope:Ce,_=m&&Object.prototype.hasOwnProperty.call(m,"defer")?m.defer!==!1:!0,P=m&&typeof m.onError=="function"?m.onError:null,k=p(m&&m.context),I=b&&typeof b.register=="function"?b:ri;if(!I||typeof I.register!="function")throw new TypeError("cineModules.createBlueprint register() requires a registry with a register() function.");try{return I.register(c.name,k,C)}catch(w){if(_&&sd(A,{name:c.name,api:k,options:C}),P)try{P(w)}catch{}throw w}}const g={name:c.name,category:c.category,description:c.description,connections:c.connections,freeze:c.freeze,instantiate:p,register:d,getMetadata(){return c},createRegistrationOptions:y,toJSON(){return c}};return Object.freeze(g)}const Ee={};Ee.register=Wp;Ee.get=Yp;Ee.has=Ll;Ee.list=Jp;Ee.describe=Qp;Ee.describeAll=ed;Ee.assertRegistered=td;Ee.createBlueprint=ad;Ee.__internalResetForTests=rd;ri=Ee;const rr=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&rr.push(globalThis);typeof window<"u"&&rr.indexOf(window)===-1&&rr.push(window);typeof self<"u"&&rr.indexOf(self)===-1&&rr.push(self);typeof global<"u"&&rr.indexOf(global)===-1&&rr.push(global);for(let e=0;e<rr.length;e+=1){const t=rr[e];if(!t||typeof t!="object")continue;if(t.cineModules!==Ee)try{Object.defineProperty(t,"cineModules",{configurable:!0,enumerable:!1,value:Ee,writable:!0})}catch{try{t.cineModules=Ee}catch{}}Nl(t)}function ha(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Ml=ha(),Dn={value:null,time:0};function ba(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Bo(){if(Dn.value&&typeof Dn.value=="object")return Dn.value;try{const e=ha();if(e&&(typeof e=="object"||typeof e=="function"))return Dn.value=e,Dn.time=Date.now(),e}catch{}return Ml}function zl(e,t,r){const n=[],o=s=>{!s||typeof s!="object"&&typeof s!="function"||n.indexOf(s)===-1&&n.push(s)};o(e);const i=typeof r=="function"?r:Bo;try{o(i())}catch{}if(Array.isArray(t))for(let s=0;s<t.length;s+=1)o(t[s]);return typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),o(Ml),n.slice()}function cd(e){if(typeof require!="function")return null;try{return require(e)}catch{return null}}function ld(e,t){const r=t||{},n=typeof r.predicate=="function"?r.predicate:null,o=Array.isArray(r.scopes)?r.scopes.slice():[],i=zl(r.primaryScope,r.additionalScopes,r.detect);for(let s=0;s<i.length;s+=1)o.indexOf(i[s])===-1&&o.push(i[s]);for(let s=0;s<o.length;s+=1){const a=o[s];if(!(!a||typeof a!="object"&&typeof a!="function")){if(n)try{if(n(a,e))return a}catch{}try{if(e in a)return a}catch{}}}return null}function ud(e,t){if(!e)return typeof t=="function"?t():t;const r=Bo();if(r&&typeof r=="object"){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];const n=typeof t=="function"?t():t;if(ba(r,e,n))try{return r[e]}catch{}return n}return typeof t=="function"?t():t}const fd={baseDetectGlobalScope:ha,detectGlobalScope:Bo,collectCandidateScopes:zl,tryRequire:cd,defineHiddenProperty:ba,resolveFromScopes:ld,getCachedGlobalValue:ud},gs=Bo();gs&&!gs.cineScopeUtils&&ba(gs,"cineScopeUtils",fd);const Go=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},pd=new Set(["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI","DisplayPort"]),Ei="__normalized";function xl(e){const t=new Map;return r=>{if(!r)return"";const n=String(r).replace(/[™®]/g,"").trim(),o=n.toLowerCase();return t.has(o)||t.set(o,e(n,o)),t.get(o)}}const dd=[{needles:["12g"],value:"12G-SDI"},{needles:["6g"],value:"6G-SDI"},{needles:["3g"],value:"3G-SDI"},{needles:["hd","sdi"],value:"3G-SDI"},{needles:["mini","bnc"],value:"Mini BNC"},{needles:["micro","hdmi"],value:"Micro HDMI"},{needles:["mini","hdmi"],value:"Mini HDMI"},{needles:["hdmi"],value:"HDMI"},{needles:["displayport"],value:"DisplayPort"},{needles:["display","port"],value:"DisplayPort"},{needles:["dp"],value:"DisplayPort"}],Bl=xl((e,t)=>{const r=dd.find(({needles:n})=>n.every(o=>t.includes(o)));return r?r.value:""}),yd={"lemo 4-pin (lbus)":"LBUS (LEMO 4-pin)","lbus (lemo 4-pin)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo for motors)":"LBUS (LEMO 4-pin)","4-pin lemo (lbus)":"LBUS (LEMO 4-pin)","lemo 4-pin":"LEMO 4-pin","4-pin lemo":"LEMO 4-pin","lemo 7-pin":"LEMO 7-pin","lemo 7-pin 1b":"LEMO 7-pin","7-pin lemo":"LEMO 7-pin","7-pin lemo (lcs)":"LEMO 7-pin (LCS)","7-pin lemo (cam)":"LEMO 7-pin (CAM)","ext (lemo 7-pin)":"EXT LEMO 7-pin","hirose 12pin":"Hirose 12-pin","12-pin hirose":"Hirose 12-pin","12pin broadcast connector":"Hirose 12-pin","lens 12 pin":"Hirose 12-pin","lens terminal 12-pin":"Hirose 12-pin","lens terminal 12-pin jack":"Hirose 12-pin","lens terminal":"Hirose 12-pin","usb type-c":"USB-C","usb-c":"USB-C","usb-c (usb 3.2 / 3.1 gen 1)":"USB-C","usb-c / gigabit ethernet (via adapter)":"USB-C","active ef mount":"Active EF mount","lanc (2.5mm stereo mini jack)":"LANC","2.5 mm sub-mini (lanc)":"LANC","remote a (2.5mm)":"REMOTE A connector","remote control terminal":"REMOTE A connector","remote 8 pin":"REMOTE B connector"};function Sa(e){return xl((t,r)=>e[r]||t)}const Xn=Sa(yd),gd={'dsmc3 red touch 7" lcd (optional)':'RED Touch 7" LCD (Optional)','red touch 7.0" lcd (optional)':'RED Touch 7" LCD (Optional)',"lcd touch panel":"LCD touchscreen","lcd touchscreen":"LCD touchscreen","native lcd capacitive touchscreen":"LCD touchscreen","integrated touchscreen lcd":"LCD touchscreen","free-angle lcd":"Vari-angle LCD","lcd monitor (native)":"Integrated LCD monitor","native lcd viewfinder":"Integrated LCD monitor","lcd monitor lm-v2 (supplied)":"LCD Monitor LM-V2","integrated main monitor":"Integrated LCD monitor","optional evf-v70 viewfinder":"EVF-V70 (Optional)","optional evf-v50":"EVF-V50 (Optional)","optional oled viewfinder":"OLED EVF (Optional)","blackmagic pocket cinema camera pro evf (optional)":"Blackmagic Pro EVF (Optional)","external backlit lcd status display":"LCD status display","built-in fold-out lcd":"Fold-out LCD","oled lvf (live view finder)":"OLED EVF","lcd capacitive touchscreen":"LCD touchscreen","lemo 26 pin":"LEMO 26-pin port"},Gl=Sa(gd),md={"lemo 8-pin (dc in / bat)":"Bat LEMO 8-pin","lemo 8-pin (bat)":"Bat LEMO 8-pin","bat (lemo 8-pin)":"Bat LEMO 8-pin","lemo 8-pin":"Bat LEMO 8-pin","2-pin dc-input":"2-pin DC-IN","dc-":"DC IN",dc:"DC IN","2-pin xlr":"XLR 2-pin","2-pin locking connector":"LEMO 2-pin","2-pin locking connector / 2-pin lemo":"LEMO 2-pin","4-pin xlr / dc in 12v":"XLR 4-pin","4-pin xlr / v-lock":"XLR 4-pin","xlr 4-pin jack":"XLR 4-pin","xlr 4-pin (main input)":"XLR 4-pin","xlr-type 4 pin (male) / square-shaped 5 pin connector (battery)":"XLR 4-pin / Square 5-pin","12-pin molex connector (at battery plate rear) / 4-pin xlr (external power)":"Molex 12-pin / XLR 4-pin","battery slot":"Battery Slot","usb-c":"USB-C","usb type-c":"USB-C","usb-c pd":"USB-C PD","usb-c (power delivery)":"USB-C PD","usb-c pd,dc coupler":"USB-C PD / DC Coupler","dc coupler":"DC Coupler","dc coupler (dr-e6c)":"DC Coupler","dc input":"DC IN","dc barrel":"DC Barrel","dc (barrel)":"DC Barrel","locking dc barrel":"DC Barrel","dc 24v terminal":"DC Barrel","weipu sf610/s2 (12vdc) input":"Weipu SF610/S2","6-pin 1b dc-in / tb50 battery mount":"6-pin 1B DC-IN","6-pin 1b dc-,tb50":"6-pin 1B DC-IN"},Sc=Sa(md);function oi(e){if(!e)return[];const t=r=>{const n=Sc(r);return n?n.split(/[/,]/).map(o=>Sc(o.trim())).map(o=>o&&o.trim()||"").filter(Boolean):[]};return Array.isArray(e)?e.flatMap(t):t(e)}function gr(e,t){return Array.isArray(e)?e.map(r=>typeof r=="string"?{...t,type:r}:{...t,...r||{}}):[]}function wa(e){if(!e)return;e.powerInput&&!e.power?.input&&(e.power={...e.power||{},input:{type:oi(e.powerInput)}},delete e.powerInput);const t=e.power?.input;if(!t)return;const r=n=>{if(typeof n=="string")return{type:oi(n)};if(n){const{portType:o,type:i,...s}=n,a=!i&&o?o:i;return{...s,type:a?oi(a):[]}}return{type:[]}};e.power.input=Array.isArray(t)?t.map(r):r(t)}function wc(e){!e||typeof e!="object"||Object.values(e).forEach(wa)}function Fl(e){return!!(e&&Object.prototype.hasOwnProperty.call(e,Ei)&&e[Ei])}function Ea(e){if(!e||typeof e!="object")return e;try{Object.defineProperty(e,Ei,{configurable:!0,enumerable:!1,value:!0,writable:!0})}catch{e[Ei]=!0}return e}function Oa(e,t){if(!e||typeof e!="object"||!!!(t&&t.force)&&Fl(e))return e;Object.values(e.cameras||{}).forEach(o=>{o.power?.input&&o.power.input.powerDrawWatts!==void 0&&delete o.power.input.powerDrawWatts,wa(o),Array.isArray(o.power?.batteryPlateSupport)&&(o.power.batteryPlateSupport=o.power.batteryPlateSupport.map(i=>{if(typeof i=="string"){const s=i.match(/([^()]+)(?:\(([^)]+)\))?(?:\s*-\s*(.*))?/),a=s?s[1].trim():i;let c=s&&s[2]?s[2].trim().toLowerCase():"";c?/via adapter/i.test(c)&&(c="adapted"):c=/adapted|via adapter/i.test(i)?"adapted":"native";const u=s&&s[3]?s[3].trim():/via adapter/i.test(i)?"via adapter":"";return{type:a,mount:c,notes:u}}return{type:i.type||"",mount:(i.mount?i.mount:i.native?"native":i.adapted?"adapted":"native").toLowerCase(),notes:i.notes||""}})),o.power&&(o.power.powerDistributionOutputs=gr(o.power.powerDistributionOutputs,{type:"",voltage:"",current:"",wattage:null,notes:""})),o.videoOutputs=gr(o.videoOutputs,{type:"",notes:""}).flatMap(i=>{const{count:s,...a}=i||{},c=Bl(a.type);if(!pd.has(c))return[];const u=parseInt(s,10),f=Number.isFinite(u)&&u>0?u:1,l={...a,type:c,notes:a.notes||""};return Array.from({length:f},()=>({...l}))}),o.fizConnectors=gr(o.fizConnectors,{type:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:Xn(s)}}),o.viewfinder=gr(o.viewfinder,{type:"",resolution:"",connector:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:Gl(s)}}),o.recordingMedia=gr(o.recordingMedia,{type:"",notes:""}).map(i=>{let{type:s="",notes:a=""}=i||{};const c=s.match(/^(.*?)(?:\((.*)\))?$/);return c&&(s=c[1].trim(),a=a||(c[2]?c[2].trim():"")),/^SD UHS-II$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II`:"UHS-II"):/^SD \(UHS-II\/UHS-I\)$/i.test(s)?(s="SD Card",a="UHS-II/UHS-I"):s==="CFast 2.0 card slots"?(s="CFast 2.0",a=a||"Dual Slots"):s==="CFexpress Type B (Dual Slots)"?(s="CFexpress Type B",a=a||"Dual Slots"):s==="CFexpress Type B (via adapter)"?(s="CFexpress Type B",a=a||"via adapter"):/^SD UHS-II \(Dual Slots\)$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II (Dual Slots)`:"UHS-II (Dual Slots)"):s==="SD Card (Dual Slots)"?(s="SD Card",a=a||"Dual Slots"):s==="SD card slot (for proxy/backup)"&&(s="SD Card",a=a||"for proxy/backup"),{type:s,notes:a}}),o.timecode=gr(o.timecode,{type:"",notes:""}),o.lensMount=gr(o.lensMount,{type:"",mount:"native",notes:""}).map(i=>({type:i.type,mount:i.mount?i.mount.toLowerCase():"native",notes:i.notes||""})).filter((i,s,a)=>s===a.findIndex(c=>c.type===i.type&&c.mount===i.mount&&c.notes===i.notes))}),Object.values(e.lenses||{}).forEach(o=>{if(!o||typeof o!="object")return;const i=y=>{if(!y)return null;if(typeof y=="string"){const g=y.trim();return g?{type:g,mount:"native"}:null}const p=typeof y.type=="string"?y.type.trim():"";if(!p)return null;const d=typeof y.mount=="string"?y.mount.trim().toLowerCase():"";return{type:p,mount:d==="adapted"?"adapted":"native"}},s=o.mountOptions,a=[],c=y=>{const p=i(y);p&&a.push(p)};if(Array.isArray(s)?s.forEach(c):s&&typeof s=="object"&&c(s),!a.length&&Array.isArray(o.lensMount)&&(o.lensMount.forEach(c),delete o.lensMount),!a.length){const y=typeof o.mount=="string"?o.mount.trim():"";y&&c({type:y,mount:"native"})}const u=[];a.forEach(y=>{if(!y||!y.type)return;const p=y.mount==="adapted"?"adapted":"native";u.some(g=>g.type===y.type&&g.mount===p)||u.push({type:y.type,mount:p})});const f=Array.isArray(u)?u:[];o.mountOptions=f;const l=Array.isArray(o.mountOptions)?o.mountOptions:[];if(l.length){const y=l.find(d=>d&&d.mount==="native"&&d.type)||l[0],p=y&&y.type?y.type:"";p?o.mount=p:typeof o.mount=="string"&&(o.mount=o.mount.trim())}else typeof o.mount=="string"&&(o.mount=o.mount.trim(),o.mount||delete o.mount)}),["monitors","video","viewfinders"].forEach(o=>{wc(e[o])});const n=e.fiz||{};return["motors","controllers","distance"].forEach(o=>{wc(n[o])}),Object.values(e.fiz?.motors||{}).forEach(o=>{o&&(o.connector&&!o.fizConnector&&(o.fizConnector=o.connector,delete o.connector),o.fizConnector&&(o.fizConnector=Xn(o.fizConnector)))}),Object.values(e.fiz?.controllers||{}).forEach(o=>{if(o)if(o.FIZ_connector&&!o.fizConnector&&!o.fizConnectors&&(o.fizConnector=o.FIZ_connector,delete o.FIZ_connector),Array.isArray(o.fizConnectors))o.fizConnectors=o.fizConnectors.map(i=>{if(!i)return{type:""};const s=Xn(i.type||i),a=i.notes||void 0;return a?{type:s,notes:a}:{type:s}});else if(o.fizConnector){const i=String(o.fizConnector).split(",").map(s=>s.trim()).filter(Boolean);o.fizConnectors=i.map(s=>({type:Xn(s)})),delete o.fizConnector}else o.fizConnectors=[]}),Ea(e),e}function Dl(e){return Oa(e,{force:!0})}Go.cineDeviceNormalization={unifyDevices:Oa,normalizeDevicesForPersistence:Dl,markDevicesNormalized:Ea,hasNormalizedDevicesMarker:Fl,fixPowerInput:wa,normalizeVideoType:Bl,normalizeFizConnectorType:Xn,normalizeViewfinderType:Gl,normalizePowerPortType:oi,ensureList:gr};Go.unifyDevices=Oa;Go.normalizeDevicesForPersistence=Dl;Go.markDevicesNormalized=Ea;Go.cineDeviceNormalization;var Ec={};function Ul(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Mr(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function hd(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function Oc(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}const Kl=(function(){const t=Ul();if(t&&typeof t.__cineDeepClone=="function")return t.__cineDeepClone;const r=hd(t);return r?function(o){if(o===null||typeof o!="object")return o;try{return r(o)}catch{}return Oc(o)}:Oc})();function bd(e){const t=Mr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function Sd(e){const t=Mr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}function wd(e){const t=Mr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleGlobals=="object")return n.cineModuleGlobals}return null}function Ac(e){return null}const Yi=Ul(),Y=bd(Yi),J=Sd(Yi),q=wd(Yi),W=(J&&typeof J.getGlobalScope=="function"?J.getGlobalScope():null)||(Y&&typeof Y.getGlobalScope=="function"?Y.getGlobalScope():null)||Yi;(function(){return q&&typeof q.tryRequire=="function"?q.tryRequire:J&&typeof J.tryRequire=="function"?function(r){const n=J.tryRequire(r);return typeof n>"u"?Ac():n}:Y&&typeof Y.tryRequire=="function"?Y.tryRequire:Ac})();const Cc=(function(){const t=[];function r(o,i){if(typeof o!="function")return;t.some(a=>a&&a.fn===o)||t.push({fn:o,scope:i||null})}if(q&&(typeof q.structuredClone=="function"&&r(q.structuredClone,q),typeof q.getStructuredClone=="function"))try{const o=q.getStructuredClone();r(o,q)}catch{}if(J&&(typeof J.structuredClone=="function"&&r(J.structuredClone,J),typeof J.getStructuredClone=="function"))try{const o=J.getStructuredClone();r(o,J)}catch{}if(Y&&(typeof Y.structuredClone=="function"&&r(Y.structuredClone,Y),typeof Y.getStructuredClone=="function"))try{const o=Y.getStructuredClone();r(o,Y)}catch{}const n=Mr(W);for(let o=0;o<n.length;o+=1){const i=n[o];if(!i||typeof i!="object"&&typeof i!="function")continue;const s=i.structuredClone;typeof s=="function"&&r(s,i)}return t})();let Vo=null;function Ed(e){if(Vo)try{const t=Vo;return{success:!0,value:t.scope?t.fn.call(t.scope,e):t.fn(e)}}catch{Vo=null}for(let t=0;t<Cc.length;t+=1){const r=Cc[t];if(!(!r||typeof r.fn!="function"))try{const n=r.scope?r.fn.call(r.scope,e):r.fn(e);return Vo=r,{success:!0,value:n}}catch{}}return{success:!1,value:null}}function Od(e){if(q&&typeof q.resolveModuleRegistry=="function")try{const r=q.resolveModuleRegistry(e||W);if(r)return r}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const r=J.getModuleRegistry(e||W);if(r)return r}catch{}if(Y&&typeof Y.resolveModuleRegistry=="function")try{return Y.resolveModuleRegistry(e||W)}catch{}if(Ee&&typeof Ee=="object")return Ee;const t=Mr(W);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModules=="object")return n.cineModules}return null}const ii=(function(){if(q&&typeof q.getModuleRegistry=="function")try{const t=q.getModuleRegistry(W);if(t)return t}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const t=J.getModuleRegistry(W);if(t)return t}catch{}if(Y&&typeof Y.getModuleRegistry=="function")try{const t=Y.getModuleRegistry(W);if(t)return t}catch{}return Od()})(),Ad=(function(){return q&&typeof q.queueModuleRegistration=="function"?function(r,n,o,i){try{return q.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:J&&typeof J.queueModuleRegistration=="function"?function(r,n,o){try{const i=J.queueModuleRegistration(r,n,o);return typeof i>"u"?!1:i}catch{return!1}}:Y&&typeof Y.queueModuleRegistration=="function"?function(r,n,o,i){try{return Y.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:function(){return!1}})(),Cd=(function(){return q&&typeof q.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=q.registerOrQueueModule(r,n,o,i,s||W,a||ii);return typeof c>"u"?!1:c}catch{return!1}}:J&&typeof J.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=J.registerOrQueueModule(r,n,o,i,s||W,a||ii);return typeof c>"u"?!1:c}catch{return!1}}:Y&&typeof Y.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{return Y.registerOrQueueModule(r,n,o,i,s||W,a||ii)}catch{return!1}}:function(r,n,o,i){if(typeof i=="function")try{if(typeof window<"u"&&window.cineModuleRegistry&&typeof window.cineModuleRegistry.register=="function")return window.cineModuleRegistry.register(r,n,o),!0;console.warn("Logging module registration deferred - queue unavailable.")}catch{}return!1}})();function _d(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function kd(e){if(!e||typeof e!="object"||_d(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;const t=e.constructor;if(!t)return!1;if(t===Number||t===String||t===Boolean||t===Date||t===RegExp||t===Promise||t===WeakMap||t===WeakSet||t===Map||t===Set)return!0;const r=typeof t.name=="string"?t.name:"";if(r&&/Error|Event|Response|Request|Headers|Node|Element|Window|Document/.test(r))return!0;try{if(typeof e.then=="function"||typeof e.catch=="function"||typeof e.pipe=="function"||typeof e.on=="function"||typeof e.write=="function"||typeof e.read=="function"||typeof e.getReader=="function"||typeof e.getWriter=="function"||typeof e[Symbol.iterator]=="function"&&!Array.isArray(e))return!0;if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const n=e[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port|Process/.test(n))return!0}}catch{}return!1}function Ts(e,t){const r=t||(typeof WeakSet=="function"?new WeakSet:{add(){},has(){return!1}});if(!e||typeof e!="object"||kd(e))return e;if(typeof process<"u"&&process&&Ec&&Ec.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(typeof r.has=="function"&&r.has(e))return e;typeof r.add=="function"&&r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||Ts(s,r)}try{try{return Object.freeze(e)}catch(o){return e}}catch{return e}}const ve=(function(){return q&&typeof q.freezeDeep=="function"?q.freezeDeep:J&&typeof J.freezeDeep=="function"?function(r,n){try{return J.freezeDeep(r,n)}catch{return Ts(r,n)}}:Y&&typeof Y.freezeDeep=="function"?Y.freezeDeep:Ts})();function _c(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Qe=(function(){return q&&typeof q.safeWarn=="function"?q.safeWarn:J&&typeof J.safeWarn=="function"?function(r,n){try{J.safeWarn(r,n)}catch{_c(r,n)}}:Y&&typeof Y.safeWarn=="function"?Y.safeWarn:_c})(),Cn=["debug","info","warn","error","log"],Pt=typeof Symbol=="function"?Symbol.for("cineLoggingConsoleProxyInstalled"):"__cineLoggingConsoleProxyInstalled__",ge=(function(){const t=Object.create(null);if(typeof console>"u"||!console)return t;for(let r=0;r<Cn.length;r+=1){const n=Cn[r];try{const o=console[n];t[n]=typeof o=="function"?o:null}catch{t[n]=null}}return t})();let bt=!1,Aa=!1,Fr=!1,Un=null,Ho=!1,Kn=0;const Pd=(function(){return q&&typeof q.exposeGlobal=="function"?function(r,n,o){try{return q.exposeGlobal(r,n,o)}catch{return!1}}:function(r,n){if(!W||typeof W!="object"&&typeof W!="function")return!1;try{return W[r]=n,!0}catch{return!1}}})();function jd(e,t){if(!(!q||typeof q.recordModule!="function"))try{q.recordModule(e,t)}catch{}}const xt={debug:{priority:10,consoleMethod:"debug"},info:{priority:20,consoleMethod:"info"},warn:{priority:30,consoleMethod:"warn"},error:{priority:40,consoleMethod:"error"}},Id=ve(xt),_n=Object.freeze(Object.keys(xt).concat(["other"]));function zn(){const e=Object.create(null);for(let t=0;t<_n.length;t+=1){const r=_n[t];e[r]=0}return e}function vd(e){if(!(!e||typeof e!="object"))for(let t=0;t<_n.length;t+=1){const r=_n[t];e[r]=0}}function Ld(e){if(typeof e=="string"&&e){if(Object.prototype.hasOwnProperty.call(xt,e))return e;const t=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(xt,t))return t}return"other"}function Ns(e,t){if(!e||typeof e!="object")return 0;const r=e[t];return typeof r=="number"&&Number.isFinite(r)&&r>0?r:0}function Ca(e,t,r){if(!e||typeof e!="object"||typeof r!="number"||!Number.isFinite(r)||r===0)return;const n=Ld(t),i=Ns(e,n)+r;e[n]=i>0?i:0}function $l(e,t,r){if(!(!Array.isArray(t)||!t.length)&&!(typeof r!="number"||!Number.isFinite(r)||r===0))for(let n=0;n<t.length;n+=1){const o=t[n],i=o&&o.level;Ca(e,i,r)}}function Rd(e){const t=zn();return $l(t,e,1),t}function Vl(e,t){if(!(!e||typeof e!="object"||!t||typeof t!="object"))for(let r=0;r<_n.length;r+=1){const n=_n[r],o=Ns(t,n);if(o){const i=Ns(e,n);e[n]=i+o}}}function Hl(e){const t=zn();return Vl(t,e),t}function gn(e){return ve(Hl(e))}const Oi=50,ql=1,Wl=5e3,Ai="__cineLoggingHistory",Ms="__cineLoggingConfig",Td=typeof Symbol=="function"?Symbol.for("cineLoggingHandled"):"__cineLoggingHandled__",yt={level:"warn",historyLevel:"info",historyLimit:1200,consoleOutput:!0,persistSession:!0,captureGlobalErrors:!0,captureConsole:!1,stackTraces:!0},Nd=ve(yt),Md="cine-sw-logs",zd="cine-sw:log-entry",xd="cine-sw:log-state-request",Bd="cine-sw:log-state",kc=5e3,Gd=60*1e3,Fd=200;function Yl(){return{level:yt.level,historyLevel:yt.historyLevel,historyLimit:yt.historyLimit,consoleOutput:yt.consoleOutput,persistSession:yt.persistSession,captureGlobalErrors:yt.captureGlobalErrors,captureConsole:yt.captureConsole,stackTraces:yt.stackTraces}}let L=Yl();const Lt=[],Ci=new Set,_i=new Set,qo=typeof WeakSet=="function"?new WeakSet:[];let Jl=0;const Ql=zn(),Ji=zn(),Xl=zn();let Zl=0,ae=null;const U={initialised:!1,supported:!1,requestInFlight:!1,lastRequestId:null,pollTimer:null,requestTimer:null,broadcastChannel:null,broadcastFailed:!1,seenIds:typeof Set=="function"?new Set:null,fallbackSeenIds:typeof Set!="function"?[]:null,lastSnapshotMeta:null};function Cr(e,t){const r=typeof t=="string"?t:L.level;if(typeof e=="string"){const n=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(xt,n))return n;if(n==="log"||n==="information")return"info";if(n==="warning")return"warn";if(n==="trace"||n==="verbose")return"debug";if(n==="fatal"||n==="critical")return"error"}return Object.prototype.hasOwnProperty.call(xt,r)?r:"info"}function kn(e){const t=Cr(e,"info"),r=xt[t];return r?r.priority:xt.info.priority}function $n(e,t){if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:e>0:!!t;if(typeof e=="string"){const r=e.trim().toLowerCase();if(r==="true"||r==="1"||r==="yes"||r==="on")return!0;if(r==="false"||r==="0"||r==="no"||r==="off")return!1}return typeof t=="boolean"?t:!1}function eu(e,t){const n=!!(t&&t.allowReducedMin===!0)?ql:Oi;if(typeof e=="number"&&Number.isFinite(e)){const o=Math.abs(Math.floor(e));return o?Math.max(n,Math.min(Wl,o)):L.historyLimit}if(typeof e=="string"&&e){const o=Number(e);if(Number.isFinite(o))return eu(o,t)}return L.historyLimit}function mo(e){if(typeof e=="string")return e;if(e instanceof Error)return e.message||e.name||"Error";if(e&&typeof e=="object"){if(typeof e.message=="string")return e.message;const t=e.constructor&&e.constructor.name;if(t)return t}if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e>"u"||e===null)return"";try{return String(e)}catch{}return Object.prototype.toString.call(e)}function ue(e,t,r){const n=typeof t=="number"?t:0,o=r||(typeof WeakSet=="function"?new WeakSet:null);if(e===null||typeof e>"u")return null;const i=typeof e;if(i==="string"||i==="number"||i==="boolean")return e;if(i==="bigint")try{return e.toString()}catch{return"BigInt"}if(i==="symbol")try{return e.toString()}catch{return"Symbol"}if(i==="function")return`[Function${e.name?` ${e.name}`:""}]`;if(e instanceof Date)try{return e.toISOString()}catch{return e.toString()}if(typeof RegExp<"u"&&e instanceof RegExp){try{return e.toString()}catch{}return"[RegExp]"}if(e instanceof Error){const a={name:e.name,message:e.message};if(e.stack&&(a.stack=String(e.stack)),typeof e.code<"u"&&(a.code=e.code),typeof e.status<"u"&&(a.status=e.status),typeof e.cause<"u"&&e.cause!==null&&(a.cause=ue(e.cause,n+1,o)),typeof e.details<"u"&&(a.details=ue(e.details,n+1,o)),typeof e.errors<"u"&&e.errors!==null){const c=[];let f=0;const l=function(d){if(c.length>=10){f+=1;return}try{c.push(ue(d,n+1,o))}catch(g){c.push(g&&g.message?`[Unserializable error: ${g.message}]`:"[Unserializable error]")}},y=e.errors;if(Array.isArray(y)){for(let p=0;p<y.length;p+=1)l(y[p]);y.length>c.length&&(f+=y.length-c.length)}else if(y&&typeof y=="object"){let p=null;try{const d=typeof Symbol=="function"?Symbol.iterator:null;d&&typeof y[d]=="function"&&(p=y[d].call(y))}catch{p=null}if(p&&typeof p.next=="function"){let d=p.next(),g=0;for(;!d.done;){g<10?l(d.value):f+=1,g+=1;try{d=p.next()}catch{f+=1;break}}}else l(y)}else l(y);c.length&&(a.errors=c,f>0&&(a.errorsTruncated=f))}return a}if(i==="object"){if(o)try{if(o.has(e))return"[Circular]";o.add(e)}catch{}if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return{__type:"ArrayBuffer",byteLength:e.byteLength};if(typeof DataView<"u"&&e instanceof DataView)return{__type:"DataView",byteOffset:e.byteOffset,byteLength:e.byteLength};if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(e)){const d=e.constructor&&e.constructor.name,g=32,m=typeof e.length=="number"?e.length:0,b=[],C=Math.min(m,g);for(let _=0;_<C;_+=1)b.push(e[_]);const A={__type:d||"TypedArray",length:m,byteOffset:typeof e.byteOffset=="number"?e.byteOffset:0,byteLength:typeof e.byteLength=="number"?e.byteLength:0};return b.length&&(A.preview=b),m>g&&(A.__truncatedItems=m-g),A}const a=typeof Map=="function"?Map:null;if(a&&e instanceof a){const d=[];let m=0;e.forEach((C,A)=>{m<30&&d.push({key:ue(A,n+1,o),value:ue(C,n+1,o)}),m+=1});const b={__type:"Map",size:typeof e.size=="number"?e.size:m,entries:d};return m>30&&(b.__truncatedEntries=m-30),b}const c=typeof Set=="function"?Set:null;if(c&&e instanceof c){const d=[];let m=0;e.forEach(C=>{m<30&&d.push(ue(C,n+1,o)),m+=1});const b={__type:"Set",size:typeof e.size=="number"?e.size:m,values:d};return m>30&&(b.__truncatedValues=m-30),b}const u=typeof URLSearchParams=="function"?URLSearchParams:null;if(u&&e instanceof u){const d=[],g=typeof e.entries=="function"?e.entries():null;let m=0;if(g&&typeof g.next=="function"){let A=0,_=g.next();for(;!_.done;){if(A<40){const P=_.value||[];d.push({key:ue(P[0],n+1,o),value:ue(P[1],n+1,o)})}A+=1,_=g.next()}A>d.length&&(m=A-d.length)}const b={__type:"URLSearchParams",entries:d};return m>0&&(b.__truncatedEntries=m),b}if(typeof URL=="function"&&e instanceof URL)try{return e.toString()}catch{}if(n>=4){const d=e.constructor&&e.constructor.name;return d?`[${d}]`:Object.prototype.toString.call(e)}if(Array.isArray(e)){const g=[],m=Math.min(e.length,20);for(let b=0;b<m;b+=1)g.push(ue(e[b],n+1,o));return e.length>20&&g.push(`… (${e.length-20} more)`),g}const f={},l=Object.keys(e),y=30,p=Math.min(l.length,y);for(let d=0;d<p;d+=1){const g=l[d];try{f[g]=ue(e[g],n+1,o)}catch(m){f[g]=`[Threw: ${m&&m.message?m.message:"error"}]`}}if(l.length>y&&(f.__truncatedKeys=l.length-y),typeof Object.getOwnPropertySymbols=="function"){const d=Object.getOwnPropertySymbols(e),g=Math.min(d.length,5);for(let m=0;m<g;m+=1){const b=d[m],C=typeof b=="symbol"?b.toString():String(b);try{f[C]=ue(e[b],n+1,o)}catch(A){f[C]=`[Threw: ${A&&A.message?A.message:"error"}]`}}}if(!l.length){const d=e.constructor&&e.constructor.name;d&&(f.__className=d)}return f}const s=Ed(e);if(s.success)return s.value;try{return Kl(e)}catch{}try{return String(e)}catch{}return null}function ki(e){if(typeof e!="string")return null;const t=e.replace(/\r\n?/g,`
`).trim();if(!t)return null;const r=5e3,n=t.length>r,o=n?t.slice(0,r):t,i=t.split(`
`),s=40,a=[];let c=!1;for(let u=0;u<i.length;u+=1){const f=i[u].trim();if(f)if(a.length<s)a.push(f.length>500?`${f.slice(0,500)}…`:f);else{c=!0;break}}return{stack:o,frames:a,truncated:n||c}}function Dd(e){if(!e||typeof e!="object")return null;const t=typeof e.source=="string"&&e.source?e.source:"unknown";let r=null;typeof e.stack=="string"&&e.stack&&(r=ki(e.stack));const n=[];if(Array.isArray(e.frames))for(let s=0;s<e.frames.length&&n.length<40;s+=1){const a=e.frames[s];typeof a=="string"&&a?n.push(a):a!==null&&typeof a<"u"&&n.push(mo(a))}else if(r&&Array.isArray(r.frames))for(let s=0;s<r.frames.length;s+=1)n.push(r.frames[s]);const o=e.truncated===!0||(r?r.truncated===!0:!1)||n.length>0&&n.length>=40,i={source:t,truncated:o};return r&&r.stack?i.stack=r.stack:typeof e.stack=="string"&&e.stack?i.stack=e.stack:i.stack=null,n.length&&(i.frames=n),!i.stack&&(!i.frames||!i.frames.length)?null:ve(i)}function Fo(){const e=Mr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{const n=r.sessionStorage;if(n&&typeof n.getItem=="function"&&typeof n.setItem=="function")return n}catch{}}return null}function tu(){const e=Fo();if(e)try{e.removeItem(Ai)}catch{}}function Ud(){const e=Fo();if(e){if(!L.persistSession){try{e.removeItem(Ms)}catch{}return}try{e.setItem(Ms,JSON.stringify({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces}))}catch(t){console.warn("cineLogging: Unable to persist logging config",t)}}}function _a(){if(!L.persistSession){tu();return}const e=Fo();if(e)try{e.setItem(Ai,JSON.stringify(Lt))}catch(t){if(t&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")){L.persistSession=!1;try{e.removeItem(Ai)}catch{}return}console.warn("cineLogging: Unable to persist log history",t)}}function ka(){const e=L.persistSession===!1?ql:Oi;return Math.max(e,Math.min(Wl,Math.floor(L.historyLimit)))}function Kd(e,t,r){if(!Array.isArray(e)||e.length===0)return null;Zl+=e.length;const n=Rd(e),o=r&&typeof r.source=="string"&&r.source.trim()?r.source.trim():"enforce",i=e[0]||null,s=e[e.length-1]||null,a=Date.now();let c="";try{c=new Date(a).toISOString()}catch{c=String(a)}if(ae=ve({count:e.length,limit:t,source:o,timestamp:a,isoTimestamp:c,oldestEntryId:i&&typeof i.id=="string"?i.id:null,oldestEntryTimestamp:i&&typeof i.timestamp=="number"?i.timestamp:null,oldestEntryIsoTimestamp:i&&typeof i.isoTimestamp=="string"?i.isoTimestamp:null,newestEntryId:s&&typeof s.id=="string"?s.id:null,newestEntryTimestamp:s&&typeof s.timestamp=="number"?s.timestamp:null,newestEntryIsoTimestamp:s&&typeof s.isoTimestamp=="string"?s.isoTimestamp:null,levels:gn(n)}),ge&&typeof ge.warn=="function")try{ge.warn("cineLogging: history trimmed to enforce retention limit",{limit:t,removed:e.length,source:o,levels:Hl(n)})}catch{}return n}function Pa(e){const t=ka();if(Lt.length<=t)return 0;const r=Lt.length-t,n=Lt.splice(0,r);$l(Ji,n,-1);const o=Kd(n,t,e);return o&&Vl(Xl,o),r}function ru(e){return kn(e)>=kn(L.historyLevel)}function nu(e){return L.consoleOutput?kn(e)>=kn(L.level):!1}function ja(e){const t=Cr(e,"info"),r=nu(t),n=ru(t);return ve({level:t,enabled:r||n,console:r,history:n,thresholds:ve({console:Cr(L.level,yt.level),history:Cr(L.historyLevel,yt.historyLevel)})})}function ou(e,t){const r=ja(e);if(!t||typeof t!="object")return r.enabled;const n=t.console!==!1,o=t.history!==!1;return!n&&!o?!1:t.requireAll===!0?!(n&&!r.console||o&&!r.history):!!(n&&r.console||o&&r.history)}function iu(e){return`log-${e}-${Math.random().toString(36).slice(2,10)}`}function su(e){if(e){try{Lt.push(e)}catch{return}Ca(Ji,e.level,1)}}function au(e){su(e),Jl+=1,Pa({source:"append"}),_a(),$d(e)}function $d(e){if(!Ci.size)return;const t=Array.from(Ci);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Qe("cineLogging listener execution failed",o)}}}function Vd(e){const t=typeof e=="number"&&Number.isFinite(e)?Math.max(0,Math.floor(e)):Lt.length;if(!t)return Object.freeze([]);const r=Math.max(0,Lt.length-t),n=Lt.slice(r);return Object.freeze(n.slice())}function Hd(e){if(!_i.size)return;const t=Array.from(_i);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Qe("cineLogging config listener failed",o)}}}function Ia(e){if(!e||typeof e.length!="number")return[];const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}function Ar(e,t){if(!Array.isArray(e))return!1;try{return typeof Object.isExtensible=="function"&&!Object.isExtensible(e)?!1:(e.push(t),!0)}catch{}return!1}function qd(e){return e==="error"?"error":e==="warn"?"warn":e==="info"?"info":"debug"}function cu(e){if(typeof e!="string"||!e)return null;if(Object.prototype.hasOwnProperty.call(ge,e)){const t=ge[e];if(typeof t=="function")return t}if(typeof console<"u"&&console){let t=null;try{t=console[e]}catch{t=null}if(typeof t=="function"&&(!t||!t[Pt]))return t}if((e==="debug"||e==="log")&&typeof ge.log=="function")return ge.log;if(e==="info"){if(typeof ge.info=="function")return ge.info;if(typeof ge.log=="function")return ge.log}if(e==="warn"){if(typeof ge.warn=="function")return ge.warn;if(typeof ge.error=="function")return ge.error}return e==="error"&&typeof ge.error=="function"?ge.error:null}function lu(e,t){const r=cu(e);if(typeof r!="function")return;const n=typeof console<"u"&&console?console:W&&W.console?W.console:null,o=Array.isArray(t)?t:Ia(t);try{return r.apply(n,o)}catch{try{return Function.prototype.apply.call(r,n,o)}catch{}}}function Wd(e,t,r){const n=qd(e),o=Array.isArray(t)?t:Ia(t),i=[];for(let d=0;d<o.length;d+=1){const g=o[d],m=typeof g;if(m==="string")Ar(i,g);else if(m==="number"||m==="boolean")Ar(i,String(g));else if(m==="symbol")try{Ar(i,g.toString())}catch{}}let s=i.join(" ").trim();s||(s=`[console.${e||n}]`);let a=null,c=null;if(o.length)try{a=ue(o),c={arguments:a}}catch{c={arguments:o.slice()}}const u=[],f=Array.isArray(a)?a:null;for(let d=0;d<o.length;d+=1){const g=o[d],m=f?f[d]:null,b=g instanceof Error,C=m&&typeof m=="object"&&m!==null?typeof m.stack=="string"||typeof m.message=="string"||typeof m.name=="string":!1;if(!b&&!C)continue;let A=C?m:null;if(!A)try{A=ue(g)}catch{A=null}!A&&b&&(A={name:g.name||null,message:g.message||mo(g)||null},typeof g.code<"u"&&(A.code=g.code),typeof g.status<"u"&&(A.status=g.status),typeof g.stack=="string"&&g.stack&&(A.stack=g.stack));let _=A;if(_&&typeof _=="object")try{_=Kl(_)}catch{try{_=Object.assign({},_)}catch{_=A}}const P={index:d};if(_&&typeof _=="object")P.value=_,typeof _.name=="string"&&_.name&&(P.name=_.name),typeof _.message=="string"&&_.message&&(P.message=_.message),typeof _.code<"u"&&(P.code=_.code),typeof _.status<"u"&&(P.status=_.status);else if(typeof _<"u"){P.value=_;const w=mo(_);w&&(P.message=w)}else P.value=null;const k=g===null?"null":typeof g;if(k==="object"||k==="function"){const w=g&&g.constructor&&g.constructor.name;P.argumentType=typeof w=="string"&&w?w:k}else P.argumentType=k;const I=b&&typeof g.stack=="string"&&g.stack?ki(g.stack):_&&typeof _=="object"&&typeof _.stack=="string"?ki(_.stack):null;I&&(typeof I.stack=="string"&&(P.stack=I.stack),Array.isArray(I.frames)&&I.frames.length&&(P.frames=I.frames),I.truncated&&(P.stackTruncated=!0)),Ar(u,P)}const l={channel:"console",method:e||"log"};if(r&&typeof r=="object"){const d=Object.keys(r);for(let g=0;g<d.length;g+=1){const m=d[g];try{l[m]=ue(r[m])}catch{l[m]=r[m]}}}if(u.length){c=c||{};const d=[];for(let m=0;m<u.length;m+=1){const b=u[m];d.push(b.index)}c.errors=u,c.errorCount=u.length,c.errorIndices=d,c.primaryError=u[0],l.errorCount=u.length,l.errorIndices=d;const g=u[0];g&&(typeof g.name=="string"&&g.name&&(l.primaryErrorName=g.name),typeof g.message=="string"&&g.message&&(l.primaryErrorMessage=g.message),typeof g.code<"u"&&(l.primaryErrorCode=g.code),typeof g.status<"u"&&(l.primaryErrorStatus=g.status),g.stack&&(l.primaryErrorHasStack=!0))}const y=e==="error"||u.length>0,p={namespace:"console",meta:l};return y&&(p.captureStack=!0),ft(n,s,c,p,{silentConsole:!0})}function Yd(){if(bt)return!0;if(Aa=!0,typeof console>"u"||!console)return Fr=!0,!1;try{if(console[Pt])return bt=!0,Fr=!1,!0}catch{}let e=!1;for(let t=0;t<Cn.length;t+=1){const r=Cn[t];let n=cu(r);if(typeof n!="function")try{const i=console[r];typeof i=="function"&&(!i||!i[Pt])&&(n=i)}catch{n=null}if((!Object.prototype.hasOwnProperty.call(ge,r)||ge[r]===null)&&(ge[r]=typeof n=="function"?n:ge[r]),typeof n!="function")continue;const o=function(){const s=Ia(arguments);Kn+=1;try{if(Kn===1){const a=s.length?s[0]:null;if(!(typeof a=="string"&&a.indexOf("cineLogging:")===0))try{Wd(r,s,{captured:!0})}catch(u){}}return lu(r,s)}finally{Kn-=1,Kn<0&&(Kn=0)}};try{Object.defineProperty(o,Pt,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{o[Pt]=!0}try{console[r]=o,e=!0}catch{}}if(e){bt=!0,Fr=!1;try{Object.defineProperty(console,Pt,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{try{console[Pt]=!0}catch{}}}else Fr=!0;return bt}function Jd(){if(!bt)return!1;if(typeof console>"u"||!console)return bt=!1,!1;let e=!1;for(let t=0;t<Cn.length;t+=1){const r=Cn[t],n=ge[r];try{typeof n=="function"?(console[r]=n,e=!0):r!=="log"&&r!=="info"&&delete console[r]}catch{}}try{console&&console[Pt]&&(typeof Object.defineProperty=="function"?Object.defineProperty(console,Pt,{configurable:!0,enumerable:!1,writable:!0,value:!1}):console[Pt]=!1)}catch{}return bt=!1,e}function va(){return L.captureConsole?Yd()?(Ho=!1,Un!=="enabled"&&(ft("info","Console output capture enabled",ms({status:"enabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Un="enabled"),!0):(Ho||(ft("warn","Console output capture failed",ms({status:"failed",reason:typeof console>"u"||!console?"console-unavailable":"installation-failed"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Qe("cineLogging: Unable to capture console output for diagnostics."),Ho=!0),Un="failed",!1):(bt&&Jd(),Un!=="disabled"&&(ft("info","Console output capture disabled",ms({status:"disabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Un="disabled"),Ho=!1,Fr=!1,!0)}function La(){return!!L.captureConsole&&bt===!0}function ms(e){const t={configured:L.captureConsole===!0,installed:bt===!0,attempted:Aa===!0,failed:Fr===!0};if((typeof console>"u"||!console)&&(t.consoleAvailable=!1),e&&typeof e=="object"){const r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}}return t}function Qd(e){return Ra({captureConsole:!0},(e&&typeof e=="object"?e:null)||void 0),La()}function Xd(e){return Ra({captureConsole:!1},(e&&typeof e=="object"?e:null)||void 0),La()}function Zd(e,t,r){const n=r&&Object.prototype.hasOwnProperty.call(r,"captureStack")?r.captureStack:null;return n===!0?!0:n===!1||L.stackTraces!==!0?!1:t instanceof Error?!0:kn(e)>=kn("warn")}function uu(e,t,r,n){if(!Zd(e,r,n))return null;let o="generated",i="";if(r instanceof Error){const c=r.stack;typeof c=="string"&&c&&(o="detail",i=c)}if(!i)try{const c=typeof t=="string"&&t?t:`Log ${e}`,u=new Error(c);typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(u,uu),typeof u.stack=="string"&&u.stack&&(i=u.stack)}catch{}const s=ki(i);if(!s)return null;const a={source:o,stack:s.stack,truncated:s.truncated};return Array.isArray(s.frames)&&s.frames.length&&(a.frames=s.frames),ve(a)}function ft(e,t,r,n,o){const i=Cr(e,"info"),s=Date.now();let a="";try{a=new Date(s).toISOString()}catch{a=String(s)}const c=n&&typeof n=="object"?n:null,u=uu(i,t,r,c),f=c&&typeof c.namespace=="string"&&c.namespace?n.namespace:null,l=c&&typeof c.meta<"u"?ue(c.meta):null,y=typeof r>"u"?null:ue(r),p=ve({id:iu(s),level:i,message:mo(t),namespace:f,detail:y,meta:l,timestamp:s,isoTimestamp:a,origin:u});Ca(Ql,i,1),ru(i)&&au(p);const d=o&&typeof o=="object"?o:null;if(nu(i)&&(!d||d.silentConsole!==!0)){const m=(xt[i]||xt.info).consoleMethod,b=["[cine]"];f&&b.push(`[${f}]`),b.push(p.isoTimestamp);const A=[`${b.join(" ")} ${p.message}`];r!==void 0?Ar(A,r):p.detail!==null&&Ar(A,p.detail),p.meta!==null&&Ar(A,{meta:p.meta}),u&&Ar(A,{origin:u}),lu(m,A)}return p}function fu(e,t,r){return ft("debug",e,t,r)}function ey(e,t,r){return ft("info",e,t,r)}function ty(e,t,r){return ft("warn",e,t,r)}function ry(e,t,r){return ft("error",e,t,r)}function ho(){return ve({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces})}function ny(e){const t=e&&typeof e.limit<"u"?e.limit:void 0;return Vd(t)}function oy(){return ae?ve({count:typeof ae.count=="number"?ae.count:0,limit:typeof ae.limit=="number"?ae.limit:ka(),source:typeof ae.source=="string"?ae.source:"enforce",timestamp:typeof ae.timestamp=="number"?ae.timestamp:null,isoTimestamp:typeof ae.isoTimestamp=="string"?ae.isoTimestamp:null,oldestEntryId:typeof ae.oldestEntryId=="string"?ae.oldestEntryId:null,oldestEntryTimestamp:typeof ae.oldestEntryTimestamp=="number"?ae.oldestEntryTimestamp:null,oldestEntryIsoTimestamp:typeof ae.oldestEntryIsoTimestamp=="string"?ae.oldestEntryIsoTimestamp:null,newestEntryId:typeof ae.newestEntryId=="string"?ae.newestEntryId:null,newestEntryTimestamp:typeof ae.newestEntryTimestamp=="number"?ae.newestEntryTimestamp:null,newestEntryIsoTimestamp:typeof ae.newestEntryIsoTimestamp=="string"?ae.newestEntryIsoTimestamp:null,levels:ae.levels?gn(ae.levels):gn(zn())}):null}function pu(){return ve({runtimeEntries:Jl,retainedEntries:Lt.length,droppedEntries:Zl,historyLimit:ka(),lastDrop:oy(),levels:ve({emitted:gn(Ql),retained:gn(Ji),dropped:gn(Xl)}),consoleCapture:ve({configured:L.captureConsole===!0,installed:bt,attempted:Aa,failed:Fr})})}function iy(e){return Lt.length=0,vd(Ji),(!e||e.persist!==!1)&&_a(),!0}function sy(e){return typeof e!="function"?function(){return!1}:(Ci.add(e),function(){return Ci.delete(e),!0})}function ay(e){return typeof e!="function"?function(){return!1}:(_i.add(e),function(){return _i.delete(e),!0})}function cy(e,t){if(!e&&!t)return null;if(!e)return ue(t);if(!t)return e;if(typeof e!="object"||typeof t!="object")return ue(t);const r={},n=Object.keys(e);for(let i=0;i<n.length;i+=1){const s=n[i];r[s]=e[s]}const o=Object.keys(t);for(let i=0;i<o.length;i+=1){const s=o[i];r[s]=ue(t[s])}return r}function ly(e,t){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?ue(t.meta):null;function o(i,s,a,c){const u=cy(n,c);return ft(i,s,a,{namespace:r,meta:u})}return ve({namespace:r,log(i,s,a,c){return o(i,s,a,c)},debug(i,s,a){return o("debug",i,s,a)},info(i,s,a){return o("info",i,s,a)},warn(i,s,a){return o("warn",i,s,a)},error(i,s,a){return o("error",i,s,a)},getConfig:ho,isLevelEnabled(i,s){return ou(i,s)},getLevelState(i){return ja(i)}})}function du(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;const t=Td;try{return typeof t=="symbol"?e[t]?!0:(e[t]=!0,!1):Object.prototype.hasOwnProperty.call(e,t)&&e[t]?!0:(Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:!0}),!1)}catch{}return!1}function uy(e){if(!L.captureGlobalErrors||du(e))return;const t={message:e&&typeof e.message=="string"?e.message:"",filename:e&&(e.filename||e.fileName)||null,lineno:e&&(e.lineno||e.lineNumber)||null,colno:e&&(e.colno||e.columnNumber)||null,error:e&&e.error?ue(e.error):null};e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Global error captured",t,{namespace:"global"})}function fy(e){if(!L.captureGlobalErrors||du(e))return;const t={reason:e?ue(e.reason):null};e&&e.promise&&(t.promiseState="[Promise]"),e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Unhandled promise rejection captured",t,{namespace:"global"})}function py(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;if(qo instanceof WeakSet)return qo.has(e)?!0:(qo.add(e),!1);const t=qo;return t.indexOf(e)!==-1?!0:(t.push(e),!1)}function yu(){if(!L.captureGlobalErrors)return;const e=Mr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r.addEventListener!="function")&&!py(r)){try{r.addEventListener("error",uy,!0)}catch{}try{r.addEventListener("unhandledrejection",fy,!0)}catch{}}}}function Qi(e){if(!e||typeof e!="object")return{changed:!1,captureChanged:!1,limitChanged:!1};let t=!1,r=!1,n=!1,o=!1;const i=Object.prototype.hasOwnProperty.call(e,"persistSession")?$n(e.persistSession,L.persistSession):L.persistSession;if(Object.prototype.hasOwnProperty.call(e,"level")){const s=Cr(e.level,L.level);s!==L.level&&(L.level=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLevel")){const s=Cr(e.historyLevel,L.historyLevel);s!==L.historyLevel&&(L.historyLevel=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLimit")){const s=eu(e.historyLimit,{allowReducedMin:i===!1});s!==L.historyLimit&&(L.historyLimit=s,t=!0,n=!0)}if(Object.prototype.hasOwnProperty.call(e,"consoleOutput")){const s=$n(e.consoleOutput,L.consoleOutput);s!==L.consoleOutput&&(L.consoleOutput=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"persistSession")&&i!==L.persistSession&&(L.persistSession=i,t=!0),L.persistSession&&L.historyLimit<Oi&&(L.historyLimit=Oi,t=!0,n=!0),Object.prototype.hasOwnProperty.call(e,"captureGlobalErrors")){const s=$n(e.captureGlobalErrors,L.captureGlobalErrors);s!==L.captureGlobalErrors&&(L.captureGlobalErrors=s,t=!0,r=!0)}if(Object.prototype.hasOwnProperty.call(e,"captureConsole")){const s=$n(e.captureConsole,L.captureConsole);s!==L.captureConsole&&(L.captureConsole=s,t=!0,o=!0)}if(Object.prototype.hasOwnProperty.call(e,"stackTraces")){const s=$n(e.stackTraces,L.stackTraces);s!==L.stackTraces&&(L.stackTraces=s,t=!0)}return{changed:t,captureChanged:r,limitChanged:n,consoleCaptureChanged:o}}function Ra(e,t){const r=L.captureGlobalErrors,n=L.captureConsole,o=Qi(e);return o.limitChanged&&Pa({source:"config"}),o.changed&&(!t||t.persist!==!1)&&(Ud(),_a()),L.persistSession||tu(),!r&&L.captureGlobalErrors&&yu(),(o.consoleCaptureChanged||n!==L.captureConsole)&&va(),o.changed&&Hd(ho()),ho()}function dy(){const e=Mr(W),t=["__cineLoggingConfig","__CINE_LOGGING_CONFIG","cineLoggingConfig"];for(let r=0;r<e.length;r+=1){const n=e[r];if(!(!n||typeof n!="object"&&typeof n!="function"))for(let o=0;o<t.length;o+=1){const i=t[o];let s;try{s=n[i]}catch{s=null}if(s&&typeof s=="object")return s}}return null}function yy(){const e=Fo();if(!e)return;let t="";try{t=e.getItem(Ms)||""}catch{return}if(t)try{const r=JSON.parse(t);Qi(r)}catch(r){Qe("cineLogging: Unable to restore logging config from storage",r)}}function gy(){if(!W||!W.location)return;let e="";try{e=W.location.search||""}catch{return}if(typeof e!="string"||!e)return;let t=null;if(typeof URLSearchParams=="function")try{t=new URLSearchParams(e)}catch{}const r={};let n=!1;function o(i,s){r[i]=s,n=!0}if(t)t.has("cineLogLevel")&&o("level",t.get("cineLogLevel")),t.has("cineLogHistoryLevel")&&o("historyLevel",t.get("cineLogHistoryLevel")),t.has("cineLogLimit")&&o("historyLimit",t.get("cineLogLimit")),t.has("cineLogConsole")&&o("consoleOutput",t.get("cineLogConsole")),t.has("cineLogPersist")&&o("persistSession",t.get("cineLogPersist")),t.has("cineLogCapture")&&o("captureGlobalErrors",t.get("cineLogCapture")),t.has("cineLogConsoleCapture")&&o("captureConsole",t.get("cineLogConsoleCapture")),t.has("cineLogStackTraces")&&o("stackTraces",t.get("cineLogStackTraces"));else{const s=(e.charAt(0)==="?"?e.slice(1):e).split("&");for(let a=0;a<s.length;a+=1){const c=s[a];if(!c)continue;const u=c.indexOf("="),f=decodeURIComponent(u===-1?c:c.slice(0,u)),l=u===-1?"":decodeURIComponent(c.slice(u+1));f==="cineLogLevel"?o("level",l):f==="cineLogHistoryLevel"?o("historyLevel",l):f==="cineLogLimit"?o("historyLimit",l):f==="cineLogConsole"?o("consoleOutput",l):f==="cineLogPersist"?o("persistSession",l):f==="cineLogCapture"?o("captureGlobalErrors",l):f==="cineLogConsoleCapture"?o("captureConsole",l):f==="cineLogStackTraces"&&o("stackTraces",l)}}n&&Qi(r)}function gu(e){if(!e||typeof e!="object")return null;const t=Cr(e.level,"info"),r=typeof e.timestamp=="number"&&Number.isFinite(e.timestamp)?e.timestamp:Date.now();let n="";if(typeof e.isoTimestamp=="string"&&e.isoTimestamp)n=e.isoTimestamp;else try{n=new Date(r).toISOString()}catch{n=String(r)}const o=typeof e.message=="string"?e.message:mo(e.message),i=typeof e.namespace=="string"&&e.namespace?e.namespace:null,s=typeof e.id=="string"&&e.id?e.id:iu(r);return ve({id:s,level:t,message:o,namespace:i,detail:typeof e.detail>"u"?null:ue(e.detail),meta:typeof e.meta>"u"?null:ue(e.meta),timestamp:r,isoTimestamp:n,origin:typeof e.origin>"u"?null:Dd(e.origin)})}function my(){return W&&typeof W.navigator=="object"&&W.navigator?W.navigator:typeof navigator<"u"&&navigator?navigator:typeof globalThis<"u"&&globalThis&&typeof globalThis.navigator=="object"?globalThis.navigator:null}function mu(){const e=my();return!e||typeof e!="object"||!e.serviceWorker?null:e.serviceWorker}function hy(e){return e?U.seenIds?U.seenIds.has(e)?!1:(U.seenIds.add(e),!0):Array.isArray(U.fallbackSeenIds)?U.fallbackSeenIds.indexOf(e)!==-1?!1:(U.fallbackSeenIds.push(e),!0):!0:!0}function by(e,t){const r={};if(e&&typeof e.meta<"u")if(e.meta&&typeof e.meta=="object")for(const o in e.meta)Object.prototype.hasOwnProperty.call(e.meta,o)&&(r[o]=e.meta[o]);else r.value=e.meta;const n=e&&typeof e.channel=="string"&&e.channel?e.channel:r.channel;return n?r.channel=n:r.channel="service-worker",t&&typeof t=="object"&&(t.cacheName&&!r.cacheName&&(r.cacheName=t.cacheName),t.cacheVersion&&!r.cacheVersion&&(r.cacheVersion=t.cacheVersion),typeof t.generatedAt=="number"&&Number.isFinite(t.generatedAt)&&(r.snapshotTimestamp||(r.snapshotTimestamp=t.generatedAt)),typeof t.historyLength=="number"&&Number.isFinite(t.historyLength)&&(r.snapshotSize||(r.snapshotSize=t.historyLength))),r}function Pc(e,t){if(!(!Array.isArray(e)||!e.length))for(let r=0;r<e.length;r+=1){const n=e[r];if(!n||typeof n!="object")continue;const o=typeof n.id=="string"&&n.id?n.id:null;if(!hy(o))continue;const i=n.origin&&typeof n.origin=="object"?n.origin:{runtime:"service-worker"},s=gu({id:o||void 0,level:n.level,message:n.message,namespace:typeof n.namespace=="string"&&n.namespace?n.namespace:"service-worker",detail:typeof n.detail>"u"?null:n.detail,meta:by(n,t),timestamp:n.timestamp,isoTimestamp:n.isoTimestamp,origin:i});s&&au(s)}}function si(e){if(U.requestInFlight&&!(e&&U.lastRequestId&&e!==U.lastRequestId)){if(U.requestInFlight=!1,U.lastRequestId=null,U.requestTimer&&typeof clearTimeout=="function")try{clearTimeout(U.requestTimer)}catch{}U.requestTimer=null}}function Kr(){if(!(U.broadcastChannel||U.broadcastFailed)&&!(U.pollTimer||typeof setTimeout!="function"))try{U.pollTimer=setTimeout(()=>{U.pollTimer=null,hu("poll")},Gd)}catch{}}function Sy(){if(U.broadcastFailed)return null;if(U.broadcastChannel)return U.broadcastChannel;if(typeof BroadcastChannel!="function")return U.broadcastFailed=!0,null;try{const e=new BroadcastChannel(Md);if(e.addEventListener("message",Pi),U.broadcastChannel=e,U.pollTimer&&typeof clearTimeout=="function"){try{clearTimeout(U.pollTimer)}catch(t){}U.pollTimer=null}return e}catch(e){return U.broadcastFailed=!0,Qe("cineLogging: Unable to open service worker diagnostics channel",e),null}}function Pi(e){if(!e)return;let t=null;try{t=e.data||null}catch{t=null}if(!(!t||typeof t!="object")){if(t.type===zd){Pc([t.entry],U.lastSnapshotMeta),Kr();return}if(t.type===Bd){si(t.requestId||null);const r=t.state&&typeof t.state=="object"?t.state:null;if(!r){Kr();return}U.lastSnapshotMeta={cacheName:typeof r.cacheName=="string"&&r.cacheName?r.cacheName:null,cacheVersion:r.cacheVersion||null,generatedAt:typeof r.generatedAt=="number"&&Number.isFinite(r.generatedAt)?r.generatedAt:Date.now(),historyLength:typeof r.historyLength=="number"&&Number.isFinite(r.historyLength)?r.historyLength:null},Pc(r.history,U.lastSnapshotMeta),Kr()}}}function hu(e){if(U.requestInFlight)return;const t=mu();if(!t)return;U.supported=!0;const r=`sw-log-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;U.requestInFlight=!0,U.lastRequestId=r;const n={type:xd,limit:Fd,reason:typeof e=="string"&&e?e:"sync",requestId:r},o=s=>{if(s){try{s.port1.onmessage=null}catch{}if(typeof s.port1.onmessageerror<"u")try{s.port1.onmessageerror=null}catch{}try{s.port1.close()}catch{}try{s.port2.close()}catch{}}},i=t.ready&&typeof t.ready.then=="function"?t.ready.then(s=>s&&s.active||t.controller||null):Promise.resolve(t.controller||null);Promise.resolve(i).then(s=>{const a=t.controller||null,c=s||a;if(!c||typeof c.postMessage!="function"){si(r),Kr();return}let u=!1,f=null;const l=()=>{u||(u=!0,o(f),si(r))},y=()=>{l(),Kr()},p=b=>{l(),Pi(b)},d=()=>{Qe("cineLogging: Service worker diagnostics channel closed before a response was received",{requestId:r}),y()},g=()=>{try{c.postMessage(n)}catch(b){Qe("cineLogging: Unable to post service worker diagnostics request",b),y();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{u||y()},kc)}catch{}};if(!(typeof MessageChannel!="function"||!a?!1:c===a)){g();return}if(f=new MessageChannel,f.port1.onmessage=p,typeof f.port1.onmessageerror<"u"&&(f.port1.onmessageerror=d),typeof f.port1.start=="function")try{f.port1.start()}catch{}try{c.postMessage(n,[f.port2])}catch(b){o(f),f=null,Qe("cineLogging: Unable to request service worker diagnostics",b),g();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{u||d()},kc)}catch{}}).catch(s=>{si(r),Qe("cineLogging: Unable to await service worker for diagnostics",s),Kr()})}function wy(){if(U.initialised)return;U.initialised=!0;const e=mu();if(e){if(U.supported=!0,Sy(),typeof e.addEventListener=="function")try{e.addEventListener("message",Pi)}catch(t){Qe("cineLogging: Unable to attach service worker diagnostics listener",t)}else if(typeof e.onmessage>"u")try{e.onmessage=Pi}catch{}hu("initial-sync"),U.broadcastChannel||Kr()}}function Ey(){if(!L.persistSession)return;const e=Fo();if(!e)return;let t="";try{t=e.getItem(Ai)||""}catch{return}if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;for(let n=0;n<r.length;n+=1){const o=gu(r[n]);o&&su(o)}Pa({source:"restore"})}catch(r){Qe("cineLogging: Unable to restore log history from storage",r)}}function Oy(){L=Yl();const e=dy();e&&Qi(e),yy(),gy()}Oy();Ey();wy();va();L.captureGlobalErrors&&yu();fu("cineLogging initialized",{config:ho(),stats:pu()},{namespace:"logging",meta:{lifecycle:"init"}});const Xi=ve({log:ft,debug:fu,info:ey,warn:ty,error:ry,createLogger:ly,getHistory:ny,getStats:pu,clearHistory:iy,getConfig:ho,setConfig:Ra,getLevelState:ja,isLevelEnabled:ou,subscribe:sy,subscribeConfig:ay,enableConsoleCapture:Qd,disableConsoleCapture:Xd,syncConsoleCapture:va,isConsoleCaptureActive:La,constants:ve({LOG_LEVELS:Id,DEFAULT_CONFIG:Nd})});jd("cineLogging",Xi);const bu={category:"diagnostics",description:"Structured logging utilities for debugging and diagnostics.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},Ay=Cd("cineLogging",Xi,bu,function(e){Qe("Unable to register cineLogging module.",e)},W,ii);Ay||Ad("cineLogging",Xi,bu,W);Pd("cineLogging",Xi,{configurable:!0,enumerable:!1,writable:!1})||Qe("Unable to expose cineLogging globally.");const Dr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;function ji(e){const t=(Dr&&typeof Dr=="object"?Dr:null)||(typeof globalThis<"u"?globalThis:null);if(!t)return null;let r,n=null;try{r=t.console,n=Object.getOwnPropertyDescriptor(t,"console")}catch{r=typeof console<"u"?console:null}if(!r||typeof r!="object")return null;let o=[];Array.isArray(e)?o=e:typeof e=="string"&&e?o=[e]:o=["warn","info"];const i=Object.create(null);for(let u=0;u<o.length;u+=1){const f=o[u];typeof f=="string"&&f&&(i[f]=!0)}const s=Object.keys(i);if(!s.length)return r;const a=Object.create(null);for(let u=0;u<s.length;u+=1){const f=s[u];let l=r[f];try{const y=Object.getOwnPropertyDescriptor(r,f);y&&Object.prototype.hasOwnProperty.call(y,"value")&&(l=y.value)}catch{}if(typeof l=="function")try{a[f]=l.bind(r)}catch{a[f]=l}else a[f]=l}const c=new Proxy(r,{get(u,f,l){return Object.prototype.hasOwnProperty.call(a,f)?a[f]:Reflect.get(u,f,l)},set(u,f,l,y){if(Object.prototype.hasOwnProperty.call(a,f))return a[f]=l,!0;try{return Reflect.set(u,f,l,y),!0}catch{}return!1},defineProperty(u,f,l){return Object.prototype.hasOwnProperty.call(a,f)?(l&&Object.prototype.hasOwnProperty.call(l,"value")&&(a[f]=l.value),!0):Reflect.defineProperty(u,f,l)},getOwnPropertyDescriptor(u,f){return Object.prototype.hasOwnProperty.call(a,f)?{configurable:!0,enumerable:!0,writable:!0,value:a[f]}:Reflect.getOwnPropertyDescriptor(u,f)},ownKeys(u){const f=Reflect.ownKeys(u);for(let l=0;l<s.length;l+=1)f.indexOf(s[l])===-1&&f.push(s[l]);return f}});try{Object.defineProperty(t,"console",{configurable:!0,enumerable:n?n.enumerable!==!1:!0,writable:!0,value:c})}catch{t.console=c}return c}if(Dr&&typeof Dr=="object")try{typeof Dr.__cineEnsureConsoleMethodsWritable!="function"&&(Dr.__cineEnsureConsoleMethodsWritable=ji)}catch{}const Cy=Object.freeze(Object.defineProperty({__proto__:null,ensureConsoleMethodsWritable:ji},Symbol.toStringTag,{value:"Module"}));function _y(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const nr=_y();function ky(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const we=ky(nr),Py=we&&typeof we.freezeDeep=="function"?we.freezeDeep:function(t){return t},Su=e=>{try{return Py(e)}catch{return e}};function jc(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return e&&r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}const jy=we&&typeof we.collectCandidateScopes=="function"?function(t){try{const r=we.collectCandidateScopes(t,nr);if(Array.isArray(r)&&r.length)return r}catch{}return jc(t||nr)}:jc;function Iy(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const zs=we&&typeof we.safeWarn=="function"?we.safeWarn:Iy;function vy(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=null;try{t=e.cineLogging||null}catch{t=null}return t&&typeof t=="object"?t:null}function wu(e={}){const t=e.baseScope||nr;e.allowRequire;const r=jy(t);for(let n=0;n<r.length;n+=1){const o=vy(r[n]);if(o)return o}return null}function Sr(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const o=[];t.set(e,o);for(let i=0;i<e.length;i+=1)o[i]=Sr(e[i],t);return o}const r={};t.set(e,r);const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=Sr(e[i],t)}return r}function Ly(e,t){if(!e&&!t)return null;if(!e)return Sr(t);if(!t)return Sr(e);if(typeof e!="object"||typeof t!="object")return Sr(t);const r=Sr(e),n=Object.keys(t);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=Sr(t[i])}return r}function Ry(e){if(typeof console>"u"||!console)return null;const t=typeof e=="string"?e.toLowerCase():"";return t==="error"&&typeof console.error=="function"?console.error.bind(console):t==="warn"&&typeof console.warn=="function"?console.warn.bind(console):t==="info"&&typeof console.info=="function"?console.info.bind(console):t==="debug"&&typeof console.debug=="function"?console.debug.bind(console):typeof console.log=="function"?console.log.bind(console):null}let Ic=!1;function Eu(e,t={}){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?Sr(t.meta):null;function o(s,a,c,u){const f=Ry(s);if(!f)return null;const l=["[cine-fallback]"];r&&l.push(`[${r}]`);const y=new Date;try{l.push(y.toISOString())}catch{l.push(String(y.getTime()))}const g=[`${l.join(" ")} ${typeof a=="string"&&a?a:"Log entry"}`];typeof c<"u"&&g.push(c);const m=Ly(n,u);m&&g.push({meta:m,source:"console-fallback"});try{f(...g)}catch{}if(!Ic&&typeof console<"u"&&typeof console.warn=="function"){Ic=!0;try{console.warn("[cine-fallback] Structured logging unavailable, using console logger.")}catch{}}return null}return Su({namespace:r,log(s,a,c,u){return o(s,a,c,u)},debug(s,a,c){return o("debug",s,a,c)},info(s,a,c){return o("info",s,a,c)},warn(s,a,c){return o("warn",s,a,c)},error(s,a,c){return o("error",s,a,c)},getConfig(){return null},isLevelEnabled(){return!0},getLevelState(s){return{level:typeof s=="string"&&s?s:"all",enabled:!0,source:"console-fallback"}},__cineLoggingFallback:!0})}function Ty(e,t={}){const r=wu(t),n=t&&typeof t.meta<"u"?t.meta:void 0;if(r&&typeof r.createLogger=="function")try{const o=r.createLogger(e,typeof n<"u"?{meta:n}:void 0);if(o)return o}catch(o){zs("cineLoggingResolver: createLogger failed, falling back to console.",o)}return t.allowConsoleFallback===!1?null:Eu(e,{meta:n})}const $r=Su({resolveLogging:wu,resolveLogger:Ty,createConsoleFallbackLogger:Eu}),Ny=we&&typeof we.resolveModuleRegistry=="function"?we.resolveModuleRegistry(nr):null;if(we&&typeof we.registerOrQueueModule=="function"&&!we.registerOrQueueModule("cineLoggingResolver",$r,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0,connections:["cineLogging","cineModuleBase","cineEnvironmentBridge"]},t=>{zs("Unable to register cineLoggingResolver module.",t)},nr,Ny)&&typeof we.queueModuleRegistration=="function")try{we.queueModuleRegistration("cineLoggingResolver",$r,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0},nr)}catch(t){zs("Unable to queue cineLoggingResolver registration.",t)}if(we&&typeof we.exposeGlobal=="function")we.exposeGlobal("cineLoggingResolver",$r,nr,{configurable:!0,enumerable:!1,writable:!1});else try{nr.cineLoggingResolver=$r}catch{}function My(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const _r=My(),ht=typeof cineModuleBase=="object"&&cineModuleBase||(_r&&typeof _r.cineModuleBase=="object"?_r.cineModuleBase:null),Ir=ht&&typeof ht.safeWarn=="function"?ht.safeWarn:function(t,r){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof r>"u"?console.warn(t):console.warn(t,r)}catch{}},Ta="cameraPowerPlanner_contacts";function Ou(e){const t=e||_r;try{if(t&&typeof t.localStorage<"u")return t.localStorage}catch(r){Ir("cine.features.contacts could not access localStorage.",r)}return null}function Au(){return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function qt(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return qt(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Cu(e){if(!e||typeof e!="object")return null;const t=qt(e.id)||Au(),r=qt(e.name),n=qt(e.role),o=qt(e.phone),i=qt(e.email),s=qt(e.website||e.url),a=qt(e.notes||e.note||e.text),c=typeof e.avatar=="string"&&e.avatar.startsWith("data:")?e.avatar:"",u=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),f=Number.isFinite(e.updatedAt)?e.updatedAt:u,l={id:t,name:r,role:n,phone:o,email:i,website:s,notes:a,createdAt:u,updatedAt:f};return c&&(l.avatar=c),l}function _u(e){return(Array.isArray(e)?e.filter(Boolean):[]).map(Cu).filter(Boolean).sort((t,r)=>{const n=(t&&t.name?t.name:"").toLowerCase(),o=(r&&r.name?r.name:"").toLowerCase();if(n&&o&&n!==o)try{return n.localeCompare(o)}catch(i){Ir("cine.features.contacts could not sort contacts by locale.",i)}return n&&!o?-1:!n&&o?1:(t&&t.createdAt?t.createdAt:0)-(r&&r.createdAt?r.createdAt:0)})}function zy(e={}){const t=Ou(e.scope);if(!t||typeof t.getItem!="function")return[];const r=typeof e.storageKey=="string"&&e.storageKey?e.storageKey:Ta;try{const n=t.getItem(r);if(!n)return[];const o=JSON.parse(n);return Array.isArray(o)?_u(o):[]}catch(n){return Ir("cine.features.contacts could not load contacts from storage.",n),[]}}function xy(e,t={}){const r=Ou(t.scope);if(!r||typeof r.setItem!="function")return!1;const n=typeof t.storageKey=="string"&&t.storageKey?t.storageKey:Ta;try{return r.setItem(n,JSON.stringify(Array.isArray(e)?e:[])),!0}catch(o){return Ir("cine.features.contacts could not save contacts to storage.",o),!1}}const Pn=Object.freeze({CONTACTS_STORAGE_KEY:Ta,generateContactId:Au,sanitizeContactValue:qt,normalizeContactEntry:Cu,sortContacts:_u,loadStoredContacts:zy,saveContactsToStorage:xy});if(ht&&typeof ht.registerOrQueueModule=="function")try{ht.registerOrQueueModule("cine.features.contacts",Pn,{category:"features",description:"Shared helpers for contacts management.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cinePersistence"]},e=>Ir("Unable to register cine.features.contacts module.",e),_r,ht.getModuleRegistry&&ht.getModuleRegistry(_r))}catch(e){Ir("cine.features.contacts registration failed.",e)}let ku=!1;if(ht&&typeof ht.exposeGlobal=="function")try{ht.exposeGlobal("cineFeaturesContacts",Pn,_r,{configurable:!0,enumerable:!1,writable:!1}),ku=!0}catch(e){Ir("cine.features.contacts could not expose global api.",e)}if(!ku)try{_r.cineFeaturesContacts=Pn}catch(e){Ir("cine.features.contacts could not assign global api.",e)}const yb=Object.freeze(Object.defineProperty({__proto__:null,default:Pn},Symbol.toStringTag,{value:"Module"}));class Pu{async init(){throw new Error('Method "init()" must be implemented.')}async getItem(t){throw new Error('Method "getItem()" must be implemented.')}async setItem(t,r){throw new Error('Method "setItem()" must be implemented.')}async removeItem(t){throw new Error('Method "removeItem()" must be implemented.')}async clear(){throw new Error('Method "clear()" must be implemented.')}async getKeys(){throw new Error('Method "getKeys()" must be implemented.')}}class ju extends Pu{constructor(){super(),this.storage=window.localStorage}async init(){if(!this.storage)throw new Error("LocalStorage is not supported in this environment.");return Promise.resolve()}async getItem(t){try{const r=this.storage.getItem(t);if(r===null)return null;try{return JSON.parse(r)}catch{return r}}catch(r){return console.warn(`[LocalStorageAdapter] Failed to get item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r);this.storage.setItem(t,n)}catch(n){throw console.error(`[LocalStorageAdapter] Failed to save item: ${t}`,n),n}}async removeItem(t){try{this.storage.removeItem(t)}catch(r){console.warn(`[LocalStorageAdapter] Failed to remove item: ${t}`,r)}}async clear(){try{this.storage.clear()}catch(t){console.warn("[LocalStorageAdapter] Failed to clear storage",t)}}async getKeys(){return Object.keys(this.storage)}}class Iu{constructor(){this.userId=null,this.deviceId=null,this.sessionId=null,this.storageKey="cine_user_uuid",this.deviceStorageKey="cine_device_uuid"}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})}init(){if(this.userId&&this.deviceId&&this.sessionId)return this.userId;let t=localStorage.getItem(this.storageKey);t?console.log("[UserContext] Loaded User UUID:",t):(t=this.generateUUID(),localStorage.setItem(this.storageKey,t),console.log("[UserContext] Generated new User UUID:",t)),this.userId=t;let r=localStorage.getItem(this.deviceStorageKey);return r||(r=this.generateUUID(),localStorage.setItem(this.deviceStorageKey,r),console.log("[UserContext] Generated new Device UUID:",r)),this.deviceId=r,this.sessionId=this.generateUUID(),console.log("[UserContext] Session UUID:",this.sessionId),t}getUserId(){return this.userId?this.userId:this.init()}getDeviceId(){return this.deviceId||this.init(),this.deviceId}getSessionId(){return this.sessionId||this.init(),this.sessionId}getScopedKey(t){return`user_${this.getUserId()}_${t}`}getIdentity(){return{userId:this.getUserId(),deviceId:this.getDeviceId(),sessionId:this.getSessionId()}}reset(){localStorage.removeItem(this.storageKey),this.userId=null,this.sessionId=null}}const xe=new Iu,By=Object.freeze(Object.defineProperty({__proto__:null,UserContext:Iu,userContext:xe},Symbol.toStringTag,{value:"Module"})),vu=1,Xr=Object.freeze({SYNCED:"synced",PENDING:"pending",CONFLICT:"conflict",SYNCING:"syncing",LOCAL_ONLY:"local_only"}),De=Object.freeze({UNLOCKED:"unlocked",LOCKED_BY_SELF:"locked_by_self",LOCKED_BY_OTHER_TAB:"locked_by_other_tab",LOCKED_BY_OTHER_DEVICE:"locked_by_other_device"});function Na(){return new Date().toISOString()}function Gy(e="doc"){const t=Date.now().toString(36),r=Math.random().toString(36).substring(2,10);return`${e}_${t}_${r}`}function Lu(e={}){const t=xe.getIdentity(),r=Na();return{version:vu,docId:e.docId||Gy(e.docType||"doc"),docType:e.docType||"unknown",ownerId:t.userId,createdAt:r,updatedAt:r,syncStatus:Xr.LOCAL_ONLY,syncedAt:null,syncError:null,changeCount:1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId,lock:null,sharedWith:[],permissions:{}}}function Fy(e){if(!e||typeof e!="object")return Lu();const t=xe.getIdentity(),r=Na();return{...e,version:vu,updatedAt:r,syncStatus:e.syncStatus===Xr.SYNCED?Xr.PENDING:e.syncStatus,changeCount:(e.changeCount||0)+1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId}}function Dy(e,t=null){return!e||typeof e!="object"?(console.warn("[SyncMetadata] Cannot mark null metadata as synced"),e):{...e,syncStatus:Xr.SYNCED,syncedAt:t||Na(),syncError:null}}function Uy(e,t){return!e||typeof e!="object"?e:{...e,syncStatus:Xr.CONFLICT,syncError:t}}function Ky(e,t=null,r={}){return{_meta:t?Fy(t):Lu(r),data:e}}function $y(e){return!e||typeof e!="object"?{data:e,meta:null}:e._meta&&"data"in e?{data:e.data,meta:e._meta}:{data:e,meta:null}}function Wo(e){return e&&typeof e=="object"&&"_meta"in e&&"data"in e}const Vy="cine-project-locks",Hy=5e3,qy=3e4,hs="cine_project_lock_",pr=Object.freeze({LOCK_ACQUIRED:"lock_acquired",LOCK_RELEASED:"lock_released",LOCK_HEARTBEAT:"lock_heartbeat",LOCK_TAKEOVER:"lock_takeover",LOCK_QUERY:"lock_query",LOCK_STATUS:"lock_status"});class Wy{constructor(){this.channel=null,this.localLocks=new Map,this.heartbeatIntervals=new Map,this.lockChangeListeners=new Set,this.initialized=!1}init(){if(!this.initialized){if(xe.init(),typeof BroadcastChannel<"u")try{this.channel=new BroadcastChannel(Vy),this.channel.onmessage=t=>this._handleChannelMessage(t),console.log("[ProjectLockService] BroadcastChannel initialized")}catch(t){console.warn("[ProjectLockService] BroadcastChannel not available:",t)}this._restoreLocksFromStorage(),typeof window<"u"&&(window.addEventListener("beforeunload",()=>this._handlePageUnload()),window.addEventListener("pagehide",()=>this._handlePageUnload())),this.initialized=!0,console.log("[ProjectLockService] Initialized")}}async acquireLock(t,r={}){this.init();const n=this._getStoredLock(t),o=this._getLockStatusForLock(n);if(o===De.LOCKED_BY_SELF)return{success:!0,status:o,lock:n};if(o!==De.UNLOCKED&&!r.force)return{success:!1,status:o,lock:n};r.force&&n&&this._broadcastTakeover(t,n);const i=this._createLockObject(t);return this._storeLock(t,i),this.localLocks.set(t,i),this._startHeartbeat(t),this._broadcastLockAcquired(t,i),this._notifyListeners(t,De.LOCKED_BY_SELF,i),console.log("[ProjectLockService] Lock acquired:",t),{success:!0,status:De.LOCKED_BY_SELF,lock:i}}async releaseLock(t){this.init();const r=this._getStoredLock(t);return this._getLockStatusForLock(r)!==De.LOCKED_BY_SELF?(console.warn("[ProjectLockService] Cannot release lock not owned by this session"),!1):(this._stopHeartbeat(t),this._clearStoredLock(t),this.localLocks.delete(t),this._broadcastLockReleased(t),this._notifyListeners(t,De.UNLOCKED,null),console.log("[ProjectLockService] Lock released:",t),!0)}getLockInfo(t){this.init();const r=this._getStoredLock(t),n=this._getLockStatusForLock(r);return{status:n,lock:r,isEditable:n===De.UNLOCKED||n===De.LOCKED_BY_SELF}}subscribe(t){return this.lockChangeListeners.add(t),()=>this.lockChangeListeners.delete(t)}refreshHeartbeat(t){const r=this.localLocks.get(t);if(!r)return;const n=xe.getIdentity();if(r.sessionId!==n.sessionId){this._stopHeartbeat(t);return}r.heartbeat=new Date().toISOString(),this._storeLock(t,r),this._broadcastHeartbeat(t,r)}_createLockObject(t){const r=xe.getIdentity(),n=new Date().toISOString();return{projectId:t,userId:r.userId,deviceId:r.deviceId,sessionId:r.sessionId,acquiredAt:n,heartbeat:n}}_getStorageKey(t){return hs+t}_storeLock(t,r){try{localStorage.setItem(this._getStorageKey(t),JSON.stringify(r))}catch(n){console.warn("[ProjectLockService] Failed to store lock:",n)}}_getStoredLock(t){try{const r=localStorage.getItem(this._getStorageKey(t));if(!r)return null;const n=JSON.parse(r);return this._isLockExpired(n)?(this._clearStoredLock(t),null):n}catch(r){return console.warn("[ProjectLockService] Failed to read lock:",r),null}}_clearStoredLock(t){try{localStorage.removeItem(this._getStorageKey(t))}catch(r){console.warn("[ProjectLockService] Failed to clear lock:",r)}}_isLockExpired(t){return!t||!t.heartbeat?!0:Date.now()-new Date(t.heartbeat).getTime()>qy}_getLockStatusForLock(t){if(!t||this._isLockExpired(t))return De.UNLOCKED;const r=xe.getIdentity();return t.sessionId===r.sessionId?De.LOCKED_BY_SELF:t.deviceId===r.deviceId?De.LOCKED_BY_OTHER_TAB:De.LOCKED_BY_OTHER_DEVICE}_startHeartbeat(t){this._stopHeartbeat(t);const r=setInterval(()=>{this.refreshHeartbeat(t)},Hy);this.heartbeatIntervals.set(t,r)}_stopHeartbeat(t){const r=this.heartbeatIntervals.get(t);r&&(clearInterval(r),this.heartbeatIntervals.delete(t))}_restoreLocksFromStorage(){const t=xe.getIdentity();try{for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(!n||!n.startsWith(hs))continue;const o=n.slice(hs.length),i=this._getStoredLock(o);i&&i.sessionId===t.sessionId&&(this.localLocks.set(o,i),this._startHeartbeat(o),console.log("[ProjectLockService] Restored lock:",o))}}catch(r){console.warn("[ProjectLockService] Failed to restore locks:",r)}}_handlePageUnload(){for(const t of this.localLocks.keys())this._stopHeartbeat(t),this._clearStoredLock(t),this._broadcastLockReleased(t);this.localLocks.clear()}_notifyListeners(t,r,n){for(const o of this.lockChangeListeners)try{o(t,r,n)}catch(i){console.warn("[ProjectLockService] Listener error:",i)}}_broadcast(t,r){if(this.channel)try{this.channel.postMessage({type:t,...r})}catch(n){console.warn("[ProjectLockService] Broadcast failed:",n)}}_broadcastLockAcquired(t,r){this._broadcast(pr.LOCK_ACQUIRED,{projectId:t,lock:r})}_broadcastLockReleased(t){this._broadcast(pr.LOCK_RELEASED,{projectId:t})}_broadcastHeartbeat(t,r){this._broadcast(pr.LOCK_HEARTBEAT,{projectId:t,lock:r})}_broadcastTakeover(t,r){this._broadcast(pr.LOCK_TAKEOVER,{projectId:t,oldLock:r})}_handleChannelMessage(t){const{type:r,projectId:n,lock:o,oldLock:i}=t.data||{};if(!n)return;const s=xe.getIdentity();switch(r){case pr.LOCK_ACQUIRED:o&&o.sessionId!==s.sessionId&&this._notifyListeners(n,this._getLockStatusForLock(o),o);break;case pr.LOCK_RELEASED:this._notifyListeners(n,De.UNLOCKED,null);break;case pr.LOCK_TAKEOVER:i&&i.sessionId===s.sessionId&&(console.warn("[ProjectLockService] Lock taken over by another tab:",n),this._stopHeartbeat(n),this.localLocks.delete(n),this._notifyListeners(n,De.LOCKED_BY_OTHER_TAB,null));break;case pr.LOCK_HEARTBEAT:o&&o.sessionId!==s.sessionId&&this._storeLock(n,o);break}}destroy(){for(const t of this.heartbeatIntervals.keys())this._stopHeartbeat(t);this.channel&&(this.channel.close(),this.channel=null),this.localLocks.clear(),this.lockChangeListeners.clear(),this.initialized=!1}}const nn=new Wy,Vn="cine_project:";class Yy{constructor(){this.driver=new ju,this.initialized=!1}async init(){this.initialized||(await this.driver.init(),console.log("[StorageRepository] Initialized with default driver:",this.driver.constructor.name),this.initialized=!0,nn.init())}async switchDriver(t){console.log("[StorageRepository] Switching driver to:",t.constructor.name),await t.init(),this.driver=t}async getItem(t){this.initialized||await this.init();const r=xe.getScopedKey(t);return this.driver.getItem(r)}async setItem(t,r){this.initialized||await this.init();const n=xe.getScopedKey(t);return this.driver.setItem(n,r)}async removeItem(t){this.initialized||await this.init();const r=xe.getScopedKey(t);return this.driver.removeItem(r)}async clear(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${xe.getUserId()}_`,n=t.filter(o=>o.startsWith(r)).map(o=>this.driver.removeItem(o));await Promise.all(n)}async getKeys(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${xe.getUserId()}_`;return t.filter(n=>n.startsWith(r)).map(n=>n.slice(r.length))}getProjectKeyPrefix(){return Vn}getProjectStorageKey(t){return`${Vn}${t}`}getProjectKeyFromStorageKey(t){return typeof t!="string"||!t.startsWith(Vn)?t:t.slice(Vn.length)}isProjectStorageKey(t){return typeof t=="string"&&t.startsWith(Vn)}async getProjectKeys(){return(await this.getKeys()).filter(r=>this.isProjectStorageKey(r)).map(r=>this.getProjectKeyFromStorageKey(r))}async loadProject(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return $y(n)}async loadProjectRaw(t){return(await this.loadProject(t)).data}async saveProject(t,r,n=null){this.initialized||await this.init();const o=nn.getLockInfo(t);if(!o.isEditable)return console.warn("[StorageRepository] Cannot save - project is locked by another session"),{success:!1,error:"PROJECT_LOCKED",lockInfo:o};const i=Ky(r,n,{docType:"project",docId:t}),s=this.getProjectStorageKey(t);return await this.setItem(s,i),gl(async()=>{const{dataVault:a}=await Promise.resolve().then(()=>Xy);return{dataVault:a}},void 0).then(({dataVault:a})=>{a&&a.saveSnapshot(t,i).catch(c=>console.warn("Auto-backup failed",c))}),console.log("[StorageRepository] Project saved with metadata:",t),{success:!0,meta:i._meta}}async getProjectMeta(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return Wo(n)?n._meta:null}async markProjectSynced(t,r=null){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return Wo(o)?(o._meta=Dy(o._meta,r),await this.setItem(n,o),!0):(console.warn("[StorageRepository] Cannot mark as synced - no metadata"),!1)}async markProjectConflict(t,r){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return Wo(o)?(o._meta=Uy(o._meta,r),await this.setItem(n,o),!0):!1}async getPendingSyncProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const o=await this.getProjectMeta(n);o&&(o.syncStatus===Xr.PENDING||o.syncStatus===Xr.LOCAL_ONLY)&&r.push({key:n,meta:o})}return r}async listProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const{data:o,meta:i}=await this.loadProject(n);i&&i.docType==="project"&&r.push({key:n,data:o,meta:i})}return r}async acquireProjectLock(t,r={}){return this.initialized||await this.init(),nn.acquireLock(t,r)}async releaseProjectLock(t){return nn.releaseLock(t)}getProjectLockInfo(t){return nn.getLockInfo(t)}onLockChange(t){return nn.subscribe(t)}async removeProject(t){const r=this.getProjectStorageKey(t);return this.removeItem(r)}async migrateUnprefixedProjectRecords({projectIndexKeys:t=[]}={}){this.initialized||await this.init();const r=await this.getKeys(),n=new Set(r.filter(a=>this.isProjectStorageKey(a))),o=new Set;(Array.isArray(t)?t:[]).forEach(a=>{const c=this.getProjectKeyFromStorageKey(a);typeof c=="string"&&c&&o.add(c)});for(const a of r){if(this.isProjectStorageKey(a)||o.has(a))continue;const c=await this.getItem(a);Wo(c)&&c._meta&&c._meta.docType==="project"&&o.add(a)}const s=[];for(const a of o){if(typeof a!="string"||!a)continue;const c=this.getProjectStorageKey(a);if(n.has(c))continue;const u=await this.getItem(a);if(u!=null)try{await this.setItem(c,u),await this.removeItem(a),n.add(c),s.push(a)}catch(f){console.warn(`[StorageRepository] Failed to migrate project key "${a}"`,f)}}return{migratedKeys:s}}}const O=new Yy;class xs extends Pu{constructor(){super(),this.name="IndexedDBAdapter"}async init(){try{if(typeof indexedDB>"u")throw new Error("IndexedDB is not supported in this environment.");return Promise.resolve()}catch(t){throw console.warn("IndexedDB initialization failed:",t),t}}async getItem(t){try{const r=await bp(t);if(r==null)return null;let n=ks.decompressFromUTF16(r);const o=n!==null?n:r;try{return JSON.parse(o)}catch{return o}}catch(r){return console.warn(`[IndexedDBAdapter] Failed to get/decompress item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r),o=ks.compressToUTF16(n);await Sp(t,o)}catch(n){throw console.error(`[IndexedDBAdapter] Failed to compress/save item: ${t}`,n),n}}async removeItem(t){return wp(t)}async clear(){return Ep()}async getKeys(){return Op()}}const Hn="cine_storage_migrated_v2";class Jy{constructor(){this.localStorage=new ju,this.indexedDB=new xs}async runMigrationIfNeeded(){try{if(await this.localStorage.init(),await this.indexedDB.init(),await this.localStorage.getItem(Hn)==="true")return console.log("[MigrationService] Storage already migrated to IndexedDB."),!1;console.log("[MigrationService] Starting storage migration...");const r=await this.localStorage.getKeys();if(r.length===0)return console.log("[MigrationService] No local storage data found. safe to skip."),await this.markAsMigrated(),!1;const n=r.filter(i=>i!==Hn&&i!=="cine_user_uuid");let o;try{if(o=(await gl(()=>Promise.resolve().then(()=>By),void 0)).userContext,!o)throw new Error("UserContext module loaded but userContext export is missing");o.init()}catch(i){return console.error("[MigrationService] Failed to load UserContext for scoping. Aborting migration to prevent data loss.",i),!1}for(const i of n)try{const s=await this.localStorage.getItem(i);if(s!==null){const a=o.getScopedKey(i);await this.indexedDB.setItem(a,s),console.log(`[MigrationService] Migrated key: ${i} -> ${a}`)}}catch(s){console.error(`[MigrationService] Failed to migrate key: ${i}`,s)}return await this.markAsMigrated(),console.log("[MigrationService] Migration complete. IndexedDB is now the primary storage."),!0}catch(t){return console.error("[MigrationService] Critical migration failure:",t),!1}}async markAsMigrated(){const t=async(r,n)=>{try{await r.setItem(Hn,"true")}catch(o){console.warn(`[MigrationService] Failed to set migration flag in ${n}:`,o)}};await Promise.all([t(this.localStorage,"LocalStorage"),t(this.indexedDB,"IndexedDB")])}async isMigrated(){try{return await this.localStorage.getItem(Hn)==="true"?!0:await this.indexedDB.getItem(Hn)==="true"}catch(t){return console.warn("[MigrationService] Failed to check migration status:",t),!1}}}const Ht=new Jy,vc="cameraPowerPlanner_ownGear";class Qy{constructor(){this.memoryCache=null}async getOwnGear(){if(this.memoryCache)return this.memoryCache;try{const t=await O.getItem(vc);if(!t)return[];Array.isArray(t)?this.memoryCache=t:t.items&&Array.isArray(t.items)?this.memoryCache=t.items:this.memoryCache=[]}catch(t){console.warn("[GearRepository] Failed to load own gear:",t),this.memoryCache=[]}return this.memoryCache}async saveOwnGear(t){if(!Array.isArray(t)){console.error("[GearRepository] saveOwnGear expects an array");return}this.memoryCache=t,await O.setItem(vc,t)}async addOwnGearItem(t){const r=await this.getOwnGear();r.push(t),await this.saveOwnGear(r)}getLibrary(){return typeof window<"u"&&window.deviceLibrary?window.deviceLibrary:typeof globalThis<"u"&&globalThis.deviceLibrary?globalThis.deviceLibrary:{}}async searchGear(t){if(!t)return[];const r=t.toLowerCase();return(await this.getOwnGear()).filter(i=>i.name&&i.name.toLowerCase().includes(r)||i.brand&&i.brand.toLowerCase().includes(r))}}const Ru=new Qy;class Tu{constructor(){this.root=null,this.initialized=!1}async init(){if(!this.initialized)try{if(!navigator.storage||!navigator.storage.getDirectory){console.warn("[DataVault] OPFS is not supported in this browser.");return}this.root=await navigator.storage.getDirectory(),this.initialized=!0}catch(t){console.error("[DataVault] Failed to initialize OPFS:",t)}}async saveSnapshot(t,r){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const n=t.replace(/[^a-z0-9_\-\.\s]/gi,"_"),i=await(await this.root.getFileHandle(n+".json",{create:!0})).createWritable();return await i.write(JSON.stringify(r)),await i.close(),console.log(`[DataVault] Saved snapshot: ${t}`),!0}catch(n){throw console.error(`[DataVault] Failed to save snapshot ${t}:`,n),n}}async listSnapshots(){if(this.initialized||await this.init(),!this.root)return[];const t=[];try{for await(const[r,n]of this.root.entries())n.kind==="file"&&r.endsWith(".json")&&t.push(r)}catch(r){console.error("[DataVault] Failed to list snapshots:",r)}return t.sort().reverse()}async restoreSnapshot(t){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const o=await(await(await this.root.getFileHandle(t)).getFile()).text();return JSON.parse(o)}catch(r){throw console.error(`[DataVault] Failed to restore snapshot ${t}:`,r),r}}async deleteSnapshot(t){if(this.initialized||await this.init(),!!this.root)try{await this.root.removeEntry(t),console.log(`[DataVault] Deleted snapshot: ${t}`)}catch(r){console.warn(`[DataVault] Failed to delete snapshot ${t}:`,r)}}async clear(){if(this.initialized||await this.init(),!!this.root)try{const t=await this.listSnapshots();for(const r of t)await this.root.removeEntry(r);console.log("[DataVault] All data wiped.")}catch(t){console.error("[DataVault] Failed to wipe vault:",t)}}}const Bs=new Tu,Xy=Object.freeze(Object.defineProperty({__proto__:null,DataVault:Tu,dataVault:Bs},Symbol.toStringTag,{value:"Module"}));var no={};console.log("DEBUG: storage.js execution started");let Xe={},Zr=!1;async function Zy(){if(!Zr){console.log("[storage.js] Hydrating project cache from storage...");try{const e=O&&typeof O.getProjectKeys=="function"?await O.getProjectKeys():[],t="cameraPowerPlanner_project";let r=null;const n=e.slice();if(O&&typeof O.getItem=="function"){const i=await O.getItem(jn),s=Za(i);s&&(Nn=s),O.getItem(Mt).then(a=>{a&&(Fi=a)}),O.getItem(St).then(a=>{a&&(fo=a)}),O.getItem(ct).then(a=>{a&&(po=a)}),O.getItem(ut).then(a=>{Array.isArray(a)&&(pn=a)}),O.getItem(zt).then(a=>{a&&(Di=a)}),O.getItem(ar).then(a=>{a&&(Ui=a)}),O.getItem(kr).then(a=>{a&&(_o=a)}),O.getItem(rt).then(a=>{a&&(ko=a)}),O.getItem(Gt).then(a=>{a&&(Po=a)}),O.getItem(Re).then(a=>{a&&(jo=a)}),O.getItem(tt).then(a=>{a&&(Io=a)}),O.getItem(Bt).then(a=>{a&&(vo=a)}),O.getItem(lt).then(a=>{a&&(Lo=a)}),O.getItem(et).then(a=>{a&&(Ro=a)}),O.getItem(Ft).then(a=>{a&&(To=a)}),O.getItem(sr).then(a=>{a&&(No=a)}),O.getItem(ir()).then(a=>{a&&(Mo=a)}),O.getItem(Je).then(a=>{a&&(Qr=a)}),r=await O.getItem(t)}if(r&&typeof r=="object")try{Object.assign(Xe,r)}catch(i){console.warn("[hydrate] Failed to load monolith",i)}const o=n.map(async i=>{try{const s=await O.loadProjectRaw(i);s&&(Xe[i]=s)}catch(s){console.warn("[hydrate] Failed to load shard",i,s)}});await Promise.all(o),Zr=!0,console.log("[storage.js] Project cache hydrated. Keys:",Object.keys(Xe).length)}catch(e){console.warn("Cache hydration failed",e)}}}const h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:null,eg=typeof process<"u"&&process&&no&&(no.JEST_WORKER_ID||no.CINE_FORCE_STORAGE_REINIT),$e="cine_factory_reset_lock";if(h&&h.__cineStorageInitialized)if(eg){try{delete h.__cineStorageInitialized}catch{h.__cineStorageInitialized=!1}try{delete h.__cineStorageApi}catch{h.__cineStorageApi=null}try{delete h.__cineMonolithicProjectCleanupDone}catch{h.__cineMonolithicProjectCleanupDone=!1}}else typeof module<"u"&&module.exports&&h.__cineStorageApi&&typeof h.__cineStorageApi=="object"&&(module.exports=h.__cineStorageApi);const tg="cine-power-planner-lifecycle";let je=null;const rg=typeof process<"u"&&process&&no&&no.JEST_WORKER_ID;if(typeof BroadcastChannel<"u"&&!rg)try{je=new BroadcastChannel(tg),je&&(je.onmessage=e=>{if(e&&e.data==="factory-reset"){if(h){h.__cameraPowerPlannerFactoryResetting=!0;try{typeof sessionStorage<"u"&&sessionStorage.setItem($e,"true"),typeof localStorage<"u"&&localStorage.setItem($e,"true")}catch(t){}if(typeof sessionStorage<"u"&&typeof sessionStorage.clear=="function")try{const t=sessionStorage.getItem($e);sessionStorage.clear(),t&&sessionStorage.setItem($e,t)}catch(t){}typeof h.location<"u"&&typeof h.location.reload=="function"&&h.location.reload()}}else e.data==="project-shards-changed"&&or()})}catch{}if(h)try{const e=[typeof window<"u"?window:null,typeof sessionStorage<"u"?sessionStorage:null,typeof localStorage<"u"?localStorage:null];let t=!1;e.forEach(r=>{if(r&&typeof r.getItem=="function")try{r.getItem($e)&&(t=!0)}catch(n){}}),t&&(h.__cineJustFactoryReset=!0),e.forEach(r=>{if(r&&typeof r.removeItem=="function")try{r.removeItem($e)}catch(n){}}),Object.defineProperty(h,"__cineStorageInitialized",{configurable:!0,writable:!0,value:!0}),(async()=>{try{let r=!1;if(Ht&&typeof Ht.runMigrationIfNeeded=="function"){const o=await Ht.runMigrationIfNeeded(),i=await Ht.isMigrated();(o||i)&&(console.log(o?"[storage.js] Migration successful. Switching to IndexedDB.":"[storage.js] Native IndexedDB mode active."),await O.switchDriver(new xs),r=!0)}else if(Ht&&typeof Ht.init=="function"){const o=await Ht.init();let i=!1;typeof Ht.isMigrated=="function"&&(i=await Ht.isMigrated()),(o||i)&&(await O.switchDriver(new xs),r=!0)}const n=await yh();if(r&&(await Zy(),(!n.hasIndex||!Nn)&&Zr&&Xe&&Object.keys(Xe).length>0))try{Ao(Xe,T())}catch(o){console.warn("Failed to refresh project index after migration",o)}}catch(r){console.warn("[storage.js] Migration service failed:",r)}})()}catch{h.__cineStorageInitialized=!0}function ng(){if(je){try{je.close()}catch{}je=null}}typeof module<"u"&&module.exports&&(module.exports.closeStorageLifecycle=ng);function Gs(e,t){if(e===null||typeof e!="object")return e;let r=t;if(r||(r=typeof WeakMap=="function"?new WeakMap:[]),typeof r.has=="function"&&typeof r.get=="function"){if(r.has(e))return r.get(e)}else if(Array.isArray(r))for(let i=0;i<r.length;i+=1){const s=r[i];if(s&&s[0]===e)return s[1]}if(Object.prototype.toString.call(e)==="[object Date]"){let i;try{const s=typeof e.getTime=="function"?e.getTime():e.valueOf();i=new Date(s)}catch{i=new Date(e)}return typeof r.set=="function"?r.set(e,i):Array.isArray(r)&&r.push([e,i]),i}const o=Array.isArray(e)?[]:{};if(typeof r.set=="function"?r.set(e,o):Array.isArray(r)&&r.push([e,o]),Array.isArray(e))for(let i=0;i<e.length;i+=1)o[i]=Gs(e[i],r);else{const i=Object.keys(e);for(let s=0;s<i.length;s+=1){const a=i[s];o[a]=Gs(e[a],r)}}return o}function vr(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return Gs(e,null)}function og(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function ig(e){const t=og(e);return t?function(n){if(n===null||typeof n!="object")return n;try{return t(n)}catch{}return vr(n)}:vr}const ur=h&&typeof h.__cineDeepClone=="function"?h.__cineDeepClone:ig(h),mn=typeof WeakSet=="function"?new WeakSet:null;function Vr(e){if(!(!mn||typeof mn.add!="function"||!e))try{mn.add(e)}catch{}}function Ma(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.sessionStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}(function(){const t=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=Ma(t[r]);n&&Vr(n)}if(typeof sessionStorage<"u")try{Vr(sessionStorage)}catch{}})();function sg(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.localStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}function Nu(){const e=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof globalThis<"u"?globalThis:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=[],r=typeof WeakSet=="function"?new WeakSet:null;for(let n=0;n<e.length;n+=1){const o=sg(e[n]);if(o){if(r)try{if(r.has(o))continue;r.add(o)}catch{}else if(t.indexOf(o)!==-1)continue;t.push(o)}}return t}if(h&&typeof h.__cineDeepClone!="function")try{h.__cineDeepClone=ur}catch{}function Mu(){const e=r=>{if(!r||typeof r!="object"&&typeof r!="function")return!1;try{return r.__cameraPowerPlannerFactoryResetting===!0}catch{return!1}};if(e(h))return!0;const t=[typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&n!==h&&e(n))return!0}try{if(typeof sessionStorage<"u"&&sessionStorage.getItem($e)||typeof localStorage<"u"&&localStorage.getItem($e))return!0}catch{}return!1}var Ve="cameraPowerPlanner_devices",Yo=null,Ze="cameraPowerPlanner_setups",wt="cameraPowerPlanner_session",Xt="cameraPowerPlanner_feedback",pe="cameraPowerPlanner_project",Zi="cameraPowerPlanner_project_rev",et="cameraPowerPlanner_favorites",tt="cameraPowerPlanner_contacts",Bt="cameraPowerPlanner_ownGear",lt="cameraPowerPlanner_userProfile",Jt="cameraPowerPlanner_documentationTracker",Ot="cameraPowerPlanner_schemaCache",za="cinePowerPlanner_schemaCache",kr="cameraPowerPlanner_customFonts",ai="cameraPowerPlanner_mountVoltages",Gt="cameraPowerPlanner_cameraColors",Re="cineRentalPrintSections",jn="cameraPowerPlanner_projectIndex",oo=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.mountVoltageKey"):null,st=null,wr=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.storageCache"):"__cineStorageStateCache",Rt="cameraPowerPlanner_prj_",un=typeof WeakMap=="function"&&typeof Map=="function"?new WeakMap:null,kt=null,Lc=!1,Hr=typeof Map=="function"?new Map:null,qn=[],ag=6,zu=typeof Object.freeze=="function"?Object.freeze({__cineCompressionMiss:!0}):{__cineCompressionMiss:!0},Rc=Gu(8),Tc=Gu(6),Et=typeof Map=="function"?new Map:null,Er=[],cg=16;function Ii(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.slice();for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n],i=e[o];t[o]=Array.isArray(i)?i.slice():i}return t}function xu(e){if(!Et||typeof e!="string"||!e)return null;var t;try{t=Et.get(e)}catch{t=null}return!t||!t.payload?null:{payload:Ii(t.payload),compression:t.compression?Ii(t.compression):null}}function ci(e,t,r){if(!(!Et||typeof e!="string"||!e||!vn(t))){var n={payload:Ii(t),compression:r?Ii(r):null};try{Et.set(e,n)}catch{return}var o=Er.indexOf(e);for(o!==-1&&Er.splice(o,1),Er.push(e);Er.length>cg;){var i=Er.shift();if(!(!i||i===e))try{Et.delete(i)}catch{}}}}function lg(){if(Et&&typeof Et.clear=="function")try{Et.clear()}catch{}Er.length=0}var Fs=Number.POSITIVE_INFINITY,Ds=8,Bu=60*1e3,Zn={entries:Object.create(null),totalWarnings:0,suppressionNoticeShown:!1},mt=null,dr=null,on=null,Nc=!1;Cy&&typeof ji=="function"&&(mt=ji);var Zt="",Tt=!1;!mt&&h&&typeof h.__cineEnsureConsoleMethodsWritable=="function"&&(mt=h.__cineEnsureConsoleMethodsWritable);typeof mt=="function"&&mt(["warn","info"]);function ug(){var e=[],t=function(n){!n||typeof n!="object"&&typeof n!="function"||e.indexOf(n)===-1&&e.push(n)};return t(h),t(typeof globalThis<"u"?globalThis:null),t(typeof window<"u"?window:null),t(typeof self<"u"?self:null),t(typeof global<"u"?global:null),e}function fg(){if(dr)return dr;if($r&&typeof $r.resolveLogger=="function")return dr=$r,dr;for(var e=ug(),t=0;t<e.length;t+=1){var r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{var n=r.cineLoggingResolver;if(n&&typeof n.resolveLogger=="function")return dr=n,dr}catch{}}return dr=null,dr}function pg(){if(on||Nc)return on;Nc=!0;var e=fg();if(e&&typeof e.resolveLogger=="function")try{var t=e.resolveLogger("storage",{meta:{source:"storage-module"}});if(t)return on=t,on}catch{}return on=null,on}function cn(e){if(!e)return null;if(typeof e=="string")return{message:e};var t={};if(typeof e.name=="string"&&e.name&&(t.name=e.name),typeof e.message=="string"&&e.message&&(t.message=e.message),typeof e.stack=="string"&&e.stack&&(t.stack=e.stack),!Object.keys(t).length)try{t.message=String(e)}catch{return null}return t}function hr(e){if(e&&typeof D<"u"&&D&&D.storage===e)return D&&typeof D.type=="string"?D.type:"unknown";if(e&&h){try{if(h.localStorage&&e===h.localStorage)return"local"}catch{}try{if(h.sessionStorage&&e===h.sessionStorage)return"session"}catch{}}return typeof D<"u"&&D&&typeof D.type=="string"?D.type:"unknown"}function br(e,t,r,n,o){var i=typeof e=="string"&&e?e.toLowerCase():"info",s=typeof t=="string"&&t?t:"Storage event",a=pg(),c=!1,u={module:"storage"};if(n&&typeof n=="object"){u={module:"storage"};for(var f=Object.keys(n),l=0;l<f.length;l+=1){var y=f[l];u[y]=n[y]}}if(a){if(typeof a[i]=="function")try{a[i](s,r,u),c=!0}catch{c=!1}else if(typeof a.log=="function")try{a.log(i,s,r,u),c=!0}catch{c=!1}}if(typeof o=="function"){try{o()}catch{}return c}if(typeof console>"u"||!console)return c;var p=null;if(i==="error"&&typeof console.error=="function"?p=console.error:i==="warn"&&typeof console.warn=="function"?p=console.warn:i==="info"&&typeof console.info=="function"?p=console.info:i==="debug"&&typeof console.debug=="function"?p=console.debug:typeof console.log=="function"&&(p=console.log),typeof p=="function")try{p.call(console,s,r||null)}catch{}return c}function dg(){if(typeof Date>"u")return null;if(typeof Date.now=="function")return Date.now();try{return new Date().getTime()}catch{}return null}function es(e,t,r,n,o){var i=typeof e=="string"&&e?e:"generic",s=null;if(typeof t=="string"&&t)s=t;else if(t!=null)try{s=String(t)}catch{s=null}var a={event:"compression-savings",kind:i,key:s,storageType:hr()};typeof n=="number"&&Number.isFinite(n)&&(a.savings=n),typeof o=="number"&&Number.isFinite(o)&&(a.percent=o);var c=function(){if(!(typeof console>"u")){var f=Zn,l=f.entries[i],y=dg();if(l||(l={kind:i,occurrences:0,totalSavings:0,lastPercent:null,lastKey:null,uniqueKeys:Object.create(null),uniqueKeyCount:0,firstLoggedAt:y,lastLoggedAt:y,lastSummaryAt:null,suppressedTotal:0,suppressedSinceSummary:0},f.entries[i]=l),l.occurrences+=1,l.lastLoggedAt=y,s&&(l.lastKey=s,l.uniqueKeys[s]||(l.uniqueKeys[s]=!0,l.uniqueKeyCount+=1)),typeof n=="number"&&Number.isFinite(n)&&(l.totalSavings+=n),typeof o=="number"&&Number.isFinite(o)&&(l.lastPercent=o),f.totalWarnings<Fs){typeof mt=="function"&&mt("warn"),typeof console.warn=="function"&&r&&console.warn(r),f.totalWarnings+=1;return}l.suppressedTotal+=1,l.suppressedSinceSummary+=1,!f.suppressionNoticeShown&&typeof console.info=="function"&&(typeof mt=="function"&&mt("info"),console.info("Additional storage compression warnings are being batched to keep diagnostics readable.",{limit:Fs,batchSize:Ds}),f.suppressionNoticeShown=!0);var p=!1;l.lastSummaryAt?(l.suppressedSinceSummary>=Ds||y!==null&&l.lastSummaryAt!==null&&l.suppressedSinceSummary>0&&y-l.lastSummaryAt>=Bu)&&(p=!0):p=!0,p&&typeof console.info=="function"&&(typeof mt=="function"&&mt("info"),console.info("Suppressed repeated storage compression warnings.",{kind:l.kind,mostRecentKey:l.lastKey,suppressedSinceSummary:l.suppressedSinceSummary,suppressedTotal:l.suppressedTotal,totalOccurrences:l.occurrences,totalSavings:l.totalSavings,lastPercent:l.lastPercent,uniqueKeys:l.uniqueKeyCount}),l.lastSummaryAt=y,l.suppressedSinceSummary=0)}};br("info",r,a,{event:"compression-savings",kind:i},c)}function yg(){for(var e={},t=Object.keys(Zn.entries),r=0;r<t.length;r+=1){var n=t[r],o=Zn.entries[n];o&&(e[n]={kind:o.kind,occurrences:o.occurrences,totalSavings:o.totalSavings,lastPercent:o.lastPercent,lastKey:o.lastKey,uniqueKeyCount:o.uniqueKeyCount,firstLoggedAt:o.firstLoggedAt,lastLoggedAt:o.lastLoggedAt,lastSummaryAt:o.lastSummaryAt,suppressedTotal:o.suppressedTotal})}return{limit:Fs,batchSize:Ds,summaryWindowMs:Bu,totalWarnings:Zn.totalWarnings,suppressionNoticeShown:Zn.suppressionNoticeShown,entries:e}}function gg(e){if(!Array.isArray(e)||!e.length)return null;for(var t=[],r=0;r<e.length;r+=1){var n=e[r]||{},o=typeof n.variant=="string"?n.variant:"",i=typeof n.compress=="string"?n.compress:"",s=typeof n.decompress=="string"?n.decompress:"";t.push(o+":"+i+":"+s)}return t.join("|")}function mg(e,t){if(!Hr||!e)return null;var r;try{r=Hr.get(e)}catch{r=null}return!r||r.lz!==t?null:!Array.isArray(r.strategies)||!r.strategies.length?Array.isArray(r.strategies)?[]:null:r.strategies.slice()}function hg(e){if(!(!Hr||!e)){var t=qn.indexOf(e);for(t!==-1&&qn.splice(t,1),qn.push(e);qn.length>ag;){var r=qn.shift();if(typeof Hr.delete=="function")try{Hr.delete(r)}catch{}}}}function bg(e,t,r){if(!(!Hr||!e)){var n={lz:t,strategies:Array.isArray(r)?r.slice():[]};try{Hr.set(e,n),hg(e)}catch{}}}function Sg(){if(typeof JSON>"u"||!JSON||typeof JSON.stringify!="function")return 0;try{var e={[Ut]:!0,version:vi,algorithm:wo,namespace:en,data:"",originalLength:0,compressedPayloadLength:0,compressionVariant:""},t=JSON.stringify(e);if(typeof t!="string"||!t)return 0;var r=JSON.stringify("").length;return r>0?t.length-r*2-String(0).length*2:0}catch{}return 0}function Gu(e){if(typeof Map!="function")return null;var t=Number(e);return t>0?{map:new Map,keys:[],limit:Math.floor(t)}:null}function Fu(e){if(!e||typeof e!="object")return null;for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1)t[r[n]]=e[r[n]];return t}function Du(e,t){if(!(!e||!Array.isArray(e.keys))){var r=e.keys.indexOf(t);r!==-1&&e.keys.splice(r,1),e.keys.push(t)}}function Uu(e,t){if(!e||!e.map||typeof e.map.get!="function")return{hit:!1};if(typeof t!="string"||!t)return{hit:!1};var r;try{r=e.map.get(t)}catch{return{hit:!1}}if(r===void 0)return{hit:!1};if(Du(e,t),r===zu)return{hit:!0,candidate:null};var n=Fu(r);return n?{hit:!0,candidate:n}:{hit:!0,candidate:null}}function Ku(e,t,r){if(!(!e||!e.map||typeof e.map.set!="function")&&!(typeof t!="string"||!t)&&!(!e.limit||e.limit<=0)){var n=r&&typeof r=="object"?Fu(r):zu;try{e.map.set(t,n)}catch{return}for(Du(e,t);e.keys.length>e.limit;){var o=e.keys.shift();if(!(typeof o!="string"||o===t))try{e.map.delete(o)}catch{}}}}function xa(e,t){if(!e||typeof e!="object"&&typeof e!="function")return null;let r=null;if(wr)try{r=e[wr]}catch{r=null}if(!r&&un)try{r=un.get(e)||null}catch{r=null}if(r||!t)return r||null;const n=new Map;let o=!1;if(wr)try{Object.defineProperty(e,wr,{configurable:!0,writable:!0,value:n}),o=!0}catch{try{e[wr]=n,o=!0}catch{o=!1}}if(!o&&un)try{un.set(e,n),o=!0}catch{o=!1}return o?n:null}function wg(e,t){const r=xa(e,!1);return!r||typeof t!="string"||!t?null:r.get(t)||null}function Qt(e,t){const r=xa(e,!1);if(!(!r||typeof t!="string"||!t)&&(typeof r.delete=="function"&&r.delete(t),r.size===0)){if(wr)try{e&&(typeof e=="object"||typeof e=="function")&&Object.prototype.hasOwnProperty.call(e,wr)&&delete e[wr]}catch{}if(un)try{un.delete(e)}catch{}}}function $u(e){if(e===null||typeof e!="object")return e;try{return ur(e)}catch{}return e}function bs(e){if(!e)return;const{value:t}=e;return t===null||typeof t!="object"?t:$u(t)}function In(e,t){const r=new Map;if(!e||typeof e.forEach!="function")return r;const{freezeArray:n=!1}=t||{};return e.forEach((o,i)=>{if(Array.isArray(o)){const s=o.slice();if(n)try{Object.freeze(s)}catch{}r.set(i,s)}else r.set(i,o)}),r}function Us(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:In(e.raw),normalized:In(e.normalized)}}function Eg(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:In(e.raw),normalized:In(e.normalized,{freezeArray:!0})}}function Og(e){if(!E(e))return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n],i=e[o];if(i&&typeof i=="object")try{Object.freeze(i)}catch{}t[o]=i}try{Object.freeze(t)}catch{}return t}function Mc(e){if(!e||typeof e!="object"){st=null;return}st={projects:Og(e.projects),changed:!!e.changed,originalValue:e.originalValue,lookup:Eg(e.lookup),rawValue:e.rawValue===void 0?void 0:e.rawValue}}function Ag(e){if(!st)return null;const t=T();let r=null;if(t&&typeof t.getItem=="function")try{r=t.getItem(pe)}catch{r=null}if(st.rawValue!==void 0&&st.rawValue!==r)return st=null,null;const{forMutation:n=!1}=e||{};return{projects:n?ur(st.projects):st.projects,changed:st.changed,originalValue:st.originalValue,lookup:Us(st.lookup)}}function or(){st=null}function Cg(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}return null}function _g(){return Zi}function Vu(e){const t=e||T();if(!t||typeof t.getItem!="function")return null;const r=Ne(t,Zi,"Error reading project storage revision from localStorage:",null,{validate:n=>n===null||typeof n=="number"||typeof n=="string"});return Cg(r)}function Ba(e){const t=e||T();if(!t||typeof t.setItem!="function")return null;const r=Vu(t),n=Number.isFinite(r)?r+1:1;return Oe(t,Zi,n,"Error saving project storage revision to localStorage:",{disableCompression:!0,enableCompressionSweep:!1}),n}function Ue(e,t,r,n,o){if(typeof t!="string"||!t||!e||typeof e!="object"&&typeof e!="function")return;const i=xa(e,!0);if(!i)return;const s=$u(o),c={raw:typeof r=="string"&&r?r:null,normalizedRaw:typeof n=="string"&&n?n:typeof r=="string"&&r?r:null,value:s};i.set(t,c)}function kg(e,t,r,n){const o=wg(e,t);if(!o)return{hit:!1};if(typeof n=="string"&&n&&o.raw&&o.raw===n)return{hit:!0,value:bs(o)};if(typeof r=="string"&&r){if(o.normalizedRaw&&o.normalizedRaw===r)return{hit:!0,value:bs(o)};if(o.raw&&o.raw===r)return{hit:!0,value:bs(o)}}return{hit:!1}}function Pg(e,t){if(!e||typeof e!="object")return"";var r;try{r=Object.getOwnPropertyDescriptor(e,t)}catch{r=null}if(r&&Object.prototype.hasOwnProperty.call(r,"value")&&typeof r.value=="string"&&r.value)return r.value;var n;try{n=e[t]}catch{n=""}if(typeof n=="string"&&n)return n;if(oo)try{const o=e[oo];if(typeof o=="string"&&o)return o}catch{}return""}function Hu(e,t,r){if(!e||typeof e!="object")return"";if(oo)try{e[oo]=r;const i=e[oo];if(typeof i=="string"&&i)return i}catch{}var n;try{n=Object.getOwnPropertyDescriptor(e,t)}catch{n=null}if(n&&Object.prototype.hasOwnProperty.call(n,"value")&&typeof n.value=="string"&&n.value)return n.value;if(n&&n.configurable===!1&&n.writable===!1)return"";var o="";try{e[t]=r,o=e[t]}catch{o=""}return typeof o=="string"&&o?o:(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose mount voltage storage key globally. Using fallback only."),"")}function qu(){if(!h||typeof h!="object")return ai;var e=Pg(h,"MOUNT_VOLTAGE_STORAGE_KEY");if(e)return e;var t=Hu(h,"MOUNT_VOLTAGE_STORAGE_KEY",ai);return t||ai}var li=qu();function Wu(){const e=qu();if(e&&e!==li&&(li=e,h&&Hu(h,"MOUNT_VOLTAGE_STORAGE_KEY",e),typeof jt<"u"&&jt&&typeof jt.add=="function")){jt.add(e);const t=Ct(e);for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&jt.add(n)}}return li}function ir(){return Wu()}function Yu(){const e=Wu();return e?`${e}__backup`:`${ai}__backup`}function Ju(){if(!h)return kr;const e=typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:typeof h.CUSTOM_FONT_STORAGE_KEY=="string"?h.CUSTOM_FONT_STORAGE_KEY:kr;let t=e;return e==="cinePowerPlanner_customFonts"&&(t=kr),h.CUSTOM_FONT_STORAGE_KEY!==t&&(h.CUSTOM_FONT_STORAGE_KEY=t),h.CUSTOM_FONT_STORAGE_KEY_NAME!==t&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=t),t}function Lr(){return h&&typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:Ju()}Ju();var rt="customLogo",zc="cameraPowerPlanner_temperatureUnit",xc="cameraPowerPlanner_focusScale";function jg(){if(!h)return zc;const e=typeof h.TEMPERATURE_UNIT_STORAGE_KEY=="string"?h.TEMPERATURE_UNIT_STORAGE_KEY:zc;if(h.TEMPERATURE_UNIT_STORAGE_KEY!==e)try{h.TEMPERATURE_UNIT_STORAGE_KEY=e}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign temperature unit storage key globally.",t);try{Object.defineProperty(h,"TEMPERATURE_UNIT_STORAGE_KEY",{configurable:!0,writable:!0,value:e})}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose temperature unit storage key globally.",r)}}return e}var Ft=jg(),sr=(function(){if(!h)return xc;const t=typeof h.FOCUS_SCALE_STORAGE_KEY=="string"?h.FOCUS_SCALE_STORAGE_KEY:xc;if(h.FOCUS_SCALE_STORAGE_KEY!==t)try{h.FOCUS_SCALE_STORAGE_KEY=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign focus scale storage key globally.",r)}if(h.FOCUS_SCALE_STORAGE_KEY_NAME!==t)try{h.FOCUS_SCALE_STORAGE_KEY_NAME=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose focus scale storage key globally.",r)}return t})(),Rr="cameraPowerPlanner_autoGearRules",tn="cameraPowerPlanner_autoGearSeeded",ut="cameraPowerPlanner_autoGearBackups",Nt="cameraPowerPlanner_autoGearPresets",Mt="cameraPowerPlanner_autoGearMonitorDefaults",St="cameraPowerPlanner_autoGearActivePreset",ct="cameraPowerPlanner_autoGearAutoPreset",ar="cameraPowerPlanner_autoGearShowBackups",zt="cameraPowerPlanner_autoGearBackupRetention",Je="cameraPowerPlanner_fullBackups",Fe="auto-backup-",At="auto-backup-before-delete-",qr="__cineAutoBackupRenamed",bo="__cineAutoBackupMetadata",hn="__cineAutoBackupSnapshot",Wr=1,Ga="__cineAutoBackupCompressedPayload",Qu="__cineCircular__",Pr=new Map,Ss=typeof Set=="function"?new Set:null,Ig=2048;function Dt(e){return typeof e=="string"&&(e.startsWith(Fe)||e.startsWith(At))}if(h&&typeof h=="object")try{Object.prototype.hasOwnProperty.call(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG")||Object.defineProperty(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG",{configurable:!0,writable:!1,value:qr})}catch{try{h.__CINE_AUTO_BACKUP_RENAMED_FLAG=qr}catch{}}var fn=240,Bc=20,Xu=36,at=1,vg=120;function Lg(){if(!(!h||typeof h!="object")){if(typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=Xu}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention default globally.",e)}if(typeof h.AUTO_GEAR_BACKUP_RETENTION_MIN!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_MIN=at}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention minimum globally.",e)}}}Lg();function Rg(e){return!e||typeof e!="object"?null:{version:Number.isFinite(e.version)?e.version:Wr,snapshotType:e.snapshotType==="delta"?"delta":"full",base:typeof e.base=="string"?e.base:null,sequence:Number.isFinite(e.sequence)?e.sequence:e.snapshotType==="delta"?1:0,createdAt:typeof e.createdAt=="string"?e.createdAt:null,changedKeys:Array.isArray(e.changedKeys)?e.changedKeys.slice():[],removedKeys:Array.isArray(e.removedKeys)?e.removedKeys.slice():[],payloadSignature:typeof e.payloadSignature=="string"?e.payloadSignature:null,payloadCompression:E(e.payloadCompression)?{...e.payloadCompression}:null,compressedPayload:E(e.compressedPayload)?be(e.compressedPayload,{stripMetadata:!0}):e.compressedPayload&&typeof e.compressedPayload=="string"?e.compressedPayload:null}}function io(e,t){if(!e||typeof e!="object")return;const r=Rg(t);try{Object.defineProperty(e,bo,{configurable:!0,enumerable:!1,writable:!0,value:r})}catch{try{e[bo]=r}catch{}}}function So(e){if(!e||typeof e!="object")return null;const t=e[bo];return!t||typeof t!="object"?null:t}function Tg(e,t){if(!t||typeof t!="object")return;const r=So(e);r&&io(t,r)}function be(e,t,r){const n=t||{},o=r||(typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),i=(s,a)=>{if(!o||!o.stack)return a();if(o.stack.has(s)){if(!o.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function")try{console.warn("Detected circular reference while cloning automatic backup data. Using a placeholder to keep serialization stable.")}catch{}return o&&(o.reportedCycle=!0),Qu}o.stack.add(s);try{return a()}finally{o.stack.delete(s)}};return e===null||typeof e!="object"?e:e instanceof Date?new Date(e.getTime()):Array.isArray(e)?i(e,()=>e.map(s=>be(s,n,o))):i(e,()=>{const s={};if(Object.keys(e).forEach(a=>{n.stripMetadata&&a===bo||(s[a]=be(e[a],n,o))}),!n.stripMetadata){const a=So(e);a&&io(s,a)}return s})}function Ks(e,t){const n=be(e,t,typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),o=fe(n);return o!==n?o:n}function vn(e){return!E(e)||e[Ga]!==!0?!1:typeof e.data=="string"&&e.data}function ws(e,t,r){if(!e||typeof e!="object")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:null};const n=r||{};if(n.disableCompression)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:typeof n.payloadSignature=="string"?n.payloadSignature:null};const o=n.reportCompression!==!1;let i=null;try{i=typeof n.payloadSignature=="string"?n.payloadSignature:_e(e)}catch(y){i=null,console.warn("Unable to compute stable signature for automatic backup payload before compression",y)}const s=typeof n.existingPayloadSignature=="string"?n.existingPayloadSignature:null;if(s&&i&&s===i&&vn(n.existingCompressedPayload)){const y=be(n.existingCompressedPayload,{stripMetadata:!0}),p=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null;return!n.disableCompression&&typeof i=="string"&&i&&ci(i,y,p),{payload:y,compression:p,compressed:!0,reused:!0,payloadSignature:i}}if(!n.disableCompression&&typeof i=="string"&&i){const y=xu(i);if(y&&y.payload)return{payload:y.payload,compression:y.compression,compressed:!0,reused:!0,payloadSignature:i}}let a;try{a=JSON.stringify(e)}catch(y){return console.warn("Unable to serialize auto backup payload before compression",y),{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i}}if(typeof a!="string"||a.length<Ig)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};if(!n.disableCompression&&vn(n.existingCompressedPayload)){const y=Do(n.existingCompressedPayload.data);if(y.success&&typeof y.value=="string"&&y.value===a){const p=be(n.existingCompressedPayload,{stripMetadata:!0}),d=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null,g=typeof i=="string"&&i?i:typeof s=="string"&&s?s:null;return g&&ci(g,p,d),{payload:p,compression:d,compressed:!0,reused:!0,payloadSignature:g}}}const c=Ln(a);if(!c||typeof c.serialized!="string")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};const u=c.originalLength-c.wrappedLength,f={[Ga]:!0,data:c.serialized,originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},l=typeof c.originalLength=="number"&&Number.isFinite(c.originalLength)&&typeof c.wrappedLength=="number"&&Number.isFinite(c.wrappedLength)?{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null}:null;if(!n.disableCompression&&typeof i=="string"&&i&&ci(i,f,l),o&&typeof console<"u"&&typeof console.warn=="function"&&u>0){const y=typeof t=="string"&&t?`"${t}"`:"an automatic backup",p=c.originalLength>0?Math.round(u/c.originalLength*100):0,d=`Stored compressed payload for ${y} snapshot to reduce storage usage by ${u} characters (${p}%).`;es("auto-backup",t||y,d,u,p)}return{payload:f,compression:{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},compressed:!0,reused:!1,payloadSignature:i}}function $s(e,t){if(!e||typeof e!="object")return{payload:e,compressed:!1};const r=e.payload;if(!vn(r))return{payload:r,compressed:!1};const n=Do(r.data);if(!n.success||typeof n.value!="string"){const o=n&&n.error?n.error:null;throw console.warn("Unable to decompress automatic backup payload.",t,o),new Error("Failed to decompress automatic backup payload")}try{return{payload:JSON.parse(n.value),compressed:!0}}catch(o){throw console.warn("Unable to parse decompressed automatic backup payload.",t,o),o}}function so(e,t){const r=Ka(e);if(r&&Number.isFinite(r.timestamp)&&r.timestamp>0)try{return new Date(r.timestamp).toISOString()}catch{}const n=t instanceof Date?t:new Date;try{return n.toISOString()}catch{return new Date().toISOString()}}function Ng(e,t,r){if(!E(e)||!r||r.snapshotType!=="delta")return{cycle:!1,path:[]};const n=new Set,o=[],i=Math.max(10,Object.keys(e).length+5);let s=0,a=t,c=r;for(;c&&c.snapshotType==="delta";){if(s>i)return{cycle:!0,path:o};const u=typeof c.base=="string"?c.base:null;if(!u)return{cycle:!1,path:o};if(!Dt(u))return{cycle:!1,path:o};if(n.has(u))return o.push(u),{cycle:!0,path:o};n.add(a),o.push(a);const f=Object.prototype.hasOwnProperty.call(e,u)?e[u]:null;if(!E(f))return{cycle:!1,path:o};if(a=u,c=So(f),!c)return{cycle:!1,path:o};s+=1}return{cycle:!1,path:o}}function Mg(e,t,r){if(!e||typeof e!="object")return;e.snapshotType="full",e.base=null,e.sequence=0,e.removedKeys=[];const n=E(r)?Object.keys(r):[];e.changedKeys=n.slice(),(typeof e.createdAt!="string"||!e.createdAt)&&(e.createdAt=so(t))}function Zu(e,t){if(!E(e))return e;const r={},n=new Map,o=t||{},i=typeof o.isAutoBackupKey=="function"?o.isAutoBackupKey:Dt,s=typeof o.filter=="function"?o.filter:null,a=s?u=>{let f=!1;try{f=s(u)}catch{f=!1}return f}:()=>!0,c=(u,f)=>{if(n.has(u))return n.get(u);const l=e[u],y=ns(l,u),p=y.restored?y.value:l;if(!E(p)){const m=be(p);return n.set(u,m),m}const d=p[hn];if(d&&typeof d=="object"){if(f.has(u)){console.warn("Detected cyclic auto-backup reference while expanding snapshot",u);let S={},v=[],B=null;try{const z=$s(d,u);if(z&&E(z.payload)){S=be(z.payload),v=Object.keys(z.payload);try{B=_e(z.payload)}catch(M){B=null,console.warn("Unable to compute stable signature for automatic backup payload after detecting a cycle",M)}}}catch(z){console.warn("Failed to restore automatic backup payload after detecting a cyclic reference",u,z)}const N={version:Number.isFinite(d.version)?d.version:Wr,snapshotType:"full",base:null,sequence:Number.isFinite(d.sequence)?d.sequence:0,createdAt:typeof d.createdAt=="string"?d.createdAt:so(u),changedKeys:v.slice(),removedKeys:[],payloadSignature:B};return vn(d.payload)?(N.compressedPayload=be(d.payload,{stripMetadata:!0}),N.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(N.compressedPayload=null,N.payloadCompression=null),io(S,N),n.set(u,S),S}f.add(u);const m=d.snapshotType==="delta"?"delta":"full",b=m==="delta"&&typeof d.base=="string"?d.base:null,C=b?be(c(b,f)):{};let A;try{A=$s(d,u)}catch(S){throw console.warn("Failed to restore automatic backup payload while expanding snapshot",u,S),S}const _=E(A.payload)?A.payload:{},P=Array.isArray(d.changedKeys)&&d.changedKeys.length?d.changedKeys:Object.keys(_),k=Array.isArray(d.removedKeys)?d.removedKeys:[],I=be(C);P.forEach(S=>{Object.prototype.hasOwnProperty.call(_,S)&&I&&(I[S]=be(_[S]))}),k.forEach(S=>{Object.prototype.hasOwnProperty.call(I,S)&&delete I[S]});const w={version:Number.isFinite(d.version)?d.version:Wr,snapshotType:m,base:m==="delta"?b:null,sequence:Number.isFinite(d.sequence)?d.sequence:m==="delta"?1:0,createdAt:typeof d.createdAt=="string"?d.createdAt:so(u),changedKeys:P.slice(),removedKeys:k.slice()};try{w.payloadSignature=_e(_)}catch(S){w.payloadSignature=null,console.warn("Unable to compute stable signature for automatic backup payload during expansion",S)}return vn(d.payload)?(w.compressedPayload=be(d.payload,{stripMetadata:!0}),w.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(w.compressedPayload=null,w.payloadCompression=null),io(I,w),n.set(u,I),f.delete(u),I}const g=be(p);if(i(u)){const m={version:Wr,snapshotType:"full",base:null,sequence:0,createdAt:so(u),changedKeys:Object.keys(g),removedKeys:[]};io(g,m)}return n.set(u,g),g};return Object.keys(e).forEach(u=>{if(a(u)){if(!i(u)){const f=e[u];r[u]=E(f)?be(f):f;return}r[u]=c(u,new Set)}}),r}function zg(e,t){const r={},n=[],o=[],i=E(t)?Object.keys(t):[],s=E(e)?Object.keys(e):[];return new Set([...i,...s]).forEach(c=>{if(c===bo)return;const u=Object.prototype.hasOwnProperty.call(e||{},c),f=Object.prototype.hasOwnProperty.call(t||{},c);if(!u&&f){o.push(c);return}if(!u)return;const l=e?e[c]:void 0,y=f?t[c]:void 0,p=_e(l),d=_e(y);p!==d&&(n.push(c),r[c]=be(l,{stripMetadata:!0}))}),{payload:r,changedKeys:n,removedKeys:o}}function ef(e,t){if(!E(e))return e;const r=t||{},n=typeof r.isAutoBackupKey=="function"?r.isAutoBackupKey:Dt,o={},i=Object.keys(e),s=(()=>{const a=new Map;i.forEach(u=>{if(!n(u))return;const f=e[u],l=So(f);let y=Number.NEGATIVE_INFINITY;if(l&&typeof l.createdAt=="string"){const g=Date.parse(l.createdAt);Number.isNaN(g)||(y=g)}if(!Number.isFinite(y)){const g=Ka(u);g&&Number.isFinite(g.timestamp)&&(y=g.timestamp)}const p=u.startsWith(At)?At:Fe,d=a.get(p);(!d||y>d.timestamp||y===d.timestamp&&u.localeCompare(d.name)>0)&&a.set(p,{name:u,timestamp:y})});const c=new Set;return a.forEach(({name:u})=>{typeof u=="string"&&u&&c.add(u)}),c})();return i.forEach(a=>{const c=e[a],u=Ks(c,{stripMetadata:!0});if(!n(a)||!E(u)){o[a]=u;return}const f=s.has(a),l=So(c);l&&l.snapshotType==="delta"&&Ng(e,a,l).cycle&&(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Detected cyclic automatic backup chain during serialization. Promoting to full snapshot.",a),Mg(l,a,u));const y=l&&typeof l.createdAt=="string"?l.createdAt:so(a);if(!l||l.snapshotType!=="delta"){o[a]={};const _={version:Wr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(u||{}),removedKeys:[]};let P;try{P=_e(u)}catch(I){P=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",I)}const k=ws(u,a,{disableCompression:f,payloadSignature:P,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(_.payload=k.payload,k.compression&&(_.payloadCompression=k.compression),l){const I=typeof k.payloadSignature=="string"?k.payloadSignature:P;l.payloadSignature=I||null,k.compressed?(l.compressedPayload=be(k.payload,{stripMetadata:!0}),l.payloadCompression=k.compression?{...k.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][hn]=_;return}const p=typeof l.base=="string"?l.base:null,d=p&&Object.prototype.hasOwnProperty.call(e,p)?e[p]:null;if(!d||!E(d)){o[a]={};const _={version:Wr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(u||{}),removedKeys:[]};let P;try{P=_e(u)}catch(I){P=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",I)}const k=ws(u,a,{disableCompression:f,payloadSignature:P,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(_.payload=k.payload,k.compression&&(_.payloadCompression=k.compression),l){const I=typeof k.payloadSignature=="string"?k.payloadSignature:P;l.payloadSignature=I||null,k.compressed?(l.compressedPayload=be(k.payload,{stripMetadata:!0}),l.payloadCompression=k.compression?{...k.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][hn]=_;return}const g=Ks(d,{stripMetadata:!0}),m=zg(u,g);o[a]={};const b={version:Number.isFinite(l.version)?l.version:Wr,snapshotType:"delta",base:p,sequence:Number.isFinite(l.sequence)?l.sequence:1,createdAt:y,changedKeys:m.changedKeys,removedKeys:m.removedKeys};let C;try{C=_e(m.payload)}catch(_){C=null,console.warn("Unable to compute stable signature for automatic backup delta payload before serialization",_)}const A=ws(m.payload,a,{disableCompression:f,payloadSignature:C,existingCompressedPayload:l?l.compressedPayload:null,existingPayloadCompression:l?l.payloadCompression:null,existingPayloadSignature:l?l.payloadSignature:null});if(b.payload=A.payload,A.compression&&(b.payloadCompression=A.compression),l){const _=typeof A.payloadSignature=="string"?A.payloadSignature:C;l.payloadSignature=_||null,A.compressed?(l.compressedPayload=be(A.payload,{stripMetadata:!0}),l.payloadCompression=A.compression?{...A.compression}:null):(l.compressedPayload=null,l.payloadCompression=null)}o[a][hn]=b}),o}function Ct(e){if(typeof e!="string"||!e)return[e];const t=new Set([e]);return e.startsWith("cameraPowerPlanner_")?t.add(`cinePowerPlanner_${e.slice(19)}`):e.startsWith("cinePowerPlanner_")&&t.add(`cameraPowerPlanner_${e.slice(17)}`),Array.from(t)}var bn=new Set(Ct(Ze));function xg(){return(!Yo||typeof Yo.has!="function")&&(Yo=new Set(Ct(Ve))),Yo}function tf(e){if(typeof e!="string"||!e)return!1;const t=xg();return t&&typeof t.has=="function"?t.has(e):e===Ve}function Bg(e){return!(typeof e!="string"||!e||!bn||typeof bn.has!="function"||!bn.has(e)||Tt)}function Gg(e,t){if(!e||typeof e.getItem!="function"||!bn||typeof bn.forEach!="function")return;const r=new Set,n=t&&typeof t.has=="function"?t:null;bn.forEach(o=>{if(!(typeof o!="string"||!o||r.has(o))&&(r.add(o),!(n&&n.has(o))))try{e.getItem(o)}catch{}})}var de="__backup",Fg=3,Dg=100,zr="__legacyMigrationBackup",jt=new Set([Lr(),rt,Ot,tt,Bt,Jt,li,sr,Re]);Array.from(jt).forEach(e=>{Ct(e).forEach(t=>{typeof t=="string"&&t&&jt.add(t)})});var Gc=[()=>({key:Ve}),()=>({key:Ze}),()=>({key:wt}),()=>({key:Xt}),()=>({key:pe,valueProvider:()=>{if(typeof _t=="function")try{const{projects:e}=_t({forMutation:!1});if(e&&typeof e=="object")return JSON.stringify(e)}catch(e){typeof console<"u"&&console.warn&&console.warn("Failed to reconstruct monolithic project backup",e)}return null}}),()=>({key:et}),()=>({key:tt}),()=>({key:Bt}),()=>({key:Jt}),()=>({key:Ot}),()=>({key:Rr}),()=>({key:tn}),()=>({key:ut}),()=>({key:Nt}),()=>({key:St}),()=>({key:ct}),()=>({key:ar}),()=>({key:zt}),()=>({key:Mt}),()=>({key:Je}),()=>({key:rt}),()=>({key:Lr()}),()=>({key:"darkMode"}),()=>({key:"pinkMode"}),()=>({key:"highContrast"}),()=>({key:"reduceMotion"}),()=>({key:"relaxedSpacing"}),()=>({key:"showAutoBackups"}),()=>({key:"accentColor"}),()=>({key:"fontSize"}),()=>({key:"fontFamily"}),()=>({key:"language"}),()=>({key:"iosPwaHelpShown"}),()=>({key:Re}),()=>({key:Ft}),()=>({key:ir(),backupKey:Yu()})];function Ug(e,t={}){if(!e||typeof e!="object")return null;const{key:r,backupKey:n,storage:o=null}=e;if(typeof r!="string"||!r)return null;const i=typeof n=="string"&&n?n:`${r}${de}`;return{key:r,backupKey:i,storage:o,label:typeof t.label=="string"?t.label:r,valueProvider:typeof e.valueProvider=="function"?e.valueProvider:null}}function Kg(e={}){const t=[],r=new Set,n=i=>{if(!i)return;const s=Ct(i.key),a=`${i.key}${de}`;for(let c=0;c<s.length;c+=1){const u=s[c];if(typeof u!="string"||!u)continue;let f=i.backupKey;u!==i.key&&i.backupKey===a&&(f=`${u}${de}`);const l=u===i.key?i:{...i,key:u,backupKey:f},y=l.storage||null,p=`${l.key}__${y?String(y):"default"}`;r.has(p)||(r.add(p),t.push(l))}};for(let i=0;i<Gc.length;i+=1){const s=Gc[i];if(typeof s!="function")continue;let a;try{a=s(e)}catch(u){var o={event:"critical-storage",action:"collect-keys",reason:"provider-error",storageType:hr(e&&e.storage?e.storage:null),error:cn(u)};br("warn","Critical storage key provider failed",o,{event:"critical-storage",stage:"gather"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage key provider failed",u)});continue}const c=Ug(a,e);c&&n(c)}return t}let rf=null;function $g(e){if(rf=e,!(!h||typeof h!="object"))try{h.__cineCriticalStorageGuard=e}catch{try{Object.defineProperty(h,"__cineCriticalStorageGuard",{configurable:!0,writable:!0,value:e})}catch{}}}function Vg(e={}){let t=e&&e.storage?e.storage:null;if(!t)try{t=T()}catch(f){var r={event:"critical-storage",action:"resolve-storage",reason:"resolve-failed",storageType:hr(e&&e.storage?e.storage:null),error:cn(f)};br("warn","Unable to resolve safe storage while ensuring backups",r,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve safe storage while ensuring backups",f)}),t=null}const n={ensured:[],skipped:[],errors:[],timestamp:new Date().toISOString(),storageType:D&&D.type?D.type:"unknown"},o=Kg(e),i=t&&typeof t.getItem=="function"?t:null;for(let f=0;f<o.length;f+=1){const l=o[f],y=l.storage&&typeof l.storage.getItem=="function"?l.storage:i;if(!y||typeof y.getItem!="function"||typeof y.setItem!="function"){n.skipped.push({key:l.key,reason:"unavailable-storage"});continue}let p;try{l.valueProvider?p=l.valueProvider():p=y.getItem(l.key)}catch(k){n.errors.push({key:l.key,reason:"read-failed",error:k});var s={event:"critical-storage",action:"inspect-primary",key:l.key,storageType:hr(y),reason:"read-failed",error:cn(k)};br("warn","Critical storage guard could not inspect "+l.key,s,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not inspect "+l.key,k)});continue}if(p==null){n.skipped.push({key:l.key,reason:"missing"});continue}let d;try{d=y.getItem(l.backupKey)}catch(k){n.errors.push({key:l.key,reason:"backup-read-failed",error:k});var a={event:"critical-storage",action:"inspect-backup",key:l.key,backupKey:l.backupKey,storageType:hr(y),reason:"backup-read-failed",error:cn(k)};br("warn","Critical storage guard could not read backup for "+l.key,a,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not read backup for "+l.key,k)});continue}if(typeof d=="string"){n.skipped.push({key:l.key,reason:"exists"});continue}const g=typeof p=="string"?p:p==null?"":String(p),m=k=>{try{return y.setItem(l.backupKey,k),{success:!0,error:null}}catch(I){return{success:!1,error:I}}},b=(k,I="backup-write-failed")=>{n.errors.push({key:l.key,reason:I,error:k});var w={event:"critical-storage",action:"mirror-backup",key:l.key,backupKey:l.backupKey,storageType:hr(y),reason:I,error:cn(k)};_&&(w.compressed=!0),br("error","Critical storage guard could not mirror "+l.key,w,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.error=="function"&&console.error("Critical storage guard could not mirror "+l.key,k)})},C=typeof g=="string"&&g&&!g.includes(`"${Ut}":true`)&&!tf(l.key);let A=g,_=null,P=m(A);if(!P.success&&P.error){if(!vt(P.error)){b(P.error);continue}if(C){const k=Ln(g);k&&typeof k.serialized=="string"&&k.serialized&&(A=k.serialized,_=k,P=m(A))}if(!P.success&&P.error&&vt(P.error)){const k=new Set;typeof l.backupKey=="string"&&l.backupKey&&k.add(l.backupKey);const I=Bg(l.key);!I&&typeof l.key=="string"&&l.key&&k.add(l.key),!I&&!Tt&&Gg(y,k);const w=lf(y,{skipKeys:Array.from(k)});w&&w.success&&(P=m(A))}if(!P.success){b(P.error,vt(P.error)?"backup-quota-exceeded":"backup-write-failed"),vt(P.error)&&le("critical-backup-quota");continue}}if(n.ensured.push({key:l.key,backupKey:l.backupKey,compressed:!!_}),_&&typeof _.originalLength=="number"&&typeof _.wrappedLength=="number"){const k=_.originalLength-_.wrappedLength,I=_.originalLength>0?Math.round(k/_.originalLength*100):0,w=`Stored compressed critical backup for ${l.key}, reducing storage usage by ${k} characters (${I}%).`;es("critical-backup",l.key,w,k,I)}}if($g(n),n.ensured.length){var c={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||hr(),count:n.ensured.length,timestamp:n.timestamp,entries:n.ensured.map(function(l){return{key:l.key,backupKey:l.backupKey,compressed:!!l.compressed}})};br("info","Critical storage guard mirrored backup copies",c,{event:"critical-storage",stage:"ensure"},function(){if(typeof console<"u"&&typeof console.info=="function"){const l=n.ensured.map(y=>({key:y.key,backupKey:y.backupKey}));console.info("Critical storage guard mirrored backup copies",{count:n.ensured.length,entries:l})}})}if(n.errors.length){var u={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||hr(),count:n.errors.length,timestamp:n.timestamp,reason:"errors-detected",entries:n.errors.map(function(l){return{key:l&&l.key,reason:l&&l.reason,error:cn(l&&l.error)}})};br("warn","Critical storage guard encountered issues",u,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard encountered issues",n.errors)})}return n}function Hg(){return rf}var qg=10,nf="lz-string",of="json-string",ts=[{variant:"utf16",compress:"compressToUTF16",decompress:"decompressFromUTF16"},{variant:"uri-component",compress:"compressToEncodedURIComponent",decompress:"decompressFromEncodedURIComponent"},{variant:"base64",compress:"compressToBase64",decompress:"decompressFromBase64"}],Ut="__cineStorageCompressed",vi=1,wo="lz-string",Fc="lz-string-utf16",sf=ts,en="camera-power-planner:storage-compression",Wg=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(wo):'"'.concat(String(wo),'"'),Yg=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(en):'"'.concat(String(en),'"'),Dc=Sg(),sn=typeof WeakSet=="function"?new WeakSet:null,Jg=40,Qg=128,jr="__cineRawGetItem",Xg=1024,Zg=256,em=.08;function rs(e){if(!Array.isArray(e)||!e.length)return[];var t=ks;if(!t)return[];var r=gg(e),n=mg(r,t);if(n!=null)return n;for(var o=[],i=0;i<e.length;i+=1){var s=e[i];if(s){var a=typeof t[s.compress]=="function"?t[s.compress]:null,c=typeof t[s.decompress]=="function"?t[s.decompress]:null,u=null,f=0;if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{u=JSON.stringify(String(s.variant||"")),typeof u=="string"&&u?f=u.length:(u=null,f=0)}catch{u=null,f=0}a&&c&&o.push({variant:s.variant,compress:a,decompress:c,variantLiteral:f>0?u:null,variantLiteralLength:f})}}var l=o.length?o.slice():[];return r&&bg(r,t,l),l}function af(e,t,r,n){if(typeof e!="string"||!e)return{success:!1};var o=rs(t);if(!o.length)return{success:!1};var i=[];if(r){for(var s=null,a=0;a<o.length;a+=1)if(o[a].variant===r){s=o[a];break}s?i.push(s):typeof console<"u"&&typeof console.warn=="function"&&console.warn("Compression variant ".concat(r," is unavailable while reading ").concat(n||"compressed payload","."))}for(var c=0;c<o.length;c+=1)(!r||o[c].variant!==r)&&i.push(o[c]);for(var u=null,f=0;f<i.length;f+=1){var l=i[f];try{var y=l.decompress(e);if(typeof y=="string"&&y)return{success:!0,value:y,variant:l.variant}}catch(p){u=p,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decompress ".concat(n||"compressed payload"," with ").concat(l.variant," variant"),p)}}return{success:!1,error:u}}function Fa(){return rs(ts).length>0}function tm(e,t){if(typeof e!="string"||!e||!Fa())return null;var r=Uu(Tc,e);if(r.hit)return r.candidate;var n=null,o=rs(ts);if(!o.length)return null;for(var i=0;i<o.length;i+=1){var s=o[i],a=null;try{a=s.compress(e)}catch(f){console.warn("Unable to compress migration backup payload with ".concat(s.variant," variant"),f);continue}if(!(typeof a!="string"||!a||a.length>=e.length)){var c={createdAt:t,compression:nf,compressionVariant:s.variant,encoding:of,data:a,originalSize:e.length,compressedSize:a.length},u;try{u=JSON.stringify(c)}catch(f){console.warn("Unable to serialize compressed migration backup payload",f);continue}typeof u!="string"||!u||u.length>=e.length||(!n||u.length<n.serializedLength)&&(n={serialized:u,serializedLength:u.length,originalSize:e.length,compressedSize:a.length,variant:s.variant})}}return Ku(Tc,e,n),n}function rm(e){if(typeof e!="string"||!e)return{createdAt:0,size:typeof e=="string"?e.length:0};const t={createdAt:0,size:e.length};try{const r=JSON.parse(e);if(r&&typeof r=="object"){let n=null;if(typeof r.createdAt=="string"?n=r.createdAt.trim():typeof r.createdAt=="number"&&Number.isFinite(r.createdAt)&&(t.createdAt=r.createdAt),n){const o=Date.parse(n);Number.isNaN(o)||(t.createdAt=o)}else for(let o=0;o<Li.length;o+=1){const i=Li[o];if(typeof r[i]=="string"){const s=r[i].trim();if(s){const a=Date.parse(s);if(!Number.isNaN(a)){t.createdAt=a;break}}}else if(typeof r[i]=="number"&&Number.isFinite(r[i])){t.createdAt=r[i];break}}}}catch{}return t}function cf(){return Fa()}function Ln(e){if(typeof e!="string"||!e||!cf())return null;var t=Uu(Rc,e);if(t.hit)return t.candidate;var r=rs(sf);if(!r.length)return null;for(var n=typeof Dc=="number"?Dc:0,o=null,i=null,s=null,a=null,c=String(e.length).length,u=0;u<r.length;u+=1){var f=r[u],l=null;try{l=f.compress(e)}catch(P){console.warn("Unable to compress storage payload with ".concat(f.variant," variant"),P);continue}if(!(typeof l!="string"||!l)){var y;try{y=JSON.stringify(l)}catch(P){console.warn("Unable to serialize compressed storage payload candidate",P);continue}if(!(typeof y!="string"||!y)){var p=typeof f.variantLiteral=="string"&&f.variantLiteral?f.variantLiteral:null,d=typeof f.variantLiteralLength=="number"&&f.variantLiteralLength>0?f.variantLiteralLength:0;if(!p&&typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{p=JSON.stringify(String(f.variant||"")),d=typeof p=="string"&&p?p.length:0}catch{p=null,d=0}var g=null,m=Number.POSITIVE_INFINITY;if(n>0&&d>0){var b=String(l.length).length;m=n+y.length+c+b+d}else{var C={[Ut]:!0,version:vi,algorithm:wo,namespace:en,data:l,originalLength:e.length,compressedPayloadLength:l.length,compressionVariant:f.variant};try{g=JSON.stringify(C)}catch(P){console.warn("Unable to serialize compressed storage payload wrapper",P);continue}if(typeof g!="string"||!g)continue;m=g.length}m<e.length&&(!o||m<o.wrappedLength)&&(o={originalLength:e.length,wrappedLength:m,compressedPayloadLength:l.length,compressionVariant:f.variant},i=g,s=y,a=p)}}}if(o&&(!i||typeof i!="string"))if(typeof s!="string"||!s)o=null;else{var A;if(typeof a=="string"&&a)A=a;else if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{A=JSON.stringify(String(o.compressionVariant||""))}catch{A=null}if(typeof A!="string"||!A)o=null;else{var _='{"'.concat(Ut,'":true,"version":').concat(String(vi),',"algorithm":').concat(Wg,',"namespace":').concat(Yg,',"data":').concat(s,',"originalLength":').concat(String(o.originalLength),',"compressedPayloadLength":').concat(String(o.compressedPayloadLength),',"compressionVariant":').concat(A,"}");i=_}}return o&&i&&typeof i=="string"&&i.length<o.originalLength?(o.serialized=i,o.wrappedLength=i.length):o=null,Ku(Rc,e,o),o}function Do(e){if(typeof e!="string")return{success:!1};if(!e||e.charCodeAt(0)!==123)return{success:!1};if(!e.includes(`"${Ut}":true`)||!e.includes(`"namespace":"${en}`))return{success:!1};let t;try{t=JSON.parse(e)}catch(o){return{success:!1,error:o}}if(!t||t[Ut]!==!0)return{success:!1};if(t.namespace!==en)return{success:!1};if(t.version!==vi)return console.warn("Unsupported storage compression version",t.version),{success:!1};if(t.algorithm!==wo&&t.algorithm!==Fc)return console.warn("Unsupported storage compression algorithm",t.algorithm),{success:!1};if(typeof t.data!="string"||!t.data)return{success:!1};if(!cf())return console.warn("Compressed storage payload detected but compression library is unavailable."),{success:!1};var r=null;typeof t.compressionVariant=="string"&&t.compressionVariant?r=t.compressionVariant:t.algorithm===Fc&&(r="utf16");var n=af(t.data,sf,r,"storage payload");return n.success?(!t.compressionVariant&&n.variant&&(t.compressionVariant=n.variant),{success:!0,value:n.value,metadata:t}):{success:!1,error:n.error}}function ns(e,t){if(typeof e=="string"){const r=Do(e);if(!r.success||typeof r.value!="string")return{restored:!1,value:e};try{return{restored:!0,value:JSON.parse(r.value)}}catch(n){return console.warn("Unable to parse decompressed project entry payload",t||"project entry",n),{restored:!1,value:e}}}if(E(e)&&e[Ut]===!0){let r;try{r=JSON.stringify(e)}catch(n){return console.warn("Unable to reserialize compressed project entry wrapper before restoration",t||"project entry",n),{restored:!1,value:e}}if(typeof r=="string"&&r)return ns(r,t)}return{restored:!1,value:e}}function os(e,t){if(typeof e!="string")return;const r=typeof t=="number"&&Number.isFinite(t)?t:Date.now(),n=Be(e);if(n){Pr.set(n,r),n!==e&&Pr.set(e,r);return}Pr.set(e,r)}function nm(e,t){if(!e||typeof e!="object")return;const r=Date.now();Object.keys(e).forEach(n=>{typeof n!="string"||!n||Dt(n)||os(n,r)})}function Vs(e){if(typeof e!="string")return;const t=Be(e);Pr.delete(e),t&&t!==e&&Pr.delete(t)}function om(e){if(typeof e!="string")return"";const t=Be(e);return typeof t=="string"&&t?t:""}function im(e){if(!Ss||typeof Ss.has!="function")return!1;const t=om(e);if(!t)return!1;try{return Ss.has(t)}catch{}return!1}function sm(e,t){const r=ns(e,t);return r.restored?r.value:e}function am(e){return E(e)&&Object.keys(e).forEach(t=>{e[t]=sm(e[t],t)}),e}function cm(e){if(!e||typeof e.add!="function")return;const t=[pe,`${pe}${de}`,Ze,`${Ze}${de}`];for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&e.add(n)}}function lm(e){if(!e||typeof e.add!="function")return;const t=[tt,Bt,lt,Ve];for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n!="string"||!n)continue;const o=Ct(n);for(let i=0;i<o.length;i+=1){const s=o[i];typeof s!="string"||!s||(e.add(s),e.add(`${s}${de}`))}}}function rn(e,t){if(typeof e!="string")return e;const r=Do(e);return r.success?r.value:e}function lf(e,t){if(!e||typeof e.length!="number"||typeof e.key!="function")return{success:!1,compressed:0,freed:0};if(bf(e))return{success:!1,compressed:0,freed:0};const{skipKeys:r=[],limit:n=Jg,minSavings:o=Qg}=t||{},i=new Set;if(Tt&&Zt&&i.add(Zt),Tt&&cm(i),lm(i),Array.isArray(r))for(let y=0;y<r.length;y+=1){const p=r[y];typeof p=="string"&&p&&i.add(p)}const s=typeof o=="number"&&o>0?o:0,a=e.length,c=[];for(let y=0;y<a;y+=1){let p;try{p=e.key(y)}catch{p=null}if(typeof p!="string"||!p||i.has(p))continue;let d;try{d=e.getItem(p)}catch{continue}if(typeof d!="string"||!d||d.includes(`"${Ut}":true`))continue;const g=Ln(d);if(!g||typeof g.serialized!="string"||!g.serialized)continue;const m=typeof g.originalLength=="number"&&typeof g.wrappedLength=="number"?g.originalLength-g.wrappedLength:0;m<s||c.push({key:p,serialized:g.serialized,savings:m>0?m:0,originalLength:typeof g.originalLength=="number"?g.originalLength:0})}if(!c.length)return{success:!1,compressed:0,freed:0};c.sort((y,p)=>p.savings!==y.savings?p.savings-y.savings:p.originalLength-y.originalLength);const u=typeof n=="number"&&n>0?Math.min(n,c.length):c.length;let f=0,l=0;for(let y=0;y<c.length&&f<u;y+=1){const p=c[y];if(!(!p||typeof p.serialized!="string"||!p.serialized))try{e.setItem(p.key,p.serialized),f+=1,l+=p.savings}catch{}}return f===0?{success:!1,compressed:0,freed:0}:(typeof console<"u"&&typeof console.warn=="function"&&(l>0?console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery, freeing approximately ${l} characters.`):console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery.`)),{success:!0,compressed:f,freed:l})}function Tr(e){return e==null?e:rn(e)}function Uc(e){if(!e||typeof e.getItem!="function"||sn&&typeof sn.has=="function"&&sn.has(e))return;const t=e.getItem,r=typeof t=="function"?function(i){return t.call(this,i)}:null,n=function(i){const s=r?r.call(this,i):void 0;return rn(s)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(o){const i=o&&typeof o.message=="string"&&o.message.includes("Cannot redefine property");i||console.warn("Unable to redefine storage.getItem descriptor for compression support",o);try{e.getItem=n}catch(s){const a=s&&typeof s.message=="string"&&s.message.includes("Cannot assign to read only property");return a||console.warn("Unable to patch storage instance getItem for compression support",s),void 0}}if(r)try{Object.defineProperty(e,jr,{configurable:!0,writable:!0,value:r})}catch{try{e[jr]=r}catch{}}if(sn&&typeof sn.add=="function")try{sn.add(e)}catch{}}function um(){if(typeof Storage>"u"){const i=[];h&&typeof h=="object"&&(h.localStorage&&i.push(h.localStorage),h.sessionStorage&&i.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&i.push(global.localStorage),global.sessionStorage&&i.push(global.sessionStorage)),i.forEach(Uc);return}const e=Storage.prototype;if(!e||typeof e.getItem!="function"||e.__cineStorageCompressionPatched)return;const t=e.getItem,r=function(s){return t.call(this,s)},n=function(s){const a=r.call(this,s);return rn(a)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(i){console.warn("Unable to patch Storage.getItem for compression support",i);return}try{Object.defineProperty(e,jr,{configurable:!0,writable:!1,value:r})}catch{try{e[jr]=r}catch{}}try{Object.defineProperty(e,"__cineStorageCompressionPatched",{configurable:!0,writable:!1,value:!0})}catch{e.__cineStorageCompressionPatched=!0}const o=[];h&&typeof h=="object"&&(h.localStorage&&o.push(h.localStorage),h.sessionStorage&&o.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&o.push(global.localStorage),global.sessionStorage&&o.push(global.sessionStorage)),o.forEach(Uc)}function Da(e){if(!e||typeof e!="object")return null;const t=e[jr];if(typeof t=="function")return t;const r=Object.getPrototypeOf(e);return r&&typeof r[jr]=="function"?r[jr]:null}function eo(e,t,r){if(!e||typeof t!="string"||!t)return null;const n=typeof r=="function"?r:Da(e);if(typeof n!="function")return null;try{return n.call(e,t)}catch{return null}}function fm(e,t){if(!e)return[];let r;try{r=Ua(e,{suppressAlerts:!0})}catch(n){return console.warn("Unable to inspect storage while preparing migration backup cleanup",n),[]}return!r||typeof r!="object"?[]:Object.keys(r).filter(n=>!(typeof n!="string"||!n||!n.endsWith(zr)||t&&n===t)).map(n=>{const o=r[n],i=typeof o=="string"?o:o==null?"":String(o),s=rm(i);return{key:n,createdAt:s.createdAt,size:s.size}}).sort((n,o)=>n.createdAt&&o.createdAt&&n.createdAt!==o.createdAt?n.createdAt-o.createdAt:n.createdAt&&!o.createdAt?-1:!n.createdAt&&o.createdAt?1:n.size!==o.size?o.size-n.size:n.key.localeCompare(o.key))}function uf(e,t){const r=fm(e,t);if(!r.length)return[];const n=[],o=r[0];try{e.removeItem(o.key),n.push(o.key)}catch(i){console.warn(`Unable to remove migration backup ${o.key} during cleanup`,i)}return n}function Kc(e,t,r,n){if(!e||typeof e.setItem!="function")return{success:!1,error:null};const o=[];let i=null;if(typeof n!="function")return{success:!1,error:null};const s=()=>{const a=n();return a&&typeof a=="object"&&"error"in a&&a.error&&(i=a.error),a&&a.success?{success:!0,quota:!1}:a&&a.quota?{success:!1,quota:!0,error:a.error||null}:{success:!1,quota:!1,error:a&&a.error?a.error:null}};if(typeof cr=="function"){let a=!1;try{cr(),a=!0}catch(c){console.warn("Unable to clear cached UI storage entries before creating migration backup",c)}if(a){const c=s();if(c.success)return console.warn(`Cleared cached planner data to free storage before creating migration backup for ${t}.`),{success:!0,error:null};if(!c.quota)return{success:!1,error:c.error}}}for(let a=0;a<qg;a+=1){const c=uf(e,r);if(!c.length)break;o.push(...c);const u=s();if(u.success)return console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} to free up storage before creating migration backup for ${t}.`,o),{success:!0,error:null};if(!u.quota)return{success:!1,error:u.error}}return o.length>0&&console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} while attempting to create migration backup for ${t}, but storage quota is still exceeded.`,o),{success:!1,error:i}}function qe(e,t){if(!e||typeof e.getItem!="function"||!t)return null;let r=null;try{r=e.getItem(t)}catch(i){return console.warn(`Unable to inspect existing value for ${t} before creating migration backup`,i),null}if(r==null)return null;let n=r,o=r;if(typeof r=="string"&&r)if(o=rn(r),typeof o=="string"&&o)try{n=JSON.parse(o)}catch{}else n=o;return n&&typeof n=="object"&&(Array.isArray(n)&&n.length===0||!Array.isArray(n)&&Object.keys(n).length===0)||pt(e,t,n),n}var $c=["payload","value","content","entries","snapshot","state","record"],Li=["iso","timestamp","time"];function Jo(e){try{return JSON.stringify(e)}catch(t){return console.warn("Unable to serialize normalized migration backup payload",t),null}}function Vc(e,t){const r=typeof t=="string"&&t?t:null;if(typeof e=="string"){const o=e.trim();if(!o)return{value:r||new Date().toISOString(),changed:!0};const i=Number(o);if(!Number.isNaN(i)&&Number.isFinite(i)&&String(i)===o)try{return{value:new Date(i).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}const s=Date.parse(o);if(!Number.isNaN(s))try{const a=new Date(s).toISOString();return{value:a,changed:a!==o}}catch{return{value:r||new Date().toISOString(),changed:!0}}return{value:o,changed:o!==e}}if(typeof e=="number"&&Number.isFinite(e))try{return{value:new Date(e).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}if(e instanceof Date){const o=e.getTime();if(Number.isFinite(o))try{return{value:e.toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}}return r?{value:r,changed:!0}:{value:new Date().toISOString(),changed:!0}}function pm(e,t){if(typeof e!="string"||!e)return null;const r=typeof t=="string"&&t?t:new Date().toISOString();let n;try{n=JSON.parse(e)}catch{return Jo({createdAt:r,data:e})}if(!n||typeof n!="object")return Jo({createdAt:r,data:n===void 0?e:n});if(Array.isArray(n)){let f=!1;const l=n.map(y=>{if(!y||typeof y!="object")return f=!0,{createdAt:r,data:y};const p=Object.prototype.hasOwnProperty.call(y,"data"),d=y.createdAt,{value:g,changed:m}=Vc(d,r);return p?m||d!==g?(f=!0,{...y,createdAt:g}):y:(f=!0,{createdAt:g,data:y})});return f?Jo(l):null}let o,i=!1;if(Object.prototype.hasOwnProperty.call(n,"data"))o={...n};else{let f=null;for(let l=0;l<$c.length;l+=1){const y=$c[l];if(Object.prototype.hasOwnProperty.call(n,y)){f=y;break}}f?(o={...n},o.data=n[f],delete o[f],i=!0):(o={data:n},i=!0)}let s=o.createdAt,a="createdAt";if(s===void 0)for(let f=0;f<Li.length;f+=1){const l=Li[f];if(Object.prototype.hasOwnProperty.call(n,l)){s=n[l],a=l;break}}const{value:c,changed:u}=Vc(s,r);return o.createdAt=c,a!=="createdAt"&&a&&Object.prototype.hasOwnProperty.call(o,a)&&(delete o[a],i=!0),u&&(i=!0),i?Jo(o):null}function dm(e,t,r,n){const o=pm(r,n);if(o===null)return!0;if(typeof o!="string"||!o)return!1;if(o===r)return!0;try{return e.setItem(t,o),!0}catch(i){return console.warn(`Unable to normalize legacy migration backup for ${t}`,i),!1}}function pt(e,t,r){if(!e||typeof e.setItem!="function"||r==null)return;const n=`${t}${zr}`;let o=!1;if(typeof e.getItem=="function")try{const d=e.getItem(n);if(d!=null){o=!0;const g=new Date().toISOString();dm(e,n,d,g)}}catch(d){console.warn(`Unable to inspect migration backup for ${t}`,d)}if(o)try{const d=e.getItem(n),g=Tr(d);let m=null;try{m=JSON.parse(g)}catch(k){m=g}let b=Array.isArray(m)?m:[m];const C={createdAt:new Date().toISOString(),data:r};b.push(C);const A=5;b.length>A&&(b=b.slice(b.length-A));const _=k=>{try{return e.setItem(n,JSON.stringify(k)),{success:!0}}catch(I){return{success:!1,quota:vt(I),error:I}}};let P=_(b);for(;!P.success&&P.quota&&b.length>1;)b.shift(),console.warn(`Pruning oldest migration backup for ${t} due to quota limit.`),P=_(b);if(P.success)return;if(!P.success&&P.quota){const k=Kc(e,t,n,()=>_(b));if(k&&k.success)return}console.warn("Unable to append to migration backup",P.error);return}catch(d){console.warn("Unable to append to migration backup",d);return}let i;const s=new Date().toISOString();try{i=JSON.stringify({createdAt:s,data:r})}catch(d){console.warn(`Unable to serialize migration backup for ${t}`,d);return}const a=(d,g={})=>{const{logCompression:m=!1,info:b=null}=g||{};try{if(e.setItem(n,d.serialized),m&&b&&!a.compressionLogged){a.compressionLogged=!0;const C=typeof b.serializedLength=="number"?b.serializedLength:b.compressedSize,A=b.originalSize-C,_=A>0?A:0,P=b.originalSize>0?Math.round(_/b.originalSize*100):0,k=`Stored compressed migration backup for ${t} to reduce storage usage by ${_} characters (${P}%) using ${b.variant||"unknown"} variant.`;es("migration-backup",t,k,_,P)}return{success:!0,quota:!1}}catch(C){return{success:!1,quota:vt(C),error:C}}};a.compressionLogged=a.compressionLogged||!1;const c={serialized:i},u=a(c);if(u.success)return;const f=d=>{console.warn(`Unable to create migration backup for ${t}`,d)};if(!u.quota){f(u.error);return}const y=!tf(t)?tm(i,s):null,p=(d,g,m)=>{const b=Kc(e,t,n,()=>a(d,g));if(b&&b.success)return!0;const C=b&&b.error?b.error:m;return f(C),le("migration-backup-quota"),!1};if(y){const d=a(y,{logCompression:!0,info:y});if(d.success)return;if(!d.quota){f(d.error);return}return p(y,{logCompression:!0,info:y},d.error),void 0}p(c,{},u.error)}var Hc=[Ve,Ze,wt,Xt,pe,et,Ot,Rr,tn,ut,Nt,St,ct,ar,Mt,zt,Je],qc=[rt,Lr(),"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",Gt,Ft],Sn="__cameraPowerPlannerStorageAlertShown",ui="__cameraPowerPlannerSessionFallbackAlertShown",fi=!1;h&&(typeof h[Sn]=="boolean"?fi=h[Sn]:h[Sn]=!1);var Hs=!1;h&&(typeof h[ui]=="boolean"?Hs=h[ui]:h[ui]=!1);var ym=["cameras","monitors","video","viewfinders","directorMonitors","iosVideo","videoAssist","media","lenses","batteries","batteryHotswaps","wirelessReceivers"],gm=["motors","handUnits","controllers","distance"],mm=["chargers","cages","powerPlates","cameraSupport","matteboxes","filters","rigging","batteries","cables","videoAssist","media","cardReaders","tripodHeads","tripods","sliders","cameraStabiliser","grip","carts"],hm=()=>typeof navigator<"u"&&navigator&&typeof navigator.storage=="object"?navigator.storage:null,qs="__storage_test__",bm=new Set(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"]),Sm=new Set([22,1014]),wm=new Set([22,1014]);function vt(e){return!e||typeof e!="object"?!1:!!(typeof e.code=="number"&&Sm.has(e.code)||typeof e.number=="number"&&wm.has(e.number)||typeof e.name=="string"&&bm.has(e.name))}function Em(e){if(!e)return!1;try{if(typeof e.length=="number"&&e.length>0)return!0}catch(t){console.warn("Unable to read storage length after quota error",t)}if(typeof e.getItem=="function")try{for(let t=0;t<Hc.length;t+=1){const r=Hc[t],n=Ct(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;const s=`${i}${de}`;if(e.getItem(s)!==null)return!0}}for(let t=0;t<qc.length;t+=1){const r=qc[t],n=Ct(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;if(jt.has(i)){const s=`${i}${de}`;if(e.getItem(s)!==null)return!0}}}}catch(t){console.warn("Unable to inspect known storage keys after quota error",t)}if(typeof e.key=="function")try{const t=typeof e.length=="number"?e.length:0;for(let r=0;r<t;r+=1){const n=e.key(r);if(typeof n=="string"&&n)return!0}}catch(t){console.warn("Unable to iterate storage keys after quota error",t)}return!1}function Ri(e){if(!e)return null;try{e.setItem(qs,"1")}catch(t){if(vt(t)&&Em(e))return console.warn("localStorage quota exceeded. Existing planner data will remain available but new saves may fail.",t),e;throw t}try{e.removeItem(qs)}catch(t){console.warn("Unable to clean up storage test key",t)}return e}function ff(){let e={};return{get length(){return Object.keys(e).length},key(t){const r=Object.keys(e);return t>=0&&t<r.length?r[t]:null},getItem(t){return Object.prototype.hasOwnProperty.call(e,t)?rn(e[t]):null},setItem(t,r){e[t]=String(r)},removeItem(t){delete e[t]},clear(){e={}},keys(){return Object.keys(e)}}}function pf(){const e=Nu();for(let t=0;t<e.length;t+=1){const r=e[t];if(r)try{const n=Ri(r);if(n)return Or=null,{storage:n,type:"local"}}catch(n){console.warn("localStorage is unavailable:",n),Or=r}}if(typeof window<"u")try{if("sessionStorage"in window){const t=Ri(window.sessionStorage);if(t)return Vr(t),console.warn("Falling back to sessionStorage; data persists for this tab only."),hf(),{storage:t,type:"session"}}}catch(t){console.warn("sessionStorage fallback is unavailable:",t)}return le(),{storage:ff(),type:"memory"}}var Or=null,D=pf();function Om(e,t){const r=[],n=[];return!e||!t||typeof t.setItem!="function"?{migratedKeys:r,failedKeys:n}:(Object.keys(e).forEach(o=>{const i=e[o];if(i==null)return;let s=null,a=!1;try{s=t.getItem(o),a=!0}catch(c){console.warn("Unable to inspect localStorage during upgrade",o,c)}if(a&&s!==null&&s!==void 0&&s!==i&&pt(t,o,s),a&&s===i){r.push(o);return}try{t.setItem(o,i),r.push(o)}catch(c){console.warn("Unable to migrate storage key during upgrade",o,c),n.push(o)}}),{migratedKeys:r,failedKeys:n})}function Am(e,t,r){if(!e||!t||typeof t.removeItem!="function")return;(Array.isArray(r)&&r.length>0?r:Object.keys(e)).forEach(o=>{try{t.removeItem(o)}catch(i){console.warn("Unable to remove migrated storage key from fallback",o,i)}})}function Cm(e,t){!e||typeof e.removeItem!="function"||!Array.isArray(t)||t.forEach(r=>{try{e.removeItem(r)}catch(n){console.warn("Unable to roll back migrated storage key after upgrade failure",r,n)}})}function Ua(e,t={}){const r=Object.create(null);if(!e)return r;const{suppressAlerts:n=!1}=t||{},o=i=>{if(typeof i!="string"||!i)return;let s;try{typeof e.getItem=="function"?s=e.getItem(i):Object.prototype.hasOwnProperty.call(e,i)&&(s=e[i])}catch(a){console.warn("Unable to read storage key during snapshot",i,a),n||le("migration-read");return}s!=null&&(r[i]=String(s))};if(typeof e.key=="function"&&typeof e.length=="number"){for(let i=0;i<e.length;i+=1)o(e.key(i));return r}if(typeof e.keys=="function"){try{const i=e.keys();Array.isArray(i)&&i.forEach(o)}catch(i){console.warn("Unable to enumerate storage keys during snapshot",i),n||le("migration-read")}return r}if(typeof e.forEach=="function"){try{e.forEach((i,s)=>{typeof s=="string"&&i!=null&&(r[s]=String(i))})}catch(i){console.warn("Unable to iterate storage entries during snapshot",i),n||le("migration-read")}return r}return Object.keys(e).forEach(o),r}function df(){if(!(!h||typeof h!="object"))try{Object.defineProperty(h,"SAFE_LOCAL_STORAGE",{configurable:!0,get:T});return}catch{try{h.SAFE_LOCAL_STORAGE=T();return}catch(t){console.warn("Unable to refresh SAFE_LOCAL_STORAGE global reference",t)}}}function Se(e,t,r){if(!D||D.type==="memory")return;const n=D.storage;if(!n||r&&r!==n)return;let o=Object.create(null);try{o=Ua(n,{suppressAlerts:!0})}catch(c){console.warn("Unable to capture storage snapshot during downgrade",c)}let i=null,s="memory";if(D.type!=="session"){const c=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let u=0;u<c.length;u+=1){const f=Ma(c[u]);if(!(!f||f===n||r&&f===r))try{const l=Ri(f);if(l){i=l,s="session",Vr(l);break}}catch(l){console.warn("Unable to activate sessionStorage fallback during downgrade",l)}}}i||(i=ff()),Object.keys(o).forEach(c=>{const u=o[c];if(u!=null)try{typeof i.setItem=="function"?i.setItem(c,u):i[c]=u}catch(f){console.warn(`Unable to copy storage entry to ${s==="session"?"sessionStorage":"memory"} during downgrade`,c,f)}}),D={storage:i,type:s},Or=null;const a=s==="session"?"sessionStorage":"in-memory fallback";console.warn(e?`Downgraded planner storage to ${a} after ${e} errors.`:`Downgraded planner storage to ${a} after storage errors.`,t),s==="session"&&hf(),df()}function _m(){if(!D||D.type==="local")return D.storage;const e=Nu(),t=D.storage;let r=null,n=null;for(let a=0;a<e.length;a+=1){const c=e[a];if(!c||c===t||c===Or)continue;let u;try{u=Ri(c)}catch(f){console.warn("localStorage upgrade verification failed",f),Or=c;continue}if(!u||u===t){u||(Or=c);continue}r=c,n=u;break}if(!n)return t;const o=Ua(t),{migratedKeys:i,failedKeys:s}=Om(o,n);return s.length>0?(Cm(n,i),console.warn("Aborting localStorage upgrade because some entries could not be migrated. Continuing to use fallback storage.",s),le("migration-write"),Or=r||n,t):(Am(o,t,i),D={storage:n,type:"local"},Or=null,n)}function T(){return O&&O.driver&&O.driver.storage?O.driver.storage:((!D||!D.storage)&&(D=pf(),typeof console<"u"&&console.log&&console.log("DEBUG: storage initialized with type:",D.type)),D.type!=="local"&&_m(),D.storage)}df();um();var Wn=null;function yf(){const e=hm();if(!(e&&typeof e.persist=="function"))return Promise.resolve({supported:!1,granted:!1,alreadyGranted:!1});if(Wn)return Wn;const n=(async()=>{let o=!1;const i=typeof e.persisted=="function";if(i)try{o=await e.persisted()}catch(s){console.warn("Unable to determine persistent storage state",s)}if(o)return{supported:!0,granted:!0,alreadyGranted:!0};try{const s=await e.persist();if(!s&&i)try{if(await e.persisted())return{supported:!0,granted:!0,alreadyGranted:!0}}catch(a){console.warn("Unable to verify persistent storage after request",a)}return{supported:!0,granted:s,alreadyGranted:!1}}catch(s){return console.warn("Persistent storage request failed",s),{supported:!0,granted:!1,alreadyGranted:!1,error:s}}})().then(o=>((!o||o.granted!==!0)&&(Wn=null),o),o=>{throw Wn=null,o});return Wn=n,n}typeof window<"u"&&typeof navigator<"u"&&yf();function E(e){if(e===null||typeof e!="object")return!1;let t;try{t=Object.getPrototypeOf(e)}catch{return!1}if(t===null||t===Object.prototype)return!0;if(Object.getPrototypeOf(t)===null&&typeof t.constructor=="function"){const n=t.constructor.name;return n==="Object"||n===""}return!1}function re(e){if(!e||typeof e!="object")return!1;if(Object.prototype.toString.call(e)==="[object Map]")return!0;if(typeof Map<"u")try{if(e instanceof Map)return!0}catch{}return typeof e.size=="number"&&typeof e.entries=="function"&&typeof e.forEach=="function"&&typeof e.get=="function"&&typeof e.set=="function"}function gf(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(typeof e=="symbol")return e.description||e.toString();if(e&&typeof e=="object")try{const t=JSON.stringify(e);if(t&&t!=="{}")return t}catch{}try{return String(e)}catch{}return null}function ne(e){if(!re(e))return null;const t=Object.create(null),r=(o,i)=>{const s=gf(o);s!=null&&(Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i))};let n=!1;if(typeof e.entries=="function")try{const o=e.entries();if(o&&typeof o.next=="function"){for(let i=o.next();!i.done;i=o.next()){const s=i&&i.value;Array.isArray(s)&&s.length>=2&&r(s[0],s[1])}n=!0}}catch(o){console.warn("Unable to iterate map-like value entries",o)}if(!n&&typeof e.forEach=="function")try{e.forEach((o,i)=>{r(i,o)}),n=!0}catch(o){console.warn("Unable to iterate map-like value via forEach",o)}return!Object.keys(t).length&&!n?null:t}var Eo=/^long[\s_-]?gop$/i;function Wc(e){if(typeof e!="string")return null;var t=e.trim();if(!t)return null;var r=t.toLowerCase();return r==="utf16"||r==="utf-16"?"utf16":r==="uri-component"||r==="uri_component"||r==="encoded-uri-component"||r==="uri"?"uri-component":r==="base64"?"base64":Eo.test(r)?"utf16":null}function Yc(e){if(typeof e!="string")return e;const t=e.trim();return Eo.test(t)?"long-gop":e}function km(e){return typeof e!="string"?e:Eo.test(e)?"long-gop":e}function fe(e,t){if(e===null||typeof e!="object")return Yc(e);const r=t||new WeakSet;if(r.has(e))return e;if(r.add(e),Array.isArray(e)){let n=!1;const o=e.map(i=>{const s=fe(i,r);return s!==i&&(n=!0),s});return n?o:e}if(E(e)){let n=!1;const o={};return Object.keys(e).forEach(i=>{const s=km(i),a=e[i],c=fe(a,r);(s!==i||c!==a)&&(n=!0),o[s]=c}),n?o:e}return Yc(e)}function Ti(e){if(!Array.isArray(e))return{normalized:Array.isArray(e)?e:[],changed:!1};let t=!1;return{normalized:e.map(n=>{if(n==null)return n;const o=fe(n);return o!==n&&(t=!0),o}),changed:t}}function Ka(e){if(typeof e!="string")return{timestamp:Number.NEGATIVE_INFINITY,label:""};const t=(r,n={})=>{const i=e.slice(r.length).split("-");if(i.length<5)return null;const[s,a,c,u,f]=i,l=Number.parseInt(s,10),y=Number.parseInt(a,10)-1,p=Number.parseInt(c,10),d=Number.parseInt(u,10),g=Number.parseInt(f,10);if([l,y,p,d,g].some(k=>Number.isNaN(k)))return null;let m=!1,b=0,C=5;if(i.length>C){const k=i[C];if(/^\d{1,2}$/u.test(k))m=!0,b=Number.parseInt(k,10),C+=1;else if(n.requireSeconds)return null}else if(n.requireSeconds)return null;const A=i.slice(C).join("-").trim(),P=new Date(l,y,p,d,g,m?b:0,0).getTime();return Number.isNaN(P)?null:{timestamp:P,label:A}};if(e.startsWith(Fe)){const r=t(Fe);return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}if(e.startsWith(At)){const r=t(At,{requireSeconds:!1});return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}return{timestamp:Number.NEGATIVE_INFINITY,label:""}}function Ni(e,t){return!E(e)||typeof t!="string"?[]:Object.keys(e).filter(r=>typeof r=="string"&&r.startsWith(t)).map(r=>{const{timestamp:n,label:o}=Ka(r);return{key:r,timestamp:n,label:o}}).sort((r,n)=>r.timestamp!==n.timestamp?r.timestamp-n.timestamp:r.key.localeCompare(n.key))}function Pm(e){if(!(!e||typeof e!="object")){try{e[qr]=!0}catch{try{Object.defineProperty(e,qr,{configurable:!0,enumerable:!0,writable:!0,value:!0})}catch{}}if(E(e.projectInfo))try{e.projectInfo[qr]=!0}catch{}}}function jm(e){return!e||typeof e!="object"?!1:!!(e[qr]===!0||E(e.projectInfo)&&e.projectInfo[qr]===!0)}function $a(e,t){return!E(e)||typeof t!="string"?!1:jm(e[t])}function mf(e){if(!e||typeof e!="object")return"";if(typeof e.label=="string"){const t=e.label.trim();if(t)return t}if(typeof e.key=="string"&&e.key.trim()){const t=e.key.trim();return t.startsWith(Fe)||t.startsWith(At)?"__auto-backup:unlabeled__":t}return"__auto-backup:unlabeled__"}function Im(e,t){if(!E(e)||!t||typeof t.key!="string")return"undefined";const r=Object.prototype.hasOwnProperty.call(e,t.key)?e[t.key]:void 0;try{let n=r;if(E(r)&&r[hn]){const i=be(r,{stripMetadata:!0}),s=i[hn];if(s&&typeof s=="object")try{const a=$s(s,t.key);s.payload=a.payload,Object.prototype.hasOwnProperty.call(s,"payloadCompression")&&delete s.payloadCompression}catch(a){console.warn("Failed to expand automatic backup payload for signature comparison",t.key,a)}n=i}const o=Ks(n,{stripMetadata:!0});return _e(o)}catch(n){return console.warn("Failed to create stable signature for automatic backup entry",n),"undefined"}}function _e(e,t){const r=t||(typeof WeakSet=="function"?{seen:new WeakSet,reportedCycle:!1}:null),n=r&&r.seen?r.seen:null,o=(i,s)=>{if(!n)return s();if(n.has(i))return!r.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Detected circular reference while computing automatic backup signature. Using a placeholder token to keep backups stable."),r.reportedCycle=!0,Qu;n.add(i);try{return s()}finally{n.delete(i)}};if(e===null)return"null";if(e===void 0)return"undefined";if(Array.isArray(e))return o(e,()=>{let i="[";for(let s=0;s<e.length;s+=1)s>0&&(i+=","),i+=_e(e[s],r);return i+="]",i});if(e instanceof Date)return o(e,()=>{const i=e.getTime();return Number.isNaN(i)?"date:invalid":`date:${i}`});if(E(e))return o(e,()=>{const i=Object.keys(e).sort();let s="{";for(let a=0;a<i.length;a+=1){const c=i[a];a>0&&(s+=","),s+=`${JSON.stringify(c)}:${_e(e[c],r)}`}return s+="}",s});if(e&&typeof e=="object")return o(e,()=>`${typeof e}:${String(e)}`);if(typeof e=="number")return Number.isNaN(e)?"number:NaN":Number.isFinite(e)?`number:${e}`:e>0?"number:Infinity":"number:-Infinity";if(typeof e=="bigint")return`bigint:${e.toString()}`;if(typeof e=="boolean")return e?"boolean:true":"boolean:false";if(typeof e=="string"){const i=Do(e);if(i.success&&typeof i.value=="string")try{const s=JSON.parse(i.value);return _e(s,r)}catch(s){console.warn("Unable to decode compressed string while computing stable value signature",s)}return`string:${e}`}return typeof e=="symbol"?`symbol:${String(e)}`:typeof e=="function"?`function:${e.name||"anonymous"}`:`${typeof e}:${String(e)}`}function Ws(e,t){if(!E(e)||!Array.isArray(t)||t.length<2)return null;const r=new Map;for(let n=t.length-1;n>=0;n-=1){const o=t[n];if(!o||typeof o.key!="string"||$a(e,o.key))continue;const i=mf(o);let s=r.get(i);s||(s=new Map,r.set(i,s));const a=Object.prototype.hasOwnProperty.call(e,o.key)?e[o.key]:void 0,c=_e(a),u=s.get(c);if(u&&typeof u.key=="string")return delete e[o.key],t.splice(n,1),typeof console<"u"&&typeof console.info=="function"&&console.info("Removed duplicate automatic backup while preserving newer copy.",{removedKey:o.key,preservedKey:u.key,label:i}),o.key;s.set(c,{key:o.key,signature:c})}return null}function Jc(e,t){const r=[];for(;;){const n=Ws(e,t);if(!n)break;r.push(n)}return r}function Qc(e,t,r,n){if(!E(e)||!Array.isArray(t)||t.length<=r)return;const o=new Map;for(let s=0;s<t.length;s+=1){const a=t[s];if(!a||typeof a.key!="string")continue;const c=mf(a),u=Im(e,a),f=`${c}__${u}`,l=o.get(f);l?l.push(s):o.set(f,[s])}const i=Array.from(o.values()).filter(s=>Array.isArray(s)&&s.length>1).flatMap(s=>s.slice(0,-1)).sort((s,a)=>s-a);if(!i.length){t.length>r&&console.warn("Skipped trimming automatic backups because all remaining versions are unique.",{limit:r,total:t.length});return}for(let s=i.length-1;s>=0&&t.length>r;s-=1){const a=i[s],c=t[a];!c||typeof c.key!="string"||$a(e,c.key)||(delete e[c.key],t.splice(a,1),n.push(c.key))}t.length>r&&console.warn("Unable to trim automatic backups down to the configured limit without losing unique data.",{limit:r,remaining:t.length})}function Va(e){if(!E(e))return[];const t=[],r=Ni(e,Fe);t.push(...Jc(e,r)),r.length>fn&&Qc(e,r,fn,t);const n=Ni(e,At);return t.push(...Jc(e,n)),n.length>Bc&&Qc(e,n,Bc,t),t.length>0&&console.warn(`Removed ${t.length} older automatic backup${t.length>1?"s":""} to stay within storage limits.`,t),t}function Ys(e,t={}){if(!E(e))return null;const{force:r=!1}=t,n=(f,{respectRename:l=!0}={})=>{if(!Array.isArray(f)||f.length===0)return null;for(let y=0;y<f.length;y+=1){const p=f[y];if(!p||typeof p.key!="string")continue;const d=Object.prototype.hasOwnProperty.call(e,p.key),g=d?e[p.key]:void 0;if(!d||g===void 0||g===null||typeof g!="object")return delete e[p.key],p.key;if(!(l&&$a(e,p.key)))return delete e[p.key],p.key}return null},o=Ni(e,Fe),i=Ws(e,o);if(i)return i;const s=Ni(e,At),a=Ws(e,s);if(a)return a;const c=n(s,{respectRename:!1});if(c)return c;s.length>0&&console.warn("Unable to free space by removing pre-deletion backups because all copies appear to be protected.");const u=n(o,{respectRename:!r});return u||(o.length>0&&console.warn("Unable to free space by removing automatic backups because the remaining copies were renamed or protected."),null)}function vm(e){if(!e||typeof e!="object")return"";if(typeof e.note=="string"){const t=e.note.trim();if(t)return t}if(typeof e.createdAt=="string"){const t=e.createdAt.trim();if(t)return t}return typeof e.id=="string"?e.id:""}function Js(e){if(!Array.isArray(e)||e.length===0)return null;const t=r=>{const[n]=e.splice(r,1);return{removed:n,label:vm(n)}};for(let r=e.length-1;r>=0;r-=1){const n=e[r];if(!n||typeof n!="object"||!Array.isArray(n.rules))return t(r)}return t(e.length-1)}function Lm(e){if(!e||typeof e.getItem!="function"||typeof e.removeItem!="function")return!1;const t=`${ut}${zr}`,r=[];try{const n=e.getItem(t);n!=null&&(e.removeItem(t),r.push(t))}catch(n){console.warn("Unable to inspect automatic gear backup migration snapshot while recovering storage quota.",n)}try{const n=uf(e,t);Array.isArray(n)&&n.length>0&&r.push(...n)}catch(n){console.warn("Unable to prune migration backups while recovering storage for automatic gear backups.",n)}return r.length>0?(console.warn(`Removed ${r.length} migration backup${r.length>1?"s":""} while freeing storage for automatic gear backups.`,r),!0):!1}function Qs(){if(typeof cr!="function")return!1;try{return cr(),console.warn("Cleared cached planner data to free up storage space before saving automatic gear backups."),!0}catch(e){console.warn("Unable to clear cached planner data while recovering storage for automatic gear backups.",e)}return!1}function Rm(e){return e?!(e==="migration-read"&&typeof D<"u"&&D&&D.type&&D.type!=="memory"):!0}function le(e){if(!Rm(e)||(h&&typeof h[Sn]=="boolean"&&(fi=h[Sn]),fi)||(fi=!0,h&&(h[Sn]=!0),typeof window>"u"||typeof window.alert!="function"))return;let t="Storage error: Unable to access local data. Changes may not be saved.";try{if(typeof window<"u"&&window.texts){const r=window.texts,n=window.currentLang||"en",o=r[n]?n:"en";t=r[o]?.alertStorageError||t}}catch{}window.alert(t)}function hf(){if(Hs||(Hs=!0,h&&(h[ui]=!0),typeof window>"u"||typeof window.alert!="function"))return;let e="Warning: Local storage is unavailable. Data will only persist for this browser tab.";try{if(typeof window<"u"&&window.texts){const t=window.texts,r=window.currentLang||"en",n=t[r]?r:"en";e=t[n]?.alertSessionFallback||e}}catch{}window.alert(e)}function Rn(e){if(typeof window>"u")return null;try{return window[e]}catch(t){return console.warn(`Unable to access ${e} during legacy migration`,t),null}}function Oo(e){if(!Array.isArray(e)||e.length===0)return[];const t=[],r=new Set;for(let n=0;n<e.length;n+=1){const o=e[n];!o||typeof o.getItem!="function"||r.has(o)||(r.add(o),t.push(o))}return t}function Tm(e,t,r,n,o={}){if(!e||typeof e.getItem!="function")return!1;const{keepLegacy:i=!1}=o;let s;try{s=e.getItem(r)}catch(c){return console.warn(`Unable to read legacy storage key ${r}`,c),le("migration-read"),!1}if(s==null)return!1;const a=t&&typeof t.setItem=="function"?t:e;try{const c=a.getItem(n);if(c!=null){if(!i&&(e!==a||r!==n))try{e.removeItem(r)}catch(u){console.warn(`Unable to remove legacy storage key ${r}`,u)}return!1}}catch(c){console.warn(`Unable to inspect destination storage for ${n}`,c)}try{a.setItem(n,s)}catch(c){return console.warn(`Unable to migrate legacy storage key ${r}`,c),!1}if(!i)try{e.removeItem(r)}catch(c){console.warn(`Unable to remove legacy storage key ${r} after migration`,c)}return!0}function Qo(e,t,r,n,o){let i=!1;for(let s=0;s<e.length;s+=1)Tm(e[s],t,r,n,o)&&(i=!0);return i}function Nm(){const e=T(),t=Oo([Rn("localStorage"),e]),r=Oo([Rn("sessionStorage"),typeof sessionStorage<"u"?sessionStorage:null]),n="cinePowerPlanner_";[{legacy:`${n}devices`,modern:Ve},{legacy:`${n}setups`,modern:Ze},{legacy:`${n}session`,modern:wt,includeSession:!0},{legacy:`${n}feedback`,modern:Xt},{legacy:`${n}project`,modern:pe},{legacy:`${n}projects`,modern:pe},{legacy:`${n}favorites`,modern:et},{legacy:`${n}ownGear`,modern:Bt},{legacy:`${n}schemaCache`,modern:Ot},{legacy:`${n}autoGearRules`,modern:Rr},{legacy:`${n}autoGearBackups`,modern:ut},{legacy:`${n}autoGearSeeded`,modern:tn},{legacy:`${n}autoGearPresets`,modern:Nt},{legacy:`${n}autoGearActivePreset`,modern:St},{legacy:`${n}autoGearAutoPreset`,modern:ct},{legacy:`${n}autoGearShowBackups`,modern:ar},{legacy:`${n}autoGearBackupRetention`,modern:zt},{legacy:`${n}autoGearMonitorDefaults`,modern:Mt},{legacy:`${n}customFonts`,modern:kr,updateFontKey:!0}].forEach(({legacy:i,modern:s,includeSession:a=!1,updateFontKey:c=!1})=>{const u=Qo(t,e,i,s);Qo(t,e,`${i}${de}`,`${s}${de}`),a&&(Qo(r,null,i,s),Qo(r,null,`${i}${de}`,`${s}${de}`)),c&&u&&h&&(h.CUSTOM_FONT_STORAGE_KEY===i&&(h.CUSTOM_FONT_STORAGE_KEY=s),h.CUSTOM_FONT_STORAGE_KEY_NAME===i&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=s))})}function ke(){Nm()}function bf(e){if(!e||typeof e.getItem!="function")return!1;if(mn&&typeof mn.has=="function"&&mn.has(e))return!0;if(D&&D.type==="session"&&D.storage===e)return Vr(e),!0;const t=T();if(t&&D&&D.type==="session"&&t===e)return Vr(e),!0;const r=[h,h&&h.__cineGlobal?h.__cineGlobal:null,h&&h.window?h.window:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let n=0;n<r.length;n+=1){const o=Ma(r[n]);if(o&&o===e)return Vr(o),!0}return!1}function Ne(e,t,r,n=null,o={}){if(!e)return n;const{disableBackup:i=!1,backupKey:s,validate:a,restoreIfMissing:c=!1,alertOnFailure:u=null,migrationBackupKey:f}=o||{},l=typeof s=="string"&&s?s:`${t}${de}`,y=!i&&l&&l!==t,p=Mu()||h&&h.__cineJustFactoryReset,d=y&&!p,g=!p,m=(()=>{const N=new Set,z=[],M=$=>{typeof $!="string"||!$||N.has($)||(N.add($),z.push($))};typeof f=="string"&&f&&M(f);const x=Ct(t);for(let $=0;$<x.length;$+=1)M(`${x[$]}${zr}`);return z})(),b=Da(e);let C=typeof b=="function"?eo(e,t,b):void 0,A=!1;const _=(N,z)=>{if(N==null)return{ok:!1,reason:"missing"};const M=typeof N=="string"?rn(N):N;if(typeof N=="string"&&N&&M===N&&N.includes(`"${Ut}":true`)&&N.includes(`"namespace":"${en}`))return console.warn(`${r} Compressed value could not be decoded${z?` (${z})`:""}.`),A=!0,{ok:!1,reason:"compressed"};try{const x=JSON.parse(M);return typeof a=="function"&&!a(x)?(console.warn(`${r} Invalid data${z?` (${z})`:""}.`),A=!0,{ok:!1,reason:"invalid"}):{ok:!0,value:x,raw:N,normalizedRaw:M}}catch(x){return console.error(`${r}${z?` (${z})`:""}`,x),A=!0,{ok:!1,reason:"error"}}};let P=null;try{P=e.getItem(t)}catch(N){console.error(`${r} (read)`,N),Se("read access",N,e),A=!0}typeof C>"u"&&typeof b=="function"&&(C=eo(e,t,b)),P==null&&C==null&&Qt(e,t);const k=kg(e,t,P,C);if(k.hit)return k.value;const I=_(P,"");if(I.ok){const N=typeof I.normalizedRaw=="string"&&I.normalizedRaw?I.normalizedRaw:typeof I.raw=="string"&&I.raw?I.raw:null,z=typeof C=="string"&&C?C:typeof I.raw=="string"&&I.raw?I.raw:null;return Ue(e,t,z,N,I.value),I.value}const w=!I.ok&&I.reason==="missing",S=()=>{if(!m.length)return{success:!1,shouldAlert:!1};for(let N=0;N<m.length;N+=1){const z=m[N];let M=null,x;try{M=e.getItem(z)}catch(R){return console.error(`${r} (migration backup read)`,R),Se("read access",R,e),{success:!1,shouldAlert:!0}}if(typeof b=="function"&&(x=eo(e,z,b)),M==null&&x==null){Qt(e,z);continue}const $=M??x,nt=On({key:z,value:$,type:"migration-backup"});if(typeof nt>"u")continue;let me=nt;if(typeof me=="string"){const R=me.trim();if(R)try{me=JSON.parse(R)}catch{}else me=""}if(typeof a=="function"&&!a(me)){console.warn(`Ignored migration backup for ${t} because it failed validation.`);continue}Ue(e,z,typeof x=="string"&&x?x:typeof $=="string"&&$?$:null,typeof $=="string"&&$?$:typeof x=="string"&&x?x:null,me);let ot=null;try{ot=JSON.stringify(me)}catch(R){console.warn(`Unable to serialize recovered migration backup for ${t}`,R),ot=null}let xr=null,it=!1;if(ot!==null){let R=ot;const K=typeof ot=="string"?Ln(ot):null;K&&typeof K.serialized=="string"&&(R=K.serialized);try{e.setItem(t,R),xr=R}catch(V){console.warn(`Unable to restore primary copy for ${t} from migration backup`,V),Se("write access",V,e),it=!0}}else it=!0;xr!==null?Ue(e,t,xr,ot,me):ot!==null?Ue(e,t,ot,ot,me):Ue(e,t,null,null,me),console.warn(xr!==null?`Recovered ${t} from migration backup copy.`:`Recovered ${t} from migration backup copy but could not rewrite the primary entry.`);try{e.removeItem(z),Qt(e,z)}catch(R){console.warn(`Unable to remove migration backup ${z} after recovery`,R)}return{success:!0,value:me,shouldAlert:it}}return{success:!1,shouldAlert:!1}},v=d&&(A||c||w);if(v){let N=null;try{N=e.getItem(l)}catch(x){console.error(`${r} (backup read)`,x),Se("read access",x,e),A=!0}const z=typeof b=="function"?eo(e,l,b):void 0,M=_(N,"backup");if(M.ok&&((A||w)&&console.warn(`Recovered ${t} from backup copy.`),M.raw!==null&&M.raw!==void 0)){let x=null;try{if(typeof M.raw=="string"){const nt=typeof M.normalizedRaw=="string"&&M.normalizedRaw?M.normalizedRaw:M.raw,me=Ln(nt);me&&typeof me.serialized=="string"?(e.setItem(t,me.serialized),x=me.serialized):nt!==M.raw?(e.setItem(t,nt),x=nt):(e.setItem(t,M.raw),x=M.raw)}else e.setItem(t,M.raw),x=typeof M.raw=="string"?M.raw:null}catch(nt){console.warn(`Unable to restore primary copy for ${t} from backup`,nt),x=null}const $=typeof M.normalizedRaw=="string"&&M.normalizedRaw?M.normalizedRaw:typeof M.raw=="string"&&M.raw?M.raw:null,Kt=typeof z=="string"&&z?z:typeof M.raw=="string"&&M.raw?M.raw:null;return Ue(e,l,Kt,$,M.value),typeof x=="string"&&x&&Ue(e,t,x,$,M.value),M.value}}const B=g&&m.length>0&&(w||c||A);if(B){const N=S();if(N.success){if(N.shouldAlert&&(A=!0),m.length){const z=m[0].key;try{e.removeItem(z),e[jr]&&e.removeItem&&e.removeItem(z)}catch(M){console.warn("Post-migration cleanup error:",M)}}return N.value}N.shouldAlert&&(A=!0)}return A&&le(u),Qt(e,t),w&&!v&&!B&&console.debug(`[Storage] Returning default for ${t} (No primary, no backups found)`),n}function Oe(e,t,r,n,o={}){if(!e){console.warn("DEBUG: saveJSONToStorage NO STORAGE");return}if(Mu()){console.warn("DEBUG: saveJSONToStorage RESET ACTIVE");return}const{disableBackup:i=!1,backupKey:s,onQuotaExceeded:a,enableCompressionSweep:c=!0,disableCompression:u=!1,forceCompressionOnQuota:f=!1}=o||{},l=typeof s=="string"&&s?s:`${t}${de}`,y=!i&&l&&l!==t,p=bf(e),d=p||!!u,g=p?!1:f===!0,m=Da(e),b=R=>eo(e,R,m);let C,A=!1,_,P=!1,k=!1,I=!1;const w=()=>{C=void 0,A=!1,_=void 0,P=!1,k=!1,I=!1},S=()=>{if(A)return C;A=!0;try{C=JSON.stringify(r)}catch(R){C=null,console.error(n,R),le()}return C},v=()=>{if(_!==void 0)return _&&typeof _.serialized=="string"?_.serialized:null;const R=S();if(typeof R!="string"||!R)return _=null,null;const K=Ln(R);return!K||typeof K.serialized!="string"?(_=null,null):(_=K,K.serialized)},B=()=>{if(P){const K=v();if(typeof K=="string")return K;P=!1}const R=S();return typeof R=="string"?R:null},N=({force:R=!1}={})=>{const K=R&&g;if(d&&!K)return k=!0,!1;if(P||k&&!K)return!1;k=!0;const V=S();if(typeof V!="string"||!V)return!1;const Pe=v();return typeof Pe!="string"||!Pe||Pe.length>=V.length?!1:(P=!0,!0)},z=()=>{if(!P||!_||I)return;const{originalLength:R,wrappedLength:K}=_;if(typeof R=="number"&&typeof K=="number"&&K<R){const V=R-K,Pe=R>0?Math.round(V/R*100):0,te=`Stored compressed value for ${t} to reduce storage usage by ${V} characters (${Pe}%).`;es("storage-value",t,te,V,Pe)}I=!0},M=()=>{if(d){k=!0;return}if(P||k)return;const R=S();if(typeof R!="string"||!R||R.length<Xg)return;const K=v();if(typeof K!="string"||!K)return;const V=R.length-K.length;if(V<Zg||(R.length>0?V/R.length:0)<em)return;const te=b(t);typeof te=="string"&&te===K||(P=!0,k=!0)};let x,$=!1,Kt=!1,nt=0,me=!1,as=!1;M();const xn=()=>(nt+=1,nt>Dg?(me=!0,console.warn(`Exceeded maximum storage recovery attempts while saving ${t}.`),!1):!0),ot=(R,K)=>{if(!R||typeof R.length!="number"||typeof R.key!="function")return{success:!1,freed:0};const{skipKeys:V=[]}=K||{},Pe=new Set(V);Tt&&Zt&&Pe.add(Zt);const te=[],Me=R.length;for(let ze=0;ze<Me;ze+=1){let se;try{se=R.key(ze)}catch{continue}if(!(!se||Pe.has(se))){if(se.endsWith("__legacyMigrationBackup")){te.push({key:se,priority:1,size:0});continue}if(se.endsWith("__backup")){te.push({key:se,priority:2,size:0});continue}if(se===Ot||se===za){te.push({key:se,priority:3,size:0});continue}if(se.startsWith(Rt)&&se.includes("auto-backup-")){te.push({key:se,priority:4,size:0});continue}}}if(!te.length)return{success:!1,freed:0};te.sort((ze,se)=>ze.priority-se.priority);let Ge=0,$t=0;for(let ze=0;ze<te.length;ze+=1){const se=te[ze];try{const Vt=R.getItem(se.key),Bn=Vt?Vt.length:0;if(R.removeItem(se.key),Qt(R,se.key),Ge+=Bn,$t+=1,console.warn(`[Storage Cleanup] Removed ${se.key} to free ${Bn} chars.`),Ge>5e5)break}catch(Vt){console.warn(`[Storage Cleanup] Failed to remove ${se.key}`,Vt)}}return{success:$t>0,freed:Ge}},xr=(R,K={})=>{if(!vt(R))return!1;if(typeof a=="function")try{if(a(R,{storage:e,key:t,value:r,...K})===!0)return!0}catch(te){const Me=K&&K.isBackup?" (backup)":"";console.error(`Error while handling quota exceed for ${t}${Me}`,te)}if(!as&&c!==!1){as=!0;const te=[t];y&&typeof l=="string"&&l&&l!==t&&te.push(l),K&&typeof K.backupKey=="string"&&K.backupKey&&te.push(K.backupKey);const Me=lf(e,{skipKeys:te});if(Me&&Me.success)return!0}const V=[t];y&&typeof l=="string"&&l&&V.push(l);const Pe=ot(e,{skipKeys:V});return!!(Pe&&Pe.success)};let it=0;for(;it<Fg;){it+=1;const R=B();if(typeof R!="string")return;const K=S(),V=typeof K=="string"&&K?K:null;let Pe=!1,te,Me=!1,Ge=null,$t=null,ze=null;if(typeof e.getItem=="function")try{const oe=e.getItem(t);if(oe===R)Pe=!0,$t=R;else if(P){const Le=b(t);typeof Le=="string"&&($t=Le,Le===R&&(Pe=!0))}else typeof oe=="string"&&($t=oe)}catch(oe){console.warn(`Unable to inspect existing value for ${t}`,oe)}if(y&&typeof e.getItem=="function")try{te=e.getItem(l),Me=typeof te=="string",Me&&P?(Ge=b(l),typeof Ge=="string"&&(ze=Ge)):Me&&(ze=te)}catch(oe){console.warn(`Unable to inspect existing backup for ${t}`,oe)}!$&&Me&&typeof te=="string"&&(x=te,$=!0);const se=(()=>{if(!y)return[];const oe=[];if(P){const Le=S();typeof Le=="string"&&Le&&oe.push({serialized:Le,compressed:!1}),typeof R=="string"&&R&&(!oe.length||oe[oe.length-1].serialized!==R)&&oe.push({serialized:R,compressed:!0})}else typeof R=="string"&&R&&oe.push({serialized:R,compressed:!1});return oe})(),Vt=se.length?se[0]:null,Bn=Me&&Vt&&typeof Vt.serialized=="string"&&(te===Vt.serialized||typeof Ge=="string"&&Ge===Vt.serialized);if(Pe&&(!y||Bn)){if(V&&(Ue(e,t,P&&typeof $t=="string"&&$t?$t:R,V,r),y&&Me)){const Le=P&&typeof Ge=="string"&&Ge?Ge:ze;typeof Le=="string"&&Le&&Ue(e,l,Le,V,r)}return}if(!Pe)try{e.setItem(t,R),z(),V&&Ue(e,t,R,V,r)}catch(oe){if(xr(oe)){if(w(),!xn())break;it>0&&(it-=1);continue}if(!me&&N({force:g})){if(!xn())break;it>0&&(it-=1);continue}console.error(n,oe),Se("write access",oe,e),le();return}if(!y)return;if(Bn){if(V&&Me){const oe=P&&typeof Ge=="string"&&Ge?Ge:ze;typeof oe=="string"&&oe&&Ue(e,l,oe,V,r)}return}const lc=(()=>{const oe=se.length?se:[{serialized:R,compressed:P}];let Le=null,cs=!1,$o=null;const uc=fr=>{try{return e.setItem(l,fr.serialized),fr.compressed&&z(),Kt=!1,!0}catch(dt){return Le=dt,!1}};for(let fr=0;fr<oe.length;fr+=1){const dt=oe[fr];if($o=dt,uc(dt)){if(V){const Gn=dt.compressed&&V?V:dt.serialized;Ue(e,l,dt.serialized,Gn,r)}return"success"}if(!vt(Le))break;if(!cs&&Me)try{if(e.removeItem(l),Qt(e,l),cs=!0,Kt=!0,Me=!1,uc(dt)){if(V){const Gn=dt.compressed&&V?V:dt.serialized;Ue(e,l,dt.serialized,Gn,r)}return"success"}}catch(Gn){console.warn(`Unable to remove previous backup for ${t}`,Gn)}}if(vt(Le)&&(xr(Le,{serialized:$o&&typeof $o.serialized=="string"?$o.serialized:R,backupKey:l,isBackup:!0})||!me&&N({force:g})))return w(),xn()?"retry":"failure";if(cs&&typeof te=="string")try{e.setItem(l,te),V&&Ue(e,l,te,V,r),Kt=!1}catch(fr){console.warn(`Unable to restore previous backup for ${t}`,fr)}return console.warn(`Unable to update backup copy for ${t}`,Le),le(),"failure"})();if(lc==="success")return;if(lc==="retry"){it>0&&(it-=1);continue}if(me)break;return}if($&&Kt&&typeof x=="string")try{e.setItem(l,x),Qt(e,l)}catch(R){console.warn(`Unable to restore preserved backup for ${t}`,R)}console.error(n,new Error("Unable to save value after multiple attempts.")),le()}function ce(e,t,r,n={}){if(!e)return;O&&O.removeItem(t).catch(()=>{});const{disableBackup:o=!1,backupKey:i,disableMigrationCleanup:s=!1}=n||{},a=typeof i=="string"&&i?i:`${t}${de}`,c=!o&&a&&a!==t;Qt(e,t),c&&Qt(e,a),t===pe&&or();try{e.removeItem(t)}catch(u){console.error(r,u),Se("deletion",u,e),le()}if(c)try{e.removeItem(a)}catch(u){console.error(`${r} (backup)`,u),Se("deletion",u,e),le()}if(!s){const u=`${t}${zr}`;try{e.removeItem(u)}catch(f){console.warn(`Unable to remove migration backup for ${t}`,f)}}}var Mm=[Ot,za],Xo=new Set;function zm(){const e=[],t=new Set,r=i=>{!i||typeof i.getItem!="function"||e.push(i)},n=(i,s,a)=>{if(!i||typeof i!="object"&&typeof i!="function")return null;try{return i[s]}catch(c){return a&&!Xo.has(a)&&(Xo.add(a),console.warn(`Unable to access ${a} while clearing UI caches`,c)),null}},o=(i,s)=>{if(!i||t.has(i))return;t.add(i),r(n(i,"SAFE_LOCAL_STORAGE",`${s}.SAFE_LOCAL_STORAGE`)),r(n(i,"localStorage",`${s}.localStorage`)),r(n(i,"sessionStorage",`${s}.sessionStorage`));const a=n(i,"__cineGlobal",`${s}.__cineGlobal`);a&&a!==i&&o(a,`${s}.__cineGlobal`)};o(typeof globalThis<"u"?globalThis:null,"globalThis"),o(typeof window<"u"?window:null,"window"),o(typeof self<"u"?self:null,"self"),o(typeof global<"u"?global:null,"global"),h&&h.__cineGlobal&&o(h.__cineGlobal,"__cineGlobal"),D&&D.storage&&r(D.storage),typeof T=="function"&&T()&&r(T());try{r(T())}catch(i){Xo.has("getSafeLocalStorage")||(Xo.add("getSafeLocalStorage"),console.warn("Unable to access safe local storage while clearing UI caches",i))}return r(Rn("localStorage")),r(Rn("sessionStorage")),typeof localStorage<"u"&&r(localStorage),typeof sessionStorage<"u"&&r(sessionStorage),Oo(e)}function cr(){const e=zm();e.length&&Mm.forEach(t=>{O&&O.removeItem(t).catch(r=>console.warn("Failed to clear UI cache from repo",r)),!(typeof t!="string"||!t)&&e.forEach(r=>{ce(r,t,`Failed to clear UI cache entry ${t}`)})})}function Sf(e,t,r){if(!e)return!1;try{return e.getItem(t)==="1"}catch(n){return console.error(r,n),Se("read access",n,e),le(),!1}}function wf(e,t,r,n){if(e)try{r?e.setItem(t,"1"):e.removeItem(t)}catch(o){console.error(n,o),Se("write access",o,e),le()}}function xm(e,t,r,n,o,i,s,a){const c=Ne(e,r,n,null,a);if(c!==null)return c;if(!t)return null;const u={...a||{},alertOnFailure:"migration-read"},f=Ne(t,r,o,null,u);return f!==null?(Oe(e,r,f,i),ce(t,r,s),f):null}function Ha(e,t,r){const n=e.trim();let o=n,i=2;const s=r||new Set([...t].map(c=>c.trim().toLowerCase()));let a=n.toLowerCase();for(;s.has(a);)o=`${n} (${i++})`,a=o.toLowerCase();return t.add(o),s.add(a),o}function Bm(e){const t=typeof e=="string"?e.trim():"";if(!t)return"Project-imported";const r=t.match(/^(.*?)-imported(?:-(\d+))?$/i);if(r){const n=typeof r[1]=="string"?r[1].trim():"";return n?`${n}-imported`:"Project-imported"}return t.toLowerCase().endsWith("-imported")?t:`${t}-imported`}function Gm(e){const t=typeof e=="string"?e.trim():"",r=Bm(e);if(!t)return{base:r,initialCandidate:r,suffixStart:2};const n=t.match(/^(.*?)-imported(?:-(\d+))?$/i),o=n&&n[2]?Number(n[2]):NaN,i=Number.isFinite(o)?o+1:2;return n?{base:r,initialCandidate:t,suffixStart:i}:{base:r,initialCandidate:r,suffixStart:2}}function Fm(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=Gm(e);let i=typeof o.initialCandidate=="string"?o.initialCandidate.trim():"";i||(i=o.base||"Project-imported");let s=i.trim().toLowerCase(),a=o.suffixStart;for(;s&&n.has(s);)i=`${o.base||"Project-imported"}-${a++}`,s=i.trim().toLowerCase();return t.add(i),s&&n.add(s),i}function Dm(e){const t=typeof e=="string"?e.trim():"";return t?t.toLowerCase().endsWith("-updated")?t:`${t}-updated`:"Project-updated"}function Yn(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=Dm(e);let i=o,s=2,a=i.trim().toLowerCase();for(;a&&n.has(a);)i=`${o}-${s++}`,a=i.trim().toLowerCase();return i}function Um(e){if(e==null)return[];if(typeof e=="string"){const t=e.trim();return t?[t]:[]}return Array.isArray(e)?e.filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):E(e)?Object.values(e).filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):[]}function Km(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}function Xs(e){if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(!n||typeof n!="object")return;const o=Number(n.x),i=Number(n.y);!Number.isFinite(o)||!Number.isFinite(i)||(t[r]={x:o,y:i})}),t}function $m(e,t){const r=Object.keys(e||{}),n=Object.keys(t||{});if(r.length!==n.length)return!1;for(let o=0;o<r.length;o+=1){const i=r[o];if(!Object.prototype.hasOwnProperty.call(t||{},i))return!1;const s=e[i],a=t[i];if(!s||typeof s!="object"||!a||typeof a!="object"||Number(s.x)!==a.x||Number(s.y)!==a.y)return!1}return!0}function Vm(e){if(!E(e))return{state:null,changed:!1};const t={...e};let r=!1;const n=s=>{if(!Object.prototype.hasOwnProperty.call(t,s))return;const a=t[s];if(typeof a=="string"){const c=a.trim();c!==a&&(t[s]=c,r=!0);return}if(a==null){t[s]="",r=!0;return}if(typeof a=="number"||typeof a=="boolean"){t[s]=String(a),r=!0;return}t[s]="",r=!0};["setupName","setupSelect","camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap","sliderBowl","easyrig"].forEach(n);const o=(s,a=[])=>{const c=[],u=[s,...a];let f=!1;u.forEach(g=>{if(Object.prototype.hasOwnProperty.call(t,g)){const m=Um(t[g]);g!==s&&(f=!0),m.length&&c.push(...m)}}),u.slice(1).forEach(g=>{Object.prototype.hasOwnProperty.call(t,g)&&(delete t[g],r=!0)});const l=[],y=new Set;c.forEach(g=>{y.has(g)||(y.add(g),l.push(g))});const p=Object.prototype.hasOwnProperty.call(t,s),d=p&&Array.isArray(t[s])?t[s].filter(g=>typeof g=="string").map(g=>g.trim()).filter(g=>g):[];!p&&!f&&l.length===0&&d.length===0||Km(d,l)||(t[s]=l,r=!0)};if(o("motors",["motor","motorSelect"]),o("controllers",["controller","controllerSelect"]),Object.prototype.hasOwnProperty.call(t,"projectInfo")&&!E(t.projectInfo)&&(t.projectInfo=null,r=!0),Object.prototype.hasOwnProperty.call(t,"autoGearHighlight")){const s=t.autoGearHighlight,a=s===!0||s==="true"||s===1||s==="1";(s!==a||typeof s!="boolean")&&(t.autoGearHighlight=a,r=!0)}if(Object.prototype.hasOwnProperty.call(t,"diagramPositions")){const s=Xs(t.diagramPositions);Object.keys(s).length===0?(delete t.diagramPositions,r=!0):$m(t.diagramPositions,s)||(t.diagramPositions=s,r=!0)}const i=fe(t);return i!==t?{state:i,changed:!0}:{state:t,changed:r}}function Ef(){ke();const e=T(),t=xm(e,typeof sessionStorage<"u"?sessionStorage:null,wt,"Error loading session state from localStorage:","Error loading session state from sessionStorage:","Error saving session state to localStorage:","Error deleting session state from sessionStorage:",{validate:o=>o===null||E(o)});if(t===null)return null;const{state:r,changed:n}=Vm(t);return r?(n&&(pt(e,wt,t),qa(r)),r):null}function qa(e,t={}){const r=T();if(e==null){ce(r,wt,"Error deleting session state from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid session state payload. Expected a plain object.");return}qe(r,wt);const n=fe(e),o=E(t)?t:{},i=o.disableCompression!==!1,s={...o,disableCompression:i,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{if(typeof Js=="function"){const a=oc();if(Js(a))return console.warn("Removed oldest automatic gear backup to free up space for session state."),!0}return typeof Qs=="function"&&Qs()?(console.warn("Cleared cached planner data to free up space for session state."),!0):!1}};Oe(r,wt,n,"Error saving session state to localStorage:",s)}function Of(e){if(!E(e))return{data:null,changed:!1};const t={...e};let r=!1;const n=(o,i)=>(E(o[i])||(o[i]={},r=!0),o[i]);return ym.forEach(o=>{n(t,o)}),E(t.fiz)||(t.fiz={},r=!0),gm.forEach(o=>{n(t.fiz,o)}),E(t.accessories)||(t.accessories={},r=!0),mm.forEach(o=>{n(t.accessories,o)}),Array.isArray(t.filterOptions)||(t.filterOptions=Array.isArray(e.filterOptions)?e.filterOptions.slice():[],r=!0),{data:t,changed:r}}function Af(){ke();const e=T(),t=Ne(e,Ve,"Error loading device data from localStorage:",null,{validate:o=>o===null||E(o)}),{data:r,changed:n}=Of(t);return r?(n&&(pt(e,Ve,t),Oe(e,Ve,r,"Error updating device data in localStorage during normalization:",{disableCompression:!0,forceCompressionOnQuota:!1})),r):null}function Cf(e){const t=T();if(e==null){ce(t,Ve,"Error deleting device data from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid device data payload. Expected a plain object.");return}const{data:r}=Of(e),n=r||e;qe(t,Ve),Oe(t,Ve,n,"Error saving device data to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function _f(e){if(!e)return{data:{},changed:!1};if(Array.isArray(e)){const n={},o=new Set,i=new Set;for(let s=0;s<e.length;s+=1){const a=e[s];if(!E(a))continue;const c=a.name||a.setupName||`Setup ${s+1}`,u=Ha(c,o,i);n[u]=a}return{data:n,changed:!0}}if(!E(e))return{data:{},changed:!0};const t={};let r=!1;return Object.keys(e).forEach(n=>{const o=e[n];if(E(o)){const i=fe(o);i!==o&&(r=!0),t[n]=i}else r=!0}),r?{data:t,changed:!0}:{data:e,changed:!1}}function Uo(){ke();const e=T(),t=Ne(e,Ze,"Error loading setups from localStorage:",null,{validate:o=>o===null||Array.isArray(o)||E(o)}),{data:r,changed:n}=_f(t);n&&(pt(e,Ze,t),Oe(e,Ze,r,"Error updating setups in localStorage during normalization:"));try{return Zu(r,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Fe)})}catch(o){return console.warn("Failed to expand automatic backup entries while loading setups",o),be(r)}}function Wa(e){const{data:t}=_f(e);Va(t);const r=ef(t,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(Fe)});am(r);const n=T();typeof Ao=="function"&&Ao(t,n),qe(n,Ze),Oe(n,Ze,r,"Error saving setups to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{const o=Ys(r);return o?(console.warn(`Removed automatic backup "${o}" to free up storage space before saving setups.`),!0):!1}})}function Ya(e){const t=Uo(),{result:r,changed:n=!0}=e(t)||{};return n&&Wa(t),r}function Hm(e,t){Ya(r=>(r[e]=t,{changed:!0}))}function qm(e){return Uo()[e]}function Wm(e){Ya(t=>Object.prototype.hasOwnProperty.call(t,e)?(delete t[e],{changed:!0}):{changed:!1})}function Ym(e,t){return Ya(r=>{if(!Object.prototype.hasOwnProperty.call(r,e))return{result:null,changed:!1};const n=t.trim();if(!n)return{result:e,changed:!1};if(e.trim().toLowerCase()===n.toLowerCase())return{result:e,changed:!1};const o=new Set(Object.keys(r));o.delete(e);const i=Ha(n,o),s=r[e];r[i]=s,delete r[e];const a=typeof e=="string"&&e.startsWith(Fe),c=typeof i=="string"&&i.startsWith(Fe);return a&&c&&Pm(s),{result:i,changed:!0}})}var Jm=new Set(["prepDays","shootingDays","returnDays","crew","productionCompany","productionCompanyAddress"]),kf={productionCompany:["Production Company","Produktionsfirma","Société de production","Productora","Casa di produzione"],productionCompanyAddress:["Production Company Address","Adresse der Produktionsfirma","Adresse de la société de production","Dirección de la productora","Indirizzo della casa di produzione"],productionCompanyStreet:["Street address","Straße und Hausnummer","Adresse","Dirección","Indirizzo"],productionCompanyStreet2:["Address line 2","Adresszusatz","Complément d'adresse","Línea 2 de dirección","Seconda linea indirizzo"],productionCompanyCity:["City","Stadt","Ville","Ciudad","Città"],productionCompanyRegion:["State / Province / Region","Bundesland / Region","État / Région / Département","Estado / Provincia / Región","Regione / Provincia / Stato"],productionCompanyPostalCode:["Postal code","Postleitzahl","Code postal","Código postal","CAP"],productionCompanyCountry:["Country","Land","Pays","País","Paese"],rentalHouse:["Rental","Kameraverleih","Loueur","Noleggio","Verleih","Location","Rental House"],crew:["Crew","Team","Équipe","Equipo","Troupe"],prepDays:["Prep Days","Prep-Tage","Jours de préparation","Días de preparación","Giorni di preparazione"],shootingDays:["Shooting Days","Drehtage","Jours de tournage","Días de rodaje","Giorni di riprese"],returnDays:["Return Days","Rückgabetage","Jours de restitution","Días de devolución","Giorni di restituzione"],deliveryResolution:["Delivery Resolution","Auslieferungsauflösung","Résolution de livraison","Resolución de entrega","Risoluzione di consegna"],recordingResolution:["Recording Resolution","Aufnahmeauflösung","Résolution d’enregistrement","Resolución de grabación","Risoluzione di registrazione"],slowMotionRecordingResolution:["Slow Motion Recording Resolution","Zeitlupen-Aufnahmeauflösung","Résolution d’enregistrement au ralenti","Resolución de grabación en cámara lenta","Risoluzione di registrazione slow motion"],aspectRatio:["Aspect Ratio","Seitenverhältnis","Format d’image","Relación de aspecto","Formato"],codec:["Codec","Codec","Codec","Códec","Codec"],baseFrameRate:["Base Frame Rate","Basis-Framerate","Cadence de base","Velocidad base","Frame rate base"],slowMotionBaseFrameRate:["Slow Motion Base Frame Rate","Zeitlupen-Basis-Framerate","Cadence de base au ralenti","Velocidad base en cámara lenta","Frame rate base slow motion"],recordingFrameRate:["Recording Frame Rate","Aufnahmebildrate","Cadence d’enregistrement","Velocidad de grabación","Frame rate di registrazione"],slowMotionRecordingFrameRate:["Slow Motion Recording Frame Rate","Zeitlupen-Aufnahmebildrate","Cadence d’enregistrement au ralenti","Velocidad de grabación en cámara lenta","Frame rate di registrazione slow motion"],sensorMode:["Sensor Mode","Sensormodus","Mode capteur","Modo de sensor","Modalità sensore"],slowMotionSensorMode:["Slow Motion Sensor Mode","Zeitlupen-Sensormodus","Mode capteur au ralenti","Modo de sensor en cámara lenta","Modalità sensore slow motion"],slowMotionAspectRatio:["Slow Motion Aspect Ratio","Zeitlupen-Seitenverhältnis","Format d’image au ralenti","Relación de aspecto en cámara lenta","Formato slow motion"],lenses:["Lenses","Objektive","Optiques","Ópticas","Obiettivi"],requiredScenarios:["Required Scenarios","Anforderungen","Scénarios requis","Escenarios requeridos","Scenari richiesti"],cameraHandle:["Camera Handle","Kamera-Handgriff","Poignée caméra","Empuñadura de cámara","Maniglia camera"],viewfinderExtension:["Viewfinder Extension","Sucher-Verlängerung","Extension viseur","Extensión de visor","Prolunga mirino"],viewfinderEyeLeatherColor:["Viewfinder Eye Leather Color","Sucher-Augenmuschel-Farbe","Couleur de l’œil du viseur","Color del ocular del visor","Colore gomma mirino"],mattebox:["Mattebox","Matte-Box","Matte box","Matte box","Matte box"],gimbal:["Gimbal","Gimbal-Stabilisator","Stabilisateur gimbal","Estabilizador gimbal","Stabilizzatore gimbal"],videoDistribution:["Video Distribution","Videoverteilung","Distribution vidéo","Distribución de vídeo","Distribuzione video"],monitoringSupport:["Monitoring support","Monitoring-Support","Support de monitoring","Soporte de monitorización","Supporto monitoraggio"],monitoringConfiguration:["Monitoring configuration","Monitoring-Konfiguration","Configuration de monitoring","Configuración de monitorización","Configurazione monitoraggio"],focusMonitor:["Focus Monitor","Fokusmonitor","Moniteur focus","Monitor de foco","Monitor fuoco"],monitorUserButtons:["Onboard Monitor User Buttons","Onboard-Monitor-Buttons","Boutons personnalisés du moniteur","Botones de usuario del monitor integrado","Tasti monitor onboard"],cameraUserButtons:["Camera User Buttons","Kamera-Buttons","Boutons personnalisés caméra","Botones de usuario de la cámara","Tasti camera"],viewfinderUserButtons:["Viewfinder User Buttons","Sucher-Buttons","Boutons personnalisés viseur","Botones de usuario del visor","Tasti mirino"],tripodHeadBrand:["Tripod Head Brand","Kopfmarke","Marque de la tête","Marca de la cabeza","Marca della testa"],tripodBowl:["Tripod Bowl","Schalentyp","Type de bol","Tipo de bowl","Tipo di bowl"],tripodTypes:["Tripod Types","Stativtypen","Types de trépied","Tipos de trípode","Tipi di treppiede"],tripodSpreader:["Tripod Spreader","Spreizer-Option","Type de spreader","Tipo de esparcidor","Tipo di spreader"],sliderBowl:["Slider Bowl","Slider-Schale","Slider bowl","Bowl del slider","Slider bowl"],easyrig:["Further Stabilisation","Weitere Stabilisierung","Stabilisation complémentaire","Estabilización adicional","Stabilizzazione aggiuntiva"]},Zs=["productionCompanyAddress","productionCompanyStreet","productionCompanyStreet2","productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"];function Pf(e){return typeof e!="string"?"":e.trim().replace(/[:：]\s*$/,"").trim()}function Qm(e){var t={},r=typeof window<"u"&&window.texts?window.texts:null,n=r&&r.en&&r.en.projectFields||{},o=["productionCompany"].concat(Zs);return o.forEach(function(i){var s=new Set,a=function(u){if(typeof u=="string"){var f=Pf(u);f&&s.add(f)}};e&&e[i]&&a(e[i]),n&&n[i]&&a(n[i]);var c=kf[i];Array.isArray(c)&&c.forEach(a),t[i]=s}),t}function Xm(e,t,r){if(typeof e!="string")return null;var n=e.replace(/\r\n?/g,`
`).split(`
`).map(function(m){return m.trim()}).filter(function(m){return m});if(!n.length)return null;var o=Qm(t),i={},s=n[0];s&&(i.productionCompany=s);var a=Array.isArray(r?.lines)?r.lines:null;if(a&&a.length){var c={};if(a.forEach(function(m){if(!(!m||typeof m.text!="string")){var b=m.text.trim();if(b){var C=m.fields;typeof C=="string"&&(C=C.split(/\s+/)),!(!Array.isArray(C)||!C.length)&&C.map(function(A){return typeof A=="string"?A.trim():""}).filter(function(A){return A&&Zs.includes(A)}).forEach(function(A){c[A]||(c[A]=[]),c[A].push(b)})}}}),Object.keys(c).length){if(c.productionCompanyAddress&&c.productionCompanyAddress.length&&(i.productionCompanyAddress=c.productionCompanyAddress.join(`
`)),c.productionCompanyStreet&&c.productionCompanyStreet.length){var u=c.productionCompanyStreet;if(i.productionCompanyStreet=u[0],u.length>1){var f=u.slice(1).join(`
`);f&&(i.productionCompanyStreet2=f)}}if(c.productionCompanyStreet2&&c.productionCompanyStreet2.length){var l=c.productionCompanyStreet2.join(`
`);l&&(i.productionCompanyStreet2=i.productionCompanyStreet2?i.productionCompanyStreet2+`
`+l:l)}var y=function(m){if(!(!c[m]||!c[m].length)){var b=c[m].join(" ");b&&(i[m]=b)}};return["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"].forEach(y),i}}var p={},d=null;if(n.slice(1).forEach(function(m){var b=Pf(m),C=null;if(Zs.forEach(function(A){C||!o[A]||o[A].has(b)&&(C=A)}),C){d=C,p[d]||(p[d]=[]);return}if(!d){i.productionCompany?i.productionCompany+=`
`+m:i.productionCompany=m;return}p[d]||(p[d]=[]),p[d].push(m)}),p.productionCompanyAddress&&p.productionCompanyAddress.length&&(i.productionCompanyAddress=p.productionCompanyAddress.join(`
`)),p.productionCompanyStreet&&p.productionCompanyStreet.length){var g=p.productionCompanyStreet;i.productionCompanyStreet=g[0],g.length>1&&(i.productionCompanyStreet2=g.slice(1).join(`
`))}return p.productionCompanyCity&&p.productionCompanyCity.length&&(i.productionCompanyCity=p.productionCompanyCity.join(" ")),p.productionCompanyRegion&&p.productionCompanyRegion.length&&(i.productionCompanyRegion=p.productionCompanyRegion.join(" ")),p.productionCompanyPostalCode&&p.productionCompanyPostalCode.length&&(i.productionCompanyPostalCode=p.productionCompanyPostalCode.join(" ")),p.productionCompanyCountry&&p.productionCompanyCountry.length&&(i.productionCompanyCountry=p.productionCompanyCountry.join(" ")),i}var Zm=(()=>{const e=new Map,t=r=>typeof r!="string"?"":r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return Object.entries(kf).forEach(([r,n])=>{n.forEach(o=>{const i=t(o);i&&!e.has(i)&&e.set(i,r)})}),e})(),eh={amp:"&",lt:"<",gt:">",quot:'"',apos:"'",nbsp:" "};function ao(e){return typeof e!="string"||!e?"":e.replace(/&(#x?[0-9a-fA-F]+|[a-zA-Z]+);/g,(t,r)=>{if(!r)return t;if(r[0]==="#"){const o=r[1]==="x"||r[1]==="X"?parseInt(r.slice(2),16):parseInt(r.slice(1),10);return Number.isFinite(o)?String.fromCodePoint(o):t}const n=eh[r.toLowerCase()];return n!==void 0?n:t})}function co(e){if(typeof e!="string")return"";let t;do t=e,e=e.replace(/<[^>]*>/g,"");while(e!==t);return e}function th(e,t){if(typeof e!="string")return"";const r=e.replace(/<\s*br\s*\/?\s*>/gi,`
`).replace(/<\/(p|div|li|ul|ol)>/gi,`
`).replace(/<li[^>]*>/gi,""),o=ao(co(r)).replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(i=>i.replace(/\s+/g," ").trim()).filter(i=>i);return o.length?t&&Jm.has(t)?o.join(`
`):o.join(", "):""}function rh(e){if(typeof e!="string")return null;const t=/<span([^>]*)>([\s\S]*?)<\/span>/gi,r=[];let n;for(;n=t.exec(e);){const o=n[1]||"";if(!/class=["'][^"']*req-sub-line[^"']*["']/i.test(o))continue;const i=n[2]||"",s=ao(co(i)).replace(/\s+/g," ").trim();if(!s)continue;const a=o.match(/data-fields=["']([^"']+)["']/i),c=a?null:o.match(/data-field=["']([^"']+)["']/i),u=a?a[1]:c?c[1]:"",f=typeof u=="string"?u.split(/\s+/).map(l=>l.trim()).filter(l=>l):[];r.push({text:s,fields:f})}return r.length?{lines:r}:null}function nh(e){if(typeof e!="string")return"";const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return t&&Zm.get(t)||""}function Xc(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const r={},n=t.match(/<div[^>]*class=["'][^"']*requirements-grid[^"']*["'][^>]*>/i),o=n?n.index:-1;if(o===-1){const d=t.match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(d){const m=ao(co(d[1])).replace(/[“”"']/g,"").trim();m&&(r.projectName=m)}return Object.keys(r).length?r:null}const i=t.slice(o),a=t.slice(0,o).match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(a){const g=ao(co(a[1])).replace(/[“”"']/g,"").trim();g&&!/gear list/i.test(g)&&(r.projectName=g)}const c=/<div[^>]*class=["'][^"']*requirement-box[^"']*["'][^>]*>[\s\S]*?<\/div>/gi;let u;const f=typeof window<"u"&&window.texts?window.texts:null,l=typeof window<"u"&&window.currentLang?window.currentLang:null,y=typeof l=="string"&&f&&f[l]?l:"en",p=f&&f[y]&&f[y].projectFields?f[y].projectFields:f&&f.en&&f.en.projectFields?f.en.projectFields:{};for(;u=c.exec(i);){const d=u[0],g=d.match(/data-field=["']([^"']+)["']/i),m=d.match(/<span[^>]*class=["'][^"']*req-label[^"']*["'][^>]*>([\s\S]*?)<\/span>/i),b=d.match(/<span[^>]*class=["'][^"']*req-value[^"']*["'][^>]*>([\s\S]*)<\/span\s*>/i),C=g?g[1].trim():"",A=m?ao(co(m[1])):"",_=C||nh(A);if(!_)continue;const P=b?b[1]:"",k=th(P,_);if(!k)continue;let I=k,w=null;if(_==="productionCompany"){w=rh(P);const S=Xm(k,p,w);S&&typeof S=="object"&&(S.productionCompany&&(I=S.productionCompany),Object.entries(S).forEach(([v,B])=>{v!=="productionCompany"&&(Object.prototype.hasOwnProperty.call(r,v)||(r[v]=B))}))}Object.prototype.hasOwnProperty.call(r,_)||(r[_]=I)}return Object.keys(r).length?r:null}function Tn(e){if(Array.isArray(e))return e.map(t=>Tn(t));if(E(e)){const t={};return Object.entries(e).forEach(([r,n])=>{t[r]=Tn(n)}),t}return e}function Zo(e){if(!E(e))return null;try{return ur(e)}catch(t){console.warn("Unable to serialize project info during normalization",t);try{return Tn(e)}catch(r){return console.warn("Unable to deep clone project info during normalization",r),{...e}}}}function oh(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(r=>{if(!E(r)){const l=Ja(r);l!=null&&t.push(l);return}const n={},o=typeof r.name=="string"?r.name.trim():"";o&&(n.name=o);const i=typeof r.phone=="string"?r.phone.trim():"";i&&(n.phone=i);const s=typeof r.email=="string"?r.email.trim():"";s&&(n.email=s);const c=typeof r.website=="string"?r.website.trim():typeof r.url=="string"?r.url.trim():"";c&&(n.website=c);const u=typeof r.text=="string"?r.text.trim():"";u&&(n.text=u);const f=typeof r.role=="string"?r.role.trim():"";f&&(n.role=f),Object.keys(n).length&&t.push(n)}),t}function Ja(e){if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t||null}if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="boolean")return e?!0:null;if(Array.isArray(e)){const t=e.map(r=>Ja(r)).filter(r=>r!=null&&!(typeof r=="string"&&!r));return t.length?t:null}return E(e)?jf(e):null}function jf(e){if(!E(e))return null;const t={},r=[],n=new Set,o=a=>{if(typeof a!="string")return;const c=a.trim();!c||n.has(c)||(n.add(c),r.push(c))},i=(a,c={})=>{if(a==null)return;if(c.fromSelections){(Array.isArray(a)?a:[a]).forEach(l=>{if(re(l)){const p=ne(l);if(p){i(p,{fromSelections:!0});return}}if(E(l)){const p=Qa(l);if(p.length){p.forEach(d=>{d&&typeof d.name=="string"&&o(d.name)});return}}const y=Te(l);y&&o(y)});return}const u=Ye(a);u.length&&u.forEach(f=>{o(f)})};if(i(e.lenses),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&i(e.lensSelections,{fromSelections:!0}),Object.entries(e).forEach(([a,c])=>{if(c==null)return;if(a==="people"){const f=oh(c);f.length&&(t.people=f);return}if(a==="lenses"){const{names:f}=Lf(c);t.lenses=f.slice();return}if(a==="lensSelections"){const f=ea(c,r);f.selections&&f.selections.length&&(t.lensSelections=f.selections);return}const u=Ja(c);u!=null&&(t[a]=u)}),!Object.prototype.hasOwnProperty.call(t,"lenses")&&r.length&&(t.lenses=r.slice()),!Object.prototype.hasOwnProperty.call(t,"lensSelections")&&r.length){const a=ea([],r);a.selections&&a.selections.length&&(t.lensSelections=a.selections)}return Object.keys(t).length?fe(t):null}function ih(e){if(!Array.isArray(e)||!e.length)return null;try{return ur(e)}catch(t){console.warn("Unable to serialize automatic gear rules during normalization",t);try{return Tn(e)}catch(r){return console.warn("Unable to deep clone automatic gear rules during normalization",r),e.slice()}}}function sh(e){if(!E(e)||!Object.keys(e).length)return{};try{return ur(e)}catch(t){console.warn("Unable to serialize diagram positions during normalization",t);try{return Tn(e)}catch(r){return console.warn("Unable to deep clone diagram positions during normalization",r),{...e}}}}var pi="4x5.65";function gt(e){if(e==null)return[];if(Array.isArray(e)){const r=[];return e.forEach(n=>{if(n==null)return;if(Array.isArray(n)){r.push(...gt(n));return}if(re(n)){const i=ne(n);if(i){r.push(...gt(i));return}}if(typeof n=="object"){r.push(...gt(Object.values(n)));return}const o=String(n).trim();o&&r.push(o)}),r}if(re(e)){const r=ne(e);if(r)return gt(r)}if(typeof e=="object")return Object.prototype.hasOwnProperty.call(e,"values")?gt(e.values):Object.prototype.hasOwnProperty.call(e,"selected")?gt(e.selected):gt(Object.values(e));if(typeof e=="string"){const r=e.trim();if(!r||r==="!")return[];const n=Ae(r);return n.success?gt(n.parsed):r.split(/[|,]/).map(o=>o.trim()).filter(o=>o)}const t=String(e).trim();return t?[t]:[]}function wn(e,t=""){if(e==null)return null;if(typeof e=="string"){const r=e.trim();if(!r)return null;const n=Ae(r);if(n.success)return wn(n.parsed,t);const o=r.split(":"),i=o.shift(),s=i?i.trim():"";if(!s)return null;const a=o.shift(),c=a&&a.trim()?a.trim():pi;if(!o.length)return{type:s,size:c,values:[],hasExplicitValues:!1};const u=o.join(":");if(u==="!")return{type:s,size:c,values:[],hasExplicitValues:!0};const f=gt(u);return{type:s,size:c,values:f,hasExplicitValues:!0}}if(Array.isArray(e)){if(!e.length)return null;if(e.length===1)return wn(e[0],t);const[r,n,o]=e;let i=typeof r=="string"?r.trim():"";if(!i&&typeof t=="string"&&(i=t.trim()),!i)return null;const s=typeof n=="string"&&n.trim()?n.trim():pi,a=e.length>2,c=a?gt(o):[];return{type:i,size:s,values:c,hasExplicitValues:a}}if(re(e)){const r=ne(e);if(r)return wn(r,t)}if(typeof e=="object"){let r="";const n=["type","filter","name","label"];for(let u=0;u<n.length;u+=1){const f=n[u];if(typeof e[f]=="string"){const l=e[f].trim();if(l){r=l;break}}}if(!r&&typeof t=="string"&&t.trim()&&(r=t.trim()),!r)return null;const o=["size","filterSize","format","dimension","dimensions","diameter"];let i="";for(let u=0;u<o.length;u+=1){const f=o[u];if(typeof e[f]=="string"){const l=e[f].trim();if(l){i=l;break}}}i||(i=pi);const s=["values","value","strengths","strength","options","selected","selections","choices"];let a=!1,c=[];for(let u=0;u<s.length;u+=1){const f=s[u];if(Object.prototype.hasOwnProperty.call(e,f)){a=!0,c=gt(e[f]);break}}return{type:r,size:i,values:c,hasExplicitValues:a}}return null}function Es(e){if(!e||!e.type)return null;const t=e.type,r=e.size&&e.size.trim()?e.size.trim():pi;let n=`${t}:${r}`;const o=Array.isArray(e.values)?Array.from(new Set(e.values.map(i=>typeof i=="string"?i.trim():String(i??"").trim()).filter(i=>i))):[];return(e.hasExplicitValues||o.length)&&(n+=o.length?`:${o.join("|")}`:":!"),n}function Mi(e){if(e===void 0)return null;if(e===null)return"";if(typeof e=="string"){const t=e.trim();if(!t)return"";const r=Ae(t);return r.success?Mi(r.parsed):t}if(Array.isArray(e)){const t=e.map(r=>wn(r)).filter(Boolean);return t.length?t.map(r=>Es(r)).filter(Boolean).join(","):""}if(re(e)){const t=ne(e);if(t)return Mi(t)}if(typeof e=="object"){const t=wn(e);if(t)return Es(t)||"";const r=[];return Object.entries(e).forEach(([n,o])=>{const i=wn(o,n);i&&r.push(i)}),r.length?r.map(n=>Es(n)).filter(Boolean).join(","):""}return String(e).trim()}function Os(e){if(!E(e))return;const t=Mi(e.filter);if(t!==null)t?e.filter=t:delete e.filter;else{const r=Mi(e.filters);r!==null&&(r?e.filter=r:delete e.filter)}Object.prototype.hasOwnProperty.call(e,"filters")&&delete e.filters}function Jn(e){if(!E(e))return null;const t=n=>{if(Array.isArray(n))return n.map(i=>t(i)).filter(i=>i!==void 0);if(E(n)){const o={};return Object.entries(n).forEach(([i,s])=>{if(typeof i!="string"||!i)return;const a=t(s);a!==void 0&&(o[i]=a)}),o}if(n==null)return"";if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean")return String(n);try{return String(n)}catch{}return""},r={};return Object.entries(e).forEach(([n,o])=>{if(typeof n!="string"||!n)return;const i=t(o);i!==void 0&&(r[n]=i)}),Object.keys(r).length?r:null}function to(e){if(e==null)return null;const t=o=>typeof o=="string"?o.trim():o==null?"":typeof o=="number"||typeof o=="boolean"?String(o):"";if(!E(e))return null;const r={batteryPlate:t(e.batteryPlate),battery:t(e.battery),batteryHotswap:t(e.batteryHotswap)};return Object.keys(r).some(o=>r[o])?r:null}function ah(e){const t=to(e);return t?{batteryPlate:t.batteryPlate,battery:t.battery,batteryHotswap:t.batteryHotswap}:null}const ch=new Set(["name","lensname","label","title","text","lens","mount","mountlabel","mountname","mounts","note","notes","names","values","selection","legacyvalue","lensselections","selections","entries","items","options","meta","metadata","count","version","length","size","updated","created","createdat","timestamp","id","uuid","key","value"]);function If(e){if(typeof e!="string")return!1;const t=e.trim();if(!t||/^[0-9]+$/u.test(t))return!1;const r=t.toLowerCase();return!(r.startsWith("__proto__")||r==="prototype"||r==="constructor"||ch.has(r))}function vf(e){if(!E(e))return[];const t=Object.keys(e),r=[];return t.forEach(n=>{if(!If(n))return;const o=n.trim();o&&r.push(o)}),r}function Te(e){if(e==null)return"";if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return(typeof e=="string"?e:String(e)).trim();if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Te(e[t]);if(r)return r}return""}if(re(e)){const t=ne(e);if(t)return Te(t)}if(E(e)){const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i=="string"){const s=i.trim();if(s)return s}}const r=vf(e);if(r.length)return r[0];if(Array.isArray(e.names)&&e.names.length){const o=Te(e.names[0]);if(o)return o}if(Array.isArray(e.values)&&e.values.length){const o=Te(e.values[0]);if(o)return o}const n=Object.values(e);for(let o=0;o<n.length;o+=1){const i=Te(n[o]);if(i)return i}}return""}function Ye(e){if(e==null)return[];if(Array.isArray(e)){const t=[];return e.forEach(r=>{if(r==null)return;if(typeof r=="string"){const o=Ae(r);if(o.success){t.push(...Ye(o.parsed));return}const i=r.trim();i&&t.push(i);return}if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint"){t.push(String(r));return}const n=Te(r);if(n){t.push(n);return}if(Array.isArray(r)){t.push(...Ye(r));return}if(re(r)){const o=ne(r);o&&t.push(...Ye(o));return}E(r)&&t.push(...Ye(Object.values(r)))}),t}if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return[String(e)];if(typeof e=="string"){const t=Ae(e);return t.success?Ye(t.parsed):e.split(/[\n,;]/u).map(r=>r.trim()).filter(r=>r)}if(re(e)){const t=ne(e);if(t)return Ye(t)}if(E(e)){const t=vf(e);if(t.length)return t;const r=Te(e);if(r)return[r];const n=[];return Array.isArray(e.names)&&n.push(...Ye(e.names)),Array.isArray(e.values)&&n.push(...Ye(e.values)),n.length||n.push(...Ye(Object.values(e))),n}return[]}function Lf(e){const t=Ye(e),r=Array.isArray(e)&&e.length===t.length&&e.every((n,o)=>typeof n=="string"&&n.trim()===t[o]);return{names:t,changed:!r}}function di(e){if(e==null)return{selection:null,changed:!1};if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"){const t=Te(e);return t?{selection:{name:t,mount:""},changed:!0}:{selection:null,changed:!0}}if(re(e)){const t=ne(e);if(t)return di(t)}if(Array.isArray(e)){if(!e.length)return{selection:null,changed:!0};const t=Te(e[0]);if(!t)return{selection:null,changed:!0};const r=e.length>1?e[1]:"",n=typeof r=="string"?r.trim():"",o={name:t};return o.mount=n||"",{selection:o,changed:!0}}if(E(e)){const t={...e};let r=!1;const n=Te(e);if(!n)return{selection:null,changed:!0};t.name!==n&&(t.name=n,r=!0),Object.prototype.hasOwnProperty.call(t,"name")||(t.name=n,r=!0);const o=[];if(typeof e.mount=="string"&&o.push(e.mount),typeof e.mountLabel=="string"&&o.push(e.mountLabel),typeof e.mountName=="string"&&o.push(e.mountName),Array.isArray(e.mounts))for(let s=0;s<e.mounts.length;s+=1){const a=e.mounts[s];if(typeof a=="string"&&a.trim()){o.push(a);break}}let i="";for(let s=0;s<o.length;s+=1){const a=o[s];if(typeof a=="string"){const c=a.trim();if(c){i=c;break}}}if(typeof t.mount=="string"){const s=t.mount.trim();s!==t.mount&&(t.mount=s,r=!0),!i&&s&&(i=s)}return i||(i=""),t.mount!==i&&(t.mount=i,r=!0),Object.prototype.hasOwnProperty.call(t,"mount")||(t.mount=i,r=!0),{selection:t,changed:r}}return{selection:null,changed:!0}}function Qa(e){if(!E(e))return[];const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let n=0;n<t.length;n+=1){const o=t[n];if(typeof o=="string"&&o.trim())return[]}const r=[];return Object.entries(e).forEach(([n,o])=>{if(!If(n))return;const i=n.trim();if(!i)return;let s=o;if(re(s)){const u=ne(s);u&&(s=u)}if(E(s)){const u={...s};u.name=i;let f="";const l=["mount","mountLabel","mountName"];for(let y=0;y<l.length;y+=1){const p=l[y];if(typeof u[p]!="string")continue;const d=u[p].trim();if(d&&d.toLowerCase()!==i.toLowerCase()){f=d;break}}if(!f&&Array.isArray(u.mounts)){const y=Te(u.mounts);y&&y.toLowerCase()!==i.toLowerCase()&&(f=y)}u.mount=typeof f=="string"?f:"",r.push(u);return}if(Array.isArray(s)){const u=Te(s),f=u&&u.toLowerCase()!==i.toLowerCase()?u:"";r.push({name:i,mount:f});return}if(typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"){const u=Te(s),f=u&&u.toLowerCase()!==i.toLowerCase()?u:"";r.push({name:i,mount:f});return}if(s==null){r.push({name:i,mount:""});return}const a=Te(s),c=a&&a.toLowerCase()!==i.toLowerCase()?a:"";r.push({name:i,mount:c})}),r}function ea(e,t=[]){const r=Array.isArray(e)?e:[e],n=[],o=new Set;let i=!1;const s=(c,u)=>{if(!c||typeof c!="object"){u&&(i=!0);return}const f={...c},y=(typeof f.name=="string"?f.name:"").trim();if(!y){u&&(i=!0);return}f.name!==y&&(f.name=y,u=!0);const d=(typeof f.mount=="string"?f.mount:"").trim();if(f.mount!==d&&(f.mount=d,u=!0),Object.prototype.hasOwnProperty.call(f,"mount")||(f.mount=d,u=!0),Object.prototype.hasOwnProperty.call(f,"mountState")){const m=(typeof f.mountState=="string"?f.mountState:"").trim();f.mountState!==m&&(f.mountState=m,u=!0),m||(delete f.mountState,u=!0)}u&&(i=!0),n.push(f),o.add(y)},a=c=>{if(c==null)return;if(typeof c=="string"){const f=Ae(c);if(f.success){a(f.parsed),i=!0;return}const l=Ye(c);l.length?l.forEach(y=>{s({name:y,mount:""},!0)}):i=!0;return}if(typeof c=="number"||typeof c=="boolean"||typeof c=="bigint"){s({name:String(c),mount:""},!0);return}if(Array.isArray(c)){if(c.length&&c.length<=2&&(typeof c[0]=="string"||typeof c[0]=="number"||typeof c[0]=="boolean"||typeof c[0]=="bigint")){const{selection:f,changed:l}=di(c);if(f){s(f,l);return}}c.forEach(f=>{const{selection:l,changed:y}=di(f);l?s(l,y):y&&(i=!0)});return}if(re(c)){const f=ne(c);f&&(a(f),i=!0);return}if(E(c)){const f=Qa(c);if(f.length){f.forEach(d=>{s(d,!0)});return}const{selection:l,changed:y}=di(c);if(l){s(l,y);return}const p=Object.values(c);p.length&&(a(p),i=!0);return}const u=Te(c);u?s({name:u,mount:""},!0):i=!0};for(let c=0;c<r.length;c+=1)a(r[c]);return Array.isArray(t)&&t.forEach(c=>{if(typeof c!="string")return;const u=c.trim();!u||o.has(u)||(n.push({name:u,mount:""}),o.add(u),i=!0)}),n.length?{selections:n,changed:i}:{selections:null,changed:i}}function Ke(e){const t=ns(e);if(t.restored)return Ke(t.value);if(typeof e=="string"){const r=Ae(e);if(r.success){const n=Ke(r.parsed);if(n)return n}return Ke({gearList:e,projectInfo:null})}if(re(e)){const r=ne(e);return r?Ke(r):null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"gearList")||Object.prototype.hasOwnProperty.call(e,"projectInfo")){const r=re(e.project)?ne(e.project):e.project;let n=e.projectInfo;re(n)&&(n=ne(n));let o=E(n)?n:null;if(!o&&typeof n=="string"){const w=Ae(n);w.success&&E(w.parsed)&&(o=w.parsed)}if(!o&&E(r)){let w=r.projectInfo;if(re(w)&&(w=ne(w)),E(w))o=w;else if(typeof w=="string"){const S=Ae(w);S.success&&E(S.parsed)&&(o=S.parsed)}}let i=null;const s=w=>{if(i&&i.length||w==null)return;let S=w;if(re(S)){const v=ne(S);v&&(S=Object.values(v).filter(B=>B!=null))}if(Array.isArray(S)&&S.length){i=S;return}if(E(S)){const v=Object.values(S).filter(B=>B!=null);if(v.length){i=v;return}}if(typeof S=="string"){const v=Ae(S);v.success&&Array.isArray(v.parsed)&&v.parsed.length&&(i=v.parsed)}};s(e.autoGearRules),!i&&E(r)&&s(r.autoGearRules);let a=re(e.gearList)?ne(e.gearList):e.gearList;if((a==null||typeof a=="string"&&!a)&&E(r)&&Object.prototype.hasOwnProperty.call(r,"gearList")&&(a=r.gearList),re(a)){const w=ne(a);w&&(a=w)}let c=typeof a=="string"||a&&typeof a=="object"?a:"",u=null;const f=re(e.gearSelectors)?ne(e.gearSelectors):e.gearSelectors;if(E(f))u=Jn(f);else if(typeof f=="string"){const w=Ae(f);w.success&&E(w.parsed)&&(u=Jn(w.parsed))}const l=re(e.powerSelection)?ne(e.powerSelection):e.powerSelection;let y=to(l);if(!y&&E(l)&&(y=to(l)),typeof c=="string"){const w=Ae(c);if(w.success){const S=Ke(w.parsed);S?(c=S.gearList,!o&&S.projectInfo&&(o=S.projectInfo),(!i||!i.length)&&Array.isArray(S.autoGearRules)&&S.autoGearRules.length&&(i=S.autoGearRules),!u&&E(S.gearSelectors)&&(u=Jn(S.gearSelectors)),!y&&E(S.powerSelection)&&(y=to(S.powerSelection))):(typeof w.parsed=="string"||E(w.parsed)&&Object.values(w.parsed).every(v=>typeof v=="string"))&&(c=w.parsed)}}c&&typeof c=="object"&&!E(c)&&(c=""),o&&Os(o),o&&(o=jf(o)||null),o&&Os(o);const p={gearList:Array.isArray(c)||E(c)?Tn(c):c,projectInfo:o?Zo(o):null},d=re(e.diagramPositions)?ne(e.diagramPositions):e.diagramPositions;let g=Xs(d);if(Object.keys(g).length===0&&E(r)){const w=re(r.diagramPositions)?ne(r.diagramPositions):r.diagramPositions;g=Xs(w)}Object.keys(g).length&&(p.diagramPositions=sh(g));const m=[];if(typeof e.projectHtml=="string"&&m.push(e.projectHtml),typeof e.gearHtml=="string"&&m.push(e.gearHtml),E(r)&&(typeof r.projectHtml=="string"&&m.push(r.projectHtml),typeof r.gearHtml=="string"&&m.push(r.gearHtml)),E(a)&&typeof a.gearHtml=="string"&&m.push(a.gearHtml),E(c)?(typeof c.projectHtml=="string"&&m.push(c.projectHtml),typeof c.gearHtml=="string"&&m.push(c.gearHtml)):typeof c=="string"&&m.push(c),!u&&E(r)){const w=re(r.gearSelectors)?ne(r.gearSelectors):r.gearSelectors;E(w)&&(u=Jn(w))}if(!u&&E(c)&&E(c.gearSelectors)&&(u=Jn(c.gearSelectors)),!y&&E(r)){const w=re(r.powerSelection)?ne(r.powerSelection):r.powerSelection;E(w)&&(y=to(w))}if(o){if(m.length)for(let w=0;w<m.length;w+=1){const S=Xc(m[w]);if(S){const v=Zo(S)||{},B=Zo(o)||{};p.projectInfo={...v,...B};break}}}else for(let w=0;w<m.length;w+=1){const S=Xc(m[w]);if(S){p.projectInfo=Zo(S);break}}const b=[],C=new Set,A=w=>{if(typeof w!="string")return;const S=w.trim();!S||C.has(S)||(C.add(S),b.push(S))},_=(w,S={})=>{if(w==null)return;if(S.fromSelections){(Array.isArray(w)?w:[w]).forEach(N=>{if(re(N)){const M=ne(N);if(M){_(M,{fromSelections:!0});return}}if(E(N)){const M=Qa(N);if(M.length){M.forEach(x=>{x&&typeof x.name=="string"&&A(x.name)});return}}const z=Te(N);z&&A(z)});return}const v=Ye(w);v.length&&v.forEach(B=>{A(B)})};if(p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lenses")){const{names:w}=Lf(p.projectInfo.lenses);p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=w.slice(),_(w)}_(e.lenses),E(r)&&_(r.lenses),_(a&&a.lenses),E(c)&&_(c.lenses),(!p.projectInfo||!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&b.length&&(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=b.slice());const P=[];p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&(_(p.projectInfo.lensSelections,{fromSelections:!0}),P.push(p.projectInfo.lensSelections)),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&(_(e.lensSelections,{fromSelections:!0}),P.push(e.lensSelections)),E(r)&&Object.prototype.hasOwnProperty.call(r,"lensSelections")&&(_(r.lensSelections,{fromSelections:!0}),P.push(r.lensSelections)),E(a)&&Object.prototype.hasOwnProperty.call(a,"lensSelections")&&(_(a.lensSelections,{fromSelections:!0}),P.push(a.lensSelections)),E(c)&&Object.prototype.hasOwnProperty.call(c,"lensSelections")&&(_(c.lensSelections,{fromSelections:!0}),P.push(c.lensSelections));const k=ea(P,b);k&&k.selections&&k.selections.length?(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lensSelections=k.selections,(!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&(p.projectInfo.lenses=k.selections.map(w=>typeof w.name=="string"?w.name:"").filter(w=>w))):k&&k.changed&&p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&delete p.projectInfo.lensSelections;const I=typeof e.gearListAndProjectRequirementsGenerated=="boolean"?e.gearListAndProjectRequirementsGenerated:m.some(w=>typeof w=="string"&&w.trim());if(p.gearListAndProjectRequirementsGenerated=I,i&&i.length&&(p.autoGearRules=ih(i)),u&&Object.keys(u).length&&(p.gearSelectors=u),y&&(p.powerSelection=ah(y)),Tg(e,p),p.projectInfo&&Os(p.projectInfo),p.projectInfo){const w=fe(p.projectInfo);w!==p.projectInfo&&(p.projectInfo=w)}if(p.autoGearRules){const w=fe(p.autoGearRules);w!==p.autoGearRules&&(p.autoGearRules=w)}if(p.gearSelectors){const w=fe(p.gearSelectors);w!==p.gearSelectors&&(p.gearSelectors=w)}if(p.diagramPositions){const w=fe(p.diagramPositions);w!==p.diagramPositions&&(p.diagramPositions=w)}if(p.powerSelection){const w=fe(p.powerSelection);w!==p.powerSelection&&(p.powerSelection=w)}return p}if(Object.prototype.hasOwnProperty.call(e,"projectHtml")||Object.prototype.hasOwnProperty.call(e,"gearHtml"))return{gearList:{projectHtml:e.projectHtml||"",gearHtml:e.gearHtml||""},projectInfo:null};if(E(e.project)){const r=Ke(e.project);if(r)return r}else if(typeof e.project=="string"){const r=Ae(e.project);if(r.success){const n=Ke(r.parsed);if(n)return n}}}return null}var lh=new Set(["gearList","projectInfo","projectHtml","gearHtml","autoGearRules","powerSelection","gearListAndProjectRequirementsGenerated"]),uh=new Set(["gearList","projectInfo","autoGearRules","diagramPositions","gearSelectors","powerSelection","gearListAndProjectRequirementsGenerated"]);function zi(e){if(!E(e)||!Object.keys(e).every(o=>uh.has(o)))return!1;const{gearList:r,projectInfo:n}=e;if(typeof r!="string"&&!(E(r)&&Object.keys(r).every(o=>typeof r[o]=="string"))||n!==null&&!E(n)||Object.prototype.hasOwnProperty.call(e,"autoGearRules")&&(!Array.isArray(e.autoGearRules)||!e.autoGearRules.length)||Object.prototype.hasOwnProperty.call(e,"diagramPositions")&&!E(e.diagramPositions)||Object.prototype.hasOwnProperty.call(e,"gearSelectors")&&!E(e.gearSelectors))return!1;if(Object.prototype.hasOwnProperty.call(e,"powerSelection")){const o=e.powerSelection;if(!E(o))return!1}return!(Object.prototype.hasOwnProperty.call(e,"gearListAndProjectRequirementsGenerated")&&typeof e.gearListAndProjectRequirementsGenerated!="boolean")}function Be(e){return typeof e!="string"?"":e.trim()}function fh(e){if(e==null)return Zt="",Tt=!1,"";const t=Be(e);return im(t)?(Zt="",Tt=!1,t):(Zt=t,Tt=!0,t)}function ph(e){return!Tt||e!==void 0&&Be(e)!==Zt?!1:(Zt="",Tt=!1,!0)}function Yr(e,t,r,n={}){if(!e||typeof e!="object")return null;const o=typeof r=="string"?r:"";if(Object.prototype.hasOwnProperty.call(e,o))return o;const i=Be(o);if(i&&i!==o&&Object.prototype.hasOwnProperty.call(e,i))return i;if(!t||typeof t!="object")return null;const{raw:s,normalized:a}=t;if(s&&typeof s.get=="function"&&s.has(o)){const c=s.get(o);if(Object.prototype.hasOwnProperty.call(e,c))return c}if(a&&typeof a.get=="function"&&a.has(i)){const c=a.get(i);if(Array.isArray(c)){if(n&&n.preferExact&&o){const f=c.find(l=>l===o&&Object.prototype.hasOwnProperty.call(e,l));if(f)return f}const u=c.find(f=>Object.prototype.hasOwnProperty.call(e,f));if(u)return u}else if(typeof c=="string"&&Object.prototype.hasOwnProperty.call(e,c))return c}return null}function dh(e={}){const t=new Map,r=new Map;return(e&&typeof e=="object"?Object.keys(e):[]).forEach(o=>{if(typeof o!="string")return;t.set(o,o);const i=Be(o);r.has(i)||r.set(i,[]),r.get(i).push(o)}),{raw:t,normalized:r}}function _t(e={}){const{forceRefresh:t=!1,forMutation:r=!1,skipMigrations:n=!1,skipAutoBackupExpansion:o=!1}=e||{};if(n||ke(),Zr&&!t){const S={...Xe},v=dh(S);return{projects:S,changed:!1,originalValue:{...Xe},lookup:Us(v)}}const i=T();let s=null;if(i&&typeof i.getItem=="function")try{s=i.getItem(pe)}catch{s=null}const a=Ne(i,pe,"Error loading project from localStorage:",null,{validate:S=>S===null||typeof S=="string"||Array.isArray(S)||E(S)}),c=a;let u=null;if(E(a)?u={...a}:u={},i&&typeof i.length=="number"){const S=i.length;for(let v=0;v<S;v++){const B=i.key(v);if(!B||!B.startsWith(Rt))continue;const N=B.substring(Rt.length);if(N!=null)try{const z=i.getItem(B),M=JSON.parse(Tr(z));u===null&&(u={}),u[N]=M}catch{}}}let f=a;(u!==null&&Object.keys(u).length>0||E(a))&&(f=u);const l={isAutoBackupKey:Dt};o&&(l.filter=S=>!Dt(S));const y=Zu(f,l),p={};let d=!1;const g=new Set,m=new Set,b=S=>{if(typeof S!="string")return;g.add(S);const v=S.trim();v&&m.add(v.toLowerCase())},C=new Map,A=new Map,_=(S,v)=>{if(typeof S!="string")return;const B=typeof v=="string"?v:S;C.set(S,B);const N=Be(S);A.has(N)||A.set(N,[]),A.get(N).push(B)},P=()=>({raw:In(C),normalized:In(A)}),k=()=>{const S={projects:p,changed:d,originalValue:c,lookup:P(),rawValue:s};return d?(Mc(null),r?{projects:ur(S.projects),changed:S.changed,originalValue:S.originalValue,lookup:Us(S.lookup)}:S):t?S:(Mc(S),Ag({forMutation:r})||S)};if(y==null)return k();if(typeof y=="string"){const S=Ke(y);if(S){const v=S&&S.projectInfo&&typeof S.projectInfo.projectName=="string"?S.projectInfo.projectName:"",B=Yn(v,g,m);p[B]=S,_("",B),b(B)}return d=!0,k()}if(Array.isArray(y)){const S=g,v=m;return y.forEach((B,N)=>{const z=Ke(B);if(!z){d=!0;return}const x=(E(B)&&typeof B.name=="string"?B.name.trim():`Project ${N+1}`)||`Project ${N+1}`,$=Yn(x,S,v);p[$]=z,_(x,$),b($)}),d=!0,k()}if(!E(y))return d=!0,k();const I=Object.keys(y);if(I.length>0&&I.every(S=>lh.has(S))){const S=Ke(y);if(S){const v=Yn("",g,m);p[v]=S,_("",v),b(v)}return d=!0,k()}return I.forEach(S=>{if(zi(y[S])){const v=typeof S=="string"?S.trim():"";v&&m.add(v.toLowerCase())}}),I.forEach(S=>{const v=Ke(y[S]);if(v){const B=y[S],z=!zi(B);let M=!1;if(!z)try{const $=_e(v),Kt=_e(B);$!==Kt&&(M=!0)}catch($){M=!0,console.warn("Unable to compare stored project entry during legacy long-GOP normalization check",$)}let x=S;if(z){const $=v&&v.projectInfo&&typeof v.projectInfo.projectName=="string"&&v.projectInfo.projectName?v.projectInfo.projectName:S;x=Yn($,g,m),d=!0}x!==S&&Object.prototype.hasOwnProperty.call(p,x)&&(x=Yn(x,g,m)),p[x]=v,_(S,x),b(x),!z&&M&&(d=!0)}else d=!0}),k()}function Rf(e,t){if(!e||typeof e.length!="number"||!E(t))return;const r=new Set(Object.keys(t).map(o=>Be(o))),n=[];for(let o=0;o<e.length;o+=1){const i=e.key(o);if(i&&i.startsWith(Rt)){const s=i.substring(Rt.length);r.has(s)||n.push(i)}}n.forEach(o=>ce(e,o,"Pruning orphan project shard:"))}function Tf(e){if(!e||h&&h.__cineMonolithicProjectCleanupDone)return;const t=e.getItem(pe);if(!t){h&&(h.__cineMonolithicProjectCleanupDone=!0);return}try{const r=JSON.parse(Tr(t));r&&pt(e,pe,r)}catch{}ce(e,pe,"Error clearing project monolithic storage after sharding:",{disableBackup:!1,disableMigrationCleanup:!0}),h&&(h.__cineMonolithicProjectCleanupDone=!0)}function Nf(e,t,r={}){if(e==null||t===void 0||t===null)return!1;const n=T();if(!n)return!1;const{skipCompression:o=!1}=r||{},i=Rt+Be(e),s={};s[e]=t;const c=ef(s,{isAutoBackupKey:Dt})[e];return Oe(n,i,c,`Error saving project shard "${e}":`,{disableCompression:o,forceCompressionOnQuota:!0,disableBackup:!0,onQuotaExceeded:()=>{const{projects:f}=_t({forMutation:!1,skipMigrations:!0});let l=Ys(f);if(l||(l=Ys(f,{force:!0})),l){const y=Rt+Be(l);return ce(n,y,`Pruning shard "${l}" to recover space:`),!0}return!1}})==="success"}function Xa(e,t={}){const{skipCompression:r=!1}=t||{},n=T();if(!(!e||typeof e!="object")){Va(e),Rf(n,e),Object.keys(e).forEach(o=>{Nf(o,e[o],{skipCompression:r})}),Tf(n),Ba(n);try{Ao(e,n)}catch(o){console.warn("Failed to update project index",o)}if(or(),je)try{je.postMessage("project-shards-changed")}catch{}}}let Nn=null;function Za(e){if(!e||typeof e!="object")return null;const t={};return Object.keys(e).forEach(n=>{if(typeof n!="string")return;const o=O&&typeof O.getProjectKeyFromStorageKey=="function"?O.getProjectKeyFromStorageKey(n):n;if(o==null)return;const i=e[n];if(!Object.prototype.hasOwnProperty.call(t,o)){t[o]=i;return}const s=t[o],a=i&&typeof i=="object"&&typeof i.lastModified=="number"?i.lastModified:null,c=s&&typeof s=="object"&&typeof s.lastModified=="number"?s.lastModified:null;typeof a=="number"&&typeof c=="number"&&a>c&&(t[o]=i)}),Object.keys(t).length?t:null}function Mf(e){if(!e||typeof e!="object")return null;if(!O||typeof O.getProjectStorageKey!="function")return e;const t={};return Object.keys(e).forEach(r=>{if(typeof r!="string")return;const n=O.getProjectStorageKey(r);t[n]=e[r]}),t}async function yh(){if(!O||typeof O.migrateUnprefixedProjectRecords!="function")return{migratedKeys:[],hasIndex:!1};try{const e=await O.getItem(jn),t=e&&typeof e=="object"?Object.keys(e):[],r=Za(e),n=await O.migrateUnprefixedProjectRecords({projectIndexKeys:t});if(r){Nn=r;const o=Mf(r);o&&await O.setItem(jn,o)}return{migratedKeys:n.migratedKeys||[],hasIndex:!!r}}catch(e){return console.warn("[storage.js] Project prefix migration failed",e),{migratedKeys:[],hasIndex:!1}}}function gh(){if(Nn)return Nn;const e=T(),t=O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter";if(!e||typeof e.getItem!="function"||t)return null;try{const r=e.getItem(jn);if(!r)return null;const n=JSON.parse(r);if(n&&typeof n=="object")return Za(n)||n}catch(r){console.warn("Failed to read project index",r)}return null}function Ao(e,t){if(!e||typeof e!="object")return;const r={};Object.keys(e).forEach(o=>{if(Dt(o))return;const i=e[o];i&&(r[o]={color:i.color,icon:i.icon,lastModified:i.lastModified,prepDays:i.prepDays,shootingDays:i.shootingDays,returnDays:i.returnDays,archived:i.archived,status:i.status})}),Nn=r;const n=O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter";if(O){const o=Mf(r);O.setItem(jn,o).catch(i=>console.warn("Failed to persist index to repo",i))}if(!n&&t&&typeof t.setItem=="function")try{t.setItem(jn,JSON.stringify(r))}catch(o){console.warn("Failed to write project index",o)}}function zf(e){const t=e!==void 0&&!(typeof e=="string"&&Dt(e));let{projects:r,changed:n,originalValue:o,lookup:i}=_t({skipAutoBackupExpansion:t}),s=null;if(e!==void 0&&(s=Yr(r,i,e,{preferExact:!0}),s!=null&&os(s)),n){const a=T();a&&pt(a,pe,o);const c=ur(r);Xa(c),r=c}if(e===void 0)return nm(r),r;if(s!=null&&Object.prototype.hasOwnProperty.call(r,s)){const a=r[s];if(a&&(!a.gearList||a.gearList==="")){const u=Uo()[s];u&&u.gearList&&(a.gearList=u.gearList)}return a}return null}function mh(){const e=gh();if(e)return e;const t=_t({forMutation:!1,skipAutoBackupExpansion:!0}),r={};if(t&&t.projects){const n=Object.keys(t.projects);for(let i=0;i<n.length;i++){const s=n[i];if(Dt(s))continue;const a=t.projects[s];a&&(r[s]={color:a.color,icon:a.icon,lastModified:a.lastModified,prepDays:a.prepDays,shootingDays:a.shootingDays,returnDays:a.returnDays,archived:a.archived,status:a.status})}const o=T();if(o)try{Ao(t.projects,o)}catch{}}return r}function xf(e){if(typeof e!="string")return"";const t=e.replace(/\s+/g," ").trim();return t?t.length<=120?t:t.slice(0,120):""}function Bf(e){const t=r=>String(r).padStart(2,"0");return[e.getFullYear(),t(e.getMonth()+1),t(e.getDate()),t(e.getHours()),t(e.getMinutes()),t(e.getSeconds())].join("-")}function hh(e,t){const n=Bf(new Date),o=xf(e),i=o?`${At}${n}-${o}`:`${At}${n}`,s=new Set(Object.keys(t));if(!s.has(i))return{name:i};let a=2,c=`${i}-${a}`;for(;s.has(c);)a+=1,c=`${i}-${a}`;return{name:c}}function Gf(e){if(e!==void 0){if(e===null||typeof e!="object")return e;try{const t=ur(e),r=fe(t);return r!==t?r:t}catch(t){console.warn("Unable to deep clone project for backup",t);const r={...e},n=fe(r);return n!==r?n:r}}}function Ff(e,t){if(!e||!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(typeof t=="string"&&t.startsWith(Fe))return{status:"skipped"};const r=e[t];if(r===void 0)return{status:"missing"};const{name:n}=hh(t,e);if(!n)return{status:"failed"};const o=Gf(r);return o===void 0?(typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipping deletion backup for project "${t}" because no stored data was available during backup creation.`),{status:"missing"}):(e[n]=o,{status:"created",backupName:n})}function bh(e){const{projects:t,changed:r,originalValue:n,lookup:o}=_t({forMutation:!0});if(!t||typeof t!="object")return{status:"invalid"};const i=Yr(t,o,e,{preferExact:!0}),s=Be(e),a=i??s;if(!Object.prototype.hasOwnProperty.call(t,a))return{status:"missing"};const c=Ff(t,a);if(c.status!=="created")return c;if(r){const u=T();u&&pt(u,pe,n)}return os(c.backupName),Xa(t),c}function Sh(e,t){const r=Bf(new Date),n=xf(e),o=n?`${Fe}${r}-${n}`:`${Fe}${r}`,i=new Set(Object.keys(t));if(!i.has(o))return{name:o};let s=2,a=`${o}-${s}`;for(;i.has(a);)s+=1,a=`${o}-${s}`;return{name:a}}function wh(e,t){if(!E(e)||typeof t!="string")return{status:"invalid"};if(!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(t.startsWith(Fe)||t.startsWith(At))return{status:"skipped"};const r=Gf(e[t]);if(r===void 0)return{status:"failed"};const{name:n}=Sh(t,e);return n?(e[n]=r,{status:"created",backupName:n}):{status:"failed"}}function ec(e,t,r={}){if(!E(t))return;const n=Ke(t);if(!n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped saving project "${e||""}" because the payload could not be normalised.`);return}const o=!!(r&&r.skipOverwriteBackup),i=!!(r&&r.skipCompression),s=typeof e=="string"?e:"",a=Be(s),c=_t({forMutation:!0}),u=E(c.projects)?c.projects:{};if(c.changed){const S=T();S&&pt(S,pe,c.originalValue)}const f=Yr(u,c.lookup,s,{preferExact:!0}),l=f!=null&&Object.prototype.hasOwnProperty.call(u,f)?u[f]:null,y=l?_e(l):null,p=_t({forMutation:!0}),d=E(p.projects)?p.projects:{};if(p.changed){const S=T();S&&pt(S,pe,p.originalValue)}const g=Yr(d,p.lookup,s,{preferExact:!0});let m=g,b=null;a&&a!==g&&!Object.prototype.hasOwnProperty.call(d,a)&&(m=a,b=g),m==null&&(m=a),!m&&m!==""&&(m="");const C=b??m,A=C!=null&&Object.prototype.hasOwnProperty.call(d,C),_=A?d[C]:null;if(A&&!o){const S=_e(_),v=_e(n);S!==v&&wh(d,C).status==="failed"&&console.warn(`Automatic backup before overwriting project "${C}" failed. Proceeding with save.`)}if(b!=null&&b!==m){let S=!!y;Object.prototype.hasOwnProperty.call(d,b)&&y?_e(d[b])!==y&&(S=!1):S=!1,S?(delete d[b],Vs(b)):typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped removing "${b}" while saving "${m}" because the original entry changed in another tab.`)}const P=r&&r.renamedFrom;if(P&&P!==m){const S=Yr(d,p.lookup,P,{preferExact:!0});S&&Object.prototype.hasOwnProperty.call(d,S)&&(delete d[S],Vs(S))}const k=m||"";d[k]=n,os(k),Va(d),O&&O.saveProject(k,n).catch(S=>console.warn("[saveProject] Repo write failed",S)),Zr&&(Xe[k]=n);const I=O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter";let w=!0;if(I||(w=Nf(k,n,{skipCompression:i})),w){const S=T();if(Rf(S,d),Tf(S),or(),je)try{je.postMessage("project-shards-changed")}catch{}Ba(S)}else Xa(d,{skipCompression:i})}function Df(e){if(e===void 0){const l=[T()];typeof localStorage<"u"&&l.indexOf(localStorage)===-1&&l.push(localStorage),l.forEach(p=>{if(p&&typeof p.removeItem=="function")try{p.removeItem(pe);const d=typeof de=="string"?de:"__backup";p.removeItem(`${pe}${d}`),p.removeItem("cameraPowerPlanner_project__backup")}catch(d){console.warn("[FactoryReset] Failed to force delete project keys",d)}if(ce(p,pe,"Error deleting project from storage:"),p&&typeof p.length=="number"){const d=[];for(let g=0;g<p.length;g++){const m=p.key(g);m&&m.startsWith(Rt)&&d.push(m)}d.forEach(g=>ce(p,g,"Error deleting project shard from storage:"))}});try{O&&O.clear().catch(p=>console.warn("[FactoryReset] Failed to clear StorageRepository",p)),Bs&&Bs.clear().catch(p=>console.warn("[FactoryReset] Failed to clear DataVault",p)),xe&&xe.reset()}catch(p){console.warn("[FactoryReset] Error clearing modern storage",p)}if(typeof cr=="function")try{cr()}catch(p){console.warn("Failed to clear UI cache during project deletion",p)}if(or(),je)try{je.postMessage("project-shards-changed")}catch{}Pr&&typeof Pr.clear=="function"&&Pr.clear();const y=T();y&&Ba(y);return}const{projects:t,changed:r,originalValue:n,lookup:o}=_t({forMutation:!0});if(r){const l=T();l&&pt(l,pe,n)}const i=Yr(t,o,e,{preferExact:!0}),s=i??Be(e);if(!Object.prototype.hasOwnProperty.call(t,s)){const l=Rt+Be(e),y=T();y&&ce(y,l,"Error deleting orphan project shard:");return}if(Ff(t,s).status==="failed"){console.warn(`Automatic backup before deleting project "${s}" failed. Deletion aborted.`),le();return}const c=Rt+Be(s),u=T(),f=O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter";if(u&&!f&&ce(u,c,"Error deleting project shard:"),Zr&&delete Xe[s],O&&typeof O.removeProject=="function"?O.removeProject(s).catch(l=>console.warn("Failed to delete from repo",l)):O&&O.removeItem(s).catch(l=>console.warn("Failed to delete from repo",l)),delete t[s],Vs(s),or(),je)try{je.postMessage("project-shards-changed")}catch{}}function Eh(e,t){if(!e||!t)return null;const{projects:r}=_t({forMutation:!0}),n=Yr(r,null,e,{preferExact:!0});if(!n||!r[n])return null;const o=t.trim();if(!o||o===n)return n;const i=r[n];if(i.name=o,E(i.projectInfo)||(i.projectInfo={}),i.projectInfo.projectName=o,Zr?(delete Xe[n],Xe[o]=i):(delete r[n],r[o]=i),O&&typeof O.removeProject=="function"?O.removeProject(n).catch(s=>console.warn("Failed to delete old project key",s)):O&&O.removeItem(n).catch(s=>console.warn("Failed to delete old project key",s)),ec(o,i),or(),je)try{je.postMessage("project-shards-changed")}catch{}return o}function Zc(){const{projects:e,changed:t,originalValue:r}=_t({forMutation:!0});if(t){const s=T();s&&pt(s,pe,r)}const n=new Set(Object.keys(e)),o=new Set([...n].map(s=>s.trim().toLowerCase())),i="Imported project";return(s,a,c=i)=>{const u=Ke(a);if(!u)return;!(a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"gearListAndProjectRequirementsGenerated")&&typeof a.gearListAndProjectRequirementsGenerated=="boolean")&&typeof u.gearListAndProjectRequirementsGenerated!="boolean"&&(u.gearListAndProjectRequirementsGenerated=!1);const l=[];if(typeof s=="string"&&l.push(s.trim()),E(a)){typeof a.name=="string"&&l.push(a.name.trim());const m=a.projectInfo;E(m)&&typeof m.projectName=="string"&&l.push(m.projectName.trim())}const y=typeof c=="string"&&c.trim()?c.trim():i,p=l.length>0?l[0]:y,d=typeof p=="string"?p.trim().toLowerCase():"",g=o.has(d)?Fm(p,n,o):Ha(p,n,o);ec(g,u,{skipCompression:!1}),n.add(g),o.add(g.trim().toLowerCase())}}function Ae(e){if(typeof e!="string")return{success:!1,parsed:null};const t=e.trim();if(!t)return{success:!1,parsed:null};const r=t[0],n=t[t.length-1];let o=null;if(r==="{"?o="}":r==="["?o="]":r==='"'&&(o='"'),!o||n!==o)return{success:!1,parsed:null};try{return{success:!0,parsed:JSON.parse(t)}}catch{return{success:!1,parsed:null}}}function lo(e,t,r="Imported project"){if(typeof e=="string"){const n=Ae(e);return n.success?lo(n.parsed,t,r):(t()(r,e,r),!0)}if(re(e)){const n=ne(e);return n?lo(Object.entries(n),t,r):!1}if(Array.isArray(e)){const n=e.map(s=>s==null?null:Array.isArray(s)&&s.length>=2?{name:s[0],project:s[1]}:E(s)&&typeof s.name=="string"?{name:s.name,project:s}:{name:"",project:s}).filter(Boolean);if(!n.length)return!0;const o=t();let i=0;return n.forEach(({name:s,project:a})=>{if(a==null)return;i+=1;let c="";typeof s=="string"?c=s:typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"?c=String(s):typeof s=="symbol"&&(c=s.description||s.toString()),o(c,a,`${r} ${i}`)}),!0}if(E(e)){const n=t();return Object.entries(e).forEach(([o,i])=>{const s=typeof o=="string"?o:gf(o);n(typeof s=="string"&&s?s:r,i,r)}),!0}return!1}function Oh(e){if(!e||typeof e!="object")return[];const t=[],r=i=>{i!=null&&t.push(i)};["projectData","projectCollection","projectEntries","legacyProjects","legacyProjectData"].forEach(i=>{Object.prototype.hasOwnProperty.call(e,i)&&r(e[i])}),E(e.data)&&(Object.prototype.hasOwnProperty.call(e.data,"project")&&r(e.data.project),Object.prototype.hasOwnProperty.call(e.data,"projects")&&r(e.data.projects));const o=e.plannerData;return Array.isArray(o)&&o.forEach(i=>{if(Array.isArray(i)&&i.length>=2){const c=i[0];typeof c=="string"&&c.toLowerCase().includes("project")&&r(i[1]);return}if(!i||typeof i!="object")return;const s=typeof i.key=="string"?i.key:typeof i.name=="string"?i.name:typeof i.id=="string"?i.id:typeof i.section=="string"?i.section:null;if(!s||!s.toLowerCase().includes("project"))return;const a=Object.prototype.hasOwnProperty.call(i,"value")?i.value:Object.prototype.hasOwnProperty.call(i,"data")?i.data:Object.prototype.hasOwnProperty.call(i,"project")?i.project:Object.prototype.hasOwnProperty.call(i,"projects")?i.projects:null;a!=null&&r(a)}),t}function Uf(){ke();const e=T(),t=Ne(e,et,"Error loading favorites from localStorage:",{},{validate:r=>r===null||E(r)});return E(t)?t:{}}function Kf(e){const t=T();if(e==null){ce(t,et,"Error deleting favorites from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid favorites payload. Expected a plain object.");return}qe(t,et),Oe(t,et,e,"Error saving favorites to localStorage:")}function Ah(){if(kt||(Lc||(Lc=!0,Pn&&(kt=Pn)),kt))return kt;const e=h&&typeof h=="object"?h:null;if(e&&e.cineFeaturesContacts&&typeof e.cineFeaturesContacts=="object")return kt=e.cineFeaturesContacts,kt;const t=e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null;if(t&&typeof t.resolveModule=="function")try{const r=t.resolveModule("cine.features.contacts",e);if(r&&typeof r=="object")return kt=r,kt}catch{}return kt}function $f(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return $f(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Ch(e){if(e&&typeof e.generateContactId=="function")try{const t=e.generateContactId();if(typeof t=="string"&&t)return t}catch{}return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function _h(e,t){if(!e||typeof e!="object")return null;const r=$f,n=r(e.id)||Ch(t),o=r(e.name),i=r(e.role),s=r(e.phone),a=r(e.email),c=r(e.website||e.url),u=r(e.notes||e.note||e.text),f=typeof e.avatar=="string"?e.avatar.trim():"",l=f&&f.startsWith("data:")?f:"",y=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),p=Number.isFinite(e.updatedAt)?e.updatedAt:y,d={id:n,name:o,role:i,phone:s,email:a,website:c,notes:u,createdAt:y,updatedAt:p};return l&&(d.avatar=l),d}function kh(e){if(!Array.isArray(e))return[];const t=e.filter(r=>r&&typeof r=="object").map(r=>({...r}));return t.sort((r,n)=>{const o=(r&&r.name?r.name:"").toLowerCase(),i=(n&&n.name?n.name:"").toLowerCase();if(o&&i&&o!==i)try{return o.localeCompare(i)}catch{}if(o&&!i)return-1;if(!o&&i)return 1;const s=r&&typeof r.createdAt=="number"?r.createdAt:0,a=n&&typeof n.createdAt=="number"?n.createdAt:0;return s-a}),t}function tc(e){if(!Array.isArray(e))return[];const t=Ah();if(t&&typeof t.sortContacts=="function")try{const o=t.sortContacts(e);if(Array.isArray(o))return o.filter(i=>i&&typeof i=="object")}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contacts via module.",o)}const r=t&&typeof t.normalizeContactEntry=="function"?t.normalizeContactEntry:null,n=[];for(let o=0;o<e.length;o+=1){const i=e[o];if(!i)continue;let s=null;if(r)try{s=r(i)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contact entry via module.",a),s=null}s||(s=_h(i,t)),s&&typeof s=="object"&&n.push(s)}return kh(n)}function Vf(){ke();const e=T(),t=Ne(e,tt,"Error loading contacts from localStorage:",[],{validate:r=>r===null||Array.isArray(r)});return Array.isArray(t)?tc(t):[]}function ta(e){const t=T();if(e==null){ce(t,tt,"Error deleting contacts from localStorage:");return}if(!Array.isArray(e)){console.warn("Ignoring invalid contacts payload. Expected an array.");return}const r=tc(e);qe(t,tt),Oe(t,tt,r,"Error saving contacts to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Hf(){return Ru.getOwnGear()}function qf(e){return Ru.saveOwnGear(e)}function ln(e){if(typeof e=="string")return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="bigint")return e.toString();if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return ln(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function rc(e){if(!e||typeof e!="object")return null;const t=ln(e.name),r=ln(e.role),n=ln(e.avatar),o=n&&n.toLowerCase().startsWith("data:")?n:"",i=ln(e.phone),s=ln(e.email);return!t&&!r&&!o&&!i&&!s?{name:"",role:"",avatar:"",phone:"",email:""}:{name:t,role:r,avatar:o,phone:i,email:s}}function Wf(){ke();const e=T(),t=Ne(e,lt,"Error loading user profile from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?rc(t)||{name:"",role:"",avatar:"",phone:"",email:""}:{name:"",role:"",avatar:"",phone:"",email:""}}function yi(e){const t=T();if(e==null){ce(t,lt,"Error deleting user profile from localStorage:");return}const r=rc(e)||{name:"",role:"",avatar:"",phone:"",email:""};if(!r.name&&!r.role&&!r.avatar&&!r.phone&&!r.email){ce(t,lt,"Error deleting user profile from localStorage:");return}qe(t,lt),Oe(t,lt,r,"Error saving user profile to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,enableCompressionSweep:!1})}function Yf(){ke();const e=T(),t=Ne(e,Xt,"Error loading feedback from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?t:{}}function Jf(e){const t=T();if(e==null){ce(t,Xt,"Error deleting feedback from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid feedback payload. Expected a plain object.");return}qe(t,Xt),Oe(t,Xt,e,"Error saving feedback to localStorage:")}function Jr(e){if(!e)return null;if(typeof e=="string"){const t=e.trim();return t?{createdAt:t}:null}if(typeof e=="object"){const t=typeof e.createdAt=="string"&&e.createdAt.trim()?e.createdAt.trim():typeof e.iso=="string"&&e.iso.trim()?e.iso.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?e.timestamp.trim():null;if(!t)return null;const r={createdAt:t};return typeof e.fileName=="string"&&e.fileName.trim()?r.fileName=e.fileName.trim():typeof e.name=="string"&&e.name.trim()&&(r.fileName=e.name.trim()),r}return null}function Co(){if(Qr!==null){const n=Qr;if(Array.isArray(n))return n.map(Jr).filter(Boolean)}ke();const e=T(),t=Ne(e,Je,"Error loading full backup history from localStorage:",[],{validate:n=>n===null||Array.isArray(n)});if(!Array.isArray(t))return[];const r=t.map(Jr).filter(Boolean);return Qr=r,O.setItem(Je,r).catch(n=>{console.warn("[storage.js] Failed to persist backup history to new storage:",n)}),r}function xi(e){const t=T();if(e==null){Qr=[],ce(t,Je,"Error deleting full backup history from localStorage:"),O.removeItem(Je).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)});return}if(!Array.isArray(e)){console.warn("Ignoring invalid full backup history payload. Expected an array.");return}const r=e.map(Jr).filter(Boolean);if(!r.length){e.length===0?(Qr=[],ce(t,Je,"Error deleting full backup history from localStorage:"),O.removeItem(Je).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)})):console.warn("Ignoring full backup history update because no valid entries were provided.");return}Qr=r,qe(t,Je),Oe(t,Je,r,"Error saving full backup history to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0}),O.setItem(Je,r).catch(n=>{console.warn("[storage.js] Failed to persist backup history to new storage:",n)})}var Qf=e=>{const t=Jr(e);if(!t)return Co();const r=Co();r.push(t);const n=r.slice(-200);return xi(n),n};function Wt(e,t,r=0){if(e==null)return[];if(r>50)return[];if(Array.isArray(e)){const o=[],i=e.length,s=t||new WeakSet;if(s.has(e))return[];s.add(e);for(let a=0;a<i;a+=1){const c=e[a];if(!(typeof c=="object"&&c!==null&&s.has(c)))if(Array.isArray(c)){const u=Wt(c,s,r+1);if(u&&u.length)for(let f=0;f<u.length;f+=1)o.push(u[f])}else{const u=Jr(c);u&&o.push(u)}}return o}const n=t||new WeakSet;if(typeof e=="object"&&e!==null){if(n.has(e))return[];n.add(e)}if(re(e)){const o=ne(e);return o?Wt(Object.values(o),n,r+1):[]}if(typeof e=="string"){const o=Ae(e);if(o.success)return Wt(o.parsed,n,r+1);const i=Jr(e);return i?[i]:[]}if(Array.isArray(e))return[];if(E(e)){if(Array.isArray(e.history))return Wt(e.history,n,r+1);if(Array.isArray(e.entries))return Wt(e.entries,n,r+1);if(Array.isArray(e.list))return Wt(e.list,n,r+1);const o=Jr(e);if(o)return[o];const i=Object.values(e);if(i.length)return Wt(i,n,r+1)}return[]}var Bi=1;function Ph(){var e=0;if(typeof Date<"u"&&Date&&typeof Date.now=="function")e=Date.now();else try{e=new Date().getTime()}catch{e=Math.floor(Math.random()*1e9)}var t=0;try{t=Math.floor(Math.random()*1e6)}catch{t=e%1e6}return"doc-tracker-"+e.toString(36)+"-"+t.toString(36)}function el(e){var t=!1,r=null;if(e&&typeof e=="object"){typeof e.completed=="boolean"?t=e.completed:typeof e.checked=="boolean"?t=e.checked:typeof e.value=="boolean"?t=e.value:e.done===!0&&(t=!0);var n=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?n=e.updatedAt.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?n=e.timestamp.trim():typeof e.completedAt=="string"&&e.completedAt.trim()&&(n=e.completedAt.trim()),n&&(r=n)}else if(typeof e=="boolean")t=e;else if(typeof e=="string"){var o=e.trim().toLowerCase();(o==="true"||o==="1"||o==="yes"||o==="done")&&(t=!0)}return{completed:t===!0,updatedAt:typeof r=="string"?r:null}}function jh(e){var t={};if(Array.isArray(e)){for(var r=0;r<e.length;r+=1){var n=e[r];if(n!=null){if(typeof n=="string"&&n.trim()){t[n.trim()]={completed:!0,updatedAt:null};continue}if(typeof n=="object"){var o=null;if(typeof n.id=="string"&&n.id.trim()?o=n.id.trim():typeof n.key=="string"&&n.key.trim()?o=n.key.trim():typeof n.name=="string"&&n.name.trim()&&(o=n.name.trim()),!o)continue;t[o]=el(n)}}}return t}if(e&&(typeof e=="object"||typeof e=="function"))for(var i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(a!=null){var c=typeof a=="string"?a:String(a);if(c){var u=c.trim();u&&(t[u]=el(e[a]))}}}return t}function Ih(e){var t={};if(e&&(typeof e=="object"||typeof e=="function"))for(var r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n];o&&(t[o]=jh(e[o]))}return t.locales||(t.locales={}),t.helpTopics||(t.helpTopics={}),t.printGuides||(t.printGuides={}),t}function tl(e){if(!e||typeof e!="object"&&typeof e!="function")return null;var t=null;typeof e.id=="string"&&e.id.trim()&&(t=e.id.trim()),!t&&typeof e.key=="string"&&e.key.trim()&&(t=e.key.trim()),t||(t=Ph());var r="";typeof e.name=="string"?r=e.name.trim():typeof e.title=="string"&&(r=e.title.trim());var n="";typeof e.targetDate=="string"&&e.targetDate.trim()?n=e.targetDate.trim():typeof e.releaseDate=="string"&&e.releaseDate.trim()&&(n=e.releaseDate.trim());var o="";if(typeof e.createdAt=="string"&&e.createdAt.trim()?o=e.createdAt.trim():typeof e.generatedAt=="string"&&e.generatedAt.trim()&&(o=e.generatedAt.trim()),!o)try{o=new Date().toISOString()}catch{o=""}var i=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?i=e.updatedAt.trim():typeof e.modifiedAt=="string"&&e.modifiedAt.trim()?i=e.modifiedAt.trim():typeof e.lastUpdated=="string"&&e.lastUpdated.trim()?i=e.lastUpdated.trim():typeof e.timestamp=="string"&&e.timestamp.trim()&&(i=e.timestamp.trim()),i||(i=o||null);var s="";typeof e.notes=="string"?s=e.notes.trim():typeof e.summary=="string"&&(s=e.summary.trim()),s&&s.length>8e3&&(s=s.slice(0,8e3));var a=!1;if(typeof e.archived=="boolean")a=e.archived;else if(typeof e.status=="string"){var c=e.status.trim().toLowerCase();(c==="archived"||c==="closed"||c==="complete")&&(a=!0)}var u=Ih(e.statuses);return{id:t,name:r,targetDate:n,createdAt:typeof o=="string"?o:"",updatedAt:typeof i=="string"?i:null,statuses:u,notes:s,archived:a===!0}}function uo(e){var t={version:Bi,releases:[]};if(e==null)return t;var r=e;if(Array.isArray(r))return t.releases=r.map(tl).filter(Boolean),t;if(typeof r!="object"&&typeof r!="function")return t;typeof r.version=="number"&&Number.isFinite(r.version)&&(t.version=r.version);var n=null;if(Array.isArray(r.releases)?n=r.releases:Array.isArray(r.entries)?n=r.entries:Array.isArray(r.logs)&&(n=r.logs),!n&&r&&typeof r=="object"){var o=Object.values(r);o.length&&o.every(function(i){return i&&typeof i=="object"&&!Array.isArray(i)})&&(n=o)}return!n||!Array.isArray(n)?t.releases=[]:t.releases=n.map(tl).filter(Boolean),t}function Xf(){ke();const e=T(),t=Ne(e,Jt,"Error loading documentation tracker from localStorage:",null,{validate:n=>n===null||E(n)||Array.isArray(n)});if(!t)return{version:Bi,releases:[]};const r=uo(t);return!r||!Array.isArray(r.releases)?{version:Bi,releases:[]}:r}function gi(e){const t=T();if(e==null){ce(t,Jt,"Error deleting documentation tracker from localStorage:");return}const r=uo(e);if(!r.releases.length){ce(t,Jt,"Error deleting documentation tracker from localStorage:");return}qe(t,Jt),Oe(t,Jt,{version:Bi,releases:r.releases},"Error saving documentation tracker to localStorage:",{disableCompression:!0})}function Zf(){ke();const e=T(),t=Ne(e,Rr,"Error loading automatic gear rules from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?fe(r):[];if(n!==r&&nc(n,{skipNormalization:!0}),Array.isArray(n)){let o=!1;const i=n.map(s=>s&&typeof s=="object"&&typeof s.enabled>"u"?(o=!0,{...s,enabled:!0}):s);return o?i:n}return[]}function nc(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],i=n?o:Array.isArray(o)?fe(o):[],s=T();return qe(s,Rr),Oe(s,Rr,i,"Error saving automatic gear rules to localStorage:",{disableCompression:!0}),i}function oc(){if(ke(),Array.isArray(pn)&&pn.length){const{normalized:i,changed:s}=Ti(pn);return s&&Gi(i,{skipNormalization:!0}),i}const e=T(),t=Ne(e,ut,"Error loading automatic gear rule backups from localStorage:",[],{validate:i=>i===null||Array.isArray(i)}),r=Array.isArray(t)?t:[],{normalized:n,changed:o}=Ti(r);return o&&Gi(n,{skipNormalization:!0}),pn=n,n}function Gi(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],{normalized:i}=n?{normalized:o}:Ti(o);pn=i;const s=T();qe(s,ut);let a=!1,c=!1;if(typeof window<"u"&&window.localStorage===s){const f=typeof O<"u"&&O.driver&&O.driver.constructor.name==="IndexedDBAdapter";typeof O<"u"&&O.setItem(ut,i).catch(l=>{if(console.warn("[Storage] Failed to async persist Auto Gear Backups to IDB:",l),f)try{Oe(s,ut,i,"Error saving automatic gear rule backups to localStorage:")}catch(y){console.warn("[Storage] Failed to persist Auto Gear Backups fallback to localStorage:",y)}})}if(!(typeof O<"u"&&O.driver&&O.driver.constructor.name==="IndexedDBAdapter"))return Oe(s,ut,i,"Error saving automatic gear rule backups to localStorage:",{onQuotaExceeded:(f,l={})=>{const y=Js(i);if(y){const d=y.label;return console.warn(d?`Removed automatic gear backup "${d}" to free up storage space before saving gear backups.`:"Removed oldest automatic gear backup entry to free up storage space before saving gear backups."),!0}const p=l&&l.storage?l.storage:s;return!!(!a&&(a=!0,Lm(p))||!c&&(c=!0,Qs()))}}),i}function ep(){ke();const e=T();return Sf(e,tn,"Error loading automatic gear seed flag from localStorage:")}function ra(e){const t=T();wf(t,tn,!!e,"Error saving automatic gear seed flag to localStorage:")}function tp(){ke();const e=T(),t=Ne(e,Nt,"Error loading automatic gear presets from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?fe(r):[];return n!==r&&is(n,{skipNormalization:!0}),Array.isArray(n)?n:[]}let Fi=null,fo=null,po=null,pn=null,Di=null,Ui=null,_o=null,ko=null,Po=null,jo=null,Io=null,vo=null,Lo=null,Ro=null,To=null,No=null,Mo=null,Qr=null;function vh(){const e=new Set,t=r=>{if(typeof r=="string"){const n=r.trim();n&&e.add(n)}};if(typeof Ki=="function")try{t(Ki())}catch(r){console.warn("Unable to read automatic gear active preset id while evaluating compression policy.",r)}if(typeof $i=="function")try{t($i())}catch(r){console.warn("Unable to read automatic gear auto preset id while evaluating compression policy.",r)}return e}function is(e,t={}){const r=t||{},{skipNormalization:n=!1,disableCompression:o}=r,i=Array.isArray(e)?e.slice():[],s=n?i:Array.isArray(i)?fe(i):[],a=T();qe(a,Nt);let c=typeof o=="boolean"?o:!1;if(o===void 0){const f=vh();f.size>0&&(c=s.some(l=>l&&typeof l=="object"&&typeof l.id=="string"&&f.has(l.id)))}return O&&O.setItem(Nt,s).catch(f=>console.warn("Failed to save auto gear presets to repo",f)),O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter"||Oe(a,Nt,s,"Error saving automatic gear presets to localStorage:",c?{disableCompression:!0}:void 0),s}function rp(){if(Fi)return Fi;ke();const e=T(),t=Ne(e,Mt,"Error loading automatic gear monitor defaults from localStorage:",{},{validate:o=>o===null||typeof o=="object"}),r=t&&typeof t=="object"?t:{},n=E(r)?fe(r):{};return n!==r&&ic(n,{skipNormalization:!0}),n&&typeof n=="object"?n:{}}function ic(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=e&&typeof e=="object"?{...e}:{},i=n?o:E(o)?fe(o):{},s=T();return qe(s,Mt),Fi=i,O&&O.setItem(Mt,i).catch(c=>console.warn("Failed to save monitor defaults to repo",c)),O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter"||Oe(s,Mt,i,"Error saving automatic gear monitor defaults to localStorage:"),i}function rl(e,t){if(!e)return;const r=t||T();if(!r)return;let n;try{n=r.getItem(Nt)}catch(a){console.error("Error loading automatic gear presets while removing autosaved preset from localStorage:",a),Se("read access",a,r),le();return}if(n===null||typeof n>"u")return;let o,i=n;typeof n=="string"&&n&&(i=rn(n));try{o=JSON.parse(i)}catch(a){console.error("Error parsing automatic gear presets while removing autosaved preset from localStorage:",a);return}if(!Array.isArray(o))return;const s=o.filter(a=>!a||typeof a!="object"?!0:a.id!==e);s.length!==o.length&&is(s,{skipNormalization:!0})}function Ki(){if(fo!==null)return typeof fo=="string"?fo:"";ke();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(St);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear active preset from localStorage:",t),Se("read access",t,e),le(),""}}function np(e){if(fo=e||"",O&&(e?O.setItem(St,e).catch(n=>console.warn("Failed to save active preset id",n)):O.removeItem(St).catch(n=>console.warn("Failed to remove active preset id",n))),O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter")return;const r=T();if(r)try{e?r.setItem(St,e):r.removeItem(St)}catch(n){console.error("Error saving automatic gear active preset to localStorage:",n),Se("write access",n,r),le()}}function $i(){if(po!==null)return typeof po=="string"?po:"";ke();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(ct);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear auto preset from localStorage:",t),Se("read access",t,e),le(),""}}function op(e){if(po=e||"",O&&(e?O.setItem(ct,e).catch(o=>console.warn("Failed to save auto preset id",o)):O.removeItem(ct).catch(o=>console.warn("Failed to remove auto preset id",o))),O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter")return;const r=T();if(!r)return;let n="";try{const o=r.getItem(ct);typeof o=="string"&&o&&(n=o)}catch(o){console.error("Error inspecting automatic gear auto preset in localStorage:",o),Se("read access",o,r)}try{e?(r.setItem(ct,e),n&&n!==e&&rl(n,r)):(r.removeItem(ct),n&&rl(n,r))}catch(o){console.error("Error saving automatic gear auto preset to localStorage:",o),Se("write access",o,r),le()}}function ip(){if(Ui!==null)return!!Ui;ke();const e=T();return Sf(e,ar,"Error loading automatic gear backup visibility from localStorage:")}function na(e){if(Ui=!!e,O&&O.setItem(ar,!!e).catch(n=>console.warn("Failed to save visibility",n)),O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter")return;const r=T();wf(r,ar,!!e,"Error saving automatic gear backup visibility to localStorage:")}function sp(){const t=Number(vg);if(!Number.isFinite(t))return fn;const r=Math.round(t);return Number.isFinite(r)?r<at?at:r>fn?fn:r:fn}function dn(e){const t=Number(e);if(!Number.isFinite(t))return zo();const r=Math.round(t);if(!Number.isFinite(r))return zo();if(r<at)return at;const n=sp();return r>n?n:r}function zo(){const e=sp();if(h&&typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=="number"){const r=h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT;if(Number.isFinite(r)&&r>=at){const n=Math.round(r);return Number.isFinite(n)?n<at?at:n>e?e:n:e}}const t=Math.round(Xu);return Number.isFinite(t)?t>e?e:t<at?at:t:at}function yo(e,t=zo()){if(e==null)return t;if(typeof e=="number")return dn(e);if(typeof e=="string"){const r=e.trim();if(!r)return t;const n=Number(r);if(Number.isFinite(n))return dn(n);const o=Ae(r);return o&&o.success?yo(o.parsed,t):t}if(Array.isArray(e)){for(let r=0;r<e.length;r+=1){const n=yo(e[r],null);if(typeof n=="number"&&Number.isFinite(n))return dn(n)}return t}if(E(e)){const r=["value","retention","limit","count"];for(let n=0;n<r.length;n+=1){const o=r[n];if(!Object.prototype.hasOwnProperty.call(e,o))continue;const i=yo(e[o],null);if(typeof i=="number"&&Number.isFinite(i))return dn(i)}return t}return t}function ap(){if(Di!==null)return Di;ke();const e=T(),t=Ne(e,zt,"Error loading automatic gear backup retention from localStorage:",zo(),{validate:r=>r===null||typeof r=="number"||typeof r=="string"||Array.isArray(r)||E(r)});return yo(t)}function cp(e){if(e==null||typeof e=="function"||typeof e=="object"&&!Array.isArray(e)&&!E(e))return;const t=T(),r=yo(e);Di=r,O&&O.setItem(zt,r).catch(o=>console.warn("Failed to save backup retention",o)),!(O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter")&&(qe(t,zt),Oe(t,zt,r,"Error saving automatic gear backup retention to localStorage:"))}async function Lh(){try{typeof globalThis<"u"&&(globalThis.__cameraPowerPlannerFactoryResetting=!0),typeof global<"u"&&(global.__cameraPowerPlannerFactoryResetting=!0),typeof window<"u"&&(window.__cameraPowerPlannerFactoryResetting=!0),h&&(h.__cameraPowerPlannerFactoryResetting=!0,h.__cineMonolithicProjectCleanupDone=!1),typeof sessionStorage<"u"&&sessionStorage.setItem($e,"true"),typeof localStorage<"u"&&localStorage.setItem($e,"true")}catch{}if(je)try{je.postMessage("factory-reset")}catch{}const e="Error clearing storage:";try{Df()}catch(l){console.warn("Unable to clear stored projects during factory reset",l)}or(),Et&&typeof Et.clear=="function"&&Et.clear(),Array.isArray(Er)&&(Er.length=0);try{let l=null;if(h&&typeof h.clearBackupVault=="function"?l=h.clearBackupVault:typeof window<"u"&&typeof window.clearBackupVault=="function"?l=window.clearBackupVault:h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup.clearBackupVault=="function"&&(l=h.cineFeatureBackup.clearBackupVault),l&&await l(),typeof indexedDB<"u"){const y=["cinePowerPlannerBackupVault","cinePowerPlanner","cameraPowerPlanner"];if(typeof indexedDB.databases=="function")try{(await indexedDB.databases()).forEach(d=>{d.name&&!y.includes(d.name)&&y.push(d.name)})}catch(p){console.warn("Failed to list IndexedDB databases during factory reset",p)}await Promise.all(y.map(p=>new Promise(d=>{try{const g=indexedDB.deleteDatabase(p);g.addEventListener("success",()=>d()),g.addEventListener("error",()=>{console.warn(`Failed to delete IndexedDB database "${p}" during factory reset`,g.error),d()}),g.addEventListener("blocked",()=>{console.warn(`Deletion of IndexedDB database "${p}" blocked during factory reset`),d()})}catch(g){console.warn(`Error initiating deletion of IndexedDB database "${p}"`,g),d()}})))}}catch(l){console.warn("Failed to clear backup vault during factory reset",l)}const t=T(),r=(l,y)=>{if(l){if(typeof l.clear=="function")try{l.clear()}catch(p){console.warn(`Failed to clear ${y} using clear(), falling back to manual removal.`,p)}try{const p=[];try{const d=l.length;for(let g=0;g<d;g++){const m=l.key(g);m&&p.push(m)}}catch(d){console.warn(`Failed to iterate ${y} by index`,d)}try{const d=Object.keys(l);Array.isArray(d)&&d.forEach(g=>{g&&!p.includes(g)&&p.push(g)})}catch(d){}p.forEach(d=>{if(d!==$e)try{l.removeItem(d)}catch(g){console.warn(`Failed to remove key ${d} from ${y}`,g)}})}catch(p){console.warn(`Failed to iterate ${y} for strict cleanup`,p)}}};r(t,"safeLocalStorage"),typeof localStorage<"u"&&localStorage!==t&&r(localStorage,"localStorage"),typeof sessionStorage<"u"&&r(sessionStorage,"sessionStorage");const n=["settingsActiveTab",typeof h<"u"&&h&&typeof h.INSTALL_BANNER_DISMISSED_KEY=="string"?h.INSTALL_BANNER_DISMISSED_KEY:"cine_install_banner_dismissed"],o=(l,y)=>{if(!l||typeof l.length!="number"||typeof l.key!="function")return;const p=[],d=l.length;for(let g=0;g<d;g++){const m=l.key(g);m&&(m.startsWith("cameraPowerPlanner_")||m.startsWith("cine_")||m.startsWith("cinePowerPlanner_")||m.startsWith("cinePowerPlanner")||m.startsWith("cineRental")||m.startsWith("__cine")||m.startsWith("cine_")||n.includes(m))&&m!==$e&&p.push(m)}p.forEach(g=>{try{l.removeItem(g)}catch(m){console.warn(`Failed to remove key ${g} from ${y}`,m)}})};if(o(t,"safeLocalStorage"),typeof localStorage<"u"&&localStorage!==t&&o(localStorage,"localStorage"),typeof sessionStorage<"u"&&o(sessionStorage,"sessionStorage"),typeof cr=="function")try{cr()}catch{}if(["cineBackupVaultFallbackRecords",Ve,Ze,Xt,pe,Zi,"cameraPowerPlanner_projects","cameraPowerPlanner_project_shards",et,tt,Rr,ut,tn,Nt,St,ct,ar,zt,Mt,Lr(),rt,Ot,za,Bt,lt,Jt,Je,Ut,qs,wt,"cameraPowerPlanner_lastProject","cameraPowerPlanner_onboardingComplete","cameraPowerPlanner_tourShown","cameraPowerPlanner_v1_migration","cameraPowerPlanner_v2_migration","cameraPowerPlanner_sharded","cameraPowerPlanner_forceLegacyBundle","cameraPowerPlanner_forceLegacyBundleRetry",typeof h<"u"&&h.TEMPERATURE_UNIT_STORAGE_KEY,typeof h<"u"&&h.FOCUS_SCALE_STORAGE_KEY,typeof h<"u"&&h.INSTALL_BANNER_DISMISSED_KEY,"cine_install_banner_dismissed","cameraPowerPlanner_project__backup","cameraPowerPlanner_project__legacyMigrationBackup","cameraPowerPlanner_setups__backup","cameraPowerPlanner_setups__legacyMigrationBackup"].forEach(l=>{l&&(ce(t,l,e),typeof t.removeItem=="function"&&(t.removeItem(`${l}${de}`),t.removeItem(`${l}${zr}`)))}),typeof sessionStorage<"u"){ce(sessionStorage,wt,e),ce(sessionStorage,"__cineLoggingHistory",e),ce(sessionStorage,"__cineLoggingConfig",e);try{const l=sessionStorage.getItem($e);sessionStorage.clear(),l&&sessionStorage.setItem($e,l)}catch{}}if(typeof caches<"u"&&typeof caches.keys=="function")try{const l=await caches.keys();await Promise.all(l.map(function(y){return caches.delete(y)})),typeof console<"u"&&typeof console.log=="function"&&console.log("Storage reset: Service Worker caches cleared.")}catch(l){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Storage reset: Failed to clear Service Worker caches.",l)}["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",Gt,Re].forEach(l=>{ce(t,l,e,{disableBackup:!0}),typeof t.removeItem=="function"&&t.removeItem(`${l}${de}`)});const a=["cameraPowerPlanner_onboardingTutorial","cinePowerPlanner_onboardingTutorial","cameraPowerPlanner_onboardingComplete","cameraPowerPlanner_tourShown"],c=l=>{if(l)for(let y=0;y<a.length;y+=1){const p=a[y];ce(l,p,e),typeof l.removeItem=="function"&&l.removeItem(`${p}${de}`)}},u=Oo([t,T(),Rn("localStorage"),typeof localStorage<"u"?localStorage:null]);for(let l=0;l<u.length;l+=1)c(u[l]);const f=Oo([typeof sessionStorage<"u"?sessionStorage:null,Rn("sessionStorage")]);for(let l=0;l<f.length;l+=1)c(f[l]);try{const l=h&&h.cineLogging?h.cineLogging:null;l&&typeof l.clearHistory=="function"&&l.clearHistory({persist:!1})}catch(l){console.warn("Unable to clear logging history during factory reset",l)}try{h&&typeof h.name=="string"&&(h.name=""),typeof window<"u"&&typeof window.name=="string"&&(window.name="")}catch(l){console.warn("Unable to reset window.name during factory reset",l)}try{if(typeof navigator<"u"&&navigator.serviceWorker){const l=await navigator.serviceWorker.getRegistrations();for(const y of l)await y.unregister()}}catch(l){console.warn("Failed to unregister service workers",l)}typeof console<"u"&&typeof console.log=="function"&&console.log("Factory reset cleanup complete. Waiting for reload.")}function he(e){if(e===kr&&_o)return _o;if(e===rt&&ko)return ko;if(e===Gt&&Po)return Po;if(e===Re&&jo)return jo;if(e===tt&&Io)return Io;if(e===Bt&&vo)return vo;if(e===lt&&Lo)return Lo;if(e===et&&Ro)return Ro;if(e===Ft&&To)return To;if(e===sr&&No)return No;if(e===ir()&&Mo)return Mo;const t=T();if(!t||typeof t.getItem!="function")return null;const r=Ct(e);for(let n=0;n<r.length;n+=1){const o=r[n];try{const i=t.getItem(o);if(i==null){if(jt.has(o))try{const s=t.getItem(`${o}${de}`);if(s!=null){const a=Tr(s);return typeof a=="string"?a:String(s)}}catch(s){console.warn("Unable to read backup key for export",o,s),Se("read access",s,t)}}else{const s=Tr(i);return typeof s=="string"?s:String(i)}}catch(i){console.warn("Unable to read storage key for backup",o,i),Se("read access",i,t)}}return null}function Gr(e){if(e==null)return null;if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isNaN(e)?null:e!==0;const t=String(e).trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}function sc(e){if(e==null)return null;let t=null,r=e;if(typeof e=="string"){const c=e.trim();if(!c)return null;t=c;try{r=JSON.parse(c)}catch{return{normalized:null,serialized:t}}}if(!r||typeof r!="object")return t?{normalized:null,serialized:t}:null;const n=typeof r.sections=="object"&&r.sections!==null,o=n?r.sections:r,i={};if(o&&typeof o=="object"){const c=Object.keys(o);for(let u=0;u<c.length;u+=1){const f=c[u],l=o[f];typeof l=="boolean"&&(i[f]=l)}}let s=null;if(typeof r.layout=="string"){const c=r.layout.trim();c&&(s=c)}s||(s=n?"standard":"rental");const a={sections:i,layout:s};if(n){const c=Object.keys(r);for(let u=0;u<c.length;u+=1){const f=c[u];f==="sections"||f==="layout"||(a[f]=vr(r[f]))}}return{normalized:a,serialized:t}}function Rh(){const e={},t=Gr(he("darkMode"));t!==null&&(e.darkMode=t);const r=Gr(he("pinkMode"));r!==null&&(e.pinkMode=r);const n=Gr(he("highContrast"));n!==null&&(e.highContrast=n);const o=Gr(he("reduceMotion"));o!==null&&(e.reduceMotion=o);const i=Gr(he("relaxedSpacing"));i!==null&&(e.relaxedSpacing=i);const s=Gr(he("showAutoBackups"));s!==null&&(e.showAutoBackups=s);const a=he("accentColor");a&&(e.accentColor=a);const c=he("fontSize");c&&(e.fontSize=c);const u=he("fontFamily");u&&(e.fontFamily=u);const f=he("language");f&&(e.language=f);const l=ir(),y=he(l);if(y)if(y==="[object Object]"||String(y).includes("[object Object]"))typeof DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}};else try{e.mountVoltages=JSON.parse(y)}catch(C){console.warn("Failed to parse stored mount voltages for backup",C),typeof DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}}}const p=Gr(he("iosPwaHelpShown"));p!==null&&(e.iosPwaHelpShown=p);const d=he(Ft);d&&(e.temperatureUnit=d);const g=he(sr);g&&(e.focusScale=g);const m=he(Gt);if(m){let C=null;if(typeof m=="string"){const A=m.trim();if(A)try{C=JSON.parse(A)}catch(_){console.warn("Failed to parse stored camera color preferences for backup",_),C=null}}C&&typeof C=="object"?e.cameraColors=vr(C):typeof m=="string"&&m.trim()&&(e.cameraColors=m)}const b=he(Re);if(b!=null){const C=sc(b);C&&(C.normalized?e[Re]=vr(C.normalized):C.serialized&&(e[Re]=C.serialized))}return e}function lp(e){return Array.isArray(e)?e.map(t=>({id:t&&typeof t.id=="string"?t.id:null,name:t&&typeof t.name=="string"?t.name:"",data:t&&typeof t.data=="string"?t.data:""})).filter(t=>t.id&&t.name&&t.data):[]}function Th(){const e=he(Lr());if(!e)return[];try{const t=JSON.parse(e);return lp(t)}catch(t){return console.warn("Failed to parse stored custom fonts for backup",t),[]}}let ro=[];function Nh(e){if(!e||typeof e!="object")return null;const t={};return typeof e.source=="string"&&e.source&&(t.source=e.source),typeof e.reason=="string"&&e.reason&&(t.reason=e.reason),typeof e.permissionState=="string"&&e.permissionState&&(t.permissionState=e.permissionState),Object.keys(t).length?t:null}function up(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"";if(!t)return null;const r=typeof e.fileName=="string"&&e.fileName?e.fileName:"cine-power-planner-backup.json",n=typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)?e.createdAtMs:null,o=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:n!==null?new Date(n).toISOString():null;let i=n;if(i===null&&o){const a=Date.parse(o);Number.isFinite(a)&&(i=a)}i===null&&(i=Date.now());const s=Nh(e.metadata);return{id:t,fileName:r,payload:e.payload,createdAt:o||new Date(i).toISOString(),createdAtMs:i,metadata:s||{}}}function xo(e){if(!e)return[];let t=e;if(typeof e=="string"){const o=Ae(e);o&&o.success&&(t=o.parsed)}const r=Array.isArray(t)?t:[],n=[];return r.forEach(o=>{const i=up(o);i&&n.push(i)}),n}function nl(e){if(!e)return 0;let t=0;return e.payload!==null&&e.payload!==void 0&&(t+=3),typeof e.fileName=="string"&&e.fileName&&(t+=1),typeof e.createdAt=="string"&&e.createdAt&&(t+=1),typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)&&(t+=1),e.metadata&&typeof e.metadata=="object"&&(t+=1),t}function fp(e,t){const r=new Map,n=o=>{Array.isArray(o)&&o.forEach(i=>{const s=up(i);if(!s)return;const a=r.get(s.id);(!a||nl(s)>=nl(a))&&r.set(s.id,s)})};return n(e),n(t),Array.from(r.values())}function pp(){const e=he("cineBackupVaultFallbackRecords");return xo(e)}function dp(){return h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup=="object"?h.cineFeatureBackup:h&&typeof h.getQueuedBackupPayloads=="function"?h:null}function yp(){const e=dp();if(!e)return;const t=typeof e.listBackupVaultRecords=="function"?e.listBackupVaultRecords:typeof e.getQueuedBackupPayloads=="function"?e.getQueuedBackupPayloads:null;if(!t)return;let r=null;try{r=t()}catch(n){console.warn("Unable to load backup vault records for export",n);return}if(Array.isArray(r)){ro=xo(r);return}return r&&typeof r.then=="function"?r.then(n=>(ro=xo(n),ro)).catch(n=>(console.warn("Unable to load backup vault records for export",n),[])):Promise.resolve(ro)}async function Mh(){return await yp()}function zh(){yp();const e={devices:Af(),setups:Uo(),session:Ef(),feedback:Yf(),project:zf(),favorites:Uf(),contacts:Vf(),ownGear:Hf(),userProfile:null,autoGearRules:Zf(),autoGearBackups:oc(),autoGearSeeded:ep(),autoGearPresets:tp(),autoGearMonitorDefaults:rp(),autoGearActivePresetId:Ki(),autoGearAutoPresetId:$i(),autoGearShowBackups:ip(),autoGearBackupRetention:ap(),fullBackupHistory:Co()},t=Xf();t&&Array.isArray(t.releases)&&t.releases.length&&(e.documentationTracker=t);const r=Rh();Object.keys(r).length&&(e.preferences=r);const n=Wf();n&&typeof n=="object"&&(typeof n.name=="string"&&n.name||typeof n.role=="string"&&n.role||typeof n.avatar=="string"&&n.avatar||typeof n.phone=="string"&&n.phone||typeof n.email=="string"&&n.email)?e.userProfile=n:delete e.userProfile;const o=he(rt);o&&(e.customLogo=o);const i=Th();i.length&&(e.customFonts=i);const s=he(Ot);s!=null&&(e.schemaCache=s);const a=pp(),c=fp(ro,a);return c.length&&(e.backupVaultRecords=c.map(u=>vr(u))),e}function ye(e,t){const r=T();if(!r)return;const n=jt.has(e),o=`${e}${de}`,i=!!(O&&O.driver&&O.driver.constructor&&O.driver.constructor.name==="IndexedDBAdapter"),s=()=>{e===kr&&(_o=null),e===rt&&(ko=null),e===Gt&&(Po=null),e===Re&&(jo=null),e===tt&&(Io=null),e===Bt&&(vo=null),e===lt&&(Lo=null),e===et&&(Ro=null),e===Ft&&(To=null),e===sr&&(No=null),e===ir()&&(Mo=null)},a=c=>{if(r.setItem(e,c),n)try{r.setItem(o,c)}catch(u){console.warn("Unable to update backup key during import",o,u),Se("write access",u,r),le()}};try{if(t==null){if(s(),O&&O.removeItem(e).catch(c=>console.warn("Failed to remove key from repo",e,c)),r.removeItem(e),n)try{r.removeItem(o)}catch(c){console.warn("Unable to remove backup key during import",o,c),Se("deletion",c,r)}}else{const c=String(t);if(e===kr&&(_o=c),e===rt&&(ko=c),e===Gt&&(Po=c),e===Re&&(jo=c),e===tt&&(Io=c),e===Bt&&(vo=c),e===lt&&(Lo=c),e===et&&(Ro=c),e===Ft&&(To=c),e===sr&&(No=c),e===ir()&&(Mo=c),O&&O.setItem(e,c).catch(u=>{console.warn("Failed to save key to repo",e,u);try{a(c)}catch(f){console.warn("Unable to persist fallback legacy storage key during repo failure",e,f),Se("write access",f,r),n&&le()}}),i)return;a(c)}}catch(c){console.warn("Unable to persist storage key during import",e,c),Se("write access",c,r),n&&le()}}function En(e){if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}if(typeof e=="number")return Number.isNaN(e)?null:e!==0;if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=En(e[t]);if(r!==null)return r}return null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"value"))return En(e.value);if(Object.prototype.hasOwnProperty.call(e,"enabled"))return En(e.enabled)}return null}function er(e,t=[],r=null){if(re(e)){const n=ne(e);return n?er(n,t,r):[]}if(Array.isArray(e))return r?e.filter(n=>r(n)):e.filter(n=>n!=null);if(typeof e=="string"){const n=Ae(e);return n.success?er(n.parsed,t,r):[]}if(E(e)){for(let o=0;o<t.length;o+=1){const i=t[o];if(!Object.prototype.hasOwnProperty.call(e,i))continue;const s=er(e[i],t,r);if(s.length)return s}const n=Object.values(e);if(n.length)return r?n.filter(o=>r(o)):n.filter(o=>o!=null)}return[]}function xh(e){const t=er(e,["contacts","entries","items","list","values","data"],r=>r&&typeof r=="object");return Array.isArray(t)?tc(t):[]}function Bh(e){const t=er(e,["rules","items","entries","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?fe(t):[]}function Gh(e){const t=er(e,["backups","entries","items","list","values","data"],n=>n!==null&&typeof n=="object");if(!Array.isArray(t))return[];const{normalized:r}=Ti(t);return r}function mi(e){if(e==null)return null;if(typeof e=="number")return dn(e);if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return dn(r);const n=Ae(t);return n&&n.success?mi(n.parsed):null}if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=mi(e[t]);if(typeof r=="number")return r}return null}if(E(e)){const t=["value","retention","limit","count"];for(let r=0;r<t.length;r+=1){const n=t[r];if(!Object.prototype.hasOwnProperty.call(e,n))continue;const o=mi(e[n]);if(typeof o=="number")return o}return null}return typeof e=="boolean"&&e?at:null}function Fh(e){const t=er(e,["presets","entries","items","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?fe(t):[]}function Dh(e){if(!e||typeof e!="object")return{};const t={};Object.entries(e).forEach(([n,o])=>{if(typeof o!="string")return;const i=o.trim();i&&(t[n]=i)});const r=fe(t);return E(r)?r:t}function oa(e){if(typeof e=="string")return e;if(typeof e=="number")return Number.isNaN(e)?"":String(e);if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=oa(e[t]);if(r)return r}return""}if(E(e)){if(typeof e.id=="string"&&e.id)return e.id;if(typeof e.value=="string")return e.value;if(Object.prototype.hasOwnProperty.call(e,"name"))return oa(e.name)}return""}function ol(e){const t=er(e,["backupVaultRecords","backupVault","vault","records","entries","items","list","values","data"],r=>r&&typeof r=="object");return xo(t)}function il(e){const t=xo(e);if(!t.length)return;const r=pp(),n=fp(r,t);try{ye("cineBackupVaultFallbackRecords",JSON.stringify(n))}catch(a){console.warn("Unable to persist imported backup vault fallback records",a)}const o=dp();if(!o||typeof o.queueBackupPayloadForVault!="function")return;const i=a=>{o.queueBackupPayloadForVault(a.fileName,a.payload,{id:a.id,createdAt:a.createdAt,createdAtMs:a.createdAtMs,source:a.metadata&&a.metadata.source?a.metadata.source:void 0,reason:a.metadata&&a.metadata.reason?a.metadata.reason:void 0,permissionState:a.metadata&&a.metadata.permissionState?a.metadata.permissionState:void 0})},s=typeof o.listBackupVaultRecords=="function"?o.listBackupVaultRecords:typeof o.getQueuedBackupPayloads=="function"?o.getQueuedBackupPayloads:null;if(!s){t.forEach(i);return}try{const a=s();if(Array.isArray(a)){const c=new Set(a.map(u=>u&&u.id?u.id:null));t.forEach(u=>{c.has(u.id)||i(u)});return}if(a&&typeof a.then=="function"){a.then(c=>{const u=new Set(Array.isArray(c)?c.map(f=>f&&f.id?f.id:null):[]);t.forEach(f=>{u.has(f.id)||i(f)})}).catch(c=>{console.warn("Unable to inspect backup vault before import",c),t.forEach(i)});return}t.forEach(i)}catch(a){console.warn("Unable to import backup vault records via backup module",a),t.forEach(i)}}function Uh(e){return Ct(e)}function We(e,t){if(!E(e))return null;const r=Uh(t);for(let n=0;n<r.length;n+=1){const o=r[n];if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"primary"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${de}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"backup"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${zr}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"migration-backup"}}return null}function On(e){if(!e)return;let t=e.value;if(e.type==="migration-backup")try{const r=typeof t=="string"?JSON.parse(t):t;if(r&&typeof r=="object"){const n=typeof r.compression=="string"?r.compression.trim():"",o=typeof r.encoding=="string"?r.encoding.trim():"",i=n===nf&&o===of,s=Eo.test(n)||Eo.test(o);if((i||s)&&typeof r.data=="string")if(Fa()){let a=typeof r.compressionVariant=="string"&&r.compressionVariant?r.compressionVariant:null;a||(s?a=Wc(o)||Wc(n)||"utf16":a="utf16");const c=af(r.data,ts,a,"migration backup entry");if(c.success&&typeof c.value=="string")try{const u=JSON.parse(c.value);u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"data")?t=u.data:t=null}catch(u){console.warn("Unable to parse migration backup entry during import",e.key,u),t=null}else console.warn("Unable to decompress migration backup entry during import",e&&e.key,c.error),t=null}else console.warn("Compression support is unavailable while reading migration backup entry",e&&e.key),t=null;else Object.prototype.hasOwnProperty.call(r,"data")?t=r.data:t=null}else t=null}catch(r){console.warn("Unable to parse migration backup entry during import",e.key,r),t=null}return t}function ei(e){const t=On(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=Tr(t);if(r===null)return null;if(r===void 0)return;if(typeof r!="string")return r;const n=r.trim();if(!n)return"";try{return JSON.parse(n)}catch{return r}}return t}}function yr(e){const t=On(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=Tr(t);if(r===null)return null;if(r===void 0)return;if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return String(r);if(Array.isArray(r)||r&&typeof r=="object")try{return JSON.stringify(r)}catch(n){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,n),null}return null}if(typeof t=="number"||typeof t=="boolean")return String(t);if(Array.isArray(t)||t&&typeof t=="object")try{return JSON.stringify(t)}catch(r){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,r),null}return null}}function Kh(e){if(!E(e)||["devices","setups","session","feedback","favorites","contacts","preferences","project","projects","autoGearRules","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","autoGearSeeded","autoGearActivePresetId","autoGearAutoPresetId","autoGearBackupRetention","autoGearShowBackups","fullBackupHistory","fullBackups","backupVaultRecords"].some(w=>Object.prototype.hasOwnProperty.call(e,w)))return null;const n={};let o=!1,i=!1;const s=["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",Gt,Re],a=ir(),c=new Set([rt,...s,a].filter(w=>typeof w=="string"&&w)),u=new Set(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"]),f=w=>{if(!w||typeof w.key!="string")return;if(w.key.startsWith("cameraPowerPlanner_")||w.key.startsWith("cinePowerPlanner_")||w.key.endsWith(de)||w.key.endsWith(zr)){i=!0;return}const S=w.key.replace(/(?:__backup|__legacyMigrationBackup)$/u,"");c.has(S)&&(i=!0)},l=(w,S)=>{const v=We(e,w);if(!v)return;f(v);const B=ei(v);B!==void 0&&(n[S]=B,o=!0)};l(Ve,"devices"),l(Ze,"setups"),l(wt,"session"),l(Xt,"feedback"),l(pe,"project"),l(et,"favorites"),l(tt,"contacts"),l(Bt,"ownGear"),l(lt,"userProfile"),l(Jt,"documentationTracker"),l(Rr,"autoGearRules"),l(ut,"autoGearBackups"),l(Nt,"autoGearPresets"),l(Mt,"autoGearMonitorDefaults"),l(zt,"autoGearBackupRetention");const y=We(e,Ot);if(y){f(y);const w=yr(y);w!==void 0&&(n.schemaCache=w,o=!0)}const p=We(e,Lr());if(p){f(p);const w=ei(p);w!==void 0&&(n.customFonts=w,o=!0)}const d=We(e,rt);if(d){f(d);const w=yr(d);w!==void 0&&(n.customLogo=w,o=!0)}const g=We(e,tn);g&&(f(g),n.autoGearSeeded=On(g),o=!0);const m=We(e,St);m&&(f(m),n.autoGearActivePresetId=yr(m),o=!0);const b=We(e,ct);b&&(f(b),n.autoGearAutoPresetId=yr(b),o=!0);const C=We(e,ar);C&&(f(C),n.autoGearShowBackups=On(C),o=!0);const A={};s.forEach(w=>{const S=We(e,w);if(!S)return;if(f(S),w===Re){const N=yr(S);if(N!==void 0){const z=sc(N);if(z){if(z.normalized){A[w]=vr(z.normalized),o=!0;return}if(z.serialized){A[w]=z.serialized,o=!0;return}}}return}const v=On(S);if(u.has(w)){const N=En(v);if(N!==null){A[w]=N,o=!0;return}}const B=yr(S);B!==void 0&&(A[w]=B,o=!0)});const _=We(e,Ft);if(_){f(_);const w=yr(_);if(typeof w=="string"){const S=w.trim();S&&(A.temperatureUnit=S,o=!0)}}const P=We(e,sr);if(P){f(P);const w=yr(P);if(typeof w=="string"){const S=w.trim();S&&(A.focusScale=S,o=!0)}}const k=We(e,Gt);if(k){f(k);const w=ei(k);w!==void 0&&(A.cameraColors=w,o=!0)}const I=We(e,a);if(I){f(I);const w=ei(I);w!==void 0&&(A.mountVoltages=w,o=!0)}return Object.keys(A).length>0&&(n.preferences=A),!o||!i?null:n}function gp(e,t={}){if(Array.isArray(e)){lo(e,()=>Zc());return}if(!E(e))return;const{skipSnapshotConversion:r=!1}=t||{};if(!r){const l=Kh(e);if(l){gp(l,{skipSnapshotConversion:!0});return}}const n=l=>Object.prototype.hasOwnProperty.call(e,l),o=ir(),i=Gt;if(n("devices")&&Cf(e.devices),n("setups")&&Wa(e.setups),n("session")&&qa(e.session,{disableCompression:!0}),n("feedback")&&Jf(e.feedback),n("favorites")&&Kf(e.favorites),n("contacts"))if(e.contacts===null)ta(null);else{const l=xh(e.contacts);ta(l)}if(n("ownGear")){const l=er(e.ownGear,["items","entries","list","values","data"],y=>y&&typeof y=="object");qf(l)}if(n("userProfile")){if(e.userProfile===null)yi(null);else if(E(e.userProfile)){const l=rc(e.userProfile);yi(l||null)}}if(E(e.preferences)){const l=e.preferences;if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"].forEach(d=>{Object.prototype.hasOwnProperty.call(l,d)&&typeof l[d]=="boolean"&&ye(d,l[d])}),["accentColor","fontSize","fontFamily","language"].forEach(d=>{if(Object.prototype.hasOwnProperty.call(l,d)){const g=l[d];typeof g=="string"&&g&&ye(d,g)}}),Object.prototype.hasOwnProperty.call(l,"temperatureUnit")){const d=l.temperatureUnit;if(typeof d=="string"){const g=d.trim();g&&ye(Ft,g)}else d===null&&ye(Ft,null)}if(Object.prototype.hasOwnProperty.call(l,"focusScale")){const d=l.focusScale;if(typeof d=="string"){const g=d.trim();if(g&&(ye(sr,g),typeof window<"u"&&typeof window.applyFocusScalePreference=="function"))try{window.applyFocusScalePreference(g,{persist:!1,forceUpdate:!0})}catch(m){console.warn("Unable to apply imported focus scale preference",m)}}else d===null&&ye(sr,null)}if(Object.prototype.hasOwnProperty.call(l,Re)){const d=l[Re];if(d===null)ye(Re,null);else{const g=sc(d);if(g){if(g.normalized){const m=vr(g.normalized);let b=null;try{b=JSON.stringify(m)}catch(C){console.warn("Unable to serialize imported print preferences",C),b=null}if(b!==null)try{ye(Re,b)}catch(C){console.warn("Unable to persist imported print preferences",C)}if(typeof window<"u"&&typeof window.savePrintPreferences=="function")try{window.savePrintPreferences(m)}catch(C){console.warn("Unable to apply imported print preferences",C)}}else if(g.serialized)try{ye(Re,g.serialized)}catch(m){console.warn("Unable to store imported print preferences string value",m)}}}}if(Object.prototype.hasOwnProperty.call(l,"mountVoltages")){const d=l.mountVoltages;if(d&&typeof d=="object"){try{ye(o,JSON.stringify(d))}catch(g){console.warn("Unable to store imported mount voltages",g)}typeof window<"u"&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(d,{persist:!1,triggerUpdate:!0})}else if(typeof d=="string"){if(ye(o,d),typeof window<"u"&&typeof window.parseStoredMountVoltages=="function")try{const g=window.parseStoredMountVoltages(d);g&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(g,{persist:!1,triggerUpdate:!0})}catch(g){console.warn("Unable to parse imported mount voltages",g)}}else d===null&&(ye(o,null),typeof window<"u"&&typeof window.resetMountVoltagePreferences=="function"&&window.resetMountVoltagePreferences({persist:!1,triggerUpdate:!0}))}if(Object.prototype.hasOwnProperty.call(l,"cameraColors")){const d=l.cameraColors,g=m=>{if(!m||typeof m!="object")return!1;let b=!1;if(typeof window<"u"&&window&&typeof window.setCameraLetterColors=="function")try{window.setCameraLetterColors(m),b=!0}catch(A){console.warn("Unable to apply imported camera color preferences",A),b=!1}let C=null;try{C=JSON.stringify(m)}catch(A){console.warn("Unable to serialize imported camera color preferences",A),C=null}if(C)try{ye(i,C)}catch(A){console.warn("Unable to persist imported camera color preferences",A)}return b};if(d&&typeof d=="object")g(d);else if(typeof d=="string"){const m=d.trim();if(m){let b=null;try{b=JSON.parse(m)}catch(C){console.warn("Unable to parse imported camera color palette",C),b=null}if(b&&typeof b=="object")g(b);else try{ye(i,m)}catch(C){console.warn("Unable to store raw imported camera color palette",C)}}}else d===null&&ye(i,null)}}if(Object.prototype.hasOwnProperty.call(e,"customLogo")){const l=e.customLogo;typeof l=="string"&&l?ye(rt,l):ye(rt,null)}if(Object.prototype.hasOwnProperty.call(e,"customFonts")){const l=lp(e.customFonts);if(l.length)try{ye(Lr(),JSON.stringify(l))}catch(y){console.warn("Unable to store imported custom fonts",y)}else ye(Lr(),null)}if(Object.prototype.hasOwnProperty.call(e,"schemaCache")){const l=e.schemaCache;if(typeof l=="string"||l===null)ye(Ot,l);else if(l&&typeof l=="object")try{ye(Ot,JSON.stringify(l))}catch(y){console.warn("Unable to store imported schema cache",y)}}if(Object.prototype.hasOwnProperty.call(e,"documentationTracker")){const l=uo(e.documentationTracker);gi(l)}else if(Object.prototype.hasOwnProperty.call(e,"documentationLogs")){const l=uo({releases:e.documentationLogs});gi(l)}else if(Object.prototype.hasOwnProperty.call(e,"documentationUpdateLog")){const l=uo(e.documentationUpdateLog);gi(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearRules")){const l=Bh(e.autoGearRules);nc(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackups")){const l=Gh(e.autoGearBackups);Gi(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearSeeded")){const l=En(e.autoGearSeeded);ra(l===null?!1:l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearPresets")){const l=Fh(e.autoGearPresets);is(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearMonitorDefaults")){const l=Dh(e.autoGearMonitorDefaults);ic(l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearActivePresetId")){const l=oa(e.autoGearActivePresetId);np(typeof l=="string"?l:"")}if(Object.prototype.hasOwnProperty.call(e,"autoGearAutoPresetId")&&op(typeof e.autoGearAutoPresetId=="string"?e.autoGearAutoPresetId:""),Object.prototype.hasOwnProperty.call(e,"autoGearShowBackups")){const l=En(e.autoGearShowBackups);na(l===null?!1:l)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackupRetention")){const l=mi(e.autoGearBackupRetention);typeof l=="number"&&Number.isFinite(l)&&cp(l)}if(Object.prototype.hasOwnProperty.call(e,"fullBackupHistory")){const l=Wt(e.fullBackupHistory);xi(l)}else if(Object.prototype.hasOwnProperty.call(e,"fullBackups")){const l=Wt(e.fullBackups);xi(l)}if(Object.prototype.hasOwnProperty.call(e,"backupVaultRecords")){const l=ol(e.backupVaultRecords);il(l)}else if(Object.prototype.hasOwnProperty.call(e,"backupVault")){const l=ol(e.backupVault);il(l)}let s=null;const a=()=>(s||(s=Zc()),s);let c=!1;const u=()=>{const l=a();return(y,p,d)=>{c=!0,l(y,p,d)}},f=(l,y)=>{const d=lo(l,()=>u(),y);return d&&(c=!0),d};e.project&&f(e.project,""),e.projects?f(e.projects):!e.project&&typeof e.gearList=="string"&&(u()("",{gearList:e.gearList}),c=!0),c||Oh(e).forEach((y,p)=>{if(y&&typeof y=="object"&&!Array.isArray(y)){const g=zi(y)?y:Ke(y);if(g&&zi(g)){u()("",g,`Imported project ${p+1}`),c=!0;return}}lo(y,()=>u(),`Imported project ${p+1}`)&&(c=!0)})}function $h(){return Xe}var lr={getSafeLocalStorage:T,loadDeviceData:Af,saveDeviceData:Cf,loadSetups:Uo,saveSetups:Wa,saveSetup:Hm,loadSetup:qm,deleteSetup:Wm,renameSetup:Ym,safeSetLocalStorage:ye,readLocalStorageValue:he,getMountVoltageStorageKeyName:ir,getMountVoltageStorageBackupKeyName:Yu,getProjectStorageRevisionKeyName:_g,loadProjectStorageRevision:Vu,loadProject:zf,loadProjectMetadata:mh,saveProject:ec,deleteProject:Df,renameProject:Eh,createProjectDeletionBackup:bh,loadSessionState:Ef,saveSessionState:qa,loadFavorites:Uf,saveFavorites:Kf,loadContacts:Vf,saveContacts:ta,loadOwnGear:Hf,saveOwnGear:qf,loadUserProfile:Wf,saveUserProfile:yi,loadDocumentationTracker:Xf,saveDocumentationTracker:gi,loadAutoGearBackups:oc,saveAutoGearBackups:Gi,loadFeedback:Yf,saveFeedback:Jf,clearAllData:Lh,exportAllData:zh,prepareBackupForExport:Mh,importAllData:gp,loadAutoGearRules:Zf,saveAutoGearRules:nc,loadAutoGearSeedFlag:ep,saveAutoGearSeedFlag:ra,loadAutoGearPresets:tp,saveAutoGearPresets:is,loadAutoGearMonitorDefaults:rp,saveAutoGearMonitorDefaults:ic,loadAutoGearActivePresetId:Ki,saveAutoGearActivePresetId:np,loadAutoGearAutoPresetId:$i,saveAutoGearAutoPresetId:op,loadAutoGearBackupVisibility:ip,saveAutoGearBackupVisibility:na,loadAutoGearBackupRetention:ap,saveAutoGearBackupRetention:cp,getAutoGearBackupRetentionDefault:zo,loadFullBackupHistory:Co,saveFullBackupHistory:xi,recordFullBackupHistoryEntry:Qf,requestPersistentStorage:yf,clearUiCacheStorageEntries:cr,ensureCriticalStorageBackups:Vg,getLastCriticalStorageGuardResult:Hg,decodeStoredValue:Tr,getCompressionLogSnapshot:yg,setActiveProjectCompressionHold:fh,clearActiveProjectCompressionHold:ph,invalidateProjectReadCache:or,getProjectMemoryCache:$h,storageRepo:O},sl={flag:Ga,read:xu,write:ci,clear:lg};try{Object.defineProperty(lr,"__testAutoBackupCompressionCache",{configurable:!1,enumerable:!1,writable:!1,value:sl})}catch{lr.__testAutoBackupCompressionCache=sl}typeof module<"u"&&module.exports&&(module.exports=lr);console.log("DEBUG: storage.js: starting global export loop");if(h&&typeof h=="object"){Object.keys(lr).forEach(e=>{const t=lr[e];if(typeof t=="function"&&typeof h[e]!="function")try{h[e]=t}catch{try{Object.defineProperty(h,e,{configurable:!0,writable:!0,value:t})}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Unable to expose storage helper ${e} globally.`,n)}}});try{typeof h.recordFullBackupHistoryEntry!="function"&&(h.recordFullBackupHistoryEntry=Qf),typeof h.loadFullBackupHistory!="function"&&(h.loadFullBackupHistory=Co)}catch{}}if(h)try{Object.defineProperty(h,"__cineStorageApi",{configurable:!0,writable:!0,value:lr})}catch{h.__cineStorageApi=lr}console.log("DEBUG: storage.js execution finished");const Vh=lr,As=Object.freeze(Object.defineProperty({__proto__:null,cineStorage:Vh,default:lr},Symbol.toStringTag,{value:"Module"}));var al={};const ss=Bo();function Hh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const o=n&&n.cineModuleLinker;if(o&&typeof o=="object")return o}catch{}}return null}function qh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function Wh(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}const ie=Hh(ss),X=ie&&typeof ie.getModuleEnvironment=="function"?ie.getModuleEnvironment():qh(ss),Z=ie&&typeof ie.getEnvironmentBridge=="function"?ie.getEnvironmentBridge():Wh(ss),H=(ie&&typeof ie.getGlobalScope=="function"?ie.getGlobalScope():null)||(Z&&typeof Z.getGlobalScope=="function"?Z.getGlobalScope():null)||(X&&typeof X.getGlobalScope=="function"?X.getGlobalScope():null)||ss;function Yh(){const e=[H];typeof globalThis<"u"&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&e.indexOf(global)===-1&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&typeof r.cineModuleGlobals=="object")return r.cineModuleGlobals}return null}const ee=(ie&&typeof ie.getModuleGlobals=="function"?ie.getModuleGlobals():null)||Yh();function Jh(e,t){if(ie&&typeof ie.recordModule=="function"&&ie.recordModule(e,t),!(!ee||typeof ee.recordModule!="function"))try{ee.recordModule(e,t)}catch{}}function cl(e){return null}(function(){return ie&&typeof ie.tryRequire=="function"?ie.tryRequire:ee&&typeof ee.tryRequire=="function"?ee.tryRequire:Z&&typeof Z.tryRequire=="function"?function(r){const n=Z.tryRequire(r);return typeof n>"u"?cl():n}:X&&typeof X.tryRequire=="function"?X.tryRequire:cl})();function Qh(e){const t=e||H;if(ie&&typeof ie.getModuleRegistry=="function"){const n=ie.getModuleRegistry(t);if(n)return n}if(ee&&typeof ee.resolveModuleRegistry=="function")try{const n=ee.resolveModuleRegistry(t);if(n)return n}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const n=Z.getModuleRegistry(t);if(n)return n}catch{}if(X&&typeof X.resolveModuleRegistry=="function")try{const n=X.resolveModuleRegistry(t);if(n)return n}catch{}if(Ee&&typeof Ee=="object")return Ee;const r=[t];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModules=="object")return o.cineModules}return null}const An=(function(){if(ie&&typeof ie.getModuleRegistry=="function"){const e=ie.getModuleRegistry(H);if(e)return e}if(ee&&typeof ee.getModuleRegistry=="function")try{const e=ee.getModuleRegistry(H);if(e)return e}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const e=Z.getModuleRegistry(H);if(e)return e}catch{}if(X&&typeof X.getModuleRegistry=="function")try{const e=X.getModuleRegistry(H);if(e)return e}catch{}return Qh(H)})(),an=(function(){if(ie&&typeof ie.getPendingQueueKey=="function"){const t=ie.getPendingQueueKey();if(typeof t=="string"&&t)return t}if(ee&&typeof ee.getPendingQueueKey=="function")try{const t=ee.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}if(Z&&typeof Z.getPendingQueueKey=="function")try{const t=Z.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return X&&typeof X.PENDING_QUEUE_KEY=="string"?X.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function Xh(e){if(!e||typeof e!="object")return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}return t}function Zh(e,t,r){if(ee&&typeof ee.queueModuleRegistration=="function")try{if(ee.queueModuleRegistration(e,t,r,H))return!0}catch{}if(Z&&typeof Z.queueModuleRegistration=="function")try{if(Z.queueModuleRegistration(e,t,r))return!0}catch{}if(X&&typeof X.queueModuleRegistration=="function")return X.queueModuleRegistration(e,t,r,H);if(!H||typeof H!="object")return!1;const n=Object.freeze({name:e,api:t,options:Object.freeze(Xh(r))});let o=H[an];if(!Array.isArray(o))try{Object.defineProperty(H,an,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=H[an]}catch{try{Array.isArray(H[an])||(H[an]=[]),o=H[an]}catch{return!1}}try{o.push(n)}catch{o[o.length]=n}return!0}function Cs(e,t,r,n){if(An&&typeof An.register=="function")try{return An.register(e,t,r),!0}catch(o){if(typeof n=="function")try{n(o)}catch{}}return Zh(e,t,r),!1}const eb=(function(){return ee&&typeof ee.registerOrQueueModule=="function"?function(r,n,o,i){try{if(ee.registerOrQueueModule(r,n,o,i,H,An))return!0}catch{}return Cs(r,n,o,i)}:Z&&typeof Z.registerOrQueueModule=="function"?function(r,n,o,i){try{if(Z.registerOrQueueModule(r,n,o,i,H,An))return!0}catch{}return Cs(r,n,o,i)}:X&&typeof X.registerOrQueueModule=="function"?function(r,n,o,i){return X.registerOrQueueModule(r,n,o,i,H,An)}:Cs})();function tb(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function rb(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(tb(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function nb(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function ia(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||rb(e))return e;if(typeof process<"u"&&process&&al&&al.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const r=nb(t);if(r.has(e))return e;r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||ia(s,r)}try{return Object.freeze(e)}catch{return e}}const ac=(function(){return ee&&typeof ee.freezeDeep=="function"?ee.freezeDeep:Z&&typeof Z.freezeDeep=="function"?function(r,n){try{return Z.freezeDeep(r,n)}catch{return ia(r,n)}}:X&&typeof X.freezeDeep=="function"?X.freezeDeep:ia})();function ll(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const ob=(function(){return ee&&typeof ee.safeWarn=="function"?ee.safeWarn:Z&&typeof Z.safeWarn=="function"?function(r,n){try{Z.safeWarn(r,n)}catch{ll(r,n)}}:X&&typeof X.safeWarn=="function"?X.safeWarn:ll})();function _s(e,t){if(!H||typeof H!="object")return!1;try{return Object.defineProperty(H,e,{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{try{return H[e]=t,!0}catch{return!1}}}const ib=(function(){return ee&&typeof ee.exposeGlobal=="function"?function(r,n,o){try{return ee.exposeGlobal(r,n,o)}catch{return _s(r,n)}}:Z&&typeof Z.exposeGlobal=="function"?function(r,n,o){try{return Z.exposeGlobal(r,n,o)}catch{return _s(r,n)}}:X&&typeof X.exposeGlobal=="function"?function(r,n,o){return X.exposeGlobal(r,n,H,o)}:_s})(),sa=[];function Ko(e,t){!e||typeof e!="object"||sa.push({ref:e,name:t||null})}Ko(H,"global");As&&typeof As=="object"&&Ko(As,"storage");H.cineAppSession&&Ko(H.cineAppSession,"session");H.cineAppSetups&&Ko(H.cineAppSetups,"setups");const aa=Object.create(null),yn=[];function sb(e){if(!e)return null;if(e.name)return e.name;const t=e.ref;return!t||typeof t!="object"?null:t===H?"global":typeof t.constructor=="function"&&t.constructor.name?t.constructor.name:null}function mp(e,t){const r=String(e);let n=aa[r];return n?t&&n.implementationName!==t&&(n.implementationName=t):(n={name:r,implementationName:t||r,available:!1,providerIndex:-1,providerName:null,lastChecked:null,implementation:null},aa[r]=n,yn.push(r)),n}function cc(e,t={}){const r=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,n=mp(e),o=n.implementationName||String(e);if(!r&&n.implementation&&typeof n.implementation=="function")return n;let i=null;for(let s=0;s<sa.length;s+=1){const a=sa[s],c=a&&a.ref;if(!c||typeof c!="object")continue;const u=c[o];if(typeof u=="function"){i={implementation:u,providerIndex:s,providerName:sb(a)};break}}return n.available=!!i,n.providerIndex=i?i.providerIndex:-1,n.providerName=i?i.providerName:null,n.lastChecked=Date.now(),n.implementation=i?i.implementation:null,n}function ab(e){const t=cc(e,{refresh:!0});if(!t||typeof t.implementation!="function"){const r=new Error(`cinePersistence could not resolve function "${e}".`);throw r.code="CINE_PERSISTENCE_BINDING_MISSING",r.binding=e,r.detail={name:e,available:t?t.available:!1,providerName:t?t.providerName:null},r}return t.implementation}function hp(e){return e?Object.freeze({name:e.name,available:!!e.available,providerIndex:typeof e.providerIndex=="number"?e.providerIndex:-1,providerName:e.providerName||null,lastChecked:e.lastChecked||null,implementation:e.implementationName||e.name}):null}function j(e,t){const r=t||e;return mp(r,e),function(){return ab(r).apply(this,arguments)}}function cb(e,t={}){const r=String(e),n=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,o=cc(r,{refresh:n});return hp(o)}function lb(e={}){if(e&&Object.prototype.hasOwnProperty.call(e,"refresh")?e.refresh:!0)for(let n=0;n<yn.length;n+=1)cc(yn[n],{refresh:!0});const r={};for(let n=0;n<yn.length;n+=1){const o=yn[n];r[o]=hp(aa[o])}return ac(r)}function ub(){return yn.slice()}const Mn={bindings:{saveSession:j("saveCurrentSession","saveSession"),autoSaveSetup:j("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:j("saveCurrentGearList","saveGearList"),restoreSessionState:j("restoreSessionState"),collectFullBackupData:j("collectFullBackupData"),createSettingsBackup:j("createSettingsBackup"),captureStorageSnapshot:j("captureStorageSnapshot"),sanitizeBackupPayload:j("sanitizeBackupPayload"),autoBackup:j("autoBackup"),formatFullBackupFilename:j("formatFullBackupFilename"),downloadPayload:j("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:j("recordFullBackupHistoryEntry"),encodeSharedSetup:j("encodeSharedSetup"),decodeSharedSetup:j("decodeSharedSetup"),applySharedSetup:j("applySharedSetup"),applySharedSetupFromUrl:j("applySharedSetupFromUrl"),downloadProject:j("downloadSharedProject","downloadProject"),saveProject:j("saveProject"),proceed:j("handleRestoreRehearsalProceed","proceed"),abort:j("handleRestoreRehearsalAbort","abort")},storage:{loadDeviceData:j("loadDeviceData"),saveDeviceData:j("saveDeviceData"),loadSetups:j("loadSetups"),saveSetups:j("saveSetups"),saveSetup:j("saveSetup"),loadSetup:j("loadSetup"),deleteSetup:j("deleteSetup"),renameSetup:j("renameSetup"),loadSessionState:j("loadSessionState"),saveSessionState:j("saveSessionState"),loadFeedback:j("loadFeedback"),saveFeedback:j("saveFeedback"),saveProject:j("saveProject"),loadProject:j("loadProject"),deleteProject:j("deleteProject"),loadFavorites:j("loadFavorites"),saveFavorites:j("saveFavorites"),exportAllData:j("exportAllData"),importAllData:j("importAllData"),clearAllData:j("clearAllData"),loadAutoGearRules:j("loadAutoGearRules"),saveAutoGearRules:j("saveAutoGearRules"),loadAutoGearBackups:j("loadAutoGearBackups"),saveAutoGearBackups:j("saveAutoGearBackups"),loadAutoGearSeedFlag:j("loadAutoGearSeedFlag"),saveAutoGearSeedFlag:j("saveAutoGearSeedFlag"),loadAutoGearBackupRetention:j("loadAutoGearBackupRetention"),saveAutoGearBackupRetention:j("saveAutoGearBackupRetention"),getAutoGearBackupRetentionDefault:j("getAutoGearBackupRetentionDefault"),loadAutoGearPresets:j("loadAutoGearPresets"),saveAutoGearPresets:j("saveAutoGearPresets"),loadAutoGearActivePresetId:j("loadAutoGearActivePresetId"),saveAutoGearActivePresetId:j("saveAutoGearActivePresetId"),loadAutoGearAutoPresetId:j("loadAutoGearAutoPresetId"),saveAutoGearAutoPresetId:j("saveAutoGearAutoPresetId"),loadAutoGearMonitorDefaults:j("loadAutoGearMonitorDefaults"),saveAutoGearMonitorDefaults:j("saveAutoGearMonitorDefaults"),loadAutoGearBackupVisibility:j("loadAutoGearBackupVisibility"),saveAutoGearBackupVisibility:j("saveAutoGearBackupVisibility"),loadFullBackupHistory:j("loadFullBackupHistory"),saveFullBackupHistory:j("saveFullBackupHistory"),recordFullBackupHistoryEntry:j("recordFullBackupHistoryEntry"),requestPersistentStorage:j("requestPersistentStorage"),clearUiCacheStorageEntries:j("clearUiCacheStorageEntries"),ensureCriticalStorageBackups:j("ensureCriticalStorageBackups"),getLastCriticalStorageGuardResult:j("getLastCriticalStorageGuardResult"),saveSession:j("saveCurrentSession","saveSession"),autoSaveSetup:j("autoSaveCurrentSetup","autoSaveSetup"),proceed:j("handleRestoreRehearsalProceed","proceed"),abort:j("handleRestoreRehearsalAbort","abort")},autosave:{saveSession:j("saveCurrentSession","saveSession"),autoSaveSetup:j("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:j("saveCurrentGearList","saveGearList"),restoreSessionState:j("restoreSessionState")},backups:{collectFullBackupData:j("collectFullBackupData"),createSettingsBackup:j("createSettingsBackup"),captureStorageSnapshot:j("captureStorageSnapshot"),sanitizeBackupPayload:j("sanitizeBackupPayload"),autoBackup:j("autoBackup"),formatFullBackupFilename:j("formatFullBackupFilename"),downloadPayload:j("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:j("recordFullBackupHistoryEntry")},restore:{proceed:j("handleRestoreRehearsalProceed","proceed"),abort:j("handleRestoreRehearsalAbort","abort")},share:{downloadProject:j("downloadSharedProject","downloadProject"),encodeSharedSetup:j("encodeSharedSetup"),decodeSharedSetup:j("decodeSharedSetup"),applySharedSetup:j("applySharedSetup"),applySharedSetupFromUrl:j("applySharedSetupFromUrl")},__internal:ac({listBindings:ub,inspectBinding(e,t){return cb(e,t)||null},inspectAllBindings:lb})};ac(Mn);Ko(Mn.bindings,"bindings");Jh("cinePersistence",Mn);eb("cinePersistence",Mn,{category:"persistence",description:"Data integrity facade for storage, autosave, backups, restore, and share flows.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},e=>{ob("Unable to register cinePersistence module.",e)});if(H&&typeof H=="object"){let e=null;try{e=H.cinePersistence||null}catch{e=null}e!==Mn&&!ib("cinePersistence",Mn,{configurable:!0,enumerable:!1,writable:!1})&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose cinePersistence globally.")}class fb{async getProject(t){if(!t)return null;try{const r=await O.loadProject(t);return r?r.data:null}catch(r){return console.error("[ProjectService] Failed to load project:",t,r),null}}async getProjectNames(){try{return await O.getProjectKeys()}catch(t){return console.error("[ProjectService] Failed to get project names:",t),[]}}async getProjectMetadata(t){if(!t)return{};try{const r=await O.getProjectMeta(t),n=await O.loadProject(t);if(n&&n.data)return n.data}catch(r){console.error("[ProjectService] Failed to get project metadata:",t,r)}return{}}async saveProject(t,r){if(!t||!r)return!1;try{return typeof r!="object"?(console.warn("[ProjectService] Invalid project data"),!1):(r.lastModified||(r.lastModified=new Date().toISOString()),(await O.saveProject(t,r)).success)}catch(n){return console.error("[ProjectService] Failed to save project:",t,n),!1}}async createProject(t){if(!t)return!1;const r={created:new Date().toISOString(),lastModified:new Date().toISOString(),gearList:"",projectInfo:null,gearListAndProjectRequirementsGenerated:!1,color:"blue",icon:"📽️"};return this.saveProject(t,r)}async deleteProject(t){if(!t)return!1;try{return await O.removeProject(t),!0}catch(r){return console.error("[ProjectService] Failed to delete project:",t,r),!1}}async duplicateProject(t){try{const r=t.trim(),n=await this.getProject(r);if(!n)return{success:!1};const o=await this.getProjectNames();let i=`${r} (Copy)`,s=2;for(;o.includes(i);)i=`${r} (Copy ${s})`,s++;const a=JSON.parse(JSON.stringify(n));return a.created=new Date().toISOString(),a.lastModified=new Date().toISOString(),{success:await this.saveProject(i,a),newId:i}}catch(r){return console.error("[ProjectService] Failed to duplicate project:",r),{success:!1}}}}const gb=new fb;export{yl as I,gl as _,pl as a,Bo as b,Il as c,Bs as d,fd as e,ua as f,$r as g,Vh as h,F as i,Gl as j,Xn as k,Bl as l,gr as m,oi as n,wa as o,gb as p,yb as q,Ee as r,O as s,$y as u};
//# sourceMappingURL=core-modules-Be_U3JJE.js.map
