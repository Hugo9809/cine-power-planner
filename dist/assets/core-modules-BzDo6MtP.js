import{g as Tp,L as Bs,s as Mp,d as Np,c as Gp,k as zp}from"./vendor-BnBlqqbr.js";function ba(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Cl=ba(),Wn={value:null,time:0};function Sa(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Kn(){if(Wn.value&&typeof Wn.value=="object")return Wn.value;try{const e=ba();if(e&&(typeof e=="object"||typeof e=="function"))return Wn.value=e,Wn.time=Date.now(),e}catch{}return Cl}function Pl(e,t,r){const n=[],o=s=>{!s||typeof s!="object"&&typeof s!="function"||n.indexOf(s)===-1&&n.push(s)};o(e);const i=typeof r=="function"?r:Kn;try{o(i())}catch{}if(Array.isArray(t))for(let s=0;s<t.length;s+=1)o(t[s]);return typeof globalThis<"u"&&o(globalThis),typeof window<"u"&&o(window),typeof self<"u"&&o(self),typeof global<"u"&&o(global),o(Cl),n.slice()}function Bp(e){if(typeof require!="function")return null;try{return require(e)}catch{return null}}function xp(e,t){const r=t||{},n=typeof r.predicate=="function"?r.predicate:null,o=Array.isArray(r.scopes)?r.scopes.slice():[],i=Pl(r.primaryScope,r.additionalScopes,r.detect);for(let s=0;s<i.length;s+=1)o.indexOf(i[s])===-1&&o.push(i[s]);for(let s=0;s<o.length;s+=1){const a=o[s];if(!(!a||typeof a!="object"&&typeof a!="function")){if(n)try{if(n(a,e))return a}catch{}try{if(e in a)return a}catch{}}}return null}function Fp(e,t){if(!e)return typeof t=="function"?t():t;const r=Kn();if(r&&typeof r=="object"){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];const n=typeof t=="function"?t():t;if(Sa(r,e,n))try{return r[e]}catch{}return n}return typeof t=="function"?t():t}const Dp={baseDetectGlobalScope:ba,detectGlobalScope:Kn,collectCandidateScopes:Pl,tryRequire:Bp,defineHiddenProperty:Sa,resolveFromScopes:xp,getCachedGlobalValue:Fp},ws=Kn();ws&&!ws.cineScopeUtils&&Sa(ws,"cineScopeUtils",Dp);const He=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},wa=(function(){const t=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:null);if(typeof t!="object"||!t)return new Set;const r=Object.values(t).filter(n=>typeof n=="string"&&n);return new Set(r)})();function io(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return"";if(typeof String.fromCodePoint=="function")try{return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):""}function Ci(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=io(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=io(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=io(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=io(i[1],10);if(s)return s}return t}function F(e,t){const n=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons",o=t||n,i=wa.has(o)?o:n,a={char:Ci(e),font:i};return typeof Object.freeze=="function"?Object.freeze(a):a}function rs(e){const r=(He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons"})).UICONS||"uicons";if(!e)return{char:"",font:r,className:"",size:void 0};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:Ci(e),font:r,className:"",size:void 0};if(typeof e=="object"){const n=typeof e.char=="string"?Ci(e.char):"",o=e.font&&wa.has(e.font)?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:"",size:void 0}}function _l(e){return typeof e!="string"?"":e.indexOf('aria-hidden="true"')!==-1?e:e.replace("<svg",'<svg aria-hidden="true"')}function kl(e,t){if(!e)return;const r=rs(t);if(r.markup){e.innerHTML=_l(r.markup),e.setAttribute("aria-hidden","true"),r.className&&r.className.split(/\s+/).filter(Boolean).forEach(o=>e.classList.add(o)),e.removeAttribute("data-icon-font");return}const n=r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font):e.removeAttribute("data-icon-font")}function vl(e,t){const r=rs(e),n=[];r.className&&n.push(r.className),t&&n.push(t);const o=n.join(" ");if(r.markup){let s=_l(r.markup);return o&&(s.indexOf('class="')!==-1?s=s.replace('class="',`class="${o} `):s=s.replace("<svg",`<svg class="${o}"`)),s}const i=r.char?`data-icon-font="${r.font}"`:"";return`<span class="icon-glyph ${o}" aria-hidden="true" ${i}>${r.char}</span>`}function Or(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function jl(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=Or(t),a=Or(r),c=Or(n),l=Or(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(u,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[];return/(?:^|\s)width\s*=/i.test(p)||d.push(`width="${c}"`),/(?:^|\s)height\s*=/i.test(p)||d.push(`height="${l}"`),d.push(`x="-${Or(i)}"`),d.push(`y="-${Or(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}const Ea=`
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M12 17.25 6.545 20.2 7.9 13.975 3 9.45l6.272-.7L12 3l2.728 5.75L21 9.45l-4.9 4.525 1.355 6.225Z"
    fill="currentColor"
    stroke="currentColor"
    stroke-width="0"
  />
</svg>
`.trim(),x=He.ICON_FONT_KEYS||(typeof ICON_FONT_KEYS<"u"?ICON_FONT_KEYS:{UICONS:"uicons",ESSENTIAL:"essential",GADGET:"gadget",FILM:"film",TEXT:"text"}),Il=Object.freeze({batteryBolt:F("",x.UICONS),batteryFull:F("",x.UICONS),bolt:F("",x.ESSENTIAL),plug:F("",x.UICONS),sliders:F("",x.ESSENTIAL),screen:F("",x.GADGET),brightness:F("",x.UICONS),wifi:F("",x.UICONS),gears:F("",x.UICONS),controller:F("",x.GADGET),distance:F("",x.UICONS),sensor:F("",x.UICONS),viewfinder:F("",x.FILM),camera:F("",x.UICONS),trash:F("",x.ESSENTIAL),reload:F("",x.ESSENTIAL),load:F("",x.UICONS),installApp:F("",x.UICONS),add:Object.freeze({char:"+",font:x.TEXT,className:"icon-text"}),minus:Object.freeze({char:"−",font:x.TEXT,className:"icon-text"}),arrowLeft:Object.freeze({char:"←",font:x.TEXT,className:"icon-text"}),check:F("",x.UICONS),fileExport:F("",x.UICONS),fileImport:F("",x.UICONS),save:F("",x.ESSENTIAL),share:F("",x.ESSENTIAL),paperPlane:F("",x.UICONS),magnet:F("",x.ESSENTIAL),codec:F("",x.UICONS),timecode:F("",x.FILM),audioIn:F("",x.ESSENTIAL),audioOut:F("",x.ESSENTIAL),note:F("",x.ESSENTIAL),overview:F("",x.UICONS),gearList:F("",x.UICONS),contacts:F("",x.UICONS),feedback:F("",x.UICONS),resetView:F("",x.UICONS),pin:F("",x.ESSENTIAL),sun:F("",x.UICONS),moon:F("",x.UICONS),circleX:F("",x.ESSENTIAL),settingsGeneral:F("",x.UICONS),settingsAutoGear:F("",x.UICONS),settingsAccessibility:F("",x.UICONS),settingsBackup:F("",x.UICONS),settingsData:F("",x.UICONS),settingsAbout:F("",x.UICONS),star:Object.freeze({markup:Ea,className:"icon-svg favorite-star-icon"}),warning:F("",x.ESSENTIAL)});He.cineIcons={VALID_ICON_FONTS:wa,toCodePointChar:io,normalizeGlyphChar:Ci,iconGlyph:F,resolveIconGlyph:rs,applyIconGlyph:kl,iconMarkup:vl,formatSvgCoordinate:Or,positionSvgMarkup:jl,STAR_ICON_SVG:Ea,ICON_GLYPHS:Il};He.iconGlyph=F;He.resolveIconGlyph=rs;He.applyIconGlyph=kl;He.iconMarkup=vl;He.formatSvgCoordinate=Or;He.positionSvgMarkup=jl;He.STAR_ICON_SVG=Ea;He.ICON_GLYPHS=Il;He.cineIcons;const Up="modulepreload",Kp=function(e){return"/"+e},Ac={},Ll=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let c=function(l){return Promise.all(l.map(f=>Promise.resolve(f).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");o=c(r.map(l=>{if(l=Kp(l),l in Ac)return;Ac[l]=!0;const f=l.endsWith(".css"),u=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":Up,f||(y.as="script"),y.crossOrigin="",y.href=l,a&&y.setAttribute("nonce",a),document.head.appendChild(y),f)return new Promise((p,d)=>{y.addEventListener("load",p),y.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};function Rl(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Tl(e){return!!e&&(typeof e=="object"||typeof e=="function")}function ns(e){if(typeof Object.freeze=="function")try{return Object.freeze(e)}catch{}return e}function ai(e){if(!e)return[];try{return Array.prototype.slice.call(e)}catch{}const t=[];for(let r=0;r<e.length;r+=1)t[r]=e[r];return t}function Oc(){return{objects:typeof WeakMap=="function"?new WeakMap:null,primitives:Object.create(null),empty:null}}function $p(e,t){if(!e)return null;if(Tl(t)){if(!e.objects)return null;let o=e.objects.get(t);return o||(o={cached:!1,value:null},e.objects.set(t,o)),o}const r=typeof t+":"+String(t);let n=e.primitives[r];return n||(n={cached:!1,value:null},e.primitives[r]=n),n}function Xt(e,t){Tl(t)&&e.indexOf(t)===-1&&e.push(t)}const xs=(function(){const t=[];return Xt(t,typeof globalThis<"u"?globalThis:null),Xt(t,typeof window<"u"?window:null),Xt(t,typeof self<"u"?self:null),Xt(t,typeof global<"u"?global:null),ns(t)})(),Fs=ns([]),Ml=typeof WeakMap=="function",Es=Ml?new WeakMap:null;function Vp(e){if(!Array.isArray(e)||e.length===0)return Fs;const t=[];for(let r=0;r<e.length;r+=1)Xt(t,e[r]);return t.length===0?Fs:ns(t)}function Cc(e,t,r){const n=[];Xt(n,e);let o=null;if(typeof t=="function")try{o=t()}catch{o=null}Xt(n,o);for(let i=0;i<xs.length;i+=1)Xt(n,xs[i]);if(Array.isArray(r))for(let i=0;i<r.length;i+=1)Xt(n,r[i]);return ns(n)}function Hp(e,t){if(!e)return null;if(t===Fs)return e.empty||(e.empty=Oc()),e.empty;if(!e.extras){if(!Ml)return null;e.extras=new WeakMap}let r=e.extras.get(t);return r||(r=Oc(),e.extras.set(t,r)),r}function qp(e){if(!Es)return null;let t=Es.get(e);return t||(t={empty:null,extras:null},Es.set(e,t)),t}function Wp(e,t,r,n){if(n){const i=$p(n,e);if(i){if(i.cached)return ai(i.value);const s=Cc(e,t,r);return i.value=s,i.cached=!0,ai(s)}}const o=Cc(e,t,r);return ai(o)}function Aa(e){const t=e&&typeof e.detectGlobalScope=="function"?e.detectGlobalScope:Rl,r=Vp(e&&e.additionalScopes),n=qp(t),o=Hp(n,r);return function(s){return Wp(s,t,r,o)}}function Yp(e,t){return Aa(t||{})(e)}function Jp(){return ai(xs)}const As=Rl();As&&!As.__cineScopeCollector&&(As.__cineScopeCollector={collectCandidateScopes:Yp,createCollector:Aa,getBaseScopes:Jp});const os="__cinePendingModuleRegistrations__";function sr(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Qp(e){const t=e||sr();if(!t||typeof t!="object"&&typeof t!="function")return;let r=null;try{r=t.console||null}catch{r=null}if(!r||typeof r!="object"&&typeof r!="function")return;const n=["log","warn","error","info","debug"];let o=null;try{o=r.__cineSafeConsoleOriginals||null}catch{o=null}if(!o||typeof o!="object"){o={};try{Object.defineProperty(r,"__cineSafeConsoleOriginals",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{try{r.__cineSafeConsoleOriginals=o}catch{}}}for(let i=0;i<n.length;i+=1){const s=n[i];let a=null;try{a=r[s]}catch{a=null}if(typeof a!="function"||a&&a.__cineSafeConsoleGuard)continue;Object.prototype.hasOwnProperty.call(o,s)||(o[s]=a);const c=function(){try{return a.apply(r,arguments)}catch{}};try{Object.defineProperty(c,"__cineSafeConsoleGuard",{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{c.__cineSafeConsoleGuard=!0}try{r[s]=c}catch{}}}const Pc=Aa,Xp={key:"defaultExtras"},Os=[],Ur=typeof WeakMap=="function"?new WeakMap:[];function Zp(e){if(!e||typeof e!="object"&&typeof e!="function")return;if(Ur&&typeof Ur.get=="function"){let r=Ur.get(e);return r||(r=[e],Ur.set(e,r)),r}for(let r=0;r<Ur.length;r+=1){const n=Ur[r];if(n.scope===e)return n.extras}const t=[e];return Ur.push({scope:e,extras:t}),t}function ed(e,t){if(!Pc)return null;const r=Array.isArray(t)?t:Xp;for(let o=0;o<Os.length;o+=1){const i=Os[o];if(i.detect===e&&i.extras===r)return i.collector}const n=Pc({detectGlobalScope:e,additionalScopes:Array.isArray(t)?t:void 0});return n?(Os.push({detect:e,extras:r,collector:n}),n):null}function is(e,t){const r=t||sr(),n=Zp(r),o=ed(sr,n);if(o)return o(e||r);const i=[];function s(a){!a||typeof a!="object"&&typeof a!="function"||i.indexOf(a)===-1&&i.push(a)}return s(e||r),typeof globalThis<"u"&&s(globalThis),typeof window<"u"&&s(window),typeof self<"u"&&s(self),typeof global<"u"&&s(global),i}function Nl(e){return null}function Gl(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function Oa(e,t,r){const n=e||r,o=typeof t=="string"&&t?t:os;if(!n||typeof n!="object")return null;let i=n[o];return Array.isArray(i)?i:!Gl(n,o,[])||(i=n[o],!Array.isArray(i))?null:i}const Cs=(function(){const t="__cineBuiltinImmutabilityGuards__",r=is(null,sr());for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function Ds(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(je&&typeof je=="object")try{if(e===je.ethereum)return!0}catch{return!0}try{if(e.isMetaMask===!0)return!0}catch(t){if(t&&typeof t.message=="string"&&/metamask/i.test(t.message))return!0}try{if(typeof e.request=="function"&&typeof e.on=="function"){if(typeof e.removeListener=="function"||typeof e.removeEventListener=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Ethereum|MetaMask|Provider/i.test(t))return!0}}catch{return!0}return!1}function td(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Us(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(td(e)||typeof e=="object"&&e&&typeof e.id=="string"&&typeof e.filename=="string"&&(typeof e.loaded=="boolean"||Array.isArray(e.children))||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(Cs&&typeof Cs.isImmutableBuiltin=="function"&&Cs.isImmutableBuiltin(e)||typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function rd(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function Ca(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||Us(e)||Ds(e))return e;if(typeof e=="function")try{return Object.freeze(e)}catch{return e}const r=rd(t);if(r.has(e))return e;r.add(e);let n;try{n=Object.getOwnPropertyNames(e)}catch{return e}for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=Object.getOwnPropertyDescriptor(e,i)}catch{s=null}if(s&&(typeof s.get=="function"||typeof s.set=="function"))continue;let a;try{a=e[i]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||Us(a)||Ds(a)||Ca(a,r)}try{return Object.freeze(e)}catch{return e}}function zl(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}function nd(e,t){const n=is(e||t,t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}function od(e,t,r,n,o){const s=Oa(e||o,os,o);if(!s)return!1;const a=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{return s.push(a),!0}catch{}try{return s[s.length]=a,!0}catch{}return!1}function id(e){const t=e||sr();return{detectGlobalScope:sr,getGlobalScope(){return t},collectCandidateScopes(r){return is(r||t,t)},tryRequire:Nl,defineHiddenProperty:Gl,ensureQueue(r,n){return Oa(r||t,n,t)},freezeDeep:Ca,safeWarn:zl,resolveModuleRegistry(r){return nd(r||t,t)},queueModuleRegistration(r,n,o,i){return od(r||t,n,o,i,t)},getPendingQueueKey(){return os}}}function sd(e){const t=e||sr();return t&&typeof t.cineModuleArchitectureKernel=="object"?t.cineModuleArchitectureKernel:null}const Pa=sr();Qp(Pa);const ad=sd(Pa),Q=ad||id(Pa);function _c(){if(Q&&typeof Q.detectGlobalScope=="function")try{const e=Q.detectGlobalScope();if(e)return e}catch{}return sr()}const je=Q&&typeof Q.getGlobalScope=="function"?(function(){try{const t=Q.getGlobalScope();if(t)return t}catch{}return _c()})():_c(),Ks=Q&&typeof Q.getPendingQueueKey=="function"?Q.getPendingQueueKey():os;function Bl(e){if(Q&&typeof Q.collectCandidateScopes=="function")try{const t=Q.collectCandidateScopes(e||je);if(Array.isArray(t)&&t.length>0)return t}catch{}return is(e||je,je)}function xl(e){if(Q&&typeof Q.tryRequire=="function")try{const t=Q.tryRequire(e);if(typeof t<"u")return t}catch{}return Nl()}function Fl(e){const t=e||je;if(Q&&typeof Q.resolveModuleRegistry=="function")try{const o=Q.resolveModuleRegistry(t);if(o&&typeof o=="object")return o}catch{}const r=xl("./registry.js");if(r&&typeof r=="object")return r;const n=Bl(t);for(let o=0;o<n.length;o+=1){const i=n[o];if(i&&typeof i.cineModules=="object")return i.cineModules}return null}let kc=null,vc=!1;function $s(e){if(!vc||e&&e!==je){const t=Fl(e);if(e&&e!==je)return t;kc=t,vc=!0}return kc}function cd(e){const t=e||je;if(Q&&typeof Q.ensureQueue=="function")try{const r=Q.ensureQueue(t,Ks);if(Array.isArray(r))return r}catch{}return Oa(t,Ks,je)}function Dl(e,t,r,n){const o=e||je;if(Q&&typeof Q.queueModuleRegistration=="function")try{if(Q.queueModuleRegistration(o,t,r,n))return!0}catch{}const i=cd(o);if(!i)return!1;const s=Object.freeze({name:t,api:r,options:Object.freeze({...n||{}})});try{i.push(s)}catch{i[i.length]=s}return!0}function Ul(e,t,r,n,o,i){if(t&&typeof t.register=="function")try{return t.register(r,n,o),!0}catch(s){typeof i=="function"&&i(s)}return Dl(e,r,n,o),!1}function jc(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||Us(e)||Ds(e))return e;if(Q&&typeof Q.freezeDeep=="function")try{return Q.freezeDeep(e)}catch{}return Ca(e)}function Kl(e,t){if(Q&&typeof Q.safeWarn=="function")try{Q.safeWarn(e,t);return}catch{}zl(e,t)}function $l(e,t,r,n={}){const o=r||je;if(!o||typeof o!="object")return!1;const i={configurable:n.configurable!==!1,enumerable:!!n.enumerable,value:t,writable:n.writable===!0};try{return Object.defineProperty(o,e,i),!0}catch{try{return o[e]=t,!0}catch{return!1}}}const Vl=jc({getGlobalScope(){return je},collectCandidateScopes:Bl,tryRequire:xl,resolveModuleRegistry:Fl,getModuleRegistry:$s,queueModuleRegistration(e,t,r,n){return Dl(n||je,e,t,r)},registerOrQueueModule(e,t,r,n,o,i){const s=o||je,a=i||$s(s);return Ul(s,a,e,t,r,n)},freezeDeep:jc,safeWarn:Kl,exposeGlobal:$l,PENDING_QUEUE_KEY:Ks}),ld=$s();Ul(je,ld,"cineModuleBase",Vl,{category:"infrastructure",description:"Shared helpers for module registration, freezing and safe global exposure.",replace:!0,connections:["cineModuleArchitectureKernel","cineModuleArchitectureHelpers"]},e=>{Kl("Unable to register cineModuleBase.",e)});$l("cineModuleBase",Vl,je,{configurable:!0,enumerable:!1,writable:!1});var ud={};const Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};let Pi=null;!Pi&&Ce&&typeof Ce.__cineEnsureConsoleMethodsWritable=="function"&&(Pi=Ce.__cineEnsureConsoleMethodsWritable);typeof Pi=="function"&&Pi(["warn","info"]);const Oo="__cinePendingModuleRegistrations__",_a="__cinePendingModuleRegistrationsTimer__";let qr=Object.create(null),_i=Object.create(null),ci=null;function Hl(e){const r=[e||Ce];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModuleImmutability=="object")return o.cineModuleImmutability}return null}const Ps=(function(){const t="__cineBuiltinImmutabilityGuards__",r=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&r.push(globalThis),typeof window<"u"&&r.push(window),typeof self<"u"&&r.push(self),typeof global<"u"&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(!(!o||typeof o!="object"&&typeof o!="function"))try{const i=o[t];if(i&&typeof i=="object")return i}catch{}}return null})();function fd(){function e(r){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function")return!1;try{if(Ps&&typeof Ps.isImmutableBuiltin=="function"&&Ps.isImmutableBuiltin(r)||typeof r.pipe=="function"&&typeof r.unpipe=="function")return!0;if(typeof r.on=="function"&&typeof r.emit=="function"){if(typeof r.write=="function"||typeof r.read=="function")return!0;const n=r.constructor&&r.constructor.name;if(n&&/Stream|Emitter|Port/i.test(n))return!0}if(typeof Symbol<"u"&&r[Symbol.toStringTag]){const n=r[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port/i.test(n))return!0}}catch{}return!1}function t(r,n=new WeakSet){if(!r||typeof r=="function"||typeof r!="object"&&typeof r!="function"||e(r)||n.has(r))return r;n.add(r);const o=Object.getOwnPropertyNames(r);for(let i=0;i<o.length;i+=1){const s=o[i];let a;try{a=r[s]}catch{a=void 0}!a||typeof a=="function"||typeof a!="object"&&typeof a!="function"||t(a,n)}try{return Object.freeze(r)}catch{return r}}return{shouldBypassDeepFreeze:e,freezeDeep:t}}const ka=fd();let Yn=Hl(Ce)||ka;function pd(){if(Yn!==ka)return Yn;const e=Hl(Ce);return e&&e!==Yn&&(Yn=e),Yn}function Rt(e,t){const r=pd();try{return r.freezeDeep(e,t)}catch{}return ka.freezeDeep(e,t)}function xr(e){if(typeof e=="string"){const t=e.trim();if(t)return t}throw new TypeError("cineModules.register expected a non-empty string name.")}function li(e){if(e==null)return[];const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=new Set,n=[];for(let o=0;o<t.length;o+=1){const i=t[o];let s=null;if(typeof i=="string"?s=i:i&&typeof i.name=="string"&&(s=i.name),!s)continue;const a=s.trim();!a||r.has(a)||(r.add(a),n.push(a))}return n}function dd(e,t,r={}){const n=xr(e);if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError(`cineModules.register("${n}") expected an object or function.`);const o=r.freeze!==!1,i=o&&!Object.isFrozen(t)?Rt(t):t;if(Object.prototype.hasOwnProperty.call(qr,n)){const s=qr[n];if(s===i)return s;if(!r.replace)throw new Error(`cineModules: Module "${n}" is already registered. Use { replace: true } to overwrite.`)}return qr[n]=i,_i[n]={description:typeof r.description=="string"?r.description.trim():"",category:typeof r.category=="string"?r.category.trim():"",registeredAt:Date.now(),frozen:o,connections:Rt(li(r.connections||r.links||r.dependencies||null))},i}function yd(e){const t=xr(e);return Object.prototype.hasOwnProperty.call(qr,t)?qr[t]:null}function ql(e){const t=xr(e);return Object.prototype.hasOwnProperty.call(qr,t)}function gd(){return Object.freeze(Object.keys(qr).sort())}function md(e){const t=xr(e),r=_i[t];return r?Object.freeze({name:t,description:r.description,category:r.category,registeredAt:r.registeredAt,frozen:r.frozen,connections:r.connections||Rt([])}):null}function hd(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];try{const s=xr(i);n.has(s)||(n.add(s),r.push(s))}catch{}}return r.length>0?r:null}function bd(e){if(e==null)return null;const t=Array.isArray(e)?e:typeof e=="string"?[e]:typeof e[Symbol.iterator]=="function"?Array.from(e):[e],r=[],n=new Set;for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i!="string")continue;const s=i.trim();!s||n.has(s)||(n.add(s),r.push(s))}return r.length>0?r:null}function Sd(e={}){const t=hd(e&&e.names),r=bd(e&&(e.categories||e.category||null)),n=t?new Set(t):null,o=r?new Set(r):null,i=[],s=n?t:Object.keys(_i);for(let a=0;a<s.length;a+=1){const c=s[a],l=_i[c];l&&(o&&!o.has(l.category)||i.push({name:c,description:l.description,category:l.category,registeredAt:l.registeredAt,frozen:l.frozen,connections:l.connections||Rt([])}))}return n||(!e||e.sort!==!1)&&i.sort((c,l)=>c.name.localeCompare(l.name)),Rt(i)}function wd(e){const t=Array.isArray(e)?e.slice():[e],r={},n=[];for(let o=0;o<t.length;o+=1){const i=xr(t[o]),s=ql(i);r[i]=s,s||n.push(i)}return Object.freeze({ok:n.length===0,missing:Object.freeze(n),detail:Object.freeze(r)})}function Ed(e={}){throw typeof process<"u"&&process,new Error("cineModules.__internalResetForTests() is restricted to test environments.")}function Wl(e){if(!e||typeof e!="object")return null;const t=e[_a];return t&&typeof t=="object"?t:null}function va(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")return!1;try{return Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}),!0}catch{}try{return e[t]=r,!0}catch{}return!1}function ki(e){const t=Wl(e);if(!t)return;const r=t&&typeof t.clear=="function"?t.clear:null;if(r&&Object.prototype.hasOwnProperty.call(t,"id"))try{r(t.id)}catch{}va(e,_a,null)}function Yl(e){if(!e||typeof e!="object")return;const t=e[Oo];if(!Array.isArray(t)||t.length===0){ki(e);return}if(Wl(e))return;const r=typeof e.setTimeout=="function"&&e.setTimeout.bind(e)||typeof Ce.setTimeout=="function"&&Ce.setTimeout.bind(Ce)||(typeof setTimeout=="function"?setTimeout:null);if(typeof r!="function")return;const n=typeof e.clearTimeout=="function"&&e.clearTimeout.bind(e)||typeof Ce.clearTimeout=="function"&&Ce.clearTimeout.bind(Ce)||(typeof clearTimeout=="function"?clearTimeout:null),o=r(function(){ki(e),Jl(e)},0);va(e,_a,{id:o,clear:typeof n=="function"?n:null})}function Jl(e){if(!e||typeof e!="object")return;const t=e[Oo];if(!Array.isArray(t)||t.length===0){ki(e);return}const r=t.slice();t.length=0;for(let n=0;n<r.length;n+=1){const o=r[n];if(!o||typeof o!="object")continue;const i=o.name,s=o.api,a=o.options||{};try{Se.register(i,s,a)}catch(c){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`cineModules: discard pending registration for "${i}" due to error:`,c);continue}}t.length>0?Yl(e):ki(e)}function Ad(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),r(Ce),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function _s(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e[Oo];return Array.isArray(t)?t:null}catch{return null}}function Od(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=_s(e);if(t||va(e,Oo,[])&&(t=_s(e),t))return t;try{if(e[Oo]=[],t=_s(e),t)return t}catch{}return null}function Cd(e){const t=Ad(e);for(let r=0;r<t.length;r+=1){const n=t[r],o=Od(n);if(o)return{queue:o,scope:n}}return null}function Pd(e,t){const r=Cd(e||Ce);if(!r||!r.queue)return!1;const n=Rt({name:t&&t.name?xr(t.name):null,api:t?t.api:null,options:Object.freeze({...t&&t.options?t.options:{}})}),{queue:o,scope:i}=r;try{o.push(n)}catch{o[o.length]=n}try{Yl(i)}catch{}return!0}function _d(e={}){const t=xr(e.name),r=typeof e.category=="string"?e.category.trim():"";if(!r)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty category string.`);const n=typeof e.description=="string"?e.description.trim():"";if(!n)throw new TypeError(`cineModules.createBlueprint("${t}") expected a non-empty description.`);const o=e.freeze!==!1,i=Rt(li(e.connections)),s=typeof e.factory=="function"?e.factory:null,a=s?null:e.api;if(!s&&(!a||typeof a!="object"&&typeof a!="function"))throw new TypeError(`cineModules.createBlueprint("${t}") expected an object API or factory function.`);const c=Object.freeze({name:t,category:r,description:n,connections:i,freeze:o});let l=null,f=!1,u=null;function y(g){const b={category:c.category,description:c.description,connections:c.connections,freeze:c.freeze};if(!g||typeof g!="object")return Object.freeze({...b});const P={...b};if(Object.prototype.hasOwnProperty.call(g,"category")){const A=typeof g.category=="string"?g.category.trim():"";A&&(P.category=A)}if(Object.prototype.hasOwnProperty.call(g,"description")){const A=typeof g.description=="string"?g.description.trim():"";A&&(P.description=A)}return Object.prototype.hasOwnProperty.call(g,"connections")&&(P.connections=Rt(li(g.connections))),Object.prototype.hasOwnProperty.call(g,"freeze")&&(P.freeze=g.freeze!==!1),Object.freeze(P)}function p(g){if(f){if(u)throw u;return l}f=!0;let b=a;if(s){const P=g&&typeof g=="object"?{...g}:{},A=Object.freeze({registry:ci||null,metadata:c,context:P,freezeDeep:Rt,normalizeConnections:li});try{b=s(A)}catch(O){throw u=O instanceof Error?O:new Error(String(O)),u}}if(!b||typeof b!="object"&&typeof b!="function"){const P=new TypeError(`cineModules.createBlueprint("${t}") factory expected an object or function return value.`);throw u=P,P}return l=o&&!Object.isFrozen(b)?Rt(b):b,l}function d(g={}){const b=g&&typeof g.registry=="object"&&g.registry?g.registry:ci,P=y(g&&g.options),A=g&&g.scope?g.scope:Ce,O=g&&Object.prototype.hasOwnProperty.call(g,"defer")?g.defer!==!1:!0,_=g&&typeof g.onError=="function"?g.onError:null,k=p(g&&g.context),j=b&&typeof b.register=="function"?b:ci;if(!j||typeof j.register!="function")throw new TypeError("cineModules.createBlueprint register() requires a registry with a register() function.");try{return j.register(c.name,k,P)}catch(w){if(O&&Pd(A,{name:c.name,api:k,options:P}),_)try{_(w)}catch{}throw w}}const m={name:c.name,category:c.category,description:c.description,connections:c.connections,freeze:c.freeze,instantiate:p,register:d,getMetadata(){return c},createRegistrationOptions:y,toJSON(){return c}};return Object.freeze(m)}const Se={};Se.register=dd;Se.get=yd;Se.has=ql;Se.list=gd;Se.describe=md;Se.describeAll=Sd;Se.assertRegistered=wd;Se.createBlueprint=_d;Se.__internalResetForTests=Ed;ci=Se;const ar=[Ce];typeof globalThis<"u"&&globalThis!==Ce&&ar.push(globalThis);typeof window<"u"&&ar.indexOf(window)===-1&&ar.push(window);typeof self<"u"&&ar.indexOf(self)===-1&&ar.push(self);typeof global<"u"&&ar.indexOf(global)===-1&&ar.push(global);for(let e=0;e<ar.length;e+=1){const t=ar[e];if(!t||typeof t!="object")continue;if(t.cineModules!==Se)try{Object.defineProperty(t,"cineModules",{configurable:!0,enumerable:!1,value:Se,writable:!0})}catch{try{t.cineModules=Se}catch{}}Jl(t)}const Ko=typeof globalThis<"u"&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||typeof global<"u"&&global||{},kd=new Set(["3G-SDI","6G-SDI","12G-SDI","Mini BNC","HDMI","Mini HDMI","Micro HDMI","DisplayPort"]),vi="__normalized";function Ql(e){const t=new Map;return r=>{if(!r)return"";const n=String(r).replace(/[™®]/g,"").trim(),o=n.toLowerCase();return t.has(o)||t.set(o,e(n,o)),t.get(o)}}const vd=[{needles:["12g"],value:"12G-SDI"},{needles:["6g"],value:"6G-SDI"},{needles:["3g"],value:"3G-SDI"},{needles:["hd","sdi"],value:"3G-SDI"},{needles:["mini","bnc"],value:"Mini BNC"},{needles:["micro","hdmi"],value:"Micro HDMI"},{needles:["mini","hdmi"],value:"Mini HDMI"},{needles:["hdmi"],value:"HDMI"},{needles:["displayport"],value:"DisplayPort"},{needles:["display","port"],value:"DisplayPort"},{needles:["dp"],value:"DisplayPort"}],Xl=Ql((e,t)=>{const r=vd.find(({needles:n})=>n.every(o=>t.includes(o)));return r?r.value:""}),jd={"lemo 4-pin (lbus)":"LBUS (LEMO 4-pin)","lbus (lemo 4-pin)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo)":"LBUS (LEMO 4-pin)","lbus (4-pin lemo for motors)":"LBUS (LEMO 4-pin)","4-pin lemo (lbus)":"LBUS (LEMO 4-pin)","lemo 4-pin":"LEMO 4-pin","4-pin lemo":"LEMO 4-pin","lemo 7-pin":"LEMO 7-pin","lemo 7-pin 1b":"LEMO 7-pin","7-pin lemo":"LEMO 7-pin","7-pin lemo (lcs)":"LEMO 7-pin (LCS)","7-pin lemo (cam)":"LEMO 7-pin (CAM)","ext (lemo 7-pin)":"EXT LEMO 7-pin","hirose 12pin":"Hirose 12-pin","12-pin hirose":"Hirose 12-pin","12pin broadcast connector":"Hirose 12-pin","lens 12 pin":"Hirose 12-pin","lens terminal 12-pin":"Hirose 12-pin","lens terminal 12-pin jack":"Hirose 12-pin","lens terminal":"Hirose 12-pin","usb type-c":"USB-C","usb-c":"USB-C","usb-c (usb 3.2 / 3.1 gen 1)":"USB-C","usb-c / gigabit ethernet (via adapter)":"USB-C","active ef mount":"Active EF mount","lanc (2.5mm stereo mini jack)":"LANC","2.5 mm sub-mini (lanc)":"LANC","remote a (2.5mm)":"REMOTE A connector","remote control terminal":"REMOTE A connector","remote 8 pin":"REMOTE B connector"};function ja(e){return Ql((t,r)=>e[r]||t)}const so=ja(jd),Id={'dsmc3 red touch 7" lcd (optional)':'RED Touch 7" LCD (Optional)','red touch 7.0" lcd (optional)':'RED Touch 7" LCD (Optional)',"lcd touch panel":"LCD touchscreen","lcd touchscreen":"LCD touchscreen","native lcd capacitive touchscreen":"LCD touchscreen","integrated touchscreen lcd":"LCD touchscreen","free-angle lcd":"Vari-angle LCD","lcd monitor (native)":"Integrated LCD monitor","native lcd viewfinder":"Integrated LCD monitor","lcd monitor lm-v2 (supplied)":"LCD Monitor LM-V2","integrated main monitor":"Integrated LCD monitor","optional evf-v70 viewfinder":"EVF-V70 (Optional)","optional evf-v50":"EVF-V50 (Optional)","optional oled viewfinder":"OLED EVF (Optional)","blackmagic pocket cinema camera pro evf (optional)":"Blackmagic Pro EVF (Optional)","external backlit lcd status display":"LCD status display","built-in fold-out lcd":"Fold-out LCD","oled lvf (live view finder)":"OLED EVF","lcd capacitive touchscreen":"LCD touchscreen","lemo 26 pin":"LEMO 26-pin port"},Zl=ja(Id),Ld={"lemo 8-pin (dc in / bat)":"Bat LEMO 8-pin","lemo 8-pin (bat)":"Bat LEMO 8-pin","bat (lemo 8-pin)":"Bat LEMO 8-pin","lemo 8-pin":"Bat LEMO 8-pin","2-pin dc-input":"2-pin DC-IN","dc-":"DC IN",dc:"DC IN","2-pin xlr":"XLR 2-pin","2-pin locking connector":"LEMO 2-pin","2-pin locking connector / 2-pin lemo":"LEMO 2-pin","4-pin xlr / dc in 12v":"XLR 4-pin","4-pin xlr / v-lock":"XLR 4-pin","xlr 4-pin jack":"XLR 4-pin","xlr 4-pin (main input)":"XLR 4-pin","xlr-type 4 pin (male) / square-shaped 5 pin connector (battery)":"XLR 4-pin / Square 5-pin","12-pin molex connector (at battery plate rear) / 4-pin xlr (external power)":"Molex 12-pin / XLR 4-pin","battery slot":"Battery Slot","usb-c":"USB-C","usb type-c":"USB-C","usb-c pd":"USB-C PD","usb-c (power delivery)":"USB-C PD","usb-c pd,dc coupler":"USB-C PD / DC Coupler","dc coupler":"DC Coupler","dc coupler (dr-e6c)":"DC Coupler","dc input":"DC IN","dc barrel":"DC Barrel","dc (barrel)":"DC Barrel","locking dc barrel":"DC Barrel","dc 24v terminal":"DC Barrel","weipu sf610/s2 (12vdc) input":"Weipu SF610/S2","6-pin 1b dc-in / tb50 battery mount":"6-pin 1B DC-IN","6-pin 1b dc-,tb50":"6-pin 1B DC-IN"},Ic=ja(Ld);function ui(e){if(!e)return[];const t=r=>{const n=Ic(r);return n?n.split(/[/,]/).map(o=>Ic(o.trim())).map(o=>o&&o.trim()||"").filter(Boolean):[]};return Array.isArray(e)?e.flatMap(t):t(e)}function Ar(e,t){return Array.isArray(e)?e.map(r=>typeof r=="string"?{...t,type:r}:{...t,...r||{}}):[]}function Ia(e){if(!e)return;e.powerInput&&!e.power?.input&&(e.power={...e.power||{},input:{type:ui(e.powerInput)}},delete e.powerInput);const t=e.power?.input;if(!t)return;const r=n=>{if(typeof n=="string")return{type:ui(n)};if(n){const{portType:o,type:i,...s}=n,a=!i&&o?o:i;return{...s,type:a?ui(a):[]}}return{type:[]}};e.power.input=Array.isArray(t)?t.map(r):r(t)}function Lc(e){!e||typeof e!="object"||Object.values(e).forEach(Ia)}function eu(e){return!!(e&&Object.prototype.hasOwnProperty.call(e,vi)&&e[vi])}function La(e){if(!e||typeof e!="object")return e;try{Object.defineProperty(e,vi,{configurable:!0,enumerable:!1,value:!0,writable:!0})}catch{e[vi]=!0}return e}function Ra(e,t){if(!e||typeof e!="object"||!!!(t&&t.force)&&eu(e))return e;Object.values(e.cameras||{}).forEach(o=>{o.power?.input&&o.power.input.powerDrawWatts!==void 0&&delete o.power.input.powerDrawWatts,Ia(o),Array.isArray(o.power?.batteryPlateSupport)&&(o.power.batteryPlateSupport=o.power.batteryPlateSupport.map(i=>{if(typeof i=="string"){const s=i.match(/([^()]+)(?:\(([^)]+)\))?(?:\s*-\s*(.*))?/),a=s?s[1].trim():i;let c=s&&s[2]?s[2].trim().toLowerCase():"";c?/via adapter/i.test(c)&&(c="adapted"):c=/adapted|via adapter/i.test(i)?"adapted":"native";const l=s&&s[3]?s[3].trim():/via adapter/i.test(i)?"via adapter":"";return{type:a,mount:c,notes:l}}return{type:i.type||"",mount:(i.mount?i.mount:i.native?"native":i.adapted?"adapted":"native").toLowerCase(),notes:i.notes||""}})),o.power&&(o.power.powerDistributionOutputs=Ar(o.power.powerDistributionOutputs,{type:"",voltage:"",current:"",wattage:null,notes:""})),o.videoOutputs=Ar(o.videoOutputs,{type:"",notes:""}).flatMap(i=>{const{count:s,...a}=i||{},c=Xl(a.type);if(!kd.has(c))return[];const l=parseInt(s,10),f=Number.isFinite(l)&&l>0?l:1,u={...a,type:c,notes:a.notes||""};return Array.from({length:f},()=>({...u}))}),o.fizConnectors=Ar(o.fizConnectors,{type:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:so(s)}}),o.viewfinder=Ar(o.viewfinder,{type:"",resolution:"",connector:"",notes:""}).map(i=>{const{type:s,...a}=i||{};return{...a,type:Zl(s)}}),o.recordingMedia=Ar(o.recordingMedia,{type:"",notes:""}).map(i=>{let{type:s="",notes:a=""}=i||{};const c=s.match(/^(.*?)(?:\((.*)\))?$/);return c&&(s=c[1].trim(),a=a||(c[2]?c[2].trim():"")),/^SD UHS-II$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II`:"UHS-II"):/^SD \(UHS-II\/UHS-I\)$/i.test(s)?(s="SD Card",a="UHS-II/UHS-I"):s==="CFast 2.0 card slots"?(s="CFast 2.0",a=a||"Dual Slots"):s==="CFexpress Type B (Dual Slots)"?(s="CFexpress Type B",a=a||"Dual Slots"):s==="CFexpress Type B (via adapter)"?(s="CFexpress Type B",a=a||"via adapter"):/^SD UHS-II \(Dual Slots\)$/i.test(s)?(s="SD Card",a=a?`${a}; UHS-II (Dual Slots)`:"UHS-II (Dual Slots)"):s==="SD Card (Dual Slots)"?(s="SD Card",a=a||"Dual Slots"):s==="SD card slot (for proxy/backup)"&&(s="SD Card",a=a||"for proxy/backup"),{type:s,notes:a}}),o.timecode=Ar(o.timecode,{type:"",notes:""}),o.lensMount=Ar(o.lensMount,{type:"",mount:"native",notes:""}).map(i=>({type:i.type,mount:i.mount?i.mount.toLowerCase():"native",notes:i.notes||""})).filter((i,s,a)=>s===a.findIndex(c=>c.type===i.type&&c.mount===i.mount&&c.notes===i.notes))}),Object.values(e.lenses||{}).forEach(o=>{if(!o||typeof o!="object")return;const i=y=>{if(!y)return null;if(typeof y=="string"){const m=y.trim();return m?{type:m,mount:"native"}:null}const p=typeof y.type=="string"?y.type.trim():"";if(!p)return null;const d=typeof y.mount=="string"?y.mount.trim().toLowerCase():"";return{type:p,mount:d==="adapted"?"adapted":"native"}},s=o.mountOptions,a=[],c=y=>{const p=i(y);p&&a.push(p)};if(Array.isArray(s)?s.forEach(c):s&&typeof s=="object"&&c(s),!a.length&&Array.isArray(o.lensMount)&&(o.lensMount.forEach(c),delete o.lensMount),!a.length){const y=typeof o.mount=="string"?o.mount.trim():"";y&&c({type:y,mount:"native"})}const l=[];a.forEach(y=>{if(!y||!y.type)return;const p=y.mount==="adapted"?"adapted":"native";l.some(m=>m.type===y.type&&m.mount===p)||l.push({type:y.type,mount:p})});const f=Array.isArray(l)?l:[];o.mountOptions=f;const u=Array.isArray(o.mountOptions)?o.mountOptions:[];if(u.length){const y=u.find(d=>d&&d.mount==="native"&&d.type)||u[0],p=y&&y.type?y.type:"";p?o.mount=p:typeof o.mount=="string"&&(o.mount=o.mount.trim())}else typeof o.mount=="string"&&(o.mount=o.mount.trim(),o.mount||delete o.mount)}),["monitors","video","viewfinders"].forEach(o=>{Lc(e[o])});const n=e.fiz||{};return["motors","controllers","distance"].forEach(o=>{Lc(n[o])}),Object.values(e.fiz?.motors||{}).forEach(o=>{o&&(o.connector&&!o.fizConnector&&(o.fizConnector=o.connector,delete o.connector),o.fizConnector&&(o.fizConnector=so(o.fizConnector)))}),Object.values(e.fiz?.controllers||{}).forEach(o=>{if(o)if(o.FIZ_connector&&!o.fizConnector&&!o.fizConnectors&&(o.fizConnector=o.FIZ_connector,delete o.FIZ_connector),Array.isArray(o.fizConnectors))o.fizConnectors=o.fizConnectors.map(i=>{if(!i)return{type:""};const s=so(i.type||i),a=i.notes||void 0;return a?{type:s,notes:a}:{type:s}});else if(o.fizConnector){const i=String(o.fizConnector).split(",").map(s=>s.trim()).filter(Boolean);o.fizConnectors=i.map(s=>({type:so(s)})),delete o.fizConnector}else o.fizConnectors=[]}),La(e),e}function tu(e){return Ra(e,{force:!0})}Ko.cineDeviceNormalization={unifyDevices:Ra,normalizeDevicesForPersistence:tu,markDevicesNormalized:La,hasNormalizedDevicesMarker:eu,fixPowerInput:Ia,normalizeVideoType:Xl,normalizeFizConnectorType:so,normalizeViewfinderType:Zl,normalizePowerPortType:ui,ensureList:Ar};Ko.unifyDevices=Ra;Ko.normalizeDevicesForPersistence=tu;Ko.markDevicesNormalized=La;Ko.cineDeviceNormalization;var Rc={};function ru(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}function Fr(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}function Rd(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function Tc(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return e}const nu=(function(){const t=ru();if(t&&typeof t.__cineDeepClone=="function")return t.__cineDeepClone;const r=Rd(t);return r?function(o){if(o===null||typeof o!="object")return o;try{return r(o)}catch{}return Tc(o)}:Tc})();function Td(e){const t=Fr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function Md(e){const t=Fr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}function Nd(e){const t=Fr(e);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleGlobals=="object")return n.cineModuleGlobals}return null}function Mc(e){return null}const ss=ru(),Y=Td(ss),J=Md(ss),q=Nd(ss),W=(J&&typeof J.getGlobalScope=="function"?J.getGlobalScope():null)||(Y&&typeof Y.getGlobalScope=="function"?Y.getGlobalScope():null)||ss;(function(){return q&&typeof q.tryRequire=="function"?q.tryRequire:J&&typeof J.tryRequire=="function"?function(r){const n=J.tryRequire(r);return typeof n>"u"?Mc():n}:Y&&typeof Y.tryRequire=="function"?Y.tryRequire:Mc})();const Nc=(function(){const t=[];function r(o,i){if(typeof o!="function")return;t.some(a=>a&&a.fn===o)||t.push({fn:o,scope:i||null})}if(q&&(typeof q.structuredClone=="function"&&r(q.structuredClone,q),typeof q.getStructuredClone=="function"))try{const o=q.getStructuredClone();r(o,q)}catch{}if(J&&(typeof J.structuredClone=="function"&&r(J.structuredClone,J),typeof J.getStructuredClone=="function"))try{const o=J.getStructuredClone();r(o,J)}catch{}if(Y&&(typeof Y.structuredClone=="function"&&r(Y.structuredClone,Y),typeof Y.getStructuredClone=="function"))try{const o=Y.getStructuredClone();r(o,Y)}catch{}const n=Fr(W);for(let o=0;o<n.length;o+=1){const i=n[o];if(!i||typeof i!="object"&&typeof i!="function")continue;const s=i.structuredClone;typeof s=="function"&&r(s,i)}return t})();let Yo=null;function Gd(e){if(Yo)try{const t=Yo;return{success:!0,value:t.scope?t.fn.call(t.scope,e):t.fn(e)}}catch{Yo=null}for(let t=0;t<Nc.length;t+=1){const r=Nc[t];if(!(!r||typeof r.fn!="function"))try{const n=r.scope?r.fn.call(r.scope,e):r.fn(e);return Yo=r,{success:!0,value:n}}catch{}}return{success:!1,value:null}}function zd(e){if(q&&typeof q.resolveModuleRegistry=="function")try{const r=q.resolveModuleRegistry(e||W);if(r)return r}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const r=J.getModuleRegistry(e||W);if(r)return r}catch{}if(Y&&typeof Y.resolveModuleRegistry=="function")try{return Y.resolveModuleRegistry(e||W)}catch{}if(Se&&typeof Se=="object")return Se;const t=Fr(W);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModules=="object")return n.cineModules}return null}const fi=(function(){if(q&&typeof q.getModuleRegistry=="function")try{const t=q.getModuleRegistry(W);if(t)return t}catch{}if(J&&typeof J.getModuleRegistry=="function")try{const t=J.getModuleRegistry(W);if(t)return t}catch{}if(Y&&typeof Y.getModuleRegistry=="function")try{const t=Y.getModuleRegistry(W);if(t)return t}catch{}return zd()})(),Bd=(function(){return q&&typeof q.queueModuleRegistration=="function"?function(r,n,o,i){try{return q.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:J&&typeof J.queueModuleRegistration=="function"?function(r,n,o){try{const i=J.queueModuleRegistration(r,n,o);return typeof i>"u"?!1:i}catch{return!1}}:Y&&typeof Y.queueModuleRegistration=="function"?function(r,n,o,i){try{return Y.queueModuleRegistration(r,n,o,i||W)}catch{return!1}}:function(){return!1}})(),xd=(function(){return q&&typeof q.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=q.registerOrQueueModule(r,n,o,i,s||W,a||fi);return typeof c>"u"?!1:c}catch{return!1}}:J&&typeof J.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{const c=J.registerOrQueueModule(r,n,o,i,s||W,a||fi);return typeof c>"u"?!1:c}catch{return!1}}:Y&&typeof Y.registerOrQueueModule=="function"?function(r,n,o,i,s,a){try{return Y.registerOrQueueModule(r,n,o,i,s||W,a||fi)}catch{return!1}}:function(r,n,o,i){if(typeof i=="function")try{if(typeof window<"u"&&window.cineModuleRegistry&&typeof window.cineModuleRegistry.register=="function")return window.cineModuleRegistry.register(r,n,o),!0;console.warn("Logging module registration deferred - queue unavailable.")}catch{}return!1}})();function Fd(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Dd(e){if(!e||typeof e!="object"||Fd(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;const t=e.constructor;if(!t)return!1;if(t===Number||t===String||t===Boolean||t===Date||t===RegExp||t===Promise||t===WeakMap||t===WeakSet||t===Map||t===Set)return!0;const r=typeof t.name=="string"?t.name:"";if(r&&/Error|Event|Response|Request|Headers|Node|Element|Window|Document/.test(r))return!0;try{if(typeof e.then=="function"||typeof e.catch=="function"||typeof e.pipe=="function"||typeof e.on=="function"||typeof e.write=="function"||typeof e.read=="function"||typeof e.getReader=="function"||typeof e.getWriter=="function"||typeof e[Symbol.iterator]=="function"&&!Array.isArray(e))return!0;if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const n=e[Symbol.toStringTag];if(typeof n=="string"&&/Stream|Port|Process/.test(n))return!0}}catch{}return!1}function Vs(e,t){const r=t||(typeof WeakSet=="function"?new WeakSet:{add(){},has(){return!1}});if(!e||typeof e!="object"||Dd(e))return e;if(typeof process<"u"&&process&&Rc&&Rc.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}if(typeof r.has=="function"&&r.has(e))return e;typeof r.add=="function"&&r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||Vs(s,r)}try{try{return Object.freeze(e)}catch(o){return e}}catch{return e}}const Ie=(function(){return q&&typeof q.freezeDeep=="function"?q.freezeDeep:J&&typeof J.freezeDeep=="function"?function(r,n){try{return J.freezeDeep(r,n)}catch{return Vs(r,n)}}:Y&&typeof Y.freezeDeep=="function"?Y.freezeDeep:Vs})();function Gc(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Xe=(function(){return q&&typeof q.safeWarn=="function"?q.safeWarn:J&&typeof J.safeWarn=="function"?function(r,n){try{J.safeWarn(r,n)}catch{Gc(r,n)}}:Y&&typeof Y.safeWarn=="function"?Y.safeWarn:Gc})(),Ln=["debug","info","warn","error","log"],It=typeof Symbol=="function"?Symbol.for("cineLoggingConsoleProxyInstalled"):"__cineLoggingConsoleProxyInstalled__",de=(function(){const t=Object.create(null);if(typeof console>"u"||!console)return t;for(let r=0;r<Ln.length;r+=1){const n=Ln[r];try{const o=console[n];t[n]=typeof o=="function"?o:null}catch{t[n]=null}}return t})();let Et=!1,Ta=!1,Vr=!1,Jn=null,Jo=!1,Qn=0;const Ud=(function(){return q&&typeof q.exposeGlobal=="function"?function(r,n,o){try{return q.exposeGlobal(r,n,o)}catch{return!1}}:function(r,n){if(!W||typeof W!="object"&&typeof W!="function")return!1;try{return W[r]=n,!0}catch{return!1}}})();function Kd(e,t){if(!(!q||typeof q.recordModule!="function"))try{q.recordModule(e,t)}catch{}}const $t={debug:{priority:10,consoleMethod:"debug"},info:{priority:20,consoleMethod:"info"},warn:{priority:30,consoleMethod:"warn"},error:{priority:40,consoleMethod:"error"}},$d=Ie($t),Rn=Object.freeze(Object.keys($t).concat(["other"]));function $n(){const e=Object.create(null);for(let t=0;t<Rn.length;t+=1){const r=Rn[t];e[r]=0}return e}function Vd(e){if(!(!e||typeof e!="object"))for(let t=0;t<Rn.length;t+=1){const r=Rn[t];e[r]=0}}function Hd(e){if(typeof e=="string"&&e){if(Object.prototype.hasOwnProperty.call($t,e))return e;const t=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call($t,t))return t}return"other"}function Hs(e,t){if(!e||typeof e!="object")return 0;const r=e[t];return typeof r=="number"&&Number.isFinite(r)&&r>0?r:0}function Ma(e,t,r){if(!e||typeof e!="object"||typeof r!="number"||!Number.isFinite(r)||r===0)return;const n=Hd(t),i=Hs(e,n)+r;e[n]=i>0?i:0}function ou(e,t,r){if(!(!Array.isArray(t)||!t.length)&&!(typeof r!="number"||!Number.isFinite(r)||r===0))for(let n=0;n<t.length;n+=1){const o=t[n],i=o&&o.level;Ma(e,i,r)}}function qd(e){const t=$n();return ou(t,e,1),t}function iu(e,t){if(!(!e||typeof e!="object"||!t||typeof t!="object"))for(let r=0;r<Rn.length;r+=1){const n=Rn[r],o=Hs(t,n);if(o){const i=Hs(e,n);e[n]=i+o}}}function su(e){const t=$n();return iu(t,e),t}function An(e){return Ie(su(e))}const ji=50,au=1,cu=5e3,Ii="__cineLoggingHistory",qs="__cineLoggingConfig",Wd=typeof Symbol=="function"?Symbol.for("cineLoggingHandled"):"__cineLoggingHandled__",mt={level:"warn",historyLevel:"info",historyLimit:1200,consoleOutput:!0,persistSession:!0,captureGlobalErrors:!0,captureConsole:!1,stackTraces:!0},Yd=Ie(mt),Jd="cine-sw-logs",Qd="cine-sw:log-entry",Xd="cine-sw:log-state-request",Zd="cine-sw:log-state",zc=5e3,ey=60*1e3,ty=200;function lu(){return{level:mt.level,historyLevel:mt.historyLevel,historyLimit:mt.historyLimit,consoleOutput:mt.consoleOutput,persistSession:mt.persistSession,captureGlobalErrors:mt.captureGlobalErrors,captureConsole:mt.captureConsole,stackTraces:mt.stackTraces}}let L=lu();const Nt=[],Li=new Set,Ri=new Set,Qo=typeof WeakSet=="function"?new WeakSet:[];let uu=0;const fu=$n(),as=$n(),pu=$n();let du=0,ae=null;const U={initialised:!1,supported:!1,requestInFlight:!1,lastRequestId:null,pollTimer:null,requestTimer:null,broadcastChannel:null,broadcastFailed:!1,seenIds:typeof Set=="function"?new Set:null,fallbackSeenIds:typeof Set!="function"?[]:null,lastSnapshotMeta:null};function Rr(e,t){const r=typeof t=="string"?t:L.level;if(typeof e=="string"){const n=e.trim().toLowerCase();if(Object.prototype.hasOwnProperty.call($t,n))return n;if(n==="log"||n==="information")return"info";if(n==="warning")return"warn";if(n==="trace"||n==="verbose")return"debug";if(n==="fatal"||n==="critical")return"error"}return Object.prototype.hasOwnProperty.call($t,r)?r:"info"}function Tn(e){const t=Rr(e,"info"),r=$t[t];return r?r.priority:$t.info.priority}function Xn(e,t){if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:e>0:!!t;if(typeof e=="string"){const r=e.trim().toLowerCase();if(r==="true"||r==="1"||r==="yes"||r==="on")return!0;if(r==="false"||r==="0"||r==="no"||r==="off")return!1}return typeof t=="boolean"?t:!1}function yu(e,t){const n=!!(t&&t.allowReducedMin===!0)?au:ji;if(typeof e=="number"&&Number.isFinite(e)){const o=Math.abs(Math.floor(e));return o?Math.max(n,Math.min(cu,o)):L.historyLimit}if(typeof e=="string"&&e){const o=Number(e);if(Number.isFinite(o))return yu(o,t)}return L.historyLimit}function Co(e){if(typeof e=="string")return e;if(e instanceof Error)return e.message||e.name||"Error";if(e&&typeof e=="object"){if(typeof e.message=="string")return e.message;const t=e.constructor&&e.constructor.name;if(t)return t}if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e>"u"||e===null)return"";try{return String(e)}catch{}return Object.prototype.toString.call(e)}function le(e,t,r){const n=typeof t=="number"?t:0,o=r||(typeof WeakSet=="function"?new WeakSet:null);if(e===null||typeof e>"u")return null;const i=typeof e;if(i==="string"||i==="number"||i==="boolean")return e;if(i==="bigint")try{return e.toString()}catch{return"BigInt"}if(i==="symbol")try{return e.toString()}catch{return"Symbol"}if(i==="function")return`[Function${e.name?` ${e.name}`:""}]`;if(e instanceof Date)try{return e.toISOString()}catch{return e.toString()}if(typeof RegExp<"u"&&e instanceof RegExp){try{return e.toString()}catch{}return"[RegExp]"}if(e instanceof Error){const a={name:e.name,message:e.message};if(e.stack&&(a.stack=String(e.stack)),typeof e.code<"u"&&(a.code=e.code),typeof e.status<"u"&&(a.status=e.status),typeof e.cause<"u"&&e.cause!==null&&(a.cause=le(e.cause,n+1,o)),typeof e.details<"u"&&(a.details=le(e.details,n+1,o)),typeof e.errors<"u"&&e.errors!==null){const c=[];let f=0;const u=function(d){if(c.length>=10){f+=1;return}try{c.push(le(d,n+1,o))}catch(m){c.push(m&&m.message?`[Unserializable error: ${m.message}]`:"[Unserializable error]")}},y=e.errors;if(Array.isArray(y)){for(let p=0;p<y.length;p+=1)u(y[p]);y.length>c.length&&(f+=y.length-c.length)}else if(y&&typeof y=="object"){let p=null;try{const d=typeof Symbol=="function"?Symbol.iterator:null;d&&typeof y[d]=="function"&&(p=y[d].call(y))}catch{p=null}if(p&&typeof p.next=="function"){let d=p.next(),m=0;for(;!d.done;){m<10?u(d.value):f+=1,m+=1;try{d=p.next()}catch{f+=1;break}}}else u(y)}else u(y);c.length&&(a.errors=c,f>0&&(a.errorsTruncated=f))}return a}if(i==="object"){if(o)try{if(o.has(e))return"[Circular]";o.add(e)}catch{}if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return{__type:"ArrayBuffer",byteLength:e.byteLength};if(typeof DataView<"u"&&e instanceof DataView)return{__type:"DataView",byteOffset:e.byteOffset,byteLength:e.byteLength};if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(e)){const d=e.constructor&&e.constructor.name,m=32,g=typeof e.length=="number"?e.length:0,b=[],P=Math.min(g,m);for(let O=0;O<P;O+=1)b.push(e[O]);const A={__type:d||"TypedArray",length:g,byteOffset:typeof e.byteOffset=="number"?e.byteOffset:0,byteLength:typeof e.byteLength=="number"?e.byteLength:0};return b.length&&(A.preview=b),g>m&&(A.__truncatedItems=g-m),A}const a=typeof Map=="function"?Map:null;if(a&&e instanceof a){const d=[];let g=0;e.forEach((P,A)=>{g<30&&d.push({key:le(A,n+1,o),value:le(P,n+1,o)}),g+=1});const b={__type:"Map",size:typeof e.size=="number"?e.size:g,entries:d};return g>30&&(b.__truncatedEntries=g-30),b}const c=typeof Set=="function"?Set:null;if(c&&e instanceof c){const d=[];let g=0;e.forEach(P=>{g<30&&d.push(le(P,n+1,o)),g+=1});const b={__type:"Set",size:typeof e.size=="number"?e.size:g,values:d};return g>30&&(b.__truncatedValues=g-30),b}const l=typeof URLSearchParams=="function"?URLSearchParams:null;if(l&&e instanceof l){const d=[],m=typeof e.entries=="function"?e.entries():null;let g=0;if(m&&typeof m.next=="function"){let A=0,O=m.next();for(;!O.done;){if(A<40){const _=O.value||[];d.push({key:le(_[0],n+1,o),value:le(_[1],n+1,o)})}A+=1,O=m.next()}A>d.length&&(g=A-d.length)}const b={__type:"URLSearchParams",entries:d};return g>0&&(b.__truncatedEntries=g),b}if(typeof URL=="function"&&e instanceof URL)try{return e.toString()}catch{}if(n>=4){const d=e.constructor&&e.constructor.name;return d?`[${d}]`:Object.prototype.toString.call(e)}if(Array.isArray(e)){const m=[],g=Math.min(e.length,20);for(let b=0;b<g;b+=1)m.push(le(e[b],n+1,o));return e.length>20&&m.push(`… (${e.length-20} more)`),m}const f={},u=Object.keys(e),y=30,p=Math.min(u.length,y);for(let d=0;d<p;d+=1){const m=u[d];try{f[m]=le(e[m],n+1,o)}catch(g){f[m]=`[Threw: ${g&&g.message?g.message:"error"}]`}}if(u.length>y&&(f.__truncatedKeys=u.length-y),typeof Object.getOwnPropertySymbols=="function"){const d=Object.getOwnPropertySymbols(e),m=Math.min(d.length,5);for(let g=0;g<m;g+=1){const b=d[g],P=typeof b=="symbol"?b.toString():String(b);try{f[P]=le(e[b],n+1,o)}catch(A){f[P]=`[Threw: ${A&&A.message?A.message:"error"}]`}}}if(!u.length){const d=e.constructor&&e.constructor.name;d&&(f.__className=d)}return f}const s=Gd(e);if(s.success)return s.value;try{return nu(e)}catch{}try{return String(e)}catch{}return null}function Ti(e){if(typeof e!="string")return null;const t=e.replace(/\r\n?/g,`
`).trim();if(!t)return null;const r=5e3,n=t.length>r,o=n?t.slice(0,r):t,i=t.split(`
`),s=40,a=[];let c=!1;for(let l=0;l<i.length;l+=1){const f=i[l].trim();if(f)if(a.length<s)a.push(f.length>500?`${f.slice(0,500)}…`:f);else{c=!0;break}}return{stack:o,frames:a,truncated:n||c}}function ry(e){if(!e||typeof e!="object")return null;const t=typeof e.source=="string"&&e.source?e.source:"unknown";let r=null;typeof e.stack=="string"&&e.stack&&(r=Ti(e.stack));const n=[];if(Array.isArray(e.frames))for(let s=0;s<e.frames.length&&n.length<40;s+=1){const a=e.frames[s];typeof a=="string"&&a?n.push(a):a!==null&&typeof a<"u"&&n.push(Co(a))}else if(r&&Array.isArray(r.frames))for(let s=0;s<r.frames.length;s+=1)n.push(r.frames[s]);const o=e.truncated===!0||(r?r.truncated===!0:!1)||n.length>0&&n.length>=40,i={source:t,truncated:o};return r&&r.stack?i.stack=r.stack:typeof e.stack=="string"&&e.stack?i.stack=e.stack:i.stack=null,n.length&&(i.frames=n),!i.stack&&(!i.frames||!i.frames.length)?null:Ie(i)}function $o(){const e=Fr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{const n=r.sessionStorage;if(n&&typeof n.getItem=="function"&&typeof n.setItem=="function")return n}catch{}}return null}function gu(){const e=$o();if(e)try{e.removeItem(Ii)}catch{}}function ny(){const e=$o();if(e){if(!L.persistSession){try{e.removeItem(qs)}catch{}return}try{e.setItem(qs,JSON.stringify({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces}))}catch(t){console.warn("cineLogging: Unable to persist logging config",t)}}}function Na(){if(!L.persistSession){gu();return}const e=$o();if(e)try{e.setItem(Ii,JSON.stringify(Nt))}catch(t){if(t&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")){L.persistSession=!1;try{e.removeItem(Ii)}catch{}return}console.warn("cineLogging: Unable to persist log history",t)}}function Ga(){const e=L.persistSession===!1?au:ji;return Math.max(e,Math.min(cu,Math.floor(L.historyLimit)))}function oy(e,t,r){if(!Array.isArray(e)||e.length===0)return null;du+=e.length;const n=qd(e),o=r&&typeof r.source=="string"&&r.source.trim()?r.source.trim():"enforce",i=e[0]||null,s=e[e.length-1]||null,a=Date.now();let c="";try{c=new Date(a).toISOString()}catch{c=String(a)}if(ae=Ie({count:e.length,limit:t,source:o,timestamp:a,isoTimestamp:c,oldestEntryId:i&&typeof i.id=="string"?i.id:null,oldestEntryTimestamp:i&&typeof i.timestamp=="number"?i.timestamp:null,oldestEntryIsoTimestamp:i&&typeof i.isoTimestamp=="string"?i.isoTimestamp:null,newestEntryId:s&&typeof s.id=="string"?s.id:null,newestEntryTimestamp:s&&typeof s.timestamp=="number"?s.timestamp:null,newestEntryIsoTimestamp:s&&typeof s.isoTimestamp=="string"?s.isoTimestamp:null,levels:An(n)}),de&&typeof de.warn=="function")try{de.warn("cineLogging: history trimmed to enforce retention limit",{limit:t,removed:e.length,source:o,levels:su(n)})}catch{}return n}function za(e){const t=Ga();if(Nt.length<=t)return 0;const r=Nt.length-t,n=Nt.splice(0,r);ou(as,n,-1);const o=oy(n,t,e);return o&&iu(pu,o),r}function mu(e){return Tn(e)>=Tn(L.historyLevel)}function hu(e){return L.consoleOutput?Tn(e)>=Tn(L.level):!1}function Ba(e){const t=Rr(e,"info"),r=hu(t),n=mu(t);return Ie({level:t,enabled:r||n,console:r,history:n,thresholds:Ie({console:Rr(L.level,mt.level),history:Rr(L.historyLevel,mt.historyLevel)})})}function bu(e,t){const r=Ba(e);if(!t||typeof t!="object")return r.enabled;const n=t.console!==!1,o=t.history!==!1;return!n&&!o?!1:t.requireAll===!0?!(n&&!r.console||o&&!r.history):!!(n&&r.console||o&&r.history)}function Su(e){return`log-${e}-${Math.random().toString(36).slice(2,10)}`}function wu(e){if(e){try{Nt.push(e)}catch{return}Ma(as,e.level,1)}}function Eu(e){wu(e),uu+=1,za({source:"append"}),Na(),iy(e)}function iy(e){if(!Li.size)return;const t=Array.from(Li);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Xe("cineLogging listener execution failed",o)}}}function sy(e){const t=typeof e=="number"&&Number.isFinite(e)?Math.max(0,Math.floor(e)):Nt.length;if(!t)return Object.freeze([]);const r=Math.max(0,Nt.length-t),n=Nt.slice(r);return Object.freeze(n.slice())}function ay(e){if(!Ri.size)return;const t=Array.from(Ri);for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n=="function")try{n(e)}catch(o){Xe("cineLogging config listener failed",o)}}}function xa(e){if(!e||typeof e.length!="number")return[];const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}function Ir(e,t){if(!Array.isArray(e))return!1;try{return typeof Object.isExtensible=="function"&&!Object.isExtensible(e)?!1:(e.push(t),!0)}catch{}return!1}function cy(e){return e==="error"?"error":e==="warn"?"warn":e==="info"?"info":"debug"}function Au(e){if(typeof e!="string"||!e)return null;if(Object.prototype.hasOwnProperty.call(de,e)){const t=de[e];if(typeof t=="function")return t}if(typeof console<"u"&&console){let t=null;try{t=console[e]}catch{t=null}if(typeof t=="function"&&(!t||!t[It]))return t}if((e==="debug"||e==="log")&&typeof de.log=="function")return de.log;if(e==="info"){if(typeof de.info=="function")return de.info;if(typeof de.log=="function")return de.log}if(e==="warn"){if(typeof de.warn=="function")return de.warn;if(typeof de.error=="function")return de.error}return e==="error"&&typeof de.error=="function"?de.error:null}function Ou(e,t){const r=Au(e);if(typeof r!="function")return;const n=typeof console<"u"&&console?console:W&&W.console?W.console:null,o=Array.isArray(t)?t:xa(t);try{return r.apply(n,o)}catch{try{return Function.prototype.apply.call(r,n,o)}catch{}}}function ly(e,t,r){const n=cy(e),o=Array.isArray(t)?t:xa(t),i=[];for(let d=0;d<o.length;d+=1){const m=o[d],g=typeof m;if(g==="string")Ir(i,m);else if(g==="number"||g==="boolean")Ir(i,String(m));else if(g==="symbol")try{Ir(i,m.toString())}catch{}}let s=i.join(" ").trim();s||(s=`[console.${e||n}]`);let a=null,c=null;if(o.length)try{a=le(o),c={arguments:a}}catch{c={arguments:o.slice()}}const l=[],f=Array.isArray(a)?a:null;for(let d=0;d<o.length;d+=1){const m=o[d],g=f?f[d]:null,b=m instanceof Error,P=g&&typeof g=="object"&&g!==null?typeof g.stack=="string"||typeof g.message=="string"||typeof g.name=="string":!1;if(!b&&!P)continue;let A=P?g:null;if(!A)try{A=le(m)}catch{A=null}!A&&b&&(A={name:m.name||null,message:m.message||Co(m)||null},typeof m.code<"u"&&(A.code=m.code),typeof m.status<"u"&&(A.status=m.status),typeof m.stack=="string"&&m.stack&&(A.stack=m.stack));let O=A;if(O&&typeof O=="object")try{O=nu(O)}catch{try{O=Object.assign({},O)}catch{O=A}}const _={index:d};if(O&&typeof O=="object")_.value=O,typeof O.name=="string"&&O.name&&(_.name=O.name),typeof O.message=="string"&&O.message&&(_.message=O.message),typeof O.code<"u"&&(_.code=O.code),typeof O.status<"u"&&(_.status=O.status);else if(typeof O<"u"){_.value=O;const w=Co(O);w&&(_.message=w)}else _.value=null;const k=m===null?"null":typeof m;if(k==="object"||k==="function"){const w=m&&m.constructor&&m.constructor.name;_.argumentType=typeof w=="string"&&w?w:k}else _.argumentType=k;const j=b&&typeof m.stack=="string"&&m.stack?Ti(m.stack):O&&typeof O=="object"&&typeof O.stack=="string"?Ti(O.stack):null;j&&(typeof j.stack=="string"&&(_.stack=j.stack),Array.isArray(j.frames)&&j.frames.length&&(_.frames=j.frames),j.truncated&&(_.stackTruncated=!0)),Ir(l,_)}const u={channel:"console",method:e||"log"};if(r&&typeof r=="object"){const d=Object.keys(r);for(let m=0;m<d.length;m+=1){const g=d[m];try{u[g]=le(r[g])}catch{u[g]=r[g]}}}if(l.length){c=c||{};const d=[];for(let g=0;g<l.length;g+=1){const b=l[g];d.push(b.index)}c.errors=l,c.errorCount=l.length,c.errorIndices=d,c.primaryError=l[0],u.errorCount=l.length,u.errorIndices=d;const m=l[0];m&&(typeof m.name=="string"&&m.name&&(u.primaryErrorName=m.name),typeof m.message=="string"&&m.message&&(u.primaryErrorMessage=m.message),typeof m.code<"u"&&(u.primaryErrorCode=m.code),typeof m.status<"u"&&(u.primaryErrorStatus=m.status),m.stack&&(u.primaryErrorHasStack=!0))}const y=e==="error"||l.length>0,p={namespace:"console",meta:u};return y&&(p.captureStack=!0),ft(n,s,c,p,{silentConsole:!0})}function uy(){if(Et)return!0;if(Ta=!0,typeof console>"u"||!console)return Vr=!0,!1;try{if(console[It])return Et=!0,Vr=!1,!0}catch{}let e=!1;for(let t=0;t<Ln.length;t+=1){const r=Ln[t];let n=Au(r);if(typeof n!="function")try{const i=console[r];typeof i=="function"&&(!i||!i[It])&&(n=i)}catch{n=null}if((!Object.prototype.hasOwnProperty.call(de,r)||de[r]===null)&&(de[r]=typeof n=="function"?n:de[r]),typeof n!="function")continue;const o=function(){const s=xa(arguments);Qn+=1;try{if(Qn===1){const a=s.length?s[0]:null;if(!(typeof a=="string"&&a.indexOf("cineLogging:")===0))try{ly(r,s,{captured:!0})}catch(l){}}return Ou(r,s)}finally{Qn-=1,Qn<0&&(Qn=0)}};try{Object.defineProperty(o,It,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{o[It]=!0}try{console[r]=o,e=!0}catch{}}if(e){Et=!0,Vr=!1;try{Object.defineProperty(console,It,{configurable:!0,enumerable:!1,writable:!1,value:!0})}catch{try{console[It]=!0}catch{}}}else Vr=!0;return Et}function fy(){if(!Et)return!1;if(typeof console>"u"||!console)return Et=!1,!1;let e=!1;for(let t=0;t<Ln.length;t+=1){const r=Ln[t],n=de[r];try{typeof n=="function"?(console[r]=n,e=!0):r!=="log"&&r!=="info"&&delete console[r]}catch{}}try{console&&console[It]&&(typeof Object.defineProperty=="function"?Object.defineProperty(console,It,{configurable:!0,enumerable:!1,writable:!0,value:!1}):console[It]=!1)}catch{}return Et=!1,e}function Fa(){return L.captureConsole?uy()?(Jo=!1,Jn!=="enabled"&&(ft("info","Console output capture enabled",ks({status:"enabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Jn="enabled"),!0):(Jo||(ft("warn","Console output capture failed",ks({status:"failed",reason:typeof console>"u"||!console?"console-unavailable":"installation-failed"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Xe("cineLogging: Unable to capture console output for diagnostics."),Jo=!0),Jn="failed",!1):(Et&&fy(),Jn!=="disabled"&&(ft("info","Console output capture disabled",ks({status:"disabled"}),{namespace:"logging",meta:{channel:"console",lifecycle:"sync"}},{silentConsole:!0}),Jn="disabled"),Jo=!1,Vr=!1,!0)}function Da(){return!!L.captureConsole&&Et===!0}function ks(e){const t={configured:L.captureConsole===!0,installed:Et===!0,attempted:Ta===!0,failed:Vr===!0};if((typeof console>"u"||!console)&&(t.consoleAvailable=!1),e&&typeof e=="object"){const r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}}return t}function py(e){return Ua({captureConsole:!0},(e&&typeof e=="object"?e:null)||void 0),Da()}function dy(e){return Ua({captureConsole:!1},(e&&typeof e=="object"?e:null)||void 0),Da()}function yy(e,t,r){const n=r&&Object.prototype.hasOwnProperty.call(r,"captureStack")?r.captureStack:null;return n===!0?!0:n===!1||L.stackTraces!==!0?!1:t instanceof Error?!0:Tn(e)>=Tn("warn")}function Cu(e,t,r,n){if(!yy(e,r,n))return null;let o="generated",i="";if(r instanceof Error){const c=r.stack;typeof c=="string"&&c&&(o="detail",i=c)}if(!i)try{const c=typeof t=="string"&&t?t:`Log ${e}`,l=new Error(c);typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(l,Cu),typeof l.stack=="string"&&l.stack&&(i=l.stack)}catch{}const s=Ti(i);if(!s)return null;const a={source:o,stack:s.stack,truncated:s.truncated};return Array.isArray(s.frames)&&s.frames.length&&(a.frames=s.frames),Ie(a)}function ft(e,t,r,n,o){const i=Rr(e,"info"),s=Date.now();let a="";try{a=new Date(s).toISOString()}catch{a=String(s)}const c=n&&typeof n=="object"?n:null,l=Cu(i,t,r,c),f=c&&typeof c.namespace=="string"&&c.namespace?n.namespace:null,u=c&&typeof c.meta<"u"?le(c.meta):null,y=typeof r>"u"?null:le(r),p=Ie({id:Su(s),level:i,message:Co(t),namespace:f,detail:y,meta:u,timestamp:s,isoTimestamp:a,origin:l});Ma(fu,i,1),mu(i)&&Eu(p);const d=o&&typeof o=="object"?o:null;if(hu(i)&&(!d||d.silentConsole!==!0)){const g=($t[i]||$t.info).consoleMethod,b=["[cine]"];f&&b.push(`[${f}]`),b.push(p.isoTimestamp);const A=[`${b.join(" ")} ${p.message}`];r!==void 0?Ir(A,r):p.detail!==null&&Ir(A,p.detail),p.meta!==null&&Ir(A,{meta:p.meta}),l&&Ir(A,{origin:l}),Ou(g,A)}return p}function Pu(e,t,r){return ft("debug",e,t,r)}function gy(e,t,r){return ft("info",e,t,r)}function my(e,t,r){return ft("warn",e,t,r)}function hy(e,t,r){return ft("error",e,t,r)}function Po(){return Ie({level:L.level,historyLevel:L.historyLevel,historyLimit:L.historyLimit,consoleOutput:L.consoleOutput,persistSession:L.persistSession,captureGlobalErrors:L.captureGlobalErrors,captureConsole:L.captureConsole,stackTraces:L.stackTraces})}function by(e){const t=e&&typeof e.limit<"u"?e.limit:void 0;return sy(t)}function Sy(){return ae?Ie({count:typeof ae.count=="number"?ae.count:0,limit:typeof ae.limit=="number"?ae.limit:Ga(),source:typeof ae.source=="string"?ae.source:"enforce",timestamp:typeof ae.timestamp=="number"?ae.timestamp:null,isoTimestamp:typeof ae.isoTimestamp=="string"?ae.isoTimestamp:null,oldestEntryId:typeof ae.oldestEntryId=="string"?ae.oldestEntryId:null,oldestEntryTimestamp:typeof ae.oldestEntryTimestamp=="number"?ae.oldestEntryTimestamp:null,oldestEntryIsoTimestamp:typeof ae.oldestEntryIsoTimestamp=="string"?ae.oldestEntryIsoTimestamp:null,newestEntryId:typeof ae.newestEntryId=="string"?ae.newestEntryId:null,newestEntryTimestamp:typeof ae.newestEntryTimestamp=="number"?ae.newestEntryTimestamp:null,newestEntryIsoTimestamp:typeof ae.newestEntryIsoTimestamp=="string"?ae.newestEntryIsoTimestamp:null,levels:ae.levels?An(ae.levels):An($n())}):null}function _u(){return Ie({runtimeEntries:uu,retainedEntries:Nt.length,droppedEntries:du,historyLimit:Ga(),lastDrop:Sy(),levels:Ie({emitted:An(fu),retained:An(as),dropped:An(pu)}),consoleCapture:Ie({configured:L.captureConsole===!0,installed:Et,attempted:Ta,failed:Vr})})}function wy(e){return Nt.length=0,Vd(as),(!e||e.persist!==!1)&&Na(),!0}function Ey(e){return typeof e!="function"?function(){return!1}:(Li.add(e),function(){return Li.delete(e),!0})}function Ay(e){return typeof e!="function"?function(){return!1}:(Ri.add(e),function(){return Ri.delete(e),!0})}function Oy(e,t){if(!e&&!t)return null;if(!e)return le(t);if(!t)return e;if(typeof e!="object"||typeof t!="object")return le(t);const r={},n=Object.keys(e);for(let i=0;i<n.length;i+=1){const s=n[i];r[s]=e[s]}const o=Object.keys(t);for(let i=0;i<o.length;i+=1){const s=o[i];r[s]=le(t[s])}return r}function Cy(e,t){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?le(t.meta):null;function o(i,s,a,c){const l=Oy(n,c);return ft(i,s,a,{namespace:r,meta:l})}return Ie({namespace:r,log(i,s,a,c){return o(i,s,a,c)},debug(i,s,a){return o("debug",i,s,a)},info(i,s,a){return o("info",i,s,a)},warn(i,s,a){return o("warn",i,s,a)},error(i,s,a){return o("error",i,s,a)},getConfig:Po,isLevelEnabled(i,s){return bu(i,s)},getLevelState(i){return Ba(i)}})}function ku(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;const t=Wd;try{return typeof t=="symbol"?e[t]?!0:(e[t]=!0,!1):Object.prototype.hasOwnProperty.call(e,t)&&e[t]?!0:(Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:!0}),!1)}catch{}return!1}function Py(e){if(!L.captureGlobalErrors||ku(e))return;const t={message:e&&typeof e.message=="string"?e.message:"",filename:e&&(e.filename||e.fileName)||null,lineno:e&&(e.lineno||e.lineNumber)||null,colno:e&&(e.colno||e.columnNumber)||null,error:e&&e.error?le(e.error):null};e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Global error captured",t,{namespace:"global"})}function _y(e){if(!L.captureGlobalErrors||ku(e))return;const t={reason:e?le(e.reason):null};e&&e.promise&&(t.promiseState="[Promise]"),e&&typeof e.preventDefault=="function"&&e.defaultPrevented&&(t.defaultPrevented=!0),ft("error","Unhandled promise rejection captured",t,{namespace:"global"})}function ky(e){if(!e||typeof e!="object"&&typeof e!="function")return!1;if(Qo instanceof WeakSet)return Qo.has(e)?!0:(Qo.add(e),!1);const t=Qo;return t.indexOf(e)!==-1?!0:(t.push(e),!1)}function vu(){if(!L.captureGlobalErrors)return;const e=Fr(W);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r.addEventListener!="function")&&!ky(r)){try{r.addEventListener("error",Py,!0)}catch{}try{r.addEventListener("unhandledrejection",_y,!0)}catch{}}}}function cs(e){if(!e||typeof e!="object")return{changed:!1,captureChanged:!1,limitChanged:!1};let t=!1,r=!1,n=!1,o=!1;const i=Object.prototype.hasOwnProperty.call(e,"persistSession")?Xn(e.persistSession,L.persistSession):L.persistSession;if(Object.prototype.hasOwnProperty.call(e,"level")){const s=Rr(e.level,L.level);s!==L.level&&(L.level=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLevel")){const s=Rr(e.historyLevel,L.historyLevel);s!==L.historyLevel&&(L.historyLevel=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"historyLimit")){const s=yu(e.historyLimit,{allowReducedMin:i===!1});s!==L.historyLimit&&(L.historyLimit=s,t=!0,n=!0)}if(Object.prototype.hasOwnProperty.call(e,"consoleOutput")){const s=Xn(e.consoleOutput,L.consoleOutput);s!==L.consoleOutput&&(L.consoleOutput=s,t=!0)}if(Object.prototype.hasOwnProperty.call(e,"persistSession")&&i!==L.persistSession&&(L.persistSession=i,t=!0),L.persistSession&&L.historyLimit<ji&&(L.historyLimit=ji,t=!0,n=!0),Object.prototype.hasOwnProperty.call(e,"captureGlobalErrors")){const s=Xn(e.captureGlobalErrors,L.captureGlobalErrors);s!==L.captureGlobalErrors&&(L.captureGlobalErrors=s,t=!0,r=!0)}if(Object.prototype.hasOwnProperty.call(e,"captureConsole")){const s=Xn(e.captureConsole,L.captureConsole);s!==L.captureConsole&&(L.captureConsole=s,t=!0,o=!0)}if(Object.prototype.hasOwnProperty.call(e,"stackTraces")){const s=Xn(e.stackTraces,L.stackTraces);s!==L.stackTraces&&(L.stackTraces=s,t=!0)}return{changed:t,captureChanged:r,limitChanged:n,consoleCaptureChanged:o}}function Ua(e,t){const r=L.captureGlobalErrors,n=L.captureConsole,o=cs(e);return o.limitChanged&&za({source:"config"}),o.changed&&(!t||t.persist!==!1)&&(ny(),Na()),L.persistSession||gu(),!r&&L.captureGlobalErrors&&vu(),(o.consoleCaptureChanged||n!==L.captureConsole)&&Fa(),o.changed&&ay(Po()),Po()}function vy(){const e=Fr(W),t=["__cineLoggingConfig","__CINE_LOGGING_CONFIG","cineLoggingConfig"];for(let r=0;r<e.length;r+=1){const n=e[r];if(!(!n||typeof n!="object"&&typeof n!="function"))for(let o=0;o<t.length;o+=1){const i=t[o];let s;try{s=n[i]}catch{s=null}if(s&&typeof s=="object")return s}}return null}function jy(){const e=$o();if(!e)return;let t="";try{t=e.getItem(qs)||""}catch{return}if(t)try{const r=JSON.parse(t);cs(r)}catch(r){Xe("cineLogging: Unable to restore logging config from storage",r)}}function Iy(){if(!W||!W.location)return;let e="";try{e=W.location.search||""}catch{return}if(typeof e!="string"||!e)return;let t=null;if(typeof URLSearchParams=="function")try{t=new URLSearchParams(e)}catch{}const r={};let n=!1;function o(i,s){r[i]=s,n=!0}if(t)t.has("cineLogLevel")&&o("level",t.get("cineLogLevel")),t.has("cineLogHistoryLevel")&&o("historyLevel",t.get("cineLogHistoryLevel")),t.has("cineLogLimit")&&o("historyLimit",t.get("cineLogLimit")),t.has("cineLogConsole")&&o("consoleOutput",t.get("cineLogConsole")),t.has("cineLogPersist")&&o("persistSession",t.get("cineLogPersist")),t.has("cineLogCapture")&&o("captureGlobalErrors",t.get("cineLogCapture")),t.has("cineLogConsoleCapture")&&o("captureConsole",t.get("cineLogConsoleCapture")),t.has("cineLogStackTraces")&&o("stackTraces",t.get("cineLogStackTraces"));else{const s=(e.charAt(0)==="?"?e.slice(1):e).split("&");for(let a=0;a<s.length;a+=1){const c=s[a];if(!c)continue;const l=c.indexOf("="),f=decodeURIComponent(l===-1?c:c.slice(0,l)),u=l===-1?"":decodeURIComponent(c.slice(l+1));f==="cineLogLevel"?o("level",u):f==="cineLogHistoryLevel"?o("historyLevel",u):f==="cineLogLimit"?o("historyLimit",u):f==="cineLogConsole"?o("consoleOutput",u):f==="cineLogPersist"?o("persistSession",u):f==="cineLogCapture"?o("captureGlobalErrors",u):f==="cineLogConsoleCapture"?o("captureConsole",u):f==="cineLogStackTraces"&&o("stackTraces",u)}}n&&cs(r)}function ju(e){if(!e||typeof e!="object")return null;const t=Rr(e.level,"info"),r=typeof e.timestamp=="number"&&Number.isFinite(e.timestamp)?e.timestamp:Date.now();let n="";if(typeof e.isoTimestamp=="string"&&e.isoTimestamp)n=e.isoTimestamp;else try{n=new Date(r).toISOString()}catch{n=String(r)}const o=typeof e.message=="string"?e.message:Co(e.message),i=typeof e.namespace=="string"&&e.namespace?e.namespace:null,s=typeof e.id=="string"&&e.id?e.id:Su(r);return Ie({id:s,level:t,message:o,namespace:i,detail:typeof e.detail>"u"?null:le(e.detail),meta:typeof e.meta>"u"?null:le(e.meta),timestamp:r,isoTimestamp:n,origin:typeof e.origin>"u"?null:ry(e.origin)})}function Ly(){return W&&typeof W.navigator=="object"&&W.navigator?W.navigator:typeof navigator<"u"&&navigator?navigator:typeof globalThis<"u"&&globalThis&&typeof globalThis.navigator=="object"?globalThis.navigator:null}function Iu(){const e=Ly();return!e||typeof e!="object"||!e.serviceWorker?null:e.serviceWorker}function Ry(e){return e?U.seenIds?U.seenIds.has(e)?!1:(U.seenIds.add(e),!0):Array.isArray(U.fallbackSeenIds)?U.fallbackSeenIds.indexOf(e)!==-1?!1:(U.fallbackSeenIds.push(e),!0):!0:!0}function Ty(e,t){const r={};if(e&&typeof e.meta<"u")if(e.meta&&typeof e.meta=="object")for(const o in e.meta)Object.prototype.hasOwnProperty.call(e.meta,o)&&(r[o]=e.meta[o]);else r.value=e.meta;const n=e&&typeof e.channel=="string"&&e.channel?e.channel:r.channel;return n?r.channel=n:r.channel="service-worker",t&&typeof t=="object"&&(t.cacheName&&!r.cacheName&&(r.cacheName=t.cacheName),t.cacheVersion&&!r.cacheVersion&&(r.cacheVersion=t.cacheVersion),typeof t.generatedAt=="number"&&Number.isFinite(t.generatedAt)&&(r.snapshotTimestamp||(r.snapshotTimestamp=t.generatedAt)),typeof t.historyLength=="number"&&Number.isFinite(t.historyLength)&&(r.snapshotSize||(r.snapshotSize=t.historyLength))),r}function Bc(e,t){if(!(!Array.isArray(e)||!e.length))for(let r=0;r<e.length;r+=1){const n=e[r];if(!n||typeof n!="object")continue;const o=typeof n.id=="string"&&n.id?n.id:null;if(!Ry(o))continue;const i=n.origin&&typeof n.origin=="object"?n.origin:{runtime:"service-worker"},s=ju({id:o||void 0,level:n.level,message:n.message,namespace:typeof n.namespace=="string"&&n.namespace?n.namespace:"service-worker",detail:typeof n.detail>"u"?null:n.detail,meta:Ty(n,t),timestamp:n.timestamp,isoTimestamp:n.isoTimestamp,origin:i});s&&Eu(s)}}function pi(e){if(U.requestInFlight&&!(e&&U.lastRequestId&&e!==U.lastRequestId)){if(U.requestInFlight=!1,U.lastRequestId=null,U.requestTimer&&typeof clearTimeout=="function")try{clearTimeout(U.requestTimer)}catch{}U.requestTimer=null}}function Wr(){if(!(U.broadcastChannel||U.broadcastFailed)&&!(U.pollTimer||typeof setTimeout!="function"))try{U.pollTimer=setTimeout(()=>{U.pollTimer=null,Lu("poll")},ey)}catch{}}function My(){if(U.broadcastFailed)return null;if(U.broadcastChannel)return U.broadcastChannel;if(typeof BroadcastChannel!="function")return U.broadcastFailed=!0,null;try{const e=new BroadcastChannel(Jd);if(e.addEventListener("message",Mi),U.broadcastChannel=e,U.pollTimer&&typeof clearTimeout=="function"){try{clearTimeout(U.pollTimer)}catch(t){}U.pollTimer=null}return e}catch(e){return U.broadcastFailed=!0,Xe("cineLogging: Unable to open service worker diagnostics channel",e),null}}function Mi(e){if(!e)return;let t=null;try{t=e.data||null}catch{t=null}if(!(!t||typeof t!="object")){if(t.type===Qd){Bc([t.entry],U.lastSnapshotMeta),Wr();return}if(t.type===Zd){pi(t.requestId||null);const r=t.state&&typeof t.state=="object"?t.state:null;if(!r){Wr();return}U.lastSnapshotMeta={cacheName:typeof r.cacheName=="string"&&r.cacheName?r.cacheName:null,cacheVersion:r.cacheVersion||null,generatedAt:typeof r.generatedAt=="number"&&Number.isFinite(r.generatedAt)?r.generatedAt:Date.now(),historyLength:typeof r.historyLength=="number"&&Number.isFinite(r.historyLength)?r.historyLength:null},Bc(r.history,U.lastSnapshotMeta),Wr()}}}function Lu(e){if(U.requestInFlight)return;const t=Iu();if(!t)return;U.supported=!0;const r=`sw-log-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;U.requestInFlight=!0,U.lastRequestId=r;const n={type:Xd,limit:ty,reason:typeof e=="string"&&e?e:"sync",requestId:r},o=s=>{if(s){try{s.port1.onmessage=null}catch{}if(typeof s.port1.onmessageerror<"u")try{s.port1.onmessageerror=null}catch{}try{s.port1.close()}catch{}try{s.port2.close()}catch{}}},i=t.ready&&typeof t.ready.then=="function"?t.ready.then(s=>s&&s.active||t.controller||null):Promise.resolve(t.controller||null);Promise.resolve(i).then(s=>{const a=t.controller||null,c=s||a;if(!c||typeof c.postMessage!="function"){pi(r),Wr();return}let l=!1,f=null;const u=()=>{l||(l=!0,o(f),pi(r))},y=()=>{u(),Wr()},p=b=>{u(),Mi(b)},d=()=>{Xe("cineLogging: Service worker diagnostics channel closed before a response was received",{requestId:r}),y()},m=()=>{try{c.postMessage(n)}catch(b){Xe("cineLogging: Unable to post service worker diagnostics request",b),y();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{l||y()},zc)}catch{}};if(!(typeof MessageChannel!="function"||!a?!1:c===a)){m();return}if(f=new MessageChannel,f.port1.onmessage=p,typeof f.port1.onmessageerror<"u"&&(f.port1.onmessageerror=d),typeof f.port1.start=="function")try{f.port1.start()}catch{}try{c.postMessage(n,[f.port2])}catch(b){o(f),f=null,Xe("cineLogging: Unable to request service worker diagnostics",b),m();return}if(typeof setTimeout=="function")try{U.requestTimer=setTimeout(()=>{l||d()},zc)}catch{}}).catch(s=>{pi(r),Xe("cineLogging: Unable to await service worker for diagnostics",s),Wr()})}function Ny(){if(U.initialised)return;U.initialised=!0;const e=Iu();if(e){if(U.supported=!0,My(),typeof e.addEventListener=="function")try{e.addEventListener("message",Mi)}catch(t){Xe("cineLogging: Unable to attach service worker diagnostics listener",t)}else if(typeof e.onmessage>"u")try{e.onmessage=Mi}catch{}Lu("initial-sync"),U.broadcastChannel||Wr()}}function Gy(){if(!L.persistSession)return;const e=$o();if(!e)return;let t="";try{t=e.getItem(Ii)||""}catch{return}if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;for(let n=0;n<r.length;n+=1){const o=ju(r[n]);o&&wu(o)}za({source:"restore"})}catch(r){Xe("cineLogging: Unable to restore log history from storage",r)}}function zy(){L=lu();const e=vy();e&&cs(e),jy(),Iy()}zy();Gy();Ny();Fa();L.captureGlobalErrors&&vu();Pu("cineLogging initialized",{config:Po(),stats:_u()},{namespace:"logging",meta:{lifecycle:"init"}});const ls=Ie({log:ft,debug:Pu,info:gy,warn:my,error:hy,createLogger:Cy,getHistory:by,getStats:_u,clearHistory:wy,getConfig:Po,setConfig:Ua,getLevelState:Ba,isLevelEnabled:bu,subscribe:Ey,subscribeConfig:Ay,enableConsoleCapture:py,disableConsoleCapture:dy,syncConsoleCapture:Fa,isConsoleCaptureActive:Da,constants:Ie({LOG_LEVELS:$d,DEFAULT_CONFIG:Yd})});Kd("cineLogging",ls);const Ru={category:"diagnostics",description:"Structured logging utilities for debugging and diagnostics.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},By=xd("cineLogging",ls,Ru,function(e){Xe("Unable to register cineLogging module.",e)},W,fi);By||Bd("cineLogging",ls,Ru,W);Ud("cineLogging",ls,{configurable:!0,enumerable:!1,writable:!1})||Xe("Unable to expose cineLogging globally.");const vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;function Tu(){return(vs&&typeof vs=="object"?vs:null)||(typeof globalThis<"u"?globalThis:null)}function Ni(e){const t=Tu();if(!t)return null;let r,n=null;try{r=t.console,n=Object.getOwnPropertyDescriptor(t,"console")}catch{r=typeof console<"u"?console:null}if(!r||typeof r!="object")return null;let o=[];Array.isArray(e)?o=e:typeof e=="string"&&e?o=[e]:o=["warn","info"];const i=Object.create(null);for(let l=0;l<o.length;l+=1){const f=o[l];typeof f=="string"&&f&&(i[f]=!0)}const s=Object.keys(i);if(!s.length)return r;const a=Object.create(null);for(let l=0;l<s.length;l+=1){const f=s[l];let u=r[f];try{const y=Object.getOwnPropertyDescriptor(r,f);y&&Object.prototype.hasOwnProperty.call(y,"value")&&(u=y.value)}catch{}if(typeof u=="function")try{a[f]=u.bind(r)}catch{a[f]=u}else a[f]=u}const c=new Proxy(r,{get(l,f,u){return Object.prototype.hasOwnProperty.call(a,f)?a[f]:Reflect.get(l,f,u)},set(l,f,u,y){if(Object.prototype.hasOwnProperty.call(a,f))return a[f]=u,!0;try{return Reflect.set(l,f,u,y),!0}catch{}return!1},defineProperty(l,f,u){return Object.prototype.hasOwnProperty.call(a,f)?(u&&Object.prototype.hasOwnProperty.call(u,"value")&&(a[f]=u.value),!0):Reflect.defineProperty(l,f,u)},getOwnPropertyDescriptor(l,f){return Object.prototype.hasOwnProperty.call(a,f)?{configurable:!0,enumerable:!0,writable:!0,value:a[f]}:Reflect.getOwnPropertyDescriptor(l,f)},ownKeys(l){const f=Reflect.ownKeys(l);for(let u=0;u<s.length;u+=1)f.indexOf(s[u])===-1&&f.push(s[u]);return f}});try{Object.defineProperty(t,"console",{configurable:!0,enumerable:n?n.enumerable!==!1:!0,writable:!0,value:c})}catch{t.console=c}return c}const Xo=Tu();if(Xo&&typeof Xo=="object")try{typeof Xo.__cineEnsureConsoleMethodsWritable!="function"&&(Xo.__cineEnsureConsoleMethodsWritable=Ni)}catch{}const xy=Object.freeze(Object.defineProperty({__proto__:null,ensureConsoleMethodsWritable:Ni},Symbol.toStringTag,{value:"Module"}));function Fy(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const cr=Fy();function Dy(e){return typeof cineModuleBase=="object"&&cineModuleBase?cineModuleBase:e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null}const we=Dy(cr),Uy=we&&typeof we.freezeDeep=="function"?we.freezeDeep:function(t){return t},Mu=e=>{try{return Uy(e)}catch{return e}};function xc(e){const t=[];function r(n){!n||typeof n!="object"&&typeof n!="function"||t.indexOf(n)===-1&&t.push(n)}return e&&r(e),typeof globalThis<"u"&&r(globalThis),typeof window<"u"&&r(window),typeof self<"u"&&r(self),typeof global<"u"&&r(global),t}const Ky=we&&typeof we.collectCandidateScopes=="function"?function(t){try{const r=we.collectCandidateScopes(t,cr);if(Array.isArray(r)&&r.length)return r}catch{}return xc(t||cr)}:xc;function $y(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Ws=we&&typeof we.safeWarn=="function"?we.safeWarn:$y;function Vy(e){if(!e||typeof e!="object"&&typeof e!="function")return null;let t=null;try{t=e.cineLogging||null}catch{t=null}return t&&typeof t=="object"?t:null}function Nu(e={}){const t=e.baseScope||cr;e.allowRequire;const r=Ky(t);for(let n=0;n<r.length;n+=1){const o=Vy(r[n]);if(o)return o}return null}function _r(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const o=[];t.set(e,o);for(let i=0;i<e.length;i+=1)o[i]=_r(e[i],t);return o}const r={};t.set(e,r);const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=_r(e[i],t)}return r}function Hy(e,t){if(!e&&!t)return null;if(!e)return _r(t);if(!t)return _r(e);if(typeof e!="object"||typeof t!="object")return _r(t);const r=_r(e),n=Object.keys(t);for(let o=0;o<n.length;o+=1){const i=n[o];r[i]=_r(t[i])}return r}function qy(e){if(typeof console>"u"||!console)return null;const t=typeof e=="string"?e.toLowerCase():"";return t==="error"&&typeof console.error=="function"?console.error.bind(console):t==="warn"&&typeof console.warn=="function"?console.warn.bind(console):t==="info"&&typeof console.info=="function"?console.info.bind(console):t==="debug"&&typeof console.debug=="function"?console.debug.bind(console):typeof console.log=="function"?console.log.bind(console):null}let Fc=!1;function Gu(e,t={}){const r=typeof e=="string"&&e.trim()?e.trim():"app",n=t&&typeof t.meta<"u"?_r(t.meta):null;function o(s,a,c,l){const f=qy(s);if(!f)return null;const u=["[cine-fallback]"];r&&u.push(`[${r}]`);const y=new Date;try{u.push(y.toISOString())}catch{u.push(String(y.getTime()))}const m=[`${u.join(" ")} ${typeof a=="string"&&a?a:"Log entry"}`];typeof c<"u"&&m.push(c);const g=Hy(n,l);g&&m.push({meta:g,source:"console-fallback"});try{f(...m)}catch{}if(!Fc&&typeof console<"u"&&typeof console.warn=="function"){Fc=!0;try{console.warn("[cine-fallback] Structured logging unavailable, using console logger.")}catch{}}return null}return Mu({namespace:r,log(s,a,c,l){return o(s,a,c,l)},debug(s,a,c){return o("debug",s,a,c)},info(s,a,c){return o("info",s,a,c)},warn(s,a,c){return o("warn",s,a,c)},error(s,a,c){return o("error",s,a,c)},getConfig(){return null},isLevelEnabled(){return!0},getLevelState(s){return{level:typeof s=="string"&&s?s:"all",enabled:!0,source:"console-fallback"}},__cineLoggingFallback:!0})}function Wy(e,t={}){const r=Nu(t),n=t&&typeof t.meta<"u"?t.meta:void 0;if(r&&typeof r.createLogger=="function")try{const o=r.createLogger(e,typeof n<"u"?{meta:n}:void 0);if(o)return o}catch(o){Ws("cineLoggingResolver: createLogger failed, falling back to console.",o)}return t.allowConsoleFallback===!1?null:Gu(e,{meta:n})}const Yr=Mu({resolveLogging:Nu,resolveLogger:Wy,createConsoleFallbackLogger:Gu}),Yy=we&&typeof we.resolveModuleRegistry=="function"?we.resolveModuleRegistry(cr):null;if(we&&typeof we.registerOrQueueModule=="function"&&!we.registerOrQueueModule("cineLoggingResolver",Yr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0,connections:["cineLogging","cineModuleBase","cineEnvironmentBridge"]},t=>{Ws("Unable to register cineLoggingResolver module.",t)},cr,Yy)&&typeof we.queueModuleRegistration=="function")try{we.queueModuleRegistration("cineLoggingResolver",Yr,{category:"diagnostics",description:"Helpers to resolve cineLogging instances and console fallbacks across runtimes.",replace:!0},cr)}catch(t){Ws("Unable to queue cineLoggingResolver registration.",t)}if(we&&typeof we.exposeGlobal=="function")we.exposeGlobal("cineLoggingResolver",Yr,cr,{configurable:!0,enumerable:!1,writable:!1});else try{cr.cineLoggingResolver=Yr}catch{}function Jy(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{}}const Tr=Jy(),wt=typeof cineModuleBase=="object"&&cineModuleBase||(Tr&&typeof Tr.cineModuleBase=="object"?Tr.cineModuleBase:null),lr=wt&&typeof wt.safeWarn=="function"?wt.safeWarn:function(t,r){if(!(typeof console>"u"||!console||typeof console.warn!="function"))try{typeof r>"u"?console.warn(t):console.warn(t,r)}catch{}},Ka="cameraPowerPlanner_contacts";function zu(e){const t=e||Tr;try{if(t&&typeof t.localStorage<"u")return t.localStorage}catch(r){lr("cine.features.contacts could not access localStorage.",r)}return null}function $a(){return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function jt(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return jt(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Gi(e){if(!e||typeof e!="object")return null;const t=jt(e.id)||$a(),r=jt(e.name),n=jt(e.role),o=jt(e.phone),i=jt(e.email),s=jt(e.website||e.url),a=jt(e.notes||e.note||e.text),c=typeof e.avatar=="string"&&e.avatar.startsWith("data:")?e.avatar:"",l=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),f=Number.isFinite(e.updatedAt)?e.updatedAt:l,u={id:t,name:r,role:n,phone:o,email:i,website:s,notes:a,createdAt:l,updatedAt:f};return c&&(u.avatar=c),u}function Va(e){return(Array.isArray(e)?e.filter(Boolean):[]).map(Gi).filter(Boolean).sort((t,r)=>{const n=(t&&t.name?t.name:"").toLowerCase(),o=(r&&r.name?r.name:"").toLowerCase();if(n&&o&&n!==o)try{return n.localeCompare(o)}catch(i){lr("cine.features.contacts could not sort contacts by locale.",i)}return n&&!o?-1:!n&&o?1:(t&&t.createdAt?t.createdAt:0)-(r&&r.createdAt?r.createdAt:0)})}function Qy(e={}){const t=zu(e.scope);if(!t||typeof t.getItem!="function")return[];const r=typeof e.storageKey=="string"&&e.storageKey?e.storageKey:Ka;try{const n=t.getItem(r);if(!n)return[];const o=JSON.parse(n);return Array.isArray(o)?Va(o):[]}catch(n){return lr("cine.features.contacts could not load contacts from storage.",n),[]}}function Xy(e,t={}){const r=zu(t.scope);if(!r||typeof r.setItem!="function")return!1;const n=typeof t.storageKey=="string"&&t.storageKey?t.storageKey:Ka;try{return r.setItem(n,JSON.stringify(Array.isArray(e)?e:[])),!0}catch(o){return lr("cine.features.contacts could not save contacts to storage.",o),!1}}function Bu(e){if(!e||typeof e!="object")return"";const t=["BEGIN:VCARD","VERSION:3.0"];if(e.name){t.push(`FN:${e.name}`);const r=e.name.trim().split(/\s+/);r.length>=2?t.push(`N:${r.slice(1).join(" ")};${r[0]};;;`):t.push(`N:;${e.name};;;`)}if(e.role&&t.push(`TITLE:${e.role}`),e.phone&&t.push(`TEL:${e.phone}`),e.email&&t.push(`EMAIL:${e.email}`),e.website&&t.push(`URL:${e.website}`),e.notes&&t.push(`NOTE:${e.notes.replace(/\r?\n/g,"\\n")}`),e.avatar&&e.avatar.startsWith("data:"))try{const[r,n]=e.avatar.split(","),o=r.match(/data:([^;]+)/),s=(o?o[1]:"image/jpeg").split("/")[1].toUpperCase();t.push(`PHOTO;ENCODING=b;TYPE=${s}:${n}`)}catch(r){lr("Failed to encode avatar for vCard",r)}return t.push("END:VCARD"),t.join(`\r
`)}function Zy(e){return!Array.isArray(e)||e.length===0?"":e.map(Bu).join(`\r
\r
`)}const eg=Object.freeze(["id","name","role","phone","email","website","avatar","createdAt","updatedAt"]);function tg(e,t={}){const r=typeof t.sanitize=="function"?t.sanitize:jt;if(typeof e!="string")return[];const n=e.replace(/\r\n?/g,`
`),o=[];n.split(`
`).forEach(a=>{/^[ \t]/.test(a)&&o.length?o[o.length-1]+=a.replace(/^[ \t]/,""):o.push(a)});const i=[];let s=null;return o.forEach(a=>{if(/^BEGIN:VCARD/i.test(a)){s={name:"",role:"",phone:"",email:"",website:"",avatar:""};return}if(/^END:VCARD/i.test(a)){s&&(s.name||s.email||s.phone||s.website)&&i.push({...s}),s=null;return}if(!s)return;const[c,...l]=a.split(":");if(!l.length)return;const f=c.split(";"),u=f[0]?.toUpperCase(),y=l.join(":").trim();if(u){if(u==="FN"){s.name=r(y);return}if(u==="N"&&!s.name){s.name=y.split(";").filter(Boolean).join(" ").trim();return}if(u==="TEL"){s.phone||(s.phone=r(y));return}if(u==="EMAIL"){s.email||(s.email=r(y));return}if(u==="URL"||/\.URL$/.test(u)){s.website||(s.website=r(y));return}if((u==="ROLE"||u==="TITLE")&&!s.role){s.role=r(y);return}if(u==="ORG"&&!s.role){s.role=r(y);return}if(u==="PHOTO"){let p=y;if(!p)return;if(/^data:/i.test(p)){s.avatar=p;return}const d=f.slice(1);let m="image/jpeg";d.forEach(g=>{const[b,P]=g.split("=");if(!P)return;const A=b.trim().toUpperCase(),O=P.trim();if(A==="MEDIATYPE")m=O;else if(A==="TYPE"){const _=O.toLowerCase();_.includes("/")?m=_:m=`image/${_}`}}),s.avatar=`data:${m};base64,${p}`}}}),i.map(a=>({name:r(a.name),role:r(a.role),phone:r(a.phone),email:r(a.email),website:r(a.website),avatar:typeof a.avatar=="string"&&a.avatar.startsWith("data:")?a.avatar:""})).filter(a=>a.name||a.email||a.phone||a.website)}function rg(e={}){const{existing:t=[],imported:r=[],now:n=()=>Date.now(),generateContactIdFn:o=$a}=e,i=t.map(c=>Gi(c));let s=0,a=0;return r.forEach(c=>{const l=Gi({...c,id:c.id||o(),createdAt:n(),updatedAt:n()}),f=i.find(u=>{if(l.email&&u.email&&l.email.toLowerCase()===u.email.toLowerCase())return!0;if(l.phone&&u.phone){const y=l.phone.replace(/\D+/g,""),p=u.phone.replace(/\D+/g,"");if(y&&p&&y===p)return!0}return!!(l.name&&u.name&&l.name.toLowerCase()===u.name.toLowerCase()||l.website&&u.website&&l.website.toLowerCase()===u.website.toLowerCase())});f?(eg.forEach(u=>{l[u]&&(f[u]=l[u])}),f.updatedAt=n(),a+=1):(i.push(l),s+=1)}),{contacts:Va(i),added:s,updated:a}}const Mn=Object.freeze({CONTACTS_STORAGE_KEY:Ka,generateContactId:$a,sanitizeContactValue:jt,normalizeContactEntry:Gi,sortContacts:Va,loadStoredContacts:Qy,saveContactsToStorage:Xy,generateVCard:Bu,generateAllContactsVCard:Zy,parseVCard:tg,mergeImportedContacts:rg});if(wt&&typeof wt.registerOrQueueModule=="function")try{wt.registerOrQueueModule("cine.features.contacts",Mn,{category:"features",description:"Shared helpers for contacts management.",replace:!0,connections:["cineModuleBase","cineModuleGlobals","cinePersistence"]},e=>lr("Unable to register cine.features.contacts module.",e),Tr,wt.getModuleRegistry&&wt.getModuleRegistry(Tr))}catch(e){lr("cine.features.contacts registration failed.",e)}let xu=!1;if(wt&&typeof wt.exposeGlobal=="function")try{wt.exposeGlobal("cineFeaturesContacts",Mn,Tr,{configurable:!0,enumerable:!1,writable:!1}),xu=!0}catch(e){lr("cine.features.contacts could not expose global api.",e)}if(!xu)try{Tr.cineFeaturesContacts=Mn}catch(e){lr("cine.features.contacts could not assign global api.",e)}const $b=Object.freeze(Object.defineProperty({__proto__:null,default:Mn},Symbol.toStringTag,{value:"Module"}));class Fu{async init(){throw new Error('Method "init()" must be implemented.')}async getItem(t){throw new Error('Method "getItem()" must be implemented.')}async setItem(t,r){throw new Error('Method "setItem()" must be implemented.')}async removeItem(t){throw new Error('Method "removeItem()" must be implemented.')}async clear(){throw new Error('Method "clear()" must be implemented.')}async getKeys(){throw new Error('Method "getKeys()" must be implemented.')}}class zi extends Fu{constructor(){super(),this.name="IndexedDBAdapter"}async init(){try{if(typeof indexedDB>"u")throw new Error("IndexedDB is not supported in this environment.");return Promise.resolve()}catch(t){throw console.warn("IndexedDB initialization failed:",t),t}}async getItem(t){try{const r=await Tp(t);if(r==null)return null;if(typeof r!="string"){if(r&&typeof r=="object")try{return JSON.parse(JSON.stringify(r))}catch{return r}return r}let n=Bs.decompressFromUTF16(r);const o=n!==null?n:r;try{return JSON.parse(o)}catch{return o}}catch(r){return console.warn(`[IndexedDBAdapter] Failed to get/decompress item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r),o=Bs.compressToUTF16(n);await Mp(t,o)}catch(n){throw console.error(`[IndexedDBAdapter] Failed to compress/save item: ${t}`,n),n}}async removeItem(t){return Np(t)}async clear(){return Gp()}async getKeys(){return zp()}}class Du{constructor(){this.userId=null,this.deviceId=null,this.sessionId=null,this.storageKey="cine_user_uuid",this.deviceStorageKey="cine_device_uuid"}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})}init(){if(this.userId&&this.deviceId&&this.sessionId)return this.userId;let t=localStorage.getItem(this.storageKey);t?console.log("[UserContext] Loaded User UUID:",t):(t=this.generateUUID(),localStorage.setItem(this.storageKey,t),console.log("[UserContext] Generated new User UUID:",t)),this.userId=t;let r=localStorage.getItem(this.deviceStorageKey);return r||(r=this.generateUUID(),localStorage.setItem(this.deviceStorageKey,r),console.log("[UserContext] Generated new Device UUID:",r)),this.deviceId=r,this.sessionId=this.generateUUID(),console.log("[UserContext] Session UUID:",this.sessionId),t}getUserId(){return this.userId?this.userId:this.init()}getDeviceId(){return this.deviceId||this.init(),this.deviceId}getSessionId(){return this.sessionId||this.init(),this.sessionId}getScopedKey(t){return`user_${this.getUserId()}_${t}`}getIdentity(){return{userId:this.getUserId(),deviceId:this.getDeviceId(),sessionId:this.getSessionId()}}reset(){localStorage.removeItem(this.storageKey),this.userId=null,this.sessionId=null}}const ze=new Du,ng=Object.freeze(Object.defineProperty({__proto__:null,UserContext:Du,userContext:ze},Symbol.toStringTag,{value:"Module"})),Uu=1,rn=Object.freeze({SYNCED:"synced",PENDING:"pending",CONFLICT:"conflict",SYNCING:"syncing",LOCAL_ONLY:"local_only"}),Ue=Object.freeze({UNLOCKED:"unlocked",LOCKED_BY_SELF:"locked_by_self",LOCKED_BY_OTHER_TAB:"locked_by_other_tab",LOCKED_BY_OTHER_DEVICE:"locked_by_other_device"});function Ha(){return new Date().toISOString()}function og(e="doc"){const t=Date.now().toString(36),r=Math.random().toString(36).substring(2,10);return`${e}_${t}_${r}`}function Ku(e={}){const t=ze.getIdentity(),r=Ha();return{version:Uu,docId:e.docId||og(e.docType||"doc"),docType:e.docType||"unknown",ownerId:t.userId,createdAt:r,updatedAt:r,syncStatus:rn.LOCAL_ONLY,syncedAt:null,syncError:null,changeCount:1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId,lock:null,sharedWith:[],permissions:{}}}function ig(e){if(!e||typeof e!="object")return Ku();const t=ze.getIdentity(),r=Ha();return{...e,version:Uu,updatedAt:r,syncStatus:e.syncStatus===rn.SYNCED?rn.PENDING:e.syncStatus,changeCount:(e.changeCount||0)+1,lastChangeBy:t.userId,lastChangeDevice:t.deviceId,lastChangeSession:t.sessionId}}function sg(e,t=null){return!e||typeof e!="object"?(console.warn("[SyncMetadata] Cannot mark null metadata as synced"),e):{...e,syncStatus:rn.SYNCED,syncedAt:t||Ha(),syncError:null}}function ag(e,t){return!e||typeof e!="object"?e:{...e,syncStatus:rn.CONFLICT,syncError:t}}function cg(e,t=null,r={}){return{_meta:t?ig(t):Ku(r),data:e}}function lg(e){return!e||typeof e!="object"?{data:e,meta:null}:e._meta&&"data"in e?{data:e.data,meta:e._meta}:{data:e,meta:null}}function Zo(e){return e&&typeof e=="object"&&"_meta"in e&&"data"in e}const ug="cine-project-locks",fg=5e3,pg=3e4,js="cine_project_lock_",hr=Object.freeze({LOCK_ACQUIRED:"lock_acquired",LOCK_RELEASED:"lock_released",LOCK_HEARTBEAT:"lock_heartbeat",LOCK_TAKEOVER:"lock_takeover",LOCK_QUERY:"lock_query",LOCK_STATUS:"lock_status"});class dg{constructor(){this.channel=null,this.localLocks=new Map,this.heartbeatIntervals=new Map,this.lockChangeListeners=new Set,this.initialized=!1}init(){if(!this.initialized){if(ze.init(),typeof BroadcastChannel<"u")try{this.channel=new BroadcastChannel(ug),this.channel.onmessage=t=>this._handleChannelMessage(t),console.log("[ProjectLockService] BroadcastChannel initialized")}catch(t){console.warn("[ProjectLockService] BroadcastChannel not available:",t)}this._restoreLocksFromStorage(),typeof window<"u"&&(window.addEventListener("beforeunload",()=>this._handlePageUnload()),window.addEventListener("pagehide",()=>this._handlePageUnload())),this.initialized=!0,console.log("[ProjectLockService] Initialized")}}async acquireLock(t,r={}){this.init();const n=this._getStoredLock(t),o=this._getLockStatusForLock(n);if(o===Ue.LOCKED_BY_SELF)return{success:!0,status:o,lock:n};if(o!==Ue.UNLOCKED&&!r.force)return{success:!1,status:o,lock:n};r.force&&n&&this._broadcastTakeover(t,n);const i=this._createLockObject(t);return this._storeLock(t,i),this.localLocks.set(t,i),this._startHeartbeat(t),this._broadcastLockAcquired(t,i),this._notifyListeners(t,Ue.LOCKED_BY_SELF,i),console.log("[ProjectLockService] Lock acquired:",t),{success:!0,status:Ue.LOCKED_BY_SELF,lock:i}}async releaseLock(t){this.init();const r=this._getStoredLock(t);return this._getLockStatusForLock(r)!==Ue.LOCKED_BY_SELF?(console.warn("[ProjectLockService] Cannot release lock not owned by this session"),!1):(this._stopHeartbeat(t),this._clearStoredLock(t),this.localLocks.delete(t),this._broadcastLockReleased(t),this._notifyListeners(t,Ue.UNLOCKED,null),console.log("[ProjectLockService] Lock released:",t),!0)}getLockInfo(t){this.init();const r=this._getStoredLock(t),n=this._getLockStatusForLock(r);return{status:n,lock:r,isEditable:n===Ue.UNLOCKED||n===Ue.LOCKED_BY_SELF}}subscribe(t){return this.lockChangeListeners.add(t),()=>this.lockChangeListeners.delete(t)}refreshHeartbeat(t){const r=this.localLocks.get(t);if(!r)return;const n=ze.getIdentity();if(r.sessionId!==n.sessionId){this._stopHeartbeat(t);return}r.heartbeat=new Date().toISOString(),this._storeLock(t,r),this._broadcastHeartbeat(t,r)}_createLockObject(t){const r=ze.getIdentity(),n=new Date().toISOString();return{projectId:t,userId:r.userId,deviceId:r.deviceId,sessionId:r.sessionId,acquiredAt:n,heartbeat:n}}_getStorageKey(t){return js+t}_storeLock(t,r){try{localStorage.setItem(this._getStorageKey(t),JSON.stringify(r))}catch(n){console.warn("[ProjectLockService] Failed to store lock:",n)}}_getStoredLock(t){try{const r=localStorage.getItem(this._getStorageKey(t));if(!r)return null;const n=JSON.parse(r);return this._isLockExpired(n)?(this._clearStoredLock(t),null):n}catch(r){return console.warn("[ProjectLockService] Failed to read lock:",r),null}}_clearStoredLock(t){try{localStorage.removeItem(this._getStorageKey(t))}catch(r){console.warn("[ProjectLockService] Failed to clear lock:",r)}}_isLockExpired(t){return!t||!t.heartbeat?!0:Date.now()-new Date(t.heartbeat).getTime()>pg}_getLockStatusForLock(t){if(!t||this._isLockExpired(t))return Ue.UNLOCKED;const r=ze.getIdentity();return t.sessionId===r.sessionId?Ue.LOCKED_BY_SELF:t.deviceId===r.deviceId?Ue.LOCKED_BY_OTHER_TAB:Ue.LOCKED_BY_OTHER_DEVICE}_startHeartbeat(t){this._stopHeartbeat(t);const r=setInterval(()=>{this.refreshHeartbeat(t)},fg);this.heartbeatIntervals.set(t,r)}_stopHeartbeat(t){const r=this.heartbeatIntervals.get(t);r&&(clearInterval(r),this.heartbeatIntervals.delete(t))}_restoreLocksFromStorage(){const t=ze.getIdentity();try{for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(!n||!n.startsWith(js))continue;const o=n.slice(js.length),i=this._getStoredLock(o);i&&i.sessionId===t.sessionId&&(this.localLocks.set(o,i),this._startHeartbeat(o),console.log("[ProjectLockService] Restored lock:",o))}}catch(r){console.warn("[ProjectLockService] Failed to restore locks:",r)}}_handlePageUnload(){for(const t of this.localLocks.keys())this._stopHeartbeat(t),this._clearStoredLock(t),this._broadcastLockReleased(t);this.localLocks.clear()}_notifyListeners(t,r,n){for(const o of this.lockChangeListeners)try{o(t,r,n)}catch(i){console.warn("[ProjectLockService] Listener error:",i)}}_broadcast(t,r){if(this.channel)try{this.channel.postMessage({type:t,...r})}catch(n){console.warn("[ProjectLockService] Broadcast failed:",n)}}_broadcastLockAcquired(t,r){this._broadcast(hr.LOCK_ACQUIRED,{projectId:t,lock:r})}_broadcastLockReleased(t){this._broadcast(hr.LOCK_RELEASED,{projectId:t})}_broadcastHeartbeat(t,r){this._broadcast(hr.LOCK_HEARTBEAT,{projectId:t,lock:r})}_broadcastTakeover(t,r){this._broadcast(hr.LOCK_TAKEOVER,{projectId:t,oldLock:r})}_handleChannelMessage(t){const{type:r,projectId:n,lock:o,oldLock:i}=t.data||{};if(!n)return;const s=ze.getIdentity();switch(r){case hr.LOCK_ACQUIRED:o&&o.sessionId!==s.sessionId&&this._notifyListeners(n,this._getLockStatusForLock(o),o);break;case hr.LOCK_RELEASED:this._notifyListeners(n,Ue.UNLOCKED,null);break;case hr.LOCK_TAKEOVER:i&&i.sessionId===s.sessionId&&(console.warn("[ProjectLockService] Lock taken over by another tab:",n),this._stopHeartbeat(n),this.localLocks.delete(n),this._notifyListeners(n,Ue.LOCKED_BY_OTHER_TAB,null));break;case hr.LOCK_HEARTBEAT:o&&o.sessionId!==s.sessionId&&this._storeLock(n,o);break}}destroy(){for(const t of this.heartbeatIntervals.keys())this._stopHeartbeat(t);this.channel&&(this.channel.close(),this.channel=null),this.localLocks.clear(),this.lockChangeListeners.clear(),this.initialized=!1}}const un=new dg,Zn="cine_project:";class yg{constructor(){this.driver=new zi,this.initialized=!1}async init(){this.initialized||(await this.driver.init(),console.log("[StorageRepository] Initialized with default driver:",this.driver.constructor.name),this.initialized=!0,un.init())}async switchDriver(t){console.log("[StorageRepository] Switching driver to:",t.constructor.name),await t.init(),this.driver=t}async getItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.getItem(r)}async setItem(t,r){this.initialized||await this.init();const n=ze.getScopedKey(t);return this.driver.setItem(n,r)}async removeItem(t){this.initialized||await this.init();const r=ze.getScopedKey(t);return this.driver.removeItem(r)}async clear(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`,n=t.filter(o=>o.startsWith(r)).map(o=>this.driver.removeItem(o));await Promise.all(n)}async getKeys(){this.initialized||await this.init();const t=await this.driver.getKeys(),r=`user_${ze.getUserId()}_`;return t.filter(n=>n.startsWith(r)).map(n=>n.slice(r.length))}getProjectKeyPrefix(){return Zn}getProjectStorageKey(t){return`${Zn}${t}`}getProjectKeyFromStorageKey(t){return typeof t!="string"||!t.startsWith(Zn)?t:t.slice(Zn.length)}isProjectStorageKey(t){return typeof t=="string"&&t.startsWith(Zn)}async getProjectKeys(){return(await this.getKeys()).filter(r=>this.isProjectStorageKey(r)).map(r=>this.getProjectKeyFromStorageKey(r))}async loadProject(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return lg(n)}async loadProjectRaw(t){return(await this.loadProject(t)).data}async saveProject(t,r,n=null){this.initialized||await this.init();const o=un.getLockInfo(t);if(!o.isEditable)return console.warn("[StorageRepository] Cannot save - project is locked by another session"),{success:!1,error:"PROJECT_LOCKED",lockInfo:o};const i=cg(r,n,{docType:"project",docId:t}),s=this.getProjectStorageKey(t);return await this.setItem(s,i),Ll(async()=>{const{dataVault:a}=await Promise.resolve().then(()=>bg);return{dataVault:a}},void 0).then(({dataVault:a})=>{a&&a.saveSnapshot(t,i).catch(c=>console.warn("Auto-backup failed",c))}),console.log("[StorageRepository] Project saved with metadata:",t),{success:!0,meta:i._meta}}async getProjectMeta(t){const r=this.getProjectStorageKey(t),n=await this.getItem(r);return Zo(n)?n._meta:null}async markProjectSynced(t,r=null){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return Zo(o)?(o._meta=sg(o._meta,r),await this.setItem(n,o),!0):(console.warn("[StorageRepository] Cannot mark as synced - no metadata"),!1)}async markProjectConflict(t,r){const n=this.getProjectStorageKey(t),o=await this.getItem(n);return Zo(o)?(o._meta=ag(o._meta,r),await this.setItem(n,o),!0):!1}async getPendingSyncProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const o=await this.getProjectMeta(n);o&&(o.syncStatus===rn.PENDING||o.syncStatus===rn.LOCAL_ONLY)&&r.push({key:n,meta:o})}return r}async listProjects(){const t=await this.getProjectKeys(),r=[];for(const n of t){const{data:o,meta:i}=await this.loadProject(n);i&&i.docType==="project"&&r.push({key:n,data:o,meta:i})}return r}async acquireProjectLock(t,r={}){return this.initialized||await this.init(),un.acquireLock(t,r)}async releaseProjectLock(t){return un.releaseLock(t)}getProjectLockInfo(t){return un.getLockInfo(t)}onLockChange(t){return un.subscribe(t)}async removeProject(t){const r=this.getProjectStorageKey(t);return this.removeItem(r)}async migrateUnprefixedProjectRecords({projectIndexKeys:t=[]}={}){this.initialized||await this.init();const r=await this.getKeys(),n=new Set(r.filter(a=>this.isProjectStorageKey(a))),o=new Set;(Array.isArray(t)?t:[]).forEach(a=>{const c=this.getProjectKeyFromStorageKey(a);typeof c=="string"&&c&&o.add(c)});for(const a of r){if(this.isProjectStorageKey(a)||o.has(a))continue;const c=await this.getItem(a);Zo(c)&&c._meta&&c._meta.docType==="project"&&o.add(a)}const s=[];for(const a of o){if(typeof a!="string"||!a)continue;const c=this.getProjectStorageKey(a);if(n.has(c))continue;const l=await this.getItem(a);if(l!=null)try{await this.setItem(c,l),await this.removeItem(a),n.add(c),s.push(a)}catch(f){console.warn(`[StorageRepository] Failed to migrate project key "${a}"`,f)}}return{migratedKeys:s}}}const C=new yg;class gg extends Fu{constructor(){super();try{this.storage=window.localStorage}catch(t){console.warn("[LocalStorageAdapter] Unable to access window.localStorage.",t),this.storage=null}}async init(){if(!this.storage)throw new Error("LocalStorage is unavailable. Access to window.localStorage failed or is blocked.");return Promise.resolve()}async getItem(t){try{const r=this.storage.getItem(t);if(r===null)return null;try{return JSON.parse(r)}catch{return r}}catch(r){return console.warn(`[LocalStorageAdapter] Failed to get item: ${t}`,r),null}}async setItem(t,r){try{const n=typeof r=="string"?r:JSON.stringify(r);this.storage.setItem(t,n)}catch(n){throw console.error(`[LocalStorageAdapter] Failed to save item: ${t}`,n),n}}async removeItem(t){try{this.storage.removeItem(t)}catch(r){console.warn(`[LocalStorageAdapter] Failed to remove item: ${t}`,r)}}async clear(){try{this.storage.clear()}catch(t){console.warn("[LocalStorageAdapter] Failed to clear storage",t)}}async getKeys(){const t=[];for(let r=0;r<this.storage.length;r+=1){const n=this.storage.key(r);n!==null&&t.push(n)}return t}}const eo="cine_storage_migrated_v2";class mg{constructor(){this.localStorage=new gg,this.indexedDB=new zi}async runMigrationIfNeeded(){try{if(await this.localStorage.init(),await this.indexedDB.init(),await this.localStorage.getItem(eo)==="true")return console.log("[MigrationService] Storage already migrated to IndexedDB."),!1;console.log("[MigrationService] Starting storage migration...");const r=await this.localStorage.getKeys();if(r.length===0)return console.log("[MigrationService] No local storage data found. safe to skip."),await this.markAsMigrated(),!1;const n=r.filter(i=>i!==eo&&i!=="cine_user_uuid");let o;try{o=await this.loadUserContext()}catch(i){return console.error("[MigrationService] Failed to load UserContext for scoping. Aborting migration to prevent data loss.",i),!1}for(const i of n)try{const s=await this.localStorage.getItem(i);if(s!==null){const a=o.getScopedKey(i);await this.indexedDB.setItem(a,s),console.log(`[MigrationService] Migrated key: ${i} -> ${a}`)}}catch(s){console.error(`[MigrationService] Failed to migrate key: ${i}`,s)}return await this.markAsMigrated(),console.log("[MigrationService] Migration complete. IndexedDB is now the primary storage."),!0}catch(t){return console.error("[MigrationService] Critical migration failure:",t),!1}}async markAsMigrated(){const t=async(r,n)=>{try{await r.setItem(eo,"true")}catch(o){console.warn(`[MigrationService] Failed to set migration flag in ${n}:`,o)}};await Promise.all([t(this.localStorage,"LocalStorage"),t(this.indexedDB,"IndexedDB")])}async loadUserContext(){const r=(await Ll(()=>Promise.resolve().then(()=>ng),void 0)).userContext;if(!r)throw new Error("UserContext module loaded but userContext export is missing");return r.init(),r}async isMigrated(){try{return await this.localStorage.getItem(eo)==="true"?!0:await this.indexedDB.getItem(eo)==="true"}catch(t){return console.warn("[MigrationService] Failed to check migration status:",t),!1}}}const Yt=new mg,Dc="cameraPowerPlanner_ownGear";class hg{constructor(){this.memoryCache=null}async getOwnGear(){if(this.memoryCache)return this.memoryCache;try{const t=await C.getItem(Dc);if(!t)return[];Array.isArray(t)?this.memoryCache=t:t.items&&Array.isArray(t.items)?this.memoryCache=t.items:this.memoryCache=[]}catch(t){console.warn("[GearRepository] Failed to load own gear:",t),this.memoryCache=[]}return this.memoryCache}async saveOwnGear(t){if(!Array.isArray(t)){console.error("[GearRepository] saveOwnGear expects an array");return}this.memoryCache=t,await C.setItem(Dc,t)}async addOwnGearItem(t){const r=await this.getOwnGear();r.push(t),await this.saveOwnGear(r)}getLibrary(){return typeof window<"u"&&window.deviceLibrary?window.deviceLibrary:typeof globalThis<"u"&&globalThis.deviceLibrary?globalThis.deviceLibrary:{}}async searchGear(t){if(!t)return[];const r=t.toLowerCase();return(await this.getOwnGear()).filter(i=>i.name&&i.name.toLowerCase().includes(r)||i.brand&&i.brand.toLowerCase().includes(r))}}const $u=new hg;class Vu{constructor(){this.root=null,this.initialized=!1}async init(){if(!this.initialized)try{if(!navigator.storage||!navigator.storage.getDirectory){console.warn("[DataVault] OPFS is not supported in this browser.");return}this.root=await navigator.storage.getDirectory(),this.initialized=!0}catch(t){console.error("[DataVault] Failed to initialize OPFS:",t)}}async saveSnapshot(t,r){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const n=t.replace(/[^a-z0-9_\-\.\s]/gi,"_"),i=await(await this.root.getFileHandle(n+".json",{create:!0})).createWritable();return await i.write(JSON.stringify(r)),await i.close(),console.log(`[DataVault] Saved snapshot: ${t}`),!0}catch(n){throw console.error(`[DataVault] Failed to save snapshot ${t}:`,n),n}}async listSnapshots(){if(this.initialized||await this.init(),!this.root)return[];const t=[];try{for await(const[r,n]of this.root.entries())n.kind==="file"&&r.endsWith(".json")&&t.push(r)}catch(r){console.error("[DataVault] Failed to list snapshots:",r)}return t.sort().reverse()}async restoreSnapshot(t){if(this.initialized||await this.init(),!this.root)throw new Error("OPFS not available");try{const o=await(await(await this.root.getFileHandle(t)).getFile()).text();return JSON.parse(o)}catch(r){throw console.error(`[DataVault] Failed to restore snapshot ${t}:`,r),r}}async deleteSnapshot(t){if(this.initialized||await this.init(),!!this.root)try{await this.root.removeEntry(t),console.log(`[DataVault] Deleted snapshot: ${t}`)}catch(r){console.warn(`[DataVault] Failed to delete snapshot ${t}:`,r)}}async clear(){if(this.initialized||await this.init(),!!this.root)try{const t=await this.listSnapshots();for(const r of t)await this.root.removeEntry(r);console.log("[DataVault] All data wiped.")}catch(t){console.error("[DataVault] Failed to wipe vault:",t)}}}const Ys=new Vu,bg=Object.freeze(Object.defineProperty({__proto__:null,DataVault:Vu,dataVault:Ys},Symbol.toStringTag,{value:"Module"}));var fo={};console.log("DEBUG: storage.js execution started");let Ve={},ur=!1;async function Hu(){if(!ur){console.log("[storage.js] Hydrating project cache from storage...");try{const e=C&&typeof C.getProjectKeys=="function"?await C.getProjectKeys():[],t="cameraPowerPlanner_project";let r=null;const n=e.slice();if(C&&typeof C.getItem=="function"){const i=await C.getItem(Nn),s=uc(i);s&&(Fn=s),C.getItem(Ut).then(a=>{a&&(Ji=a)}),C.getItem(Ot).then(a=>{a&&(wo=a)}),C.getItem(Qe).then(a=>{a&&(Eo=a)}),C.getItem(ut).then(a=>{Array.isArray(a)&&(Sn=a)}),C.getItem(Kt).then(a=>{a&&(Qi=a)}),C.getItem(pr).then(a=>{a&&(Xi=a)}),C.getItem(tr).then(a=>{a&&(Ro=a)}),C.getItem(rt).then(a=>{a&&(To=a)}),C.getItem(zt).then(a=>{a&&(Mo=a)}),C.getItem(Re).then(a=>{a&&(No=a)}),C.getItem(tt).then(a=>{a&&(Go=a)}),C.getItem(Gt).then(a=>{a&&(Dn=a)}),C.getItem(ct).then(a=>{a&&(zo=a)}),C.getItem(et).then(a=>{a&&(Bo=a)}),C.getItem(lt).then(a=>{a&&(xo=a)}),C.getItem(Je).then(a=>{a&&(Hr=a)}),C.getItem(Ft()).then(a=>{a&&(Fo=a)}),C.getItem(Fe).then(a=>{a&&(or=a)}),r=await C.getItem(t)}if(r&&typeof r=="object")try{Object.assign(Ve,r)}catch(i){console.warn("[hydrate] Failed to load monolith",i)}const o=n.map(async i=>{try{const s=await C.loadProjectRaw(i);s&&(Ve[i]=s)}catch(s){console.warn("[hydrate] Failed to load shard",i,s)}});await Promise.all(o),ur=!0,console.log("[storage.js] Project cache hydrated. Keys:",Object.keys(Ve).length)}catch(e){console.warn("Cache hydration failed",e)}}}const h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:null,Sg=typeof process<"u"&&process&&fo&&(fo.JEST_WORKER_ID||fo.CINE_FORCE_STORAGE_REINIT),At="cine_factory_reset_lock";if(h&&h.__cineStorageInitialized)if(Sg){try{delete h.__cineStorageInitialized}catch{h.__cineStorageInitialized=!1}try{delete h.__cineStorageApi}catch{h.__cineStorageApi=null}try{delete h.__cineMonolithicProjectCleanupDone}catch{h.__cineMonolithicProjectCleanupDone=!1}}else typeof module<"u"&&module.exports&&h.__cineStorageApi&&typeof h.__cineStorageApi=="object"&&(module.exports=h.__cineStorageApi);const wg="cine-power-planner-lifecycle";let ve=null;const Eg=typeof process<"u"&&process&&fo&&fo.JEST_WORKER_ID;if(typeof BroadcastChannel<"u"&&!Eg)try{ve=new BroadcastChannel(wg),ve&&(ve.onmessage=e=>{if(e&&e.data==="factory-reset"){if(h){h.__cameraPowerPlannerFactoryResetting=!0;try{typeof sessionStorage<"u"&&sessionStorage.setItem(At,"true"),typeof localStorage<"u"&&localStorage.setItem(At,"true")}catch(t){}if(typeof sessionStorage<"u"&&typeof sessionStorage.clear=="function")try{const t=sessionStorage.getItem(At);sessionStorage.clear(),t&&sessionStorage.setItem(At,t)}catch(t){}typeof h.location<"u"&&typeof h.location.reload=="function"&&h.location.reload()}}else e.data==="project-shards-changed"&&fr()})}catch{}if(h)try{const e=[typeof window<"u"?window:null,typeof sessionStorage<"u"?sessionStorage:null,typeof localStorage<"u"?localStorage:null];let t=!1;e.forEach(r=>{if(r&&typeof r.getItem=="function")try{r.getItem(At)&&(t=!0)}catch(n){}}),t&&(h.__cineJustFactoryReset=!0),e.forEach(r=>{if(r&&typeof r.removeItem=="function")try{r.removeItem(At)}catch(n){}}),Object.defineProperty(h,"__cineStorageInitialized",{configurable:!0,writable:!0,value:!0}),(async()=>{try{let r=!1;if(Yt&&typeof Yt.runMigrationIfNeeded=="function"){const o=await Yt.runMigrationIfNeeded(),i=await Yt.isMigrated();(o||i)&&(console.log(o?"[storage.js] Migration successful. Switching to IndexedDB.":"[storage.js] Native IndexedDB mode active."),await C.switchDriver(new zi),r=!0)}else if(Yt&&typeof Yt.init=="function"){const o=await Yt.init();let i=!1;typeof Yt.isMigrated=="function"&&(i=await Yt.isMigrated()),(o||i)&&(await C.switchDriver(new zi),r=!0)}const n=await Th();if(r&&(await Hu(),(!n.hasIndex||!Fn)&&ur&&Ve&&Object.keys(Ve).length>0))try{Io(Ve,T())}catch(o){console.warn("Failed to refresh project index after migration",o)}}catch(r){console.warn("[storage.js] Migration service failed:",r)}})()}catch{h.__cineStorageInitialized=!0}function Ag(){if(ve){try{ve.close()}catch{}ve=null}}typeof module<"u"&&module.exports&&(module.exports.closeStorageLifecycle=Ag,module.exports.hydrateProjectCache=Hu,module.exports.__resetProjectMemoryCache=()=>{Ve={},ur=!1});function Js(e,t){if(e===null||typeof e!="object")return e;let r=t;if(r||(r=typeof WeakMap=="function"?new WeakMap:[]),typeof r.has=="function"&&typeof r.get=="function"){if(r.has(e))return r.get(e)}else if(Array.isArray(r))for(let i=0;i<r.length;i+=1){const s=r[i];if(s&&s[0]===e)return s[1]}if(Object.prototype.toString.call(e)==="[object Date]"){let i;try{const s=typeof e.getTime=="function"?e.getTime():e.valueOf();i=new Date(s)}catch{i=new Date(e)}return typeof r.set=="function"?r.set(e,i):Array.isArray(r)&&r.push([e,i]),i}const o=Array.isArray(e)?[]:{};if(typeof r.set=="function"?r.set(e,o):Array.isArray(r)&&r.push([e,o]),Array.isArray(e))for(let i=0;i<e.length;i+=1)o[i]=Js(e[i],r);else{const i=Object.keys(e);for(let s=0;s<i.length;s+=1){const a=i[s];o[a]=Js(e[a],r)}}return o}function zr(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{}return Js(e,null)}function Og(e){if(typeof structuredClone=="function")return structuredClone;if(e&&typeof e.structuredClone=="function")try{return e.structuredClone.bind(e)}catch{}return null}function Cg(e){const t=Og(e);return t?function(n){if(n===null||typeof n!="object")return n;try{return t(n)}catch{}return zr(n)}:zr}const gr=h&&typeof h.__cineDeepClone=="function"?h.__cineDeepClone:Cg(h),On=typeof WeakSet=="function"?new WeakSet:null;function Jr(e){if(!(!On||typeof On.add!="function"||!e))try{On.add(e)}catch{}}function qa(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.sessionStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}(function(){const t=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=qa(t[r]);n&&Jr(n)}if(typeof sessionStorage<"u")try{Jr(sessionStorage)}catch{}})();function Pg(e){if(!e||typeof e!="object"&&typeof e!="function")return null;try{const t=e.localStorage;if(t&&typeof t.getItem=="function")return t}catch{}return null}function qu(){const e=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof globalThis<"u"?globalThis:null,typeof self<"u"?self:null,typeof global<"u"?global:null],t=[],r=typeof WeakSet=="function"?new WeakSet:null;for(let n=0;n<e.length;n+=1){const o=Pg(e[n]);if(o){if(r)try{if(r.has(o))continue;r.add(o)}catch{}else if(t.indexOf(o)!==-1)continue;t.push(o)}}return t}if(h&&typeof h.__cineDeepClone!="function")try{h.__cineDeepClone=gr}catch{}function Wu(){const e=r=>{if(!r||typeof r!="object"&&typeof r!="function")return!1;try{return r.__cameraPowerPlannerFactoryResetting===!0}catch{return!1}};if(e(h))return!0;const t=[typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&n!==h&&e(n))return!0}try{if(typeof sessionStorage<"u"&&sessionStorage.getItem(At)||typeof localStorage<"u"&&localStorage.getItem(At))return!0}catch{}return!1}var Ze="cameraPowerPlanner_devices",ei=null,pt="cameraPowerPlanner_setups",er="cameraPowerPlanner_session",Mr="cameraPowerPlanner_feedback",pe="cameraPowerPlanner_project",Wa="cameraPowerPlanner_project_rev",et="cameraPowerPlanner_favorites",tt="cameraPowerPlanner_contacts",Gt="cameraPowerPlanner_ownGear",ct="cameraPowerPlanner_userProfile",Lr="cameraPowerPlanner_documentationTracker",dt="cameraPowerPlanner_schemaCache",Yu="cinePowerPlanner_schemaCache",tr="cameraPowerPlanner_customFonts",di="cameraPowerPlanner_mountVoltages",zt="cameraPowerPlanner_cameraColors",Re="cineRentalPrintSections",Nn="cameraPowerPlanner_projectIndex",po=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.mountVoltageKey"):null,st=null,kr=typeof Symbol=="function"?Symbol.for("cinePowerPlanner.storageCache"):"__cineStorageStateCache",Bt="cameraPowerPlanner_prj_",hn=typeof WeakMap=="function"&&typeof Map=="function"?new WeakMap:null,vt=null,Uc=!1,Qr=typeof Map=="function"?new Map:null,to=[],_g=6,Ju=typeof Object.freeze=="function"?Object.freeze({__cineCompressionMiss:!0}):{__cineCompressionMiss:!0},Kc=Zu(8),$c=Zu(6),Ct=typeof Map=="function"?new Map:null,vr=[],kg=16;function Bi(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.slice();for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n],i=e[o];t[o]=Array.isArray(i)?i.slice():i}return t}function Qu(e){if(!Ct||typeof e!="string"||!e)return null;var t;try{t=Ct.get(e)}catch{t=null}return!t||!t.payload?null:{payload:Bi(t.payload),compression:t.compression?Bi(t.compression):null}}function yi(e,t,r){if(!(!Ct||typeof e!="string"||!e||!zn(t))){var n={payload:Bi(t),compression:r?Bi(r):null};try{Ct.set(e,n)}catch{return}var o=vr.indexOf(e);for(o!==-1&&vr.splice(o,1),vr.push(e);vr.length>kg;){var i=vr.shift();if(!(!i||i===e))try{Ct.delete(i)}catch{}}}}function vg(){if(Ct&&typeof Ct.clear=="function")try{Ct.clear()}catch{}vr.length=0}var Qs=Number.POSITIVE_INFINITY,Xs=8,Xu=60*1e3,ao={entries:Object.create(null),totalWarnings:0,suppressionNoticeShown:!1},bt=null,br=null,fn=null,Vc=!1;xy&&typeof Ni=="function"&&(bt=Ni);var rr="",xt=!1;!bt&&h&&typeof h.__cineEnsureConsoleMethodsWritable=="function"&&(bt=h.__cineEnsureConsoleMethodsWritable);typeof bt=="function"&&bt(["warn","info"]);function jg(){var e=[],t=function(n){!n||typeof n!="object"&&typeof n!="function"||e.indexOf(n)===-1&&e.push(n)};return t(h),t(typeof globalThis<"u"?globalThis:null),t(typeof window<"u"?window:null),t(typeof self<"u"?self:null),t(typeof global<"u"?global:null),e}function Ig(){if(br)return br;if(Yr&&typeof Yr.resolveLogger=="function")return br=Yr,br;for(var e=jg(),t=0;t<e.length;t+=1){var r=e[t];if(!(!r||typeof r!="object"&&typeof r!="function"))try{var n=r.cineLoggingResolver;if(n&&typeof n.resolveLogger=="function")return br=n,br}catch{}}return br=null,br}function Lg(){if(fn||Vc)return fn;Vc=!0;var e=Ig();if(e&&typeof e.resolveLogger=="function")try{var t=e.resolveLogger("storage",{meta:{source:"storage-module"}});if(t)return fn=t,fn}catch{}return fn=null,fn}function gn(e){if(!e)return null;if(typeof e=="string")return{message:e};var t={};if(typeof e.name=="string"&&e.name&&(t.name=e.name),typeof e.message=="string"&&e.message&&(t.message=e.message),typeof e.stack=="string"&&e.stack&&(t.stack=e.stack),!Object.keys(t).length)try{t.message=String(e)}catch{return null}return t}function Cr(e){if(e&&typeof D<"u"&&D&&D.storage===e)return D&&typeof D.type=="string"?D.type:"unknown";if(e&&h){try{if(h.localStorage&&e===h.localStorage)return"local"}catch{}try{if(h.sessionStorage&&e===h.sessionStorage)return"session"}catch{}}return typeof D<"u"&&D&&typeof D.type=="string"?D.type:"unknown"}function Pr(e,t,r,n,o){var i=typeof e=="string"&&e?e.toLowerCase():"info",s=typeof t=="string"&&t?t:"Storage event",a=Lg(),c=!1,l={module:"storage"};if(n&&typeof n=="object"){l={module:"storage"};for(var f=Object.keys(n),u=0;u<f.length;u+=1){var y=f[u];l[y]=n[y]}}if(a){if(typeof a[i]=="function")try{a[i](s,r,l),c=!0}catch{c=!1}else if(typeof a.log=="function")try{a.log(i,s,r,l),c=!0}catch{c=!1}}if(typeof o=="function"){try{o()}catch{}return c}if(typeof console>"u"||!console)return c;var p=null;if(i==="error"&&typeof console.error=="function"?p=console.error:i==="warn"&&typeof console.warn=="function"?p=console.warn:i==="info"&&typeof console.info=="function"?p=console.info:i==="debug"&&typeof console.debug=="function"?p=console.debug:typeof console.log=="function"&&(p=console.log),typeof p=="function")try{p.call(console,s,r||null)}catch{}return c}function Rg(){if(typeof Date>"u")return null;if(typeof Date.now=="function")return Date.now();try{return new Date().getTime()}catch{}return null}function us(e,t,r,n,o){var i=typeof e=="string"&&e?e:"generic",s=null;if(typeof t=="string"&&t)s=t;else if(t!=null)try{s=String(t)}catch{s=null}var a={event:"compression-savings",kind:i,key:s,storageType:Cr()};typeof n=="number"&&Number.isFinite(n)&&(a.savings=n),typeof o=="number"&&Number.isFinite(o)&&(a.percent=o);var c=function(){if(!(typeof console>"u")){var f=ao,u=f.entries[i],y=Rg();if(u||(u={kind:i,occurrences:0,totalSavings:0,lastPercent:null,lastKey:null,uniqueKeys:Object.create(null),uniqueKeyCount:0,firstLoggedAt:y,lastLoggedAt:y,lastSummaryAt:null,suppressedTotal:0,suppressedSinceSummary:0},f.entries[i]=u),u.occurrences+=1,u.lastLoggedAt=y,s&&(u.lastKey=s,u.uniqueKeys[s]||(u.uniqueKeys[s]=!0,u.uniqueKeyCount+=1)),typeof n=="number"&&Number.isFinite(n)&&(u.totalSavings+=n),typeof o=="number"&&Number.isFinite(o)&&(u.lastPercent=o),f.totalWarnings<Qs){typeof bt=="function"&&bt("warn"),typeof console.warn=="function"&&r&&console.warn(r),f.totalWarnings+=1;return}u.suppressedTotal+=1,u.suppressedSinceSummary+=1,!f.suppressionNoticeShown&&typeof console.info=="function"&&(typeof bt=="function"&&bt("info"),console.info("Additional storage compression warnings are being batched to keep diagnostics readable.",{limit:Qs,batchSize:Xs}),f.suppressionNoticeShown=!0);var p=!1;u.lastSummaryAt?(u.suppressedSinceSummary>=Xs||y!==null&&u.lastSummaryAt!==null&&u.suppressedSinceSummary>0&&y-u.lastSummaryAt>=Xu)&&(p=!0):p=!0,p&&typeof console.info=="function"&&(typeof bt=="function"&&bt("info"),console.info("Suppressed repeated storage compression warnings.",{kind:u.kind,mostRecentKey:u.lastKey,suppressedSinceSummary:u.suppressedSinceSummary,suppressedTotal:u.suppressedTotal,totalOccurrences:u.occurrences,totalSavings:u.totalSavings,lastPercent:u.lastPercent,uniqueKeys:u.uniqueKeyCount}),u.lastSummaryAt=y,u.suppressedSinceSummary=0)}};Pr("info",r,a,{event:"compression-savings",kind:i},c)}function Tg(){for(var e={},t=Object.keys(ao.entries),r=0;r<t.length;r+=1){var n=t[r],o=ao.entries[n];o&&(e[n]={kind:o.kind,occurrences:o.occurrences,totalSavings:o.totalSavings,lastPercent:o.lastPercent,lastKey:o.lastKey,uniqueKeyCount:o.uniqueKeyCount,firstLoggedAt:o.firstLoggedAt,lastLoggedAt:o.lastLoggedAt,lastSummaryAt:o.lastSummaryAt,suppressedTotal:o.suppressedTotal})}return{limit:Qs,batchSize:Xs,summaryWindowMs:Xu,totalWarnings:ao.totalWarnings,suppressionNoticeShown:ao.suppressionNoticeShown,entries:e}}function Mg(e){if(!Array.isArray(e)||!e.length)return null;for(var t=[],r=0;r<e.length;r+=1){var n=e[r]||{},o=typeof n.variant=="string"?n.variant:"",i=typeof n.compress=="string"?n.compress:"",s=typeof n.decompress=="string"?n.decompress:"";t.push(o+":"+i+":"+s)}return t.join("|")}function Ng(e,t){if(!Qr||!e)return null;var r;try{r=Qr.get(e)}catch{r=null}return!r||r.lz!==t?null:!Array.isArray(r.strategies)||!r.strategies.length?Array.isArray(r.strategies)?[]:null:r.strategies.slice()}function Gg(e){if(!(!Qr||!e)){var t=to.indexOf(e);for(t!==-1&&to.splice(t,1),to.push(e);to.length>_g;){var r=to.shift();if(typeof Qr.delete=="function")try{Qr.delete(r)}catch{}}}}function zg(e,t,r){if(!(!Qr||!e)){var n={lz:t,strategies:Array.isArray(r)?r.slice():[]};try{Qr.set(e,n),Gg(e)}catch{}}}function Bg(){if(typeof JSON>"u"||!JSON||typeof JSON.stringify!="function")return 0;try{var e={[dr]:!0,version:xi,algorithm:vo,namespace:on,data:"",originalLength:0,compressedPayloadLength:0,compressionVariant:""},t=JSON.stringify(e);if(typeof t!="string"||!t)return 0;var r=JSON.stringify("").length;return r>0?t.length-r*2-String(0).length*2:0}catch{}return 0}function Zu(e){if(typeof Map!="function")return null;var t=Number(e);return t>0?{map:new Map,keys:[],limit:Math.floor(t)}:null}function ef(e){if(!e||typeof e!="object")return null;for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1)t[r[n]]=e[r[n]];return t}function tf(e,t){if(!(!e||!Array.isArray(e.keys))){var r=e.keys.indexOf(t);r!==-1&&e.keys.splice(r,1),e.keys.push(t)}}function rf(e,t){if(!e||!e.map||typeof e.map.get!="function")return{hit:!1};if(typeof t!="string"||!t)return{hit:!1};var r;try{r=e.map.get(t)}catch{return{hit:!1}}if(r===void 0)return{hit:!1};if(tf(e,t),r===Ju)return{hit:!0,candidate:null};var n=ef(r);return n?{hit:!0,candidate:n}:{hit:!0,candidate:null}}function nf(e,t,r){if(!(!e||!e.map||typeof e.map.set!="function")&&!(typeof t!="string"||!t)&&!(!e.limit||e.limit<=0)){var n=r&&typeof r=="object"?ef(r):Ju;try{e.map.set(t,n)}catch{return}for(tf(e,t);e.keys.length>e.limit;){var o=e.keys.shift();if(!(typeof o!="string"||o===t))try{e.map.delete(o)}catch{}}}}function Ya(e,t){if(!e||typeof e!="object"&&typeof e!="function")return null;let r=null;if(kr)try{r=e[kr]}catch{r=null}if(!r&&hn)try{r=hn.get(e)||null}catch{r=null}if(r||!t)return r||null;const n=new Map;let o=!1;if(kr)try{Object.defineProperty(e,kr,{configurable:!0,writable:!0,value:n}),o=!0}catch{try{e[kr]=n,o=!0}catch{o=!1}}if(!o&&hn)try{hn.set(e,n),o=!0}catch{o=!1}return o?n:null}function xg(e,t){const r=Ya(e,!1);return!r||typeof t!="string"||!t?null:r.get(t)||null}function Zt(e,t){const r=Ya(e,!1);if(!(!r||typeof t!="string"||!t)&&(typeof r.delete=="function"&&r.delete(t),r.size===0)){if(kr)try{e&&(typeof e=="object"||typeof e=="function")&&Object.prototype.hasOwnProperty.call(e,kr)&&delete e[kr]}catch{}if(hn)try{hn.delete(e)}catch{}}}function of(e){if(e===null||typeof e!="object")return e;try{return gr(e)}catch{}return e}function Is(e){if(!e)return;const{value:t}=e;return t===null||typeof t!="object"?t:of(t)}function Gn(e,t){const r=new Map;if(!e||typeof e.forEach!="function")return r;const{freezeArray:n=!1}=t||{};return e.forEach((o,i)=>{if(Array.isArray(o)){const s=o.slice();if(n)try{Object.freeze(s)}catch{}r.set(i,s)}else r.set(i,o)}),r}function Zs(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Gn(e.raw),normalized:Gn(e.normalized)}}function Fg(e){return!e||typeof e!="object"?{raw:new Map,normalized:new Map}:{raw:Gn(e.raw),normalized:Gn(e.normalized,{freezeArray:!0})}}function Dg(e){if(!E(e))return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n],i=e[o];if(i&&typeof i=="object")try{Object.freeze(i)}catch{}t[o]=i}try{Object.freeze(t)}catch{}return t}function Hc(e){if(!e||typeof e!="object"){st=null;return}st={projects:Dg(e.projects),changed:!!e.changed,originalValue:e.originalValue,lookup:Fg(e.lookup),rawValue:e.rawValue===void 0?void 0:e.rawValue}}function Ug(e){if(!st)return null;const t=T();let r=null;if(t&&typeof t.getItem=="function")try{r=t.getItem(pe)}catch{r=null}if(st.rawValue!==void 0&&st.rawValue!==r)return st=null,null;const{forMutation:n=!1}=e||{};return{projects:n?gr(st.projects):st.projects,changed:st.changed,originalValue:st.originalValue,lookup:Zs(st.lookup)}}function fr(){st=null}function Kg(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}return null}function $g(){return Wa}function sf(e){const t=e||T();if(!t||typeof t.getItem!="function")return null;const r=Me(t,Wa,"Error reading project storage revision from localStorage:",null,{validate:n=>n===null||typeof n=="number"||typeof n=="string"});return Kg(r)}function Ja(e){const t=e||T();if(!t||typeof t.setItem!="function")return null;const r=sf(t),n=Number.isFinite(r)?r+1:1;return Ae(t,Wa,n,"Error saving project storage revision to localStorage:",{disableCompression:!0,enableCompressionSweep:!1}),n}function Ke(e,t,r,n,o){if(typeof t!="string"||!t||!e||typeof e!="object"&&typeof e!="function")return;const i=Ya(e,!0);if(!i)return;const s=of(o),c={raw:typeof r=="string"&&r?r:null,normalizedRaw:typeof n=="string"&&n?n:typeof r=="string"&&r?r:null,value:s};i.set(t,c)}function Vg(e,t,r,n){const o=xg(e,t);if(!o)return{hit:!1};if(typeof n=="string"&&n&&o.raw&&o.raw===n)return{hit:!0,value:Is(o)};if(typeof r=="string"&&r){if(o.normalizedRaw&&o.normalizedRaw===r)return{hit:!0,value:Is(o)};if(o.raw&&o.raw===r)return{hit:!0,value:Is(o)}}return{hit:!1}}function Hg(e,t){if(!e||typeof e!="object")return"";var r;try{r=Object.getOwnPropertyDescriptor(e,t)}catch{r=null}if(r&&Object.prototype.hasOwnProperty.call(r,"value")&&typeof r.value=="string"&&r.value)return r.value;var n;try{n=e[t]}catch{n=""}if(typeof n=="string"&&n)return n;if(po)try{const o=e[po];if(typeof o=="string"&&o)return o}catch{}return""}function af(e,t,r){if(!e||typeof e!="object")return"";if(po)try{e[po]=r;const i=e[po];if(typeof i=="string"&&i)return i}catch{}var n;try{n=Object.getOwnPropertyDescriptor(e,t)}catch{n=null}if(n&&Object.prototype.hasOwnProperty.call(n,"value")&&typeof n.value=="string"&&n.value)return n.value;if(n&&n.configurable===!1&&n.writable===!1)return"";var o="";try{e[t]=r,o=e[t]}catch{o=""}return typeof o=="string"&&o?o:(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose mount voltage storage key globally. Using fallback only."),"")}function cf(){if(!h||typeof h!="object")return di;var e=Hg(h,"MOUNT_VOLTAGE_STORAGE_KEY");if(e)return e;var t=af(h,"MOUNT_VOLTAGE_STORAGE_KEY",di);return t||di}var gi=cf();function lf(){const e=cf();if(e&&e!==gi&&(gi=e,h&&af(h,"MOUNT_VOLTAGE_STORAGE_KEY",e),typeof Lt<"u"&&Lt&&typeof Lt.add=="function")){Lt.add(e);const t=_t(e);for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&Lt.add(n)}}return gi}function Ft(){return lf()}function uf(){const e=lf();return e?`${e}__backup`:`${di}__backup`}function ff(){if(!h)return tr;const e=typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:typeof h.CUSTOM_FONT_STORAGE_KEY=="string"?h.CUSTOM_FONT_STORAGE_KEY:tr;let t=e;return e==="cinePowerPlanner_customFonts"&&(t=tr),h.CUSTOM_FONT_STORAGE_KEY!==t&&(h.CUSTOM_FONT_STORAGE_KEY=t),h.CUSTOM_FONT_STORAGE_KEY_NAME!==t&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=t),t}function nn(){return h&&typeof h.CUSTOM_FONT_STORAGE_KEY_NAME=="string"?h.CUSTOM_FONT_STORAGE_KEY_NAME:ff()}ff();var rt="customLogo",qc="cameraPowerPlanner_temperatureUnit",Wc="cameraPowerPlanner_focusScale";function qg(){if(!h)return qc;const e=typeof h.TEMPERATURE_UNIT_STORAGE_KEY=="string"?h.TEMPERATURE_UNIT_STORAGE_KEY:qc;if(h.TEMPERATURE_UNIT_STORAGE_KEY!==e)try{h.TEMPERATURE_UNIT_STORAGE_KEY=e}catch(t){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign temperature unit storage key globally.",t);try{Object.defineProperty(h,"TEMPERATURE_UNIT_STORAGE_KEY",{configurable:!0,writable:!0,value:e})}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose temperature unit storage key globally.",r)}}return e}var lt=qg(),Je=(function(){if(!h)return Wc;const t=typeof h.FOCUS_SCALE_STORAGE_KEY=="string"?h.FOCUS_SCALE_STORAGE_KEY:Wc;if(h.FOCUS_SCALE_STORAGE_KEY!==t)try{h.FOCUS_SCALE_STORAGE_KEY=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to assign focus scale storage key globally.",r)}if(h.FOCUS_SCALE_STORAGE_KEY_NAME!==t)try{h.FOCUS_SCALE_STORAGE_KEY_NAME=t}catch(r){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose focus scale storage key globally.",r)}return t})(),Br="cameraPowerPlanner_autoGearRules",an="cameraPowerPlanner_autoGearSeeded",ut="cameraPowerPlanner_autoGearBackups",Dt="cameraPowerPlanner_autoGearPresets",Ut="cameraPowerPlanner_autoGearMonitorDefaults",Ot="cameraPowerPlanner_autoGearActivePreset",Qe="cameraPowerPlanner_autoGearAutoPreset",pr="cameraPowerPlanner_autoGearShowBackups",Kt="cameraPowerPlanner_autoGearBackupRetention",Fe="cameraPowerPlanner_fullBackups",De="auto-backup-",Pt="auto-backup-before-delete-",Xr="__cineAutoBackupRenamed",_o="__cineAutoBackupMetadata",Cn="__cineAutoBackupSnapshot",Zr=1,Qa="__cineAutoBackupCompressedPayload",pf="__cineCircular__",Nr=new Map,Ls=typeof Set=="function"?new Set:null,Wg=2048;function Vt(e){return typeof e=="string"&&(e.startsWith(De)||e.startsWith(Pt))}if(h&&typeof h=="object")try{Object.prototype.hasOwnProperty.call(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG")||Object.defineProperty(h,"__CINE_AUTO_BACKUP_RENAMED_FLAG",{configurable:!0,writable:!1,value:Xr})}catch{try{h.__CINE_AUTO_BACKUP_RENAMED_FLAG=Xr}catch{}}var bn=240,Yc=20,df=36,at=1,Yg=120;function Jg(){if(!(!h||typeof h!="object")){if(typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=df}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention default globally.",e)}if(typeof h.AUTO_GEAR_BACKUP_RETENTION_MIN!="number")try{h.AUTO_GEAR_BACKUP_RETENTION_MIN=at}catch(e){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose auto gear backup retention minimum globally.",e)}}}Jg();function Qg(e){return!e||typeof e!="object"?null:{version:Number.isFinite(e.version)?e.version:Zr,snapshotType:e.snapshotType==="delta"?"delta":"full",base:typeof e.base=="string"?e.base:null,sequence:Number.isFinite(e.sequence)?e.sequence:e.snapshotType==="delta"?1:0,createdAt:typeof e.createdAt=="string"?e.createdAt:null,changedKeys:Array.isArray(e.changedKeys)?e.changedKeys.slice():[],removedKeys:Array.isArray(e.removedKeys)?e.removedKeys.slice():[],payloadSignature:typeof e.payloadSignature=="string"?e.payloadSignature:null,payloadCompression:E(e.payloadCompression)?{...e.payloadCompression}:null,compressedPayload:E(e.compressedPayload)?me(e.compressedPayload,{stripMetadata:!0}):e.compressedPayload&&typeof e.compressedPayload=="string"?e.compressedPayload:null}}function yo(e,t){if(!e||typeof e!="object")return;const r=Qg(t);try{Object.defineProperty(e,_o,{configurable:!0,enumerable:!1,writable:!0,value:r})}catch{try{e[_o]=r}catch{}}}function ko(e){if(!e||typeof e!="object")return null;const t=e[_o];return!t||typeof t!="object"?null:t}function Xg(e,t){if(!t||typeof t!="object")return;const r=ko(e);r&&yo(t,r)}function me(e,t,r){const n=t||{},o=r||(typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),i=(s,a)=>{if(!o||!o.stack)return a();if(o.stack.has(s)){if(!o.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function")try{console.warn("Detected circular reference while cloning automatic backup data. Using a placeholder to keep serialization stable.")}catch{}return o&&(o.reportedCycle=!0),pf}o.stack.add(s);try{return a()}finally{o.stack.delete(s)}};return e===null||typeof e!="object"?e:e instanceof Date?new Date(e.getTime()):Array.isArray(e)?i(e,()=>e.map(s=>me(s,n,o))):i(e,()=>{const s={};if(Object.keys(e).forEach(a=>{n.stripMetadata&&a===_o||(s[a]=me(e[a],n,o))}),!n.stripMetadata){const a=ko(e);a&&yo(s,a)}return s})}function ea(e,t){const n=me(e,t,typeof WeakSet=="function"?{stack:new WeakSet,reportedCycle:!1}:null),o=ue(n);return o!==n?o:n}function zn(e){return!E(e)||e[Qa]!==!0?!1:typeof e.data=="string"&&e.data}function Rs(e,t,r){if(!e||typeof e!="object")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:null};const n=r||{};if(n.disableCompression)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:typeof n.payloadSignature=="string"?n.payloadSignature:null};const o=n.reportCompression!==!1;let i=null;try{i=typeof n.payloadSignature=="string"?n.payloadSignature:Pe(e)}catch(y){i=null,console.warn("Unable to compute stable signature for automatic backup payload before compression",y)}const s=typeof n.existingPayloadSignature=="string"?n.existingPayloadSignature:null;if(s&&i&&s===i&&zn(n.existingCompressedPayload)){const y=me(n.existingCompressedPayload,{stripMetadata:!0}),p=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null;return!n.disableCompression&&typeof i=="string"&&i&&yi(i,y,p),{payload:y,compression:p,compressed:!0,reused:!0,payloadSignature:i}}if(!n.disableCompression&&typeof i=="string"&&i){const y=Qu(i);if(y&&y.payload)return{payload:y.payload,compression:y.compression,compressed:!0,reused:!0,payloadSignature:i}}let a;try{a=JSON.stringify(e)}catch(y){return console.warn("Unable to serialize auto backup payload before compression",y),{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i}}if(typeof a!="string"||a.length<Wg)return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};if(!n.disableCompression&&zn(n.existingCompressedPayload)){const y=Vo(n.existingCompressedPayload.data);if(y.success&&typeof y.value=="string"&&y.value===a){const p=me(n.existingCompressedPayload,{stripMetadata:!0}),d=E(n.existingPayloadCompression)?{...n.existingPayloadCompression}:null,m=typeof i=="string"&&i?i:typeof s=="string"&&s?s:null;return m&&yi(m,p,d),{payload:p,compression:d,compressed:!0,reused:!0,payloadSignature:m}}}const c=Bn(a);if(!c||typeof c.serialized!="string")return{payload:e,compression:null,compressed:!1,reused:!1,payloadSignature:i};const l=c.originalLength-c.wrappedLength,f={[Qa]:!0,data:c.serialized,originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},u=typeof c.originalLength=="number"&&Number.isFinite(c.originalLength)&&typeof c.wrappedLength=="number"&&Number.isFinite(c.wrappedLength)?{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null}:null;if(!n.disableCompression&&typeof i=="string"&&i&&yi(i,f,u),o&&typeof console<"u"&&typeof console.warn=="function"&&l>0){const y=typeof t=="string"&&t?`"${t}"`:"an automatic backup",p=c.originalLength>0?Math.round(l/c.originalLength*100):0,d=`Stored compressed payload for ${y} snapshot to reduce storage usage by ${l} characters (${p}%).`;us("auto-backup",t||y,d,l,p)}return{payload:f,compression:{originalLength:c.originalLength,compressedLength:c.wrappedLength,compressionVariant:c.compressionVariant||null},compressed:!0,reused:!1,payloadSignature:i}}function ta(e,t){if(!e||typeof e!="object")return{payload:e,compressed:!1};const r=e.payload;if(!zn(r))return{payload:r,compressed:!1};const n=Vo(r.data);if(!n.success||typeof n.value!="string"){const o=n&&n.error?n.error:null;throw console.warn("Unable to decompress automatic backup payload.",t,o),new Error("Failed to decompress automatic backup payload")}try{return{payload:JSON.parse(n.value),compressed:!0}}catch(o){throw console.warn("Unable to parse decompressed automatic backup payload.",t,o),o}}function go(e,t){const r=tc(e);if(r&&Number.isFinite(r.timestamp)&&r.timestamp>0)try{return new Date(r.timestamp).toISOString()}catch{}const n=t instanceof Date?t:new Date;try{return n.toISOString()}catch{return new Date().toISOString()}}function Zg(e,t,r){if(!E(e)||!r||r.snapshotType!=="delta")return{cycle:!1,path:[]};const n=new Set,o=[],i=Math.max(10,Object.keys(e).length+5);let s=0,a=t,c=r;for(;c&&c.snapshotType==="delta";){if(s>i)return{cycle:!0,path:o};const l=typeof c.base=="string"?c.base:null;if(!l)return{cycle:!1,path:o};if(!Vt(l))return{cycle:!1,path:o};if(n.has(l))return o.push(l),{cycle:!0,path:o};n.add(a),o.push(a);const f=Object.prototype.hasOwnProperty.call(e,l)?e[l]:null;if(!E(f))return{cycle:!1,path:o};if(a=l,c=ko(f),!c)return{cycle:!1,path:o};s+=1}return{cycle:!1,path:o}}function em(e,t,r){if(!e||typeof e!="object")return;e.snapshotType="full",e.base=null,e.sequence=0,e.removedKeys=[];const n=E(r)?Object.keys(r):[];e.changedKeys=n.slice(),(typeof e.createdAt!="string"||!e.createdAt)&&(e.createdAt=go(t))}function yf(e,t){if(!E(e))return e;const r={},n=new Map,o=t||{},i=typeof o.isAutoBackupKey=="function"?o.isAutoBackupKey:Vt,s=typeof o.filter=="function"?o.filter:null,a=s?l=>{let f=!1;try{f=s(l)}catch{f=!1}return f}:()=>!0,c=(l,f)=>{if(n.has(l))return n.get(l);const u=e[l],y=ds(u,l),p=y.restored?y.value:u;if(!E(p)){const g=me(p);return n.set(l,g),g}const d=p[Cn];if(d&&typeof d=="object"){if(f.has(l)){console.warn("Detected cyclic auto-backup reference while expanding snapshot",l);let S={},I=[],B=null;try{const G=ta(d,l);if(G&&E(G.payload)){S=me(G.payload),I=Object.keys(G.payload);try{B=Pe(G.payload)}catch(N){B=null,console.warn("Unable to compute stable signature for automatic backup payload after detecting a cycle",N)}}}catch(G){console.warn("Failed to restore automatic backup payload after detecting a cyclic reference",l,G)}const M={version:Number.isFinite(d.version)?d.version:Zr,snapshotType:"full",base:null,sequence:Number.isFinite(d.sequence)?d.sequence:0,createdAt:typeof d.createdAt=="string"?d.createdAt:go(l),changedKeys:I.slice(),removedKeys:[],payloadSignature:B};return zn(d.payload)?(M.compressedPayload=me(d.payload,{stripMetadata:!0}),M.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(M.compressedPayload=null,M.payloadCompression=null),yo(S,M),n.set(l,S),S}f.add(l);const g=d.snapshotType==="delta"?"delta":"full",b=g==="delta"&&typeof d.base=="string"?d.base:null,P=b?me(c(b,f)):{};let A;try{A=ta(d,l)}catch(S){throw console.warn("Failed to restore automatic backup payload while expanding snapshot",l,S),S}const O=E(A.payload)?A.payload:{},_=Array.isArray(d.changedKeys)&&d.changedKeys.length?d.changedKeys:Object.keys(O),k=Array.isArray(d.removedKeys)?d.removedKeys:[],j=me(P);_.forEach(S=>{Object.prototype.hasOwnProperty.call(O,S)&&j&&(j[S]=me(O[S]))}),k.forEach(S=>{Object.prototype.hasOwnProperty.call(j,S)&&delete j[S]});const w={version:Number.isFinite(d.version)?d.version:Zr,snapshotType:g,base:g==="delta"?b:null,sequence:Number.isFinite(d.sequence)?d.sequence:g==="delta"?1:0,createdAt:typeof d.createdAt=="string"?d.createdAt:go(l),changedKeys:_.slice(),removedKeys:k.slice()};try{w.payloadSignature=Pe(O)}catch(S){w.payloadSignature=null,console.warn("Unable to compute stable signature for automatic backup payload during expansion",S)}return zn(d.payload)?(w.compressedPayload=me(d.payload,{stripMetadata:!0}),w.payloadCompression=E(d.payloadCompression)?{...d.payloadCompression}:null):(w.compressedPayload=null,w.payloadCompression=null),yo(j,w),n.set(l,j),f.delete(l),j}const m=me(p);if(i(l)){const g={version:Zr,snapshotType:"full",base:null,sequence:0,createdAt:go(l),changedKeys:Object.keys(m),removedKeys:[]};yo(m,g)}return n.set(l,m),m};return Object.keys(e).forEach(l=>{if(a(l)){if(!i(l)){const f=e[l];r[l]=E(f)?me(f):f;return}r[l]=c(l,new Set)}}),r}function tm(e,t){const r={},n=[],o=[],i=E(t)?Object.keys(t):[],s=E(e)?Object.keys(e):[];return new Set([...i,...s]).forEach(c=>{if(c===_o)return;const l=Object.prototype.hasOwnProperty.call(e||{},c),f=Object.prototype.hasOwnProperty.call(t||{},c);if(!l&&f){o.push(c);return}if(!l)return;const u=e?e[c]:void 0,y=f?t[c]:void 0,p=Pe(u),d=Pe(y);p!==d&&(n.push(c),r[c]=me(u,{stripMetadata:!0}))}),{payload:r,changedKeys:n,removedKeys:o}}function gf(e,t){if(!E(e))return e;const r=t||{},n=typeof r.isAutoBackupKey=="function"?r.isAutoBackupKey:Vt,o={},i=Object.keys(e),s=(()=>{const a=new Map;i.forEach(l=>{if(!n(l))return;const f=e[l],u=ko(f);let y=Number.NEGATIVE_INFINITY;if(u&&typeof u.createdAt=="string"){const m=Date.parse(u.createdAt);Number.isNaN(m)||(y=m)}if(!Number.isFinite(y)){const m=tc(l);m&&Number.isFinite(m.timestamp)&&(y=m.timestamp)}const p=l.startsWith(Pt)?Pt:De,d=a.get(p);(!d||y>d.timestamp||y===d.timestamp&&l.localeCompare(d.name)>0)&&a.set(p,{name:l,timestamp:y})});const c=new Set;return a.forEach(({name:l})=>{typeof l=="string"&&l&&c.add(l)}),c})();return i.forEach(a=>{const c=e[a],l=ea(c,{stripMetadata:!0});if(!n(a)||!E(l)){o[a]=l;return}const f=s.has(a),u=ko(c);u&&u.snapshotType==="delta"&&Zg(e,a,u).cycle&&(typeof console<"u"&&typeof console.warn=="function"&&console.warn("Detected cyclic automatic backup chain during serialization. Promoting to full snapshot.",a),em(u,a,l));const y=u&&typeof u.createdAt=="string"?u.createdAt:go(a);if(!u||u.snapshotType!=="delta"){o[a]={};const O={version:Zr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(l||{}),removedKeys:[]};let _;try{_=Pe(l)}catch(j){_=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",j)}const k=Rs(l,a,{disableCompression:f,payloadSignature:_,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(O.payload=k.payload,k.compression&&(O.payloadCompression=k.compression),u){const j=typeof k.payloadSignature=="string"?k.payloadSignature:_;u.payloadSignature=j||null,k.compressed?(u.compressedPayload=me(k.payload,{stripMetadata:!0}),u.payloadCompression=k.compression?{...k.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][Cn]=O;return}const p=typeof u.base=="string"?u.base:null,d=p&&Object.prototype.hasOwnProperty.call(e,p)?e[p]:null;if(!d||!E(d)){o[a]={};const O={version:Zr,snapshotType:"full",base:null,sequence:0,createdAt:y,changedKeys:Object.keys(l||{}),removedKeys:[]};let _;try{_=Pe(l)}catch(j){_=null,console.warn("Unable to compute stable signature for automatic backup payload before serialization",j)}const k=Rs(l,a,{disableCompression:f,payloadSignature:_,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(O.payload=k.payload,k.compression&&(O.payloadCompression=k.compression),u){const j=typeof k.payloadSignature=="string"?k.payloadSignature:_;u.payloadSignature=j||null,k.compressed?(u.compressedPayload=me(k.payload,{stripMetadata:!0}),u.payloadCompression=k.compression?{...k.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][Cn]=O;return}const m=ea(d,{stripMetadata:!0}),g=tm(l,m);o[a]={};const b={version:Number.isFinite(u.version)?u.version:Zr,snapshotType:"delta",base:p,sequence:Number.isFinite(u.sequence)?u.sequence:1,createdAt:y,changedKeys:g.changedKeys,removedKeys:g.removedKeys};let P;try{P=Pe(g.payload)}catch(O){P=null,console.warn("Unable to compute stable signature for automatic backup delta payload before serialization",O)}const A=Rs(g.payload,a,{disableCompression:f,payloadSignature:P,existingCompressedPayload:u?u.compressedPayload:null,existingPayloadCompression:u?u.payloadCompression:null,existingPayloadSignature:u?u.payloadSignature:null});if(b.payload=A.payload,A.compression&&(b.payloadCompression=A.compression),u){const O=typeof A.payloadSignature=="string"?A.payloadSignature:P;u.payloadSignature=O||null,A.compressed?(u.compressedPayload=me(A.payload,{stripMetadata:!0}),u.payloadCompression=A.compression?{...A.compression}:null):(u.compressedPayload=null,u.payloadCompression=null)}o[a][Cn]=b}),o}function _t(e){if(typeof e!="string"||!e)return[e];const t=new Set([e]);return e.startsWith("cameraPowerPlanner_")?t.add(`cinePowerPlanner_${e.slice(19)}`):e.startsWith("cinePowerPlanner_")&&t.add(`cameraPowerPlanner_${e.slice(17)}`),Array.from(t)}var Pn=new Set(_t(pt));function rm(){return(!ei||typeof ei.has!="function")&&(ei=new Set(_t(Ze))),ei}function mf(e){if(typeof e!="string"||!e)return!1;const t=rm();return t&&typeof t.has=="function"?t.has(e):e===Ze}function nm(e){return!(typeof e!="string"||!e||!Pn||typeof Pn.has!="function"||!Pn.has(e)||xt)}function om(e,t){if(!e||typeof e.getItem!="function"||!Pn||typeof Pn.forEach!="function")return;const r=new Set,n=t&&typeof t.has=="function"?t:null;Pn.forEach(o=>{if(!(typeof o!="string"||!o||r.has(o))&&(r.add(o),!(n&&n.has(o))))try{e.getItem(o)}catch{}})}var he="__backup",im=3,sm=100,cn="__legacyMigrationBackup",Lt=new Set([nn(),rt,dt,tt,Gt,Lr,gi,Je,Re]);Array.from(Lt).forEach(e=>{_t(e).forEach(t=>{typeof t=="string"&&t&&Lt.add(t)})});var Jc=[()=>({key:Ze}),()=>({key:pt}),()=>({key:er}),()=>({key:Mr}),()=>({key:pe,valueProvider:()=>{if(typeof kt=="function")try{const{projects:e}=kt({forMutation:!1});if(e&&typeof e=="object")return JSON.stringify(e)}catch(e){typeof console<"u"&&console.warn&&console.warn("Failed to reconstruct monolithic project backup",e)}return null}}),()=>({key:et}),()=>({key:tt}),()=>({key:Gt}),()=>({key:Lr}),()=>({key:dt}),()=>({key:Br}),()=>({key:an}),()=>({key:ut}),()=>({key:Dt}),()=>({key:Ot}),()=>({key:Qe}),()=>({key:pr}),()=>({key:Kt}),()=>({key:Ut}),()=>({key:Fe}),()=>({key:rt}),()=>({key:nn()}),()=>({key:"darkMode"}),()=>({key:"pinkMode"}),()=>({key:"highContrast"}),()=>({key:"reduceMotion"}),()=>({key:"relaxedSpacing"}),()=>({key:"showAutoBackups"}),()=>({key:"accentColor"}),()=>({key:"fontSize"}),()=>({key:"fontFamily"}),()=>({key:"language"}),()=>({key:"iosPwaHelpShown"}),()=>({key:Re}),()=>({key:lt}),()=>({key:Ft(),backupKey:uf()})];function am(e,t={}){if(!e||typeof e!="object")return null;const{key:r,backupKey:n,storage:o=null}=e;if(typeof r!="string"||!r)return null;const i=typeof n=="string"&&n?n:`${r}${he}`;return{key:r,backupKey:i,storage:o,label:typeof t.label=="string"?t.label:r,valueProvider:typeof e.valueProvider=="function"?e.valueProvider:null}}function cm(e={}){const t=[],r=new Set,n=i=>{if(!i)return;const s=_t(i.key),a=`${i.key}${he}`;for(let c=0;c<s.length;c+=1){const l=s[c];if(typeof l!="string"||!l)continue;let f=i.backupKey;l!==i.key&&i.backupKey===a&&(f=`${l}${he}`);const u=l===i.key?i:{...i,key:l,backupKey:f},y=u.storage||null,p=`${u.key}__${y?String(y):"default"}`;r.has(p)||(r.add(p),t.push(u))}};for(let i=0;i<Jc.length;i+=1){const s=Jc[i];if(typeof s!="function")continue;let a;try{a=s(e)}catch(l){var o={event:"critical-storage",action:"collect-keys",reason:"provider-error",storageType:Cr(e&&e.storage?e.storage:null),error:gn(l)};Pr("warn","Critical storage key provider failed",o,{event:"critical-storage",stage:"gather"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage key provider failed",l)});continue}const c=am(a,e);c&&n(c)}return t}let hf=null;function lm(e){if(hf=e,!(!h||typeof h!="object"))try{h.__cineCriticalStorageGuard=e}catch{try{Object.defineProperty(h,"__cineCriticalStorageGuard",{configurable:!0,writable:!0,value:e})}catch{}}}function um(e={}){let t=e&&e.storage?e.storage:null;if(!t)try{t=T()}catch(f){var r={event:"critical-storage",action:"resolve-storage",reason:"resolve-failed",storageType:Cr(e&&e.storage?e.storage:null),error:gn(f)};Pr("warn","Unable to resolve safe storage while ensuring backups",r,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to resolve safe storage while ensuring backups",f)}),t=null}const n={ensured:[],skipped:[],errors:[],timestamp:new Date().toISOString(),storageType:D&&D.type?D.type:"unknown"},o=cm(e),i=t&&typeof t.getItem=="function"?t:null;for(let f=0;f<o.length;f+=1){const u=o[f],y=u.storage&&typeof u.storage.getItem=="function"?u.storage:i;if(!y||typeof y.getItem!="function"||typeof y.setItem!="function"){n.skipped.push({key:u.key,reason:"unavailable-storage"});continue}let p;try{u.valueProvider?p=u.valueProvider():p=y.getItem(u.key)}catch(k){n.errors.push({key:u.key,reason:"read-failed",error:k});var s={event:"critical-storage",action:"inspect-primary",key:u.key,storageType:Cr(y),reason:"read-failed",error:gn(k)};Pr("warn","Critical storage guard could not inspect "+u.key,s,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not inspect "+u.key,k)});continue}if(p==null){n.skipped.push({key:u.key,reason:"missing"});continue}let d;try{d=y.getItem(u.backupKey)}catch(k){n.errors.push({key:u.key,reason:"backup-read-failed",error:k});var a={event:"critical-storage",action:"inspect-backup",key:u.key,backupKey:u.backupKey,storageType:Cr(y),reason:"backup-read-failed",error:gn(k)};Pr("warn","Critical storage guard could not read backup for "+u.key,a,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard could not read backup for "+u.key,k)});continue}if(typeof d=="string"){n.skipped.push({key:u.key,reason:"exists"});continue}const m=typeof p=="string"?p:p==null?"":String(p),g=k=>{try{return y.setItem(u.backupKey,k),{success:!0,error:null}}catch(j){return{success:!1,error:j}}},b=(k,j="backup-write-failed")=>{n.errors.push({key:u.key,reason:j,error:k});var w={event:"critical-storage",action:"mirror-backup",key:u.key,backupKey:u.backupKey,storageType:Cr(y),reason:j,error:gn(k)};O&&(w.compressed=!0),Pr("error","Critical storage guard could not mirror "+u.key,w,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.error=="function"&&console.error("Critical storage guard could not mirror "+u.key,k)})},P=typeof m=="string"&&m&&!m.includes(`"${dr}":true`)&&!mf(u.key);let A=m,O=null,_=g(A);if(!_.success&&_.error){if(!Tt(_.error)){b(_.error);continue}if(P){const k=Bn(m);k&&typeof k.serialized=="string"&&k.serialized&&(A=k.serialized,O=k,_=g(A))}if(!_.success&&_.error&&Tt(_.error)){const k=new Set;typeof u.backupKey=="string"&&u.backupKey&&k.add(u.backupKey);const j=nm(u.key);!j&&typeof u.key=="string"&&u.key&&k.add(u.key),!j&&!xt&&om(y,k);const w=Of(y,{skipKeys:Array.from(k)});w&&w.success&&(_=g(A))}if(!_.success){b(_.error,Tt(_.error)?"backup-quota-exceeded":"backup-write-failed"),Tt(_.error)&&ce("critical-backup-quota");continue}}if(n.ensured.push({key:u.key,backupKey:u.backupKey,compressed:!!O}),O&&typeof O.originalLength=="number"&&typeof O.wrappedLength=="number"){const k=O.originalLength-O.wrappedLength,j=O.originalLength>0?Math.round(k/O.originalLength*100):0,w=`Stored compressed critical backup for ${u.key}, reducing storage usage by ${k} characters (${j}%).`;us("critical-backup",u.key,w,k,j)}}if(lm(n),n.ensured.length){var c={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||Cr(),count:n.ensured.length,timestamp:n.timestamp,entries:n.ensured.map(function(u){return{key:u.key,backupKey:u.backupKey,compressed:!!u.compressed}})};Pr("info","Critical storage guard mirrored backup copies",c,{event:"critical-storage",stage:"ensure"},function(){if(typeof console<"u"&&typeof console.info=="function"){const u=n.ensured.map(y=>({key:y.key,backupKey:y.backupKey}));console.info("Critical storage guard mirrored backup copies",{count:n.ensured.length,entries:u})}})}if(n.errors.length){var l={event:"critical-storage",action:"mirror-summary",storageType:n.storageType||Cr(),count:n.errors.length,timestamp:n.timestamp,reason:"errors-detected",entries:n.errors.map(function(u){return{key:u&&u.key,reason:u&&u.reason,error:gn(u&&u.error)}})};Pr("warn","Critical storage guard encountered issues",l,{event:"critical-storage",stage:"ensure"},function(){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Critical storage guard encountered issues",n.errors)})}return n}function fm(){return hf}var pm=10,bf="lz-string",Sf="json-string",fs=[{variant:"utf16",compress:"compressToUTF16",decompress:"decompressFromUTF16"},{variant:"uri-component",compress:"compressToEncodedURIComponent",decompress:"decompressFromEncodedURIComponent"},{variant:"base64",compress:"compressToBase64",decompress:"decompressFromBase64"}],dr="__cineStorageCompressed",xi=1,vo="lz-string",Qc="lz-string-utf16",wf=fs,on="camera-power-planner:storage-compression",dm=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(vo):'"'.concat(String(vo),'"'),ym=typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function"?JSON.stringify(on):'"'.concat(String(on),'"'),Xc=Bg(),pn=typeof WeakSet=="function"?new WeakSet:null,gm=40,mm=128,Gr="__cineRawGetItem",hm=1024,bm=256,Sm=.08;function ps(e){if(!Array.isArray(e)||!e.length)return[];var t=Bs;if(!t)return[];var r=Mg(e),n=Ng(r,t);if(n!=null)return n;for(var o=[],i=0;i<e.length;i+=1){var s=e[i];if(s){var a=typeof t[s.compress]=="function"?t[s.compress]:null,c=typeof t[s.decompress]=="function"?t[s.decompress]:null,l=null,f=0;if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{l=JSON.stringify(String(s.variant||"")),typeof l=="string"&&l?f=l.length:(l=null,f=0)}catch{l=null,f=0}a&&c&&o.push({variant:s.variant,compress:a,decompress:c,variantLiteral:f>0?l:null,variantLiteralLength:f})}}var u=o.length?o.slice():[];return r&&zg(r,t,u),u}function Ef(e,t,r,n){if(typeof e!="string"||!e)return{success:!1};var o=ps(t);if(!o.length)return{success:!1};var i=[];if(r){for(var s=null,a=0;a<o.length;a+=1)if(o[a].variant===r){s=o[a];break}s?i.push(s):typeof console<"u"&&typeof console.warn=="function"&&console.warn("Compression variant ".concat(r," is unavailable while reading ").concat(n||"compressed payload","."))}for(var c=0;c<o.length;c+=1)(!r||o[c].variant!==r)&&i.push(o[c]);for(var l=null,f=0;f<i.length;f+=1){var u=i[f];try{var y=u.decompress(e);if(typeof y=="string"&&y)return{success:!0,value:y,variant:u.variant}}catch(p){l=p,typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to decompress ".concat(n||"compressed payload"," with ").concat(u.variant," variant"),p)}}return{success:!1,error:l}}function Xa(){return ps(fs).length>0}function wm(e,t){if(typeof e!="string"||!e||!Xa())return null;var r=rf($c,e);if(r.hit)return r.candidate;var n=null,o=ps(fs);if(!o.length)return null;for(var i=0;i<o.length;i+=1){var s=o[i],a=null;try{a=s.compress(e)}catch(f){console.warn("Unable to compress migration backup payload with ".concat(s.variant," variant"),f);continue}if(!(typeof a!="string"||!a||a.length>=e.length)){var c={createdAt:t,compression:bf,compressionVariant:s.variant,encoding:Sf,data:a,originalSize:e.length,compressedSize:a.length},l;try{l=JSON.stringify(c)}catch(f){console.warn("Unable to serialize compressed migration backup payload",f);continue}typeof l!="string"||!l||l.length>=e.length||(!n||l.length<n.serializedLength)&&(n={serialized:l,serializedLength:l.length,originalSize:e.length,compressedSize:a.length,variant:s.variant})}}return nf($c,e,n),n}function Em(e){if(typeof e!="string"||!e)return{createdAt:0,size:typeof e=="string"?e.length:0};const t={createdAt:0,size:e.length};try{const r=JSON.parse(e);if(r&&typeof r=="object"){let n=null;if(typeof r.createdAt=="string"?n=r.createdAt.trim():typeof r.createdAt=="number"&&Number.isFinite(r.createdAt)&&(t.createdAt=r.createdAt),n){const o=Date.parse(n);Number.isNaN(o)||(t.createdAt=o)}else for(let o=0;o<Fi.length;o+=1){const i=Fi[o];if(typeof r[i]=="string"){const s=r[i].trim();if(s){const a=Date.parse(s);if(!Number.isNaN(a)){t.createdAt=a;break}}}else if(typeof r[i]=="number"&&Number.isFinite(r[i])){t.createdAt=r[i];break}}}}catch{}return t}function Af(){return Xa()}function Bn(e){if(typeof e!="string"||!e||!Af())return null;var t=rf(Kc,e);if(t.hit)return t.candidate;var r=ps(wf);if(!r.length)return null;for(var n=typeof Xc=="number"?Xc:0,o=null,i=null,s=null,a=null,c=String(e.length).length,l=0;l<r.length;l+=1){var f=r[l],u=null;try{u=f.compress(e)}catch(_){console.warn("Unable to compress storage payload with ".concat(f.variant," variant"),_);continue}if(!(typeof u!="string"||!u)){var y;try{y=JSON.stringify(u)}catch(_){console.warn("Unable to serialize compressed storage payload candidate",_);continue}if(!(typeof y!="string"||!y)){var p=typeof f.variantLiteral=="string"&&f.variantLiteral?f.variantLiteral:null,d=typeof f.variantLiteralLength=="number"&&f.variantLiteralLength>0?f.variantLiteralLength:0;if(!p&&typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{p=JSON.stringify(String(f.variant||"")),d=typeof p=="string"&&p?p.length:0}catch{p=null,d=0}var m=null,g=Number.POSITIVE_INFINITY;if(n>0&&d>0){var b=String(u.length).length;g=n+y.length+c+b+d}else{var P={[dr]:!0,version:xi,algorithm:vo,namespace:on,data:u,originalLength:e.length,compressedPayloadLength:u.length,compressionVariant:f.variant};try{m=JSON.stringify(P)}catch(_){console.warn("Unable to serialize compressed storage payload wrapper",_);continue}if(typeof m!="string"||!m)continue;g=m.length}g<e.length&&(!o||g<o.wrappedLength)&&(o={originalLength:e.length,wrappedLength:g,compressedPayloadLength:u.length,compressionVariant:f.variant},i=m,s=y,a=p)}}}if(o&&(!i||typeof i!="string"))if(typeof s!="string"||!s)o=null;else{var A;if(typeof a=="string"&&a)A=a;else if(typeof JSON<"u"&&JSON&&typeof JSON.stringify=="function")try{A=JSON.stringify(String(o.compressionVariant||""))}catch{A=null}if(typeof A!="string"||!A)o=null;else{var O='{"'.concat(dr,'":true,"version":').concat(String(xi),',"algorithm":').concat(dm,',"namespace":').concat(ym,',"data":').concat(s,',"originalLength":').concat(String(o.originalLength),',"compressedPayloadLength":').concat(String(o.compressedPayloadLength),',"compressionVariant":').concat(A,"}");i=O}}return o&&i&&typeof i=="string"&&i.length<o.originalLength?(o.serialized=i,o.wrappedLength=i.length):o=null,nf(Kc,e,o),o}function Vo(e){if(typeof e!="string")return{success:!1};if(!e||e.charCodeAt(0)!==123)return{success:!1};if(!e.includes(`"${dr}":true`)||!e.includes(`"namespace":"${on}`))return{success:!1};let t;try{t=JSON.parse(e)}catch(o){return{success:!1,error:o}}if(!t||t[dr]!==!0)return{success:!1};if(t.namespace!==on)return{success:!1};if(t.version!==xi)return console.warn("Unsupported storage compression version",t.version),{success:!1};if(t.algorithm!==vo&&t.algorithm!==Qc)return console.warn("Unsupported storage compression algorithm",t.algorithm),{success:!1};if(typeof t.data!="string"||!t.data)return{success:!1};if(!Af())return console.warn("Compressed storage payload detected but compression library is unavailable."),{success:!1};var r=null;typeof t.compressionVariant=="string"&&t.compressionVariant?r=t.compressionVariant:t.algorithm===Qc&&(r="utf16");var n=Ef(t.data,wf,r,"storage payload");return n.success?(!t.compressionVariant&&n.variant&&(t.compressionVariant=n.variant),{success:!0,value:n.value,metadata:t}):{success:!1,error:n.error}}function ds(e,t){if(typeof e=="string"){const r=Vo(e);if(!r.success||typeof r.value!="string")return{restored:!1,value:e};try{return{restored:!0,value:JSON.parse(r.value)}}catch(n){return console.warn("Unable to parse decompressed project entry payload",t||"project entry",n),{restored:!1,value:e}}}if(E(e)&&e[dr]===!0){let r;try{r=JSON.stringify(e)}catch(n){return console.warn("Unable to reserialize compressed project entry wrapper before restoration",t||"project entry",n),{restored:!1,value:e}}if(typeof r=="string"&&r)return ds(r,t)}return{restored:!1,value:e}}function ys(e,t){if(typeof e!="string")return;const r=typeof t=="number"&&Number.isFinite(t)?t:Date.now(),n=Be(e);if(n){Nr.set(n,r),n!==e&&Nr.set(e,r);return}Nr.set(e,r)}function Am(e,t){if(!e||typeof e!="object")return;const r=Date.now();Object.keys(e).forEach(n=>{typeof n!="string"||!n||Vt(n)||ys(n,r)})}function ra(e){if(typeof e!="string")return;const t=Be(e);Nr.delete(e),t&&t!==e&&Nr.delete(t)}function Om(e){if(typeof e!="string")return"";const t=Be(e);return typeof t=="string"&&t?t:""}function Cm(e){if(!Ls||typeof Ls.has!="function")return!1;const t=Om(e);if(!t)return!1;try{return Ls.has(t)}catch{}return!1}function Pm(e,t){const r=ds(e,t);return r.restored?r.value:e}function _m(e){return E(e)&&Object.keys(e).forEach(t=>{e[t]=Pm(e[t],t)}),e}function km(e){if(!e||typeof e.add!="function")return;const t=[pe,`${pe}${he}`,pt,`${pt}${he}`];for(let r=0;r<t.length;r+=1){const n=t[r];typeof n=="string"&&n&&e.add(n)}}function vm(e){if(!e||typeof e.add!="function")return;const t=[tt,Gt,ct,Ze];for(let r=0;r<t.length;r+=1){const n=t[r];if(typeof n!="string"||!n)continue;const o=_t(n);for(let i=0;i<o.length;i+=1){const s=o[i];typeof s!="string"||!s||(e.add(s),e.add(`${s}${he}`))}}}function ln(e,t){if(typeof e!="string")return e;const r=Vo(e);return r.success?r.value:e}function Of(e,t){if(!e||typeof e.length!="number"||typeof e.key!="function")return{success:!1,compressed:0,freed:0};if(Rf(e))return{success:!1,compressed:0,freed:0};const{skipKeys:r=[],limit:n=gm,minSavings:o=mm}=t||{},i=new Set;if(xt&&rr&&i.add(rr),xt&&km(i),vm(i),Array.isArray(r))for(let y=0;y<r.length;y+=1){const p=r[y];typeof p=="string"&&p&&i.add(p)}const s=typeof o=="number"&&o>0?o:0,a=e.length,c=[];for(let y=0;y<a;y+=1){let p;try{p=e.key(y)}catch{p=null}if(typeof p!="string"||!p||i.has(p))continue;let d;try{d=e.getItem(p)}catch{continue}if(typeof d!="string"||!d||d.includes(`"${dr}":true`))continue;const m=Bn(d);if(!m||typeof m.serialized!="string"||!m.serialized)continue;const g=typeof m.originalLength=="number"&&typeof m.wrappedLength=="number"?m.originalLength-m.wrappedLength:0;g<s||c.push({key:p,serialized:m.serialized,savings:g>0?g:0,originalLength:typeof m.originalLength=="number"?m.originalLength:0})}if(!c.length)return{success:!1,compressed:0,freed:0};c.sort((y,p)=>p.savings!==y.savings?p.savings-y.savings:p.originalLength-y.originalLength);const l=typeof n=="number"&&n>0?Math.min(n,c.length):c.length;let f=0,u=0;for(let y=0;y<c.length&&f<l;y+=1){const p=c[y];if(!(!p||typeof p.serialized!="string"||!p.serialized))try{e.setItem(p.key,p.serialized),f+=1,u+=p.savings}catch{}}return f===0?{success:!1,compressed:0,freed:0}:(typeof console<"u"&&typeof console.warn=="function"&&(u>0?console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery, freeing approximately ${u} characters.`):console.warn(`Compressed ${f} stored entr${f===1?"y":"ies"} during quota recovery.`)),{success:!0,compressed:f,freed:u})}function nr(e){return e==null?e:ln(e)}function Zc(e){if(!e||typeof e.getItem!="function"||pn&&typeof pn.has=="function"&&pn.has(e))return;const t=e.getItem,r=typeof t=="function"?function(i){return t.call(this,i)}:null,n=function(i){const s=r?r.call(this,i):void 0;return ln(s)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(o){const i=o&&typeof o.message=="string"&&o.message.includes("Cannot redefine property");i||console.warn("Unable to redefine storage.getItem descriptor for compression support",o);try{e.getItem=n}catch(s){const a=s&&typeof s.message=="string"&&s.message.includes("Cannot assign to read only property");return a||console.warn("Unable to patch storage instance getItem for compression support",s),void 0}}if(r)try{Object.defineProperty(e,Gr,{configurable:!0,writable:!0,value:r})}catch{try{e[Gr]=r}catch{}}if(pn&&typeof pn.add=="function")try{pn.add(e)}catch{}}function jm(){if(typeof Storage>"u"){const i=[];h&&typeof h=="object"&&(h.localStorage&&i.push(h.localStorage),h.sessionStorage&&i.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&i.push(global.localStorage),global.sessionStorage&&i.push(global.sessionStorage)),i.forEach(Zc);return}const e=Storage.prototype;if(!e||typeof e.getItem!="function"||e.__cineStorageCompressionPatched)return;const t=e.getItem,r=function(s){return t.call(this,s)},n=function(s){const a=r.call(this,s);return ln(a)};try{Object.defineProperty(e,"getItem",{configurable:!0,writable:!0,value:n})}catch(i){console.warn("Unable to patch Storage.getItem for compression support",i);return}try{Object.defineProperty(e,Gr,{configurable:!0,writable:!1,value:r})}catch{try{e[Gr]=r}catch{}}try{Object.defineProperty(e,"__cineStorageCompressionPatched",{configurable:!0,writable:!1,value:!0})}catch{e.__cineStorageCompressionPatched=!0}const o=[];h&&typeof h=="object"&&(h.localStorage&&o.push(h.localStorage),h.sessionStorage&&o.push(h.sessionStorage)),typeof global<"u"&&global&&global!==h&&(global.localStorage&&o.push(global.localStorage),global.sessionStorage&&o.push(global.sessionStorage)),o.forEach(Zc)}function Za(e){if(!e||typeof e!="object")return null;const t=e[Gr];if(typeof t=="function")return t;const r=Object.getPrototypeOf(e);return r&&typeof r[Gr]=="function"?r[Gr]:null}function co(e,t,r){if(!e||typeof t!="string"||!t)return null;const n=typeof r=="function"?r:Za(e);if(typeof n!="function")return null;try{return n.call(e,t)}catch{return null}}function Im(e,t){if(!e)return[];let r;try{r=ec(e,{suppressAlerts:!0})}catch(n){return console.warn("Unable to inspect storage while preparing migration backup cleanup",n),[]}return!r||typeof r!="object"?[]:Object.keys(r).filter(n=>!(typeof n!="string"||!n||!n.endsWith(cn)||t&&n===t)).map(n=>{const o=r[n],i=typeof o=="string"?o:o==null?"":String(o),s=Em(i);return{key:n,createdAt:s.createdAt,size:s.size}}).sort((n,o)=>n.createdAt&&o.createdAt&&n.createdAt!==o.createdAt?n.createdAt-o.createdAt:n.createdAt&&!o.createdAt?-1:!n.createdAt&&o.createdAt?1:n.size!==o.size?o.size-n.size:n.key.localeCompare(o.key))}function Cf(e,t){const r=Im(e,t);if(!r.length)return[];const n=[],o=r[0];try{e.removeItem(o.key),n.push(o.key)}catch(i){console.warn(`Unable to remove migration backup ${o.key} during cleanup`,i)}return n}function el(e,t,r,n){if(!e||typeof e.setItem!="function")return{success:!1,error:null};const o=[];let i=null;if(typeof n!="function")return{success:!1,error:null};const s=()=>{const a=n();return a&&typeof a=="object"&&"error"in a&&a.error&&(i=a.error),a&&a.success?{success:!0,quota:!1}:a&&a.quota?{success:!1,quota:!0,error:a.error||null}:{success:!1,quota:!1,error:a&&a.error?a.error:null}};if(typeof sn=="function"){let a=!1;try{sn(),a=!0}catch(c){console.warn("Unable to clear cached UI storage entries before creating migration backup",c)}if(a){const c=s();if(c.success)return console.warn(`Cleared cached planner data to free storage before creating migration backup for ${t}.`),{success:!0,error:null};if(!c.quota)return{success:!1,error:c.error}}}for(let a=0;a<pm;a+=1){const c=Cf(e,r);if(!c.length)break;o.push(...c);const l=s();if(l.success)return console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} to free up storage before creating migration backup for ${t}.`,o),{success:!0,error:null};if(!l.quota)return{success:!1,error:l.error}}return o.length>0&&console.warn(`Removed ${o.length} older migration backup${o.length>1?"s":""} while attempting to create migration backup for ${t}, but storage quota is still exceeded.`,o),{success:!1,error:i}}function qe(e,t){if(!e||typeof e.getItem!="function"||!t)return null;let r=null;try{r=e.getItem(t)}catch(i){return console.warn(`Unable to inspect existing value for ${t} before creating migration backup`,i),null}if(r==null)return null;let n=r,o=r;if(typeof r=="string"&&r)if(o=ln(r),typeof o=="string"&&o)try{n=JSON.parse(o)}catch{}else n=o;return n&&typeof n=="object"&&(Array.isArray(n)&&n.length===0||!Array.isArray(n)&&Object.keys(n).length===0)||yt(e,t,n),n}var tl=["payload","value","content","entries","snapshot","state","record"],Fi=["iso","timestamp","time"];function ti(e){try{return JSON.stringify(e)}catch(t){return console.warn("Unable to serialize normalized migration backup payload",t),null}}function rl(e,t){const r=typeof t=="string"&&t?t:null;if(typeof e=="string"){const o=e.trim();if(!o)return{value:r||new Date().toISOString(),changed:!0};const i=Number(o);if(!Number.isNaN(i)&&Number.isFinite(i)&&String(i)===o)try{return{value:new Date(i).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}const s=Date.parse(o);if(!Number.isNaN(s))try{const a=new Date(s).toISOString();return{value:a,changed:a!==o}}catch{return{value:r||new Date().toISOString(),changed:!0}}return{value:o,changed:o!==e}}if(typeof e=="number"&&Number.isFinite(e))try{return{value:new Date(e).toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}if(e instanceof Date){const o=e.getTime();if(Number.isFinite(o))try{return{value:e.toISOString(),changed:!0}}catch{return{value:r||new Date().toISOString(),changed:!0}}}return r?{value:r,changed:!0}:{value:new Date().toISOString(),changed:!0}}function Lm(e,t){if(typeof e!="string"||!e)return null;const r=typeof t=="string"&&t?t:new Date().toISOString();let n;try{n=JSON.parse(e)}catch{return ti({createdAt:r,data:e})}if(!n||typeof n!="object")return ti({createdAt:r,data:n===void 0?e:n});if(Array.isArray(n)){let f=!1;const u=n.map(y=>{if(!y||typeof y!="object")return f=!0,{createdAt:r,data:y};const p=Object.prototype.hasOwnProperty.call(y,"data"),d=y.createdAt,{value:m,changed:g}=rl(d,r);return p?g||d!==m?(f=!0,{...y,createdAt:m}):y:(f=!0,{createdAt:m,data:y})});return f?ti(u):null}let o,i=!1;if(Object.prototype.hasOwnProperty.call(n,"data"))o={...n};else{let f=null;for(let u=0;u<tl.length;u+=1){const y=tl[u];if(Object.prototype.hasOwnProperty.call(n,y)){f=y;break}}f?(o={...n},o.data=n[f],delete o[f],i=!0):(o={data:n},i=!0)}let s=o.createdAt,a="createdAt";if(s===void 0)for(let f=0;f<Fi.length;f+=1){const u=Fi[f];if(Object.prototype.hasOwnProperty.call(n,u)){s=n[u],a=u;break}}const{value:c,changed:l}=rl(s,r);return o.createdAt=c,a!=="createdAt"&&a&&Object.prototype.hasOwnProperty.call(o,a)&&(delete o[a],i=!0),l&&(i=!0),i?ti(o):null}function Rm(e,t,r,n){const o=Lm(r,n);if(o===null)return!0;if(typeof o!="string"||!o)return!1;if(o===r)return!0;try{return e.setItem(t,o),!0}catch(i){return console.warn(`Unable to normalize legacy migration backup for ${t}`,i),!1}}function yt(e,t,r){if(!e||typeof e.setItem!="function"||r==null)return;const n=`${t}${cn}`;let o=!1;if(typeof e.getItem=="function")try{const d=e.getItem(n);if(d!=null){o=!0;const m=new Date().toISOString();Rm(e,n,d,m)}}catch(d){console.warn(`Unable to inspect migration backup for ${t}`,d)}if(o)try{const d=e.getItem(n),m=nr(d);let g=null;try{g=JSON.parse(m)}catch(k){g=m}let b=Array.isArray(g)?g:[g];const P={createdAt:new Date().toISOString(),data:r};b.push(P);const A=5;b.length>A&&(b=b.slice(b.length-A));const O=k=>{try{return e.setItem(n,JSON.stringify(k)),{success:!0}}catch(j){return{success:!1,quota:Tt(j),error:j}}};let _=O(b);for(;!_.success&&_.quota&&b.length>1;)b.shift(),console.warn(`Pruning oldest migration backup for ${t} due to quota limit.`),_=O(b);if(_.success)return;if(!_.success&&_.quota){const k=el(e,t,n,()=>O(b));if(k&&k.success)return}console.warn("Unable to append to migration backup",_.error);return}catch(d){console.warn("Unable to append to migration backup",d);return}let i;const s=new Date().toISOString();try{i=JSON.stringify({createdAt:s,data:r})}catch(d){console.warn(`Unable to serialize migration backup for ${t}`,d);return}const a=(d,m={})=>{const{logCompression:g=!1,info:b=null}=m||{};try{if(e.setItem(n,d.serialized),g&&b&&!a.compressionLogged){a.compressionLogged=!0;const P=typeof b.serializedLength=="number"?b.serializedLength:b.compressedSize,A=b.originalSize-P,O=A>0?A:0,_=b.originalSize>0?Math.round(O/b.originalSize*100):0,k=`Stored compressed migration backup for ${t} to reduce storage usage by ${O} characters (${_}%) using ${b.variant||"unknown"} variant.`;us("migration-backup",t,k,O,_)}return{success:!0,quota:!1}}catch(P){return{success:!1,quota:Tt(P),error:P}}};a.compressionLogged=a.compressionLogged||!1;const c={serialized:i},l=a(c);if(l.success)return;const f=d=>{console.warn(`Unable to create migration backup for ${t}`,d)};if(!l.quota){f(l.error);return}const y=!mf(t)?wm(i,s):null,p=(d,m,g)=>{const b=el(e,t,n,()=>a(d,m));if(b&&b.success)return!0;const P=b&&b.error?b.error:g;return f(P),ce("migration-backup-quota"),!1};if(y){const d=a(y,{logCompression:!0,info:y});if(d.success)return;if(!d.quota){f(d.error);return}return p(y,{logCompression:!0,info:y},d.error),void 0}p(c,{},l.error)}var nl=[Ze,pt,er,Mr,pe,et,dt,Br,an,ut,Dt,Ot,Qe,pr,Ut,Kt,Fe],ol=[rt,nn(),"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",zt,lt],_n="__cameraPowerPlannerStorageAlertShown",mi="__cameraPowerPlannerSessionFallbackAlertShown",hi=!1;h&&(typeof h[_n]=="boolean"?hi=h[_n]:h[_n]=!1);var na=!1;h&&(typeof h[mi]=="boolean"?na=h[mi]:h[mi]=!1);var Tm=["cameras","monitors","video","viewfinders","directorMonitors","iosVideo","videoAssist","media","lenses","batteries","batteryHotswaps","wirelessReceivers"],Mm=["motors","handUnits","controllers","distance"],Nm=["chargers","cages","powerPlates","cameraSupport","matteboxes","filters","rigging","batteries","cables","videoAssist","media","cardReaders","tripodHeads","tripods","sliders","cameraStabiliser","grip","carts"],Gm=()=>typeof navigator<"u"&&navigator&&typeof navigator.storage=="object"?navigator.storage:null,il="__storage_test__",zm=new Set(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"]),Bm=new Set([22,1014]),xm=new Set([22,1014]);function Tt(e){return!e||typeof e!="object"?!1:!!(typeof e.code=="number"&&Bm.has(e.code)||typeof e.number=="number"&&xm.has(e.number)||typeof e.name=="string"&&zm.has(e.name))}function Fm(e){if(!e)return!1;try{if(typeof e.length=="number"&&e.length>0)return!0}catch(t){console.warn("Unable to read storage length after quota error",t)}if(typeof e.getItem=="function")try{for(let t=0;t<nl.length;t+=1){const r=nl[t],n=_t(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;const s=`${i}${he}`;if(e.getItem(s)!==null)return!0}}for(let t=0;t<ol.length;t+=1){const r=ol[t],n=_t(r);for(let o=0;o<n.length;o+=1){const i=n[o];if(e.getItem(i)!==null)return!0;if(Lt.has(i)){const s=`${i}${he}`;if(e.getItem(s)!==null)return!0}}}}catch(t){console.warn("Unable to inspect known storage keys after quota error",t)}if(typeof e.key=="function")try{const t=typeof e.length=="number"?e.length:0;for(let r=0;r<t;r+=1){const n=e.key(r);if(typeof n=="string"&&n)return!0}}catch(t){console.warn("Unable to iterate storage keys after quota error",t)}return!1}function Di(e){if(!e)return null;try{e.setItem(il,"1")}catch(t){if(Tt(t)&&Fm(e))return console.warn("localStorage quota exceeded. Existing planner data will remain available but new saves may fail.",t),e;throw t}try{e.removeItem(il)}catch(t){console.warn("Unable to clean up storage test key",t)}return e}function Pf(){let e={};return{get length(){return Object.keys(e).length},key(t){const r=Object.keys(e);return t>=0&&t<r.length?r[t]:null},getItem(t){return Object.prototype.hasOwnProperty.call(e,t)?ln(e[t]):null},setItem(t,r){e[t]=String(r)},removeItem(t){delete e[t]},clear(){e={}},keys(){return Object.keys(e)}}}function _f(){const e=qu();for(let t=0;t<e.length;t+=1){const r=e[t];if(r)try{const n=Di(r);if(n)return jr=null,{storage:n,type:"local"}}catch(n){console.warn("localStorage is unavailable:",n),jr=r}}if(typeof window<"u")try{if("sessionStorage"in window){const t=Di(window.sessionStorage);if(t)return Jr(t),console.warn("Falling back to sessionStorage; data persists for this tab only."),Lf(),{storage:t,type:"session"}}}catch(t){console.warn("sessionStorage fallback is unavailable:",t)}return ce(),{storage:Pf(),type:"memory"}}var jr=null,D=_f();function Dm(e,t){const r=[],n=[];return!e||!t||typeof t.setItem!="function"?{migratedKeys:r,failedKeys:n}:(Object.keys(e).forEach(o=>{const i=e[o];if(i==null)return;let s=null,a=!1;try{s=t.getItem(o),a=!0}catch(c){console.warn("Unable to inspect localStorage during upgrade",o,c)}if(a&&s!==null&&s!==void 0&&s!==i&&yt(t,o,s),a&&s===i){r.push(o);return}try{t.setItem(o,i),r.push(o)}catch(c){console.warn("Unable to migrate storage key during upgrade",o,c),n.push(o)}}),{migratedKeys:r,failedKeys:n})}function Um(e,t,r){if(!e||!t||typeof t.removeItem!="function")return;(Array.isArray(r)&&r.length>0?r:Object.keys(e)).forEach(o=>{try{t.removeItem(o)}catch(i){console.warn("Unable to remove migrated storage key from fallback",o,i)}})}function Km(e,t){!e||typeof e.removeItem!="function"||!Array.isArray(t)||t.forEach(r=>{try{e.removeItem(r)}catch(n){console.warn("Unable to roll back migrated storage key after upgrade failure",r,n)}})}function ec(e,t={}){const r=Object.create(null);if(!e)return r;const{suppressAlerts:n=!1}=t||{},o=i=>{if(typeof i!="string"||!i)return;let s;try{typeof e.getItem=="function"?s=e.getItem(i):Object.prototype.hasOwnProperty.call(e,i)&&(s=e[i])}catch(a){console.warn("Unable to read storage key during snapshot",i,a),n||ce("migration-read");return}s!=null&&(r[i]=String(s))};if(typeof e.key=="function"&&typeof e.length=="number"){for(let i=0;i<e.length;i+=1)o(e.key(i));return r}if(typeof e.keys=="function"){try{const i=e.keys();Array.isArray(i)&&i.forEach(o)}catch(i){console.warn("Unable to enumerate storage keys during snapshot",i),n||ce("migration-read")}return r}if(typeof e.forEach=="function"){try{e.forEach((i,s)=>{typeof s=="string"&&i!=null&&(r[s]=String(i))})}catch(i){console.warn("Unable to iterate storage entries during snapshot",i),n||ce("migration-read")}return r}return Object.keys(e).forEach(o),r}function kf(){if(!(!h||typeof h!="object"))try{Object.defineProperty(h,"SAFE_LOCAL_STORAGE",{configurable:!0,get:T});return}catch{try{h.SAFE_LOCAL_STORAGE=T();return}catch(t){console.warn("Unable to refresh SAFE_LOCAL_STORAGE global reference",t)}}}function be(e,t,r){if(!D||D.type==="memory")return;const n=D.storage;if(!n||r&&r!==n)return;let o=Object.create(null);try{o=ec(n,{suppressAlerts:!0})}catch(c){console.warn("Unable to capture storage snapshot during downgrade",c)}let i=null,s="memory";if(D.type!=="session"){const c=[h,h&&h.window?h.window:null,h&&h.__cineGlobal?h.__cineGlobal:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let l=0;l<c.length;l+=1){const f=qa(c[l]);if(!(!f||f===n||r&&f===r))try{const u=Di(f);if(u){i=u,s="session",Jr(u);break}}catch(u){console.warn("Unable to activate sessionStorage fallback during downgrade",u)}}}i||(i=Pf()),Object.keys(o).forEach(c=>{const l=o[c];if(l!=null)try{typeof i.setItem=="function"?i.setItem(c,l):i[c]=l}catch(f){console.warn(`Unable to copy storage entry to ${s==="session"?"sessionStorage":"memory"} during downgrade`,c,f)}}),D={storage:i,type:s},jr=null;const a=s==="session"?"sessionStorage":"in-memory fallback";console.warn(e?`Downgraded planner storage to ${a} after ${e} errors.`:`Downgraded planner storage to ${a} after storage errors.`,t),s==="session"&&Lf(),kf()}function $m(){if(!D||D.type==="local")return D.storage;const e=qu(),t=D.storage;let r=null,n=null;for(let a=0;a<e.length;a+=1){const c=e[a];if(!c||c===t||c===jr)continue;let l;try{l=Di(c)}catch(f){console.warn("localStorage upgrade verification failed",f),jr=c;continue}if(!l||l===t){l||(jr=c);continue}r=c,n=l;break}if(!n)return t;const o=ec(t),{migratedKeys:i,failedKeys:s}=Dm(o,n);return s.length>0?(Km(n,i),console.warn("Aborting localStorage upgrade because some entries could not be migrated. Continuing to use fallback storage.",s),ce("migration-write"),jr=r||n,t):(Um(o,t,i),D={storage:n,type:"local"},jr=null,n)}function T(){if(C&&C.driver&&C.driver.storage)return C.driver.storage;(!D||!D.storage)&&(D=_f(),typeof console<"u"&&console.log&&console.log("DEBUG: storage initialized with type:",D.type)),D.type!=="local"&&$m();const e=D.storage;return console.log("DEBUG: getSafeLocalStorage returning",e&&"object"),e}kf();jm();var ro=null;function vf(){const e=Gm();if(!(e&&typeof e.persist=="function"))return Promise.resolve({supported:!1,granted:!1,alreadyGranted:!1});if(ro)return ro;const n=(async()=>{let o=!1;const i=typeof e.persisted=="function";if(i)try{o=await e.persisted()}catch(s){console.warn("Unable to determine persistent storage state",s)}if(o)return{supported:!0,granted:!0,alreadyGranted:!0};try{const s=await e.persist();if(!s&&i)try{if(await e.persisted())return{supported:!0,granted:!0,alreadyGranted:!0}}catch(a){console.warn("Unable to verify persistent storage after request",a)}return{supported:!0,granted:s,alreadyGranted:!1}}catch(s){return console.warn("Persistent storage request failed",s),{supported:!0,granted:!1,alreadyGranted:!1,error:s}}})().then(o=>((!o||o.granted!==!0)&&(ro=null),o),o=>{throw ro=null,o});return ro=n,n}typeof window<"u"&&typeof navigator<"u"&&vf();function E(e){if(e===null||typeof e!="object")return!1;let t;try{t=Object.getPrototypeOf(e)}catch{return!1}if(t===null||t===Object.prototype)return!0;if(Object.getPrototypeOf(t)===null&&typeof t.constructor=="function"){const n=t.constructor.name;return n==="Object"||n===""}return!1}function re(e){if(!e||typeof e!="object")return!1;if(Object.prototype.toString.call(e)==="[object Map]")return!0;if(typeof Map<"u")try{if(e instanceof Map)return!0}catch{}return typeof e.size=="number"&&typeof e.entries=="function"&&typeof e.forEach=="function"&&typeof e.get=="function"&&typeof e.set=="function"}function jf(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(typeof e=="symbol")return e.description||e.toString();if(e&&typeof e=="object")try{const t=JSON.stringify(e);if(t&&t!=="{}")return t}catch{}try{return String(e)}catch{}return null}function ne(e){if(!re(e))return null;const t=Object.create(null),r=(o,i)=>{const s=jf(o);s!=null&&(Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i))};let n=!1;if(typeof e.entries=="function")try{const o=e.entries();if(o&&typeof o.next=="function"){for(let i=o.next();!i.done;i=o.next()){const s=i&&i.value;Array.isArray(s)&&s.length>=2&&r(s[0],s[1])}n=!0}}catch(o){console.warn("Unable to iterate map-like value entries",o)}if(!n&&typeof e.forEach=="function")try{e.forEach((o,i)=>{r(i,o)}),n=!0}catch(o){console.warn("Unable to iterate map-like value via forEach",o)}return!Object.keys(t).length&&!n?null:t}var jo=/^long[\s_-]?gop$/i;function sl(e){if(typeof e!="string")return null;var t=e.trim();if(!t)return null;var r=t.toLowerCase();return r==="utf16"||r==="utf-16"?"utf16":r==="uri-component"||r==="uri_component"||r==="encoded-uri-component"||r==="uri"?"uri-component":r==="base64"?"base64":jo.test(r)?"utf16":null}function al(e){if(typeof e!="string")return e;const t=e.trim();return jo.test(t)?"long-gop":e}function Vm(e){return typeof e!="string"?e:jo.test(e)?"long-gop":e}function ue(e,t){if(e===null||typeof e!="object")return al(e);const r=t||new WeakSet;if(r.has(e))return e;if(r.add(e),Array.isArray(e)){let n=!1;const o=e.map(i=>{const s=ue(i,r);return s!==i&&(n=!0),s});return n?o:e}if(E(e)){let n=!1;const o={};return Object.keys(e).forEach(i=>{const s=Vm(i),a=e[i],c=ue(a,r);(s!==i||c!==a)&&(n=!0),o[s]=c}),n?o:e}return al(e)}function Ui(e){if(!Array.isArray(e))return{normalized:Array.isArray(e)?e:[],changed:!1};let t=!1;return{normalized:e.map(n=>{if(n==null)return n;const o=ue(n);return o!==n&&(t=!0),o}),changed:t}}function tc(e){if(typeof e!="string")return{timestamp:Number.NEGATIVE_INFINITY,label:""};const t=(r,n={})=>{const i=e.slice(r.length).split("-");if(i.length<5)return null;const[s,a,c,l,f]=i,u=Number.parseInt(s,10),y=Number.parseInt(a,10)-1,p=Number.parseInt(c,10),d=Number.parseInt(l,10),m=Number.parseInt(f,10);if([u,y,p,d,m].some(k=>Number.isNaN(k)))return null;let g=!1,b=0,P=5;if(i.length>P){const k=i[P];if(/^\d{1,2}$/u.test(k))g=!0,b=Number.parseInt(k,10),P+=1;else if(n.requireSeconds)return null}else if(n.requireSeconds)return null;const A=i.slice(P).join("-").trim(),_=new Date(u,y,p,d,m,g?b:0,0).getTime();return Number.isNaN(_)?null:{timestamp:_,label:A}};if(e.startsWith(De)){const r=t(De);return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}if(e.startsWith(Pt)){const r=t(Pt,{requireSeconds:!1});return r||{timestamp:Number.NEGATIVE_INFINITY,label:""}}return{timestamp:Number.NEGATIVE_INFINITY,label:""}}function Ki(e,t){return!E(e)||typeof t!="string"?[]:Object.keys(e).filter(r=>typeof r=="string"&&r.startsWith(t)).map(r=>{const{timestamp:n,label:o}=tc(r);return{key:r,timestamp:n,label:o}}).sort((r,n)=>r.timestamp!==n.timestamp?r.timestamp-n.timestamp:r.key.localeCompare(n.key))}function Hm(e){if(!(!e||typeof e!="object")){try{e[Xr]=!0}catch{try{Object.defineProperty(e,Xr,{configurable:!0,enumerable:!0,writable:!0,value:!0})}catch{}}if(E(e.projectInfo))try{e.projectInfo[Xr]=!0}catch{}}}function qm(e){return!e||typeof e!="object"?!1:!!(e[Xr]===!0||E(e.projectInfo)&&e.projectInfo[Xr]===!0)}function rc(e,t){return!E(e)||typeof t!="string"?!1:qm(e[t])}function If(e){if(!e||typeof e!="object")return"";if(typeof e.label=="string"){const t=e.label.trim();if(t)return t}if(typeof e.key=="string"&&e.key.trim()){const t=e.key.trim();return t.startsWith(De)||t.startsWith(Pt)?"__auto-backup:unlabeled__":t}return"__auto-backup:unlabeled__"}function Wm(e,t){if(!E(e)||!t||typeof t.key!="string")return"undefined";const r=Object.prototype.hasOwnProperty.call(e,t.key)?e[t.key]:void 0;try{let n=r;if(E(r)&&r[Cn]){const i=me(r,{stripMetadata:!0}),s=i[Cn];if(s&&typeof s=="object")try{const a=ta(s,t.key);s.payload=a.payload,Object.prototype.hasOwnProperty.call(s,"payloadCompression")&&delete s.payloadCompression}catch(a){console.warn("Failed to expand automatic backup payload for signature comparison",t.key,a)}n=i}const o=ea(n,{stripMetadata:!0});return Pe(o)}catch(n){return console.warn("Failed to create stable signature for automatic backup entry",n),"undefined"}}function Pe(e,t){const r=t||(typeof WeakSet=="function"?{seen:new WeakSet,reportedCycle:!1}:null),n=r&&r.seen?r.seen:null,o=(i,s)=>{if(!n)return s();if(n.has(i))return!r.reportedCycle&&typeof console<"u"&&console&&typeof console.warn=="function"&&console.warn("Detected circular reference while computing automatic backup signature. Using a placeholder token to keep backups stable."),r.reportedCycle=!0,pf;n.add(i);try{return s()}finally{n.delete(i)}};if(e===null)return"null";if(e===void 0)return"undefined";if(Array.isArray(e))return o(e,()=>{let i="[";for(let s=0;s<e.length;s+=1)s>0&&(i+=","),i+=Pe(e[s],r);return i+="]",i});if(e instanceof Date)return o(e,()=>{const i=e.getTime();return Number.isNaN(i)?"date:invalid":`date:${i}`});if(E(e))return o(e,()=>{const i=Object.keys(e).sort();let s="{";for(let a=0;a<i.length;a+=1){const c=i[a];a>0&&(s+=","),s+=`${JSON.stringify(c)}:${Pe(e[c],r)}`}return s+="}",s});if(e&&typeof e=="object")return o(e,()=>`${typeof e}:${String(e)}`);if(typeof e=="number")return Number.isNaN(e)?"number:NaN":Number.isFinite(e)?`number:${e}`:e>0?"number:Infinity":"number:-Infinity";if(typeof e=="bigint")return`bigint:${e.toString()}`;if(typeof e=="boolean")return e?"boolean:true":"boolean:false";if(typeof e=="string"){const i=Vo(e);if(i.success&&typeof i.value=="string")try{const s=JSON.parse(i.value);return Pe(s,r)}catch(s){console.warn("Unable to decode compressed string while computing stable value signature",s)}return`string:${e}`}return typeof e=="symbol"?`symbol:${String(e)}`:typeof e=="function"?`function:${e.name||"anonymous"}`:`${typeof e}:${String(e)}`}function oa(e,t){if(!E(e)||!Array.isArray(t)||t.length<2)return null;const r=new Map;for(let n=t.length-1;n>=0;n-=1){const o=t[n];if(!o||typeof o.key!="string"||rc(e,o.key))continue;const i=If(o);let s=r.get(i);s||(s=new Map,r.set(i,s));const a=Object.prototype.hasOwnProperty.call(e,o.key)?e[o.key]:void 0,c=Pe(a),l=s.get(c);if(l&&typeof l.key=="string")return delete e[o.key],t.splice(n,1),typeof console<"u"&&typeof console.info=="function"&&console.info("Removed duplicate automatic backup while preserving newer copy.",{removedKey:o.key,preservedKey:l.key,label:i}),o.key;s.set(c,{key:o.key,signature:c})}return null}function cl(e,t){const r=[];for(;;){const n=oa(e,t);if(!n)break;r.push(n)}return r}function ll(e,t,r,n){if(!E(e)||!Array.isArray(t)||t.length<=r)return;const o=new Map;for(let s=0;s<t.length;s+=1){const a=t[s];if(!a||typeof a.key!="string")continue;const c=If(a),l=Wm(e,a),f=`${c}__${l}`,u=o.get(f);u?u.push(s):o.set(f,[s])}const i=Array.from(o.values()).filter(s=>Array.isArray(s)&&s.length>1).flatMap(s=>s.slice(0,-1)).sort((s,a)=>s-a);if(!i.length){t.length>r&&console.warn("Skipped trimming automatic backups because all remaining versions are unique.",{limit:r,total:t.length});return}for(let s=i.length-1;s>=0&&t.length>r;s-=1){const a=i[s],c=t[a];!c||typeof c.key!="string"||rc(e,c.key)||(delete e[c.key],t.splice(a,1),n.push(c.key))}t.length>r&&console.warn("Unable to trim automatic backups down to the configured limit without losing unique data.",{limit:r,remaining:t.length})}function nc(e){if(!E(e))return[];const t=[],r=Ki(e,De);t.push(...cl(e,r)),r.length>bn&&ll(e,r,bn,t);const n=Ki(e,Pt);return t.push(...cl(e,n)),n.length>Yc&&ll(e,n,Yc,t),t.length>0&&console.warn(`Removed ${t.length} older automatic backup${t.length>1?"s":""} to stay within storage limits.`,t),t}function ia(e,t={}){if(!E(e))return null;const{force:r=!1}=t,n=(f,{respectRename:u=!0}={})=>{if(!Array.isArray(f)||f.length===0)return null;for(let y=0;y<f.length;y+=1){const p=f[y];if(!p||typeof p.key!="string")continue;const d=Object.prototype.hasOwnProperty.call(e,p.key),m=d?e[p.key]:void 0;if(!d||m===void 0||m===null||typeof m!="object")return delete e[p.key],p.key;if(!(u&&rc(e,p.key)))return delete e[p.key],p.key}return null},o=Ki(e,De),i=oa(e,o);if(i)return i;const s=Ki(e,Pt),a=oa(e,s);if(a)return a;const c=n(s,{respectRename:!1});if(c)return c;s.length>0&&console.warn("Unable to free space by removing pre-deletion backups because all copies appear to be protected.");const l=n(o,{respectRename:!r});return l||(o.length>0&&console.warn("Unable to free space by removing automatic backups because the remaining copies were renamed or protected."),null)}function Ym(e){if(!e||typeof e!="object")return"";if(typeof e.note=="string"){const t=e.note.trim();if(t)return t}if(typeof e.createdAt=="string"){const t=e.createdAt.trim();if(t)return t}return typeof e.id=="string"?e.id:""}function sa(e){if(!Array.isArray(e)||e.length===0)return null;const t=r=>{const[n]=e.splice(r,1);return{removed:n,label:Ym(n)}};for(let r=e.length-1;r>=0;r-=1){const n=e[r];if(!n||typeof n!="object"||!Array.isArray(n.rules))return t(r)}return t(e.length-1)}function Jm(e){if(!e||typeof e.getItem!="function"||typeof e.removeItem!="function")return!1;const t=`${ut}${cn}`,r=[];try{const n=e.getItem(t);n!=null&&(e.removeItem(t),r.push(t))}catch(n){console.warn("Unable to inspect automatic gear backup migration snapshot while recovering storage quota.",n)}try{const n=Cf(e,t);Array.isArray(n)&&n.length>0&&r.push(...n)}catch(n){console.warn("Unable to prune migration backups while recovering storage for automatic gear backups.",n)}return r.length>0?(console.warn(`Removed ${r.length} migration backup${r.length>1?"s":""} while freeing storage for automatic gear backups.`,r),!0):!1}function aa(){if(typeof sn!="function")return!1;try{return sn(),console.warn("Cleared cached planner data to free up storage space before saving automatic gear backups."),!0}catch(e){console.warn("Unable to clear cached planner data while recovering storage for automatic gear backups.",e)}return!1}function Qm(e){return e?!(e==="migration-read"&&typeof D<"u"&&D&&D.type&&D.type!=="memory"):!0}function ce(e){if(!Qm(e)||(h&&typeof h[_n]=="boolean"&&(hi=h[_n]),hi)||(hi=!0,h&&(h[_n]=!0),typeof window>"u"||typeof window.alert!="function"))return;let t="Storage error: Unable to access local data. Changes may not be saved.";try{if(typeof window<"u"&&window.texts){const r=window.texts,n=window.currentLang||"en",o=r[n]?n:"en";t=r[o]?.alertStorageError||t}}catch{}window.alert(t)}function Lf(){if(na||(na=!0,h&&(h[mi]=!0),typeof window>"u"||typeof window.alert!="function"))return;let e="Warning: Local storage is unavailable. Data will only persist for this browser tab.";try{if(typeof window<"u"&&window.texts){const t=window.texts,r=window.currentLang||"en",n=t[r]?r:"en";e=t[n]?.alertSessionFallback||e}}catch{}window.alert(e)}function $i(e){if(typeof window>"u")return null;try{return window[e]}catch(t){return console.warn(`Unable to access ${e} during legacy migration`,t),null}}function ca(e){if(!Array.isArray(e)||e.length===0)return[];const t=[],r=new Set;for(let n=0;n<e.length;n+=1){const o=e[n];!o||typeof o.getItem!="function"||r.has(o)||(r.add(o),t.push(o))}return t}function Xm(e,t,r,n,o={}){if(!e||typeof e.getItem!="function")return!1;const{keepLegacy:i=!1}=o;let s;try{s=e.getItem(r)}catch(c){return console.warn(`Unable to read legacy storage key ${r}`,c),ce("migration-read"),!1}if(s==null)return!1;const a=t&&typeof t.setItem=="function"?t:e;try{const c=a.getItem(n);if(c!=null){if(!i&&(e!==a||r!==n))try{e.removeItem(r)}catch(l){console.warn(`Unable to remove legacy storage key ${r}`,l)}return!1}}catch(c){console.warn(`Unable to inspect destination storage for ${n}`,c)}try{a.setItem(n,s)}catch(c){return console.warn(`Unable to migrate legacy storage key ${r}`,c),!1}if(!i)try{e.removeItem(r)}catch(c){console.warn(`Unable to remove legacy storage key ${r} after migration`,c)}return!0}function ri(e,t,r,n,o){let i=!1;for(let s=0;s<e.length;s+=1)Xm(e[s],t,r,n,o)&&(i=!0);return i}function Zm(){const e=T(),t=ca([$i("localStorage"),e]),r=ca([$i("sessionStorage"),typeof sessionStorage<"u"?sessionStorage:null]),n="cinePowerPlanner_";[{legacy:`${n}devices`,modern:Ze},{legacy:`${n}setups`,modern:pt},{legacy:`${n}session`,modern:er,includeSession:!0},{legacy:`${n}feedback`,modern:Mr},{legacy:`${n}project`,modern:pe},{legacy:`${n}projects`,modern:pe},{legacy:`${n}favorites`,modern:et},{legacy:`${n}ownGear`,modern:Gt},{legacy:`${n}schemaCache`,modern:dt},{legacy:`${n}autoGearRules`,modern:Br},{legacy:`${n}autoGearBackups`,modern:ut},{legacy:`${n}autoGearSeeded`,modern:an},{legacy:`${n}autoGearPresets`,modern:Dt},{legacy:`${n}autoGearActivePreset`,modern:Ot},{legacy:`${n}autoGearAutoPreset`,modern:Qe},{legacy:`${n}autoGearShowBackups`,modern:pr},{legacy:`${n}autoGearBackupRetention`,modern:Kt},{legacy:`${n}autoGearMonitorDefaults`,modern:Ut},{legacy:`${n}customFonts`,modern:tr,updateFontKey:!0}].forEach(({legacy:i,modern:s,includeSession:a=!1,updateFontKey:c=!1})=>{const l=ri(t,e,i,s);ri(t,e,`${i}${he}`,`${s}${he}`),a&&(ri(r,null,i,s),ri(r,null,`${i}${he}`,`${s}${he}`)),c&&l&&h&&(h.CUSTOM_FONT_STORAGE_KEY===i&&(h.CUSTOM_FONT_STORAGE_KEY=s),h.CUSTOM_FONT_STORAGE_KEY_NAME===i&&(h.CUSTOM_FONT_STORAGE_KEY_NAME=s))})}function _e(){Zm()}function Rf(e){if(!e||typeof e.getItem!="function")return!1;if(On&&typeof On.has=="function"&&On.has(e))return!0;if(D&&D.type==="session"&&D.storage===e)return Jr(e),!0;const t=T();if(t&&D&&D.type==="session"&&t===e)return Jr(e),!0;const r=[h,h&&h.__cineGlobal?h.__cineGlobal:null,h&&h.window?h.window:null,typeof window<"u"?window:null,typeof self<"u"?self:null,typeof global<"u"?global:null];for(let n=0;n<r.length;n+=1){const o=qa(r[n]);if(o&&o===e)return Jr(o),!0}return!1}function Me(e,t,r,n=null,o={}){if(!e)return n;const{disableBackup:i=!1,backupKey:s,validate:a,restoreIfMissing:c=!1,alertOnFailure:l=null,migrationBackupKey:f}=o||{},u=typeof s=="string"&&s?s:`${t}${he}`,y=!i&&u&&u!==t,p=Wu()||h&&h.__cineJustFactoryReset,d=y&&!p,m=!p,g=(()=>{const M=new Set,G=[],N=$=>{typeof $!="string"||!$||M.has($)||(M.add($),G.push($))};typeof f=="string"&&f&&N(f);const z=_t(t);for(let $=0;$<z.length;$+=1)N(`${z[$]}${cn}`);return G})(),b=Za(e);let P=typeof b=="function"?co(e,t,b):void 0,A=!1;const O=(M,G)=>{if(M==null)return{ok:!1,reason:"missing"};const N=typeof M=="string"?ln(M):M;if(typeof M=="string"&&M&&N===M&&M.includes(`"${dr}":true`)&&M.includes(`"namespace":"${on}`))return console.warn(`${r} Compressed value could not be decoded${G?` (${G})`:""}.`),A=!0,{ok:!1,reason:"compressed"};try{const z=JSON.parse(N);return typeof a=="function"&&!a(z)?(console.warn(`${r} Invalid data${G?` (${G})`:""}.`),A=!0,{ok:!1,reason:"invalid"}):{ok:!0,value:z,raw:M,normalizedRaw:N}}catch(z){return console.error(`${r}${G?` (${G})`:""}`,z),A=!0,{ok:!1,reason:"error"}}};let _=null;try{_=e.getItem(t)}catch(M){console.error(`${r} (read)`,M),be("read access",M,e),A=!0}typeof P>"u"&&typeof b=="function"&&(P=co(e,t,b)),_==null&&P==null&&Zt(e,t);const k=Vg(e,t,_,P);if(k.hit)return k.value;const j=O(_,"");if(j.ok){const M=typeof j.normalizedRaw=="string"&&j.normalizedRaw?j.normalizedRaw:typeof j.raw=="string"&&j.raw?j.raw:null,G=typeof P=="string"&&P?P:typeof j.raw=="string"&&j.raw?j.raw:null;return Ke(e,t,G,M,j.value),j.value}const w=!j.ok&&j.reason==="missing",S=()=>{if(!g.length)return{success:!1,shouldAlert:!1};for(let M=0;M<g.length;M+=1){const G=g[M];let N=null,z;try{N=e.getItem(G)}catch(R){return console.error(`${r} (migration backup read)`,R),be("read access",R,e),{success:!1,shouldAlert:!0}}if(typeof b=="function"&&(z=co(e,G,b)),N==null&&z==null){Zt(e,G);continue}const $=N??z,nt=jn({key:G,value:$,type:"migration-backup"});if(typeof nt>"u")continue;let ye=nt;if(typeof ye=="string"){const R=ye.trim();if(R)try{ye=JSON.parse(R)}catch{}else ye=""}if(typeof a=="function"&&!a(ye)){console.warn(`Ignored migration backup for ${t} because it failed validation.`);continue}Ke(e,G,typeof z=="string"&&z?z:typeof $=="string"&&$?$:null,typeof $=="string"&&$?$:typeof z=="string"&&z?z:null,ye);let ot=null;try{ot=JSON.stringify(ye)}catch(R){console.warn(`Unable to serialize recovered migration backup for ${t}`,R),ot=null}let Dr=null,it=!1;if(ot!==null){let R=ot;const K=typeof ot=="string"?Bn(ot):null;K&&typeof K.serialized=="string"&&(R=K.serialized);try{e.setItem(t,R),Dr=R}catch(V){console.warn(`Unable to restore primary copy for ${t} from migration backup`,V),be("write access",V,e),it=!0}}else it=!0;Dr!==null?Ke(e,t,Dr,ot,ye):ot!==null?Ke(e,t,ot,ot,ye):Ke(e,t,null,null,ye),console.warn(Dr!==null?`Recovered ${t} from migration backup copy.`:`Recovered ${t} from migration backup copy but could not rewrite the primary entry.`);try{e.removeItem(G),Zt(e,G)}catch(R){console.warn(`Unable to remove migration backup ${G} after recovery`,R)}return{success:!0,value:ye,shouldAlert:it}}return{success:!1,shouldAlert:!1}},I=d&&(A||c||w);if(I){let M=null;try{M=e.getItem(u)}catch(z){console.error(`${r} (backup read)`,z),be("read access",z,e),A=!0}const G=typeof b=="function"?co(e,u,b):void 0,N=O(M,"backup");if(N.ok&&((A||w)&&console.warn(`Recovered ${t} from backup copy.`),N.raw!==null&&N.raw!==void 0)){let z=null;try{if(typeof N.raw=="string"){const nt=typeof N.normalizedRaw=="string"&&N.normalizedRaw?N.normalizedRaw:N.raw,ye=Bn(nt);ye&&typeof ye.serialized=="string"?(e.setItem(t,ye.serialized),z=ye.serialized):nt!==N.raw?(e.setItem(t,nt),z=nt):(e.setItem(t,N.raw),z=N.raw)}else e.setItem(t,N.raw),z=typeof N.raw=="string"?N.raw:null}catch(nt){console.warn(`Unable to restore primary copy for ${t} from backup`,nt),z=null}const $=typeof N.normalizedRaw=="string"&&N.normalizedRaw?N.normalizedRaw:typeof N.raw=="string"&&N.raw?N.raw:null,Ht=typeof G=="string"&&G?G:typeof N.raw=="string"&&N.raw?N.raw:null;return Ke(e,u,Ht,$,N.value),typeof z=="string"&&z&&Ke(e,t,z,$,N.value),N.value}}const B=m&&g.length>0&&(w||c||A);if(B){const M=S();if(M.success){if(M.shouldAlert&&(A=!0),g.length){const G=g[0].key;try{e.removeItem(G),e[Gr]&&e.removeItem&&e.removeItem(G)}catch(N){console.warn("Post-migration cleanup error:",N)}}return M.value}M.shouldAlert&&(A=!0)}return A&&ce(l),Zt(e,t),w&&!I&&!B&&console.debug(`[Storage] Returning default for ${t} (No primary, no backups found)`),n}function Ae(e,t,r,n,o={}){if(!e){console.warn("DEBUG: saveJSONToStorage NO STORAGE");return}if(Wu()){console.warn("DEBUG: saveJSONToStorage RESET ACTIVE");return}const{disableBackup:i=!1,backupKey:s,onQuotaExceeded:a,enableCompressionSweep:c=!0,disableCompression:l=!1,forceCompressionOnQuota:f=!1}=o||{},u=typeof s=="string"&&s?s:`${t}${he}`,y=!i&&u&&u!==t,p=Rf(e),d=p||!!l,m=p?!1:f===!0,g=Za(e),b=R=>co(e,R,g);let P,A=!1,O,_=!1,k=!1,j=!1;const w=()=>{P=void 0,A=!1,O=void 0,_=!1,k=!1,j=!1},S=()=>{if(A)return P;A=!0;try{P=JSON.stringify(r)}catch(R){P=null,console.error(n,R),ce()}return P},I=()=>{if(O!==void 0)return O&&typeof O.serialized=="string"?O.serialized:null;const R=S();if(typeof R!="string"||!R)return O=null,null;const K=Bn(R);return!K||typeof K.serialized!="string"?(O=null,null):(O=K,K.serialized)},B=()=>{if(_){const K=I();if(typeof K=="string")return K;_=!1}const R=S();return typeof R=="string"?R:null},M=({force:R=!1}={})=>{const K=R&&m;if(d&&!K)return k=!0,!1;if(_||k&&!K)return!1;k=!0;const V=S();if(typeof V!="string"||!V)return!1;const ke=I();return typeof ke!="string"||!ke||ke.length>=V.length?!1:(_=!0,!0)},G=()=>{if(!_||!O||j)return;const{originalLength:R,wrappedLength:K}=O;if(typeof R=="number"&&typeof K=="number"&&K<R){const V=R-K,ke=R>0?Math.round(V/R*100):0,te=`Stored compressed value for ${t} to reduce storage usage by ${V} characters (${ke}%).`;us("storage-value",t,te,V,ke)}j=!0},N=()=>{if(d){k=!0;return}if(_||k)return;const R=S();if(typeof R!="string"||!R||R.length<hm)return;const K=I();if(typeof K!="string"||!K)return;const V=R.length-K.length;if(V<bm||(R.length>0?V/R.length:0)<Sm)return;const te=b(t);typeof te=="string"&&te===K||(_=!0,k=!0)};let z,$=!1,Ht=!1,nt=0,ye=!1,bs=!1;N();const Vn=()=>(nt+=1,nt>sm?(ye=!0,console.warn(`Exceeded maximum storage recovery attempts while saving ${t}.`),!1):!0),ot=(R,K)=>{if(!R||typeof R.length!="number"||typeof R.key!="function")return{success:!1,freed:0};const{skipKeys:V=[]}=K||{},ke=new Set(V);xt&&rr&&ke.add(rr);const te=[],Ne=R.length;for(let Ge=0;Ge<Ne;Ge+=1){let se;try{se=R.key(Ge)}catch{continue}if(!(!se||ke.has(se))){if(se.endsWith("__legacyMigrationBackup")){te.push({key:se,priority:1,size:0});continue}if(se.endsWith("__backup")){te.push({key:se,priority:2,size:0});continue}if(se===dt||se===Yu){te.push({key:se,priority:3,size:0});continue}if(se.startsWith(Bt)&&se.includes("auto-backup-")){te.push({key:se,priority:4,size:0});continue}}}if(!te.length)return{success:!1,freed:0};te.sort((Ge,se)=>Ge.priority-se.priority);let xe=0,qt=0;for(let Ge=0;Ge<te.length;Ge+=1){const se=te[Ge];try{const Wt=R.getItem(se.key),Hn=Wt?Wt.length:0;if(R.removeItem(se.key),Zt(R,se.key),xe+=Hn,qt+=1,console.warn(`[Storage Cleanup] Removed ${se.key} to free ${Hn} chars.`),xe>5e5)break}catch(Wt){console.warn(`[Storage Cleanup] Failed to remove ${se.key}`,Wt)}}return{success:qt>0,freed:xe}},Dr=(R,K={})=>{if(!Tt(R))return!1;if(typeof a=="function")try{if(a(R,{storage:e,key:t,value:r,...K})===!0)return!0}catch(te){const Ne=K&&K.isBackup?" (backup)":"";console.error(`Error while handling quota exceed for ${t}${Ne}`,te)}if(!bs&&c!==!1){bs=!0;const te=[t];y&&typeof u=="string"&&u&&u!==t&&te.push(u),K&&typeof K.backupKey=="string"&&K.backupKey&&te.push(K.backupKey);const Ne=Of(e,{skipKeys:te});if(Ne&&Ne.success)return!0}const V=[t];y&&typeof u=="string"&&u&&V.push(u);const ke=ot(e,{skipKeys:V});return!!(ke&&ke.success)};let it=0;for(;it<im;){it+=1;const R=B();if(typeof R!="string")return;const K=S(),V=typeof K=="string"&&K?K:null;let ke=!1,te,Ne=!1,xe=null,qt=null,Ge=null;if(typeof e.getItem=="function")try{const oe=e.getItem(t);if(oe===R)ke=!0,qt=R;else if(_){const Le=b(t);typeof Le=="string"&&(qt=Le,Le===R&&(ke=!0))}else typeof oe=="string"&&(qt=oe)}catch(oe){console.warn(`Unable to inspect existing value for ${t}`,oe)}if(y&&typeof e.getItem=="function")try{te=e.getItem(u),Ne=typeof te=="string",Ne&&_?(xe=b(u),typeof xe=="string"&&(Ge=xe)):Ne&&(Ge=te)}catch(oe){console.warn(`Unable to inspect existing backup for ${t}`,oe)}!$&&Ne&&typeof te=="string"&&(z=te,$=!0);const se=(()=>{if(!y)return[];const oe=[];if(_){const Le=S();typeof Le=="string"&&Le&&oe.push({serialized:Le,compressed:!1}),typeof R=="string"&&R&&(!oe.length||oe[oe.length-1].serialized!==R)&&oe.push({serialized:R,compressed:!0})}else typeof R=="string"&&R&&oe.push({serialized:R,compressed:!1});return oe})(),Wt=se.length?se[0]:null,Hn=Ne&&Wt&&typeof Wt.serialized=="string"&&(te===Wt.serialized||typeof xe=="string"&&xe===Wt.serialized);if(ke&&(!y||Hn)){if(V&&(Ke(e,t,_&&typeof qt=="string"&&qt?qt:R,V,r),y&&Ne)){const Le=_&&typeof xe=="string"&&xe?xe:Ge;typeof Le=="string"&&Le&&Ke(e,u,Le,V,r)}return}if(!ke)try{e.setItem(t,R),G(),V&&Ke(e,t,R,V,r)}catch(oe){if(Dr(oe)){if(w(),!Vn())break;it>0&&(it-=1);continue}if(!ye&&M({force:m})){if(!Vn())break;it>0&&(it-=1);continue}console.error(n,oe),be("write access",oe,e),ce();return}if(!y)return;if(Hn){if(V&&Ne){const oe=_&&typeof xe=="string"&&xe?xe:Ge;typeof oe=="string"&&oe&&Ke(e,u,oe,V,r)}return}const wc=(()=>{const oe=se.length?se:[{serialized:R,compressed:_}];let Le=null,Ss=!1,Wo=null;const Ec=mr=>{try{return e.setItem(u,mr.serialized),mr.compressed&&G(),Ht=!1,!0}catch(gt){return Le=gt,!1}};for(let mr=0;mr<oe.length;mr+=1){const gt=oe[mr];if(Wo=gt,Ec(gt)){if(V){const qn=gt.compressed&&V?V:gt.serialized;Ke(e,u,gt.serialized,qn,r)}return"success"}if(!Tt(Le))break;if(!Ss&&Ne)try{if(e.removeItem(u),Zt(e,u),Ss=!0,Ht=!0,Ne=!1,Ec(gt)){if(V){const qn=gt.compressed&&V?V:gt.serialized;Ke(e,u,gt.serialized,qn,r)}return"success"}}catch(qn){console.warn(`Unable to remove previous backup for ${t}`,qn)}}if(Tt(Le)&&(Dr(Le,{serialized:Wo&&typeof Wo.serialized=="string"?Wo.serialized:R,backupKey:u,isBackup:!0})||!ye&&M({force:m})))return w(),Vn()?"retry":"failure";if(Ss&&typeof te=="string")try{e.setItem(u,te),V&&Ke(e,u,te,V,r),Ht=!1}catch(mr){console.warn(`Unable to restore previous backup for ${t}`,mr)}return console.warn(`Unable to update backup copy for ${t}`,Le),ce(),"failure"})();if(wc==="success")return;if(wc==="retry"){it>0&&(it-=1);continue}if(ye)break;return}if($&&Ht&&typeof z=="string")try{e.setItem(u,z),Zt(e,u)}catch(R){console.warn(`Unable to restore preserved backup for ${t}`,R)}console.error(n,new Error("Unable to save value after multiple attempts.")),ce()}function Ee(e,t,r,n={}){if(!e)return;C&&C.removeItem(t).catch(()=>{});const{disableBackup:o=!1,backupKey:i,disableMigrationCleanup:s=!1}=n||{},a=typeof i=="string"&&i?i:`${t}${he}`,c=!o&&a&&a!==t;Zt(e,t),c&&Zt(e,a),t===pe&&fr();try{e.removeItem(t)}catch(l){console.error(r,l),be("deletion",l,e),ce()}if(c)try{e.removeItem(a)}catch(l){console.error(`${r} (backup)`,l),be("deletion",l,e),ce()}if(!s){const l=`${t}${cn}`;try{e.removeItem(l)}catch(f){console.warn(`Unable to remove migration backup for ${t}`,f)}}}var eh=[dt,Yu],ni=new Set;function th(){const e=[],t=new Set,r=i=>{!i||typeof i.getItem!="function"||e.push(i)},n=(i,s,a)=>{if(!i||typeof i!="object"&&typeof i!="function")return null;try{return i[s]}catch(c){return a&&!ni.has(a)&&(ni.add(a),console.warn(`Unable to access ${a} while clearing UI caches`,c)),null}},o=(i,s)=>{if(!i||t.has(i))return;t.add(i),r(n(i,"SAFE_LOCAL_STORAGE",`${s}.SAFE_LOCAL_STORAGE`)),r(n(i,"localStorage",`${s}.localStorage`)),r(n(i,"sessionStorage",`${s}.sessionStorage`));const a=n(i,"__cineGlobal",`${s}.__cineGlobal`);a&&a!==i&&o(a,`${s}.__cineGlobal`)};o(typeof globalThis<"u"?globalThis:null,"globalThis"),o(typeof window<"u"?window:null,"window"),o(typeof self<"u"?self:null,"self"),o(typeof global<"u"?global:null,"global"),h&&h.__cineGlobal&&o(h.__cineGlobal,"__cineGlobal"),D&&D.storage&&r(D.storage),typeof T=="function"&&T()&&r(T());try{r(T())}catch(i){ni.has("getSafeLocalStorage")||(ni.add("getSafeLocalStorage"),console.warn("Unable to access safe local storage while clearing UI caches",i))}return r($i("localStorage")),r($i("sessionStorage")),typeof localStorage<"u"&&r(localStorage),typeof sessionStorage<"u"&&r(sessionStorage),ca(e)}function sn(){const e=th();e.length&&eh.forEach(t=>{C&&C.removeItem(t).catch(r=>console.warn("Failed to clear UI cache from repo",r)),!(typeof t!="string"||!t)&&e.forEach(r=>{Ee(r,t,`Failed to clear UI cache entry ${t}`)})})}function Tf(e,t,r){if(!e)return!1;try{return e.getItem(t)==="1"}catch(n){return console.error(r,n),be("read access",n,e),ce(),!1}}function Mf(e,t,r,n){if(e)try{r?e.setItem(t,"1"):e.removeItem(t)}catch(o){console.error(n,o),be("write access",o,e),ce()}}function rh(e,t,r,n,o,i,s,a){const c=Me(e,r,n,null,a);if(c!==null)return c;if(!t)return null;const l={...a||{},alertOnFailure:"migration-read"},f=Me(t,r,o,null,l);return f!==null?(Ae(e,r,f,i),Ee(t,r,s),f):null}function gs(e,t,r){const n=e.trim();let o=n,i=2;const s=r||new Set([...t].map(c=>c.trim().toLowerCase()));let a=n.toLowerCase();for(;s.has(a);)o=`${n} (${i++})`,a=o.toLowerCase();return t.add(o),s.add(a),o}function nh(e){const t=typeof e=="string"?e.trim():"";if(!t)return"Project-imported";const r=t.match(/^(.*?)-imported(?:-(\d+))?$/i);if(r){const n=typeof r[1]=="string"?r[1].trim():"";return n?`${n}-imported`:"Project-imported"}return t.toLowerCase().endsWith("-imported")?t:`${t}-imported`}function oh(e){const t=typeof e=="string"?e.trim():"",r=nh(e);if(!t)return{base:r,initialCandidate:r,suffixStart:2};const n=t.match(/^(.*?)-imported(?:-(\d+))?$/i),o=n&&n[2]?Number(n[2]):NaN,i=Number.isFinite(o)?o+1:2;return n?{base:r,initialCandidate:t,suffixStart:i}:{base:r,initialCandidate:r,suffixStart:2}}function ih(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=oh(e);let i=typeof o.initialCandidate=="string"?o.initialCandidate.trim():"";i||(i=o.base||"Project-imported");let s=i.trim().toLowerCase(),a=o.suffixStart;for(;s&&n.has(s);)i=`${o.base||"Project-imported"}-${a++}`,s=i.trim().toLowerCase();return t.add(i),s&&n.add(s),i}function sh(e){const t=typeof e=="string"?e.trim():"";return t?t.toLowerCase().endsWith("-updated")?t:`${t}-updated`:"Project-updated"}function no(e,t,r){const n=r||new Set([...t].map(c=>typeof c=="string"?c.trim().toLowerCase():"").filter(c=>c)),o=sh(e);let i=o,s=2,a=i.trim().toLowerCase();for(;a&&n.has(a);)i=`${o}-${s++}`,a=i.trim().toLowerCase();return i}function ah(e){if(e==null)return[];if(typeof e=="string"){const t=e.trim();return t?[t]:[]}return Array.isArray(e)?e.filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):E(e)?Object.values(e).filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>t):[]}function ch(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}function la(e){if(!e||typeof e!="object")return{};const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(!n||typeof n!="object")return;const o=Number(n.x),i=Number(n.y);!Number.isFinite(o)||!Number.isFinite(i)||(t[r]={x:o,y:i})}),t}function lh(e,t){const r=Object.keys(e||{}),n=Object.keys(t||{});if(r.length!==n.length)return!1;for(let o=0;o<r.length;o+=1){const i=r[o];if(!Object.prototype.hasOwnProperty.call(t||{},i))return!1;const s=e[i],a=t[i];if(!s||typeof s!="object"||!a||typeof a!="object"||Number(s.x)!==a.x||Number(s.y)!==a.y)return!1}return!0}function uh(e){if(!E(e))return{state:null,changed:!1};const t={...e};let r=!1;const n=s=>{if(!Object.prototype.hasOwnProperty.call(t,s))return;const a=t[s];if(typeof a=="string"){const c=a.trim();c!==a&&(t[s]=c,r=!0);return}if(a==null){t[s]="",r=!0;return}if(typeof a=="number"||typeof a=="boolean"){t[s]=String(a),r=!0;return}t[s]="",r=!0};["setupName","setupSelect","camera","monitor","video","cage","distance","batteryPlate","battery","batteryHotswap","sliderBowl","easyrig"].forEach(n);const o=(s,a=[])=>{const c=[],l=[s,...a];let f=!1;l.forEach(m=>{if(Object.prototype.hasOwnProperty.call(t,m)){const g=ah(t[m]);m!==s&&(f=!0),g.length&&c.push(...g)}}),l.slice(1).forEach(m=>{Object.prototype.hasOwnProperty.call(t,m)&&(delete t[m],r=!0)});const u=[],y=new Set;c.forEach(m=>{y.has(m)||(y.add(m),u.push(m))});const p=Object.prototype.hasOwnProperty.call(t,s),d=p&&Array.isArray(t[s])?t[s].filter(m=>typeof m=="string").map(m=>m.trim()).filter(m=>m):[];!p&&!f&&u.length===0&&d.length===0||ch(d,u)||(t[s]=u,r=!0)};if(o("motors",["motor","motorSelect"]),o("controllers",["controller","controllerSelect"]),Object.prototype.hasOwnProperty.call(t,"projectInfo")&&!E(t.projectInfo)&&(t.projectInfo=null,r=!0),Object.prototype.hasOwnProperty.call(t,"autoGearHighlight")){const s=t.autoGearHighlight,a=s===!0||s==="true"||s===1||s==="1";(s!==a||typeof s!="boolean")&&(t.autoGearHighlight=a,r=!0)}if(Object.prototype.hasOwnProperty.call(t,"diagramPositions")){const s=la(t.diagramPositions);Object.keys(s).length===0?(delete t.diagramPositions,r=!0):lh(t.diagramPositions,s)||(t.diagramPositions=s,r=!0)}const i=ue(t);return i!==t?{state:i,changed:!0}:{state:t,changed:r}}function Nf(){_e();const e=T(),t=rh(e,typeof sessionStorage<"u"?sessionStorage:null,er,"Error loading session state from localStorage:","Error loading session state from sessionStorage:","Error saving session state to localStorage:","Error deleting session state from sessionStorage:",{validate:o=>o===null||E(o)});if(t===null)return null;const{state:r,changed:n}=uh(t);return r?(n&&(yt(e,er,t),oc(r)),r):null}function oc(e,t={}){const r=T();if(e==null){Ee(r,er,"Error deleting session state from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid session state payload. Expected a plain object.");return}qe(r,er);const n=ue(e),o=E(t)?t:{},i=o.disableCompression!==!1,s={...o,disableCompression:i,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{if(typeof sa=="function"){const a=gc();if(sa(a))return console.warn("Removed oldest automatic gear backup to free up space for session state."),!0}return typeof aa=="function"&&aa()?(console.warn("Cleared cached planner data to free up space for session state."),!0):!1}};Ae(r,er,n,"Error saving session state to localStorage:",s)}function Gf(e){if(!E(e))return{data:null,changed:!1};const t={...e};let r=!1;const n=(i,s)=>(E(i[s])||(i[s]={},r=!0),i[s]),o=i=>{if(!E(i))return;Object.entries(i).forEach(([a,c])=>{if(typeof a!="string")return;const l=a.trim();if(!l||l===a)return;if(!E(c)){Object.prototype.hasOwnProperty.call(i,l)||(i[l]=c,delete i[a],r=!0);return}const f=n(i,l),u=new Set(Object.keys(f)),y=new Set([...u].map(p=>p.trim().toLowerCase()));Object.entries(c).forEach(([p,d])=>{if(Object.prototype.hasOwnProperty.call(f,p)){const m=gs(p,u,y);f[m]=d;return}f[p]=d,u.add(p),y.add(p.trim().toLowerCase())}),delete i[a],r=!0})};return Tm.forEach(i=>{n(t,i)}),E(t.fiz)||(t.fiz={},r=!0),Mm.forEach(i=>{n(t.fiz,i)}),E(t.accessories)||(t.accessories={},r=!0),Nm.forEach(i=>{n(t.accessories,i)}),o(t.accessories),o(t.fiz),Array.isArray(t.filterOptions)||(t.filterOptions=Array.isArray(e.filterOptions)?e.filterOptions.slice():[],r=!0),{data:t,changed:r}}function zf(){_e();const e=T(),t=Me(e,Ze,"Error loading device data from localStorage:",null,{validate:o=>o===null||E(o)}),{data:r,changed:n}=Gf(t);return r?(n&&(yt(e,Ze,t),Ae(e,Ze,r,"Error updating device data in localStorage during normalization:",{disableCompression:!0,forceCompressionOnQuota:!1})),r):null}function Bf(e){const t=T();if(e==null){Ee(t,Ze,"Error deleting device data from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid device data payload. Expected a plain object.");return}const{data:r}=Gf(e),n=r||e;qe(t,Ze),Ae(t,Ze,n,"Error saving device data to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function xf(e){if(!e)return{data:{},changed:!1};if(Array.isArray(e)){const n={},o=new Set,i=new Set;for(let s=0;s<e.length;s+=1){const a=e[s];if(!E(a))continue;const c=a.name||a.setupName||`Setup ${s+1}`,l=gs(c,o,i);n[l]=a}return{data:n,changed:!0}}if(!E(e))return{data:{},changed:!0};const t={};let r=!1;return Object.keys(e).forEach(n=>{const o=e[n];if(E(o)){const i=ue(o);i!==o&&(r=!0),t[n]=i}else r=!0}),r?{data:t,changed:!0}:{data:e,changed:!1}}function Ho(){_e();const e=T(),t=Me(e,pt,"Error loading setups from localStorage:",null,{validate:o=>o===null||Array.isArray(o)||E(o)}),{data:r,changed:n}=xf(t);n&&(yt(e,pt,t),Ae(e,pt,r,"Error updating setups in localStorage during normalization:"));try{return yf(r,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(De)})}catch(o){return console.warn("Failed to expand automatic backup entries while loading setups",o),me(r)}}function ic(e){const{data:t}=xf(e);nc(t);const r=gf(t,{isAutoBackupKey:o=>typeof o=="string"&&o.startsWith(De)});_m(r);const n=T();typeof Io=="function"&&Io(t,n),qe(n,pt),Ae(n,pt,r,"Error saving setups to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,onQuotaExceeded:()=>{const o=ia(r);return o?(console.warn(`Removed automatic backup "${o}" to free up storage space before saving setups.`),!0):!1}})}function sc(e){const t=Ho(),{result:r,changed:n=!0}=e(t)||{};return n&&ic(t),r}function fh(e,t){sc(r=>(r[e]=t,{changed:!0}))}function ph(e){return Ho()[e]}function dh(e){sc(t=>Object.prototype.hasOwnProperty.call(t,e)?(delete t[e],{changed:!0}):{changed:!1})}function yh(e,t){return sc(r=>{if(!Object.prototype.hasOwnProperty.call(r,e))return{result:null,changed:!1};const n=t.trim();if(!n)return{result:e,changed:!1};if(e.trim().toLowerCase()===n.toLowerCase())return{result:e,changed:!1};const o=new Set(Object.keys(r));o.delete(e);const i=gs(n,o),s=r[e];r[i]=s,delete r[e];const a=typeof e=="string"&&e.startsWith(De),c=typeof i=="string"&&i.startsWith(De);return a&&c&&Hm(s),{result:i,changed:!0}})}var gh=new Set(["prepDays","shootingDays","returnDays","crew","productionCompany","productionCompanyAddress"]),Ff={productionCompany:["Production Company","Produktionsfirma","Société de production","Productora","Casa di produzione"],productionCompanyAddress:["Production Company Address","Adresse der Produktionsfirma","Adresse de la société de production","Dirección de la productora","Indirizzo della casa di produzione"],productionCompanyStreet:["Street address","Straße und Hausnummer","Adresse","Dirección","Indirizzo"],productionCompanyStreet2:["Address line 2","Adresszusatz","Complément d'adresse","Línea 2 de dirección","Seconda linea indirizzo"],productionCompanyCity:["City","Stadt","Ville","Ciudad","Città"],productionCompanyRegion:["State / Province / Region","Bundesland / Region","État / Région / Département","Estado / Provincia / Región","Regione / Provincia / Stato"],productionCompanyPostalCode:["Postal code","Postleitzahl","Code postal","Código postal","CAP"],productionCompanyCountry:["Country","Land","Pays","País","Paese"],rentalHouse:["Rental","Kameraverleih","Loueur","Noleggio","Verleih","Location","Rental House"],crew:["Crew","Team","Équipe","Equipo","Troupe"],prepDays:["Prep Days","Prep-Tage","Jours de préparation","Días de preparación","Giorni di preparazione"],shootingDays:["Shooting Days","Drehtage","Jours de tournage","Días de rodaje","Giorni di riprese"],returnDays:["Return Days","Rückgabetage","Jours de restitution","Días de devolución","Giorni di restituzione"],deliveryResolution:["Delivery Resolution","Auslieferungsauflösung","Résolution de livraison","Resolución de entrega","Risoluzione di consegna"],recordingResolution:["Recording Resolution","Aufnahmeauflösung","Résolution d’enregistrement","Resolución de grabación","Risoluzione di registrazione"],slowMotionRecordingResolution:["Slow Motion Recording Resolution","Zeitlupen-Aufnahmeauflösung","Résolution d’enregistrement au ralenti","Resolución de grabación en cámara lenta","Risoluzione di registrazione slow motion"],aspectRatio:["Aspect Ratio","Seitenverhältnis","Format d’image","Relación de aspecto","Formato"],codec:["Codec","Codec","Codec","Códec","Codec"],baseFrameRate:["Base Frame Rate","Basis-Framerate","Cadence de base","Velocidad base","Frame rate base"],slowMotionBaseFrameRate:["Slow Motion Base Frame Rate","Zeitlupen-Basis-Framerate","Cadence de base au ralenti","Velocidad base en cámara lenta","Frame rate base slow motion"],recordingFrameRate:["Recording Frame Rate","Aufnahmebildrate","Cadence d’enregistrement","Velocidad de grabación","Frame rate di registrazione"],slowMotionRecordingFrameRate:["Slow Motion Recording Frame Rate","Zeitlupen-Aufnahmebildrate","Cadence d’enregistrement au ralenti","Velocidad de grabación en cámara lenta","Frame rate di registrazione slow motion"],sensorMode:["Sensor Mode","Sensormodus","Mode capteur","Modo de sensor","Modalità sensore"],slowMotionSensorMode:["Slow Motion Sensor Mode","Zeitlupen-Sensormodus","Mode capteur au ralenti","Modo de sensor en cámara lenta","Modalità sensore slow motion"],slowMotionAspectRatio:["Slow Motion Aspect Ratio","Zeitlupen-Seitenverhältnis","Format d’image au ralenti","Relación de aspecto en cámara lenta","Formato slow motion"],lenses:["Lenses","Objektive","Optiques","Ópticas","Obiettivi"],requiredScenarios:["Required Scenarios","Anforderungen","Scénarios requis","Escenarios requeridos","Scenari richiesti"],cameraHandle:["Camera Handle","Kamera-Handgriff","Poignée caméra","Empuñadura de cámara","Maniglia camera"],viewfinderExtension:["Viewfinder Extension","Sucher-Verlängerung","Extension viseur","Extensión de visor","Prolunga mirino"],viewfinderEyeLeatherColor:["Viewfinder Eye Leather Color","Sucher-Augenmuschel-Farbe","Couleur de l’œil du viseur","Color del ocular del visor","Colore gomma mirino"],mattebox:["Mattebox","Matte-Box","Matte box","Matte box","Matte box"],gimbal:["Gimbal","Gimbal-Stabilisator","Stabilisateur gimbal","Estabilizador gimbal","Stabilizzatore gimbal"],videoDistribution:["Video Distribution","Videoverteilung","Distribution vidéo","Distribución de vídeo","Distribuzione video"],monitoringSupport:["Monitoring support","Monitoring-Support","Support de monitoring","Soporte de monitorización","Supporto monitoraggio"],monitoringConfiguration:["Monitoring configuration","Monitoring-Konfiguration","Configuration de monitoring","Configuración de monitorización","Configurazione monitoraggio"],focusMonitor:["Focus Monitor","Fokusmonitor","Moniteur focus","Monitor de foco","Monitor fuoco"],monitorUserButtons:["Onboard Monitor User Buttons","Onboard-Monitor-Buttons","Boutons personnalisés du moniteur","Botones de usuario del monitor integrado","Tasti monitor onboard"],cameraUserButtons:["Camera User Buttons","Kamera-Buttons","Boutons personnalisés caméra","Botones de usuario de la cámara","Tasti camera"],viewfinderUserButtons:["Viewfinder User Buttons","Sucher-Buttons","Boutons personnalisés viseur","Botones de usuario del visor","Tasti mirino"],tripodHeadBrand:["Tripod Head Brand","Kopfmarke","Marque de la tête","Marca de la cabeza","Marca della testa"],tripodBowl:["Tripod Bowl","Schalentyp","Type de bol","Tipo de bowl","Tipo di bowl"],tripodTypes:["Tripod Types","Stativtypen","Types de trépied","Tipos de trípode","Tipi di treppiede"],tripodSpreader:["Tripod Spreader","Spreizer-Option","Type de spreader","Tipo de esparcidor","Tipo di spreader"],sliderBowl:["Slider Bowl","Slider-Schale","Slider bowl","Bowl del slider","Slider bowl"],easyrig:["Further Stabilisation","Weitere Stabilisierung","Stabilisation complémentaire","Estabilización adicional","Stabilizzazione aggiuntiva"]},ua=["productionCompanyAddress","productionCompanyStreet","productionCompanyStreet2","productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"];function Df(e){return typeof e!="string"?"":e.trim().replace(/[:：]\s*$/,"").trim()}function mh(e){var t={},r=typeof window<"u"&&window.texts?window.texts:null,n=r&&r.en&&r.en.projectFields||{},o=["productionCompany"].concat(ua);return o.forEach(function(i){var s=new Set,a=function(l){if(typeof l=="string"){var f=Df(l);f&&s.add(f)}};e&&e[i]&&a(e[i]),n&&n[i]&&a(n[i]);var c=Ff[i];Array.isArray(c)&&c.forEach(a),t[i]=s}),t}function hh(e,t,r){if(typeof e!="string")return null;var n=e.replace(/\r\n?/g,`
`).split(`
`).map(function(g){return g.trim()}).filter(function(g){return g});if(!n.length)return null;var o=mh(t),i={},s=n[0];s&&(i.productionCompany=s);var a=Array.isArray(r?.lines)?r.lines:null;if(a&&a.length){var c={};if(a.forEach(function(g){if(!(!g||typeof g.text!="string")){var b=g.text.trim();if(b){var P=g.fields;typeof P=="string"&&(P=P.split(/\s+/)),!(!Array.isArray(P)||!P.length)&&P.map(function(A){return typeof A=="string"?A.trim():""}).filter(function(A){return A&&ua.includes(A)}).forEach(function(A){c[A]||(c[A]=[]),c[A].push(b)})}}}),Object.keys(c).length){if(c.productionCompanyAddress&&c.productionCompanyAddress.length&&(i.productionCompanyAddress=c.productionCompanyAddress.join(`
`)),c.productionCompanyStreet&&c.productionCompanyStreet.length){var l=c.productionCompanyStreet;if(i.productionCompanyStreet=l[0],l.length>1){var f=l.slice(1).join(`
`);f&&(i.productionCompanyStreet2=f)}}if(c.productionCompanyStreet2&&c.productionCompanyStreet2.length){var u=c.productionCompanyStreet2.join(`
`);u&&(i.productionCompanyStreet2=i.productionCompanyStreet2?i.productionCompanyStreet2+`
`+u:u)}var y=function(g){if(!(!c[g]||!c[g].length)){var b=c[g].join(" ");b&&(i[g]=b)}};return["productionCompanyCity","productionCompanyRegion","productionCompanyPostalCode","productionCompanyCountry"].forEach(y),i}}var p={},d=null;if(n.slice(1).forEach(function(g){var b=Df(g),P=null;if(ua.forEach(function(A){P||!o[A]||o[A].has(b)&&(P=A)}),P){d=P,p[d]||(p[d]=[]);return}if(!d){i.productionCompany?i.productionCompany+=`
`+g:i.productionCompany=g;return}p[d]||(p[d]=[]),p[d].push(g)}),p.productionCompanyAddress&&p.productionCompanyAddress.length&&(i.productionCompanyAddress=p.productionCompanyAddress.join(`
`)),p.productionCompanyStreet&&p.productionCompanyStreet.length){var m=p.productionCompanyStreet;i.productionCompanyStreet=m[0],m.length>1&&(i.productionCompanyStreet2=m.slice(1).join(`
`))}return p.productionCompanyCity&&p.productionCompanyCity.length&&(i.productionCompanyCity=p.productionCompanyCity.join(" ")),p.productionCompanyRegion&&p.productionCompanyRegion.length&&(i.productionCompanyRegion=p.productionCompanyRegion.join(" ")),p.productionCompanyPostalCode&&p.productionCompanyPostalCode.length&&(i.productionCompanyPostalCode=p.productionCompanyPostalCode.join(" ")),p.productionCompanyCountry&&p.productionCompanyCountry.length&&(i.productionCompanyCountry=p.productionCompanyCountry.join(" ")),i}var bh=(()=>{const e=new Map,t=r=>typeof r!="string"?"":r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return Object.entries(Ff).forEach(([r,n])=>{n.forEach(o=>{const i=t(o);i&&!e.has(i)&&e.set(i,r)})}),e})(),Sh={amp:"&",lt:"<",gt:">",quot:'"',apos:"'",nbsp:" "};function mo(e){return typeof e!="string"||!e?"":e.replace(/&(#x?[0-9a-fA-F]+|[a-zA-Z]+);/g,(t,r)=>{if(!r)return t;if(r[0]==="#"){const o=r[1]==="x"||r[1]==="X"?parseInt(r.slice(2),16):parseInt(r.slice(1),10);return Number.isFinite(o)?String.fromCodePoint(o):t}const n=Sh[r.toLowerCase()];return n!==void 0?n:t})}function ho(e){if(typeof e!="string")return"";let t;do t=e,e=e.replace(/<[^>]*>/g,"");while(e!==t);return e}function wh(e,t){if(typeof e!="string")return"";const r=e.replace(/<\s*br\s*\/?\s*>/gi,`
`).replace(/<\/(p|div|li|ul|ol)>/gi,`
`).replace(/<li[^>]*>/gi,""),o=mo(ho(r)).replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(i=>i.replace(/\s+/g," ").trim()).filter(i=>i);return o.length?t&&gh.has(t)?o.join(`
`):o.join(", "):""}function Eh(e){if(typeof e!="string")return null;const t=/<span([^>]*)>([\s\S]*?)<\/span>/gi,r=[];let n;for(;n=t.exec(e);){const o=n[1]||"";if(!/class=["'][^"']*req-sub-line[^"']*["']/i.test(o))continue;const i=n[2]||"",s=mo(ho(i)).replace(/\s+/g," ").trim();if(!s)continue;const a=o.match(/data-fields=["']([^"']+)["']/i),c=a?null:o.match(/data-field=["']([^"']+)["']/i),l=a?a[1]:c?c[1]:"",f=typeof l=="string"?l.split(/\s+/).map(u=>u.trim()).filter(u=>u):[];r.push({text:s,fields:f})}return r.length?{lines:r}:null}function Ah(e){if(typeof e!="string")return"";const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[:：]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim().toLowerCase();return t&&bh.get(t)||""}function ul(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const r={},n=t.match(/<div[^>]*class=["'][^"']*requirements-grid[^"']*["'][^>]*>/i),o=n?n.index:-1;if(o===-1){const d=t.match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(d){const g=mo(ho(d[1])).replace(/[“”"']/g,"").trim();g&&(r.projectName=g)}return Object.keys(r).length?r:null}const i=t.slice(o),a=t.slice(0,o).match(/<h2[^>]*>([\s\S]*?)<\/h2>/i);if(a){const m=mo(ho(a[1])).replace(/[“”"']/g,"").trim();m&&!/gear list/i.test(m)&&(r.projectName=m)}const c=/<div[^>]*class=["'][^"']*requirement-box[^"']*["'][^>]*>[\s\S]*?<\/div>/gi;let l;const f=typeof window<"u"&&window.texts?window.texts:null,u=typeof window<"u"&&window.currentLang?window.currentLang:null,y=typeof u=="string"&&f&&f[u]?u:"en",p=f&&f[y]&&f[y].projectFields?f[y].projectFields:f&&f.en&&f.en.projectFields?f.en.projectFields:{};for(;l=c.exec(i);){const d=l[0],m=d.match(/data-field=["']([^"']+)["']/i),g=d.match(/<span[^>]*class=["'][^"']*req-label[^"']*["'][^>]*>([\s\S]*?)<\/span>/i),b=d.match(/<span[^>]*class=["'][^"']*req-value[^"']*["'][^>]*>([\s\S]*)<\/span\s*>/i),P=m?m[1].trim():"",A=g?mo(ho(g[1])):"",O=P||Ah(A);if(!O)continue;const _=b?b[1]:"",k=wh(_,O);if(!k)continue;let j=k,w=null;if(O==="productionCompany"){w=Eh(_);const S=hh(k,p,w);S&&typeof S=="object"&&(S.productionCompany&&(j=S.productionCompany),Object.entries(S).forEach(([I,B])=>{I!=="productionCompany"&&(Object.prototype.hasOwnProperty.call(r,I)||(r[I]=B))}))}Object.prototype.hasOwnProperty.call(r,O)||(r[O]=j)}return Object.keys(r).length?r:null}function xn(e){if(Array.isArray(e))return e.map(t=>xn(t));if(E(e)){const t={};return Object.entries(e).forEach(([r,n])=>{t[r]=xn(n)}),t}return e}function oi(e){if(!E(e))return null;try{return gr(e)}catch(t){console.warn("Unable to serialize project info during normalization",t);try{return xn(e)}catch(r){return console.warn("Unable to deep clone project info during normalization",r),{...e}}}}function Oh(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(r=>{if(!E(r)){const u=ac(r);u!=null&&t.push(u);return}const n={},o=typeof r.name=="string"?r.name.trim():"";o&&(n.name=o);const i=typeof r.phone=="string"?r.phone.trim():"";i&&(n.phone=i);const s=typeof r.email=="string"?r.email.trim():"";s&&(n.email=s);const c=typeof r.website=="string"?r.website.trim():typeof r.url=="string"?r.url.trim():"";c&&(n.website=c);const l=typeof r.text=="string"?r.text.trim():"";l&&(n.text=l);const f=typeof r.role=="string"?r.role.trim():"";f&&(n.role=f),Object.keys(n).length&&t.push(n)}),t}function ac(e){if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t||null}if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="boolean")return e?!0:null;if(Array.isArray(e)){const t=e.map(r=>ac(r)).filter(r=>r!=null&&!(typeof r=="string"&&!r));return t.length?t:null}return E(e)?Uf(e):null}function Uf(e){if(!E(e))return null;const t={},r=[],n=new Set,o=a=>{if(typeof a!="string")return;const c=a.trim();!c||n.has(c)||(n.add(c),r.push(c))},i=(a,c={})=>{if(a==null)return;if(c.fromSelections){(Array.isArray(a)?a:[a]).forEach(u=>{if(re(u)){const p=ne(u);if(p){i(p,{fromSelections:!0});return}}if(E(u)){const p=cc(u);if(p.length){p.forEach(d=>{d&&typeof d.name=="string"&&o(d.name)});return}}const y=Te(u);y&&o(y)});return}const l=Ye(a);l.length&&l.forEach(f=>{o(f)})};if(i(e.lenses),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&i(e.lensSelections,{fromSelections:!0}),Object.entries(e).forEach(([a,c])=>{if(c==null)return;if(a==="people"){const f=Oh(c);f.length&&(t.people=f);return}if(a==="lenses"){const{names:f}=Vf(c);t.lenses=f.slice();return}if(a==="lensSelections"){const f=fa(c,r);f.selections&&f.selections.length&&(t.lensSelections=f.selections);return}const l=ac(c);l!=null&&(t[a]=l)}),!Object.prototype.hasOwnProperty.call(t,"lenses")&&r.length&&(t.lenses=r.slice()),!Object.prototype.hasOwnProperty.call(t,"lensSelections")&&r.length){const a=fa([],r);a.selections&&a.selections.length&&(t.lensSelections=a.selections)}return Object.keys(t).length?ue(t):null}function Ch(e){if(!Array.isArray(e)||!e.length)return null;try{return gr(e)}catch(t){console.warn("Unable to serialize automatic gear rules during normalization",t);try{return xn(e)}catch(r){return console.warn("Unable to deep clone automatic gear rules during normalization",r),e.slice()}}}function Ph(e){if(!E(e)||!Object.keys(e).length)return{};try{return gr(e)}catch(t){console.warn("Unable to serialize diagram positions during normalization",t);try{return xn(e)}catch(r){return console.warn("Unable to deep clone diagram positions during normalization",r),{...e}}}}var bi="4x5.65";function ht(e){if(e==null)return[];if(Array.isArray(e)){const r=[];return e.forEach(n=>{if(n==null)return;if(Array.isArray(n)){r.push(...ht(n));return}if(re(n)){const i=ne(n);if(i){r.push(...ht(i));return}}if(typeof n=="object"){r.push(...ht(Object.values(n)));return}const o=String(n).trim();o&&r.push(o)}),r}if(re(e)){const r=ne(e);if(r)return ht(r)}if(typeof e=="object")return Object.prototype.hasOwnProperty.call(e,"values")?ht(e.values):Object.prototype.hasOwnProperty.call(e,"selected")?ht(e.selected):ht(Object.values(e));if(typeof e=="string"){const r=e.trim();if(!r||r==="!")return[];const n=Oe(r);return n.success?ht(n.parsed):r.split(/[|,]/).map(o=>o.trim()).filter(o=>o)}const t=String(e).trim();return t?[t]:[]}function kn(e,t=""){if(e==null)return null;if(typeof e=="string"){const r=e.trim();if(!r)return null;const n=Oe(r);if(n.success)return kn(n.parsed,t);const o=r.split(":"),i=o.shift(),s=i?i.trim():"";if(!s)return null;const a=o.shift(),c=a&&a.trim()?a.trim():bi;if(!o.length)return{type:s,size:c,values:[],hasExplicitValues:!1};const l=o.join(":");if(l==="!")return{type:s,size:c,values:[],hasExplicitValues:!0};const f=ht(l);return{type:s,size:c,values:f,hasExplicitValues:!0}}if(Array.isArray(e)){if(!e.length)return null;if(e.length===1)return kn(e[0],t);const[r,n,o]=e;let i=typeof r=="string"?r.trim():"";if(!i&&typeof t=="string"&&(i=t.trim()),!i)return null;const s=typeof n=="string"&&n.trim()?n.trim():bi,a=e.length>2,c=a?ht(o):[];return{type:i,size:s,values:c,hasExplicitValues:a}}if(re(e)){const r=ne(e);if(r)return kn(r,t)}if(typeof e=="object"){let r="";const n=["type","filter","name","label"];for(let l=0;l<n.length;l+=1){const f=n[l];if(typeof e[f]=="string"){const u=e[f].trim();if(u){r=u;break}}}if(!r&&typeof t=="string"&&t.trim()&&(r=t.trim()),!r)return null;const o=["size","filterSize","format","dimension","dimensions","diameter"];let i="";for(let l=0;l<o.length;l+=1){const f=o[l];if(typeof e[f]=="string"){const u=e[f].trim();if(u){i=u;break}}}i||(i=bi);const s=["values","value","strengths","strength","options","selected","selections","choices"];let a=!1,c=[];for(let l=0;l<s.length;l+=1){const f=s[l];if(Object.prototype.hasOwnProperty.call(e,f)){a=!0,c=ht(e[f]);break}}return{type:r,size:i,values:c,hasExplicitValues:a}}return null}function Ts(e){if(!e||!e.type)return null;const t=e.type,r=e.size&&e.size.trim()?e.size.trim():bi;let n=`${t}:${r}`;const o=Array.isArray(e.values)?Array.from(new Set(e.values.map(i=>typeof i=="string"?i.trim():String(i??"").trim()).filter(i=>i))):[];return(e.hasExplicitValues||o.length)&&(n+=o.length?`:${o.join("|")}`:":!"),n}function Vi(e){if(e===void 0)return null;if(e===null)return"";if(typeof e=="string"){const t=e.trim();if(!t)return"";const r=Oe(t);return r.success?Vi(r.parsed):t}if(Array.isArray(e)){const t=e.map(r=>kn(r)).filter(Boolean);return t.length?t.map(r=>Ts(r)).filter(Boolean).join(","):""}if(re(e)){const t=ne(e);if(t)return Vi(t)}if(typeof e=="object"){const t=kn(e);if(t)return Ts(t)||"";const r=[];return Object.entries(e).forEach(([n,o])=>{const i=kn(o,n);i&&r.push(i)}),r.length?r.map(n=>Ts(n)).filter(Boolean).join(","):""}return String(e).trim()}function Ms(e){if(!E(e))return;const t=Vi(e.filter);if(t!==null)t?e.filter=t:delete e.filter;else{const r=Vi(e.filters);r!==null&&(r?e.filter=r:delete e.filter)}Object.prototype.hasOwnProperty.call(e,"filters")&&delete e.filters}function oo(e){if(!E(e))return null;const t=n=>{if(Array.isArray(n))return n.map(i=>t(i)).filter(i=>i!==void 0);if(E(n)){const o={};return Object.entries(n).forEach(([i,s])=>{if(typeof i!="string"||!i)return;const a=t(s);a!==void 0&&(o[i]=a)}),o}if(n==null)return"";if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean")return String(n);try{return String(n)}catch{}return""},r={};return Object.entries(e).forEach(([n,o])=>{if(typeof n!="string"||!n)return;const i=t(o);i!==void 0&&(r[n]=i)}),Object.keys(r).length?r:null}function lo(e){if(e==null)return null;const t=o=>typeof o=="string"?o.trim():o==null?"":typeof o=="number"||typeof o=="boolean"?String(o):"";if(!E(e))return null;const r={batteryPlate:t(e.batteryPlate),battery:t(e.battery),batteryHotswap:t(e.batteryHotswap)};return Object.keys(r).some(o=>r[o])?r:null}function _h(e){const t=lo(e);return t?{batteryPlate:t.batteryPlate,battery:t.battery,batteryHotswap:t.batteryHotswap}:null}const kh=new Set(["name","lensname","label","title","text","lens","mount","mountlabel","mountname","mounts","note","notes","names","values","selection","legacyvalue","lensselections","selections","entries","items","options","meta","metadata","count","version","length","size","updated","created","createdat","timestamp","id","uuid","key","value"]);function Kf(e){if(typeof e!="string")return!1;const t=e.trim();if(!t||/^[0-9]+$/u.test(t))return!1;const r=t.toLowerCase();return!(r.startsWith("__proto__")||r==="prototype"||r==="constructor"||kh.has(r))}function $f(e){if(!E(e))return[];const t=Object.keys(e),r=[];return t.forEach(n=>{if(!Kf(n))return;const o=n.trim();o&&r.push(o)}),r}function Te(e){if(e==null)return"";if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return(typeof e=="string"?e:String(e)).trim();if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Te(e[t]);if(r)return r}return""}if(re(e)){const t=ne(e);if(t)return Te(t)}if(E(e)){const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let o=0;o<t.length;o+=1){const i=t[o];if(typeof i=="string"){const s=i.trim();if(s)return s}}const r=$f(e);if(r.length)return r[0];if(Array.isArray(e.names)&&e.names.length){const o=Te(e.names[0]);if(o)return o}if(Array.isArray(e.values)&&e.values.length){const o=Te(e.values[0]);if(o)return o}const n=Object.values(e);for(let o=0;o<n.length;o+=1){const i=Te(n[o]);if(i)return i}}return""}function Ye(e){if(e==null)return[];if(Array.isArray(e)){const t=[];return e.forEach(r=>{if(r==null)return;if(typeof r=="string"){const o=Oe(r);if(o.success){t.push(...Ye(o.parsed));return}const i=r.trim();i&&t.push(i);return}if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint"){t.push(String(r));return}const n=Te(r);if(n){t.push(n);return}if(Array.isArray(r)){t.push(...Ye(r));return}if(re(r)){const o=ne(r);o&&t.push(...Ye(o));return}E(r)&&t.push(...Ye(Object.values(r)))}),t}if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return[String(e)];if(typeof e=="string"){const t=Oe(e);return t.success?Ye(t.parsed):e.split(/[\n,;]/u).map(r=>r.trim()).filter(r=>r)}if(re(e)){const t=ne(e);if(t)return Ye(t)}if(E(e)){const t=$f(e);if(t.length)return t;const r=Te(e);if(r)return[r];const n=[];return Array.isArray(e.names)&&n.push(...Ye(e.names)),Array.isArray(e.values)&&n.push(...Ye(e.values)),n.length||n.push(...Ye(Object.values(e))),n}return[]}function Vf(e){const t=Ye(e),r=Array.isArray(e)&&e.length===t.length&&e.every((n,o)=>typeof n=="string"&&n.trim()===t[o]);return{names:t,changed:!r}}function Si(e){if(e==null)return{selection:null,changed:!1};if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"){const t=Te(e);return t?{selection:{name:t,mount:""},changed:!0}:{selection:null,changed:!0}}if(re(e)){const t=ne(e);if(t)return Si(t)}if(Array.isArray(e)){if(!e.length)return{selection:null,changed:!0};const t=Te(e[0]);if(!t)return{selection:null,changed:!0};const r=e.length>1?e[1]:"",n=typeof r=="string"?r.trim():"",o={name:t};return o.mount=n||"",{selection:o,changed:!0}}if(E(e)){const t={...e};let r=!1;const n=Te(e);if(!n)return{selection:null,changed:!0};t.name!==n&&(t.name=n,r=!0),Object.prototype.hasOwnProperty.call(t,"name")||(t.name=n,r=!0);const o=[];if(typeof e.mount=="string"&&o.push(e.mount),typeof e.mountLabel=="string"&&o.push(e.mountLabel),typeof e.mountName=="string"&&o.push(e.mountName),Array.isArray(e.mounts))for(let s=0;s<e.mounts.length;s+=1){const a=e.mounts[s];if(typeof a=="string"&&a.trim()){o.push(a);break}}let i="";for(let s=0;s<o.length;s+=1){const a=o[s];if(typeof a=="string"){const c=a.trim();if(c){i=c;break}}}if(typeof t.mount=="string"){const s=t.mount.trim();s!==t.mount&&(t.mount=s,r=!0),!i&&s&&(i=s)}return i||(i=""),t.mount!==i&&(t.mount=i,r=!0),Object.prototype.hasOwnProperty.call(t,"mount")||(t.mount=i,r=!0),{selection:t,changed:r}}return{selection:null,changed:!0}}function cc(e){if(!E(e))return[];const t=[e.name,e.lensName,e.label,e.title,e.text,e.lens];for(let n=0;n<t.length;n+=1){const o=t[n];if(typeof o=="string"&&o.trim())return[]}const r=[];return Object.entries(e).forEach(([n,o])=>{if(!Kf(n))return;const i=n.trim();if(!i)return;let s=o;if(re(s)){const l=ne(s);l&&(s=l)}if(E(s)){const l={...s};l.name=i;let f="";const u=["mount","mountLabel","mountName"];for(let y=0;y<u.length;y+=1){const p=u[y];if(typeof l[p]!="string")continue;const d=l[p].trim();if(d&&d.toLowerCase()!==i.toLowerCase()){f=d;break}}if(!f&&Array.isArray(l.mounts)){const y=Te(l.mounts);y&&y.toLowerCase()!==i.toLowerCase()&&(f=y)}l.mount=typeof f=="string"?f:"",r.push(l);return}if(Array.isArray(s)){const l=Te(s),f=l&&l.toLowerCase()!==i.toLowerCase()?l:"";r.push({name:i,mount:f});return}if(typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"){const l=Te(s),f=l&&l.toLowerCase()!==i.toLowerCase()?l:"";r.push({name:i,mount:f});return}if(s==null){r.push({name:i,mount:""});return}const a=Te(s),c=a&&a.toLowerCase()!==i.toLowerCase()?a:"";r.push({name:i,mount:c})}),r}function fa(e,t=[]){const r=Array.isArray(e)?e:[e],n=[],o=new Set;let i=!1;const s=(c,l)=>{if(!c||typeof c!="object"){l&&(i=!0);return}const f={...c},y=(typeof f.name=="string"?f.name:"").trim();if(!y){l&&(i=!0);return}f.name!==y&&(f.name=y,l=!0);const d=(typeof f.mount=="string"?f.mount:"").trim();if(f.mount!==d&&(f.mount=d,l=!0),Object.prototype.hasOwnProperty.call(f,"mount")||(f.mount=d,l=!0),Object.prototype.hasOwnProperty.call(f,"mountState")){const g=(typeof f.mountState=="string"?f.mountState:"").trim();f.mountState!==g&&(f.mountState=g,l=!0),g||(delete f.mountState,l=!0)}l&&(i=!0),n.push(f),o.add(y)},a=c=>{if(c==null)return;if(typeof c=="string"){const f=Oe(c);if(f.success){a(f.parsed),i=!0;return}const u=Ye(c);u.length?u.forEach(y=>{s({name:y,mount:""},!0)}):i=!0;return}if(typeof c=="number"||typeof c=="boolean"||typeof c=="bigint"){s({name:String(c),mount:""},!0);return}if(Array.isArray(c)){if(c.length&&c.length<=2&&(typeof c[0]=="string"||typeof c[0]=="number"||typeof c[0]=="boolean"||typeof c[0]=="bigint")){const{selection:f,changed:u}=Si(c);if(f){s(f,u);return}}c.forEach(f=>{const{selection:u,changed:y}=Si(f);u?s(u,y):y&&(i=!0)});return}if(re(c)){const f=ne(c);f&&(a(f),i=!0);return}if(E(c)){const f=cc(c);if(f.length){f.forEach(d=>{s(d,!0)});return}const{selection:u,changed:y}=Si(c);if(u){s(u,y);return}const p=Object.values(c);p.length&&(a(p),i=!0);return}const l=Te(c);l?s({name:l,mount:""},!0):i=!0};for(let c=0;c<r.length;c+=1)a(r[c]);return Array.isArray(t)&&t.forEach(c=>{if(typeof c!="string")return;const l=c.trim();!l||o.has(l)||(n.push({name:l,mount:""}),o.add(l),i=!0)}),n.length?{selections:n,changed:i}:{selections:null,changed:i}}function $e(e){const t=ds(e);if(t.restored)return $e(t.value);if(typeof e=="string"){const r=Oe(e);if(r.success){const n=$e(r.parsed);if(n)return n}return $e({gearList:e,projectInfo:null})}if(re(e)){const r=ne(e);return r?$e(r):null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"gearList")||Object.prototype.hasOwnProperty.call(e,"projectInfo")){const r=re(e.project)?ne(e.project):e.project;let n=e.projectInfo;re(n)&&(n=ne(n));let o=E(n)?n:null;if(!o&&typeof n=="string"){const w=Oe(n);w.success&&E(w.parsed)&&(o=w.parsed)}if(!o&&E(r)){let w=r.projectInfo;if(re(w)&&(w=ne(w)),E(w))o=w;else if(typeof w=="string"){const S=Oe(w);S.success&&E(S.parsed)&&(o=S.parsed)}}let i=null;const s=w=>{if(i&&i.length||w==null)return;let S=w;if(re(S)){const I=ne(S);I&&(S=Object.values(I).filter(B=>B!=null))}if(Array.isArray(S)&&S.length){i=S;return}if(E(S)){const I=Object.values(S).filter(B=>B!=null);if(I.length){i=I;return}}if(typeof S=="string"){const I=Oe(S);I.success&&Array.isArray(I.parsed)&&I.parsed.length&&(i=I.parsed)}};s(e.autoGearRules),!i&&E(r)&&s(r.autoGearRules);let a=re(e.gearList)?ne(e.gearList):e.gearList;if((a==null||typeof a=="string"&&!a)&&E(r)&&Object.prototype.hasOwnProperty.call(r,"gearList")&&(a=r.gearList),re(a)){const w=ne(a);w&&(a=w)}let c=typeof a=="string"||a&&typeof a=="object"?a:"",l=null;const f=re(e.gearSelectors)?ne(e.gearSelectors):e.gearSelectors;if(E(f))l=oo(f);else if(typeof f=="string"){const w=Oe(f);w.success&&E(w.parsed)&&(l=oo(w.parsed))}const u=re(e.powerSelection)?ne(e.powerSelection):e.powerSelection;let y=lo(u);if(!y&&E(u)&&(y=lo(u)),typeof c=="string"){const w=Oe(c);if(w.success){const S=$e(w.parsed);S?(c=S.gearList,!o&&S.projectInfo&&(o=S.projectInfo),(!i||!i.length)&&Array.isArray(S.autoGearRules)&&S.autoGearRules.length&&(i=S.autoGearRules),!l&&E(S.gearSelectors)&&(l=oo(S.gearSelectors)),!y&&E(S.powerSelection)&&(y=lo(S.powerSelection))):(typeof w.parsed=="string"||E(w.parsed)&&Object.values(w.parsed).every(I=>typeof I=="string"))&&(c=w.parsed)}}c&&typeof c=="object"&&!E(c)&&(c=""),o&&Ms(o),o&&(o=Uf(o)||null),o&&Ms(o);const p={gearList:Array.isArray(c)||E(c)?xn(c):c,projectInfo:o?oi(o):null},d=re(e.diagramPositions)?ne(e.diagramPositions):e.diagramPositions;let m=la(d);if(Object.keys(m).length===0&&E(r)){const w=re(r.diagramPositions)?ne(r.diagramPositions):r.diagramPositions;m=la(w)}Object.keys(m).length&&(p.diagramPositions=Ph(m));const g=[];if(typeof e.projectHtml=="string"&&g.push(e.projectHtml),typeof e.gearHtml=="string"&&g.push(e.gearHtml),E(r)&&(typeof r.projectHtml=="string"&&g.push(r.projectHtml),typeof r.gearHtml=="string"&&g.push(r.gearHtml)),E(a)&&typeof a.gearHtml=="string"&&g.push(a.gearHtml),E(c)?(typeof c.projectHtml=="string"&&g.push(c.projectHtml),typeof c.gearHtml=="string"&&g.push(c.gearHtml)):typeof c=="string"&&g.push(c),!l&&E(r)){const w=re(r.gearSelectors)?ne(r.gearSelectors):r.gearSelectors;E(w)&&(l=oo(w))}if(!l&&E(c)&&E(c.gearSelectors)&&(l=oo(c.gearSelectors)),!y&&E(r)){const w=re(r.powerSelection)?ne(r.powerSelection):r.powerSelection;E(w)&&(y=lo(w))}if(o){if(g.length)for(let w=0;w<g.length;w+=1){const S=ul(g[w]);if(S){const I=oi(S)||{},B=oi(o)||{};p.projectInfo={...I,...B};break}}}else for(let w=0;w<g.length;w+=1){const S=ul(g[w]);if(S){p.projectInfo=oi(S);break}}const b=[],P=new Set,A=w=>{if(typeof w!="string")return;const S=w.trim();!S||P.has(S)||(P.add(S),b.push(S))},O=(w,S={})=>{if(w==null)return;if(S.fromSelections){(Array.isArray(w)?w:[w]).forEach(M=>{if(re(M)){const N=ne(M);if(N){O(N,{fromSelections:!0});return}}if(E(M)){const N=cc(M);if(N.length){N.forEach(z=>{z&&typeof z.name=="string"&&A(z.name)});return}}const G=Te(M);G&&A(G)});return}const I=Ye(w);I.length&&I.forEach(B=>{A(B)})};if(p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lenses")){const{names:w}=Vf(p.projectInfo.lenses);p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=w.slice(),O(w)}O(e.lenses),E(r)&&O(r.lenses),O(a&&a.lenses),E(c)&&O(c.lenses),(!p.projectInfo||!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&b.length&&(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lenses=b.slice());const _=[];p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&(O(p.projectInfo.lensSelections,{fromSelections:!0}),_.push(p.projectInfo.lensSelections)),Object.prototype.hasOwnProperty.call(e,"lensSelections")&&(O(e.lensSelections,{fromSelections:!0}),_.push(e.lensSelections)),E(r)&&Object.prototype.hasOwnProperty.call(r,"lensSelections")&&(O(r.lensSelections,{fromSelections:!0}),_.push(r.lensSelections)),E(a)&&Object.prototype.hasOwnProperty.call(a,"lensSelections")&&(O(a.lensSelections,{fromSelections:!0}),_.push(a.lensSelections)),E(c)&&Object.prototype.hasOwnProperty.call(c,"lensSelections")&&(O(c.lensSelections,{fromSelections:!0}),_.push(c.lensSelections));const k=fa(_,b);k&&k.selections&&k.selections.length?(p.projectInfo=p.projectInfo&&typeof p.projectInfo=="object"?p.projectInfo:{},p.projectInfo.lensSelections=k.selections,(!Array.isArray(p.projectInfo.lenses)||!p.projectInfo.lenses.length)&&(p.projectInfo.lenses=k.selections.map(w=>typeof w.name=="string"?w.name:"").filter(w=>w))):k&&k.changed&&p.projectInfo&&Object.prototype.hasOwnProperty.call(p.projectInfo,"lensSelections")&&delete p.projectInfo.lensSelections;const j=typeof e.gearListAndProjectRequirementsGenerated=="boolean"?e.gearListAndProjectRequirementsGenerated:g.some(w=>typeof w=="string"&&w.trim());if(p.gearListAndProjectRequirementsGenerated=j,i&&i.length&&(p.autoGearRules=Ch(i)),l&&Object.keys(l).length&&(p.gearSelectors=l),y&&(p.powerSelection=_h(y)),Xg(e,p),p.projectInfo&&Ms(p.projectInfo),p.projectInfo){const w=ue(p.projectInfo);w!==p.projectInfo&&(p.projectInfo=w)}if(p.autoGearRules){const w=ue(p.autoGearRules);w!==p.autoGearRules&&(p.autoGearRules=w)}if(p.gearSelectors){const w=ue(p.gearSelectors);w!==p.gearSelectors&&(p.gearSelectors=w)}if(p.diagramPositions){const w=ue(p.diagramPositions);w!==p.diagramPositions&&(p.diagramPositions=w)}if(p.powerSelection){const w=ue(p.powerSelection);w!==p.powerSelection&&(p.powerSelection=w)}return p}if(Object.prototype.hasOwnProperty.call(e,"projectHtml")||Object.prototype.hasOwnProperty.call(e,"gearHtml"))return{gearList:{projectHtml:e.projectHtml||"",gearHtml:e.gearHtml||""},projectInfo:null};if(E(e.project)){const r=$e(e.project);if(r)return r}else if(typeof e.project=="string"){const r=Oe(e.project);if(r.success){const n=$e(r.parsed);if(n)return n}}}return null}var vh=new Set(["gearList","projectInfo","projectHtml","gearHtml","autoGearRules","powerSelection","gearListAndProjectRequirementsGenerated"]),jh=new Set(["gearList","projectInfo","autoGearRules","diagramPositions","gearSelectors","powerSelection","gearListAndProjectRequirementsGenerated"]);function Hi(e){if(!E(e)||!Object.keys(e).every(o=>jh.has(o)))return!1;const{gearList:r,projectInfo:n}=e;if(typeof r!="string"&&!(E(r)&&Object.keys(r).every(o=>typeof r[o]=="string"))||n!==null&&!E(n)||Object.prototype.hasOwnProperty.call(e,"autoGearRules")&&(!Array.isArray(e.autoGearRules)||!e.autoGearRules.length)||Object.prototype.hasOwnProperty.call(e,"diagramPositions")&&!E(e.diagramPositions)||Object.prototype.hasOwnProperty.call(e,"gearSelectors")&&!E(e.gearSelectors))return!1;if(Object.prototype.hasOwnProperty.call(e,"powerSelection")){const o=e.powerSelection;if(!E(o))return!1}return!(Object.prototype.hasOwnProperty.call(e,"gearListAndProjectRequirementsGenerated")&&typeof e.gearListAndProjectRequirementsGenerated!="boolean")}function Be(e){return typeof e!="string"?"":e.trim()}function Ih(e){if(e==null)return rr="",xt=!1,"";const t=Be(e);return Cm(t)?(rr="",xt=!1,t):(rr=t,xt=!0,t)}function Lh(e){return!xt||e!==void 0&&Be(e)!==rr?!1:(rr="",xt=!1,!0)}function en(e,t,r,n={}){if(!e||typeof e!="object")return null;const o=typeof r=="string"?r:"";if(Object.prototype.hasOwnProperty.call(e,o))return o;const i=Be(o);if(i&&i!==o&&Object.prototype.hasOwnProperty.call(e,i))return i;if(!t||typeof t!="object")return null;const{raw:s,normalized:a}=t;if(s&&typeof s.get=="function"&&s.has(o)){const c=s.get(o);if(Object.prototype.hasOwnProperty.call(e,c))return c}if(a&&typeof a.get=="function"&&a.has(i)){const c=a.get(i);if(Array.isArray(c)){if(n&&n.preferExact&&o){const f=c.find(u=>u===o&&Object.prototype.hasOwnProperty.call(e,u));if(f)return f}const l=c.find(f=>Object.prototype.hasOwnProperty.call(e,f));if(l)return l}else if(typeof c=="string"&&Object.prototype.hasOwnProperty.call(e,c))return c}return null}function Rh(e={}){const t=new Map,r=new Map;return(e&&typeof e=="object"?Object.keys(e):[]).forEach(o=>{if(typeof o!="string")return;t.set(o,o);const i=Be(o);r.has(i)||r.set(i,[]),r.get(i).push(o)}),{raw:t,normalized:r}}function kt(e={}){const{forceRefresh:t=!1,forMutation:r=!1,skipMigrations:n=!1,skipAutoBackupExpansion:o=!1}=e||{};if(n||_e(),ur&&!t){const S={...Ve},I=Rh(S);return{projects:S,changed:!1,originalValue:{...Ve},lookup:Zs(I)}}const i=T();let s=null;if(i&&typeof i.getItem=="function")try{s=i.getItem(pe)}catch{s=null}const a=Me(i,pe,"Error loading project from localStorage:",null,{validate:S=>S===null||typeof S=="string"||Array.isArray(S)||E(S)}),c=a;let l=null;if(E(a)?l={...a}:l={},i&&typeof i.length=="number"){const S=i.length;for(let I=0;I<S;I++){const B=i.key(I);if(!B||!B.startsWith(Bt))continue;const M=B.substring(Bt.length);if(M!=null)try{const G=i.getItem(B),N=JSON.parse(nr(G));l===null&&(l={}),l[M]=N}catch{}}}let f=a;(l!==null&&Object.keys(l).length>0||E(a))&&(f=l);const u={isAutoBackupKey:Vt};o&&(u.filter=S=>!Vt(S));const y=yf(f,u),p={};let d=!1;const m=new Set,g=new Set,b=S=>{if(typeof S!="string")return;m.add(S);const I=S.trim();I&&g.add(I.toLowerCase())},P=new Map,A=new Map,O=(S,I)=>{if(typeof S!="string")return;const B=typeof I=="string"?I:S;P.set(S,B);const M=Be(S);A.has(M)||A.set(M,[]),A.get(M).push(B)},_=()=>({raw:Gn(P),normalized:Gn(A)}),k=()=>{const S={projects:p,changed:d,originalValue:c,lookup:_(),rawValue:s};return d?(Hc(null),r?{projects:gr(S.projects),changed:S.changed,originalValue:S.originalValue,lookup:Zs(S.lookup)}:S):t?S:(Hc(S),Ug({forMutation:r})||S)};if(y==null)return k();if(typeof y=="string"){const S=$e(y);if(S){const I=S&&S.projectInfo&&typeof S.projectInfo.projectName=="string"?S.projectInfo.projectName:"",B=no(I,m,g);p[B]=S,O("",B),b(B)}return d=!0,k()}if(Array.isArray(y)){const S=m,I=g;return y.forEach((B,M)=>{const G=$e(B);if(!G){d=!0;return}const z=(E(B)&&typeof B.name=="string"?B.name.trim():`Project ${M+1}`)||`Project ${M+1}`,$=no(z,S,I);p[$]=G,O(z,$),b($)}),d=!0,k()}if(!E(y))return d=!0,k();const j=Object.keys(y);if(j.length>0&&j.every(S=>vh.has(S))){const S=$e(y);if(S){const I=no("",m,g);p[I]=S,O("",I),b(I)}return d=!0,k()}return j.forEach(S=>{if(Hi(y[S])){const I=typeof S=="string"?S.trim():"";I&&g.add(I.toLowerCase())}}),j.forEach(S=>{const I=$e(y[S]);if(I){const B=y[S],G=!Hi(B);let N=!1;if(!G)try{const $=Pe(I),Ht=Pe(B);$!==Ht&&(N=!0)}catch($){N=!0,console.warn("Unable to compare stored project entry during legacy long-GOP normalization check",$)}let z=S;if(G){const $=I&&I.projectInfo&&typeof I.projectInfo.projectName=="string"&&I.projectInfo.projectName?I.projectInfo.projectName:S;z=no($,m,g),d=!0}z!==S&&Object.prototype.hasOwnProperty.call(p,z)&&(z=no(z,m,g)),p[z]=I,O(S,z),b(z),!G&&N&&(d=!0)}else d=!0}),k()}function Hf(e,t){if(!e||typeof e.length!="number"||!E(t))return;const r=new Set(Object.keys(t).map(o=>Be(o))),n=[];for(let o=0;o<e.length;o+=1){const i=e.key(o);if(i&&i.startsWith(Bt)){const s=i.substring(Bt.length);r.has(s)||n.push(i)}}n.forEach(o=>Ee(e,o,"Pruning orphan project shard:"))}function qf(e){if(!e||h&&h.__cineMonolithicProjectCleanupDone)return;const t=e.getItem(pe);if(!t){h&&(h.__cineMonolithicProjectCleanupDone=!0);return}try{const r=JSON.parse(nr(t));r&&yt(e,pe,r)}catch{}Ee(e,pe,"Error clearing project monolithic storage after sharding:",{disableBackup:!1,disableMigrationCleanup:!0}),h&&(h.__cineMonolithicProjectCleanupDone=!0)}function Wf(e,t,r={}){if(e==null||t===void 0||t===null)return!1;const n=T();if(!n)return!1;const{skipCompression:o=!1}=r||{},i=Bt+Be(e),s={};s[e]=t;const c=gf(s,{isAutoBackupKey:Vt})[e];return Ae(n,i,c,`Error saving project shard "${e}":`,{disableCompression:o,forceCompressionOnQuota:!0,disableBackup:!0,onQuotaExceeded:()=>{const{projects:f}=kt({forMutation:!1,skipMigrations:!0});let u=ia(f);if(u||(u=ia(f,{force:!0})),u){const y=Bt+Be(u);return Ee(n,y,`Pruning shard "${u}" to recover space:`),!0}return!1}})==="success"}function lc(e,t={}){const{skipCompression:r=!1}=t||{},n=T();if(!(!e||typeof e!="object")){nc(e),Hf(n,e),Object.keys(e).forEach(o=>{Wf(o,e[o],{skipCompression:r})}),qf(n),Ja(n);try{Io(e,n)}catch(o){console.warn("Failed to update project index",o)}if(fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}}}let Fn=null;function uc(e){if(!e||typeof e!="object")return null;const t={};return Object.keys(e).forEach(n=>{if(typeof n!="string")return;const o=C&&typeof C.getProjectKeyFromStorageKey=="function"?C.getProjectKeyFromStorageKey(n):n;if(o==null)return;const i=e[n];if(!Object.prototype.hasOwnProperty.call(t,o)){t[o]=i;return}const s=t[o],a=i&&typeof i=="object"&&typeof i.lastModified=="number"?i.lastModified:null,c=s&&typeof s=="object"&&typeof s.lastModified=="number"?s.lastModified:null;typeof a=="number"&&typeof c=="number"&&a>c&&(t[o]=i)}),Object.keys(t).length?t:null}function Yf(e){if(!e||typeof e!="object")return null;if(!C||typeof C.getProjectStorageKey!="function")return e;const t={};return Object.keys(e).forEach(r=>{if(typeof r!="string")return;const n=C.getProjectStorageKey(r);t[n]=e[r]}),t}async function Th(){if(!C||typeof C.migrateUnprefixedProjectRecords!="function")return{migratedKeys:[],hasIndex:!1};try{const e=await C.getItem(Nn),t=e&&typeof e=="object"?Object.keys(e):[],r=uc(e),n=await C.migrateUnprefixedProjectRecords({projectIndexKeys:t});if(r){Fn=r;const o=Yf(r);o&&await C.setItem(Nn,o)}return{migratedKeys:n.migratedKeys||[],hasIndex:!!r}}catch(e){return console.warn("[storage.js] Project prefix migration failed",e),{migratedKeys:[],hasIndex:!1}}}function Mh(){if(Fn)return Fn;const e=T(),t=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";if(!e||typeof e.getItem!="function"||t)return null;try{const r=e.getItem(Nn);if(!r)return null;const n=JSON.parse(r);if(n&&typeof n=="object")return uc(n)||n}catch(r){console.warn("Failed to read project index",r)}return null}function Io(e,t){if(!e||typeof e!="object")return;const r={};Object.keys(e).forEach(o=>{if(Vt(o))return;const i=e[o];i&&(r[o]={color:i.color,icon:i.icon,lastModified:i.lastModified,prepDays:i.prepDays,shootingDays:i.shootingDays,returnDays:i.returnDays,archived:i.archived,status:i.status})}),Fn=r;const n=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";if(C){const o=Yf(r);C.setItem(Nn,o).catch(i=>console.warn("Failed to persist index to repo",i))}if(!n&&t&&typeof t.setItem=="function")try{t.setItem(Nn,JSON.stringify(r))}catch(o){console.warn("Failed to write project index",o)}}function Jf(e){const t=e!==void 0&&!(typeof e=="string"&&Vt(e));let{projects:r,changed:n,originalValue:o,lookup:i}=kt({skipAutoBackupExpansion:t}),s=null;if(e!==void 0&&(s=en(r,i,e,{preferExact:!0}),s!=null&&ys(s)),n){const a=T();a&&yt(a,pe,o);const c=gr(r);lc(c),r=c}if(e===void 0)return Am(r),r;if(s!=null&&Object.prototype.hasOwnProperty.call(r,s)){const a=r[s];if(a&&(!a.gearList||a.gearList==="")){const l=Ho()[s];l&&l.gearList&&(a.gearList=l.gearList)}return a}return null}function Nh(){const e=Mh();if(e)return e;const t=kt({forMutation:!1,skipAutoBackupExpansion:!0}),r={};if(t&&t.projects){const n=Object.keys(t.projects);for(let i=0;i<n.length;i++){const s=n[i];if(Vt(s))continue;const a=t.projects[s];a&&(r[s]={color:a.color,icon:a.icon,lastModified:a.lastModified,prepDays:a.prepDays,shootingDays:a.shootingDays,returnDays:a.returnDays,archived:a.archived,status:a.status})}const o=T();if(o)try{Io(t.projects,o)}catch{}}return r}function Qf(e){if(typeof e!="string")return"";const t=e.replace(/\s+/g," ").trim();return t?t.length<=120?t:t.slice(0,120):""}function Xf(e){const t=r=>String(r).padStart(2,"0");return[e.getFullYear(),t(e.getMonth()+1),t(e.getDate()),t(e.getHours()),t(e.getMinutes()),t(e.getSeconds())].join("-")}function Gh(e,t){const n=Xf(new Date),o=Qf(e),i=o?`${Pt}${n}-${o}`:`${Pt}${n}`,s=new Set(Object.keys(t));if(!s.has(i))return{name:i};let a=2,c=`${i}-${a}`;for(;s.has(c);)a+=1,c=`${i}-${a}`;return{name:c}}function Zf(e){if(e!==void 0){if(e===null||typeof e!="object")return e;try{const t=gr(e),r=ue(t);return r!==t?r:t}catch(t){console.warn("Unable to deep clone project for backup",t);const r={...e},n=ue(r);return n!==r?n:r}}}function ep(e,t){if(!e||!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(typeof t=="string"&&t.startsWith(De))return{status:"skipped"};const r=e[t];if(r===void 0)return{status:"missing"};const{name:n}=Gh(t,e);if(!n)return{status:"failed"};const o=Zf(r);return o===void 0?(typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipping deletion backup for project "${t}" because no stored data was available during backup creation.`),{status:"missing"}):(e[n]=o,{status:"created",backupName:n})}function zh(e){const{projects:t,changed:r,originalValue:n,lookup:o}=kt({forMutation:!0});if(!t||typeof t!="object")return{status:"invalid"};const i=en(t,o,e,{preferExact:!0}),s=Be(e),a=i??s;if(!Object.prototype.hasOwnProperty.call(t,a))return{status:"missing"};const c=ep(t,a);if(c.status!=="created")return c;if(r){const l=T();l&&yt(l,pe,n)}return ys(c.backupName),lc(t),c}function Bh(e,t){const r=Xf(new Date),n=Qf(e),o=n?`${De}${r}-${n}`:`${De}${r}`,i=new Set(Object.keys(t));if(!i.has(o))return{name:o};let s=2,a=`${o}-${s}`;for(;i.has(a);)s+=1,a=`${o}-${s}`;return{name:a}}function xh(e,t){if(!E(e)||typeof t!="string")return{status:"invalid"};if(!Object.prototype.hasOwnProperty.call(e,t))return{status:"missing"};if(t.startsWith(De)||t.startsWith(Pt))return{status:"skipped"};const r=Zf(e[t]);if(r===void 0)return{status:"failed"};const{name:n}=Bh(t,e);return n?(e[n]=r,{status:"created",backupName:n}):{status:"failed"}}function fc(e,t,r={}){if(!E(t))return;const n=$e(t);if(!n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped saving project "${e||""}" because the payload could not be normalised.`);return}const o=!!(r&&r.skipOverwriteBackup),i=!!(r&&r.skipCompression),s=typeof e=="string"?e:"",a=Be(s),c=kt({forMutation:!0}),l=E(c.projects)?c.projects:{};if(c.changed){const S=T();S&&yt(S,pe,c.originalValue)}const f=en(l,c.lookup,s,{preferExact:!0}),u=f!=null&&Object.prototype.hasOwnProperty.call(l,f)?l[f]:null,y=u?Pe(u):null,p=kt({forMutation:!0}),d=E(p.projects)?p.projects:{};if(p.changed){const S=T();S&&yt(S,pe,p.originalValue)}const m=en(d,p.lookup,s,{preferExact:!0});let g=m,b=null;a&&a!==m&&!Object.prototype.hasOwnProperty.call(d,a)&&(g=a,b=m),g==null&&(g=a),!g&&g!==""&&(g="");const P=b??g,A=P!=null&&Object.prototype.hasOwnProperty.call(d,P),O=A?d[P]:null;if(A&&!o){const S=Pe(O),I=Pe(n);S!==I&&xh(d,P).status==="failed"&&console.warn(`Automatic backup before overwriting project "${P}" failed. Proceeding with save.`)}if(b!=null&&b!==g){let S=!!y;Object.prototype.hasOwnProperty.call(d,b)&&y?Pe(d[b])!==y&&(S=!1):S=!1,S?(delete d[b],ra(b)):typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Skipped removing "${b}" while saving "${g}" because the original entry changed in another tab.`)}const _=r&&r.renamedFrom;if(_&&_!==g){const S=en(d,p.lookup,_,{preferExact:!0});S&&Object.prototype.hasOwnProperty.call(d,S)&&(delete d[S],ra(S))}const k=g||"";d[k]=n,ys(k),nc(d),C&&C.saveProject(k,n).catch(S=>console.warn("[saveProject] Repo write failed",S)),ur&&(Ve[k]=n);const j=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";let w=!0;if((!j||!ur)&&(w=Wf(k,n,{skipCompression:i})),w){const S=T();if(Hf(S,d),qf(S),fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}Ja(S)}else lc(d,{skipCompression:i})}function tp(e){if(e===void 0){const u=[T()];typeof localStorage<"u"&&u.indexOf(localStorage)===-1&&u.push(localStorage),u.forEach(p=>{if(p&&typeof p.removeItem=="function")try{p.removeItem(pe);const d=typeof he=="string"?he:"__backup";p.removeItem(`${pe}${d}`),p.removeItem("cameraPowerPlanner_project__backup")}catch(d){console.warn("[FactoryReset] Failed to force delete project keys",d)}if(Ee(p,pe,"Error deleting project from storage:"),p&&typeof p.length=="number"){const d=[];for(let m=0;m<p.length;m++){const g=p.key(m);g&&g.startsWith(Bt)&&d.push(g)}d.forEach(m=>Ee(p,m,"Error deleting project shard from storage:"))}});try{C&&C.clear().catch(p=>console.warn("[FactoryReset] Failed to clear StorageRepository",p)),Ys&&Ys.clear().catch(p=>console.warn("[FactoryReset] Failed to clear DataVault",p)),ze&&ze.reset()}catch(p){console.warn("[FactoryReset] Error clearing modern storage",p)}if(typeof sn=="function")try{sn()}catch(p){console.warn("Failed to clear UI cache during project deletion",p)}if(fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}Nr&&typeof Nr.clear=="function"&&Nr.clear();const y=T();y&&Ja(y);return}const{projects:t,changed:r,originalValue:n,lookup:o}=kt({forMutation:!0});if(r){const u=T();u&&yt(u,pe,n)}const i=en(t,o,e,{preferExact:!0}),s=i??Be(e);if(!Object.prototype.hasOwnProperty.call(t,s)){const u=Bt+Be(e),y=T();y&&Ee(y,u,"Error deleting orphan project shard:");return}if(ep(t,s).status==="failed"){console.warn(`Automatic backup before deleting project "${s}" failed. Deletion aborted.`),ce();return}const c=Bt+Be(s),l=T(),f=C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter";if(l&&!f&&Ee(l,c,"Error deleting project shard:"),ur&&delete Ve[s],C&&typeof C.removeProject=="function"?C.removeProject(s).catch(u=>console.warn("Failed to delete from repo",u)):C&&C.removeItem(s).catch(u=>console.warn("Failed to delete from repo",u)),delete t[s],ra(s),fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}}function Fh(e,t){if(!e||!t)return null;const{projects:r}=kt({forMutation:!0}),n=en(r,null,e,{preferExact:!0});if(!n||!r[n])return null;const o=t.trim();if(!o||o===n)return n;const i=r[n];if(i.name=o,E(i.projectInfo)||(i.projectInfo={}),i.projectInfo.projectName=o,ur?(delete Ve[n],Ve[o]=i):(delete r[n],r[o]=i),C&&typeof C.removeProject=="function"?C.removeProject(n).catch(s=>console.warn("Failed to delete old project key",s)):C&&C.removeItem(n).catch(s=>console.warn("Failed to delete old project key",s)),fc(o,i),fr(),ve)try{ve.postMessage("project-shards-changed")}catch{}return o}function fl(){const{projects:e,changed:t,originalValue:r}=kt({forMutation:!0});if(t){const s=T();s&&yt(s,pe,r)}const n=new Set(Object.keys(e)),o=new Set([...n].map(s=>s.trim().toLowerCase())),i="Imported project";return(s,a,c=i)=>{const l=$e(a);if(!l)return;!(a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"gearListAndProjectRequirementsGenerated")&&typeof a.gearListAndProjectRequirementsGenerated=="boolean")&&typeof l.gearListAndProjectRequirementsGenerated!="boolean"&&(l.gearListAndProjectRequirementsGenerated=!1);const u=[];if(typeof s=="string"&&u.push(s.trim()),E(a)){typeof a.name=="string"&&u.push(a.name.trim());const g=a.projectInfo;E(g)&&typeof g.projectName=="string"&&u.push(g.projectName.trim())}const y=typeof c=="string"&&c.trim()?c.trim():i,p=u.length>0?u[0]:y,d=typeof p=="string"?p.trim().toLowerCase():"",m=o.has(d)?ih(p,n,o):gs(p,n,o);fc(m,l,{skipCompression:!1}),n.add(m),o.add(m.trim().toLowerCase())}}function Oe(e){if(typeof e!="string")return{success:!1,parsed:null};const t=e.trim();if(!t)return{success:!1,parsed:null};const r=t[0],n=t[t.length-1];let o=null;if(r==="{"?o="}":r==="["?o="]":r==='"'&&(o='"'),!o||n!==o)return{success:!1,parsed:null};try{return{success:!0,parsed:JSON.parse(t)}}catch{return{success:!1,parsed:null}}}function bo(e,t,r="Imported project"){if(typeof e=="string"){const n=Oe(e);return n.success?bo(n.parsed,t,r):(t()(r,e,r),!0)}if(re(e)){const n=ne(e);return n?bo(Object.entries(n),t,r):!1}if(Array.isArray(e)){const n=e.map(s=>{if(s==null)return null;if(Array.isArray(s)&&s.length>=2)return{name:s[0],project:s[1]};if(E(s)&&typeof s.name=="string"){const a=Object.prototype.hasOwnProperty.call(s,"project")?s.project:s;return{name:s.name,project:a}}return{name:"",project:s}}).filter(Boolean);if(!n.length)return!0;const o=t();let i=0;return n.forEach(({name:s,project:a})=>{if(a==null)return;i+=1;let c="";typeof s=="string"?c=s:typeof s=="number"||typeof s=="boolean"||typeof s=="bigint"?c=String(s):typeof s=="symbol"&&(c=s.description||s.toString()),o(c,a,`${r} ${i}`)}),!0}if(E(e)){const n=t();return Object.entries(e).forEach(([o,i])=>{const s=typeof o=="string"?o:jf(o);n(typeof s=="string"&&s?s:r,i,r)}),!0}return!1}function Dh(e){if(!e||typeof e!="object")return[];const t=[],r=i=>{i!=null&&t.push(i)};["projectData","projectCollection","projectEntries","legacyProjects","legacyProjectData"].forEach(i=>{Object.prototype.hasOwnProperty.call(e,i)&&r(e[i])}),E(e.data)&&(Object.prototype.hasOwnProperty.call(e.data,"project")&&r(e.data.project),Object.prototype.hasOwnProperty.call(e.data,"projects")&&r(e.data.projects));const o=e.plannerData;return Array.isArray(o)&&o.forEach(i=>{if(Array.isArray(i)&&i.length>=2){const c=i[0];typeof c=="string"&&c.toLowerCase().includes("project")&&r(i[1]);return}if(!i||typeof i!="object")return;const s=typeof i.key=="string"?i.key:typeof i.name=="string"?i.name:typeof i.id=="string"?i.id:typeof i.section=="string"?i.section:null;if(!s||!s.toLowerCase().includes("project"))return;const a=Object.prototype.hasOwnProperty.call(i,"value")?i.value:Object.prototype.hasOwnProperty.call(i,"data")?i.data:Object.prototype.hasOwnProperty.call(i,"project")?i.project:Object.prototype.hasOwnProperty.call(i,"projects")?i.projects:null;a!=null&&r(a)}),t}function rp(){_e();const e=T(),t=Me(e,et,"Error loading favorites from localStorage:",{},{validate:r=>r===null||E(r)});return E(t)?t:{}}function np(e){const t=T();if(e==null){Ee(t,et,"Error deleting favorites from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid favorites payload. Expected a plain object.");return}qe(t,et),Ae(t,et,e,"Error saving favorites to localStorage:")}function Uh(){if(vt||(Uc||(Uc=!0,Mn&&(vt=Mn)),vt))return vt;const e=h&&typeof h=="object"?h:null;if(e&&e.cineFeaturesContacts&&typeof e.cineFeaturesContacts=="object")return vt=e.cineFeaturesContacts,vt;const t=e&&typeof e.cineModuleBase=="object"?e.cineModuleBase:null;if(t&&typeof t.resolveModule=="function")try{const r=t.resolveModule("cine.features.contacts",e);if(r&&typeof r=="object")return vt=r,vt}catch{}return vt}function op(e){if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e).trim():"";if(typeof e=="bigint"){try{return e.toString()}catch{}return""}if(typeof e=="boolean")return e?"true":"false";if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return op(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function Kh(e){if(e&&typeof e.generateContactId=="function")try{const t=e.generateContactId();if(typeof t=="string"&&t)return t}catch{}return`contact-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function $h(e,t){if(!e||typeof e!="object")return null;const r=op,n=r(e.id)||Kh(t),o=r(e.name),i=r(e.role),s=r(e.phone),a=r(e.email),c=r(e.website||e.url),l=r(e.notes||e.note||e.text),f=typeof e.avatar=="string"?e.avatar.trim():"",u=f&&f.startsWith("data:")?f:"",y=Number.isFinite(e.createdAt)?e.createdAt:Date.now(),p=Number.isFinite(e.updatedAt)?e.updatedAt:y,d={id:n,name:o,role:i,phone:s,email:a,website:c,notes:l,createdAt:y,updatedAt:p};return u&&(d.avatar=u),d}function Vh(e){if(!Array.isArray(e))return[];const t=e.filter(r=>r&&typeof r=="object").map(r=>({...r}));return t.sort((r,n)=>{const o=(r&&r.name?r.name:"").toLowerCase(),i=(n&&n.name?n.name:"").toLowerCase();if(o&&i&&o!==i)try{return o.localeCompare(i)}catch{}if(o&&!i)return-1;if(!o&&i)return 1;const s=r&&typeof r.createdAt=="number"?r.createdAt:0,a=n&&typeof n.createdAt=="number"?n.createdAt:0;return s-a}),t}function pc(e){if(!Array.isArray(e))return[];const t=Uh();if(t&&typeof t.sortContacts=="function")try{const o=t.sortContacts(e);if(Array.isArray(o))return o.filter(i=>i&&typeof i=="object")}catch(o){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contacts via module.",o)}const r=t&&typeof t.normalizeContactEntry=="function"?t.normalizeContactEntry:null,n=[];for(let o=0;o<e.length;o+=1){const i=e[o];if(!i)continue;let s=null;if(r)try{s=r(i)}catch(a){typeof console<"u"&&typeof console.warn=="function"&&console.warn("Error normalizing contact entry via module.",a),s=null}s||(s=$h(i,t)),s&&typeof s=="object"&&n.push(s)}return Vh(n)}function ip(){_e();const e=T(),t=Me(e,tt,"Error loading contacts from localStorage:",[],{validate:r=>r===null||Array.isArray(r)});return Array.isArray(t)?pc(t):[]}function pa(e){const t=T();if(e==null){Ee(t,tt,"Error deleting contacts from localStorage:");return}if(!Array.isArray(e)){console.warn("Ignoring invalid contacts payload. Expected an array.");return}const r=pc(e);qe(t,tt),Ae(t,tt,r,"Error saving contacts to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0})}function Hh(){return $u.getOwnGear()}function sp(e){return $u.saveOwnGear(e)}function mn(e){if(typeof e=="string")return e.trim();if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="bigint")return e.toString();if(e&&typeof e=="object")try{const t=e.valueOf();if(t!==e)return mn(t);if(typeof e.toString=="function"){const r=e.toString();if(typeof r=="string"&&r&&r!=="[object Object]")return r.trim()}}catch{}return""}function dc(e){if(!e||typeof e!="object")return null;const t=mn(e.name),r=mn(e.role),n=mn(e.avatar),o=n&&n.toLowerCase().startsWith("data:")?n:"",i=mn(e.phone),s=mn(e.email);return!t&&!r&&!o&&!i&&!s?{name:"",role:"",avatar:"",phone:"",email:""}:{name:t,role:r,avatar:o,phone:i,email:s}}function ap(){_e();const e=T(),t=Me(e,ct,"Error loading user profile from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?dc(t)||{name:"",role:"",avatar:"",phone:"",email:""}:{name:"",role:"",avatar:"",phone:"",email:""}}function wi(e){const t=T();if(e==null){Ee(t,ct,"Error deleting user profile from localStorage:");return}const r=dc(e)||{name:"",role:"",avatar:"",phone:"",email:""};if(!r.name&&!r.role&&!r.avatar&&!r.phone&&!r.email){Ee(t,ct,"Error deleting user profile from localStorage:");return}qe(t,ct),Ae(t,ct,r,"Error saving user profile to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0,enableCompressionSweep:!1})}function cp(){_e();const e=T(),t=Me(e,Mr,"Error loading feedback from localStorage:",null,{validate:r=>r===null||E(r)});return E(t)?t:{}}function lp(e){const t=T();if(e==null){Ee(t,Mr,"Error deleting feedback from localStorage:");return}if(!E(e)){console.warn("Ignoring invalid feedback payload. Expected a plain object.");return}qe(t,Mr),Ae(t,Mr,e,"Error saving feedback to localStorage:")}function tn(e){if(!e)return null;if(typeof e=="string"){const t=e.trim();return t?{createdAt:t}:null}if(typeof e=="object"){const t=typeof e.createdAt=="string"&&e.createdAt.trim()?e.createdAt.trim():typeof e.iso=="string"&&e.iso.trim()?e.iso.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?e.timestamp.trim():null;if(!t)return null;const r={createdAt:t};return typeof e.fileName=="string"&&e.fileName.trim()?r.fileName=e.fileName.trim():typeof e.name=="string"&&e.name.trim()&&(r.fileName=e.name.trim()),r}return null}function Lo(e=!1){if(!e&&or!==null){const o=or;if(Array.isArray(o))return o.map(tn).filter(Boolean)}_e();const t=T(),r=Me(t,Fe,"Error loading full backup history from localStorage:",[],{validate:o=>o===null||Array.isArray(o)});if(!Array.isArray(r))return[];const n=r.map(tn).filter(Boolean);return or=n,C.setItem(Fe,n).catch(o=>{console.warn("[storage.js] Failed to persist backup history to new storage:",o)}),n}function qi(e){const t=T();if(e==null){or=[],Ee(t,Fe,"Error deleting full backup history from localStorage:"),C.removeItem(Fe).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)});return}if(!Array.isArray(e)){console.warn("Ignoring invalid full backup history payload. Expected an array.");return}const r=e.map(tn).filter(Boolean);if(!r.length){e.length===0?(or=[],Ee(t,Fe,"Error deleting full backup history from localStorage:"),C.removeItem(Fe).catch(n=>{console.warn("[storage.js] Failed to delete backup history from new storage:",n)})):console.warn("Ignoring full backup history update because no valid entries were provided.");return}or=r,qe(t,Fe),Ae(t,Fe,r,"Error saving full backup history to localStorage:",{disableCompression:!1,forceCompressionOnQuota:!0}),C.setItem(Fe,r).catch(n=>{console.warn("[storage.js] Failed to persist backup history to new storage:",n)})}var up=e=>{const t=tn(e);if(!t)return Lo();const r=Lo();r.push(t);const n=r.slice(-200);return qi(n),n};function Jt(e,t,r=0){if(e==null)return[];if(r>50)return[];if(Array.isArray(e)){const o=[],i=e.length,s=t||new WeakSet;if(s.has(e))return[];s.add(e);for(let a=0;a<i;a+=1){const c=e[a];if(!(typeof c=="object"&&c!==null&&s.has(c)))if(Array.isArray(c)){const l=Jt(c,s,r+1);if(l&&l.length)for(let f=0;f<l.length;f+=1)o.push(l[f])}else{const l=tn(c);l&&o.push(l)}}return o}const n=t||new WeakSet;if(typeof e=="object"&&e!==null){if(n.has(e))return[];n.add(e)}if(re(e)){const o=ne(e);return o?Jt(Object.values(o),n,r+1):[]}if(typeof e=="string"){const o=Oe(e);if(o.success)return Jt(o.parsed,n,r+1);const i=tn(e);return i?[i]:[]}if(Array.isArray(e))return[];if(E(e)){if(Array.isArray(e.history))return Jt(e.history,n,r+1);if(Array.isArray(e.entries))return Jt(e.entries,n,r+1);if(Array.isArray(e.list))return Jt(e.list,n,r+1);const o=tn(e);if(o)return[o];const i=Object.values(e);if(i.length)return Jt(i,n,r+1)}return[]}var Wi=1;function qh(){var e=0;if(typeof Date<"u"&&Date&&typeof Date.now=="function")e=Date.now();else try{e=new Date().getTime()}catch{e=Math.floor(Math.random()*1e9)}var t=0;try{t=Math.floor(Math.random()*1e6)}catch{t=e%1e6}return"doc-tracker-"+e.toString(36)+"-"+t.toString(36)}function pl(e){var t=!1,r=null;if(e&&typeof e=="object"){typeof e.completed=="boolean"?t=e.completed:typeof e.checked=="boolean"?t=e.checked:typeof e.value=="boolean"?t=e.value:e.done===!0&&(t=!0);var n=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?n=e.updatedAt.trim():typeof e.timestamp=="string"&&e.timestamp.trim()?n=e.timestamp.trim():typeof e.completedAt=="string"&&e.completedAt.trim()&&(n=e.completedAt.trim()),n&&(r=n)}else if(typeof e=="boolean")t=e;else if(typeof e=="string"){var o=e.trim().toLowerCase();(o==="true"||o==="1"||o==="yes"||o==="done")&&(t=!0)}return{completed:t===!0,updatedAt:typeof r=="string"?r:null}}function Wh(e){var t={};if(Array.isArray(e)){for(var r=0;r<e.length;r+=1){var n=e[r];if(n!=null){if(typeof n=="string"&&n.trim()){t[n.trim()]={completed:!0,updatedAt:null};continue}if(typeof n=="object"){var o=null;if(typeof n.id=="string"&&n.id.trim()?o=n.id.trim():typeof n.key=="string"&&n.key.trim()?o=n.key.trim():typeof n.name=="string"&&n.name.trim()&&(o=n.name.trim()),!o)continue;t[o]=pl(n)}}}return t}if(e&&(typeof e=="object"||typeof e=="function"))for(var i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(a!=null){var c=typeof a=="string"?a:String(a);if(c){var l=c.trim();l&&(t[l]=pl(e[a]))}}}return t}function Yh(e){var t={};if(e&&(typeof e=="object"||typeof e=="function"))for(var r=Object.keys(e),n=0;n<r.length;n+=1){var o=r[n];o&&(t[o]=Wh(e[o]))}return t.locales||(t.locales={}),t.helpTopics||(t.helpTopics={}),t.printGuides||(t.printGuides={}),t}function dl(e){if(!e||typeof e!="object"&&typeof e!="function")return null;var t=null;typeof e.id=="string"&&e.id.trim()&&(t=e.id.trim()),!t&&typeof e.key=="string"&&e.key.trim()&&(t=e.key.trim()),t||(t=qh());var r="";typeof e.name=="string"?r=e.name.trim():typeof e.title=="string"&&(r=e.title.trim());var n="";typeof e.targetDate=="string"&&e.targetDate.trim()?n=e.targetDate.trim():typeof e.releaseDate=="string"&&e.releaseDate.trim()&&(n=e.releaseDate.trim());var o="";if(typeof e.createdAt=="string"&&e.createdAt.trim()?o=e.createdAt.trim():typeof e.generatedAt=="string"&&e.generatedAt.trim()&&(o=e.generatedAt.trim()),!o)try{o=new Date().toISOString()}catch{o=""}var i=null;typeof e.updatedAt=="string"&&e.updatedAt.trim()?i=e.updatedAt.trim():typeof e.modifiedAt=="string"&&e.modifiedAt.trim()?i=e.modifiedAt.trim():typeof e.lastUpdated=="string"&&e.lastUpdated.trim()?i=e.lastUpdated.trim():typeof e.timestamp=="string"&&e.timestamp.trim()&&(i=e.timestamp.trim()),i||(i=o||null);var s="";typeof e.notes=="string"?s=e.notes.trim():typeof e.summary=="string"&&(s=e.summary.trim()),s&&s.length>8e3&&(s=s.slice(0,8e3));var a=!1;if(typeof e.archived=="boolean")a=e.archived;else if(typeof e.status=="string"){var c=e.status.trim().toLowerCase();(c==="archived"||c==="closed"||c==="complete")&&(a=!0)}var l=Yh(e.statuses);return{id:t,name:r,targetDate:n,createdAt:typeof o=="string"?o:"",updatedAt:typeof i=="string"?i:null,statuses:l,notes:s,archived:a===!0}}function So(e){var t={version:Wi,releases:[]};if(e==null)return t;var r=e;if(Array.isArray(r))return t.releases=r.map(dl).filter(Boolean),t;if(typeof r!="object"&&typeof r!="function")return t;typeof r.version=="number"&&Number.isFinite(r.version)&&(t.version=r.version);var n=null;if(Array.isArray(r.releases)?n=r.releases:Array.isArray(r.entries)?n=r.entries:Array.isArray(r.logs)&&(n=r.logs),!n&&r&&typeof r=="object"){var o=Object.values(r);o.length&&o.every(function(i){return i&&typeof i=="object"&&!Array.isArray(i)})&&(n=o)}return!n||!Array.isArray(n)?t.releases=[]:t.releases=n.map(dl).filter(Boolean),t}function fp(){_e();const e=T(),t=Me(e,Lr,"Error loading documentation tracker from localStorage:",null,{validate:n=>n===null||E(n)||Array.isArray(n)});if(!t)return{version:Wi,releases:[]};const r=So(t);return!r||!Array.isArray(r.releases)?{version:Wi,releases:[]}:r}function Ei(e){const t=T();if(e==null){Ee(t,Lr,"Error deleting documentation tracker from localStorage:");return}const r=So(e);if(!r.releases.length){Ee(t,Lr,"Error deleting documentation tracker from localStorage:");return}qe(t,Lr),Ae(t,Lr,{version:Wi,releases:r.releases},"Error saving documentation tracker to localStorage:",{disableCompression:!0})}function pp(){_e();const e=T(),t=Me(e,Br,"Error loading automatic gear rules from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?ue(r):[];if(n!==r&&yc(n,{skipNormalization:!0}),Array.isArray(n)){let o=!1;const i=n.map(s=>s&&typeof s=="object"&&typeof s.enabled>"u"?(o=!0,{...s,enabled:!0}):s);return o?i:n}return[]}function yc(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],i=n?o:Array.isArray(o)?ue(o):[],s=T();return qe(s,Br),Ae(s,Br,i,"Error saving automatic gear rules to localStorage:",{disableCompression:!0}),i}function gc(){if(_e(),Array.isArray(Sn)&&Sn.length){const{normalized:i,changed:s}=Ui(Sn);return s&&Yi(i,{skipNormalization:!0}),i}const e=T(),t=Me(e,ut,"Error loading automatic gear rule backups from localStorage:",[],{validate:i=>i===null||Array.isArray(i)}),r=Array.isArray(t)?t:[],{normalized:n,changed:o}=Ui(r);return o&&Yi(n,{skipNormalization:!0}),Sn=n,n}function Yi(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=Array.isArray(e)?e.slice():[],{normalized:i}=n?{normalized:o}:Ui(o);Sn=i;const s=T();qe(s,ut);let a=!1,c=!1;if(typeof window<"u"&&window.localStorage===s){const f=typeof C<"u"&&C.driver&&C.driver.constructor.name==="IndexedDBAdapter";typeof C<"u"&&C.setItem(ut,i).catch(u=>{if(console.warn("[Storage] Failed to async persist Auto Gear Backups to IDB:",u),f)try{Ae(s,ut,i,"Error saving automatic gear rule backups to localStorage:")}catch(y){console.warn("[Storage] Failed to persist Auto Gear Backups fallback to localStorage:",y)}})}if(!(typeof C<"u"&&C.driver&&C.driver.constructor.name==="IndexedDBAdapter"))return Ae(s,ut,i,"Error saving automatic gear rule backups to localStorage:",{onQuotaExceeded:(f,u={})=>{const y=sa(i);if(y){const d=y.label;return console.warn(d?`Removed automatic gear backup "${d}" to free up storage space before saving gear backups.`:"Removed oldest automatic gear backup entry to free up storage space before saving gear backups."),!0}const p=u&&u.storage?u.storage:s;return!!(!a&&(a=!0,Jm(p))||!c&&(c=!0,aa()))}}),i}function dp(){_e();const e=T();return Tf(e,an,"Error loading automatic gear seed flag from localStorage:")}function da(e){const t=T();Mf(t,an,!!e,"Error saving automatic gear seed flag to localStorage:")}function yp(){_e();const e=T(),t=Me(e,Dt,"Error loading automatic gear presets from localStorage:",[],{validate:o=>o===null||Array.isArray(o)}),r=Array.isArray(t)?t:[],n=Array.isArray(r)?ue(r):[];return n!==r&&ms(n,{skipNormalization:!0}),Array.isArray(n)?n:[]}let Ji=null,wo=null,Eo=null,Sn=null,Qi=null,Xi=null,Ro=null,To=null,Mo=null,No=null,Go=null,Dn=null,zo=null,Bo=null,xo=null,Hr=null,Fo=null,or=null;function Jh(){const e=new Set,t=r=>{if(typeof r=="string"){const n=r.trim();n&&e.add(n)}};if(typeof Zi=="function")try{t(Zi())}catch(r){console.warn("Unable to read automatic gear active preset id while evaluating compression policy.",r)}if(typeof es=="function")try{t(es())}catch(r){console.warn("Unable to read automatic gear auto preset id while evaluating compression policy.",r)}return e}function ms(e,t={}){const r=t||{},{skipNormalization:n=!1,disableCompression:o}=r,i=Array.isArray(e)?e.slice():[],s=n?i:Array.isArray(i)?ue(i):[],a=T();qe(a,Dt);let c=typeof o=="boolean"?o:!1;if(o===void 0){const l=Jh();l.size>0&&(c=s.some(f=>f&&typeof f=="object"&&typeof f.id=="string"&&l.has(f.id)))}return C&&C.setItem(Dt,s).catch(l=>console.warn("Failed to save auto gear presets to repo",l)),Ae(a,Dt,s,"Error saving automatic gear presets to localStorage:",c?{disableCompression:!0}:void 0),s}function gp(){if(Ji)return Ji;_e();const e=T(),t=Me(e,Ut,"Error loading automatic gear monitor defaults from localStorage:",{},{validate:o=>o===null||typeof o=="object"}),r=t&&typeof t=="object"?t:{},n=E(r)?ue(r):{};return n!==r&&mc(n,{skipNormalization:!0}),n&&typeof n=="object"?n:{}}function mc(e,t={}){const r=t||{},{skipNormalization:n=!1}=r,o=e&&typeof e=="object"?{...e}:{},i=n?o:E(o)?ue(o):{},s=T();return qe(s,Ut),Ji=i,C&&C.setItem(Ut,i).catch(c=>console.warn("Failed to save monitor defaults to repo",c)),C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter"||Ae(s,Ut,i,"Error saving automatic gear monitor defaults to localStorage:"),i}function yl(e,t){if(!e)return;const r=t||T();if(!r)return;let n;try{n=r.getItem(Dt)}catch(a){console.error("Error loading automatic gear presets while removing autosaved preset from localStorage:",a),be("read access",a,r),ce();return}if(n===null||typeof n>"u")return;let o,i=n;typeof n=="string"&&n&&(i=ln(n));try{o=JSON.parse(i)}catch(a){console.error("Error parsing automatic gear presets while removing autosaved preset from localStorage:",a);return}if(!Array.isArray(o))return;const s=o.filter(a=>!a||typeof a!="object"?!0:a.id!==e);s.length!==o.length&&ms(s,{skipNormalization:!0})}function Zi(){if(wo!==null)return typeof wo=="string"?wo:"";_e();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(Ot);return typeof t=="string"?t:""}catch(t){return console.error("Error loading automatic gear active preset from localStorage:",t),be("read access",t,e),ce(),""}}function mp(e){if(wo=e||"",C&&(e?C.setItem(Ot,e).catch(n=>console.warn("Failed to save active preset id",n)):C.removeItem(Ot).catch(n=>console.warn("Failed to remove active preset id",n))),C&&C.driver&&C.driver.constructor&&C.driver.constructor.name==="IndexedDBAdapter")return;const r=T();if(r)try{e?r.setItem(Ot,e):r.removeItem(Ot)}catch(n){console.error("Error saving automatic gear active preset to localStorage:",n),be("write access",n,r),ce()}}function es(){if(Eo!==null)return typeof Eo=="string"?Eo:"";_e();const e=T();if(!e||typeof e.getItem!="function")return"";try{const t=e.getItem(Qe);if(typeof t=="string"&&t)return t;const r=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(console.log("DEBUG: loadAutoGearAutoPresetId legacy check, legacyStorage exists:",!!r),r&&r.getItem){let n=r.getItem("cinePowerPlanner_autoGearAutoPreset");if(console.log("DEBUG: legacyValue for cinePowerPlanner_autoGearAutoPreset:",n),typeof n=="string"&&n||(n=r.getItem(Qe),typeof n=="string"&&n))return n}return""}catch(t){return console.error("Error loading automatic gear auto preset from localStorage:",t),be("read access",t,e),ce(),""}}function hp(e){Eo=e||"",C&&(e?C.setItem(Qe,e).catch(n=>console.warn("Failed to save auto preset id",n)):C.removeItem(Qe).catch(n=>console.warn("Failed to remove auto preset id",n))),C&&C.driver&&C.driver.constructor&&C.driver.constructor.name;const t=T();if(!t)return;let r="";try{const n=t.getItem(Qe);typeof n=="string"&&n&&(r=n)}catch(n){console.error("Error inspecting automatic gear auto preset in localStorage:",n),be("read access",n,t)}try{e?(t.setItem(Qe,e),r&&r!==e&&yl(r,t)):(t.removeItem(Qe),r&&yl(r,t))}catch(n){console.error("Error saving automatic gear auto preset to localStorage:",n),be("write access",n,t),ce()}}function bp(){if(Xi!==null)return!!Xi;_e();const e=T();return Tf(e,pr,"Error loading automatic gear backup visibility from localStorage:")}function Sp(e){Xi=!!e,C&&C.setItem(pr,!!e).catch(r=>console.warn("Failed to save visibility",r));const t=T();Mf(t,pr,!!e,"Error saving automatic gear backup visibility to localStorage:")}function wp(){const t=Number(Yg);if(!Number.isFinite(t))return bn;const r=Math.round(t);return Number.isFinite(r)?r<at?at:r>bn?bn:r:bn}function wn(e){const t=Number(e);if(!Number.isFinite(t))return Do();const r=Math.round(t);if(!Number.isFinite(r))return Do();if(r<at)return at;const n=wp();return r>n?n:r}function Do(){const e=wp();if(h&&typeof h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT=="number"){const r=h.AUTO_GEAR_BACKUP_RETENTION_DEFAULT;if(Number.isFinite(r)&&r>=at){const n=Math.round(r);return Number.isFinite(n)?n<at?at:n>e?e:n:e}}const t=Math.round(df);return Number.isFinite(t)?t>e?e:t<at?at:t:at}function Ao(e,t=Do()){if(e==null)return t;if(typeof e=="number")return wn(e);if(typeof e=="string"){const r=e.trim();if(!r)return t;const n=Number(r);if(Number.isFinite(n))return wn(n);const o=Oe(r);return o&&o.success?Ao(o.parsed,t):t}if(Array.isArray(e)){for(let r=0;r<e.length;r+=1){const n=Ao(e[r],null);if(typeof n=="number"&&Number.isFinite(n))return wn(n)}return t}if(E(e)){const r=["value","retention","limit","count"];for(let n=0;n<r.length;n+=1){const o=r[n];if(!Object.prototype.hasOwnProperty.call(e,o))continue;const i=Ao(e[o],null);if(typeof i=="number"&&Number.isFinite(i))return wn(i)}return t}return t}function Ep(){if(Qi!==null)return Qi;_e();const e=T(),t=Me(e,Kt,"Error loading automatic gear backup retention from localStorage:",Do(),{validate:r=>r===null||typeof r=="number"||typeof r=="string"||Array.isArray(r)||E(r)});return Ao(t)}function Ap(e){if(e==null||typeof e=="function"||typeof e=="object"&&!Array.isArray(e)&&!E(e))return;const t=T(),r=Ao(e);Qi=r,C&&C.setItem(Kt,r).catch(n=>console.warn("Failed to save backup retention",n)),qe(t,Kt),Ae(t,Kt,r,"Error saving automatic gear backup retention to localStorage:")}async function Qh(){const e=T(),t=(r,n)=>{if(r){if(typeof r.clear=="function")try{r.clear()}catch{}try{const o=[];try{for(let i=0;i<r.length;i++){const s=r.key(i);s&&o.push(s)}}catch(i){}try{Object.keys(r).forEach(i=>{i&&!o.includes(i)&&o.push(i)})}catch(i){}o.forEach(i=>{if(i!==At)try{r.removeItem(i)}catch(s){}})}catch{}}};t(e),typeof localStorage<"u"&&localStorage!==e&&t(localStorage),typeof sessionStorage<"u"&&t(sessionStorage);try{typeof globalThis<"u"&&(globalThis.__cameraPowerPlannerFactoryResetting=!0),typeof global<"u"&&(global.__cameraPowerPlannerFactoryResetting=!0),typeof window<"u"&&(window.__cameraPowerPlannerFactoryResetting=!0),h&&(h.__cameraPowerPlannerFactoryResetting=!0,h.__cineMonolithicProjectCleanupDone=!1),typeof sessionStorage<"u"&&sessionStorage.setItem(At,"true"),typeof localStorage<"u"&&localStorage.setItem(At,"true")}catch{}if(ve)try{ve.postMessage("factory-reset")}catch{}try{tp()}catch(r){console.warn("Unable to clear stored projects",r)}fr(),Ct&&typeof Ct.clear=="function"&&Ct.clear(),Array.isArray(vr)&&(vr.length=0);try{let r=null;if(h&&typeof h.clearBackupVault=="function"?r=h.clearBackupVault:typeof window<"u"&&typeof window.clearBackupVault=="function"?r=window.clearBackupVault:h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup.clearBackupVault=="function"&&(r=h.cineFeatureBackup.clearBackupVault),r&&await r(),typeof indexedDB<"u"){const n=["cinePowerPlannerBackupVault","cinePowerPlanner","cameraPowerPlanner"];if(typeof indexedDB.databases=="function")try{(await indexedDB.databases()).forEach(i=>{i.name&&!n.includes(i.name)&&n.push(i.name)})}catch(o){}await Promise.all(n.map(o=>new Promise(i=>{try{const s=indexedDB.deleteDatabase(o);s.addEventListener("success",()=>i()),s.addEventListener("error",()=>{console.warn(`Failed to delete IndexedDB database "${o}"`,s.error),i()}),s.addEventListener("blocked",()=>i())}catch{i()}})))}}catch(r){console.warn("Failed to clear backup vault",r)}if(typeof caches<"u"&&typeof caches.keys=="function")try{const r=await caches.keys();await Promise.all(r.map(function(n){return caches.delete(n)}))}catch(r){console.warn("Storage reset: Failed to clear Service Worker caches.",r)}}function ge(e){if(e===tr&&Ro)return Ro;if(e===rt&&To)return To;if(e===zt&&Mo)return Mo;if(e===Re&&No)return No;if(e===tt&&Go)return Go;if(e===Gt&&Dn)return Dn;if(e===ct&&zo)return zo;if(e===et&&Bo)return Bo;if(e===lt&&xo)return xo;if(e===Je&&Hr)return Hr;if(e===Ft()&&Fo)return Fo;const t=T();if(!t||typeof t.getItem!="function")return null;const r=_t(e);for(let o=0;o<r.length;o+=1){const i=r[o];try{const s=t.getItem(i);if(s==null){if(Lt.has(i))try{const a=t.getItem(`${i}${he}`);if(a!=null){const c=nr(a);return typeof c=="string"?c:String(a)}}catch(a){console.warn("Unable to read backup key for export",i,a),be("read access",a,t)}}else{const a=nr(s);return typeof a=="string"?a:String(s)}}catch(s){console.warn("Unable to read storage key for backup",i,s),be("read access",s,t)}}if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown"].includes(e)){const o=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(o&&typeof o.getItem=="function")try{const i=o.getItem(e);if(i!=null)return nr(i)}catch(i){console.warn("Unable to read preference from legacy localStorage",e,i)}}return null}function Kr(e){if(e==null)return null;if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isNaN(e)?null:e!==0;const t=String(e).trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}function hc(e){if(e==null)return null;let t=null,r=e;if(typeof e=="string"){const c=e.trim();if(!c)return null;t=c;try{r=JSON.parse(c)}catch{return{normalized:null,serialized:t}}}if(!r||typeof r!="object")return t?{normalized:null,serialized:t}:null;const n=typeof r.sections=="object"&&r.sections!==null,o=n?r.sections:r,i={};if(o&&typeof o=="object"){const c=Object.keys(o);for(let l=0;l<c.length;l+=1){const f=c[l],u=o[f];typeof u=="boolean"&&(i[f]=u)}}let s=null;if(typeof r.layout=="string"){const c=r.layout.trim();c&&(s=c)}s||(s=n?"standard":"rental");const a={sections:i,layout:s};if(n){const c=Object.keys(r);for(let l=0;l<c.length;l+=1){const f=c[l];f==="sections"||f==="layout"||(a[f]=zr(r[f]))}}return{normalized:a,serialized:t}}function Xh(){const e={},t=Kr(ge("darkMode"));t!==null&&(e.darkMode=t);const r=Kr(ge("pinkMode"));r!==null&&(e.pinkMode=r);const n=Kr(ge("highContrast"));n!==null&&(e.highContrast=n);const o=Kr(ge("reduceMotion"));o!==null&&(e.reduceMotion=o);const i=Kr(ge("relaxedSpacing"));i!==null&&(e.relaxedSpacing=i);const s=Kr(ge("showAutoBackups"));s!==null&&(e.showAutoBackups=s);const a=ge("accentColor");a&&(e.accentColor=a);const c=ge("fontSize");c&&(e.fontSize=c);const l=ge("fontFamily");l&&(e.fontFamily=l);const f=ge("language");f&&(e.language=f);const u=Ft(),y=ge(u);if(y)if(y==="[object Object]"||String(y).includes("[object Object]"))typeof h.DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=h.DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}};else try{e.mountVoltages=JSON.parse(y)}catch(P){console.warn("Failed to parse stored mount voltages for backup",P),typeof h.DEFAULT_MOUNT_VOLTAGES<"u"?e.mountVoltages=h.DEFAULT_MOUNT_VOLTAGES:e.mountVoltages={"V-Mount":{high:14.4,low:12},"Gold-Mount":{high:14.4,low:12},"B-Mount":{high:33.6,low:21.6}}}const p=Kr(ge("iosPwaHelpShown"));p!==null&&(e.iosPwaHelpShown=p);const d=ge(lt);d&&(e.temperatureUnit=d);const m=ge(Je);m&&(e.focusScale=m);const g=ge(zt);if(g){let P=null;if(typeof g=="string"){const A=g.trim();if(A)try{P=JSON.parse(A)}catch(O){console.warn("Failed to parse stored camera color preferences for backup",O),P=null}}P&&typeof P=="object"?e.cameraColors=zr(P):typeof g=="string"&&g.trim()&&(e.cameraColors=g)}const b=ge(Re);if(b!=null){const P=hc(b);P&&(P.normalized?e[Re]=zr(P.normalized):P.serialized&&(e[Re]=P.serialized))}return e}function Op(e){return Array.isArray(e)?e.map(t=>({id:t&&typeof t.id=="string"?t.id:null,name:t&&typeof t.name=="string"?t.name:"",data:t&&typeof t.data=="string"?t.data:""})).filter(t=>t.id&&t.name&&t.data):[]}function Zh(){const e=ge(nn());if(!e)return[];try{const t=JSON.parse(e);return Op(t)}catch(t){return console.warn("Failed to parse stored custom fonts for backup",t),[]}}let uo=[];function eb(e){if(!e||typeof e!="object")return null;const t={};return typeof e.source=="string"&&e.source&&(t.source=e.source),typeof e.reason=="string"&&e.reason&&(t.reason=e.reason),typeof e.permissionState=="string"&&e.permissionState&&(t.permissionState=e.permissionState),Object.keys(t).length?t:null}function Cp(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id.trim():"";if(!t)return null;const r=typeof e.fileName=="string"&&e.fileName?e.fileName:"cine-power-planner-backup.json",n=typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)?e.createdAtMs:null,o=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:n!==null?new Date(n).toISOString():null;let i=n;if(i===null&&o){const a=Date.parse(o);Number.isFinite(a)&&(i=a)}i===null&&(i=Date.now());const s=eb(e.metadata);return{id:t,fileName:r,payload:e.payload,createdAt:o||new Date(i).toISOString(),createdAtMs:i,metadata:s||{}}}function Uo(e){if(!e)return[];let t=e;if(typeof e=="string"){const o=Oe(e);o&&o.success&&(t=o.parsed)}const r=Array.isArray(t)?t:[],n=[];return r.forEach(o=>{const i=Cp(o);i&&n.push(i)}),n}function gl(e){if(!e)return 0;let t=0;return e.payload!==null&&e.payload!==void 0&&(t+=3),typeof e.fileName=="string"&&e.fileName&&(t+=1),typeof e.createdAt=="string"&&e.createdAt&&(t+=1),typeof e.createdAtMs=="number"&&Number.isFinite(e.createdAtMs)&&(t+=1),e.metadata&&typeof e.metadata=="object"&&(t+=1),t}function Pp(e,t){const r=new Map,n=o=>{Array.isArray(o)&&o.forEach(i=>{const s=Cp(i);if(!s)return;const a=r.get(s.id);(!a||gl(s)>=gl(a))&&r.set(s.id,s)})};return n(e),n(t),Array.from(r.values())}function _p(){const e=ge("cineBackupVaultFallbackRecords");return Uo(e)}function kp(){return h&&h.cineFeatureBackup&&typeof h.cineFeatureBackup=="object"?h.cineFeatureBackup:h&&typeof h.getQueuedBackupPayloads=="function"?h:null}function vp(){const e=kp();if(!e)return;const t=typeof e.listBackupVaultRecords=="function"?e.listBackupVaultRecords:typeof e.getQueuedBackupPayloads=="function"?e.getQueuedBackupPayloads:null;if(!t)return;let r=null;try{r=t()}catch(n){console.warn("Unable to load backup vault records for export",n);return}if(Array.isArray(r)){uo=Uo(r);return}return r&&typeof r.then=="function"?r.then(n=>(uo=Uo(n),uo)).catch(n=>(console.warn("Unable to load backup vault records for export",n),[])):Promise.resolve(uo)}function jp(){return h&&h.cineAutoGearPersistence?h.cineAutoGearPersistence:h&&h.cineModules&&typeof h.cineModules.get=="function"&&h.cineModules.get("cineAutoGearPersistence")||null}function tb(){const e=jp();if(!e)return null;const t=typeof e.getCacheSnapshot=="function"?e.getCacheSnapshot():null,r=(n,o,i)=>{if(t&&Object.prototype.hasOwnProperty.call(t,n))return t[n];if(i&&typeof e[i]=="function")try{return e[i]()}catch(s){console.warn(`Failed to read ${n} from Auto-Gear persistence cache`,s)}return o};return{autoGearRules:r("autoGearRules",[],"readAutoGearRules"),autoGearBackups:r("autoGearBackups",[],"readAutoGearBackups"),autoGearPresets:r("autoGearPresets",[],"readAutoGearPresets"),autoGearMonitorDefaults:r("autoGearMonitorDefaults",{},"readAutoGearMonitorDefaults"),autoGearActivePresetId:r("autoGearActivePresetId","","readActivePresetId"),autoGearAutoPresetId:r("autoGearAutoPresetId","","readAutoPresetId"),autoGearBackupRetention:r("autoGearBackupRetention",null,"readBackupRetention"),autoGearShowBackups:r("autoGearShowBackups",!1,"readBackupVisibility")}}async function rb(){return await vp()}function nb(){vp();const e=tb(),t={devices:zf(),setups:Ho(),session:Nf(),feedback:cp(),project:(()=>{const f=Jf();if(!f||typeof f!="object")return{};const u={};return Object.keys(f).forEach(y=>{const p=f[y];if(typeof p=="string")try{const d=JSON.parse(p);u[y]=d}catch{console.warn("[Export] Found non-JSON string in project data",y),u[y]=p}else u[y]=p}),u})(),favorites:rp(),contacts:ip(),ownGear:Dn||[],userProfile:null,autoGearRules:e?e.autoGearRules:pp(),autoGearBackups:e?e.autoGearBackups:gc(),autoGearSeeded:dp(),autoGearPresets:e?e.autoGearPresets:yp(),autoGearMonitorDefaults:e?e.autoGearMonitorDefaults:gp(),autoGearActivePresetId:e?e.autoGearActivePresetId:Zi(),autoGearAutoPresetId:e?e.autoGearAutoPresetId:es(),autoGearShowBackups:e?e.autoGearShowBackups:bp(),autoGearBackupRetention:e?e.autoGearBackupRetention:Ep(),fullBackupHistory:Lo()},r=fp();r&&Array.isArray(r.releases)&&r.releases.length&&(t.documentationTracker=r);const n=Xh();Object.keys(n).length&&(t.preferences=n);const o=ap();o&&typeof o=="object"&&(typeof o.name=="string"&&o.name||typeof o.role=="string"&&o.role||typeof o.avatar=="string"&&o.avatar||typeof o.phone=="string"&&o.phone||typeof o.email=="string"&&o.email)?t.userProfile=o:delete t.userProfile;const i=ge(rt);i&&(t.customLogo=i);const s=Zh();s.length&&(t.customFonts=s);const a=ge(dt);a!=null&&(t.schemaCache=a);const c=_p(),l=Pp(uo,c);return l.length&&(t.backupVaultRecords=l.map(f=>zr(f))),t}function fe(e,t){const r=T();if(!r)return;const n=Lt.has(e),o=`${e}${he}`;C&&C.driver&&C.driver.constructor&&C.driver.constructor.name;const i=new Set([tr,rt,zt,Re,tt,Gt,ct,et,lt,Je,lt,Je,Ft(),Fe,"darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",dt,Br,ut,Dt,Ut,Kt,an,Ot,Qe,pr]),s=()=>{e===tr&&(Ro=null),e===rt&&(To=null),e===zt&&(Mo=null),e===Re&&(No=null),e===tt&&(Go=null),e===Gt&&(Dn=null),e===ct&&(zo=null),e===et&&(Bo=null),e===lt&&(xo=null),e===Je&&(Hr=null),e===Je&&(Hr=null),e===Ft()&&(Fo=null),e===Fe&&(or=null)},a=c=>{if(r.setItem(e,c),["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",dt].includes(e)||i.has(e)){const u=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage||typeof globalThis<"u"&&globalThis.localStorage;if(u&&u!==r)try{u.setItem(e,c)}catch{}else u||console.warn("DEBUG: legacyStorage NOT FOUND in writeLegacyStorage for",e)}if(n)try{r.setItem(o,c)}catch(u){console.warn("Unable to update backup key during import",o,u),be("write access",u,r),ce()}};try{if(t==null){s(),C&&C.removeItem(e).catch(l=>console.warn("Failed to remove key from repo",e,l)),r.removeItem(e);const c=typeof global<"u"&&global.localStorage||typeof window<"u"&&window.localStorage;if(c&&c!==r)try{c.removeItem(e)}catch(l){}if(n)try{r.removeItem(o)}catch(l){console.warn("Unable to remove backup key during import",o,l),be("deletion",l,r)}}else{const c=String(t);e===tr&&(Ro=c),e===rt&&(To=c),e===zt&&(Mo=c),e===Re&&(No=c),e===tt&&(Go=c),e===Gt&&(Dn=c),e===ct&&(zo=c),e===et&&(Bo=c),e===lt&&(xo=c),e===Je&&(Hr=c),e===Je&&(Hr=c),e===Ft()&&(Fo=c),e===Fe&&(or=JSON.parse(c)),C&&C.setItem(e,c).catch(l=>{console.warn("Failed to save key to repo",e,l);try{a(c)}catch(f){console.warn("Unable to persist fallback legacy storage key during repo failure",e,f),be("write access",f,r),n&&ce()}});try{a(c)}catch(l){console.warn("DEBUG: writeLegacyStorage failed",l)}}}catch(c){console.warn("Unable to persist storage key during import",e,c),be("write access",c,r),n&&ce()}}function vn(e){if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();return t?t==="true"||t==="1"||t==="yes"||t==="on"?!0:t==="false"||t==="0"||t==="no"||t==="off"?!1:null:null}if(typeof e=="number")return Number.isNaN(e)?null:e!==0;if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=vn(e[t]);if(r!==null)return r}return null}if(E(e)){if(Object.prototype.hasOwnProperty.call(e,"value"))return vn(e.value);if(Object.prototype.hasOwnProperty.call(e,"enabled"))return vn(e.enabled)}return null}function ir(e,t=[],r=null){if(re(e)){const n=ne(e);return n?ir(n,t,r):[]}if(Array.isArray(e))return r?e.filter(n=>r(n)):e.filter(n=>n!=null);if(typeof e=="string"){const n=Oe(e);return n.success?ir(n.parsed,t,r):[]}if(E(e)){for(let o=0;o<t.length;o+=1){const i=t[o];if(!Object.prototype.hasOwnProperty.call(e,i))continue;const s=ir(e[i],t,r);if(s.length)return s}const n=Object.values(e);if(n.length)return r?n.filter(o=>r(o)):n.filter(o=>o!=null)}return[]}function ob(e){const t=ir(e,["contacts","entries","items","list","values","data"],r=>r&&typeof r=="object");return Array.isArray(t)?pc(t):[]}function ib(e){const t=ir(e,["rules","items","entries","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?ue(t):[]}function sb(e){const t=ir(e,["backups","entries","items","list","values","data"],n=>n!==null&&typeof n=="object");if(!Array.isArray(t))return[];const{normalized:r}=Ui(t);return r}function Ai(e){if(e==null)return null;if(typeof e=="number")return wn(e);if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(Number.isFinite(r))return wn(r);const n=Oe(t);return n&&n.success?Ai(n.parsed):null}if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=Ai(e[t]);if(typeof r=="number")return r}return null}if(E(e)){const t=["value","retention","limit","count"];for(let r=0;r<t.length;r+=1){const n=t[r];if(!Object.prototype.hasOwnProperty.call(e,n))continue;const o=Ai(e[n]);if(typeof o=="number")return o}return null}return typeof e=="boolean"&&e?at:null}function ab(e){const t=ir(e,["presets","entries","items","list","values","data"],r=>r!==null&&typeof r=="object");return Array.isArray(t)?ue(t):[]}function cb(e){if(!e||typeof e!="object")return{};const t={};Object.entries(e).forEach(([n,o])=>{if(typeof o!="string")return;const i=o.trim();i&&(t[n]=i)});const r=ue(t);return E(r)?r:t}function ya(e){if(typeof e=="string")return e;if(typeof e=="number")return Number.isNaN(e)?"":String(e);if(Array.isArray(e)){for(let t=0;t<e.length;t+=1){const r=ya(e[t]);if(r)return r}return""}if(E(e)){if(typeof e.id=="string"&&e.id)return e.id;if(typeof e.value=="string")return e.value;if(Object.prototype.hasOwnProperty.call(e,"name"))return ya(e.name)}return""}function ml(e){const t=ir(e,["backupVaultRecords","backupVault","vault","records","entries","items","list","values","data"],r=>r&&typeof r=="object");return Uo(t)}function hl(e){const t=Uo(e);if(!t.length)return;const r=_p(),n=Pp(r,t);try{fe("cineBackupVaultFallbackRecords",JSON.stringify(n))}catch(a){console.warn("Unable to persist imported backup vault fallback records",a)}const o=kp();if(!o||typeof o.queueBackupPayloadForVault!="function")return;const i=a=>{o.queueBackupPayloadForVault(a.fileName,a.payload,{id:a.id,createdAt:a.createdAt,createdAtMs:a.createdAtMs,source:a.metadata&&a.metadata.source?a.metadata.source:void 0,reason:a.metadata&&a.metadata.reason?a.metadata.reason:void 0,permissionState:a.metadata&&a.metadata.permissionState?a.metadata.permissionState:void 0})},s=typeof o.listBackupVaultRecords=="function"?o.listBackupVaultRecords:typeof o.getQueuedBackupPayloads=="function"?o.getQueuedBackupPayloads:null;if(!s){t.forEach(i);return}try{const a=s();if(Array.isArray(a)){const c=new Set(a.map(l=>l&&l.id?l.id:null));t.forEach(l=>{c.has(l.id)||i(l)});return}if(a&&typeof a.then=="function"){a.then(c=>{const l=new Set(Array.isArray(c)?c.map(f=>f&&f.id?f.id:null):[]);t.forEach(f=>{l.has(f.id)||i(f)})}).catch(c=>{console.warn("Unable to inspect backup vault before import",c),t.forEach(i)});return}t.forEach(i)}catch(a){console.warn("Unable to import backup vault records via backup module",a),t.forEach(i)}}function lb(e){return _t(e)}function We(e,t){if(!E(e))return null;const r=lb(t);for(let n=0;n<r.length;n+=1){const o=r[n];if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"primary"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${he}`;if(Object.prototype.hasOwnProperty.call(e,o))return{key:o,value:e[o],type:"backup"}}for(let n=0;n<r.length;n+=1){const o=`${r[n]}${cn}`;if(console.log("DEBUG: readSnapshotEntry checking migration candidate",o,Object.prototype.hasOwnProperty.call(e,o)),Object.prototype.hasOwnProperty.call(e,o))return console.log("DEBUG: readSnapshotEntry FOUND migration backup",o),{key:o,value:e[o],type:"migration-backup"}}return null}function jn(e){if(!e)return;let t=e.value;if(e.type==="migration-backup")try{const r=typeof t=="string"?JSON.parse(t):t;if(r&&typeof r=="object"){const n=typeof r.compression=="string"?r.compression.trim():"",o=typeof r.encoding=="string"?r.encoding.trim():"",i=n===bf&&o===Sf,s=jo.test(n)||jo.test(o);if((i||s)&&typeof r.data=="string")if(Xa()){let a=typeof r.compressionVariant=="string"&&r.compressionVariant?r.compressionVariant:null;a||(s?a=sl(o)||sl(n)||"utf16":a="utf16");const c=Ef(r.data,fs,a,"migration backup entry");if(c.success&&typeof c.value=="string")try{const l=JSON.parse(c.value);l&&typeof l=="object"&&Object.prototype.hasOwnProperty.call(l,"data")?t=l.data:t=null}catch(l){console.log("DEBUG: extractSnapshotStoredValue parse error",l),t=null}else console.log("DEBUG: extractSnapshotStoredValue decompression failed",c),console.warn("Unable to decompress migration backup entry during import",e&&e.key,c.error),t=null}else console.log("DEBUG: extractSnapshotStoredValue compression unavailable"),console.warn("Compression support is unavailable while reading migration backup entry",e&&e.key),t=null;else Object.prototype.hasOwnProperty.call(r,"data")?t=r.data:t=null}else t=null}catch(r){console.warn("Unable to parse migration backup entry during import",e.key,r),t=null}return t}function ii(e){const t=jn(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=nr(t);if(r===null)return null;if(r===void 0)return;if(typeof r!="string")return r;const n=r.trim();if(!n)return"";try{return JSON.parse(n)}catch{return r}}return t}}function Sr(e){const t=jn(e);if(t!==void 0){if(t===null)return null;if(typeof t=="string"){const r=nr(t);if(r===null)return null;if(r===void 0)return;if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return String(r);if(Array.isArray(r)||r&&typeof r=="object")try{return JSON.stringify(r)}catch(n){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,n),null}return null}if(typeof t=="number"||typeof t=="boolean")return String(t);if(Array.isArray(t)||t&&typeof t=="object")try{return JSON.stringify(t)}catch(r){return console.warn("Unable to serialize snapshot entry during import",e&&e.key,r),null}return null}}function ub(e){if(!E(e)||["devices","setups","session","feedback","favorites","contacts","preferences","project","projects","autoGearRules","autoGearBackups","autoGearPresets","autoGearMonitorDefaults","autoGearSeeded","autoGearActivePresetId","autoGearAutoPresetId","autoGearBackupRetention","autoGearShowBackups","fullBackupHistory","fullBackups","backupVaultRecords"].some(w=>Object.prototype.hasOwnProperty.call(e,w)))return null;const n={};let o=!1,i=!1;const s=["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","accentColor","fontSize","fontFamily","language","iosPwaHelpShown",zt,Re],a=Ft(),c=new Set([rt,...s,a].filter(w=>typeof w=="string"&&w)),l=new Set(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"]),f=w=>{if(!w||typeof w.key!="string")return;if(w.key.startsWith("cameraPowerPlanner_")||w.key.startsWith("cinePowerPlanner_")||w.key.endsWith(he)||w.key.endsWith(cn)){i=!0;return}const S=w.key.replace(/(?:__backup|__legacyMigrationBackup)$/u,"");c.has(S)&&(i=!0)},u=(w,S)=>{const I=We(e,w);if(!I)return;f(I);const B=ii(I);B!==void 0&&(n[S]=B,o=!0)};u(Ze,"devices"),u(pt,"setups"),u(er,"session"),u(Mr,"feedback"),u(pe,"project"),u(et,"favorites"),u(tt,"contacts"),u(Gt,"ownGear"),u(ct,"userProfile"),u(Lr,"documentationTracker"),u(Br,"autoGearRules"),u(ut,"autoGearBackups"),u(Dt,"autoGearPresets"),u(Ut,"autoGearMonitorDefaults"),u(Kt,"autoGearBackupRetention");const y=We(e,dt);if(y){f(y);const w=Sr(y);w!==void 0&&(n.schemaCache=w,o=!0)}const p=We(e,nn());if(p){f(p);const w=ii(p);w!==void 0&&(n.customFonts=w,o=!0)}const d=We(e,rt);if(d){f(d);const w=Sr(d);w!==void 0&&(n.customLogo=w,o=!0)}const m=We(e,an);m&&(f(m),n.autoGearSeeded=jn(m),o=!0);const g=We(e,Ot);g&&(f(g),n.autoGearActivePresetId=Sr(g),o=!0);const b=We(e,Qe);b&&(f(b),n.autoGearAutoPresetId=Sr(b),o=!0);const P=We(e,pr);P&&(f(P),n.autoGearShowBackups=jn(P),o=!0);const A={};s.forEach(w=>{const S=We(e,w);if(!S)return;if(f(S),w===Re){const M=Sr(S);if(M!==void 0){const G=hc(M);if(G){if(G.normalized){A[w]=zr(G.normalized),o=!0;return}if(G.serialized){A[w]=G.serialized,o=!0;return}}}return}const I=jn(S);if(l.has(w)){const M=vn(I);if(M!==null){A[w]=M,o=!0;return}}const B=Sr(S);B!==void 0&&(A[w]=B,o=!0)});const O=We(e,lt);if(O){f(O);const w=Sr(O);if(typeof w=="string"){const S=w.trim();S&&(A.temperatureUnit=S,o=!0)}}const _=We(e,Je);if(_){f(_);const w=Sr(_);if(typeof w=="string"){const S=w.trim();S&&(A.focusScale=S,o=!0)}}const k=We(e,zt);if(k){f(k);const w=ii(k);w!==void 0&&(A.cameraColors=w,o=!0)}const j=We(e,a);if(j){f(j);const w=ii(j);w!==void 0&&(A.mountVoltages=w,o=!0)}return Object.keys(A).length>0&&(n.preferences=A),!o||!i?null:n}function Ip(e,t={}){if(console.error("DEBUG: importAllData CALLED",Object.keys(e)),Array.isArray(e)){bo(e,()=>fl());return}if(!E(e))return;const{skipSnapshotConversion:r=!1}=t||{};if(!r){const p=ub(e);if(p){Ip(p,{skipSnapshotConversion:!0});return}}const n=p=>Object.prototype.hasOwnProperty.call(e,p),o=Ft(),i=zt,s=jp(),a=(p,d,m)=>{if(s&&typeof s[p]=="function")try{return s[p](m),!0}catch(g){console.warn(`Failed to persist Auto-Gear value with ${p}`,g)}return typeof d=="function"&&d(m),!1};if(n("devices")&&Bf(e.devices),n("setups")&&ic(e.setups),n("session")&&oc(e.session,{disableCompression:!0}),n("feedback")&&lp(e.feedback),n("favorites")&&np(e.favorites),n("contacts"))if(e.contacts===null)pa(null);else{const p=ob(e.contacts);pa(p)}if(n("ownGear")){const p=ir(e.ownGear,["items","entries","list","values","data"],d=>d&&typeof d=="object");sp(p)}if(n("userProfile")){if(e.userProfile===null)wi(null);else if(E(e.userProfile)){const p=dc(e.userProfile);wi(p||null)}}if(E(e.preferences)){const p=e.preferences;if(["darkMode","pinkMode","highContrast","reduceMotion","relaxedSpacing","showAutoBackups","iosPwaHelpShown"].forEach(g=>{Object.prototype.hasOwnProperty.call(p,g)&&typeof p[g]=="boolean"&&fe(g,p[g])}),["accentColor","fontSize","fontFamily","language"].forEach(g=>{if(Object.prototype.hasOwnProperty.call(p,g)){const b=p[g];typeof b=="string"&&b&&fe(g,b)}}),Object.prototype.hasOwnProperty.call(p,"temperatureUnit")){const g=p.temperatureUnit;if(typeof g=="string"){const b=g.trim();b&&fe(lt,b)}else g===null&&fe(lt,null)}if(Object.prototype.hasOwnProperty.call(p,"focusScale")){const g=p.focusScale;if(typeof g=="string"){const b=g.trim();if(b&&(fe(Je,b),typeof window<"u"&&typeof window.applyFocusScalePreference=="function"))try{window.applyFocusScalePreference(b,{persist:!1,forceUpdate:!0})}catch(P){console.warn("Unable to apply imported focus scale preference",P)}}else g===null&&fe(Je,null)}if(Object.prototype.hasOwnProperty.call(p,Re)){const g=p[Re];if(g===null)fe(Re,null);else{const b=hc(g);if(b){if(b.normalized){const P=zr(b.normalized);let A=null;try{A=JSON.stringify(P)}catch(O){console.warn("Unable to serialize imported print preferences",O),A=null}if(A!==null)try{fe(Re,A)}catch(O){console.warn("Unable to persist imported print preferences",O)}if(typeof window<"u"&&typeof window.savePrintPreferences=="function")try{window.savePrintPreferences(P)}catch(O){console.warn("Unable to apply imported print preferences",O)}}else if(b.serialized)try{fe(Re,b.serialized)}catch(P){console.warn("Unable to store imported print preferences string value",P)}}}}if(Object.prototype.hasOwnProperty.call(p,"mountVoltages")){const g=p.mountVoltages;if(g&&typeof g=="object"){try{fe(o,JSON.stringify(g))}catch(b){console.warn("Unable to store imported mount voltages",b)}typeof window<"u"&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(g,{persist:!1,triggerUpdate:!0})}else if(typeof g=="string"){if(fe(o,g),typeof window<"u"&&typeof window.parseStoredMountVoltages=="function")try{const b=window.parseStoredMountVoltages(g);b&&typeof window.applyMountVoltagePreferences=="function"&&window.applyMountVoltagePreferences(b,{persist:!1,triggerUpdate:!0})}catch(b){console.warn("Unable to parse imported mount voltages",b)}}else g===null&&(fe(o,null),typeof window<"u"&&typeof window.resetMountVoltagePreferences=="function"&&window.resetMountVoltagePreferences({persist:!1,triggerUpdate:!0}))}if(Object.prototype.hasOwnProperty.call(p,"cameraColors")){const g=p.cameraColors,b=P=>{if(!P||typeof P!="object")return!1;let A=!1;if(typeof window<"u"&&window&&typeof window.setCameraLetterColors=="function")try{window.setCameraLetterColors(P),A=!0}catch(_){console.warn("Unable to apply imported camera color preferences",_),A=!1}let O=null;try{O=JSON.stringify(P)}catch(_){console.warn("Unable to serialize imported camera color preferences",_),O=null}if(O)try{fe(i,O)}catch(_){console.warn("Unable to persist imported camera color preferences",_)}return A};if(g&&typeof g=="object")b(g);else if(typeof g=="string"){const P=g.trim();if(P){let A=null;try{A=JSON.parse(P)}catch(O){console.warn("Unable to parse imported camera color palette",O),A=null}if(A&&typeof A=="object")b(A);else try{fe(i,P)}catch(O){console.warn("Unable to store raw imported camera color palette",O)}}}else g===null&&fe(i,null)}}if(Object.prototype.hasOwnProperty.call(e,"customLogo")){const p=e.customLogo;typeof p=="string"&&p?fe(rt,p):fe(rt,null)}if(Object.prototype.hasOwnProperty.call(e,"customFonts")){const p=Op(e.customFonts);if(p.length)try{fe(nn(),JSON.stringify(p))}catch(d){console.warn("Unable to store imported custom fonts",d)}else fe(nn(),null)}if(Object.prototype.hasOwnProperty.call(e,"schemaCache")){const p=e.schemaCache;if(typeof p=="string"||p===null)fe(dt,p);else if(p&&typeof p=="object")try{fe(dt,JSON.stringify(p))}catch(d){console.warn("Unable to store imported schema cache",d)}}if(Object.prototype.hasOwnProperty.call(e,"documentationTracker")){const p=So(e.documentationTracker);Ei(p)}else if(Object.prototype.hasOwnProperty.call(e,"documentationLogs")){const p=So({releases:e.documentationLogs});Ei(p)}else if(Object.prototype.hasOwnProperty.call(e,"documentationUpdateLog")){const p=So(e.documentationUpdateLog);Ei(p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearRules")){const p=ib(e.autoGearRules);a("persistAutoGearRules",yc,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackups")){const p=sb(e.autoGearBackups);a("persistAutoGearBackups",Yi,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearSeeded")){const p=vn(e.autoGearSeeded);da(p===null?!1:p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearPresets")){const p=ab(e.autoGearPresets);a("persistAutoGearPresets",ms,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearMonitorDefaults")){const p=cb(e.autoGearMonitorDefaults);a("persistAutoGearMonitorDefaults",mc,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearActivePresetId")){const p=ya(e.autoGearActivePresetId);a("persistActivePresetId",mp,typeof p=="string"?p:"")}if(Object.prototype.hasOwnProperty.call(e,"autoGearAutoPresetId")){const p=typeof e.autoGearAutoPresetId=="string"?e.autoGearAutoPresetId:"";a("persistAutoPresetId",hp,p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearShowBackups")){const p=vn(e.autoGearShowBackups);a("persistBackupVisibility",Sp,p===null?!1:p)}if(Object.prototype.hasOwnProperty.call(e,"autoGearBackupRetention")){const p=Ai(e.autoGearBackupRetention);typeof p=="number"&&Number.isFinite(p)&&a("persistBackupRetention",Ap,p)}if(Object.prototype.hasOwnProperty.call(e,"fullBackupHistory")){const p=Jt(e.fullBackupHistory);qi(p)}else if(Object.prototype.hasOwnProperty.call(e,"fullBackups")){const p=Jt(e.fullBackups);qi(p)}if(Object.prototype.hasOwnProperty.call(e,"backupVaultRecords")){const p=ml(e.backupVaultRecords);hl(p)}else if(Object.prototype.hasOwnProperty.call(e,"backupVault")){const p=ml(e.backupVault);hl(p)}let c=null;const l=()=>(c||(c=fl()),c);let f=!1;const u=()=>{const p=l();return(d,m,g)=>{f=!0,p(d,m,g)}},y=(p,d)=>{const g=bo(p,()=>u(),d);return g&&(f=!0),g};e.project&&y(e.project,""),e.projects?y(e.projects):!e.project&&typeof e.gearList=="string"&&(u()("",{gearList:e.gearList}),f=!0),f||Dh(e).forEach((d,m)=>{if(d&&typeof d=="object"&&!Array.isArray(d)){const b=Hi(d)?d:$e(d);if(b&&Hi(b)){u()("",b,`Imported project ${m+1}`),f=!0;return}}bo(d,()=>u(),`Imported project ${m+1}`)&&(f=!0)})}function fb(){return Ve}var yr={getSafeLocalStorage:T,loadDeviceData:zf,saveDeviceData:Bf,loadSetups:Ho,saveSetups:ic,saveSetup:fh,loadSetup:ph,deleteSetup:dh,renameSetup:yh,safeSetLocalStorage:fe,readLocalStorageValue:ge,getMountVoltageStorageKeyName:Ft,getMountVoltageStorageBackupKeyName:uf,getProjectStorageRevisionKeyName:$g,loadProjectStorageRevision:sf,loadProject:Jf,loadProjectMetadata:Nh,saveProject:fc,deleteProject:tp,renameProject:Fh,createProjectDeletionBackup:zh,loadSessionState:Nf,saveSessionState:oc,loadFavorites:rp,saveFavorites:np,loadContacts:ip,saveContacts:pa,loadOwnGear:Hh,saveOwnGear:sp,loadUserProfile:ap,saveUserProfile:wi,loadDocumentationTracker:fp,saveDocumentationTracker:Ei,loadAutoGearBackups:gc,saveAutoGearBackups:Yi,loadFeedback:cp,saveFeedback:lp,clearAllData:Qh,exportAllData:nb,prepareBackupForExport:rb,importAllData:Ip,loadAutoGearRules:pp,saveAutoGearRules:yc,loadAutoGearSeedFlag:dp,saveAutoGearSeedFlag:da,loadAutoGearPresets:yp,saveAutoGearPresets:ms,loadAutoGearMonitorDefaults:gp,saveAutoGearMonitorDefaults:mc,loadAutoGearActivePresetId:Zi,saveAutoGearActivePresetId:mp,loadAutoGearAutoPresetId:es,saveAutoGearAutoPresetId:hp,loadAutoGearBackupVisibility:bp,saveAutoGearBackupVisibility:Sp,loadAutoGearBackupRetention:Ep,saveAutoGearBackupRetention:Ap,getAutoGearBackupRetentionDefault:Do,loadFullBackupHistory:Lo,saveFullBackupHistory:qi,recordFullBackupHistoryEntry:up,requestPersistentStorage:vf,clearUiCacheStorageEntries:sn,ensureCriticalStorageBackups:um,getLastCriticalStorageGuardResult:fm,decodeStoredValue:nr,getCompressionLogSnapshot:Tg,setActiveProjectCompressionHold:Ih,clearActiveProjectCompressionHold:Lh,invalidateProjectReadCache:fr,getProjectMemoryCache:fb,storageRepo:C},bl={flag:Qa,read:Qu,write:yi,clear:vg};try{Object.defineProperty(yr,"__testAutoBackupCompressionCache",{configurable:!1,enumerable:!1,writable:!1,value:bl})}catch{yr.__testAutoBackupCompressionCache=bl}typeof module<"u"&&module.exports&&(module.exports=yr);console.log("DEBUG: storage.js: starting global export loop");if(h&&typeof h=="object"){Object.keys(yr).forEach(e=>{const t=yr[e];if(typeof t=="function"&&typeof h[e]!="function")try{h[e]=t}catch{try{Object.defineProperty(h,e,{configurable:!0,writable:!0,value:t})}catch(n){typeof console<"u"&&typeof console.warn=="function"&&console.warn(`Unable to expose storage helper ${e} globally.`,n)}}});try{typeof h.recordFullBackupHistoryEntry!="function"&&(h.recordFullBackupHistoryEntry=up),typeof h.loadFullBackupHistory!="function"&&(h.loadFullBackupHistory=Lo)}catch{}}if(h)try{Object.defineProperty(h,"__cineStorageApi",{configurable:!0,writable:!0,value:yr})}catch{h.__cineStorageApi=yr}console.log("DEBUG: storage.js execution finished");const pb=yr,Qt=Object.freeze(Object.defineProperty({__proto__:null,cineStorage:pb,default:yr},Symbol.toStringTag,{value:"Module"}));var Sl={};const hs=Kn();function db(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];try{const o=n&&n.cineModuleLinker;if(o&&typeof o=="object")return o}catch{}}return null}function yb(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineModuleEnvironment=="object")return n.cineModuleEnvironment}return null}function gb(e){const t=[e];typeof globalThis<"u"&&t.indexOf(globalThis)===-1&&t.push(globalThis),typeof window<"u"&&t.indexOf(window)===-1&&t.push(window),typeof self<"u"&&t.indexOf(self)===-1&&t.push(self),typeof global<"u"&&t.indexOf(global)===-1&&t.push(global);for(let r=0;r<t.length;r+=1){const n=t[r];if(n&&typeof n.cineEnvironmentBridge=="object")return n.cineEnvironmentBridge}return null}const ie=db(hs),X=ie&&typeof ie.getModuleEnvironment=="function"?ie.getModuleEnvironment():yb(hs),Z=ie&&typeof ie.getEnvironmentBridge=="function"?ie.getEnvironmentBridge():gb(hs),H=(ie&&typeof ie.getGlobalScope=="function"?ie.getGlobalScope():null)||(Z&&typeof Z.getGlobalScope=="function"?Z.getGlobalScope():null)||(X&&typeof X.getGlobalScope=="function"?X.getGlobalScope():null)||hs;function mb(){const e=[H];typeof globalThis<"u"&&e.indexOf(globalThis)===-1&&e.push(globalThis),typeof window<"u"&&e.indexOf(window)===-1&&e.push(window),typeof self<"u"&&e.indexOf(self)===-1&&e.push(self),typeof global<"u"&&e.indexOf(global)===-1&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&typeof r.cineModuleGlobals=="object")return r.cineModuleGlobals}return null}const ee=(ie&&typeof ie.getModuleGlobals=="function"?ie.getModuleGlobals():null)||mb();function hb(e,t){if(ie&&typeof ie.recordModule=="function"&&ie.recordModule(e,t),!(!ee||typeof ee.recordModule!="function"))try{ee.recordModule(e,t)}catch{}}function wl(e){return null}(function(){return ie&&typeof ie.tryRequire=="function"?ie.tryRequire:ee&&typeof ee.tryRequire=="function"?ee.tryRequire:Z&&typeof Z.tryRequire=="function"?function(r){const n=Z.tryRequire(r);return typeof n>"u"?wl():n}:X&&typeof X.tryRequire=="function"?X.tryRequire:wl})();function bb(e){const t=e||H;if(ie&&typeof ie.getModuleRegistry=="function"){const n=ie.getModuleRegistry(t);if(n)return n}if(ee&&typeof ee.resolveModuleRegistry=="function")try{const n=ee.resolveModuleRegistry(t);if(n)return n}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const n=Z.getModuleRegistry(t);if(n)return n}catch{}if(X&&typeof X.resolveModuleRegistry=="function")try{const n=X.resolveModuleRegistry(t);if(n)return n}catch{}if(Se&&typeof Se=="object")return Se;const r=[t];typeof globalThis<"u"&&r.indexOf(globalThis)===-1&&r.push(globalThis),typeof window<"u"&&r.indexOf(window)===-1&&r.push(window),typeof self<"u"&&r.indexOf(self)===-1&&r.push(self),typeof global<"u"&&r.indexOf(global)===-1&&r.push(global);for(let n=0;n<r.length;n+=1){const o=r[n];if(o&&typeof o.cineModules=="object")return o.cineModules}return null}const In=(function(){if(ie&&typeof ie.getModuleRegistry=="function"){const e=ie.getModuleRegistry(H);if(e)return e}if(ee&&typeof ee.getModuleRegistry=="function")try{const e=ee.getModuleRegistry(H);if(e)return e}catch{}if(Z&&typeof Z.getModuleRegistry=="function")try{const e=Z.getModuleRegistry(H);if(e)return e}catch{}if(X&&typeof X.getModuleRegistry=="function")try{const e=X.getModuleRegistry(H);if(e)return e}catch{}return bb(H)})(),dn=(function(){if(ie&&typeof ie.getPendingQueueKey=="function"){const t=ie.getPendingQueueKey();if(typeof t=="string"&&t)return t}if(ee&&typeof ee.getPendingQueueKey=="function")try{const t=ee.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}if(Z&&typeof Z.getPendingQueueKey=="function")try{const t=Z.getPendingQueueKey();if(typeof t=="string"&&t)return t}catch{}return X&&typeof X.PENDING_QUEUE_KEY=="string"?X.PENDING_QUEUE_KEY:"__cinePendingModuleRegistrations__"})();function Sb(e){if(!e||typeof e!="object")return{};const t={},r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];t[o]=e[o]}return t}function wb(e,t,r){if(ee&&typeof ee.queueModuleRegistration=="function")try{if(ee.queueModuleRegistration(e,t,r,H))return!0}catch{}if(Z&&typeof Z.queueModuleRegistration=="function")try{if(Z.queueModuleRegistration(e,t,r))return!0}catch{}if(X&&typeof X.queueModuleRegistration=="function")return X.queueModuleRegistration(e,t,r,H);if(!H||typeof H!="object")return!1;const n=Object.freeze({name:e,api:t,options:Object.freeze(Sb(r))});let o=H[dn];if(!Array.isArray(o))try{Object.defineProperty(H,dn,{configurable:!0,enumerable:!1,writable:!0,value:[]}),o=H[dn]}catch{try{Array.isArray(H[dn])||(H[dn]=[]),o=H[dn]}catch{return!1}}try{o.push(n)}catch{o[o.length]=n}return!0}function Ns(e,t,r,n){if(In&&typeof In.register=="function")try{return In.register(e,t,r),!0}catch(o){if(typeof n=="function")try{n(o)}catch{}}return wb(e,t,r),!1}const Eb=(function(){return ee&&typeof ee.registerOrQueueModule=="function"?function(r,n,o,i){try{if(ee.registerOrQueueModule(r,n,o,i,H,In))return!0}catch{}return Ns(r,n,o,i)}:Z&&typeof Z.registerOrQueueModule=="function"?function(r,n,o,i){try{if(Z.registerOrQueueModule(r,n,o,i,H,In))return!0}catch{}return Ns(r,n,o,i)}:X&&typeof X.registerOrQueueModule=="function"?function(r,n,o,i){return X.registerOrQueueModule(r,n,o,i,H,In)}:Ns})();function Ab(e){if(!e||typeof process>"u"||!process)return!1;if(e===process)return!0;if(typeof e=="object"){try{if(e.constructor&&e.constructor.name==="process")return!0}catch{}if(typeof e.pid=="number"&&typeof e.nextTick=="function"&&typeof e.emit=="function"&&typeof e.binding=="function")return!0}if(typeof e=="function"){if(e===process.binding||e===process._linkedBinding||e===process.dlopen)return!0;try{const t=e.name||"";if(t&&(t==="binding"||t==="dlopen")){const r=Function.prototype.toString.call(e);if(r&&r.indexOf("[native code]")!==-1)return!0}}catch{}}return!1}function Ob(e){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function")return!1;if(Ab(e)||typeof process<"u"&&process&&process.release&&process.release.name==="node")return!0;try{if(typeof e.pipe=="function"&&typeof e.unpipe=="function")return!0;if(typeof e.on=="function"&&typeof e.emit=="function"){if(typeof e.write=="function"||typeof e.read=="function")return!0;const t=e.constructor&&e.constructor.name;if(t&&/Stream|Emitter|Port/i.test(t))return!0}if(typeof Symbol<"u"&&e[Symbol.toStringTag]){const t=e[Symbol.toStringTag];if(typeof t=="string"&&/Stream|Port/i.test(t))return!0}}catch{}return!1}function Cb(e){if(e&&typeof e.has=="function"&&typeof e.add=="function")return e;if(Array.isArray(e))return{has(r){return e.indexOf(r)!==-1},add(r){e.indexOf(r)===-1&&e.push(r)}};if(typeof WeakSet=="function")try{return new WeakSet}catch{}const t=[];return{has(r){return t.indexOf(r)!==-1},add(r){t.indexOf(r)===-1&&t.push(r)}}}function ga(e,t){if(!e||typeof e=="function"||typeof e!="object"&&typeof e!="function"||Ob(e))return e;if(typeof process<"u"&&process&&Sl&&Sl.JEST_WORKER_ID){try{typeof Object.freeze=="function"&&Object.freeze(e)}catch{}return e}const r=Cb(t);if(r.has(e))return e;r.add(e);const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o+=1){const i=n[o];let s;try{s=e[i]}catch{s=void 0}!s||typeof s=="function"||typeof s!="object"&&typeof s!="function"||ga(s,r)}try{return Object.freeze(e)}catch{return e}}const bc=(function(){return ee&&typeof ee.freezeDeep=="function"?ee.freezeDeep:Z&&typeof Z.freezeDeep=="function"?function(r,n){try{return Z.freezeDeep(r,n)}catch{return ga(r,n)}}:X&&typeof X.freezeDeep=="function"?X.freezeDeep:ga})();function El(e,t){if(!(typeof console>"u"||typeof console.warn!="function"))try{typeof t>"u"?console.warn(e):console.warn(e,t)}catch{}}const Pb=(function(){return ee&&typeof ee.safeWarn=="function"?ee.safeWarn:Z&&typeof Z.safeWarn=="function"?function(r,n){try{Z.safeWarn(r,n)}catch{El(r,n)}}:X&&typeof X.safeWarn=="function"?X.safeWarn:El})();function Gs(e,t){if(!H||typeof H!="object")return!1;try{return Object.defineProperty(H,e,{configurable:!0,enumerable:!1,value:t,writable:!1}),!0}catch{try{return H[e]=t,!0}catch{return!1}}}const _b=(function(){return ee&&typeof ee.exposeGlobal=="function"?function(r,n,o){try{return ee.exposeGlobal(r,n,o)}catch{return Gs(r,n)}}:Z&&typeof Z.exposeGlobal=="function"?function(r,n,o){try{return Z.exposeGlobal(r,n,o)}catch{return Gs(r,n)}}:X&&typeof X.exposeGlobal=="function"?function(r,n,o){return X.exposeGlobal(r,n,H,o)}:Gs})(),ma=[];function qo(e,t){!e||typeof e!="object"||ma.push({ref:e,name:t||null})}qo(H,"global");Qt&&typeof Qt=="object"&&qo(Qt,"storage");H.cineAppSession&&qo(H.cineAppSession,"session");H.cineAppSetups&&qo(H.cineAppSetups,"setups");const ha=Object.create(null),En=[];function kb(e){if(!e)return null;if(e.name)return e.name;const t=e.ref;return!t||typeof t!="object"?null:t===H?"global":typeof t.constructor=="function"&&t.constructor.name?t.constructor.name:null}function Lp(e,t){const r=String(e);let n=ha[r];return n?t&&n.implementationName!==t&&(n.implementationName=t):(n={name:r,implementationName:t||r,available:!1,providerIndex:-1,providerName:null,lastChecked:null,implementation:null},ha[r]=n,En.push(r)),n}function Sc(e,t={}){const r=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,n=Lp(e),o=n.implementationName||String(e);if(!r&&n.implementation&&typeof n.implementation=="function")return n;let i=null;for(let s=0;s<ma.length;s+=1){const a=ma[s],c=a&&a.ref;if(!c||typeof c!="object")continue;const l=c[o];if(typeof l=="function"){i={implementation:l,providerIndex:s,providerName:kb(a)};break}}return n.available=!!i,n.providerIndex=i?i.providerIndex:-1,n.providerName=i?i.providerName:null,n.lastChecked=Date.now(),n.implementation=i?i.implementation:null,n}function vb(e){const t=Sc(e,{refresh:!0});if(!t||typeof t.implementation!="function"){const r=new Error(`cinePersistence could not resolve function "${e}".`);throw r.code="CINE_PERSISTENCE_BINDING_MISSING",r.binding=e,r.detail={name:e,available:t?t.available:!1,providerName:t?t.providerName:null},r}return t.implementation}function Rp(e){return e?Object.freeze({name:e.name,available:!!e.available,providerIndex:typeof e.providerIndex=="number"?e.providerIndex:-1,providerName:e.providerName||null,lastChecked:e.lastChecked||null,implementation:e.implementationName||e.name}):null}function v(e,t){const r=t||e;return Lp(r,e),function(){return vb(r).apply(this,arguments)}}function jb(e,t={}){const r=String(e),n=t&&Object.prototype.hasOwnProperty.call(t,"refresh")?t.refresh:!0,o=Sc(r,{refresh:n});return Rp(o)}function Ib(e={}){if(e&&Object.prototype.hasOwnProperty.call(e,"refresh")?e.refresh:!0)for(let n=0;n<En.length;n+=1)Sc(En[n],{refresh:!0});const r={};for(let n=0;n<En.length;n+=1){const o=En[n];r[o]=Rp(ha[o])}return bc(r)}function Lb(){return En.slice()}const Un={bindings:{saveSession:v("saveCurrentSession","saveSession"),autoSaveSetup:v("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:v("saveCurrentGearList","saveGearList"),restoreSessionState:v("restoreSessionState"),collectFullBackupData:v("collectFullBackupData"),createSettingsBackup:v("createSettingsBackup"),captureStorageSnapshot:v("captureStorageSnapshot"),sanitizeBackupPayload:v("sanitizeBackupPayload"),autoBackup:v("autoBackup"),formatFullBackupFilename:v("formatFullBackupFilename"),downloadPayload:v("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:v("recordFullBackupHistoryEntry"),encodeSharedSetup:v("encodeSharedSetup"),decodeSharedSetup:v("decodeSharedSetup"),applySharedSetup:v("applySharedSetup"),applySharedSetupFromUrl:v("applySharedSetupFromUrl"),downloadProject:v("downloadSharedProject","downloadProject"),saveProject:v("saveProject"),proceed:v("handleRestoreRehearsalProceed","proceed"),abort:v("handleRestoreRehearsalAbort","abort")},storage:{loadDeviceData:v("loadDeviceData"),saveDeviceData:v("saveDeviceData"),loadSetups:v("loadSetups"),saveSetups:v("saveSetups"),saveSetup:v("saveSetup"),loadSetup:v("loadSetup"),deleteSetup:v("deleteSetup"),renameSetup:v("renameSetup"),loadSessionState:v("loadSessionState"),saveSessionState:v("saveSessionState"),loadFeedback:v("loadFeedback"),saveFeedback:v("saveFeedback"),saveProject:v("saveProject"),loadProject:v("loadProject"),deleteProject:v("deleteProject"),loadFavorites:v("loadFavorites"),saveFavorites:v("saveFavorites"),exportAllData:v("exportAllData"),importAllData:v("importAllData"),clearAllData:v("clearAllData"),loadAutoGearRules:v("loadAutoGearRules"),saveAutoGearRules:v("saveAutoGearRules"),loadAutoGearBackups:v("loadAutoGearBackups"),saveAutoGearBackups:v("saveAutoGearBackups"),loadAutoGearSeedFlag:v("loadAutoGearSeedFlag"),saveAutoGearSeedFlag:v("saveAutoGearSeedFlag"),loadAutoGearBackupRetention:v("loadAutoGearBackupRetention"),saveAutoGearBackupRetention:v("saveAutoGearBackupRetention"),getAutoGearBackupRetentionDefault:v("getAutoGearBackupRetentionDefault"),loadAutoGearPresets:v("loadAutoGearPresets"),saveAutoGearPresets:v("saveAutoGearPresets"),loadAutoGearActivePresetId:v("loadAutoGearActivePresetId"),saveAutoGearActivePresetId:v("saveAutoGearActivePresetId"),loadAutoGearAutoPresetId:v("loadAutoGearAutoPresetId"),saveAutoGearAutoPresetId:v("saveAutoGearAutoPresetId"),loadAutoGearMonitorDefaults:v("loadAutoGearMonitorDefaults"),saveAutoGearMonitorDefaults:v("saveAutoGearMonitorDefaults"),loadAutoGearBackupVisibility:v("loadAutoGearBackupVisibility"),saveAutoGearBackupVisibility:v("saveAutoGearBackupVisibility"),loadFullBackupHistory:v("loadFullBackupHistory"),saveFullBackupHistory:v("saveFullBackupHistory"),recordFullBackupHistoryEntry:v("recordFullBackupHistoryEntry"),requestPersistentStorage:v("requestPersistentStorage"),clearUiCacheStorageEntries:v("clearUiCacheStorageEntries"),ensureCriticalStorageBackups:v("ensureCriticalStorageBackups"),getLastCriticalStorageGuardResult:v("getLastCriticalStorageGuardResult"),saveSession:v("saveCurrentSession","saveSession"),autoSaveSetup:v("autoSaveCurrentSetup","autoSaveSetup"),proceed:v("handleRestoreRehearsalProceed","proceed"),abort:v("handleRestoreRehearsalAbort","abort")},autosave:{saveSession:v("saveCurrentSession","saveSession"),autoSaveSetup:v("autoSaveCurrentSetup","autoSaveSetup"),saveGearList:v("saveCurrentGearList","saveGearList"),restoreSessionState:v("restoreSessionState")},backups:{collectFullBackupData:v("collectFullBackupData"),createSettingsBackup:v("createSettingsBackup"),captureStorageSnapshot:v("captureStorageSnapshot"),sanitizeBackupPayload:v("sanitizeBackupPayload"),autoBackup:v("autoBackup"),formatFullBackupFilename:v("formatFullBackupFilename"),downloadPayload:v("downloadBackupPayload","downloadPayload"),recordFullBackupHistoryEntry:v("recordFullBackupHistoryEntry")},restore:{proceed:v("handleRestoreRehearsalProceed","proceed"),abort:v("handleRestoreRehearsalAbort","abort")},share:{downloadProject:v("downloadSharedProject","downloadProject"),encodeSharedSetup:v("encodeSharedSetup"),decodeSharedSetup:v("decodeSharedSetup"),applySharedSetup:v("applySharedSetup"),applySharedSetupFromUrl:v("applySharedSetupFromUrl")},__internal:bc({listBindings:Lb,inspectBinding(e,t){return jb(e,t)||null},inspectAllBindings:Ib})};bc(Un);qo(Un.bindings,"bindings");hb("cinePersistence",Un);Eb("cinePersistence",Un,{category:"persistence",description:"Data integrity facade for storage, autosave, backups, restore, and share flows.",replace:!0,connections:["cineModuleGlobals","cineModuleEnvironment","cineEnvironmentBridge","cineModuleContext"]},e=>{Pb("Unable to register cinePersistence module.",e)});if(H&&typeof H=="object"){let e=null;try{e=H.cinePersistence||null}catch{e=null}e!==Un&&!_b("cinePersistence",Un,{configurable:!0,enumerable:!1,writable:!1})&&typeof console<"u"&&typeof console.warn=="function"&&console.warn("Unable to expose cinePersistence globally.")}function Rb(){return Object.freeze({ESSENTIAL:"essential",FILM:"film",GADGET:"gadget",UICONS:"uicons",TEXT:"text"})}function yn(e){if(!Number.isFinite(e))return"0";const t=Math.round(e*100)/100;return Number.isInteger(t)?String(t):t.toFixed(2).replace(/0+$/,"").replace(/\.$/,"")}function Vb(e,t,r,n=24){if(typeof e!="string")return{markup:"",x:"0",y:"0"};const o=e.trim();if(!o)return{markup:"",x:"0",y:"0"};const i=n/2,s=yn(t),a=yn(r),c=yn(n),l=yn(n);return{markup:o.replace(/<svg\b([^>]*)>/i,(u,y="")=>{let p=y.replace(/\s+x\s*=\s*"[^"]*"/gi,"").replace(/\s+y\s*=\s*"[^"]*"/gi,"").trim();const d=[],m=/(?:^|\s)width\s*=/i.test(p),g=/(?:^|\s)height\s*=/i.test(p);return m||d.push(`width="${c}"`),g||d.push(`height="${l}"`),d.push(`x="-${yn(i)}"`),d.push(`y="-${yn(i)}"`),p=[p].concat(d).filter(Boolean).join(" ").trim(),p?`<svg ${p}>`:"<svg>"}),x:s,y:a}}function si(e,t){const r=parseInt(e,t);if(!Number.isFinite(r)||r<0)return null;try{if(typeof String.fromCodePoint=="function")return String.fromCodePoint(r)}catch{}return r<=65535?String.fromCharCode(r):null}function Al(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.match(/^(?:\\)+u([0-9A-Fa-f]{4})$/);if(r){const s=si(r[1],16);if(s)return s}const n=t.match(/^(?:\\)+u\{([0-9A-Fa-f]+)\}$/);if(n){const s=si(n[1],16);if(s)return s}const o=t.match(/^&#x([0-9A-Fa-f]+);$/i);if(o){const s=si(o[1],16);if(s)return s}const i=t.match(/^&#(\d+);$/);if(i){const s=si(i[1],10);if(s)return s}return t}function Tb(e){const t=Rb();new Set(Object.values(t).filter(Boolean));const r=t.UICONS;if(!e)return{char:"",font:r,className:""};if(e.markup){const n=Number.isFinite(e.size)?e.size:void 0;return{markup:e.markup,className:e.className||"",font:r,size:n}}if(typeof e=="string")return{char:Al(e),font:r,className:""};if(typeof e=="object"){const n=typeof e.char=="string"?Al(e.char):"",o=e.font&&typeof e.font=="string"?e.font:r,i=typeof e.className=="string"?e.className:"",s=Number.isFinite(e.size)?e.size:void 0;return e.markup?{markup:e.markup,className:i,font:o,size:s}:{char:n,font:o,className:i,size:s}}return{char:"",font:r,className:""}}function Hb(e,t){if(!e)return;const r=Tb(t);if(r&&r.markup){let o=r.markup;o.includes("aria-hidden")||(o=o.replace("<svg",'<svg aria-hidden="true"')),e.innerHTML=o,o.includes("aria-hidden")||e.setAttribute("aria-hidden","true"),r.className&&e.classList&&r.className.split(/\s+/).filter(Boolean).forEach(i=>e.classList.add(i)),e.removeAttribute("data-icon-font");return}const n=r&&r.char||"";e.textContent=n,n?e.setAttribute("data-icon-font",r.font||"uicons"):e.removeAttribute("data-icon-font")}const Mb="__backup",Nb="__legacyMigrationBackup",$r="cameraPowerPlanner_devices",Mt=(function(){const t={},r=(o,i)=>{if(!o||typeof t[i]=="function")return;const s=o[i];typeof s=="function"&&(t[i]=s)};Qt&&(r(Qt,"getSafeLocalStorage"),r(Qt,"saveDeviceData"),r(Qt,"clearUiCacheStorageEntries"),r(Qt,"getDeviceStorageKeyVariants"),r(Qt,"getStorageKeyVariants"));const n=[];typeof globalThis<"u"&&n.push(globalThis),typeof window<"u"&&n.push(window),typeof self<"u"&&n.push(self);for(const o of n)if(o&&(r(o,"getSafeLocalStorage"),r(o,"saveDeviceData"),r(o,"clearUiCacheStorageEntries"),t.getSafeLocalStorage&&t.saveDeviceData&&t.clearUiCacheStorageEntries))break;return t})();function Gb(e,t){if(typeof e!="string"||!e)return!1;const r=t||{},n=new Set;n.add(e),n.add(`${e}${Mb}`),n.add(`${e}${Nb}`);let o=!1;const i=r.logPrefix||"Failed to clear device storage variant",s=new Set;if(Mt.getSafeLocalStorage)try{const c=Mt.getSafeLocalStorage();c&&s.add(c)}catch(c){console.warn(`${i}: safe storage lookup failed`,c)}typeof localStorage<"u"&&s.add(localStorage),typeof window<"u"&&window.localStorage&&s.add(window.localStorage);const a=Array.from(n);if(s.forEach(c=>{!c||typeof c.removeItem!="function"||a.forEach(l=>{try{c.removeItem(l),o=!0}catch(f){console.warn(`${i} "${l}"`,f)}})}),Mt.clearUiCacheStorageEntries)try{Mt.clearUiCacheStorageEntries(a)}catch(c){console.warn("Failed to clear UI cache entries for device storage reset",c)}return o}function zb(){if(Mt.getDeviceStorageKeyVariants)return Array.from(Mt.getDeviceStorageKeyVariants());if(Mt.getStorageKeyVariants)return Array.from(Mt.getStorageKeyVariants($r));const e=new Set;return e.add($r),$r.startsWith("cameraPowerPlanner_")?e.add(`cinePowerPlanner_${$r.slice(19)}`):$r.startsWith("cinePowerPlanner_")&&e.add(`cameraPowerPlanner_${$r.slice(17)}`),Array.from(e)}function qb(){const e=zb();if(!e)return!1;let t=!1;return e.forEach(r=>{if(r===$r&&Mt.saveDeviceData)try{Mt.saveDeviceData(null),t=!0}catch(n){console.warn("Failed to clear primary device storage via saveDeviceData",n)}Gb(r,{logPrefix:"Failed to clear device storage variant"})&&(t=!0)}),t}const Bb=Object.freeze(["power","video","fiz","cables"]);function Wb(e){const t=[],r=new Set,n=o=>{if(typeof o!="string")return;const i=o.trim();!i||r.has(i)||(r.add(i),t.push(i))};try{const o=typeof deviceSchema<"u"?deviceSchema:null;o?.accessories?.cables&&Object.keys(o.accessories.cables).forEach(n)}catch{}Bb.forEach(n);try{const o=typeof devices<"u"?devices:null;o?.accessories?.cables&&Object.keys(o.accessories.cables).forEach(n)}catch{}return Array.isArray(e)?e.forEach(n):e&&n(e),t}const zs=Object.freeze({autoGearRules:"cameraPowerPlanner_autoGearRules",autoGearBackups:"cameraPowerPlanner_autoGearBackups",autoGearPresets:"cameraPowerPlanner_autoGearPresets",autoGearMonitorDefaults:"cameraPowerPlanner_autoGearMonitorDefaults",autoGearActivePresetId:"cameraPowerPlanner_autoGearActivePreset",autoGearAutoPresetId:"cameraPowerPlanner_autoGearAutoPreset",autoGearBackupRetention:"cameraPowerPlanner_autoGearBackupRetention",autoGearShowBackups:"cameraPowerPlanner_autoGearShowBackups"}),wr=Object.freeze({autoGearRules:Object.freeze([]),autoGearBackups:Object.freeze([]),autoGearPresets:Object.freeze([]),autoGearMonitorDefaults:Object.freeze({}),autoGearActivePresetId:"",autoGearAutoPresetId:"",autoGearBackupRetention:null,autoGearShowBackups:!1}),St=Kn();function Oi(e){return Array.isArray(e)?e.slice():e&&typeof e=="object"?{...e}:e}function Er(e){return{hydrated:!1,value:Oi(e)}}function Ol(){return{autoGearRules:Er(wr.autoGearRules),autoGearBackups:Er(wr.autoGearBackups),autoGearPresets:Er(wr.autoGearPresets),autoGearMonitorDefaults:Er(wr.autoGearMonitorDefaults),autoGearActivePresetId:Er(wr.autoGearActivePresetId),autoGearAutoPresetId:Er(wr.autoGearAutoPresetId),autoGearBackupRetention:Er(wr.autoGearBackupRetention),autoGearShowBackups:Er(wr.autoGearShowBackups)}}function xb(){const e=[];St&&e.push(St),typeof globalThis<"u"&&globalThis!==St&&e.push(globalThis),typeof window<"u"&&window!==St&&e.push(window),typeof self<"u"&&self!==St&&e.push(self),typeof global<"u"&&global!==St&&e.push(global);for(let t=0;t<e.length;t+=1){const r=e[t];if(!(!r||typeof r!="object")){if(r.cinePersistence)return r;if(r.cineModules&&typeof r.cineModules.get=="function"){const n=r.cineModules.get("cinePersistence");if(n)return{cinePersistence:n}}}}return null}class Fb{constructor(){this.cache=Ol(),this.hydrating=null}hydrateCache(t={}){const r=t&&t.force===!0;return this.hydrating&&!r?this.hydrating:(this.hydrating=(async()=>{const o=Object.keys(zs).map(async i=>{const s=zs[i];try{const a=await C.getItem(s);this.setCacheValue(i,a,{hydrate:!0})}catch(a){console.warn("[AutoGearService] Failed to hydrate",s,a),this.setCacheValue(i,void 0,{hydrate:!0,skipUpdate:!0})}});return await Promise.all(o),this.getCacheSnapshot()})(),this.hydrating)}getCacheSnapshot(){const t={};return Object.keys(this.cache).forEach(r=>{t[r]=Oi(this.cache[r].value)}),t}setCacheValue(t,r,n={}){const o=this.cache[t];if(!o)return;const i=n&&n.hydrate===!0;!(n&&n.skipUpdate===!0)&&typeof r<"u"&&r!==null&&(o.value=Oi(r)),i&&(o.hydrated=!0)}getCacheValue(t){const r=this.cache[t];if(r)return Oi(r.value)}async persistValue(t,r,n){this.setCacheValue(t,r);const o=xb(),i=o?o.cinePersistence:null;if(i&&i.storage&&typeof i.storage[n]=="function")return i.storage[n](r);const s=zs[t];return C.setItem(s,r)}readAutoGearRules(){return this.getCacheValue("autoGearRules")||[]}readAutoGearBackups(){return this.getCacheValue("autoGearBackups")||[]}readAutoGearPresets(){return this.getCacheValue("autoGearPresets")||[]}readAutoGearMonitorDefaults(){return this.getCacheValue("autoGearMonitorDefaults")||{}}readActivePresetId(){const t=this.getCacheValue("autoGearActivePresetId");return typeof t=="string"?t:""}readAutoPresetId(){const t=this.getCacheValue("autoGearAutoPresetId");return typeof t=="string"?t:""}readBackupRetention(){return this.getCacheValue("autoGearBackupRetention")}readBackupVisibility(){return!!this.getCacheValue("autoGearShowBackups")}persistAutoGearRules(t){return this.persistValue("autoGearRules",Array.isArray(t)?t:[],"saveAutoGearRules")}persistAutoGearBackups(t){return this.persistValue("autoGearBackups",Array.isArray(t)?t:[],"saveAutoGearBackups")}persistAutoGearPresets(t){return this.persistValue("autoGearPresets",Array.isArray(t)?t:[],"saveAutoGearPresets")}persistAutoGearMonitorDefaults(t){const r=t&&typeof t=="object"?t:{};return this.persistValue("autoGearMonitorDefaults",r,"saveAutoGearMonitorDefaults")}persistActivePresetId(t){const r=typeof t=="string"?t:"";return this.persistValue("autoGearActivePresetId",r,"saveAutoGearActivePresetId")}persistAutoPresetId(t){const r=typeof t=="string"?t:"";return this.persistValue("autoGearAutoPresetId",r,"saveAutoGearAutoPresetId")}persistBackupRetention(t){return this.persistValue("autoGearBackupRetention",t,"saveAutoGearBackupRetention")}persistBackupVisibility(t){return this.persistValue("autoGearShowBackups",!!t,"saveAutoGearBackupVisibility")}__internalResetCache(){this.cache=Ol(),this.hydrating=null}}const ts=new Fb;ts.hydrateCache().catch(e=>{console.warn("[AutoGearService] Initial hydration failed",e)});if(St&&typeof St=="object"&&!St.cineAutoGearPersistence)try{Object.defineProperty(St,"cineAutoGearPersistence",{configurable:!0,enumerable:!1,writable:!1,value:ts})}catch{St.cineAutoGearPersistence=ts}Se.register("cineAutoGearPersistence",ts,{category:"persistence",description:"Twin-store persistence cache for Auto-Gear state.",connections:["cinePersistence","cineModuleGlobals"],freeze:!1,replace:!0});class Db{async getProject(t){if(!t)return null;try{const r=await C.loadProject(t);return r?r.data:null}catch(r){return console.error("[ProjectService] Failed to load project:",t,r),null}}async getProjectNames(){try{return await C.getProjectKeys()}catch(t){return console.error("[ProjectService] Failed to get project names:",t),[]}}async getProjectMetadata(t){if(!t)return{};try{const r=await C.getProjectMeta(t),n=await C.loadProject(t);if(n&&n.data)return n.data}catch(r){console.error("[ProjectService] Failed to get project metadata:",t,r)}return{}}async saveProject(t,r){if(!t||!r)return!1;try{return typeof r!="object"?(console.warn("[ProjectService] Invalid project data"),!1):(r.lastModified||(r.lastModified=new Date().toISOString()),(await C.saveProject(t,r)).success)}catch(n){return console.error("[ProjectService] Failed to save project:",t,n),!1}}async createProject(t){if(!t)return!1;const r={created:new Date().toISOString(),lastModified:new Date().toISOString(),gearList:"",projectInfo:null,gearListAndProjectRequirementsGenerated:!1,color:"blue",icon:"📽️"};return this.saveProject(t,r)}async deleteProject(t){if(!t)return!1;try{return await C.removeProject(t),!0}catch(r){return console.error("[ProjectService] Failed to delete project:",t,r),!1}}async duplicateProject(t){try{if(typeof t!="string"||t.length===0)return{success:!1};const r=t.trim(),n=await this.getProject(r);if(!n)return{success:!1};const o=await this.getProjectNames();let i=`${r} (Copy)`,s=2;for(;o.includes(i);)i=`${r} (Copy ${s})`,s++;const a=JSON.parse(JSON.stringify(n));return a.created=new Date().toISOString(),a.lastModified=new Date().toISOString(),{success:await this.saveProject(i,a),newId:i}}catch(r){return console.error("[ProjectService] Failed to duplicate project:",r),{success:!1}}}}const Yb=new Db;export{Il as I,Ll as _,Kn as a,Sa as b,vl as c,Ys as d,Pl as e,Vl as f,Dp as g,Aa as h,F as i,Tb as j,yn as k,Vb as l,Hb as m,Rb as n,Wb as o,Yb as p,qb as q,Se as r,C as s,$b as t,lg as u};
//# sourceMappingURL=core-modules-BzDo6MtP.js.map
