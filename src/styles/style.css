@import url('fonts.css');
/* General styles */
:root {
  color-scheme: light dark;
  --brand-accent-color: #001589;
  --accent-color: var(--brand-accent-color);
  --logo-background-color: var(--accent-color);
  --logo-accent-color: var(--brand-accent-color);
  --logo-center-color: #ffffff;
  --link-color: var(--accent-color);
  --background-color: #f9f9f9;
  --surface-color: #ffffff;
  --text-color: #000000;
  --inverse-text-color: #ffffff;
  --control-bg: #f0f0f0;
  --control-text: #333333;
  --control-border: #dddddd;
  --control-hover-bg: #e0e0e0;
  --control-active-bg: #d0d0d0;
  --control-disabled-bg: #dddddd;
  --panel-bg: #f9f9f9;
  --panel-border: #ddd;
  --panel-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  --panel-shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.12);
  --border-radius: 5px;
  --spacing-2xs: 2px;
  --spacing-xs: 4px;
  --spacing-sm: 5px;
  --spacing-md: 8px;
  --spacing-lg: 10px;
  --spacing-xl: 15px;
  --spacing-xxl: 20px;
  --page-padding: var(--spacing-xxl);
  --main-top-padding-multiplier: 1.5;
  --gap-size: var(--spacing-lg);
  --button-size: 27px;
  --select-height: var(--button-size);
  --button-icon-size: var(--icon-size-md);
  --button-line-height: 1.25;
  --button-padding-block: 0;
  --button-padding-inline: var(--spacing-md);
  --button-margin-block-start: var(--spacing-lg);
  --button-margin-inline: var(--spacing-sm);
  --button-margin-block-end: var(--spacing-sm);
  --button-link-padding-block: var(--button-padding-block);
  --button-link-padding-inline: 12px;
  --icon-gap: 0.3em;
  --button-icon-gap: 0.375em;
  --install-banner-font-scale: var(--font-scale-xs);
  --install-banner-line-height: 1.3;
  --install-banner-padding-block: var(--spacing-2xs);
  --install-banner-padding-inline: var(--spacing-lg);
  --install-banner-gap: var(--spacing-xs);
  --install-banner-font-size: calc(var(--font-size-base) * var(--install-banner-font-scale));
  --install-banner-offset: calc(
    max(
        calc(var(--install-banner-line-height) * var(--install-banner-font-size)),
        var(--icon-size-md)
      ) +
    (var(--install-banner-padding-block) * 2) +
    env(safe-area-inset-top, 0px)
  );
  --form-control-font-size: var(--font-size-relative-base);
  --form-label-width: 150px;
  --form-label-min-width: 120px;
  --form-action-width: 110px;
  --font-family: 'Ubuntu', 'UiconsThinStraightV2', sans-serif;
  --cluster-gap: var(--gap-size);
  --section-padding: var(--spacing-xl);
  --section-margin-block-start: 1.5em;
  --paragraph-spacing: 1em;
  --tagline-padding-inline: var(--section-padding);
  --form-row-margin-block: var(--spacing-sm);
  /* Typography */
  --font-size-base: 1rem;
  --font-size-relative-base: 1em;
  --font-scale-compact: 0.8;
  --font-scale-xxs: 0.75;
  --font-scale-xs: 0.85;
  --font-scale-sm: 0.9;
  --font-scale-md: 0.95;
  --font-scale-lg: 1.1;
  --font-scale-xl: 1.2;
  --font-scale-xxl: 1.4;
  --font-scale-xxxl: 1.5;
  --font-scale-display: 1.8;
  --font-scale-icon-lg: 1.5;
  --font-scale-icon-sm: 0.625;
  --font-scale-diagram-label: 0.7;
  --font-scale-diagram-text: 0.8;
  --font-size-root: clamp(14px, 1vw + 10px, 16px);
  --icon-size-xs: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  --icon-size-sm: calc(var(--font-size-relative-base) * var(--font-scale-sm));
  --icon-size-md: calc(var(--font-size-relative-base) * var(--font-scale-lg));
  --icon-size-lg: calc(var(--font-size-relative-base) * var(--font-scale-xl));
  --icon-size-xl: calc(var(--font-size-relative-base) * var(--font-scale-xxl));
  --font-weight-light: 300;
  --font-weight-regular: var(--font-weight-light);
  --font-weight-medium: var(--font-weight-bold);
  --font-weight-bold: 500;
  --font-weight-semibold: var(--font-weight-bold);
  --font-size-diagram-icon: calc(var(--font-size-base) * var(--font-scale-icon-lg));
  --font-size-diagram-label: calc(var(--font-size-base) * var(--font-scale-diagram-label));
  --font-size-diagram-text: calc(var(--font-size-base) * var(--font-scale-diagram-text));
  --diagram-node-fill: #f0f0f0;
  --power-color: #d33;
  --video-color: #369;
  --fiz-color: #090;
  --selected-row-bg: #e6f7ff;
  --favorite-inactive-color: var(--control-text);
  --link-color: var(--accent-color);
  --muted-text-color: #555555;
  --border-strong-color: #ccc;
  --divider-color: #eee;
  --diagram-gridline-color: var(--divider-color);
  --diagram-button-active-bg: #ddd;
  --warning-color: #ff9f1c;
  --warning-text-color: #000000;
  --danger-color: #f44336;
  --danger-overlay-color: rgba(244, 67, 54, 0.4);
  --success-color: #4caf50;
  --info-color: #2196f3;
  --neutral-color: #9e9e9e;
  --offline-indicator-bg: #2f3437;
  --offline-indicator-text: #f5f7fa;
  --offline-indicator-border: rgba(245, 247, 250, 0.2);
  --line-height-base: 1.6;
  --line-height-supporting: 1.5;
  --line-height-relaxed: 1.65;
  --status-error-bg: #ff8a80;
  --status-warning-bg: #ff6b6b;
  --status-success-bg: #dfd;
  --status-border-color: #ccc;
  --status-error-text-color: #000;
  --status-warning-text-color: #ffffff;
  --status-success-text-color: #000;
  --camera-color: #4caf50;
  --monitor-color: #2196f3;
  --video-segment-color: #ffc107;
  --motor-color: #9c27b0;
  --controller-color: #ff5722;
  --distance-color: #795548;
  --power-conn-bg: rgba(221, 51, 51, 0.15);
  --fiz-conn-bg: rgba(0, 153, 0, 0.15);
  --video-conn-bg: rgba(51, 102, 153, 0.15);
  --neutral-conn-bg: rgba(158, 158, 158, 0.15);
  --connector-label-neutral-color: #000000;
  --auto-gear-highlight-bg: rgba(255, 210, 64, 0.35);
  --auto-gear-highlight-border: rgba(255, 181, 0, 0.7);
  --auto-gear-highlight-text: var(--text-color);
}
@media (max-width: 600px) {
  :root {
    --page-padding: var(--spacing-sm);
  }
  main {
    max-width: none;
    margin: 0;
  }
  h2 {
    padding-bottom: 0.3em;
  }
}
html.pink-mode,
body.pink-mode {
  --accent-color: #ff69b4;
  --link-color: #ff69b4;
  --icon-color: var(--accent-color);
  --logo-accent-color: #f255a8;
  --logo-background-color: #f255a8;
  --logo-center-color: #ffffff;
}

html.reduce-motion,
body.reduce-motion {
  scroll-behavior: auto;
}

body.reduce-motion *,
body.reduce-motion *::before,
body.reduce-motion *::after {
  animation-duration: 0.001ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.001ms !important;
  transition-delay: 0ms !important;
}

body.relaxed-spacing {
  --line-height-base: 1.75;
  --line-height-supporting: 1.7;
  --gap-size: 14px;
  --form-label-width: 170px;
  --form-label-min-width: 140px;
  --button-size: 33px;
  --button-line-height: 1.45;
  --button-icon-gap: 0.5em;
  --form-row-margin-block: 8px;
  --button-link-padding-inline: 16px;
}

body.relaxed-spacing .settings-hint {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
}

body.relaxed-spacing input:not([type='checkbox']):not([type='radio']),
body.relaxed-spacing select,
body.relaxed-spacing textarea {
  padding: 0.65em 0.9em;
}

html {
  font-size: var(--font-size-root);
}

html,
body {
  background: var(--background-color);
  height: 100%;
  margin: 0;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Ensure predictable sizing */
*, *::before, *::after {
  box-sizing: border-box;
}

body {
  font-family: var(--font-family);
  font-weight: var(--font-weight-light);
  margin: 0;
  background-color: var(--background-color);
  color: var(--text-color);
  font-size: var(--font-size-relative-base);
  line-height: var(--line-height-base);
}

main {
  max-width: 1200px;
  margin: 0 auto;
  padding: calc(var(--page-padding) * var(--main-top-padding-multiplier))
    var(--page-padding)
    var(--page-padding);
  position: relative;
}

section,
fieldset,
input,
select,
textarea {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

@supports (padding: env(safe-area-inset-top)) {
  main {
    padding:
      calc(env(safe-area-inset-top) + var(--page-padding) * var(--main-top-padding-multiplier))
      calc(env(safe-area-inset-right) + var(--page-padding))
      calc(env(safe-area-inset-bottom) + var(--page-padding))
      calc(env(safe-area-inset-left) + var(--page-padding));
  }
}

.skip-link {
  position: absolute;
  left: -999px;
  top: -999px;
  background: var(--accent-color);
  color: var(--inverse-text-color);
  padding: 8px 12px;
  z-index: 100;
}
.skip-link:focus {
  left: 10px;
  top: 10px;
}

#offlineIndicator {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: var(--offline-indicator-bg);
  color: var(--offline-indicator-text);
  text-align: center;
  padding: 10px 16px;
  z-index: 1000;
  display: none;
  border-bottom: 1px solid var(--offline-indicator-border);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.18);
  letter-spacing: 0.03em;
  text-transform: uppercase;
  font-size: calc(var(--font-size-base) * var(--font-scale-xs));
  font-weight: var(--font-weight-medium);
}

#installPromptBanner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: var(--accent-color);
  color: var(--install-banner-text-color, var(--inverse-text-color));
  padding:
    calc(var(--install-banner-padding-block) + env(safe-area-inset-top, 0px))
    var(--install-banner-padding-inline)
    var(--install-banner-padding-block);
  z-index: 999;
  border-radius: 0;
  line-height: var(--install-banner-line-height);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.14);
  display: none;
  flex-wrap: nowrap;
  align-items: center;
  justify-content: center;
  gap: var(--install-banner-gap);
  text-align: center;
  font-size: var(--install-banner-font-size);
}

#installPromptBanner:not([hidden]) {
  display: flex;
}

@media (max-width: 480px) {
  #installPromptBanner {
    flex-wrap: wrap;
  }
  #installPromptBanner .install-banner-dismiss {
    align-self: flex-start;
  }
}

#installPromptBanner:not([hidden]) ~ #topBar {
  margin-top: var(--install-banner-offset);
  --top-bar-offset: var(--install-banner-offset);
}

#installPromptBanner:not([hidden]) ~ #sideMenu {
  top: var(--install-banner-offset);
  height: calc(100% - var(--install-banner-offset));
}

#installPromptBanner:not([hidden]) ~ #menuOverlay {
  top: var(--install-banner-offset);
  height: calc(100% - var(--install-banner-offset));
}

#installPromptBanner .install-banner-action,
#installPromptBanner .install-banner-dismiss {
  appearance: none;
  border: none;
  background: none;
  border-radius: 0;
  color: inherit;
  font: inherit;
  font-weight: var(--font-weight-medium);
  padding: 0;
  cursor: pointer;
  transition: color 120ms ease, text-decoration-color 120ms ease, opacity 120ms ease;
  margin: 0;
  min-height: 0;
}

#installPromptBanner .install-banner-action {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--install-banner-gap);
  text-align: center;
  flex: 0 1 auto;
  padding: 0;
  width: auto;
  max-width: min(100%, 32rem);
  white-space: normal;
}

#installPromptBanner .install-banner-action .install-banner-icon {
  font-size: var(--icon-size-md);
  --icon-color: #ffffff;
  color: #ffffff;
  flex-shrink: 0;
  text-decoration: none;
}

#installPromptBannerText {
  display: inline-block;
}

#installPromptBanner .install-banner-action:focus-visible,
#installPromptBanner .install-banner-dismiss:focus-visible {
  outline: none;
  text-decoration: underline;
  text-decoration-thickness: 0.12em;
  text-underline-offset: 0.18em;
  text-decoration-color: color-mix(
    in srgb,
    var(--install-banner-text-color, currentColor) 85%,
    transparent
  );
}

#installPromptBanner .install-banner-action:hover,
#installPromptBanner .install-banner-action:focus-visible,
#installPromptBanner .install-banner-dismiss:hover,
#installPromptBanner .install-banner-dismiss:focus-visible {
  text-decoration: underline;
  text-decoration-thickness: 0.12em;
  text-underline-offset: 0.18em;
  text-decoration-color: color-mix(
    in srgb,
    var(--install-banner-text-color, currentColor) 70%,
    transparent
  );
}

#installPromptBanner .install-banner-dismiss {
  min-width: 0;
  white-space: nowrap;
  flex: 0 0 auto;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  opacity: 0.9;
}

#installPromptBanner .install-banner-dismiss:hover,
#installPromptBanner .install-banner-dismiss:focus-visible {
  opacity: 1;
}

#installPromptBanner:not([hidden]) ~ #installGuideDialog {
  align-items: flex-start;
  padding-top: calc(var(--install-banner-offset) + 20px);
}

#installPromptBanner .install-banner-dismiss .btn-icon {
  margin-inline-end: 0;
  --icon-color: #ffffff;
  color: #ffffff;
  text-decoration: none;
}

#installPromptBanner .install-banner-dismiss .btn-icon.icon-glyph {
  --icon-size: var(--icon-size-md);
}

.visually-hidden {
  position: absolute !important;
  height: 1px; width: 1px;
  overflow: hidden;
  clip: rect(1px, 1px, 1px, 1px);
  white-space: nowrap;
}

.hidden {
  /* Ensure hidden elements stay hidden even if other classes set display */
  display: none !important;
}

.status-message {
  margin-top: 0.75em;
}

.status-message:empty {
  display: none;
}

.status-message--info,
.status-message--success,
.status-message--warning,
.status-message--danger {
  padding: 0.5em 0.75em;
  border-radius: var(--border-radius);
  border: 1px solid var(--status-border-color);
  background-color: var(--panel-bg);
  display: block;
}

.status-message--info {
  color: var(--text-color);
}

.status-message--success {
  background-color: var(--status-success-bg);
  color: var(--status-success-text-color);
}

.status-message--warning {
  background-color: var(--status-warning-bg);
  color: var(--status-warning-text-color);
}

.status-message--danger {
  background-color: var(--status-error-bg);
  color: var(--status-error-text-color);
}

/* Improve keyboard accessibility by clearly showing focus outlines for links, inputs, and textareas */
button:focus,
a:focus,
input:focus,
select:focus,
textarea:focus {
  outline: none;
}
a:focus-visible,
input:focus-visible,
textarea:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

.button-group {
  margin-bottom: var(--spacing-lg);
}

.button-row {
  display: flex;
  gap: var(--cluster-gap);
}

.flex-1 {
  flex: 1;
}

#exportOutput {
  display: none;
  width: 100%;
  height: 100px;
  margin-top: var(--spacing-lg);
}
h1, h2, h3 {
  font-family: var(--font-family);
  font-weight: var(--font-weight-regular);
  color: var(--accent-color);
}
h1 {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-display));
  margin-bottom: 0.2em;
}
h2 {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxl));
  margin-top: 1.3em;
  border-bottom: 1px solid var(--accent-color);
}

section > h2 {
  font-weight: var(--font-weight-light);
}

body.pink-mode:not(.dark-mode) h1,
body.pink-mode:not(.dark-mode) h2,
body.pink-mode:not(.dark-mode) h3 {
  color: var(--accent-color);
}

body.pink-mode:not(.dark-mode) h2 {
  border-bottom: 1px solid var(--accent-color);
}
h3 {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-lg));
  margin-top: 1em;
}

/* Paragraph text */
p {
  line-height: var(--line-height-base);
  margin: 0 0 var(--paragraph-spacing);
}

p + p {
  margin-top: var(--paragraph-spacing);
}

#tagline {
  margin: 0 0 1em;
  padding: 0 var(--tagline-padding-inline);
}

a {
  color: var(--link-color);
  font-weight: var(--font-weight-regular);
  text-decoration: none;
}

b,
strong {
  font-weight: var(--font-weight-bold);
}

a:visited {
  color: var(--link-color);
}

a:hover,
a:focus {
  text-decoration: underline;
}

html.dark-mode a,
body.dark-mode a,
.dark-mode a {
  color: var(--inverse-text-color);
  text-decoration: underline;
  text-decoration-color: currentColor;
}

html.dark-mode a:visited,
body.dark-mode a:visited,
.dark-mode a:visited {
  color: var(--inverse-text-color);
}

footer {
  text-align: center;
  padding: 20px 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

footer a {
  margin: 0 0.5em;
}

body.dark-mode:not(.pink-mode) footer {
  color: var(--inverse-text-color);
}

body.dark-mode:not(.pink-mode) footer a {
  color: var(--inverse-text-color);
}

body.dark-mode:not(.pink-mode) footer a:visited {
  color: var(--inverse-text-color);
}

/* Static legal pages */
body.static-page {
  display: flex;
  flex-direction: column;
  min-height: 100%;
}

body.static-page main {
  flex: 1;
}

main.legal-content {
  max-width: 960px;
}

.legal-language-nav {
  margin: 0 0 1.5em;
}

.legal-language-nav ul {
  list-style: none;
  display: flex;
  flex-wrap: wrap;
  gap: 0.75em;
  padding: 0;
  margin: 0;
}

.legal-language-nav a[aria-current="page"] {
  font-weight: var(--font-weight-semibold);
}

.legal-content h1 {
  margin-bottom: 0.6em;
}

.legal-card {
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 20px;
  box-shadow: var(--panel-shadow);
}

.legal-card h2:first-of-type {
  margin-top: 0;
}

.legal-card h2 {
  border-bottom: 1px solid var(--accent-color);
  padding-bottom: 0.4em;
}

.static-nav {
  display: flex;
  align-items: center;
  gap: var(--cluster-gap);
}

.button-link,
.button-link:visited {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: var(--button-size);
  height: auto;
  padding: var(--button-link-padding-block) var(--button-link-padding-inline);
  border-radius: var(--border-radius);
  background-color: var(--control-bg);
  color: var(--control-text);
  font-size: var(--form-control-font-size);
  text-decoration: none;
  transition: background-color 0.2s, color 0.2s, transform 0.2s;
}

.button-link:hover {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
  transform: translateY(-2px);
}

.button-link:active {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
  filter: brightness(0.9);
  transform: translateY(0);
}

/* Form layout */
.form-row {
  display: flex;
  align-items: center;
  margin: var(--form-row-margin-block) 0;
  gap: var(--gap-size);
  flex-wrap: wrap; /* allow inputs to wrap on smaller screens */
}
.form-row label,
.form-row .form-row-label {
  flex: 0 0 var(--form-label-width);
  min-width: var(--form-label-min-width);
  font-weight: var(--font-weight-light);
}
#setup-config .form-row label,
#setup-config .form-row .form-row-label {
  line-height: 1.3;
}
.form-row select,
.form-row input,
.form-row textarea {
  flex: 1;
  min-width: 0; /* allow shrinking inside flex container */
}

.form-row textarea {
  resize: vertical;
}

.form-row .auto-gear-scenarios {
  flex: 0 1 320px;
  width: min(100%, 320px);
  max-width: 100%;
  overflow-y: auto;
  min-height: 12rem;
  height: clamp(14rem, 45vh, 20rem);
}

.form-row .auto-gear-video-distribution {
  flex: 0 1 320px;
  width: min(100%, 320px);
  max-width: 100%;
  overflow-y: visible;
  min-height: auto;
  height: auto;
}

#crewContainer {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--gap-size);
}

.person-row {
  display: flex;
  align-items: center;
  gap: var(--gap-size);
  flex-wrap: wrap;
}

.person-row select {
  flex: 0 0 160px;
  min-width: 140px;
}

.person-row input {
  flex: 1 1 180px;
  min-width: 160px;
}

.person-row button {
  flex: 0 0 auto;
  margin: 0;
  align-self: stretch;
}

#dynamicFields {
  margin-top: 10px;
}

.schema-attribute-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 15px 0;
}

.schema-form-row {
  align-items: flex-start;
}

.schema-control {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  width: 100%;
}

.schema-control-inline {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  flex-wrap: wrap;
  width: 100%;
}

.schema-control--checkbox .schema-control-inline {
  align-items: center;
}

.schema-input {
  flex: 1;
  width: 100%;
  padding: 6px 8px;
  border-radius: 4px;
  border: 1px solid var(--control-border);
  background: var(--control-bg);
  color: var(--control-text);
  font: inherit;
}

.schema-input:focus {
  outline: 2px solid var(--accent-color);
  outline-offset: 1px;
}

.schema-input--textarea {
  resize: vertical;
}

.schema-input--checkbox {
  width: auto;
  min-width: 16px;
  height: 16px;
  flex: 0 0 auto;
}

.schema-field-suffix {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
  color: var(--muted-text-color);
}

.schema-field-help {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  color: var(--muted-text-color);
  line-height: var(--line-height-supporting);
}

/* Keep controls aligned within Project Overview and Configure Devices */
#setup-manager .form-row,
#setup-config .form-row {
  align-items: stretch;
}

#setup-manager .form-row:not(.form-row-actions) > button:not(.clear-input-btn):not(.favorite-toggle),
#setup-config .form-row:not(.form-row-actions) > button:not(.clear-input-btn):not(.favorite-toggle) {
  align-self: stretch;
  flex: 0 0 var(--form-action-width);
  margin: 0;
}

.form-label-spacer {
  flex: 0 0 var(--form-label-width);
  min-width: var(--form-label-min-width);
}

#setup-manager .form-row.form-row-actions {
  flex-wrap: nowrap;
}

#setup-manager .form-row.form-row-actions .form-actions {
  display: flex;
  gap: var(--gap-size);
  flex: 1;
}

#setup-manager .form-row.form-row-actions .form-actions button,
#setup-manager .form-row.form-row-actions > button {
  flex: 1;
  margin: 0;
}

.share-import-group {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--gap-size);
  flex: 1 1 0;
  flex-wrap: wrap;
  min-width: 0;
}

.share-import-group label {
  flex: 0 1 auto;
  white-space: nowrap;
}

#setup-manager .form-row.form-row-actions .form-actions > .share-import-group:only-child,
#setup-manager .form-row.form-row-actions .form-actions > button.hidden + .share-import-group,
#setup-manager .form-row.form-row-actions .form-actions > button[hidden] + .share-import-group {
  flex: 1 1 100%;
  max-width: 100%;
}

#setup-manager .form-row.form-row-actions .form-actions > .share-import-group:only-child button,
#setup-manager .form-row.form-row-actions .form-actions > button.hidden + .share-import-group button,
#setup-manager .form-row.form-row-actions .form-actions > button[hidden] + .share-import-group button {
  width: 100%;
}


.share-option {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: calc(var(--font-size-base) * var(--font-scale-md));
  margin: 0;
}

.share-option input[type="checkbox"] {
  margin: 0;
}

.share-option.disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.share-dialog {
  display: flex;
  flex-direction: column;
  gap: clamp(0.75rem, 2vw, 1rem);
  width: min(90vw, 420px);
  padding: clamp(1.25rem, 3vw, 1.75rem);
  border-color: var(--panel-border);
  box-shadow: var(--panel-shadow);
}

.share-dialog h3 {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xl));
  font-weight: var(--font-weight-semibold);
}

.share-dialog p {
  margin: 0;
  color: var(--muted-text-color);
  line-height: var(--line-height-supporting);
}

.share-dialog .form-row {
  align-items: center;
  gap: 0.75rem;
}

.dialog-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  margin-top: clamp(0.75rem, 2vw, 1.25rem);
}

#setup-manager .share-import-row {
  align-items: flex-start;
}

#setup-manager .share-import-options {
  flex: 1;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 0.75rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  background-color: var(--surface-color);
}

#setup-manager .share-import-options legend {
  font-weight: var(--font-weight-semibold);
  font-size: calc(var(--font-size-base) * var(--font-scale-md));
  margin-bottom: 0.25rem;
}

#setup-manager .share-import-mode-select {
  width: 100%;
  min-height: 6.5rem;
}

#sharedImportDialog .share-import-dialog {
  width: min(90vw, 420px);
  display: flex;
  flex-direction: column;
  gap: clamp(1rem, 2.5vw, 1.5rem);
  padding: clamp(1.25rem, 3vw, 1.75rem);
  border-color: var(--panel-border);
  box-shadow: var(--panel-shadow);
}

#sharedImportDialog .share-import-dialog h3 {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xl));
  font-weight: var(--font-weight-semibold);
}

#sharedImportDialog .share-import-dialog p {
  margin: 0;
  color: var(--muted-text-color);
  line-height: 1.5;
}

#sharedImportDialog .share-import-options {
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 0.75rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  background-color: var(--panel-bg);
}

#sharedImportDialog .share-import-options legend {
  font-weight: var(--font-weight-semibold);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-md));
  margin-bottom: 0.25rem;
  color: var(--text-color);
}

#sharedImportDialog .share-import-mode-select {
  width: 100%;
  min-height: 6.5rem;
  border: 1px solid var(--control-border);
  border-radius: var(--border-radius);
  background-color: var(--control-bg);
  color: var(--control-text);
}

#sharedImportDialog .share-import-mode-select option {
  padding: 0.5rem 0.75rem;
}

#sharedImportDialog .dialog-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
}

#sharedImportDialog .dialog-actions button {
  min-width: clamp(96px, 20vw, 128px);
}

.feedback-dialog {
  display: flex;
  flex-direction: column;
  gap: clamp(1rem, 3vw, 1.5rem);
  width: min(95vw, 720px);
  padding: clamp(1.25rem, 3vw, 2rem);
  border-color: var(--panel-border);
}

.feedback-dialog h3 {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xl));
  font-weight: var(--font-weight-semibold);
}

#setup-manager #shareLinkMessage {
  margin-left: calc(var(--form-label-width) + var(--gap-size));
}

@media (max-width: 600px) {
  .form-row {
    flex-direction: column;
    align-items: stretch;
  }
  .form-row label,
  .form-row .form-row-label {
    flex: 1 0 100%;
    min-width: unset;
  }
  .form-row select,
  .form-row input {
    margin: 0;
  }
  .form-label-spacer {
    display: none;
  }
  #setup-manager .form-row:not(.form-row-actions) > button:not(.clear-input-btn):not(.favorite-toggle),
  #setup-config .form-row:not(.form-row-actions) > button:not(.clear-input-btn):not(.favorite-toggle) {
    flex: 1 0 100%;
    width: 100%;
    margin: 5px 0 0 0;
  }
  #setup-manager .form-row.form-row-actions {
    flex-direction: column;
    align-items: stretch;
  }
  #setup-manager .form-row.form-row-actions .form-actions {
    flex-direction: column;
  }
  #setup-manager .form-row.form-row-actions .form-actions button,
  #setup-manager .form-row.form-row-actions > button {
    width: 100%;
  }
  #setup-manager #shareLinkMessage {
    margin-left: 0;
  }

  .share-import-group {
    width: 100%;
    flex-direction: column;
    align-items: stretch;
  }

  .share-import-group label {
    width: 100%;
    white-space: normal;
  }

  .share-import-group button {
    width: 100%;
    align-self: stretch;
  }
  .share-import-group #applySharedLinkBtn {
    flex: 1 1 100%;
    width: 100%;
    align-self: stretch;
  }

  #setup-manager .share-import-row {
    flex-direction: column;
  }

  #setup-manager .share-import-options {
    width: 100%;
  }

  .settings-hint {
    margin-left: 0;
  }
}

@supports (-webkit-touch-callout: none) {
  select,
  input:not([type="checkbox"]):not([type="radio"]),
  textarea {
    background-image: none;
    -webkit-appearance: none;
    appearance: none;
  }
}

/* Align add/remove buttons in form rows with input fields */
.form-row > button:not(.clear-input-btn):not(.favorite-toggle) {
  align-self: flex-end;
  margin-top: 5px;
}

.form-row > .inline-form-button {
  align-self: center;
  margin-top: 0;
  white-space: nowrap;
  flex: 0 0 auto;
}

.form-row > button:not(.clear-input-btn):not(.favorite-toggle) + button:not(.clear-input-btn):not(.favorite-toggle) {
  margin-left: 0;
}

.settings-hint {
  flex-basis: 100%;
  margin: 0;
  margin-left: calc(var(--form-label-width) + var(--gap-size));
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  color: var(--control-text);
  opacity: 0.8;
}

.project-backups {
  display: flex;
  flex-direction: column;
  gap: var(--gap-size);
  margin-top: var(--gap-size);
  padding-top: var(--gap-size);
  border-top: 1px solid color-mix(in srgb, var(--panel-border) 60%, transparent);
}

.project-backups .settings-hint {
  margin-left: 0;
}

.project-backups-actions {
  align-items: center;
}

.full-backup-section {
  display: flex;
  flex-direction: column;
  gap: var(--gap-size);
  margin-top: var(--gap-size);
  padding-top: var(--gap-size);
  border-top: 1px solid color-mix(in srgb, var(--panel-border) 60%, transparent);
}

.full-backup-section .settings-hint {
  margin-left: 0;
}

.full-backup-actions {
  align-items: center;
}

.backup-diff-section {
  display: flex;
  flex-direction: column;
  gap: var(--gap-size);
  padding-block: calc(var(--gap-size) * 0.5);
  border-top: 1px solid color-mix(in srgb, var(--panel-border) 80%, transparent);
}

.backup-diff-section[hidden] {
  display: none;
}

.backup-diff-section h4 {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

.backup-diff-section .diff-summary {
  margin: 0;
  padding: 0.5rem 0.75rem;
  border-radius: var(--border-radius);
  background: color-mix(in srgb, var(--accent-color) 12%, transparent);
  color: var(--text-color);
}

.diff-list-container {
  border: 1px solid color-mix(in srgb, var(--panel-border) 65%, transparent);
  border-radius: var(--border-radius);
  padding: 0.75rem;
  max-height: 18rem;
  overflow: auto;
  background: color-mix(in srgb, var(--surface-color) 96%, var(--accent-color) 4%);
}

.diff-list-container[hidden] {
  display: none;
}

.diff-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.restore-rehearsal {
  display: flex;
  flex-direction: column;
  gap: var(--gap-size);
  margin-top: var(--gap-size);
  padding: 1rem;
  border: 1px solid color-mix(in srgb, var(--panel-border) 65%, transparent);
  border-radius: var(--border-radius);
  background: color-mix(in srgb, var(--surface-color) 94%, var(--accent-color) 6%);
}

.restore-rehearsal[hidden] {
  display: none;
}

.restore-rehearsal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--gap-size);
}

.restore-rehearsal-header h4 {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

.restore-rehearsal-modes {
  border: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  gap: calc(var(--gap-size) * 0.75);
}

.restore-rehearsal-modes label {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 500;
}

.restore-rehearsal-file {
  align-items: center;
}

.restore-rehearsal-file button {
  margin-left: auto;
}

.restore-rehearsal-table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid color-mix(in srgb, var(--panel-border) 55%, transparent);
  border-radius: var(--border-radius);
  overflow: hidden;
  background: color-mix(in srgb, var(--surface-color) 96%, var(--accent-color) 4%);
}

.restore-rehearsal-table caption {
  text-align: left;
  font-weight: 600;
  padding: 0.75rem;
}

.restore-rehearsal-table th,
.restore-rehearsal-table td {
  padding: 0.5rem 0.75rem;
  text-align: left;
  border-top: 1px solid color-mix(in srgb, var(--panel-border) 45%, transparent);
}

.restore-rehearsal-table th:first-child,
.restore-rehearsal-table td:first-child {
  width: 35%;
}

.restore-rehearsal-table tbody tr:first-child th,
.restore-rehearsal-table tbody tr:first-child td {
  border-top: none;
}

.restore-rehearsal-table .restore-rehearsal-diff-match {
  color: color-mix(in srgb, var(--text-color) 85%, var(--accent-color) 15%);
}

.restore-rehearsal-table .restore-rehearsal-diff-positive {
  color: var(--danger-color, #b00020);
  font-weight: 600;
}

.restore-rehearsal-table .restore-rehearsal-diff-negative {
  color: var(--warning-color, #8a6d3b);
  font-weight: 600;
}

.diff-entry {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  border: 1px solid color-mix(in srgb, var(--panel-border) 65%, transparent);
  border-radius: calc(var(--border-radius) * 0.9);
  padding: 0.75rem;
  background: color-mix(in srgb, var(--surface-color) 96%, transparent);
  box-shadow: 0 1px 0 rgba(0, 0, 0, 0.04);
}

.diff-entry.diff-added {
  border-color: color-mix(in srgb, var(--success-color) 55%, var(--panel-border) 45%);
  background: color-mix(in srgb, var(--surface-color) 90%, var(--success-color) 10%);
}

.diff-entry.diff-removed {
  border-color: color-mix(in srgb, var(--danger-color) 55%, var(--panel-border) 45%);
  background: color-mix(in srgb, var(--surface-color) 90%, var(--danger-color) 10%);
}

.diff-entry.diff-changed {
  border-color: color-mix(in srgb, var(--info-color) 55%, var(--panel-border) 45%);
  background: color-mix(in srgb, var(--surface-color) 92%, var(--info-color) 8%);
}

.diff-entry-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.75rem;
}

.diff-path {
  font-weight: var(--font-weight-medium);
  color: var(--text-color);
  word-break: break-word;
}

.diff-status-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
  padding: 0.25rem 0.6rem;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--panel-border) 70%, transparent);
  background: color-mix(in srgb, var(--surface-color) 92%, transparent);
  color: color-mix(in srgb, var(--text-color) 90%, transparent);
}

.diff-status-added {
  border-color: color-mix(in srgb, var(--success-color) 55%, transparent);
  background: color-mix(in srgb, var(--surface-color) 82%, var(--success-color) 18%);
  color: color-mix(in srgb, var(--success-color) 85%, var(--text-color) 15%);
}

.diff-status-removed {
  border-color: color-mix(in srgb, var(--danger-color) 55%, transparent);
  background: color-mix(in srgb, var(--surface-color) 80%, var(--danger-color) 20%);
  color: color-mix(in srgb, var(--danger-color) 80%, var(--text-color) 20%);
}

.diff-status-changed {
  border-color: color-mix(in srgb, var(--info-color) 55%, transparent);
  background: color-mix(in srgb, var(--surface-color) 84%, var(--info-color) 16%);
  color: color-mix(in srgb, var(--info-color) 80%, var(--text-color) 20%);
}

.diff-change-group {
  display: grid;
  gap: 0.75rem;
}

.diff-change-group--split {
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.diff-change {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.diff-label {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: color-mix(in srgb, var(--text-color) 70%, transparent);
}

.diff-value {
  margin: 0;
  padding: 0.6rem 0.7rem;
  border-radius: calc(var(--border-radius) * 0.75);
  border: 1px solid color-mix(in srgb, var(--panel-border) 70%, transparent);
  background: color-mix(in srgb, var(--surface-color) 94%, transparent);
  font-family: "SFMono-Regular", "Roboto Mono", "Menlo", "Courier New", monospace;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 10rem;
  overflow: auto;
}

.diff-value-added {
  border-color: color-mix(in srgb, var(--success-color) 55%, transparent);
  background: color-mix(in srgb, var(--surface-color) 86%, var(--success-color) 14%);
}

.diff-value-removed {
  border-color: color-mix(in srgb, var(--danger-color) 55%, transparent);
  background: color-mix(in srgb, var(--surface-color) 84%, var(--danger-color) 16%);
}

.diff-value-changed {
  border-color: color-mix(in srgb, var(--info-color) 55%, transparent);
  background: color-mix(in srgb, var(--surface-color) 88%, var(--info-color) 12%);
}

html.high-contrast .diff-entry,
body.high-contrast .diff-entry {
  background: var(--background-color);
  border-color: var(--text-color);
  box-shadow: none;
}

html.high-contrast .diff-entry.diff-added,
body.high-contrast .diff-entry.diff-added,
html.high-contrast .diff-entry.diff-removed,
body.high-contrast .diff-entry.diff-removed,
html.high-contrast .diff-entry.diff-changed,
body.high-contrast .diff-entry.diff-changed {
  background: var(--background-color);
}

html.high-contrast .diff-status-badge,
body.high-contrast .diff-status-badge {
  background: var(--background-color);
  border-color: var(--text-color);
  color: var(--text-color);
}

html.high-contrast .diff-value,
body.high-contrast .diff-value,
html.high-contrast .diff-value-added,
body.high-contrast .diff-value-added,
html.high-contrast .diff-value-removed,
body.high-contrast .diff-value-removed,
html.high-contrast .diff-value-changed,
body.high-contrast .diff-value-changed {
  background: var(--background-color);
  border-color: var(--text-color);
  color: var(--text-color);
}

.diff-actions {
  justify-content: flex-end;
  gap: var(--gap-size);
}

/* Ensure favorite star aligns with its select element without stretching */
.select-wrapper .favorite-toggle {
  align-self: center;
  min-height: var(--button-size);
  height: auto;
  margin-top: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

/* Date range rows for prep and shooting days */
.period-row {
  display: flex;
  align-items: center;
  gap: var(--gap-size);
  flex-wrap: wrap;
  margin-bottom: var(--gap-size);
}
.period-row input {
  flex: 1;
  min-width: 120px;
}
.period-row span {
  white-space: nowrap;
}

.period-row button {
  margin: 0;
}

@media (max-width: 600px) {
  .period-row {
    flex-direction: column;
    align-items: stretch;
  }
  .period-row span {
    display: none;
  }
  .period-row button {
    align-self: flex-end;
  }
}


/* Small wrapper to show labels even when a value is present */
.field-with-label {
  display: flex;
  flex-direction: column;
  flex: 1;
  margin-right: 5px;
  min-width: 150px; /* prevent fields from becoming too narrow */
}
.field-with-label::before {
  content: attr(data-label);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  color: var(--muted-text-color);
  margin-bottom: 2px;
}

#helpDialog[hidden] {
  display: none;
}
#settingsDialog[hidden] {
  display: none;
}

/* Global modal layout */
.app-modal {
  border: none;
  padding: 0;
  background: transparent;
  color: inherit;
  max-width: none;
  width: 100vw;
  height: 100vh;
  margin: 0;
}

.app-modal::backdrop {
  background: rgba(0, 0, 0, 0.6);
}

.app-modal[open] {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  z-index: 200;
  overflow: hidden;
  overscroll-behavior: contain;
}

.modal-surface {
  background: var(--surface-color);
  color: var(--text-color);
  border: 2px solid var(--accent-color);
  border-radius: var(--border-radius);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}


.power-warning-dialog {
  max-width: min(420px, 90vw);
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1.5rem;
  border-color: var(--danger-color);
}

.power-warning-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid var(--danger-color);
  color: var(--danger-color);
}

.power-warning-icon {
  font-size: 2.5rem;
  color: var(--danger-color);
  --icon-color: var(--danger-color);
}

.power-warning-title {
  margin: 0;
  color: inherit;
}


.power-warning-summary {
  border: 1px solid var(--danger-color);
  border-left-width: 4px;
  border-radius: var(--border-radius);
  background: var(--danger-overlay-color);
  padding: 0.75rem 1rem;
  color: var(--text-color);
  font-weight: var(--font-weight-bold);
}

.power-warning-summary p {
  margin: 0;
}

.power-warning-section {
  border: 1px solid var(--danger-color);
  border-radius: var(--border-radius);
  padding: 1rem;
  background: var(--surface-color);
  background: color-mix(in srgb, var(--surface-color) 75%, var(--danger-overlay-color));
}

.power-warning-section h4 {
  margin: 0 0 0.5rem;
  font-size: 1rem;
  color: var(--danger-color);
}

.power-warning-details {
  margin: 0;
  padding-left: 1.25rem;
  color: var(--text-color-secondary, inherit);
}

.power-warning-details li {
  margin-bottom: 0.25rem;
}

.power-warning-details li:last-child {
  margin-bottom: 0;
}

.power-warning-advice {
  margin: 0;
  font-weight: var(--font-weight-bold);
  color: var(--danger-color);
}

.dark-mode .power-warning-icon {
  color: var(--danger-color, #ff6666);
  --icon-color: var(--danger-color, #ff6666);
}

.help-content.modal-surface,
.settings-content.modal-surface {
  border: 2px solid var(--panel-border);
}

.modal-surface-scrollable {
  max-height: min(92vh, 960px);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

#installGuideDialog {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 205;
  padding: 20px;
  overflow: hidden;
  overscroll-behavior: contain;
}

#iosPwaHelpDialog {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 210;
  padding: 20px;
  overflow: hidden;
  overscroll-behavior: contain;
}

#feedbackForm fieldset {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 10px 20px;
}

#feedbackForm fieldset legend {
  grid-column: 1 / -1;
}

#feedbackForm .button-row {
  display: flex;
  justify-content: flex-end;
  gap: var(--cluster-gap);
  margin-top: var(--spacing-lg);
}

#installGuideDialog[hidden] {
  display: none;
}

#iosPwaHelpDialog[hidden] {
  display: none;
}

#settingsDialog[hidden] {
  display: none;
}

.help-content {
  padding: 20px;
  width: min(95vw, 900px);
}

.help-content h3 {
  display: flex;
  align-items: center;
  gap: 0.35em;
}

.help-content h3 .help-icon {
  margin-right: 0;
  flex-shrink: 0;
}


.install-guide-content {
  padding: clamp(20px, 4vw, 32px);
  width: min(520px, 100%);
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.install-guide-content ol {
  padding-left: 20px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.install-guide-content section {
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.install-guide-content section h3 {
  margin: 0;
}

.install-guide-actions {
  justify-content: flex-end;
}


.ios-pwa-help-content {
  padding: clamp(20px, 4vw, 32px);
  width: min(480px, 100%);
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.ios-pwa-help-content ol {
  padding-left: 20px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.ios-pwa-help-actions {
  justify-content: flex-end;
}


.settings-content {
  padding: 20px;
  width: min(95vw, 960px);
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.settings-tabs {
  display: flex;
  flex-wrap: nowrap;
  gap: var(--cluster-gap);
  padding: 0;
  margin: 0;
  list-style: none;
  align-items: stretch;
  flex: 0 0 auto;
  overflow-x: auto;
  overflow-y: hidden;
  scrollbar-width: thin;
  -webkit-overflow-scrolling: touch;
  scrollbar-gutter: stable both-edges;
}

.settings-tab {
  margin: 0;
  flex: 1 1 140px;
  min-width: 140px;
  justify-content: flex-start;
  align-items: center;
  text-align: left;
  white-space: normal;
  font-weight: var(--font-weight-medium);
  letter-spacing: normal;
  transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease,
    transform 0.2s ease;
}

.settings-tab:hover,
.settings-tab:focus-visible {
  transform: translateY(-1px);
}

.settings-tab:active {
  transform: translateY(0);
}

.settings-tab:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

.settings-tab[aria-selected="true"] {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
  box-shadow: 0 4px 12px color-mix(in srgb, var(--accent-color) 35%, transparent);
}

.settings-tab[aria-selected="true"]:hover,
.settings-tab[aria-selected="true"]:focus-visible {
  background-color: color-mix(in srgb, var(--accent-color) 90%, var(--control-hover-bg));
}

.settings-tab-icon {
  --icon-size: var(--button-icon-size);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: var(--accent-color);
  flex: 0 0 auto;
  margin-inline-end: 0;
  flex-shrink: 0;
  transition: color 0.2s ease;
}

.settings-tab:hover .settings-tab-icon,
.settings-tab:focus-visible .settings-tab-icon,
.settings-tab[aria-selected="true"] .settings-tab-icon {
  color: currentColor;
}

.settings-tab-label {
  font-size: var(--form-control-font-size);
  font-weight: var(--font-weight-medium);
  line-height: var(--button-line-height);
  color: inherit;
  text-align: left;
  flex: 1 1 auto;
  min-width: 0;
}

.settings-tab[aria-selected="true"] .settings-tab-label {
  font-weight: var(--font-weight-semibold);
}

body.high-contrast .settings-tab {
  border: 2px solid currentColor;
  background-color: var(--surface-color);
  color: inherit;
  box-shadow: none;
}

body.high-contrast .settings-tab:hover,
body.high-contrast .settings-tab:focus-visible {
  transform: none;
}

body.high-contrast .settings-tab[aria-selected="true"] {
  border-color: var(--accent-color);
  color: var(--inverse-text-color);
  box-shadow: none;
}

@media (max-width: 600px) {
  .settings-tab {
    flex-basis: 100%;
  }
}

@media (prefers-reduced-motion: reduce) {
  .settings-tab {
    transition: none;
    transform: none;
  }
  .settings-tab-icon {
    transition: none;
  }
}

.settings-panel {
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  box-shadow: var(--panel-shadow);
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.settings-panel h3 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
}

.settings-panel p {
  margin: 0;
}

.settings-panel label {
  font-weight: var(--font-weight-light);
}

.settings-panel .button-row {
  justify-content: flex-start;
  flex-wrap: wrap;
}

.settings-panel[hidden] {
  display: none;
}

.auto-gear-rules {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

#settingsPanel-autoGear h3,
#settingsPanel-autoGear h4 {
  font-weight: var(--font-weight-semibold);
}

.auto-gear-preset-panel {
  margin-top: 16px;
  margin-bottom: 16px;
  padding: 16px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  background: var(--panel-bg);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.auto-gear-preset-row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 12px;
}

.auto-gear-preset-row label {
  flex: 0 0 auto;
  margin: 0;
}

.auto-gear-preset-select {
  flex: 1 1 200px;
  min-width: 160px;
}

.auto-gear-action-row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 12px;
}

.auto-gear-filters .auto-gear-action-row {
  flex: 1 1 100%;
  margin-top: 0;
}

.auto-gear-highlight-toggle {
  display: inline-flex;
  align-items: center;
  gap: var(--icon-gap);
  margin: 0;
  border: 1px solid color-mix(in srgb, var(--accent-color) 45%, transparent);
  background: color-mix(in srgb, var(--surface-color) 92%, var(--accent-color) 8%);
  color: var(--control-text);
  font-weight: var(--font-weight-medium);
  justify-content: flex-start;
  padding-inline: calc(var(--button-padding-inline) * 0.9);
  min-width: 0;
  transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease,
    box-shadow 0.2s ease;
}

.auto-gear-highlight-toggle .btn-icon {
  margin-inline-end: var(--icon-gap);
  color: currentColor;
}

.auto-gear-highlight-toggle:hover,
.auto-gear-highlight-toggle:focus-visible {
  background: var(--accent-color);
  color: var(--inverse-text-color);
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 35%, transparent);
}

.auto-gear-highlight-toggle:focus-visible {
  outline: none;
}

.auto-gear-highlight-toggle.is-active {
  background: var(--accent-color);
  color: var(--inverse-text-color);
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 45%, transparent);
}

.auto-gear-highlight-toggle:disabled {
  opacity: 0.65;
  cursor: not-allowed;
  box-shadow: none;
}

.auto-gear-highlight-state {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-inline-start: calc(var(--icon-gap) * 1.4);
  padding: 0.15em 0.6em;
  border-radius: 999px;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  line-height: 1.2;
  font-weight: var(--font-weight-medium);
  border: 1px solid color-mix(in srgb, var(--accent-color) 35%, transparent);
  background: color-mix(in srgb, var(--accent-color) 18%, transparent);
  color: currentColor;
  transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease,
    opacity 0.2s ease;
}

.auto-gear-highlight-toggle.is-active .auto-gear-highlight-state {
  background: color-mix(in srgb, var(--inverse-text-color) 18%, transparent);
  border-color: color-mix(in srgb, var(--inverse-text-color) 35%, transparent);
  color: var(--inverse-text-color);
}

.auto-gear-highlight-toggle:disabled .auto-gear-highlight-state {
  opacity: 0.7;
}

.auto-gear-backups {
  margin-top: 16px;
  padding: 16px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  background: var(--panel-bg);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.auto-gear-backup-header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.auto-gear-backup-toggle-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.auto-gear-backup-toggle-row label {
  margin: 0;
}

.auto-gear-backups.auto-gear-backups-collapsed {
  gap: 4px;
}

.auto-gear-backups.auto-gear-backups-collapsed .auto-gear-backup-controls {
  display: none;
}

.auto-gear-backup-controls {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.auto-gear-backup-row {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.auto-gear-backup-select {
  flex: 1;
  min-width: 0;
}

.auto-gear-backup-empty {
  font-style: italic;
  color: var(--muted-text-color, #666);
  margin: 0;
}

.auto-gear-filters {
  margin-top: 16px;
  margin-bottom: 12px;
  padding: 12px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  background: var(--panel-bg);
  display: flex;
  flex-wrap: wrap;
  align-items: flex-end;
  gap: 12px;
}

.auto-gear-filter-field {
  flex: 1 1 220px;
  min-width: 200px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.auto-gear-filter-field label {
  margin: 0;
  font-weight: var(--font-weight-semibold);
}

.auto-gear-filter-field input[type='search'],
.auto-gear-filter-select {
  width: 100%;
}

.auto-gear-filter-clear {
  flex: 0 0 auto;
  align-self: flex-end;
  margin: 0 0 var(--button-margin-block-end);
  margin-left: auto;
  padding-inline: calc(var(--button-padding-inline) + 2px);
  background-color: var(--surface-color);
  border: 1px solid var(--panel-border);
  color: var(--control-text);
  box-shadow: none;
}

.auto-gear-filter-clear:hover {
  background-color: color-mix(in srgb, var(--accent-color) 12%, var(--surface-color));
  border-color: color-mix(in srgb, var(--accent-color) 55%, var(--panel-border));
  color: var(--control-text);
}

.auto-gear-filter-clear:active {
  background-color: color-mix(in srgb, var(--accent-color) 18%, var(--surface-color));
  border-color: color-mix(in srgb, var(--accent-color) 65%, var(--panel-border));
}

.auto-gear-filter-clear:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

.auto-gear-rule {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  padding: 12px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  background: var(--panel-bg);
}

.auto-gear-rule-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  min-width: 0;
}

.auto-gear-rule-title {
  font-weight: var(--font-weight-semibold);
  margin: 0;
}

.auto-gear-rule-items-label {
  font-weight: var(--font-weight-semibold);
}

body.light-mode .auto-gear-rule-title,
body.light-mode #settingsPanel-autoGear h3,
body.light-mode #settingsPanel-autoGear h4,
body.light-mode #settingsPanel-autoGear .auto-gear-filter-field label,
body.light-mode #settingsPanel-autoGear .auto-gear-rule-items-label,
#overviewDialogContent:not(.dark-mode) .auto-gear-rule-title,
#overviewDialogContent:not(.dark-mode) .auto-gear-rule-items-label {
  color: var(--accent-color);
}

body.pink-mode .auto-gear-rule-title,
#overviewDialogContent.pink-mode .auto-gear-rule-title {
  color: var(--accent-color);
}

body.pink-mode:not(.dark-mode) #settingsPanel-autoGear h3,
body.pink-mode:not(.dark-mode) #settingsPanel-autoGear h4,
body.pink-mode:not(.dark-mode) #settingsPanel-autoGear .auto-gear-filter-field label,
body.pink-mode:not(.dark-mode) #settingsPanel-autoGear .auto-gear-rule-items-label,
#overviewDialogContent.pink-mode:not(.dark-mode) .auto-gear-rule-items-label {
  color: var(--accent-color);
}

.auto-gear-rule-meta {
  color: var(--muted-text-color, #666);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

.auto-gear-rule-items-label {
  margin-top: 4px;
}

.auto-gear-rule-items {
  margin: 0;
  padding-left: 18px;
  color: var(--muted-text-color, #666);
}

.auto-gear-rule-item {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
  line-height: var(--line-height-supporting);
  word-break: break-word;
}

.auto-gear-rule-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

@media (max-width: 600px) {
  .auto-gear-rule {
    flex-direction: column;
    align-items: stretch;
  }

  .auto-gear-rule-info,
  .auto-gear-rule-items,
  .auto-gear-rule-actions {
    width: 100%;
  }

  .auto-gear-rule-actions {
    justify-content: flex-start;
  }
}

.auto-gear-editor {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 16px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  background: var(--panel-bg);
}

.auto-gear-editor[hidden] {
  display: none !important;
}

.auto-gear-conditions-row {
  padding: 0;
}

.auto-gear-conditions {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
}

.auto-gear-condition-controls {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.auto-gear-condition-controls label {
  flex: 0 0 auto;
  min-width: 0;
}

.auto-gear-condition-picker {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.auto-gear-condition-controls:focus-within {
  outline: 2px solid var(--accent-color, #007aff);
  outline-offset: 4px;
  border-radius: var(--border-radius);
}

.auto-gear-condition-select {
  min-width: min(220px, 100%);
}

.auto-gear-condition-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.auto-gear-condition {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 12px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  background: var(--surface-color);
}

.auto-gear-condition[hidden] {
  display: none !important;
}

.auto-gear-condition-header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.auto-gear-condition-actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.auto-gear-condition-actions button {
  min-width: 40px;
  padding-inline: 10px;
}

.auto-gear-editor-columns {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

@media (min-width: 720px) {
  .auto-gear-editor-columns {
    flex-direction: row;
  }
}

.auto-gear-column {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.auto-gear-add-controls {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  align-items: end;
}

.auto-gear-field {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.auto-gear-item-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.auto-gear-item-list .auto-gear-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  background: var(--surface-color);
}

.auto-gear-item-list .auto-gear-item.auto-gear-item-editing {
  border-color: var(--accent-color, #007aff);
  box-shadow: 0 0 0 1px var(--accent-color, #007aff);
}

.auto-gear-item-list .auto-gear-item span {
  display: block;
}

.auto-gear-item-actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.auto-gear-selector-container {
  display: inline-flex;
  flex-direction: column;
  align-items: stretch;
  gap: 4px;
  max-width: min(100%, 320px);
  vertical-align: top;
}

.auto-gear-selector,
.auto-gear-multiselect {
  width: 100%;
  height: auto;
  overflow-y: auto;
}

.auto-gear-selector {
  max-height: 18rem;
}

.auto-gear-multiselect {
  max-height: min(24rem, 60vh);
}

.auto-gear-device-multiselect {
  min-height: 14rem;
}

@media (max-width: 640px) {
  .auto-gear-device-multiselect {
    min-height: 12rem;
  }
}

.auto-gear-selector-hint {
  display: block;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  color: var(--muted-text-color, #666);
  line-height: var(--line-height-supporting);
}

.auto-gear-empty {
  font-style: italic;
  color: var(--muted-text-color, #666);
}

.storage-summary {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.storage-summary-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.storage-summary-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 12px;
}

.storage-summary-label {
  font-weight: var(--font-weight-semibold);
}

.storage-summary-key {
  font-family: 'Courier New', Courier, monospace;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  padding: 2px 6px;
  border-radius: 4px;
  background: var(--control-bg);
  color: var(--control-text);
}

.storage-summary-value {
  margin: 0;
  font-weight: var(--font-weight-medium);
}

.storage-summary-note,
.storage-summary-description,
.storage-summary-extra {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  color: var(--control-text);
  opacity: 0.85;
}

.storage-summary-extra {
  padding-left: 0;
}

.settings-content .button-row {
  display: flex;
  gap: var(--cluster-gap);
  flex-wrap: wrap;
  align-items: center;
}

#settingsDialog button {
  flex-shrink: 0;
}

.settings-content .action-buttons {
  justify-content: flex-end;
  margin-top: auto;
}

.help-content p,
.help-content li {
  line-height: 1.6;
}


#helpSearchContainer {
  position: relative;
}

#helpSearch {
  width: 100%;
  margin: 10px 0;
  padding: 5px calc(var(--button-size) + 12px) 5px 10px;
  box-sizing: border-box;
  border: 1px solid var(--panel-border);
}

#helpSearch:focus-visible {
  outline: none;
  border-color: var(--accent-color);
  box-shadow: 0 0 0 1px var(--accent-color);
}

#helpSearchClear {
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
  margin: 0;
  padding: 0;
  width: var(--button-size);
  height: var(--button-size);
  min-height: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  font-size: var(--font-size-base);
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
}

#helpSearchClear[hidden] {
  display: none;
}

#helpQuickLinks {
  margin: 16px 0;
  padding: 12px;
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
}

#helpResultsSummary {
  margin: 0 0 12px;
  color: var(--muted-text-color);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-md));
}

#helpResultsSummary[hidden] {
  display: none;
}

#helpQuickLinks[hidden] {
  display: none;
}

#helpQuickLinksHeading {
  margin: 0;
  font-size: var(--font-size-base);
}

#helpQuickLinksList {
  list-style: none;
  margin: 8px 0 0;
  padding: 0;
  display: grid;
  gap: 6px;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

#helpQuickLinksList li {
  margin: 0;
}

.help-quick-link {
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  gap: 0.5em;
  background: none;
  border: none;
  color: inherit;
  width: 100%;
  margin: 0;
  padding: 0 10px;
  text-align: left;
  white-space: normal;
}

.help-quick-link-icon {
  --icon-color: var(--accent-color);
  flex: 0 0 auto;
  font-size: var(--icon-size-md);
}

.help-quick-link-icon.icon-glyph {
  --icon-size: var(--icon-size-md);
}

.dark-mode .help-quick-link-icon {
  --icon-color: var(--inverse-text-color);
}

.help-quick-link.active .help-quick-link-icon {
  --icon-color: var(--inverse-text-color);
}

.help-quick-link-label {
  flex: 1 1 auto;
  min-width: 0;
  line-height: 1.3;
}

.help-quick-link:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

.help-quick-link.active {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
}

.help-quick-link.active:focus-visible {
  outline-color: var(--inverse-text-color);
}

#helpSections section[hidden],
#helpSections details[hidden] {
  display: none;
}

#helpSections section {
  scroll-margin-top: 24px;
}

#helpSections section.help-section-focus {
  outline: 2px solid var(--accent-color);
  outline-offset: 4px;
  border-radius: var(--border-radius);
}

.help-link {
  text-decoration: none;
  transition:
    color 0.2s ease,
    text-decoration-color 0.2s ease;
}

.help-link:focus-visible {
  border-radius: calc(var(--border-radius) * 0.75);
}

.help-link:not(.button-link) {
  color: var(--accent-color);
  font-weight: var(--font-weight-semibold);
  text-underline-offset: 0.2em;
  text-decoration-thickness: 0.12em;
}

.help-link:not(.button-link):visited {
  color: var(--accent-color);
}

.help-link:not(.button-link):hover,
.help-link:not(.button-link):focus-visible {
  text-decoration: underline;
}

.help-inline-links {
  margin: 0.75rem 0 0;
  line-height: 1.6;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

.help-inline-links .help-link:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

.help-callout {
  margin: 1.25rem 0;
  padding: 1rem 1.25rem;
  border-radius: calc(var(--border-radius) * 1.2);
  border: 1px solid var(--panel-border);
  background-color: var(--panel-bg);
  box-shadow: inset 4px 0 0 0 var(--accent-color);
  display: grid;
  gap: 0.75rem;
}

.help-callout h4 {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-md));
  font-weight: var(--font-weight-semibold);
}

.help-callout ol,
.help-callout ul {
  margin: 0;
  padding-left: 1.25em;
}

.help-callout-note {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
  color: var(--muted-text-color);
}

body.dark-mode .help-callout {
  background-color: rgba(255, 255, 255, 0.06);
  border-color: rgba(255, 255, 255, 0.12);
}

.help-target-focus,
.feature-search-focus {
  outline: 3px solid var(--accent-color);
  outline-offset: 4px;
  border-radius: var(--border-radius);
  transition:
    outline-color 0.2s ease-in-out,
    background-color 0.2s ease-in-out,
    box-shadow 0.2s ease-in-out;
}

.help-target-focus:focus,
.help-target-focus:focus-visible,
.feature-search-focus:focus,
.feature-search-focus:focus-visible {
  outline: 3px solid var(--accent-color);
  outline-offset: 4px;
}

.feature-search-focus {
  background-color: rgba(0, 0, 0, 0.04);
  box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.02);
}

.dark-mode .feature-search-focus {
  background-color: rgba(255, 255, 255, 0.08);
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.04);
}

@supports (background-color: color-mix(in srgb, red 10%, transparent)) {
  .feature-search-focus {
    background-color: color-mix(in srgb, var(--accent-color) 18%, transparent);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 24%, transparent);
  }

  .dark-mode .feature-search-focus {
    background-color: color-mix(in srgb, var(--accent-color) 26%, transparent);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 32%, transparent);
  }
}

.icon-glyph {
  font-family: 'UiconsThinStraightV2';
  font-style: normal;
  font-weight: var(--font-weight-regular);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  vertical-align: middle;
  font-size: var(--icon-size, 1em);
  width: var(--icon-size, 1em);
  height: var(--icon-size, 1em);
  inline-size: var(--icon-size, 1em);
  block-size: var(--icon-size, 1em);
  min-inline-size: var(--icon-size, 1em);
  min-block-size: var(--icon-size, 1em);
  flex: 0 0 var(--icon-size, 1em);
  color: var(--icon-color, currentColor);
}

.icon-glyph[data-icon-font='uicons'] {
  font-family: 'UiconsThinStraightV2';
}

.icon-glyph[data-icon-font='essential'] {
  font-family: 'EssentialIconsV2';
}

.icon-glyph[data-icon-font='film'] {
  font-family: 'FilmIndustryIconsV2';
}

.icon-glyph[data-icon-font='gadget'] {
  font-family: 'GadgetIconsV2';
}

.icon-glyph[data-icon-font='text'] {
  font-family: 'Ubuntu', sans-serif;
  font-weight: var(--font-weight-medium);
}

.icon-glyph.icon-text {
  font-family: 'Ubuntu', sans-serif;
  font-weight: var(--font-weight-medium);
}

.icon-glyph.icon-svg {
  font-family: inherit;
}

.icon-glyph.icon-svg svg {
  width: 1em;
  height: 1em;
  display: block;
  stroke: currentColor;
  fill: none;
}

.favorite-icon.icon-svg svg,
.favorite-star-icon svg {
  fill: currentColor;
  stroke-width: 0;
}

.icon-glyph.icon-svg .pink-mode-icon-image {
  width: 1em;
  height: 1em;
  display: block;
  object-fit: contain;
}

body.pink-mode .pink-mode-icon {
  color: var(--accent-color);
}

@keyframes pink-mode-icon-pop {
  0% {
    transform: scale(0.85);
    opacity: 0.6;
  }
  45% {
    transform: scale(1.15);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.pink-mode-icon-pop {
  animation: pink-mode-icon-pop 420ms ease-out;
  transform-origin: center;
  will-change: transform;
}

.pink-mode-animation-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  overflow: visible;
}

.pink-mode-animation-instance {
  position: absolute;
  top: var(--pink-mode-animation-y, 50%);
  left: var(--pink-mode-animation-x, 50%);
  width: var(--pink-mode-animation-size, 72px);
  height: var(--pink-mode-animation-size, 72px);
  margin-top: calc(-0.5 * var(--pink-mode-animation-size, 72px));
  margin-left: calc(-0.5 * var(--pink-mode-animation-size, 72px));
  opacity: 0;
  animation: pink-mode-floating-icon var(--pink-mode-animation-duration, 7s) ease-in-out forwards;
  transform-origin: center;
  will-change: transform, opacity;
  filter: drop-shadow(0 4px 12px rgba(255, 105, 180, 0.25));
}

.pink-mode-animation-instance svg {
  width: 100%;
  height: 100%;
  display: block;
}

@keyframes pink-mode-floating-icon {
  0% {
    opacity: 0;
    transform: translate3d(0, 12%, 0) scale(0.75);
  }

  18% {
    opacity: 0.9;
    transform: translate3d(0, 0, 0) scale(1);
  }

  82% {
    opacity: 0.9;
    transform: translate3d(0, -4%, 0) scale(1.05);
  }

  100% {
    opacity: 0;
    transform: translate3d(0, -14%, 0) scale(0.85);
  }
}

@media (prefers-reduced-motion: reduce) {
  .pink-mode-icon-pop {
    animation: none;
  }

  .pink-mode-animation-layer {
    display: none !important;
  }
}

#helpSearchClear .icon-glyph,
.clear-input-btn .icon-glyph,
.controls button .icon-glyph {
  --icon-size: var(--button-icon-size);
}

.help-icon,
.btn-icon,
.legend-icon,
.connector-icon,
.info-icon,
.category-icon,
.scenario-icon,
.icon-box .icon {
  margin-inline-end: var(--icon-gap);
}

button,
.button-link,
.button-link:visited {
  gap: var(--button-icon-gap);
}

button .btn-icon,
.button-link .btn-icon {
  margin-inline-end: 0;
}

.favorite-icon.icon-glyph {
  --icon-size: calc(var(--font-size-relative-base) * var(--font-scale-md));
}

body.pink-mode button:hover,
body.pink-mode button:active,
body.pink-mode button:focus-visible,
body.pink-mode .button-link:hover,
body.pink-mode .button-link:active,
body.pink-mode .help-quick-link.active,
body.pink-mode .favorite-toggle.favorited,
body.pink-mode .favorite-toggle:hover,
body.pink-mode .favorite-toggle:active,
body.pink-mode .favorite-toggle.favorited:hover,
body.pink-mode .favorite-toggle.favorited:active {
  --icon-color: currentColor;
}

.help-icon.icon-glyph,
.btn-icon.icon-glyph,
.legend-icon.icon-glyph,
.connector-icon.icon-glyph,
.info-icon.icon-glyph,
.category-icon.icon-glyph,
.scenario-icon.icon-glyph,
.icon-box .icon.icon-glyph {
  --icon-size: var(--button-icon-size);
}

#hoverHelpTooltip {
  position: absolute;
  z-index: 1000;
  background: var(--accent-color);
  color: var(--inverse-text-color);
  padding: 4px 8px;
  border-radius: 4px;
  /* Allow icon glyphs from all local fonts to render inside hover help */
  font-family: var(--font-family), 'EssentialIconsV2', 'FilmIndustryIconsV2', 'GadgetIconsV2';
  font-size: calc(var(--font-size-base) * var(--font-scale-compact));
  pointer-events: none;
  /* Allow longer hover help descriptions */
  max-width: 320px;
  white-space: normal;
}

#hoverHelpTooltip[hidden] {
  display: none;
}

/* Force help cursor when hover help is active */
body.hover-help-active,
body.hover-help-active * {
  cursor: help !important;
}

/* Ensure selects and inputs inside wrappers match normal form fields */
.field-with-label select,
.field-with-label input {
  flex: 1;
  margin: 5px 5px 0 0;
}

/* Give wrappers the same margin so favorite stars line up with selects */
.field-with-label .select-wrapper {
  margin: 5px 5px 0 0;
}

/* Remove the default margin from selects inside wrappers */
.field-with-label .select-wrapper select {
  margin: 0;
}

/* Wrapper for selects to allow flexible layout */
.select-wrapper {
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 0; /* allow wrapper to shrink on narrow screens */
  position: relative;
}

/* Ensure selects fill the available space next to the favorite star */
.select-wrapper select {
  flex: 1;
  width: 100%;
  max-width: 100%;
}

.device-category .list-filter {
  width: 100%;
  margin-bottom: 5px;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

/* Ensure form controls use consistent styling */
input,
select,
textarea {
  padding: 4px;
  font-size: var(--form-control-font-size);
  background-color: var(--control-bg);
  color: var(--control-text);
  border: none;
  border-radius: var(--border-radius);
}

/* Match input and select heights to standard buttons */
input:not([type="checkbox"]) {
  height: var(--button-size);
}

select {
  height: var(--select-height);
}

#accentColorInput {
  flex: 0 0 auto;
  width: calc(var(--button-size) * 1.25);
  height: calc(var(--button-size) * 1.25);
  min-width: calc(var(--button-size) * 1.25);
  min-height: calc(var(--button-size) * 1.25);
  max-width: calc(var(--button-size) * 1.25);
  max-height: calc(var(--button-size) * 1.25);
  aspect-ratio: 1 / 1;
  padding: 0;
  border-radius: calc(var(--border-radius) * 1.2);
  box-shadow: 0 0 0 1px var(--panel-border);
  overflow: hidden;
}

#accentColorInput::-webkit-color-swatch-wrapper {
  padding: 0;
}

#accentColorInput::-webkit-color-swatch,
#accentColorInput::-moz-color-swatch {
  border: none;
  border-radius: inherit;
}

input[type="file"] {
  padding: 2px 4px;
  height: auto;
  min-height: var(--button-size);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  line-height: 1.2;
}

.file-input-wrapper {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.file-input-wrapper input[type="file"] {
  width: 100%;
}

.logo-preview {
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 10px;
  background-color: var(--surface-color);
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo-preview img {
  max-width: 100%;
  max-height: 120px;
}

input[type="checkbox"] {
  width: 1.1em;
  height: 1.1em;
  min-width: 1.1em;
  max-width: 1.1em;
  padding: 0;
  display: inline-grid;
  place-items: center;
  vertical-align: middle;
  cursor: pointer;
  border: 2px solid var(--control-border);
  border-radius: calc(var(--border-radius) * 0.75);
  background-color: var(--control-bg);
  color: var(--inverse-text-color);
  transition: background-color 0.2s ease, border-color 0.2s ease,
    box-shadow 0.2s ease;
  -webkit-appearance: none;
  appearance: none;
}

input[type="checkbox"]::after {
  content: '';
  width: 0.35em;
  height: 0.65em;
  border: solid transparent;
  border-width: 0 0.15em 0.15em 0;
  transform: rotate(45deg) scale(0);
  transform-origin: center;
  opacity: 0;
  transition: transform 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

input[type="checkbox"]:hover:not(:disabled) {
  border-color: var(--accent-color);
}

input[type="checkbox"]:focus-visible {
  border-color: var(--accent-color);
}

input[type="checkbox"]:not(:checked):hover:not(:disabled) {
  background-color: var(--control-hover-bg);
}

input[type="checkbox"]:checked {
  background-color: var(--control-bg);
  border-color: var(--accent-color);
}

input[type="checkbox"]:checked::after {
  border-color: var(--accent-color);
  opacity: 1;
  transform: rotate(45deg) scale(1);
}

input[type="checkbox"]:checked:hover:not(:disabled) {
  background-color: var(--control-bg);
}

@supports (color: color-mix(in srgb, #000 50%, white)) {
  input[type="checkbox"]:hover:not(:disabled),
  input[type="checkbox"]:focus-visible {
    box-shadow: none;
  }

  input[type="checkbox"]:not(:checked):hover:not(:disabled) {
    background-color: color-mix(in srgb, var(--accent-color) 12%, var(--control-bg));
  }

  input[type="checkbox"]:checked {
    background-color: var(--control-bg);
  }

  input[type="checkbox"]:checked:hover:not(:disabled) {
    background-color: var(--control-bg);
  }

  input[type="checkbox"]:checked::after {
    border-color: var(--accent-color);
  }
}

input[type="checkbox"]:disabled {
  cursor: not-allowed;
  background-color: var(--control-disabled-bg);
  border-color: var(--control-border);
  color: var(--control-text);
  box-shadow: none;
}

input[type="checkbox"]:disabled::after {
  border-color: transparent;
  opacity: 0;
  transform: rotate(45deg) scale(0);
}

input[type="checkbox"]:disabled:checked {
  background-color: var(--control-disabled-bg);
  border-color: var(--control-border);
}

input[type="checkbox"]:disabled:checked::after {
  border-color: var(--control-text);
  opacity: 1;
  transform: rotate(45deg) scale(1);
}

select {
  background-image: none;
  -webkit-appearance: none;
  appearance: none;
}

/* Ensure multi-select lists remain legible across themes, including dark mode on mobile */
select[multiple] {
  background-color: var(--control-bg);
  color: var(--control-text);
  -webkit-text-fill-color: var(--control-text);
}

select[multiple] option {
  background-color: var(--control-bg);
  color: var(--control-text);
}

select[multiple] option:hover {
  background-color: var(--control-hover-bg);
}

select[multiple] option:checked {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
}

@supports (color: color-mix(in srgb, #000 50%, white)) {
  body.light-mode:not(.high-contrast) #projectDialog select[multiple] option:checked {
    background-color: color-mix(in srgb, var(--accent-color) 35%, white);
    color: var(--accent-color);
  }
}

html.high-contrast select[multiple] option:checked,
body.high-contrast select[multiple] option:checked {
  color: #000;
}

input:hover,
select:hover,
textarea:hover {
  background-color: var(--control-hover-bg);
}

input:active,
select:active,
textarea:active {
  background-color: var(--control-active-bg);
}

input:disabled,
select:disabled,
textarea:disabled {
  background-color: var(--control-disabled-bg);
  cursor: not-allowed;
}

.clear-input-btn {
  margin-left: 4px;
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: var(--font-size-relative-base);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: var(--button-size);
  height: var(--button-size);
  padding: 0;
  line-height: 1;
  border-radius: var(--border-radius);
  color: inherit;
}

.clear-input-btn:hover {
  color: var(--accent-color);
}

.favorite-toggle {
  margin: 0 0 0 4px;
  padding: 0;
  width: var(--button-size);
  height: var(--button-size);
  background-color: var(--control-bg);
  border-radius: var(--border-radius);
  border: none;
  outline: none;
  cursor: pointer;
  font-size: var(--font-size-base);
  color: var(--favorite-inactive-color);
  --icon-color: currentColor;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
}
.favorite-toggle:disabled {
  background-color: var(--control-bg);
  color: var(--muted-text-color);
  cursor: not-allowed;
  opacity: 0.7;
}
.favorite-toggle:hover {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
  transform: translateY(-2px);
}
.favorite-toggle:active {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
  filter: brightness(0.9);
  transform: translateY(0);
}
.favorite-toggle.favorited {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
}
.favorite-toggle.favorited:hover,
.favorite-toggle.favorited:active {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
}

#setup-config .form-row:first-of-type {
  clear: both;
}

/* Specific style for setup controls */
#setupSelect,
#setupName {
  flex: 1; /* Allow them to grow */
}

/* FIZ group fieldset */
fieldset {
  border: 1px solid var(--accent-color);
  border-radius: var(--border-radius);
  padding: 10px;
  margin-top: 1em;
  width: 100%;
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
}
legend {
  font-weight: var(--font-weight-medium);
  color: var(--accent-color);
  padding: 0 5px;
}

/* Sections */
section {
  background-color: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: var(--section-padding);
  margin-top: var(--section-margin-block-start);
  box-shadow: var(--panel-shadow);
  transition: transform 0.2s;
}

section:hover {
  box-shadow: var(--panel-shadow-hover);
  transform: translateY(-2px);
}

/* All Buttons */
button {
  background-color: var(--control-bg);
  color: var(--control-text);
  border: none;
  border-radius: var(--border-radius);
  padding: var(--button-padding-block) var(--button-padding-inline);
  margin: var(--button-margin-block-start) var(--button-margin-inline)
    var(--button-margin-block-end);
  cursor: pointer;
  font-size: var(--form-control-font-size);
  min-height: var(--button-size);
  height: auto;
  /* Keep single-line buttons consistent in every locale without preventing wrapping */
  line-height: var(--button-line-height);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition:
    background-color 0.2s,
    color 0.2s,
    transform 0.2s;
}

.share-import-group button {
  margin: 0;
  flex: 1 1 100%;
  width: 100%;
  align-self: center;
}
.share-import-group #applySharedLinkBtn {
  flex: 0 0 auto;
  width: auto;
  align-self: center;
}
button:hover {
  background-color: var(--control-hover-bg);
  color: var(--control-text);
}
button:active {
  background-color: var(--control-active-bg);
  color: var(--control-text);
}
button:disabled {
  background-color: var(--control-disabled-bg);
  cursor: not-allowed;
}

body:not(.dark-mode) button .btn-icon.icon-glyph,
body:not(.dark-mode) .button-link .btn-icon.icon-glyph {
  --icon-color: var(--accent-color);
}

body:not(.dark-mode) button:hover .btn-icon.icon-glyph,
body:not(.dark-mode) button:active .btn-icon.icon-glyph,
body:not(.dark-mode) button:focus-visible .btn-icon.icon-glyph,
body:not(.dark-mode) button:disabled .btn-icon.icon-glyph,
body:not(.dark-mode) .button-link:hover .btn-icon.icon-glyph,
body:not(.dark-mode) .button-link:active .btn-icon.icon-glyph,
body:not(.dark-mode) .button-link:focus-visible .btn-icon.icon-glyph,
body:not(.dark-mode) .button-link[aria-disabled='true'] .btn-icon.icon-glyph {
  --icon-color: currentColor;
}

/* Style file input buttons to match standard buttons */
input[type="file"]::file-selector-button,
input[type="file"]::-webkit-file-upload-button {
  background-color: var(--control-bg);
  color: var(--control-text);
  border: none;
  border-radius: var(--border-radius);
  padding: var(--button-padding-block) var(--button-padding-inline);
  margin-inline-end: var(--spacing-sm);
  cursor: pointer;
  font-size: var(--form-control-font-size);
  height: 100%;
  min-height: var(--button-size);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s, color 0.2s, transform 0.2s;
}

input[type="file"]::file-selector-button:hover,
input[type="file"]::-webkit-file-upload-button:hover {
  background-color: var(--control-hover-bg);
  color: var(--control-text);
}

input[type="file"]::file-selector-button:active,
input[type="file"]::-webkit-file-upload-button:active {
  background-color: var(--control-active-bg);
  color: var(--control-text);
}

input[type="file"]:disabled::file-selector-button,
input[type="file"]:disabled::-webkit-file-upload-button {
  background-color: var(--control-disabled-bg);
  cursor: not-allowed;
}


/* Device Manager specific styles */
.device-list-container {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-top: 15px;
  max-width: 100%;
  overflow-x: auto;
}

.device-category {
  flex: 1 1 calc(33% - 15px); /* Three columns, adjust as needed */
  min-width: 250px; /* Minimum width for each column */
  background-color: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 10px;
  box-shadow: var(--panel-shadow);
  transition: transform 0.2s;
  box-sizing: border-box;
}

.device-category:hover {
  box-shadow: var(--panel-shadow-hover);
  transform: translateY(-2px);
}

@media (max-width: 900px) {
  .device-category {
    flex: 1 1 calc(50% - 15px);
  }
}

.device-category h4 {
  font-family: var(--font-family);
  font-weight: var(--font-weight-regular);
  color: var(--accent-color);
  margin-top: 0;
  margin-bottom: 10px;
  border-bottom: 1px solid var(--divider-color);
  padding-bottom: 5px;
}

.device-ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.device-ul li {
  border-bottom: 1px dashed var(--divider-color);
  padding: 5px 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

.device-summary {
  display: flex;
  justify-content: space-between;
  align-items: flex-start; /* keep buttons a constant height */
}

.detail-toggle {
  margin: 0 5px 0 0;
  background: none;
  border: 2px solid transparent;
  padding: 0;
  cursor: pointer;
}

.detail-toggle:focus,
.detail-toggle[aria-expanded="true"] {
  border-color: var(--accent-color);
}

.device-details {
  margin-left: 20px;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
}

/* Arrange top-level device details in two columns */
.device-details > .device-detail-list {
  column-count: 2;
  column-gap: 20px;
}


.device-detail-list {
  list-style: none;
  padding-left: 0;
  margin: 3px 0;
}

.device-detail-list ul {
  margin-left: 15px;
  list-style: none;
  padding-left: 0;
}

.device-detail-list li {
  margin: 2px 0;
  break-inside: avoid;
}

.device-detail-list strong {
  margin-right: 4px;
}

.device-ul li:last-child {
  border-bottom: none;
}

.device-summary span {
  flex-grow: 1;
  margin-right: 10px;
}


/* Top bar */
#topBar {
  position: sticky;
  top: var(--top-bar-offset, 0);
  padding: 5px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  background: linear-gradient(to bottom, var(--surface-color), var(--panel-bg));
  border-bottom: 1px solid var(--panel-border);
  box-shadow: var(--panel-shadow);
  z-index: 100;
}

#topBar h1 {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxl));
  margin: 0;
  font-weight: var(--font-weight-light);
}

#topBar .branding {
  display: flex;
  align-items: center;
  gap: 10px;
  color: inherit;
  text-decoration: none;
}

#topBar .branding:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
  border-radius: 6px;
}

#topBar #logo {
  width: 32px;
  height: 32px;
}

body.pink-mode #topBar #logo .logo-center {
  fill: var(--logo-center-color) !important;
}

#topBar .feature-search {
  flex: 1;
}

/* Search and control group styling */
.feature-search {
  display: flex;
  justify-content: center;
}

#sideMenu .feature-search {
  justify-content: flex-start;
  margin-bottom: 20px;
}

.controls {
  display: flex;
  gap: 5px;
  align-items: center;
  flex-wrap: wrap;
}

#sideMenu .controls {
  margin-bottom: 20px;
  flex-wrap: nowrap;
}

#sideMenu .controls select {
  flex: 1 1 auto;
  min-width: 0;
  margin-bottom: 0;
}

#sideMenu .controls button {
  flex: 0 0 var(--button-size);
}

#featureSearchContainer {
  width: 100%;
  max-width: 300px;
}

#featureSearch {
  width: 100%;
  max-width: 300px;
  padding: 2px 10px 2px 6px;
  height: var(--button-size);
}

.controls select {
  height: var(--select-height);
  margin: 0;
  font-size: var(--font-size-relative-base);
  padding: 2px 4px;
  text-align: center;
  text-align-last: center;
}

.controls button {
  height: var(--button-size);
  margin: 0;
  min-width: var(--button-size);
  width: var(--button-size);
  padding: 0;
  border-radius: 50%;
}

.controls button:hover {
  background-color: var(--control-hover-bg);
  color: var(--control-text);
}
.controls button:active {
  background-color: var(--control-active-bg);
  color: var(--control-text);
}

body.light-mode #topBar .controls button {
  color: var(--accent-color);
  --icon-color: currentColor;
}

body.light-mode #topBar .controls button:hover,
body.light-mode #topBar .controls button:active {
  color: var(--accent-color);
}

body.light-mode #topBar .controls button:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

body.light-mode #topBar select {
  color: var(--accent-color);
  font-weight: var(--font-weight-medium);
}

body.light-mode #topBar select:hover,
body.light-mode #topBar select:focus {
  color: var(--accent-color);
}

body.light-mode #topBar select:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

@supports (padding: env(safe-area-inset-top)) {
  #topBar {
    padding:
      calc(5px + env(safe-area-inset-top))
      calc(20px + env(safe-area-inset-right))
      5px
      calc(20px + env(safe-area-inset-left));
  }
}

#helpButton {
  padding: 0 4px;
  font-size: var(--font-size-relative-base);
}

#helpButton .icon-text {
  font-weight: var(--font-weight-light);
}

/* Breakdown list */
#breakdownList {
  list-style: none;
  margin: 5px 0;
  padding-left: 0;
}
#breakdownList li {
  margin: 6px 0;
  line-height: 1.6;
}

/* Power diagram */
#powerDiagram,
.power-diagram {
  max-width: 300px;
  margin: 10px 0;
}

.power-bar {
  position: relative;
  display: flex;
  height: 20px;
  border: 1px solid var(--border-strong-color);
  overflow: visible;
}

.power-bar .segment {
  position: relative;
  z-index: 1;
  height: 100%;
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--inverse-text-color);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  overflow: hidden;
}

.power-bar .segment span {
  position: relative;
  z-index: 3;
  padding: 0 2px;
}

.power-bar .camera { background-color: var(--camera-color); }
.power-bar .monitor { background-color: var(--monitor-color); }
.power-bar .video { background-color: var(--video-segment-color); }
.power-bar .motors { background-color: var(--motor-color); }
.power-bar .controllers { background-color: var(--controller-color); }
.power-bar .distance { background-color: var(--distance-color); }

.power-bar .over-usage {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  background: var(--danger-overlay-color);
  z-index: 2;
  pointer-events: none;
}


.power-bar .limit-line {
  position: absolute;
  top: -4px;
  bottom: -4px;
  width: 2px;
  background: var(--danger-color);
  z-index: 4;
  overflow: visible;
}

.power-bar .limit-line .limit-label {
  position: absolute;
  top: -1.2em;
  left: 50%;
  transform: translateX(-50%);
  background: none;
  color: var(--danger-color);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  padding: 0 2px;
  white-space: nowrap;
}

#powerDiagram.over .power-bar,
.power-diagram.over .power-bar {
  border-color: var(--danger-color);
}


#maxPowerText,
.power-diagram-note {
  margin-top: 4px;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

/* Project diagram */
#setupDiagram {
  text-align: center;
  min-height: 440px;
  padding-top: 1em; /* prevent heading overlap */
}

#diagramArea {
  margin: 0.5em auto 0;
  position: relative;
  display: block;
  width: min(90%, var(--diagram-max-width, 100%));
  max-width: var(--diagram-max-width, 100%);
  text-align: left;
}

#diagramArea > * {
  flex: 0 0 auto;
}

#diagramArea > svg,
#diagramArea > canvas {
  margin-inline: auto;
  width: 100%;
  max-width: 100%;
  display: block;
}

#diagramArea .diagram-placeholder {
  text-align: center;
  width: 100%;
}

#diagramArea.grid-snap {
  background-size: 20px 20px;
  background-image: linear-gradient(var(--diagram-gridline-color) 1px, transparent 1px),
                    linear-gradient(90deg, var(--diagram-gridline-color) 1px, transparent 1px);
}

#diagramLegend {
  margin-top: 0.25em;
  font-size: var(--font-size-diagram-text);
}
#diagramLegend span {
  margin: 0 6px;
  display: inline-flex;
  align-items: center;
}
#diagramLegend .swatch {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 4px;
  display: inline-block;
}
#diagramLegend .power { background: var(--power-color); }
#diagramLegend .video { background: var(--video-color); }
#diagramLegend .fiz { background: var(--fiz-color); }

#powerDiagramLegend,
.power-diagram-legend {
  margin-top: 0.25em;
  font-size: var(--font-size-diagram-text);
}
#powerDiagramLegend span,
.power-diagram-legend span {
  margin: 0 6px;
  display: inline-flex;
  align-items: center;
}
#powerDiagramLegend .swatch,
.power-diagram-legend .swatch {
  width: 12px;
  height: 12px;
  border-radius: 2px;
  margin-right: 4px;
  display: inline-block;
}
#powerDiagramLegend .camera,
.power-diagram-legend .camera { background-color: var(--camera-color); }
#powerDiagramLegend .monitor,
.power-diagram-legend .monitor { background-color: var(--monitor-color); }
#powerDiagramLegend .video,
.power-diagram-legend .video { background-color: var(--video-segment-color); }
#powerDiagramLegend .motors,
.power-diagram-legend .motors { background-color: var(--motor-color); }
#powerDiagramLegend .controllers,
.power-diagram-legend .controllers { background-color: var(--controller-color); }
#powerDiagramLegend .distance,
.power-diagram-legend .distance { background-color: var(--distance-color); }

.diagram-controls {
  margin-top: 0.5em;
  display: flex;
  justify-content: center;
  gap: 0.5em;
  flex-wrap: wrap;
}

.diagram-controls button {
  min-width: var(--button-size);
  min-height: var(--button-size);
  height: auto;
}

.diagram-controls button.active {
  background: var(--diagram-button-active-bg);
}

@media (max-width: 600px) {
  .diagram-controls {
    display: grid;
    grid-template-columns: repeat(2, minmax(var(--button-size), 1fr));
    justify-content: center;
  }

  .diagram-controls button {
    min-width: 0;
  }

  .diagram-controls #zoomOut,
  .diagram-controls #zoomIn {
    width: var(--button-size);
    justify-self: center;
  }

  .diagram-controls #resetView,
  .diagram-controls #gridSnapToggle {
    justify-self: stretch;
    white-space: nowrap;
  }
}

#diagramHint {
  margin-top: 0.25em;
  font-size: var(--font-size-diagram-text);
  color: var(--muted-text-color);
}


.diagram-popup {
  display: none;
  position: absolute;
  pointer-events: none;
  background: var(--surface-color);
  color: var(--text-color);
  border: 1px solid var(--panel-border);
  font-size: var(--font-size-relative-base);
  line-height: var(--line-height-supporting);
  padding: clamp(0.5rem, 1vw, 0.75rem);
  border-radius: var(--border-radius);
  box-shadow: var(--panel-shadow);
  z-index: 10;
  max-width: 320px;
  overflow: auto;
}


/* Device info lists inside diagram popups */
.connector-summary {
  margin-top: 4px;
  display: flex;
  flex-wrap: wrap;
}

.scenario-summary,
.icon-box-summary {
    margin-top: 4px;
    display: flex;
    flex-wrap: wrap;
    width: 100%;
}

.connector-block,
.info-box {
  display: inline-flex;
  align-items: center;
  flex-wrap: wrap;
  padding: 2px 6px;
  margin: 2px;
  border-radius: 3px;
  border: 1px solid;
  background-color: transparent;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
}

.info-box-list {
  gap: 4px;
  flex-wrap: nowrap;
}

.info-box-label {
  font-weight: var(--font-weight-bold);
  margin-right: 2px;
  color: var(--connector-label-neutral-color);
}

.info-box strong:first-child {
  color: var(--connector-label-neutral-color);
}

.power-conn .info-box-label,
.info-box.power-conn strong:first-child {
  color: var(--power-color);
}

.video-conn .info-box-label,
.info-box.video-conn strong:first-child {
  color: var(--video-color);
}

.fiz-conn .info-box-label,
.info-box.fiz-conn strong:first-child {
  color: var(--fiz-color);
}

.neutral-conn .info-box-label,
.info-box.neutral-conn strong:first-child {
  color: var(--connector-label-neutral-color);
}

.info-box-list .info-box-label {
  flex: 0 0 auto;
}

.info-box-list .info-box-values {
  flex: 1 1 auto;
  min-width: 0;
  white-space: normal;
  overflow-wrap: anywhere;
}

.scenario-box,
.icon-box {
  display: flex;
  align-items: center;
  padding: 2px 6px;
  margin: 2px;
  border-radius: 3px;
  border: 1px solid;
  background-color: transparent;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
}

.scenario-box .scenario-icon,
.icon-box .icon {
  margin-right: 4px;
}

.tray-box {
  margin-top: 4px;
  padding: 4px;
  border-radius: 3px;
  background: transparent;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
}

.lens-mount-box {
  display: flex;
  flex-wrap: wrap;
}

.info-label {
  width: 100%;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxs));
  font-weight: var(--font-weight-bold);
  margin: 4px 2px 0;
}

.port-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 4px;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-compact));
}
.port-table th {
  text-align: left;
  padding: 2px 6px 2px 0;
  white-space: nowrap;
}
.port-table td {
  padding: 2px 0;
}

.port-table .power-row th,
.port-table .power-row td {
  color: var(--power-color);
}

.port-table .fiz-row th,
.port-table .fiz-row td {
  color: var(--fiz-color);
}

.port-table .video-row th,
.port-table .video-row td {
  color: var(--video-color);
}

.power-conn {
  border-color: var(--power-color);
  background-color: transparent;
  --icon-color: var(--power-color);
}
.fiz-conn {
  border-color: var(--fiz-color);
  background-color: transparent;
  --icon-color: var(--fiz-color);
}
.video-conn {
  border-color: var(--video-color);
  background-color: transparent;
  --icon-color: var(--video-color);
}
.neutral-conn {
  border-color: var(--neutral-color);
  background-color: transparent;
  --icon-color: var(--neutral-color);
}


.device-data { margin-left: 10px; }
.device-data ul { list-style: disc; margin-left: 20px; }

#setupDiagram svg {
  width: 100%;
  height: auto;
  touch-action: none;
}

#setupDiagram .node-box {
  fill: var(--diagram-node-fill);
  stroke: none;
}
#setupDiagram .node-box.first-fiz {
  stroke: none;
}

#setupDiagram .first-fiz-highlight {
  stroke: url(#firstFizGrad);
  stroke-width: 1px;
  fill: none;
}

#setupDiagram .node-icon {
  font-size: var(--font-size-diagram-icon);
  font-family: 'UiconsThinStraightV2', system-ui, sans-serif;
  font-style: normal;
  color: var(--accent-color);
  fill: var(--accent-color);
}
#setupDiagram .node-icon[data-icon-font='essential'] {
  font-family: 'EssentialIconsV2', system-ui, sans-serif;
}
#setupDiagram .node-icon[data-icon-font='text'] {
  font-family: 'Ubuntu', system-ui, sans-serif;
  font-weight: var(--font-weight-medium);
}
#setupDiagram .conn {
  stroke: none;
}
#setupDiagram .conn.red { fill: var(--power-color); }
#setupDiagram .conn.blue { fill: var(--video-color); }
#setupDiagram .conn.green { fill: var(--fiz-color); }

#setupDiagram .edge-label {
  font-size: var(--font-size-diagram-label);
  dominant-baseline: middle;
}

#setupDiagram line {
  stroke: var(--control-text);
  stroke-width: 2px;
}

#setupDiagram path.edge-path {
  stroke-width: 2px;
  fill: none;
}
#setupDiagram path.edge-path:not(.power):not(.video):not(.fiz) {
  stroke: var(--control-text);
}
#setupDiagram path.power {
  stroke: var(--power-color);
}
#setupDiagram path.video {
  stroke: var(--video-color);
}
#setupDiagram path.fiz {
  stroke: var(--fiz-color);
}

#setupDiagram .diagram-placeholder {
  font-style: italic;
  color: #666;
  margin: 0;
}


/* Temperature note table */
#temperatureNote {
  margin-top: 1em;
  overflow-x: auto;
}

#temperatureNote table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.5em;
  min-width: 260px;
}

#temperatureNote th,
#temperatureNote td {
  padding: 6px 8px;
  text-align: center;
  border: 1px solid var(--panel-border);
  font-variant-numeric: tabular-nums;
}

#temperatureNote th {
  font-weight: var(--font-weight-bold);
  background-color: var(--surface-color);
}

#temperatureNote td {
  font-weight: var(--font-weight-light);
}

body:not(.light-mode) #temperatureNote th,
body:not(.light-mode) #temperatureNote td {
  border-color: var(--border-strong-color);
}

body:not(.light-mode) #temperatureNote th {
  background-color: var(--panel-bg);
}

/* Battery comparison section */
.battery-comparison-section {
  background: var(--panel-bg); /* Match section background */
  padding: 15px; /* Match section padding */
  margin-top: 1em; /* Match section margin */
  border: 1px solid var(--panel-border); /* Match section border */
  border-radius: var(--border-radius); /* Match section border-radius */
  box-shadow: var(--panel-shadow);
  transition: transform 0.2s;
}

.battery-comparison-section:hover {
  box-shadow: var(--panel-shadow-hover);
  transform: translateY(-2px);
}
.battery-table-container {
  overflow-x: auto;
}
.battery-comparison-section table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 5px;
}
.battery-comparison-section th,
.battery-comparison-section td {
  border: 1px solid var(--panel-border);
  padding: 8px;
  text-align: left;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}
.battery-comparison-section th:nth-child(1),
.battery-comparison-section td:nth-child(1) {
  width: 30%; /* Battery Name */
}

.battery-comparison-section th:nth-child(2),
.battery-comparison-section td:nth-child(2) {
  width: 25%; /* Estimated Runtime */
}

.battery-comparison-section th:nth-child(3),
.battery-comparison-section td:nth-child(3) {
  width: 45%; /* Bar column, takes remaining space */
}

.battery-comparison-section th {
  background-color: var(--surface-color);
}

/* User runtime feedback table */
#feedbackTableContainer {
  overflow-x: auto;
  max-width: 100%;
  margin-top: 1em;
}

#userFeedbackTable {
  width: auto; /* Allow the table to size to its content by default */
  width: fit-content; /* Prevent stretching across the full viewport on wide screens */
  max-width: 100%;
  border-collapse: collapse;
}

#userFeedbackTable th,
#userFeedbackTable td {
  border: 1px solid var(--panel-border);
  padding: 6px;
  white-space: nowrap;
  text-align: left;
}

#userFeedbackTable th {
  background-color: var(--surface-color);
}

body:not(.light-mode) #userFeedbackTable th {
  background-color: var(--panel-bg);
}

body:not(.light-mode) #userFeedbackTable th,
body:not(.light-mode) #userFeedbackTable td {
  border-color: var(--border-strong-color);
}

/* Accent handling for feedback table */
body.light-mode #userFeedbackTable th,
body.light-mode #userFeedbackTable td,
body.pink-mode #userFeedbackTable th,
body.pink-mode #userFeedbackTable td {
  border-color: var(--accent-color);
}
body.light-mode #userFeedbackTable th,
body.pink-mode #userFeedbackTable th {
  background-color: var(--accent-color);
  color: var(--inverse-text-color);
}

/* Battery comparison bars */
.barContainer {
  width: 100%;
  background-color: var(--surface-color);
  border-radius: 3px;
  overflow: hidden;
  height: 15px; /* Height of the bar */
}

.bar {
  height: 100%;
  background-color: var(--success-color);
  width: 0%; /* Will be set by JS */
  border-radius: 3px;
  transition: width 0.5s ease-out; /* Smooth transition for bar growth */
}

.bar-pins-only {
  background-color: var(--warning-color);
}

/* Runtime weighting */
.weightingRow {
  display: flex;
  align-items: center;
}
.weightBar {
  height: 100%;
  background-color: var(--info-color);
  border-radius: 3px;
  transition: width 0.5s ease-out;
}

.weightingPercent {
  margin-left: 0.5em;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
}

.selectedBatteryRow {
    background-color: var(--selected-row-bg); /* Light blue background for selected row */
    font-weight: var(--font-weight-bold);
}

html.dark-mode,
.dark-mode {
  color-scheme: dark light;
  --background-color: #1c1c1e;
  --surface-color: #1c1c1e;
  --text-color: #f0f0f0;
  --control-bg: #2c2c2f;
  --control-text: #f0f0f0;
  --control-border: #444;
  --control-hover-bg: #3a3a3d;
  --control-active-bg: #4a4a4d;
  --control-disabled-bg: #333;
  --panel-bg: #1c1c1e;
  --panel-border: #333;
  --panel-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  --panel-shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.5);
  --link-color: var(--inverse-text-color);
  --muted-text-color: #bbb;
  --border-strong-color: #555;
  --divider-color: #444;
  --diagram-gridline-color: #444;
  --diagram-button-active-bg: #3a3a3d;
  --warning-text-color: #000000;
  --danger-color: #ff6666;
  --danger-overlay-color: rgba(255, 102, 102, 0.4);
  --success-color: #66bb6a;
  --info-color: #7ec8ff;
  --neutral-color: #bbbbbb;
  --status-error-bg: rgba(255, 120, 120, 0.45);
  --status-warning-bg: rgba(255, 107, 107, 0.65);
  --status-success-bg: rgba(102, 187, 106, 0.2);
  --status-border-color: #444;
  --status-error-text-color: #ffffff;
  --status-warning-text-color: #ffffff;
  --status-success-text-color: #f0f0f0;
  --diagram-node-fill: #444;
  --power-color: #ff6666;
  --video-color: #7ec8ff;
  --fiz-color: #6f6;
  --camera-color: #66bb6a;
  --monitor-color: #7ec8ff;
  --video-segment-color: #ffd54f;
  --motor-color: #ce93d8;
  --controller-color: #ff8a65;
  --distance-color: #a1887f;
  --selected-row-bg: #003366;
  --power-conn-bg: rgba(255, 102, 102, 0.3);
  --fiz-conn-bg: rgba(102, 187, 106, 0.3);
  --video-conn-bg: rgba(126, 200, 255, 0.3);
  --neutral-conn-bg: rgba(187, 187, 187, 0.3);
  --connector-label-neutral-color: var(--text-color);
}

html.high-contrast,
body.high-contrast {
  --accent-color: #fff;
  --background-color: #000;
  --surface-color: #000;
  --text-color: #fff;
  --control-bg: #000;
  --control-text: #fff;
  --control-border: #fff;
  --panel-bg: #000;
  --panel-border: #fff;
  --link-color: #0ff;
  --muted-text-color: #fff;
  --border-strong-color: #fff;
  --divider-color: #fff;
  --diagram-gridline-color: #fff;
  --diagram-button-active-bg: #444;
  --warning-color: #ff0;
  --warning-text-color: #000;
  --danger-color: #f00;
  --danger-overlay-color: rgba(255, 0, 0, 0.5);
  --success-color: #0f0;
  --info-color: #0ff;
  --neutral-color: #fff;
  --status-error-bg: #f00;
  --status-warning-bg: #ff0;
  --status-success-bg: #0f0;
  --status-border-color: #fff;
  --status-error-text-color: #000;
  --status-warning-text-color: #000;
  --status-success-text-color: #000;
  --diagram-node-fill: #fff;
  --power-color: #f00;
  --video-color: #0ff;
  --fiz-color: #0f0;
  --camera-color: #0f0;
  --monitor-color: #0ff;
  --video-segment-color: #ff0;
  --motor-color: #f0f;
  --controller-color: #fff;
  --distance-color: #ff8800;
  --power-conn-bg: rgba(255, 0, 0, 0.5);
  --fiz-conn-bg: rgba(0, 255, 0, 0.5);
  --video-conn-bg: rgba(0, 255, 255, 0.5);
  --neutral-conn-bg: rgba(255, 255, 255, 0.5);
  --connector-label-neutral-color: #ffffff;
  --selected-row-bg: #fff;
}

html.high-contrast.pink-mode,
body.high-contrast.pink-mode {
  --accent-color: #ff69b4;
  --link-color: #ff69b4;
  --icon-color: var(--accent-color);
  --logo-accent-color: #f255a8;
  --logo-background-color: #f255a8;
  --logo-center-color: #ffffff;
}

html.dark-mode,
body.dark-mode {
  background-color: var(--background-color);
  color: var(--text-color);
  --auto-gear-highlight-bg: rgba(255, 196, 0, 0.28);
  --auto-gear-highlight-border: rgba(255, 208, 0, 0.72);
  --auto-gear-highlight-text: var(--inverse-text-color);
}

.dark-mode h1,
.dark-mode h2,
.dark-mode h3 {
  color: var(--inverse-text-color);
}
.dark-mode h2 {
  border-bottom: 1px solid var(--inverse-text-color);
}
body.dark-mode.pink-mode h1,
body.dark-mode.pink-mode h2,
body.dark-mode.pink-mode h3,
body.dark-mode.dark-accent-boost:not(.pink-mode) h1,
body.dark-mode.dark-accent-boost:not(.pink-mode) h2,
body.dark-mode.dark-accent-boost:not(.pink-mode) h3 {
  color: var(--accent-color);
}
body.dark-mode.pink-mode h2,
body.dark-mode.dark-accent-boost:not(.pink-mode) h2 {
  border-bottom: 1px solid var(--accent-color);
}

body.dark-mode.pink-mode {
  --link-color: var(--inverse-text-color);
}
.dark-mode section,
.dark-mode .device-category,
.dark-mode .battery-comparison-section {
  background-color: var(--panel-bg);
  border-color: var(--panel-border);
  box-shadow: var(--panel-shadow);
}
.dark-mode fieldset { border-color: var(--inverse-text-color); }
.dark-mode legend { color: var(--inverse-text-color); }
.dark-mode .battery-comparison-section th { background-color: var(--control-bg); }
.dark-mode .barContainer { background-color: var(--panel-bg); }
.dark-mode .device-category h4 { color: var(--inverse-text-color); border-bottom: 1px solid var(--inverse-text-color); }
.dark-mode .connector-block,
.dark-mode .info-box { background-color: transparent; }
.dark-mode .scenario-box { background-color: transparent; }
.dark-mode .tray-box { background-color: transparent; }
.dark-mode #setupDiagram .first-fiz-highlight { stroke: url(#firstFizGrad); }
.dark-mode #setupDiagram text { fill: var(--inverse-text-color); }
.dark-mode #setupDiagram line { stroke: var(--inverse-text-color); }
.dark-mode #setupDiagram path.edge-path:not(.power):not(.video):not(.fiz) { stroke: var(--inverse-text-color); }
.dark-mode #setupDiagram marker polygon { fill: var(--inverse-text-color); }
.dark-mode #setupDiagram .diagram-placeholder { color: #bbb; }
.dark-mode .help-content.modal-surface,
.dark-mode .settings-content.modal-surface {
  border-color: var(--control-border);
}
body.dark-mode.pink-mode .help-content,
body.dark-mode.pink-mode .settings-content.modal-surface,
body.dark-mode.dark-accent-boost:not(.pink-mode) .help-content,
body.dark-mode.dark-accent-boost:not(.pink-mode) .settings-content.modal-surface {
  border-color: var(--control-border);
}

@media (prefers-color-scheme: dark) {
  html:not(.light-mode),
  body:not(.light-mode) {
    --background-color: #1c1c1e;
    --surface-color: #1c1c1e;
    --text-color: #f0f0f0;
    --control-bg: #2c2c2f;
    --control-text: #f0f0f0;
    --control-border: #444;
    --control-hover-bg: #3a3a3d;
    --control-active-bg: #4a4a4d;
    --control-disabled-bg: #333;
    --panel-bg: #1c1c1e;
    --panel-border: #333;
    --panel-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    --panel-shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.5);
    --link-color: #7ec8ff;
    --muted-text-color: #bbb;
    --border-strong-color: #555;
    --divider-color: #444;
    --diagram-gridline-color: #444;
    --diagram-button-active-bg: #3a3a3d;
    --warning-text-color: #000000;
    --danger-color: #ff6666;
    --danger-overlay-color: rgba(255, 102, 102, 0.4);
    --success-color: #66bb6a;
    --info-color: #7ec8ff;
    --neutral-color: #bbbbbb;
    --status-error-bg: rgba(255, 120, 120, 0.45);
    --status-warning-bg: rgba(255, 107, 107, 0.65);
    --status-success-bg: rgba(102, 187, 106, 0.2);
    --status-border-color: #444;
    --status-error-text-color: #ffffff;
    --status-warning-text-color: #ffffff;
    --status-success-text-color: #f0f0f0;
    --favorite-inactive-color: var(--control-text);
    --diagram-node-fill: #444;
    --power-color: #ff6666;
    --video-color: #7ec8ff;
    --fiz-color: #6f6;
    --camera-color: #66bb6a;
    --monitor-color: #7ec8ff;
    --video-segment-color: #ffd54f;
    --motor-color: #ce93d8;
    --controller-color: #ff8a65;
    --distance-color: #a1887f;
    --selected-row-bg: #003366;
    --power-conn-bg: rgba(255, 102, 102, 0.3);
    --fiz-conn-bg: rgba(102, 187, 106, 0.3);
    --video-conn-bg: rgba(126, 200, 255, 0.3);
    --neutral-conn-bg: rgba(187, 187, 187, 0.3);
    background-color: var(--background-color);
    color: var(--text-color);
  }
  body:not(.light-mode) h1,
  body:not(.light-mode) h2,
  body:not(.light-mode) h3 {
    color: var(--inverse-text-color);
  }
  body:not(.light-mode) h2 {
    border-bottom: 1px solid var(--inverse-text-color);
  }
  body:not(.light-mode).pink-mode h1,
  body:not(.light-mode).pink-mode h2,
  body:not(.light-mode).pink-mode h3,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) h1,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) h2,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) h3 {
    color: var(--accent-color);
  }
  body:not(.light-mode).pink-mode h2,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) h2 {
    border-bottom: 1px solid var(--accent-color);
  }
  body:not(.light-mode) fieldset { border-color: var(--inverse-text-color); }
  body:not(.light-mode) legend { color: var(--inverse-text-color); }
  body:not(.light-mode) .battery-comparison-section th { background-color: var(--control-bg); }
  body:not(.light-mode) .barContainer { background-color: var(--panel-bg); }
  body:not(.light-mode) .device-category h4 { color: var(--inverse-text-color); border-bottom: 1px solid var(--inverse-text-color); }
  body:not(.light-mode) .connector-block,
  body:not(.light-mode) .info-box { background-color: transparent; }
  body:not(.light-mode) .scenario-box { background-color: transparent; }
  body:not(.light-mode) .tray-box { background-color: transparent; }
  body:not(.light-mode) #setupDiagram .first-fiz-highlight { stroke: url(#firstFizGrad); }
  body:not(.light-mode) #setupDiagram text { fill: var(--inverse-text-color); }
  body:not(.light-mode) #setupDiagram line { stroke: var(--inverse-text-color); }
  body:not(.light-mode) #setupDiagram path.edge-path:not(.power):not(.video):not(.fiz) { stroke: var(--inverse-text-color); }
  body:not(.light-mode) #setupDiagram marker polygon { fill: var(--inverse-text-color); }
  body:not(.light-mode) #setupDiagram .diagram-placeholder { color: var(--muted-text-color); }
  body:not(.light-mode) .help-content,
  body:not(.light-mode) .settings-content.modal-surface {
    border-color: var(--control-border);
  }
  body:not(.light-mode) .gear-table td {
    border-top: 1px solid var(--inverse-text-color);
    border-bottom: 1px solid var(--inverse-text-color);
  }
  body:not(.light-mode) .gear-table .category-row td {
    border-top: 1px solid var(--inverse-text-color);
    border-bottom: 1px solid var(--inverse-text-color);
    color: var(--inverse-text-color);
    font-weight: var(--font-weight-medium);
  }
  body:not(.light-mode).pink-mode .gear-table td,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) .gear-table td {
    border-top: 1px solid var(--accent-color);
    border-bottom: 1px solid var(--accent-color);
  }
  body:not(.light-mode).pink-mode .gear-table .category-row td,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) .gear-table .category-row td {
    border-top: 1px solid var(--accent-color);
    border-bottom: 1px solid var(--accent-color);
    color: var(--accent-color);
    font-weight: var(--font-weight-medium);
  }
  body:not(.light-mode).pink-mode .help-content,
  body:not(.light-mode).pink-mode .settings-content.modal-surface,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) .help-content,
  body:not(.light-mode).dark-accent-boost:not(.pink-mode) .settings-content.modal-surface {
    border-color: var(--control-border);
  }
}
/* Responsive layout adjustments */
@media (max-width: 768px) {
  #featureSearch {
    max-width: 100%;
  }
  #topBar .feature-search,
  #topBar .controls {
    display: none;
  }
}

@media (min-width: 769px) {
  #sideMenu .sidebar-controls {
    display: none;
  }
}

@media (max-width: 600px) {
  body {
    margin: 10px;
    font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  }

  .controls select {
    flex: 1 1 100%;
    margin-bottom: 5px;
  }

  .controls button {
    flex: 0 0 auto;
  }

  .form-row {
    flex-direction: column;
    align-items: stretch;
  }

  .form-row label,
  .form-row .form-row-label {
    width: auto;
    min-width: auto;
    margin-bottom: 4px;
  }
  #setup-config .form-row label,
  #setup-config .form-row .form-row-label {
    line-height: var(--line-height-base);
  }
  .form-row select,
  .form-row input {
    margin: 5px 0 0 0;
  }

  .form-row .select-wrapper {
    margin: 5px 0 0 0;
  }

  .form-row .select-wrapper select {
    margin: 0;
  }

  .form-row > button {
    width: 100%;
    margin: 5px 0 0 0;
  }

  .form-row > button + button {
    margin-left: 0;
    margin-top: 5px;
  }

  .share-import-group {
    width: 100%;
    flex-direction: column;
    align-items: stretch;
  }

  .share-import-group label {
    width: 100%;
    white-space: normal;
  }

  .share-import-group button {
    width: 100%;
    align-self: stretch;
  }

  .device-list-container {
    flex-direction: column;
  }

  .device-category {
    flex: 1 1 100%;
    min-width: auto;
  }

  /* Stack device details vertically on small screens */
  .device-details > .device-detail-list {
    column-count: 1;
  }

  #setupDiagram {
    min-height: 300px;
  }

    /* Allow wrapping instead of horizontal scroll on small screens */
    #feedbackTableContainer,
    #batteryTableContainer {
      overflow-x: visible;
    }

  #userFeedbackTable th,
  #userFeedbackTable td,
  .port-table th,
  .port-table td,
  .battery-comparison-section th,
  .battery-comparison-section td {
    white-space: normal;
    overflow-wrap: anywhere;
  }
}

/* Project requirements dialog */
#projectDialog {
  border: none;
  padding: 0;
  background: transparent;
  color: inherit;
}

#projectDialog::backdrop {
  background: rgba(0, 0, 0, 0.6);
}

#projectDialog .project-dialog {
  width: min(100%, 960px);
  display: flex;
  flex-direction: column;
  gap: clamp(20px, 4vw, 28px);
  padding: clamp(20px, 4vw, 32px);
}

@media (min-width: 1024px) {
  #projectDialog .project-dialog {
    width: min(100%, 1100px);
  }
}

.project-dialog-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.project-dialog-header h2 {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxl));
  font-weight: var(--font-weight-semibold);
}

.project-dialog-close {
  border: none;
  background: transparent;
  color: inherit;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: clamp(36px, 8vw, 44px);
  height: clamp(36px, 8vw, 44px);
  border-radius: 50%;
  transition: background-color 0.2s ease, color 0.2s ease;
  cursor: pointer;
}

.project-dialog-close:hover,
.project-dialog-close:focus-visible {
  background-color: var(--control-bg);
  color: var(--control-text);
}

.project-dialog-body {
  display: flex;
  flex-direction: column;
  gap: clamp(16px, 3vw, 24px);
}

.project-dialog-section {
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  box-shadow: var(--panel-shadow);
  padding: clamp(16px, 2.5vw, 24px);
  display: flex;
  flex-direction: column;
  gap: clamp(12px, 2vw, 16px);
}

.project-section-title {
  margin: 0;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-lg));
  font-weight: var(--font-weight-semibold);
  color: var(--accent-color);
}

.project-section-content {
  display: flex;
  flex-direction: column;
  gap: clamp(10px, 2vw, 16px);
}

.project-section-content .form-row {
  margin: 0;
}

#projectDialog .form-row {
  display: grid;
  grid-template-columns: minmax(var(--form-label-min-width), var(--form-label-width)) minmax(0, 1fr);
  align-items: center;
  gap: var(--gap-size);
}

#projectDialog .form-row label,
#projectDialog .form-row .form-row-label {
  flex: initial;
  min-width: 0;
}

#projectDialog .form-row > :not(label):not(.form-row-label) {
  grid-column: 2;
  justify-self: stretch;
}

#projectDialog .form-row > button,
#projectDialog .form-row > .inline-form-button {
  justify-self: start;
}

#projectDialog select[multiple] {
  height: auto;
}

#projectDialog .form-row .select-wrapper {
  flex: 1 1 auto;
  width: 100%;
}

#projectDialog .form-row .select-wrapper select {
  flex: 1 1 auto;
  width: 100%;
}

#projectDialog #lenses {
  width: 100%;
  min-width: 0;
  height: 15rem;
  overflow-y: auto;
}

#projectDialog .lens-selector-row {
  flex-wrap: nowrap;
  align-items: flex-start;
  gap: clamp(12px, 2vw, 16px);
}

#projectDialog .lens-selector-row label {
  flex: 0 1 clamp(72px, 18vw, var(--form-label-width));
  min-width: clamp(72px, 18vw, var(--form-label-width));
  padding-top: 0.25rem;
}

#projectDialog .lens-selector {
  flex: 1 1 clamp(320px, 60vw, 640px);
  min-width: clamp(140px, 60vw, 640px);
  max-width: 100%;
}

#projectDialog .lens-selector select {
  width: 100%;
  min-height: 15rem;
}

.project-dialog-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  border-top: 1px solid var(--panel-border);
  padding-top: clamp(12px, 2vw, 16px);
}

/* Project requirement boxes */
.requirements-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 1em;
}
.requirement-box {
  flex: 1 1 150px;
  background: var(--surface-color);
  border: 1px solid var(--panel-border);
  border-radius: 8px;
  text-align: center;
  padding: 10px;
  box-shadow: var(--panel-shadow);
  --requirement-accent-color: var(--text-color);
}
.requirement-box .req-icon {
  --req-icon-size: calc(var(--font-size-relative-base) * var(--font-scale-xxxl));
  --icon-size: var(--req-icon-size);
  font-size: var(--icon-size);
  width: var(--icon-size);
  height: var(--icon-size);
  min-width: var(--icon-size);
  min-height: var(--icon-size);
  max-width: var(--icon-size);
  max-height: var(--icon-size);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 5px;
  line-height: 1;
  flex-shrink: 0;
  color: var(--requirement-accent-color);
  --icon-color: var(--requirement-accent-color);
}

.requirement-box .req-icon svg {
  width: var(--icon-size);
  height: var(--icon-size);
  max-width: 100%;
  max-height: 100%;
  display: block;
}
.requirement-box .req-label {
  font-weight: var(--font-weight-bold);
  display: block;
  color: var(--requirement-accent-color);
}
.requirement-box .req-value {
  display: block;
  margin-top: 4px;
}

body:not(.dark-mode) .requirement-box,
#overviewDialogContent:not(.dark-mode) .requirement-box,
body:not(.dark-mode) #projectRequirementsOutput .requirement-box {
  --requirement-accent-color: var(--accent-color);
}

body.dark-mode .requirement-box,
#overviewDialogContent.dark-mode .requirement-box {
  --requirement-accent-color: var(--inverse-text-color);
}

/* Let project scenarios span the full row for clarity */
.requirement-box[data-field="requiredScenarios"] {
  flex: 1 1 100%;
}

/* Overview dialog */
#overviewDialog {
  width: min(96vw, 210mm);
  max-width: none;
  padding: 0;
  border: none;
}
#overviewDialog::backdrop {
  background: rgba(0, 0, 0, 0.5);
}
#overviewDialogContent {
  padding: 20px;
  max-height: min(92vh, 1100px);
  overflow-y: auto;
  background: var(--surface-color);
  color: var(--control-text);
  font-family: var(--font-family);
  font-weight: var(--font-weight-light);
}

#overviewDialogContent:not(.dark-mode) {
  --surface-color: #ffffff;
  --panel-bg: #ffffff;
  background-color: #ffffff;
}
#overviewDialogContent h1,
#overviewDialogContent h2,
#overviewDialogContent h3 {
  font-family: var(--font-family);
  font-weight: var(--font-weight-regular);
  color: var(--text-color);
}

#overviewDialogContent:not(.dark-mode) h1,
#overviewDialogContent:not(.dark-mode) h2,
#overviewDialogContent:not(.dark-mode) h3 {
  color: var(--accent-color);
}
#overviewDialogContent h1 {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-display));
  margin-bottom: 0.2em;
}

#printLogo {
  display: none;
}
#overviewDialogContent h2 {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxl));
  margin-top: 1.3em;
  border-bottom: 1px solid var(--divider-color);
  padding-bottom: 5px;
}

#overviewDialogContent:not(.dark-mode) h2 {
  border-bottom: 1px solid var(--accent-color);
}
#overviewDialogContent h3 {
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-lg));
  margin-top: 1em;
}
#overviewDialogContent table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 5px;
  table-layout: fixed;
}
#overviewDialogContent th,
#overviewDialogContent td {
  border: 1px solid var(--panel-border);
  padding: 8px;
  text-align: left;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
  overflow: hidden;
}
#overviewDialogContent th {
  background-color: var(--control-bg);
  font-weight: var(--font-weight-bold);
}
#overviewDialogContent tr:nth-child(even) {
  background-color: var(--panel-bg);
}
#overviewDialogContent .device-block {
  background: #ffffff;
  border: 1px solid var(--panel-border);
  border-radius: 6px;
  padding: 6px 10px;
  box-shadow: var(--panel-shadow);
  font-size: var(--font-size-diagram-text);
}
#overviewDialogContent .device-block strong {
  display: block;
  margin-bottom: 4px;
  font-weight: var(--font-weight-bold);
}
#overviewDialogContent .device-category-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
#overviewDialogContent .device-category {
  background: #ffffff;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  padding: 10px;
  margin-bottom: 10px;
  flex: 1 1 calc((100% - 20px) / 3);
  box-sizing: border-box;
  box-shadow: var(--panel-shadow);
}
#overviewDialogContent .device-category h3 {
  font-family: var(--font-family);
  font-weight: var(--font-weight-regular);
  margin-top: 0;
  margin-bottom: 5px;
  border-bottom: 1px solid var(--divider-color);
  padding-bottom: 3px;
}
#overviewDialogContent .device-block-grid {
  display: grid;
  gap: 8px;
}
#overviewDialogContent .device-block-grid.single-column {
  grid-template-columns: 1fr;
}
#overviewDialogContent .device-block-grid.two-column {
  grid-template-columns: repeat(2, 1fr);
}
#overviewDialogContent .device-block-grid.fiz-single-column {
  grid-template-columns: 1fr;
}

@media screen and (max-width: 600px) {
  #overviewDialogContent .device-category-container {
    flex-direction: column;
  }

  #overviewDialogContent .device-category {
    flex: 1 1 100%;
  }

  #overviewDialogContent .device-block-grid.two-column {
    grid-template-columns: 1fr;
  }
}
#overviewDialogContent.pink-mode {
  --accent-color: #ff69b4;
  --logo-accent-color: var(--brand-accent-color);
}
#overviewDialogContent.dark-mode {
  background-color: var(--background-color);
  color: var(--text-color);
}
#overviewDialogContent.dark-mode h1,
#overviewDialogContent.dark-mode h2,
#overviewDialogContent.dark-mode h3 {
  color: var(--text-color);
}
#overviewDialogContent.dark-mode h2 {
  border-bottom: 1px solid var(--divider-color);
}
#overviewDialogContent.dark-mode th {
  background-color: var(--control-bg);
}
#overviewDialogContent.dark-mode tr:nth-child(even) {
  background-color: #1a1a1a;
}
#overviewDialogContent.dark-mode .device-category {
  background: var(--panel-bg);
  border-color: var(--panel-border);
  box-shadow: var(--panel-shadow);
}
#overviewDialogContent.dark-mode .device-block {
  background: rgba(255, 255, 255, 0.1);
  border-color: var(--control-border);
  box-shadow: var(--panel-shadow);
}

.gear-table {
  width: 100%;
  border-collapse: collapse;
}

.gear-table td {
  padding: 4px 0;
  border-left: none;
  border-right: none;
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
  background: var(--panel-bg);
  line-height: var(--line-height-relaxed);
  break-inside: avoid;
  page-break-inside: avoid;
}

.gear-table tbody {
  break-inside: avoid;
  page-break-inside: avoid;
}

.gear-table .category-row {
  break-after: avoid;
  break-after: avoid-page;
  page-break-after: avoid;
}

.gear-table .auto-gear-item {
  margin: 0;
  padding: 0;
  border: none;
  border-radius: 0;
  background: none;
  box-shadow: none;
  --auto-gear-rule-bg: var(--auto-gear-highlight-bg);
  --auto-gear-rule-border: var(--auto-gear-highlight-border);
  --auto-gear-rule-text: var(--auto-gear-highlight-text);
}

#gearListOutput .auto-gear-rule-badge {
  display: none;
  margin-left: 0.75rem;
  padding: 0.1rem 0.6rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.02em;
  background: color-mix(in srgb, var(--auto-gear-rule-bg, var(--auto-gear-highlight-bg)) 65%, transparent);
  border: 1px solid color-mix(in srgb, var(--auto-gear-rule-border, var(--auto-gear-highlight-border)) 75%, transparent);
  color: var(--auto-gear-rule-text, var(--auto-gear-highlight-text));
  white-space: nowrap;
}

#gearListOutput.show-auto-gear-highlight .auto-gear-rule-badge {
  display: inline-flex;
  align-items: center;
}

#gearListOutput.show-auto-gear-highlight .auto-gear-item {
  display: inline-block;
  max-width: 100%;
  padding: 0.1em 0.5em;
  margin-block: 0.15em;
  border-radius: calc(var(--border-radius) * 0.75);
  background: var(--auto-gear-rule-bg, var(--auto-gear-highlight-bg));
  box-shadow: 0 0 0 2px var(--auto-gear-rule-border, var(--auto-gear-highlight-border));
  color: var(--auto-gear-rule-text, var(--auto-gear-highlight-text));
  white-space: normal;
  word-break: break-word;
}

#gearListOutput.show-auto-gear-highlight .auto-gear-item select {
  border-color: var(--auto-gear-rule-border, var(--auto-gear-highlight-border));
  background: color-mix(in srgb, var(--auto-gear-rule-bg, var(--auto-gear-highlight-bg)) 60%, transparent);
  color: var(--auto-gear-rule-text, var(--auto-gear-highlight-text));
}

.dark-mode #gearListOutput.show-auto-gear-highlight .auto-gear-item select {
  background: color-mix(in srgb, var(--auto-gear-rule-bg, var(--auto-gear-highlight-bg)) 70%, transparent);
}

#gearListOutput .cage-select-wrapper {
  display: inline-flex;
  flex-direction: row;
  align-items: center;
  gap: 0.25rem;
  flex-wrap: wrap;
}

#gearListOutput .cage-select-wrapper > span {
  white-space: nowrap;
}

#gearListOutput .cage-select-wrapper select {
  flex: 0 1 auto;
  max-width: 100%;
}

#gearListOutput .gear-table select {
  padding-inline-end: 0.125rem;
}

.gear-table .category-row td {
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
  font-weight: var(--font-weight-regular);
  color: var(--accent-color);
  break-after: avoid;
  page-break-after: avoid;
}

body.light-mode .gear-table strong,
#gearListOutput:not(.dark-mode) .gear-table strong,
#overviewDialogContent:not(.dark-mode) .gear-table strong {
  color: var(--accent-color);
}

.dark-mode .gear-table td {
  border-top: 1px solid var(--inverse-text-color);
  border-bottom: 1px solid var(--inverse-text-color);
}

.dark-mode .gear-table .category-row td {
  border-top: 1px solid var(--inverse-text-color);
  border-bottom: 1px solid var(--inverse-text-color);
  color: var(--inverse-text-color);
  font-weight: var(--font-weight-medium);
}

.dark-mode.pink-mode .gear-table td,
.dark-mode.dark-accent-boost:not(.pink-mode) .gear-table td {
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
}

.dark-mode.pink-mode .gear-table .category-row td,
.dark-mode.dark-accent-boost:not(.pink-mode) .gear-table .category-row td {
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
  color: var(--accent-color);
  font-weight: var(--font-weight-medium);
}

#overviewDialogContent .gear-table td {
  padding: 4px 0;
  border-left: none;
  border-right: none;
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
  background: var(--panel-bg);
  line-height: var(--line-height-relaxed);
  break-inside: avoid;
  page-break-inside: avoid;
}

#overviewDialogContent .gear-table .category-row td {
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
  font-weight: var(--font-weight-bold);
  color: var(--accent-color);
  break-after: avoid;
  page-break-after: avoid;
}

#overviewDialogContent.dark-mode .gear-table td {
  border-top: 1px solid var(--inverse-text-color);
  border-bottom: 1px solid var(--inverse-text-color);
}

#overviewDialogContent.dark-mode .gear-table .category-row td {
  border-top: 1px solid var(--inverse-text-color);
  border-bottom: 1px solid var(--inverse-text-color);
  color: var(--inverse-text-color);
}

#overviewDialogContent.dark-mode.pink-mode .gear-table td {
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
}

#overviewDialogContent.dark-mode.pink-mode .gear-table .category-row td {
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
  color: var(--accent-color);
}

#gearListOutput,
#projectRequirementsOutput {
  background: var(--panel-bg);
  color: var(--text-color);
  padding: 10px;
  border: 1px solid var(--panel-border);
  border-radius: var(--border-radius);
  margin-top: 10px;
  overflow-x: auto;
}

#gearListOutput h1,
#gearListOutput h2,
#gearListOutput h3 {
  color: var(--accent-color);
}

#gearListOutput h2 {
  border-bottom: 1px solid var(--accent-color);
}

body:not(.dark-mode) #gearListOutput h2,
#gearListOutput:not(.dark-mode) h2 {
  font-weight: var(--font-weight-medium);
}

.dark-mode #gearListOutput h1,
.dark-mode #gearListOutput h2,
.dark-mode #gearListOutput h3,
#gearListOutput.dark-mode h1,
#gearListOutput.dark-mode h2,
#gearListOutput.dark-mode h3 {
  color: var(--inverse-text-color);
}

.dark-mode #gearListOutput h2,
#gearListOutput.dark-mode h2 {
  border-bottom: 1px solid var(--inverse-text-color);
}

body.dark-mode.pink-mode #gearListOutput h1,
body.dark-mode.pink-mode #gearListOutput h2,
body.dark-mode.pink-mode #gearListOutput h3,
#gearListOutput.dark-mode.pink-mode h1,
#gearListOutput.dark-mode.pink-mode h2,
#gearListOutput.dark-mode.pink-mode h3 {
  color: var(--accent-color);
}

body.dark-mode.pink-mode #gearListOutput h2,
#gearListOutput.dark-mode.pink-mode h2 {
  border-bottom: 1px solid var(--accent-color);
}

#gearListFilterDetails {
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
  margin-top: 0.25rem;
  line-height: inherit;
}

#gearListFilterDetails.hidden {
  display: none;
}

#gearListFilterDetails .filter-detail {
  display: grid;
  grid-template-columns: minmax(8.5rem, max-content) minmax(0, 1fr);
  column-gap: 0.5rem;
  row-gap: 0.125rem;
  align-items: center;
  padding: 0;
  border: none;
  border-radius: 0;
  background: none;
}

#gearListFilterDetails .filter-detail-label {
  font-size: inherit;
  font-weight: inherit;
  min-width: 0;
  margin-right: 0;
  line-height: inherit;
}

#gearListFilterDetails .filter-detail-controls {
  display: flex;
  flex: 1 1 auto;
  flex-wrap: wrap;
  gap: 0.375rem 0.5rem;
  align-items: center;
}

#gearListFilterDetails .filter-detail-size {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  font-weight: var(--font-weight-regular);
  padding: 0;
  border: none;
  background: none;
}

#gearListFilterDetails .filter-detail-size .select-wrapper {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
}

#gearListFilterDetails .filter-detail-size .select-wrapper select {
  min-width: 3.5rem;
  margin: 0;
  width: var(--gear-select-width, auto);
}

#gearListFilterDetails .filter-detail-size .select-wrapper select:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

#gearListFilterDetails .filter-detail-values {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
  align-items: center;
}

#gearListFilterDetails .filter-detail-sublabel {
  font-weight: var(--font-weight-light);
}

#gearListFilterDetails .filter-detail-sublabel::after {
  content: ':';
}

#gearListFilterDetails .filter-values-container {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 0.25rem;
}

#gearListFilterDetails .filter-value-option {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.125rem 0.5rem;
  border-radius: var(--border-radius);
  border: 1px solid transparent;
  background-color: transparent;
  transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
}

#gearListFilterDetails .filter-value-option:hover {
  border-color: var(--accent-color);
  background-color: var(--panel-bg);
}

#gearListFilterDetails .filter-value-option:focus-within {
  border-color: var(--accent-color);
  box-shadow: 0 0 0 1px var(--accent-color);
  background-color: var(--panel-bg);
}

@media (max-width: 640px) {
  #gearListFilterDetails .filter-detail {
    grid-template-columns: minmax(0, 1fr);
  }

  #gearListFilterDetails .filter-detail-label {
    margin-bottom: 0.125rem;
  }
}

@supports (color: color-mix(in srgb, #000 50%, white)) {
  #gearListFilterDetails .filter-detail-size:focus-within {
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 35%, transparent);
    background-color: color-mix(in srgb, var(--accent-color) 12%, var(--panel-bg));
  }

  #gearListFilterDetails .filter-value-option:hover {
    background-color: color-mix(in srgb, var(--accent-color) 8%, var(--panel-bg));
  }

  #gearListFilterDetails .filter-value-option:focus-within {
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 35%, transparent);
    background-color: color-mix(in srgb, var(--accent-color) 12%, var(--panel-bg));
  }
}

#gearListFilterDetails .filter-value-option input[type="checkbox"] {
  margin: 0;
  padding: 0;
  accent-color: var(--accent-color);
}

#gearListFilterDetails .filter-value-option input[type="checkbox"]:focus-visible {
  outline: none;
}

#gearListOutput .select-wrapper,
#projectRequirementsOutput .select-wrapper {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  flex: 0 0 auto;
  width: auto;
  max-width: 100%;
  vertical-align: middle;
}

#gearListOutput .select-wrapper select,
#projectRequirementsOutput .select-wrapper select {
  flex: 0 0 auto;
  width: var(--gear-select-width, auto);
  max-width: 100%;
}

#gearListOutput .select-wrapper .favorite-toggle,
#projectRequirementsOutput .select-wrapper .favorite-toggle {
  flex: 0 0 auto;
  margin-inline-end: var(--gap-size);
  margin-right: var(--gap-size);
}

#gearListActions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  align-items: center;
  margin-bottom: 1rem;
}

#gearListActions .gear-list-autosave-note {
  flex-basis: 100%;
  margin: 0;
  font-size: calc(var(--font-size-base) * var(--font-scale-sm));
  color: var(--muted-text-color);
}

#gearListActions .gear-list-action-btn {
  margin: 0;
  border: 1px solid color-mix(in srgb, var(--accent-color) 45%, transparent);
  background: color-mix(in srgb, var(--surface-color) 92%, var(--accent-color) 8%);
  color: var(--control-text);
  font-weight: var(--font-weight-medium);
  justify-content: flex-start;
  padding-inline: calc(var(--button-padding-inline) * 0.9);
  min-width: 0;
}

#gearListActions .gear-list-action-btn .btn-icon {
  margin-inline-end: var(--icon-gap);
  color: currentColor;
}

#gearListActions .gear-list-action-btn:hover,
#gearListActions .gear-list-action-btn:focus-visible {
  background: var(--accent-color);
  color: var(--inverse-text-color);
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 35%, transparent);
}

#gearListActions .gear-list-action-btn:focus-visible {
  outline: none;
}

#gearListActions .gear-list-action-btn.is-active {
  background: var(--accent-color);
  color: var(--inverse-text-color);
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 45%, transparent);
}

.gear-list-autosave-note--overlay {
  position: fixed;
  left: 50%;
  bottom: calc(env(safe-area-inset-bottom, 0px) + clamp(1rem, 3vw, 2.5rem));
  transform: translate(-50%, 1rem);
  max-width: min(90vw, 40rem);
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius);
  border: 2px solid var(--panel-border);
  background: var(--surface-color);
  color: var(--text-color);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
  text-align: center;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-sm));
  line-height: 1.4;
  pointer-events: none;
  z-index: 240;
  opacity: 0;
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.gear-list-autosave-note--overlay.is-visible {
  opacity: 1;
  transform: translate(-50%, 0);
}

#settingsDialog.has-gear-list-note .settings-content {
  padding-bottom: clamp(6rem, 12vw, 8rem);
}

@media (max-width: 600px) {
  #settingsDialog.has-gear-list-note .settings-content {
    padding-bottom: clamp(7rem, 24vw, 10rem);
  }
}

@media (max-width: 600px) {
  .gear-list-autosave-note--overlay {
    padding: 0.75rem;
    font-size: calc(var(--font-size-relative-base) * var(--font-scale-xs));
  }
}

@media (max-width: 600px) {
  #gearListOutput,
  #projectRequirementsOutput {
    overflow-x: visible;
  }
  #gearListOutput table,
  #projectRequirementsOutput table,
  #gearListOutput select,
  #projectRequirementsOutput select {
    width: 100%;
    max-width: 100%;
  }
  #gearListOutput .cage-select-wrapper {
    width: 100%;
  }
  #gearListOutput .cage-select-wrapper select {
    width: auto;
    flex: 1 1 auto;
    min-width: 0;
  }
  #gearListOutput .select-wrapper,
  #projectRequirementsOutput .select-wrapper {
    display: flex;
    width: 100%;
  }
  #gearListOutput .select-wrapper select,
  #projectRequirementsOutput .select-wrapper select {
    flex: 1 1 auto;
  }
  #gearListOutput select,
  #projectRequirementsOutput select {
    box-sizing: border-box;
  }
  #gearListOutput td,
  #projectRequirementsOutput td {
    white-space: normal;
    overflow-wrap: anywhere;
  }
}

/* Sidebar menu */
#menuToggle {
  background: none;
  border: none;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-xxxl));
}

#sideMenu {
  position: fixed;
  top: 0;
  right: 0;
  height: 100%;
  width: 250px;
  background: var(--surface-color);
  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.3);
  padding: calc(var(--page-padding) + 10px);
  padding-left: calc(var(--page-padding) + 20px);
  z-index: 200;
  transition: transform 0.3s ease;
  transform: translateX(100%);
}

#sideMenu.open {
  transform: translateX(0);
}

#sideMenu ul {
  list-style: none;
  padding: 0;
  margin: 0;
  border-top: 1px solid var(--accent-color);
  border-bottom: 1px solid var(--accent-color);
}

#sideMenu li {
  margin: 0;
}

#sideMenu li + li {
  border-top: 1px solid var(--accent-color);
}

#sideMenu li.sidebar-divider {
  padding: 8px 0;
  margin: 12px 0;
}

#sideMenu li.sidebar-divider + li {
  border-top: none;
}

#sideMenu a {
  color: var(--text-color);
  text-decoration: none;
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-lg));
  display: block;
  padding: 10px 0;
}

#sideMenu button[data-sidebar-action] {
  display: block;
  width: 100%;
  padding: 10px 0;
  background: none;
  border: none;
  color: var(--text-color);
  font-size: calc(var(--font-size-relative-base) * var(--font-scale-lg));
  text-align: left;
  cursor: pointer;
}

#sideMenu button[data-sidebar-action]:hover {
  color: var(--accent-color);
}

#sideMenu button[data-sidebar-action]:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

body.light-mode #sideMenu ul {
  border-top: 1px solid color-mix(in srgb, var(--accent-color) 55%, var(--surface-color));
  border-bottom: 1px solid color-mix(in srgb, var(--accent-color) 55%, var(--surface-color));
}

body.light-mode #sideMenu li + li {
  border-top: 1px solid color-mix(in srgb, var(--accent-color) 45%, var(--surface-color));
}

body.light-mode #sideMenu a,
body.light-mode #sideMenu button[data-sidebar-action] {
  color: color-mix(in srgb, var(--accent-color) 72%, var(--text-color));
}

body.light-mode #sideMenu a:hover,
body.light-mode #sideMenu button[data-sidebar-action]:hover {
  color: var(--accent-color);
}

body.light-mode #sideMenu a:focus-visible,
body.light-mode #sideMenu button[data-sidebar-action]:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent-color) 70%, var(--surface-color));
  outline-offset: 3px;
}

.dark-mode #sideMenu ul {
  border-color: var(--accent-color);
}

.dark-mode #sideMenu li + li {
  border-color: var(--accent-color);
}

#menuOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 150;
}

@supports (padding: env(safe-area-inset-top)) {
  #sideMenu {
    padding:
      calc(var(--page-padding) + 10px + env(safe-area-inset-top))
      calc(var(--page-padding) + 10px + env(safe-area-inset-right))
      calc(var(--page-padding) + 10px + env(safe-area-inset-bottom))
      calc(var(--page-padding) + 20px + env(safe-area-inset-left));
  }
}

@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
  }
}

@media print {
  /* Hide everything except the overview dialog when printing */
  body > :not(#overviewDialog) {
    display: none !important;
  }

  html,
  body,
  #overviewDialogContent {
    --status-warning-text-color: #ffffff !important;
    --status-error-text-color: #000 !important;
  }

  .status-message--warning {
    color: #ffffff !important;
  }

  .status-message--danger {
    color: #000 !important;
  }

  #overviewDialog {
    display: block;
    position: static;
    width: auto;
    max-width: none;
    max-height: none;
    height: auto;
    overflow: visible;
  }

  #overviewDialogContent {
    max-height: none;
    overflow: visible;
  }
}
