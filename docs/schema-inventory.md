# Schema Inventory

This inventory documents the persistent data shapes stored by Cine Power Planner.
Update it whenever storage logic changes so engineers, QA and documentation can
validate backups without inspecting code online.

## Top-level storage keys

| Key | Source module | Shape | Notes |
| --- | --- | --- | --- |
| `cameraPowerPlanner_devices` | `storage.js` (`loadDevices`) | Array of device objects `{ id, name, voltageFamily, wattDraw, notes, source }`. | Bundled catalog entries + user-added gear. |
| `cameraPowerPlanner_setups` | `storage.js` (`loadSetups`) | Array of rig setups `{ id, name, projectId, devices: [deviceId], accessories: [...] }`. | Drives runtime estimator tables. |
| `cameraPowerPlanner_sessionState` | `storage.js` (`loadSessionState`) | Object `{ selectedProjectId, selectedSetupId, lastVisitedView, theme, language }`. | Reset-safe; non-critical if missing. |
| `cameraPowerPlanner_feedback` | `storage.js` (`loadFeedback`) | Object keyed by ISO timestamp with `{ message, category }`. | Logged for rehearsal notes; exported in planner backup. |
| `cameraPowerPlanner_project` | `storage.js` (`loadProject`) | Object describing active project `{ id, name, notes, crew, requirements, scenarios }`. | Always cloned before mutation. |
| `cameraPowerPlanner_favorites` | `storage.js` (`loadFavorites`) | Array of device IDs and setup IDs pinned for quick access. |  |
| `cameraPowerPlanner_ownGear` | `storage.js` (`loadOwnGear`) | Array of custom gear entries `{ id, name, mount, capacityWh, voltage, weight, notes, source }`. | Used by automatic gear rules. |
| `cameraPowerPlanner_userProfile` | `storage.js` (`loadUserProfile`) | Object `{ name, role, avatar, phone, email }`. | Avatar is a data URI. Empty values remove storage entry. |
| `cameraPowerPlanner_documentationTracker` | `storage.js` (`loadDocumentationTracker`) | Object `{ statusReports: [...], coverageMatrix: {...}, lastAudit: ISO }`. | Mirrors docs folder status; update when checklists change. |
| `cameraPowerPlanner_autoGearRules` | `storage.js` (`loadAutomaticGearRules`) | Object keyed by scenario ID with arrays of rule descriptors `{ id, deviceId, quantity, helper }`. | Generated by `modules/features/auto-gear-rules.js`. |
| `cameraPowerPlanner_autoGearBackups` | `storage.js` (`loadAutomaticGearBackups`) | Array of timestamped snapshots `{ createdAt, rules }`. | Populated before every rule change/import. |
| `cameraPowerPlanner_autoGearPresets` | `storage.js` (`loadAutomaticGearPresets`) | Object mapping preset IDs to scenario rule collections. | Imported/exported with project bundles. |
| `cameraPowerPlanner_autoGearMonitorDefaults` | `storage.js` (`loadAutomaticGearMonitorDefaults`) | Object storing preferred monitors `{ scenarioId: monitorId }`. | Keeps helper defaults deterministic. |
| `cameraPowerPlanner_autoGearBackupRetention` | `storage.js` (`loadAutomaticGearBackupRetention`) | Object `{ limit: number, lastPruneAt: ISO }`. | Controls rolling backups for presets. |

## Planner backup structure

`planner-backup.json` contains:

```
{
  "version": "<semantic version>",
  "exportedAt": "<ISO timestamp>",
  "projects": [...],
  "setups": [...],
  "devices": [...],
  "ownGear": [...],
  "favorites": [...],
  "autoGearRules": {...},
  "autoGearBackups": [...],
  "autoGearPresets": {...},
  "autoGearMonitorDefaults": {...},
  "session": {...},
  "feedback": {...},
  "userProfile": {...},
  "documentationTracker": {...}
}
```

All arrays/objects follow the shapes above. The backup also includes a checksum
field inside the verification packet manifest, not in the JSON payload.

## Validation references

- `storage.js` defines `normalize*` helpers for each shape; review them when
  updating this inventory.
- `modules/helpers/schema/` contains JSON schema snippets reused by import
  validators.
- During restores, the runtime coerces unknown fields into safe defaults and
  logs discrepancies to the diagnostics timeline.

## Maintenance steps

1. Update this doc whenever new keys are added or structures change.
2. Sync the [Save, Share & Restore Reference](save-share-restore-reference.md)
   and [Documentation Coverage Matrix](documentation-coverage-matrix.md) after
   schema updates.
3. Store a copy of the updated schema inventory with the verification packet so
   offline audits can validate backups without code access.
